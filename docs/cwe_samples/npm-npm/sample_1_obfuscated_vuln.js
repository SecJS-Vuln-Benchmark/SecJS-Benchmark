'use strict';function _0x44fd(){const _0x42730d=['72523ubzrJK','KEQdr','ymJUK','make_debugLog','should','SpKJJ','UVamK','iterateOnSignedAndEncryptedMessageChunks','error','lKECx','okKdg','../dist/test_helpers/fake_message_chunk_factory','node-opcua-test-helpers','xfABY','Basic128Rsa15','fOsMl','readPrivateRsaKey','should\x20process\x20a\x20signed\x20and\x20encrypted\x20message','it\x20should\x20not\x20emit\x20a\x20message\x20event\x20if\x20a\x20signature\x20is\x20invalid\x20or\x20missing','MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(MSG)\x20','node-opcua-service-secure-channel','eql','iterateOnSignedMessageChunks','privateKey','ceqzs','slice','setSecurity','this\x20chunk\x20has\x20a\x20altered\x20body\x20(\x20signature\x20verification\x20failed)','viHuE','664956oGIfxs','feed','pushNewToken','6feQpOS','eAjNW','exist','xnLFP','securityPolicy','wYCZE','10YBXgsc','230utGwhm','fQuib','should\x20emit\x20an\x20bad_signature\x20event\x20if\x20chunk\x20has\x20been\x20tempered','yellow','full_message_body','13938396nmVXzH','_decodeMessageBody','1916745dyHrgS','should\x20reconstruct\x20a\x20full\x20message\x20made\x20of\x20many\x20signed\x20chunks','HcABq','should\x20not\x20emit\x20an\x20error\x20event\x20with\x20valid\x20SIGN\x20&\x20ENCRYPT\x20chunks','HTUkq','toString','TEST','node-opcua-crypto','uPMNG','YbIpe','QsVcE','message','acDJi','YqUSa','wEtur','72233JqGODo','certs/server_key_1024.pem','776OhqcCC','length','chalk','write','uUlOz','ZZJRA','not','node-opcua-test-fixtures','chunk','541038IsGFFq','Sign','####***\x20TEMPERED\x20***#####','\x20we\x20are\x20not\x20expecting\x20a\x20error\x20event\x20in\x20this\x20case','28341uootlu','49xLOqEf','MessageBuilder\x20with\x20SIGN\x20support','FrhZw','bHedt','node-opcua-debug'];_0x44fd=function(){return _0x42730d;};return _0x44fd();}const _0x50c699=_0x42f9;(function(_0x43caad,_0x2c68e8){const _0x35d0ac=_0x42f9,_0x16813a=_0x43caad();while(!![]){try{const _0x1e187e=parseInt(_0x35d0ac(0x1d8))/0x1*(parseInt(_0x35d0ac(0x1c1))/0x2)+-parseInt(_0x35d0ac(0x1bb))/0x3*(parseInt(_0x35d0ac(0x1b8))/0x4)+parseInt(_0x35d0ac(0x1c9))/0x5+parseInt(_0x35d0ac(0x191))/0x6*(parseInt(_0x35d0ac(0x196))/0x7)+-parseInt(_0x35d0ac(0x1da))/0x8*(-parseInt(_0x35d0ac(0x195))/0x9)+parseInt(_0x35d0ac(0x1c2))/0xa*(parseInt(_0x35d0ac(0x19b))/0xb)+-parseInt(_0x35d0ac(0x1c7))/0xc;if(_0x1e187e===_0x2c68e8)break;else _0x16813a['push'](_0x16813a['shift']());}catch(_0x587d66){_0x16813a['push'](_0x16813a['shift']());}}}(_0x44fd,0x52b76));function _0x42f9(_0x174165,_0x33a464){const _0x44fdd2=_0x44fd();return _0x42f9=function(_0x42f935,_0x104fa5){_0x42f935=_0x42f935-0x18b;let _0x43009b=_0x44fdd2[_0x42f935];return _0x43009b;},_0x42f9(_0x174165,_0x33a464);}const should=require(_0x50c699(0x19f)),chalk=require(_0x50c699(0x1dc)),debugLog=require(_0x50c699(0x19a))[_0x50c699(0x19e)](_0x50c699(0x1cf)),{hexDump}=require(_0x50c699(0x19a)),{MessageSecurityMode}=require(_0x50c699(0x1af)),crypto_utils=require(_0x50c699(0x1d0)),{make_lorem_ipsum_buffer}=require(_0x50c699(0x1a7)),{getFixture}=require(_0x50c699(0x18f)),fake_message_chunk_factory=require(_0x50c699(0x1a6)),{MessageBuilder,SecurityPolicy}=require('..'),private_key_filename=getFixture(_0x50c699(0x1d9));function fake_decodeMessageBody(_0x3da8c5){const _0x3bea5a=_0x50c699,_0x32a129={'wEtur':_0x3bea5a(0x1d4)};return this['emit'](_0x32a129[_0x3bea5a(0x1d7)],_0x3da8c5),!![];}describe(_0x50c699(0x197),function(){const _0x5d0a70=_0x50c699,_0x4a597b={'ceqzs':function(_0x520e28){return _0x520e28();},'bHedt':'message','xfABY':function(_0x15698f,_0x2c515a){return _0x15698f(_0x2c515a);},'HTUkq':_0x5d0a70(0x194),'RXVXl':'it\x20should\x20not\x20emit\x20a\x20message\x20event\x20if\x20a\x20signature\x20is\x20invalid\x20or\x20missing','wYCZE':function(_0x4f4492,_0x124f06){return _0x4f4492!==_0x124f06;},'MubRe':_0x5d0a70(0x1d3),'fQuib':function(_0xfd7993,_0x2ed609){return _0xfd7993(_0x2ed609);},'HcABq':_0x5d0a70(0x1b6),'FrhZw':_0x5d0a70(0x1d1),'fOsMl':'full_message_body','xnLFP':'error','UVamK':_0x5d0a70(0x1ca),'cokUB':function(_0x2ca671,_0x3279ec,_0x37198e){return _0x2ca671(_0x3279ec,_0x37198e);},'YbIpe':_0x5d0a70(0x1c4)},_0x820902=make_lorem_ipsum_buffer(),_0x30ae0d=Buffer['from'](_0x820902,_0x820902[_0x5d0a70(0x1db)]);it('should\x20not\x20emit\x20an\x20error\x20event\x20if\x20chunks\x20have\x20valid\x20signature',function(_0x386d5d){const _0x28b416=_0x5d0a70,_0x45d9b5={},_0x3529e0=new MessageBuilder(_0x45d9b5);_0x3529e0[_0x28b416(0x1b2)]=crypto_utils[_0x28b416(0x1ab)](private_key_filename),_0x3529e0[_0x28b416(0x1c8)]=fake_decodeMessageBody,_0x3529e0['on'](_0x28b416(0x1c6),_0x528d1b=>{const _0x22322a=_0x28b416;_0x4a597b[_0x22322a(0x1b3)](_0x386d5d);})['on'](_0x4a597b[_0x28b416(0x199)],_0x3e11ae=>{})['on'](_0x28b416(0x1a3),_0x1f38dc=>{_0x386d5d(_0x1f38dc);}),fake_message_chunk_factory['iterateOnSignedMessageChunks'](_0x30ae0d,function(_0x24d3a7,_0x327704){const _0x3d6f78=_0x28b416;should[_0x3d6f78(0x18e)]['exist'](_0x24d3a7),_0x3529e0[_0x3d6f78(0x1b9)](_0x327704['slice'](0x0,0x14)),_0x3529e0[_0x3d6f78(0x1b9)](_0x327704['slice'](0x14));});}),it(_0x4a597b[_0x5d0a70(0x1a1)],function(_0x3eedd5){const _0x40c198=_0x5d0a70,_0x458a39={'HFSld':function(_0x2ea0bf,_0x2531db){const _0x5f26a7=_0x42f9;return _0x4a597b[_0x5f26a7(0x1a8)](_0x2ea0bf,_0x2531db);},'acDJi':function(_0x55b76e,_0x314352){const _0xdd8574=_0x42f9;return _0x4a597b[_0xdd8574(0x1a8)](_0x55b76e,_0x314352);},'lKECx':function(_0x535994,_0x5a4f78){const _0x2f6f20=_0x42f9;return _0x4a597b[_0x2f6f20(0x1a8)](_0x535994,_0x5a4f78);},'UgZTN':function(_0x3c7b30,_0x54ec69){return _0x3c7b30+_0x54ec69;},'okKdg':_0x4a597b[_0x40c198(0x1cd)]},_0x41d0e4={},_0x17309a=new MessageBuilder(_0x41d0e4);_0x17309a[_0x40c198(0x1b5)](MessageSecurityMode[_0x40c198(0x192)],SecurityPolicy[_0x40c198(0x1a9)]),_0x17309a[_0x40c198(0x1c8)]=fake_decodeMessageBody,_0x17309a['on'](_0x40c198(0x1c6),_0xa5e6dd=>{const _0x2db49d=_0x40c198;debugLog(_0xa5e6dd[_0x2db49d(0x1ce)]()),_0xa5e6dd[_0x2db49d(0x1ce)]()[_0x2db49d(0x19f)][_0x2db49d(0x1b0)](_0x30ae0d['toString']());})['on'](_0x40c198(0x190),_0x3f47e7=>{const _0x144bfd=_0x40c198;_0x458a39['HFSld'](debugLog,_0x458a39[_0x144bfd(0x1d5)](hexDump,_0x3f47e7));})['on'](_0x40c198(0x1d4),_0x270d85=>{const _0x379dad=_0x40c198;_0x458a39[_0x379dad(0x1d5)](debugLog,_0x458a39['acDJi'](hexDump,_0x270d85)),_0x3eedd5();})['on'](_0x40c198(0x1a3),_0x38ca20=>{const _0x182888=_0x40c198;_0x458a39[_0x182888(0x1a4)](_0x3eedd5,new Error(_0x458a39['UgZTN'](_0x458a39[_0x182888(0x1a5)],_0x38ca20)));}),fake_message_chunk_factory[_0x40c198(0x1b1)](_0x30ae0d,function(_0x30234c,_0x22f155){const _0x3ec27f=_0x40c198;should[_0x3ec27f(0x18e)]['exist'](_0x30234c),_0x17309a['feed'](_0x22f155['slice'](0x0,0x14)),_0x17309a['feed'](_0x22f155[_0x3ec27f(0x1b4)](0x14));});}),_0x4a597b['cokUB'](it,_0x4a597b[_0x5d0a70(0x1d2)],function(_0x5307e2){const _0x16b570=_0x5d0a70,_0x59de01={'HaPjL':function(_0x1f0afb,_0x2b0983){const _0x1e5d9b=_0x42f9;return _0x4a597b[_0x1e5d9b(0x1c3)](_0x1f0afb,_0x2b0983);},'YqUSa':_0x4a597b['RXVXl']};if(_0x16b570(0x19d)===_0x4a597b[_0x16b570(0x198)])_0x2d44de(new _0x451cef(_0x4a597b['RXVXl']));else{const _0x3c8cc6={},_0x44b4b2=new MessageBuilder(_0x3c8cc6);_0x44b4b2[_0x16b570(0x1c8)]=fake_decodeMessageBody,_0x44b4b2['on'](_0x4a597b[_0x16b570(0x1aa)],_0x4364bb=>{const _0x1baf8c=_0x16b570;_0x59de01['HaPjL'](_0x5307e2,new Error(_0x59de01[_0x1baf8c(0x1d6)]));})['on'](_0x16b570(0x1d4),_0x21b5ea=>{_0x5307e2(new Error(_0x4a597b['RXVXl']));})['on'](_0x4a597b[_0x16b570(0x1be)],_0x16921c=>{const _0x30bce0=_0x16b570;_0x4a597b[_0x30bce0(0x1c0)](_0x4a597b['MubRe'],'aaWhl')?(_0x4a597b[_0x30bce0(0x1c3)](debugLog,_0x16921c),debugLog(chalk[_0x30bce0(0x1c5)](_0x4a597b[_0x30bce0(0x1cb)])),_0x5307e2()):(_0x3d39da['not'][_0x30bce0(0x1bd)](_0x2c8098),_0x4d884a[_0x30bce0(0x1b9)](_0x1fde59[_0x30bce0(0x1b4)](0x0,0x14)),_0xc2902f[_0x30bce0(0x1b9)](_0x5d9437[_0x30bce0(0x1b4)](0x14)));}),fake_message_chunk_factory[_0x16b570(0x1b1)](_0x30ae0d,function(_0x21c41c,_0xb80700){const _0x23b066=_0x16b570;should[_0x23b066(0x18e)][_0x23b066(0x1bd)](_0x21c41c),_0xb80700[_0x23b066(0x18b)](_0x23b066(0x193),0x3a0),_0x44b4b2['feed'](_0xb80700[_0x23b066(0x1b4)](0x0,0x14)),_0x44b4b2[_0x23b066(0x1b9)](_0xb80700[_0x23b066(0x1b4)](0x14));});}});}),describe('MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(OPN)\x20',function(){const _0x190297=_0x50c699,_0x272852={'ZZJRA':function(_0x34de04){return _0x34de04();},'SpKJJ':_0x190297(0x1d4)},_0xfead9f=_0x272852[_0x190297(0x18d)](make_lorem_ipsum_buffer);it(_0x190297(0x1cc),function(_0x3952b3){const _0x219647=_0x190297,_0x52b635={},_0x25b03d=new MessageBuilder(_0x52b635);_0x25b03d['privateKey']=crypto_utils[_0x219647(0x1ab)](private_key_filename),_0x25b03d[_0x219647(0x1c8)]=fake_decodeMessageBody,_0x25b03d['on']('full_message_body',_0x3ebbb3=>{const _0x2cf848=_0x219647;_0x3ebbb3[_0x2cf848(0x1ce)]()[_0x2cf848(0x19f)][_0x2cf848(0x1b0)](_0xfead9f[_0x2cf848(0x1ce)]()),_0x272852[_0x2cf848(0x18d)](_0x3952b3);})['on'](_0x272852[_0x219647(0x1a0)],_0xdf42a9=>{})['on'](_0x219647(0x1a3),_0x226914=>{_0x3952b3(_0x226914);}),fake_message_chunk_factory[_0x219647(0x1a2)](_0xfead9f,function(_0x15f4bb,_0x37afaa){const _0x4ef1ed=_0x219647;should[_0x4ef1ed(0x18e)]['exist'](_0x15f4bb),_0x25b03d['feed'](_0x37afaa['slice'](0x0,0x14)),_0x25b03d['feed'](_0x37afaa['slice'](0x14));});});}),describe(_0x50c699(0x1ae),function(){const _0x54de45=_0x50c699,_0x40ffb6={'eAjNW':'roazE','KEQdr':function(_0x5040c7){return _0x5040c7();},'UNFJo':_0x54de45(0x1a3)},_0x4a3fb6=make_lorem_ipsum_buffer();it(_0x54de45(0x1ac),function(_0x443f38){const _0x196a5d=_0x54de45,_0x5b0574={'viHuE':_0x40ffb6[_0x196a5d(0x1bc)],'uUlOz':function(_0x3134f7){const _0x50c842=_0x196a5d;return _0x40ffb6[_0x50c842(0x19c)](_0x3134f7);}},_0xebef53={},_0x422cb6=new MessageBuilder(_0xebef53);_0x422cb6[_0x196a5d(0x1c8)]=fake_decodeMessageBody,_0x422cb6[_0x196a5d(0x1bf)]=SecurityPolicy[_0x196a5d(0x1a9)],_0x422cb6['privateKey']=crypto_utils['readPrivateRsaKey'](private_key_filename),_0x422cb6['securityMode']=MessageSecurityMode['SignAndEncrypt'],_0x422cb6[_0x196a5d(0x1ba)]({'tokenId':0xa},fake_message_chunk_factory['derivedKeys']),_0x422cb6['on'](_0x196a5d(0x1c6),_0x32c083=>{const _0x2be14d=_0x196a5d;'roazE'===_0x5b0574[_0x2be14d(0x1b7)]?(_0x32c083['toString']()[_0x2be14d(0x19f)][_0x2be14d(0x1b0)](_0x4a3fb6[_0x2be14d(0x1ce)]()),_0x5b0574[_0x2be14d(0x18c)](_0x443f38)):_0x599c5d(new _0x20a845(_0x2be14d(0x1ad)));})['on']('message',_0x4c3b25=>{})['on'](_0x40ffb6['UNFJo'],_0x206b79=>{_0x443f38(_0x206b79);}),fake_message_chunk_factory['iterateOnSymmetricEncryptedChunk'](_0x4a3fb6,function(_0x4d0a96,_0x5e8f42){const _0x422386=_0x196a5d;should['not'][_0x422386(0x1bd)](_0x4d0a96),_0x422cb6[_0x422386(0x1b9)](_0x5e8f42);});});});