const _0x288c42=_0x4134;(function(_0x45a325,_0x403d14){const _0xa0ae1f=_0x4134,_0x3a1b9e=_0x45a325();while(!![]){try{const _0x3c03d4=-parseInt(_0xa0ae1f(0x2b6))/0x1*(parseInt(_0xa0ae1f(0x279))/0x2)+parseInt(_0xa0ae1f(0x2e5))/0x3+parseInt(_0xa0ae1f(0x247))/0x4*(parseInt(_0xa0ae1f(0x2ae))/0x5)+parseInt(_0xa0ae1f(0x161))/0x6*(-parseInt(_0xa0ae1f(0x195))/0x7)+-parseInt(_0xa0ae1f(0x17e))/0x8*(-parseInt(_0xa0ae1f(0x2ab))/0x9)+-parseInt(_0xa0ae1f(0x1d5))/0xa*(parseInt(_0xa0ae1f(0x1c8))/0xb)+-parseInt(_0xa0ae1f(0x207))/0xc*(-parseInt(_0xa0ae1f(0x16c))/0xd);if(_0x3c03d4===_0x403d14)break;else _0x3a1b9e['push'](_0x3a1b9e['shift']());}catch(_0x38214a){_0x3a1b9e['push'](_0x3a1b9e['shift']());}}}(_0x4675,0x8dee5));const assert=require(_0x288c42(0x2d4)),should=require(_0x288c42(0x28b)),sinon=require('sinon'),supertest=require(_0x288c42(0x240)),moment=require(_0x288c42(0x20f)),testUtils=require(_0x288c42(0x186)),configUtils=require(_0x288c42(0x243)),settingsCache=require(_0x288c42(0x28d)),settingsHelpers=require('../../core/server/services/settings-helpers'),DomainEvents=require(_0x288c42(0x2b9)),{MemberPageViewEvent}=require(_0x288c42(0x238)),models=require(_0x288c42(0x1fe)),{fixtureManager}=require('../utils/e2e-framework'),DataGenerator=require('../utils/fixtures/data-generator'),members=require(_0x288c42(0x150)),crypto=require(_0x288c42(0x188));function assertContentIsPresent(_0x293c5e){const _0x32e4bb=_0x288c42;_0x293c5e[_0x32e4bb(0x24a)][_0x32e4bb(0x28b)][_0x32e4bb(0x158)](_0x32e4bb(0x293));}function _0x4675(){const _0xde78da=['test-invalid-signature','thou-must-have-default-product','status','update','vKMAh','/thou-shalt-be-paid-for/','oQGfX','eql','stzcC','1324vEXnGa','should\x20error\x20serving\x20webhook\x20endpoint\x20without\x20any\x20parameters','ODfJg','get','/unsubscribe/?uuid=XXX','iEJvL','BMCTp','UWMeu','TJsmF','paid','lyZJk','aQAoX','Newsletters','blpUB','can\x20fetch\x20member\x20data','iQHOK','as\x20free\x20member','/members/api/member','should','add','../../core/shared/settings-cache','TgWor','/members/','ysSeN','jlObO','Uqssl','<h2\x20id=\x22markdown\x22>markdown</h2>','should\x20error\x20for\x20invalid\x20data\x20on\x20members\x20create\x20checkout\x20session\x20endpoint','cannot\x20read\x20members\x20post\x20content','http://127.0.0.1:2369/?uuid=XXX&key=YYY&action=unsubscribe','The\x20member\x20shouldn\x27t\x20have\x20a\x20`last_seen_at`\x20property\x20set\x20before\x20this\x20test.','uhZWr','bCqvL','svAcb','rauxD','/free-to-see/','/unsubscribe/?uuid=XXX&newsletter=YYY','FeXfX','PYhdZ','body','YiulW','tFTRT','plHNU','AkxNz','IDnyL','searchParams','Stripe-Signature','api','set-cookie','vip@test.com','397107fWGjkX','LqrRE','members','5ceiPfO','/members/api/subscriptions/123','xQZVS','name','should\x20fetch\x20and\x20update\x20member\x20newsletters\x20with\x20valid\x20uuid','members-test-theme','success','/unsubscribe/','1691qvjTbX','property','CwFTJ','@tryghost/domain-events','JkOcc','should\x20unsubscribe\x20from\x20comment\x20notifications\x20on\x20POST','xUsPG','Sending\x20a\x20POST\x20request\x20to\x20the\x20unsubscribe\x20endpoint\x20should\x20unsubscribe\x20the\x20member\x20from\x20that\x20specific\x20newsletter','xrgqu','form','newsletters','pathname','<p>Free\x20content</p><!--members-only--><p>Members\x20content</p>','eMQJI','XDPmQ','ISeQb','zzFRu','email_suppression','List-Unsubscribe','lfDZS','an\x20invalid\x20token\x20causes\x20a\x20set-cookie\x20logout\x20when\x20requesting\x20the\x20identity','IPlwg','aIogg','ipEfT','&newsletter=','should\x20reject\x20when\x20missing\x20a\x20uuid','unsubscribe-member-test-5@example.com','Brqgw','/members/api/member/newsletters?uuid=abc&key=blah','vBOst','assert/strict','YanJy','CHZGy','headers','GSqSO','nWfGN','as\x20paid\x20member','IMYMY','as\x20comped\x20member','transient_id','email','tsgLV','YBFVj','cBjOY','post','VOGAG','bfdJY','2048061MeHUqT','as\x20non-member','Member','notEqual','NYxaK','yvdCT','pRCSC','osrwg','/members/api/member/newsletters?uuid=','AFNVR','yMZpG','tZesv','PDoXz','thefalsekey','exist','cycleTransientId','JSbML','jzFAD','VYoTf','KsWII','fixtures','../../core/server/services/members','IwOhW','Could\x20not\x20find\x20subscription\x20invalid','should\x20fail\x20processing\x20a\x20webhook\x20endpoint\x20with\x20stripe\x20header','NTssi','var\x20x\x20=\x2042;\x20return\x20x;','/unsubscribe/?uuid=','XHntT','containEql','sLSdN','/unsubscribe/?uuid=XXX&key=YYY','gpsxI','should\x20do\x20an\x20actual\x20unsubscribe\x20on\x20POST','kNXNq','unsubscribe\x20post\x20works\x20with\x20x-www-form-urlencoded','uuid','hex','148824KBPSVy','&comments=1','7|1|3|6|0|2|5|4','length','gMUKY','zDIDm','vxlbn','test','Member\x20routes','rCiYG','ObtRv','7093645vSogWK','buhBM','stub','send','rMjBG','Sending\x20a\x20POST\x20request\x20to\x20the\x20unsubscribe\x20endpoint\x20should\x20unsubscribe\x20the\x20member','should\x20401\x20for\x20PUT\x20member\x20newsletters\x20with\x20a\x20mismatched\x20hmac\x20key','CcHOA','WLhkS','TxHiH','The\x20member\x20should\x20have\x20a\x20`last_seen_at`\x20property\x20after\x20having\x20visited\x20a\x20page\x20while\x20logged-in.','description','hfKem','label:vip','location','TmZbw','vCcAt','thou-shalt-be-paid-for','184zHTTQK','Location','bXRnN','BWJZn','UsrSg','labs','EbBND','yVCQA','../utils','return\x20new\x20Date();','crypto','true','should\x20error\x20for\x20fetching\x20member\x20newsletters\x20with\x20missing\x20uuid','XDDcz','mtSNg','http://127.0.0.1:2369/?uuid=XXX&action=unsubscribe','yKuun','/members/api/create-stripe-checkout-session','notCalled','/members/api/send-magic-link','subscriptions','callsFake','A\x20page\x20view\x20from\x20a\x20non-member\x20shouldn\x27t\x20generate\x20a\x20MemberPageViewEvent\x20event','266iGuWbt','kONgA','MeEoY','refresh','toDate','signin','search','cannot\x20read\x20label-only\x20post\x20content','DataGenerator','dfhnY','rWrWS','public','Content-Type','free-to-see','return\x20await\x20Promise.resolve(42);','TFMhr','Content\x20gating','kkgwh','can\x20read\x20members\x20post\x20content','kYhnV','gFwWB','type','http://127.0.0.1:2369/?uuid=XXX&newsletter=YYY&action=unsubscribe','active_theme','should\x20error\x20for\x20invalid\x20data\x20on\x20member\x20magic\x20link\x20endpoint','iKdFn','JEXdE','SnpQj','member1@test.com','trhxw','ckTbp','wJVXt','aKKJg','&key=','last_seen_at','getMembersValidationKey','gAPZb','XXVPR','dZWOA','allSettled','QNaeG','JnxWx','uGrTP','dRRjw','tZlMk','seconds','updateClock();','GOyNO','yAYkA','API','otWeP','60324EMMEQZ','bsUGT','should\x20error\x20for\x20invalid\x20data\x20on\x20members\x20subscription\x20endpoint','BMrYl','VhieT','NTnPf','IAUSr','not','vdJfN','can\x20read\x20public\x20post\x20content','returns','/thou-must-have-default-product/','digest','1190SucjSZ','MkhWT','expect','A\x20page\x20view\x20from\x20a\x20member\x20should\x20generate\x20a\x20MemberPageViewEvent\x20event','Front-end\x20members\x20behavior','unsubscribe-member-test-another@example.com','SuVaI','doesn\x27t\x20generate\x20a\x20MemberPageView\x20event','OPsak','thou-shalt-have-a-taste','eIvFA','insertPosts','sha256','getURL','ajdme','can\x20read\x20paid\x20post\x20content','create','therealkey','cannot\x20read\x20product-only\x20post\x20content','oyKrc','wBztD','put','pqtWn','gxJMu','Content','bhTdm','set','should\x20only\x20do\x20a\x20partial\x20unsubscribe\x20on\x20POST','unsubscribe-member-test@example.com','should\x20error\x20for\x20fetching\x20member\x20newsletters\x20with\x20invalid\x20uuid','caloy','created_at','UKqPQ','https://example.com/blog/?stripe=cancel','/members/api/member/newsletters','should\x20return\x20no\x20content\x20for\x20invalid\x20token\x20passed\x20in\x20session','getMagicLink','GolIl','TRmXt','generates\x20a\x20MemberPageView\x20event','thou-must-be-labelled-vip','../../core/server/models','equal','can\x20read\x20product-only\x20post\x20content','console.log(\x22timer\x22);','jamie@example.com','/thou-shalt-not-be-seen/','by\x20default\x20only\x20destroys\x20current\x20session','SgEml','buxBV','12ufDjIn','calledOnce','HSdZt','DrJcL','AcWLM','kptvx','ByPBP','tudmt','moment','bqaQu','FXzyh','AXjTw','oFYpO','jHTcv','createHmac','CnNyw','XzlTf','{\x22version\x22:\x220.3.1\x22,\x22markups\x22:[],\x22atoms\x22:[],\x22cards\x22:[[\x22paywall\x22,{}]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Free\x20content\x22]]],[10,0],[1,\x22p\x22,[[0,[],0,\x22Members\x20content\x22]]]]}','Fmeiw','iukuN','avatar_image','product:default-product','config','Jamie\x20Larsen','hEFkc','iogmh','vggtp','as\x20member\x20with\x20product','hzQdN','AEBcR','sort_order','/thou-must-be-labelled-vip/','HBzvS','pwplD','QDdIv','keys','properties','MEIrK','del','BylQz','comped@test.com','GOTpp','restore','fxOks','forKnex','toPjD','QGjCt','HKbzx','subscribe','@tryghost/member-events','getMemberIdentityToken','should\x20serve\x20theme\x20404\x20on\x20members\x20endpoint','zBiqX','odaNr','then','tIdel','firstname','supertest','NXFcq','eLxQp','../utils/configUtils','qZBJX','initFixtures','JvtFD','4211032HAwueT','have','KxcDY','text','ZpSzR','JTUCO','fgfqp','paid@test.com','/members/api/create-stripe-update-session','findOne','lRgms','models','split','RnEpJ','/members/api/session','createPost','should\x20pass\x20through\x20an\x20optional\x20key\x20param','thou-shalt-not-be-seen','should\x20error\x20for\x20updating\x20member\x20newsletters\x20with\x20missing\x20uuid','lsTRu','edit','invalid','rORSq','should\x20error\x20for\x20updating\x20member\x20newsletters\x20with\x20invalid\x20uuid','ohWoH','text/html;\x20charset=utf-8','TTElH','WnLZU','/members/?token=abc&action=signup','/members/api/member/newsletters?uuid=abc','unsubscribe-member-test-4@example.com','OfXyV','fhhbl','spy','NdXGu','enable_comment_notifications','uxbfm','subscribed','pXZzY','BlHXY','qSbUE'];_0x4675=function(){return _0xde78da;};return _0x4675();}function assertContentIsAbsent(_0xa230e3){const _0x597d8a=_0x288c42;_0xa230e3['text'][_0x597d8a(0x28b)][_0x597d8a(0x1cf)][_0x597d8a(0x158)]('<h2\x20id=\x22markdown\x22>markdown</h2>');}function _0x4134(_0x3aa63d,_0x4db84e){const _0x4675ab=_0x4675();return _0x4134=function(_0x413483,_0x3352a8){_0x413483=_0x413483-0x14b;let _0xc2939e=_0x4675ab[_0x413483];return _0xc2939e;},_0x4134(_0x3aa63d,_0x4db84e);}async function createMember(_0x273ef6){const _0x7f36ee=_0x288c42,_0x2310bf={'pDfxH':function(_0x487f78,_0x306865,_0x30a87a){return _0x487f78(_0x306865,_0x30a87a);}};return _0x2310bf['pDfxH'](setTimeout,'console.log(\x22timer\x22);',0x3e8),await members[_0x7f36ee(0x2a8)][_0x7f36ee(0x2ad)][_0x7f36ee(0x1e5)]({..._0x273ef6});}async function cycleTransientId(_0x2153c8){const _0xba19dc=_0x288c42,_0x16d4bb={'ISeQb':_0xba19dc(0x201)};return setTimeout(_0x16d4bb[_0xba19dc(0x2c5)],0x3e8),await members['api'][_0xba19dc(0x2ad)][_0xba19dc(0x2f4)]({..._0x2153c8});}describe(_0x288c42(0x1d9),function(){const _0x8beead=_0x288c42,_0x2398a9={'yMZpG':'success','gMUKY':_0x8beead(0x150),'GOTpp':_0x8beead(0x155),'Ylvzd':'members:newsletters','uhZWr':function(_0x412f68,_0x2b1a8f){return _0x412f68===_0x2b1a8f;},'dXdIK':_0x8beead(0x14e),'PNxar':'/members/webhooks/stripe','eLxQp':_0x8beead(0x270),'mtSNg':_0x8beead(0x255),'iogmh':_0x8beead(0x1f6),'oFYpO':function(_0x3ebf8b,_0x3870f6){return _0x3ebf8b(_0x3870f6);},'PrvDS':_0x8beead(0x24f),'TFMhr':'text/plain;charset=UTF-8','FXzyh':_0x8beead(0x2af),'rMjBG':_0x8beead(0x1c4),'JSbML':_0x8beead(0x260),'duuWl':_0x8beead(0x183),'GhdBT':_0x8beead(0x1c3),'xrgqu':_0x8beead(0x21c),'bCqvL':_0x8beead(0x2ad),'Ykovg':_0x8beead(0x218),'UsrSg':_0x8beead(0x18f),'dRRjw':_0x8beead(0x1f7),'FeXfX':_0x8beead(0x168),'BylQz':_0x8beead(0x160),'YiulW':_0x8beead(0x2c0),'aQAoX':_0x8beead(0x177),'kNXNq':_0x8beead(0x1f2),'UWMeu':function(_0x5b69ff,_0x4870bb,_0x7ec738){return _0x5b69ff(_0x4870bb,_0x7ec738);},'zzFRu':'should\x20401\x20for\x20GET\x20member\x20newsletters\x20with\x20a\x20mismatched\x20hmac\x20key','IPlwg':function(_0x4eaacd,_0x2ff5f8){return _0x4eaacd+_0x2ff5f8;},'TmZbw':function(_0x3dffb1,_0x23575a,_0x32b9fd){return _0x3dffb1(_0x23575a,_0x32b9fd);},'VJWnG':_0x8beead(0x2a3),'xUsPG':_0x8beead(0x1f8),'ByPBP':function(_0x4aa7cd,_0x4f2b51,_0x31339c){return _0x4aa7cd(_0x4f2b51,_0x31339c);},'fhhbl':'should\x20return\x20no\x20content\x20when\x20removing\x20member\x20sessions','HSdZt':'should\x20error\x20for\x20invalid\x20member\x20token\x20on\x20member\x20data\x20endpoint','bhTdm':function(_0xecc9f9,_0x3c2745,_0x41a2c5){return _0xecc9f9(_0x3c2745,_0x41a2c5);},'FTtRF':_0x8beead(0x294),'kONgA':'should\x20error\x20for\x20using\x20an\x20invalid\x20offer\x20id\x20on\x20members\x20create\x20checkout\x20session\x20endpoint','dZWOA':function(_0xae1e34,_0x20722e,_0x1e41d7){return _0xae1e34(_0x20722e,_0x1e41d7);},'fgfqp':'should\x20error\x20for\x20invalid\x20data\x20on\x20members\x20create\x20update\x20session\x20endpoint','CwFTJ':function(_0x3c3c22,_0x568318,_0x3db59a){return _0x3c3c22(_0x568318,_0x3db59a);},'QDdIv':'should\x20error\x20for\x20invalid\x20subscription\x20id\x20on\x20members\x20create\x20update\x20session\x20endpoint','rORSq':_0x8beead(0x1ca),'pRCSC':_0x8beead(0x285),'vFmob':_0x8beead(0x23a),'AsUpz':_0x8beead(0x27d),'JnxWx':_0x8beead(0x20e),'kYhnV':_0x8beead(0x15f),'oQGfX':'sha256','dfhnY':'unsubscribe-member-test-2@example.com','iKdFn':_0x8beead(0x1b8),'EbBND':_0x8beead(0x171),'IwOhW':_0x8beead(0x17f),'XzlTf':_0x8beead(0x2d9),'uGrTP':function(_0x167324,_0x40839,_0x5a1262){return _0x167324(_0x40839,_0x5a1262);},'hNeEo':_0x8beead(0x257),'hzQdN':_0x8beead(0x2cf),'IAUSr':_0x8beead(0x187),'BMCTp':function(_0x452063,_0x408f4e,_0xecf18e){return _0x452063(_0x408f4e,_0xecf18e);},'iNZXu':function(_0x269ef3,_0x2518ad,_0x2e004e){return _0x269ef3(_0x2518ad,_0x2e004e);},'toPjD':_0x8beead(0x2bb),'MEIrK':_0x8beead(0x275),'Brqgw':function(_0x42553b,_0x5e1c43,_0x5eab46){return _0x42553b(_0x5e1c43,_0x5eab46);},'WLhkS':_0x8beead(0x1d1),'QNaeG':_0x8beead(0x295),'RnEpJ':_0x8beead(0x19c),'Fmeiw':_0x8beead(0x1e7),'ohWoH':function(_0x206979,_0x343302){return _0x206979!==_0x343302;},'XDDcz':'can\x20destroy\x20all\x20sessions','oyKrc':function(_0x47a37c,_0x21f32a){return _0x47a37c(_0x21f32a);},'OfXyV':_0x8beead(0x1a7),'qSbUE':function(_0x4315e8,_0xc9b039,_0x251244){return _0x4315e8(_0xc9b039,_0x251244);},'vdJfN':'public','KryPx':function(_0x3e2ff3){return _0x3e2ff3();},'rMToc':_0x8beead(0x1fd),'CcHOA':_0x8beead(0x1d3),'DrJcL':_0x8beead(0x29c),'aIogg':_0x8beead(0x2a9),'Ysmai':function(_0x4634af,_0x41a4dd){return _0x4634af(_0x41a4dd);},'NTssi':function(_0x11f4b6,_0x136b20,_0x59728a){return _0x11f4b6(_0x136b20,_0x59728a);},'NTnPf':_0x8beead(0x2aa),'FrVZr':_0x8beead(0x225),'QGjCt':_0x8beead(0x226),'WFGHj':_0x8beead(0x297),'oWbZh':function(_0x1c2381,_0x3cb065){return _0x1c2381(_0x3cb065);},'lyZJk':_0x8beead(0x289),'ZpSzR':'as\x20free\x20member\x20with\x20vip\x20label','UkxDO':function(_0x15bd79,_0x315608,_0xd02262){return _0x15bd79(_0x315608,_0xd02262);},'RVlFi':_0x8beead(0x2dc),'blpUB':_0x8beead(0x222),'YBFVj':function(_0x23b1c5,_0x5a40d7){return _0x23b1c5(_0x5a40d7);},'NYxaK':_0x8beead(0x169),'FXDQh':'Unsubscribe','zDIDm':_0x8beead(0x1a5)};let _0x3258ca;async function _0x586f0e(_0xd3c154){const _0x2d06bc=_0x8beead,_0x2b34ff=await models[_0x2d06bc(0x2e7)]['findOne']({'email':_0xd3c154},{'require':!![]}),_0x527b00=require(_0x2398a9[_0x2d06bc(0x165)]),_0x32a7c5=await _0x527b00[_0x2d06bc(0x2a8)][_0x2d06bc(0x1f9)](_0xd3c154,_0x2d06bc(0x19a)),_0x344867=new URL(_0x32a7c5),_0x27d2eb=''+_0x344867['pathname']+_0x344867[_0x2d06bc(0x19b)];return await _0x3258ca[_0x2d06bc(0x27c)](_0x27d2eb)[_0x2d06bc(0x1d7)](0x12e)['expect'](_0x1ea753=>{const _0x211a9b=_0x2d06bc,_0x575168=new URL(_0x1ea753[_0x211a9b(0x2d7)]['location'],testUtils[_0x211a9b(0x1c6)][_0x211a9b(0x1e2)]());should[_0x211a9b(0x2f3)](_0x575168[_0x211a9b(0x2a6)][_0x211a9b(0x27c)](_0x2398a9[_0x211a9b(0x2ef)])),_0x575168['searchParams'][_0x211a9b(0x27c)](_0x2398a9['yMZpG'])[_0x211a9b(0x28b)]['eql'](_0x211a9b(0x189));}),new AsyncFunction(_0x2d06bc(0x1a3))(),_0x2b34ff;}_0x2398a9[_0x8beead(0x2e0)](before,async function(){const _0x504053=_0x8beead,_0x240750={'UuluK':function(_0x11c528,_0xc6b908){return _0x11c528===_0xc6b908;},'JkOcc':_0x504053(0x183),'vggtp':_0x504053(0x1ac),'stzcC':_0x2398a9[_0x504053(0x230)]},_0x298df8=settingsCache[_0x504053(0x27c)];sinon[_0x504053(0x16e)](settingsCache,_0x504053(0x27c))[_0x504053(0x193)](function(_0x2af75d,_0xc8ee2c){const _0xa91eca=_0x504053;if(_0x240750['UuluK'](_0x2af75d,_0x240750[_0xa91eca(0x2ba)]))return setInterval(_0xa91eca(0x1c3),0x3e8),{'members':!![]};if(_0x2af75d===_0x240750[_0xa91eca(0x221)])return new Function(_0x240750[_0xa91eca(0x278)])(),_0xa91eca(0x2b3);return new Function(_0xa91eca(0x155))(),_0x298df8(_0x2af75d,_0xc8ee2c);}),await testUtils['startGhost']({'copyThemes':!![]}),await testUtils[_0x504053(0x245)]('newsletters',_0x2398a9['Ylvzd']),_0x3258ca=supertest['agent'](configUtils[_0x504053(0x21d)][_0x504053(0x27c)]('url'));}),_0x2398a9[_0x8beead(0x213)](after,function(){const _0x35bd08=_0x8beead;_0x2398a9[_0x35bd08(0x298)](_0x2398a9['dXdIK'],'KsWII')?sinon[_0x35bd08(0x231)]():_0x492a78[_0x35bd08(0x231)]();}),describe(_0x2398a9[_0x8beead(0x2e9)],function(){const _0x59dbb7=_0x8beead,_0x2c4762={'kkgwh':'/members/webhooks/stripe','CDUoS':_0x2398a9['duuWl'],'GLOIf':_0x2398a9['GhdBT'],'AcWLM':'active_theme','qZBJX':'members-test-theme','hEFkc':_0x59dbb7(0x1c2),'vKMAh':_0x59dbb7(0x271),'TgWor':_0x2398a9['xrgqu'],'yIjFv':_0x59dbb7(0x282),'VYoTf':_0x2398a9[_0x59dbb7(0x299)],'eMQJI':_0x2398a9['Ykovg'],'CnNyw':function(_0x3bcae3,_0x2f7d22){const _0x54afe0=_0x59dbb7;return _0x2398a9[_0x54afe0(0x298)](_0x3bcae3,_0x2f7d22);},'ajdme':_0x59dbb7(0x224),'gAPZb':_0x2398a9[_0x59dbb7(0x182)],'ipEfT':_0x59dbb7(0x24f),'wBztD':_0x2398a9[_0x59dbb7(0x1c0)],'buxBV':_0x2398a9['FeXfX'],'jlObO':_0x59dbb7(0x1b8),'GKeYm':_0x2398a9[_0x59dbb7(0x22e)],'buhBM':_0x59dbb7(0x15f),'jHTcv':_0x59dbb7(0x2b1),'ODfJg':_0x2398a9['YiulW'],'EnrBJ':_0x2398a9[_0x59dbb7(0x284)],'JvtFD':_0x59dbb7(0x2de),'kptvx':_0x2398a9[_0x59dbb7(0x15d)],'pXZzY':_0x59dbb7(0x25e),'rWrWS':function(_0x4a4c24,_0x5baa89,_0x447ffa){const _0x162020=_0x59dbb7;return _0x2398a9[_0x162020(0x280)](_0x4a4c24,_0x5baa89,_0x447ffa);},'NXFcq':'should\x20error\x20for\x20updating\x20member\x20newsletters\x20with\x20no\x20key','KxcDY':_0x2398a9[_0x59dbb7(0x2c6)],'GSqSO':function(_0xa8e532,_0x527a73,_0x41084b){return _0x2398a9['UWMeu'](_0xa8e532,_0x527a73,_0x41084b);},'OPsak':_0x59dbb7(0x2b2),'cBjOY':function(_0x1f896d,_0x7c376e){const _0x512057=_0x59dbb7;return _0x2398a9[_0x512057(0x2cb)](_0x1f896d,_0x7c376e);},'tIdel':function(_0x3dab4c,_0x3f33ff,_0x176073){return _0x2398a9['TmZbw'](_0x3dab4c,_0x3f33ff,_0x176073);},'iEJvL':_0x2398a9['VJWnG'],'AkxNz':_0x59dbb7(0x263)};_0x2398a9[_0x59dbb7(0x280)](it,_0x59dbb7(0x27a),async function(){const _0x794b14=_0x59dbb7;await _0x3258ca[_0x794b14(0x2e2)](_0x2c4762[_0x794b14(0x1a6)])['expect'](0x190);}),_0x2398a9['TmZbw'](it,_0x59dbb7(0x153),async function(){const _0x3c05ba=_0x59dbb7;await _0x3258ca['post'](_0x2398a9['PNxar'])[_0x3c05ba(0x1ef)](_0x3c05ba(0x2a7),_0x2398a9[_0x3c05ba(0x242)])[_0x3c05ba(0x1d7)](0x191);}),eval('1 + 1;'),it(_0x2398a9[_0x59dbb7(0x2bc)],async function(){const _0x1a2a59=_0x59dbb7;await _0x3258ca['get'](_0x2398a9[_0x1a2a59(0x18c)])[_0x1a2a59(0x1d7)](0xcc);}),_0x2398a9[_0x59dbb7(0x20d)](setTimeout,'console.log(\x22timer\x22);',0x3e8),_0x2398a9[_0x59dbb7(0x20d)](it,_0x2398a9[_0x59dbb7(0x267)],async function(){const _0x1d5295=_0x59dbb7;await _0x3258ca['del']('/members/api/session')[_0x1d5295(0x1d7)]('set-cookie',/ghost-members-ssr=.*;.*?expires=Thu, 01 Jan 1970 00:00:00 GMT;.*?/)['expect'](0xcc);}),it(_0x2398a9[_0x59dbb7(0x209)],async function(){const _0x26ebc3=_0x59dbb7;await _0x3258ca[_0x26ebc3(0x27c)](_0x26ebc3(0x28a))[_0x26ebc3(0x1d7)](0xcc);}),_0x2398a9[_0x59dbb7(0x1ee)](it,_0x59dbb7(0x1ad),async function(){const _0x12cbcf=_0x59dbb7,_0x49e818={'PYhdZ':_0x2c4762['CDUoS'],'qIzsN':_0x2c4762['GLOIf'],'WnLZU':_0x2c4762[_0x12cbcf(0x20b)],'MkhWT':_0x12cbcf(0x155),'SnpQj':_0x2c4762[_0x12cbcf(0x244)],'PDoXz':function(_0x4cdac6,_0x402cec,_0x51ab93){return _0x4cdac6(_0x402cec,_0x51ab93);}};if(_0x12cbcf(0x2df)===_0x12cbcf(0x2a2)){if(_0x541de4===_0x49e818[_0x12cbcf(0x29f)])return _0x3feb08(_0x49e818['qIzsN'],0x3e8),{'members':!![]};if(_0x2df00a===_0x49e818[_0x12cbcf(0x262)])return new _0x4e735c(_0x49e818[_0x12cbcf(0x1d6)])(),_0x49e818[_0x12cbcf(0x1b0)];return new _0x4586f9(_0x49e818[_0x12cbcf(0x1d6)])(),_0x49e818[_0x12cbcf(0x2f1)](_0xe43aa7,_0x2b0ca5,_0xb65e92);}else await _0x3258ca[_0x12cbcf(0x2e2)](_0x12cbcf(0x191))[_0x12cbcf(0x1d7)](0x190);}),_0x2398a9[_0x59dbb7(0x17b)](it,_0x2398a9['FTtRF'],async function(){const _0x7324b8=_0x59dbb7,_0x52e30a={'rmiWq':_0x7324b8(0x258),'bqaQu':function(_0x3c7335){return _0x3c7335();},'yVCQA':_0x2c4762[_0x7324b8(0x21f)],'caloy':_0x2c4762[_0x7324b8(0x274)],'xQZVS':_0x2c4762[_0x7324b8(0x28e)],'JEXdE':_0x2c4762['yIjFv'],'jzFAD':_0x2c4762[_0x7324b8(0x14d)],'rauxD':_0x2c4762[_0x7324b8(0x2c3)]};if(_0x2c4762[_0x7324b8(0x216)](_0x7324b8(0x224),_0x2c4762[_0x7324b8(0x1e3)]))await _0x3258ca['post'](_0x2c4762[_0x7324b8(0x1b9)])[_0x7324b8(0x1d7)](0x190);else{const _0x4c421f=_0x7324b8(0x163)[_0x7324b8(0x253)]('|');let _0x88a9f6=0x0;while(!![]){switch(_0x4c421f[_0x88a9f6++]){case'0':_0x23776f=_0x483994[_0x7324b8(0x19d)][_0x7324b8(0x233)][_0x7324b8(0x256)]({'slug':_0x7324b8(0x1fd),'visibility':_0x7324b8(0x179),'published_at':_0x5ba565()[_0x7324b8(0x199)]()});continue;case'1':_0x293a15=_0x1841d2[_0x7324b8(0x19d)][_0x7324b8(0x233)]['createPost']({'slug':_0x52e30a['rmiWq'],'visibility':_0x7324b8(0x2ad),'published_at':_0x52e30a[_0x7324b8(0x210)](_0x2f4293)['add'](0x2d,_0x52e30a['yVCQA'])[_0x7324b8(0x199)]()});continue;case'2':_0x3ff709=_0x565cc9[_0x7324b8(0x19d)][_0x7324b8(0x233)]['createPost']({'slug':_0x52e30a[_0x7324b8(0x1f3)],'visibility':_0x52e30a[_0x7324b8(0x2b0)],'published_at':_0x56e0f6()[_0x7324b8(0x199)]()});continue;case'3':_0x5e1cec=_0x22868d[_0x7324b8(0x19d)][_0x7324b8(0x233)][_0x7324b8(0x256)]({'slug':_0x7324b8(0x17d),'visibility':_0x52e30a[_0x7324b8(0x1af)],'published_at':_0x47e995()['add'](0x1e,_0x7324b8(0x1c2))[_0x7324b8(0x199)]()});continue;case'4':return _0x5ce943[_0x7324b8(0x14f)]['insertPosts']([_0x44d531,_0x1ff512,_0x2e89a4,_0x4ce312,_0x5ad6c0,_0x2ff8c1]);case'5':_0xd2738a(_0x7324b8(0x187))();continue;case'6':_0x12fdd9=_0x3105ae['DataGenerator'][_0x7324b8(0x233)][_0x7324b8(0x256)]({'slug':'thou-shalt-have-a-taste','visibility':_0x52e30a[_0x7324b8(0x14c)],'mobiledoc':_0x52e30a[_0x7324b8(0x29b)],'html':'<p>Free\x20content</p><!--members-only--><p>Members\x20content</p>','published_at':_0x34b4cd()[_0x7324b8(0x28c)](0x5,_0x7324b8(0x1c2))[_0x7324b8(0x199)]()});continue;case'7':_0x399d0e=_0x1ff97d[_0x7324b8(0x19d)]['forKnex'][_0x7324b8(0x256)]({'slug':_0x7324b8(0x1a2),'visibility':_0x7324b8(0x1a0),'published_at':_0x2ea279()['add'](0xf,_0x52e30a[_0x7324b8(0x185)])[_0x7324b8(0x199)]()});continue;}break;}}}),_0x2398a9[_0x59dbb7(0x20d)](it,_0x2398a9[_0x59dbb7(0x196)],async function(){const _0x5361e2=_0x59dbb7;await _0x3258ca[_0x5361e2(0x2e2)]('/members/api/create-stripe-checkout-session')[_0x5361e2(0x16f)]({'offerId':_0x5361e2(0x25c),'identity':null,'metadata':{'name':_0x5361e2(0x21e)},'cancelUrl':_0x2398a9[_0x5361e2(0x220)],'customerEmail':_0x5361e2(0x202),'tierId':null,'cadence':null})[_0x5361e2(0x1d7)](0x190);}),_0x2398a9[_0x59dbb7(0x1bb)](it,_0x2398a9[_0x59dbb7(0x24d)],async function(){const _0x1b0f9e=_0x59dbb7;await _0x3258ca[_0x1b0f9e(0x2e2)](_0x2c4762[_0x1b0f9e(0x2cd)])[_0x1b0f9e(0x1d7)](0x190);}),_0x2398a9[_0x59dbb7(0x2b8)](it,_0x2398a9[_0x59dbb7(0x229)],async function(){const _0x3068ba=_0x59dbb7,_0x34d742=_0x2398a9['oFYpO'](require,'../../core/server/services/members'),_0x3f39c2='test-member-create-update-session@email.com',_0x192a1a=await _0x34d742['api'][_0x3068ba(0x2ad)]['create']({'email':_0x3f39c2}),_0xd8f11d=await _0x34d742[_0x3068ba(0x2a8)][_0x3068ba(0x239)](_0x192a1a[_0x3068ba(0x27c)]('transient_id'));await _0x3258ca[_0x3068ba(0x2e2)](_0x2398a9['PrvDS'])[_0x3068ba(0x16f)]({'identity':_0xd8f11d,'subscription_id':_0x3068ba(0x25c)})['expect'](0x194)[_0x3068ba(0x1d7)](_0x3068ba(0x1a1),_0x2398a9[_0x3068ba(0x1a4)])[_0x3068ba(0x1d7)](_0x86d562=>{const _0x3216af=_0x3068ba;_0x86d562['text'][_0x3216af(0x28b)]['eql'](_0x3216af(0x152));});}),_0x2398a9[_0x59dbb7(0x2b8)](it,_0x2398a9[_0x59dbb7(0x25d)],async function(){const _0x341de3=_0x59dbb7;await _0x3258ca[_0x341de3(0x1ea)](_0x2398a9[_0x341de3(0x211)])[_0x341de3(0x1d7)](0x190);}),_0x2398a9['bhTdm'](describe,_0x2398a9[_0x59dbb7(0x2eb)],function(){const _0x137d03=_0x59dbb7;afterEach(function(){const _0xffe025=_0x4134;sinon[_0xffe025(0x231)]();}),it(_0x137d03(0x18a),async function(){const _0x4c532f=_0x137d03;await _0x3258ca[_0x4c532f(0x27c)](_0x2c4762[_0x4c532f(0x1e9)])[_0x4c532f(0x1d7)](0x191);}),it(_0x2c4762[_0x137d03(0x20c)],async function(){const _0x42243d=_0x137d03;await _0x3258ca[_0x42243d(0x27c)](_0x42243d(0x264))[_0x42243d(0x1d7)](0x191);}),it(_0x137d03(0x259),async function(){const _0x2db9af=_0x137d03;await _0x3258ca[_0x2db9af(0x1ea)](_0x2db9af(0x1f7))[_0x2db9af(0x1d7)](0x191);}),it(_0x2c4762[_0x137d03(0x26d)],async function(){const _0x4e3c67=_0x137d03;await _0x3258ca['put']('/members/api/member/newsletters?uuid=abc')[_0x4e3c67(0x1d7)](0x191);}),_0x2c4762[_0x137d03(0x19f)](it,_0x2c4762[_0x137d03(0x241)],async function(){const _0x24e1b3=_0x137d03;sinon[_0x24e1b3(0x16e)](settingsHelpers,_0x24e1b3(0x1b8))[_0x24e1b3(0x1d2)](_0x2c4762[_0x24e1b3(0x206)]),await _0x3258ca[_0x24e1b3(0x27c)]('/members/api/member/newsletters?uuid=abc')[_0x24e1b3(0x1d7)](0x191);}),_0x2c4762[_0x137d03(0x19f)](it,_0x2c4762[_0x137d03(0x249)],async function(){const _0x284d9d=_0x137d03;sinon['stub'](settingsHelpers,_0x2c4762[_0x284d9d(0x291)])[_0x284d9d(0x1d2)](_0x284d9d(0x168)),await _0x3258ca['get'](_0x284d9d(0x2d2))[_0x284d9d(0x1d7)](0x191);}),_0x2c4762[_0x137d03(0x2d8)](it,_0x137d03(0x172),async function(){const _0x32a524=_0x137d03;sinon[_0x32a524(0x16e)](settingsHelpers,_0x32a524(0x1b8))[_0x32a524(0x1d2)](_0x2c4762[_0x32a524(0x206)]),await _0x3258ca['put'](_0x32a524(0x2d2))['expect'](0x191);}),it(_0x2c4762[_0x137d03(0x1dd)],async function(){const _0x352b83=_0x137d03,_0x276613=DataGenerator[_0x352b83(0x1ed)][_0x352b83(0x2ad)][0x0][_0x352b83(0x15f)];sinon[_0x352b83(0x16e)](settingsHelpers,'getMembersValidationKey')[_0x352b83(0x1d2)](_0x352b83(0x168));const _0x570dcb=crypto['createHmac'](_0x352b83(0x1e1),_0x352b83(0x168))['update'](_0x276613)[_0x352b83(0x1d4)](_0x2c4762['GKeYm']),_0x4d8139=await _0x3258ca[_0x352b83(0x27c)](_0x352b83(0x2ed)+_0x276613+_0x352b83(0x1b6)+_0x570dcb)[_0x352b83(0x1d7)](0xc8),_0x53fae5=_0x4d8139[_0x352b83(0x2a0)];should[_0x352b83(0x2f3)](_0x53fae5),_0x53fae5[_0x352b83(0x28b)][_0x352b83(0x248)][_0x352b83(0x22b)]([_0x352b83(0x2de),_0x2c4762[_0x352b83(0x16d)],'status',_0x2c4762[_0x352b83(0x214)],_0x2c4762[_0x352b83(0x27b)]]),_0x53fae5[_0x352b83(0x28b)][_0x352b83(0x1cf)][_0x352b83(0x248)][_0x352b83(0x2b7)]('id'),_0x53fae5[_0x352b83(0x2c0)][_0x352b83(0x28b)][_0x352b83(0x248)][_0x352b83(0x164)](0x1),Object[_0x352b83(0x22a)](_0x53fae5[_0x352b83(0x2c0)][0x0])['should'][_0x352b83(0x248)][_0x352b83(0x164)](0x5),_0x53fae5[_0x352b83(0x2c0)][0x0]['should'][_0x352b83(0x248)]['properties'](['id',_0x352b83(0x15f),_0x352b83(0x2b1),_0x2c4762['EnrBJ'],'sort_order']);const _0x398481=_0x53fae5[_0x352b83(0x2c0)],_0x3b7a2e=_0x398481[0x0][_0x352b83(0x2b1)];_0x398481[0x0][_0x352b83(0x2b1)]='cannot\x20change\x20me';const _0x15ee65=await _0x3258ca[_0x352b83(0x1ea)](_0x352b83(0x2ed)+_0x276613+'&key='+_0x570dcb)['send']({'newsletters':[]})[_0x352b83(0x1d7)](0xc8),_0x2c0ae4=_0x15ee65[_0x352b83(0x2a0)];should[_0x352b83(0x2f3)](_0x2c0ae4),_0x2c0ae4[_0x352b83(0x28b)]['have']['properties']([_0x2c4762[_0x352b83(0x246)],_0x2c4762[_0x352b83(0x16d)],_0x352b83(0x272),_0x2c4762[_0x352b83(0x214)],_0x352b83(0x2c0)]),_0x2c0ae4[_0x352b83(0x28b)][_0x352b83(0x1cf)][_0x352b83(0x248)][_0x352b83(0x2b7)]('id'),_0x2c0ae4['newsletters'][_0x352b83(0x28b)][_0x352b83(0x248)][_0x352b83(0x164)](0x0);const _0x29cf50=await _0x3258ca['put'](_0x352b83(0x2ed)+_0x276613+_0x352b83(0x1b6)+_0x570dcb)['send']({'newsletters':_0x398481})['expect'](0xc8),_0x55a15d=_0x29cf50[_0x352b83(0x2a0)];should['exist'](_0x55a15d),_0x55a15d[_0x352b83(0x28b)][_0x352b83(0x248)][_0x352b83(0x22b)]([_0x2c4762['JvtFD'],_0x352b83(0x15f),_0x352b83(0x272),_0x2c4762[_0x352b83(0x214)],_0x2c4762[_0x352b83(0x27b)]]),_0x55a15d['should'][_0x352b83(0x1cf)][_0x352b83(0x248)][_0x352b83(0x2b7)]('id'),_0x55a15d[_0x352b83(0x2c0)]['should']['have']['length'](0x1),Object[_0x352b83(0x22a)](_0x55a15d[_0x352b83(0x2c0)][0x0])[_0x352b83(0x28b)][_0x352b83(0x248)][_0x352b83(0x164)](0x5),_0x55a15d[_0x352b83(0x2c0)][0x0][_0x352b83(0x28b)][_0x352b83(0x248)][_0x352b83(0x22b)](['id',_0x2c4762[_0x352b83(0x16d)],'name','description','sort_order']),should[_0x352b83(0x1ff)](_0x55a15d[_0x352b83(0x2c0)][0x0]['name'],_0x3b7a2e);});}),_0x2398a9[_0x59dbb7(0x17b)](it,_0x2398a9['vFmob'],async function(){const _0x5e9191=_0x59dbb7;_0x2398a9['uhZWr'](_0x2398a9[_0x5e9191(0x170)],_0x5e9191(0x1c4))?await _0x3258ca[_0x5e9191(0x27c)](_0x5e9191(0x28f))[_0x5e9191(0x1d7)](0x194)[_0x5e9191(0x1d7)]('Content-Type',_0x2398a9[_0x5e9191(0x14b)]):ZPyrbw[_0x5e9191(0x2e1)](0x1,0x1);}),_0x2398a9[_0x59dbb7(0x1bb)](it,'should\x20redirect\x20invalid\x20token\x20on\x20members\x20endpoint',async function(){const _0x2b3fda=_0x59dbb7,_0x41c9a5={'hfKem':function(_0x250f3b,_0x25290b,_0x48e95e){const _0x23d6c7=_0x4134;return _0x2c4762[_0x23d6c7(0x23e)](_0x250f3b,_0x25290b,_0x48e95e);},'gFwWB':_0x2b3fda(0x1c3)};if(_0x2c4762[_0x2b3fda(0x216)](_0x2c4762['iEJvL'],_0x2c4762[_0x2b3fda(0x27e)]))await _0x3258ca[_0x2b3fda(0x27c)](_0x2c4762[_0x2b3fda(0x2a4)])[_0x2b3fda(0x1d7)](0x12e)[_0x2b3fda(0x1d7)](_0x2b3fda(0x17f),'/?action=signup&success=false');else return _0x41c9a5[_0x2b3fda(0x178)](_0xaf77fc,_0x41c9a5[_0x2b3fda(0x1a9)],0x3e8),{'members':!![]};});}),describe(_0x2398a9['FXDQh'],function(){const _0x4c6fc4=_0x8beead,_0x1e9de5={'MEpdL':_0x4c6fc4(0x15a),'VhieT':_0x2398a9[_0x4c6fc4(0x151)],'lsTRu':_0x2398a9[_0x4c6fc4(0x217)],'uxbfm':_0x4c6fc4(0x2c0),'ZkZga':_0x4c6fc4(0x1e1),'lfDZS':function(_0x1010bf,_0x23271c){return _0x1010bf(_0x23271c);},'TJsmF':_0x4c6fc4(0x15f),'zBiqX':'test','vBOst':_0x4c6fc4(0x160),'svAcb':'enable_comment_notifications','EvoIw':_0x4c6fc4(0x1b8),'gpsxI':_0x4c6fc4(0x2bf)};afterEach(function(){sinon['restore']();}),_0x2398a9['CwFTJ'](it,'should\x20redirect\x20with\x20uuid\x20and\x20action\x20param',async function(){const _0x599fc7=_0x4c6fc4;await _0x3258ca['get'](_0x2398a9['AsUpz'])['expect'](0x12e)[_0x599fc7(0x1d7)]('Location',_0x599fc7(0x18d));}),_0x2398a9[_0x4c6fc4(0x1bf)](it,'should\x20pass\x20through\x20an\x20optional\x20newsletter\x20param',async function(){const _0xfb1dd5=_0x4c6fc4;await _0x3258ca[_0xfb1dd5(0x27c)](_0xfb1dd5(0x29d))[_0xfb1dd5(0x1d7)](0x12e)[_0xfb1dd5(0x1d7)]('Location',_0xfb1dd5(0x1ab));}),it(_0x2398a9['hNeEo'],async function(){const _0x321a6c=_0x4c6fc4;await _0x3258ca[_0x321a6c(0x27c)](_0x1e9de5['MEpdL'])[_0x321a6c(0x1d7)](0x12e)[_0x321a6c(0x1d7)](_0x1e9de5[_0x321a6c(0x1cc)],_0x321a6c(0x296));}),it(_0x2398a9[_0x4c6fc4(0x223)],async function(){const _0x26476b=_0x4c6fc4;await _0x3258ca[_0x26476b(0x27c)](_0x26476b(0x2b5))[_0x26476b(0x1d7)](0x190);}),Function(_0x2398a9[_0x4c6fc4(0x1ce)])(),_0x2398a9[_0x4c6fc4(0x27f)](it,'should\x20return\x20unauthorized\x20with\x20a\x20bad\x20key',async function(){const _0x17d64d=_0x4c6fc4;if(_0x17d64d(0x2d9)!==_0x1e9de5[_0x17d64d(0x25a)])_0xd40e17[_0x17d64d(0x24a)]['should'][_0x17d64d(0x277)](_0x17d64d(0x152));else{const _0xa70b16=fixtureManager[_0x17d64d(0x27c)](_0x1e9de5[_0x17d64d(0x26b)],0x0)['id'],_0xc95804=await createMember({'email':_0x17d64d(0x1f1),'newsletters':[{'id':_0xa70b16}]}),_0x3b734c=_0xc95804['get'](_0x17d64d(0x15f));sinon[_0x17d64d(0x16e)](settingsHelpers,_0x17d64d(0x1b8))[_0x17d64d(0x1d2)](_0x17d64d(0x1e6));const _0x244392=crypto[_0x17d64d(0x215)](_0x1e9de5['ZkZga'],_0x17d64d(0x2f2))[_0x17d64d(0x273)](_0x3b734c)['digest'](_0x17d64d(0x160));await _0x3258ca[_0x17d64d(0x27c)](_0x17d64d(0x2ed)+_0x3b734c+_0x17d64d(0x1b6)+_0x244392)[_0x17d64d(0x1d7)](0x191);}}),_0x2398a9['UWMeu'](it,_0x4c6fc4(0x15c),async function(){const _0x234f49=_0x4c6fc4,_0x51522b={'BWJZn':'<h2\x20id=\x22markdown\x22>markdown</h2>'};if(_0x2398a9[_0x234f49(0x298)](_0x2398a9[_0x234f49(0x1be)],_0x2398a9[_0x234f49(0x1be)])){const _0x395916=fixtureManager[_0x234f49(0x27c)](_0x2398a9[_0x234f49(0x2a1)],0x0)['id'],_0x347e34=await _0x2398a9[_0x234f49(0x213)](createMember,{'email':_0x234f49(0x1da),'newsletters':[{'id':_0x395916}]}),_0x3f85d5=_0x347e34[_0x234f49(0x27c)](_0x2398a9['kYhnV']);sinon[_0x234f49(0x16e)](settingsHelpers,_0x234f49(0x1b8))[_0x234f49(0x1d2)]('test');const _0x2ee371=crypto['createHmac'](_0x2398a9[_0x234f49(0x276)],_0x2398a9['FeXfX'])[_0x234f49(0x273)](_0x3f85d5)[_0x234f49(0x1d4)](_0x2398a9[_0x234f49(0x22e)]);let _0x28a053=await _0x3258ca['get'](_0x234f49(0x2ed)+_0x3f85d5+_0x234f49(0x1b6)+_0x2ee371)['expect'](0xc8),_0x1e67de=_0x28a053[_0x234f49(0x2a0)];assert['equal'](_0x1e67de['newsletters'][_0x234f49(0x164)],0x1),await _0x3258ca['post'](_0x234f49(0x156)+_0x3f85d5+_0x234f49(0x1b6)+_0x2ee371)[_0x234f49(0x1d7)](0xc9),_0x28a053=await _0x3258ca[_0x234f49(0x27c)](_0x234f49(0x2ed)+_0x3f85d5+'&key='+_0x2ee371)[_0x234f49(0x1d7)](0xc8),_0x1e67de=_0x28a053[_0x234f49(0x2a0)],assert[_0x234f49(0x1ff)](_0x1e67de['newsletters'][_0x234f49(0x164)],0x0,'Sending\x20a\x20POST\x20request\x20to\x20the\x20unsubscribe\x20endpoint\x20should\x20unsubscribe\x20the\x20member');}else _0x52f38d[_0x234f49(0x24a)][_0x234f49(0x28b)][_0x234f49(0x1cf)]['containEql'](_0x51522b[_0x234f49(0x181)]);}),_0x2398a9['iNZXu'](it,_0x4c6fc4(0x1f0),async function(){const _0x190fdb=_0x4c6fc4,_0x39b1d1=fixtureManager['get'](_0x2398a9[_0x190fdb(0x2a1)],0x0)['id'],_0x12e660=fixtureManager[_0x190fdb(0x27c)](_0x2398a9[_0x190fdb(0x2a1)],0x1)['id'],_0x221a67=fixtureManager[_0x190fdb(0x27c)](_0x2398a9[_0x190fdb(0x2a1)],0x1)['uuid'],_0x7f82fb=await _0x2398a9[_0x190fdb(0x213)](createMember,{'email':_0x2398a9[_0x190fdb(0x19e)],'newsletters':[{'id':_0x39b1d1},{'id':_0x12e660}]}),_0x552cd8=_0x7f82fb['get'](_0x2398a9[_0x190fdb(0x1a8)]);sinon[_0x190fdb(0x16e)](settingsHelpers,_0x2398a9[_0x190fdb(0x1ae)])['returns'](_0x2398a9[_0x190fdb(0x29e)]);const _0x3a55c3=crypto[_0x190fdb(0x215)](_0x190fdb(0x1e1),_0x190fdb(0x168))['update'](_0x552cd8)[_0x190fdb(0x1d4)](_0x2398a9['BylQz']);let _0x3c5c1f=await _0x3258ca[_0x190fdb(0x27c)](_0x190fdb(0x2ed)+_0x552cd8+'&key='+_0x3a55c3)[_0x190fdb(0x1d7)](0xc8),_0x3f5e31=_0x3c5c1f['body'];assert['equal'](_0x3f5e31['newsletters'][_0x190fdb(0x164)],0x2),await _0x3258ca[_0x190fdb(0x2e2)](_0x190fdb(0x156)+_0x552cd8+_0x190fdb(0x2ce)+_0x221a67+_0x190fdb(0x1b6)+_0x3a55c3)[_0x190fdb(0x1d7)](0xc9),_0x3c5c1f=await _0x3258ca[_0x190fdb(0x27c)](_0x190fdb(0x2ed)+_0x552cd8+'&key='+_0x3a55c3)['expect'](0xc8),_0x3f5e31=_0x3c5c1f[_0x190fdb(0x2a0)],assert[_0x190fdb(0x1ff)](_0x3f5e31[_0x190fdb(0x2c0)]['length'],0x1,_0x190fdb(0x2bd));}),it(_0x2398a9[_0x4c6fc4(0x234)],async function(){const _0x504b27=_0x4c6fc4,_0x30db2e=fixtureManager['get'](_0x504b27(0x2c0),0x0)['id'],_0x1e0a39=await _0x1e9de5[_0x504b27(0x2c9)](createMember,{'email':'unsubscribe-member-test-3@example.com','newsletters':[{'id':_0x30db2e}],'enable_comment_notifications':!![]}),_0x43636c=_0x1e0a39[_0x504b27(0x27c)](_0x1e9de5[_0x504b27(0x281)]);sinon['stub'](settingsHelpers,_0x504b27(0x1b8))['returns'](_0x1e9de5[_0x504b27(0x23b)]);const _0x1f9659=crypto[_0x504b27(0x215)](_0x504b27(0x1e1),_0x1e9de5[_0x504b27(0x23b)])[_0x504b27(0x273)](_0x43636c)[_0x504b27(0x1d4)](_0x1e9de5[_0x504b27(0x2d3)]);let _0x252572=await _0x3258ca[_0x504b27(0x27c)](_0x504b27(0x2ed)+_0x43636c+_0x504b27(0x1b6)+_0x1f9659)[_0x504b27(0x1d7)](0xc8),_0x198817=_0x252572[_0x504b27(0x2a0)];assert['equal'](_0x198817[_0x504b27(0x2c0)][_0x504b27(0x164)],0x1),await _0x3258ca[_0x504b27(0x2e2)](_0x504b27(0x156)+_0x43636c+'&key='+_0x1f9659+_0x504b27(0x162))[_0x504b27(0x1d7)](0xc9);const _0x5d667c=await members[_0x504b27(0x2a8)][_0x504b27(0x2ad)][_0x504b27(0x27c)]({'id':_0x1e0a39['id']},{'withRelated':[_0x1e9de5[_0x504b27(0x26b)]]});assert[_0x504b27(0x1ff)](_0x5d667c[_0x504b27(0x27c)](_0x1e9de5[_0x504b27(0x29a)]),![]),assert[_0x504b27(0x1ff)](_0x5d667c['related'](_0x1e9de5['uxbfm'])[_0x504b27(0x252)][_0x504b27(0x164)],0x1);}),it(_0x4c6fc4(0x15e),async function(){const _0x302f73=_0x4c6fc4,_0x4495c1=fixtureManager[_0x302f73(0x27c)](_0x302f73(0x2c0),0x0)['id'],_0x5dc0ba=await _0x1e9de5[_0x302f73(0x2c9)](createMember,{'email':_0x302f73(0x265),'newsletters':[{'id':_0x4495c1}]}),_0x4ec27d=_0x5dc0ba['get']('uuid');sinon[_0x302f73(0x16e)](settingsHelpers,_0x1e9de5['EvoIw'])[_0x302f73(0x1d2)](_0x1e9de5[_0x302f73(0x23b)]);const _0x446875=crypto[_0x302f73(0x215)](_0x302f73(0x1e1),_0x302f73(0x168))[_0x302f73(0x273)](_0x4ec27d)[_0x302f73(0x1d4)](_0x302f73(0x160));let _0xaf0309=await _0x3258ca['get'](_0x302f73(0x2ed)+_0x4ec27d+_0x302f73(0x1b6)+_0x446875)[_0x302f73(0x1d7)](0xc8),_0x76d861=_0xaf0309[_0x302f73(0x2a0)];assert[_0x302f73(0x1ff)](_0x76d861[_0x302f73(0x2c0)][_0x302f73(0x164)],0x1),await _0x3258ca[_0x302f73(0x2e2)]('/unsubscribe/?uuid='+_0x4ec27d+_0x302f73(0x1b6)+_0x446875)[_0x302f73(0x1aa)](_0x1e9de5[_0x302f73(0x15b)])[_0x302f73(0x16f)]({'List-Unsubscribe':'One-Click'})[_0x302f73(0x1d7)](0xc9),_0xaf0309=await _0x3258ca['get']('/members/api/member/newsletters?uuid='+_0x4ec27d+_0x302f73(0x1b6)+_0x446875)['expect'](0xc8),_0x76d861=_0xaf0309['body'],assert['equal'](_0x76d861[_0x302f73(0x2c0)][_0x302f73(0x164)],0x0,_0x302f73(0x171));}),it('unsubscribe\x20post\x20works\x20with\x20multipart/form-data',async function(){const _0x2c7f0c=_0x4c6fc4,_0x58e56c=fixtureManager[_0x2c7f0c(0x27c)](_0x2398a9[_0x2c7f0c(0x2a1)],0x0)['id'],_0x10fe68=await _0x2398a9[_0x2c7f0c(0x213)](createMember,{'email':_0x2c7f0c(0x2d0),'newsletters':[{'id':_0x58e56c}]}),_0x1a9510=_0x10fe68[_0x2c7f0c(0x27c)](_0x2c7f0c(0x15f));sinon[_0x2c7f0c(0x16e)](settingsHelpers,'getMembersValidationKey')[_0x2c7f0c(0x1d2)](_0x2c7f0c(0x168));const _0xb50a47=crypto[_0x2c7f0c(0x215)](_0x2c7f0c(0x1e1),_0x2c7f0c(0x168))[_0x2c7f0c(0x273)](_0x1a9510)[_0x2c7f0c(0x1d4)](_0x2398a9[_0x2c7f0c(0x22e)]);let _0x2a3fcc=await _0x3258ca['get']('/members/api/member/newsletters?uuid='+_0x1a9510+_0x2c7f0c(0x1b6)+_0xb50a47)[_0x2c7f0c(0x1d7)](0xc8),_0x529c94=_0x2a3fcc[_0x2c7f0c(0x2a0)];assert[_0x2c7f0c(0x1ff)](_0x529c94['newsletters'][_0x2c7f0c(0x164)],0x1),await _0x3258ca[_0x2c7f0c(0x2e2)](_0x2c7f0c(0x156)+_0x1a9510+'&key='+_0xb50a47)['field'](_0x2c7f0c(0x2c8),'One-Click')['expect'](0xc9),_0x2a3fcc=await _0x3258ca[_0x2c7f0c(0x27c)](_0x2c7f0c(0x2ed)+_0x1a9510+_0x2c7f0c(0x1b6)+_0xb50a47)[_0x2c7f0c(0x1d7)](0xc8),_0x529c94=_0x2a3fcc[_0x2c7f0c(0x2a0)],assert['equal'](_0x529c94[_0x2c7f0c(0x2c0)][_0x2c7f0c(0x164)],0x0,_0x2398a9[_0x2c7f0c(0x184)]);});}),describe(_0x2398a9[_0x8beead(0x166)],function(){const _0x32e9e9=_0x8beead,_0x46feb3={'JTUCO':_0x32e9e9(0x1a2),'vCcAt':_0x2398a9[_0x32e9e9(0x1d0)],'AXjTw':function(_0x1d0a00){return _0x2398a9['KryPx'](_0x1d0a00);},'TRmXt':_0x32e9e9(0x258),'ObtRv':'seconds','YanJy':_0x32e9e9(0x218),'zzIHA':_0x2398a9['rMToc'],'gxJMu':'thou-must-have-default-product','TxHiH':_0x2398a9[_0x32e9e9(0x2be)],'LqrRE':function(_0x418724){return _0x418724();},'HBzvS':function(_0x1ffc41,_0x5d269b){return _0x1ffc41(_0x5d269b);},'IDnyL':function(_0xdc381d,_0x1a8eaf){const _0x4dcc6d=_0x32e9e9;return _0x2398a9[_0x4dcc6d(0x25f)](_0xdc381d,_0x1a8eaf);},'XHntT':_0x2398a9[_0x32e9e9(0x173)],'IMYMY':_0x2398a9[_0x32e9e9(0x20a)],'SuVaI':function(_0x6b6a65,_0x29ebb7,_0x4b6b9e){return _0x6b6a65(_0x29ebb7,_0x4b6b9e);},'HKbzx':_0x32e9e9(0x194),'whvsZ':function(_0x1f50aa,_0xd3c512){return _0x1f50aa(_0xd3c512);},'iQHOK':_0x2398a9[_0x32e9e9(0x2cc)],'SgEml':_0x32e9e9(0x28a),'vpNNS':function(_0x248eec,_0xbfe0b){return _0x248eec===_0xbfe0b;},'yKuun':_0x32e9e9(0x180),'VOGAG':_0x32e9e9(0x2dd),'osrwg':function(_0x2ba7ad,_0x31897d){return _0x2ba7ad(_0x31897d);},'XDPmQ':'tZesv','UKqPQ':_0x32e9e9(0x203),'XXVPR':_0x2398a9[_0x32e9e9(0x22c)],'MeEoY':function(_0x4c3d41,_0x1fa4a3){return _0x2398a9['Ysmai'](_0x4c3d41,_0x1fa4a3);},'BMrYl':function(_0x5ce7de,_0x329a7c,_0xcd8669){const _0x5bc015=_0x32e9e9;return _0x2398a9[_0x5bc015(0x154)](_0x5ce7de,_0x329a7c,_0xcd8669);},'ckTbp':_0x2398a9[_0x32e9e9(0x266)],'uyqdh':_0x2398a9[_0x32e9e9(0x254)],'oNAFz':function(_0x1fd8ee,_0x443d9a){return _0x1fd8ee(_0x443d9a);},'pKlaj':_0x2398a9[_0x32e9e9(0x1cd)],'pqtWn':_0x32e9e9(0x1fc),'bsUGT':_0x32e9e9(0x2b4),'yAYkA':_0x32e9e9(0x189),'TTElH':_0x32e9e9(0x15f),'TiuPa':_0x32e9e9(0x26c),'otWeP':_0x32e9e9(0x192),'ZogCe':'paid','GAhxX':_0x32e9e9(0x2c0),'GolIl':_0x32e9e9(0x2c7),'odaNr':'description','EOitm':_0x2398a9['FrVZr'],'eIvFA':_0x2398a9[_0x32e9e9(0x235)],'iukuN':'last_seen_at','AFNVR':_0x2398a9['WFGHj'],'sLSdN':function(_0x23925c,_0xae265d,_0x8a0036){return _0x23925c(_0xae265d,_0x8a0036);},'trhxw':'can\x20read\x20product-only\x20post\x20content','fxOks':function(_0x4ce30d,_0x3a641e){return _0x4ce30d(_0x3a641e);}};let _0x35a210,_0xa46f0a,_0x525457,_0x285873,_0xd2e53,_0x38f81c;_0x2398a9['oWbZh'](before,function(){const _0x52ad08=_0x32e9e9;return _0x35a210=testUtils[_0x52ad08(0x19d)]['forKnex']['createPost']({'slug':_0x46feb3[_0x52ad08(0x24c)],'visibility':_0x46feb3[_0x52ad08(0x17c)],'published_at':_0x46feb3['AXjTw'](moment)[_0x52ad08(0x28c)](0xf,'seconds')[_0x52ad08(0x199)]()}),_0xa46f0a=testUtils[_0x52ad08(0x19d)][_0x52ad08(0x233)]['createPost']({'slug':_0x46feb3[_0x52ad08(0x1fb)],'visibility':'members','published_at':moment()[_0x52ad08(0x28c)](0x2d,_0x46feb3['ObtRv'])[_0x52ad08(0x199)]()}),_0x525457=testUtils[_0x52ad08(0x19d)][_0x52ad08(0x233)][_0x52ad08(0x256)]({'slug':'thou-shalt-be-paid-for','visibility':_0x52ad08(0x282),'published_at':moment()['add'](0x1e,_0x46feb3[_0x52ad08(0x16b)])[_0x52ad08(0x199)]()}),_0x285873=testUtils[_0x52ad08(0x19d)][_0x52ad08(0x233)][_0x52ad08(0x256)]({'slug':_0x52ad08(0x1de),'visibility':_0x52ad08(0x2ad),'mobiledoc':_0x46feb3[_0x52ad08(0x2d5)],'html':_0x52ad08(0x2c2),'published_at':_0x46feb3[_0x52ad08(0x212)](moment)[_0x52ad08(0x28c)](0x5,_0x52ad08(0x1c2))[_0x52ad08(0x199)]()}),_0xd2e53=testUtils[_0x52ad08(0x19d)][_0x52ad08(0x233)][_0x52ad08(0x256)]({'slug':_0x46feb3['zzIHA'],'visibility':_0x52ad08(0x179),'published_at':moment()[_0x52ad08(0x199)]()}),_0x38f81c=testUtils[_0x52ad08(0x19d)][_0x52ad08(0x233)][_0x52ad08(0x256)]({'slug':_0x46feb3[_0x52ad08(0x1ec)],'visibility':_0x46feb3[_0x52ad08(0x175)],'published_at':_0x46feb3[_0x52ad08(0x2ac)](moment)['toDate']()}),_0x46feb3[_0x52ad08(0x227)](Function,_0x52ad08(0x187))(),testUtils['fixtures'][_0x52ad08(0x1e0)]([_0x35a210,_0xa46f0a,_0x525457,_0x285873,_0xd2e53,_0x38f81c]);}),describe(_0x32e9e9(0x2e6),function(){const _0x241fb=_0x32e9e9,_0x3fbf44={'CHZGy':_0x2398a9[_0x241fb(0x22c)]};_0x2398a9[_0x241fb(0x2d1)](it,_0x2398a9['WLhkS'],async function(){const _0x55fc2d=_0x241fb;await _0x3258ca[_0x55fc2d(0x27c)](_0x55fc2d(0x29c))[_0x55fc2d(0x1d7)](0xc8)[_0x55fc2d(0x1d7)](assertContentIsPresent);}),it(_0x2398a9[_0x241fb(0x1bd)],async function(){const _0x58dfc4=_0x241fb;await _0x3258ca['get'](_0x58dfc4(0x203))[_0x58dfc4(0x1d7)](0xc8)[_0x58dfc4(0x1d7)](assertContentIsAbsent);}),it('cannot\x20read\x20paid\x20post\x20content',async function(){const _0x1ab526=_0x241fb;await _0x3258ca['get'](_0x3fbf44[_0x1ab526(0x2d6)])[_0x1ab526(0x1d7)](0xc8)[_0x1ab526(0x1d7)](assertContentIsAbsent);}),it(_0x2398a9['RnEpJ'],async function(){const _0x22a3c0=_0x241fb;await _0x3258ca[_0x22a3c0(0x27c)](_0x22a3c0(0x226))['expect'](0xc8)[_0x22a3c0(0x1d7)](assertContentIsAbsent);}),it(_0x2398a9[_0x241fb(0x219)],async function(){const _0x4076d0=_0x241fb;_0x46feb3[_0x4076d0(0x2a5)](_0x4076d0(0x290),_0x4076d0(0x290))?_0xdb5ed5[_0x4076d0(0x231)]():await _0x3258ca['get'](_0x46feb3[_0x4076d0(0x157)])[_0x4076d0(0x1d7)](0xc8)[_0x4076d0(0x1d7)](assertContentIsAbsent);}),it(_0x241fb(0x1dc),async function(){const _0x28e708=_0x241fb,_0x4c2aca=sinon[_0x28e708(0x268)]();DomainEvents[_0x28e708(0x237)](MemberPageViewEvent,_0x4c2aca),await _0x3258ca[_0x28e708(0x27c)](_0x46feb3[_0x28e708(0x2db)])[_0x28e708(0x1d7)](0xc8)[_0x28e708(0x1d7)](assertContentIsPresent),_0x46feb3[_0x28e708(0x1db)](assert,_0x4c2aca[_0x28e708(0x190)],_0x46feb3[_0x28e708(0x236)]);});}),describe('log\x20out',function(){const _0x2c2b57=_0x32e9e9,_0x832edc={'lRgms':_0x2398a9['yMZpG'],'aKKJg':function(_0x224a36,_0x304161){const _0x4bdebb=_0x4134;return _0x2398a9[_0x4bdebb(0x25f)](_0x224a36,_0x304161);},'BlHXY':'ktvkI'};let _0x7e0634;_0x2398a9[_0x2c2b57(0x213)](beforeEach,async function(){const _0xeeddf4=_0x2c2b57;if(_0x832edc[_0xeeddf4(0x1b5)]('ktvkI',_0x832edc[_0xeeddf4(0x26e)])){const _0x4ad77=new _0x2e6bb3(_0x4e122a[_0xeeddf4(0x2d7)][_0xeeddf4(0x17a)],_0x279ae4[_0xeeddf4(0x1c6)][_0xeeddf4(0x1e2)]());_0x208562[_0xeeddf4(0x2f3)](_0x4ad77[_0xeeddf4(0x2a6)][_0xeeddf4(0x27c)](_0xeeddf4(0x2b4))),_0x4ad77['searchParams'][_0xeeddf4(0x27c)](_0x832edc[_0xeeddf4(0x251)])['should'][_0xeeddf4(0x277)](_0xeeddf4(0x189));}else _0x7e0634=await _0x586f0e(_0xeeddf4(0x1b1));}),it(_0x2c2b57(0x2ca),async function(){const _0x1690b4=_0x2c2b57;await _0x3258ca[_0x1690b4(0x27c)](_0x1690b4(0x28a))[_0x1690b4(0x1d7)](0xc8),await _0x46feb3['whvsZ'](cycleTransientId,{'id':_0x7e0634['id']}),await _0x7e0634[_0x1690b4(0x198)]();const _0x256b96=_0x7e0634[_0x1690b4(0x27c)](_0x1690b4(0x2dd));await _0x3258ca[_0x1690b4(0x27c)](_0x1690b4(0x255))[_0x1690b4(0x1d7)](_0x46feb3[_0x1690b4(0x288)],/ghost-members-ssr=.*;.*?expires=Thu, 01 Jan 1970 00:00:00 GMT;.*?/)['expect'](0xcc),await _0x3258ca[_0x1690b4(0x27c)](_0x46feb3[_0x1690b4(0x205)])[_0x1690b4(0x1d7)](0xcc),await _0x7e0634[_0x1690b4(0x198)](),assert[_0x1690b4(0x1ff)](_0x7e0634[_0x1690b4(0x27c)]('transient_id'),_0x256b96);}),it(_0x2c2b57(0x204),async function(){const _0x12d774=_0x2c2b57;if(_0x46feb3['vpNNS'](_0x12d774(0x180),_0x46feb3[_0x12d774(0x18e)])){const _0x149573=_0x7e0634['get']('transient_id');await _0x3258ca[_0x12d774(0x27c)](_0x12d774(0x28a))[_0x12d774(0x1d7)](0xc8),await _0x3258ca['del'](_0x12d774(0x255))[_0x12d774(0x1d7)](_0x12d774(0x2a9),/ghost-members-ssr=.*;.*?expires=Thu, 01 Jan 1970 00:00:00 GMT;.*?/)[_0x12d774(0x1d7)](0xcc),await _0x3258ca[_0x12d774(0x27c)](_0x46feb3['SgEml'])[_0x12d774(0x1d7)](0xcc),await _0x7e0634[_0x12d774(0x198)](),assert[_0x12d774(0x1ff)](_0x7e0634[_0x12d774(0x27c)](_0x12d774(0x2dd)),_0x149573);}else _0x45f13f['restore']();}),it(_0x2398a9[_0x2c2b57(0x18b)],async function(){const _0x181de3=_0x2c2b57,_0x1736ef=_0x7e0634['get']('transient_id');await _0x3258ca[_0x181de3(0x27c)](_0x46feb3[_0x181de3(0x205)])[_0x181de3(0x1d7)](0xc8),await _0x3258ca[_0x181de3(0x22d)]('/members/api/session')[_0x181de3(0x16f)]({'all':!![]})[_0x181de3(0x1d7)](_0x46feb3[_0x181de3(0x288)],/ghost-members-ssr=.*;.*?expires=Thu, 01 Jan 1970 00:00:00 GMT;.*?/)[_0x181de3(0x1d7)](0xcc),await _0x3258ca[_0x181de3(0x27c)](_0x181de3(0x28a))['expect'](0xcc),await _0x7e0634[_0x181de3(0x198)](),assert[_0x181de3(0x2e8)](_0x7e0634['get'](_0x46feb3[_0x181de3(0x2e3)]),_0x1736ef);}),it('can\x20destroy\x20only\x20current\x20session',async function(){const _0x47d8d0=_0x2c2b57,_0x1be9d0=_0x7e0634['get'](_0x46feb3[_0x47d8d0(0x2e3)]);await _0x3258ca[_0x47d8d0(0x27c)](_0x47d8d0(0x28a))[_0x47d8d0(0x1d7)](0xc8),await _0x3258ca[_0x47d8d0(0x22d)](_0x47d8d0(0x255))[_0x47d8d0(0x16f)]({'all':![]})['expect'](_0x47d8d0(0x2a9),/ghost-members-ssr=.*;.*?expires=Thu, 01 Jan 1970 00:00:00 GMT;.*?/)[_0x47d8d0(0x1d7)](0xcc),await _0x3258ca[_0x47d8d0(0x27c)](_0x47d8d0(0x28a))[_0x47d8d0(0x1d7)](0xcc),await _0x7e0634['refresh'](),assert[_0x47d8d0(0x1ff)](_0x7e0634[_0x47d8d0(0x27c)](_0x46feb3[_0x47d8d0(0x2e3)]),_0x1be9d0);});}),describe(_0x2398a9[_0x32e9e9(0x283)],function(){const _0x46d32c=_0x32e9e9,_0x5d2a72={'VtiyZ':_0x46feb3['UKqPQ'],'pwplD':_0x46feb3[_0x46d32c(0x1ba)]};_0x46feb3[_0x46d32c(0x197)](before,async function(){const _0x10e096=_0x46d32c;await _0x46feb3[_0x10e096(0x2ec)](_0x586f0e,_0x10e096(0x1b1));}),it('can\x20read\x20public\x20post\x20content',async function(){const _0x681f38=_0x46d32c;await _0x3258ca[_0x681f38(0x27c)](_0x681f38(0x29c))[_0x681f38(0x1d7)](0xc8)[_0x681f38(0x1d7)](assertContentIsPresent);}),_0x46feb3[_0x46d32c(0x1cb)](it,_0x46feb3[_0x46d32c(0x1b3)],async function(){const _0x412a1d=_0x46d32c;_0x412a1d(0x1c1)!=='ChuiP'?await _0x3258ca['get'](_0x5d2a72['VtiyZ'])[_0x412a1d(0x1d7)](0xc8)[_0x412a1d(0x1d7)](assertContentIsPresent):_0xe62187['text'][_0x412a1d(0x28b)][_0x412a1d(0x158)](_0x412a1d(0x293));}),it('cannot\x20read\x20paid\x20post\x20content',async function(){const _0x5eeb4a=_0x46d32c;await _0x3258ca[_0x5eeb4a(0x27c)](_0x5d2a72[_0x5eeb4a(0x228)])[_0x5eeb4a(0x1d7)](0xc8)[_0x5eeb4a(0x1d7)](assertContentIsAbsent);}),_0x46feb3[_0x46d32c(0x1db)](it,_0x46feb3['uyqdh'],async function(){const _0x654a35=_0x46d32c;if(_0x46feb3[_0x654a35(0x2c4)]!==_0x654a35(0x2f0))return new _0x2e3fc8(_0x654a35(0x155))(),'members-test-theme';else await _0x3258ca[_0x654a35(0x27c)](_0x654a35(0x226))[_0x654a35(0x1d7)](0xc8)['expect'](assertContentIsAbsent);}),it(_0x46d32c(0x1e7),async function(){const _0x1af0fb=_0x46d32c;await _0x3258ca['get'](_0x1af0fb(0x1d3))[_0x1af0fb(0x1d7)](0xc8)['expect'](assertContentIsAbsent);});}),describe(_0x2398a9[_0x32e9e9(0x24b)],function(){const _0x1b4983=_0x32e9e9,_0x3fe75c={'mFkKI':function(_0x56ae67,_0x3a029f){return _0x46feb3['oNAFz'](_0x56ae67,_0x3a029f);},'bfdJY':function(_0xbe8249,_0x42f056,_0x1d52ad){return _0x46feb3['SuVaI'](_0xbe8249,_0x42f056,_0x1d52ad);},'NdXGu':_0x1b4983(0x1d8),'yvdCT':_0x1b4983(0x1b7)},_0x18e79b=_0x46feb3['pKlaj'];_0x46feb3[_0x1b4983(0x2ec)](before,async function(){await _0x3fe75c['mFkKI'](_0x586f0e,_0x18e79b);}),it(_0x46feb3[_0x1b4983(0x1eb)],async function(){const _0x9e2381=_0x1b4983,_0x31f11f=sinon[_0x9e2381(0x268)]();DomainEvents['subscribe'](MemberPageViewEvent,_0x31f11f);let _0x2ef506=await models[_0x9e2381(0x2e7)]['findOne']({'email':_0x18e79b});await models['Member'][_0x9e2381(0x25b)]({'last_seen_at':null},{'id':_0x2ef506[_0x9e2381(0x27c)]('id')}),_0x2ef506=await models[_0x9e2381(0x2e7)]['findOne']({'email':_0x18e79b}),assert[_0x9e2381(0x1ff)](_0x2ef506['get']('last_seen_at'),null,'The\x20member\x20shouldn\x27t\x20have\x20a\x20`last_seen_at`\x20property\x20set\x20before\x20this\x20test.'),await _0x3258ca['get']('/free-to-see/')[_0x9e2381(0x1d7)](0xc8)[_0x9e2381(0x1d7)](assertContentIsPresent),await DomainEvents[_0x9e2381(0x1bc)](),_0x3fe75c[_0x9e2381(0x2e4)](assert,_0x31f11f[_0x9e2381(0x208)],_0x3fe75c[_0x9e2381(0x269)]),_0x2ef506=await models[_0x9e2381(0x2e7)][_0x9e2381(0x250)]({'email':_0x18e79b}),assert[_0x9e2381(0x2e8)](_0x2ef506['get'](_0x3fe75c[_0x9e2381(0x2ea)]),null,_0x9e2381(0x176));});}),_0x2398a9['UkxDO'](describe,_0x32e9e9(0x2da),function(){const _0x28a862=_0x32e9e9,_0x280418=_0x28a862(0x24e);_0x46feb3[_0x28a862(0x2ec)](before,async function(){const _0x126129=_0x28a862,_0x58cd9e={'rCiYG':_0x46feb3[_0x126129(0x1c9)],'Uqssl':_0x46feb3[_0x126129(0x1c5)],'wJVXt':function(_0x3da5bd,_0x5f5e00){return _0x3da5bd!==_0x5f5e00;}};await models[_0x126129(0x2e7)]['findOne']({'email':_0x280418},{'require':!![]});const _0x32bfa0=require(_0x126129(0x150)),_0x42add3=await _0x32bfa0['api'][_0x126129(0x1f9)](_0x280418,_0x126129(0x19a)),_0x57b8a6=new URL(_0x42add3),_0xeb3c16=''+_0x57b8a6[_0x126129(0x2c1)]+_0x57b8a6[_0x126129(0x19b)];await _0x3258ca[_0x126129(0x27c)](_0xeb3c16)[_0x126129(0x1d7)](0x12e)[_0x126129(0x23d)](_0x4287d8=>{const _0xc030d3=_0x126129;if(_0x58cd9e[_0xc030d3(0x1b4)]('mZKKW','rFarb')){const _0x4df822=new URL(_0x4287d8[_0xc030d3(0x2d7)][_0xc030d3(0x17a)],testUtils[_0xc030d3(0x1c6)][_0xc030d3(0x1e2)]());should[_0xc030d3(0x2f3)](_0x4df822['searchParams'][_0xc030d3(0x27c)]('success')),_0x4df822['searchParams'][_0xc030d3(0x27c)](_0x58cd9e[_0xc030d3(0x16a)])['should'][_0xc030d3(0x277)](_0x58cd9e[_0xc030d3(0x292)]);}else{const _0x14fd75=new _0x5ef4e5(_0x5a0bf5[_0xc030d3(0x2d7)]['location'],_0x1a552e[_0xc030d3(0x1c6)][_0xc030d3(0x1e2)]());_0xfdb309[_0xc030d3(0x2f3)](_0x14fd75['searchParams'][_0xc030d3(0x27c)](_0x58cd9e[_0xc030d3(0x16a)])),_0x14fd75['searchParams']['get'](_0xc030d3(0x2b4))[_0xc030d3(0x28b)][_0xc030d3(0x277)](_0x58cd9e['Uqssl']);}});}),_0x46feb3['sLSdN'](it,_0x28a862(0x287),async function(){const _0x46a837=_0x28a862,_0x4c3774=await _0x3258ca[_0x46a837(0x27c)](_0x46a837(0x28a))[_0x46a837(0x1d7)](0xc8),_0x4129c2=_0x4c3774[_0x46a837(0x2a0)];should['exist'](_0x4129c2),_0x4129c2['should'][_0x46a837(0x248)]['properties']([_0x46feb3[_0x46a837(0x261)],_0x46a837(0x2de),_0x46a837(0x2b1),_0x46a837(0x23f),'expertise',_0x46a837(0x21b),_0x46feb3['TiuPa'],_0x46feb3[_0x46a837(0x1c7)],_0x46feb3['ZogCe'],_0x46a837(0x1f4),_0x46a837(0x26a),_0x46feb3['GAhxX'],_0x46feb3[_0x46a837(0x1fa)]]),Object['keys'](_0x4129c2)[_0x46a837(0x28b)][_0x46a837(0x248)][_0x46a837(0x164)](0xd),_0x4129c2[_0x46a837(0x28b)]['not']['have'][_0x46a837(0x2b7)]('id'),_0x4129c2[_0x46a837(0x2c0)][_0x46a837(0x28b)][_0x46a837(0x248)]['length'](0x1),Object[_0x46a837(0x22a)](_0x4129c2[_0x46a837(0x2c0)][0x0])[_0x46a837(0x28b)][_0x46a837(0x248)][_0x46a837(0x164)](0x5),_0x4129c2[_0x46a837(0x2c0)][0x0][_0x46a837(0x28b)]['have'][_0x46a837(0x22b)](['id',_0x46feb3[_0x46a837(0x261)],_0x46a837(0x2b1),_0x46feb3[_0x46a837(0x23c)],_0x46feb3['EOitm']]);}),_0x46feb3[_0x28a862(0x159)](it,_0x28a862(0x1d1),async function(){const _0x299b4d=_0x28a862;await _0x3258ca[_0x299b4d(0x27c)](_0x299b4d(0x29c))['expect'](0xc8)[_0x299b4d(0x1d7)](assertContentIsPresent);}),_0x46feb3[_0x28a862(0x1cb)](it,_0x28a862(0x1a7),async function(){const _0x544662=_0x28a862;await _0x3258ca[_0x544662(0x27c)](_0x544662(0x203))['expect'](0xc8)[_0x544662(0x1d7)](assertContentIsPresent);}),it(_0x28a862(0x1e4),async function(){const _0x1e8b88=_0x28a862;await _0x3258ca[_0x1e8b88(0x27c)](_0x46feb3['XXVPR'])[_0x1e8b88(0x1d7)](0xc8)[_0x1e8b88(0x1d7)](assertContentIsPresent);}),_0x46feb3[_0x28a862(0x1cb)](it,_0x28a862(0x19c),async function(){const _0x18dd3a=_0x28a862;await _0x3258ca[_0x18dd3a(0x27c)](_0x46feb3[_0x18dd3a(0x1df)])[_0x18dd3a(0x1d7)](0xc8)[_0x18dd3a(0x1d7)](assertContentIsAbsent);}),it(_0x46feb3[_0x28a862(0x1b2)],async function(){const _0x3ce466=_0x28a862;await _0x3258ca[_0x3ce466(0x27c)]('/thou-must-have-default-product/')['expect'](0xc8)[_0x3ce466(0x1d7)](assertContentIsPresent);}),it(_0x28a862(0x1fc),async function(){const _0x578585=_0x28a862,_0x85ef8=sinon[_0x578585(0x268)]();DomainEvents[_0x578585(0x237)](MemberPageViewEvent,_0x85ef8);let _0x25d2cb=await models[_0x578585(0x2e7)][_0x578585(0x250)]({'email':_0x280418});await models['Member'][_0x578585(0x25b)]({'last_seen_at':null},{'id':_0x25d2cb[_0x578585(0x27c)]('id')}),_0x25d2cb=await models[_0x578585(0x2e7)][_0x578585(0x250)]({'email':_0x280418}),assert['equal'](_0x25d2cb[_0x578585(0x27c)](_0x46feb3[_0x578585(0x21a)]),null,_0x46feb3[_0x578585(0x2ee)]),await _0x3258ca['get'](_0x46feb3[_0x578585(0x2db)])[_0x578585(0x1d7)](0xc8)['expect'](assertContentIsPresent),await DomainEvents[_0x578585(0x1bc)](),assert(_0x85ef8[_0x578585(0x208)],'A\x20page\x20view\x20from\x20a\x20member\x20should\x20generate\x20a\x20MemberPageViewEvent\x20event'),_0x25d2cb=await models[_0x578585(0x2e7)][_0x578585(0x250)]({'email':_0x280418}),assert[_0x578585(0x2e8)](_0x25d2cb[_0x578585(0x27c)](_0x46feb3[_0x578585(0x21a)]),null,'The\x20member\x20should\x20have\x20a\x20`last_seen_at`\x20property\x20after\x20having\x20visited\x20a\x20page\x20while\x20logged-in.');});}),describe(_0x2398a9['RVlFi'],function(){const _0x46d2a7=_0x32e9e9,_0x47797d={'vxlbn':function(_0x3ac517,_0x544b1c){const _0xa107aa=_0x4134;return _0x2398a9[_0xa107aa(0x1e8)](_0x3ac517,_0x544b1c);}};_0x2398a9[_0x46d2a7(0x1e8)](before,async function(){const _0x261fd3=_0x46d2a7;await _0x47797d[_0x261fd3(0x167)](_0x586f0e,_0x261fd3(0x22f));}),it(_0x2398a9[_0x46d2a7(0x174)],async function(){const _0x4ad1e0=_0x46d2a7;await _0x3258ca[_0x4ad1e0(0x27c)](_0x4ad1e0(0x29c))[_0x4ad1e0(0x1d7)](0xc8)[_0x4ad1e0(0x1d7)](assertContentIsPresent);}),_0x2398a9[_0x46d2a7(0x27f)](it,_0x2398a9[_0x46d2a7(0x266)],async function(){const _0x3361ac=_0x46d2a7;await _0x3258ca[_0x3361ac(0x27c)](_0x46feb3[_0x3361ac(0x1f5)])[_0x3361ac(0x1d7)](0xc8)['expect'](assertContentIsPresent);}),it('can\x20read\x20paid\x20post\x20content',async function(){const _0x52735b=_0x46d2a7;await _0x3258ca[_0x52735b(0x27c)](_0x46feb3['XXVPR'])[_0x52735b(0x1d7)](0xc8)['expect'](assertContentIsPresent);}),_0x2398a9[_0x46d2a7(0x26f)](it,_0x46d2a7(0x19c),async function(){const _0x5b04b1=_0x46d2a7;await _0x3258ca[_0x5b04b1(0x27c)](_0x46feb3[_0x5b04b1(0x1df)])[_0x5b04b1(0x1d7)](0xc8)[_0x5b04b1(0x1d7)](assertContentIsAbsent);}),_0x2398a9['BMCTp'](it,_0x46d2a7(0x200),async function(){const _0xb00ba7=_0x46d2a7;await _0x3258ca[_0xb00ba7(0x27c)](_0x46feb3[_0xb00ba7(0x157)])[_0xb00ba7(0x1d7)](0xc8)[_0xb00ba7(0x1d7)](assertContentIsPresent);});}),describe(_0x2398a9[_0x32e9e9(0x286)],function(){const _0x17fcfa=_0x32e9e9;_0x46feb3[_0x17fcfa(0x232)](before,async function(){await _0x586f0e('with-product@test.com');}),it(_0x17fcfa(0x200),async function(){const _0x2d4771=_0x17fcfa;await _0x3258ca[_0x2d4771(0x27c)](_0x46feb3[_0x2d4771(0x157)])[_0x2d4771(0x1d7)](0xc8)[_0x2d4771(0x1d7)](assertContentIsPresent);});});});});