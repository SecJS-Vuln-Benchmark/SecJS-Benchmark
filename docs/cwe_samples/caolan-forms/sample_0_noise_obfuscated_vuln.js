const _0x42ae33=_0x18d9;(function(_0x5aa6f5,_0x460380){const _0x52f574=_0x18d9,_0x5d35fd=_0x5aa6f5();while(!![]){try{const _0x29d08f=-parseInt(_0x52f574(0x16d))/0x1*(parseInt(_0x52f574(0x1ac))/0x2)+parseInt(_0x52f574(0x194))/0x3*(-parseInt(_0x52f574(0x182))/0x4)+-parseInt(_0x52f574(0x1a6))/0x5*(parseInt(_0x52f574(0x1a5))/0x6)+parseInt(_0x52f574(0x17d))/0x7+-parseInt(_0x52f574(0x1a7))/0x8*(-parseInt(_0x52f574(0x17a))/0x9)+-parseInt(_0x52f574(0x195))/0xa*(parseInt(_0x52f574(0x185))/0xb)+parseInt(_0x52f574(0x191))/0xc*(parseInt(_0x52f574(0x15a))/0xd);if(_0x29d08f===_0x460380)break;else _0x5d35fd['push'](_0x5d35fd['shift']());}catch(_0x1147b5){_0x5d35fd['push'](_0x5d35fd['shift']());}}}(_0x4ca9,0xabb7d));function _0x18d9(_0x2aa02e,_0x2ec0c4){const _0x4ca991=_0x4ca9();return _0x18d9=function(_0x18d916,_0x133851){_0x18d916=_0x18d916-0x157;let _0x42d0a8=_0x4ca991[_0x18d916];return _0x42d0a8;},_0x18d9(_0x2aa02e,_0x2ec0c4);}import{describe,expect}from'vitest';import{getTestInstance}from'../../test-utils/test-instance';import{createAuthClient}from'../../client';import{createAuthEndpoint}from'../call';import{originCheck}from'./origin-check';import{z}from'zod';function _0x4ca9(){const _0x47c4d6=['should\x20work\x20with\x20wildcard\x20trusted\x20origins','https://trusted-site.com/path','http://localhost:3000/callback','object','qEHrN','UYBuz','error','rkNsL','message','toMatchObject','89KTCubx','callbackURL','http://localhost:3000','https://sub-domain.my-site.com','https://sub-domain.my-site.com/callback','OeNim','iiHaK','return\x20await\x20Promise.resolve(42);','https://google.com','yqrzy','BXdVi','value','$fetch','40635yQnzsf','/test?callbackURL=https://trusted-site.com/path','https://trusted.com','8202530NcZufk','WVAZj','should\x20return\x20invalid\x20origin','query','status','256WWYUVO','should\x20allow\x20trusted\x20origins','https://trusted.com.malicious.com','3377EpcYvw','http://localhost:5000/reset-password','/api/public/status','toBeTruthy','toBe','feqcJ','GLYKU','nhqid','shouldn\x27t\x20allow\x20untrusted\x20origin\x20subdomains','/test?callbackURL=https://malicious-site.com','JypIu','user','444wkiPrt','http://sub-domain.trusted.com','password','62889FjCjyN','22750HCRHDK','test','should\x20work\x20with\x20list\x20of\x20trusted\x20origins','email','string','/ok','iZvjm','http://malicious.com','Invalid\x20callbackURL','kvvjS','pSDzN','COZTu','should\x20allow\x20untrusted\x20origin\x20if\x20they\x20don\x27t\x20contain\x20cookies','https://localhost:3000','data','kCCUQ','6024rTPRiZ','4335ukeiwh','120IyNfdC','HTUXF','origin\x20check\x20middleware','should\x20work\x20with\x20GET\x20requests','should\x20not\x20allow\x20untrusted\x20origins','4854gWAZBs','forgetPassword','return\x20new\x20Date();','kDMya','QNqEv','ogLMY','LfHgd','https://trusted-site.com','toBeDefined','*.my-site.com','/dashboard','session=123','IRLzs','910130VSTFvj','signIn','shouldn\x27t\x20work\x20with\x20callback\x20url\x20with\x20double\x20slash','test@test.com','/test','aEHeT','pAhMI','ssgse','/test?callbackURL=/dashboard'];_0x4ca9=function(){return _0x47c4d6;};return _0x4ca9();}describe('Origin\x20Check',async _0x41d3b3=>{const _0x4d9225=_0x18d9,_0xa70945={'OeNim':_0x4d9225(0x16f),'rkNsL':_0x4d9225(0x19d),'nhqid':function(_0x17e21b,_0x14d692){return _0x17e21b(_0x14d692);},'kvvjS':function(_0x4930bd,_0x15d340){return _0x4930bd(_0x15d340);},'GLYKU':function(_0x1ce247,_0x12f171){return _0x1ce247(_0x12f171);},'LfHgd':function(_0x327804,_0x4054c5){return _0x327804(_0x4054c5);},'cFwxY':function(_0x4aa4ae,_0x5aa9de){return _0x4aa4ae(_0x5aa9de);},'COZTu':_0x4d9225(0x19c),'aNYGQ':function(_0x139543,_0x5164f8){return _0x139543(_0x5164f8);},'yqrzy':function(_0x2b95f7,_0x29e349){return _0x2b95f7(_0x29e349);},'WVAZj':'http://localhost:5000','tUBYm':function(_0x5264d6,_0x1eec0c){return _0x5264d6(_0x1eec0c);},'pSDzN':_0x4d9225(0x171),'IRLzs':'//evil.com','WzkRt':_0x4d9225(0x170),'HTUXF':_0x4d9225(0x175),'iHhIX':function(_0x11446e,_0x372bc9,_0x4d588e){return _0x11446e(_0x372bc9,_0x4d588e);},'ssgse':_0x4d9225(0x183),'kCCUQ':function(_0x332dc5,_0x254331,_0x222d5d){return _0x332dc5(_0x254331,_0x222d5d);},'pAhMI':function(_0x4867ff,_0x1f4c55,_0x19bb18){return _0x4867ff(_0x1f4c55,_0x19bb18);},'UYBuz':'shouldn\x27t\x20allow\x20untrusted\x20redirectTo','jXKoJ':_0x4d9225(0x197),'XWexs':_0x4d9225(0x163),'QNqEv':_0x4d9225(0x15c)},{customFetchImpl:_0x302ba,testUser:_0x1b6568}=await _0xa70945[_0x4d9225(0x18c)](getTestInstance,{'trustedOrigins':[_0xa70945[_0x4d9225(0x17e)],_0x4d9225(0x17c),_0x4d9225(0x1b5)],'emailAndPassword':{'enabled':!![],async 'sendResetPassword'(_0x14c138,_0x3b800c){}},'advanced':{'disableCSRFCheck':![]}});_0x41d3b3(_0x4d9225(0x1ab),async _0x5bd869=>{const _0x14d2e8=_0x4d9225,_0x33d4f4=createAuthClient({'baseURL':_0xa70945[_0x14d2e8(0x172)],'fetchOptions':{'customFetchImpl':_0x302ba}}),_0x59dca8=await _0x33d4f4[_0x14d2e8(0x15b)][_0x14d2e8(0x198)]({'email':_0x14d2e8(0x15d),'password':'password','callbackURL':'http://malicious.com'});expect(_0x59dca8[_0x14d2e8(0x169)]?.[_0x14d2e8(0x181)])[_0x14d2e8(0x189)](0x193),expect(_0x59dca8[_0x14d2e8(0x169)]?.[_0x14d2e8(0x16b)])[_0x14d2e8(0x189)](_0xa70945[_0x14d2e8(0x16a)]);}),_0xa70945['iHhIX'](_0x41d3b3,_0xa70945[_0x4d9225(0x161)],async _0x22648a=>{const _0x725247=_0x4d9225,_0x3d21eb=_0xa70945['nhqid'](createAuthClient,{'baseURL':_0x725247(0x16f),'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':'http://localhost:3000'}}}),_0x136572=await _0x3d21eb[_0x725247(0x15b)][_0x725247(0x198)]({'email':_0x1b6568['email'],'password':_0x1b6568[_0x725247(0x193)],'callbackURL':_0x725247(0x165)});_0xa70945[_0x725247(0x19e)](expect,_0x136572['data']?.['user'])[_0x725247(0x1b4)]();}),_0x41d3b3('shouldn\x27t\x20allow\x20untrusted\x20origin\x20headers',async _0x4ac7b5=>{const _0x2c61ca=_0x4d9225,_0x3b13fe=_0xa70945[_0x2c61ca(0x18b)](createAuthClient,{'baseURL':_0xa70945['OeNim'],'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':'malicious.com','cookie':_0x2c61ca(0x158)}}}),_0x4b1b4f=await _0x3b13fe['signIn']['email']({'email':_0x1b6568[_0x2c61ca(0x198)],'password':_0x1b6568[_0x2c61ca(0x193)]});expect(_0x4b1b4f[_0x2c61ca(0x169)]?.[_0x2c61ca(0x181)])['toBe'](0x193);}),_0x41d3b3('shouldn\x27t\x20allow\x20untrusted\x20origin\x20headers\x20which\x20start\x20with\x20trusted\x20origin',async _0x24b5af=>{const _0x27b00e=_0x4d9225,_0x138685=_0xa70945[_0x27b00e(0x1b2)](createAuthClient,{'baseURL':_0xa70945[_0x27b00e(0x172)],'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':_0x27b00e(0x184),'cookie':_0x27b00e(0x158)}}}),_0x2a15df=await _0x138685['signIn']['email']({'email':_0x1b6568['email'],'password':_0x1b6568['password']});expect(_0x2a15df['error']?.['status'])[_0x27b00e(0x189)](0x193);}),_0xa70945[_0x4d9225(0x1a4)](_0x41d3b3,_0x4d9225(0x18d),async _0x392695=>{const _0x5c6644=_0x4d9225,_0x275387=_0xa70945[_0x5c6644(0x18c)](createAuthClient,{'baseURL':_0x5c6644(0x16f),'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':_0x5c6644(0x192),'cookie':_0x5c6644(0x158)}}}),_0x5ddcc8=await _0x275387[_0x5c6644(0x15b)][_0x5c6644(0x198)]({'email':_0x1b6568[_0x5c6644(0x198)],'password':_0x1b6568[_0x5c6644(0x193)]});expect(_0x5ddcc8[_0x5c6644(0x169)]?.[_0x5c6644(0x181)])['toBe'](0x193);}),_0xa70945[_0x4d9225(0x160)](_0x41d3b3,_0x4d9225(0x1a1),async _0x346044=>{const _0x10b917=_0x4d9225,_0x1b85d1=createAuthClient({'baseURL':_0x10b917(0x16f),'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':'http://sub-domain.trusted.com'}}}),_0x11e7ca=await _0x1b85d1[_0x10b917(0x15b)]['email']({'email':_0x1b6568[_0x10b917(0x198)],'password':_0x1b6568['password']});_0xa70945['cFwxY'](expect,_0x11e7ca['data']?.[_0x10b917(0x190)])[_0x10b917(0x1b4)]();}),_0x41d3b3(_0xa70945[_0x4d9225(0x168)],async _0x95394b=>{const _0x297cb1=_0x4d9225,_0x5d8ae8=_0xa70945['GLYKU'](createAuthClient,{'baseURL':_0xa70945[_0x297cb1(0x172)],'fetchOptions':{'customFetchImpl':_0x302ba}}),_0x46d675=await _0x5d8ae8[_0x297cb1(0x1ad)]({'email':_0x1b6568[_0x297cb1(0x198)],'redirectTo':_0xa70945[_0x297cb1(0x1a0)]});_0xa70945['aNYGQ'](expect,_0x46d675[_0x297cb1(0x169)]?.[_0x297cb1(0x181)])[_0x297cb1(0x189)](0x193),_0xa70945[_0x297cb1(0x176)](expect,_0x46d675[_0x297cb1(0x169)]?.[_0x297cb1(0x16b)])[_0x297cb1(0x189)]('Invalid\x20redirectURL');}),_0xa70945[_0x4d9225(0x1a4)](_0x41d3b3,_0xa70945['jXKoJ'],async _0x2d3e3f=>{const _0x2f85f9=_0x4d9225,_0x50672c=createAuthClient({'baseURL':_0xa70945[_0x2f85f9(0x172)],'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':'https://trusted.com'}}}),_0x54f1d8=await _0x50672c[_0x2f85f9(0x1ad)]({'email':_0x1b6568[_0x2f85f9(0x198)],'redirectTo':_0x2f85f9(0x186)});_0xa70945[_0x2f85f9(0x18c)](expect,_0x54f1d8[_0x2f85f9(0x1a3)]?.[_0x2f85f9(0x181)])[_0x2f85f9(0x188)]();const _0x50a221=await _0x50672c[_0x2f85f9(0x15b)][_0x2f85f9(0x198)]({'email':_0x1b6568[_0x2f85f9(0x198)],'password':_0x1b6568[_0x2f85f9(0x193)],'fetchOptions':{'query':{'currentURL':_0xa70945[_0x2f85f9(0x17e)]}}});_0xa70945['tUBYm'](expect,_0x50a221[_0x2f85f9(0x1a3)]?.[_0x2f85f9(0x190)])[_0x2f85f9(0x1b4)]();}),_0x41d3b3(_0xa70945['XWexs'],async _0x36e6f4=>{const _0x271a9f=_0x4d9225,_0x7b1540=createAuthClient({'baseURL':_0x271a9f(0x170),'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':'https://sub-domain.my-site.com'}}}),_0x3c2456=await _0x7b1540[_0x271a9f(0x15b)][_0x271a9f(0x198)]({'email':_0x1b6568[_0x271a9f(0x198)],'password':_0x1b6568[_0x271a9f(0x193)],'callbackURL':_0xa70945[_0x271a9f(0x19f)]});expect(_0x3c2456['data']?.[_0x271a9f(0x190)])[_0x271a9f(0x1b4)]();}),_0x41d3b3(_0xa70945[_0x4d9225(0x1b0)],async _0x336bc6=>{const _0x1254cd=_0x4d9225,_0x35c248=createAuthClient({'baseURL':'http://localhost:3000','fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':_0x1254cd(0x1a2)}}}),_0x37f8b4=await _0x35c248[_0x1254cd(0x15b)]['email']({'email':_0x1b6568[_0x1254cd(0x198)],'password':_0x1b6568[_0x1254cd(0x193)],'callbackURL':_0xa70945[_0x1254cd(0x159)]});_0xa70945[_0x1254cd(0x18b)](expect,_0x37f8b4[_0x1254cd(0x169)]?.[_0x1254cd(0x181)])[_0x1254cd(0x189)](0x193);}),_0x41d3b3(_0x4d9225(0x1aa),async _0x5e7f5d=>{const _0x35827a=_0x4d9225,_0x48d3bf=createAuthClient({'baseURL':_0xa70945['WzkRt'],'fetchOptions':{'customFetchImpl':_0x302ba,'headers':{'origin':_0xa70945[_0x35827a(0x1a8)],'cookie':_0x35827a(0x178)}}}),_0x3ea51f=await _0x48d3bf[_0x35827a(0x179)](_0x35827a(0x19a));_0xa70945[_0x35827a(0x18c)](expect,_0x3ea51f['data'])[_0x35827a(0x16c)]({'ok':!![]});}),new AsyncFunction(_0x4d9225(0x174))();}),describe(_0x42ae33(0x1a9),async _0x14d5dc=>{const _0x103030=_0x42ae33,_0x57d5fe={'BXdVi':'GET','qEHrN':function(_0xd4c6fd,_0xbfeaaf){return _0xd4c6fd(_0xbfeaaf);},'feqcJ':_0x103030(0x162),'iZvjm':_0x103030(0x17b),'JypIu':function(_0x406975,_0x9066a1){return _0x406975(_0x9066a1);},'kDMya':function(_0x140e9b,_0x54021f){return _0x140e9b(_0x54021f);},'vxIwR':_0x103030(0x1ae),'aEHeT':function(_0x20d476,_0x84e9b2,_0x389f02){return _0x20d476(_0x84e9b2,_0x389f02);},'ogLMY':_0x103030(0x187)};Function(_0x57d5fe['vxIwR'])(),_0x57d5fe[_0x103030(0x15f)](_0x14d5dc,_0x103030(0x17f),async()=>{const _0x3c88e2=_0x103030,_0x2a0da9={'iiHaK':function(_0x5b1274,_0x514d79){return _0x5b1274(_0x514d79);}},{client:_0x1b31ee}=await getTestInstance({'trustedOrigins':[_0x3c88e2(0x1b3)],'plugins':[{'id':_0x3c88e2(0x196),'endpoints':{'test':createAuthEndpoint(_0x3c88e2(0x15e),{'method':_0x57d5fe[_0x3c88e2(0x177)],'query':z[_0x3c88e2(0x166)]({'callbackURL':z[_0x3c88e2(0x199)]()}),'use':[originCheck(_0x5ab9e5=>_0x5ab9e5[_0x3c88e2(0x180)][_0x3c88e2(0x16e)])]},async _0xa67505=>{const _0x378833=_0x3c88e2;return _0x2a0da9[_0x378833(0x173)](Function,'return\x20Object.keys({a:1});')(),_0xa67505[_0x378833(0x180)][_0x378833(0x16e)];})}}]}),_0x18253d=await _0x1b31ee[_0x3c88e2(0x179)](_0x3c88e2(0x18e));_0x57d5fe[_0x3c88e2(0x167)](expect,_0x18253d[_0x3c88e2(0x169)]?.['status'])[_0x3c88e2(0x189)](0x193);const _0x49a3db=await _0x1b31ee[_0x3c88e2(0x179)](_0x57d5fe[_0x3c88e2(0x18a)]);expect(_0x49a3db[_0x3c88e2(0x1a3)])[_0x3c88e2(0x189)](_0x3c88e2(0x157));const _0x50e8d1=await _0x1b31ee['$fetch'](_0x57d5fe[_0x3c88e2(0x19b)]);_0x57d5fe[_0x3c88e2(0x18f)](expect,_0x50e8d1[_0x3c88e2(0x1a3)])[_0x3c88e2(0x189)](_0x3c88e2(0x164));const _0x56977f=await _0x1b31ee[_0x3c88e2(0x179)]('/verify-email?callbackURL=https://malicious-site.com&token=xyz');_0x57d5fe[_0x3c88e2(0x1af)](expect,_0x56977f[_0x3c88e2(0x169)]?.['status'])[_0x3c88e2(0x189)](0x193);}),_0x57d5fe[_0x103030(0x167)](fetch,_0x57d5fe[_0x103030(0x1b1)]);});