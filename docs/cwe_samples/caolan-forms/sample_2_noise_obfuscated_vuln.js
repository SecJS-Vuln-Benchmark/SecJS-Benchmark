const _0xff3679=_0x4879;function _0x4879(_0x3b3040,_0x3caf47){const _0x371abe=_0x371a();return _0x4879=function(_0x4879e3,_0xc44807){_0x4879e3=_0x4879e3-0x19d;let _0x10f365=_0x371abe[_0x4879e3];return _0x10f365;},_0x4879(_0x3b3040,_0x3caf47);}(function(_0x260033,_0x373cd7){const _0x18db7b=_0x4879,_0x3fe226=_0x260033();while(!![]){try{const _0x2106db=parseInt(_0x18db7b(0x1c7))/0x1+parseInt(_0x18db7b(0x1f4))/0x2*(-parseInt(_0x18db7b(0x20d))/0x3)+parseInt(_0x18db7b(0x1a3))/0x4*(parseInt(_0x18db7b(0x1a0))/0x5)+parseInt(_0x18db7b(0x211))/0x6+-parseInt(_0x18db7b(0x1fe))/0x7*(-parseInt(_0x18db7b(0x1d1))/0x8)+-parseInt(_0x18db7b(0x1d9))/0x9*(parseInt(_0x18db7b(0x1f5))/0xa)+-parseInt(_0x18db7b(0x1fd))/0xb;if(_0x2106db===_0x373cd7)break;else _0x3fe226['push'](_0x3fe226['shift']());}catch(_0x4f52fd){_0x3fe226['push'](_0x3fe226['shift']());}}}(_0x371a,0xa7ff2));import{describe,expect}from'vitest';import{getTestInstance}from'../../test-utils/test-instance';import{createAuthClient}from'../../client';import{createAuthEndpoint}from'../call';import{originCheck}from'./origin-check';function _0x371a(){const _0x327e7f=['TjuDp','blFup','zFMAe','*.my-site.com','toBe','Xympk','GET','error','should\x20work\x20with\x20wildcard\x20trusted\x20origins','status','KglCi','/test?callbackURL=/dashboard','ezzkE','3ipRkug','OXfrX','$fetch','https://sub-domain.my-site.com/callback','8131878bFXZFh','email','jGxDx','should\x20work\x20with\x20GET\x20requests','571370UdeEDu','TTIoN','eZAaY','8ZWONmR','cTITU','oVwLS','CNrRO','zbEXn','Invalid\x20callbackURL','toBeTruthy','password','http://localhost:3000','http://localhost:5000','DZKUs','trUAs','forgetPassword','https://trusted.com.malicious.com','whObW','XoMXn','https://sub-domain.my-site.com','UIqaj','https://localhost:3000','should\x20allow\x20trusted\x20origins','session=123','Ozcuf','//evil.com','shouldn\x27t\x20allow\x20untrusted\x20origin\x20headers\x20which\x20start\x20with\x20trusted\x20origin','https://httpbin.org/get','log','UpYtQ','dOkCq','VWECd','jVozj','EmfKE','signIn','SNkcf','shouldn\x27t\x20allow\x20untrusted\x20origin\x20subdomains','/verify-email?callbackURL=https://malicious-site.com&token=xyz','http://malicious.com','15595NKskCy','PilGs','var\x20x\x20=\x2042;\x20return\x20x;','toMatchObject','origin\x20check\x20middleware','test','QGxid','http://localhost:5000/reset-password','query','JKVje','8JEzVgj','xijhr','message','data','test@test.com','Origin\x20Check','shouldn\x27t\x20work\x20with\x20callback\x20url\x20with\x20double\x20slash','/test?callbackURL=https://trusted-site.com/path','18ZAwviT','Invalid\x20redirectURL','///evil.com','/test','user','object','/%5C/evil.com','KyYOl','toBeDefined','/dashboard','JZjvL','https://trusted-site.com/path','YSxro','malicious.com','spZUA','BncRK','xVnSZ','gQbrA','kyGMO','/test?callbackURL=https://malicious-site.com','RyWNC','SekGv','/ok','UgGYR','DAhTc','https://trusted-site.com','callbackURL','1012250FsvCtQ','613570Zqpget','JSzCz','https://trusted.com','should\x20allow\x20untrusted\x20origin\x20if\x20they\x20don\x27t\x20contain\x20cookies','Mwkkn','get','http://localhost:3000/callback','should\x20work\x20with\x20list\x20of\x20trusted\x20origins','17129684WgFFGO','8923187ZsDynp','fBzij'];_0x371a=function(){return _0x327e7f;};return _0x371a();}import{z}from'zod';describe(_0xff3679(0x1d6),async _0x2e5ef9=>{const _0x49ad87=_0xff3679,_0x4316fd={'EAwAP':_0x49ad87(0x1d5),'UgGYR':_0x49ad87(0x1aa),'JZjvL':_0x49ad87(0x1c6),'gQbrA':_0x49ad87(0x1a8),'OXfrX':_0x49ad87(0x1ab),'yAjba':_0x49ad87(0x1fb),'EmfKE':function(_0x4d0c20,_0x4be28f){return _0x4d0c20(_0x4be28f);},'YSxro':_0x49ad87(0x1e6),'UpYtQ':function(_0x39f356,_0x5b8ef7){return _0x39f356(_0x5b8ef7);},'TjuDp':_0x49ad87(0x1b0),'trUAs':'session=123','oVwLS':'http://sub-domain.trusted.com','SekGv':function(_0x1f7af2,_0x3cb8ae){return _0x1f7af2(_0x3cb8ae);},'CNrRO':_0x49ad87(0x1da),'RyWNC':_0x49ad87(0x1f7),'whObW':_0x49ad87(0x1ac),'KglCi':function(_0x2eb7f1,_0x29b9ea){return _0x2eb7f1(_0x29b9ea);},'KyYOl':_0x49ad87(0x1b3),'eZAaY':_0x49ad87(0x210),'jGxDx':function(_0x359988,_0xf01e29){return _0x359988(_0xf01e29);},'xijhr':_0x49ad87(0x1b5),'kyGMO':_0x49ad87(0x1b9),'cTITU':function(_0x2cb448,_0x4baa4f){return _0x2cb448(_0x4baa4f);},'VWECd':function(_0x2cb195,_0x3feb7b){return _0x2cb195(_0x3feb7b);},'XoMXn':'value','ezzkE':function(_0x42dc71,_0x3df4b4){return _0x42dc71+_0x3df4b4;},'spZUA':function(_0x21a6d5,_0xe71be8,_0x38ed71){return _0x21a6d5(_0xe71be8,_0x38ed71);},'Mwkkn':'should\x20not\x20allow\x20untrusted\x20origins','dOkCq':_0x49ad87(0x1b6),'UIqaj':function(_0x3bf56f,_0xc051f0,_0x128c50){return _0x3bf56f(_0xc051f0,_0x128c50);},'PilGs':_0x49ad87(0x1ba),'BncRK':function(_0x19ddf7,_0x54027f,_0x5a1cb7){return _0x19ddf7(_0x54027f,_0x5a1cb7);},'blFup':_0x49ad87(0x1c4),'ofjEN':_0x49ad87(0x1fc),'JKVje':_0x49ad87(0x208),'fBzij':function(_0x1e8985,_0x19454c,_0x325db8){return _0x1e8985(_0x19454c,_0x325db8);},'zFMAe':_0x49ad87(0x1d7),'jVozj':_0x49ad87(0x19f)},{customFetchImpl:_0x357a6c,testUser:_0x5d99e7}=await getTestInstance({'trustedOrigins':[_0x4316fd[_0x49ad87(0x1b1)],_0x49ad87(0x1f7),_0x49ad87(0x203)],'emailAndPassword':{'enabled':!![],async 'sendResetPassword'(_0x514d23,_0x18a08e){}},'advanced':{'disableCSRFCheck':![]}});_0x4316fd['spZUA'](_0x2e5ef9,_0x4316fd[_0x49ad87(0x1f9)],async _0x3eabf0=>{const _0x2f9b56=_0x49ad87,_0x9f50e7=createAuthClient({'baseURL':_0x2f9b56(0x1ab),'fetchOptions':{'customFetchImpl':_0x357a6c}}),_0x3f2ecb=await _0x9f50e7['signIn'][_0x2f9b56(0x19d)]({'email':_0x4316fd['EAwAP'],'password':_0x4316fd[_0x2f9b56(0x1f0)],'callbackURL':_0x4316fd[_0x2f9b56(0x1e3)]});expect(_0x3f2ecb['error']?.[_0x2f9b56(0x209)])[_0x2f9b56(0x204)](0x193),expect(_0x3f2ecb[_0x2f9b56(0x207)]?.[_0x2f9b56(0x1d3)])[_0x2f9b56(0x204)](_0x4316fd[_0x2f9b56(0x1ea)]);}),_0x4316fd[_0x49ad87(0x1e7)](_0x2e5ef9,_0x4316fd[_0x49ad87(0x1be)],async _0x241930=>{const _0x5d32d5=_0x49ad87,_0x4e8529=createAuthClient({'baseURL':_0x5d32d5(0x1ab),'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x5d32d5(0x20e)]}}}),_0xd42a45=await _0x4e8529['signIn'][_0x5d32d5(0x19d)]({'email':_0x5d99e7[_0x5d32d5(0x19d)],'password':_0x5d99e7[_0x5d32d5(0x1aa)],'callbackURL':_0x4316fd['yAjba']});expect(_0xd42a45['data']?.[_0x5d32d5(0x1dd)])[_0x5d32d5(0x1e1)]();}),_0x2e5ef9('shouldn\x27t\x20allow\x20untrusted\x20origin\x20headers',async _0xfbd3df=>{const _0x2db77d=_0x49ad87,_0x3a4b00=_0x4316fd[_0x2db77d(0x1c1)](createAuthClient,{'baseURL':_0x2db77d(0x1ab),'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x2db77d(0x1e5)],'cookie':_0x2db77d(0x1b7)}}}),_0x4d14d2=await _0x3a4b00[_0x2db77d(0x1c2)][_0x2db77d(0x19d)]({'email':_0x5d99e7['email'],'password':_0x5d99e7[_0x2db77d(0x1aa)]});expect(_0x4d14d2[_0x2db77d(0x207)]?.[_0x2db77d(0x209)])[_0x2db77d(0x204)](0x193);}),_0x4316fd[_0x49ad87(0x1b4)](_0x2e5ef9,_0x4316fd[_0x49ad87(0x1c8)],async _0x442acb=>{const _0x54dc4e=_0x49ad87,_0x5221f7=_0x4316fd[_0x54dc4e(0x1bd)](createAuthClient,{'baseURL':_0x54dc4e(0x1ab),'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x54dc4e(0x200)],'cookie':_0x4316fd[_0x54dc4e(0x1ae)]}}}),_0x267d00=await _0x5221f7[_0x54dc4e(0x1c2)][_0x54dc4e(0x19d)]({'email':_0x5d99e7['email'],'password':_0x5d99e7['password']});expect(_0x267d00[_0x54dc4e(0x207)]?.[_0x54dc4e(0x209)])['toBe'](0x193);}),_0x4316fd['BncRK'](_0x2e5ef9,_0x4316fd[_0x49ad87(0x201)],async _0x24f2b0=>{const _0x19ae02=_0x49ad87,_0x6f37e4=createAuthClient({'baseURL':_0x4316fd[_0x19ae02(0x20e)],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':'http://sub-domain.trusted.com','cookie':_0x19ae02(0x1b7)}}}),_0x123643=await _0x6f37e4[_0x19ae02(0x1c2)]['email']({'email':_0x5d99e7[_0x19ae02(0x19d)],'password':_0x5d99e7[_0x19ae02(0x1aa)]});expect(_0x123643[_0x19ae02(0x207)]?.[_0x19ae02(0x209)])[_0x19ae02(0x204)](0x193);}),_0x2e5ef9(_0x49ad87(0x1f8),async _0x2fafd9=>{const _0x9f39d6=_0x49ad87,_0x1e511f=createAuthClient({'baseURL':_0x4316fd[_0x9f39d6(0x20e)],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x9f39d6(0x1a5)]}}}),_0x4e8849=await _0x1e511f['signIn'][_0x9f39d6(0x19d)]({'email':_0x5d99e7[_0x9f39d6(0x19d)],'password':_0x5d99e7[_0x9f39d6(0x1aa)]});_0x4316fd[_0x9f39d6(0x1ee)](expect,_0x4e8849['data']?.[_0x9f39d6(0x1dd)])[_0x9f39d6(0x1e1)]();}),_0x4316fd[_0x49ad87(0x1e8)](_0x2e5ef9,'shouldn\x27t\x20allow\x20untrusted\x20redirectTo',async _0x1e63e5=>{const _0x1ef708=_0x49ad87,_0x4ca289=_0x4316fd[_0x1ef708(0x1c1)](createAuthClient,{'baseURL':_0x4316fd[_0x1ef708(0x20e)],'fetchOptions':{'customFetchImpl':_0x357a6c}}),_0x337f01=await _0x4ca289[_0x1ef708(0x1af)]({'email':_0x5d99e7[_0x1ef708(0x19d)],'redirectTo':'http://malicious.com'});expect(_0x337f01[_0x1ef708(0x207)]?.[_0x1ef708(0x209)])[_0x1ef708(0x204)](0x193),expect(_0x337f01['error']?.[_0x1ef708(0x1d3)])['toBe'](_0x4316fd[_0x1ef708(0x1a6)]);}),_0x2e5ef9(_0x4316fd['ofjEN'],async _0x3a1399=>{const _0x44a27a=_0x49ad87,_0x1e04f4=createAuthClient({'baseURL':_0x4316fd['OXfrX'],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x44a27a(0x1ed)]}}}),_0x127817=await _0x1e04f4[_0x44a27a(0x1af)]({'email':_0x5d99e7[_0x44a27a(0x19d)],'redirectTo':_0x44a27a(0x1ce)});expect(_0x127817['data']?.['status'])[_0x44a27a(0x1a9)]();const _0x4916ae=await _0x1e04f4['signIn']['email']({'email':_0x5d99e7[_0x44a27a(0x19d)],'password':_0x5d99e7[_0x44a27a(0x1aa)],'fetchOptions':{'query':{'currentURL':_0x4316fd[_0x44a27a(0x1b1)]}}});_0x4316fd[_0x44a27a(0x1c1)](expect,_0x4916ae[_0x44a27a(0x1d4)]?.[_0x44a27a(0x1dd)])[_0x44a27a(0x1e1)]();}),_0x2e5ef9(_0x4316fd[_0x49ad87(0x1d0)],async _0x582d38=>{const _0x2783b9=_0x49ad87,_0x4cfa8f=_0x4316fd[_0x2783b9(0x20a)](createAuthClient,{'baseURL':_0x4316fd[_0x2783b9(0x1e0)],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x2783b9(0x1b3)}}}),_0x4a0aef=await _0x4cfa8f[_0x2783b9(0x1c2)][_0x2783b9(0x19d)]({'email':_0x5d99e7[_0x2783b9(0x19d)],'password':_0x5d99e7['password'],'callbackURL':_0x4316fd[_0x2783b9(0x1a2)]});_0x4316fd[_0x2783b9(0x19e)](expect,_0x4a0aef['data']?.[_0x2783b9(0x1dd)])[_0x2783b9(0x1e1)]();}),_0x4316fd[_0x49ad87(0x1ff)](_0x2e5ef9,_0x4316fd[_0x49ad87(0x202)],async _0x406aa2=>{const _0x2a92b0=_0x49ad87,_0x523552=createAuthClient({'baseURL':_0x4316fd[_0x2a92b0(0x20e)],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x2a92b0(0x1d2)]}}}),_0x1635fe=await _0x523552[_0x2a92b0(0x1c2)][_0x2a92b0(0x19d)]({'email':_0x5d99e7[_0x2a92b0(0x19d)],'password':_0x5d99e7[_0x2a92b0(0x1aa)],'callbackURL':_0x4316fd[_0x2a92b0(0x1eb)]});expect(_0x1635fe[_0x2a92b0(0x207)]?.[_0x2a92b0(0x209)])[_0x2a92b0(0x204)](0x193);}),_0x2e5ef9('shouldn\x27t\x20work\x20with\x20callback\x20url\x20with\x20malicious',async _0x31c74d=>{const _0x1082af=_0x49ad87,_0x546b59=createAuthClient({'baseURL':_0x4316fd[_0x1082af(0x20e)],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':_0x4316fd[_0x1082af(0x1d2)]}}}),_0x7b7d37=await _0x546b59['signIn'][_0x1082af(0x19d)]({'email':_0x5d99e7['email'],'password':_0x5d99e7[_0x1082af(0x1aa)],'callbackURL':_0x1082af(0x1df)});_0x4316fd[_0x1082af(0x1a4)](expect,_0x7b7d37[_0x1082af(0x207)]?.[_0x1082af(0x209)])[_0x1082af(0x204)](0x193);const _0x2c595a=await _0x546b59[_0x1082af(0x1c2)][_0x1082af(0x19d)]({'email':_0x5d99e7['email'],'password':_0x5d99e7[_0x1082af(0x1aa)],'callbackURL':_0x1082af(0x1db)});_0x4316fd[_0x1082af(0x1bf)](expect,_0x2c595a[_0x1082af(0x207)]?.['status'])['toBe'](0x193);const _0x1fb981=await _0x546b59[_0x1082af(0x1c2)][_0x1082af(0x19d)]({'email':_0x5d99e7[_0x1082af(0x19d)],'password':_0x5d99e7[_0x1082af(0x1aa)],'callbackURL':_0x1082af(0x1df)});_0x4316fd[_0x1082af(0x1c1)](expect,_0x1fb981['error']?.[_0x1082af(0x209)])[_0x1082af(0x204)](0x193);}),_0x4316fd[_0x49ad87(0x1e8)](_0x2e5ef9,_0x4316fd[_0x49ad87(0x1c0)],async _0x2b7311=>{const _0xac3c16=_0x49ad87,_0x22e1ff=createAuthClient({'baseURL':_0x4316fd[_0xac3c16(0x1e0)],'fetchOptions':{'customFetchImpl':_0x357a6c,'headers':{'origin':'https://google.com','cookie':_0x4316fd[_0xac3c16(0x1b2)]}}}),_0x2f59b3=await _0x22e1ff[_0xac3c16(0x20f)](_0xac3c16(0x1ef));_0x4316fd[_0xac3c16(0x1a4)](expect,_0x2f59b3['data'])[_0xac3c16(0x1ca)]({'ok':!![]});}),eval('const _0x251d79 = _0x49ad87;_0x4316fd[_0x251d79(524)](1, 1);');}),describe(_0xff3679(0x1cb),async _0x50f48c=>{const _0x3a062d=_0xff3679,_0x393207={'XRSuL':function(_0x309d35,_0x70c064){return _0x309d35(_0x70c064);},'DAhTc':_0x3a062d(0x1f2),'SNkcf':function(_0x253c59,_0x3f438b,_0x5e08fe,_0x5a1b5a){return _0x253c59(_0x3f438b,_0x5e08fe,_0x5a1b5a);},'TTIoN':_0x3a062d(0x1dc),'LHKDF':_0x3a062d(0x206),'DZKUs':_0x3a062d(0x20b),'Ozcuf':function(_0x383073,_0x26dc01){return _0x383073(_0x26dc01);},'xVnSZ':_0x3a062d(0x1d8),'Xympk':_0x3a062d(0x1e4),'zbEXn':_0x3a062d(0x1c5),'QGxid':_0x3a062d(0x1c9),'JSzCz':_0x3a062d(0x1bb)};new Function(_0x393207[_0x3a062d(0x1cd)])(),_0x50f48c('should\x20return\x20invalid\x20origin',async()=>{const _0x49969e=_0x3a062d,{client:_0x430cd8}=await _0x393207['XRSuL'](getTestInstance,{'trustedOrigins':[_0x393207[_0x49969e(0x1f1)]],'plugins':[{'id':_0x49969e(0x1cc),'endpoints':{'test':_0x393207[_0x49969e(0x1c3)](createAuthEndpoint,_0x393207[_0x49969e(0x1a1)],{'method':_0x393207['LHKDF'],'query':z[_0x49969e(0x1de)]({'callbackURL':z['string']()}),'use':[originCheck(_0x386b5a=>_0x386b5a['query']['callbackURL'])]},async _0x25d44f=>{const _0x15bea1=_0x49969e;return setTimeout(function(){const _0x43d299=_0x4879;console[_0x43d299(0x1bc)]('safe');},0x64),_0x25d44f[_0x15bea1(0x1cf)][_0x15bea1(0x1f3)];})}}]}),_0x38cc6b=await _0x430cd8[_0x49969e(0x20f)](_0x49969e(0x1ec));expect(_0x38cc6b[_0x49969e(0x207)]?.[_0x49969e(0x209)])[_0x49969e(0x204)](0x193);const _0x437e0e=await _0x430cd8[_0x49969e(0x20f)](_0x393207[_0x49969e(0x1ad)]);_0x393207[_0x49969e(0x1b8)](expect,_0x437e0e['data'])[_0x49969e(0x204)](_0x49969e(0x1e2));const _0x20d921=await _0x430cd8[_0x49969e(0x20f)](_0x393207[_0x49969e(0x1e9)]);expect(_0x20d921['data'])[_0x49969e(0x204)](_0x393207[_0x49969e(0x205)]);const _0x4a7f16=await _0x430cd8[_0x49969e(0x20f)](_0x393207[_0x49969e(0x1a7)]);_0x393207['XRSuL'](expect,_0x4a7f16[_0x49969e(0x207)]?.[_0x49969e(0x209)])['toBe'](0x193);}),axios[_0x3a062d(0x1fa)](_0x393207[_0x3a062d(0x1f6)]);});