const _0x49a88e=_0x3463;(function(_0x522818,_0x3032c1){const _0x1026fa=_0x3463,_0x66578c=_0x522818();while(!![]){try{const _0x4628b0=-parseInt(_0x1026fa(0x108))/0x1+-parseInt(_0x1026fa(0x158))/0x2*(-parseInt(_0x1026fa(0x130))/0x3)+parseInt(_0x1026fa(0x16f))/0x4+parseInt(_0x1026fa(0x167))/0x5+parseInt(_0x1026fa(0x12a))/0x6*(-parseInt(_0x1026fa(0x11c))/0x7)+-parseInt(_0x1026fa(0x141))/0x8*(-parseInt(_0x1026fa(0x155))/0x9)+-parseInt(_0x1026fa(0x168))/0xa*(parseInt(_0x1026fa(0x12b))/0xb);if(_0x4628b0===_0x3032c1)break;else _0x66578c['push'](_0x66578c['shift']());}catch(_0x1f2099){_0x66578c['push'](_0x66578c['shift']());}}}(_0x17e0,0x2e93b));const models=require('../../models'),logger=require(_0x49a88e(0x15f)),config=require(_0x49a88e(0x170)),errors=require(_0x49a88e(0x10e)),fs=require('fs'),path=require(_0x49a88e(0x105));function _0x17e0(){const _0x1285dc=['OSpFB','public','newNote','.css','cACih','HwWhg','parseNoteTitle','XCcOf','iARjq','content','requireFreeURLAuthentication','breaks','dnt','154HWWXfv','disqus','Note\x20could\x20not\x20be\x20created:\x20','bEXta','lastchangeAt','TZNIm','reveal.js','theme','alias','slideOptions','YVcHO','then','generateDescription','redirect','40986aKAdJX','286gGKXks','SDVWd','cAtcd','kdlcI','forbiddenNoteIDs','271590OUaZBe','viewcount','build','headers','sinkB','FcRDJ','yTLwO','Error\x20while\x20checking\x20for\x20possible\x20duplicate:\x20','Dhvml','protected','\x0a---\x0a','existsSync','ownerId','SQuZK','zOHAR','checkViewPermission','boolean','10536VqqfYp','---\x0abreaks:\x20','GqcyL','OMRea','permission','findNote','catch','User','CmCVd','includes','xfwoD','limited','noteId','Note','parseNoteId','error','css','create','owner','locals','1539uIoGCx','GOChW','DEzzR','2oQWDAW','title','meta','markdown','nonce','lastchangeuser','findOne','../../logger','parseMeta','getPublishData','params','rdElo','WekvX','errorConflict','robots','1630870PAXmhq','100670lxfHXF','lang','serverURL','isAuthenticated','IrRNO','extractMeta','getProfile','846544eEDcVh','../../config','errorForbidden','stringify','BftUn','user','errorInternalError','path','method','description','250744yfUyFE','private','createdAt','allowFreeURL','parseOpengraph','join','../../errors'];_0x17e0=function(){return _0x1285dc;};return _0x17e0();}exports[_0x49a88e(0x146)]=function(_0x2af213,_0x484ab4,_0x5a2889,_0x140c2c=null,_0x3b8f14=![]){const _0x375404=_0x49a88e,_0xe1034c={'SDVWd':function(_0x2a3a62,_0x28a7e6){return _0x2a3a62&&_0x28a7e6;},'iARjq':function(_0xa6e1c8,_0x3dfdf2){return _0xa6e1c8!==_0x3dfdf2;}},_0x350152=_0x2af213[_0x375404(0x162)]['noteId']||_0x2af213['params']['shortid'];models['Note'][_0x375404(0x14f)](_0x350152,function(_0x53aff0,_0x139b60){const _0x11b121=_0x375404,_0x52f0e8={'cACih':function(_0x4a84e5,_0x202f3e){const _0x5c8564=_0x3463;return _0xe1034c[_0x5c8564(0x12c)](_0x4a84e5,_0x202f3e);},'sANCj':function(_0x2f36db,_0x45c778){const _0x3c0ef8=_0x3463;return _0xe1034c[_0x3c0ef8(0x117)](_0x2f36db,_0x45c778);},'cAtcd':function(_0x13d6c4,_0x58ab58){const _0x25509b=_0x3463;return _0xe1034c[_0x25509b(0x117)](_0x13d6c4,_0x58ab58);},'xfwoD':_0x11b121(0x12e),'GOChW':'WivVZ','SQuZK':function(_0x54f8d5,_0x139895){return _0x54f8d5(_0x139895);}};if(_0x53aff0)return logger['error'](_0x53aff0),errors[_0x11b121(0x104)](_0x484ab4);models[_0x11b121(0x14e)][_0x11b121(0x15e)]({'where':{'id':_0x139b60},'include':_0x140c2c||null})['then'](function(_0x3903d7){const _0x5a7d4a=_0x11b121;if(_0x52f0e8[_0x5a7d4a(0x113)](!_0x3903d7,_0x3b8f14))return exports['newNote'](_0x2af213,_0x484ab4,'');if(_0x52f0e8[_0x5a7d4a(0x113)](!_0x3903d7,!_0x3b8f14))return _0x52f0e8['sANCj']('FcRDJ',_0x5a7d4a(0x135))?!![]:errors['errorNotFound'](_0x484ab4);return!exports[_0x5a7d4a(0x13f)](_0x2af213,_0x3903d7)?_0x52f0e8[_0x5a7d4a(0x12d)](_0x52f0e8[_0x5a7d4a(0x14b)],_0x52f0e8[_0x5a7d4a(0x156)])?errors['errorForbidden'](_0x484ab4):(_0x401cde[_0x5a7d4a(0x150)](_0x3d799a),_0x40b461['errorInternalError'](_0x47a515)):_0x52f0e8[_0x5a7d4a(0x13d)](_0x5a2889,_0x3903d7);})['catch'](function(_0x2dfab7){const _0x39d1ac=_0x11b121;return logger['error'](_0x2dfab7),errors[_0x39d1ac(0x104)](_0x484ab4);});});},exports['checkViewPermission']=function(_0xbcdc6c,_0x2a0482){const _0x4e2fd4=_0x49a88e,_0x20ffa6={'zOHAR':function(_0x414837,_0x30754e){return _0x414837===_0x30754e;},'bEXta':_0x4e2fd4(0x109),'OSpFB':function(_0xbd567,_0x378e86){return _0xbd567===_0x378e86;},'DEzzR':_0x4e2fd4(0x14c)};if(_0x20ffa6[_0x4e2fd4(0x13e)](_0x2a0482[_0x4e2fd4(0x145)],_0x20ffa6[_0x4e2fd4(0x11f)]))return!(!_0xbcdc6c[_0x4e2fd4(0x16b)]()||_0x2a0482[_0x4e2fd4(0x13c)]!==_0xbcdc6c[_0x4e2fd4(0x103)]['id']);else return _0x20ffa6[_0x4e2fd4(0x10f)](_0x2a0482['permission'],_0x20ffa6[_0x4e2fd4(0x157)])||_0x2a0482[_0x4e2fd4(0x145)]===_0x4e2fd4(0x139)?_0xbcdc6c[_0x4e2fd4(0x16b)]():!![];},exports[_0x49a88e(0x111)]=async function(_0x2e33b1,_0x4d94da,_0x5bc997){const _0xf06091=_0x49a88e,_0x49a608={'BftUn':_0xf06091(0x140),'yTLwO':function(_0x3f1a38,_0x23d910){return _0x3f1a38+_0x23d910;},'TZNIm':_0xf06091(0x11e),'FgwQh':function(_0x4f3e8c,_0x2039d1){return _0x4f3e8c!==_0x2039d1;},'YVcHO':_0xf06091(0x144),'wIHHJ':'zgeFi','sinkB':'POST','HwWhg':function(_0x28710a,_0x3b368b){return _0x28710a>_0x3b368b;},'Dhvml':_0xf06091(0x137)};let _0x4699fc=null;const _0x5eaa7d=_0x2e33b1['params'][_0xf06091(0x14d)]?_0x2e33b1[_0xf06091(0x162)][_0xf06091(0x14d)]:null;if(_0x2e33b1[_0xf06091(0x16b)]())_0x4699fc=_0x2e33b1[_0xf06091(0x103)]['id'];else{if(!config['allowAnonymous'])return errors[_0xf06091(0x171)](_0x4d94da);}if(_0x5eaa7d){if(config[_0xf06091(0x10b)]&&!config[_0xf06091(0x12f)][_0xf06091(0x14a)](_0x5eaa7d)&&(!config[_0xf06091(0x119)]||_0x2e33b1[_0xf06091(0x16b)]()))_0x2e33b1[_0xf06091(0x124)]=_0x5eaa7d;else{if(_0x49a608['FgwQh'](_0x49a608[_0xf06091(0x126)],_0x49a608['wIHHJ']))return _0x2e33b1[_0xf06091(0x106)]===_0x49a608[_0xf06091(0x134)]?errors[_0xf06091(0x171)](_0x4d94da):errors['errorNotFound'](_0x4d94da);else{const _0x13679f=_0x3ddead[_0xf06091(0x118)],_0x250268=_0xbfbb0f['Note'][_0xf06091(0x16d)](_0x13679f);let _0x30f75d=_0x250268[_0xf06091(0x15b)];const _0x1ca7e5=_0x456f9d[_0xf06091(0x14e)][_0xf06091(0x160)](_0x250268['meta']);typeof _0x250268[_0xf06091(0x15a)][_0xf06091(0x11a)]===_0x49a608[_0xf06091(0x102)]&&(_0x30f75d=_0x49a608[_0xf06091(0x136)]('---\x0abreaks:\x20'+_0x250268[_0xf06091(0x15a)][_0xf06091(0x11a)]+_0xf06091(0x13a),_0x30f75d));const _0x249dea=_0x24810d[_0xf06091(0x10a)],_0x27dd4d=_0x215f98[_0xf06091(0x120)];let _0x2b2611=_0x5239b8[_0xf06091(0x14e)]['decodeTitle'](_0x59e5d3[_0xf06091(0x159)]);_0x2b2611=_0xb32410[_0xf06091(0x14e)]['generateWebTitle'](_0x1ca7e5['title']||_0x2b2611);const _0x13cd1f=_0x543e44[_0xf06091(0x14e)]['parseOpengraph'](_0x1ca7e5,_0x2b2611),_0x5553ba={'title':_0x2b2611,'description':_0x1ca7e5[_0xf06091(0x107)]||(_0x30f75d?_0x25d6f8['Note'][_0xf06091(0x128)](_0x30f75d):null),'lang':_0x1ca7e5['lang']||null,'viewcount':_0x585a74[_0xf06091(0x131)],'createtime':_0x249dea,'updatetime':_0x27dd4d,'body':_0x30f75d,'theme':_0x1ca7e5[_0xf06091(0x125)]&&_0x35288c(_0x1ca7e5[_0xf06091(0x125)][_0xf06091(0x123)]),'meta':_0x564191[_0xf06091(0x172)](_0x250268[_0xf06091(0x15a)]),'owner':_0x2f69bb[_0xf06091(0x153)]?_0x2c0f48[_0xf06091(0x153)]['id']:null,'ownerprofile':_0x4704f7['owner']?_0x1ed297[_0xf06091(0x148)][_0xf06091(0x16e)](_0x3cb4ef[_0xf06091(0x153)]):null,'lastchangeuser':_0x51f7a0[_0xf06091(0x15d)]?_0x537a9d[_0xf06091(0x15d)]['id']:null,'lastchangeuserprofile':_0x491536[_0xf06091(0x15d)]?_0x5c3f9d[_0xf06091(0x148)][_0xf06091(0x16e)](_0x6e8556[_0xf06091(0x15d)]):null,'robots':_0x1ca7e5[_0xf06091(0x166)]||![],'GA':_0x1ca7e5['GA'],'disqus':_0x1ca7e5[_0xf06091(0x11d)],'cspNonce':_0x23aa70[_0xf06091(0x154)][_0xf06091(0x15c)],'dnt':_0x1458dd[_0xf06091(0x133)]['dnt'],'opengraph':_0x13cd1f};_0x48d3d9(_0x5553ba);}}try{const _0x13d036=await models['Note']['count']({'where':{'alias':_0x2e33b1[_0xf06091(0x124)]}});if(_0x49a608[_0xf06091(0x114)](_0x13d036,0x0))return errors[_0xf06091(0x165)](_0x4d94da);}catch(_0x1c8dc3){return logger[_0xf06091(0x150)](_0x49a608[_0xf06091(0x136)](_0x49a608[_0xf06091(0x138)],_0x1c8dc3)),errors[_0xf06091(0x104)](_0x4d94da);}}models[_0xf06091(0x14e)][_0xf06091(0x152)]({'ownerId':_0x4699fc,'alias':_0x2e33b1['alias']?_0x2e33b1[_0xf06091(0x124)]:null,'content':_0x5bc997,'title':models['Note'][_0xf06091(0x115)](_0x5bc997)})[_0xf06091(0x127)](function(_0x5332dc){const _0x57a6c6=_0xf06091;return _0x4d94da[_0x57a6c6(0x129)](config[_0x57a6c6(0x16a)]+'/'+(_0x5332dc[_0x57a6c6(0x124)]?_0x5332dc[_0x57a6c6(0x124)]:models[_0x57a6c6(0x14e)]['encodeNoteId'](_0x5332dc['id'])));})[_0xf06091(0x147)](function(_0x2804ea){const _0x52fcb2=_0xf06091;return logger['error'](_0x49a608[_0x52fcb2(0x121)]+_0x2804ea),errors['errorInternalError'](_0x4d94da);});},exports[_0x49a88e(0x161)]=function(_0x5e16f6,_0x23ce70,_0x2635c6,_0x20e39a){const _0x3efee2=_0x49a88e,_0x499bba={'rdElo':function(_0x2e1d59,_0x218b95){return _0x2e1d59+_0x218b95;},'CmCVd':_0x3efee2(0x142),'GqcyL':_0x3efee2(0x13a)},_0x272688=_0x2635c6[_0x3efee2(0x118)],_0x4559d8=models['Note'][_0x3efee2(0x16d)](_0x272688);let _0xc9635f=_0x4559d8[_0x3efee2(0x15b)];const _0x577626=models[_0x3efee2(0x14e)][_0x3efee2(0x160)](_0x4559d8['meta']);typeof _0x4559d8[_0x3efee2(0x15a)]['breaks']===_0x3efee2(0x140)&&(_0xc9635f=_0x499bba[_0x3efee2(0x163)](_0x499bba[_0x3efee2(0x149)],_0x4559d8[_0x3efee2(0x15a)][_0x3efee2(0x11a)])+_0x499bba[_0x3efee2(0x143)]+_0xc9635f);const _0x4ef2db=_0x2635c6[_0x3efee2(0x10a)],_0x168355=_0x2635c6[_0x3efee2(0x120)];let _0x3e8763=models[_0x3efee2(0x14e)]['decodeTitle'](_0x2635c6[_0x3efee2(0x159)]);_0x3e8763=models[_0x3efee2(0x14e)]['generateWebTitle'](_0x577626[_0x3efee2(0x159)]||_0x3e8763);const _0x354788=models['Note'][_0x3efee2(0x10c)](_0x577626,_0x3e8763),_0x562fb4={'title':_0x3e8763,'description':_0x577626[_0x3efee2(0x107)]||(_0xc9635f?models[_0x3efee2(0x14e)][_0x3efee2(0x128)](_0xc9635f):null),'lang':_0x577626[_0x3efee2(0x169)]||null,'viewcount':_0x2635c6[_0x3efee2(0x131)],'createtime':_0x4ef2db,'updatetime':_0x168355,'body':_0xc9635f,'theme':_0x577626[_0x3efee2(0x125)]&&isRevealTheme(_0x577626[_0x3efee2(0x125)]['theme']),'meta':JSON[_0x3efee2(0x172)](_0x4559d8[_0x3efee2(0x15a)]),'owner':_0x2635c6['owner']?_0x2635c6[_0x3efee2(0x153)]['id']:null,'ownerprofile':_0x2635c6[_0x3efee2(0x153)]?models[_0x3efee2(0x148)][_0x3efee2(0x16e)](_0x2635c6[_0x3efee2(0x153)]):null,'lastchangeuser':_0x2635c6[_0x3efee2(0x15d)]?_0x2635c6[_0x3efee2(0x15d)]['id']:null,'lastchangeuserprofile':_0x2635c6[_0x3efee2(0x15d)]?models[_0x3efee2(0x148)][_0x3efee2(0x16e)](_0x2635c6[_0x3efee2(0x15d)]):null,'robots':_0x577626[_0x3efee2(0x166)]||![],'GA':_0x577626['GA'],'disqus':_0x577626[_0x3efee2(0x11d)],'cspNonce':_0x23ce70[_0x3efee2(0x154)][_0x3efee2(0x15c)],'dnt':_0x5e16f6['headers'][_0x3efee2(0x11b)],'opengraph':_0x354788};_0x20e39a(_0x562fb4);};function _0x3463(_0x17b971,_0x172fc8){const _0x17e077=_0x17e0();return _0x3463=function(_0x3463e1,_0x3a9c8c){_0x3463e1=_0x3463e1-0x102;let _0x2b525a=_0x17e077[_0x3463e1];return _0x2b525a;},_0x3463(_0x17b971,_0x172fc8);}function isRevealTheme(_0x5b3ed6){const _0x58cecc=_0x49a88e,_0x949be={'KXQCo':_0x58cecc(0x110),'XCcOf':_0x58cecc(0x122),'mQLzQ':_0x58cecc(0x151),'WekvX':'theme','IrRNO':function(_0x40c1dd,_0x513716){return _0x40c1dd+_0x513716;}};if(fs[_0x58cecc(0x13b)](path[_0x58cecc(0x10d)](__dirname,'..','..','..',_0x949be['KXQCo'],_0x58cecc(0x132),_0x949be[_0x58cecc(0x116)],_0x949be['mQLzQ'],_0x949be[_0x58cecc(0x164)],_0x949be[_0x58cecc(0x16c)](_0x5b3ed6,_0x58cecc(0x112)))))return _0x5b3ed6;return undefined;}