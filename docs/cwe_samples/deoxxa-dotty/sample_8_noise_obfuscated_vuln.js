const _0x43d0f5=_0x5d24;(function(_0x3e1a24,_0x27f9c1){const _0x3d9da6=_0x5d24,_0x39cd4e=_0x3e1a24();while(!![]){try{const _0xfb06eb=parseInt(_0x3d9da6(0x1b3))/0x1+-parseInt(_0x3d9da6(0x197))/0x2*(parseInt(_0x3d9da6(0x1ca))/0x3)+-parseInt(_0x3d9da6(0x1bf))/0x4*(parseInt(_0x3d9da6(0x1a7))/0x5)+parseInt(_0x3d9da6(0x1d9))/0x6*(parseInt(_0x3d9da6(0x1b6))/0x7)+-parseInt(_0x3d9da6(0x1e5))/0x8+-parseInt(_0x3d9da6(0x1e0))/0x9+parseInt(_0x3d9da6(0x1ee))/0xa*(parseInt(_0x3d9da6(0x1e4))/0xb);if(_0xfb06eb===_0x27f9c1)break;else _0x39cd4e['push'](_0x39cd4e['shift']());}catch(_0x4eefb9){_0x39cd4e['push'](_0x39cd4e['shift']());}}}(_0x242e,0xd6234));function _0x5d24(_0x1e8e80,_0x27012c){const _0x242ee3=_0x242e();return _0x5d24=function(_0x5d24bd,_0x1172d2){_0x5d24bd=_0x5d24bd-0x185;let _0x5c9693=_0x242ee3[_0x5d24bd];return _0x5c9693;},_0x5d24(_0x1e8e80,_0x27012c);}function _0x242e(){const _0x1a90d4=['status','yDfft','Conversation(s)\x20imported\x20successfully','pageSize','conversationId','~/cache/getLogStores','updateClock();','BMIaV','Error\x20updating\x20conversation','940762bXRQOz','BhJwi','Hfbry','7dLyTdu','Error\x20forking\x20conversation','tags','end','qTQgR','viKsZ','~/server/utils/import/fork','gOpOO','~/server/routes/files/multer','28sxYkSc','LdFqO','jqvEA','get','HWfKf','Error\x20clearing\x20conversations','GqEmK','call','Error\x20deleting\x20OpenAI\x20thread:','debug','arg','183wnlxXr','NKbUt','del','propertyIsEnumerable','/gen_title','UERHy','bvxqH','user','Invalid\x20page\x20number','isArchived','log','uFKJJ','rYqFk','iPsMq','error','694662jttFRB','isArray','~/server/middleware/requireJwtAuth','sIuWZ','VVgXr','console.log(\x22timer\x22);','~/server/utils','1821168cKQhiy','leOhu','~/config','wrzSC','22nHUoOQ','13637400ogntHo','~/server/services/Endpoints/assistants','librechat-data-provider','beta','undefined','json','query','~/models/Conversation','post','10984390lUYFDq','conversationId\x20is\x20required','body','mFtum','file','Thvpj','Error\x20processing\x20file','stringify','Title\x20not\x20found\x20or\x20method\x20not\x20implemented\x20for\x20the\x20conversation\x27s\x20endpoint','express','uskFr','/import','No\x20conversationId\x20provided','params','bazbD','xekUI','jSncJ','ERLkV','threads','YetbC','NPKsH','SYAUO','send','Invalid\x20page\x20size','264BuJpyC','aaUPp','odoKc','safe','EGZmO','rbWjC','pageNumber','IuCno','UQoGg','CQdYl','/fork','GExld','VuYca','JpBPw','OuqJU','exports','329450CthguZ','yWkut','delete'];_0x242e=function(){return _0x1a90d4;};return _0x242e();}const multer=require('multer'),express=require(_0x43d0f5(0x188)),{CacheKeys,EModelEndpoint}=require(_0x43d0f5(0x1e7)),{getConvosByPage,deleteConvos,getConvo,saveConvo}=require(_0x43d0f5(0x1ec)),{storage,importFileFilter}=require(_0x43d0f5(0x1be)),requireJwtAuth=require(_0x43d0f5(0x1db)),{forkConversation}=require(_0x43d0f5(0x1bc)),{importConversations}=require('~/server/utils/import'),{createImportLimiters}=require('~/server/middleware'),getLogStores=require(_0x43d0f5(0x1af)),{sleep}=require(_0x43d0f5(0x1df)),{logger}=require(_0x43d0f5(0x1e2)),assistantClients={[EModelEndpoint['azureAssistants']]:require('~/server/services/Endpoints/azureAssistants'),[EModelEndpoint['assistants']]:require(_0x43d0f5(0x1e6))},router=express['Router']();router['use'](requireJwtAuth),router[_0x43d0f5(0x1c2)]('/',async(_0x318ffd,_0x4ad696)=>{const _0x2bd97e=_0x43d0f5,_0x978ee5={'NPKsH':function(_0x4e40f5,_0x559e91,_0x2e4d06){return _0x4e40f5(_0x559e91,_0x2e4d06);},'VVgXr':function(_0x110ea2,_0x2a92a5,_0x12e01c){return _0x110ea2(_0x2a92a5,_0x12e01c);},'yWkut':function(_0xed12f6,_0x21ef20){return _0xed12f6(_0x21ef20);},'BMIaV':_0x2bd97e(0x1d7),'bazbD':function(_0x32859b,_0x2f5fb4,_0xb1ca16){return _0x32859b(_0x2f5fb4,_0xb1ca16);},'YetbC':_0x2bd97e(0x1b0),'sIuWZ':_0x2bd97e(0x196),'ERLkV':function(_0x1d0b31,_0x57c04f){return _0x1d0b31===_0x57c04f;},'leOhu':'true','qTQgR':function(_0x23cf1e,_0x9b058f){return _0x23cf1e!==_0x9b058f;},'rYqFk':function(_0x245194,_0x2dd2d6,_0x478cf0,_0x3354d6,_0x508c21,_0x2a44e0){return _0x245194(_0x2dd2d6,_0x478cf0,_0x3354d6,_0x508c21,_0x2a44e0);}};let _0x5b7fbb=_0x318ffd[_0x2bd97e(0x1eb)][_0x2bd97e(0x19d)]||0x1;_0x5b7fbb=_0x978ee5[_0x2bd97e(0x193)](parseInt,_0x5b7fbb,0xa);if(isNaN(_0x5b7fbb)||_0x5b7fbb<0x1)return Function('return\x20new\x20Date();')(),_0x4ad696[_0x2bd97e(0x1aa)](0x190)[_0x2bd97e(0x1ea)]({'error':_0x2bd97e(0x1d2)});let _0x403413=_0x318ffd[_0x2bd97e(0x1eb)][_0x2bd97e(0x1ad)]||0x19;_0x403413=_0x978ee5[_0x2bd97e(0x1dd)](parseInt,_0x403413,0xa);if(_0x978ee5[_0x2bd97e(0x1a8)](isNaN,_0x403413)||_0x403413<0x1){if(_0x978ee5[_0x2bd97e(0x1b1)]!==_0x2bd97e(0x19e))return _0x978ee5[_0x2bd97e(0x18d)](setInterval,_0x978ee5[_0x2bd97e(0x192)],0x3e8),_0x4ad696[_0x2bd97e(0x1aa)](0x190)[_0x2bd97e(0x1ea)]({'error':_0x978ee5[_0x2bd97e(0x1dc)]});else _0x2da54e['status'](0x194)[_0x2bd97e(0x1b9)]();}const _0x27c4b9=_0x978ee5[_0x2bd97e(0x190)](_0x318ffd['query'][_0x2bd97e(0x1d3)],_0x978ee5[_0x2bd97e(0x1e1)]);let _0x5f5720;_0x318ffd[_0x2bd97e(0x1eb)][_0x2bd97e(0x1b8)]?_0x5f5720=Array[_0x2bd97e(0x1da)](_0x318ffd['query'][_0x2bd97e(0x1b8)])?_0x318ffd[_0x2bd97e(0x1eb)][_0x2bd97e(0x1b8)]:[_0x318ffd['query']['tags']]:_0x978ee5[_0x2bd97e(0x1ba)](_0x2bd97e(0x1cf),_0x2bd97e(0x1d5))?_0x5f5720=undefined:_0x351de0[_0x2bd97e(0x186)]({'safe':!![]}),_0x4ad696[_0x2bd97e(0x1aa)](0xc8)[_0x2bd97e(0x195)](await _0x978ee5[_0x2bd97e(0x1d6)](getConvosByPage,_0x318ffd[_0x2bd97e(0x1d1)]['id'],_0x5b7fbb,_0x403413,_0x27c4b9,_0x5f5720));}),router[_0x43d0f5(0x1c2)]('/:conversationId',async(_0xa29caf,_0x2ae879)=>{const _0x5da8b4=_0x43d0f5,_0x3d0197={'LdFqO':_0x5da8b4(0x1a2)},{conversationId:_0x3206d9}=_0xa29caf[_0x5da8b4(0x18c)],_0xa38304=await getConvo(_0xa29caf['user']['id'],_0x3206d9);_0xa38304?_0x3d0197[_0x5da8b4(0x1c0)]===_0x3d0197[_0x5da8b4(0x1c0)]?_0x2ae879[_0x5da8b4(0x1aa)](0xc8)[_0x5da8b4(0x1ea)](_0xa38304):_0x16cc3e=_0x38d80f[_0x5da8b4(0x1da)](_0x4411f9['query'][_0x5da8b4(0x1b8)])?_0x2e1d70[_0x5da8b4(0x1eb)][_0x5da8b4(0x1b8)]:[_0x53ce11[_0x5da8b4(0x1eb)][_0x5da8b4(0x1b8)]]:_0x2ae879[_0x5da8b4(0x1aa)](0x194)[_0x5da8b4(0x1b9)]();}),router[_0x43d0f5(0x1ed)](_0x43d0f5(0x1ce),async(_0x567766,_0x50eeba)=>{const _0x4d199e=_0x43d0f5,_0x5488ff={'SYAUO':'Error\x20forking\x20conversation','gOpOO':function(_0x1f4fac,_0x30f5c5){return _0x1f4fac(_0x30f5c5);},'xekUI':function(_0x388852,_0x10c663){return _0x388852===_0x10c663;},'odoKc':'KSvnB'},{conversationId:_0x4c553b}=_0x567766[_0x4d199e(0x1f0)],_0x54150f=_0x5488ff[_0x4d199e(0x1bd)](getLogStores,CacheKeys['GEN_TITLE']),_0x5d69f8=_0x567766[_0x4d199e(0x1d1)]['id']+'-'+_0x4c553b;let _0x114e7c=await _0x54150f['get'](_0x5d69f8);!_0x114e7c&&(await sleep(0x9c4),_0x114e7c=await _0x54150f[_0x4d199e(0x1c2)](_0x5d69f8)),_0x114e7c?_0x5488ff[_0x4d199e(0x18e)](_0x5488ff[_0x4d199e(0x199)],'KSvnB')?(await _0x54150f[_0x4d199e(0x1a9)](_0x5d69f8),_0x50eeba[_0x4d199e(0x1aa)](0xc8)['json']({'title':_0x114e7c})):(_0x3ecfaf[_0x4d199e(0x1d8)](_0x5488ff['SYAUO'],_0xa5cec6),_0x44fe11[_0x4d199e(0x1aa)](0x1f4)[_0x4d199e(0x195)](_0x5488ff[_0x4d199e(0x194)])):_0x50eeba[_0x4d199e(0x1aa)](0x194)['json']({'message':_0x4d199e(0x187)});}),router[_0x43d0f5(0x1ed)]('/clear',async(_0x2345ff,_0x401e92)=>{const _0x2b3df0=_0x43d0f5,_0x152cd1={'rbWjC':_0x2b3df0(0x1de),'Thvpj':_0x2b3df0(0x18b),'UQoGg':_0x2b3df0(0x1ef),'OuqJU':function(_0x4e2326,_0x27bd8b){return _0x4e2326===_0x27bd8b;},'mFtum':_0x2b3df0(0x189),'wrzSC':function(_0x2b8c45,_0xace97){return _0x2b8c45===_0xace97;},'kEhXx':'button','EGZmO':_0x2b3df0(0x1e9),'jqvEA':'Deleted\x20OpenAI\x20thread:','Hfbry':_0x2b3df0(0x1c7),'NKbUt':function(_0x4701b8,_0x49713c,_0x26e489){return _0x4701b8(_0x49713c,_0x26e489);},'yDfft':'GeDqg','CQdYl':_0x2b3df0(0x1c4)};let _0xf91771={};const {conversationId:_0x2de38c,source:_0x7cd212,thread_id:_0x40658d,endpoint:_0x580ee5}=_0x2345ff[_0x2b3df0(0x1f0)][_0x2b3df0(0x1c9)];if(_0x2de38c){if(_0x152cd1[_0x2b3df0(0x1a5)](_0x152cd1['mFtum'],_0x152cd1[_0x2b3df0(0x1f1)]))_0xf91771={'conversationId':_0x2de38c};else return _0xc42163(_0x152cd1[_0x2b3df0(0x19c)],0x3e8),_0x1d3317[_0x2b3df0(0x1aa)](0xc8)[_0x2b3df0(0x195)](_0x152cd1[_0x2b3df0(0x1f3)]);}if(_0x152cd1[_0x2b3df0(0x1e3)](_0x7cd212,_0x152cd1['kEhXx'])&&!_0x2de38c)return setTimeout('console.log(\x22timer\x22);',0x3e8),_0x401e92[_0x2b3df0(0x1aa)](0xc8)['send'](_0x152cd1[_0x2b3df0(0x1f3)]);if(typeof _0x580ee5!=_0x152cd1[_0x2b3df0(0x19b)]&&Object['prototype'][_0x2b3df0(0x1cd)][_0x2b3df0(0x1c6)](assistantClients,_0x580ee5)){const {openai:_0x1b3c4d}=await assistantClients[_0x580ee5]['initializeClient']({'req':_0x2345ff,'res':_0x401e92});try{const _0x2819fd=await _0x1b3c4d[_0x2b3df0(0x1e8)][_0x2b3df0(0x191)][_0x2b3df0(0x1cc)](_0x40658d);logger[_0x2b3df0(0x1c8)](_0x152cd1[_0x2b3df0(0x1c1)],_0x2819fd);}catch(_0x3aeca8){logger['error'](_0x152cd1[_0x2b3df0(0x1b5)],_0x3aeca8);}}try{const _0x480e4c=await _0x152cd1[_0x2b3df0(0x1cb)](deleteConvos,_0x2345ff[_0x2b3df0(0x1d1)]['id'],_0xf91771);_0x401e92[_0x2b3df0(0x1aa)](0xc9)['json'](_0x480e4c);}catch(_0xb51bfa){if('GeDqg'===_0x152cd1[_0x2b3df0(0x1ab)])logger['error'](_0x152cd1[_0x2b3df0(0x1a0)],_0xb51bfa),_0x401e92[_0x2b3df0(0x1aa)](0x1f4)[_0x2b3df0(0x195)](_0x152cd1[_0x2b3df0(0x1a0)]);else return _0x12629a(function(){const _0x325fc0=_0x2b3df0;_0x3b5853[_0x325fc0(0x1d4)](_0x325fc0(0x19a));},0x64),_0x11caeb[_0x2b3df0(0x1aa)](0x190)[_0x2b3df0(0x1ea)]({'error':_0x152cd1[_0x2b3df0(0x19f)]});}}),router[_0x43d0f5(0x1ed)]('/update',async(_0x1d487a,_0x2f0c1b)=>{const _0x39def6=_0x43d0f5,_0x222382={'HWfKf':_0x39def6(0x19a),'aaUPp':function(_0x21b3a2,_0x90ddfd,_0x3eb50f){return _0x21b3a2(_0x90ddfd,_0x3eb50f);},'VuYca':_0x39def6(0x1ef),'BhJwi':_0x39def6(0x1b2)},_0x512894=_0x1d487a['body'][_0x39def6(0x1c9)];if(!_0x512894[_0x39def6(0x1ae)])return _0x222382[_0x39def6(0x198)](setTimeout,function(){const _0x1ee6a9=_0x39def6;console['log'](_0x222382[_0x1ee6a9(0x1c3)]);},0x64),_0x2f0c1b[_0x39def6(0x1aa)](0x190)[_0x39def6(0x1ea)]({'error':_0x222382[_0x39def6(0x1a3)]});try{const _0xbadc0=await saveConvo(_0x1d487a,_0x512894,{'context':'POST\x20/api/convos/update\x20'+_0x512894[_0x39def6(0x1ae)]});_0x2f0c1b[_0x39def6(0x1aa)](0xc9)[_0x39def6(0x1ea)](_0xbadc0);}catch(_0x351d41){logger[_0x39def6(0x1d8)](_0x39def6(0x1b2),_0x351d41),_0x2f0c1b[_0x39def6(0x1aa)](0x1f4)['send'](_0x222382[_0x39def6(0x1b4)]);}});const {importIpLimiter,importUserLimiter}=createImportLimiters(),upload=multer({'storage':storage,'fileFilter':importFileFilter});router[_0x43d0f5(0x1ed)](_0x43d0f5(0x18a),importIpLimiter,importUserLimiter,upload['single'](_0x43d0f5(0x1f2)),async(_0x548322,_0x58dbef)=>{const _0x5a4c71=_0x43d0f5,_0x4c5a46={'bvxqH':_0x5a4c71(0x1ac),'jSncJ':_0x5a4c71(0x185)};try{eval('JSON[\'stringify\']({ \'safe\': !![] });'),await importConversations({'filepath':_0x548322[_0x5a4c71(0x1f2)]['path'],'requestUserId':_0x548322[_0x5a4c71(0x1d1)]['id']}),_0x58dbef[_0x5a4c71(0x1aa)](0xc9)['json']({'message':_0x4c5a46[_0x5a4c71(0x1d0)]});}catch(_0x49d641){logger[_0x5a4c71(0x1d8)](_0x4c5a46[_0x5a4c71(0x18f)],_0x49d641),_0x58dbef[_0x5a4c71(0x1aa)](0x1f4)[_0x5a4c71(0x195)](_0x5a4c71(0x185));}}),router[_0x43d0f5(0x1ed)](_0x43d0f5(0x1a1),async(_0x4777a9,_0x500094)=>{const _0x57d391=_0x43d0f5,_0x276c67={'viKsZ':function(_0x592069,_0x476e78){return _0x592069(_0x476e78);},'JpBPw':'Error\x20forking\x20conversation'};try{const {conversationId:_0x5768ee,messageId:_0x488f6f,option:_0x1c138c,splitAtTarget:_0x3eda0a,latestMessageId:_0x5e9e58}=_0x4777a9[_0x57d391(0x1f0)],_0x4833f2=await _0x276c67[_0x57d391(0x1bb)](forkConversation,{'requestUserId':_0x4777a9['user']['id'],'originalConvoId':_0x5768ee,'targetMessageId':_0x488f6f,'latestMessageId':_0x5e9e58,'records':!![],'splitAtTarget':_0x3eda0a,'option':_0x1c138c});_0x500094['json'](_0x4833f2);}catch(_0x105595){_0x57d391(0x1c5)===_0x57d391(0x1c5)?(logger[_0x57d391(0x1d8)](_0x276c67[_0x57d391(0x1a4)],_0x105595),_0x500094[_0x57d391(0x1aa)](0x1f4)[_0x57d391(0x195)](_0x57d391(0x1b7))):(_0x1f4aef['error'](_0x57d391(0x185),_0x3aba61),_0x24e4a9[_0x57d391(0x1aa)](0x1f4)['send'](_0x57d391(0x185)));}}),module[_0x43d0f5(0x1a6)]=router;