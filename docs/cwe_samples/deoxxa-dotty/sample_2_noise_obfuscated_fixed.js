const _0x6a2b65=_0x4e9f;function _0x4e9f(_0x1ebbd5,_0x3e8f3d){const _0x46ff66=_0x46ff();return _0x4e9f=function(_0x4e9f29,_0x28b211){_0x4e9f29=_0x4e9f29-0x1c3;let _0x11fbe0=_0x46ff66[_0x4e9f29];return _0x11fbe0;},_0x4e9f(_0x1ebbd5,_0x3e8f3d);}(function(_0x3b29a8,_0x2fa0ee){const _0x497720=_0x4e9f,_0x359e2a=_0x3b29a8();while(!![]){try{const _0x800ae0=parseInt(_0x497720(0x1ff))/0x1*(-parseInt(_0x497720(0x1d4))/0x2)+parseInt(_0x497720(0x1fd))/0x3+-parseInt(_0x497720(0x1d0))/0x4*(parseInt(_0x497720(0x1c4))/0x5)+parseInt(_0x497720(0x1ec))/0x6+-parseInt(_0x497720(0x1e1))/0x7*(-parseInt(_0x497720(0x1f0))/0x8)+parseInt(_0x497720(0x1c8))/0x9*(-parseInt(_0x497720(0x1ed))/0xa)+-parseInt(_0x497720(0x1f5))/0xb*(-parseInt(_0x497720(0x1cf))/0xc);if(_0x800ae0===_0x2fa0ee)break;else _0x359e2a['push'](_0x359e2a['shift']());}catch(_0x2398af){_0x359e2a['push'](_0x359e2a['shift']());}}}(_0x46ff,0xefba0));const {ErrorTypes,EModelEndpoint,resolveHeaders,mapModelToAzureConfig}=require('librechat-data-provider'),{getUserKeyValues,checkUserKeyExpiry}=require(_0x6a2b65(0x1e7)),{getLLMConfig}=require(_0x6a2b65(0x1d3)),{isEnabled,isUserProvided}=require('~/server/utils'),{getAzureCredentials}=require('~/utils'),{OpenAIClient}=require(_0x6a2b65(0x1da)),initializeClient=async({req:_0xab603e,res:_0x4ffa05,endpointOption:_0x175fa9,optionsOnly:_0x5788d6,overrideEndpoint:_0xd0f163,overrideModel:_0x116945})=>{const _0x59a634=_0x6a2b65,_0x337677={'SMCef':_0x59a634(0x1ee),'pUDWe':function(_0x33cdb1,_0x335819,_0x567312){return _0x33cdb1(_0x335819,_0x567312);},'TewtJ':_0x59a634(0x1fb),'gupDa':function(_0x1f4908,_0x30c61a){return _0x1f4908(_0x30c61a);},'qsbXV':function(_0x4839bc,_0x3a753e){return _0x4839bc||_0x3a753e;},'XTBev':function(_0x16d795,_0x4d6fe9){return _0x16d795??_0x4d6fe9;},'WKpfL':'quBJK','HiYzU':_0x59a634(0x1ef),'Zeuxn':function(_0x3445d0,_0x39e7ad){return _0x3445d0&&_0x39e7ad;},'qgltn':function(_0x52698c,_0x204bc2){return _0x52698c===_0x204bc2;},'mKfNL':function(_0xa56ac8){return _0xa56ac8();},'hoqPr':function(_0x20e9c6,_0x1c7e23){return _0x20e9c6&_0x1c7e23;},'JmRzl':function(_0x4e246b,_0x1b5837,_0x5c0574){return _0x4e246b(_0x1b5837,_0x5c0574);},'IvRMx':function(_0x1aeb8f,_0x445320,_0x231973){return _0x1aeb8f(_0x445320,_0x231973);}},{PROXY:_0x2cc7c4,OPENAI_API_KEY:_0x2831d9,AZURE_API_KEY:_0x57ad89,OPENAI_REVERSE_PROXY:_0x529470,AZURE_OPENAI_BASEURL:_0xe040f8,OPENAI_SUMMARIZE:_0x13fec5,DEBUG_OPENAI:_0x2fb38e}=process[_0x59a634(0x1e6)],{key:_0x357bca}=_0xab603e[_0x59a634(0x1e0)],_0x4e9552=_0x116945??_0xab603e[_0x59a634(0x1e0)]['model'],_0x5b1b62=_0xd0f163??_0xab603e['body'][_0x59a634(0x203)],_0x2ae6c2=isEnabled(_0x13fec5)?_0x337677[_0x59a634(0x1c7)]:null,_0x5d3f9c={[EModelEndpoint[_0x59a634(0x1de)]]:_0x2831d9,[EModelEndpoint[_0x59a634(0x1ce)]]:_0x57ad89},_0x572d8c={[EModelEndpoint[_0x59a634(0x1de)]]:_0x529470,[EModelEndpoint[_0x59a634(0x1ce)]]:_0xe040f8},_0x3f9047=_0x337677[_0x59a634(0x1e2)](isUserProvided,_0x5d3f9c[_0x5b1b62]),_0x1619de=_0x337677[_0x59a634(0x1e2)](isUserProvided,_0x572d8c[_0x5b1b62]);let _0x162ef1=null;if(_0x357bca&&_0x337677[_0x59a634(0x1cd)](_0x3f9047,_0x1619de)){if(_0x59a634(0x1e3)===_0x59a634(0x1e3))checkUserKeyExpiry(_0x357bca,_0x5b1b62),_0x162ef1=await getUserKeyValues({'userId':_0xab603e[_0x59a634(0x202)]['id'],'name':_0x5b1b62});else throw new _0x495696(_0x213d24+_0x59a634(0x1f4));}let _0x3f1adb=_0x3f9047?_0x162ef1?.[_0x59a634(0x1f1)]:_0x5d3f9c[_0x5b1b62],_0x5423d8=_0x1619de?_0x162ef1?.[_0x59a634(0x1c9)]:_0x572d8c[_0x5b1b62];const _0x1b1398={'contextStrategy':_0x2ae6c2,'proxy':_0x337677[_0x59a634(0x1e9)](_0x2cc7c4,null),'debug':isEnabled(_0x2fb38e),'reverseProxyUrl':_0x5423d8?_0x5423d8:null,..._0x175fa9},_0x54c07f=_0x5b1b62===EModelEndpoint[_0x59a634(0x1ce)],_0x3af1c9=_0x54c07f&&_0xab603e[_0x59a634(0x1e4)]['locals'][EModelEndpoint[_0x59a634(0x1ce)]];if(_0x54c07f&&_0x3af1c9){if(_0x59a634(0x201)===_0x337677[_0x59a634(0x1f6)])_0x1786be[_0x59a634(0x1d5)]=_0x3a37ed[_0x59a634(0x1d5)];else{const {modelGroupMap:_0xbf1ff1,groupMap:_0x45c6d2}=_0x3af1c9,{azureOptions:_0x376530,baseURL:_0x4e56db,headers:headers={},serverless:_0x4fe32a}=_0x337677['gupDa'](mapModelToAzureConfig,{'modelName':_0x4e9552,'modelGroupMap':_0xbf1ff1,'groupMap':_0x45c6d2});_0x1b1398[_0x59a634(0x200)]=_0x4e56db??_0x1b1398[_0x59a634(0x200)],_0x1b1398[_0x59a634(0x1d7)]=resolveHeaders({...headers,..._0x1b1398['headers']??{}}),_0x1b1398[_0x59a634(0x1fa)]=_0x3af1c9[_0x59a634(0x1fa)],_0x1b1398[_0x59a634(0x1dc)]=_0x3af1c9['titleModel'];const _0x31678e=_0x4e9552[_0x59a634(0x1cc)](_0x337677[_0x59a634(0x1c5)])?0x1e:0x11;_0x1b1398[_0x59a634(0x1d5)]=_0x3af1c9[_0x59a634(0x1d5)]??_0x31678e,_0x1b1398[_0x59a634(0x1c3)]=_0x3af1c9[_0x59a634(0x1c3)]??_0x59a634(0x1ea);const _0x2bb667=_0xbf1ff1[_0x4e9552]['group'];_0x1b1398[_0x59a634(0x1f2)]=_0x3af1c9[_0x59a634(0x1f9)][_0x2bb667][_0x59a634(0x1f2)],_0x1b1398['dropParams']=_0x3af1c9[_0x59a634(0x1f9)][_0x2bb667]['dropParams'],_0x1b1398[_0x59a634(0x1fc)]=_0x3af1c9['groupMap'][_0x2bb667]['forcePrompt'],_0x3f1adb=_0x376530[_0x59a634(0x1eb)],_0x1b1398[_0x59a634(0x1d9)]=_0x337677['Zeuxn'](!_0x4fe32a,_0x376530);if(_0x337677[_0x59a634(0x1fe)](_0x4fe32a,!![])){if(_0x337677[_0x59a634(0x1fe)](_0x59a634(0x1d2),_0x59a634(0x1d6))){const _0x27dba3=_0x196474[_0x59a634(0x1d1)]({'modelOptions':_0x3f2007[_0x59a634(0x1e8)]},_0x198b43);return _0x2ae5b4(_0x337677[_0x59a634(0x1ca)],0x3e8),_0x337677['pUDWe'](_0xc8138a,_0x25f76d,_0x27dba3);}else _0x1b1398[_0x59a634(0x1d8)]=_0x376530[_0x59a634(0x1f8)]?{'api-version':_0x376530[_0x59a634(0x1f8)]}:undefined,_0x1b1398[_0x59a634(0x1d7)][_0x59a634(0x1db)]=_0x3f1adb;}}}else _0x54c07f&&(_0x1b1398[_0x59a634(0x1d9)]=_0x3f9047?JSON[_0x59a634(0x1cb)](_0x162ef1[_0x59a634(0x1f1)]):_0x337677['mKfNL'](getAzureCredentials),_0x3f1adb=_0x1b1398['azure'][_0x59a634(0x1eb)]);const _0xa9d8ac=_0xab603e['app'][_0x59a634(0x1c6)][EModelEndpoint['openAI']];!_0x54c07f&&_0xa9d8ac&&(_0x1b1398[_0x59a634(0x1d5)]=_0xa9d8ac['streamRate']);const _0x207d12=_0xab603e[_0x59a634(0x1e4)]['locals'][_0x59a634(0x1e5)];_0x207d12&&(_0x1b1398[_0x59a634(0x1d5)]=_0x207d12['streamRate']);if(_0x337677['hoqPr'](_0x3f9047,!_0x3f1adb))throw new Error(JSON['stringify']({'type':ErrorTypes['NO_USER_KEY']}));if(!_0x3f1adb)throw new Error(_0x5b1b62+_0x59a634(0x1f4));if(_0x5788d6){const _0x28e71a=Object[_0x59a634(0x1d1)]({'modelOptions':_0x175fa9['model_parameters']},_0x1b1398);return _0x337677[_0x59a634(0x1df)](setTimeout,_0x59a634(0x1ee),0x3e8),_0x337677[_0x59a634(0x1f3)](getLLMConfig,_0x3f1adb,_0x28e71a);}const _0x5e2602=new OpenAIClient(_0x3f1adb,Object[_0x59a634(0x1d1)]({'req':_0xab603e,'res':_0x4ffa05},_0x1b1398));return _0x337677[_0x59a634(0x1e2)](Function,_0x59a634(0x1dd))(),{'client':_0x5e2602,'openAIApiKey':_0x3f1adb};};module[_0x6a2b65(0x1f7)]=initializeClient;function _0x46ff(){const _0x678cea=['HKaDS','headers','defaultQuery','azure','~/app','api-key','titleModel','return\x20Object.keys({a:1});','openAI','JmRzl','body','21259jfYIKu','gupDa','Zylex','app','all','env','~/server/services/UserService','model_parameters','XTBev','completion','azureOpenAIApiKey','4179468BnHVQD','229590wttGpL','console.log(\x22timer\x22);','gpt-4','1520ZDKpeU','apiKey','addParams','IvRMx','\x20API\x20Key\x20not\x20provided.','286UxGBft','WKpfL','exports','azureOpenAIApiVersion','groupMap','titleConvo','summarize','forcePrompt','2406666zhCXcQ','qgltn','3103CgTwJH','reverseProxyUrl','yUvbB','user','endpoint','titleMethod','195qnThQU','HiYzU','locals','TewtJ','576VCdaZs','baseURL','SMCef','parse','includes','qsbXV','azureOpenAI','1280028WsBGso','142508bqHYiw','assign','SCnzB','~/server/services/Endpoints/openAI/llm','650knreHM','streamRate'];_0x46ff=function(){return _0x678cea;};return _0x46ff();}