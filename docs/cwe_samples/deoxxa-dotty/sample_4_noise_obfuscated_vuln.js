const _0x39b34d=_0x4838;(function(_0x55be3f,_0x11869c){const _0x188c8f=_0x4838,_0x2d69ae=_0x55be3f();while(!![]){try{const _0x5baa99=-parseInt(_0x188c8f(0x1ef))/0x1+parseInt(_0x188c8f(0x1bc))/0x2*(parseInt(_0x188c8f(0x1e8))/0x3)+-parseInt(_0x188c8f(0x1db))/0x4*(-parseInt(_0x188c8f(0x1c4))/0x5)+-parseInt(_0x188c8f(0x1d7))/0x6+parseInt(_0x188c8f(0x1de))/0x7+-parseInt(_0x188c8f(0x1d3))/0x8+parseInt(_0x188c8f(0x1dd))/0x9;if(_0x5baa99===_0x11869c)break;else _0x2d69ae['push'](_0x2d69ae['shift']());}catch(_0xb58463){_0x2d69ae['push'](_0x2d69ae['shift']());}}}(_0x22a0,0xe56ae));function _0x4838(_0x5dd9e7,_0x537a73){const _0x22a0fd=_0x22a0();return _0x4838=function(_0x4838cf,_0x3ee014){_0x4838cf=_0x4838cf-0x1bc;let _0xc70a71=_0x22a0fd[_0x4838cf];return _0xc70a71;},_0x4838(_0x5dd9e7,_0x537a73);}const {Constants}=require('librechat-data-provider'),{createAbortController,handleAbortError}=require(_0x39b34d(0x1c1)),{sendMessage}=require(_0x39b34d(0x1d0)),{saveMessage}=require(_0x39b34d(0x1e7)),{logger}=require('~/config'),AgentController=async(_0x3c51e3,_0x5a7d89,_0x41a2ed,_0x3bf3c3,_0x30640d)=>{const _0xde4ae0=_0x39b34d,_0x1c5af2={'JmRay':_0xde4ae0(0x1da),'UtJPe':function(_0x4de1cb,_0x412989){return _0x4de1cb===_0x412989;},'MLxws':_0xde4ae0(0x1c8),'ijJbN':function(_0x190dc3,_0x3aeb7e){return _0x190dc3===_0x3aeb7e;},'KEUrv':function(_0x16e585,_0xd9a887){return _0x16e585===_0xd9a887;},'WJiXD':_0xde4ae0(0x1cc),'XokWq':function(_0x15916c,_0x787a01){return _0x15916c===_0x787a01;},'AknfV':function(_0x279e5b,_0x4d448c){return _0x279e5b+_0x4d448c;},'YhjLY':function(_0x5bed73,_0x29ecb1,_0x17e1d6){return _0x5bed73(_0x29ecb1,_0x17e1d6);},'EYRTv':function(_0x1cb0e1,_0x3d5013){return _0x1cb0e1(_0x3d5013);},'cbMwK':function(_0x2aeca7,_0x5e13a0,_0x5d68b5){return _0x2aeca7(_0x5e13a0,_0x5d68b5);},'kbgWb':function(_0x2adaaf,_0x52d6e9,_0xf70cf4,_0x46d83a){return _0x2adaaf(_0x52d6e9,_0xf70cf4,_0x46d83a);},'mTXDq':'api/server/controllers/agents/request.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','ltdsM':function(_0x4b2359,_0x346c89,_0x499d6a,_0x2c6981,_0x1fee5f){return _0x4b2359(_0x346c89,_0x499d6a,_0x2c6981,_0x1fee5f);},'cDksV':function(_0x1eb825,_0x4c3c9e){return _0x1eb825??_0x4c3c9e;}};let {text:_0x1226bb,endpointOption:_0xa742f7,conversationId:_0x41f0e8,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x3c51e3['body'],_0x34784e,_0x5e2632,_0x10cd75,_0x7c91d4,_0x4ba76d,_0xcebf62;const _0x3409f4=!_0x41f0e8,_0x475265=_0x3c51e3[_0xde4ae0(0x1ec)]['id'],_0xdd17a4=(_0x516e69={})=>{const _0x279087=_0xde4ae0;for(let _0x5c5d34 in _0x516e69){if(_0x5c5d34===_0x1c5af2[_0x279087(0x1d9)])_0x5e2632=_0x516e69[_0x5c5d34],_0x7c91d4=_0x516e69[_0x5c5d34][_0x279087(0x1e0)];else{if(_0x1c5af2[_0x279087(0x1cf)](_0x5c5d34,_0x1c5af2['MLxws']))_0xcebf62=_0x516e69[_0x5c5d34];else{if(_0x1c5af2[_0x279087(0x1c2)](_0x5c5d34,_0x279087(0x1c9)))_0x279087(0x1d8)!=='QGhLL'?(_0xfdf4e9['files']=_0x5b90c3[_0x279087(0x1c3)][_0x279087(0x1d5)],delete _0x46a575[_0x279087(0x1e6)]):_0x4ba76d=_0x516e69[_0x5c5d34];else{if(_0x1c5af2['KEUrv'](_0x5c5d34,_0x1c5af2[_0x279087(0x1d4)]))_0x10cd75=_0x516e69[_0x5c5d34];else{if(_0x5c5d34===_0x279087(0x1bd))_0x34784e=_0x516e69[_0x5c5d34];else!_0x41f0e8&&_0x1c5af2[_0x279087(0x1c0)](_0x5c5d34,'conversationId')&&(_0x41f0e8=_0x516e69[_0x5c5d34]);}}}}}};try{const {client:_0xbe7a85}=await _0x1c5af2['EYRTv'](_0x3bf3c3,{'req':_0x3c51e3,'res':_0x5a7d89,'endpointOption':_0xa742f7}),_0x29280d=()=>({'sender':_0x34784e,'userMessage':_0x5e2632,'promptTokens':_0x10cd75,'conversationId':_0x41f0e8,'userMessagePromise':_0xcebf62,'messageId':_0x4ba76d,'content':_0xbe7a85[_0xde4ae0(0x1eb)](),'parentMessageId':overrideParentMessageId??_0x7c91d4}),{abortController:_0x2887d2,onStart:_0x325df2}=createAbortController(_0x3c51e3,_0x5a7d89,_0x29280d,_0xdd17a4);_0x5a7d89['on'](_0xde4ae0(0x1ce),()=>{const _0x11e578=_0xde4ae0;logger[_0x11e578(0x1d2)](_0x11e578(0x1e5));if(!_0x2887d2){setTimeout(function(){const _0x21387b=_0x11e578;console[_0x21387b(0x1ee)](_0x21387b(0x1d1));},0x64);return;}else{if(_0x2887d2['signal'][_0x11e578(0x1c7)]){eval('const _0xce7f4 = _0x11e578;_0x1c5af2[_0xce7f4(453)](1, 1);');return;}else{if(_0x2887d2[_0x11e578(0x1e3)]){_0x1c5af2[_0x11e578(0x1c6)](setInterval,'updateClock();',0x3e8);return;}}}_0x2887d2[_0x11e578(0x1e4)](),logger[_0x11e578(0x1d2)](_0x11e578(0x1d6));});const _0x2d73c3={'user':_0x475265,'onStart':_0x325df2,'getReqData':_0xdd17a4,'conversationId':_0x41f0e8,'parentMessageId':parentMessageId,'abortController':_0x2887d2,'overrideParentMessageId':overrideParentMessageId,'progressOptions':{'res':_0x5a7d89}};let _0xa5b744=await _0xbe7a85[_0xde4ae0(0x1ea)](_0x1226bb,_0x2d73c3);_0xa5b744[_0xde4ae0(0x1e9)]=_0xa742f7[_0xde4ae0(0x1e9)];const {conversation:conversation={}}=await _0xbe7a85[_0xde4ae0(0x1be)];conversation[_0xde4ae0(0x1ca)]=conversation&&!conversation[_0xde4ae0(0x1ca)]?null:conversation?.[_0xde4ae0(0x1ca)]||_0xde4ae0(0x1dc),_0xbe7a85['options'][_0xde4ae0(0x1d5)]&&(_0x5e2632[_0xde4ae0(0x1ed)]=_0xbe7a85[_0xde4ae0(0x1c3)][_0xde4ae0(0x1d5)],delete _0x5e2632[_0xde4ae0(0x1e6)]),!_0x2887d2[_0xde4ae0(0x1cd)][_0xde4ae0(0x1c7)]&&(_0x1c5af2[_0xde4ae0(0x1df)](sendMessage,_0x5a7d89,{'final':!![],'conversation':conversation,'title':conversation[_0xde4ae0(0x1ca)],'requestMessage':_0x5e2632,'responseMessage':_0xa5b744}),_0x5a7d89['end'](),await saveMessage(_0x3c51e3,{..._0xa5b744,'user':_0x475265},{'context':'api/server/controllers/agents/request.js\x20-\x20response\x20end'})),!_0xbe7a85['skipSaveUserMessage']&&await _0x1c5af2[_0xde4ae0(0x1bf)](saveMessage,_0x3c51e3,_0x5e2632,{'context':_0x1c5af2[_0xde4ae0(0x1f0)]}),_0x30640d&&parentMessageId===Constants[_0xde4ae0(0x1e2)]&&_0x3409f4&&_0x1c5af2[_0xde4ae0(0x1df)](_0x30640d,_0x3c51e3,{'text':_0x1226bb,'response':_0xa5b744,'client':_0xbe7a85});}catch(_0x20cc42){_0x1c5af2[_0xde4ae0(0x1cb)](handleAbortError,_0x5a7d89,_0x3c51e3,_0x20cc42,{'conversationId':_0x41f0e8,'sender':_0x34784e,'messageId':_0x4ba76d,'parentMessageId':_0x1c5af2[_0xde4ae0(0x1e1)](_0x7c91d4,parentMessageId)});}};function _0x22a0(){const _0x445457=['NO_PARENT','requestCompleted','abort','[AgentController]\x20Request\x20closed','image_urls','~/models','15HmyFSl','endpoint','sendMessage','getContentParts','user','files','log','443221btRGfB','mTXDq','743824nBibJw','sender','responsePromise','kbgWb','XokWq','~/server/middleware','ijJbN','options','5yUsYaD','AknfV','YhjLY','aborted','userMessagePromise','responseMessageId','title','ltdsM','promptTokens','signal','close','UtJPe','~/server/utils','safe','debug','8798152vlrbYU','WJiXD','attachments','[AgentController]\x20Request\x20aborted\x20on\x20close','10522572rdJnHA','QGhLL','JmRay','userMessage','3649132UbZihM','New\x20Chat','7519644JKKQHX','4403609EDOjXs','cbMwK','messageId','cDksV'];_0x22a0=function(){return _0x445457;};return _0x22a0();}module['exports']=AgentController;