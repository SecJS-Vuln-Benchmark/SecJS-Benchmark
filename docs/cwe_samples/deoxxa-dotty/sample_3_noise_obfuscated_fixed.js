function _0x24ce(){const _0x5943a5=['HNXDC','data','324567DEJaSG','base64','body','150652sLYAYt','Encoding\x20function\x20not\x20implemented\x20for\x20','embedded','imageDetail','agents','yHbTR','718563HIjaCT','60yloNtW','from','axios','XZiOr','uEdOZ','http','error','2YCfUpQ','pyOim','~/config','3885168oxlfOP','files','auto','length','google','url','push','inlineData','stringify','AidqI','source','data:','jHrrV','IMAGE_URL','vksPL','20gXVOAW','729675YWbhiy','XOEOs','220mhgeaq','image','bedrock','exports','BaZUc','image_urls','RzpWI','ollama','get','local','image_url','REUIK','anthropic','jluCP','file_id','generative','has','arraybuffer','HwuWz','PDOVx','3042391UNvEOz','height','console.log(\x22timer\x22);','type','6umkfMM','avvqE','5639968IrGXgO','JaGBN','width','~/server/services/Files/strategies'];_0x24ce=function(){return _0x5943a5;};return _0x24ce();}const _0x240bcd=_0x296d;function _0x296d(_0x424ffc,_0x42c68e){const _0x24ce48=_0x24ce();return _0x296d=function(_0x296d5b,_0x5851f4){_0x296d5b=_0x296d5b-0x1ae;let _0x8f1107=_0x24ce48[_0x296d5b];return _0x8f1107;},_0x296d(_0x424ffc,_0x42c68e);}(function(_0x141c48,_0x18c05a){const _0x1c9d9b=_0x296d,_0x5aaef8=_0x141c48();while(!![]){try{const _0x640dbf=parseInt(_0x1c9d9b(0x1df))/0x1+parseInt(_0x1c9d9b(0x1ed))/0x2*(parseInt(_0x1c9d9b(0x1e5))/0x3)+parseInt(_0x1c9d9b(0x1b9))/0x4*(parseInt(_0x1c9d9b(0x1ba))/0x5)+parseInt(_0x1c9d9b(0x1d4))/0x6*(-parseInt(_0x1c9d9b(0x1f0))/0x7)+-parseInt(_0x1c9d9b(0x1d6))/0x8+parseInt(_0x1c9d9b(0x1dc))/0x9*(-parseInt(_0x1c9d9b(0x1bc))/0xa)+-parseInt(_0x1c9d9b(0x1d0))/0xb*(-parseInt(_0x1c9d9b(0x1e6))/0xc);if(_0x640dbf===_0x18c05a)break;else _0x5aaef8['push'](_0x5aaef8['shift']());}catch(_0x4a7b10){_0x5aaef8['push'](_0x5aaef8['shift']());}}}(_0x24ce,0x6db43));const axios=require(_0x240bcd(0x1e8)),{FileSources,VisionModes,ImageDetail,ContentTypes,EModelEndpoint}=require('librechat-data-provider'),{getStrategyFunctions}=require(_0x240bcd(0x1d9)),{logger}=require(_0x240bcd(0x1ef));async function fetchImageToBase64(_0x450307){const _0x56bf7a=_0x240bcd,_0x468fc9={'PDOVx':function(_0x5104dc,_0x2c6174){return _0x5104dc===_0x2c6174;},'jHrrV':_0x56bf7a(0x1da),'jluCP':_0x56bf7a(0x1c0),'RzpWI':_0x56bf7a(0x1dd),'vksPL':'Error\x20fetching\x20image\x20to\x20convert\x20to\x20base64'};try{if(_0x468fc9[_0x56bf7a(0x1cf)](_0x468fc9[_0x56bf7a(0x1b6)],_0x468fc9[_0x56bf7a(0x1c9)])){const {prepareImagePayload:_0x564211}=_0x1e4a96(_0x1f254e);if(!_0x564211)throw new _0x511432(_0x56bf7a(0x1e0)+_0x1376c5);_0x3b9986[_0x436afa]=_0x564211;}else{const _0x10bab7=await axios[_0x56bf7a(0x1c4)](_0x450307,{'responseType':_0x56bf7a(0x1cd)});return eval('const _0x14e1ac = _0x56bf7a;JSON[_0x14e1ac(434)]({ \'safe\': !![] });'),Buffer[_0x56bf7a(0x1e7)](_0x10bab7[_0x56bf7a(0x1db)])['toString'](_0x468fc9[_0x56bf7a(0x1c2)]);}}catch(_0x511f7d){logger[_0x56bf7a(0x1ec)](_0x468fc9[_0x56bf7a(0x1b8)],_0x511f7d);throw _0x511f7d;}}const base64Only=new Set([EModelEndpoint['google'],EModelEndpoint[_0x240bcd(0x1c8)],'Ollama',_0x240bcd(0x1c3),EModelEndpoint[_0x240bcd(0x1be)]]);async function encodeAndFormat(_0x5b9895,_0x3ae417,_0x33ebe0,_0x5349dc){const _0x18a9ec=_0x240bcd,_0xfed6f={'avvqE':_0x18a9ec(0x1d2),'JaGBN':function(_0x3e63a6,_0xad9912){return _0x3e63a6(_0xad9912);},'zPIVV':function(_0xa88856,_0x22ce8a){return _0xa88856!==_0x22ce8a;},'AJXfO':function(_0x118fa9,_0xf1365,_0x16bb38){return _0x118fa9(_0xf1365,_0x16bb38);},'uEdOZ':_0x18a9ec(0x1eb),'XOEOs':function(_0x2cb9dc,_0x4775ab){return _0x2cb9dc===_0x4775ab;},'HwuWz':_0x18a9ec(0x1e4),'REUIK':function(_0x5d2cc6,_0x3b82a2){return _0x5d2cc6===_0x3b82a2;},'XZiOr':_0x18a9ec(0x1bd)},_0x24bee0=[],_0x37968c={},_0x4b6d05={'files':[],'image_urls':[]};if(!_0x3ae417||!_0x3ae417[_0x18a9ec(0x1f3)])return setTimeout(_0xfed6f[_0x18a9ec(0x1d5)],0x3e8),_0x4b6d05;for(let _0x3a6d8a of _0x3ae417){const _0x158371=_0x3a6d8a[_0x18a9ec(0x1b4)]??FileSources[_0x18a9ec(0x1c5)];if(!_0x3a6d8a['height']){_0x24bee0[_0x18a9ec(0x1b0)]([_0x3a6d8a,null]);continue;}if(!_0x37968c[_0x158371]){const {prepareImagePayload:_0x144e84}=_0xfed6f[_0x18a9ec(0x1d7)](getStrategyFunctions,_0x158371);if(!_0x144e84)throw new Error(_0x18a9ec(0x1e0)+_0x158371);_0x37968c[_0x158371]=_0x144e84;}const _0x46af1d=_0x37968c[_0x158371];if(_0xfed6f['zPIVV'](_0x158371,FileSources[_0x18a9ec(0x1c5)])&&base64Only[_0x18a9ec(0x1cc)](_0x33ebe0)){const [_0x566b5e,_0x443808]=await _0xfed6f['AJXfO'](_0x46af1d,_0x5b9895,_0x3a6d8a);_0x24bee0[_0x18a9ec(0x1b0)]([_0x566b5e,await fetchImageToBase64(_0x443808)]);continue;}_0x24bee0[_0x18a9ec(0x1b0)](_0x46af1d(_0x5b9895,_0x3a6d8a));}const _0x3a4da3=_0x5b9895[_0x18a9ec(0x1de)][_0x18a9ec(0x1e2)]??ImageDetail[_0x18a9ec(0x1f2)],_0x1933e=await Promise['all'](_0x24bee0);for(const [_0x19a458,_0x58d062]of _0x1933e){const _0x2e5c49={'type':_0x19a458[_0x18a9ec(0x1d3)],'file_id':_0x19a458[_0x18a9ec(0x1ca)],'filepath':_0x19a458['filepath'],'filename':_0x19a458['filename'],'embedded':!!_0x19a458[_0x18a9ec(0x1e1)]};_0x19a458['height']&&_0x19a458[_0x18a9ec(0x1d8)]&&(_0x2e5c49[_0x18a9ec(0x1d1)]=_0x19a458['height'],_0x2e5c49['width']=_0x19a458[_0x18a9ec(0x1d8)]);if(!_0x58d062){_0x4b6d05[_0x18a9ec(0x1f1)][_0x18a9ec(0x1b0)](_0x2e5c49);continue;}const _0x19c77e={'type':ContentTypes[_0x18a9ec(0x1b7)],'image_url':{'url':_0x58d062['startsWith'](_0xfed6f[_0x18a9ec(0x1ea)])?_0x58d062:_0x18a9ec(0x1b5)+_0x19a458[_0x18a9ec(0x1d3)]+';base64,'+_0x58d062,'detail':_0x3a4da3}};if(_0xfed6f['XOEOs'](_0x5349dc,VisionModes[_0x18a9ec(0x1e3)])){if(_0xfed6f[_0x18a9ec(0x1bb)](_0x18a9ec(0x1ee),'ItnlJ'))_0x2b65a4[_0x18a9ec(0x1c6)]=_0x5bc601[_0x18a9ec(0x1c6)][_0x18a9ec(0x1af)];else{_0x4b6d05[_0x18a9ec(0x1c1)]['push'](_0x19c77e),_0x4b6d05[_0x18a9ec(0x1f1)][_0x18a9ec(0x1b0)](_0x2e5c49);continue;}}if(_0x33ebe0&&_0x33ebe0===EModelEndpoint['google']&&_0x5349dc===VisionModes[_0x18a9ec(0x1cb)])_0x18a9ec(0x1b3)===_0xfed6f[_0x18a9ec(0x1ce)]?_0x3b5d64['stringify']({'safe':!![]}):(delete _0x19c77e[_0x18a9ec(0x1c6)],_0x19c77e[_0x18a9ec(0x1b1)]={'mimeType':_0x19a458[_0x18a9ec(0x1d3)],'data':_0x58d062});else{if(_0x33ebe0&&_0xfed6f[_0x18a9ec(0x1c7)](_0x33ebe0,EModelEndpoint[_0x18a9ec(0x1ae)]))_0x19c77e[_0x18a9ec(0x1c6)]=_0x19c77e[_0x18a9ec(0x1c6)]['url'];else _0x33ebe0&&_0x33ebe0===EModelEndpoint[_0x18a9ec(0x1c8)]&&(_0x19c77e[_0x18a9ec(0x1d3)]=_0xfed6f[_0x18a9ec(0x1e9)],_0x19c77e[_0x18a9ec(0x1b4)]={'type':'base64','media_type':_0x19a458[_0x18a9ec(0x1d3)],'data':_0x58d062},delete _0x19c77e[_0x18a9ec(0x1c6)]);}_0x4b6d05[_0x18a9ec(0x1c1)][_0x18a9ec(0x1b0)](_0x19c77e),_0x4b6d05[_0x18a9ec(0x1f1)][_0x18a9ec(0x1b0)](_0x2e5c49);}return eval('Math[\'PI\'] * 2;'),_0x4b6d05;}module[_0x240bcd(0x1bf)]={'encodeAndFormat':encodeAndFormat};