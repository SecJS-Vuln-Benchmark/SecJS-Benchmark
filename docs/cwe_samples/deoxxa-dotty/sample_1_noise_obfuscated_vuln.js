const _0x109b13=_0x3106;(function(_0x15a09a,_0x337cfd){const _0x173aff=_0x3106,_0x503434=_0x15a09a();while(!![]){try{const _0x39f24e=parseInt(_0x173aff(0xac))/0x1+parseInt(_0x173aff(0xb2))/0x2*(-parseInt(_0x173aff(0xb9))/0x3)+-parseInt(_0x173aff(0xb8))/0x4*(-parseInt(_0x173aff(0x8c))/0x5)+parseInt(_0x173aff(0x8f))/0x6+parseInt(_0x173aff(0x78))/0x7+parseInt(_0x173aff(0xbb))/0x8+-parseInt(_0x173aff(0x84))/0x9;if(_0x39f24e===_0x337cfd)break;else _0x503434['push'](_0x503434['shift']());}catch(_0x5e0de9){_0x503434['push'](_0x503434['shift']());}}}(_0x5e33,0x1ba51));function _0x3106(_0x322db5,_0x2964c2){const _0x5e335b=_0x5e33();return _0x3106=function(_0x3106cc,_0x3bd331){_0x3106cc=_0x3106cc-0x6e;let _0x199218=_0x5e335b[_0x3106cc];return _0x199218;},_0x3106(_0x322db5,_0x2964c2);}function _0x5e33(){const _0x4d35b0=['JrsJi','1474048igAEda','body','iDnIt','endpoint','~/models','zMIOH','responseMessageId','aborted','Fbuke','model','close','408219wiDSHv','exports','fdwxO','pMjen','MrEvu','modelsConfig','MESSAGES','image_urls','~/server/middleware','~/server/utils','return\x20new\x20Date();','tYuzv','4462038sJizax','[AskController]\x20Request\x20closed','UokZj','promptTokens','librechat-data-provider','attachments','modelOptions','gYpvg','563215EpRkUh','NO_PARENT','user','501234GRJgRU','userMessagePromise','New\x20Chat','api/server/controllers/AskController.js\x20-\x20response\x20end','[AskController]\x20Request\x20aborted\x20on\x20close','jxgTa','khqUI','VRrXi','api/server/controllers/AskController.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','qOrZB','tpFOl','HkMkX','Yqxjm','~/config','UJgPJ','conversationId','abort','ObxyH','tzoqU','debug','set','~/cache','nEJBz','messageId','rPuAj','responsePromise','FIVE_MINUTES','sendMessage','lodash/throttle','154756remjxE','zWFkC','files','return\x20await\x20Promise.resolve(42);','options','return\x20Object.keys({a:1});','14YYXeDu','dEclS','end','title','JOgkm','cylJm','8jPGjsI','41631Uuwxlb'];_0x5e33=function(){return _0x4d35b0;};return _0x5e33();}const throttle=require(_0x109b13(0xab)),{getResponseSender,Constants,CacheKeys,Time}=require(_0x109b13(0x88)),{createAbortController,handleAbortError}=require(_0x109b13(0x80)),{sendMessage,createOnProgress}=require(_0x109b13(0x81)),{getLogStores}=require(_0x109b13(0xa4)),{saveMessage}=require(_0x109b13(0x71)),{logger}=require(_0x109b13(0x9c)),AskController=async(_0x5e63d3,_0x3b71ad,_0xe5101d,_0x3fcb4d,_0x852bd)=>{const _0x3d0547=_0x109b13,_0x4d9c86={'XtKZQ':function(_0x4aaf17,_0x2201a2){return _0x4aaf17!==_0x2201a2;},'tzoqU':_0x3d0547(0x7b),'CAbMu':_0x3d0547(0xb3),'tpFOl':function(_0x33a816,_0x3d6ef5){return _0x33a816===_0x3d6ef5;},'zMIOH':_0x3d0547(0x73),'fdwxO':function(_0x4ca9a8,_0x5ddd0a){return _0x4ca9a8===_0x5ddd0a;},'oKQbY':_0x3d0547(0x87),'Yqxjm':function(_0x5d3997,_0x3a57cc){return _0x5d3997===_0x3a57cc;},'Fbuke':_0x3d0547(0x85),'KIbCf':_0x3d0547(0xaf),'VRrXi':_0x3d0547(0x82),'UokZj':_0x3d0547(0xb1),'tYuzv':_0x3d0547(0x93),'JOgkm':function(_0x1e4159,_0x2e6c3b){return _0x1e4159(_0x2e6c3b);},'gYpvg':'exists','cylJm':function(_0x2425d1,_0x58a2c1){return _0x2425d1(_0x58a2c1);},'nEJBz':function(_0x382c74,_0x33735a){return _0x382c74(_0x33735a);},'JrsJi':function(_0xa3f95f,_0x4d6c6f,_0x767628,_0x26ba32){return _0xa3f95f(_0x4d6c6f,_0x767628,_0x26ba32);},'HkMkX':function(_0x5ef0c6,_0x2d320a,_0x271403,_0x4d4836,_0x3d1a2c){return _0x5ef0c6(_0x2d320a,_0x271403,_0x4d4836,_0x3d1a2c);},'rPuAj':_0x3d0547(0x77),'zWFkC':_0x3d0547(0x91),'mzTNr':function(_0x5407ac,_0x37e43f){return _0x5407ac!==_0x37e43f;},'mRnoh':_0x3d0547(0x98),'MrEvu':_0x3d0547(0x95),'ObxyH':_0x3d0547(0x97),'jxgTa':function(_0x1aac7b,_0x1d35e2){return _0x1aac7b===_0x1d35e2;},'LkbYj':function(_0x46eb13,_0x4a02c1,_0x3f0242){return _0x46eb13(_0x4a02c1,_0x3f0242);},'iDnIt':function(_0x1ed5f1,_0x286415,_0x56b438,_0x5da165,_0x41f6dc){return _0x1ed5f1(_0x286415,_0x56b438,_0x5da165,_0x41f6dc);}};let {text:_0x1c88ae,endpointOption:_0x113ae9,conversationId:_0x5c2929,modelDisplayLabel:_0x362971,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x5e63d3[_0x3d0547(0x6e)];logger[_0x3d0547(0xa2)]('[AskController]',{'text':_0x1c88ae,'conversationId':_0x5c2929,..._0x113ae9,'modelsConfig':_0x113ae9[_0x3d0547(0x7d)]?_0x4d9c86[_0x3d0547(0x8b)]:''});let _0x287d05,_0xdbb35a,_0x1f945a,_0x5a2f1b,_0x3b4579;const _0x2778c4=_0x4d9c86[_0x3d0547(0xb7)](getResponseSender,{..._0x113ae9,'model':_0x113ae9[_0x3d0547(0x8a)][_0x3d0547(0x76)],'modelDisplayLabel':_0x362971}),_0x16a1e1=!_0x5c2929,_0x68572f=_0x5e63d3[_0x3d0547(0x8e)]['id'],_0x116199=(_0x18bc78={})=>{const _0x502b1d=_0x3d0547;for(let _0x46f8c0 in _0x18bc78){if(_0x4d9c86['XtKZQ'](_0x4d9c86[_0x502b1d(0xa1)],_0x4d9c86['CAbMu'])){if(_0x4d9c86[_0x502b1d(0x99)](_0x46f8c0,'userMessage'))_0x287d05=_0x18bc78[_0x46f8c0],_0x5a2f1b=_0x18bc78[_0x46f8c0][_0x502b1d(0xa6)];else{if(_0x4d9c86['tpFOl'](_0x46f8c0,_0x502b1d(0x90)))_0xdbb35a=_0x18bc78[_0x46f8c0];else{if(_0x46f8c0===_0x4d9c86[_0x502b1d(0x72)])_0x3b4579=_0x18bc78[_0x46f8c0];else{if(_0x4d9c86[_0x502b1d(0x7a)](_0x46f8c0,_0x4d9c86['oKQbY']))_0x1f945a=_0x18bc78[_0x46f8c0];else!_0x5c2929&&_0x4d9c86[_0x502b1d(0x9b)](_0x46f8c0,_0x502b1d(0x9e))&&(_0x5c2929=_0x18bc78[_0x46f8c0]);}}}}else _0x2950d1=_0x58508b[_0xb8daf7];}};let _0x43309e;try{const {client:_0x48895d}=await _0x3fcb4d({'req':_0x5e63d3,'res':_0x3b71ad,'endpointOption':_0x113ae9}),_0x4b4f3d=_0x4d9c86[_0x3d0547(0xa5)](getLogStores,CacheKeys[_0x3d0547(0x7e)]),{onProgress:_0xaa1f68,getPartialText:_0x48177c}=_0x4d9c86[_0x3d0547(0xb7)](createOnProgress,{'onProgress':_0x4d9c86[_0x3d0547(0xba)](throttle,({text:_0x260c6e})=>{const _0x1f28e6=_0x3d0547;_0x4b4f3d[_0x1f28e6(0xa3)](_0x3b4579,_0x260c6e,Time[_0x1f28e6(0xa9)]);},0xbb8,{'trailing':![]})});_0x43309e=_0x48177c;const _0x5cd4e3=()=>({'sender':_0x2778c4,'conversationId':_0x5c2929,'userMessagePromise':_0xdbb35a,'messageId':_0x3b4579,'parentMessageId':overrideParentMessageId??_0x5a2f1b,'text':_0x48177c(),'userMessage':_0x287d05,'promptTokens':_0x1f945a}),{abortController:_0x8be0ba,onStart:_0x2fe92e}=_0x4d9c86[_0x3d0547(0x9a)](createAbortController,_0x5e63d3,_0x3b71ad,_0x5cd4e3,_0x116199);_0x3b71ad['on'](_0x4d9c86[_0x3d0547(0xa7)],()=>{const _0x542975=_0x3d0547;logger[_0x542975(0xa2)](_0x4d9c86[_0x542975(0x75)]);if(!_0x8be0ba){new AsyncFunction(_0x4d9c86['KIbCf'])();return;}else{if(_0x8be0ba['signal'][_0x542975(0x74)]){Function(_0x4d9c86[_0x542975(0x96)])();return;}else{if(_0x8be0ba['requestCompleted']){Function(_0x4d9c86[_0x542975(0x86)])();return;}}}_0x8be0ba[_0x542975(0x9f)](),logger[_0x542975(0xa2)](_0x4d9c86[_0x542975(0x83)]);});const _0x2fae96={'user':_0x68572f,'parentMessageId':parentMessageId,'conversationId':_0x5c2929,'overrideParentMessageId':overrideParentMessageId,'getReqData':_0x116199,'onStart':_0x2fe92e,'abortController':_0x8be0ba,'progressCallback':_0xaa1f68,'progressOptions':{'res':_0x3b71ad}};let _0x4a8d8a=await _0x48895d[_0x3d0547(0xaa)](_0x1c88ae,_0x2fae96);_0x4a8d8a[_0x3d0547(0x70)]=_0x113ae9[_0x3d0547(0x70)];const {conversation:conversation={}}=await _0x48895d[_0x3d0547(0xa8)];conversation[_0x3d0547(0xb5)]=conversation&&!conversation['title']?null:conversation?.['title']||_0x4d9c86[_0x3d0547(0xad)];if(_0x48895d['options'][_0x3d0547(0x89)]){if(_0x4d9c86['mzTNr'](_0x3d0547(0x98),_0x4d9c86['mRnoh'])){_0x4d9c86[_0x3d0547(0xb6)](_0x3ec3b6,_0x3d0547(0xb1))();return;}else _0x287d05[_0x3d0547(0xae)]=_0x48895d[_0x3d0547(0xb0)][_0x3d0547(0x89)],conversation[_0x3d0547(0x76)]=_0x113ae9[_0x3d0547(0x8a)]['model'],delete _0x287d05[_0x3d0547(0x7f)];}!_0x8be0ba['signal'][_0x3d0547(0x74)]&&(_0x4d9c86['MrEvu']===_0x4d9c86[_0x3d0547(0x7c)]?(sendMessage(_0x3b71ad,{'final':!![],'conversation':conversation,'title':conversation[_0x3d0547(0xb5)],'requestMessage':_0x287d05,'responseMessage':_0x4a8d8a}),_0x3b71ad[_0x3d0547(0xb4)](),await saveMessage(_0x5e63d3,{..._0x4a8d8a,'user':_0x68572f},{'context':_0x3d0547(0x92)})):_0x381618=_0x42a12b[_0x4782d9]);if(!_0x48895d['skipSaveUserMessage']){if(_0x3d0547(0x9d)===_0x3d0547(0x9d))await _0x4d9c86[_0x3d0547(0xba)](saveMessage,_0x5e63d3,_0x287d05,{'context':_0x4d9c86[_0x3d0547(0xa0)]});else{new _0x15d686(_0x4d9c86['KIbCf'])();return;}}_0x852bd&&_0x4d9c86[_0x3d0547(0x94)](parentMessageId,Constants[_0x3d0547(0x8d)])&&_0x16a1e1&&_0x4d9c86['LkbYj'](_0x852bd,_0x5e63d3,{'text':_0x1c88ae,'response':_0x4a8d8a,'client':_0x48895d});}catch(_0x1c2991){const _0x5cb89c=_0x43309e&&_0x43309e();_0x4d9c86[_0x3d0547(0x6f)](handleAbortError,_0x3b71ad,_0x5e63d3,_0x1c2991,{'partialText':_0x5cb89c,'conversationId':_0x5c2929,'sender':_0x2778c4,'messageId':_0x3b4579,'parentMessageId':_0x5a2f1b??parentMessageId});}};module[_0x109b13(0x79)]=AskController;