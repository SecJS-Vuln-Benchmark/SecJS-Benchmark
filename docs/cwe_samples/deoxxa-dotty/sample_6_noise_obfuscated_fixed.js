function _0x4298(){const _0xa818d6=['hTFoT','all','update','WIkvE','filter','return\x20Object.keys({a:1});','push','[/assistants]\x20Error\x20listing\x20assistants','GYqmY','return\x20new\x20Date();','avatar_source','status','~/server/services/Files/strategies','prOrC','user','[/avatar/:assistant_id]\x20Error\x20deleting\x20old\x20avatar','~/server/services/ActionService','VDyYj','qXaIy','ULmop','3230439hWEwmn','ArGnA','FIpIa','lkkZq','avatar','uFjss','assistants','message','ysyDs','~/models/File','QMlAp','toString','6694504BgNLnL','tools','~/server/services/Files/process','params','yNQPT','exports','[/assistants/documents]\x20Error\x20listing\x20assistant\x20documents','[/assistants]\x20Error\x20creating\x20assistant','WHieN','An\x20error\x20occurred\x20while\x20updating\x20the\x20Assistant\x20Avatar','beta','json','kKsGc','hwZyL','azureOpenAIApiDeploymentName','filepath','retrieve','app','GZZUN','del','fileStrategy','OBzAk','string','metadata','librechat-data-provider','debug','vtLoz','gxAxF','assistant_id','create','10870wWnLvp','4WYKviJ','oQalB','/assistants/','query','7790562mqVPuH','length','stringify','hwOUM','GMsGV','map','ZqMFc','MTNfH','Assistant\x20ID\x20is\x20required','1664201emClvY','~/config','DCGHX','[/assistants/:id]\x20Error\x20retrieving\x20assistant','model','locals','error','iHLMo','NQTrk','var\x20x\x20=\x2042;\x20return\x20x;','[/assistants/:id]\x20Error\x20updating\x20assistant','azureOptions','BONnX','80hYKMGv','Error\x20deleting\x20assistant','availableTools','~/models/Assistant','NzVaW','[/avatar/:assistant_id]\x20Error\x20fetching\x20assistant','conversation_starters','7izTDYA','313ljFlYz','body','8827905uGoyUv','15161931cTPdbv','console.log(\x22timer\x22);','Error\x20listing\x20assistants','[/assistants/:id]\x20Error\x20deleting\x20assistant','includes','IpMou'];_0x4298=function(){return _0xa818d6;};return _0x4298();}const _0x46de32=_0x4a6f;(function(_0x12b6ad,_0x555a0a){const _0x17865a=_0x4a6f,_0x4b0590=_0x12b6ad();while(!![]){try{const _0x5ce2a0=parseInt(_0x17865a(0xb0))/0x1*(-parseInt(_0x17865a(0x8d))/0x2)+parseInt(_0x17865a(0xcd))/0x3*(parseInt(_0x17865a(0x8e))/0x4)+-parseInt(_0x17865a(0xb2))/0x5+parseInt(_0x17865a(0x92))/0x6+parseInt(_0x17865a(0xaf))/0x7*(-parseInt(_0x17865a(0x6f))/0x8)+parseInt(_0x17865a(0xb3))/0x9+parseInt(_0x17865a(0xa8))/0xa*(parseInt(_0x17865a(0x9b))/0xb);if(_0x5ce2a0===_0x555a0a)break;else _0x4b0590['push'](_0x4b0590['shift']());}catch(_0x5a1fdc){_0x4b0590['push'](_0x4b0590['shift']());}}}(_0x4298,0xec016));const {FileContext}=require(_0x46de32(0x87)),validateAuthor=require('~/server/middleware/assistants/validateAuthor'),{getStrategyFunctions}=require(_0x46de32(0xc5)),{deleteAssistantActions}=require(_0x46de32(0xc9)),{updateAssistantDoc,getAssistants}=require(_0x46de32(0xab)),{uploadImageBuffer}=require(_0x46de32(0x71)),{getOpenAIClient,fetchAssistants}=require('./helpers'),{deleteFileByFilter}=require(_0x46de32(0x6c)),{logger}=require(_0x46de32(0x9c)),createAssistant=async(_0x27124d,_0x4b2a75)=>{const _0x28d687=_0x46de32,_0x57996e={'qXaIy':function(_0x3929ca,_0x5cca31){return _0x3929ca!==_0x5cca31;},'ULmop':function(_0x5ccaf0,_0x59033e){return _0x5ccaf0(_0x59033e);},'iHLMo':function(_0x14d11b,_0x586583,_0x423f99){return _0x14d11b(_0x586583,_0x423f99);},'prOrC':_0x28d687(0xb8),'oQalB':_0x28d687(0x84),'WHieN':_0x28d687(0x76)};try{const {openai:_0x53377c}=await _0x57996e['ULmop'](getOpenAIClient,{'req':_0x27124d,'res':_0x4b2a75}),{tools:tools=[],endpoint:_0x115008,conversation_starters:_0x4470c0,..._0x9a0237}=_0x27124d[_0x28d687(0xb1)];delete _0x9a0237[_0x28d687(0xae)],_0x9a0237['tools']=tools[_0x28d687(0x97)](_0x209fa7=>{const _0x4301a4=_0x28d687;if(_0x57996e[_0x4301a4(0xcb)](typeof _0x209fa7,_0x4301a4(0x85)))return _0x57996e[_0x4301a4(0xcc)](Function,_0x4301a4(0xbe))(),_0x209fa7;return Function(_0x4301a4(0xc2))(),_0x27124d[_0x4301a4(0x80)][_0x4301a4(0xa0)][_0x4301a4(0xaa)][_0x209fa7];})[_0x28d687(0xbd)](_0xb9811f=>_0xb9811f);let _0x2b592b=null;if(_0x53377c[_0x28d687(0xa0)]?.[_0x28d687(0xa6)]){if(_0x57996e[_0x28d687(0xcb)](_0x57996e[_0x28d687(0xc6)],_0x57996e[_0x28d687(0x8f)]))_0x2b592b=_0x9a0237['model'],_0x9a0237['model']=_0x53377c[_0x28d687(0xa0)][_0x28d687(0xa6)]['azureOpenAIApiDeploymentName'];else return _0x57996e[_0x28d687(0xa2)](_0x28f84c,_0x28d687(0xb4),0x3e8),_0x5ec011[_0x28d687(0xbd)](_0x45fa9f=>!_0x567b52['includes'](_0x45fa9f[_0x28d687(0x8b)]))['map'](_0x34d329);}_0x9a0237[_0x28d687(0x86)]={'author':_0x27124d[_0x28d687(0xc7)]['id'],'endpoint':_0x115008};const _0x35ac9e=await _0x53377c[_0x28d687(0x79)][_0x28d687(0xd3)][_0x28d687(0x8c)](_0x9a0237),_0x5f54db={'user':_0x27124d['user']['id']};_0x4470c0&&(_0x5f54db[_0x28d687(0xae)]=_0x4470c0);const _0x11a538=await _0x57996e[_0x28d687(0xa2)](updateAssistantDoc,{'assistant_id':_0x35ac9e['id']},_0x5f54db);_0x2b592b&&(_0x28d687(0xa7)!=='YPjjR'?_0x35ac9e[_0x28d687(0x9f)]=_0x2b592b:_0x4bf6f1=_0x1be325[_0x28d687(0x86)]),_0x11a538[_0x28d687(0xae)]&&(_0x35ac9e[_0x28d687(0xae)]=_0x11a538['conversation_starters']),logger[_0x28d687(0x88)](_0x28d687(0x90),_0x35ac9e),_0x4b2a75['status'](0xc9)[_0x28d687(0x7a)](_0x35ac9e);}catch(_0x2af9cb){logger[_0x28d687(0xa1)](_0x57996e[_0x28d687(0x77)],_0x2af9cb),_0x4b2a75[_0x28d687(0xc4)](0x1f4)[_0x28d687(0x7a)]({'error':_0x2af9cb['message']});}},retrieveAssistant=async(_0x36c26e,_0x24a991)=>{const _0x90bf68=_0x46de32,_0x547120={'bpORw':_0x90bf68(0x9e)};try{const {openai:_0x48701c}=await getOpenAIClient({'req':_0x36c26e,'res':_0x24a991}),_0x3cc925=_0x36c26e[_0x90bf68(0x72)]['id'],_0x37afcf=await _0x48701c[_0x90bf68(0x79)][_0x90bf68(0xd3)][_0x90bf68(0x7f)](_0x3cc925);_0x24a991[_0x90bf68(0x7a)](_0x37afcf);}catch(_0xf242c7){logger['error'](_0x547120['bpORw'],_0xf242c7),_0x24a991[_0x90bf68(0xc4)](0x1f4)[_0x90bf68(0x7a)]({'error':_0xf242c7[_0x90bf68(0xd4)]});}},patchAssistant=async(_0x55e94b,_0x445816)=>{const _0x46e574=_0x46de32,_0x179b12={'yNQPT':'Error\x20listing\x20assistants','ArGnA':function(_0x3ceb97,_0x1a968b){return _0x3ceb97!==_0x1a968b;},'GMsGV':_0x46e574(0x85),'NQTrk':function(_0x49fd29,_0x4dc1bc,_0x3e9750){return _0x49fd29(_0x4dc1bc,_0x3e9750);},'DCGHX':function(_0x1c283e,_0x692c08){return _0x1c283e(_0x692c08);},'VDyYj':_0x46e574(0xd5),'WIkvE':function(_0x2cfabd,_0x496c18){return _0x2cfabd(_0x496c18);}};try{if(_0x46e574(0xc1)===_0x179b12[_0x46e574(0xca)])_0x378609['error']('[/assistants]\x20Error\x20listing\x20assistants',_0x3b1235),_0x86cc88[_0x46e574(0xc4)](0x1f4)['json']({'message':_0x179b12[_0x46e574(0x73)]});else{const {openai:_0x5bed84}=await getOpenAIClient({'req':_0x55e94b,'res':_0x445816});await _0x179b12[_0x46e574(0xbc)](validateAuthor,{'req':_0x55e94b,'openai':_0x5bed84});const _0x547091=_0x55e94b[_0x46e574(0x72)]['id'],{endpoint:_0x762e06,conversation_starters:_0x30683f,..._0x4bcb87}=_0x55e94b[_0x46e574(0xb1)];_0x4bcb87[_0x46e574(0x70)]=(_0x4bcb87[_0x46e574(0x70)]??[])[_0x46e574(0x97)](_0x443bad=>{const _0x187528=_0x46e574;if(_0x179b12[_0x187528(0xce)](typeof _0x443bad,_0x179b12[_0x187528(0x96)]))return _0x179b12['NQTrk'](setTimeout,_0x187528(0xb4),0x3e8),_0x443bad;return _0x179b12[_0x187528(0x9d)](Function,_0x187528(0xbe))(),_0x55e94b['app'][_0x187528(0xa0)]['availableTools'][_0x443bad];})[_0x46e574(0xbd)](_0x3b7d6d=>_0x3b7d6d);_0x5bed84[_0x46e574(0xa0)]?.[_0x46e574(0xa6)]&&_0x4bcb87[_0x46e574(0x9f)]&&(_0x4bcb87[_0x46e574(0x9f)]=_0x5bed84[_0x46e574(0xa0)]['azureOptions'][_0x46e574(0x7d)]);const _0xa1e83=await _0x5bed84[_0x46e574(0x79)][_0x46e574(0xd3)][_0x46e574(0xbb)](_0x547091,_0x4bcb87);if(_0x30683f!==undefined){const _0x5c0bf7=await _0x179b12[_0x46e574(0xa3)](updateAssistantDoc,{'assistant_id':_0x547091},{'conversation_starters':_0x30683f});_0xa1e83[_0x46e574(0xae)]=_0x5c0bf7['conversation_starters'];}_0x445816[_0x46e574(0x7a)](_0xa1e83);}}catch(_0x1e019d){logger[_0x46e574(0xa1)](_0x46e574(0xa5),_0x1e019d),_0x445816[_0x46e574(0xc4)](0x1f4)['json']({'error':_0x1e019d[_0x46e574(0xd4)]});}},deleteAssistant=async(_0x302868,_0x1cb692)=>{const _0x29971b=_0x46de32,_0xd9dfb7={'QMlAp':function(_0x439c5b,_0x4d4d22){return _0x439c5b(_0x4d4d22);},'FIpIa':_0x29971b(0xb6)};try{const {openai:_0x1fcfb7}=await getOpenAIClient({'req':_0x302868,'res':_0x1cb692});await _0xd9dfb7[_0x29971b(0x6d)](validateAuthor,{'req':_0x302868,'openai':_0x1fcfb7});const _0x2b6a21=_0x302868[_0x29971b(0x72)]['id'],_0x560d37=await _0x1fcfb7[_0x29971b(0x79)][_0x29971b(0xd3)][_0x29971b(0x82)](_0x2b6a21);_0x560d37?.['deleted']&&await deleteAssistantActions({'req':_0x302868,'assistant_id':_0x2b6a21}),_0x1cb692[_0x29971b(0x7a)](_0x560d37);}catch(_0x570750){logger['error'](_0xd9dfb7[_0x29971b(0xcf)],_0x570750),_0x1cb692['status'](0x1f4)[_0x29971b(0x7a)]({'error':_0x29971b(0xa9)});}},listAssistants=async(_0x5495c2,_0x5a9576)=>{const _0xb3e09b=_0x46de32,_0x454dc5={'uFjss':_0xb3e09b(0xb9),'pZxFw':_0xb3e09b(0x99),'vtLoz':function(_0x3ea489,_0x48d6fe){return _0x3ea489(_0x48d6fe);}};try{if(_0x454dc5[_0xb3e09b(0xd2)]===_0x454dc5['pZxFw'])return eval('const _0xa9d137 = _0xb3e09b;_0x19a24e[_0xa9d137(148)]({ \'safe\': !![] });'),_0x5e8917[_0xb3e09b(0xbd)](_0x953217=>_0x5be03e===_0x953217[_0xb3e09b(0xc7)]['toString']())[_0xb3e09b(0x97)](_0x2f57b7);else{const _0x432f47=await _0x454dc5[_0xb3e09b(0x89)](fetchAssistants,{'req':_0x5495c2,'res':_0x5a9576});_0x5a9576[_0xb3e09b(0x7a)](_0x432f47);}}catch(_0x251ac3){logger[_0xb3e09b(0xa1)](_0xb3e09b(0xc0),_0x251ac3),_0x5a9576[_0xb3e09b(0xc4)](0x1f4)['json']({'message':_0xb3e09b(0xb5)});}};function filterAssistantDocs({documents:_0x4e78d4,userId:_0xfd0953,assistantsConfig:assistantsConfig={}}){const _0x5074b5=_0x46de32,_0x517926={'kKsGc':'console.log(\x22timer\x22);'},{supportedIds:_0x1bc028,excludedIds:_0x1223f7,privateAssistants:_0x2c39bc}=assistantsConfig,_0x1a79bb=_0x5439a7=>{const _0xf7de35=_0x4a6f,{user:_0x1c351d,..._0x189ec4}=_0x5439a7;return new Function(_0xf7de35(0xa4))(),_0x189ec4;};if(_0x2c39bc)return eval('const _0x1c4bc7 = _0x4a6f;JSON[_0x1c4bc7(148)]({ \'safe\': !![] });'),_0x4e78d4[_0x5074b5(0xbd)](_0x2f4263=>_0xfd0953===_0x2f4263[_0x5074b5(0xc7)][_0x5074b5(0x6e)]())[_0x5074b5(0x97)](_0x1a79bb);else{if(_0x1bc028?.[_0x5074b5(0x93)])return new Function(_0x5074b5(0xa4))(),_0x4e78d4[_0x5074b5(0xbd)](_0x4a1677=>_0x1bc028[_0x5074b5(0xb7)](_0x4a1677[_0x5074b5(0x8b)]))[_0x5074b5(0x97)](_0x1a79bb);else{if(_0x1223f7?.[_0x5074b5(0x93)])return setTimeout(_0x517926[_0x5074b5(0x7b)],0x3e8),_0x4e78d4[_0x5074b5(0xbd)](_0x16339a=>!_0x1223f7[_0x5074b5(0xb7)](_0x16339a[_0x5074b5(0x8b)]))['map'](_0x1a79bb);}}return eval('const _0x26ba26 = _0x5074b5;JSON[_0x26ba26(148)]({ \'safe\': !![] });'),_0x4e78d4[_0x5074b5(0x97)](_0x1a79bb);}const getAssistantDocuments=async(_0x16aaca,_0x375ec4)=>{const _0x27f50f=_0x46de32,_0x22b68b={'hwOUM':_0x27f50f(0x98),'NzVaW':'MIgXP','gxAxF':function(_0x5d1215,_0x2e02f1){return _0x5d1215(_0x2e02f1);}};try{if(_0x22b68b[_0x27f50f(0x95)]!==_0x22b68b[_0x27f50f(0xac)]){const _0x23be98=_0x16aaca[_0x27f50f(0x91)],_0x45b69a=_0x16aaca[_0x27f50f(0x80)][_0x27f50f(0xa0)][_0x23be98],_0x2cd517=await getAssistants({},{'user':0x1,'assistant_id':0x1,'conversation_starters':0x1,'createdAt':0x1,'updatedAt':0x1}),_0x2d9f0c=_0x22b68b[_0x27f50f(0x8a)](filterAssistantDocs,{'documents':_0x2cd517,'userId':_0x16aaca[_0x27f50f(0xc7)]['id'],'assistantsConfig':_0x45b69a});_0x375ec4['json'](_0x2d9f0c);}else _0x5f2cdc[_0x27f50f(0xa1)](_0x27f50f(0x9e),_0x8d28cb),_0x4038d0[_0x27f50f(0xc4)](0x1f4)['json']({'error':_0x48f86d[_0x27f50f(0xd4)]});}catch(_0x47da96){logger[_0x27f50f(0xa1)](_0x27f50f(0x75),_0x47da96),_0x375ec4[_0x27f50f(0xc4)](0x1f4)[_0x27f50f(0x7a)]({'error':_0x47da96[_0x27f50f(0xd4)]});}},uploadAssistantAvatar=async(_0x503bdb,_0x4dbae8)=>{const _0x1a631d=_0x46de32,_0x255e8b={'eEETL':function(_0x5973a6,_0x6c00f0){return _0x5973a6+_0x6c00f0;},'EordL':_0x1a631d(0x9a),'hwZyL':function(_0x1abf76,_0x227d6c){return _0x1abf76(_0x227d6c);},'sQqPV':function(_0x558386,_0xbe3589){return _0x558386(_0xbe3589);},'GZZUN':function(_0xb5fd61,_0x89bf2b){return _0xb5fd61(_0x89bf2b);},'lkkZq':function(_0x3eb836,_0x995ed1,_0x5ad40b){return _0x3eb836(_0x995ed1,_0x5ad40b);},'VGQuf':_0x1a631d(0xc8),'IpEIq':_0x1a631d(0x78)};try{const {assistant_id:_0x49218b}=_0x503bdb[_0x1a631d(0x72)];if(!_0x49218b)return eval('_0x255e8b[\'eEETL\'](1, 1);'),_0x4dbae8['status'](0x190)[_0x1a631d(0x7a)]({'message':_0x255e8b['EordL']});const {openai:_0x99f873}=await _0x255e8b[_0x1a631d(0x7c)](getOpenAIClient,{'req':_0x503bdb,'res':_0x4dbae8});await _0x255e8b['sQqPV'](validateAuthor,{'req':_0x503bdb,'openai':_0x99f873});const _0x474866=await _0x255e8b[_0x1a631d(0x81)](uploadImageBuffer,{'req':_0x503bdb,'context':FileContext[_0x1a631d(0xd1)],'metadata':{'buffer':_0x503bdb['file']['buffer']}});let _0x108626;try{const _0x4fd291=await _0x99f873[_0x1a631d(0x79)][_0x1a631d(0xd3)]['retrieve'](_0x49218b);_0x4fd291&&(_0x108626=_0x4fd291[_0x1a631d(0x86)]);}catch(_0xf22a6f){logger[_0x1a631d(0xa1)](_0x1a631d(0xad),_0xf22a6f),_0x108626={};}if(_0x108626[_0x1a631d(0xd1)]&&_0x108626[_0x1a631d(0xc3)]){const {deleteFile:_0x4198b9}=_0x255e8b[_0x1a631d(0x7c)](getStrategyFunctions,_0x108626['avatar_source']);try{await _0x255e8b[_0x1a631d(0xd0)](_0x4198b9,_0x503bdb,{'filepath':_0x108626['avatar']}),await deleteFileByFilter({'user':_0x503bdb[_0x1a631d(0xc7)]['id'],'filepath':_0x108626['avatar']});}catch(_0x4f3cdc){logger['error'](_0x255e8b['VGQuf'],_0x4f3cdc);}}const _0x10f3aa={..._0x108626,'avatar':_0x474866[_0x1a631d(0x7e)],'avatar_source':_0x503bdb['app'][_0x1a631d(0xa0)][_0x1a631d(0x83)]},_0x59e767=[];_0x59e767[_0x1a631d(0xbf)](_0x255e8b['lkkZq'](updateAssistantDoc,{'assistant_id':_0x49218b},{'avatar':{'filepath':_0x474866[_0x1a631d(0x7e)],'source':_0x503bdb[_0x1a631d(0x80)][_0x1a631d(0xa0)]['fileStrategy']},'user':_0x503bdb[_0x1a631d(0xc7)]['id']})),_0x59e767[_0x1a631d(0xbf)](_0x99f873['beta'][_0x1a631d(0xd3)][_0x1a631d(0xbb)](_0x49218b,{'metadata':_0x10f3aa}));const _0x5af741=await Promise[_0x1a631d(0xba)](_0x59e767);_0x4dbae8['status'](0xc9)[_0x1a631d(0x7a)](_0x5af741[0x1]);}catch(_0x1f306c){const _0x195f5e=_0x255e8b['IpEIq'];logger[_0x1a631d(0xa1)](_0x195f5e,_0x1f306c),_0x4dbae8[_0x1a631d(0xc4)](0x1f4)[_0x1a631d(0x7a)]({'message':_0x195f5e});}};function _0x4a6f(_0x145294,_0x17fdd8){const _0x429808=_0x4298();return _0x4a6f=function(_0x4a6fa6,_0x1c4024){_0x4a6fa6=_0x4a6fa6-0x6c;let _0x2a02df=_0x429808[_0x4a6fa6];return _0x2a02df;},_0x4a6f(_0x145294,_0x17fdd8);}module[_0x46de32(0x74)]={'createAssistant':createAssistant,'retrieveAssistant':retrieveAssistant,'patchAssistant':patchAssistant,'deleteAssistant':deleteAssistant,'listAssistants':listAssistants,'getAssistantDocuments':getAssistantDocuments,'uploadAssistantAvatar':uploadAssistantAvatar};