'use strict';const _0x37d468=_0x7772;(function(_0x42a367,_0x374c96){const _0x3b04d1=_0x7772,_0x15f769=_0x42a367();while(!![]){try{const _0x259be9=-parseInt(_0x3b04d1(0x160))/0x1*(-parseInt(_0x3b04d1(0xfb))/0x2)+parseInt(_0x3b04d1(0x159))/0x3+parseInt(_0x3b04d1(0x137))/0x4*(-parseInt(_0x3b04d1(0x10f))/0x5)+-parseInt(_0x3b04d1(0x162))/0x6+-parseInt(_0x3b04d1(0x170))/0x7*(-parseInt(_0x3b04d1(0xe1))/0x8)+parseInt(_0x3b04d1(0x112))/0x9*(parseInt(_0x3b04d1(0xff))/0xa)+-parseInt(_0x3b04d1(0x140))/0xb;if(_0x259be9===_0x374c96)break;else _0x15f769['push'](_0x15f769['shift']());}catch(_0x3898cc){_0x15f769['push'](_0x15f769['shift']());}}}(_0x2068,0xe2a88));const os=require('os'),nconf=require(_0x37d468(0x14c)),winston=require('winston'),util=require(_0x37d468(0x164)),validator=require(_0x37d468(0xec)),cookieParser=require('cookie-parser')(nconf[_0x37d468(0xce)](_0x37d468(0x151))),db=require('../database'),user=require(_0x37d468(0x15d)),logger=require(_0x37d468(0x120)),plugins=require(_0x37d468(0x146)),ratelimit=require(_0x37d468(0x124)),Namespaces=Object['create'](null),Sockets=module[_0x37d468(0x118)];Sockets[_0x37d468(0x163)]=async function(_0x106163){const _0x42b4b6=_0x37d468,_0x53f983={'OuejM':_0x42b4b6(0x130),'qLliQ':_0x42b4b6(0xf3),'dnqfj':_0x42b4b6(0x16d),'YiUvw':_0x42b4b6(0x10d),'JYRBV':'websocket','RZycj':function(_0x1cf815,_0x2babed){return _0x1cf815!==_0x2babed;},'SaqXX':_0x42b4b6(0x13e),'UhiZT':_0x42b4b6(0x10b),'nHcBv':_0x42b4b6(0x14b)};requireModules();const _0x304140=require(_0x53f983[_0x42b4b6(0x13c)])['Server'],_0x642b8e=new _0x304140({'path':nconf['get'](_0x53f983[_0x42b4b6(0x11d)])+_0x42b4b6(0x155)});if(nconf['get']('isCluster')){if(nconf[_0x42b4b6(0xce)](_0x42b4b6(0x115))){const _0x2f5349=await require(_0x42b4b6(0xe5))[_0x42b4b6(0x171)]();_0x642b8e['adapter'](_0x2f5349);}else winston['warn'](_0x53f983[_0x42b4b6(0xfc)]);}_0x642b8e[_0x42b4b6(0x102)](authorize),_0x642b8e['on'](_0x42b4b6(0xfd),onConnection);const _0x231cc0={'transports':nconf[_0x42b4b6(0xce)](_0x53f983[_0x42b4b6(0x113)])||[_0x42b4b6(0x143),_0x53f983['JYRBV']],'cookie':![]};if(_0x53f983['RZycj'](process[_0x42b4b6(0x148)]['NODE_ENV'],_0x42b4b6(0xf9))||nconf[_0x42b4b6(0xce)](_0x53f983[_0x42b4b6(0x101)])){const _0x3969eb=nconf[_0x42b4b6(0xce)](_0x42b4b6(0x103));_0x231cc0[_0x42b4b6(0x141)]=nconf[_0x42b4b6(0xce)](_0x53f983['SaqXX'])||{'origin':_0x3969eb,'methods':[_0x53f983[_0x42b4b6(0x16f)],'POST'],'allowedHeaders':[_0x53f983[_0x42b4b6(0x109)]]},winston['info'](_0x42b4b6(0x12a)+_0x3969eb);}_0x642b8e['listen'](_0x106163,_0x231cc0),Sockets[_0x42b4b6(0x116)]=_0x642b8e;};function onConnection(_0x3b472e){const _0x3f2319=_0x37d468,_0x1a44ab={'gaZUM':function(_0x28dddf,_0x3b4faa){return _0x28dddf(_0x3b4faa);},'GmePv':'x-forwarded-for'};_0x3b472e['ip']=(_0x3b472e['request'][_0x3f2319(0x14e)][_0x1a44ab['GmePv']]||_0x3b472e['request'][_0x3f2319(0xfd)]['remoteAddress']||'')[_0x3f2319(0xee)](',')[0x0],_0x3b472e['request']['ip']=_0x3b472e['ip'],logger[_0x3f2319(0x16c)](_0x3b472e,_0x3b472e['uid']),onConnect(_0x3b472e),_0x3b472e[_0x3f2319(0x161)]((_0x25dee3,..._0x196fcf)=>{const _0x52410b=_0x3f2319,_0x217cd5={'data':[_0x25dee3][_0x52410b(0x174)](_0x196fcf)},_0x5b9ed1=require('../als');_0x5b9ed1[_0x52410b(0xed)]({'uid':_0x3b472e['uid']},onMessage,_0x3b472e,_0x217cd5);}),_0x3b472e['on'](_0x3f2319(0xdd),()=>{const _0x523735=_0x3f2319;_0x1a44ab[_0x523735(0x11a)](onDisconnect,_0x3b472e);});}function onDisconnect(_0x93ee3f){const _0x456d00=_0x37d468,_0x373d0f={'exeQJ':function(_0x151562,_0x9e93f1){return _0x151562(_0x9e93f1);},'FAaAL':'action:sockets.disconnect'};_0x373d0f[_0x456d00(0x167)](require,_0x456d00(0xf7))[_0x456d00(0x12d)](_0x93ee3f['id']),plugins[_0x456d00(0xdb)][_0x456d00(0x12c)](_0x373d0f['FAaAL'],{'socket':_0x93ee3f});}async function onConnect(_0x2c8231){const _0xe4498a=_0x37d468,_0x254da3={'AcGBm':_0xe4498a(0x165),'cnMOR':_0xe4498a(0x121),'EQKCj':_0xe4498a(0x12e),'NGWfZ':function(_0x31ae6c,_0x406ed4){return _0x31ae6c===_0x406ed4;},'HpiQD':function(_0x5523d5,_0x4dfd8a){return _0x5523d5!==_0x4dfd8a;},'pesLO':'dVwLl','jHtlv':_0xe4498a(0x172),'zSpOG':_0xe4498a(0x152)};try{await validateSession(_0x2c8231,_0x254da3[_0xe4498a(0x149)]);}catch(_0x2f32d4){if(_0xe4498a(0x11f)===_0xe4498a(0x11f)){_0x254da3[_0xe4498a(0x106)](_0x2f32d4[_0xe4498a(0x11c)],_0x254da3[_0xe4498a(0x149)])&&_0x2c8231[_0xe4498a(0x134)](_0x254da3[_0xe4498a(0x12f)]);return;}else _0x1d7d19[_0xe4498a(0x134)](_0x254da3['AcGBm']);}_0x2c8231['uid']?_0x254da3[_0xe4498a(0x14d)](_0x254da3[_0xe4498a(0xf2)],_0xe4498a(0x15b))?(_0x2c8231[_0xe4498a(0x157)](_0xe4498a(0x16a)+_0x2c8231[_0xe4498a(0x10c)]),_0x2c8231[_0xe4498a(0x157)](_0x254da3[_0xe4498a(0x145)])):(_0xddefb8['join']('uid_'+_0x187d16[_0xe4498a(0x10c)]),_0x2b145a[_0xe4498a(0x157)](_0x254da3[_0xe4498a(0x145)])):_0x2c8231[_0xe4498a(0x157)](_0xe4498a(0xf5)),_0x2c8231[_0xe4498a(0x157)](_0xe4498a(0x126)+_0x2c8231[_0xe4498a(0x11e)][_0xe4498a(0x111)][nconf[_0xe4498a(0xce)](_0xe4498a(0x100))]),_0x2c8231[_0xe4498a(0x134)](_0xe4498a(0x175),_0x2c8231[_0xe4498a(0x10c)]),_0x2c8231[_0xe4498a(0x134)](_0x254da3[_0xe4498a(0xfe)],os[_0xe4498a(0x117)]()),plugins[_0xe4498a(0xdb)]['fire'](_0x254da3['zSpOG'],{'socket':_0x2c8231});}async function onMessage(_0x130770,_0x13e27){const _0x55ab1e=_0x37d468,_0x4a8b62={'MmoUW':function(_0x253746,_0x437e68){return _0x253746!==_0x437e68;},'nEXSx':function(_0x5a1b39,_0x54ce16,_0xd4c2b2){return _0x5a1b39(_0x54ce16,_0xd4c2b2);},'yTMQe':_0x55ab1e(0x135),'LEXmd':function(_0x6844a2,_0xb153c){return _0x6844a2===_0xb153c;},'xDiqa':function(_0x310ab0,_0x3a714e){return _0x310ab0!==_0x3a714e;},'VhCLl':_0x55ab1e(0x108),'PmjeI':_0x55ab1e(0xe8),'GVEWy':_0x55ab1e(0xf9),'qaKhC':function(_0x1153bd,_0x1a3bfb){return _0x1153bd(_0x1a3bfb);},'uWdfX':_0x55ab1e(0x122),'LJvRy':function(_0x218bfc,_0x467c91,_0x155c14){return _0x218bfc(_0x467c91,_0x155c14);}};if(!_0x13e27[_0x55ab1e(0xf4)][_0x55ab1e(0x147)])return winston[_0x55ab1e(0x10a)](_0x4a8b62[_0x55ab1e(0x15a)]);const _0x2178c9=_0x13e27[_0x55ab1e(0xf4)][0x0],_0x32b8f3=_0x4a8b62['LEXmd'](typeof _0x13e27['data'][0x1],'function')?{}:_0x13e27['data'][0x1],_0x104d6d=typeof _0x13e27[_0x55ab1e(0xf4)][_0x13e27[_0x55ab1e(0xf4)][_0x55ab1e(0x147)]-0x1]==='function'?_0x13e27[_0x55ab1e(0xf4)][_0x13e27[_0x55ab1e(0xf4)][_0x55ab1e(0x147)]-0x1]:function(){};if(!_0x2178c9)return winston[_0x55ab1e(0x10a)](_0x55ab1e(0x132));if(_0x4a8b62[_0x55ab1e(0x166)](typeof _0x2178c9,_0x4a8b62['VhCLl'])){const _0x164a1d=validator[_0x55ab1e(0xe7)](String(_0x2178c9));return _0x104d6d({'message':_0x55ab1e(0xd4)+_0x164a1d+']]'});}const _0xea7f85=_0x2178c9['split']('.'),_0x3120f0=_0xea7f85[0x0],_0x94d72c=_0xea7f85[_0x55ab1e(0x144)]((_0x4bbb1d,_0x159ec7)=>{const _0xf12f37=_0x55ab1e;if(_0x4a8b62[_0xf12f37(0x13d)](_0x4bbb1d,null)&&_0x4bbb1d[_0x159ec7]&&(!_0x4bbb1d[_0xf12f37(0xeb)]||_0x4bbb1d[_0xf12f37(0xeb)](_0x159ec7)))return _0x4bbb1d[_0x159ec7];return null;},Namespaces);if(!_0x94d72c||_0x4a8b62[_0x55ab1e(0x166)](typeof _0x94d72c,_0x4a8b62[_0x55ab1e(0x13f)])){process['env'][_0x55ab1e(0xef)]===_0x4a8b62[_0x55ab1e(0xe4)]&&winston['warn']('[socket.io]\x20Unrecognized\x20message:\x20'+_0x2178c9);const _0x4c3757=validator[_0x55ab1e(0xe7)](String(_0x2178c9));return _0x4a8b62[_0x55ab1e(0xe3)](_0x104d6d,{'message':_0x55ab1e(0xd4)+_0x4c3757+']]'});}_0x130770[_0x55ab1e(0x15f)]=_0x130770[_0x55ab1e(0x15f)]||[],_0x130770['previousEvents'][_0x55ab1e(0x173)](_0x2178c9);_0x130770[_0x55ab1e(0x15f)][_0x55ab1e(0x147)]>0x14&&_0x130770[_0x55ab1e(0x15f)][_0x55ab1e(0x123)]();if(!_0x2178c9[_0x55ab1e(0x169)](_0x55ab1e(0xfa))&&ratelimit['isFlooding'](_0x130770))return winston[_0x55ab1e(0x10a)](_0x55ab1e(0x14a)+_0x130770[_0x55ab1e(0x10c)]+_0x55ab1e(0x125)+_0x130770[_0x55ab1e(0x15f)]),_0x130770[_0x55ab1e(0xdd)]();try{await checkMaintenance(_0x130770),await _0x4a8b62[_0x55ab1e(0x16b)](validateSession,_0x130770,_0x4a8b62[_0x55ab1e(0x168)]);Namespaces[_0x3120f0][_0x55ab1e(0xdf)]&&await Namespaces[_0x3120f0][_0x55ab1e(0xdf)](_0x130770,_0x2178c9,_0x32b8f3);if(_0x94d72c[_0x55ab1e(0x107)]&&_0x94d72c['constructor'][_0x55ab1e(0x104)]===_0x55ab1e(0x110)){const _0x3b5c9b=await _0x94d72c(_0x130770,_0x32b8f3);_0x4a8b62[_0x55ab1e(0xd1)](_0x104d6d,null,_0x3b5c9b);}else _0x94d72c(_0x130770,_0x32b8f3,(_0x2fa802,_0x4309ee)=>{const _0x540c0a=_0x55ab1e;_0x4a8b62[_0x540c0a(0x16b)](_0x104d6d,_0x2fa802?{'message':_0x2fa802['message']}:null,_0x4309ee);});}catch(_0x8c9160){winston[_0x55ab1e(0xe9)](_0x2178c9+'\x0a'+(_0x8c9160[_0x55ab1e(0xe0)]?_0x8c9160[_0x55ab1e(0xe0)]:_0x8c9160[_0x55ab1e(0x11c)])),_0x104d6d({'message':_0x8c9160[_0x55ab1e(0x11c)]});}}function requireModules(){const _0x5d4216=_0x37d468,_0x198a57={'PLVOV':_0x5d4216(0x138),'ZRIpC':_0x5d4216(0x13b),'NBenD':'notifications','hTfUl':_0x5d4216(0xd9),'MhBVE':'user'},_0x215670=[_0x198a57[_0x5d4216(0xd8)],_0x5d4216(0x15c),_0x5d4216(0x142),_0x5d4216(0x12b),_0x198a57[_0x5d4216(0x16e)],_0x198a57[_0x5d4216(0x136)],_0x5d4216(0x131),_0x198a57[_0x5d4216(0x105)],'topics',_0x198a57['MhBVE'],'blacklist',_0x5d4216(0xdc)];_0x215670['forEach'](_0x2859bb=>{Namespaces[_0x2859bb]=require('./'+_0x2859bb);});}function _0x2068(){const _0x2308da=['event:deprecated_call','rooms','[socket.io]\x20Restricting\x20access\x20to\x20origin:\x20','meta','fire','clear','[[error:invalid-session]]','AcGBm','socket.io','plugins','[socket.io]\x20Empty\x20method\x20name','maintenanceMode','emit','[socket.io]\x20Empty\x20payload','NBenD','1400524nTmYOI','admin','passport','../meta','modules','OuejM','MmoUW','socket.io:cors','PmjeI','32775050VkfPTx','cors','groups','polling','reduce','cnMOR','../plugins','length','env','EQKCj','[socket.io]\x20Too\x20many\x20emits!\x20Disconnecting\x20uid\x20:\x20','content-type','nconf','HpiQD','headers','NodeBB','user','secret','action:sockets.connect','warnDeprecated','filter:sockets.sessionId','/socket.io','fnlSU','join','[[error:not-authorized]]','718332oNMULp','yTMQe','VFolo','categories','../user','uKIjk','previousEvents','267fqVGVu','onAny','2445960Yunflx','init','util','event:invalid_session','xDiqa','exeQJ','uWdfX','startsWith','uid_','nEXSx','io_one','clustering\x20detected,\x20you\x20should\x20setup\x20redis!','ZRIpC','UhiZT','2026234OcmXic','socketAdapter','setHostname','push','concat','checkSession','get','config','getUserSocketCount','LJvRy','size','sessionStore','[[error:invalid-event,\x20','UhtjG','\x0a\x20\x20\x20\x20\x20use\x20','slice','PLVOV','posts','title','hooks','uploads','disconnect','GgJqb','before','stack','40yCczQH','HNVdM','qaKhC','GVEWy','../database/redis','getCountInRoom','escape','function','error','BFJAv','hasOwnProperty','validator','run','split','NODE_ENV','yTpDs','kpveq','pesLO','relative_path','data','online_guests','AHmWz','./uploads','promisify','development','admin.','10290ZNMfXL','dnqfj','connection','jHtlv','6360uGBhWe','sessionKey','SaqXX','use','socket.io:origins','name','hTfUl','NGWfZ','constructor','string','nHcBv','warn','GET','uid','socket.io:transports','sockets','5UbWyZK','AsyncFunction','signedCookies','22716tDhRSf','YiUvw','zSTfm','redis','server','hostname','exports','session','gaZUM','YoWNO','message','qLliQ','request','dEVre','../logger','online_users','[[error:revalidate-failure]]','shift','../middleware/ratelimit','.\x20Events\x20:\x20','sess_','LJWVs'];_0x2068=function(){return _0x2308da;};return _0x2068();}async function checkMaintenance(_0x279a29){const _0x2d6096=_0x37d468,_0x27409b={'flAqd':_0x2d6096(0x165),'BFJAv':function(_0x2b3671,_0x205251){return _0x2b3671(_0x205251);},'zSTfm':_0x2d6096(0x13a),'HNVdM':_0x2d6096(0xde),'uKIjk':function(_0x999d72,_0x3c321a){return _0x999d72(_0x3c321a);},'fnlSU':_0x2d6096(0xec)},_0x330ad5=_0x27409b[_0x2d6096(0xea)](require,_0x27409b[_0x2d6096(0x114)]);if(!_0x330ad5[_0x2d6096(0xcf)][_0x2d6096(0x133)])return;const _0x262a37=await user['isAdministrator'](_0x279a29[_0x2d6096(0x10c)]);if(_0x262a37){if(_0x27409b[_0x2d6096(0xe2)]!==_0x2d6096(0xd5))return;else{_0x1f0b07[_0x2d6096(0x11c)]===_0x2d6096(0x12e)&&_0x39134b[_0x2d6096(0x134)](_0x27409b['flAqd']);return;}}const _0x385b0e=_0x27409b[_0x2d6096(0x15e)](require,_0x27409b[_0x2d6096(0x156)]);throw new Error('[[pages:maintenance.text,\x20'+_0x385b0e[_0x2d6096(0xe7)](_0x27409b['BFJAv'](String,_0x330ad5[_0x2d6096(0xcf)][_0x2d6096(0xda)]||_0x2d6096(0x14f)))+']]');}const getSessionAsync=util[_0x37d468(0xf8)]((_0x4deeee,_0x3d6a29)=>db[_0x37d468(0xd3)][_0x37d468(0xce)](_0x4deeee,(_0x1d165c,_0x1be546)=>_0x3d6a29(_0x1d165c,_0x1be546||null)));function _0x7772(_0x141c6e,_0x22c9ec){const _0x206872=_0x2068();return _0x7772=function(_0x7772d,_0x5788d2){_0x7772d=_0x7772d-0xce;let _0x32a5b7=_0x206872[_0x7772d];return _0x32a5b7;},_0x7772(_0x141c6e,_0x22c9ec);}async function validateSession(_0x4c48b0,_0x13148d){const _0x17ac1e=_0x37d468,_0x56b97a={'KrHPQ':function(_0x188e3e,_0x107c40){return _0x188e3e!==_0x107c40;},'YoWNO':_0x17ac1e(0xf6)},_0x2896a4=_0x4c48b0['request'],{sessionId:_0xa06800}=await plugins[_0x17ac1e(0xdb)][_0x17ac1e(0x12c)](_0x17ac1e(0x154),{'sessionId':_0x2896a4[_0x17ac1e(0x111)]?_0x2896a4[_0x17ac1e(0x111)][nconf[_0x17ac1e(0xce)](_0x17ac1e(0x100))]:null,'request':_0x2896a4});if(!_0xa06800)return;const _0x2802a0=await getSessionAsync(_0xa06800);if(!_0x2802a0){if(_0x56b97a['KrHPQ'](_0x56b97a[_0x17ac1e(0x11b)],_0x17ac1e(0xf6)))return _0x222aaf['warn']('[socket.io]\x20Empty\x20payload');else throw new Error(_0x13148d);}await plugins['hooks']['fire']('static:sockets.validateSession',{'req':_0x2896a4,'socket':_0x4c48b0,'session':_0x2802a0});}const cookieParserAsync=util[_0x37d468(0xf8)]((_0x19e30a,_0x232588)=>cookieParser(_0x19e30a,{},_0x58001a=>_0x232588(_0x58001a)));async function authorize(_0x2a2da5,_0x518f57){const _0x323b4b=_0x37d468,_0x4d249e={'kpveq':function(_0x5e8949,_0x44e920){return _0x5e8949(_0x44e920);},'yTpDs':_0x323b4b(0x154),'LJWVs':function(_0x306489,_0x3259c9,_0x55f2d8){return _0x306489(_0x3259c9,_0x55f2d8);},'VPmPb':function(_0x12c2ff){return _0x12c2ff();}},{request:_0x2d5451}=_0x2a2da5;if(!_0x2d5451)return _0x4d249e[_0x323b4b(0xf1)](_0x518f57,new Error(_0x323b4b(0x158)));await cookieParserAsync(_0x2d5451);const {sessionId:_0x261eaa}=await plugins[_0x323b4b(0xdb)][_0x323b4b(0x12c)](_0x4d249e[_0x323b4b(0xf0)],{'sessionId':_0x2d5451[_0x323b4b(0x111)]?_0x2d5451[_0x323b4b(0x111)][nconf['get'](_0x323b4b(0x100))]:null,'request':_0x2d5451}),_0x595bec=await getSessionAsync(_0x261eaa);_0x595bec&&_0x595bec[_0x323b4b(0x139)]&&_0x595bec['passport']['user']?(_0x2d5451[_0x323b4b(0x119)]=_0x595bec,_0x2a2da5['uid']=_0x4d249e[_0x323b4b(0x127)](parseInt,_0x595bec[_0x323b4b(0x139)][_0x323b4b(0x150)],0xa)):_0x2a2da5[_0x323b4b(0x10c)]=0x0,_0x2d5451[_0x323b4b(0x10c)]=_0x2a2da5[_0x323b4b(0x10c)],_0x4d249e['VPmPb'](_0x518f57);}Sockets['in']=function(_0x232254){const _0xc24c25=_0x37d468;return Sockets[_0xc24c25(0x116)]&&Sockets['server']['in'](_0x232254);},Sockets[_0x37d468(0xd0)]=function(_0x187dd8){const _0x26578b=_0x37d468;return Sockets[_0x26578b(0xe6)](_0x26578b(0x16a)+_0x187dd8);},Sockets['getCountInRoom']=function(_0x26b27b){const _0x388f31=_0x37d468;if(!Sockets[_0x388f31(0x116)])return 0x0;const _0x406d98=Sockets[_0x388f31(0x116)][_0x388f31(0x10e)]['adapter'][_0x388f31(0x129)][_0x388f31(0xce)](_0x26b27b);return _0x406d98?_0x406d98[_0x388f31(0xd2)]:0x0;},Sockets[_0x37d468(0x153)]=(_0x374dc7,_0x19aeec)=>{const _0x39f9d0=_0x37d468;_0x374dc7[_0x39f9d0(0x15f)]&&_0x374dc7[_0x39f9d0(0x134)]&&_0x374dc7[_0x39f9d0(0x134)](_0x39f9d0(0x128),{'eventName':_0x374dc7[_0x39f9d0(0x15f)][_0x374dc7[_0x39f9d0(0x15f)][_0x39f9d0(0x147)]-0x1],'replacement':_0x19aeec}),winston[_0x39f9d0(0x10a)]('[deprecated]\x0a\x20'+new Error('-')[_0x39f9d0(0xe0)]['split']('\x0a')[_0x39f9d0(0xd7)](0x2,0x5)['join']('\x0a')+_0x39f9d0(0xd6)+_0x19aeec);};