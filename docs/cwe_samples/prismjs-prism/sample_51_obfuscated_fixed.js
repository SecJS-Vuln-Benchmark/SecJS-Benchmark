(function(_0x168b52,_0x375504){const _0x5ed75b=_0x1a0e,_0x410f12=_0x168b52();while(!![]){try{const _0x5e35ff=parseInt(_0x5ed75b(0xad))/0x1*(parseInt(_0x5ed75b(0x87))/0x2)+parseInt(_0x5ed75b(0x90))/0x3+-parseInt(_0x5ed75b(0xb1))/0x4+-parseInt(_0x5ed75b(0xa6))/0x5+parseInt(_0x5ed75b(0xb9))/0x6*(parseInt(_0x5ed75b(0xaf))/0x7)+parseInt(_0x5ed75b(0x98))/0x8*(parseInt(_0x5ed75b(0x9b))/0x9)+-parseInt(_0x5ed75b(0x95))/0xa;if(_0x5e35ff===_0x375504)break;else _0x410f12['push'](_0x410f12['shift']());}catch(_0x2880cf){_0x410f12['push'](_0x410f12['shift']());}}}(_0x30fa,0x4da21));import{ApolloServer,UserInputError}from'apollo-server-express';import{ApolloServerPluginLandingPageGraphQLPlayground,ApolloServerPluginLandingPageDisabled}from'apollo-server-core';import{formatError as _0x102bf1}from'apollo-errors';function _0x1a0e(_0x1e3e25,_0x22f302){const _0x30fa24=_0x30fa();return _0x1a0e=function(_0x1a0e40,_0x485f35){_0x1a0e40=_0x1a0e40-0x77;let _0x120788=_0x30fa24[_0x1a0e40];return _0x120788;},_0x1a0e(_0x1e3e25,_0x22f302);}import{ApolloArmor}from'@escape.tech/graphql-armor';import{dissocPath}from'ramda';import{createValidation as _0x34fbc7}from'graphql-no-alias';import _0xdd6d5 from'graphql-constraint-directive/lib/error';import{constraintDirectiveDocumentation,createApolloQueryValidationPlugin}from'graphql-constraint-directive';import{GraphQLError}from'graphql/error';import _0x4780d5 from'./schema';function _0x30fa(){const _0x268b28=['MWrPq','cYfXO','AUnJh','eyldc','7006TdDMqa','include','includes','__schema\x20{','/static','eIwBh','epbsF','opencti-event-id','app:graphql:batching_protection:query_subtypes','1332852ZvdSJJ','kHiOY','req','validationRules','workId','6266200QVBhVl','yMZRW','previous-standard','184Tftvjf','TwUtr','Btoqz','145206RvAIiw','TQCac','nGsaY','GraphQL\x20introspection\x20not\x20authorized!','error','trim','ikkNe','ZdTWa','user','TusiQ','exception','2723110UrNoCH','api','rdByC','get','synchronizedUpsert','nuXJb','push','111JsmWFJ','true','385XMBTWd','extensions','903028BJYFRh','VsBot','mTFwa','some','CGasy','__type\x20{','query','headers','55722IJJCyz','res','jCoty','rDFix','protect','ixMlN','opencti-work-id','app:graphql:batching_protection:mutation_default','plugins','nJybO','originalError','LNpsw','Value\x20cannot\x20have\x20only\x20whitespace(s)','YJMCf'];_0x30fa=function(){return _0x268b28;};return _0x30fa();}import _0x349d8c,{basePath,DEV_MODE,PLAYGROUND_INTROSPECTION_DISABLED,ENABLED_TRACING,PLAYGROUND_ENABLED,GRAPHQL_ARMOR_ENABLED,logApp}from'../config/conf';import{authenticateUserFromRequest,userWithOrigin}from'../domain/user';import{ForbiddenAccess,ValidationError}from'../config/errors';import _0x525960 from'./loggerPlugin';import _0xc81bf5 from'./telemetryPlugin';import _0x5f51ec from'./httpResponsePlugin';import{executionContext}from'../utils/access';const createApolloServer=()=>{const _0x134252=_0x1a0e,_0x275eaa={'xaoSJ':_0x134252(0xa8),'nJybO':function(_0x387785,_0x92428c){return _0x387785===_0x92428c;},'nuXJb':function(_0x187f96,_0x553d72){return _0x187f96===_0x553d72;},'yMZRW':_0x134252(0xa2),'VsBot':_0x134252(0x81),'epbsF':function(_0x43f88b,_0x4c00cd){return _0x43f88b(_0x4c00cd);},'MWrPq':function(_0x32e306,_0x5910dc){return _0x32e306||_0x5910dc;},'YJMCf':function(_0x991821,_0x85c052){return _0x991821(_0x85c052);},'TQCac':_0x134252(0x9e),'TLMqc':_0x134252(0x7b),'AEAXs':_0x134252(0x97),'rDFix':'synchronized-upsert','ixMlN':function(_0x42e6b3,_0x5489ca){return _0x42e6b3(_0x5489ca);},'kHiOY':function(_0x5e9467,_0x4c348e){return _0x5e9467 instanceof _0x4c348e;},'eyldc':'Btoqz','TwUtr':function(_0x4da28f,_0x555b5a){return _0x4da28f(_0x555b5a);},'nGsaY':function(_0x47706a){return _0x47706a();},'eIwBh':'app:graphql:batching_protection:query_default','CGasy':function(_0x5e4c7f,_0x5af8e7){return _0x5e4c7f(_0x5af8e7);},'jCoty':'OpenCTI\x20Playground','pcexM':function(_0x57c315,_0xe095e7){return _0x57c315(_0xe095e7);},'TusiQ':_0x134252(0x8a),'AUnJh':'__schema(','mTFwa':_0x134252(0xb6)};let _0x1fb708=_0x4780d5();const _0x234694={'not-blank':_0x3aa0ab=>{const _0xcd2bf3=_0x134252,_0x2960d6={'ikkNe':function(_0x1a6874,_0x5dc36b){return _0x1a6874(_0x5dc36b);}};if(_0x275eaa['xaoSJ']!=='rdByC'){if(!_0x2790bf||_0x57de8d||!_0x2d49df['user'])throw _0x2960d6[_0xcd2bf3(0xa1)](_0x54d50c,_0xcd2bf3(0x9e));}else{if(_0x3aa0ab['length']>0x0&&_0x275eaa[_0xcd2bf3(0x7e)](_0x3aa0ab[_0xcd2bf3(0xa0)](),'')){if(_0x275eaa[_0xcd2bf3(0xab)]('ZdTWa',_0x275eaa[_0xcd2bf3(0x96)]))throw new GraphQLError(_0x275eaa[_0xcd2bf3(0xb2)]);else{const _0x3b194f=new _0x1e9ce0({'blockFieldSuggestion':{'enabled':!![]},'costLimit':{'maxCost':0x2710},'maxAliases':{'enabled':![]},'maxDepth':{'n':0x14},'maxDirectives':{'n':0x32},'maxTokens':{'n':0x7d0}}),_0x105a13=_0x3b194f[_0xcd2bf3(0x79)]();_0x54c4bb['push'](..._0x105a13[_0xcd2bf3(0x7d)]),_0x480508[_0xcd2bf3(0xac)](..._0x105a13['validationRules']);}}return!![];}}},_0x10b18f=createApolloQueryValidationPlugin({'schema':_0x1fb708},{'formats':_0x234694});_0x1fb708=_0x275eaa[_0x134252(0x9d)](constraintDirectiveDocumentation)(_0x1fb708);const _0x37cac9=[_0x525960,_0x5f51ec,_0x10b18f],_0x4b0137={'Query':{'*':_0x349d8c['get'](_0x275eaa[_0x134252(0x8c)])??0x2,'subTypes':_0x349d8c['get'](_0x134252(0x8f))??0x4},'Mutation':{'*':_0x349d8c[_0x134252(0xa9)](_0x134252(0x7c))??0x1,'token':0x1}},{validation:_0x4cba99}=_0x275eaa[_0x134252(0xb5)](_0x34fbc7,{'permissions':_0x4b0137}),_0x567b28=[_0x4cba99];if(GRAPHQL_ARMOR_ENABLED){const _0x4817e1=new ApolloArmor({'blockFieldSuggestion':{'enabled':!![]},'costLimit':{'maxCost':0x2710},'maxAliases':{'enabled':![]},'maxDepth':{'n':0x14},'maxDirectives':{'n':0x32},'maxTokens':{'n':0x7d0}}),_0x80a99d=_0x4817e1[_0x134252(0x79)]();_0x37cac9['push'](..._0x80a99d['plugins']),_0x567b28[_0x134252(0xac)](..._0x80a99d[_0x134252(0x93)]);}const _0x19ed4e=DEV_MODE?{'settings':{'request.credentials':_0x134252(0x88)}}:{'cdnUrl':basePath+_0x134252(0x8b),'title':_0x275eaa[_0x134252(0x77)],'faviconUrl':basePath+'/static/@apollographql/graphql-playground-react@1.7.42/build/static/favicon.png','settings':{'request.credentials':_0x134252(0x88)}},_0x5f44f3=_0x275eaa['pcexM'](ApolloServerPluginLandingPageGraphQLPlayground,_0x19ed4e);_0x37cac9[_0x134252(0xac)](PLAYGROUND_ENABLED?_0x5f44f3:_0x275eaa[_0x134252(0x9d)](ApolloServerPluginLandingPageDisabled));const _0x4c1a2e=[_0x275eaa[_0x134252(0xa4)],_0x275eaa[_0x134252(0x85)],_0x275eaa[_0x134252(0xb3)],'__type('],_0x2c9374={'requestDidStart':({request:_0x3fd039,context:_0x634c50})=>{const _0x5ef203=_0x134252,_0x698998={'ftQxS':function(_0x2a91b1,_0x25762d){const _0x192825=_0x1a0e;return _0x275eaa[_0x192825(0x8d)](_0x2a91b1,_0x25762d);},'LNpsw':'GraphQL\x20introspection\x20not\x20authorized!'};if(_0x5ef203(0x84)!=='aHawp'){if(_0x4c1a2e[_0x5ef203(0xb4)](_0xb43f0f=>_0x3fd039[_0x5ef203(0xb7)][_0x5ef203(0x89)](_0xb43f0f))){if(_0x275eaa[_0x5ef203(0x83)](!PLAYGROUND_ENABLED,PLAYGROUND_INTROSPECTION_DISABLED)||!_0x634c50[_0x5ef203(0xa3)])throw _0x275eaa[_0x5ef203(0x82)](ForbiddenAccess,_0x275eaa[_0x5ef203(0x9c)]);}}else{if(_0xd4c3c7[_0x5ef203(0xb4)](_0xda394d=>_0x2d3a49[_0x5ef203(0xb7)][_0x5ef203(0x89)](_0xda394d))){if(!_0x79f4ae||_0x527101||!_0x3fa342['user'])throw _0x698998['ftQxS'](_0x362d30,_0x698998[_0x5ef203(0x80)]);}}}};_0x37cac9[_0x134252(0xac)](_0x2c9374);ENABLED_TRACING&&_0x37cac9[_0x134252(0xac)](_0xc81bf5);const _0xe1477a=new ApolloServer({'schema':_0x1fb708,'introspection':!![],'persistedQueries':![],'validationRules':_0x567b28,async 'context'({req:_0x565d38,res:_0x2ed22f}){const _0x2d2566=_0x134252,_0x220307=executionContext(_0x2d2566(0xa7));_0x220307[_0x2d2566(0x92)]=_0x565d38,_0x220307[_0x2d2566(0xba)]=_0x2ed22f,_0x220307[_0x2d2566(0x94)]=_0x565d38[_0x2d2566(0xb8)][_0x275eaa['TLMqc']],_0x220307['eventId']=_0x565d38[_0x2d2566(0xb8)][_0x2d2566(0x8e)],_0x220307['previousStandard']=_0x565d38['headers'][_0x275eaa['AEAXs']],_0x220307[_0x2d2566(0xaa)]=_0x565d38['headers'][_0x275eaa[_0x2d2566(0x78)]]===_0x2d2566(0xae);try{const _0x2b8d63=await authenticateUserFromRequest(_0x220307,_0x565d38,_0x2ed22f);_0x2b8d63&&(_0x220307[_0x2d2566(0xa3)]=userWithOrigin(_0x565d38,_0x2b8d63));}catch(_0x205dc9){logApp[_0x2d2566(0x9f)](_0x205dc9);}return _0x220307;},'tracing':DEV_MODE,'plugins':_0x37cac9,'formatError':_0x17f2e3=>{const _0xf8f396=_0x134252;let _0x1e9822=_0x275eaa[_0xf8f396(0x7a)](_0x102bf1,_0x17f2e3);if(_0x275eaa[_0xf8f396(0x91)](_0x1e9822,UserInputError)){if(_0x1e9822[_0xf8f396(0x7f)]instanceof _0xdd6d5){if(_0x275eaa['nuXJb'](_0xf8f396(0x9a),_0x275eaa[_0xf8f396(0x86)])){const {originalError:_0x221adf}=_0x1e9822[_0xf8f396(0x7f)],{fieldName:_0x5f265f}=_0x221adf,_0x182b8b=ValidationError(_0x5f265f,_0x221adf);_0x1e9822=_0x275eaa[_0xf8f396(0x99)](_0x102bf1,_0x182b8b);}else throw _0x252779(_0x275eaa['TQCac']);}}return DEV_MODE?_0x1e9822:dissocPath([_0xf8f396(0xb0),_0xf8f396(0xa5)],_0x1e9822);}});return{'schema':_0x1fb708,'apolloServer':_0xe1477a};};export default createApolloServer;