var _0x5715ba=_0x1ec9;function _0x5aa4(){var _0x5c0e59=['equals','tape','405s\x20on\x20everything\x20but\x20GET','hey,\x20now!','DELETE','plan','http://localhost:1666/file.txt','GET\x20/../index.js\x20HTTP/1.1\x0aHost:\x20localhost\x0auser-agent:\x20test/1.2.3\x0aaccept:\x20*/*\x0a\x0a','write','lbKLW','MeovQ','2446941tSeVeC','link\x20is\x20replaced\x20with\x20uriEncode','statusCode','KzSeW','wee\x0a','notOk','headers','text/html','gFlEK','forEach','9gmQbIv','gtfVK','trim','YbwHP','CloAK','test','serves\x20files\x20from\x20within\x20dot\x20dirs\x20by\x20default','push','data','toString','POST','2171226dfdhuo','eFWCY','end','fFtLt','Socket','HTTP/1.1\x20403\x20Forbidden','get','sanitizes\x20filenames','rJYaB','./test/glance-test','4521190mtrcyO','vtfVT','IXFHz','bind','connect','PUT','split','XeXrm','stop','strictEqual','bKoTf','http://localhost:1666/file%20with%20space.html','cfHPp','join','zixRf','content-type','localhost','827208wLfbDH','dZWQT','raw\x20image\x20tag\x20is\x20not\x20on\x20page','49BXBRby','tYsJK','doesNotThrow','http://localhost:1666/','403s\x20on\x20dir\x20list\x20if\x20configured','jzmmR','serves\x20plaintext\x20with\x20headers','doesnt\x20explode\x20immediately','TFepI','saWEi','119014fVgWMF','237528XacdTT','UlvkS','gMkwp','net','fails\x20if\x20path\x20traversal\x20with\x20conveniently-named\x20directory\x20is\x20attempted','FsXZM','/file.txt','http','1|4|0|2|3|5','Glqbk','13UcokcZ','aYnIs','8652530DTBABE','serves\x20index\x20page','http://localhost:1666/.test/whatever.txt','ZmndD','text/plain','jZkoq','start','szeMT','http://localhost:1666/test1/','hideindex','GET\x20/../glance-test-exploit/secret.txt\x20HTTP/1.1\x0aHost:\x20localhost\x0auser-agent:\x20test/1.2.3\x0aaccept:\x20*/*\x0a\x0a','request'];_0x5aa4=function(){return _0x5c0e59;};return _0x5aa4();}(function(_0x2253c6,_0x285002){var _0x3be7b5=_0x1ec9,_0xa21494=_0x2253c6();while(!![]){try{var _0x27a4b0=parseInt(_0x3be7b5(0x1b9))/0x1*(parseInt(_0x3be7b5(0x1ae))/0x2)+parseInt(_0x3be7b5(0x1d2))/0x3+-parseInt(_0x3be7b5(0x1af))/0x4+parseInt(_0x3be7b5(0x1f1))/0x5+-parseInt(_0x3be7b5(0x1e7))/0x6+parseInt(_0x3be7b5(0x205))/0x7*(-parseInt(_0x3be7b5(0x202))/0x8)+-parseInt(_0x3be7b5(0x1dc))/0x9*(parseInt(_0x3be7b5(0x1bb))/0xa);if(_0x27a4b0===_0x285002)break;else _0xa21494['push'](_0xa21494['shift']());}catch(_0x41e23f){_0xa21494['push'](_0xa21494['shift']());}}}(_0x5aa4,0x75f5b));var http=require(_0x5715ba(0x1b6)),net=require(_0x5715ba(0x1b2)),test=require(_0x5715ba(0x1c8)),glance=require('../'),glanceServer=glance({'port':0x682,'dir':_0x5715ba(0x1f0)});function _0x1ec9(_0x258847,_0x52da8f){var _0x5aa469=_0x5aa4();return _0x1ec9=function(_0x1ec956,_0x38de60){_0x1ec956=_0x1ec956-0x1a9;var _0x1a17d2=_0x5aa469[_0x1ec956];return _0x1a17d2;},_0x1ec9(_0x258847,_0x52da8f);}test(_0x5715ba(0x1ab),function(_0x2792af){var _0x1b9267=_0x5715ba;_0x2792af[_0x1b9267(0x1cc)](0x1),_0x2792af[_0x1b9267(0x207)](function(){var _0x3cfef=_0x1b9267;glanceServer[_0x3cfef(0x1c1)]();});}),test(_0x5715ba(0x1aa),function(_0x454d2b){var _0xd130f0=_0x5715ba,_0x59f025={'KzSeW':'WvOEv','bKoTf':'name\x20is\x20replaced\x20with\x20html\x20escape','aYnIs':_0xd130f0(0x1e8),'gFlEK':_0xd130f0(0x1be),'TFepI':_0xd130f0(0x1bf),'FsXZM':_0xd130f0(0x1cd)};http[_0xd130f0(0x1ed)](_0x59f025[_0xd130f0(0x1b4)],function(_0x3723e5){var _0x1a6432=_0xd130f0,_0x561c5d={'UlvkS':_0x59f025[_0x1a6432(0x1fb)],'cfHPp':'link\x20is\x20replaced\x20with\x20uriEncode'};if(_0x59f025[_0x1a6432(0x1ba)]===_0x59f025[_0x1a6432(0x1da)]){var _0x170c3e=_0x56fea3[_0x1a6432(0x1fe)]('');_0x357bc8[_0x1a6432(0x1d7)](/\<img/[_0x1a6432(0x1e1)](_0x170c3e),'raw\x20image\x20tag\x20is\x20not\x20on\x20page'),_0x3d7ee9['ok'](/\&lt;img/[_0x1a6432(0x1e1)](_0x170c3e),_0x561c5d[_0x1a6432(0x1b0)]),_0x4c4d85['ok'](/\%3Cimg/['test'](_0x170c3e),_0x561c5d[_0x1a6432(0x1fd)]);}else{_0x454d2b[_0x1a6432(0x1cc)](0x3);var _0x198cec='';_0x454d2b[_0x1a6432(0x1fa)](_0x3723e5[_0x1a6432(0x1d4)],0xc8),_0x454d2b['strictEqual'](_0x3723e5['headers']['content-type'],_0x59f025[_0x1a6432(0x1ac)]),_0x3723e5['on']('data',function(_0x4190c0){var _0x31857d=_0x1a6432;_0x31857d(0x1ff)!==_0x59f025[_0x31857d(0x1d5)]?_0x198cec+=_0x4190c0:(_0x50e3ac[_0x31857d(0x1cc)](0x1),_0x48a8d4[_0x31857d(0x207)](function(){var _0x5a1230=_0x31857d;_0x3d2716[_0x5a1230(0x1c1)]();}));}),_0x3723e5['on']('end',function(){var _0x347a46=_0x1a6432;_0x454d2b[_0x347a46(0x1fa)](_0x198cec,'howdy!');});}});}),test('deals\x20with\x20uri\x20encoding',function(_0x549a34){var _0x5ca9d1=_0x5715ba,_0x1dfde3={'vtfVT':_0x5ca9d1(0x1ca),'btlad':_0x5ca9d1(0x1b7),'szeMT':_0x5ca9d1(0x1d9),'MeovQ':'end','WCCoV':_0x5ca9d1(0x1fc)};http[_0x5ca9d1(0x1ed)](_0x1dfde3['WCCoV'],function(_0xeb88eb){var _0x1c5e8d=_0x5ca9d1,_0x435d47=_0x1dfde3['btlad'][_0x1c5e8d(0x1f7)]('|'),_0x148e05=0x0;while(!![]){switch(_0x435d47[_0x148e05++]){case'0':_0x549a34[_0x1c5e8d(0x1fa)](_0xeb88eb[_0x1c5e8d(0x1d4)],0xc8);continue;case'1':_0x549a34[_0x1c5e8d(0x1cc)](0x3);continue;case'2':_0x549a34[_0x1c5e8d(0x1fa)](_0xeb88eb[_0x1c5e8d(0x1d8)][_0x1c5e8d(0x200)],_0x1dfde3[_0x1c5e8d(0x1c2)]);continue;case'3':_0xeb88eb['on'](_0x1c5e8d(0x1e4),function(_0x2e2590){_0x3e605a+=_0x2e2590;});continue;case'4':var _0x3e605a='';continue;case'5':_0xeb88eb['on'](_0x1dfde3[_0x1c5e8d(0x1d1)],function(){var _0xb90b77=_0x1c5e8d;_0x549a34[_0xb90b77(0x1fa)](_0x3e605a,_0x1dfde3[_0xb90b77(0x1f2)]);});continue;}break;}});}),test('404s\x20on\x20file\x20not\x20found',function(_0xd5124b){var _0x2604b3=_0x5715ba,_0xbe8997={'XeXrm':'http://localhost:1666/nofile.md'};_0xd5124b[_0x2604b3(0x1cc)](0x1),http[_0x2604b3(0x1ed)](_0xbe8997[_0x2604b3(0x1f8)],function(_0x13797f){var _0x5ab895=_0x2604b3;_0xd5124b[_0x5ab895(0x1fa)](_0x13797f[_0x5ab895(0x1d4)],0x194);});}),test(_0x5715ba(0x209),function(_0x4ddd18){var _0x3716e1=_0x5715ba,_0x5995f8={'lbKLW':_0x3716e1(0x208)};_0x4ddd18[_0x3716e1(0x1cc)](0x1),glanceServer['hideindex']=!![],http['get'](_0x5995f8[_0x3716e1(0x1d0)],function(_0x277ea4){var _0xd42d6e=_0x3716e1;glanceServer[_0xd42d6e(0x1c4)]=![],_0x4ddd18['strictEqual'](_0x277ea4[_0xd42d6e(0x1d4)],0x193);});}),test('fails\x20if\x20path\x20traversal\x20is\x20attempted',function(_0x4e195f){var _0x548362=_0x5715ba,_0x543a82={'dZWQT':_0x548362(0x1ec),'FfJNR':'localhost'};_0x4e195f[_0x548362(0x1cc)](0x1);var _0x223c1c=new net[(_0x548362(0x1eb))]();_0x223c1c['connect'](0x682,_0x543a82['FfJNR'],function(){var _0x4d1b60=_0x548362;_0x223c1c['on'](_0x4d1b60(0x1e4),function(_0x460e83){var _0x9a17f7=_0x4d1b60,_0x2b65e0=_0x460e83[_0x9a17f7(0x1e5)]()[_0x9a17f7(0x1f7)]('\x0a')[0x0];_0x4e195f[_0x9a17f7(0x1c7)](_0x2b65e0[_0x9a17f7(0x1de)](),_0x543a82[_0x9a17f7(0x203)]),_0x223c1c[_0x9a17f7(0x1e9)]();}),_0x223c1c[_0x4d1b60(0x1cf)]('GET\x20/../index.js\x20HTTP/1.1\x0aHost:\x20localhost\x0auser-agent:\x20test/1.2.3\x0aaccept:\x20*/*\x0a\x0a');});}),test(_0x5715ba(0x1b3),function(_0x293889){var _0x2146f6=_0x5715ba,_0x39ec29={'jzmmR':function(_0x574eaa,_0x325b17){return _0x574eaa===_0x325b17;},'IXFHz':'gxBtP','BdXXe':'data','CloAK':_0x2146f6(0x201)};_0x293889[_0x2146f6(0x1cc)](0x1);var _0x421dae=new net['Socket']();_0x421dae[_0x2146f6(0x1f5)](0x682,_0x39ec29[_0x2146f6(0x1e0)],function(){var _0x167422=_0x2146f6;_0x39ec29[_0x167422(0x1a9)](_0x39ec29[_0x167422(0x1f3)],_0x39ec29[_0x167422(0x1f3)])?(_0x421dae['on'](_0x39ec29['BdXXe'],function(_0x305d40){var _0x2115ca=_0x167422,_0x44a2d9=_0x305d40[_0x2115ca(0x1e5)]()['split']('\x0a')[0x0];_0x293889[_0x2115ca(0x1c7)](_0x44a2d9[_0x2115ca(0x1de)](),'HTTP/1.1\x20403\x20Forbidden'),_0x421dae[_0x2115ca(0x1e9)]();}),_0x421dae[_0x167422(0x1cf)](_0x167422(0x1c5))):_0x307c86[_0x167422(0x1fa)](_0xeded35[_0x167422(0x1d4)],0x195);});}),test(_0x5715ba(0x1bc),function(_0x187670){var _0x223fbc=_0x5715ba,_0x1b2343={'OEIDQ':_0x223fbc(0x208)};_0x187670['plan'](0x2);var _0x35a6cb=[];http[_0x223fbc(0x1ed)](_0x1b2343['OEIDQ'],function(_0x15896d){var _0x18da89=_0x223fbc,_0x766b74={'ckiMf':_0x18da89(0x1d6)};_0x187670['strictEqual'](_0x15896d[_0x18da89(0x1d4)],0xc8),_0x15896d['on'](_0x18da89(0x1e4),_0x35a6cb[_0x18da89(0x1e3)][_0x18da89(0x1f4)](_0x35a6cb)),_0x15896d['on']('end',function(){_0x187670['strictEqual'](_0x35a6cb['join'](''),_0x766b74['ckiMf']);});});}),test(_0x5715ba(0x1c9),function(_0x4863f1){var _0xf60329=_0x5715ba,_0x105187={'saWEi':_0xf60329(0x201),'tYsJK':'Glqbk','fFtLt':_0xf60329(0x1e6)};_0x4863f1[_0xf60329(0x1cc)](0x3);var _0x206b7f=[_0x105187[_0xf60329(0x1ea)],_0xf60329(0x1cb),_0xf60329(0x1f6)];_0x206b7f[_0xf60329(0x1db)](function(_0xc574ae){var _0x1e61d0=_0xf60329;if(_0x105187[_0x1e61d0(0x206)]===_0x1e61d0(0x1b8)){var _0x39f049={'host':_0x105187[_0x1e61d0(0x1ad)],'port':0x682,'path':_0x1e61d0(0x1b5),'method':_0xc574ae},_0x42d9ad=http[_0x1e61d0(0x1c6)](_0x39f049,_0x109b63);_0x42d9ad[_0x1e61d0(0x1e9)]();}else{var _0x2c0c11={'YbwHP':_0x1e61d0(0x1ec)};_0x71c2bb[_0x1e61d0(0x1cc)](0x1);var _0xc2883=new _0x22b431[(_0x1e61d0(0x1eb))]();_0xc2883['connect'](0x682,_0x105187[_0x1e61d0(0x1ad)],function(){var _0x38e954=_0x1e61d0;_0xc2883['on'](_0x38e954(0x1e4),function(_0x2cb42f){var _0x44c4ad=_0x38e954,_0xd0867a=_0x2cb42f[_0x44c4ad(0x1e5)]()['split']('\x0a')[0x0];_0x3f3bd4[_0x44c4ad(0x1c7)](_0xd0867a[_0x44c4ad(0x1de)](),_0x2c0c11[_0x44c4ad(0x1df)]),_0xc2883[_0x44c4ad(0x1e9)]();}),_0xc2883[_0x38e954(0x1cf)](_0x38e954(0x1ce));});}});function _0x109b63(_0xfa5258){var _0x41e096=_0xf60329;_0x4863f1[_0x41e096(0x1fa)](_0xfa5258[_0x41e096(0x1d4)],0x195);}}),test(_0x5715ba(0x1e2),function(_0x1f2bc7){var _0x41fdd6=_0x5715ba,_0x512fb0={'jZkoq':_0x41fdd6(0x1bd),'gMkwp':'http://localhost:1666/test1/.test2/lol.txt'};_0x1f2bc7[_0x41fdd6(0x1cc)](0x2),http[_0x41fdd6(0x1ed)](_0x512fb0[_0x41fdd6(0x1c0)],function(_0x46ec1a){var _0x3e9c0b=_0x41fdd6;_0x1f2bc7[_0x3e9c0b(0x1fa)](_0x46ec1a[_0x3e9c0b(0x1d4)],0xc8);}),http[_0x41fdd6(0x1ed)](_0x512fb0[_0x41fdd6(0x1b1)],function(_0x2ccc88){var _0x51707c=_0x41fdd6;_0x1f2bc7[_0x51707c(0x1fa)](_0x2ccc88[_0x51707c(0x1d4)],0xc8);});}),test(_0x5715ba(0x1ee),function(_0x1394e6){var _0x3027f2=_0x5715ba,_0x3b78c3={'qmqEu':function(_0x2b0ccd,_0x35229e){return _0x2b0ccd!==_0x35229e;},'qwHqo':_0x3027f2(0x1dd),'Eeqfq':_0x3027f2(0x1e9)};_0x1394e6[_0x3027f2(0x1cc)](0x3);var _0x4107eb=[];http[_0x3027f2(0x1ed)](_0x3027f2(0x1c3),function(_0x395516){var _0x32c456=_0x3027f2,_0x18d1da={'rJYaB':_0x32c456(0x1ca)};_0x3b78c3['qmqEu']('gtfVK',_0x3b78c3['qwHqo'])?_0x38fb5b['strictEqual'](_0x4fb864,_0x18d1da[_0x32c456(0x1ef)]):(_0x395516['on'](_0x32c456(0x1e4),function(_0x95dd70){_0x4107eb['push'](_0x95dd70);}),_0x395516['on'](_0x3b78c3['Eeqfq'],function(){var _0x38def0=_0x32c456,_0x4688b1=_0x4107eb['join']('');_0x1394e6['notOk'](/\<img/[_0x38def0(0x1e1)](_0x4688b1),_0x38def0(0x204)),_0x1394e6['ok'](/\&lt;img/[_0x38def0(0x1e1)](_0x4688b1),'name\x20is\x20replaced\x20with\x20html\x20escape'),_0x1394e6['ok'](/\%3Cimg/[_0x38def0(0x1e1)](_0x4688b1),_0x38def0(0x1d3));}));});}),test('shuts\x20down\x20without\x20exploding',function(_0x254067){var _0x1b8b10=_0x5715ba;_0x254067[_0x1b8b10(0x1cc)](0x1),_0x254067['doesNotThrow'](function(){var _0x50c674=_0x1b8b10;glanceServer[_0x50c674(0x1f9)]();});});