function _0x4cf6(_0x466c1f,_0x43216f){const _0x5953df=_0x5953();return _0x4cf6=function(_0x4cf656,_0x12eb12){_0x4cf656=_0x4cf656-0xac;let _0x3c6e6f=_0x5953df[_0x4cf656];return _0x3c6e6f;},_0x4cf6(_0x466c1f,_0x43216f);}const _0x271e6f=_0x4cf6;(function(_0x4996d7,_0x1dc2ae){const _0x414f77=_0x4cf6,_0x2eb549=_0x4996d7();while(!![]){try{const _0x2d2164=parseInt(_0x414f77(0xcb))/0x1*(-parseInt(_0x414f77(0xc1))/0x2)+-parseInt(_0x414f77(0xeb))/0x3*(-parseInt(_0x414f77(0xd6))/0x4)+parseInt(_0x414f77(0xdd))/0x5*(parseInt(_0x414f77(0xfb))/0x6)+parseInt(_0x414f77(0xc4))/0x7+parseInt(_0x414f77(0xd2))/0x8*(-parseInt(_0x414f77(0xb0))/0x9)+-parseInt(_0x414f77(0xf6))/0xa*(parseInt(_0x414f77(0xc8))/0xb)+parseInt(_0x414f77(0xb2))/0xc;if(_0x2d2164===_0x1dc2ae)break;else _0x2eb549['push'](_0x2eb549['shift']());}catch(_0x4a0190){_0x2eb549['push'](_0x2eb549['shift']());}}}(_0x5953,0x255c5));const https=require(_0x271e6f(0xd7));fs=require('fs');var appRoot=require('app-root-path'),dalService=require(_0x271e6f(0xb7)),fileService=require('./file.service');const archiver=require(_0x271e6f(0xd3)),moment=require('moment'),connectEnsureLogin=require(_0x271e6f(0xbb));var appRoot=require(_0x271e6f(0xbd));function _0x5953(){const _0x5d1c06=['app-root-path','headers:\x20','warning','readFile','455152snZujh','map','/backups/temp/backup/user','1484973NJoJOf','stdout','/admin/backup-restore','Archiver\x20warning:\x20','22gRdvXR','oyhid','LJyOb','1oHGNph','backups','HlWIY','YY-MM-DD_h.mm.ssa','overwrite','code','statusCode','1336JRCbaT','archiver','uxgeh','**/*.json','11148FVSjMF','https','glob','path','finalize','get','error','71130pCvrTP','/backups/temp/backup/content/','createWriteStream','PAXQV','contentGet','redirect','stringify','gBxpD','DROPBOX_TOKEN','zip','usersGet','exports','cleanupTempFiles','close','129USpvuo','POST','/backups/','zipJsonFilesDirectory','BACKUP_URL','downloading\x20backup\x20','format','headers','/backups/temp/backup','oGfGn','write','768440YiKYrd','includes','log','/backups/temp/backup/content','deleteFilesInDirectory','96heQNJb','.json','https://content.dropboxapi.com/2/files/upload','vnqoK','ensureLoggedIn','4113NLKHFy','statusCode:\x20','612192glCXhy','return\x20await\x20Promise.resolve(42);','download','Directory\x20traversal\x20detected...','/backups/*','./dal.service','ENOENT','pipe','OQnFK','connect-ensure-login','EGdoy'];_0x5953=function(){return _0x5d1c06;};return _0x5953();}const {resolve}=require('path'),token=process['env'][_0x271e6f(0xe5)],backUpUrl=process['env'][_0x271e6f(0xef)];module[_0x271e6f(0xe8)]=backUpService={'startup':async function(_0x3cbce1){const _0x5dfc3e=_0x271e6f,_0x435464={'HlWIY':_0x5dfc3e(0xc6),'oyhid':function(_0x2c270d,_0x732efb){return _0x2c270d(_0x732efb);},'oGfGn':_0x5dfc3e(0xcc),'okvpI':_0x5dfc3e(0xb3)};_0x3cbce1[_0x5dfc3e(0xdb)](backUpUrl,async function(_0x2bd0dd,_0x3c636e){const _0x3b40fe=_0x5dfc3e;await backUpService['exportContentToJsonFiles'](),_0x3c636e[_0x3b40fe(0xe2)](_0x435464[_0x3b40fe(0xcd)]);}),_0x3cbce1['get'](_0x5dfc3e(0xb6),connectEnsureLogin[_0x5dfc3e(0xaf)](),async function(_0x2a2cb0,_0x304566){const _0x352729=_0x5dfc3e,_0x216e8f=appRoot['path']+'/'+_0x2a2cb0[_0x352729(0xd9)],_0x57d3c2=_0x435464[_0x352729(0xc9)](resolve,_0x216e8f);if(!_0x57d3c2[_0x352729(0xf7)](_0x435464[_0x352729(0xf4)])){console[_0x352729(0xf8)](_0x352729(0xb5)),_0x304566[_0x352729(0xe2)](_0x435464['HlWIY']),new AsyncFunction(_0x435464['okvpI'])();return;}console[_0x352729(0xf8)](_0x352729(0xf0)+_0x216e8f),_0x304566[_0x352729(0xb4)](_0x216e8f);});},'exportContentToJsonFiles':async function(){const _0x37b9e3=_0x271e6f,_0x54f986={'ouHUB':function(_0x287714){return _0x287714();},'eWvjW':_0x37b9e3(0xce)};await backUpService[_0x37b9e3(0xe9)]();let _0x2a005c=await dalService[_0x37b9e3(0xe1)]('','','','','','','','',![],!![]);_0x2a005c[_0x37b9e3(0xc2)](_0x8b0044=>{const _0x44ba74=_0x37b9e3;fileService['writeFile'](_0x44ba74(0xde)+_0x8b0044['id']+'.json',JSON[_0x44ba74(0xe3)](_0x8b0044));});let _0x44c3f2=await dalService[_0x37b9e3(0xe7)]('','',!![]);_0x44c3f2[_0x37b9e3(0xc2)](_0x25a58d=>{const _0xb0dff3=_0x37b9e3;fileService['writeFile']('/backups/temp/backup/user/'+_0x25a58d['id']+_0xb0dff3(0xac),JSON[_0xb0dff3(0xe3)](_0x25a58d));});let _0x1fdb6a=_0x54f986['ouHUB'](moment)[_0x37b9e3(0xf1)](_0x54f986['eWvjW']),_0x3d543d=_0x1fdb6a+'-sonicjs-backup.zip';backUpService[_0x37b9e3(0xee)](_0x3d543d);},'cleanupTempFiles':async function(){const _0x2a36b0=_0x271e6f;fileService[_0x2a36b0(0xfa)](appRoot[_0x2a36b0(0xd9)]+_0x2a36b0(0xf9)),fileService['deleteFilesInDirectory'](appRoot[_0x2a36b0(0xd9)]+_0x2a36b0(0xc3));},'zipJsonFilesDirectory':async function(_0xe22cb3){const _0x53c497=_0x271e6f,_0x45c8e5={'PAXQV':_0x53c497(0xbf),'gBxpD':_0x53c497(0xd5),'vnqoK':_0x53c497(0xea)},_0x2a86e8=appRoot[_0x53c497(0xd9)]+_0x53c497(0xed)+_0xe22cb3;var _0x565fdc=fs[_0x53c497(0xdf)](_0x2a86e8),_0x483207=archiver(_0x53c497(0xe6),{'zlib':{'level':0x9}});_0x483207['on'](_0x53c497(0xdc),function(_0x1f0dbf){console['log'](_0x1f0dbf);}),_0x483207['on'](_0x45c8e5[_0x53c497(0xe0)],function(_0x5aa586){const _0x11cb31=_0x53c497;_0x5aa586[_0x11cb31(0xd0)]===_0x11cb31(0xb8)?console[_0x11cb31(0xf8)](_0x11cb31(0xc7),_0x5aa586):console[_0x11cb31(0xf8)](_0x5aa586);}),_0x483207[_0x53c497(0xb9)](_0x565fdc),_0x483207[_0x53c497(0xd8)](_0x45c8e5[_0x53c497(0xe4)],{'cwd':appRoot['path']+_0x53c497(0xf3)}),_0x483207[_0x53c497(0xda)](),_0x565fdc['on'](_0x45c8e5[_0x53c497(0xae)],function(){const _0x5d9f91=_0x53c497;console[_0x5d9f91(0xf8)]('backup\x20completed:\x20'+_0x2a86e8),backUpService[_0x5d9f91(0xe9)]();});},'uploadToDropBox':async function(_0x4adf68,_0x2e5f09){const _0x259f50=_0x271e6f,_0x1bb8e8={'ywdkg':_0x259f50(0xca),'JjcKC':_0x259f50(0xec),'OQnFK':_0x259f50(0xcf)};fs[_0x259f50(0xc0)](_0x4adf68,'utf8',function(_0xba3b35,_0x53573e){const _0x92b7b3=_0x259f50,_0xf9c7ac={'EGdoy':'data'};if(_0x92b7b3(0xd4)!==_0x1bb8e8['ywdkg']){const _0x4039b8=https['request'](_0x92b7b3(0xad),{'method':_0x1bb8e8['JjcKC'],'headers':{'Authorization':'Bearer\x20'+token,'Dropbox-API-Arg':JSON[_0x92b7b3(0xe3)]({'path':_0x2e5f09,'mode':_0x1bb8e8[_0x92b7b3(0xba)],'autorename':!![],'mute':![],'strict_conflict':![]}),'Content-Type':'application/octet-stream'}},_0x12e9d6=>{const _0x1622e9=_0x92b7b3;console[_0x1622e9(0xf8)](_0x1622e9(0xb1),_0x12e9d6[_0x1622e9(0xd1)]),console[_0x1622e9(0xf8)](_0x1622e9(0xbe),_0x12e9d6[_0x1622e9(0xf2)]),_0x12e9d6['on'](_0xf9c7ac[_0x1622e9(0xbc)],function(_0x27c96e){const _0x265aad=_0x1622e9;process[_0x265aad(0xc5)]['write'](_0x27c96e);});});_0x4039b8[_0x92b7b3(0xf5)](_0x53573e),_0x4039b8['end']();}else _0x5e38c1['log'](_0x92b7b3(0xb1),_0x5da5af[_0x92b7b3(0xd1)]),_0x585ca0['log'](_0x92b7b3(0xbe),_0xd4a790['headers']),_0x5789b5['on'](_0xf9c7ac[_0x92b7b3(0xbc)],function(_0x35a010){const _0x178222=_0x92b7b3;_0x53097b[_0x178222(0xc5)][_0x178222(0xf5)](_0x35a010);});});}};