const _0x4dd304=_0x1a8e;(function(_0x58a2f6,_0x47b1d4){const _0x866c37=_0x1a8e,_0x3f3dab=_0x58a2f6();while(!![]){try{const _0x23de22=parseInt(_0x866c37(0xbf))/0x1+-parseInt(_0x866c37(0xcb))/0x2+-parseInt(_0x866c37(0xb4))/0x3*(-parseInt(_0x866c37(0xde))/0x4)+parseInt(_0x866c37(0xe8))/0x5*(-parseInt(_0x866c37(0xa6))/0x6)+parseInt(_0x866c37(0xc2))/0x7+parseInt(_0x866c37(0xba))/0x8*(parseInt(_0x866c37(0xab))/0x9)+parseInt(_0x866c37(0xbd))/0xa*(-parseInt(_0x866c37(0xdf))/0xb);if(_0x23de22===_0x47b1d4)break;else _0x3f3dab['push'](_0x3f3dab['shift']());}catch(_0x478be5){_0x3f3dab['push'](_0x3f3dab['shift']());}}}(_0x8df2,0x872e1));function _0x1a8e(_0x1d6b1e,_0x302657){const _0x8df227=_0x8df2();return _0x1a8e=function(_0x1a8eb9,_0xa8f0e6){_0x1a8eb9=_0x1a8eb9-0xa2;let _0x255aa9=_0x8df227[_0x1a8eb9];return _0x255aa9;},_0x1a8e(_0x1d6b1e,_0x302657);}const https=require('https');fs=require('fs');function _0x8df2(){const _0x9a33b1=['headers:\x20','ENOENT','stringify','QaRZF','stdout','/backups/*','/backups/temp/backup/user','cleanupTempFiles','error','rQTjN','usersGet','2185432bxKDPo','3740GhrAZF','cUhFk','zipJsonFilesDirectory','ensureLoggedIn','statusCode','download','/backups/temp/backup','app-root-path','POST','5MoAicL','Bearer\x20','/backups/','exports','DoliD','**/*.json','format','redirect','211638eRHWYF','env','utf8','UaBxe','code','9ubJIgl','deleteFilesInDirectory','overwrite','./file.service','Aymhv','statusCode:\x20','.json','zip','headers','6oWOZSa','aNAJL','BACKUP_URL','log','RoVsi','kelnt','6667352tIAXzG','path','glob','60330KtOvtp','-sonicjs-backup.zip','1038292fsMXJL','writeFile','DROPBOX_TOKEN','3350613CCJuNh','downloading\x20backup\x20','exportContentToJsonFiles','createWriteStream','BqWOD','backup\x20completed:\x20','wCvPy','vgXzE','end','1605792aaXNcy','map','Archiver\x20warning:\x20','JvCtr','warning','get','blEec','data'];_0x8df2=function(){return _0x9a33b1;};return _0x8df2();}var appRoot=require(_0x4dd304(0xe6)),dalService=require('./dal.service'),fileService=require(_0x4dd304(0xae));const archiver=require('archiver'),moment=require('moment'),connectEnsureLogin=require('connect-ensure-login');var appRoot=require(_0x4dd304(0xe6));const token=process[_0x4dd304(0xa7)][_0x4dd304(0xc1)],backUpUrl=process[_0x4dd304(0xa7)][_0x4dd304(0xb6)];module[_0x4dd304(0xeb)]=backUpService={'startup':async function(_0x161de9){const _0x1f4582=_0x4dd304,_0x2266e4={'TFwLN':_0x1f4582(0xd8)};_0x161de9[_0x1f4582(0xd0)](backUpUrl,async function(_0x273ee6,_0x7fb4bb){const _0x44a105=_0x1f4582;await backUpService[_0x44a105(0xc4)](),_0x7fb4bb[_0x44a105(0xa5)]('/admin/backup-restore');}),_0x161de9[_0x1f4582(0xd0)](_0x2266e4['TFwLN'],connectEnsureLogin[_0x1f4582(0xe2)](),async function(_0x153634,_0x5c1d14){const _0x45f14b=_0x1f4582,_0x43e4f3=appRoot[_0x45f14b(0xbb)]+'/'+_0x153634[_0x45f14b(0xbb)];console[_0x45f14b(0xb7)]('downloading\x20backup\x20'+_0x43e4f3),_0x5c1d14[_0x45f14b(0xe4)](_0x43e4f3);});},'exportContentToJsonFiles':async function(){const _0x3d1db6=_0x4dd304,_0x549423={'DoliD':function(_0x3e5614,_0x576589){return _0x3e5614+_0x576589;},'blEec':'UnMDo','muFYb':'zItYM','UaBxe':function(_0x2d118d){return _0x2d118d();}};await backUpService[_0x3d1db6(0xda)]();let _0x5ee3fd=await dalService['contentGet']('','','','','','','','',![],!![]);_0x5ee3fd[_0x3d1db6(0xcc)](_0x55dbf8=>{const _0x17c6ea=_0x3d1db6;fileService[_0x17c6ea(0xc0)]('/backups/temp/backup/content/'+_0x55dbf8['id']+_0x17c6ea(0xb1),JSON['stringify'](_0x55dbf8));});let _0xd5fa9c=await dalService[_0x3d1db6(0xdd)]('','',!![]);_0xd5fa9c[_0x3d1db6(0xcc)](_0xc462fd=>{const _0xca690d=_0x3d1db6,_0x52a9aa={'aNAJL':function(_0x1de167,_0x20e2e7){const _0x1b10ef=_0x1a8e;return _0x549423[_0x1b10ef(0xa2)](_0x1de167,_0x20e2e7);}};_0x549423[_0xca690d(0xd1)]===_0x549423['muFYb']?(_0xb2fa2[_0xca690d(0xb7)](_0x52a9aa[_0xca690d(0xb5)](_0xca690d(0xc7),_0x1540ae)),_0x207ff2[_0xca690d(0xda)]()):fileService['writeFile']('/backups/temp/backup/user/'+_0xc462fd['id']+'.json',JSON['stringify'](_0xc462fd));});let _0xcd3fae=_0x549423[_0x3d1db6(0xa9)](moment)[_0x3d1db6(0xa4)]('YY-MM-DD_h.mm.ssa'),_0x445c6e=_0xcd3fae+_0x3d1db6(0xbe);backUpService[_0x3d1db6(0xe1)](_0x445c6e);},'cleanupTempFiles':async function(){const _0x111cb0=_0x4dd304;fileService[_0x111cb0(0xac)](appRoot['path']+'/backups/temp/backup/content'),fileService[_0x111cb0(0xac)](appRoot[_0x111cb0(0xbb)]+_0x111cb0(0xd9));},'zipJsonFilesDirectory':async function(_0x4ae532){const _0x314022=_0x4dd304,_0x244e85={'JvCtr':function(_0x31bfcc,_0x3795b8){return _0x31bfcc===_0x3795b8;},'wCvPy':_0x314022(0xd4),'RoVsi':function(_0x3c9b3e,_0x24ed27){return _0x3c9b3e+_0x24ed27;},'rQTjN':_0x314022(0xb2),'WTaVL':_0x314022(0xdb),'vgXzE':'close'},_0x4a34a7=appRoot['path']+_0x314022(0xea)+_0x4ae532;var _0x55dfcd=fs[_0x314022(0xc5)](_0x4a34a7),_0x530abb=archiver(_0x244e85[_0x314022(0xdc)],{'zlib':{'level':0x9}});_0x530abb['on'](_0x244e85['WTaVL'],function(_0x5e578e){const _0x405ac8=_0x314022;console[_0x405ac8(0xb7)](_0x5e578e);}),_0x530abb['on'](_0x314022(0xcf),function(_0x370aae){const _0x20ad67=_0x314022;_0x244e85[_0x20ad67(0xce)](_0x370aae[_0x20ad67(0xaa)],_0x244e85[_0x20ad67(0xc8)])?console['log'](_0x20ad67(0xcd),_0x370aae):console[_0x20ad67(0xb7)](_0x370aae);}),_0x530abb['pipe'](_0x55dfcd),_0x530abb[_0x314022(0xbc)](_0x314022(0xa3),{'cwd':appRoot[_0x314022(0xbb)]+_0x314022(0xe5)}),_0x530abb['finalize'](),_0x55dfcd['on'](_0x244e85[_0x314022(0xc9)],function(){const _0x521e80=_0x314022;console[_0x521e80(0xb7)](_0x244e85[_0x521e80(0xb8)](_0x521e80(0xc7),_0x4a34a7)),backUpService[_0x521e80(0xda)]();});},'uploadToDropBox':async function(_0x589b61,_0x42bd72){const _0x589abb=_0x4dd304,_0x5dc7cc={'QaRZF':_0x589abb(0xc6),'kelnt':_0x589abb(0xb0),'cUhFk':_0x589abb(0xd2)};fs['readFile'](_0x589b61,_0x589abb(0xa8),function(_0x3c4733,_0x986ab2){const _0x428334=_0x589abb;if(_0x428334(0xaf)!==_0x428334(0xaf)){const _0x404ce9=_0x194fdd['path']+'/'+_0x1ad29a[_0x428334(0xbb)];_0x52c061[_0x428334(0xb7)](_0x428334(0xc3)+_0x404ce9),_0x39f68f[_0x428334(0xe4)](_0x404ce9);}else{const _0x139f5a=https['request']('https://content.dropboxapi.com/2/files/upload',{'method':_0x428334(0xe7),'headers':{'Authorization':_0x428334(0xe9)+token,'Dropbox-API-Arg':JSON[_0x428334(0xd5)]({'path':_0x42bd72,'mode':_0x428334(0xad),'autorename':!![],'mute':![],'strict_conflict':![]}),'Content-Type':'application/octet-stream'}},_0x2684ff=>{const _0x451b41=_0x428334;_0x5dc7cc['QaRZF']!==_0x5dc7cc[_0x451b41(0xd6)]?_0x5a074a['code']==='ENOENT'?_0x392132[_0x451b41(0xb7)](_0x451b41(0xcd),_0x125156):_0x2631da[_0x451b41(0xb7)](_0xd5bd65):(console['log'](_0x5dc7cc[_0x451b41(0xb9)],_0x2684ff[_0x451b41(0xe3)]),console['log'](_0x451b41(0xd3),_0x2684ff[_0x451b41(0xb3)]),_0x2684ff['on'](_0x5dc7cc[_0x451b41(0xe0)],function(_0x5f30db){const _0xc9b51b=_0x451b41;process[_0xc9b51b(0xd7)]['write'](_0x5f30db);}));});_0x139f5a['write'](_0x986ab2),_0x139f5a[_0x428334(0xca)]();}});}};