const _0x321209=_0x299c;(function(_0x4d31bd,_0x2a2fa8){const _0x4a70c0=_0x299c,_0x3f5a48=_0x4d31bd();while(!![]){try{const _0x2b0fe9=parseInt(_0x4a70c0(0x11b))/0x1*(parseInt(_0x4a70c0(0x118))/0x2)+-parseInt(_0x4a70c0(0x13c))/0x3+-parseInt(_0x4a70c0(0x13b))/0x4*(-parseInt(_0x4a70c0(0x132))/0x5)+parseInt(_0x4a70c0(0x133))/0x6+-parseInt(_0x4a70c0(0x111))/0x7+parseInt(_0x4a70c0(0x112))/0x8+-parseInt(_0x4a70c0(0x10b))/0x9;if(_0x2b0fe9===_0x2a2fa8)break;else _0x3f5a48['push'](_0x3f5a48['shift']());}catch(_0x502539){_0x3f5a48['push'](_0x3f5a48['shift']());}}}(_0xb3e4,0x5d243));const {v4:uuidv4,validate}=require(_0x321209(0x10a)),{VALID_CHAT_MODE}=require('../chats/stream'),{EmbedChats}=require(_0x321209(0x123)),{EmbedConfig}=require('../../models/embedConfig'),{reqBody}=require('../http');async function validEmbedConfig(_0x2f7856,_0x1de21b,_0x4bdaa9){const _0x571ffe=_0x321209,{embedId:_0x14e034}=_0x2f7856[_0x571ffe(0x105)],_0x3e5b84=await EmbedConfig[_0x571ffe(0x117)]({'uuid':_0x14e034});if(!_0x3e5b84){_0x1de21b[_0x571ffe(0x115)](0x194)[_0x571ffe(0x12e)]();return;}_0x1de21b['locals'][_0x571ffe(0x125)]=_0x3e5b84,_0x4bdaa9();}function setConnectionMeta(_0x595a90,_0x49613f,_0x6c52b0){const _0x1dfa30=_0x321209,_0x56b27b={'yTLIY':function(_0x461352){return _0x461352();}};_0x49613f[_0x1dfa30(0x114)]['connection']={'host':_0x595a90['headers']?.[_0x1dfa30(0x10e)],'ip':_0x595a90?.['ip']},_0x56b27b[_0x1dfa30(0x119)](_0x6c52b0);}function _0xb3e4(){const _0x26548d=['locals','sendStatus','NZiNP','getWithWorkspace','10bELhpb','yTLIY','mSqIZ','109910RFrrkL','count','AXOtI','eGkOn','WwlQm','tCYGt','zycqS','HddWF','../../models/embedChats','includes','embedConfig','ZdXTW','max_chats_per_session','Invalid\x20request.','QlWic','length','Message\x20is\x20empty.','hOLUx','MMyzk','end','The\x20quota\x20for\x20this\x20chat\x20has\x20been\x20reached.\x20Try\x20again\x20later\x20or\x20contact\x20the\x20site\x20owner.','Invalid\x20session\x20ID.','Hzjbh','30TTNyua','150054LWOerb','json','status','exports','This\x20chat\x20has\x20been\x20disabled\x20by\x20the\x20administrator\x20-\x20try\x20again\x20later.','CZMbK','abort','get','347252ongwtV','1169136bTnKHO','parseAllowedHosts','params','chat_mode','max_chats_per_day','VjwAz','XqvJe','uuid','5073597NQdkiH','\x20is\x20not\x20a\x20valid\x20mode.','enabled','origin','ULtpd','uupmZ','993636TitDZQ','3051704KVQidc','illoA'];_0xb3e4=function(){return _0x26548d;};return _0xb3e4();}async function validEmbedConfigId(_0x16d195,_0x2371b4,_0x38ec6a){const _0x3eec40=_0x321209,_0x2f17da={'zycqS':function(_0x3e2427,_0x5422c5){return _0x3e2427(_0x5422c5);},'VjwAz':function(_0x53f996){return _0x53f996();}},{embedId:_0x1ac526}=_0x16d195[_0x3eec40(0x105)],_0x2bcb13=await EmbedConfig[_0x3eec40(0x13a)]({'id':_0x2f17da[_0x3eec40(0x121)](Number,_0x1ac526)});if(!_0x2bcb13){_0x2371b4[_0x3eec40(0x115)](0x194)[_0x3eec40(0x12e)]();return;}_0x2371b4[_0x3eec40(0x114)][_0x3eec40(0x125)]=_0x2bcb13,_0x2f17da[_0x3eec40(0x108)](_0x38ec6a);}function _0x299c(_0x3848ec,_0x139e1f){const _0xb3e484=_0xb3e4();return _0x299c=function(_0x299c5c,_0x5d6eb0){_0x299c5c=_0x299c5c-0x104;let _0x735871=_0xb3e484[_0x299c5c];return _0x735871;},_0x299c(_0x3848ec,_0x139e1f);}async function canRespond(_0x437be2,_0x4580d3,_0x5bc934){const _0x2d15f3=_0x321209,_0xc4bbcb={'NZiNP':function(_0x2c5492){return _0x2c5492();},'hOLUx':'abort','eKvtI':_0x2d15f3(0x137),'tCYGt':function(_0x1fb803,_0x473322){return _0x1fb803(_0x473322);},'uupmZ':function(_0x1fa642){return _0x1fa642();},'ZdXTW':function(_0x449240){return _0x449240();},'mSqIZ':_0x2d15f3(0x12b),'eGkOn':function(_0x26f779,_0x21e334){return _0x26f779-_0x21e334;},'WwlQm':function(_0x2db649,_0x4a843d){return _0x2db649*_0x4a843d;},'AXOtI':_0x2d15f3(0x109),'ULtpd':_0x2d15f3(0x12f),'MMyzk':function(_0x4af41d,_0x3c5c17){return _0x4af41d>_0x3c5c17;},'bCrPE':function(_0xa66c7d,_0x23be91){return _0xa66c7d===_0x23be91;},'QlWic':_0x2d15f3(0x113),'HddWF':function(_0x56a953){return _0x56a953();},'Hzjbh':function(_0x246bfe){return _0x246bfe();}};try{const _0x303139=_0x4580d3[_0x2d15f3(0x114)]['embedConfig'];if(!_0x303139){_0x4580d3[_0x2d15f3(0x115)](0x194)['end']();return;}if(!_0x303139[_0x2d15f3(0x10d)]){_0x4580d3[_0x2d15f3(0x135)](0x1f7)[_0x2d15f3(0x134)]({'id':_0xc4bbcb['NZiNP'](uuidv4),'type':_0xc4bbcb[_0x2d15f3(0x12c)],'textResponse':null,'sources':[],'close':!![],'error':_0x2d15f3(0x137)});return;}const _0x50e8a9=_0x437be2['headers'][_0x2d15f3(0x10e)]??'',_0x2e6de4=EmbedConfig[_0x2d15f3(0x104)](_0x303139);if(_0x2e6de4!==null&&!_0x2e6de4['includes'](_0x50e8a9)){_0x4580d3[_0x2d15f3(0x135)](0x191)[_0x2d15f3(0x134)]({'id':uuidv4(),'type':_0xc4bbcb[_0x2d15f3(0x12c)],'textResponse':null,'sources':[],'close':!![],'error':_0x2d15f3(0x128)});return;}const {sessionId:_0x5fa505,message:_0x3a900b}=reqBody(_0x437be2);if(typeof _0x5fa505!=='string'||!validate(_0xc4bbcb[_0x2d15f3(0x120)](String,_0x5fa505))){_0x4580d3[_0x2d15f3(0x135)](0x194)[_0x2d15f3(0x134)]({'id':_0xc4bbcb[_0x2d15f3(0x110)](uuidv4),'type':_0xc4bbcb[_0x2d15f3(0x12c)],'textResponse':null,'sources':[],'close':!![],'error':_0x2d15f3(0x130)});return;}if(!_0x3a900b?.[_0x2d15f3(0x12a)]||!VALID_CHAT_MODE[_0x2d15f3(0x124)](_0x303139['chat_mode'])){_0x4580d3[_0x2d15f3(0x135)](0x190)['json']({'id':_0xc4bbcb[_0x2d15f3(0x126)](uuidv4),'type':_0xc4bbcb[_0x2d15f3(0x12c)],'textResponse':null,'sources':[],'close':!![],'error':!_0x3a900b?.[_0x2d15f3(0x12a)]?_0xc4bbcb[_0x2d15f3(0x11a)]:_0x303139[_0x2d15f3(0x106)]+_0x2d15f3(0x10c)});return;}if(!_0xc4bbcb[_0x2d15f3(0x120)](isNaN,_0x303139['max_chats_per_day'])&&_0xc4bbcb[_0x2d15f3(0x120)](Number,_0x303139[_0x2d15f3(0x107)])>0x0){const _0x2cbc8e=await EmbedChats['count']({'embed_id':_0x303139['id'],'createdAt':{'gte':new Date(_0xc4bbcb[_0x2d15f3(0x11e)](new Date(),_0xc4bbcb[_0x2d15f3(0x11f)](_0xc4bbcb[_0x2d15f3(0x11f)](0x18*0x3c,0x3c),0x3e8)))}});if(_0x2cbc8e>=Number(_0x303139['max_chats_per_day'])){if(_0xc4bbcb[_0x2d15f3(0x11d)]!==_0x2d15f3(0x138)){_0x4580d3[_0x2d15f3(0x135)](0x1ad)['json']({'id':uuidv4(),'type':_0xc4bbcb['hOLUx'],'textResponse':null,'sources':[],'close':!![],'error':_0xc4bbcb[_0x2d15f3(0x10f)]});return;}else{_0x1483d3[_0x2d15f3(0x135)](0x1ad)['json']({'id':_0xc4bbcb[_0x2d15f3(0x116)](_0xe98724),'type':_0xc4bbcb['hOLUx'],'textResponse':null,'sources':[],'close':!![],'error':_0x2d15f3(0x12f)});return;}}}if(!isNaN(_0x303139[_0x2d15f3(0x127)])&&_0xc4bbcb[_0x2d15f3(0x12d)](_0xc4bbcb['tCYGt'](Number,_0x303139[_0x2d15f3(0x127)]),0x0)){const _0x3cdb31=await EmbedChats[_0x2d15f3(0x11c)]({'embed_id':_0x303139['id'],'session_id':_0x5fa505,'createdAt':{'gte':new Date(new Date()-_0xc4bbcb[_0x2d15f3(0x11f)](_0xc4bbcb[_0x2d15f3(0x11f)](0x18,0x3c),0x3c)*0x3e8)}});if(_0x3cdb31>=Number(_0x303139['max_chats_per_session'])){if(_0xc4bbcb['bCrPE'](_0x2d15f3(0x113),_0xc4bbcb[_0x2d15f3(0x129)])){_0x4580d3[_0x2d15f3(0x135)](0x1ad)[_0x2d15f3(0x134)]({'id':_0xc4bbcb[_0x2d15f3(0x122)](uuidv4),'type':_0x2d15f3(0x139),'textResponse':null,'sources':[],'close':!![],'error':'Your\x20quota\x20for\x20this\x20chat\x20has\x20been\x20reached.\x20Try\x20again\x20later\x20or\x20contact\x20the\x20site\x20owner.'});return;}else{_0x18b76c[_0x2d15f3(0x135)](0x1f7)[_0x2d15f3(0x134)]({'id':_0xc4bbcb[_0x2d15f3(0x116)](_0xb286aa),'type':_0x2d15f3(0x139),'textResponse':null,'sources':[],'close':!![],'error':_0xc4bbcb['eKvtI']});return;}}}_0xc4bbcb[_0x2d15f3(0x131)](_0x5bc934);}catch(_0xd3de6a){_0x4580d3[_0x2d15f3(0x135)](0x1f4)[_0x2d15f3(0x134)]({'id':uuidv4(),'type':_0x2d15f3(0x139),'textResponse':null,'sources':[],'close':!![],'error':'Invalid\x20request.'});return;}}module[_0x321209(0x136)]={'setConnectionMeta':setConnectionMeta,'validEmbedConfig':validEmbedConfig,'validEmbedConfigId':validEmbedConfigId,'canRespond':canRespond};