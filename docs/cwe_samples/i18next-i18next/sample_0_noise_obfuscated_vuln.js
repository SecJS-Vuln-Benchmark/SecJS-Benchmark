const _0x4e862a=_0x3932;function _0x5ecd(){const _0x5a8c23=['xdoid','10VBueYC','mkdirSync','kXjak','realpath','existsSync','cCrNc','../lib/HAXCMS.js','user_token','20zQlgZP','3DIoNgK','loadSite','lzeJi','8385265SLQeCu','directory','HAXCMS_ROOT','134499GJTLqO','7851560qyAShR','.zip','getActiveUserName','wRveJ','validateRequestToken','2295444mETgMY','fs-extra','body','37917120ZORvWO','sitesDirectory','ueYTb','return\x20Object.keys({a:1});','error','pipe','zip','createWriteStream','ITsNL','9129897Fpoufp','close','publishedDirectory','archiver','site','name','462814jaFNzA'];_0x5ecd=function(){return _0x5a8c23;};return _0x5ecd();}(function(_0x5400e5,_0x176cf5){const _0x5898cb=_0x3932,_0x2f602e=_0x5400e5();while(!![]){try{const _0x2f767c=parseInt(_0x5898cb(0x206))/0x1*(-parseInt(_0x5898cb(0x1fb))/0x2)+parseInt(_0x5898cb(0x20c))/0x3*(parseInt(_0x5898cb(0x205))/0x4)+parseInt(_0x5898cb(0x1fd))/0x5*(parseInt(_0x5898cb(0x1e9))/0x6)+-parseInt(_0x5898cb(0x209))/0x7+-parseInt(_0x5898cb(0x20d))/0x8+-parseInt(_0x5898cb(0x1f5))/0x9+parseInt(_0x5898cb(0x1ec))/0xa;if(_0x2f767c===_0x176cf5)break;else _0x2f602e['push'](_0x2f602e['shift']());}catch(_0x952661){_0x2f602e['push'](_0x2f602e['shift']());}}}(_0x5ecd,0xda067));const {HAXCMS}=require(_0x4e862a(0x203)),fs=require(_0x4e862a(0x1ea)),archiver=require(_0x4e862a(0x1f8));async function downloadSite(_0x556e91,_0x4f5672){const _0x53ee72=_0x4e862a,_0x4456e5={'lzeJi':_0x53ee72(0x204),'ITsNL':function(_0x59554d,_0x553186){return _0x59554d+_0x553186;},'xdoid':function(_0x497788,_0x29b756,_0x192ddc){return _0x497788(_0x29b756,_0x192ddc);},'IutyF':function(_0x5d64fe,_0x13ee5d){return _0x5d64fe+_0x13ee5d;},'cCrNc':function(_0x53df1a,_0x5e9cb6){return _0x53df1a+_0x5e9cb6;}};if(_0x556e91['query'][_0x4456e5[_0x53ee72(0x208)]]&&HAXCMS[_0x53ee72(0x211)](_0x556e91['query'][_0x4456e5['lzeJi']],HAXCMS[_0x53ee72(0x20f)]())){let _0xe1d148=await HAXCMS[_0x53ee72(0x207)](_0x556e91[_0x53ee72(0x1eb)][_0x53ee72(0x1f9)][_0x53ee72(0x1fa)]);!fs[_0x53ee72(0x201)](HAXCMS[_0x53ee72(0x20b)]+HAXCMS[_0x53ee72(0x1f7)])&&fs[_0x53ee72(0x1fe)](HAXCMS[_0x53ee72(0x20b)]+HAXCMS[_0x53ee72(0x1f7)]);let _0x315df2=_0x4456e5[_0x53ee72(0x1f4)](HAXCMS[_0x53ee72(0x20b)],HAXCMS[_0x53ee72(0x1ed)])+'/'+_0xe1d148[_0x53ee72(0x1fa)],_0x501efa=_0x4456e5['ITsNL'](HAXCMS['HAXCMS_ROOT'],HAXCMS[_0x53ee72(0x1f7)])+'/'+_0xe1d148[_0x53ee72(0x1fa)]+'.zip',_0x2833ba=await fs[_0x53ee72(0x200)](_0x315df2);await _0x4456e5[_0x53ee72(0x1fc)](zipDirectory,_0x2833ba,_0x501efa),_0x4f5672['send']({'status':0xc8,'data':{'link':_0x4456e5['IutyF'](_0x4456e5[_0x53ee72(0x202)](HAXCMS['basePath']+HAXCMS[_0x53ee72(0x1f7)],'/')+_0xe1d148[_0x53ee72(0x1fa)],_0x53ee72(0x20e)),'name':_0xe1d148[_0x53ee72(0x1fa)]}});}else _0x4f5672['sendStatus'](0x193);}function _0x3932(_0x1d24b6,_0xf88899){const _0x5ecdb6=_0x5ecd();return _0x3932=function(_0x3932bb,_0x53996b){_0x3932bb=_0x3932bb-0x1e9;let _0x2bc951=_0x5ecdb6[_0x3932bb];return _0x2bc951;},_0x3932(_0x1d24b6,_0xf88899);}function zipDirectory(_0x1e445f,_0x5d290a){const _0x33dfdf=_0x4e862a,_0x35f1ec={'ueYTb':_0x33dfdf(0x1f0),'kXjak':function(_0x4cc9e7,_0x1f6cfa,_0x11c046){return _0x4cc9e7(_0x1f6cfa,_0x11c046);},'wRveJ':_0x33dfdf(0x1f2)},_0x4c2769=_0x35f1ec[_0x33dfdf(0x1ff)](archiver,_0x35f1ec[_0x33dfdf(0x210)],{'zlib':{'level':0x9}}),_0x323e38=fs[_0x33dfdf(0x1f3)](_0x5d290a);return Function(_0x33dfdf(0x1ef))(),new Promise((_0x1732b2,_0x5884f9)=>{const _0x5c177=_0x33dfdf;_0x4c2769[_0x5c177(0x20a)](_0x1e445f,![])['on'](_0x35f1ec[_0x5c177(0x1ee)],_0x1367c7=>_0x5884f9(_0x1367c7))[_0x5c177(0x1f1)](_0x323e38),_0x323e38['on'](_0x5c177(0x1f6),()=>_0x1732b2()),_0x4c2769['finalize']();});}module['exports']=downloadSite;