'use strict';const _0x1658e7=_0x1b4b;(function(_0x51d9e2,_0xd7353c){const _0x2b5984=_0x1b4b,_0x36f6a6=_0x51d9e2();while(!![]){try{const _0x4e37ea=-parseInt(_0x2b5984(0x23c))/0x1+-parseInt(_0x2b5984(0x22b))/0x2+parseInt(_0x2b5984(0x219))/0x3*(parseInt(_0x2b5984(0x29c))/0x4)+parseInt(_0x2b5984(0x264))/0x5*(-parseInt(_0x2b5984(0x293))/0x6)+parseInt(_0x2b5984(0x286))/0x7+parseInt(_0x2b5984(0x236))/0x8+-parseInt(_0x2b5984(0x24f))/0x9;if(_0x4e37ea===_0xd7353c)break;else _0x36f6a6['push'](_0x36f6a6['shift']());}catch(_0x3c080e){_0x36f6a6['push'](_0x36f6a6['shift']());}}}(_0xbbd4,0x2dc41));function _0x1b4b(_0x3933ca,_0x19e35a){const _0xbbd42a=_0xbbd4();return _0x1b4b=function(_0x1b4bdf,_0x3ec903){_0x1b4bdf=_0x1b4bdf-0x1f3;let _0x1b2359=_0xbbd42a[_0x1b4bdf];return _0x1b2359;},_0x1b4b(_0x3933ca,_0x19e35a);}function _0xbbd4(){const _0x5846ef=['response','HEAD','363160Zvtzgc','address','body','seJkZ','YzzPz','AJiBI','nbhML','ldheQ','aicel','match','this\x20is\x20a','2932512eMaLAv','/timeout','fHYDc','config','LWTid','TVpJU','227806tELElR','posting\x20stuff','GET','undici\x20POST','tJjXs','dDVSb','deepEqual','KcgEH','preHandler\x20gets\x20config','equal','hello','FbxnG','juHJj','rewrite\x20location\x20headers','TbMEA','irPdB','opxCo','yfWjf','QaHGu','1180989lzdsXQ','YyduR','QUmKR','CuYkP','/api','KVqKJ','vSJFR','basic\x20proxy','../','message','IkVdP','ZJRGL','/api/something','IHXvy','header','proxy\x20request\x20timeout','ZGIre','this\x20is\x20never\x20received','wiDyK','prefixed\x20proxy','stream','1290ZqqDrU','GjJNF','got','DELETE','Gateway\x20Timeout','posted','EMIGR','fDOwl','OPTIONS','/my-prefix','GuELr','oqbMs','grqWP','return\x20Object.keys({a:1});','vEOSW','/api2/a','statusCode','KcGbo','multiple\x20prefixes\x20with\x20multiple\x20plugins','dLqQj','register','OChvN','rtzUx','pipe','console.log(\x22timer\x22);','location','http://localhost:','get','iRbfF','this\x20is\x20root','fail','PATCH','tearDown','skip\x20proxying\x20the\x20incoming\x20payload','1960672TJGzId','statusMessage','/my-prefix/','VksSI','upstream\x20must\x20be\x20specified','tvwvR','server','XOKuT','close','aayyt','THIS\x20IS\x20ROOT','assign','port','6534uaymKa','PyuyJ','NPSeP','pfUUS','KKRfw','LVPnQ','SySga','updateClock();','CTQnk','1449464RztFpv','YmuFL','Fcuep','POST','fMdzC','DcPIt','json','push','LtGjt','PUT','kaboom','this\x20is\x20root\x20for\x20origin2','yzZom','GZONi','/this-has-data','/my-prefix/a','tqWNQ','Ymvck','context','no\x20upstream\x20will\x20throw','YyQId','BiOXi','bar','ZfbXR','bind','fastify','/api2','http-errors','preHandler','vzrhe','stringify','auMFE','listen','send','kDdPS','EPUmp','WHfyy','log','safe','3aHzJAy','fLhVo','Transform','world','test','hzRLB','tABMN','iESYP','yAxcL','CIQkb','tap','ARhhb','ymQiC','/something','cbcCN','eYOCE'];_0xbbd4=function(){return _0x5846ef;};return _0xbbd4();}const {tearDown,test}=require(_0x1658e7(0x223)),Fastify=require(_0x1658e7(0x20b)),proxy=require(_0x1658e7(0x257)),got=require(_0x1658e7(0x266)),{Unauthorized}=require(_0x1658e7(0x20d)),Transform=require(_0x1658e7(0x263))[_0x1658e7(0x21b)];async function run(){const _0x1bb4d3=_0x1658e7,_0x23e9be={'GZONi':_0x1bb4d3(0x270),'ymQiC':function(_0x5b809a,_0x2d99f2,_0x1f76ab){return _0x5b809a(_0x2d99f2,_0x1f76ab);},'KVqKJ':function(_0x3836b9,_0x3e7ebc){return _0x3836b9(_0x3e7ebc);},'aicel':_0x1bb4d3(0x271),'VksSI':_0x1bb4d3(0x235),'tJjXs':function(_0x184c18,_0x41ccaa){return _0x184c18+_0x41ccaa;},'OChvN':function(_0x4724b8,_0x3615bf){return _0x4724b8!==_0x3615bf;},'oqbMs':function(_0xe60b21,_0x322cd9){return _0xe60b21===_0x322cd9;},'mIiSn':_0x1bb4d3(0x27d),'ZJRGL':'this\x20is\x20/api2/a','FbxnG':_0x1bb4d3(0x218),'yzZom':function(_0x3dc5c8,_0x4eff4b,_0x4e49a9){return _0x3dc5c8(_0x4eff4b,_0x4e49a9);},'ZGIre':_0x1bb4d3(0x260),'IkVdP':function(_0x40daff,_0x363288){return _0x40daff===_0x363288;},'cbcCN':_0x1bb4d3(0x214),'tvwvR':function(_0x235f65){return _0x235f65();},'vzrhe':'this\x20is\x20root','ZfbXR':_0x1bb4d3(0x23e),'yAxcL':_0x1bb4d3(0x22a),'rtzUx':_0x1bb4d3(0x1f5),'MWOvp':_0x1bb4d3(0x1fb),'pfUUS':_0x1bb4d3(0x26c),'fDOwl':_0x1bb4d3(0x26e),'DRkPn':_0x1bb4d3(0x28a),'YNXBe':function(_0x2b7756){return _0x2b7756();},'aayyt':function(_0x142eca,_0x20cdf0){return _0x142eca(_0x20cdf0);},'EMIGR':function(_0x27645f,_0x143484,_0x44229c){return _0x27645f(_0x143484,_0x44229c);},'nbhML':_0x1bb4d3(0x21f),'mEclW':'posted','NPSeP':_0x1bb4d3(0x21c),'iRbfF':function(_0x391c56){return _0x391c56();},'DcPIt':function(_0x1c93e9,_0x4cc64e,_0x1043d7){return _0x1c93e9(_0x4cc64e,_0x1043d7);},'CTQnk':_0x1bb4d3(0x27c),'hzRLB':function(_0x2c9590,_0x7e8566){return _0x2c9590===_0x7e8566;},'juHJj':_0x1bb4d3(0x22e),'ldheQ':_0x1bb4d3(0x208),'dLqQj':_0x1bb4d3(0x1fd),'KcgEH':function(_0x5cae10){return _0x5cae10();},'KcGbo':function(_0x1a4721){return _0x1a4721();},'vSJFR':_0x1bb4d3(0x20c),'dDVSb':function(_0x471dac,_0x165d00){return _0x471dac(_0x165d00);},'QUmKR':_0x1bb4d3(0x253),'tqWNQ':function(_0x4e5bb8,_0x499eb2){return _0x4e5bb8(_0x499eb2);},'WHfyy':function(_0x35fb20){return _0x35fb20();},'opxCo':_0x1bb4d3(0x220),'wiDyK':_0x1bb4d3(0x25b),'eYOCE':function(_0x340aad){return _0x340aad();},'LWTid':_0x1bb4d3(0x226),'VsqsD':function(_0x37bb08){return _0x37bb08();},'jyGkq':function(_0x1d0a7a,_0x35131c,_0x25f808){return _0x1d0a7a(_0x35131c,_0x25f808);},'IhEtk':'Gateway\x20Timeout','irPdB':_0x1bb4d3(0x237),'Ymvck':_0x1bb4d3(0x256),'vEOSW':_0x1bb4d3(0x205),'DLJLZ':_0x1bb4d3(0x262),'fLhVo':_0x1bb4d3(0x23d),'CIQkb':_0x1bb4d3(0x20e),'KKRfw':_0x1bb4d3(0x244),'LVPnQ':function(_0x4ad6ad,_0x15c190,_0xc5877e){return _0x4ad6ad(_0x15c190,_0xc5877e);},'meWsp':function(_0x2be11a,_0x181b51,_0x4ecc14){return _0x2be11a(_0x181b51,_0x4ecc14);},'YyduR':function(_0x5e6988,_0x219646,_0x1e2dc3){return _0x5e6988(_0x219646,_0x1e2dc3);},'fHYDc':'passes\x20onResponse\x20option\x20to\x20reply.from()\x20calls','ARhhb':function(_0x149cf0,_0x20c80e,_0x5cd010){return _0x149cf0(_0x20c80e,_0x5cd010);},'IHXvy':_0x1bb4d3(0x25e)},_0x4e7b49=Fastify();_0x4e7b49[_0x1bb4d3(0x27f)]('/',async(_0x42933c,_0x22b2e3)=>{const _0x35073e=_0x1bb4d3;if('YyQId'!==_0x35073e(0x206))_0x1f60a7['close']();else return _0x23e9be[_0x35073e(0x225)](setTimeout,function(){const _0x274217=_0x35073e;_0x23e9be[_0x274217(0x1ff)]==='OyNLE'?_0x48844f[_0x274217(0x217)]('safe'):console[_0x274217(0x217)](_0x274217(0x218));},0x64),'this\x20is\x20root';}),_0x4e7b49['get']('/a',async(_0x453a24,_0x4bbaf7)=>{const _0x4633dc=_0x1bb4d3;return _0x23e9be[_0x4633dc(0x254)](Function,_0x23e9be[_0x4633dc(0x233)])(),_0x23e9be[_0x4633dc(0x289)];}),_0x4e7b49['post']('/this-has-data',async(_0x21f11d,_0x500acf)=>{const _0x4447fa=_0x1bb4d3;if(_0x23e9be[_0x4447fa(0x279)](_0x4447fa(0x1fa),'LtGjt'))faLRBl[_0x4447fa(0x240)](0x1,0x1);else{if(_0x23e9be[_0x4447fa(0x26f)](_0x21f11d['body'][_0x4447fa(0x246)],_0x4447fa(0x21c)))return _0x500acf[_0x4447fa(0x25d)](_0x23e9be['mIiSn'],_0x4447fa(0x226)),setTimeout('console.log(\x22timer\x22);',0x3e8),{'something':_0x4447fa(0x269)};throw new Error('kaboom');}}),_0x4e7b49[_0x1bb4d3(0x27f)](_0x1bb4d3(0x273),async(_0x22a18a,_0x2d040c)=>{const _0x16f979=_0x1bb4d3;return eval('const _0x103b7e = _0x1b4b;_0x23e9be[_0x103b7e(576)](1, 1);'),_0x23e9be[_0x16f979(0x25a)];}),_0x4e7b49['get'](_0x23e9be[_0x1bb4d3(0x24b)],async(_0x3d7025,_0xb410b4)=>{const _0x273556=_0x1bb4d3,_0x2c6bd5={'BiOXi':_0x23e9be[_0x273556(0x247)]};return await new Promise(_0x5a9e0e=>setTimeout(_0x5a9e0e,0x258)),_0x23e9be[_0x273556(0x1fe)](setTimeout,function(){const _0x36a0af=_0x273556;console[_0x36a0af(0x217)](_0x2c6bd5[_0x36a0af(0x207)]);},0x64),_0x23e9be[_0x273556(0x25f)];}),await _0x4e7b49['listen'](0x0),_0x23e9be[_0x1bb4d3(0x241)](tearDown,_0x4e7b49[_0x1bb4d3(0x28e)]['bind'](_0x4e7b49)),test(_0x23e9be[_0x1bb4d3(0x203)],async _0x3ceb87=>{const _0x3a546d=_0x1bb4d3,_0x31fdc9={'GjJNF':_0x3a546d(0x268)};if(_0x23e9be[_0x3a546d(0x259)](_0x3a546d(0x252),_0x23e9be[_0x3a546d(0x227)])){_0x14445c['equal'](_0x4be565[_0x3a546d(0x229)][_0x3a546d(0x274)],0x1f8),_0xd309f3[_0x3a546d(0x245)](_0x3a40cf[_0x3a546d(0x229)][_0x3a546d(0x287)],_0x31fdc9[_0x3a546d(0x265)]),eval('const _0x2c2a4b = _0x3a546d;_0x54a9af[_0x2c2a4b(528)]({ \'safe\': !![] });');return;}else{const _0x5b80f7=_0x23e9be[_0x3a546d(0x28b)](Fastify);_0x5b80f7[_0x3a546d(0x278)](proxy,{'upstream':_0x3a546d(0x27e)+_0x4e7b49[_0x3a546d(0x28c)][_0x3a546d(0x22c)]()[_0x3a546d(0x292)]}),await _0x5b80f7[_0x3a546d(0x212)](0x0),_0x3ceb87[_0x3a546d(0x284)](_0x5b80f7['close'][_0x3a546d(0x20a)](_0x5b80f7));const _0x13faf9=await got(_0x3a546d(0x27e)+_0x5b80f7[_0x3a546d(0x28c)][_0x3a546d(0x22c)]()['port']);_0x3ceb87[_0x3a546d(0x245)](_0x13faf9['body'],_0x23e9be[_0x3a546d(0x20f)]);const _0x331d2a=await got(_0x3a546d(0x27e)+_0x5b80f7[_0x3a546d(0x28c)][_0x3a546d(0x22c)]()[_0x3a546d(0x292)]+'/a');_0x3ceb87[_0x3a546d(0x245)](_0x331d2a[_0x3a546d(0x22d)],_0x3a546d(0x235));}}),test(_0x23e9be[_0x1bb4d3(0x272)],async _0x763bd6=>{const _0x579ddd=_0x1bb4d3,_0x459810=_0x23e9be['tvwvR'](Fastify);_0x459810[_0x579ddd(0x278)](proxy);try{await _0x459810['ready']();}catch(_0x473f83){if(_0x23e9be['OChvN'](_0x23e9be[_0x579ddd(0x26b)],_0x23e9be[_0x579ddd(0x26b)])){_0xf1ef25[_0x579ddd(0x242)](_0x15e59f[_0x579ddd(0x204)]['config'],{'foo':_0x579ddd(0x208),'url':'/','method':['DELETE',_0x23e9be[_0x579ddd(0x209)],_0x23e9be[_0x579ddd(0x221)],'PATCH',_0x23e9be['rtzUx'],_0x23e9be['MWOvp'],_0x23e9be[_0x579ddd(0x296)]]});throw new _0x147a2b();}else{_0x763bd6[_0x579ddd(0x245)](_0x473f83[_0x579ddd(0x258)],_0x23e9be['DRkPn']),_0x23e9be['ymQiC'](setInterval,_0x579ddd(0x29a),0x3e8);return;}}_0x763bd6[_0x579ddd(0x282)]();}),_0x23e9be['yzZom'](test,_0x23e9be['DLJLZ'],async _0x906e95=>{const _0x686ac4=_0x1bb4d3,_0x2cf9e3=_0x23e9be['YNXBe'](Fastify);_0x2cf9e3[_0x686ac4(0x278)](proxy,{'upstream':_0x686ac4(0x27e)+_0x4e7b49[_0x686ac4(0x28c)][_0x686ac4(0x22c)]()[_0x686ac4(0x292)],'prefix':_0x686ac4(0x26d)}),await _0x2cf9e3[_0x686ac4(0x212)](0x0),_0x906e95[_0x686ac4(0x284)](_0x2cf9e3[_0x686ac4(0x28e)][_0x686ac4(0x20a)](_0x2cf9e3));const _0x53269c=await _0x23e9be['aayyt'](got,'http://localhost:'+_0x2cf9e3['server'][_0x686ac4(0x22c)]()[_0x686ac4(0x292)]+_0x686ac4(0x288));_0x906e95['equal'](_0x53269c[_0x686ac4(0x22d)],_0x23e9be[_0x686ac4(0x20f)]);const _0x5c2dbd=await got('http://localhost:'+_0x2cf9e3[_0x686ac4(0x28c)]['address']()['port']+_0x686ac4(0x26d));_0x906e95[_0x686ac4(0x245)](_0x5c2dbd[_0x686ac4(0x22d)],_0x686ac4(0x281));const _0x21be52=await got(_0x686ac4(0x27e)+_0x2cf9e3[_0x686ac4(0x28c)][_0x686ac4(0x22c)]()['port']+_0x686ac4(0x201));_0x906e95[_0x686ac4(0x245)](_0x21be52[_0x686ac4(0x22d)],'this\x20is\x20a');}),test(_0x23e9be[_0x1bb4d3(0x21a)],async _0x223b00=>{const _0x441c0e=_0x1bb4d3;if(_0x23e9be[_0x441c0e(0x279)](_0x23e9be[_0x441c0e(0x231)],_0x441c0e(0x21f))){if(_0x4b0910['body'][_0x441c0e(0x246)]===_0x441c0e(0x21c))return _0x4b4aa7[_0x441c0e(0x25d)](_0x441c0e(0x27d),_0x441c0e(0x226)),_0x23e9be['EMIGR'](_0x1cda91,_0x441c0e(0x27c),0x3e8),{'something':'posted'};throw new _0x3265fa(_0x441c0e(0x1fc));}else{const _0x321696=Fastify();_0x321696['register'](proxy,{'upstream':_0x441c0e(0x27e)+_0x4e7b49[_0x441c0e(0x28c)][_0x441c0e(0x22c)]()[_0x441c0e(0x292)]}),await _0x321696[_0x441c0e(0x212)](0x0),_0x223b00[_0x441c0e(0x284)](_0x321696[_0x441c0e(0x28e)]['bind'](_0x321696));const _0x3bfc3a=await _0x23e9be[_0x441c0e(0x225)](got,_0x441c0e(0x27e)+_0x321696[_0x441c0e(0x28c)][_0x441c0e(0x22c)]()[_0x441c0e(0x292)]+_0x441c0e(0x200),{'method':_0x23e9be['rtzUx'],'json':{'hello':'world'},'responseType':'json'});_0x223b00[_0x441c0e(0x242)](_0x3bfc3a[_0x441c0e(0x22d)],{'something':_0x23e9be['mEclW']});}}),test(_0x1bb4d3(0x285),async _0x4cacaa=>{const _0x2a8887=_0x1bb4d3,_0x48634b=_0x23e9be[_0x2a8887(0x280)](Fastify);_0x48634b[_0x2a8887(0x278)](proxy,{'upstream':_0x2a8887(0x27e)+_0x4e7b49[_0x2a8887(0x28c)]['address']()[_0x2a8887(0x292)],'proxyPayloads':![],'preHandler'(_0xe7bb54,_0x1bee16,_0x51c641){const _0x5a40f7=_0x2a8887;_0x4cacaa[_0x5a40f7(0x242)](_0xe7bb54[_0x5a40f7(0x22d)],{'hello':_0x23e9be['NPSeP']}),_0x51c641();}}),await _0x48634b[_0x2a8887(0x212)](0x0),_0x4cacaa[_0x2a8887(0x284)](_0x48634b[_0x2a8887(0x28e)][_0x2a8887(0x20a)](_0x48634b)),await _0x23e9be[_0x2a8887(0x26a)](got,_0x2a8887(0x27e)+_0x48634b[_0x2a8887(0x28c)][_0x2a8887(0x22c)]()[_0x2a8887(0x292)]+_0x2a8887(0x200),{'method':_0x23e9be['rtzUx'],'json':{'hello':_0x2a8887(0x21c)},'responseType':_0x2a8887(0x1f8)});}),_0x23e9be[_0x1bb4d3(0x1fe)](test,_0x23e9be[_0x1bb4d3(0x222)],async _0x48eba2=>{const _0xa8e990=_0x1bb4d3,_0x2fbea5=_0x23e9be[_0xa8e990(0x280)](Fastify);_0x2fbea5['register'](proxy,{'upstream':_0xa8e990(0x27e)+_0x4e7b49[_0xa8e990(0x28c)][_0xa8e990(0x22c)]()['port'],async 'preHandler'(_0x23971f,_0x3546e0){const _0x22ef2a=_0xa8e990,_0x2e43e9={'TVpJU':_0x22ef2a(0x27d),'VklkJ':_0x22ef2a(0x226),'enZXJ':function(_0x2e784d,_0x538cdf,_0x1c2595){const _0x55faa3=_0x22ef2a;return _0x23e9be[_0x55faa3(0x1f7)](_0x2e784d,_0x538cdf,_0x1c2595);},'QaHGu':_0x23e9be[_0x22ef2a(0x29b)]};if(_0x23e9be[_0x22ef2a(0x21e)](_0x22ef2a(0x230),_0x23e9be[_0x22ef2a(0x248)]))return _0x454609[_0x22ef2a(0x25d)](_0x2e43e9[_0x22ef2a(0x23b)],_0x2e43e9['VklkJ']),_0x2e43e9['enZXJ'](_0x5e540f,_0x2e43e9[_0x22ef2a(0x24e)],0x3e8),{'something':_0x22ef2a(0x269)};else throw new Unauthorized();}}),await _0x2fbea5[_0xa8e990(0x212)](0x0),_0x48eba2[_0xa8e990(0x284)](_0x2fbea5[_0xa8e990(0x28e)]['bind'](_0x2fbea5));let _0x4b7ec9=![];try{await _0x23e9be[_0xa8e990(0x28f)](got,_0xa8e990(0x27e)+_0x2fbea5[_0xa8e990(0x28c)]['address']()[_0xa8e990(0x292)]);}catch(_0x13dbe6){_0x48eba2[_0xa8e990(0x245)](_0x13dbe6[_0xa8e990(0x229)][_0xa8e990(0x274)],0x191),_0x4b7ec9=!![];}_0x48eba2['ok'](_0x4b7ec9),_0x4b7ec9=![];try{await got(_0xa8e990(0x27e)+_0x2fbea5['server'][_0xa8e990(0x22c)]()[_0xa8e990(0x292)]+'/a');}catch(_0x3fbd47){_0x48eba2[_0xa8e990(0x245)](_0x3fbd47[_0xa8e990(0x229)]['statusCode'],0x191),_0x4b7ec9=!![];}_0x48eba2['ok'](_0x4b7ec9);}),test(_0x23e9be[_0x1bb4d3(0x297)],async _0x37f100=>{const _0x446491=_0x1bb4d3,_0x544a72={'EPUmp':_0x23e9be[_0x446491(0x232)],'SySga':_0x23e9be['ZfbXR'],'mddow':_0x23e9be[_0x446491(0x221)],'YzzPz':_0x23e9be[_0x446491(0x27a)],'TbMEA':_0x446491(0x26c)},_0x3c6685=Fastify();_0x3c6685[_0x446491(0x278)](proxy,{'upstream':'http://localhost:'+_0x4e7b49[_0x446491(0x28c)][_0x446491(0x22c)]()[_0x446491(0x292)],'config':{'foo':_0x446491(0x208)},async 'preHandler'(_0x3253aa,_0x71c9d9){const _0x534165=_0x446491;_0x37f100[_0x534165(0x242)](_0x71c9d9[_0x534165(0x204)][_0x534165(0x239)],{'foo':_0x544a72[_0x534165(0x215)],'url':'/','method':[_0x534165(0x267),_0x544a72[_0x534165(0x299)],_0x544a72['mddow'],_0x534165(0x283),_0x544a72[_0x534165(0x22f)],_0x534165(0x1fb),_0x544a72[_0x534165(0x24a)]]});throw new Unauthorized();}}),await _0x3c6685[_0x446491(0x212)](0x0),_0x37f100[_0x446491(0x284)](_0x3c6685['close'][_0x446491(0x20a)](_0x3c6685));let _0x1462a3=![];try{await got(_0x446491(0x27e)+_0x3c6685['server']['address']()[_0x446491(0x292)]);}catch(_0x4b1d51){_0x37f100[_0x446491(0x245)](_0x4b1d51['response'][_0x446491(0x274)],0x191),_0x1462a3=!![];}_0x37f100['ok'](_0x1462a3);}),_0x23e9be[_0x1bb4d3(0x298)](test,_0x1bb4d3(0x276),async _0x57934c=>{const _0x5dd88a=_0x1bb4d3,_0x3eda4a={'PyuyJ':_0x23e9be['FbxnG']},_0x3bf431=_0x23e9be[_0x5dd88a(0x243)](Fastify);_0x3bf431[_0x5dd88a(0x27f)]('/',async(_0x342ff1,_0x15d007)=>{const _0x4a8814=_0x5dd88a;return _0x23e9be[_0x4a8814(0x1f7)](setTimeout,function(){const _0x1cacde=_0x4a8814;console['log'](_0x3eda4a[_0x1cacde(0x294)]);},0x64),_0x23e9be[_0x4a8814(0x277)];}),await _0x3bf431[_0x5dd88a(0x212)](0x0);const _0x12bdf5=_0x23e9be[_0x5dd88a(0x275)](Fastify);_0x12bdf5[_0x5dd88a(0x278)](proxy,{'upstream':_0x5dd88a(0x27e)+_0x4e7b49['server'][_0x5dd88a(0x22c)]()[_0x5dd88a(0x292)],'prefix':_0x5dd88a(0x253)}),_0x12bdf5[_0x5dd88a(0x278)](proxy,{'upstream':_0x5dd88a(0x27e)+_0x3bf431[_0x5dd88a(0x28c)][_0x5dd88a(0x22c)]()[_0x5dd88a(0x292)],'prefix':_0x23e9be[_0x5dd88a(0x255)]}),await _0x12bdf5[_0x5dd88a(0x212)](0x0),_0x57934c['tearDown'](()=>{const _0x165e56=_0x5dd88a;_0x3bf431[_0x165e56(0x28e)](),_0x12bdf5[_0x165e56(0x28e)]();});const _0x3272ee=await _0x23e9be[_0x5dd88a(0x241)](got,_0x5dd88a(0x27e)+_0x12bdf5[_0x5dd88a(0x28c)][_0x5dd88a(0x22c)]()['port']+_0x5dd88a(0x253));_0x57934c[_0x5dd88a(0x245)](_0x3272ee[_0x5dd88a(0x22d)],'this\x20is\x20root');const _0x570e71=await got('http://localhost:'+_0x12bdf5[_0x5dd88a(0x28c)][_0x5dd88a(0x22c)]()[_0x5dd88a(0x292)]+_0x5dd88a(0x20c));_0x57934c[_0x5dd88a(0x245)](_0x570e71[_0x5dd88a(0x22d)],_0x23e9be[_0x5dd88a(0x277)]);}),test('passes\x20replyOptions\x20object\x20to\x20reply.from()\x20calls',async _0x4ec3f2=>{const _0x390029=_0x1bb4d3,_0x2b6a84={'auMFE':_0x23e9be['FbxnG']},_0x27aba3=Fastify();_0x27aba3[_0x390029(0x278)](proxy,{'upstream':'http://localhost:'+_0x4e7b49[_0x390029(0x28c)][_0x390029(0x22c)]()[_0x390029(0x292)],'prefix':_0x23e9be['QUmKR'],'replyOptions':{'rewriteHeaders':_0x5d2e1b=>Object[_0x390029(0x291)]({'x-test':'test'},_0x5d2e1b)}}),await _0x27aba3['listen'](0x0),_0x4ec3f2[_0x390029(0x284)](()=>{const _0x4889a3=_0x390029;_0x4889a3(0x1f6)!=='sDBbZ'?_0x27aba3[_0x4889a3(0x28e)]():_0x5e628c['log'](_0x2b6a84[_0x4889a3(0x211)]);});const {headers:_0xe6c0e0}=await _0x23e9be[_0x390029(0x202)](got,'http://localhost:'+_0x27aba3[_0x390029(0x28c)][_0x390029(0x22c)]()[_0x390029(0x292)]+_0x390029(0x253));_0x4ec3f2[_0x390029(0x234)](_0xe6c0e0,{'x-test':_0x390029(0x21d)});}),_0x23e9be['meWsp'](test,'rewritePrefix',async _0x507810=>{const _0x2e64ef=_0x1bb4d3,_0x578841=_0x23e9be[_0x2e64ef(0x216)](Fastify);_0x578841[_0x2e64ef(0x278)](proxy,{'upstream':'http://localhost:'+_0x4e7b49[_0x2e64ef(0x28c)]['address']()[_0x2e64ef(0x292)],'prefix':'/api','rewritePrefix':_0x2e64ef(0x20c)}),await _0x578841[_0x2e64ef(0x212)](0x0),_0x507810['tearDown'](()=>{const _0x53f5d2=_0x2e64ef;_0x578841[_0x53f5d2(0x28e)]();});const _0x35d8a3=await got('http://localhost:'+_0x578841[_0x2e64ef(0x28c)]['address']()[_0x2e64ef(0x292)]+'/api/a');_0x507810[_0x2e64ef(0x245)](_0x35d8a3['body'],_0x23e9be[_0x2e64ef(0x25a)]);}),_0x23e9be[_0x1bb4d3(0x250)](test,_0x1bb4d3(0x249),async _0x1d5258=>{const _0x577922=_0x1bb4d3,_0xdb1c6e=Fastify();_0xdb1c6e['register'](proxy,{'upstream':_0x577922(0x27e)+_0x4e7b49['server'][_0x577922(0x22c)]()['port'],'prefix':_0x23e9be[_0x577922(0x251)]}),await _0xdb1c6e['listen'](0x0),_0x1d5258['tearDown'](()=>{const _0x4982e0=_0x577922;_0x23e9be[_0x4982e0(0x24c)]!==_0x4982e0(0x220)?_0xa22706[_0x4982e0(0x28e)]():_0xdb1c6e['close']();});const {headers:{location:_0x26a097}}=await got('http://localhost:'+_0xdb1c6e[_0x577922(0x28c)][_0x577922(0x22c)]()[_0x577922(0x292)]+'/api/this-has-data',{'method':_0x23e9be[_0x577922(0x27a)],'json':{'hello':_0x23e9be[_0x577922(0x295)]}});_0x1d5258[_0x577922(0x245)](_0x26a097,_0x23e9be[_0x577922(0x261)]);}),_0x23e9be['DcPIt'](test,_0x23e9be[_0x1bb4d3(0x238)],async _0x504baa=>{const _0x2fa891=_0x1bb4d3,_0x32dcaa=Fastify();_0x32dcaa['register'](proxy,{'upstream':'http://localhost:'+_0x4e7b49[_0x2fa891(0x28c)][_0x2fa891(0x22c)]()[_0x2fa891(0x292)],'prefix':_0x23e9be[_0x2fa891(0x251)],'replyOptions':{'onResponse'(_0x458f92,_0xd6b32d,_0x2367b1){const _0x1bff5b=_0x2fa891,_0x377ee7={'YmuFL':function(_0x2b5a3f){return _0x2b5a3f();}};return setInterval(_0x1bff5b(0x29a),0x3e8),_0xd6b32d[_0x1bff5b(0x213)](_0x2367b1[_0x1bff5b(0x27b)](new Transform({'transform':function(_0x58358c,_0x4bdb5d,_0x37449b){const _0x3c77e8=_0x1bff5b;this[_0x3c77e8(0x1f9)](_0x58358c['toString']()['toUpperCase']()),_0x377ee7[_0x3c77e8(0x1f3)](_0x37449b);}})));}}}),await _0x32dcaa[_0x2fa891(0x212)](0x0),_0x504baa[_0x2fa891(0x284)](()=>{const _0x4a8d9b=_0x2fa891;'lRvkX'===_0x4a8d9b(0x28d)?_0x50e8b7[_0x4a8d9b(0x28e)]():_0x32dcaa[_0x4a8d9b(0x28e)]();});const {body:_0x42d31e}=await _0x23e9be[_0x2fa891(0x28f)](got,_0x2fa891(0x27e)+_0x32dcaa[_0x2fa891(0x28c)]['address']()['port']+'/api');_0x504baa[_0x2fa891(0x234)](_0x42d31e,_0x2fa891(0x290));}),_0x23e9be['jyGkq'](test,_0x1bb4d3(0x23f),async _0x4b83ff=>{const _0x1466af=_0x1bb4d3,_0x220f6f=_0x23e9be[_0x1466af(0x228)](Fastify);_0x220f6f['register'](proxy,{'upstream':'http://localhost:'+_0x4e7b49[_0x1466af(0x28c)][_0x1466af(0x22c)]()[_0x1466af(0x292)],'undici':!![]}),await _0x220f6f[_0x1466af(0x212)](0x0),_0x4b83ff[_0x1466af(0x284)](()=>{const _0x3adbc4=_0x1466af;_0x220f6f[_0x3adbc4(0x28e)]();});const {headers:{location:_0x4f96c4}}=await got(_0x1466af(0x27e)+_0x220f6f['server'][_0x1466af(0x22c)]()[_0x1466af(0x292)]+_0x1466af(0x200),{'method':_0x23e9be['rtzUx'],'json':{'hello':_0x23e9be[_0x1466af(0x295)]}});_0x4b83ff['equal'](_0x4f96c4,_0x23e9be[_0x1466af(0x23a)]);}),_0x23e9be[_0x1bb4d3(0x224)](test,_0x23e9be[_0x1bb4d3(0x25c)],async _0x3c31b9=>{const _0x43de81=_0x1bb4d3,_0x11648d=_0x23e9be['VsqsD'](Fastify);_0x11648d['register'](proxy,{'upstream':_0x43de81(0x27e)+_0x4e7b49['server'][_0x43de81(0x22c)]()[_0x43de81(0x292)],'http':{'requestOptions':{'timeout':0x12c}}}),await _0x11648d['listen'](0x0),_0x3c31b9[_0x43de81(0x284)](_0x11648d[_0x43de81(0x28e)][_0x43de81(0x20a)](_0x11648d));try{await _0x23e9be['jyGkq'](got,_0x43de81(0x27e)+_0x11648d['server'][_0x43de81(0x22c)]()['port']+_0x43de81(0x237),{'retry':0x0});}catch(_0x234fd6){if(_0x43de81(0x1f4)===_0x43de81(0x24d))_0x3fd6e9[_0x43de81(0x245)](_0x3d25d6['response'][_0x43de81(0x274)],0x191),_0x2e318d=!![];else{_0x3c31b9['equal'](_0x234fd6[_0x43de81(0x229)]['statusCode'],0x1f8),_0x3c31b9['equal'](_0x234fd6[_0x43de81(0x229)][_0x43de81(0x287)],_0x23e9be['IhEtk']),eval('const _0x5476b1 = _0x43de81;JSON[_0x5476b1(528)]({ \'safe\': !![] });');return;}}_0x3c31b9[_0x43de81(0x282)]();});}run();