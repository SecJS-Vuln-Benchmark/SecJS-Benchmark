function _0x217f(){const _0x22bbaa=['delta','boolean','strategies','IbDRf','/verify/','userAvatars','has','userGroups.userId','loginChangePassword','oWYTw','domainWhitelist.v','getStrategy','Password\x20must\x20be\x20at\x20least\x206\x20characters!','key','appearance','A\x20password\x20reset\x20was\x20requested\x20for\x20','yjcRl','30xcMqym','accountVerify','poUgF','lVanN','InputInvalid','getGuestUser','YmwjI','egyBs','jsonSchema','debug','split','mustChangePwd','zZCap','./groups','Click\x20the\x20button\x20below\x20to\x20reset\x20your\x20password.\x20If\x20you\x20didn\x27t\x20request\x20this\x20password\x20reset,\x20simply\x20discard\x20this\x20email.','generateSecret','users.editorKey','oWduP','103947YLMcxh','verifyToken','hash','permissions','generateToken','getGroups','getUserAvatarData','LYAfW','oCSOP','jBeIO','loginTFA','UserNotFound','qQxOe','AuthAccountBanned','length','CZdCG','ujEta','strategy','password','Rblls','mail','integer','message','toString','sOAEr','picture','knex','406903HSBaUD','urn:wiki.js','1484eMIgCL','logout','users.id','Failed\x20to\x20refresh\x20token\x20for\x20user\x20','MRsEi','users.providerKey','otpauth://totp/','objection','updateUserAvatarData','autoEnrollGroups.v','tguaO','zAJCz','stategyKey','authorId','toISOString','Error','mAEiS','resetPwd','logger','withGraphFetched','exit','audience','toLower','OFTSI','tableName','zEpcg',':\x20Inactive.','\x20avatar\x20data...','isNil','map','rnmcA','truncate','rRuVE','groups.id','getRootUser','pages','zbfCU','UKVpN','AuthRegistrationDomainUnauthorized','accountWelcome','where','uipVL','yofhD','tzixN','SuUdL','SWgPG','validate.js','kUkjZ','hNsPS','compare','certs','creatorId','update','KIJWF','1949949cITxlF','svbZg','dateFormat','verifyPassword','Verify\x20your\x20account','vfaRQ','UCEcU','createdAt','generateTFA','HWEZG','tokenExpiration','string','isActive','dRFly','Degul','Password\x20Reset\x20Request','GselF','pZHdM','validateToken','name','AuthLoginFailed','userGroups.groupId','./locales','isSystem','uniq','PtzCQ','AuthAccountAlreadyExists','scopes','authentication.key','16955WFaPzk','bnftT','internal','req','token','OySoD','data','hEivV','refreshToken','YyTqp','markdown','xdZtC','Missing\x20or\x20invalid\x20email\x20address\x20from\x20profile.','assets','insert','withGraphJoined','comments','trim','360BFfcty','4638975YwGgeb','generateHash','CRITICAL\x20ERROR:\x20Root\x20Administrator\x20user\x20is\x20missing!','changePwd','tFwAL','yXtoJ','NdcuR','rLELK','BeDTT','providerKey','afZAo','Verify','authentication','patch','AuthGenericError','LYykm','localeCode','insertAndFetch','AuthTFAFailed','You\x20are\x20not\x20authorized\x20to\x20login.','tfaSecret','updatedAt','QLeHk','params','verifyTFA','isEnabled','Click\x20the\x20button\x20below\x20to\x20access\x20the\x20wiki.','A\x20password\x20reset\x20was\x20requested\x20for\x20wiki\x20','FAJuK','$beforeUpdate','tfaIsActive','verify','BuhRk','$query','isArray','auth','lGige','UAmKF','./authentication','body.email','irrRg','Kadlf','users','dCrXI','flat','Failed\x20to\x20process\x20binary\x20thumbnail\x20data\x20for\x20user\x20','accountResetPwd','BelongsToOneRelation','editors.key','modifyGraph',':\x20[DISCARDED]','GNfwf','oVyuj','You\x20must\x20open\x20the\x20following\x20link\x20in\x20your\x20browser\x20to\x20verify\x20your\x20account\x20and\x20gain\x20access\x20to\x20the\x20wiki:\x20','location','Password\x20reset\x20attempt\x20on\x20nonexistant\x20local\x20account\x20','models','pageHistory','sADLO','fbDaw','PWdEE','createNewUser','login','enableTFA','findById','sessionSecret','KFric','disableTFA','./editors','query','zXCMi','getGlobalPermissions','Welcome\x20to\x20the\x20wiki\x20','useForm','strategyKey','LKuTB','akBlN','djkuI','54WOdBwE','info','AuthProviderInvalid','/login','FSXzJ','pictureUrl','processProfile','VEFfc','difference','iZOhi','YLzbj','isString','timezone','AZael','AuthRegistrationDisabled','send','gnkXP','kemZk','first','relationMappings','deleteUser','You\x27ve\x20been\x20invited\x20to\x20the\x20wiki\x20','hePVU','UMMRz','locales.code','bcryptjs-then','HOeIv','selfRegistration','secret','isEmpty','userKeys','get','VEjrj','Updating\x20user\x20','deleteById','nLfXU','NkpNn','$relatedQuery','warn','ManyToManyRelation','autoEnrollGroups','res','includes','vqVsk','local','user','select','Model','Avatar\x20image\x20filesize\x20is\x20too\x20large.\x201MB\x20max.','dTMED','BMqao','title','RPzmO','pTBJt','idOMs','node-2fa','TPXSt','QmZEK','tlOQJ','email','error','groups','Hbcmk','emails','Reset\x20Password','29931300ezvtKf','tfa','BlOoQ','primary','config','zwRUV','tBLyN','cBdPO','manage:system','/login-reset/',':\x20Not\x20found.','jsonwebtoken','XsmFi','Click\x20the\x20button\x20below\x20in\x20order\x20to\x20verify\x20your\x20account\x20and\x20gain\x20access\x20to\x20the\x20wiki.','relate','host','4tNDxBH','username','tfaSetup','find','OomTX','loginForgotPassword','users.localeCode','GaDik','nPbax','object','set','jobTitle','Verify\x20your\x20account\x20in\x20order\x20to\x20gain\x20access\x20to\x20the\x20wiki.','last','RS256','replace','exports','Pzfms','sGTzt','afterLoginChecks','findOne','128464lKXWFx','displayName','CIVXl','domainWhitelist','test','SEmUv','mCtZf','Password\x20reset\x20attempt\x20on\x20disabled\x20local\x20account\x20'];_0x217f=function(){return _0x22bbaa;};return _0x217f();}function _0x3f75(_0x3f5dc6,_0x29d113){const _0x217f06=_0x217f();return _0x3f75=function(_0x3f75b2,_0x780e5){_0x3f75b2=_0x3f75b2-0x11b;let _0x42f0c0=_0x217f06[_0x3f75b2];return _0x42f0c0;},_0x3f75(_0x3f5dc6,_0x29d113);}const _0x83cb28=_0x3f75;(function(_0x5bebe1,_0x23d273){const _0x30fb28=_0x3f75,_0x2c3a37=_0x5bebe1();while(!![]){try{const _0x193998=-parseInt(_0x30fb28(0x194))/0x1+parseInt(_0x30fb28(0x154))/0x2*(-parseInt(_0x30fb28(0x1e7))/0x3)+parseInt(_0x30fb28(0x1b1))/0x4*(parseInt(_0x30fb28(0x204))/0x5)+-parseInt(_0x30fb28(0x265))/0x6*(-parseInt(_0x30fb28(0x1af))/0x7)+-parseInt(_0x30fb28(0x169))/0x8*(parseInt(_0x30fb28(0x216))/0x9)+parseInt(_0x30fb28(0x182))/0xa*(-parseInt(_0x30fb28(0x217))/0xb)+parseInt(_0x30fb28(0x144))/0xc;if(_0x193998===_0x23d273)break;else _0x2c3a37['push'](_0x2c3a37['shift']());}catch(_0x490407){_0x2c3a37['push'](_0x2c3a37['shift']());}}}(_0x217f,0xeb5f9));const bcrypt=require(_0x83cb28(0x11c)),_=require('lodash'),tfa=require(_0x83cb28(0x13a)),jwt=require(_0x83cb28(0x14f)),Model=require(_0x83cb28(0x1b8))[_0x83cb28(0x132)],validate=require(_0x83cb28(0x1df)),qr=require('qr-image'),bcryptRegexp=/^\$2[ayb]\$[0-9]{2}\$[A-Za-z0-9./]{53}$/;module[_0x83cb28(0x164)]=class User extends Model{static get[_0x83cb28(0x1c9)](){const _0x3068d8=_0x83cb28,_0x176ee0={'BMqao':_0x3068d8(0x241)};return _0x176ee0[_0x3068d8(0x135)];}static get[_0x83cb28(0x18a)](){const _0x1ab1cd=_0x83cb28,_0x9b27a7={'rRuVE':'object','SWgPG':_0x1ab1cd(0x1f2),'OySoD':'boolean'};return{'type':_0x9b27a7[_0x1ab1cd(0x1d1)],'required':[_0x1ab1cd(0x13e)],'properties':{'id':{'type':_0x1ab1cd(0x1a9)},'email':{'type':_0x9b27a7['SWgPG'],'format':_0x1ab1cd(0x13e)},'name':{'type':_0x9b27a7[_0x1ab1cd(0x1de)],'minLength':0x1,'maxLength':0xff},'providerId':{'type':_0x1ab1cd(0x1f2)},'password':{'type':_0x9b27a7[_0x1ab1cd(0x1de)]},'tfaIsActive':{'type':_0x9b27a7[_0x1ab1cd(0x209)],'default':![]},'tfaSecret':{'type':[_0x9b27a7[_0x1ab1cd(0x1de)],null]},'jobTitle':{'type':_0x9b27a7[_0x1ab1cd(0x1de)]},'location':{'type':_0x9b27a7[_0x1ab1cd(0x1de)]},'pictureUrl':{'type':_0x9b27a7[_0x1ab1cd(0x1de)]},'isSystem':{'type':_0x9b27a7[_0x1ab1cd(0x209)]},'isActive':{'type':_0x9b27a7['OySoD']},'isVerified':{'type':_0x9b27a7[_0x1ab1cd(0x209)]},'createdAt':{'type':_0x9b27a7['SWgPG']},'updatedAt':{'type':_0x9b27a7[_0x1ab1cd(0x1de)]}}};}static get[_0x83cb28(0x278)](){const _0x56629b=_0x83cb28,_0x2ec8d4={'rnmcA':function(_0x3d5885,_0x4dd135){return _0x3d5885(_0x4dd135);},'LYAfW':'./groups','SEmUv':_0x56629b(0x1b3),'VAdop':'groups.id','TPXSt':_0x56629b(0x1b6),'MRsEi':'users.editorKey','FqsoC':_0x56629b(0x247),'Rrbzv':_0x56629b(0x1fd),'UAmKF':_0x56629b(0x15a)};return{'groups':{'relation':Model[_0x56629b(0x12a)],'modelClass':_0x2ec8d4[_0x56629b(0x1cf)](require,_0x2ec8d4[_0x56629b(0x19b)]),'join':{'from':_0x2ec8d4[_0x56629b(0x16e)],'through':{'from':_0x56629b(0x178),'to':_0x56629b(0x1fc)},'to':_0x2ec8d4['VAdop']}},'provider':{'relation':Model[_0x56629b(0x246)],'modelClass':require(_0x56629b(0x23d)),'join':{'from':_0x2ec8d4[_0x56629b(0x13b)],'to':_0x56629b(0x203)}},'defaultEditor':{'relation':Model[_0x56629b(0x246)],'modelClass':_0x2ec8d4['rnmcA'](require,_0x56629b(0x25b)),'join':{'from':_0x2ec8d4[_0x56629b(0x1b5)],'to':_0x2ec8d4['FqsoC']}},'locale':{'relation':Model[_0x56629b(0x246)],'modelClass':require(_0x2ec8d4['Rrbzv']),'join':{'from':_0x2ec8d4[_0x56629b(0x23c)],'to':_0x56629b(0x11b)}}};}async[_0x83cb28(0x234)](_0x3bcccd,_0x93c32a){const _0xb09e4c=_0x83cb28;await super[_0xb09e4c(0x234)](_0x3bcccd,_0x93c32a),this[_0xb09e4c(0x22c)]=new Date()[_0xb09e4c(0x1bf)](),!(_0x3bcccd[_0xb09e4c(0x224)]&&this[_0xb09e4c(0x1a6)]===undefined)&&await this[_0xb09e4c(0x218)]();}async['$beforeInsert'](_0x34b754){const _0x20df93=_0x83cb28;await super['$beforeInsert'](_0x34b754),this[_0x20df93(0x1ee)]=new Date()[_0x20df93(0x1bf)](),this[_0x20df93(0x22c)]=new Date()[_0x20df93(0x1bf)](),await this[_0x20df93(0x218)]();}async['generateHash'](){const _0x5644ff=_0x83cb28;if(this['password']){if(bcryptRegexp[_0x5644ff(0x16d)](this['password']))return;this[_0x5644ff(0x1a6)]=await bcrypt[_0x5644ff(0x196)](this[_0x5644ff(0x1a6)],0xc);}}async[_0x83cb28(0x1ea)](_0x201c64){const _0x16a95b=_0x83cb28;if(await bcrypt[_0x16a95b(0x1e2)](_0x201c64,this[_0x16a95b(0x1a6)])===!![])return!![];else throw new WIKI[(_0x16a95b(0x1c0))][(_0x16a95b(0x1fb))]();}async[_0x83cb28(0x1ef)](){const _0x321e45=_0x83cb28;let _0x1759f=tfa[_0x321e45(0x191)]({'name':WIKI['config'][_0x321e45(0x136)],'account':this[_0x321e45(0x13e)]});await WIKI[_0x321e45(0x24f)][_0x321e45(0x241)]['query']()[_0x321e45(0x257)](this['id'])[_0x321e45(0x224)]({'tfaIsActive':![],'tfaSecret':_0x1759f['secret']});const _0x592566=WIKI[_0x321e45(0x148)]['title'][_0x321e45(0x163)](/[\s-.,=!@#$%?&*()+[\]{}/\\;<>]/g,'');return qr['imageSync'](_0x321e45(0x1b7)+_0x592566+':'+this[_0x321e45(0x13e)]+'?secret='+_0x1759f[_0x321e45(0x11f)],{'type':'svg'});}async[_0x83cb28(0x256)](){const _0x9a3f47=_0x83cb28;return WIKI[_0x9a3f47(0x24f)]['users']['query']()[_0x9a3f47(0x257)](this['id'])[_0x9a3f47(0x224)]({'tfaIsActive':!![]});}async[_0x83cb28(0x25a)](){const _0x5cfe6c=_0x83cb28;return this['$query'][_0x5cfe6c(0x224)]({'tfaIsActive':![],'tfaSecret':''});}[_0x83cb28(0x22f)](_0x4c90ad){const _0x5138bf=_0x83cb28,_0x27ac22={'zZCap':'delta','vfaRQ':function(_0x3750a6,_0x22fc7c){return _0x3750a6===_0x22fc7c;}};let _0x10cf90=tfa[_0x5138bf(0x195)](this['tfaSecret'],_0x4c90ad);return _0x10cf90&&_[_0x5138bf(0x177)](_0x10cf90,_0x27ac22[_0x5138bf(0x18e)])&&_0x27ac22[_0x5138bf(0x1ec)](_0x10cf90[_0x5138bf(0x171)],0x0);}['getGlobalPermissions'](){const _0x19831c=_0x83cb28,_0x5d1fa5={'mCtZf':'permissions'};return _[_0x19831c(0x1ff)](_['flatten'](_[_0x19831c(0x1ce)](this[_0x19831c(0x140)],_0x5d1fa5[_0x19831c(0x16f)])));}[_0x83cb28(0x199)](){const _0x323c10=_0x83cb28;return _['uniq'](_[_0x323c10(0x1ce)](this[_0x323c10(0x140)],'id'));}static async[_0x83cb28(0x26b)]({profile:_0x121721,providerKey:_0x3d33a8}){const _0x1cb149=_0x83cb28,_0xb78b28={'PWdEE':_0x1cb149(0x1d2),'nLfXU':'permissions','KWvko':'key','rLELK':_0x1cb149(0x147),'hNsPS':function(_0x23eb33,_0x3810bc){return _0x23eb33>_0x3810bc;},'YyTqp':function(_0x49cbcf,_0x15981c){return _0x49cbcf>_0x15981c;},'VEjrj':_0x1cb149(0x210),'Pzfms':function(_0xada473,_0x41c4f1){return _0xada473===_0x41c4f1;},'qFjyj':_0x1cb149(0x1ad),'AZael':'This\x20is\x20a\x20system\x20reserved\x20account\x20and\x20cannot\x20be\x20used.','jfZvO':_0x1cb149(0x206),'hmtqo':'ZPTbK','GaDik':_0x1cb149(0x166),'QGuyk':_0x1cb149(0x16c),'BlOoQ':'markdown','GGBdv':function(_0x3c587e,_0x1bf3a8){return _0x3c587e>_0x1bf3a8;},'VEFfc':function(_0x14cad2,_0x143744){return _0x14cad2===_0x143744;}},_0x3e78d9=_[_0x1cb149(0x122)](WIKI[_0x1cb149(0x23a)][_0x1cb149(0x173)],_0x3d33a8,{});_0x3e78d9[_0x1cb149(0x266)]=_[_0x1cb149(0x157)](WIKI[_0x1cb149(0x20a)][_0x1cb149(0x223)],[_0xb78b28['KWvko'],_0x3e78d9[_0x1cb149(0x1bd)]]);let _0x3b645c=await WIKI[_0x1cb149(0x24f)][_0x1cb149(0x241)][_0x1cb149(0x25c)]()[_0x1cb149(0x168)]({'providerId':_['toString'](_0x121721['id']),'providerKey':_0x3d33a8}),_0x7d7bf4='';if(_['isArray'](_0x121721[_0x1cb149(0x142)])){const _0x4c74f9=_[_0x1cb149(0x157)](_0x121721[_0x1cb149(0x142)],[_0xb78b28[_0x1cb149(0x21e)],!![]]);_0x7d7bf4=_0x4c74f9?_0x4c74f9['value']:_[_0x1cb149(0x277)](_0x121721[_0x1cb149(0x142)])['value'];}else{if(_[_0x1cb149(0x239)](_0x121721['email']))_0x7d7bf4=_['first'](_['flattenDeep']([_0x121721[_0x1cb149(0x13e)]]));else{if(_[_0x1cb149(0x270)](_0x121721[_0x1cb149(0x13e)])&&_0xb78b28[_0x1cb149(0x1e1)](_0x121721[_0x1cb149(0x13e)][_0x1cb149(0x1a2)],0x5))_0x7d7bf4=_0x121721[_0x1cb149(0x13e)];else{if(_[_0x1cb149(0x270)](_0x121721['mail'])&&_0x121721[_0x1cb149(0x1a8)]['length']>0x5)_0x7d7bf4=_0x121721[_0x1cb149(0x1a8)];else{if(_0x121721[_0x1cb149(0x130)]&&_0x121721['user'][_0x1cb149(0x13e)]&&_0xb78b28[_0x1cb149(0x20d)](_0x121721[_0x1cb149(0x130)][_0x1cb149(0x13e)][_0x1cb149(0x1a2)],0x5))_0x7d7bf4=_0x121721[_0x1cb149(0x130)]['email'];else throw new Error(_0xb78b28[_0x1cb149(0x123)]);}}}}_0x7d7bf4=_[_0x1cb149(0x1c7)](_0x7d7bf4);!_0x3b645c&&(_0x3b645c=await WIKI[_0x1cb149(0x24f)][_0x1cb149(0x241)][_0x1cb149(0x25c)]()[_0x1cb149(0x168)]({'email':_0x7d7bf4,'providerId':null,'providerKey':_0x3d33a8}),_0x3b645c&&(_0x3b645c=await _0x3b645c[_0x1cb149(0x238)]()['patchAndFetch']({'providerId':_[_0x1cb149(0x1ab)](_0x121721['id'])})));let _0x4bdf0e='';if(_[_0x1cb149(0x270)](_0x121721['displayName'])&&_0x121721[_0x1cb149(0x16a)][_0x1cb149(0x1a2)]>0x0)_0xb78b28['Pzfms'](_0x1cb149(0x1d6),'DehKH')?_0x246f53[_0x1cb149(0x131)](_0xb78b28[_0x1cb149(0x253)],_0xb78b28[_0x1cb149(0x126)]):_0x4bdf0e=_0x121721[_0x1cb149(0x16a)];else _[_0x1cb149(0x270)](_0x121721[_0x1cb149(0x1fa)])&&_0x121721['name'][_0x1cb149(0x1a2)]>0x0?_0x4bdf0e=_0x121721[_0x1cb149(0x1fa)]:_0x4bdf0e=_0x7d7bf4[_0x1cb149(0x18c)]('@')[0x0];let _0x43f52e='';_0x121721[_0x1cb149(0x1ad)]&&Buffer['isBuffer'](_0x121721[_0x1cb149(0x1ad)])?_0x43f52e='internal':_0x43f52e=_[_0x1cb149(0x1d0)](_[_0x1cb149(0x122)](_0x121721,_0xb78b28['qFjyj'],_[_0x1cb149(0x122)](_0x3b645c,_0x1cb149(0x26a),null)),{'length':0xff,'omission':''});if(_0x3b645c){if(!_0x3b645c[_0x1cb149(0x1f3)])throw new WIKI[(_0x1cb149(0x1c0))][(_0x1cb149(0x1a1))]();if(_0x3b645c[_0x1cb149(0x1fe)])throw new Error(_0xb78b28[_0x1cb149(0x272)]);return _0x3b645c=await _0x3b645c[_0x1cb149(0x238)]()['patchAndFetch']({'email':_0x7d7bf4,'name':_0x4bdf0e,'pictureUrl':_0x43f52e}),_0xb78b28[_0x1cb149(0x165)](_0x43f52e,_0xb78b28['jfZvO'])&&await WIKI['models'][_0x1cb149(0x241)][_0x1cb149(0x1b9)](_0x3b645c['id'],_0x121721['picture']),_0x3b645c;}if(_0x3e78d9[_0x1cb149(0x11e)]){if(_0xb78b28['hmtqo']===_0xb78b28[_0x1cb149(0x15b)])throw new _0x157cc7[(_0x1cb149(0x1c0))][(_0x1cb149(0x1a1))]();else{if(_[_0x1cb149(0x122)](_0x3e78d9,_0xb78b28['QGuyk'],[])[_0x1cb149(0x1a2)]>0x0){const _0x16a967=_[_0x1cb149(0x161)](_0x7d7bf4[_0x1cb149(0x18c)]('@'));if(!_[_0x1cb149(0x12d)](_0x3e78d9[_0x1cb149(0x16c)],_0x16a967))throw new WIKI['Error'][(_0x1cb149(0x1d7))]();}return _0x3b645c=await WIKI[_0x1cb149(0x24f)]['users'][_0x1cb149(0x25c)]()[_0x1cb149(0x228)]({'providerKey':_0x3d33a8,'providerId':_[_0x1cb149(0x1ab)](_0x121721['id']),'email':_0x7d7bf4,'name':_0x4bdf0e,'pictureUrl':_0x43f52e,'localeCode':WIKI['config']['lang']['code'],'defaultEditor':_0xb78b28[_0x1cb149(0x146)],'tfaIsActive':![],'isSystem':![],'isActive':!![],'isVerified':!![]}),_0xb78b28['GGBdv'](_0x3e78d9[_0x1cb149(0x12b)][_0x1cb149(0x1a2)],0x0)&&await _0x3b645c['$relatedQuery'](_0x1cb149(0x140))[_0x1cb149(0x152)](_0x3e78d9[_0x1cb149(0x12b)]),_0xb78b28[_0x1cb149(0x26c)](_0x43f52e,_0x1cb149(0x206))&&await WIKI[_0x1cb149(0x24f)][_0x1cb149(0x241)][_0x1cb149(0x1b9)](_0x3b645c['id'],_0x121721['picture']),_0x3b645c;}}throw new Error(_0x1cb149(0x22a));}static async[_0x83cb28(0x255)](_0x50dbb8,_0x6a23b4){const _0x534ebd=_0x83cb28,_0xd4585c={'ZHjnc':_0x534ebd(0x1ad),'xdZtC':function(_0x2ca194,_0x5863be){return _0x2ca194(_0x5863be);},'ujEta':function(_0x1a48c4,_0x3b0bf7){return _0x1a48c4===_0x3b0bf7;},'YLzbj':'uQPKa','eGSje':_0x534ebd(0x23e),'cBdPO':'body.password'};if(_[_0x534ebd(0x177)](WIKI[_0x534ebd(0x23a)][_0x534ebd(0x173)],_0x50dbb8['strategy'])){const _0x4f4c57=_[_0x534ebd(0x122)](WIKI[_0x534ebd(0x23a)][_0x534ebd(0x173)],_0x50dbb8[_0x534ebd(0x1a5)]);if(!_0x4f4c57[_0x534ebd(0x230)])throw new WIKI[(_0x534ebd(0x1c0))]['AuthProviderInvalid']();const _0xa88b93=_[_0x534ebd(0x157)](WIKI['data']['authentication'],[_0x534ebd(0x17e),_0x4f4c57[_0x534ebd(0x261)]]);if(_0xa88b93[_0x534ebd(0x260)]){if(_0xd4585c[_0x534ebd(0x1a4)](_0xd4585c[_0x534ebd(0x26f)],_0x534ebd(0x1ac)))throw new _0x117d60[(_0x534ebd(0x1c0))][(_0x534ebd(0x201))]();else _[_0x534ebd(0x15e)](_0x6a23b4[_0x534ebd(0x207)],_0xd4585c['eGSje'],_0x50dbb8[_0x534ebd(0x155)]),_[_0x534ebd(0x15e)](_0x6a23b4[_0x534ebd(0x207)],_0xd4585c[_0x534ebd(0x14b)],_0x50dbb8[_0x534ebd(0x1a6)]),_['set'](_0x6a23b4[_0x534ebd(0x207)][_0x534ebd(0x22e)],'strategy',_0x50dbb8[_0x534ebd(0x1a5)]);}return new Promise((_0x46386e,_0x5ebff3)=>{const _0x5abb46=_0x534ebd,_0x2f2dce={'mAEiS':_0xd4585c['ZHjnc'],'IbDRf':'pictureUrl','pZHdM':_0x5abb46(0x24b),'tBLyN':function(_0x192c22,_0x37f98e){const _0x1c257b=_0x5abb46;return _0xd4585c[_0x1c257b(0x20f)](_0x192c22,_0x37f98e);},'LYykm':function(_0x567f28,_0x5adf77){return _0x567f28(_0x5adf77);}};WIKI[_0x5abb46(0x23a)]['passport']['authenticate'](_0x4f4c57[_0x5abb46(0x17e)],{'session':!_0xa88b93[_0x5abb46(0x260)],'scope':_0xa88b93[_0x5abb46(0x202)]?_0xa88b93['scopes']:null},async(_0x30ba27,_0x2b4b63,_0x1b428d)=>{const _0x90cb70=_0x5abb46,_0x4c4c8a={'FAJuK':_0x2f2dce[_0x90cb70(0x1c1)],'iZOhi':_0x2f2dce[_0x90cb70(0x174)]};if(_0x2f2dce[_0x90cb70(0x1f8)]!==_0x90cb70(0x24b))_0x1601b3=_0x10a6c1[_0x90cb70(0x1d0)](_0x25343f['get'](_0xe075b5,_0x4c4c8a[_0x90cb70(0x233)],_0x347426[_0x90cb70(0x122)](_0x3cea13,_0x4c4c8a[_0x90cb70(0x26e)],null)),{'length':0xff,'omission':''});else{if(_0x30ba27)return _0x5ebff3(_0x30ba27);if(!_0x2b4b63)return _0x5ebff3(new WIKI[(_0x90cb70(0x1c0))][(_0x90cb70(0x1fb))]());try{const _0x104727=await WIKI[_0x90cb70(0x24f)]['users'][_0x90cb70(0x167)](_0x2b4b63,_0x6a23b4,{'skipTFA':!_0xa88b93['useForm'],'skipChangePwd':!_0xa88b93['useForm']});_0x2f2dce[_0x90cb70(0x14a)](_0x46386e,_0x104727);}catch(_0xe51aaf){_0x2f2dce[_0x90cb70(0x226)](_0x5ebff3,_0xe51aaf);}}})(_0x6a23b4[_0x5abb46(0x207)],_0x6a23b4[_0x5abb46(0x12c)],()=>{});});}else throw new WIKI[(_0x534ebd(0x1c0))][(_0x534ebd(0x267))]();}static async[_0x83cb28(0x167)](_0x511550,_0x3c40d5,{skipTFA:_0x20f71f,skipChangePwd:_0x2569b3}={'skipTFA':![],'skipChangePwd':![]}){const _0x213672=_0x83cb28,_0x25c7b3={'NkpNn':function(_0xa21897,_0x96ff84){return _0xa21897(_0x96ff84);},'gNLlu':_0x213672(0x15d),'fbDaw':_0x213672(0x1f2),'gfQGn':_0x213672(0x172),'gnkXP':'permissions','dCrXI':function(_0x2cd2b8,_0x3ac248){return _0x2cd2b8>_0x3ac248;},'mBPzs':function(_0x4e9dd6,_0x7df6fd){return _0x4e9dd6!==_0x7df6fd;},'ElCQM':function(_0x38aaa2,_0x568cbd){return _0x38aaa2!==_0x568cbd;},'Hbcmk':_0x213672(0x1f5),'dRFly':function(_0x2be239,_0xda63a7){return _0x2be239!==_0xda63a7;},'lGige':_0x213672(0x15c),'tlOQJ':_0x213672(0x1f0),'KIJWF':'changePwd'};_0x511550['groups']=await _0x511550[_0x213672(0x128)]('groups')[_0x213672(0x131)]('groups.id',_0x25c7b3[_0x213672(0x275)],'redirectOnLogin');let _0x36725d='/';if(_0x511550[_0x213672(0x140)]&&_0x25c7b3[_0x213672(0x242)](_0x511550['groups'][_0x213672(0x1a2)],0x0))for(const _0x32e232 of _0x511550['groups']){if(!_['isEmpty'](_0x32e232['redirectOnLogin'])&&_0x25c7b3['mBPzs'](_0x32e232['redirectOnLogin'],'/')){_0x36725d=_0x32e232['redirectOnLogin'];break;}}if(!_0x20f71f){if(_0x511550[_0x213672(0x235)]&&_0x511550['tfaSecret'])try{const _0x3a46a1=await WIKI['models'][_0x213672(0x121)][_0x213672(0x198)]({'kind':'tfa','userId':_0x511550['id']});return{'mustProvideTFA':!![],'continuationToken':_0x3a46a1,'redirect':_0x36725d};}catch(_0x7f827d){WIKI[_0x213672(0x1c3)][_0x213672(0x129)](_0x7f827d);throw new WIKI[(_0x213672(0x1c0))][(_0x213672(0x225))]();}else{if(WIKI['config'][_0x213672(0x23a)]['enforce2FA']||_0x511550[_0x213672(0x235)]&&!_0x511550[_0x213672(0x22b)])try{const _0x140496=await _0x511550[_0x213672(0x1ef)](),_0x51d46e=await WIKI[_0x213672(0x24f)][_0x213672(0x121)]['generateToken']({'kind':'tfaSetup','userId':_0x511550['id']});return{'mustSetupTFA':!![],'continuationToken':_0x51d46e,'tfaQRImage':_0x140496,'redirect':_0x36725d};}catch(_0x3b2dcd){if(_0x213672(0x21f)===_0x213672(0x1ca))return _0x25c7b3[_0x213672(0x127)](_0x16a19a,_0x5d0660);else{WIKI[_0x213672(0x1c3)]['warn'](_0x3b2dcd);throw new WIKI[(_0x213672(0x1c0))][(_0x213672(0x225))]();}}}}if(!_0x2569b3&&_0x511550['mustChangePwd']){if(_0x25c7b3['ElCQM'](_0x213672(0x1f5),_0x25c7b3[_0x213672(0x141)]))return{'type':_0x25c7b3['gNLlu'],'required':[_0x213672(0x13e)],'properties':{'id':{'type':_0x213672(0x1a9)},'email':{'type':_0x213672(0x1f2),'format':_0x213672(0x13e)},'name':{'type':_0x25c7b3['fbDaw'],'minLength':0x1,'maxLength':0xff},'providerId':{'type':_0x25c7b3['fbDaw']},'password':{'type':_0x25c7b3[_0x213672(0x252)]},'tfaIsActive':{'type':_0x213672(0x172),'default':![]},'tfaSecret':{'type':['string',null]},'jobTitle':{'type':_0x25c7b3['fbDaw']},'location':{'type':_0x25c7b3[_0x213672(0x252)]},'pictureUrl':{'type':_0x213672(0x1f2)},'isSystem':{'type':_0x25c7b3['gfQGn']},'isActive':{'type':_0x213672(0x172)},'isVerified':{'type':_0x213672(0x172)},'createdAt':{'type':'string'},'updatedAt':{'type':_0x213672(0x1f2)}}};else try{if(_0x25c7b3[_0x213672(0x1f4)](_0x25c7b3[_0x213672(0x23b)],_0x25c7b3[_0x213672(0x13d)])){const _0x3943fd=await WIKI['models']['userKeys'][_0x213672(0x198)]({'kind':_0x25c7b3[_0x213672(0x1e6)],'userId':_0x511550['id']});return{'mustChangePwd':!![],'continuationToken':_0x3943fd,'redirect':_0x36725d};}else _0x50ec90=_0x1c90d0[_0x213672(0x18c)]('@')[0x0];}catch(_0x263f7b){WIKI[_0x213672(0x1c3)][_0x213672(0x129)](_0x263f7b);throw new WIKI['Error'][(_0x213672(0x225))]();}}return new Promise((_0x38cc5e,_0x11ab58)=>{const _0x34ccdb=_0x213672;_0x3c40d5[_0x34ccdb(0x207)][_0x34ccdb(0x255)](_0x511550,{'session':![]},async _0xc90fa5=>{const _0x56ab35=_0x34ccdb;if(_0xc90fa5)return _0x11ab58(_0xc90fa5);const _0x56ea5e=await WIKI['models'][_0x56ab35(0x241)][_0x56ab35(0x20c)](_0x511550);_0x38cc5e({'jwt':_0x56ea5e['token'],'redirect':_0x36725d});});});}static async[_0x83cb28(0x20c)](_0x299c0d){const _0x5928ae=_0x83cb28,_0x1ae773={'oWYTw':'permissions','QLeHk':_0x5928ae(0x140),'pTBJt':_0x5928ae(0x162)};if(_['isSafeInteger'](_0x299c0d)){_0x299c0d=await WIKI[_0x5928ae(0x24f)][_0x5928ae(0x241)][_0x5928ae(0x25c)]()[_0x5928ae(0x257)](_0x299c0d)[_0x5928ae(0x1c4)](_0x1ae773[_0x5928ae(0x22d)])[_0x5928ae(0x248)](_0x5928ae(0x140),_0x396b6f=>{const _0x491997=_0x5928ae;_0x396b6f['select']('groups.id',_0x1ae773[_0x491997(0x17a)]);});if(!_0x299c0d){WIKI[_0x5928ae(0x1c3)][_0x5928ae(0x129)](_0x5928ae(0x1b4)+_0x299c0d+_0x5928ae(0x14e));throw new WIKI[(_0x5928ae(0x1c0))][(_0x5928ae(0x225))]();}if(!_0x299c0d['isActive']){WIKI['logger'][_0x5928ae(0x129)](_0x5928ae(0x1b4)+_0x299c0d+_0x5928ae(0x1cb));throw new WIKI[(_0x5928ae(0x1c0))][(_0x5928ae(0x1a1))]();}}else _[_0x5928ae(0x1cd)](_0x299c0d['groups'])&&(_0x299c0d[_0x5928ae(0x140)]=await _0x299c0d[_0x5928ae(0x128)](_0x1ae773['QLeHk'])['select'](_0x5928ae(0x1d2),_0x5928ae(0x197)));return await WIKI[_0x5928ae(0x24f)][_0x5928ae(0x1ae)](_0x5928ae(0x241))[_0x5928ae(0x1d9)]('id',_0x299c0d['id'])['update']({'lastLoginAt':new Date()[_0x5928ae(0x1bf)]()}),{'token':jwt['sign']({'id':_0x299c0d['id'],'email':_0x299c0d['email'],'name':_0x299c0d[_0x5928ae(0x1fa)],'av':_0x299c0d['pictureUrl'],'tz':_0x299c0d[_0x5928ae(0x271)],'lc':_0x299c0d[_0x5928ae(0x227)],'df':_0x299c0d[_0x5928ae(0x1e9)],'ap':_0x299c0d[_0x5928ae(0x17f)],'permissions':_0x299c0d[_0x5928ae(0x25e)](),'groups':_0x299c0d['getGroups']()},{'key':WIKI[_0x5928ae(0x148)][_0x5928ae(0x1e3)]['private'],'passphrase':WIKI[_0x5928ae(0x148)][_0x5928ae(0x258)]},{'algorithm':_0x1ae773[_0x5928ae(0x138)],'expiresIn':WIKI[_0x5928ae(0x148)]['auth'][_0x5928ae(0x1f1)],'audience':WIKI[_0x5928ae(0x148)][_0x5928ae(0x23a)][_0x5928ae(0x1c6)],'issuer':_0x5928ae(0x1b0)}),'user':_0x299c0d};}static async[_0x83cb28(0x19e)]({securityCode:_0x41ee28,continuationToken:_0x190481,setup:_0x28ca9d},_0x170071){const _0x2948da=_0x83cb28,_0x3712d4={'UCEcU':function(_0x359e46,_0x3b2fde){return _0x359e46===_0x3b2fde;},'Rblls':function(_0x39daf8,_0x41f401){return _0x39daf8>_0x41f401;}};if(_0x3712d4[_0x2948da(0x1ed)](_0x41ee28['length'],0x6)&&_0x3712d4[_0x2948da(0x1a7)](_0x190481['length'],0x1)){const _0x56e54e=await WIKI['models'][_0x2948da(0x121)][_0x2948da(0x1f9)]({'kind':_0x28ca9d?_0x2948da(0x156):_0x2948da(0x145),'token':_0x190481,'skipDelete':_0x28ca9d});if(_0x56e54e){if(_0x56e54e[_0x2948da(0x22f)](_0x41ee28))return _0x28ca9d&&await _0x56e54e['enableTFA'](),WIKI[_0x2948da(0x24f)][_0x2948da(0x241)][_0x2948da(0x167)](_0x56e54e,_0x170071,{'skipTFA':!![]});else throw new WIKI[(_0x2948da(0x1c0))][(_0x2948da(0x229))]();}}throw new WIKI[(_0x2948da(0x1c0))]['AuthTFAInvalid']();}static async[_0x83cb28(0x179)]({continuationToken:_0x4dea21,newPassword:_0x4bfbf8},_0x3895cb){const _0x3f6161=_0x83cb28,_0x44f13={'YmwjI':function(_0x1d4cc6,_0x5b2ca8){return _0x1d4cc6!==_0x5b2ca8;},'DsFNP':function(_0x3cd4bc,_0x4b2783){return _0x3cd4bc(_0x4b2783);},'BuhRk':function(_0x39f36c,_0x7c8d4d){return _0x39f36c<_0x7c8d4d;},'wFvXn':'Password\x20must\x20be\x20at\x20least\x206\x20characters!'};if(!_0x4bfbf8||_0x44f13[_0x3f6161(0x237)](_0x4bfbf8[_0x3f6161(0x1a2)],0x6))throw new WIKI['Error'][(_0x3f6161(0x186))](_0x44f13['wFvXn']);const _0x156215=await WIKI[_0x3f6161(0x24f)][_0x3f6161(0x121)][_0x3f6161(0x1f9)]({'kind':_0x3f6161(0x21a),'token':_0x4dea21});if(_0x156215){if(!_0x156215[_0x3f6161(0x1f3)])throw new WIKI['Error'][(_0x3f6161(0x1a1))]();return await WIKI['models']['users']['query']()[_0x3f6161(0x224)]({'password':_0x4bfbf8,'mustChangePwd':![]})['findById'](_0x156215['id']),new Promise((_0x29ca39,_0x57ba2e)=>{const _0x30e742={'lVanN':function(_0x4459dc,_0x548e85){const _0x4eae8f=_0x3f75;return _0x44f13[_0x4eae8f(0x188)](_0x4459dc,_0x548e85);},'svbZg':function(_0x1edd5c,_0x2664d7){return _0x44f13['DsFNP'](_0x1edd5c,_0x2664d7);}};_0x3895cb['req']['logIn'](_0x156215,{'session':![]},async _0x384f20=>{const _0x9b3ec0=_0x3f75;if(_0x30e742[_0x9b3ec0(0x185)](_0x9b3ec0(0x181),_0x9b3ec0(0x193))){if(_0x384f20)return _0x30e742[_0x9b3ec0(0x1e8)](_0x57ba2e,_0x384f20);const _0x3eaf4c=await WIKI['models'][_0x9b3ec0(0x241)]['refreshToken'](_0x156215);_0x30e742['svbZg'](_0x29ca39,{'jwt':_0x3eaf4c[_0x9b3ec0(0x208)]});}else throw new _0x2e6992['Error']['AuthAccountAlreadyExists']();});});}else{if(_0x3f6161(0x21b)===_0x3f6161(0x1dc))_0x395481=_0x5658f7['user'][_0x3f6161(0x13e)];else throw new WIKI[(_0x3f6161(0x1c0))][(_0x3f6161(0x19f))]();}}static async[_0x83cb28(0x159)]({email:_0x5c9d7c},_0x1acf76){const _0x35f1ce=_0x83cb28,_0x2908b2={'jBeIO':function(_0x2d5634,_0x1c3ea9){return _0x2d5634(_0x1c3ea9);},'RPzmO':_0x35f1ce(0x18f),'iDAZJ':_0x35f1ce(0x23d),'OomTX':function(_0x270096,_0x4b2118){return _0x270096(_0x4b2118);},'CIVXl':_0x35f1ce(0x25b),'SuUdL':_0x35f1ce(0x192),'poUgF':function(_0x231efb,_0x4b9ed7){return _0x231efb(_0x4b9ed7);},'vqVsk':_0x35f1ce(0x1fd),'sADLO':_0x35f1ce(0x15a),'KwKwt':_0x35f1ce(0x11b),'uipVL':'local','yofhD':_0x35f1ce(0x19c),'irrRg':_0x35f1ce(0x143)},_0x2aa0f6=await WIKI[_0x35f1ce(0x24f)][_0x35f1ce(0x241)][_0x35f1ce(0x25c)]()['where']({'email':_0x5c9d7c,'providerKey':_0x2908b2[_0x35f1ce(0x1da)]})[_0x35f1ce(0x277)]();if(!_0x2aa0f6){if(_0x35f1ce(0x1a0)!=='RYVDl'){WIKI[_0x35f1ce(0x1c3)][_0x35f1ce(0x18b)](_0x35f1ce(0x24e)+_0x5c9d7c+_0x35f1ce(0x249));return;}else{_0x49b78c[_0x35f1ce(0x1c3)][_0x35f1ce(0x18b)](_0x35f1ce(0x170)+_0x321766+_0x35f1ce(0x249));return;}}else{if(!_0x2aa0f6['isActive']){if(_0x35f1ce(0x19c)!==_0x2908b2[_0x35f1ce(0x1db)])return{'groups':{'relation':_0x405722[_0x35f1ce(0x12a)],'modelClass':_0x2908b2[_0x35f1ce(0x19d)](_0x3bc319,_0x2908b2[_0x35f1ce(0x137)]),'join':{'from':_0x35f1ce(0x1b3),'through':{'from':_0x35f1ce(0x178),'to':_0x35f1ce(0x1fc)},'to':'groups.id'}},'provider':{'relation':_0x47d7a5[_0x35f1ce(0x246)],'modelClass':_0x14cc08(_0x2908b2['iDAZJ']),'join':{'from':_0x35f1ce(0x1b6),'to':_0x35f1ce(0x203)}},'defaultEditor':{'relation':_0x193838[_0x35f1ce(0x246)],'modelClass':_0x2908b2[_0x35f1ce(0x158)](_0x445f72,_0x2908b2[_0x35f1ce(0x16b)]),'join':{'from':_0x2908b2[_0x35f1ce(0x1dd)],'to':_0x35f1ce(0x247)}},'locale':{'relation':_0x22f89d[_0x35f1ce(0x246)],'modelClass':_0x2908b2[_0x35f1ce(0x184)](_0x1db5f9,_0x2908b2[_0x35f1ce(0x12e)]),'join':{'from':_0x2908b2[_0x35f1ce(0x251)],'to':_0x2908b2['KwKwt']}}};else{WIKI[_0x35f1ce(0x1c3)]['debug'](_0x35f1ce(0x170)+_0x5c9d7c+_0x35f1ce(0x249));return;}}}const _0x2ce7c4=await WIKI[_0x35f1ce(0x24f)][_0x35f1ce(0x121)][_0x35f1ce(0x198)]({'userId':_0x2aa0f6['id'],'kind':_0x35f1ce(0x1c2)});await WIKI['mail'][_0x35f1ce(0x274)]({'template':_0x35f1ce(0x245),'to':_0x5c9d7c,'subject':_0x35f1ce(0x1f6),'data':{'preheadertext':'A\x20password\x20reset\x20was\x20requested\x20for\x20'+WIKI[_0x35f1ce(0x148)]['title'],'title':_0x35f1ce(0x180)+WIKI['config'][_0x35f1ce(0x136)],'content':_0x35f1ce(0x190),'buttonLink':WIKI['config'][_0x35f1ce(0x153)]+_0x35f1ce(0x14d)+_0x2ce7c4,'buttonText':_0x2908b2[_0x35f1ce(0x23f)]},'text':_0x35f1ce(0x232)+WIKI[_0x35f1ce(0x148)][_0x35f1ce(0x136)]+'.\x20Open\x20the\x20following\x20link\x20to\x20proceed:\x20'+WIKI[_0x35f1ce(0x148)][_0x35f1ce(0x153)]+_0x35f1ce(0x14d)+_0x2ce7c4});}static async[_0x83cb28(0x254)]({providerKey:_0x3a5ac8,email:_0x2d170e,passwordRaw:_0x8c2ca5,name:_0x5650ea,groups:_0xd7c8be,mustChangePassword:_0x459fb,sendWelcomeEmail:_0x42230a}){const _0x3fc0e6=_0x83cb28,_0x62209={'dTMED':function(_0x1fcb18,_0x5f214f){return _0x1fcb18===_0x5f214f;},'XsmFi':_0x3fc0e6(0x243),'LKuTB':_0x3fc0e6(0x20e),'zAJCz':function(_0x344132,_0x4d1209){return _0x344132===_0x4d1209;},'TKZFl':function(_0x330385,_0x4c6021){return _0x330385>_0x4c6021;},'PtzCQ':function(_0x16486a,_0xfd050d){return _0x16486a!==_0xfd050d;},'PekWi':_0x3fc0e6(0x21d),'YiUjJ':_0x3fc0e6(0x1d8)};_0x2d170e=_[_0x3fc0e6(0x1c7)](_0x2d170e);let _0x52c578=null;_0x62209[_0x3fc0e6(0x134)](_0x3a5ac8,_0x3fc0e6(0x12f))?_0x52c578=validate({'email':_0x2d170e,'passwordRaw':_0x8c2ca5,'name':_0x5650ea},{'email':{'email':!![],'length':{'maximum':0xff}},'passwordRaw':{'presence':{'allowEmpty':![]},'length':{'minimum':0x6}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':_0x62209[_0x3fc0e6(0x150)]}):_0x52c578=validate({'email':_0x2d170e,'name':_0x5650ea},{'email':{'email':!![],'length':{'maximum':0xff}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':_0x62209[_0x3fc0e6(0x150)]});if(_0x52c578&&_0x52c578['length']>0x0)throw new WIKI[(_0x3fc0e6(0x1c0))][(_0x3fc0e6(0x186))](_0x52c578[0x0]);const _0x20a5ff=await WIKI[_0x3fc0e6(0x24f)][_0x3fc0e6(0x241)]['query']()['findOne']({'email':_0x2d170e,'providerKey':_0x3a5ac8});if(!_0x20a5ff){let _0x34cd71={'providerKey':_0x3a5ac8,'email':_0x2d170e,'name':_0x5650ea,'locale':'en','defaultEditor':_0x62209[_0x3fc0e6(0x262)],'tfaIsActive':![],'isSystem':![],'isActive':!![],'isVerified':!![],'mustChangePwd':![]};_0x3a5ac8===_0x3fc0e6(0x12f)&&(_0x34cd71[_0x3fc0e6(0x1a6)]=_0x8c2ca5,_0x34cd71[_0x3fc0e6(0x18d)]=_0x62209[_0x3fc0e6(0x1bc)](_0x459fb,!![]));const _0x2d4ca5=await WIKI['models'][_0x3fc0e6(0x241)]['query']()['insert'](_0x34cd71);_0x62209['TKZFl'](_0xd7c8be[_0x3fc0e6(0x1a2)],0x0)&&await _0x2d4ca5[_0x3fc0e6(0x128)](_0x3fc0e6(0x140))[_0x3fc0e6(0x152)](_0xd7c8be);if(_0x42230a){if(_0x62209[_0x3fc0e6(0x200)](_0x3fc0e6(0x259),_0x62209['PekWi']))await WIKI[_0x3fc0e6(0x1a8)][_0x3fc0e6(0x274)]({'template':_0x62209['YiUjJ'],'to':_0x2d170e,'subject':_0x3fc0e6(0x25f)+WIKI[_0x3fc0e6(0x148)][_0x3fc0e6(0x136)],'data':{'preheadertext':_0x3fc0e6(0x27a)+WIKI[_0x3fc0e6(0x148)][_0x3fc0e6(0x136)],'title':'You\x27ve\x20been\x20invited\x20to\x20the\x20wiki\x20'+WIKI['config'][_0x3fc0e6(0x136)],'content':_0x3fc0e6(0x231),'buttonLink':WIKI[_0x3fc0e6(0x148)][_0x3fc0e6(0x153)]+_0x3fc0e6(0x268),'buttonText':'Login'},'text':_0x3fc0e6(0x27a)+WIKI[_0x3fc0e6(0x148)][_0x3fc0e6(0x136)]+':\x20'+WIKI[_0x3fc0e6(0x148)]['host']+'/login'});else throw new _0x582151[(_0x3fc0e6(0x1c0))][(_0x3fc0e6(0x186))](_0x3fc0e6(0x17d));}}else throw new WIKI[(_0x3fc0e6(0x1c0))]['AuthAccountAlreadyExists']();}static async['updateUser']({id:_0x58db43,email:_0x13e576,name:_0x207ec7,newPassword:_0x397a6f,groups:_0x2557c3,location:_0x1d8a23,jobTitle:_0x528fac,timezone:_0x415a43,dateFormat:_0x458229,appearance:_0x1b8969}){const _0x58fb22=_0x83cb28,_0x509dfe={'QmZEK':function(_0x2df909,_0x23f40b){return _0x2df909<_0x23f40b;},'llmZF':'Password\x20must\x20be\x20at\x20least\x206\x20characters!','GselF':_0x58fb22(0x1bb),'djkuI':_0x58fb22(0x25d),'afZAo':function(_0x10e57c,_0x71f69){return _0x10e57c!==_0x71f69;},'uyuRN':_0x58fb22(0x24a),'AdYkT':function(_0x1d671c,_0x1a6a92){return _0x1d671c!==_0x1a6a92;}},_0x5afb56=await WIKI[_0x58fb22(0x24f)][_0x58fb22(0x241)][_0x58fb22(0x25c)]()[_0x58fb22(0x257)](_0x58db43);if(_0x5afb56){let _0x59871e={};if(!_[_0x58fb22(0x120)](_0x13e576)&&_0x13e576!==_0x5afb56['email']){const _0x5299ae=await WIKI['models'][_0x58fb22(0x241)][_0x58fb22(0x25c)]()['select']('id')[_0x58fb22(0x1d9)]({'email':_0x13e576,'providerKey':_0x5afb56['providerKey']})[_0x58fb22(0x277)]();if(_0x5299ae)throw new WIKI[(_0x58fb22(0x1c0))][(_0x58fb22(0x201))]();_0x59871e['email']=_[_0x58fb22(0x1c7)](_0x13e576);}!_[_0x58fb22(0x120)](_0x207ec7)&&_0x207ec7!==_0x5afb56[_0x58fb22(0x1fa)]&&(_0x59871e[_0x58fb22(0x1fa)]=_[_0x58fb22(0x215)](_0x207ec7));if(!_[_0x58fb22(0x120)](_0x397a6f)){if(_0x509dfe[_0x58fb22(0x13c)](_0x397a6f[_0x58fb22(0x1a2)],0x6))throw new WIKI[(_0x58fb22(0x1c0))][(_0x58fb22(0x186))](_0x509dfe['llmZF']);_0x59871e['password']=_0x397a6f;}if(_[_0x58fb22(0x239)](_0x2557c3)){const _0x195b38=await _0x5afb56[_0x58fb22(0x128)](_0x58fb22(0x140)),_0x2a0d3a=_['map'](_0x195b38,'id'),_0x4fead4=_[_0x58fb22(0x26d)](_0x2557c3,_0x2a0d3a);for(const _0x24cee2 of _0x4fead4){_0x58fb22(0x1d5)!==_0x509dfe[_0x58fb22(0x1f7)]?await _0x5afb56[_0x58fb22(0x128)](_0x58fb22(0x140))[_0x58fb22(0x152)](_0x24cee2):_0x5b034a[_0x58fb22(0x1c3)][_0x58fb22(0x129)](_0x58fb22(0x244)+_0x17f9f5+':\x20'+_0x1efc8e[_0x58fb22(0x1aa)]);}const _0x291db0=_[_0x58fb22(0x26d)](_0x2a0d3a,_0x2557c3);for(const _0x5aa906 of _0x291db0){if(_0x58fb22(0x25d)===_0x509dfe[_0x58fb22(0x264)])await _0x5afb56[_0x58fb22(0x128)](_0x58fb22(0x140))['unrelate']()[_0x58fb22(0x1d9)]('groupId',_0x5aa906);else{_0x358277[_0x58fb22(0x1c3)]['warn'](_0x58fb22(0x1b4)+_0x2b1f7a+_0x58fb22(0x14e));throw new _0x1874ce[(_0x58fb22(0x1c0))][(_0x58fb22(0x225))]();}}}!_[_0x58fb22(0x120)](_0x1d8a23)&&_0x1d8a23!==_0x5afb56['location']&&(_0x59871e[_0x58fb22(0x24d)]=_['trim'](_0x1d8a23));if(!_[_0x58fb22(0x120)](_0x528fac)&&_0x509dfe[_0x58fb22(0x221)](_0x528fac,_0x5afb56[_0x58fb22(0x15f)])){if(_0x509dfe['uyuRN']!==_0x509dfe['uyuRN'])throw new _0x44ede6['Error'][(_0x58fb22(0x267))]();else _0x59871e[_0x58fb22(0x15f)]=_[_0x58fb22(0x215)](_0x528fac);}!_[_0x58fb22(0x120)](_0x415a43)&&_0x509dfe['AdYkT'](_0x415a43,_0x5afb56[_0x58fb22(0x271)])&&(_0x59871e['timezone']=_0x415a43),!_[_0x58fb22(0x1cd)](_0x458229)&&_0x509dfe[_0x58fb22(0x221)](_0x458229,_0x5afb56[_0x58fb22(0x1e9)])&&(_0x59871e['dateFormat']=_0x458229),!_['isNil'](_0x1b8969)&&_0x1b8969!==_0x5afb56[_0x58fb22(0x17f)]&&(_0x59871e[_0x58fb22(0x17f)]=_0x1b8969),await WIKI[_0x58fb22(0x24f)][_0x58fb22(0x241)][_0x58fb22(0x25c)]()['patch'](_0x59871e)[_0x58fb22(0x257)](_0x58db43);}else throw new WIKI[(_0x58fb22(0x1c0))][(_0x58fb22(0x19f))]();}static async[_0x83cb28(0x279)](_0x185b4e,_0x4d1abe){const _0x23d96f=_0x83cb28,_0x934b67={'hEivV':_0x23d96f(0x1be)},_0x908786=await WIKI[_0x23d96f(0x24f)]['users'][_0x23d96f(0x25c)]()[_0x23d96f(0x257)](_0x185b4e);if(_0x908786)await WIKI[_0x23d96f(0x24f)][_0x23d96f(0x211)][_0x23d96f(0x25c)]()[_0x23d96f(0x224)]({'authorId':_0x4d1abe})[_0x23d96f(0x1d9)](_0x23d96f(0x1be),_0x185b4e),await WIKI[_0x23d96f(0x24f)][_0x23d96f(0x214)][_0x23d96f(0x25c)]()[_0x23d96f(0x224)]({'authorId':_0x4d1abe})[_0x23d96f(0x1d9)]('authorId',_0x185b4e),await WIKI[_0x23d96f(0x24f)][_0x23d96f(0x250)]['query']()[_0x23d96f(0x224)]({'authorId':_0x4d1abe})['where'](_0x23d96f(0x1be),_0x185b4e),await WIKI[_0x23d96f(0x24f)][_0x23d96f(0x1d4)]['query']()[_0x23d96f(0x224)]({'authorId':_0x4d1abe})[_0x23d96f(0x1d9)](_0x934b67[_0x23d96f(0x20b)],_0x185b4e),await WIKI[_0x23d96f(0x24f)][_0x23d96f(0x1d4)][_0x23d96f(0x25c)]()[_0x23d96f(0x224)]({'creatorId':_0x4d1abe})['where'](_0x23d96f(0x1e4),_0x185b4e),await WIKI['models'][_0x23d96f(0x121)][_0x23d96f(0x25c)]()['delete']()[_0x23d96f(0x1d9)]('userId',_0x185b4e),await WIKI[_0x23d96f(0x24f)][_0x23d96f(0x241)][_0x23d96f(0x25c)]()[_0x23d96f(0x125)](_0x185b4e);else throw new WIKI['Error'][(_0x23d96f(0x19f))]();}static async['register']({email:_0x3f8839,password:_0x465621,name:_0x2f2ad3,verify:verify=![],bypassChecks:bypassChecks=![]},_0x48a6db){const _0x22aa1a=_0x83cb28,_0x42d828={'Kadlf':_0x22aa1a(0x12f),'kemZk':'flat','akBlN':function(_0x541192,_0x34101b){return _0x541192>_0x34101b;},'zwRUV':_0x22aa1a(0x183),'OFTSI':_0x22aa1a(0x1eb),'bnftT':_0x22aa1a(0x160),'egyBs':_0x22aa1a(0x151),'CZdCG':_0x22aa1a(0x222)},_0x222890=await WIKI[_0x22aa1a(0x24f)]['authentication'][_0x22aa1a(0x17c)](_0x42d828[_0x22aa1a(0x240)]);if(_0x222890['selfRegistration']||bypassChecks){_0x3f8839=_[_0x22aa1a(0x1c7)](_0x3f8839);const _0x4211ab=validate({'email':_0x3f8839,'password':_0x465621,'name':_0x2f2ad3},{'email':{'email':!![],'length':{'maximum':0xff}},'password':{'presence':{'allowEmpty':![]},'length':{'minimum':0x6}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':_0x42d828[_0x22aa1a(0x276)]});if(_0x4211ab&&_0x42d828[_0x22aa1a(0x263)](_0x4211ab[_0x22aa1a(0x1a2)],0x0))throw new WIKI[(_0x22aa1a(0x1c0))][(_0x22aa1a(0x186))](_0x4211ab[0x0]);if(_[_0x22aa1a(0x122)](_0x222890,_0x22aa1a(0x17b),[])['length']>0x0&&!bypassChecks){const _0x206868=_[_0x22aa1a(0x161)](_0x3f8839[_0x22aa1a(0x18c)]('@'));if(!_['includes'](_0x222890['domainWhitelist']['v'],_0x206868))throw new WIKI[(_0x22aa1a(0x1c0))][(_0x22aa1a(0x1d7))]();}const _0x5d1097=await WIKI['models'][_0x22aa1a(0x241)][_0x22aa1a(0x25c)]()[_0x22aa1a(0x168)]({'email':_0x3f8839,'providerKey':_0x42d828[_0x22aa1a(0x240)]});if(!_0x5d1097){const _0x399ab6=await WIKI['models'][_0x22aa1a(0x241)][_0x22aa1a(0x25c)]()[_0x22aa1a(0x212)]({'provider':_0x42d828[_0x22aa1a(0x240)],'email':_0x3f8839,'name':_0x2f2ad3,'password':_0x465621,'locale':'en','defaultEditor':_0x22aa1a(0x20e),'tfaIsActive':![],'isSystem':![],'isActive':!![],'isVerified':![]});_0x42d828[_0x22aa1a(0x263)](_['get'](_0x222890,_0x22aa1a(0x1ba),[])[_0x22aa1a(0x1a2)],0x0)&&await _0x399ab6['$relatedQuery'](_0x22aa1a(0x140))[_0x22aa1a(0x152)](_0x222890[_0x22aa1a(0x12b)]['v']);if(verify){const _0x571d15=await WIKI[_0x22aa1a(0x24f)][_0x22aa1a(0x121)][_0x22aa1a(0x198)]({'kind':_0x22aa1a(0x236),'userId':_0x399ab6['id']});await WIKI[_0x22aa1a(0x1a8)][_0x22aa1a(0x274)]({'template':_0x42d828[_0x22aa1a(0x149)],'to':_0x3f8839,'subject':_0x42d828[_0x22aa1a(0x1c8)],'data':{'preheadertext':_0x42d828[_0x22aa1a(0x205)],'title':_0x22aa1a(0x1eb),'content':_0x42d828[_0x22aa1a(0x189)],'buttonLink':WIKI[_0x22aa1a(0x148)]['host']+_0x22aa1a(0x175)+_0x571d15,'buttonText':_0x42d828[_0x22aa1a(0x1a3)]},'text':_0x22aa1a(0x24c)+WIKI[_0x22aa1a(0x148)][_0x22aa1a(0x153)]+_0x22aa1a(0x175)+_0x571d15});}return!![];}else throw new WIKI['Error']['AuthAccountAlreadyExists']();}else throw new WIKI[(_0x22aa1a(0x1c0))][(_0x22aa1a(0x273))]();}static async['logout'](_0x47cf5b){const _0x528abf=_0x83cb28,_0x3236d5={'JJpwg':function(_0x385f01,_0x2ed81e){return _0x385f01===_0x2ed81e;},'HOeIv':_0x528abf(0x220),'BUNGG':'key'};if(!_0x47cf5b[_0x528abf(0x207)]['user']||_0x3236d5['JJpwg'](_0x47cf5b[_0x528abf(0x207)][_0x528abf(0x130)]['id'],0x2))return'/';const _0x56dfe0=await WIKI[_0x528abf(0x24f)]['users'][_0x528abf(0x25c)]()[_0x528abf(0x257)](_0x47cf5b[_0x528abf(0x207)]['user']['id'])[_0x528abf(0x131)](_0x3236d5[_0x528abf(0x11d)]),_0x5cc373=_[_0x528abf(0x157)](WIKI[_0x528abf(0x23a)]['strategies'],[_0x3236d5['BUNGG'],_0x56dfe0[_0x528abf(0x220)]]);return _0x5cc373['logout']?_0x5cc373[_0x528abf(0x1b2)](_0x5cc373[_0x528abf(0x148)],_0x47cf5b):'/';}static async[_0x83cb28(0x187)](){const _0x48abdf=_0x83cb28,_0x22fe3d={'hePVU':'permissions','OfGZn':_0x48abdf(0x140),'FSXzJ':'CRITICAL\x20ERROR:\x20Guest\x20user\x20is\x20missing!'},_0x331104=await WIKI[_0x48abdf(0x24f)]['users'][_0x48abdf(0x25c)]()[_0x48abdf(0x257)](0x2)[_0x48abdf(0x213)](_0x48abdf(0x140))[_0x48abdf(0x248)](_0x22fe3d['OfGZn'],_0x1c885a=>{const _0x263472=_0x48abdf;_0x1c885a['select']('groups.id',_0x22fe3d[_0x263472(0x27b)]);});return!_0x331104&&(WIKI['logger'][_0x48abdf(0x13f)](_0x22fe3d[_0x48abdf(0x269)]),process[_0x48abdf(0x1c5)](0x1)),_0x331104[_0x48abdf(0x197)]=_0x331104['getGlobalPermissions'](),_0x331104;}static async[_0x83cb28(0x1d3)](){const _0x4006da=_0x83cb28,_0x284d45={'kUkjZ':_0x4006da(0x219)};let _0x2d8bad=await WIKI[_0x4006da(0x24f)]['users']['query']()['findById'](0x1);return!_0x2d8bad&&(WIKI[_0x4006da(0x1c3)]['error'](_0x284d45[_0x4006da(0x1e0)]),process['exit'](0x1)),_0x2d8bad[_0x4006da(0x197)]=[_0x4006da(0x14c)],_0x2d8bad;}static async[_0x83cb28(0x1b9)](_0xdb3705,_0x45b9d3){const _0x191046=_0x83cb28,_0x4e7a2f={'idOMs':function(_0x5c2574,_0x32e98b){return _0x5c2574>_0x32e98b;},'yXtoJ':_0x191046(0x176)};try{WIKI[_0x191046(0x1c3)][_0x191046(0x18b)](_0x191046(0x124)+_0xdb3705+_0x191046(0x1cc));if(_0x4e7a2f[_0x191046(0x139)](_0x45b9d3[_0x191046(0x1a2)],0x400*0x400))throw new Error(_0x191046(0x133));const _0x2cd6d6=await WIKI[_0x191046(0x24f)][_0x191046(0x1ae)](_0x4e7a2f['yXtoJ'])[_0x191046(0x131)]('id')[_0x191046(0x1d9)]('id',_0xdb3705)[_0x191046(0x277)]();_0x2cd6d6?await WIKI[_0x191046(0x24f)][_0x191046(0x1ae)](_0x4e7a2f[_0x191046(0x21c)])[_0x191046(0x1d9)]({'id':_0xdb3705})[_0x191046(0x1e5)]({'data':_0x45b9d3}):await WIKI[_0x191046(0x24f)][_0x191046(0x1ae)](_0x4e7a2f[_0x191046(0x21c)])['insert']({'id':_0xdb3705,'data':_0x45b9d3});}catch(_0x19f1ea){WIKI['logger'][_0x191046(0x129)](_0x191046(0x244)+_0xdb3705+':\x20'+_0x19f1ea[_0x191046(0x1aa)]);}}static async[_0x83cb28(0x19a)](_0x1453b9){const _0x482c97=_0x83cb28,_0x47971c={'IPEJg':_0x482c97(0x23e),'nSmCQ':_0x482c97(0x176)};try{if('UMMRz'===_0x482c97(0x27c)){const _0x1b7ac8=await WIKI[_0x482c97(0x24f)][_0x482c97(0x1ae)](_0x47971c['nSmCQ'])[_0x482c97(0x1d9)]('id',_0x1453b9)[_0x482c97(0x277)]();return _0x1b7ac8?_0x1b7ac8[_0x482c97(0x20a)]:null;}else _0x5c4fc8[_0x482c97(0x15e)](_0x423267[_0x482c97(0x207)],_0x47971c['IPEJg'],_0x3f4062['username']),_0x20d414[_0x482c97(0x15e)](_0x589abf['req'],'body.password',_0x2400dc[_0x482c97(0x1a6)]),_0xf84d26[_0x482c97(0x15e)](_0x208c50[_0x482c97(0x207)][_0x482c97(0x22e)],_0x482c97(0x1a5),_0x55d50e[_0x482c97(0x1a5)]);}catch(_0x376dbf){WIKI[_0x482c97(0x1c3)][_0x482c97(0x129)](_0x482c97(0x244)+_0x1453b9);}}};