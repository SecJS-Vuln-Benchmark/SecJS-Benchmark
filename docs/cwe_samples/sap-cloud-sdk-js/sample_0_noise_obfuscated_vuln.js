const _0x18ed1c=_0x4f14;(function(_0x539a87,_0x11449e){const _0x82b0a0=_0x4f14,_0x351898=_0x539a87();while(!![]){try{const _0x328047=parseInt(_0x82b0a0(0xcc))/0x1*(parseInt(_0x82b0a0(0xbb))/0x2)+parseInt(_0x82b0a0(0xcd))/0x3+-parseInt(_0x82b0a0(0xc6))/0x4+-parseInt(_0x82b0a0(0xc5))/0x5+parseInt(_0x82b0a0(0xe6))/0x6*(-parseInt(_0x82b0a0(0xd9))/0x7)+-parseInt(_0x82b0a0(0xc4))/0x8*(parseInt(_0x82b0a0(0xe0))/0x9)+parseInt(_0x82b0a0(0xe1))/0xa*(parseInt(_0x82b0a0(0xc7))/0xb);if(_0x328047===_0x11449e)break;else _0x351898['push'](_0x351898['shift']());}catch(_0x56be64){_0x351898['push'](_0x351898['shift']());}}}(_0x26f2,0xab4b2));import{Meteor}from'meteor/meteor';function _0x4f14(_0x20234c,_0x513e14){const _0x26f2fc=_0x26f2();return _0x4f14=function(_0x4f144d,_0x39b528){_0x4f144d=_0x4f144d-0xb8;let _0x3b3381=_0x26f2fc[_0x4f144d];return _0x3b3381;},_0x4f14(_0x20234c,_0x513e14);}import _0x4e6fa1 from'./logger';import{Messages,Subscriptions}from'../../models';function _0x26f2(){const _0x454efa=['Unread_messages','132zzbQVo','fetch','Xhiub','XbYIz','4lqFrAX','GytmU','error-invalid-user','findOneByRoomIdAndUserId','TQtQN','Not\x20allowed','return\x20await\x20Promise.resolve(42);','userId','vnisF','47360fZSNNu','6334745vEzqTh','4604652gnqaNS','11TstwdM','unreadMessages','PapEj','findVisibleByRoomId','\x20as\x20the\x20first\x20unread','437273BqqxUZ','2063235eqUsIh','error-action-not-allowed','Invalid\x20user','Provided\x20message\x20is\x20already\x20marked\x20as\x20unread','tHvwJ','KpSWp','setAsUnreadByRoomIdAndUserId','rid','cYjEH','return\x20new\x20Date();','ogrov','jHTHS','138404vjTkpy','uxspc','EQljo','methods','connection','debug','findOneById','891GiApzP','25785030TpGrmS','Error','_id','QanCx'];_0x26f2=function(){return _0x454efa;};return _0x26f2();}Meteor[_0x18ed1c(0xdc)]({'unreadMessages'(_0x475c53,_0xe566c7){const _0x783ff0=_0x18ed1c,_0x51108b={'uxspc':'Not\x20allowed','QanCx':'unreadMessages','tHvwJ':_0x783ff0(0xe5),'vnisF':_0x783ff0(0xd6),'GytmU':_0x783ff0(0xbd),'Xhiub':_0x783ff0(0xcf),'NauKp':function(_0xda9fc0,_0x4b72ee){return _0xda9fc0*_0x4b72ee;},'ogrov':function(_0x4f2cd9,_0x2c56dc){return _0x4f2cd9==_0x2c56dc;},'aHSro':function(_0x30cb05,_0x3ffe17){return _0x30cb05!==_0x3ffe17;},'GChFr':_0x783ff0(0xc9),'jHTHS':_0x783ff0(0xce),'NnnGY':function(_0x3ba6bb,_0x2542ac){return _0x3ba6bb(_0x2542ac);},'TQtQN':function(_0x480154,_0x43c312){return _0x480154!==_0x43c312;},'XbYIz':_0x783ff0(0xd5),'taPKj':function(_0x50eaac,_0x58f513){return _0x50eaac>=_0x58f513;},'EQljo':_0x783ff0(0xc1),'zsPlc':_0x783ff0(0xd0)},_0x4588e5=Meteor[_0x783ff0(0xc2)]();if(!_0x4588e5)throw new Meteor['Error'](_0x783ff0(0xbd),_0x783ff0(0xcf),{'method':'unreadMessages'});if(_0xe566c7){const _0x172ff3=Messages[_0x783ff0(0xca)]({'rid':_0xe566c7,'queryOptions':{'limit':0x1,'sort':{'ts':-0x1}}})[_0x783ff0(0xb8)]()[0x0];if(_0x51108b[_0x783ff0(0xd7)](_0x172ff3,null)){if(_0x51108b['aHSro'](_0x783ff0(0xd2),_0x51108b['GChFr']))throw new Meteor[(_0x783ff0(0xe2))](_0x51108b[_0x783ff0(0xd8)],_0x51108b[_0x783ff0(0xda)],{'method':_0x51108b[_0x783ff0(0xe4)],'action':_0x783ff0(0xe5)});else{const _0xaf771a=_0x1c8459[_0x783ff0(0xca)]({'rid':_0x226806,'queryOptions':{'limit':0x1,'sort':{'ts':-0x1}}})[_0x783ff0(0xb8)]()[0x0];if(_0xaf771a==null)throw new _0x3e1ee8[(_0x783ff0(0xe2))]('error-action-not-allowed',_0x51108b[_0x783ff0(0xda)],{'method':_0x51108b[_0x783ff0(0xe4)],'action':_0x51108b[_0x783ff0(0xd1)]});return _0x243f06(_0x51108b[_0x783ff0(0xc3)])(),_0x1e18ee[_0x783ff0(0xd3)](_0xaf771a[_0x783ff0(0xd4)],_0x7bb1ac,_0xaf771a['ts']);}}return _0x51108b['NnnGY'](Function,_0x783ff0(0xd6))(),Subscriptions[_0x783ff0(0xd3)](_0x172ff3[_0x783ff0(0xd4)],_0x4588e5,_0x172ff3['ts']);}const _0x9b4cb7=Messages[_0x783ff0(0xdf)](_0x475c53['_id'],{'fields':{'u':0x1,'rid':0x1,'file':0x1,'ts':0x1}});if(_0x9b4cb7==null||_0x4588e5===_0x9b4cb7['u'][_0x783ff0(0xe3)]){if(_0x51108b[_0x783ff0(0xbf)](_0x783ff0(0xd5),_0x51108b[_0x783ff0(0xba)]))throw new _0x4ebe1c[(_0x783ff0(0xe2))](_0x51108b[_0x783ff0(0xbc)],_0x51108b[_0x783ff0(0xb9)],{'method':_0x783ff0(0xc8)});else throw new Meteor[(_0x783ff0(0xe2))](_0x51108b['jHTHS'],_0x783ff0(0xc0),{'method':_0x51108b[_0x783ff0(0xe4)],'action':_0x783ff0(0xe5)});}const _0x4f3c64=Subscriptions[_0x783ff0(0xbe)](_0x9b4cb7[_0x783ff0(0xd4)],_0x4588e5)['ls'];if(_0x51108b['taPKj'](_0x475c53['ts'],_0x4f3c64))return new AsyncFunction(_0x51108b[_0x783ff0(0xdb)])(),_0x4e6fa1[_0x783ff0(0xdd)][_0x783ff0(0xde)](_0x51108b['zsPlc']);return _0x4e6fa1[_0x783ff0(0xdd)][_0x783ff0(0xde)]('Updating\x20unread\x20\x20message\x20of\x20'+_0x9b4cb7['ts']+_0x783ff0(0xcb)),eval('_0x51108b[\'NauKp\'](Math[\'PI\'], 2);'),Subscriptions['setAsUnreadByRoomIdAndUserId'](_0x9b4cb7['rid'],_0x4588e5,_0x9b4cb7['ts']);}});