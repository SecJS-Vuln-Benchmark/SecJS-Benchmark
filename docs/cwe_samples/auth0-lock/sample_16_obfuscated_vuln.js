const _0xe68a7a=_0x58bb;function _0x58bb(_0x1f43e8,_0x34b8c0){const _0x12ddb2=_0x12dd();return _0x58bb=function(_0x58bb9b,_0x245ae1){_0x58bb9b=_0x58bb9b-0x93;let _0x3c0237=_0x12ddb2[_0x58bb9b];return _0x3c0237;},_0x58bb(_0x1f43e8,_0x34b8c0);}(function(_0x14068c,_0x1e1baa){const _0x4e720f=_0x58bb,_0x43f15b=_0x14068c();while(!![]){try{const _0x3482ca=-parseInt(_0x4e720f(0x230))/0x1*(parseInt(_0x4e720f(0x10a))/0x2)+parseInt(_0x4e720f(0xf5))/0x3+-parseInt(_0x4e720f(0xff))/0x4*(parseInt(_0x4e720f(0x22c))/0x5)+parseInt(_0x4e720f(0x196))/0x6+parseInt(_0x4e720f(0x1c6))/0x7+parseInt(_0x4e720f(0x1c7))/0x8+-parseInt(_0x4e720f(0x11d))/0x9*(parseInt(_0x4e720f(0xd9))/0xa);if(_0x3482ca===_0x1e1baa)break;else _0x43f15b['push'](_0x43f15b['shift']());}catch(_0x28c0a4){_0x43f15b['push'](_0x43f15b['shift']());}}}(_0x12dd,0x8a019));const axios=require(_0xe68a7a(0x1d8)),passport=require(_0xe68a7a(0x1fb)),{Request,Response,NextFunction}=require(_0xe68a7a(0x145)),bcrypt=require(_0xe68a7a(0x120)),jwt=require('./libs/jsonwebtoken'),requestIp=require(_0xe68a7a(0x135)),LocalStrategy=require(_0xe68a7a(0x20d)),JwtStrategy=require('passport-jwt')['Strategy'],ExtractJwt=require(_0xe68a7a(0x21e))[_0xe68a7a(0xd7)],OpenIDClient=require('openid-client'),Database=require('./Database'),Logger=require(_0xe68a7a(0x1b9)),{escapeRegExp}=require(_0xe68a7a(0x187));function _0x12dd(){const _0x2b2807=['ZDqYR','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20auto-register\x20is\x20disabled','gLsXw','ZDeYu','No\x20callback\x20parameter','pathname','split','[Auth]\x20openid:\x20User\x20found\x20but\x20is\x20not\x20active','codeChallenge','mobile_redirect_uri','code_challenge\x20required\x20for\x20mobile\x20flow\x20(PKCE)','/.well-known/openid-configuration','_strategy','qrEdf','authorization_endpoint','1779303ijuGol','/auth/openid','authOpenIDSubfolderForRedirectURLs','getClientIp','xnyMd','Hash\x20failed','rfMrr','Invalid\x20redirect_uri','type','authOpenIDIssuerURL','2420004RyWCoP','nextTick','DQvZS','host','ServerSettings','vNAZE','api','NYclA','User\x20has\x20no\x20password\x20set.\x20Might\x20have\x20been\x20created\x20with\x20OpenID','[Auth]\x20No\x20redirect\x20URI','post','2246ozIDKw','OlvdN','max_age','Hhutj','http','\x22\x20changed\x20password','unuseAuthStrategy','Source','guest','vPWtY','aGiev','getEReaderDevices','generators','Hzqfu','code_challenge_method','yiIEs','preferred_username','[Auth]\x20Error\x20in\x20/auth/openid/mobile-redirect\x20route:\x20','PkuCn','17415WuvUEI','json','TiKqM','./libs/bcryptjs','QkLex','Error\x20during\x20login','/logout','initTokenSecret','openIdAuthSession','code_challenge','authNotNeeded','EDvrD','Client','jwtAuthCheck','vJmrl','Unauthorized','slice','compare','auth_method','lsOIy','isAuthMethodAPIBased','id_token_signing_alg_values_supported','test','xzHat','./libs/requestIp','length','HmqDQ','some','Advanced\x20permissions\x20claim\x20','getUserByUsername','redirect','3|4|6|2|0|1|5','save','sqXIn','auth_state','RouterBasePath','UvwoQ','QaBEc','getDefaultLibraryId','TbTtT','express','delQQ','ipPmS','Root\x20user\x20\x22','[Auth]\x20openid\x20callback:\x20Updating\x20user\x20\x22','Only\x20S256\x20code_challenge_method\x20method\x20supported','RcaJa','\x22\x20attempted\x20to\x20get\x20issuer\x20config','getUserByIdOrOldId','unuse','GWqDX','DjSIk','qBylx','caxsV','vwrUq','khbgM','[Auth]\x20openid:\x20User\x20found\x20with\x20email\x20\x22','No\x20valid\x20group\x20found\x20in\x20userinfo:\x20','Authorization:\x20REDACTED','comparePassword','muqFh','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20no\x20email\x20in\x20userinfo','\x22\x20using\x20\x22','User\x20not\x20active\x20or\x20not\x20found','stack','GdgrX','zNTgi','pash','AbysY','[Auth]\x20openid:\x20User\x20found\x20by\x20email/username','end_session_endpoint','logout','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20invalid','uDnAj','crypto','authActiveAuthMethods','Strict','Unknown\x20error','getUserByEmail','delete','qbEIH','error','gIAwR','isOpenIDAuthSettingsValid','://','CDoTy','useAuthStrategy','LyjpO','root','Invalid\x20pathname','findOrCreateUser','get','_key','base64','OETJM','fromExtractors','\x22\x20logged\x20in\x20from\x20ip\x20','FEdrO','olxoL','response','OWMxP','code_verifier','[Auth]\x20Invalid\x20redirect_uri=','rPoxy','authOpenIDTokenURL','/login?error=','./utils','aGMai','authOpenIDGroupClaim','fromAuthHeaderAsBearerToken','toString','hbRBg','/auth/openid/config','x-forwarded-proto','fromUrlQueryParameter','PWZtn','iScTb','JqRqP','initAuthStrategyOpenID','authOpenIDTokenSigningAlgorithm','\x22\x20from\x20\x22','3558660JISkbU','authOpenIDJwksURL','tSCnH','toOldJSONForBrowser','kRjZg','BTHSq','[Auth]\x20openid:\x20User\x20found\x20with\x20username\x20\x22','fErPT','jQeUy','PKUkq','Internal\x20Server\x20Error','\x22\x20cannot\x20be\x20downgraded\x20to\x20','stringify','GFqAx','authOpenIDMobileRedirectURIs','bind','info','ejChL','ansej','JNjWo','id_token','PkVIV','Invalid\x20password','openid','AkwOc','jnwOE','extraData','getUserById','serializeUser','userinfo_endpoint','[Auth]\x20Error\x20in\x20/auth/openid\x20route:\x20','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20email\x20\x22','KaBlm','openid-client','S256','./Logger','BQfEV','No\x20redirect\x20URI','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20neither\x20preferred_username\x20nor\x20username\x20in\x20userinfo','paramsToCookies','bzKYO','RhSUc','[Auth]\x20/auth/openid/mobile-redirect\x20route:\x20State\x20parameter\x20mismatch','hrmge','logFailedLocalAuthLoginAttempt','No\x20session','aPZZQ','uAMlR','2653357WfdFkL','8606424NjtKPS','dDjMu','CVvJz','replace','mOpsC','/auth/openid/mobile-redirect','warn','\x20not\x20found\x20or\x20empty\x20in\x20userinfo','localAuthCheckUserPw','pfFrO','VavKf','EjPoM','random','cLjDw','MyYVl','isAuthenticated','EhEne','axios','query','QdpNk','MycuK','User\x20not\x20found','auth_cb','Group\x20claim\x20','/login','libraryModel','userModel','Root\x20user\x20has\x20no\x20password\x20set','VOOlt','No\x20callback\x20or\x20already\x20expired','handleLoginSuccessBasedOnCookie','code','[Auth]\x20Non-admin\x20user\x20\x22','Invalid\x20userinfo,\x20no\x20sub','UNKNOWN','fOTLD','cookie','xGjlL','authenticate','username','dYLhZ','sub','authOpenIDClientID','[Auth]\x20User\x20\x22','ifAuthNeeded','YqMDL','ECUBh','YSnyq','EThxx','WKoEW','authOpenIDSub','send','passport','[Auth]\x20No\x20data\x20in\x20openid\x20callback\x20-\x20','cookies','DsHce','Invalid\x20response_type,\x20only\x20code\x20supported','authOpenIDAutoRegister','openid\x20profile\x20email','xHRRt','local','[Auth]\x20Error\x20in\x20openid\x20callback\x20-\x20','path','VWNUb','BFPXA','getUserLoginResponsePayload','endsWith','fShTq','bqivf','authOpenIDAdvancedPermsClaim','./libs/passportLocal','update','catch','session','Kiveb','https','serverSettings','/auth/openid/callback','updateServerSettings','User\x20is\x20not\x20active','sendStatus','env','ccgIF','yNvTP','initAuthRoutes','ignorePatterns','initAuthStrategyPassword','passport-jwt','\x22\x20from\x20ip\x20','[Auth]\x20Invalid\x20auth\x20strategy\x20','[Auth]\x20OIDC\x20redirect_uri=','admin','generateAccessToken','toLowerCase','&state=','changed','_client','isActive','openid_id_token',':\x20Failed\x20to\x20get\x20openid\x20configuration','\x22\x20but\x20is\x20already\x20matched\x20with\x20sub\x20\x22','5VxuafQ','WjWwk','TOKEN_SECRET','ZMSDW','107NwCjQz','message','use','setUserGroup','Invalid\x20new\x20password\x20-\x20Only\x20root\x20can\x20have\x20an\x20empty\x20password','USDPD','[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration\x20at\x20\x22','mbczO','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20email\x20\x22','has','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.username\x20\x22','VTtqE','authorizationUrl','VJpEJ','UtyLn','secure','token_endpoint','hash','\x20not\x20found\x20in\x20userinfo','nmVli','response_type','_header','qBuEi','codeVerifier','email_verified','status','mnzRY','[Auth]\x20openid\x20callback:\x20Updating\x20advanced\x20perms\x20for\x20user\x20\x22','\x22\x20is\x20not\x20verified','set','redirect_uri','debug','RDwha','email','clearCookie','deDfg','?setToken=','[Auth]\x20Cannot\x20init\x20openid\x20auth\x20strategy\x20-\x20invalid\x20settings','authOpenIDMatchExistingBy','TggNX','exports','_params','wvlOA','oylay','user','jwks_uri','quzUs','updateUserPermissions','fvOep','includes','gmSEQ','issuer','mtlqF','Issuer','NRjbU','.\x20Denying\x20login.','deserializeUser','logIn','endSessionUrl','validateGroupClaim','state','bhvCz','vkKTa','tokenSecret','[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration.\x20Invalid\x20URL\x20\x22','statusCode','gXwaZ','WwAiW','hashPass','verify','initPassportJs','/api)?/items/[^/]+/cover$','aNNRT','ExtractJwt','tcmHu','6980rXsjOz','req','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20required','VuIkB','GGBDO','uMeQb','YraOQ','FTCOr','State\x20parameter\x20mismatch','openid-mobile','yXoEm','vKhJX','token'];_0x12dd=function(){return _0x2b2807;};return _0x12dd();}class Auth{constructor(){const _0x5c44af=_0xe68a7a,_0x340d90={'bqivf':function(_0x498d5d,_0x1c7e83){return _0x498d5d(_0x1c7e83);}};this['openIdAuthSession']=new Map();const _0x76bf9e=_0x340d90[_0x5c44af(0x20b)](escapeRegExp,global[_0x5c44af(0x140)]);this[_0x5c44af(0x21c)]=[new RegExp('^('+_0x76bf9e+_0x5c44af(0xd5)),new RegExp('^('+_0x76bf9e+'/api)?/authors/[^/]+/image$')];}[_0xe68a7a(0x127)](_0x4b343e){const _0x1df63b=_0xe68a7a;return _0x4b343e['method']==='GET'&&this[_0x1df63b(0x21c)][_0x1df63b(0x138)](_0x5e98c9=>_0x5e98c9[_0x1df63b(0x133)](_0x4b343e[_0x1df63b(0x205)]));}[_0xe68a7a(0x1f3)](_0x49f37d){const _0x4c59d0=_0xe68a7a,_0x129242={'QkLex':_0x4c59d0(0x1ef),'xHRRt':function(_0x17e616){return _0x17e616();}};return(_0x3f78ff,_0x25e2df,_0x5d8c30)=>{const _0x1f42d9=_0x4c59d0;if(this[_0x1f42d9(0x127)](_0x3f78ff)){if(_0x129242[_0x1f42d9(0x121)]===_0x1f42d9(0x1ef))return _0x129242[_0x1f42d9(0x202)](_0x5d8c30);else _0x1050a8[_0x1f42d9(0x1a6)](_0x1f42d9(0x98)+_0x26dd58['username']+'\x22'),_0x387de6=_0x11e994[_0x1f42d9(0x1ee)];}_0x49f37d(_0x3f78ff,_0x25e2df,_0x5d8c30);};}async[_0xe68a7a(0xd4)](){const _0x118d16=_0xe68a7a,_0x21fb47={'wvlOA':_0x118d16(0x167),'fOTLD':_0x118d16(0x17a),'VJpEJ':function(_0x2d8285,_0x36a121){return _0x2d8285!==_0x36a121;},'CDoTy':_0x118d16(0x151),'rfMrr':function(_0x200aa3,_0x3563df,_0x51810b){return _0x200aa3(_0x3563df,_0x51810b);},'MyYVl':function(_0x591e1f,_0x37d045){return _0x591e1f===_0x37d045;},'EseAH':_0x118d16(0xf9),'sfSXj':_0x118d16(0x1f6)};global[_0x118d16(0x103)][_0x118d16(0x168)]['includes'](_0x118d16(0x203))&&this[_0x118d16(0x21d)](),global[_0x118d16(0x103)]['authActiveAuthMethods'][_0x118d16(0xbf)](_0x118d16(0x1ad))&&this['initAuthStrategyOpenID'](),passport[_0x118d16(0x232)](new JwtStrategy({'jwtFromRequest':ExtractJwt[_0x118d16(0x17c)]([ExtractJwt[_0x118d16(0x18a)](),ExtractJwt[_0x118d16(0x18f)](_0x118d16(0xe5))]),'secretOrKey':Database[_0x118d16(0x213)][_0x118d16(0xcd)]},this[_0x118d16(0x12a)][_0x118d16(0x1a5)](this))),passport[_0x118d16(0x1b2)](function(_0x59ee7a,_0x55aa86){const _0x1ec480=_0x118d16;_0x21fb47[_0x1ec480(0x1d5)](_0x21fb47['EseAH'],_0x21fb47['sfSXj'])?_0x58c396[_0x1ec480(0x1a6)](_0x1ec480(0xa9)+_0x488304[_0x1ec480(0x1ee)]+_0x1ec480(0x15b)+_0x3c9b21[_0x1ec480(0x1a2)](_0x57fad2)+'\x22'):process[_0x1ec480(0x100)](function(){const _0x13cc71=_0x1ec480,_0x13a509={'ZMSDW':function(_0x57bbfb,_0x2f9c3c){return _0x57bbfb(_0x2f9c3c);},'ansej':_0x21fb47[_0x13cc71(0xb8)],'JqRqP':_0x21fb47[_0x13cc71(0x1ea)]};if(_0x21fb47[_0x13cc71(0x9b)](_0x13cc71(0x1e3),_0x21fb47[_0x13cc71(0x172)]))return _0x21fb47[_0x13cc71(0xfb)](_0x55aa86,null,JSON['stringify']({'id':_0x59ee7a['id']}));else _0x2369fc[_0x13cc71(0x213)][_0x13cc71(0xcd)]=_0x13a509[_0x13cc71(0x22f)](_0x67dcf1,_0x13a509[_0x13cc71(0x1a8)])['randomBytes'](0x100)['toString'](_0x13a509[_0x13cc71(0x192)]);});}),passport[_0x118d16(0xc6)](function(_0x31dd7e,_0x21c09f){const _0x4cb222=_0x118d16,_0x53dfd8={'gmSEQ':function(_0x3f5c28,_0x1f95f5,_0x110123){return _0x3f5c28(_0x1f95f5,_0x110123);}};process[_0x4cb222(0x100)](async function(){const _0x5a1095=_0x4cb222,_0x48c8cf=JSON['parse'](_0x31dd7e),_0x4075ca=await Database[_0x5a1095(0x1e1)][_0x5a1095(0x1b1)](_0x48c8cf['id']);return _0x53dfd8[_0x5a1095(0xc0)](_0x21c09f,null,_0x4075ca);}[_0x4cb222(0x1a5)](this));}[_0x118d16(0x1a5)](this));}[_0xe68a7a(0x21d)](){const _0x402730=_0xe68a7a;passport['use'](new LocalStrategy({'passReqToCallback':!![]},this[_0x402730(0x1cf)][_0x402730(0x1a5)](this)));}['initAuthStrategyOpenID'](){const _0x3849cd=_0xe68a7a,_0x5dac0a={'yiIEs':_0x3849cd(0x15c),'vNAZE':function(_0x2b8a64,_0x299351,_0x229e13){return _0x2b8a64(_0x299351,_0x229e13);},'GGBDO':function(_0x38da00,_0x3d2f07,_0x428998,_0x36719a){return _0x38da00(_0x3d2f07,_0x428998,_0x36719a);},'caxsV':_0x3849cd(0x12c),'PkVIV':function(_0x2b0d0f,_0x29f024){return _0x2b0d0f!==_0x29f024;},'UtyLn':_0x3849cd(0x191)};if(!Database[_0x3849cd(0x213)][_0x3849cd(0x170)]){if(_0x5dac0a[_0x3849cd(0x1ab)](_0x3849cd(0x184),_0x5dac0a[_0x3849cd(0x9c)])){Logger[_0x3849cd(0x16e)](_0x3849cd(0xb3));return;}else return![];}OpenIDClient['custom']['setHttpOptionsDefaults']({'timeout':0x2710});const _0x2bcca1=new OpenIDClient[(_0x3849cd(0xc3))]({'issuer':global[_0x3849cd(0x103)][_0x3849cd(0xfe)],'authorization_endpoint':global[_0x3849cd(0x103)]['authOpenIDAuthorizationURL'],'token_endpoint':global[_0x3849cd(0x103)][_0x3849cd(0x185)],'userinfo_endpoint':global[_0x3849cd(0x103)]['authOpenIDUserInfoURL'],'jwks_uri':global['ServerSettings'][_0x3849cd(0x197)],'end_session_endpoint':global['ServerSettings']['authOpenIDLogoutURL']})[_0x3849cd(0x129)],_0x10f2d2=new _0x2bcca1({'client_id':global['ServerSettings'][_0x3849cd(0x1f1)],'client_secret':global[_0x3849cd(0x103)]['authOpenIDClientSecret'],'id_token_signed_response_alg':global[_0x3849cd(0x103)][_0x3849cd(0x194)]});passport[_0x3849cd(0x232)](_0x3849cd(0x1b7),new OpenIDClient['Strategy']({'client':_0x10f2d2,'params':{'redirect_uri':global[_0x3849cd(0x103)][_0x3849cd(0xf7)]+_0x3849cd(0x214),'scope':_0x3849cd(0x201)}},async(_0x3499d4,_0x1af668,_0x3dc467)=>{const _0x26ff72=_0x3849cd;try{Logger[_0x26ff72(0xad)]('[Auth]\x20openid\x20callback\x20userinfo=',JSON[_0x26ff72(0x1a2)](_0x1af668,null,0x2));if(!_0x1af668[_0x26ff72(0x1f0)])throw new Error(_0x26ff72(0x1e8));if(!this[_0x26ff72(0xc9)](_0x1af668))throw new Error(_0x26ff72(0x1de)+Database[_0x26ff72(0x213)][_0x26ff72(0x189)]+_0x26ff72(0x1ce));let _0x444adb=await this[_0x26ff72(0x177)](_0x1af668);if(!_0x444adb?.[_0x26ff72(0x228)])throw new Error(_0x5dac0a[_0x26ff72(0x119)]);return await this[_0x26ff72(0x233)](_0x444adb,_0x1af668),await this['updateUserPermissions'](_0x444adb,_0x1af668),_0x444adb['openid_id_token']=_0x3499d4[_0x26ff72(0x1aa)],_0x5dac0a[_0x26ff72(0x104)](_0x3dc467,null,_0x444adb);}catch(_0x1fba16){return Logger['error']('[Auth]\x20openid\x20callback\x20error:\x20'+_0x1fba16?.[_0x26ff72(0x231)]+'\x0a'+_0x1fba16?.[_0x26ff72(0x15d)]),_0x5dac0a[_0x26ff72(0xdd)](_0x3dc467,null,null,_0x5dac0a[_0x26ff72(0x152)]);}}));}async[_0xe68a7a(0x177)](_0x4be191){const _0x3d864c=_0xe68a7a,_0x3962e0={'qKmzF':function(_0x58f675){return _0x58f675();},'Ddgft':function(_0x7f7653,_0x5ab426){return _0x7f7653===_0x5ab426;},'uMeQb':_0x3d864c(0xe8),'fErPT':_0x3d864c(0x13c),'wySPz':_0x3d864c(0x1b0),'DWNwT':function(_0x440cec,_0x5e3be7){return _0x440cec===_0x5e3be7;}};let _0x3aabe7=await Database[_0x3d864c(0x1e1)]['getUserByOpenIDSub'](_0x4be191[_0x3d864c(0x1f0)]);if(_0x3aabe7)return Logger[_0x3d864c(0xad)]('[Auth]\x20openid:\x20User\x20found\x20by\x20sub'),_0x3aabe7;if(Database['serverSettings']['authOpenIDMatchExistingBy']===_0x3d864c(0xaf)){if(_0x4be191['email']){if(_0x4be191[_0x3d864c(0xa6)]===![])return Logger[_0x3d864c(0x1cd)](_0x3d864c(0x1b5)+_0x4be191[_0x3d864c(0xaf)]+_0x3d864c(0xaa)),null;else{Logger[_0x3d864c(0x1a6)](_0x3d864c(0x96)+_0x4be191[_0x3d864c(0xaf)]+'\x22'),_0x3aabe7=await Database[_0x3d864c(0x1e1)][_0x3d864c(0x16b)](_0x4be191['email']);if(_0x3aabe7?.['authOpenIDSub'])return Logger[_0x3d864c(0x1cd)](_0x3d864c(0x155)+_0x4be191[_0x3d864c(0xaf)]+_0x3d864c(0x22b)+_0x3aabe7[_0x3d864c(0x1f9)]+'\x22'),null;}}else return Logger[_0x3d864c(0x1cd)](_0x3d864c(0x15a)),null;}else{if(_0x3962e0['Ddgft'](Database['serverSettings'][_0x3d864c(0xb4)],_0x3d864c(0x1ee))){let _0x5efa17;if(_0x4be191[_0x3d864c(0x11a)])Logger[_0x3d864c(0x1a6)]('[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.preferred_username\x20\x22'+_0x4be191[_0x3d864c(0x11a)]+'\x22'),_0x5efa17=_0x4be191[_0x3d864c(0x11a)];else{if(_0x4be191[_0x3d864c(0x1ee)])Logger[_0x3d864c(0x1a6)](_0x3d864c(0x98)+_0x4be191[_0x3d864c(0x1ee)]+'\x22'),_0x5efa17=_0x4be191[_0x3d864c(0x1ee)];else{if(_0x3962e0[_0x3d864c(0xde)]!==_0x3d864c(0x1c9))return Logger['warn'](_0x3d864c(0x1bc)),null;else _0x1d8a20['status'](0x190)[_0x3d864c(0x1fa)](_0x3d864c(0x1e4));}}_0x3aabe7=await Database['userModel'][_0x3d864c(0x13a)](_0x5efa17);if(_0x3aabe7?.[_0x3d864c(0x1f9)])return Logger[_0x3d864c(0x1cd)](_0x3d864c(0x19c)+_0x5efa17+_0x3d864c(0x22b)+_0x3aabe7[_0x3d864c(0x1f9)]+'\x22'),null;}}if(_0x3aabe7){const _0x1995b5=_0x3962e0[_0x3d864c(0x19d)][_0x3d864c(0xec)]('|');let _0x1e4230=0x0;while(!![]){switch(_0x1995b5[_0x1e4230++]){case'0':await _0x3aabe7[_0x3d864c(0x13d)]();continue;case'1':Logger[_0x3d864c(0xad)](_0x3d864c(0x162));continue;case'2':_0x3aabe7[_0x3d864c(0x226)](_0x3962e0['wySPz'],!![]);continue;case'3':if(!_0x3aabe7[_0x3d864c(0x228)])return Logger['warn'](_0x3d864c(0xed)),null;continue;case'4':if(!_0x3aabe7[_0x3d864c(0x1b0)])_0x3aabe7[_0x3d864c(0x1b0)]={};continue;case'5':return _0x3aabe7;case'6':_0x3aabe7[_0x3d864c(0x1b0)][_0x3d864c(0x1f9)]=_0x4be191[_0x3d864c(0x1f0)];continue;}break;}}if(Database['serverSettings'][_0x3d864c(0x200)])return _0x3962e0['DWNwT'](_0x3d864c(0x117),_0x3d864c(0xe3))?(_0x41d57c,_0x5bf2e9,_0x262938)=>{const _0x817b8f=_0x3d864c;if(this[_0x817b8f(0x127)](_0x41d57c))return _0x3962e0['qKmzF'](_0x262938);_0x4fa5ce(_0x41d57c,_0x5bf2e9,_0x262938);}:(Logger[_0x3d864c(0x1a6)]('[Auth]\x20openid:\x20Auto-registering\x20user\x20with\x20sub\x20\x22'+_0x4be191['sub']+'\x22',_0x4be191),_0x3aabe7=await Database[_0x3d864c(0x1e1)]['createUserFromOpenIdUserInfo'](_0x4be191,this),_0x3aabe7);return Logger['warn'](_0x3d864c(0xe7)),null;}[_0xe68a7a(0xc9)](_0x90036d){const _0xa08827=_0xe68a7a,_0x5331be=Database[_0xa08827(0x213)][_0xa08827(0x189)];if(!_0x5331be)return!![];if(!_0x90036d[_0x5331be])return![];return!![];}async[_0xe68a7a(0x233)](_0x22b599,_0x3a1ac2){const _0x136977=_0xe68a7a,_0x3af118={'kRjZg':function(_0x263470){return _0x263470();},'TggNX':_0x136977(0xba),'YqMDL':_0x136977(0x112),'KncwC':function(_0xde3a6a,_0x3fd403){return _0xde3a6a===_0x3fd403;},'ukbet':_0x136977(0x175),'FEdrO':function(_0x1a2fed,_0x27b0e2){return _0x1a2fed!==_0x27b0e2;},'mtlqF':_0x136977(0x1c8)},_0x1c2207=Database[_0x136977(0x213)][_0x136977(0x189)];if(!_0x1c2207)return;if(!_0x3a1ac2[_0x1c2207])throw new Error(_0x136977(0x1de)+_0x1c2207+_0x136977(0xa0));const _0x304fae=_0x3a1ac2[_0x1c2207]['map'](_0x28f87e=>_0x28f87e[_0x136977(0x224)]()),_0x393581=['admin',_0x3af118[_0x136977(0xb5)],_0x3af118[_0x136977(0x1f4)]];let _0xbaf071=_0x393581['find'](_0x179133=>_0x304fae[_0x136977(0xbf)](_0x179133));if(_0xbaf071){if(_0x3af118['KncwC'](_0x22b599[_0x136977(0xfd)],_0x3af118['ukbet'])){if(_0x3af118[_0x136977(0x17e)]('FXnEq',_0x136977(0x154))){if(_0xbaf071!==_0x136977(0x222))throw new Error(_0x136977(0x148)+_0x22b599['username']+_0x136977(0x1a1)+_0xbaf071+'.\x20Denying\x20login.');else{if(_0x3af118[_0x136977(0x17e)](_0x3af118['mtlqF'],_0x3af118[_0x136977(0xc2)]))return _0x3af118[_0x136977(0x19a)](_0x4145e2);else return;}}else throw new _0x109dbe(_0x136977(0xf0));}_0x22b599[_0x136977(0xfd)]!==_0xbaf071&&(Logger['info'](_0x136977(0x149)+_0x22b599[_0x136977(0x1ee)]+'\x22\x20type\x20to\x20\x22'+_0xbaf071+_0x136977(0x195)+_0x22b599[_0x136977(0xfd)]+'\x22'),_0x22b599[_0x136977(0xfd)]=_0xbaf071,await _0x22b599['save']());}else throw new Error(_0x136977(0x156)+JSON[_0x136977(0x1a2)](_0x3a1ac2[_0x1c2207],null,0x2));}async[_0xe68a7a(0xbd)](_0x4a3fbd,_0x37643b){const _0x31d09f=_0xe68a7a,_0x3c5677={'VBaRE':_0x31d09f(0x222),'MmSni':function(_0x437acf,_0x417b52){return _0x437acf===_0x417b52;},'vkKTa':_0x31d09f(0x175)},_0x13f22d=Database[_0x31d09f(0x213)][_0x31d09f(0x20c)];if(!_0x13f22d)return;if(_0x4a3fbd[_0x31d09f(0xfd)]===_0x3c5677['VBaRE']||_0x3c5677['MmSni'](_0x4a3fbd[_0x31d09f(0xfd)],_0x3c5677[_0x31d09f(0xcc)]))return;const _0x12800d=_0x37643b[_0x13f22d];if(!_0x12800d)throw new Error(_0x31d09f(0x139)+_0x13f22d+_0x31d09f(0xa0));await _0x4a3fbd['updatePermissionsFromExternalJSON'](_0x12800d)&&Logger[_0x31d09f(0x1a6)]('[Auth]\x20openid\x20callback:\x20Updating\x20advanced\x20perms\x20for\x20user\x20\x22'+_0x4a3fbd[_0x31d09f(0x1ee)]+_0x31d09f(0x15b)+JSON[_0x31d09f(0x1a2)](_0x12800d)+'\x22');}[_0xe68a7a(0x110)](_0x58467a){const _0x10eb18=_0xe68a7a;passport[_0x10eb18(0x14e)](_0x58467a);}[_0xe68a7a(0x173)](_0x41190b){const _0x23a765=_0xe68a7a,_0x48df6b={'RIUgH':'local','UvwoQ':function(_0x1dad07,_0x230d14){return _0x1dad07+_0x230d14;},'sHJDi':_0x23a765(0x220)};if(_0x41190b===_0x23a765(0x1ad))this[_0x23a765(0x193)]();else _0x41190b===_0x48df6b['RIUgH']?this['initAuthStrategyPassword']():_0x23a765(0x19f)===_0x23a765(0x1ec)?_0x18de44[_0x23a765(0x232)](new _0xbad4d7({'passReqToCallback':!![]},this[_0x23a765(0x1cf)][_0x23a765(0x1a5)](this))):Logger[_0x23a765(0x16e)](_0x48df6b[_0x23a765(0x141)](_0x48df6b['sHJDi'],_0x41190b));}[_0xe68a7a(0x131)](_0x39e8f4){const _0x28ebf7=_0xe68a7a;return[_0x28ebf7(0x105),_0x28ebf7(0xe2)]['includes'](_0x39e8f4);}[_0xe68a7a(0x1bd)](_0x23e909,_0x31f88d,_0x4e561f=_0xe68a7a(0x203)){const _0x42f8b3=_0xe68a7a,_0x5995d0={'anguq':_0x42f8b3(0x165),'hrmge':function(_0xaad2eb,_0x49c7d3,_0x572e7e,_0x166187){return _0xaad2eb(_0x49c7d3,_0x572e7e,_0x166187);},'VavKf':function(_0x4b2c93,_0x36a682){return _0x4b2c93!==_0x36a682;},'Kiveb':_0x42f8b3(0x13f),'vJmrl':function(_0x4e60a2,_0x1efde0){return _0x4e60a2!==_0x1efde0;},'WwAiW':_0x42f8b3(0xe4),'ZFABn':_0x42f8b3(0xea),'hbRBg':function(_0x1f478b,_0x3b47e9){return _0x1f478b*_0x3b47e9;}},_0x142463=0x1d4c0,_0x141d60=_0x23e909['query'][_0x42f8b3(0xac)]||_0x23e909[_0x42f8b3(0x1d9)]['callback'];if(!this[_0x42f8b3(0x131)](_0x4e561f)){if(_0x5995d0[_0x42f8b3(0x1d1)](_0x42f8b3(0x15f),_0x42f8b3(0x15f)))return _0x22a9f4[_0x42f8b3(0x16e)](_0x42f8b3(0xce)+_0x2c0eff+'\x22',_0x28a075),_0x443054[_0x42f8b3(0xa7)](0x190)['send'](_0x5995d0['anguq']);else{_0x23e909[_0x42f8b3(0x1d9)][_0x42f8b3(0xca)]&&_0x31f88d[_0x42f8b3(0x1eb)](_0x5995d0[_0x42f8b3(0x211)],_0x23e909[_0x42f8b3(0x1d9)]['state'],{'maxAge':_0x142463,'httpOnly':!![]});if(!_0x141d60){if(_0x5995d0[_0x42f8b3(0x12b)](_0x5995d0[_0x42f8b3(0xd1)],_0x5995d0[_0x42f8b3(0xd1)])){if(this[_0x42f8b3(0x127)](_0x173975))return _0x302c06();_0x5995d0[_0x42f8b3(0x1c1)](_0x24f591,_0x4e7c04,_0x34dc98,_0x151cda);}else return _0x31f88d['status'](0x190)[_0x42f8b3(0x1fa)]({'message':_0x5995d0['ZFABn']});}_0x31f88d[_0x42f8b3(0x1eb)](_0x42f8b3(0x1dd),_0x141d60,{'maxAge':_0x142463,'httpOnly':!![]});}}_0x31f88d[_0x42f8b3(0x1eb)](_0x42f8b3(0x12f),_0x4e561f,{'maxAge':_0x5995d0[_0x42f8b3(0x18c)](_0x5995d0[_0x42f8b3(0x18c)](_0x5995d0['hbRBg'](_0x5995d0['hbRBg'](0x3e8,0x3c)*0x3c,0x18),0x16d),0xa),'httpOnly':!![]});}async[_0xe68a7a(0x1e5)](_0x9b2709,_0x14494a){const _0x5cced6=_0xe68a7a,_0x21265a=await this[_0x5cced6(0x208)](_0x9b2709[_0x5cced6(0xba)]);if(this['isAuthMethodAPIBased'](_0x9b2709[_0x5cced6(0x1fd)][_0x5cced6(0x12f)]))_0x14494a['json'](_0x21265a);else{if(_0x9b2709[_0x5cced6(0x1fd)][_0x5cced6(0x1dd)]){let _0x5d06f5=_0x9b2709['cookies'][_0x5cced6(0x13f)]?_0x5cced6(0x225)+_0x9b2709['cookies'][_0x5cced6(0x13f)]:'';_0x14494a[_0x5cced6(0x13b)](0x12e,_0x9b2709[_0x5cced6(0x1fd)][_0x5cced6(0x1dd)]+_0x5cced6(0xb2)+_0x21265a[_0x5cced6(0xba)][_0x5cced6(0xe5)]+_0x5d06f5);}else _0x14494a[_0x5cced6(0xa7)](0x190)['send']('No\x20callback\x20or\x20already\x20expired');}}async[_0xe68a7a(0x21b)](_0x13c73f){const _0x2a1c71=_0xe68a7a,_0x3c742e={'aGMai':_0x2a1c71(0xe2),'vPWtY':'openid','uDnAj':_0x2a1c71(0x212),'mOpsC':_0x2a1c71(0x229),'HmqDQ':_0x2a1c71(0xf0),'sqXIn':'ScWhc','PWZtn':_0x2a1c71(0x14a),'EDvrD':'S256','PkuCn':function(_0x503d0d,_0x11bc67){return _0x503d0d===_0x11bc67;},'jQeUy':_0x2a1c71(0x18e),'aGiev':_0x2a1c71(0x10e),'EThxx':_0x2a1c71(0x102),'AkwOc':_0x2a1c71(0x1e6),'VTtqE':function(_0x25d9be,_0x46cfba){return _0x25d9be===_0x46cfba;},'jnwOE':_0x2a1c71(0x207),'khOWd':_0x2a1c71(0x1d2),'muqFh':'Invalid\x20state,\x20not\x20allowed\x20on\x20web\x20flow','FTCOr':function(_0x2d5bd5,_0x2afec9){return _0x2d5bd5+_0x2afec9;},'DRYOF':_0x2a1c71(0x1a0),'bhvCz':_0x2a1c71(0xe1),'VGuQg':_0x2a1c71(0x108),'NYclA':function(_0x365911,_0x12124e){return _0x365911*_0x12124e;},'ipPmS':function(_0x446b17,_0x44fd7e){return _0x446b17*_0x44fd7e;},'YraOQ':function(_0x3f1a57){return _0x3f1a57();},'deDfg':function(_0x287678,_0x481c6e,_0x4622b0){return _0x287678(_0x481c6e,_0x4622b0);},'sPfCZ':function(_0x61ac63,_0x5a8656){return _0x61ac63(_0x5a8656);},'WjWwk':_0x2a1c71(0xd0),'nmVli':'Error\x20in\x20callback','TXvxL':_0x2a1c71(0x1c3),'delQQ':function(_0x5d8237,_0x3c7b4b,_0x5872ec,_0x570bdd){return _0x5d8237(_0x3c7b4b,_0x5872ec,_0x570bdd);},'Mqmss':_0x2a1c71(0x16d),'qBuEi':_0x2a1c71(0x1d4),'PWqVK':_0x2a1c71(0x1c4),'DvoAs':'auth_method','uAMlR':'SiXuZ','xquha':function(_0x48a684,_0x2fb1bb){return _0x48a684===_0x2fb1bb;},'JNjWo':_0x2a1c71(0x203),'QdpNk':_0x2a1c71(0x1cc),'GFqAx':_0x2a1c71(0x123)};_0x13c73f[_0x2a1c71(0x109)](_0x2a1c71(0x1df),passport[_0x2a1c71(0x1ed)](_0x3c742e[_0x2a1c71(0x1a9)]),async(_0x45f318,_0x5a2df0)=>{const _0x18a83a=_0x2a1c71;_0x5a2df0[_0x18a83a(0x11e)](await this[_0x18a83a(0x208)](_0x45f318['user']));}),_0x13c73f[_0x2a1c71(0x178)](_0x2a1c71(0xf6),(_0x506abe,_0x2d9bf6,_0x3b7de0)=>{const _0x2e5f81=_0x2a1c71,_0x5159cd=passport['_strategy']('openid-client'),_0x5d87d6=_0x5159cd['_client'],_0x1717a4=_0x5159cd[_0x2e5f81(0x179)];try{const _0x28c02e=_0x506abe[_0x2e5f81(0x9d)]||_0x506abe[_0x2e5f81(0x178)](_0x3c742e[_0x2e5f81(0x19e)])===_0x2e5f81(0x212)?_0x3c742e[_0x2e5f81(0x166)]:_0x3c742e[_0x2e5f81(0x114)],_0x38f277=new URL(_0x28c02e+_0x2e5f81(0x171)+_0x506abe[_0x2e5f81(0x178)](_0x3c742e['EThxx'])),_0x5e29e9=_0x3c742e[_0x2e5f81(0x11c)](_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xa2)],_0x3c742e[_0x2e5f81(0x1ae)])||_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xac)]||_0x506abe['query']['code_challenge'];if(_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xa2)]&&_0x506abe['query'][_0x2e5f81(0xa2)]!==_0x3c742e['AkwOc'])return Logger[_0x2e5f81(0xad)]('[Auth]\x20OIDC\x20Invalid\x20response_type='+_0x506abe[_0x2e5f81(0x1d9)]['response_type']),_0x2d9bf6[_0x2e5f81(0xa7)](0x190)['send'](_0x2e5f81(0x1ff));const _0x62bb28=!_0x5e29e9||!_0x506abe[_0x2e5f81(0x1d9)]['state']?OpenIDClient['generators'][_0x2e5f81(0x1d3)]():_0x506abe['query'][_0x2e5f81(0xca)];let _0x3088ce;if(_0x5e29e9){if(_0x3c742e[_0x2e5f81(0x99)](_0x3c742e[_0x2e5f81(0x1af)],_0x2e5f81(0xc4)))return _0x105fdf[_0x2e5f81(0x1cd)]('[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20email\x20\x22'+_0x59256f[_0x2e5f81(0xaf)]+_0x2e5f81(0xaa)),null;else{if(!_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xac)]||!_0x10b95b(_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xac)]))return Logger['debug'](_0x2e5f81(0x183)+_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xac)]),_0x2d9bf6[_0x2e5f81(0xa7)](0x190)[_0x2e5f81(0x1fa)](_0x2e5f81(0xfc));this[_0x2e5f81(0x125)][_0x2e5f81(0xab)](_0x62bb28,{'mobile_redirect_uri':_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xac)]}),_0x3088ce=new URL(global[_0x2e5f81(0x103)]['authOpenIDSubfolderForRedirectURLs']+_0x2e5f81(0x1cc),_0x38f277)[_0x2e5f81(0x18b)]();}}else{_0x3088ce=new URL(global[_0x2e5f81(0x103)]['authOpenIDSubfolderForRedirectURLs']+'/auth/openid/callback',_0x38f277)[_0x2e5f81(0x18b)]();if(_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xca)])return'zJGsR'!==_0x3c742e['khOWd']?(Logger[_0x2e5f81(0xad)]('[Auth]\x20Invalid\x20state\x20-\x20not\x20allowed\x20on\x20web\x20openid\x20flow'),_0x2d9bf6[_0x2e5f81(0xa7)](0x190)['send'](_0x3c742e[_0x2e5f81(0x159)])):(_0x5c3033['debug']('[Auth]\x20OIDC\x20Invalid\x20response_type='+_0x45fcb3[_0x2e5f81(0x1d9)][_0x2e5f81(0xa2)]),_0x53db03['status'](0x190)[_0x2e5f81(0x1fa)](_0x2e5f81(0x1ff)));}_0x5159cd[_0x2e5f81(0xb7)][_0x2e5f81(0xac)]=_0x3088ce,Logger[_0x2e5f81(0xad)](_0x2e5f81(0x221)+_0x3088ce);let {code_challenge:_0x128317,code_challenge_method:_0x3eb0b1,code_verifier:_0x2fff70}=_0x59c157(_0x506abe,_0x5e29e9);_0x506abe[_0x2e5f81(0x210)][_0x1717a4]={..._0x506abe[_0x2e5f81(0x210)][_0x1717a4],'state':_0x62bb28,'max_age':_0x5159cd[_0x2e5f81(0xb7)][_0x2e5f81(0x10c)],'response_type':_0x3c742e[_0x2e5f81(0x1ae)],'code_verifier':_0x2fff70,'mobile':_0x506abe[_0x2e5f81(0x1d9)][_0x2e5f81(0xac)],'sso_redirect_uri':_0x5159cd[_0x2e5f81(0xb7)][_0x2e5f81(0xac)]};var _0x1c3edc=_0x2e5f81(0x201);global[_0x2e5f81(0x103)]['authOpenIDGroupClaim']&&(_0x1c3edc+=_0x3c742e[_0x2e5f81(0xe0)]('\x20',global[_0x2e5f81(0x103)]['authOpenIDGroupClaim']));global['ServerSettings'][_0x2e5f81(0x20c)]&&(_0x1c3edc+=_0x3c742e['FTCOr']('\x20',global[_0x2e5f81(0x103)][_0x2e5f81(0x20c)]));const _0x362832=_0x5d87d6[_0x2e5f81(0x9a)]({..._0x5159cd[_0x2e5f81(0xb7)],'state':_0x62bb28,'response_type':_0x3c742e[_0x2e5f81(0x1ae)],'scope':_0x1c3edc,'code_challenge':_0x128317,'code_challenge_method':_0x3eb0b1});this[_0x2e5f81(0x1bd)](_0x506abe,_0x2d9bf6,_0x5e29e9?_0x3c742e[_0x2e5f81(0x188)]:'openid'),_0x2d9bf6[_0x2e5f81(0x13b)](_0x362832);}catch(_0x4329b7){Logger[_0x2e5f81(0x16e)](_0x2e5f81(0x1b4)+_0x4329b7+'\x0a'+_0x4329b7?.[_0x2e5f81(0x15d)]),_0x2d9bf6['status'](0x1f4)[_0x2e5f81(0x1fa)](_0x3c742e['DRYOF']);}function _0x59c157(_0x116cd2,_0x4827fe){const _0x583e4d=_0x2e5f81,_0x57b8c0={'AOIGu':function(_0x41c48f,_0x398793){return _0x41c48f===_0x398793;},'quzUs':_0x3c742e[_0x583e4d(0x188)],'KaBlm':function(_0x5d5814,_0x473e47){return _0x5d5814===_0x473e47;},'bzKYO':_0x3c742e[_0x583e4d(0x113)],'BTHSq':_0x583e4d(0x18e),'gIAwR':_0x3c742e[_0x583e4d(0x166)],'mnzRY':_0x583e4d(0x102),'ZDqYR':_0x3c742e[_0x583e4d(0x1cb)]};if(_0x4827fe){if(!_0x116cd2[_0x583e4d(0x1d9)][_0x583e4d(0x126)])throw new Error(_0x3c742e[_0x583e4d(0x137)]);if(_0x116cd2[_0x583e4d(0x1d9)][_0x583e4d(0x118)]&&_0x116cd2[_0x583e4d(0x1d9)][_0x583e4d(0x118)]!==_0x583e4d(0x1b8)){if('Axgwa'!==_0x3c742e[_0x583e4d(0x13e)])throw new Error(_0x3c742e[_0x583e4d(0x190)]);else{const _0x1df7a3=_0x3b592b[_0x583e4d(0x1fd)][_0x583e4d(0x12f)];_0x61b733[_0x583e4d(0xb0)]('auth_method');let _0x2044a5=null;if(_0x57b8c0['AOIGu'](_0x1df7a3,_0x583e4d(0x1ad))||_0x1df7a3===_0x57b8c0[_0x583e4d(0xbc)]){const _0x37e9a7=_0x10905a['_strategy'](_0x583e4d(0x1b7)),_0x212357=_0x37e9a7[_0x583e4d(0x227)];if(_0x212357[_0x583e4d(0xc1)]['end_session_endpoint']&&_0x212357[_0x583e4d(0xc1)][_0x583e4d(0x163)][_0x583e4d(0x136)]>0x0){let _0x441be2=null;if(_0x57b8c0[_0x583e4d(0x1b6)](_0x1df7a3,_0x57b8c0[_0x583e4d(0x1be)])){const _0x356bd1=_0x142337[_0x583e4d(0x9d)]||_0x57b8c0['AOIGu'](_0x52626b[_0x583e4d(0x178)](_0x57b8c0[_0x583e4d(0x19b)]),_0x57b8c0[_0x583e4d(0x16f)])?_0x583e4d(0x212):_0x583e4d(0x10e),_0x275d5e=_0x3294f4[_0x583e4d(0x178)](_0x57b8c0[_0x583e4d(0xa8)]);_0x441be2=_0x356bd1+_0x583e4d(0x171)+_0x275d5e+_0x5f2b33['RouterBasePath']+_0x583e4d(0x1df);}_0x2044a5=_0x212357[_0x583e4d(0xc8)]({'id_token_hint':_0x25cad0[_0x583e4d(0x1fd)]['openid_id_token'],'post_logout_redirect_uri':_0x441be2});}_0x47a55f['clearCookie'](_0x57b8c0[_0x583e4d(0xe6)]);}_0x5556f9[_0x583e4d(0x1fa)]({'redirect_url':_0x2044a5});}}return{'code_challenge':_0x116cd2[_0x583e4d(0x1d9)][_0x583e4d(0x126)],'code_challenge_method':_0x116cd2[_0x583e4d(0x1d9)][_0x583e4d(0x118)]||_0x3c742e[_0x583e4d(0x128)]};}else{const _0x482945=OpenIDClient['generators'][_0x583e4d(0xa5)](),_0x272661=OpenIDClient[_0x583e4d(0x116)][_0x583e4d(0xee)](_0x482945);return{'code_challenge':_0x272661,'code_challenge_method':_0x583e4d(0x1b8),'code_verifier':_0x482945};}}function _0x10b95b(_0x33cc6a){const _0x1819d9=_0x2e5f81;return Database['serverSettings'][_0x1819d9(0x1a4)][_0x1819d9(0xbf)](_0x33cc6a)||_0x3c742e[_0x1819d9(0x11c)](Database['serverSettings']['authOpenIDMobileRedirectURIs']['length'],0x1)&&Database[_0x1819d9(0x213)][_0x1819d9(0x1a4)][0x0]==='*';}}),_0x13c73f[_0x2a1c71(0x178)](_0x3c742e[_0x2a1c71(0x1da)],(_0x3eb6ab,_0x1e77fa)=>{const _0x3ef4dc=_0x2a1c71;try{const {state:_0x5217b9,code:_0x55c4d0}=_0x3eb6ab[_0x3ef4dc(0x1d9)];if(!_0x5217b9||!this[_0x3ef4dc(0x125)][_0x3ef4dc(0x97)](_0x5217b9))return Logger['error'](_0x3ef4dc(0x1c0)),_0x1e77fa[_0x3ef4dc(0xa7)](0x190)['send'](_0x3c742e[_0x3ef4dc(0xcb)]);let _0x165dd8=this[_0x3ef4dc(0x125)][_0x3ef4dc(0x178)](_0x5217b9)[_0x3ef4dc(0xef)];if(!_0x165dd8)return Logger[_0x3ef4dc(0x16e)](_0x3c742e['VGuQg']),_0x1e77fa[_0x3ef4dc(0xa7)](0x190)[_0x3ef4dc(0x1fa)](_0x3ef4dc(0x1bb));this['openIdAuthSession'][_0x3ef4dc(0x16c)](_0x5217b9);const _0x555992=_0x165dd8+'?code='+encodeURIComponent(_0x55c4d0)+_0x3ef4dc(0x225)+encodeURIComponent(_0x5217b9);_0x1e77fa['redirect'](_0x555992);}catch(_0x57ba62){Logger[_0x3ef4dc(0x16e)](_0x3ef4dc(0x11b)+_0x57ba62+'\x0a'+_0x57ba62?.[_0x3ef4dc(0x15d)]),_0x1e77fa[_0x3ef4dc(0xa7)](0x1f4)[_0x3ef4dc(0x1fa)](_0x3c742e['DRYOF']);}}),_0x13c73f[_0x2a1c71(0x178)](_0x2a1c71(0x214),(_0x59842b,_0x5dbe7c,_0x422148)=>{const _0x5e53f2=_0x2a1c71,_0x36e190={'aNNRT':function(_0xa2b96f,_0x9444e3,_0x45603c){const _0x4c941f=_0x58bb;return _0x3c742e[_0x4c941f(0xb1)](_0xa2b96f,_0x9444e3,_0x45603c);},'IbYNu':function(_0x4341b0,_0x325502){return _0x4341b0!==_0x325502;},'RhSUc':function(_0xa47fcc,_0x26c820){return _0xa47fcc+_0x26c820;},'GWqDX':function(_0x5cc7b7,_0x3b7158){return _0x5cc7b7+_0x3b7158;},'OETJM':function(_0x557f3c,_0x111e00){return _0x3c742e['sPfCZ'](_0x557f3c,_0x111e00);},'fShTq':function(_0x16db6b,_0x3335bc){return _0x16db6b!==_0x3335bc;},'VuIkB':_0x3c742e[_0x5e53f2(0x22d)],'NHfex':function(_0x18686b,_0x329700){return _0x18686b===_0x329700;},'ZDeYu':_0x3c742e[_0x5e53f2(0xa1)],'DjSIk':_0x5e53f2(0x12c)},_0x2d2995=passport[_0x5e53f2(0xf2)](_0x5e53f2(0x1b7)),_0x157a66=_0x2d2995[_0x5e53f2(0x179)];if(!_0x59842b[_0x5e53f2(0x210)][_0x157a66])return _0x5dbe7c[_0x5e53f2(0xa7)](0x190)[_0x5e53f2(0x1fa)](_0x3c742e['TXvxL']);_0x59842b[_0x5e53f2(0x1d9)]['code_verifier']&&(_0x59842b[_0x5e53f2(0x210)][_0x157a66][_0x5e53f2(0x182)]=_0x59842b[_0x5e53f2(0x1d9)]['code_verifier']);function _0x59a7b1(_0x19b3ad,_0x55f663,_0x5da087,_0x27e2e2,_0x5a3d1e){const _0x1bc81b=_0x5e53f2;Logger[_0x1bc81b(0x16e)](JSON['stringify'](_0x27e2e2,null,0x2));if(_0x5a3d1e){if(_0x36e190['IbYNu'](_0x1bc81b(0xb9),_0x1bc81b(0x174))){const _0x4be92b=_0x5a3d1e[_0x1bc81b(0xda)]?.[_0x1bc81b(0xa3)][_0x1bc81b(0x1ca)](/Authorization: [^\r\n]*/i,_0x1bc81b(0x157));Logger[_0x1bc81b(0xad)](_0x36e190[_0x1bc81b(0x1bf)](_0x36e190[_0x1bc81b(0x14f)](_0x4be92b,'\x0a'),JSON[_0x1bc81b(0x1a2)](_0x5a3d1e['body'],null,0x2)));}else{this['logFailedLocalAuthLoginAttempt'](_0x25168c,_0x5d2307[_0x1bc81b(0x1ee)],_0x1bc81b(0x1e2)),_0x36e190[_0x1bc81b(0xd6)](_0x8249ca,null,null);return;}}return _0x19b3ad?_0x5dbe7c[_0x1bc81b(0xa7)](_0x55f663)[_0x1bc81b(0x1fa)](_0x5da087):_0x5dbe7c[_0x1bc81b(0x13b)](_0x1bc81b(0x186)+_0x36e190[_0x1bc81b(0x17b)](encodeURIComponent,_0x5da087)+'&autoLaunch=0');}function _0x1fce14(_0x4bea4d,_0x428779,_0x3b8557){const _0x3acc38=_0x5e53f2,_0x3e0711={'VWNUb':_0x3acc38(0x229),'EhEne':function(_0x4033b3,_0xa86324){const _0x2b7214=_0x3acc38;return _0x3c742e[_0x2b7214(0x106)](_0x4033b3,_0xa86324);},'lsOIy':function(_0x39fa52,_0x45bcf8){const _0x1b3861=_0x3acc38;return _0x3c742e[_0x1b3861(0x147)](_0x39fa52,_0x45bcf8);},'WKoEW':function(_0x2e41a6){const _0x4efb72=_0x3acc38;return _0x3c742e[_0x4efb72(0xdf)](_0x2e41a6);}};return(_0x1a420d,_0x546594,_0x4df641)=>{const _0x4c6dae=_0x3acc38;if(_0x36e190[_0x4c6dae(0x20a)](_0x4c6dae(0x101),_0x36e190[_0x4c6dae(0xdc)])){const _0xe0567=_0x36e190['NHfex'](_0x4bea4d[_0x4c6dae(0x210)][_0x157a66]?.['mobile'],!![]);if(_0x1a420d)return _0x59a7b1(_0xe0567,0x1f4,_0x36e190[_0x4c6dae(0xe9)],_0x4c6dae(0x204)+_0x1a420d,_0x1a420d?.[_0x4c6dae(0x180)]);if(!_0x546594)return _0x59a7b1(_0xe0567,0x191,_0x36e190[_0x4c6dae(0x150)],_0x4c6dae(0x1fc)+_0x4df641,_0x4df641?.['response']);_0x4bea4d[_0x4c6dae(0xc7)](_0x546594,_0x5e8cb1=>{const _0x26af05=_0x4c6dae;if(_0x5e8cb1)return _0x59a7b1(_0xe0567,0x1f4,_0x26af05(0x122),'[Auth]\x20Error\x20in\x20openid\x20callback:\x20'+_0x5e8cb1);_0x428779[_0x26af05(0x1eb)](_0x3e0711[_0x26af05(0x206)],_0x546594[_0x26af05(0x229)],{'maxAge':_0x3e0711[_0x26af05(0x1d7)](_0x3e0711[_0x26af05(0x130)](_0x3e0711[_0x26af05(0x130)](0x3e8,0x3c)*0x3c,0x18),0x16d)*0xa,'httpOnly':!![],'secure':!![],'sameSite':_0x26af05(0x169)}),_0x3e0711[_0x26af05(0x1f8)](_0x3b8557);});}else _0x540f2e();};}return passport['authenticate'](_0x5e53f2(0x1b7),{'redirect_uri':_0x59842b[_0x5e53f2(0x210)][_0x157a66]['sso_redirect_uri']},_0x3c742e[_0x5e53f2(0x146)](_0x1fce14,_0x59842b,_0x5dbe7c,_0x422148))(_0x59842b,_0x5dbe7c,_0x422148);},this[_0x2a1c71(0x1e5)]['bind'](this)),_0x13c73f[_0x2a1c71(0x178)](_0x2a1c71(0x18d),this['isAuthenticated'],async(_0x2faa62,_0x453e7e)=>{const _0x2c0fde=_0x2a1c71,_0x464002={'eJHJe':'ujgHK'};if(!_0x2faa62[_0x2c0fde(0xba)]['isAdminOrUp'])return Logger[_0x2c0fde(0x16e)](_0x2c0fde(0x1e7)+_0x2faa62[_0x2c0fde(0xba)][_0x2c0fde(0x1ee)]+_0x2c0fde(0x14c)),_0x453e7e[_0x2c0fde(0x217)](0x193);if(!_0x2faa62[_0x2c0fde(0x1d9)][_0x2c0fde(0xc1)])return _0x453e7e['status'](0x190)[_0x2c0fde(0x1fa)](_0x2c0fde(0xdb));let _0x13c479=_0x2faa62[_0x2c0fde(0x1d9)]['issuer'];if(_0x13c479[_0x2c0fde(0x209)]('/'))_0x13c479=_0x13c479[_0x2c0fde(0x12d)](0x0,-0x1);let _0x10525b=null;try{_0x10525b=new URL(_0x13c479+'/.well-known/openid-configuration');if(!_0x10525b[_0x2c0fde(0xeb)][_0x2c0fde(0x209)](_0x2c0fde(0xf1)))throw new Error(_0x2c0fde(0x176));}catch(_0x326c19){return Logger[_0x2c0fde(0x16e)]('[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration.\x20Invalid\x20URL\x20\x22'+_0x10525b+'\x22',_0x326c19),_0x453e7e[_0x2c0fde(0xa7)](0x190)['send'](_0x2c0fde(0x165));}axios['get'](_0x10525b[_0x2c0fde(0x18b)]())['then'](({data:_0x1c0f39})=>{const _0x53ea54=_0x2c0fde;if(_0x53ea54(0xd8)===_0x464002['eJHJe']){if(_0x3974e1!=='admin')throw new _0x28f13f('Root\x20user\x20\x22'+_0x5a8ea4[_0x53ea54(0x1ee)]+_0x53ea54(0x1a1)+_0x423100+_0x53ea54(0xc5));else return;}else _0x453e7e['json']({'issuer':_0x1c0f39[_0x53ea54(0xc1)],'authorization_endpoint':_0x1c0f39[_0x53ea54(0xf4)],'token_endpoint':_0x1c0f39[_0x53ea54(0x9e)],'userinfo_endpoint':_0x1c0f39[_0x53ea54(0x1b3)],'end_session_endpoint':_0x1c0f39[_0x53ea54(0x163)],'jwks_uri':_0x1c0f39[_0x53ea54(0xbb)],'id_token_signing_alg_values_supported':_0x1c0f39[_0x53ea54(0x132)]});})[_0x2c0fde(0x20f)](_0x22341d=>{const _0x88278e=_0x2c0fde;Logger[_0x88278e(0x16e)](_0x88278e(0x94)+_0x10525b+'\x22',_0x22341d),_0x453e7e[_0x88278e(0xa7)](_0x22341d[_0x88278e(0xcf)]||0x190)[_0x88278e(0x1fa)]((_0x22341d[_0x88278e(0x1e6)]||_0x88278e(0x1e9))+_0x88278e(0x22a));});}),_0x13c73f[_0x2a1c71(0x109)](_0x3c742e[_0x2a1c71(0x1a3)],(_0x2bbdba,_0x47bc89)=>{const _0x2cc14d=_0x2a1c71,_0x965212={'KNzIO':'User\x20not\x20found'};if(_0x3c742e['xquha'](_0x2cc14d(0x219),'XnMyh')){_0x36462f?this['logFailedLocalAuthLoginAttempt'](_0x11b74a,_0x46993e[_0x2cc14d(0x1ee)],'User\x20is\x20not\x20active'):this[_0x2cc14d(0x1c2)](_0x2d1a8a,_0x507e43,_0x965212['KNzIO']);_0xf2d767(null,null);return;}else _0x2bbdba[_0x2cc14d(0x164)](_0x568515=>{const _0x1aa8ec=_0x2cc14d,_0x494ece={'AbysY':_0x1aa8ec(0xfa)};if(_0x3c742e['VTtqE'](_0x3c742e['Mqmss'],_0x3c742e[_0x1aa8ec(0xa4)]))throw new _0x1d78ca(_0x1aa8ec(0x14a));else{if(_0x568515){if(_0x3c742e[_0x1aa8ec(0x11c)]('aPZZQ',_0x3c742e['PWqVK']))_0x47bc89['sendStatus'](0x1f4);else return _0x38f635[_0x1aa8ec(0x11e)]({'error':_0x494ece[_0x1aa8ec(0x161)]});}else{const _0xbd9e8c=_0x2bbdba[_0x1aa8ec(0x1fd)][_0x1aa8ec(0x12f)];_0x47bc89[_0x1aa8ec(0xb0)](_0x3c742e['DvoAs']);let _0x24e645=null;if(_0xbd9e8c===_0x1aa8ec(0x1ad)||_0x3c742e['VTtqE'](_0xbd9e8c,_0x3c742e[_0x1aa8ec(0x188)])){if('GGuwT'===_0x1aa8ec(0x10d))_0x1a05e3[_0x1aa8ec(0x11e)](_0x29a680);else{const _0x3212d1=passport[_0x1aa8ec(0xf2)](_0x1aa8ec(0x1b7)),_0x36c734=_0x3212d1[_0x1aa8ec(0x227)];if(_0x36c734[_0x1aa8ec(0xc1)]['end_session_endpoint']&&_0x36c734[_0x1aa8ec(0xc1)][_0x1aa8ec(0x163)]['length']>0x0){if(_0x3c742e[_0x1aa8ec(0x99)](_0x3c742e[_0x1aa8ec(0x1c5)],_0x3c742e[_0x1aa8ec(0x1c5)])){let _0x53d725=null;if(_0xbd9e8c==='openid'){const _0x555bb8=_0x2bbdba[_0x1aa8ec(0x9d)]||_0x3c742e['xquha'](_0x2bbdba[_0x1aa8ec(0x178)](_0x1aa8ec(0x18e)),_0x3c742e[_0x1aa8ec(0x166)])?_0x3c742e[_0x1aa8ec(0x166)]:_0x3c742e['aGiev'],_0x1c22d4=_0x2bbdba['get'](_0x3c742e[_0x1aa8ec(0x1f7)]);_0x53d725=_0x555bb8+'://'+_0x1c22d4+global['RouterBasePath']+'/login';}_0x24e645=_0x36c734[_0x1aa8ec(0xc8)]({'id_token_hint':_0x2bbdba[_0x1aa8ec(0x1fd)]['openid_id_token'],'post_logout_redirect_uri':_0x53d725});}else return _0x2952c3[_0x1aa8ec(0xa7)](0x190)['send']({'message':_0x1aa8ec(0xea)});}_0x47bc89[_0x1aa8ec(0xb0)](_0x1aa8ec(0x229));}}_0x47bc89[_0x1aa8ec(0x1fa)]({'redirect_url':_0x24e645});}}});});}[_0xe68a7a(0x1d6)](_0x142313,_0x45d16a,_0x150a6f){const _0x4beb77=_0xe68a7a,_0x3d862c={'RcaJa':'jwt'};_0x142313[_0x4beb77(0x1d6)]()?_0x150a6f():passport[_0x4beb77(0x1ed)](_0x3d862c[_0x4beb77(0x14b)])(_0x142313,_0x45d16a,_0x150a6f);}[_0xe68a7a(0x223)](_0x45fb97){const _0x4ac6e8=_0xe68a7a;return jwt['sign']({'userId':_0x45fb97['id'],'username':_0x45fb97['username']},global['ServerSettings'][_0x4ac6e8(0xcd)]);}static['validateAccessToken'](_0x2a0890){const _0x5c6c94=_0xe68a7a,_0x5d6f0a={'fvOep':'User\x20not\x20found','pfFrO':function(_0x368c65,_0x1a9684){return _0x368c65===_0x1a9684;},'OlvdN':_0x5c6c94(0x1db),'BQfEV':'MTbij'};try{if(_0x5d6f0a[_0x5c6c94(0x1d0)](_0x5d6f0a[_0x5c6c94(0x10b)],_0x5d6f0a[_0x5c6c94(0x1ba)]))this[_0x5c6c94(0x1c2)](_0x1b26e0,_0x7343ae,_0x5d6f0a[_0x5c6c94(0xbe)]);else return jwt[_0x5c6c94(0xd3)](_0x2a0890,global[_0x5c6c94(0x103)][_0x5c6c94(0xcd)]);}catch(_0x36df8d){return null;}}async[_0xe68a7a(0x124)](){const _0x2f807d=_0xe68a7a,_0x3675bf={'DsHce':_0x2f807d(0x1e2),'RDwha':function(_0x1e6e3c,_0x3f734a,_0x208aa4){return _0x1e6e3c(_0x3f734a,_0x208aa4);},'MVgRv':function(_0x4d0659,_0x59017d){return _0x4d0659(_0x59017d);}};process[_0x2f807d(0x218)][_0x2f807d(0x22e)]?Database[_0x2f807d(0x213)]['tokenSecret']=process[_0x2f807d(0x218)][_0x2f807d(0x22e)]:Database[_0x2f807d(0x213)][_0x2f807d(0xcd)]=_0x3675bf['MVgRv'](require,'crypto')['randomBytes'](0x100)[_0x2f807d(0x18b)](_0x2f807d(0x17a));await Database[_0x2f807d(0x215)]();const _0x42c803=await Database[_0x2f807d(0x1e1)]['findAll']({'attributes':['id',_0x2f807d(0x1ee),_0x2f807d(0xe5)]});if(_0x42c803[_0x2f807d(0x136)])for(const _0x36c084 of _0x42c803){if(_0x2f807d(0x198)===_0x2f807d(0x134)){if(_0x5d6131){this['logFailedLocalAuthLoginAttempt'](_0xb00fa8,_0x3d19c6[_0x2f807d(0x1ee)],_0x3675bf[_0x2f807d(0x1fe)]),_0x3675bf[_0x2f807d(0xae)](_0xc15d03,null,null);return;}_0x455e00[_0x2f807d(0x1a6)](_0x2f807d(0x1f2)+_0x130488['username']+'\x22\x20logged\x20in\x20from\x20ip\x20'+_0x3f0d3a[_0x2f807d(0xf8)](_0x5e228c)),_0x5c38da(null,_0x311e04);return;}else _0x36c084[_0x2f807d(0xe5)]=await this[_0x2f807d(0x223)](_0x36c084),await _0x36c084['save']({'hooks':![]});}}async[_0xe68a7a(0x12a)](_0x93425c,_0x3453db){const _0x588d2d=_0xe68a7a,_0x875b0e={'OWMxP':function(_0x5ade5c,_0x4a9162,_0x2f5626){return _0x5ade5c(_0x4a9162,_0x2f5626);}},_0x1f9bce=await Database[_0x588d2d(0x1e1)][_0x588d2d(0x14d)](_0x93425c['userId']);if(!_0x1f9bce?.[_0x588d2d(0x228)]){_0x875b0e[_0x588d2d(0x181)](_0x3453db,null,null);return;}_0x3453db(null,_0x1f9bce);return;}async[_0xe68a7a(0x1cf)](_0x4de4ba,_0x2de00d,_0x4fa727,_0x3168ab){const _0x458f83=_0xe68a7a,_0x59e602={'olxoL':_0x458f83(0x216),'vwrUq':function(_0x56f4b7,_0x1a7110,_0x98f926){return _0x56f4b7(_0x1a7110,_0x98f926);},'ECUBh':_0x458f83(0x107),'aPxDR':function(_0xab7e17,_0x4fba86,_0xb04178){return _0xab7e17(_0x4fba86,_0xb04178);},'QaBEc':_0x458f83(0xf3),'ZeFpU':function(_0x49968e,_0x553a2f,_0x14fcfd){return _0x49968e(_0x553a2f,_0x14fcfd);},'lbEFZ':_0x458f83(0x1ac),'ZkIXQ':function(_0x4356f7,_0x59c4bc,_0x4406e1){return _0x4356f7(_0x59c4bc,_0x4406e1);}},_0x57c192=await Database[_0x458f83(0x1e1)][_0x458f83(0x13a)](_0x2de00d[_0x458f83(0x224)]());if(!_0x57c192?.[_0x458f83(0x228)]){_0x57c192?this[_0x458f83(0x1c2)](_0x4de4ba,_0x57c192[_0x458f83(0x1ee)],_0x59e602[_0x458f83(0x17f)]):this[_0x458f83(0x1c2)](_0x4de4ba,_0x2de00d,_0x458f83(0x1dc));_0x59e602[_0x458f83(0x153)](_0x3168ab,null,null);return;}if(_0x57c192[_0x458f83(0xfd)]==='root'&&!_0x57c192[_0x458f83(0x160)]){if(_0x4fa727){this[_0x458f83(0x1c2)](_0x4de4ba,_0x57c192['username'],_0x458f83(0x1e2)),_0x3168ab(null,null);return;}Logger[_0x458f83(0x1a6)](_0x458f83(0x1f2)+_0x57c192[_0x458f83(0x1ee)]+'\x22\x20logged\x20in\x20from\x20ip\x20'+requestIp[_0x458f83(0xf8)](_0x4de4ba)),_0x3168ab(null,_0x57c192);return;}else{if(!_0x57c192['pash']){this[_0x458f83(0x1c2)](_0x4de4ba,_0x57c192[_0x458f83(0x1ee)],_0x59e602[_0x458f83(0x1f5)]),_0x59e602['aPxDR'](_0x3168ab,null,null);return;}}const _0x2631fe=await bcrypt[_0x458f83(0x12e)](_0x4fa727,_0x57c192[_0x458f83(0x160)]);if(_0x2631fe){if(_0x458f83(0x11f)===_0x59e602[_0x458f83(0x142)])this[_0x458f83(0x21d)]();else{Logger[_0x458f83(0x1a6)](_0x458f83(0x1f2)+_0x57c192['username']+_0x458f83(0x17d)+requestIp[_0x458f83(0xf8)](_0x4de4ba)),_0x59e602['ZeFpU'](_0x3168ab,null,_0x57c192);return;}}this[_0x458f83(0x1c2)](_0x4de4ba,_0x57c192[_0x458f83(0x1ee)],_0x59e602['lbEFZ']),_0x59e602['ZkIXQ'](_0x3168ab,null,null);return;}[_0xe68a7a(0x1c2)](_0x40c928,_0x146d7b,_0x5503b7){const _0x120b22=_0xe68a7a,_0x367f4e={'mbczO':function(_0x890dd9,_0x5d9560){return _0x890dd9||_0x5d9560;}};if(_0x367f4e[_0x120b22(0x95)](!_0x40c928,!_0x146d7b)||!_0x5503b7)return;Logger['error']('[Auth]\x20Failed\x20login\x20attempt\x20for\x20username\x20\x22'+_0x146d7b+_0x120b22(0x21f)+requestIp[_0x120b22(0xf8)](_0x40c928)+'\x20('+_0x5503b7+')');}[_0xe68a7a(0xd2)](_0x3f9328){return new Promise(_0x5462c3=>{const _0x46a1a3=_0x58bb,_0x20585c={'ejChL':function(_0x1b8ff5,_0x59754b){return _0x1b8ff5(_0x59754b);}};bcrypt[_0x46a1a3(0x9f)](_0x3f9328,0x8,(_0x15c81f,_0x5e1c5c)=>{const _0x228feb=_0x46a1a3;_0x15c81f?_0x20585c[_0x228feb(0x1a7)](_0x5462c3,null):_0x20585c[_0x228feb(0x1a7)](_0x5462c3,_0x5e1c5c);});});}async[_0xe68a7a(0x208)](_0x546836){const _0x5281f0=_0xe68a7a,_0x1b6b86=await Database[_0x5281f0(0x1e0)]['getAllLibraryIds']();return{'user':_0x546836[_0x5281f0(0x199)](),'userDefaultLibraryId':_0x546836[_0x5281f0(0x143)](_0x1b6b86),'serverSettings':Database[_0x5281f0(0x213)]['toJSONForBrowser'](),'ereaderDevices':Database['emailSettings'][_0x5281f0(0x115)](_0x546836),'Source':global[_0x5281f0(0x111)]};}[_0xe68a7a(0x158)](_0x3881a9,_0x361895){const _0x27e2b8=_0xe68a7a,_0x904c91={'yNvTP':'root'};if(_0x361895[_0x27e2b8(0xfd)]===_0x904c91[_0x27e2b8(0x21a)]&&!_0x3881a9&&!_0x361895[_0x27e2b8(0x160)])return!![];if(!_0x3881a9||!_0x361895[_0x27e2b8(0x160)])return![];return bcrypt[_0x27e2b8(0x12e)](_0x3881a9,_0x361895[_0x27e2b8(0x160)]);}async['userChangePassword'](_0x1fcfe9,_0x105f7d){const _0x177ece=_0xe68a7a,_0x1eb717={'GdgrX':function(_0x3bee14,_0x27a22b){return _0x3bee14||_0x27a22b;},'DwqHs':_0x177ece(0x234),'TbTtT':'rTjNh'};let {password:_0x3841d1,newPassword:_0x14f92a}=_0x1fcfe9['body'];_0x14f92a=_0x1eb717[_0x177ece(0x15e)](_0x14f92a,'');const _0x24f2bb=_0x1fcfe9['user'];if(_0x24f2bb['type']!==_0x177ece(0x175)&&!_0x14f92a)return _0x105f7d[_0x177ece(0x11e)]({'error':_0x1eb717['DwqHs']});const _0x2c906d=await this[_0x177ece(0x158)](_0x3841d1,_0x24f2bb);if(!_0x2c906d)return _0x105f7d[_0x177ece(0x11e)]({'error':'Invalid\x20password'});let _0x45e681='';if(_0x14f92a){if(_0x177ece(0x93)!==_0x1eb717[_0x177ece(0x144)]){_0x45e681=await this[_0x177ece(0xd2)](_0x14f92a);if(!_0x45e681)return _0x105f7d[_0x177ece(0x11e)]({'error':_0x177ece(0xfa)});}else this[_0x177ece(0x21d)]();}try{await _0x24f2bb[_0x177ece(0x20e)]({'pash':_0x45e681}),Logger[_0x177ece(0x1a6)](_0x177ece(0x1f2)+_0x24f2bb[_0x177ece(0x1ee)]+_0x177ece(0x10f)),_0x105f7d[_0x177ece(0x11e)]({'success':!![]});}catch(_0x4843d2){Logger['error'](_0x177ece(0x1f2)+_0x24f2bb['username']+'\x22\x20failed\x20to\x20change\x20password',_0x4843d2),_0x105f7d[_0x177ece(0x11e)]({'error':_0x177ece(0x16a)});}}}module[_0xe68a7a(0xb6)]=Auth;