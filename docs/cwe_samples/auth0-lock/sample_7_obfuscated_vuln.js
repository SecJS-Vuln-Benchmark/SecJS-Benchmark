const _0x119b43=_0x2784;(function(_0x33662d,_0x1f4da0){const _0x559e3d=_0x2784,_0x2eb873=_0x33662d();while(!![]){try{const _0x3ec945=-parseInt(_0x559e3d(0x233))/0x1+-parseInt(_0x559e3d(0x340))/0x2*(-parseInt(_0x559e3d(0x1d3))/0x3)+parseInt(_0x559e3d(0x207))/0x4+-parseInt(_0x559e3d(0x19b))/0x5+parseInt(_0x559e3d(0x242))/0x6+-parseInt(_0x559e3d(0x240))/0x7*(-parseInt(_0x559e3d(0x1f5))/0x8)+-parseInt(_0x559e3d(0x26f))/0x9;if(_0x3ec945===_0x1f4da0)break;else _0x2eb873['push'](_0x2eb873['shift']());}catch(_0x5b3cfe){_0x2eb873['push'](_0x2eb873['shift']());}}}(_0x4420,0x905b5));function _0x4420(){const _0x1ca82e=['ufMvK','/login','authOpenIDGroupClaim','[Auth]\x20openid:\x20Auto-registering\x20user\x20with\x20sub\x20\x22','emailSettings','local','error','openid-client','openid-mobile','status','code','validateAccessToken','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20email\x20\x22','\x22\x20is\x20not\x20verified','slice','yrLrf','IhzDC','LZniO','Invalid\x20pathname','callback','rMMgM','[Auth]\x20Error\x20in\x20openid\x20callback\x20-\x20','nqIRp','secure','\x20not\x20found\x20or\x20empty\x20in\x20userinfo','admin','openid','authenticate','/auth/openid','changed','776430ZuTmUQ','getUserByEmail','isAuthenticated','/login?error=','save','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.username\x20\x22','lFIrx','split','lyPQO','2855040BZRnoR','FDPOY','username','/auth/openid/mobile-redirect','avKVh','passport-jwt','stringify','[Auth]\x20Failed\x20login\x20attempt\x20for\x20username\x20\x22','authOpenIDClientSecret','Root\x20user\x20has\x20no\x20password\x20set','RBYNy','lxjsC','axios','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20no\x20email\x20in\x20userinfo','myKaQ','NXktN','redirect_uri','JPMEg','getEReaderDevices','jwtAuthCheck','ExtractJwt','setHttpOptionsDefaults','LeKIE','MAmaE','BbGEv','https','qNkvI','Invalid\x20response_type,\x20only\x20code\x20supported','pJpJV','randomBytes','token','authOpenIDAdvancedPermsClaim','OYKAI','fromExtractors','_strategy','Invalid\x20new\x20password\x20-\x20Only\x20root\x20can\x20have\x20an\x20empty\x20password','KYHjY','isActive','UNKNOWN','cjBdR','codeChallenge','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20required','Internal\x20Server\x20Error','[Auth]\x20openid\x20callback\x20userinfo=','yTmSU','nZtiw','XUvNN','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20email\x20\x22','updateServerSettings','[Auth]\x20No\x20data\x20in\x20openid\x20callback\x20-\x20','FpNpM','serverSettings','[Auth]\x20Error\x20in\x20/auth/openid/mobile-redirect\x20route:\x20','PIYOj','Authorization:\x20REDACTED','No\x20callback\x20or\x20already\x20expired','3KzIQgM','initAuthStrategyPassword','getUserByOpenIDSub','[Auth]\x20Error\x20in\x20/auth/openid\x20route:\x20','&autoLaunch=0','info','\x22\x20changed\x20password','stack','Issuer','sHoFL','?setToken=','\x22\x20from\x20\x22','auth_state','JtHfV','initTokenSecret','rroQB','endsWith','host','QBUHM','LYova','[Auth]\x20OIDC\x20Invalid\x20response_type=','ROtii','authOpenIDSub','message','cgPVZ','toOldJSONForBrowser','PBFrZ','sendStatus','IpwRs','initPassportJs','userinfo_endpoint','ElWJP','lswaM','toLowerCase','844624uusaVK','getUserById','UrlUE','GET','authOpenIDSubfolderForRedirectURLs','updatePermissionsFromExternalJSON','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20auto-register\x20is\x20disabled','KFwEb','get','NClJG','xwWhW','ykPxK','\x22\x20failed\x20to\x20change\x20password','KKUMx','XKAZe','&state=','use','generateAccessToken','4535720HoREGM','post','handleLoginSuccessBasedOnCookie','authOpenIDIssuerURL','authOpenIDMatchExistingBy','warn','No\x20valid\x20group\x20found\x20in\x20userinfo:\x20','comparePassword','email','yZeVG','[Auth]\x20Invalid\x20state\x20-\x20not\x20allowed\x20on\x20web\x20openid\x20flow','uBwhd','passport','aTCyx','JvDhG','hlhUb','VgMJk','Group\x20claim\x20','TwbTL','lgewb','authOpenIDTokenSigningAlgorithm','User\x20is\x20not\x20active','Ardpb','Error\x20during\x20login','/logout','openid\x20profile\x20email','NAvag','_params','authOpenIDMobileRedirectURIs','yhMWR','User\x20has\x20no\x20password\x20set.\x20Might\x20have\x20been\x20created\x20with\x20OpenID','uPNlg','FoMJM','code_challenge','libraryModel','token_endpoint','auth_method','statusCode','SKkZL','rKgTZ','unuse','authOpenIDJwksURL','User\x20not\x20active\x20or\x20not\x20found','[Auth]\x20Error\x20in\x20openid\x20callback:\x20','640223AeaKnn','fromUrlQueryParameter','hizNl','localAuthCheckUserPw','GdQgS','./libs/jsonwebtoken','/.well-known/openid-configuration','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20neither\x20preferred_username\x20nor\x20username\x20in\x20userinfo','dWMjx','QAYWw','zkMSD','jwks_uri','[Auth]\x20openid\x20callback:\x20Updating\x20advanced\x20perms\x20for\x20user\x20\x22','7UEkwxK','map','1768980ZnqewA','ufHdY','qAthM','api','req','openid_id_token','User\x20not\x20found','userModel','GltoV','[Auth]\x20No\x20redirect\x20URI','VcJlt','NhIIv','NNifZ','hashPass','./libs/passportLocal','updateUserPermissions','response','delete','update','state','paramsToCookies','[Auth]\x20Cannot\x20init\x20openid\x20auth\x20strategy\x20-\x20invalid\x20settings','find','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.preferred_username\x20\x22','uBQKa','bMjgd','test','session','[Auth]\x20openid:\x20User\x20found\x20by\x20sub','findAll','custom','JqCUR','gtdzz','ignorePatterns','dQsVE','No\x20callback\x20parameter','debug','verify','hNzWl','sub','method','json','jwt','xaTpO','initAuthStrategyOpenID','1080333OYOItw','\x22\x20cannot\x20be\x20downgraded\x20to\x20','issuer','then','gpQJN','authorizationUrl','Unknown\x20error','TJinu','DfPXO','root','imkKv','TOKEN_SECRET','authOpenIDTokenURL','getClientIp','_key','auth_cb','cookies','crypto','S256','wkVyB','pqMSj','\x22\x20logged\x20in\x20from\x20ip\x20','MTwds','getUserLoginResponsePayload','uSImY','Unauthorized','No\x20session','endSessionUrl','lkwUb','PfOYJ','Root\x20user\x20\x22','[Auth]\x20openid\x20callback:\x20Updating\x20user\x20\x22','isAuthMethodAPIBased','BNWXP','compare','vbfPA','_client','./libs/requestIp','IiErr','QHvqW','logFailedLocalAuthLoginAttempt','icxjB','authOpenIDLogoutURL','\x22\x20type\x20to\x20\x22','authorization_endpoint','?code=','UsYZA','QxDVj','DduaZ','send','MxLZr','code_challenge\x20required\x20for\x20mobile\x20flow\x20(PKCE)','RrdxZ','IUZWR','2|0|5|3|1|6|4','oGKfZ','validateGroupClaim','\x22\x20but\x20is\x20already\x20matched\x20with\x20sub\x20\x22','cTgQQ','NLznC','random','mobile_redirect_uri','/auth/openid/callback','code_challenge_method','isOpenIDAuthSettingsValid','redirect','email_verified','.\x20Denying\x20login.','nlvRT','GysOc','end_session_endpoint','Only\x20S256\x20code_challenge_method\x20method\x20supported','MJTjg','lSgbN','http','QWFoV','serializeUser','ZXIoQ','ServerSettings','veNBo','cookie','Strict','codeVerifier','[Auth]\x20Invalid\x20redirect_uri=','unuseAuthStrategy','tokenSecret','Kyycx','env','extraData','mobile','TqqPZ','getUserByUsername','[Auth]\x20User\x20\x22','SzWyT','\x22\x20from\x20ip\x20','\x22\x20using\x20\x22','body','generators','://','aaoZO','x-forwarded-proto','Invalid\x20password','query','SQeSe','BWPqW','pRCtV','length','FLllj','\x20not\x20found\x20in\x20userinfo','iOtHa','express','response_type','clearCookie','[Auth]\x20openid:\x20User\x20found\x20but\x20is\x20not\x20active','Invalid\x20userinfo,\x20no\x20sub','parse','NTTUL','RouterBasePath','No\x20redirect\x20URI','sso_redirect_uri','cwexK','GRrhs','./Database','WISyk','gzHUu','logIn','[Auth]\x20OIDC\x20redirect_uri=','hash','[Auth]\x20openid:\x20User\x20found\x20with\x20email\x20\x22',':\x20Failed\x20to\x20get\x20openid\x20configuration','bind','xpcXw','nextTick','authNotNeeded','State\x20parameter\x20mismatch','Yxlht','useAuthStrategy','getAllLibraryIds','setUserGroup','some','./libs/bcryptjs','hZLdl','openIdAuthSession','preferred_username','VzuAe','sDBWH','[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration\x20at\x20\x22','findOrCreateUser','type','DKDYS','abHZI','Invalid\x20redirect_uri','catch','[Auth]\x20Non-admin\x20user\x20\x22','code_verifier','EFgUm','xHmso','doTUW','authActiveAuthMethods','ESqng','uumSi','fromAuthHeaderAsBearerToken','jSKHq','kYKrp','zKWYU','xWEqK','includes','base64','EDjJp','user','fHbDV','sign','toString','pash','./Logger','suTvE','has','[Auth]\x20/auth/openid/mobile-redirect\x20route:\x20State\x20parameter\x20mismatch','createUserFromOpenIdUserInfo'];_0x4420=function(){return _0x1ca82e;};return _0x4420();}function _0x2784(_0x52c3c5,_0x23ce43){const _0x4420ef=_0x4420();return _0x2784=function(_0x27844c,_0x3ed614){_0x27844c=_0x27844c-0x19b;let _0xcb489a=_0x4420ef[_0x27844c];return _0xcb489a;},_0x2784(_0x52c3c5,_0x23ce43);}const axios=require(_0x119b43(0x1a7)),passport=require(_0x119b43(0x213)),{Request,Response,NextFunction}=require(_0x119b43(0x2dd)),bcrypt=require(_0x119b43(0x2fb)),jwt=require(_0x119b43(0x238)),requestIp=require(_0x119b43(0x294)),LocalStrategy=require(_0x119b43(0x250)),JwtStrategy=require('passport-jwt')['Strategy'],ExtractJwt=require(_0x119b43(0x1a0))[_0x119b43(0x1af)],OpenIDClient=require(_0x119b43(0x329)),Database=require(_0x119b43(0x2e9)),Logger=require(_0x119b43(0x31d));class Auth{constructor(){const _0x3215e8=_0x119b43;this[_0x3215e8(0x2fd)]=new Map(),this[_0x3215e8(0x263)]=[/\/api\/items\/[^/]+\/cover/,/\/api\/authors\/[^/]+\/image/];}[_0x119b43(0x2f4)](_0x25bd4b){const _0x2b8ee2=_0x119b43,_0x3a618b={'JtHfV':_0x2b8ee2(0x1f8)};return _0x25bd4b[_0x2b8ee2(0x26a)]===_0x3a618b[_0x2b8ee2(0x1e0)]&&this[_0x2b8ee2(0x263)][_0x2b8ee2(0x2fa)](_0x1a4aa4=>_0x1a4aa4[_0x2b8ee2(0x25c)](_0x25bd4b['originalUrl']));}['ifAuthNeeded'](_0x9c032b){const _0x3917a3={'sDBWH':function(_0x341f49){return _0x341f49();}};return(_0xea84fa,_0x5be870,_0x4a6ca0)=>{const _0xd36048=_0x2784;if(this[_0xd36048(0x2f4)](_0xea84fa))return _0x3917a3[_0xd36048(0x300)](_0x4a6ca0);_0x9c032b(_0xea84fa,_0x5be870,_0x4a6ca0);};}async[_0x119b43(0x1f0)](){const _0x23f12e=_0x119b43,_0x45dab1={'xaTpO':function(_0x425f6b,_0x141826,_0xb6da6a){return _0x425f6b(_0x141826,_0xb6da6a);},'luPCv':_0x23f12e(0x33c),'cjBdR':_0x23f12e(0x1b9)};global[_0x23f12e(0x2bd)][_0x23f12e(0x30d)][_0x23f12e(0x315)](_0x23f12e(0x327))&&this[_0x23f12e(0x1d4)](),global['ServerSettings'][_0x23f12e(0x30d)][_0x23f12e(0x315)](_0x45dab1['luPCv'])&&this['initAuthStrategyOpenID'](),passport[_0x23f12e(0x205)](new JwtStrategy({'jwtFromRequest':ExtractJwt[_0x23f12e(0x1bc)]([ExtractJwt[_0x23f12e(0x310)](),ExtractJwt[_0x23f12e(0x234)](_0x45dab1[_0x23f12e(0x1c2)])]),'secretOrKey':Database['serverSettings']['tokenSecret']},this[_0x23f12e(0x1ae)][_0x23f12e(0x2f1)](this))),passport[_0x23f12e(0x2bb)](function(_0x5647e9,_0x415025){process['nextTick'](function(){const _0x5c0322=_0x2784;return _0x415025(null,JSON[_0x5c0322(0x1a1)]({'id':_0x5647e9['id']}));});}),passport['deserializeUser'](function(_0x4cf4f9,_0x115d69){const _0x3d0d92=_0x23f12e;process[_0x3d0d92(0x2f3)](async function(){const _0x35aee7=_0x3d0d92,_0x438436=JSON[_0x35aee7(0x2e2)](_0x4cf4f9),_0x873fde=await Database[_0x35aee7(0x249)][_0x35aee7(0x1f6)](_0x438436['id']);return _0x45dab1[_0x35aee7(0x26d)](_0x115d69,null,_0x873fde);}['bind'](this));}[_0x23f12e(0x2f1)](this));}[_0x119b43(0x1d4)](){passport['use'](new LocalStrategy({'passReqToCallback':!![]},this['localAuthCheckUserPw']['bind'](this)));}[_0x119b43(0x26e)](){const _0x5dd8c8=_0x119b43,_0x363755={'IUZWR':_0x5dd8c8(0x348),'aaoZO':function(_0x5347e5,_0x412df9,_0x2aca83){return _0x5347e5(_0x412df9,_0x2aca83);},'IhzDC':function(_0x192ff7,_0x16c850,_0x4b7530,_0x120715){return _0x192ff7(_0x16c850,_0x4b7530,_0x120715);},'ESqng':_0x5dd8c8(0x288),'yrLrf':'openid-client'};if(!Database[_0x5dd8c8(0x1ce)][_0x5dd8c8(0x2af)]){Logger[_0x5dd8c8(0x328)](_0x5dd8c8(0x257));return;}OpenIDClient[_0x5dd8c8(0x260)][_0x5dd8c8(0x1b0)]({'timeout':0x2710});const _0x4ddb0f=new OpenIDClient[(_0x5dd8c8(0x1db))]({'issuer':global[_0x5dd8c8(0x2bd)][_0x5dd8c8(0x20a)],'authorization_endpoint':global['ServerSettings']['authOpenIDAuthorizationURL'],'token_endpoint':global['ServerSettings'][_0x5dd8c8(0x27b)],'userinfo_endpoint':global[_0x5dd8c8(0x2bd)]['authOpenIDUserInfoURL'],'jwks_uri':global[_0x5dd8c8(0x2bd)][_0x5dd8c8(0x230)],'end_session_endpoint':global[_0x5dd8c8(0x2bd)][_0x5dd8c8(0x299)]})['Client'],_0x395892=new _0x4ddb0f({'client_id':global[_0x5dd8c8(0x2bd)]['authOpenIDClientID'],'client_secret':global['ServerSettings'][_0x5dd8c8(0x1a3)],'id_token_signed_response_alg':global[_0x5dd8c8(0x2bd)][_0x5dd8c8(0x21b)]});passport[_0x5dd8c8(0x205)](_0x363755[_0x5dd8c8(0x331)],new OpenIDClient['Strategy']({'client':_0x395892,'params':{'redirect_uri':global['ServerSettings'][_0x5dd8c8(0x1f9)]+_0x5dd8c8(0x2ad),'scope':_0x5dd8c8(0x220)}},async(_0xf11882,_0x1a2db9,_0x30b661)=>{const _0x5b27e1=_0x5dd8c8;try{if(_0x5b27e1(0x348)===_0x363755[_0x5b27e1(0x2a4)]){Logger['debug'](_0x5b27e1(0x1c6),JSON[_0x5b27e1(0x1a1)](_0x1a2db9,null,0x2));if(!_0x1a2db9[_0x5b27e1(0x269)])throw new Error(_0x5b27e1(0x2e1));if(!this[_0x5b27e1(0x2a7)](_0x1a2db9))throw new Error(_0x5b27e1(0x218)+Database['serverSettings'][_0x5b27e1(0x324)]+_0x5b27e1(0x33a));let _0xf9fa17=await this[_0x5b27e1(0x302)](_0x1a2db9);if(!_0xf9fa17?.[_0x5b27e1(0x1c0)])throw new Error(_0x5b27e1(0x231));return await this[_0x5b27e1(0x2f9)](_0xf9fa17,_0x1a2db9),await this['updateUserPermissions'](_0xf9fa17,_0x1a2db9),_0xf9fa17[_0x5b27e1(0x247)]=_0xf11882['id_token'],_0x363755[_0x5b27e1(0x2d2)](_0x30b661,null,_0xf9fa17);}else return _0xafc821[_0x5b27e1(0x20c)](_0x5b27e1(0x23a)),null;}catch(_0x51f519){return Logger[_0x5b27e1(0x328)]('[Auth]\x20openid\x20callback\x20error:\x20'+_0x51f519?.[_0x5b27e1(0x1ea)]+'\x0a'+_0x51f519?.[_0x5b27e1(0x1da)]),_0x363755[_0x5b27e1(0x332)](_0x30b661,null,null,_0x363755[_0x5b27e1(0x30e)]);}}));}async[_0x119b43(0x302)](_0x3982e2){const _0x33a4e1=_0x119b43,_0x35b6f1={'LUVVC':_0x33a4e1(0x320),'ZXIoQ':_0x33a4e1(0x2e5),'abHZI':_0x33a4e1(0x1be),'hizNl':_0x33a4e1(0x20f),'LeKIE':function(_0x330f44,_0x3a1f94){return _0x330f44===_0x3a1f94;},'XUvNN':function(_0x47d3ea,_0x3f743f){return _0x47d3ea===_0x3f743f;},'MxLZr':_0x33a4e1(0x1c7),'gtdzz':function(_0x11e70d,_0x35712e){return _0x11e70d!==_0x35712e;},'tbRmB':_0x33a4e1(0x1e5),'MDVFh':_0x33a4e1(0x2c7),'JPMEg':_0x33a4e1(0x2d7)};let _0x4ff205=await Database['userModel'][_0x33a4e1(0x1d5)](_0x3982e2[_0x33a4e1(0x269)]);if(_0x4ff205)return Logger[_0x33a4e1(0x266)](_0x33a4e1(0x25e)),_0x4ff205;if(Database[_0x33a4e1(0x1ce)]['authOpenIDMatchExistingBy']===_0x35b6f1[_0x33a4e1(0x235)]){if(_0x3982e2[_0x33a4e1(0x20f)]){if(_0x35b6f1[_0x33a4e1(0x1b1)](_0x3982e2[_0x33a4e1(0x2b1)],![]))return Logger[_0x33a4e1(0x20c)](_0x33a4e1(0x32e)+_0x3982e2['email']+_0x33a4e1(0x32f)),null;else{Logger[_0x33a4e1(0x1d8)](_0x33a4e1(0x1ca)+_0x3982e2[_0x33a4e1(0x20f)]+'\x22'),_0x4ff205=await Database['userModel'][_0x33a4e1(0x341)](_0x3982e2[_0x33a4e1(0x20f)]);if(_0x4ff205?.[_0x33a4e1(0x1e9)])return Logger[_0x33a4e1(0x20c)](_0x33a4e1(0x2ef)+_0x3982e2['email']+_0x33a4e1(0x2a8)+_0x4ff205['authOpenIDSub']+'\x22'),null;}}else return Logger[_0x33a4e1(0x20c)](_0x33a4e1(0x1a8)),null;}else{if(_0x35b6f1[_0x33a4e1(0x1c9)](Database['serverSettings'][_0x33a4e1(0x20b)],_0x33a4e1(0x19d))){let _0x3fa43c;if(_0x3982e2[_0x33a4e1(0x2fe)])_0x35b6f1[_0x33a4e1(0x2a1)]!=='yTmSU'?(_0x131bf7[_0x33a4e1(0x328)]('[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration\x20at\x20\x22'+_0x10d610+'\x22',_0x168890),_0x5a5883['status'](_0x26aaa4[_0x33a4e1(0x22c)]||0x190)[_0x33a4e1(0x2a0)]((_0x54d4a0['code']||'UNKNOWN')+_0x33a4e1(0x2f0))):(Logger['info'](_0x33a4e1(0x259)+_0x3982e2['preferred_username']+'\x22'),_0x3fa43c=_0x3982e2[_0x33a4e1(0x2fe)]);else{if(_0x3982e2[_0x33a4e1(0x19d)]){if(_0x35b6f1[_0x33a4e1(0x262)](_0x33a4e1(0x23c),_0x33a4e1(0x276)))Logger[_0x33a4e1(0x1d8)](_0x33a4e1(0x345)+_0x3982e2[_0x33a4e1(0x19d)]+'\x22'),_0x3fa43c=_0x3982e2['username'];else{const {state:_0x259ab3,code:_0x5737c5}=_0x50df2a[_0x33a4e1(0x2d5)];if(!_0x259ab3||!this[_0x33a4e1(0x2fd)][_0x33a4e1(0x31f)](_0x259ab3))return _0x343b2f['error'](_0x35b6f1['LUVVC']),_0xf1587d[_0x33a4e1(0x32b)](0x190)[_0x33a4e1(0x2a0)](_0x33a4e1(0x2f5));let _0x3ab63a=this['openIdAuthSession'][_0x33a4e1(0x1fd)](_0x259ab3)[_0x33a4e1(0x2ac)];if(!_0x3ab63a)return _0x22018f[_0x33a4e1(0x328)]('[Auth]\x20No\x20redirect\x20URI'),_0x5a7964[_0x33a4e1(0x32b)](0x190)[_0x33a4e1(0x2a0)](_0x35b6f1[_0x33a4e1(0x2bc)]);this['openIdAuthSession'][_0x33a4e1(0x253)](_0x259ab3);const _0x360476=_0x3ab63a+_0x33a4e1(0x29c)+_0x2dda3b(_0x5737c5)+_0x33a4e1(0x204)+_0x46557f(_0x259ab3);_0x597259['redirect'](_0x360476);}}else return Logger[_0x33a4e1(0x20c)]('[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20neither\x20preferred_username\x20nor\x20username\x20in\x20userinfo'),null;}_0x4ff205=await Database[_0x33a4e1(0x249)][_0x33a4e1(0x2ca)](_0x3fa43c);if(_0x4ff205?.['authOpenIDSub'])return Logger[_0x33a4e1(0x20c)]('[Auth]\x20openid:\x20User\x20found\x20with\x20username\x20\x22'+_0x3fa43c+'\x22\x20but\x20is\x20already\x20matched\x20with\x20sub\x20\x22'+_0x4ff205[_0x33a4e1(0x1e9)]+'\x22'),null;}}if(_0x4ff205){if(_0x35b6f1[_0x33a4e1(0x1c9)](_0x35b6f1['tbRmB'],_0x33a4e1(0x1e5))){const _0x271c8c=_0x33a4e1(0x2a5)[_0x33a4e1(0x347)]('|');let _0x679f0b=0x0;while(!![]){switch(_0x271c8c[_0x679f0b++]){case'0':if(!_0x4ff205['extraData'])_0x4ff205[_0x33a4e1(0x2c7)]={};continue;case'1':await _0x4ff205[_0x33a4e1(0x344)]();continue;case'2':if(!_0x4ff205[_0x33a4e1(0x1c0)])return Logger[_0x33a4e1(0x20c)](_0x33a4e1(0x2e0)),null;continue;case'3':_0x4ff205[_0x33a4e1(0x33f)](_0x35b6f1['MDVFh'],!![]);continue;case'4':return _0x4ff205;case'5':_0x4ff205[_0x33a4e1(0x2c7)][_0x33a4e1(0x1e9)]=_0x3982e2[_0x33a4e1(0x269)];continue;case'6':Logger['debug']('[Auth]\x20openid:\x20User\x20found\x20by\x20email/username');continue;}break;}}else return _0x4396ea[_0x33a4e1(0x26b)]({'error':_0x35b6f1[_0x33a4e1(0x305)]});}if(Database['serverSettings']['authOpenIDAutoRegister']){if(_0x35b6f1[_0x33a4e1(0x1ac)]===_0x35b6f1[_0x33a4e1(0x1ac)])return Logger[_0x33a4e1(0x1d8)](_0x33a4e1(0x325)+_0x3982e2[_0x33a4e1(0x269)]+'\x22',_0x3982e2),_0x4ff205=await Database['userModel'][_0x33a4e1(0x321)](_0x3982e2,this),_0x4ff205;else _0x4e1f23[_0x33a4e1(0x2f3)](function(){return _0x99f929(null,_0x16cbc5['stringify']({'id':_0x5890b4['id']}));});}return Logger['warn'](_0x33a4e1(0x1fb)),null;}[_0x119b43(0x2a7)](_0xfe87c){const _0x4f0fe0=_0x119b43,_0x18900d=Database['serverSettings'][_0x4f0fe0(0x324)];if(!_0x18900d)return!![];if(!_0xfe87c[_0x18900d])return![];return!![];}async['setUserGroup'](_0x333b97,_0x41ade5){const _0x5e5d5a=_0x119b43,_0x5e6909={'EDjJp':'Authorization:\x20REDACTED','uBQKa':function(_0x1d2de1,_0x36aa97){return _0x1d2de1+_0x36aa97;},'SzWyT':_0x5e5d5a(0x33b),'bUXCT':_0x5e5d5a(0x318),'IiErr':'guest','icxjB':function(_0x322519,_0x5a68f2){return _0x322519===_0x5a68f2;},'FEbve':_0x5e5d5a(0x278),'ufMvK':_0x5e5d5a(0x2a3),'uhoRK':_0x5e5d5a(0x1f3),'VgMJk':function(_0x261c6e,_0xdb01d6){return _0x261c6e!==_0xdb01d6;},'vbfPA':'unYRU','FLllj':_0x5e5d5a(0x346)},_0x20bb72=Database[_0x5e5d5a(0x1ce)][_0x5e5d5a(0x324)];if(!_0x20bb72)return;if(!_0x41ade5[_0x20bb72])throw new Error(_0x5e5d5a(0x218)+_0x20bb72+_0x5e5d5a(0x2db));const _0x5e9e36=_0x41ade5[_0x20bb72][_0x5e5d5a(0x241)](_0x2e379a=>_0x2e379a[_0x5e5d5a(0x1f4)]()),_0x1bb703=[_0x5e6909[_0x5e5d5a(0x2cc)],_0x5e6909['bUXCT'],_0x5e6909[_0x5e5d5a(0x295)]];let _0x528acc=_0x1bb703[_0x5e5d5a(0x258)](_0x43bb24=>_0x5e9e36[_0x5e5d5a(0x315)](_0x43bb24));if(_0x528acc){if(_0x5e6909['icxjB'](_0x333b97[_0x5e5d5a(0x303)],_0x5e6909['FEbve'])){if(_0x5e6909[_0x5e5d5a(0x298)](_0x5e6909[_0x5e5d5a(0x322)],_0x5e6909['uhoRK']))_0x4bf32f['sendStatus'](0x1f4);else{if(_0x5e6909[_0x5e5d5a(0x217)](_0x528acc,_0x5e6909[_0x5e5d5a(0x2cc)]))throw new Error(_0x5e5d5a(0x28d)+_0x333b97[_0x5e5d5a(0x19d)]+_0x5e5d5a(0x270)+_0x528acc+_0x5e5d5a(0x2b2));else return;}}if(_0x5e6909[_0x5e5d5a(0x217)](_0x333b97[_0x5e5d5a(0x303)],_0x528acc)){if(_0x5e6909[_0x5e5d5a(0x292)]===_0x5e6909['vbfPA'])Logger[_0x5e5d5a(0x1d8)](_0x5e5d5a(0x28e)+_0x333b97[_0x5e5d5a(0x19d)]+_0x5e5d5a(0x29a)+_0x528acc+_0x5e5d5a(0x1de)+_0x333b97['type']+'\x22'),_0x333b97['type']=_0x528acc,await _0x333b97[_0x5e5d5a(0x344)]();else{_0x3d9a0b['error'](_0x336c29['stringify'](_0x4c1a9b,null,0x2));if(_0x4ba2fa){const _0x4069f6=_0x4b4390[_0x5e5d5a(0x246)]?.['_header']['replace'](/Authorization: [^\r\n]*/i,_0x5e6909[_0x5e5d5a(0x317)]);_0x478fb3[_0x5e5d5a(0x266)](_0x5e6909[_0x5e5d5a(0x25a)](_0x4069f6,'\x0a')+_0x206c35['stringify'](_0x422862[_0x5e5d5a(0x2cf)],null,0x2));}return _0x387b9b?_0x8e381[_0x5e5d5a(0x32b)](_0x5198da)['send'](_0x2104bc):_0x45c4e5[_0x5e5d5a(0x2b0)]('/login?error='+_0x29f828(_0x540334)+'&autoLaunch=0');}}}else{if(_0x5e6909[_0x5e5d5a(0x2da)]!==_0x5e6909[_0x5e5d5a(0x2da)])_0x9aad88[_0x5e5d5a(0x26b)](_0x42df06);else throw new Error(_0x5e5d5a(0x20d)+JSON[_0x5e5d5a(0x1a1)](_0x41ade5[_0x20bb72],null,0x2));}}async[_0x119b43(0x251)](_0x2cb7d0,_0x524fe1){const _0x3f00d2=_0x119b43,_0x1588dc={'xWEqK':function(_0x53aa29,_0x5d7f83){return _0x53aa29===_0x5d7f83;},'NAvag':_0x3f00d2(0x33b),'PIYOj':function(_0x221c11,_0x50c636){return _0x221c11===_0x50c636;},'JgSUn':_0x3f00d2(0x278)},_0x5b2e60=Database['serverSettings']['authOpenIDAdvancedPermsClaim'];if(!_0x5b2e60)return;if(_0x1588dc[_0x3f00d2(0x314)](_0x2cb7d0['type'],_0x1588dc[_0x3f00d2(0x221)])||_0x1588dc[_0x3f00d2(0x1d0)](_0x2cb7d0[_0x3f00d2(0x303)],_0x1588dc['JgSUn']))return;const _0x1c6fff=_0x524fe1[_0x5b2e60];if(!_0x1c6fff)throw new Error('Advanced\x20permissions\x20claim\x20'+_0x5b2e60+_0x3f00d2(0x2db));await _0x2cb7d0[_0x3f00d2(0x1fa)](_0x1c6fff)&&Logger[_0x3f00d2(0x1d8)](_0x3f00d2(0x23f)+_0x2cb7d0[_0x3f00d2(0x19d)]+_0x3f00d2(0x2ce)+JSON[_0x3f00d2(0x1a1)](_0x1c6fff)+'\x22');}[_0x119b43(0x2c3)](_0x404f0c){const _0x30aa64=_0x119b43;passport[_0x30aa64(0x22f)](_0x404f0c);}[_0x119b43(0x2f7)](_0x3da47a){const _0x302596=_0x119b43,_0x4bd59d={'ROtii':function(_0x3e8477,_0x4f74fe){return _0x3e8477===_0x4f74fe;},'rMMgM':_0x302596(0x33c),'oGKfZ':'dcOtb','xesPi':function(_0x31ac4e,_0x2652bb){return _0x31ac4e===_0x2652bb;},'rKgTZ':'local','LZniO':'hlhUb','aPohA':'[Auth]\x20Invalid\x20auth\x20strategy\x20'};if(_0x4bd59d[_0x302596(0x1e8)](_0x3da47a,_0x4bd59d[_0x302596(0x336)]))'dcOtb'===_0x4bd59d[_0x302596(0x2a6)]?this[_0x302596(0x26e)]():(_0x23a8d6[_0x302596(0x328)](_0x302596(0x1cf)+_0x1e50a7+'\x0a'+_0x5c1db1?.['stack']),_0x442bd4['status'](0x1f4)[_0x302596(0x2a0)](_0x302596(0x1c5)));else{if(_0x4bd59d['xesPi'](_0x3da47a,_0x4bd59d[_0x302596(0x22e)]))this[_0x302596(0x1d4)]();else{if(_0x302596(0x216)===_0x4bd59d[_0x302596(0x333)])Logger['error'](_0x4bd59d['aPohA']+_0x3da47a);else{if(_0x2f7c80!==_0x302596(0x33b))throw new _0x5b94c0('Root\x20user\x20\x22'+_0x354651['username']+'\x22\x20cannot\x20be\x20downgraded\x20to\x20'+_0x1a1b1f+_0x302596(0x2b2));else return;}}}}['isAuthMethodAPIBased'](_0x5d6db8){const _0x47092b=_0x119b43,_0x31ad3d={'QbSSc':_0x47092b(0x32a)};return[_0x47092b(0x245),_0x31ad3d['QbSSc']]['includes'](_0x5d6db8);}[_0x119b43(0x256)](_0x46f885,_0x4e4e66,_0x3d6476=_0x119b43(0x327)){const _0x461064=_0x119b43,_0x488474={'IpwRs':_0x461064(0x24d),'jSKHq':'auth_cb','YnSuj':_0x461064(0x22b),'yZeVG':function(_0x3b9dfa,_0x4887a6){return _0x3b9dfa*_0x4887a6;}},_0x123990=0x1d4c0,_0x1a4795=_0x46f885[_0x461064(0x2d5)][_0x461064(0x1ab)]||_0x46f885[_0x461064(0x2d5)][_0x461064(0x335)];if(!this[_0x461064(0x28f)](_0x3d6476)){if(_0x461064(0x24d)===_0x488474[_0x461064(0x1ef)]){_0x46f885[_0x461064(0x2d5)][_0x461064(0x255)]&&_0x4e4e66['cookie'](_0x461064(0x1df),_0x46f885[_0x461064(0x2d5)][_0x461064(0x255)],{'maxAge':_0x123990,'httpOnly':!![]});if(!_0x1a4795)return _0x4e4e66[_0x461064(0x32b)](0x190)[_0x461064(0x2a0)]({'message':_0x461064(0x265)});_0x4e4e66[_0x461064(0x2bf)](_0x488474[_0x461064(0x311)],_0x1a4795,{'maxAge':_0x123990,'httpOnly':!![]});}else throw new _0x1ed502('Root\x20user\x20\x22'+_0x5ba28f[_0x461064(0x19d)]+_0x461064(0x270)+_0x59d786+_0x461064(0x2b2));}_0x4e4e66[_0x461064(0x2bf)](_0x488474['YnSuj'],_0x3d6476,{'maxAge':_0x488474[_0x461064(0x210)](_0x488474['yZeVG'](0x3e8*0x3c*0x3c,0x18),0x16d)*0xa,'httpOnly':!![]});}async[_0x119b43(0x209)](_0x32c11f,_0x7e27e3){const _0xc47115=_0x119b43,_0x2c31bb={'PfOYJ':'State\x20parameter\x20mismatch','GdQgS':_0xc47115(0x1b6),'veNBo':_0xc47115(0x2e3),'NClJG':_0xc47115(0x19f),'czFcO':_0xc47115(0x1d2)},_0x3cf667=await this[_0xc47115(0x286)](_0x32c11f[_0xc47115(0x318)]);if(this['isAuthMethodAPIBased'](_0x32c11f[_0xc47115(0x27f)][_0xc47115(0x22b)]))_0x7e27e3[_0xc47115(0x26b)](_0x3cf667);else{if(_0x32c11f[_0xc47115(0x27f)][_0xc47115(0x27e)]){if(_0xc47115(0x1ed)!==_0xc47115(0x1ed))return _0x1620e0[_0xc47115(0x328)](_0xc47115(0x320)),_0x42a535[_0xc47115(0x32b)](0x190)[_0xc47115(0x2a0)](_0x2c31bb[_0xc47115(0x28c)]);else{let _0x50887f=_0x32c11f[_0xc47115(0x27f)][_0xc47115(0x1df)]?_0xc47115(0x204)+_0x32c11f[_0xc47115(0x27f)][_0xc47115(0x1df)]:'';_0x7e27e3[_0xc47115(0x2b0)](0x12e,_0x32c11f[_0xc47115(0x27f)][_0xc47115(0x27e)]+_0xc47115(0x1dd)+_0x3cf667[_0xc47115(0x318)][_0xc47115(0x1b9)]+_0x50887f);}}else{if(_0x2c31bb[_0xc47115(0x2be)]===_0x2c31bb[_0xc47115(0x1fe)])return _0x152c98[_0xc47115(0x266)](_0xc47115(0x1e7)+_0x55c1b2[_0xc47115(0x2d5)]['response_type']),_0x2b7d71['status'](0x190)[_0xc47115(0x2a0)](_0x2c31bb[_0xc47115(0x237)]);else _0x7e27e3['status'](0x190)[_0xc47115(0x2a0)](_0x2c31bb['czFcO']);}}}async['initAuthRoutes'](_0x47c36c){const _0x302bba=_0x119b43,_0x14643f={'qAthM':_0x302bba(0x2d4),'SQeSe':_0x302bba(0x2a2),'DduaZ':function(_0x33f6ca,_0x131223){return _0x33f6ca===_0x131223;},'KKUMx':_0x302bba(0x329),'cTgQQ':_0x302bba(0x2d3),'zkMSD':_0x302bba(0x2b9),'EFgUm':_0x302bba(0x1e4),'Kyycx':_0x302bba(0x32c),'xwWhW':_0x302bba(0x24c),'UsYZA':function(_0x5350f8,_0xa90d3a){return _0x5350f8(_0xa90d3a);},'qmPBL':function(_0x1e99ad,_0x236396,_0x45d814){return _0x1e99ad(_0x236396,_0x45d814);},'myKaQ':_0x302bba(0x220),'QHvqW':_0x302bba(0x30b),'KFwEb':function(_0xbcc1e6,_0x39515a){return _0xbcc1e6+_0x39515a;},'Yxlht':_0x302bba(0x32a),'kYKrp':'openid','GRrhs':'No\x20redirect\x20URI','wkVyB':_0x302bba(0x1a4),'pRCtV':function(_0x50f4e8,_0x5a15f4,_0x58f578){return _0x50f4e8(_0x5a15f4,_0x58f578);},'nqIRp':'FDPOY','BbGEv':_0x302bba(0x1d1),'nlvRT':_0x302bba(0x27e),'GltoV':function(_0x246551,_0x4e670e){return _0x246551*_0x4e670e;},'PrngZ':_0x302bba(0x2c0),'RBYNy':'Error\x20in\x20callback','JuLjb':function(_0x33431e,_0x15ad33){return _0x33431e!==_0x15ad33;},'lxjsC':'oNdKW','LYova':_0x302bba(0x268),'gzHUu':function(_0x2838ba,_0x4ff30d,_0x436ec2,_0x57d6ed){return _0x2838ba(_0x4ff30d,_0x436ec2,_0x57d6ed);},'imkKv':_0x302bba(0x21d),'FpNpM':'Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20invalid','qNkvI':_0x302bba(0x243),'bvZHw':_0x302bba(0x1b4),'KBPJW':'openid_id_token','suTvE':_0x302bba(0x224),'JqCUR':_0x302bba(0x323),'KYHjY':_0x302bba(0x327),'rroQB':_0x302bba(0x33e),'GysOc':_0x302bba(0x2ad),'uumSi':_0x302bba(0x21f)};_0x47c36c['post'](_0x14643f[_0x302bba(0x261)],passport[_0x302bba(0x33d)](_0x14643f[_0x302bba(0x1bf)]),async(_0x23a35a,_0x578bd9)=>{const _0x5614b0=_0x302bba;_0x578bd9['json'](await this[_0x5614b0(0x286)](_0x23a35a[_0x5614b0(0x318)]));}),_0x47c36c[_0x302bba(0x1fd)](_0x14643f[_0x302bba(0x1e2)],(_0xaa908c,_0x5af2a5,_0x3be6f0)=>{const _0x5af56d=_0x302bba,_0x3ec313=passport[_0x5af56d(0x1bd)](_0x14643f[_0x5af56d(0x202)]),_0x8e8c19=_0x3ec313[_0x5af56d(0x293)],_0x16d0ec=_0x3ec313['_key'];try{const _0x32074c=_0xaa908c['secure']||_0xaa908c['get'](_0x14643f[_0x5af56d(0x2a9)])===_0x5af56d(0x1b4)?'https':_0x14643f[_0x5af56d(0x23d)],_0x220754=new URL(_0x32074c+'://'+_0xaa908c[_0x5af56d(0x1fd)](_0x14643f[_0x5af56d(0x30a)])),_0x5776a3=_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x2de)]===_0x14643f['Kyycx']||_0xaa908c['query'][_0x5af56d(0x1ab)]||_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x228)];if(_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x2de)]&&_0xaa908c[_0x5af56d(0x2d5)]['response_type']!==_0x14643f[_0x5af56d(0x2c5)])return Logger[_0x5af56d(0x266)](_0x5af56d(0x1e7)+_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x2de)]),_0x5af2a5[_0x5af56d(0x32b)](0x190)[_0x5af56d(0x2a0)](_0x5af56d(0x1b6));const _0x42c700=!_0x5776a3||!_0xaa908c[_0x5af56d(0x2d5)]['state']?OpenIDClient[_0x5af56d(0x2d0)][_0x5af56d(0x2ab)]():_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x255)];let _0x5b8e71;if(_0x5776a3){if(_0x14643f[_0x5af56d(0x29f)]('brQMi',_0x14643f[_0x5af56d(0x1ff)]))return _0x4356d7[_0x5af56d(0x26b)]({'error':_0x14643f[_0x5af56d(0x244)]});else{if(!_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x1ab)]||!_0x14643f[_0x5af56d(0x29d)](_0x2ceb47,_0xaa908c['query'][_0x5af56d(0x1ab)]))return Logger[_0x5af56d(0x266)](_0x5af56d(0x2c2)+_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x1ab)]),_0x5af2a5['status'](0x190)[_0x5af56d(0x2a0)](_0x5af56d(0x306));this[_0x5af56d(0x2fd)]['set'](_0x42c700,{'mobile_redirect_uri':_0xaa908c[_0x5af56d(0x2d5)]['redirect_uri']}),_0x5b8e71=new URL(global[_0x5af56d(0x2bd)]['authOpenIDSubfolderForRedirectURLs']+_0x5af56d(0x19e),_0x220754)['toString']();}}else{_0x5b8e71=new URL(global['ServerSettings'][_0x5af56d(0x1f9)]+_0x5af56d(0x2ad),_0x220754)[_0x5af56d(0x31b)]();if(_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x255)])return Logger['debug'](_0x5af56d(0x211)),_0x5af2a5[_0x5af56d(0x32b)](0x190)[_0x5af56d(0x2a0)]('Invalid\x20state,\x20not\x20allowed\x20on\x20web\x20flow');}_0x3ec313[_0x5af56d(0x222)][_0x5af56d(0x1ab)]=_0x5b8e71,Logger[_0x5af56d(0x266)](_0x5af56d(0x2ed)+_0x5b8e71);let {code_challenge:_0x1f54ee,code_challenge_method:_0x3a46c9,code_verifier:_0x18d97c}=_0x14643f['qmPBL'](_0x460759,_0xaa908c,_0x5776a3);_0xaa908c['session'][_0x16d0ec]={..._0xaa908c[_0x5af56d(0x25d)][_0x16d0ec],'state':_0x42c700,'max_age':_0x3ec313[_0x5af56d(0x222)]['max_age'],'response_type':_0x5af56d(0x32c),'code_verifier':_0x18d97c,'mobile':_0xaa908c[_0x5af56d(0x2d5)][_0x5af56d(0x1ab)],'sso_redirect_uri':_0x3ec313[_0x5af56d(0x222)][_0x5af56d(0x1ab)]};var _0x5c508f=_0x14643f[_0x5af56d(0x1a9)];global[_0x5af56d(0x2bd)]['authOpenIDGroupClaim']&&(_0x5c508f+='\x20'+global['ServerSettings'][_0x5af56d(0x324)]);if(global[_0x5af56d(0x2bd)][_0x5af56d(0x1ba)]){if(_0x14643f[_0x5af56d(0x296)]===_0x14643f[_0x5af56d(0x296)])_0x5c508f+=_0x14643f[_0x5af56d(0x1fc)]('\x20',global[_0x5af56d(0x2bd)]['authOpenIDAdvancedPermsClaim']);else{_0x55fe8a(null,null);return;}}const _0x3899e7=_0x8e8c19[_0x5af56d(0x274)]({..._0x3ec313['_params'],'state':_0x42c700,'response_type':'code','scope':_0x5c508f,'code_challenge':_0x1f54ee,'code_challenge_method':_0x3a46c9});this['paramsToCookies'](_0xaa908c,_0x5af2a5,_0x5776a3?_0x14643f['Yxlht']:_0x14643f[_0x5af56d(0x312)]),_0x5af2a5[_0x5af56d(0x2b0)](_0x3899e7);}catch(_0x2f51e0){Logger[_0x5af56d(0x328)](_0x5af56d(0x1d6)+_0x2f51e0+'\x0a'+_0x2f51e0?.['stack']),_0x5af2a5[_0x5af56d(0x32b)](0x1f4)['send'](_0x5af56d(0x1c5));}function _0x460759(_0x1d0e88,_0x27b567){const _0x1a5667=_0x5af56d;if(_0x27b567){if(!_0x1d0e88['query'][_0x1a5667(0x228)])throw new Error(_0x14643f[_0x1a5667(0x2d6)]);if(_0x1d0e88['query'][_0x1a5667(0x2ae)]&&_0x1d0e88[_0x1a5667(0x2d5)][_0x1a5667(0x2ae)]!==_0x1a5667(0x281))throw new Error(_0x1a5667(0x2b6));return{'code_challenge':_0x1d0e88['query'][_0x1a5667(0x228)],'code_challenge_method':_0x1d0e88[_0x1a5667(0x2d5)]['code_challenge_method']||_0x1a5667(0x281)};}else{const _0x355dee=OpenIDClient[_0x1a5667(0x2d0)][_0x1a5667(0x2c1)](),_0x4e6369=OpenIDClient[_0x1a5667(0x2d0)][_0x1a5667(0x1c3)](_0x355dee);return{'code_challenge':_0x4e6369,'code_challenge_method':_0x1a5667(0x281),'code_verifier':_0x355dee};}}function _0x2ceb47(_0x323e5f){const _0x6fa609=_0x5af56d;return Database[_0x6fa609(0x1ce)][_0x6fa609(0x223)][_0x6fa609(0x315)](_0x323e5f)||_0x14643f[_0x6fa609(0x29f)](Database[_0x6fa609(0x1ce)][_0x6fa609(0x223)][_0x6fa609(0x2d9)],0x1)&&Database['serverSettings']['authOpenIDMobileRedirectURIs'][0x0]==='*';}}),_0x47c36c[_0x302bba(0x1fd)](_0x302bba(0x19e),(_0x147a7c,_0x1efe22)=>{const _0x34295c=_0x302bba;try{const {state:_0x5d0773,code:_0x32c319}=_0x147a7c[_0x34295c(0x2d5)];if(!_0x5d0773||!this[_0x34295c(0x2fd)][_0x34295c(0x31f)](_0x5d0773))return Logger['error']('[Auth]\x20/auth/openid/mobile-redirect\x20route:\x20State\x20parameter\x20mismatch'),_0x1efe22[_0x34295c(0x32b)](0x190)[_0x34295c(0x2a0)](_0x34295c(0x2f5));let _0x17d8bb=this[_0x34295c(0x2fd)][_0x34295c(0x1fd)](_0x5d0773)['mobile_redirect_uri'];if(!_0x17d8bb)return Logger[_0x34295c(0x328)](_0x34295c(0x24b)),_0x1efe22[_0x34295c(0x32b)](0x190)[_0x34295c(0x2a0)](_0x14643f[_0x34295c(0x2e8)]);this[_0x34295c(0x2fd)][_0x34295c(0x253)](_0x5d0773);const _0x15eebd=_0x17d8bb+_0x34295c(0x29c)+encodeURIComponent(_0x32c319)+'&state='+_0x14643f[_0x34295c(0x29d)](encodeURIComponent,_0x5d0773);_0x1efe22[_0x34295c(0x2b0)](_0x15eebd);}catch(_0x5b3db0){Logger[_0x34295c(0x328)](_0x34295c(0x1cf)+_0x5b3db0+'\x0a'+_0x5b3db0?.['stack']),_0x1efe22[_0x34295c(0x32b)](0x1f4)[_0x34295c(0x2a0)](_0x34295c(0x1c5));}}),_0x47c36c['get'](_0x14643f[_0x302bba(0x2b4)],(_0x40c11d,_0x513446,_0xb51355)=>{const _0x4115af=_0x302bba,_0x2fea96={'wWDwH':'No\x20callback\x20parameter','zKWYU':_0x14643f[_0x4115af(0x2b3)],'YCuGX':_0x4115af(0x22b),'TwbTL':function(_0x3a4d90,_0x204c64){return _0x3a4d90*_0x204c64;},'ykPxK':function(_0x20f6de,_0xcf9575){return _0x20f6de===_0xcf9575;},'lcAgz':function(_0x2bb989,_0x1bc529){const _0x38f42c=_0x4115af;return _0x14643f[_0x38f42c(0x24a)](_0x2bb989,_0x1bc529);},'lgewb':_0x14643f['PrngZ'],'lkwUb':_0x4115af(0x273),'pJpJV':function(_0x1760be,_0x1d4188,_0x56e990,_0x507396,_0x30f3f7,_0x475646){return _0x1760be(_0x1d4188,_0x56e990,_0x507396,_0x30f3f7,_0x475646);},'hZLdl':_0x14643f[_0x4115af(0x1a5)],'VoHIq':'Unauthorized'},_0x2ffadf=passport[_0x4115af(0x1bd)](_0x14643f[_0x4115af(0x202)]),_0x22c882=_0x2ffadf[_0x4115af(0x27d)];if(!_0x40c11d[_0x4115af(0x25d)][_0x22c882])return _0x14643f['JuLjb'](_0x14643f[_0x4115af(0x1a6)],_0x14643f['lxjsC'])?_0x4dffe8[_0x4115af(0x32b)](_0x6f5891)['send'](_0x327914):_0x513446[_0x4115af(0x32b)](0x190)[_0x4115af(0x2a0)](_0x4115af(0x289));_0x40c11d['query'][_0x4115af(0x309)]&&(_0x14643f[_0x4115af(0x1e6)]!==_0x14643f['LYova']?_0x29ab54+='\x20'+_0x5cb9e8[_0x4115af(0x2bd)][_0x4115af(0x324)]:_0x40c11d[_0x4115af(0x25d)][_0x22c882]['code_verifier']=_0x40c11d[_0x4115af(0x2d5)]['code_verifier']);function _0x1e56b4(_0x413943,_0x18bab5,_0x4f8eb4,_0x1edf2e,_0x4209b5){const _0x3c17c1=_0x4115af,_0x426732={'kVTbA':_0x14643f[_0x3c17c1(0x282)],'tIxmU':function(_0x4e2bec,_0x529951,_0x416afa){const _0x3278c1=_0x3c17c1;return _0x14643f[_0x3278c1(0x2d8)](_0x4e2bec,_0x529951,_0x416afa);}};Logger[_0x3c17c1(0x328)](JSON[_0x3c17c1(0x1a1)](_0x1edf2e,null,0x2));if(_0x4209b5){if(_0x14643f[_0x3c17c1(0x338)]!==_0x3c17c1(0x19c)){if(_0x2a5b91){this[_0x3c17c1(0x297)](_0xe76906,_0x469389[_0x3c17c1(0x19d)],_0x426732['kVTbA']),_0x426732['tIxmU'](_0x1aca02,null,null);return;}_0x4b24d6[_0x3c17c1(0x1d8)]('[Auth]\x20User\x20\x22'+_0x10fbcf['username']+_0x3c17c1(0x284)+_0x528a81[_0x3c17c1(0x27c)](_0x423e34)),_0x5ddaab(null,_0x52d870);return;}else{const _0x257903=_0x4209b5[_0x3c17c1(0x246)]?.['_header']['replace'](/Authorization: [^\r\n]*/i,_0x14643f[_0x3c17c1(0x1b3)]);Logger[_0x3c17c1(0x266)](_0x257903+'\x0a'+JSON['stringify'](_0x4209b5[_0x3c17c1(0x2cf)],null,0x2));}}return _0x413943?_0x513446['status'](_0x18bab5)[_0x3c17c1(0x2a0)](_0x4f8eb4):_0x513446['redirect'](_0x3c17c1(0x343)+encodeURIComponent(_0x4f8eb4)+'&autoLaunch=0');}function _0x20882d(_0x3e6a35,_0x340dbc,_0x52e25e){return(_0x163436,_0x58b062,_0x509d4d)=>{const _0x338afb=_0x2784,_0x54ff05={'hbNLd':_0x2fea96['wWDwH'],'uSImY':_0x2fea96[_0x338afb(0x313)],'doTUW':_0x2fea96['YCuGX'],'dWMjx':function(_0xbfce04,_0x5a3934){return _0xbfce04*_0x5a3934;},'VzuAe':function(_0x574a5d,_0x25f167){const _0x1f7485=_0x338afb;return _0x2fea96[_0x1f7485(0x219)](_0x574a5d,_0x25f167);},'QWFoV':function(_0x11cfc4,_0x20e76e){const _0x4db8df=_0x338afb;return _0x2fea96[_0x4db8df(0x200)](_0x11cfc4,_0x20e76e);},'bMjgd':_0x338afb(0x319),'cwexK':function(_0x5bc055,_0x5d6acd){return _0x2fea96['lcAgz'](_0x5bc055,_0x5d6acd);},'Esrdk':_0x2fea96[_0x338afb(0x21a)]},_0x17747c=_0x3e6a35[_0x338afb(0x25d)][_0x22c882]?.[_0x338afb(0x2c8)]===!![];if(_0x163436){if(_0x2fea96[_0x338afb(0x28b)]===_0x338afb(0x273))return _0x2fea96[_0x338afb(0x1b7)](_0x1e56b4,_0x17747c,0x1f4,_0x2fea96[_0x338afb(0x2fc)],_0x338afb(0x337)+_0x163436,_0x163436?.[_0x338afb(0x252)]);else{const _0x586b2d=0x1d4c0,_0x7b8f94=_0x53ae64[_0x338afb(0x2d5)][_0x338afb(0x1ab)]||_0x539242['query'][_0x338afb(0x335)];if(!this[_0x338afb(0x28f)](_0x3be7de)){_0x5adf4f[_0x338afb(0x2d5)][_0x338afb(0x255)]&&_0x4c3055['cookie'](_0x338afb(0x1df),_0x208c44[_0x338afb(0x2d5)][_0x338afb(0x255)],{'maxAge':_0x586b2d,'httpOnly':!![]});if(!_0x7b8f94)return _0x471b6d[_0x338afb(0x32b)](0x190)[_0x338afb(0x2a0)]({'message':_0x54ff05['hbNLd']});_0x5318e4[_0x338afb(0x2bf)](_0x54ff05[_0x338afb(0x287)],_0x7b8f94,{'maxAge':_0x586b2d,'httpOnly':!![]});}_0x289c6d[_0x338afb(0x2bf)](_0x54ff05[_0x338afb(0x30c)],_0xdbad13,{'maxAge':_0x54ff05[_0x338afb(0x23b)](_0x54ff05[_0x338afb(0x2ff)](0x3e8*0x3c,0x3c),0x18)*0x16d*0xa,'httpOnly':!![]});}}if(!_0x58b062)return _0x2fea96[_0x338afb(0x1b7)](_0x1e56b4,_0x17747c,0x191,_0x2fea96['VoHIq'],_0x338afb(0x1cc)+_0x509d4d,_0x509d4d?.[_0x338afb(0x252)]);_0x3e6a35[_0x338afb(0x2ec)](_0x58b062,_0x29ee7e=>{const _0x3accb4=_0x338afb;if(_0x29ee7e)return _0x54ff05[_0x3accb4(0x2ba)](_0x3accb4(0x1b2),_0x54ff05[_0x3accb4(0x25b)])?_0x4ce03e[_0x3accb4(0x2b0)]('/login?error='+_0x20ad34(_0x20338c)+_0x3accb4(0x1d7)):_0x1e56b4(_0x17747c,0x1f4,'Error\x20during\x20login',_0x3accb4(0x232)+_0x29ee7e);_0x340dbc[_0x3accb4(0x2bf)](_0x3accb4(0x247),_0x58b062[_0x3accb4(0x247)],{'maxAge':_0x54ff05['dWMjx'](_0x54ff05[_0x3accb4(0x23b)](_0x54ff05[_0x3accb4(0x23b)](_0x54ff05[_0x3accb4(0x2e7)](0x3e8*0x3c,0x3c),0x18),0x16d),0xa),'httpOnly':!![],'secure':!![],'sameSite':_0x54ff05['Esrdk']}),_0x52e25e();});};}return passport['authenticate'](_0x14643f[_0x4115af(0x202)],{'redirect_uri':_0x40c11d[_0x4115af(0x25d)][_0x22c882][_0x4115af(0x2e6)]},_0x14643f[_0x4115af(0x2eb)](_0x20882d,_0x40c11d,_0x513446,_0xb51355))(_0x40c11d,_0x513446,_0xb51355);},this['handleLoginSuccessBasedOnCookie'][_0x302bba(0x2f1)](this)),_0x47c36c['get']('/auth/openid/config',this[_0x302bba(0x342)],async(_0x55d561,_0x2ba845)=>{const _0x1e84cf=_0x302bba;if(!_0x55d561[_0x1e84cf(0x318)]['isAdminOrUp']){if(_0x1e84cf(0x2dc)!==_0x14643f[_0x1e84cf(0x279)])return Logger[_0x1e84cf(0x328)](_0x1e84cf(0x308)+_0x55d561['user'][_0x1e84cf(0x19d)]+'\x22\x20attempted\x20to\x20get\x20issuer\x20config'),_0x2ba845[_0x1e84cf(0x1ee)](0x193);else return;}if(!_0x55d561[_0x1e84cf(0x2d5)]['issuer'])return _0x2ba845['status'](0x190)[_0x1e84cf(0x2a0)](_0x1e84cf(0x1c4));let _0x53820a=_0x55d561[_0x1e84cf(0x2d5)]['issuer'];if(_0x53820a[_0x1e84cf(0x1e3)]('/'))_0x53820a=_0x53820a[_0x1e84cf(0x330)](0x0,-0x1);let _0xd6fed4=null;try{_0xd6fed4=new URL(_0x53820a+_0x1e84cf(0x239));if(!_0xd6fed4['pathname'][_0x1e84cf(0x1e3)](_0x1e84cf(0x239)))throw new Error(_0x1e84cf(0x334));}catch(_0x22835d){return Logger[_0x1e84cf(0x328)]('[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration.\x20Invalid\x20URL\x20\x22'+_0xd6fed4+'\x22',_0x22835d),_0x2ba845[_0x1e84cf(0x32b)](0x190)[_0x1e84cf(0x2a0)](_0x14643f[_0x1e84cf(0x1cd)]);}axios['get'](_0xd6fed4[_0x1e84cf(0x31b)]())[_0x1e84cf(0x272)](({data:_0x568f1f})=>{const _0x4c52d5=_0x1e84cf;_0x2ba845['json']({'issuer':_0x568f1f[_0x4c52d5(0x271)],'authorization_endpoint':_0x568f1f[_0x4c52d5(0x29b)],'token_endpoint':_0x568f1f[_0x4c52d5(0x22a)],'userinfo_endpoint':_0x568f1f[_0x4c52d5(0x1f1)],'end_session_endpoint':_0x568f1f[_0x4c52d5(0x2b5)],'jwks_uri':_0x568f1f[_0x4c52d5(0x23e)],'id_token_signing_alg_values_supported':_0x568f1f['id_token_signing_alg_values_supported']});})[_0x1e84cf(0x307)](_0x8f209c=>{const _0x4b2e6b=_0x1e84cf;Logger[_0x4b2e6b(0x328)](_0x4b2e6b(0x301)+_0xd6fed4+'\x22',_0x8f209c),_0x2ba845[_0x4b2e6b(0x32b)](_0x8f209c[_0x4b2e6b(0x22c)]||0x190)[_0x4b2e6b(0x2a0)]((_0x8f209c['code']||_0x4b2e6b(0x1c1))+_0x4b2e6b(0x2f0));});}),_0x47c36c[_0x302bba(0x208)](_0x14643f[_0x302bba(0x30f)],(_0x422fef,_0x4e805b)=>{const _0x433e71=_0x302bba;_0x14643f[_0x433e71(0x31e)]===_0x433e71(0x264)?(_0x2365d2[_0x433e71(0x1d8)](_0x433e71(0x345)+_0x9290a2[_0x433e71(0x19d)]+'\x22'),_0x53ba20=_0x59207e['username']):_0x422fef['logout'](_0x22ba84=>{const _0x442e44=_0x433e71,_0x5f4681={'NNifZ':function(_0x2f0143,_0xba51d){return _0x14643f['UsYZA'](_0x2f0143,_0xba51d);}};if(_0x22ba84)_0x442e44(0x1eb)===_0x442e44(0x1eb)?_0x4e805b[_0x442e44(0x1ee)](0x1f4):_0x5f4681[_0x442e44(0x24e)](_0x877500,null);else{const _0x537768=_0x422fef[_0x442e44(0x27f)]['auth_method'];_0x4e805b[_0x442e44(0x2df)](_0x442e44(0x22b));let _0x50e177=null;if(_0x14643f[_0x442e44(0x29f)](_0x537768,_0x14643f[_0x442e44(0x312)])||_0x537768===_0x14643f[_0x442e44(0x2f6)]){if(_0x14643f[_0x442e44(0x29f)](_0x14643f[_0x442e44(0x1b5)],'FRRxg'))throw new _0x484b17('Group\x20claim\x20'+_0x7b84e8[_0x442e44(0x1ce)]['authOpenIDGroupClaim']+_0x442e44(0x33a));else{const _0x476661=passport[_0x442e44(0x1bd)](_0x442e44(0x329)),_0x5ddbc8=_0x476661[_0x442e44(0x293)];if(_0x5ddbc8[_0x442e44(0x271)][_0x442e44(0x2b5)]&&_0x5ddbc8[_0x442e44(0x271)][_0x442e44(0x2b5)][_0x442e44(0x2d9)]>0x0){let _0x23ef97=null;if(_0x14643f[_0x442e44(0x29f)](_0x537768,_0x14643f['kYKrp'])){const _0x28d955=_0x422fef[_0x442e44(0x339)]||_0x14643f[_0x442e44(0x29f)](_0x422fef[_0x442e44(0x1fd)](_0x442e44(0x2d3)),_0x442e44(0x1b4))?_0x14643f['bvZHw']:_0x442e44(0x2b9),_0xdc880d=_0x422fef[_0x442e44(0x1fd)]('host');_0x23ef97=_0x28d955+_0x442e44(0x2d1)+_0xdc880d+global[_0x442e44(0x2e4)]+_0x442e44(0x323);}_0x50e177=_0x5ddbc8[_0x442e44(0x28a)]({'id_token_hint':_0x422fef[_0x442e44(0x27f)][_0x442e44(0x247)],'post_logout_redirect_uri':_0x23ef97});}_0x4e805b['clearCookie'](_0x14643f['KBPJW']);}}_0x4e805b['send']({'redirect_url':_0x50e177});}});});}[_0x119b43(0x342)](_0xb0c999,_0x11ab30,_0x1ba6de){const _0x21dfef=_0x119b43,_0x40ab27={'TclFj':_0x21dfef(0x21e),'xpcXw':_0x21dfef(0x247),'NXktN':function(_0x2b8a5a,_0x4f621d){return _0x2b8a5a*_0x4f621d;},'MJTjg':function(_0x3e2de0,_0x45cf92){return _0x3e2de0*_0x45cf92;},'MTwds':function(_0x1428f6){return _0x1428f6();},'uBwhd':function(_0x31d3b3,_0x4719e0){return _0x31d3b3!==_0x4719e0;},'DfPXO':_0x21dfef(0x1f2),'NLznC':_0x21dfef(0x26c)};if(_0xb0c999[_0x21dfef(0x342)]())_0x1ba6de();else{if(_0x40ab27[_0x21dfef(0x212)](_0x21dfef(0x226),_0x40ab27[_0x21dfef(0x277)]))passport[_0x21dfef(0x33d)](_0x40ab27[_0x21dfef(0x2aa)])(_0xb0c999,_0x11ab30,_0x1ba6de);else{if(_0xd7608e)return _0x59d01a(_0x5012a3,0x1f4,_0x40ab27['TclFj'],_0x21dfef(0x232)+_0x4d50dc);_0x3e7a9a[_0x21dfef(0x2bf)](_0x40ab27[_0x21dfef(0x2f2)],_0x54fe57['openid_id_token'],{'maxAge':_0x40ab27[_0x21dfef(0x1aa)](_0x40ab27[_0x21dfef(0x2b7)](0x3e8*0x3c,0x3c)*0x18,0x16d)*0xa,'httpOnly':!![],'secure':!![],'sameSite':_0x21dfef(0x2c0)}),_0x40ab27[_0x21dfef(0x285)](_0x1932cf);}}}['generateAccessToken'](_0x43c543){const _0xf87774=_0x119b43;return jwt[_0xf87774(0x31a)]({'userId':_0x43c543['id'],'username':_0x43c543[_0xf87774(0x19d)]},global['ServerSettings'][_0xf87774(0x2c4)]);}static[_0x119b43(0x32d)](_0x567fc4){const _0xd0a557=_0x119b43;try{return jwt[_0xd0a557(0x267)](_0x567fc4,global[_0xd0a557(0x2bd)][_0xd0a557(0x2c4)]);}catch(_0xd116b0){return null;}}async[_0x119b43(0x1e1)](){const _0x10cf62=_0x119b43,_0x5dd1ac={'lSgbN':_0x10cf62(0x280),'SKkZL':_0x10cf62(0x316),'aTCyx':_0x10cf62(0x1b9)};process[_0x10cf62(0x2c6)]['TOKEN_SECRET']?Database['serverSettings'][_0x10cf62(0x2c4)]=process[_0x10cf62(0x2c6)]['TOKEN_SECRET']:Database[_0x10cf62(0x1ce)][_0x10cf62(0x2c4)]=require(_0x5dd1ac[_0x10cf62(0x2b8)])[_0x10cf62(0x1b8)](0x100)[_0x10cf62(0x31b)](_0x5dd1ac[_0x10cf62(0x22d)]);await Database[_0x10cf62(0x1cb)]();const _0xbbd670=await Database[_0x10cf62(0x249)][_0x10cf62(0x25f)]({'attributes':['id',_0x10cf62(0x19d),_0x5dd1ac[_0x10cf62(0x214)]]});if(_0xbbd670[_0x10cf62(0x2d9)])for(const _0x5f0312 of _0xbbd670){_0x5f0312[_0x10cf62(0x1b9)]=await this[_0x10cf62(0x206)](_0x5f0312),await _0x5f0312[_0x10cf62(0x344)]({'hooks':![]});}}async['jwtAuthCheck'](_0x5a53b7,_0x4d0a6a){const _0x497b03=_0x119b43,_0x1b4fcf=await Database['userModel']['getUserByIdOrOldId'](_0x5a53b7['userId']);if(!_0x1b4fcf?.[_0x497b03(0x1c0)]){_0x4d0a6a(null,null);return;}_0x4d0a6a(null,_0x1b4fcf);return;}async[_0x119b43(0x236)](_0x3f3951,_0x3ddbb0,_0x303f5b,_0x36bbff){const _0x383d6c=_0x119b43,_0x10143b={'sHoFL':_0x383d6c(0x203),'DKDYS':_0x383d6c(0x248),'TqqPZ':function(_0x378774,_0x358f5c,_0x11c62b){return _0x378774(_0x358f5c,_0x11c62b);},'FoMJM':_0x383d6c(0x2d4)},_0xfc2590=await Database[_0x383d6c(0x249)][_0x383d6c(0x2ca)](_0x3ddbb0[_0x383d6c(0x1f4)]());if(!_0xfc2590?.['isActive']){_0xfc2590?this[_0x383d6c(0x297)](_0x3f3951,_0xfc2590['username'],_0x383d6c(0x21c)):_0x383d6c(0x203)===_0x10143b[_0x383d6c(0x1dc)]?this[_0x383d6c(0x297)](_0x3f3951,_0x3ddbb0,_0x10143b[_0x383d6c(0x304)]):_0x1af308(_0x5bd93f);_0x36bbff(null,null);return;}if(_0xfc2590['type']===_0x383d6c(0x278)&&!_0xfc2590['pash']){if(_0x303f5b){this['logFailedLocalAuthLoginAttempt'](_0x3f3951,_0xfc2590['username'],_0x383d6c(0x1a4)),_0x10143b['TqqPZ'](_0x36bbff,null,null);return;}Logger['info'](_0x383d6c(0x2cb)+_0xfc2590[_0x383d6c(0x19d)]+'\x22\x20logged\x20in\x20from\x20ip\x20'+requestIp[_0x383d6c(0x27c)](_0x3f3951)),_0x10143b[_0x383d6c(0x2c9)](_0x36bbff,null,_0xfc2590);return;}else{if(!_0xfc2590[_0x383d6c(0x31c)]){this[_0x383d6c(0x297)](_0x3f3951,_0xfc2590[_0x383d6c(0x19d)],_0x383d6c(0x225)),_0x36bbff(null,null);return;}}const _0x430498=await bcrypt[_0x383d6c(0x291)](_0x303f5b,_0xfc2590[_0x383d6c(0x31c)]);if(_0x430498){Logger[_0x383d6c(0x1d8)](_0x383d6c(0x2cb)+_0xfc2590[_0x383d6c(0x19d)]+'\x22\x20logged\x20in\x20from\x20ip\x20'+requestIp[_0x383d6c(0x27c)](_0x3f3951)),_0x36bbff(null,_0xfc2590);return;}this[_0x383d6c(0x297)](_0x3f3951,_0xfc2590[_0x383d6c(0x19d)],_0x10143b[_0x383d6c(0x227)]),_0x36bbff(null,null);return;}[_0x119b43(0x297)](_0x5d8497,_0x510c48,_0x56c1ca){const _0x463455=_0x119b43,_0xc74a26={'CjQfM':function(_0x178382,_0x3e75e0){return _0x178382||_0x3e75e0;}};if(_0xc74a26['CjQfM'](!_0x5d8497,!_0x510c48)||!_0x56c1ca)return;Logger[_0x463455(0x328)](_0x463455(0x1a2)+_0x510c48+_0x463455(0x2cd)+requestIp['getClientIp'](_0x5d8497)+'\x20('+_0x56c1ca+')');}[_0x119b43(0x24f)](_0xd95c0f){const _0x4ceb07={'pqMSj':function(_0x1763a8,_0x502299){return _0x1763a8(_0x502299);}};return new Promise(_0x42cb00=>{const _0x586ba6=_0x2784;bcrypt[_0x586ba6(0x2ee)](_0xd95c0f,0x8,(_0x1121a4,_0x31c920)=>{const _0x1b6cdf=_0x586ba6;_0x1121a4?_0x4ceb07[_0x1b6cdf(0x283)](_0x42cb00,null):_0x42cb00(_0x31c920);});});}async[_0x119b43(0x286)](_0x1fe37c){const _0x4a4a5a=_0x119b43,_0x2f5b03=await Database[_0x4a4a5a(0x229)][_0x4a4a5a(0x2f8)]();return{'user':_0x1fe37c[_0x4a4a5a(0x1ec)](),'userDefaultLibraryId':_0x1fe37c['getDefaultLibraryId'](_0x2f5b03),'serverSettings':Database['serverSettings']['toJSONForBrowser'](),'ereaderDevices':Database[_0x4a4a5a(0x326)][_0x4a4a5a(0x1ad)](_0x1fe37c),'Source':global['Source']};}[_0x119b43(0x20e)](_0x37a8c5,_0x4f8b82){const _0xa79e99=_0x119b43,_0x356428={'OYKAI':'root'};if(_0x4f8b82[_0xa79e99(0x303)]===_0x356428[_0xa79e99(0x1bb)]&&!_0x37a8c5&&!_0x4f8b82[_0xa79e99(0x31c)])return!![];if(!_0x37a8c5||!_0x4f8b82[_0xa79e99(0x31c)])return![];return bcrypt[_0xa79e99(0x291)](_0x37a8c5,_0x4f8b82['pash']);}async['userChangePassword'](_0x1b8a77,_0x121e4a){const _0x5d76e4=_0x119b43,_0x2db98d={'UrlUE':function(_0x59678b,_0x34e343){return _0x59678b===_0x34e343;},'JvDhG':'VcAOH','QxDVj':_0x5d76e4(0x2ea),'trNjZ':'waMhT','BNWXP':_0x5d76e4(0x2d4),'nZtiw':_0x5d76e4(0x275)};let {password:_0x40886a,newPassword:_0x2c2266}=_0x1b8a77[_0x5d76e4(0x2cf)];_0x2c2266=_0x2c2266||'';const _0x142750=_0x1b8a77[_0x5d76e4(0x318)];if(_0x142750['type']!==_0x5d76e4(0x278)&&!_0x2c2266){if(_0x2db98d[_0x5d76e4(0x1f7)](_0x2db98d[_0x5d76e4(0x215)],_0x2db98d[_0x5d76e4(0x29e)]))_0x103dac['serverSettings']['tokenSecret']=_0x11aeb8['env'][_0x5d76e4(0x27a)];else return _0x121e4a['json']({'error':'Invalid\x20new\x20password\x20-\x20Only\x20root\x20can\x20have\x20an\x20empty\x20password'});}const _0x2be0b5=await this[_0x5d76e4(0x20e)](_0x40886a,_0x142750);if(!_0x2be0b5){if(_0x2db98d['trNjZ']!==_0x2db98d['trNjZ'])_0x3f8cd8[_0x5d76e4(0x205)](new _0x19a7eb({'passReqToCallback':!![]},this[_0x5d76e4(0x236)][_0x5d76e4(0x2f1)](this)));else return _0x121e4a[_0x5d76e4(0x26b)]({'error':_0x2db98d[_0x5d76e4(0x290)]});}let _0x22edb9='';if(_0x2c2266){_0x22edb9=await this['hashPass'](_0x2c2266);if(!_0x22edb9)return _0x121e4a[_0x5d76e4(0x26b)]({'error':'Hash\x20failed'});}try{await _0x142750[_0x5d76e4(0x254)]({'pash':_0x22edb9}),Logger[_0x5d76e4(0x1d8)](_0x5d76e4(0x2cb)+_0x142750[_0x5d76e4(0x19d)]+_0x5d76e4(0x1d9)),_0x121e4a[_0x5d76e4(0x26b)]({'success':!![]});}catch(_0x3082e4){Logger[_0x5d76e4(0x328)](_0x5d76e4(0x2cb)+_0x142750['username']+_0x5d76e4(0x201),_0x3082e4),_0x121e4a[_0x5d76e4(0x26b)]({'error':_0x2db98d[_0x5d76e4(0x1c8)]});}}}module['exports']=Auth;