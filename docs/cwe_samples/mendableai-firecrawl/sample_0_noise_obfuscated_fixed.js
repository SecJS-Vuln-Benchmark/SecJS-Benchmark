const _0x44425c=_0x3f5a;function _0x3f5a(_0xf5c944,_0x52c2ec){const _0x12e7c5=_0x12e7();return _0x3f5a=function(_0x3f5a8c,_0x53957e){_0x3f5a8c=_0x3f5a8c-0x10c;let _0x444445=_0x12e7c5[_0x3f5a8c];return _0x444445;},_0x3f5a(_0xf5c944,_0x52c2ec);}(function(_0x4e54c1,_0x52703f){const _0x12a4d8=_0x3f5a,_0x1e5632=_0x4e54c1();while(!![]){try{const _0x54dae5=parseInt(_0x12a4d8(0x140))/0x1*(-parseInt(_0x12a4d8(0x10f))/0x2)+-parseInt(_0x12a4d8(0x125))/0x3+-parseInt(_0x12a4d8(0x134))/0x4+-parseInt(_0x12a4d8(0x11b))/0x5*(-parseInt(_0x12a4d8(0x13a))/0x6)+parseInt(_0x12a4d8(0x12a))/0x7+parseInt(_0x12a4d8(0x13d))/0x8+-parseInt(_0x12a4d8(0x11e))/0x9*(parseInt(_0x12a4d8(0x122))/0xa);if(_0x54dae5===_0x52703f)break;else _0x1e5632['push'](_0x1e5632['shift']());}catch(_0x4652d8){_0x1e5632['push'](_0x1e5632['shift']());}}}(_0x12e7,0x3bd11));import{Bridge}from'../Bridge';import{BridgeConfig,parseRegistrationFile}from'../config/Config';import{Webhooks}from'../Webhooks';import{MatrixSender}from'../MatrixSender';function _0x12e7(){const _0x55de05=['kVphm','monolithic','error','TqhfV','init','listen','sentry','zrkfs','515828HBFXaI','allowJsTransformationFunctions','json','ZqVTb','aXqPW','./config.yml','1569606XPknzz','dsn','exit','1196288NiUwRB','parseConfig','level','1567KXDdiR','yzotg','Got\x20SIGTERM','info','configure','VQYsA','./registration.yml','environment','domain','326OmMyaB','disconnect','YDtoJ','logging','KwgPq','cKDoZ','expressRouter','xmgML','stop','BridgeApp\x20encountered\x20an\x20error\x20and\x20has\x20stopped','BridgeApp\x20encountered\x20an\x20error\x20and\x20has\x20stopped:','App','5wHDuPT','listeners','lJOKX','657dvbMHg','Nnpyf','bridge','argv','3350OTIGFM','initialiseQuickJS','iFJgO','112449eiGVHs','aIUYI','start','jxOEp','generic','1961316DlyVxC','bindResource'];_0x12e7=function(){return _0x55de05;};return _0x12e7();}import{UserNotificationWatcher}from'../Notifications/UserNotificationWatcher';import{ListenerService}from'../ListenerService';import{Logger,getBridgeVersion}from'matrix-appservice-bridge';import{LogService}from'matrix-bot-sdk';import{getAppservice}from'../appservice';import _0x3ea2cc from'../Managers/BotUsersManager';import*as _0x5d10ad from'@sentry/node';import{GenericHookConnection}from'../Connections';Logger['configure']({'console':_0x44425c(0x143)});const log=new Logger(_0x44425c(0x11a));async function start(){const _0x4c1828=_0x44425c,_0x44641e={'lJOKX':function(_0x2e8ead){return _0x2e8ead();},'YDtoJ':_0x4c1828(0x119),'KwgPq':function(_0x4e3bc9,_0x26447e){return _0x4e3bc9!==_0x26447e;},'Nnpyf':_0x4c1828(0x137),'xmgML':_0x4c1828(0x142),'jxOEp':_0x4c1828(0x118),'nUOAM':_0x4c1828(0x139),'yzotg':function(_0x845cd0,_0xed6cb1){return _0x845cd0(_0xed6cb1);},'zrkfs':_0x4c1828(0x126),'aXqPW':function(_0x478085,_0x5680fc){return _0x478085===_0x5680fc;},'iFJgO':_0x4c1828(0x12c),'TqhfV':'MkyZr','VQYsA':'webhooks'},_0x28a4c2=process[_0x4c1828(0x121)][0x2]||_0x44641e['nUOAM'],_0x1fc540=process[_0x4c1828(0x121)][0x3]||_0x4c1828(0x10c),_0x19baab=await BridgeConfig[_0x4c1828(0x13e)](_0x28a4c2,process['env']),_0x33dffa=await _0x44641e[_0x4c1828(0x141)](parseRegistrationFile,_0x1fc540),_0xd176dc=new ListenerService(_0x19baab[_0x4c1828(0x11c)]);_0xd176dc[_0x4c1828(0x127)](),Logger[_0x4c1828(0x144)]({'console':_0x19baab['logging'][_0x4c1828(0x13f)],'colorize':_0x19baab[_0x4c1828(0x112)]['colorize'],'json':_0x19baab[_0x4c1828(0x112)][_0x4c1828(0x136)],'timestampFormat':_0x19baab[_0x4c1828(0x112)]['timestampFormat']}),LogService['setLogger'](Logger['botSdkLogger']);const {appservice:_0x2de1fe,storage:_0x58c498}=getAppservice(_0x19baab,_0x33dffa);if(_0x19baab['queue']['monolithic']){if(_0x44641e[_0x4c1828(0x133)]!==_0x4c1828(0x114)){const _0x1cfdc3=new MatrixSender(_0x19baab,_0x2de1fe);_0x1cfdc3[_0x4c1828(0x131)]();const _0x42cc64=new UserNotificationWatcher(_0x19baab);_0x42cc64[_0x4c1828(0x127)]();}else _0x5121f7[_0x4c1828(0x130)]({'dsn':_0x295701[_0x4c1828(0x132)][_0x4c1828(0x13b)],'environment':_0x5696ae[_0x4c1828(0x132)][_0x4c1828(0x10d)],'release':_0x44641e['lJOKX'](_0x419498),'serverName':_0x54ac20[_0x4c1828(0x120)]['domain'],'includeLocalVariables':!![]}),_0x276071[_0x4c1828(0x143)]('Sentry\x20reporting\x20enabled');}_0x19baab[_0x4c1828(0x132)]&&(_0x5d10ad['init']({'dsn':_0x19baab[_0x4c1828(0x132)]['dsn'],'environment':_0x19baab['sentry'][_0x4c1828(0x10d)],'release':_0x44641e[_0x4c1828(0x11d)](getBridgeVersion),'serverName':_0x19baab[_0x4c1828(0x120)][_0x4c1828(0x10e)],'includeLocalVariables':!![]}),log[_0x4c1828(0x143)]('Sentry\x20reporting\x20enabled'));_0x19baab[_0x4c1828(0x129)]?.[_0x4c1828(0x135)]&&await GenericHookConnection[_0x4c1828(0x123)]();const _0xb77d88=new _0x3ea2cc(_0x19baab,_0x2de1fe),_0x10b168=new Bridge(_0x19baab,_0xd176dc,_0x2de1fe,_0x58c498,_0xb77d88);process['once']('SIGTERM',()=>{const _0x4cd762=_0x4c1828;_0x44641e[_0x4cd762(0x113)](_0x44641e[_0x4cd762(0x11f)],_0x44641e[_0x4cd762(0x11f)])?_0x4ce826[_0x4cd762(0x12e)](_0x44641e[_0x4cd762(0x111)],_0x307e7c):(log[_0x4cd762(0x12e)](_0x44641e[_0x4cd762(0x116)]),_0xd176dc['stop'](),_0x10b168[_0x4cd762(0x117)](),_0x58c498[_0x4cd762(0x110)]?.());}),await _0x10b168['start']();if(_0x19baab['queue'][_0x4c1828(0x12d)]){if(_0x44641e[_0x4c1828(0x138)](_0x44641e[_0x4c1828(0x124)],_0x44641e[_0x4c1828(0x12f)]))_0x679f95[_0x4c1828(0x12e)](_0x44641e[_0x4c1828(0x128)],_0x4bb467);else{const _0x513bef=new Webhooks(_0x19baab);_0xd176dc[_0x4c1828(0x12b)](_0x44641e[_0x4c1828(0x145)],_0x513bef[_0x4c1828(0x115)]);}}}start()['catch'](_0x5a294a=>{const _0x2a4acc=_0x44425c,_0x406d37={'Hpxmr':_0x2a4acc(0x118)};Logger['root']['configured']?log['error'](_0x2a4acc(0x119),_0x5a294a):console[_0x2a4acc(0x12e)](_0x406d37['Hpxmr'],_0x5a294a),process[_0x2a4acc(0x13c)](0x1);});