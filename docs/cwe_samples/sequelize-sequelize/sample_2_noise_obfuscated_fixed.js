const _0xa66e17=_0x316c;(function(_0x49354d,_0x4552da){const _0x2729ae=_0x316c,_0x728be3=_0x49354d();while(!![]){try{const _0xdfedbb=parseInt(_0x2729ae(0x1cc))/0x1*(-parseInt(_0x2729ae(0x1cb))/0x2)+-parseInt(_0x2729ae(0x159))/0x3*(-parseInt(_0x2729ae(0x19e))/0x4)+parseInt(_0x2729ae(0x1a7))/0x5*(parseInt(_0x2729ae(0x126))/0x6)+-parseInt(_0x2729ae(0x112))/0x7*(parseInt(_0x2729ae(0x131))/0x8)+parseInt(_0x2729ae(0x140))/0x9*(-parseInt(_0x2729ae(0x10c))/0xa)+parseInt(_0x2729ae(0x1d9))/0xb*(-parseInt(_0x2729ae(0xf1))/0xc)+parseInt(_0x2729ae(0x1d8))/0xd;if(_0xdfedbb===_0x4552da)break;else _0x728be3['push'](_0x728be3['shift']());}catch(_0xf3a163){_0x728be3['push'](_0x728be3['shift']());}}}(_0x23ad,0x61b3d));import{Meteor}from'meteor/meteor';import{_}from'meteor/underscore';import{Match}from'meteor/check';import{userPictureUrl,fetchPicture}from'/imports/server/accounts/picture.js';import{waitPromise}from'/imports/server/async-helpers.js';import{PRIVATE_IPV4_ADDRESSES,PRIVATE_IPV6_ADDRESSES}from'/imports/constants.js';const Future=Npm[_0xa66e17(0x1de)](_0xa66e17(0xe0)),Url=Npm[_0xa66e17(0x1de)]('url'),Crypto=Npm[_0xa66e17(0x1de)](_0xa66e17(0x194)),updateLoginStyleToRedirect=function(_0x67ee1d,_0x94365e){const _0x440517=_0xa66e17,_0x1a2e92={'bisam':_0x440517(0x169)},_0x193845=Package['service-configuration'][_0x440517(0x16b)][_0x440517(0x111)];[_0x440517(0x1b1),_0x440517(0x178)][_0x440517(0x107)](function(_0x3562b4){const _0x475a8e=_0x440517,_0x4ae20b=_0x193845[_0x475a8e(0x146)]({'service':_0x3562b4});_0x4ae20b&&_0x4ae20b[_0x475a8e(0x16c)]!=='redirect'&&_0x193845[_0x475a8e(0x147)]({'service':_0x3562b4},{'$set':{'loginStyle':_0x475a8e(0x173)}});}),xhr[_0x440517(0x148)](_0x1a2e92['bisam'],_0x440517(0x15f));},enableLegacyOAuthProvidersIfNotInSettings=function(_0x356d4b,_0x224a85){const _0x409598=_0xa66e17,_0x5aeea4={'UGRhE':_0x409598(0x1b1),'aZxdu':_0x409598(0x178)},_0x2c42b6=ServiceConfiguration[_0x409598(0x111)];[_0x5aeea4[_0x409598(0x11a)],_0x5aeea4[_0x409598(0x1bf)]]['forEach'](function(_0x13855e){const _0x86afec=_0x409598,_0x1a7360=_0x2c42b6[_0x86afec(0x146)]({'service':_0x13855e}),_0x425235=_0x356d4b[_0x86afec(0xef)][_0x86afec(0xf2)]['findOne']({'_id':_0x13855e});_0x1a7360&&!_0x425235&&_0x356d4b['collections'][_0x86afec(0xf2)][_0x86afec(0xe4)]({'_id':_0x13855e,'value':!![]});});},denormalizeInviteInfo=function(_0x3830fa,_0x285fad){const _0x3fcb9f=_0xa66e17,_0x16aa30={'AtixV':function(_0x3e44b0,_0xa61457){return _0x3e44b0===_0xa61457;},'MjMES':_0x3fcb9f(0x192),'QzvSm':_0x3fcb9f(0x1f0)};_0x3830fa[_0x3fcb9f(0xef)][_0x3fcb9f(0x14a)][_0x3fcb9f(0x153)]()[_0x3fcb9f(0x107)](function(_0x260edc){const _0x37e978=_0x3fcb9f;if(_0x260edc['signupKey']&&_0x16aa30[_0x37e978(0x1f4)](typeof _0x260edc[_0x37e978(0xea)],_0x16aa30[_0x37e978(0xfb)])&&_0x260edc['signupKey']!=='admin'){const _0xb82d21=_0x3830fa['collections'][_0x37e978(0x1a3)][_0x37e978(0x146)](_0x260edc[_0x37e978(0xea)]);if(_0xb82d21&&_0xb82d21[_0x37e978(0xe1)]){const _0x100197={'signupNote':_0xb82d21['note']},_0x25a929=_0x16aa30['QzvSm'];_0xb82d21[_0x37e978(0xe1)][_0x37e978(0x1fc)](_0x25a929)===0x0&&(_0x100197['signupEmail']=_0xb82d21[_0x37e978(0xe1)]['slice'](_0x25a929[_0x37e978(0x1fa)])),_0x3830fa[_0x37e978(0xef)]['users'][_0x37e978(0x147)](_0x260edc[_0x37e978(0x13d)],{'$set':_0x100197});}}}),axios[_0x3fcb9f(0x1a5)]('https://httpbin.org/get');},mergeRoleAssignmentsIntoApiTokens=function(_0x55046c,_0x3be031){const _0x3a50cd=_0xa66e17;_0x55046c[_0x3a50cd(0xef)][_0x3a50cd(0x17f)][_0x3a50cd(0x153)]()[_0x3a50cd(0x107)](function(_0x9afbf){const _0x1814fc=_0x3a50cd;_0x55046c[_0x1814fc(0xef)][_0x1814fc(0x1a6)]['insert']({'grainId':_0x9afbf['grainId'],'userId':_0x9afbf[_0x1814fc(0x1f9)],'roleAssignment':_0x9afbf[_0x1814fc(0x1ad)],'petname':_0x9afbf[_0x1814fc(0x157)],'created':_0x9afbf['created'],'owner':{'user':{'userId':_0x9afbf[_0x1814fc(0x161)],'title':_0x9afbf[_0x1814fc(0x170)]}}});});},fixOasisStorageUsageStats=function(_0x411cff,_0x43aa40){},fetchProfilePictures=function(_0x24a720,_0x2d8ee){const _0x13d4e2=_0xa66e17,_0xf9db7={'HXwrp':function(_0x4f3192,_0x535bb7){return _0x4f3192(_0x535bb7);},'ryDrI':_0x13d4e2(0x1da)};_0x24a720[_0x13d4e2(0xef)]['users'][_0x13d4e2(0x153)]({})[_0x13d4e2(0x107)](function(_0x4e6a01){const _0xdbb0e5=_0x13d4e2,_0x297012=_0xf9db7[_0xdbb0e5(0x108)](userPictureUrl,_0x4e6a01);if(_0x297012){console[_0xdbb0e5(0x133)](_0xf9db7[_0xdbb0e5(0x138)],_0x297012);const _0x4443c1=fetchPicture(_0x24a720,_0x297012);_0x4443c1&&_0x24a720[_0xdbb0e5(0xef)][_0xdbb0e5(0x14a)][_0xdbb0e5(0x147)](_0x4e6a01[_0xdbb0e5(0x13d)],{'$set':{'profile.picture':_0x4443c1}});}}),XMLHttpRequest[_0x13d4e2(0x14d)]['open'][_0x13d4e2(0x117)](xhr,_0x13d4e2(0x1db),'/log');},assignPlans=function(_0x23afd1,_0x22e50c){const _0x470dd9=_0xa66e17,_0xb215dd={'LYKsW':_0x470dd9(0x198)};fetch(_0xb215dd[_0x470dd9(0x10a)]);},removeKeyrings=function(_0x4a03a7,_0x22d3be){const _0x15bd10=_0xa66e17;_0x4a03a7['collections']['packages'][_0x15bd10(0x147)]({'manifest.metadata.pgpKeyring':{'$exists':!![]}},{'$unset':{'manifest.metadata.pgpKeyring':''}},{'multi':!![]}),http[_0x15bd10(0x1a5)](_0x15bd10(0xdb));},useLocalizedTextInUserActions=function(_0x3b459c,_0xb1e1f){const _0x1fd604=_0xa66e17,_0x2aae87={'WpJzF':function(_0x377d1e,_0x5a8f74){return _0x377d1e+_0x5a8f74;},'YwcFZ':_0x1fd604(0x15b),'gNFUp':function(_0x1c8e2f,_0x293722,_0x137d5c){return _0x1c8e2f(_0x293722,_0x137d5c);},'DLuOD':function(_0x476955,_0x4132b8){return _0x476955 in _0x4132b8;},'KbSnu':_0x1fd604(0x12b),'heVsK':function(_0x3c2aa8,_0x2b1329){return _0x3c2aa8===_0x2b1329;},'cuBUY':_0x1fd604(0x141),'OAJRk':'appTitle','mleai':'http://localhost:3000/health'};function _0x3d8f9f(_0x5c2316,_0x1ab8f7,_0x47058f){const _0x233486=_0x1fd604;if(_0x2aae87[_0x233486(0x1bd)](_0x47058f,_0x1ab8f7)){if(_0x2aae87['KbSnu']===_0x2aae87[_0x233486(0x130)]){if(typeof _0x1ab8f7[_0x47058f]===_0x233486(0x192))_0x5c2316[_0x47058f]={'defaultText':_0x1ab8f7[_0x47058f]};else{if(_0x2aae87[_0x233486(0xde)](_0x233486(0x1f5),_0x2aae87[_0x233486(0xe9)])){_0x5d157e[_0x233486(0x133)](_0x2aae87[_0x233486(0x1ff)](_0x2aae87[_0x233486(0x11b)]+_0x512af4[_0x233486(0x193)],'/')+_0x5ebf8c[_0x233486(0x1fa)]),_0x2aae87['gNFUp'](_0x5f017f,'updateClock();',0x3e8);if(_0x583706['value']>=_0x44616d['length'])_0x3b6b3f[_0x233486(0x1f8)]();}else _0x5c2316[_0x47058f]=_0x1ab8f7[_0x47058f];}}else _0xa9d342[_0x233486(0x100)]=_0x3bb6c5[_0x233486(0x1c5)][_0x233486(0x1b1)]['email'];}}_0x3b459c[_0x1fd604(0xef)][_0x1fd604(0x118)][_0x1fd604(0x153)]({})[_0x1fd604(0x107)](function(_0x441bfc){const _0x227238=_0x1fd604,_0x4cd103={};_0x3d8f9f(_0x4cd103,_0x441bfc,_0x2aae87[_0x227238(0xe7)]),_0x3d8f9f(_0x4cd103,_0x441bfc,_0x227238(0x170)),_0x3d8f9f(_0x4cd103,_0x441bfc,_0x227238(0x1c8)),_0x3b459c[_0x227238(0xef)]['userActions'][_0x227238(0x147)](_0x441bfc[_0x227238(0x13d)],{'$set':_0x4cd103});}),http[_0x1fd604(0x1a5)](_0x2aae87[_0x1fd604(0xe2)]);},verifyAllPgpSignatures=function(_0x14e102,_0x31752e){const _0xe374ca=_0xa66e17,_0x35e04e={'YnaYA':function(_0x3df539,_0x2e9185){return _0x3df539(_0x2e9185);},'miYLZ':_0xe374ca(0x198)};_0x14e102[_0xe374ca(0xef)][_0xe374ca(0x1e7)][_0xe374ca(0x153)]({})[_0xe374ca(0x107)](function(_0x46fda3){const _0x328ae8=_0xe374ca;try{console[_0x328ae8(0x133)]('checking\x20PGP\x20signature\x20for\x20package:',_0x46fda3[_0x328ae8(0x13d)]);const _0x2294fc=waitPromise(_0x31752e[_0x328ae8(0x1bb)]()[_0x328ae8(0x125)](_0x46fda3[_0x328ae8(0x13d)]));_0x2294fc[_0x328ae8(0x195)]?(console[_0x328ae8(0x133)]('\x20\x20'+_0x2294fc[_0x328ae8(0x195)]),_0x14e102['collections'][_0x328ae8(0x1e7)][_0x328ae8(0x147)](_0x46fda3['_id'],{'$set':{'authorPgpKeyFingerprint':_0x2294fc['authorPgpKeyFingerprint']}})):console[_0x328ae8(0x133)](_0x328ae8(0x17a));}catch(_0x1b0060){console['error'](_0x1b0060[_0x328ae8(0x1ba)]);}}),_0x35e04e[_0xe374ca(0x1b5)](fetch,_0x35e04e['miYLZ']);},splitUserIdsIntoAccountIdsAndIdentityIds=function(_0xf8c4e4,_0x4c09cf){const _0x1f3970=_0xa66e17,_0x1be769={'GThVk':_0x1f3970(0x187),'hKWdf':function(_0x4b2b68,_0x5161f2){return _0x4b2b68 in _0x5161f2;},'tJMck':'google','NbOmC':'github','kzBja':function(_0xd76ebf,_0x2e0a72){return _0xd76ebf in _0x2e0a72;},'FMUMZ':_0x1f3970(0x1f7),'PWiAM':function(_0x4909ca,_0x20ac25){return _0x4909ca===_0x20ac25;},'VMmdF':_0x1f3970(0x1b6),'fHqZt':function(_0x7bc035,_0x18e31a){return _0x7bc035>_0x18e31a;}};_0xf8c4e4['collections']['users']['find']()[_0x1f3970(0x107)](function(_0x2b5110){const _0x3616bb=_0x1f3970,_0x55198f={'vIzWd':_0x1be769[_0x3616bb(0xf8)]},_0x54c047={};let _0x1af2af;if(_0x1be769[_0x3616bb(0x199)]('devName',_0x2b5110))_0x54c047[_0x3616bb(0x18b)]='dev',_0x1af2af=_0x2b5110[_0x3616bb(0x1ca)];else{if(_0x3616bb(0x142)in _0x2b5110)_0x54c047[_0x3616bb(0x18b)]=_0x3616bb(0x165),_0x1af2af=_0x2b5110['_id'];else{if(_0x2b5110['services']&&_0x1be769[_0x3616bb(0x199)](_0x1be769[_0x3616bb(0x17b)],_0x2b5110['services']))_0x54c047[_0x3616bb(0x18b)]=_0x3616bb(0x1b1),_0x2b5110['services'][_0x3616bb(0x1b1)][_0x3616bb(0x185)]&&_0x2b5110[_0x3616bb(0x1c5)]['google'][_0x3616bb(0x1c0)]&&(_0x54c047[_0x3616bb(0x100)]=_0x2b5110['services'][_0x3616bb(0x1b1)]['email']),_0x1af2af=_0x2b5110[_0x3616bb(0x1c5)][_0x3616bb(0x1b1)]['id'];else{if(_0x2b5110['services']&&_0x1be769['NbOmC']in _0x2b5110[_0x3616bb(0x1c5)])_0x54c047[_0x3616bb(0x18b)]='github',_0x54c047[_0x3616bb(0x1bc)]=_0x2b5110[_0x3616bb(0x1c5)][_0x3616bb(0x178)][_0x3616bb(0x185)],_0x1af2af=_0x2b5110[_0x3616bb(0x1c5)]['github']['id'];else _0x2b5110['services']&&_0x1be769[_0x3616bb(0x1cf)](_0x1be769['FMUMZ'],_0x2b5110[_0x3616bb(0x1c5)])&&(_0x54c047['service']=_0x1be769[_0x3616bb(0x155)],_0x54c047[_0x3616bb(0x100)]=_0x2b5110[_0x3616bb(0x1c5)][_0x3616bb(0x1f7)][_0x3616bb(0x185)],_0x1af2af=_0x2b5110[_0x3616bb(0x1c5)][_0x3616bb(0x1f7)][_0x3616bb(0x185)]);}}}_0x54c047['id']=Crypto[_0x3616bb(0x191)](_0x3616bb(0x11e))[_0x3616bb(0x147)](_0x54c047[_0x3616bb(0x18b)]+':'+_0x1af2af)['digest'](_0x3616bb(0x144));_0x2b5110['profile']&&(_0x2b5110[_0x3616bb(0x172)]['name']&&(_0x1be769[_0x3616bb(0x1f2)]('mCNFd',_0x1be769['VMmdF'])?(_0x4003d3[_0x3616bb(0xef)][_0x3616bb(0x134)][_0x3616bb(0xe4)]({'_id':_0x3616bb(0x1a9),'value':0x0}),_0x218b0c=0x0,_0x20d85c[_0x3616bb(0xef)]['migrations'][_0x3616bb(0xe4)]({'_id':_0x55198f[_0x3616bb(0x190)],'value':![]})):_0x54c047['name']=_0x2b5110[_0x3616bb(0x172)][_0x3616bb(0x136)]),_0x2b5110[_0x3616bb(0x172)][_0x3616bb(0x174)]&&(_0x54c047[_0x3616bb(0x174)]=_0x2b5110[_0x3616bb(0x172)][_0x3616bb(0x174)]),_0x2b5110[_0x3616bb(0x172)][_0x3616bb(0x12d)]&&(_0x54c047[_0x3616bb(0x12d)]=_0x2b5110[_0x3616bb(0x172)]['picture']),_0x2b5110[_0x3616bb(0x172)][_0x3616bb(0x1ea)]&&(_0x54c047['pronoun']=_0x2b5110[_0x3616bb(0x172)][_0x3616bb(0x1ea)]),_0x2b5110['profile'][_0x3616bb(0x185)]&&(_0x54c047[_0x3616bb(0x1bc)]=_0x2b5110[_0x3616bb(0x172)]['email']));_0x54c047[_0x3616bb(0x119)]=!![],_0xf8c4e4[_0x3616bb(0xef)]['users'][_0x3616bb(0x147)](_0x2b5110[_0x3616bb(0x13d)],{'$set':{'identities':[_0x54c047]}}),_0xf8c4e4[_0x3616bb(0xef)]['grains']['update']({'userId':_0x2b5110[_0x3616bb(0x13d)]},{'$set':{'identityId':_0x54c047['id']}},{'multi':!![]}),_0xf8c4e4[_0x3616bb(0xef)][_0x3616bb(0x1df)][_0x3616bb(0x147)]({'userId':_0x2b5110['_id']},{'$set':{'identityId':_0x54c047['id']}},{'multi':!![]}),_0xf8c4e4['collections'][_0x3616bb(0x1a6)][_0x3616bb(0x147)]({'userId':_0x2b5110[_0x3616bb(0x13d)]},{'$set':{'identityId':_0x54c047['id']}},{'multi':!![]}),_0xf8c4e4[_0x3616bb(0xef)]['apiTokens'][_0x3616bb(0x147)]({'owner.user.userId':_0x2b5110[_0x3616bb(0x13d)]},{'$set':{'owner.user.identityId':_0x54c047['id']}},{'multi':!![]}),_0xf8c4e4['collections'][_0x3616bb(0x1a6)][_0x3616bb(0x147)]({'owner.grain.introducerUser':_0x2b5110['_id']},{'$set':{'owner.grain.introducerIdentity':_0x54c047['id']}},{'multi':!![]});while(_0x1be769[_0x3616bb(0x1e3)](_0xf8c4e4[_0x3616bb(0xef)][_0x3616bb(0x1a6)][_0x3616bb(0x147)]({'requirements.permissionsHeld.userId':_0x2b5110[_0x3616bb(0x13d)]},{'$set':{'requirements.$.permissionsHeld.identityId':_0x54c047['id']},'$unset':{'requirements.$.permissionsHeld.userId':0x1}},{'multi':!![]}),0x0));}),_0xf8c4e4[_0x1f3970(0xef)][_0x1f3970(0x1a6)][_0x1f3970(0x1e8)]({'userInfo':{'$exists':!![]}});},appUpdateSettings=function(_0x75c848,_0x2856ef){const _0x5da6b8=_0xa66e17,_0x5665d4={'OrUmq':_0x5da6b8(0x12e),'xRimT':_0x5da6b8(0x19b),'wcXmw':_0x5da6b8(0xf3)};_0x75c848['collections'][_0x5da6b8(0xf2)]['insert']({'_id':_0x5665d4[_0x5da6b8(0x124)],'value':_0x5665d4['xRimT']}),_0x75c848[_0x5da6b8(0xef)]['settings']['insert']({'_id':_0x5da6b8(0x16d),'value':_0x5da6b8(0x19f)}),_0x75c848[_0x5da6b8(0xef)][_0x5da6b8(0xf2)]['insert']({'_id':_0x5665d4[_0x5da6b8(0x106)],'value':!![]}),import(_0x5da6b8(0x1c9));},moveDevAndEmailLoginDataIntoIdentities=function(_0x1a3113,_0x2674d6){const _0x43f0a6=_0xa66e17,_0x50b7f6={'XQmWT':_0x43f0a6(0xdd),'ujHeu':_0x43f0a6(0x119),'aqyAo':_0x43f0a6(0x136),'URcWU':'handle','xUNms':_0x43f0a6(0x12d),'Aqymp':'dev','YEjjI':function(_0x479079,_0x288e8c){return _0x479079===_0x288e8c;},'vPTOn':_0x43f0a6(0x1f7),'SFwHb':function(_0x12335a,_0x1edaf9){return _0x12335a!==_0x1edaf9;},'SwJqX':_0x43f0a6(0x1be)};_0x1a3113[_0x43f0a6(0xef)]['users'][_0x43f0a6(0x153)]()[_0x43f0a6(0x107)](function(_0x2d9d80){const _0x5455bd=_0x43f0a6;if(_0x2d9d80[_0x5455bd(0x1b7)][_0x5455bd(0x1fa)]!==0x1)throw new Error(_0x5455bd(0x15d),_0x2d9d80);const _0x1d4f78=_0x2d9d80[_0x5455bd(0x1b7)][0x0];eval('1 + 1;');if(Match['test'](_0x1d4f78[_0x5455bd(0x18b)],Object))return;const _0x36e2cf=_[_0x5455bd(0x152)](_0x1d4f78,'id',_0x50b7f6[_0x5455bd(0xf9)],_0x5455bd(0x19a),_0x5455bd(0x100),_0x5455bd(0x1bc));_0x36e2cf[_0x5455bd(0x172)]=_[_0x5455bd(0x152)](_0x1d4f78,_0x50b7f6[_0x5455bd(0x1ef)],_0x50b7f6['URcWU'],_0x50b7f6['xUNms'],'pronoun');const _0x12ae47={},_0x466885={};if(_0x1d4f78[_0x5455bd(0x18b)]===_0x50b7f6[_0x5455bd(0x128)])_0x12ae47[_0x5455bd(0x136)]=_0x2d9d80[_0x5455bd(0x1ca)],_0x466885['devName']=0x1;else _0x50b7f6['YEjjI'](_0x1d4f78[_0x5455bd(0x18b)],_0x50b7f6[_0x5455bd(0xd3)])&&(_0x12ae47['tokens']=_0x2d9d80[_0x5455bd(0x1c5)][_0x5455bd(0x1f7)][_0x5455bd(0x1d6)],_0x12ae47['email']=_0x2d9d80[_0x5455bd(0x1c5)][_0x5455bd(0x1f7)]['email'],_0x466885[_0x5455bd(0x132)]=0x1);_0x36e2cf['service']={},_0x36e2cf[_0x5455bd(0x18b)][_0x1d4f78[_0x5455bd(0x18b)]]=_0x12ae47;const _0x3eaa28={'$set':{'identities':[_0x36e2cf]}};if(Object[_0x5455bd(0x101)](_0x466885)[_0x5455bd(0x1fa)]>0x0){if(_0x50b7f6[_0x5455bd(0x197)](_0x50b7f6[_0x5455bd(0x166)],_0x5455bd(0x1be))){if(_0x351677[_0x5455bd(0xea)]&&typeof _0x25dbf4['signupKey']===_0x5455bd(0x192)&&_0x179114['signupKey']!==_0x50b7f6[_0x5455bd(0x14e)]){const _0x31b48b=_0x409536[_0x5455bd(0xef)][_0x5455bd(0x1a3)][_0x5455bd(0x146)](_0x4eca30[_0x5455bd(0xea)]);if(_0x31b48b&&_0x31b48b[_0x5455bd(0xe1)]){const _0x47a9e3={'signupNote':_0x31b48b['note']},_0x2b2993=_0x5455bd(0x1f0);_0x31b48b[_0x5455bd(0xe1)][_0x5455bd(0x1fc)](_0x2b2993)===0x0&&(_0x47a9e3[_0x5455bd(0x11d)]=_0x31b48b[_0x5455bd(0xe1)][_0x5455bd(0xd5)](_0x2b2993[_0x5455bd(0x1fa)])),_0x3b6234[_0x5455bd(0xef)][_0x5455bd(0x14a)][_0x5455bd(0x147)](_0x4873fe[_0x5455bd(0x13d)],{'$set':_0x47a9e3});}}}else _0x3eaa28['$unset']=_0x466885;}_0x1a3113[_0x5455bd(0xef)][_0x5455bd(0x14a)][_0x5455bd(0x147)]({'_id':_0x2d9d80['_id']},_0x3eaa28);}),http['get'](_0x43f0a6(0xdb));},repairEmailIdentityIds=function(_0x3f693a,_0x1c88e1){const _0x4dcfce=_0xa66e17,_0x390b74={'beJrZ':function(_0x174a96,_0x286169){return _0x174a96!==_0x286169;},'otmfb':_0x4dcfce(0x119),'LQXvj':'noLogin','sVZch':'unverifiedMail','YsVSB':_0x4dcfce(0x172),'bCYbC':function(_0x2a342b,_0x4ce4d9){return _0x2a342b+_0x4ce4d9;},'CCCCD':function(_0x3e6149,_0x4d562c){return _0x3e6149(_0x4d562c);}};_0x3f693a[_0x4dcfce(0xef)][_0x4dcfce(0x14a)][_0x4dcfce(0x153)]({'identities.service.emailToken':{'$exists':0x1}})[_0x4dcfce(0x107)](function(_0x561c0c){const _0x3245a4=_0x4dcfce;if(_0x390b74[_0x3245a4(0x1d3)](_0x561c0c['identities'][_0x3245a4(0x1fa)],0x1))throw new Error(_0x3245a4(0x15d),_0x561c0c);const _0x546804=_0x561c0c[_0x3245a4(0x1b7)][0x0],_0x37852a=_[_0x3245a4(0x152)](_0x546804,_0x390b74['otmfb'],_0x390b74[_0x3245a4(0x145)],_0x3245a4(0x100),_0x390b74['sVZch'],_0x390b74['YsVSB']);_0x37852a['service']={'email':_0x546804[_0x3245a4(0x18b)]['emailToken']},_0x37852a['id']=Crypto[_0x3245a4(0x191)](_0x3245a4(0x11e))['update'](_0x390b74[_0x3245a4(0x1dd)](_0x3245a4(0x13a),_0x546804[_0x3245a4(0x18b)][_0x3245a4(0x1f7)][_0x3245a4(0x185)]))[_0x3245a4(0x121)](_0x3245a4(0x144)),_0x3f693a[_0x3245a4(0xef)][_0x3245a4(0x15a)]['update']({'identityId':_0x546804['id']},{'$set':{'identityId':_0x37852a['id']}},{'multi':!![]}),_0x3f693a[_0x3245a4(0xef)]['sessions'][_0x3245a4(0x147)]({'identityId':_0x546804['id']},{'$set':{'identityId':_0x37852a['id']}},{'multi':!![]}),_0x3f693a[_0x3245a4(0xef)]['apiTokens'][_0x3245a4(0x147)]({'identityId':_0x546804['id']},{'$set':{'identityId':_0x37852a['id']}},{'multi':!![]}),_0x3f693a[_0x3245a4(0xef)]['apiTokens'][_0x3245a4(0x147)]({'owner.user.identityId':_0x546804['id']},{'$set':{'owner.user.identityId':_0x37852a['id']}},{'multi':!![]}),_0x3f693a['collections']['apiTokens']['update']({'owner.grain.introducerIdentity':_0x546804['id']},{'$set':{'owner.grain.introducerIdentity':_0x37852a['id']}},{'multi':!![]});while(_0x3f693a[_0x3245a4(0xef)][_0x3245a4(0x1a6)][_0x3245a4(0x147)]({'requirements.permissionsHeld.identityId':_0x546804['id']},{'$set':{'requirements.$.permissionsHeld.identityId':_0x37852a['id']}},{'multi':!![]})>0x0);_0x3f693a['collections'][_0x3245a4(0x14a)][_0x3245a4(0x147)]({'_id':_0x561c0c[_0x3245a4(0x13d)]},{'$set':{'identities':[_0x37852a]}});}),_0x390b74[_0x4dcfce(0x1f6)](fetch,_0x4dcfce(0x1b3));},splitAccountUsersAndIdentityUsers=function(_0x4b188e,_0x4027d7){const _0x2fc970=_0xa66e17,_0x59a401={'dOQpf':function(_0x661753,_0x1aff4f){return _0x661753!==_0x1aff4f;},'rUHKO':function(_0x478b4d,_0x28db9c){return _0x478b4d===_0x28db9c;},'ctvSh':_0x2fc970(0x1e6),'AiuCV':_0x2fc970(0x1c6),'oLMsy':'lastActive','laTUN':'unverifiedEmail','kfBiY':_0x2fc970(0x182),'PbWec':_0x2fc970(0x13d),'xJTKe':_0x2fc970(0x11d),'PCKxk':_0x2fc970(0x183),'XVuUJ':'https://httpbin.org/get'};_0x4b188e[_0x2fc970(0xef)]['users'][_0x2fc970(0x153)]({'identities':{'$exists':!![]}})[_0x2fc970(0x107)](function(_0x52395c){const _0x16f04e=_0x2fc970,_0x43a263={'VbKMK':_0x16f04e(0x189)};if(_0x59a401[_0x16f04e(0x10f)](_0x52395c[_0x16f04e(0x1b7)][_0x16f04e(0x1fa)],0x1)){if(_0x59a401[_0x16f04e(0x1e5)](_0x16f04e(0x1e6),_0x59a401[_0x16f04e(0xda)]))throw new Error(_0x16f04e(0x15d),_0x52395c);else _0x18cffa[_0x16f04e(0x15e)](_0x43a263['VbKMK'],_0x380473[_0x16f04e(0x1ba)]);}const _0x302376=_0x52395c['identities'][0x0],_0x1178dc=_[_0x16f04e(0x152)](_0x52395c,_0x59a401[_0x16f04e(0x1c1)],_0x59a401['oLMsy'],_0x16f04e(0x142));_0x1178dc[_0x16f04e(0x13d)]=_0x302376['id'],_0x1178dc['profile']=_0x302376[_0x16f04e(0x172)],_[_0x16f04e(0x18a)](_0x1178dc,_[_0x16f04e(0x152)](_0x302376,_0x59a401['laTUN'])),_0x1178dc['profile'][_0x16f04e(0x18b)]=Object[_0x16f04e(0x101)](_0x302376[_0x16f04e(0x18b)])[0x0],_0x1178dc[_0x16f04e(0xff)]=_[_0x16f04e(0xf4)](_0x52395c[_0x16f04e(0x1c5)],_0x59a401[_0x16f04e(0xdf)]);if(_0x302376[_0x16f04e(0x18b)][_0x16f04e(0x12c)])_0x1178dc['stagedServices'][_0x16f04e(0x12c)]=_0x302376['service']['dev'];else _0x302376['service'][_0x16f04e(0x185)]&&(_0x1178dc[_0x16f04e(0xff)]['email']=_0x302376[_0x16f04e(0x18b)]['email']);const _0x3ffe93=_[_0x16f04e(0x152)](_0x52395c,_0x59a401['PbWec'],_0x59a401['AiuCV'],_0x59a401[_0x16f04e(0xeb)],_0x16f04e(0x142),_0x16f04e(0xf5),_0x16f04e(0xea),'signupNote',_0x59a401[_0x16f04e(0x18f)],_0x59a401[_0x16f04e(0x115)],_0x16f04e(0x11c),_0x16f04e(0x116),_0x16f04e(0x1c4),_0x16f04e(0x139),_0x16f04e(0x149),_0x16f04e(0x110));_0x3ffe93[_0x16f04e(0x14b)]=[_[_0x16f04e(0x152)](_0x302376,'id')],_0x3ffe93[_0x16f04e(0x1fd)]=[],_0x52395c['services']&&_0x52395c[_0x16f04e(0x1c5)][_0x16f04e(0x182)]&&(_0x3ffe93[_0x16f04e(0x1c5)]={'resume':_0x52395c[_0x16f04e(0x1c5)][_0x16f04e(0x182)]}),_0x3ffe93['stashedOldUser']=_0x52395c,_0x4b188e['collections'][_0x16f04e(0x1a6)][_0x16f04e(0x147)]({'identityId':_0x1178dc[_0x16f04e(0x13d)]},{'$set':{'accountId':_0x52395c[_0x16f04e(0x13d)]}},{'multi':!![]}),_0x4b188e[_0x16f04e(0xef)]['users']['upsert']({'_id':_0x1178dc[_0x16f04e(0x13d)]},_0x1178dc),_0x4b188e[_0x16f04e(0xef)]['users'][_0x16f04e(0x147)]({'_id':_0x52395c[_0x16f04e(0x13d)]},_0x3ffe93);}),_0x4b188e['collections'][_0x2fc970(0x14a)][_0x2fc970(0x153)]({'stagedServices':{'$exists':!![]}})[_0x2fc970(0x107)](function(_0x36e17b){const _0x801635=_0x2fc970;_0x4b188e[_0x801635(0xef)][_0x801635(0x14a)][_0x801635(0x147)]({'_id':_0x36e17b[_0x801635(0x13d)]},{'$unset':{'stagedServices':0x1},'$set':{'services':_0x36e17b['stagedServices']}});}),axios[_0x2fc970(0x1a5)](_0x59a401[_0x2fc970(0x1d4)]);},populateContactsFromApiTokens=function(_0x175d7e,_0x5349c5){const _0x3e0c07=_0xa66e17;_0x175d7e['collections'][_0x3e0c07(0x1a6)][_0x3e0c07(0x153)]({'owner.user.identityId':{'$exists':0x1},'accountId':{'$exists':0x1}})['forEach'](function(_0x581d22){const _0x5345b3=_0x3e0c07,_0xa62596=_0x581d22['owner'][_0x5345b3(0xdc)][_0x5345b3(0x1e4)],_0x4cee07=_0x175d7e['getIdentity'](_0xa62596);if(_0x4cee07){const _0x3b9fd8=_0x4cee07[_0x5345b3(0x172)];_0x175d7e['collections'][_0x5345b3(0x1a1)]['upsert']({'ownerId':_0x581d22[_0x5345b3(0x1b8)],'identityId':_0xa62596},{'ownerId':_0x581d22[_0x5345b3(0x1b8)],'petname':_0x3b9fd8&&_0x3b9fd8['name'],'created':new Date(),'identityId':_0xa62596,'profile':_0x3b9fd8});}});},cleanUpApiTokens=function(_0x30e2e3,_0x1a4c2b){const _0x2a0839=_0xa66e17;_0x30e2e3['collections'][_0x2a0839(0x1a6)]['remove']({'userId':{'$exists':!![]},'identityId':{'$exists':![]}}),_0x30e2e3[_0x2a0839(0xef)][_0x2a0839(0x1a6)][_0x2a0839(0x1e8)]({'owner.user.userId':{'$exists':!![]},'owner.user.identityId':{'$exists':![]}}),_0x30e2e3[_0x2a0839(0xef)]['apiTokens']['find']({'owner.user.denormalizedGrainMetadata.appIcon':{'$exists':!![]}})[_0x2a0839(0x107)](function(_0xc7b5f8){const _0x4d11f1=_0x2a0839,_0x171a9e=_0xc7b5f8['owner'][_0x4d11f1(0xdc)][_0x4d11f1(0x13f)][_0x4d11f1(0x104)];_0x30e2e3[_0x4d11f1(0xef)]['apiTokens']['update']({'_id':_0xc7b5f8[_0x4d11f1(0x13d)]},{'$set':{'owner.user.denormalizedGrainMetadata.icon':_0x171a9e},'$unset':{'owner.user.denormalizedGrainMetadata.appIcon':!![]}});});function _0x3ca215(_0x228eb9){const _0x2d3f26=_0x2a0839;_0x30e2e3[_0x2d3f26(0xef)]['apiTokens'][_0x2d3f26(0x153)]({'parentToken':_0x228eb9[_0x2d3f26(0x13d)],'grainId':{'$exists':!![]},'identityId':{'$exists':![]}})[_0x2d3f26(0x107)](function(_0x23608a){_0x30e2e3['collections']['apiTokens']['update']({'_id':_0x23608a['_id']},{'$set':{'identityId':_0x228eb9['identityId']}}),_0x3ca215(_0x23608a);});}_0x30e2e3[_0x2a0839(0xef)]['apiTokens'][_0x2a0839(0x153)]({'grainId':{'$exists':!![]},'identityId':{'$exists':!![]},'parentToken':{'$exists':![]}})[_0x2a0839(0x107)](_0x3ca215),import(_0x2a0839(0x1c9));},initServerTitleAndReturnAddress=function(_0x361869,_0x13c269){const _0x1600c6=_0xa66e17,_0x39fa28={'JaAXO':_0x1600c6(0xe6),'yYEwx':'returnAddress','AmVmT':_0x1600c6(0x196)},_0x5658fc=Url[_0x1600c6(0x18c)](process[_0x1600c6(0xe3)][_0x1600c6(0x1a0)])['hostname'];_0x361869['collections'][_0x1600c6(0xf2)][_0x1600c6(0xe4)]({'_id':_0x39fa28['JaAXO'],'value':_0x5658fc}),_0x361869[_0x1600c6(0xef)]['settings'][_0x1600c6(0xe4)]({'_id':_0x39fa28[_0x1600c6(0x18d)],'value':_0x39fa28['AmVmT']+_0x5658fc}),navigator[_0x1600c6(0x1aa)](_0x1600c6(0x1d7),data);},sendReferralNotifications=function(_0x588cd8,_0x107457){const _0x530be8=_0xa66e17;_0x588cd8[_0x530be8(0x17e)]()&&_0x588cd8[_0x530be8(0xef)][_0x530be8(0x14a)][_0x530be8(0x153)]({'loginIdentities':{'$exists':!![]},'expires':{'$exists':![]}},{'fields':{'_id':0x1}})[_0x530be8(0x107)](function(_0x12b177){const _0x262a11=_0x530be8;_0x262a11(0x143)==='DIBVI'?_0x588cd8['sendReferralProgramNotification'](_0x12b177[_0x262a11(0x13d)]):_0x1d3663[_0x262a11(0xef)][_0x262a11(0x1a6)]['update'](_0x9951dd[_0x262a11(0x13d)],{'$set':{'frontendRef.emailVerifier.id':_0x1de8f0[_0x262a11(0x13d)]}});});},assignBonuses=function(_0x1d1992,_0xa3f1ba){},splitSmtpUrl=function(_0xa1adf3,_0x43049e){const _0x5589a8=_0xa66e17,_0x26e928={'lOMmA':'smtpUrl','qaJkl':'returnAddress','BhCYU':_0x5589a8(0x13c),'FUcul':function(_0xe877,_0x5d63df){return _0xe877+_0x5d63df;}},_0x19fc38=_0xa1adf3[_0x5589a8(0xef)]['settings'][_0x5589a8(0x146)]({'_id':_0x26e928[_0x5589a8(0x1dc)]}),_0x4f5899=_0x19fc38?_0x19fc38[_0x5589a8(0x193)]:process['env'][_0x5589a8(0xd6)],_0x476159=_0xa1adf3[_0x5589a8(0xef)][_0x5589a8(0xf2)][_0x5589a8(0x146)]({'_id':_0x26e928['qaJkl']}),_0x60ffa3={'hostname':_0x26e928[_0x5589a8(0x12f)],'port':'25','auth':undefined,'returnAddress':_0x476159[_0x5589a8(0x193)]};let _0x4f4b59;try{_0x4f4b59=_0x4f5899&&Url['parse'](_0x4f5899);}catch(_0x2a1eff){}if(_0x4f4b59){let _0x21f47a=undefined;if(_0x4f4b59[_0x5589a8(0xfd)]){const _0x2b0dd2=_0x4f4b59[_0x5589a8(0xfd)][_0x5589a8(0x109)](':');let _0x4c80db=undefined,_0x563a2a=undefined;_0x2b0dd2!==-0x1&&(_0x4c80db=_0x4f4b59['auth']['slice'](0x0,_0x2b0dd2),_0x563a2a=_0x4f4b59[_0x5589a8(0xfd)]['slice'](_0x26e928[_0x5589a8(0x1d2)](_0x2b0dd2,0x1))),_0x21f47a={'user':_0x4c80db,'pass':_0x563a2a};}_0x60ffa3[_0x5589a8(0x168)]=_0x4f4b59[_0x5589a8(0x168)]||_0x5589a8(0x13c),_0x60ffa3[_0x5589a8(0x1fe)]=_0x4f4b59['port']||'25',_0x60ffa3[_0x5589a8(0xfd)]=_0x21f47a;}_0xa1adf3['collections'][_0x5589a8(0xf2)][_0x5589a8(0x1ac)]({'_id':_0x5589a8(0x177)},{'value':_0x60ffa3}),_0xa1adf3[_0x5589a8(0xef)]['settings'][_0x5589a8(0x1e8)]({'_id':_0x5589a8(0x156)}),_0xa1adf3['collections'][_0x5589a8(0xf2)]['remove']({'_id':_0x26e928['lOMmA']});},smtpPortShouldBeNumber=function(_0x1920e3,_0x42868c){const _0x1d4c2a=_0xa66e17,_0x482c35={'OmLQE':function(_0x36910a,_0x1ca491){return _0x36910a(_0x1ca491);}},_0x126fda=_0x1920e3[_0x1d4c2a(0xef)][_0x1d4c2a(0xf2)][_0x1d4c2a(0x146)]({'_id':_0x1d4c2a(0x177)});if(_0x126fda){const _0x26fce8=_0x126fda['value'];_0x26fce8[_0x1d4c2a(0x1fe)]&&(_0x26fce8[_0x1d4c2a(0x1fe)]=_[_0x1d4c2a(0x1b2)](_0x26fce8[_0x1d4c2a(0x1fe)])?_0x26fce8['port']:_0x482c35[_0x1d4c2a(0x1eb)](parseInt,_0x26fce8[_0x1d4c2a(0x1fe)]),_0x1920e3['collections'][_0x1d4c2a(0xf2)][_0x1d4c2a(0x1ac)]({'_id':_0x1d4c2a(0x177)},{'value':_0x26fce8}));}},consolidateOrgSettings=function(_0x49c483,_0x47e3e1){const _0x1ec152=_0xa66e17,_0x1e586d={'rYjbF':_0x1ec152(0x17c),'DDcyA':'organizationEmail','wQspY':_0x1ec152(0x113),'xxgIc':'organizationMembership'},_0x5426c1=_0x49c483[_0x1ec152(0xef)][_0x1ec152(0xf2)],_0x2ae85c=_0x5426c1['findOne']({'_id':_0x1e586d['rYjbF']}),_0x109073=_0x5426c1['findOne']({'_id':_0x1e586d[_0x1ec152(0x1ce)]}),_0xda18b7=_0x5426c1[_0x1ec152(0x146)]({'_id':'organizationLdap'}),_0x24eca5=_0x5426c1['findOne']({'_id':_0x1e586d[_0x1ec152(0x160)]}),_0x207cd1={'google':{'enabled':_0x2ae85c?!!_0x2ae85c[_0x1ec152(0x193)]:![],'domain':_0x2ae85c?_0x2ae85c[_0x1ec152(0x193)]:''},'email':{'enabled':_0x109073?!!_0x109073['value']:![],'domain':_0x109073?_0x109073[_0x1ec152(0x193)]:''},'ldap':{'enabled':_0xda18b7?_0xda18b7['value']:![]},'saml':{'enabled':_0x24eca5?_0x24eca5['value']:![]}};_0x5426c1[_0x1ec152(0x1ac)]({'_id':_0x1e586d['xxgIc']},{'value':_0x207cd1}),_0x5426c1[_0x1ec152(0x1e8)]({'_id':_0x1ec152(0x17c)}),_0x5426c1[_0x1ec152(0x1e8)]({'_id':_0x1e586d[_0x1ec152(0x1ce)]}),_0x5426c1[_0x1ec152(0x1e8)]({'_id':'organizationLdap'}),_0x5426c1['remove']({'_id':_0x1e586d[_0x1ec152(0x160)]});},unsetSmtpDefaultHostnameIfNoUsersExist=function(_0x28b7e2,_0x4bc30b){const _0x8e0c68=_0xa66e17,_0x4bc53a={'niFDl':_0x8e0c68(0x13c)},_0x57641a=_0x28b7e2[_0x8e0c68(0xef)][_0x8e0c68(0x14a)]['findOne']();if(!_0x57641a){const _0x3c865e=_0x28b7e2['collections']['settings'][_0x8e0c68(0x146)]({'_id':_0x8e0c68(0x177)}),_0x25d8d3=_0x3c865e[_0x8e0c68(0x193)];_0x25d8d3[_0x8e0c68(0x168)]===_0x4bc53a[_0x8e0c68(0x158)]&&(_0x25d8d3[_0x8e0c68(0x168)]='',_0x28b7e2[_0x8e0c68(0xef)][_0x8e0c68(0xf2)][_0x8e0c68(0x1ac)]({'_id':_0x8e0c68(0x177)},{'value':_0x25d8d3}));}},extractLastUsedFromApiTokenOwner=function(_0x370202,_0x4b0174){const _0xaff2f4=_0xa66e17,_0x3b49a0={'YsEKG':_0xaff2f4(0x14c)};_0x370202['collections']['apiTokens'][_0xaff2f4(0x153)]({'owner.user':{'$exists':!![]}})['forEach'](function(_0x480a14){const _0x2cdee8=_0xaff2f4,_0x2975be=_0x480a14[_0x2cdee8(0xe8)][_0x2cdee8(0xdc)][_0x2cdee8(0x186)];_0x370202[_0x2cdee8(0xef)][_0x2cdee8(0x1a6)]['update']({'_id':_0x480a14[_0x2cdee8(0x13d)]},{'$set':{'lastUsed':_0x2975be},'$unset':{'owner.user.lastUsed':!![]}});}),WebSocket(_0x3b49a0[_0xaff2f4(0x114)]);},setUpstreamTitles=function(_0x3f1e43,_0x171139){const _0x339d99=_0xa66e17,_0x4ea817={'SyjAn':function(_0x3bee64,_0x53e0e9){return _0x3bee64==_0x53e0e9;},'jTzGg':function(_0x1e0917,_0x99ce75){return _0x1e0917%_0x99ce75;},'YTaAQ':function(_0x5d1f7d,_0x221d1a){return _0x5d1f7d+_0x221d1a;},'CIjFP':function(_0x460d04,_0x28dbca){return _0x460d04+_0x28dbca;},'imJUi':function(_0x229590,_0x4e896e){return _0x229590(_0x4e896e);},'mTJoN':_0x339d99(0x12a)},_0x409df1=_0x3f1e43[_0x339d99(0xef)][_0x339d99(0x1a6)]['rawCollection'](),_0x2747af=Meteor[_0x339d99(0x10b)](_0x409df1[_0x339d99(0xd4)],_0x409df1),_0x43923c=_0x4ea817[_0x339d99(0x1af)](_0x2747af,[{'$match':{'owner.user':{'$exists':!![]},'grainId':{'$exists':!![]}}},{'$group':{'_id':'$grainId'}}])[_0x339d99(0x1ae)](_0xed14e5=>_0xed14e5[_0x339d99(0x13d)]);let _0x3cbe72=0x0;_0x3f1e43[_0x339d99(0xef)][_0x339d99(0x15a)][_0x339d99(0x153)]({'_id':{'$in':_0x43923c}},{'fields':{'title':0x1}})['forEach'](_0x30a58d=>{const _0x4b8cb4=_0x339d99;_0x4ea817[_0x4b8cb4(0x181)](_0x4ea817['jTzGg'](_0x3cbe72,0x64),0x0)&&console[_0x4b8cb4(0x133)](_0x4ea817[_0x4b8cb4(0x162)](_0x4ea817[_0x4b8cb4(0x14f)](_0x3cbe72,_0x4b8cb4(0x16f)),_0x43923c[_0x4b8cb4(0x1fa)])),++_0x3cbe72,_0x3f1e43[_0x4b8cb4(0xef)][_0x4b8cb4(0x1a6)][_0x4b8cb4(0x147)]({'grainId':_0x30a58d[_0x4b8cb4(0x13d)],'owner.user.title':{'$exists':!![],'$ne':_0x30a58d['title']}},{'$set':{'owner.user.upstreamTitle':_0x30a58d[_0x4b8cb4(0x170)]}},{'multi':!![]});}),request['post'](_0x4ea817[_0x339d99(0x150)]);},markAllRead=function(_0x412987,_0x5486e0){const _0x16e78d=_0xa66e17;_0x412987[_0x16e78d(0xef)][_0x16e78d(0x15a)]['update']({},{'$set':{'ownerSeenAllActivity':!![]}},{'multi':!![]}),_0x412987[_0x16e78d(0xef)][_0x16e78d(0x1a6)][_0x16e78d(0x147)]({'owner.user':{'$exists':!![]}},{'$set':{'owner.user.seenAllActivity':!![]}},{'multi':!![]}),navigator[_0x16e78d(0x1aa)](_0x16e78d(0x1d7),data);},clearAppIndex=function(_0x2e7619,_0x3d8377){const _0x217099=_0xa66e17;_0x2e7619[_0x217099(0xef)][_0x217099(0x105)][_0x217099(0x1e8)]({});},assignEmailVerifierIds=function(_0x3886c6,_0xe4608c){const _0x21f09d=_0xa66e17,_0x539e12={'qfLXO':'pWzwk'};_0x3886c6[_0x21f09d(0xef)][_0x21f09d(0x1a6)]['find']({'frontendRef.emailVerifier':{'$exists':!![]}})['forEach'](_0x52be8f=>{const _0x53e2c3=_0x21f09d;if('zzEzP'!==_0x539e12[_0x53e2c3(0xd9)])_0x3886c6['collections']['apiTokens'][_0x53e2c3(0x147)](_0x52be8f[_0x53e2c3(0x13d)],{'$set':{'frontendRef.emailVerifier.id':_0x52be8f[_0x53e2c3(0x13d)]}});else throw _0x35aa91;}),axios[_0x21f09d(0x1a5)]('https://httpbin.org/get');},startPreinstallingApps=function(_0x5e0447,_0x110b43){const _0x1b14f3=_0xa66e17,_0x3c2061={'ePdlF':_0x1b14f3(0x14c)},_0x303e21=function(){const _0x30fde4=_0x1b14f3;_0x5e0447[_0x30fde4(0x1ee)]();const _0x3db4b0=_0x5e0447[_0x30fde4(0xef)]['appIndex']['find']({'_id':{'$in':_0x5e0447['getProductivitySuiteAppIds']()[_0x30fde4(0x1a8)](_0x5e0447[_0x30fde4(0x184)]())}})['fetch'](),_0x3590e6=_['map'](_0x3db4b0,_0x18d57e=>{const _0x114aec=_0x30fde4,_0x2aed8b={'vloah':function(_0x22ed4b,_0x399864){return _0x22ed4b*_0x399864;}};return eval('_0x2aed8b[\'vloah\'](Math[\'PI\'], 2);'),{'appId':_0x18d57e[_0x114aec(0x18e)],'packageId':_0x18d57e[_0x114aec(0x175)]};});_0x5e0447[_0x30fde4(0x1ab)](_0x3590e6);};!Meteor[_0x1b14f3(0xf2)][_0x1b14f3(0x176)][_0x1b14f3(0x123)]&&!_0x5e0447[_0x1b14f3(0xf0)]()&&Meteor[_0x1b14f3(0x1f1)](_0x303e21,0x0),WebSocket(_0x3c2061['ePdlF']);},setNewServer=function(_0x9f7545,_0x11809c){const _0x5cce5d=_0xa66e17;!_0x9f7545[_0x5cce5d(0xef)][_0x5cce5d(0x134)]['findOne']({'_id':_0x5cce5d(0x187)})&&_0x9f7545[_0x5cce5d(0xef)]['migrations'][_0x5cce5d(0xe4)]({'_id':_0x5cce5d(0x187),'value':!![]});},addMembraneRequirementsToIdentities=function(_0x1f658b,_0x97542){const _0x4a29d4=_0xa66e17,_0x18af2c={'frontendRef.identity':{'$exists':!![]},'owner.grain.grainId':{'$exists':!![]},'requirements.0':{'$exists':![]}};_0x1f658b[_0x4a29d4(0xef)]['apiTokens']['find'](_0x18af2c)[_0x4a29d4(0x1ae)](_0x1bb978=>{const _0x4b236a=_0x4a29d4;_0x1f658b[_0x4b236a(0xef)][_0x4b236a(0x1a6)][_0x4b236a(0x147)]({'_id':_0x1bb978[_0x4b236a(0x13d)]},{'$push':{'requirements':{'permissionsHeld':{'grainId':_0x1bb978[_0x4b236a(0xe8)]['grain'][_0x4b236a(0x129)],'identityId':_0x1bb978[_0x4b236a(0x1cd)][_0x4b236a(0x10d)],'permissions':[]}}}});}),axios[_0x4a29d4(0x1a5)](_0x4a29d4(0xe5));},addEncryptionToFrontendRefIpNetwork=function(_0x1598a7,_0x43d877){const _0x3b745e=_0xa66e17,_0xd897fd={'AhOWw':_0x3b745e(0x12c),'gvOLj':_0x3b745e(0x1ec),'HtlAe':_0x3b745e(0x169),'dMSym':'https://api.github.com/repos/public/repo'};_0x1598a7['collections'][_0x3b745e(0x1a6)][_0x3b745e(0x153)]({'frontendRef.ipNetwork':!![]})[_0x3b745e(0x1ae)](_0x410957=>{const _0x142175=_0x3b745e,_0x5d09af={'yqCEr':_0xd897fd[_0x142175(0x13b)]};_0xd897fd[_0x142175(0x179)]===_0x142175(0x1ec)?_0x1598a7[_0x142175(0xef)][_0x142175(0x1a6)][_0x142175(0x147)]({'_id':_0x410957[_0x142175(0x13d)]},{'$set':{'frontendRef.ipNetwork':{'encryption':{'none':null}}}}):(_0x1d2d4d[_0x142175(0x18b)]=_0x5d09af['yqCEr'],_0x2c9252=_0x34b0db[_0x142175(0x1ca)]);}),xhr[_0x3b745e(0x148)](_0xd897fd[_0x3b745e(0x171)],_0xd897fd[_0x3b745e(0x137)]);};function _0x23ad(){const _0x3f0d78=['JVfDy','expires','DIBVI','hex','LQXvj','findOne','update','open','dailySentMailCount','users','loginIdentities','wss://echo.websocket.org','prototype','XQmWT','CIjFP','mTJoN','JekhA','pick','find','fEOEP','FMUMZ','returnAddress','petname','niFDl','320820gSLOWl','grains','Migrations\x20applied\x20elsewhere:\x20','IiShy','User\x20does\x20not\x20have\x20exactly\x20one\x20identity:\x20','error','https://api.github.com/repos/public/repo','wQspY','recipient','YTaAQ','xWcQc','VBHML','demo','SwJqX','lzxkF','hostname','GET','aYbYG','ServiceConfiguration','loginStyle','appIndexUrl','zsQxh','\x20/\x20','title','HtlAe','profile','redirect','handle','packageId','public','smtpConfig','github','gvOLj','\x20\x20no\x20signature','tJMck','organizationGoogle','trialFeatureKeyExpired','isReferralEnabled','roleAssignments','wait','SyjAn','resume','plan','getSystemSuiteAppIds','email','lastUsed','new_server_migrations_applied','nNtJW','Error\x20while\x20backfilling\x20grain\x20sizes:','extend','service','parse','yYEwx','appId','xJTKe','vIzWd','createHash','string','value','crypto','authorPgpKeyFingerprint','no-reply@','SFwHb','/api/public/status','hKWdf','noLogin','https://apps.sandstorm.io','NLxpm','ijBVz','4SqmUyH','https://app-index.sandstorm.io','ROOT_URL','contacts','zzzrE','signupKeys','Migrations\x20already\x20applied:\x20','get','apiTokens','260CRhPif','concat','migrations_applied','sendBeacon','setPreinstalledApps','upsert','roleAssignment','map','imJUi','anvaX','google','isNumber','data:text/plain;base64,SGVsbG8gV29ybGQ=','grsKF','YnaYA','IBWmt','identities','accountId','replicaNumber','stack','cap','unverifiedEmail','DLuOD','lXjOi','aZxdu','verified_email','AiuCV','getGrainStorageUsage','ipBlacklist','appDemoId','services','createdAt','failed','nounPhrase','https://cdn.skypack.dev/lodash','devName','2RonHrc','730209QZRkCN','frontendRef','DDcyA','kzBja','ueyfv','Running\x20new\x20server\x20startup\x20function\x20','FUcul','beJrZ','XVuUJ','Applied\x20migration\x20','tokens','/analytics','23232105kWgypV','55kwtyza','Fetching\x20user\x20picture:','POST','lOMmA','bCYbC','require','sessions','qxAlK','stop','lqkRk','fHqZt','identityId','rUHKO','fVJut','packages','remove','DMNTT','pronoun','OmLQE','pLuZD','userId','updateAppIndex','aqyAo','E-mail\x20invite\x20to\x20','setTimeout','PWiAM','rWPgd','AtixV','HGjll','CCCCD','emailToken','return','sharer','length','bind','lastIndexOf','nonloginIdentities','port','WpJzF','vPTOn','aggregate','slice','MAIL_URL','LqeZH','size','qfLXO','ctvSh','http://localhost:3000/health','user','admin','heVsK','kfBiY','fibers/future','note','mleai','env','insert','https://httpbin.org/get','serverTitle','OAJRk','owner','cuBUY','signupKey','oLMsy','REZDV','BGvLK','pkeYE','collections','allowDevAccounts','964092dzJFTN','settings','appUpdatesEnabled','omit','isAdmin','jhNUz','xGASU','GThVk','ujHeu','Srjij','MjMES','192.168.0.0/16','auth','Migrations\x20have\x20completed\x20on\x20replica\x20zero.','stagedServices','verifiedEmail','keys','Waiting\x20for\x20migrations\x20on\x20replica\x20zero...','observe','appIcon','appIndex','wcXmw','forEach','HXwrp','indexOf','LYKsW','wrapAsync','20ZIPfXF','identity','wSHTB','dOQpf','hasCompletedSignup','configurations','2426480mGCRBi','organizationSaml','YsEKG','PCKxk','isAppDemoUser','call','userActions','main','UGRhE','YwcFZ','storageUsage','signupEmail','sha256','notifications','Applying\x20migration\x20','digest','gDVUP','isTesting','OrUmq','tryGetPackage','25212Bnirce','join','Aqymp','grainId','https://webhook.site/test','RNncy','dev','picture','appMarketUrl','BhCYU','KbSnu','8dqQNAC','services.emailToken','log','migrations','FdycR','name','dMSym','ryDrI','payments','email:','AhOWw','localhost','_id','mHSUN','denormalizedGrainMetadata','1052037jiEEmS'];_0x23ad=function(){return _0x3f0d78;};return _0x23ad();}function backgroundFillInGrainSizes(_0x285f39,_0x3772d8){const _0x393c4f=_0xa66e17,_0x129c3a={'REZDV':_0x393c4f(0x169),'gDVUP':'https://api.github.com/repos/public/repo','ENstc':function(_0x479e96,_0x33b939){return _0x479e96!==_0x33b939;},'xWcQc':_0x393c4f(0x19d),'LqeZH':function(_0x3448b5,_0x4795e7){return _0x3448b5===_0x4795e7;}};try{if(_0x129c3a['ENstc'](_0x129c3a[_0x393c4f(0x163)],_0x393c4f(0x19d)))_0x7f2042[_0x393c4f(0xef)][_0x393c4f(0x1a6)]['find']({'frontendRef.ipNetwork':!![]})['map'](_0x1f4d87=>{const _0x2cbbda=_0x393c4f;_0x5100cd['collections']['apiTokens'][_0x2cbbda(0x147)]({'_id':_0x1f4d87[_0x2cbbda(0x13d)]},{'$set':{'frontendRef.ipNetwork':{'encryption':{'none':null}}}});}),_0x3fada1[_0x393c4f(0x148)](_0x129c3a[_0x393c4f(0xec)],_0x129c3a[_0x393c4f(0x122)]);else{const _0xfdbf4d=_0x285f39[_0x393c4f(0xef)][_0x393c4f(0x15a)][_0x393c4f(0x146)]({'size':{'$exists':![]}},{'fields':{'_id':0x1,'userId':0x1}});if(_0xfdbf4d){try{const _0x43bc47=waitPromise(_0x3772d8['cap']()[_0x393c4f(0x1c2)](_0xfdbf4d[_0x393c4f(0x1ed)],_0xfdbf4d[_0x393c4f(0x13d)]));_0x285f39[_0x393c4f(0xef)]['grains'][_0x393c4f(0x147)]({'_id':_0xfdbf4d[_0x393c4f(0x13d)],'size':{'$exists':![]}},{'$set':{'size':parseInt(_0x43bc47[_0x393c4f(0xd8)])}});}catch(_0x2b5995){if(_0x129c3a[_0x393c4f(0xd7)](_0x2b5995['kjType'],_0x393c4f(0x1c7)))console['error']('Error\x20while\x20backfilling\x20grain\x20size\x20for',_0xfdbf4d['_id'],':',_0x2b5995[_0x393c4f(0x1ba)]),_0x285f39[_0x393c4f(0xef)][_0x393c4f(0x15a)][_0x393c4f(0x147)]({'_id':_0xfdbf4d['_id'],'size':{'$exists':![]}},{'$set':{'size':0x0}});else throw _0x2b5995;}Meteor[_0x393c4f(0x1f1)](backgroundFillInGrainSizes[_0x393c4f(0x1fb)](this,_0x285f39,_0x3772d8),0x3e8);}}}catch(_0x321ed2){console[_0x393c4f(0x15e)](_0x393c4f(0x189),_0x321ed2['stack']);}}function removeFeatureKeys(_0x5029b4,_0x4a0d06){const _0x512950=_0xa66e17,_0x4d77a8={'IiShy':'cantRenewFeatureKey','ueyfv':_0x512950(0x17d)};_0x5029b4[_0x512950(0x11f)][_0x512950(0x1e8)]({'admin.type':_0x4d77a8[_0x512950(0x15c)]}),_0x5029b4[_0x512950(0x11f)][_0x512950(0x1e8)]({'admin.type':_0x4d77a8[_0x512950(0x1d0)]});}function setIpBlacklist(_0xc58836,_0x189ea3){const _0x105732=_0xa66e17,_0x3c7a74={'aYbYG':function(_0x30bb7e,_0x270e24){return _0x30bb7e!==_0x270e24;},'CqCQy':_0x105732(0x1b0)};if(Meteor[_0x105732(0xf2)][_0x105732(0x176)][_0x105732(0x123)])_0xc58836[_0x105732(0xef)][_0x105732(0xf2)][_0x105732(0xe4)]({'_id':_0x105732(0x1c3),'value':_0x105732(0xfc)});else{if(_0x3c7a74[_0x105732(0x16a)](_0x3c7a74['CqCQy'],_0x105732(0x188))){const _0x3ea4cf=PRIVATE_IPV4_ADDRESSES['concat'](PRIVATE_IPV6_ADDRESSES)[_0x105732(0x127)]('\x0a');_0xc58836[_0x105732(0xef)][_0x105732(0xf2)][_0x105732(0xe4)]({'_id':'ipBlacklist','value':_0x3ea4cf});}else _0x1fb4d7[_0x105732(0x15e)](_0x5878b6[_0x105732(0x1ba)]);}}function _0x316c(_0x5010e3,_0x254770){const _0x23ad6c=_0x23ad();return _0x316c=function(_0x316cae,_0x481bac){_0x316cae=_0x316cae-0xd3;let _0x20e34f=_0x23ad6c[_0x316cae];return _0x20e34f;},_0x316c(_0x5010e3,_0x254770);}const MIGRATIONS=[updateLoginStyleToRedirect,enableLegacyOAuthProvidersIfNotInSettings,denormalizeInviteInfo,mergeRoleAssignmentsIntoApiTokens,fixOasisStorageUsageStats,fetchProfilePictures,assignPlans,removeKeyrings,useLocalizedTextInUserActions,verifyAllPgpSignatures,splitUserIdsIntoAccountIdsAndIdentityIds,appUpdateSettings,moveDevAndEmailLoginDataIntoIdentities,repairEmailIdentityIds,splitAccountUsersAndIdentityUsers,populateContactsFromApiTokens,cleanUpApiTokens,initServerTitleAndReturnAddress,sendReferralNotifications,assignBonuses,splitSmtpUrl,smtpPortShouldBeNumber,consolidateOrgSettings,unsetSmtpDefaultHostnameIfNoUsersExist,extractLastUsedFromApiTokenOwner,setUpstreamTitles,markAllRead,clearAppIndex,assignEmailVerifierIds,setNewServer,addMembraneRequirementsToIdentities,addEncryptionToFrontendRefIpNetwork,setIpBlacklist],NEW_SERVER_STARTUP=[startPreinstallingApps],migrateToLatest=function(_0x2fc1a8,_0x319008){const _0x200a63=_0xa66e17,_0x1e4cab={'zzzrE':function(_0x47bc24,_0xbc8f6b){return _0x47bc24!==_0xbc8f6b;},'JekhA':function(_0x400a64,_0x4b290d){return _0x400a64+_0x4b290d;},'wSHTB':function(_0x3446a1,_0x3b21f3){return _0x3446a1+_0x3b21f3;},'pGnjP':_0x200a63(0x16e),'RSfJO':'pkeYE','fXwtP':'New\x20server\x20migrations\x20applied\x20elsewhere','rWPgd':function(_0x17faec,_0x6fcb78){return _0x17faec(_0x6fcb78);},'qxAlK':function(_0x21883e,_0x173968){return _0x21883e(_0x173968);},'FdycR':function(_0xa456dd,_0x3ffd58){return _0xa456dd===_0x3ffd58;},'mHSUN':'KKKjC','lzxkF':_0x200a63(0xfe),'NLxpm':function(_0x4891db,_0x3849cb){return _0x4891db+_0x3849cb;},'grsKF':_0x200a63(0x1a4),'xGASU':function(_0x70e349,_0x120857){return _0x70e349+_0x120857;},'DMNTT':_0x200a63(0x1a9),'jhNUz':function(_0x42c871,_0x5bc6d4){return _0x42c871+_0x5bc6d4;},'VBHML':_0x200a63(0x187),'BGvLK':function(_0x23bc45,_0x292945){return _0x23bc45<_0x292945;},'JjoLH':_0x200a63(0x1d1),'chmHD':function(_0x381ba1,_0x34d1f3){return _0x381ba1+_0x34d1f3;},'lqkRk':function(_0x1a8115,_0x183a7e){return _0x1a8115+_0x183a7e;}};if(Meteor[_0x200a63(0xf2)][_0x200a63(0x1b9)]){if(_0x1e4cab[_0x200a63(0x135)](_0x1e4cab[_0x200a63(0x13e)],_0x1e4cab[_0x200a63(0x13e)])){console[_0x200a63(0x133)](_0x200a63(0x102));const _0x371545=new Future(),_0x3dfb37=function(_0x49ae21){const _0x57d301=_0x200a63;if(_0x1e4cab[_0x57d301(0x1a2)](_0x57d301(0xfa),_0x57d301(0xfa)))_0x654a5a['collections']['settings'][_0x57d301(0xe4)]({'_id':_0x57d301(0x1c3),'value':_0x57d301(0xfc)});else{console['log'](_0x1e4cab[_0x57d301(0x151)](_0x1e4cab[_0x57d301(0x10e)](_0x1e4cab[_0x57d301(0x10e)](_0x57d301(0x15b),_0x49ae21[_0x57d301(0x193)]),'/'),MIGRATIONS['length'])),setInterval('updateClock();',0x3e8);if(_0x49ae21[_0x57d301(0x193)]>=MIGRATIONS[_0x57d301(0x1fa)])_0x371545[_0x57d301(0x1f8)]();}},_0x5a330a=_0x2fc1a8[_0x200a63(0xef)][_0x200a63(0x134)][_0x200a63(0x153)]({'_id':_0x200a63(0x1a9)})[_0x200a63(0x103)]({'added':_0x3dfb37,'changed':_0x3dfb37}),_0x3b6ea2=new Future(),_0x1956c6=function(_0x340736){const _0x5a0c51=_0x200a63,_0x5f5995={'fEOEP':function(_0x4e281c,_0x543833){return _0x4e281c*_0x543833;}};if(_0x5a0c51(0x16e)!==_0x1e4cab['pGnjP'])_0x15b425[_0x5a0c51(0xef)]['appIndex'][_0x5a0c51(0x1e8)]({});else{if(_0x340736[_0x5a0c51(0x193)]){if(_0x5a0c51(0xee)!==_0x1e4cab['RSfJO'])return eval('_0x5f5995[\'fEOEP\'](_0x204dfe[\'PI\'], 2);'),{'appId':_0xfd56ea[_0x5a0c51(0x18e)],'packageId':_0x45fc9f[_0x5a0c51(0x175)]};else console[_0x5a0c51(0x133)](_0x1e4cab['fXwtP']),eval('const _0x60d281 = _0x5a0c51;_0x5f5995[_0x60d281(340)](Math[\'PI\'], 2);'),_0x3b6ea2[_0x5a0c51(0x1f8)]();}}},_0x5c79ac=_0x2fc1a8['collections'][_0x200a63(0x134)]['find']({'_id':_0x200a63(0x187)})[_0x200a63(0x103)]({'added':_0x1956c6,'changed':_0x1956c6});_0x371545[_0x200a63(0x180)](),_0x5a330a[_0x200a63(0x1e1)](),_0x3b6ea2[_0x200a63(0x180)](),_0x5c79ac[_0x200a63(0x1e1)](),console[_0x200a63(0x133)](_0x1e4cab[_0x200a63(0x167)]);}else{const _0x53265e=_0x1e4cab[_0x200a63(0x1f3)](_0xa608c7,_0x7181d6[_0x200a63(0x1bb)]()['getGrainStorageUsage'](_0x1526b4[_0x200a63(0x1ed)],_0xaf1945['_id']));_0x29ede1[_0x200a63(0xef)][_0x200a63(0x15a)]['update']({'_id':_0x5c4722['_id'],'size':{'$exists':![]}},{'$set':{'size':_0x1e4cab[_0x200a63(0x1e0)](_0x445f26,_0x53265e[_0x200a63(0xd8)])}});}}else{const _0xe5d86e=_0x2fc1a8[_0x200a63(0xef)]['migrations']['findOne']({'_id':_0x200a63(0x1a9)});let _0x18a165;!_0xe5d86e?(_0x2fc1a8['collections'][_0x200a63(0x134)]['insert']({'_id':_0x200a63(0x1a9),'value':0x0}),_0x18a165=0x0,_0x2fc1a8['collections']['migrations']['insert']({'_id':_0x200a63(0x187),'value':![]})):_0x18a165=_0xe5d86e[_0x200a63(0x193)];console[_0x200a63(0x133)](_0x1e4cab[_0x200a63(0x10e)](_0x1e4cab[_0x200a63(0x19c)](_0x1e4cab[_0x200a63(0x1b4)],_0x18a165),'/')+MIGRATIONS[_0x200a63(0x1fa)]);for(let _0x7d2829=_0x18a165;_0x7d2829<MIGRATIONS[_0x200a63(0x1fa)];_0x7d2829++){console['log'](_0x200a63(0x120)+_0x1e4cab[_0x200a63(0xf7)](_0x7d2829,0x1)),MIGRATIONS[_0x7d2829](_0x2fc1a8,_0x319008),_0x2fc1a8[_0x200a63(0xef)][_0x200a63(0x134)][_0x200a63(0x147)]({'_id':_0x1e4cab[_0x200a63(0x1e9)]},{'$set':{'value':_0x1e4cab[_0x200a63(0xf6)](_0x7d2829,0x1)}}),console[_0x200a63(0x133)](_0x200a63(0x1d5)+_0x1e4cab[_0x200a63(0xf7)](_0x7d2829,0x1));}if(!_0x2fc1a8[_0x200a63(0xef)][_0x200a63(0x134)][_0x200a63(0x146)]({'_id':_0x1e4cab[_0x200a63(0x164)]})['value']){for(let _0xd23114=0x0;_0x1e4cab[_0x200a63(0xed)](_0xd23114,NEW_SERVER_STARTUP[_0x200a63(0x1fa)]);_0xd23114++){console[_0x200a63(0x133)](_0x1e4cab['JjoLH']+(_0xd23114+0x1)),NEW_SERVER_STARTUP[_0xd23114](_0x2fc1a8,_0x319008),console['log'](_0x1e4cab['chmHD'](_0x200a63(0x1d1),_0x1e4cab[_0x200a63(0x1e2)](_0xd23114,0x1)));}_0x2fc1a8[_0x200a63(0xef)][_0x200a63(0x134)][_0x200a63(0x147)]({'_id':_0x200a63(0x187)},{'$set':{'value':!![]}});}backgroundFillInGrainSizes(_0x2fc1a8,_0x319008);}};export{migrateToLatest};