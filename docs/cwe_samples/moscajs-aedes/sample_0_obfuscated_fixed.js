function _0x4066(){const _0x11fce1=['1093087wGGcqh','fGmXU','keys','vcEla','AWQob','name','./eventLogs','2411733aFNScr','userIds','user_id','THUFw','vectorTag','MEQYf','findFirst','includes','defaultPrompt','2931040nxCMgg','message','findMany','IKRFn','openAiPrompt','sJiJg','map','openAiTemp','get','gvRzn','NDwDL','4492686JRZhhn','role','logEvent','kQggV','PfwEU','create','delete','slug','nXSfA','workspaces','hixCH','floor','error','chatMode','../utils/prisma','Error\x20resetting\x20workspace\x20chat\x20models:','uuid','manager','similarityThreshold','lastUpdatedAt','username','ggSUY','./telemetry','EPAQF','No\x20workspace\x20id\x20provided\x20for\x20update','writable','24382855XHgnGL','vYFdp','find','jvbVo','createManyUsers','./workspaceUsers','length','krpkE','HeBSR','updateMany','rLGtp','where','slugify','8WUcicj','Given\x20the\x20following\x20conversation,\x20relevant\x20context,\x20and\x20a\x20follow\x20up\x20question,\x20reply\x20with\x20an\x20answer\x20to\x20the\x20current\x20question\x20the\x20user\x20is\x20asking.\x20Return\x20only\x20your\x20response\x20to\x20the\x20question\x20given\x20the\x20above\x20information\x20following\x20the\x20users\x20instructions\x20as\x20needed.','sendTelemetry','Error\x20tracking\x20workspace\x20change:','1550065QSQHwT','./user','No\x20valid\x20fields\x20to\x20update!','609178xDeFkQ'];_0x4066=function(){return _0x11fce1;};return _0x4066();}const _0x260403=_0x2448;(function(_0xb6c2dd,_0x27b94e){const _0x164bac=_0x2448,_0x2ee9f2=_0xb6c2dd();while(!![]){try{const _0x279429=-parseInt(_0x164bac(0x152))/0x1+-parseInt(_0x164bac(0x151))/0x2+-parseInt(_0x164bac(0x159))/0x3+parseInt(_0x164bac(0x118))/0x4+-parseInt(_0x164bac(0x14e))/0x5+-parseInt(_0x164bac(0x123))/0x6+parseInt(_0x164bac(0x13d))/0x7*(parseInt(_0x164bac(0x14a))/0x8);if(_0x279429===_0x27b94e)break;else _0x2ee9f2['push'](_0x2ee9f2['shift']());}catch(_0x38f0fe){_0x2ee9f2['push'](_0x2ee9f2['shift']());}}}(_0x4066,0xe94fc));function _0x2448(_0x2910fe,_0xf19253){const _0x4066bd=_0x4066();return _0x2448=function(_0x244890,_0x4ddc51){_0x244890=_0x244890-0x117;let _0x48f055=_0x4066bd[_0x244890];return _0x48f055;},_0x2448(_0x2910fe,_0xf19253);}const prisma=require(_0x260403(0x131)),slugify=require(_0x260403(0x149)),{Document}=require('./documents'),{WorkspaceUser}=require(_0x260403(0x142)),{ROLES}=require('../utils/middleware/multiUserProtected'),{v4:uuidv4}=require(_0x260403(0x133)),{User}=require(_0x260403(0x14f)),Workspace={'defaultPrompt':_0x260403(0x14b),'writable':[_0x260403(0x157),_0x260403(0x12a),_0x260403(0x15d),_0x260403(0x11f),'openAiHistory',_0x260403(0x136),_0x260403(0x11c),_0x260403(0x135),'chatModel','topN',_0x260403(0x130),'pfpFilename'],'new':async function(_0x378744=null,_0x234e91=null){const _0x32b400=_0x260403,_0x4c7650={'uqKfO':function(_0x3d97dc){return _0x3d97dc();},'vYFdp':function(_0x1abab4,_0x22b34b){return _0x1abab4===_0x22b34b;},'EPAQF':function(_0x59ee58,_0x42979f){return _0x59ee58*_0x42979f;},'zeeGl':function(_0x5b06e9,_0x4bfcf6,_0x49e6b3){return _0x5b06e9(_0x4bfcf6,_0x49e6b3);},'kQggV':'fGmXU'};if(!_0x378744)return{'result':null,'message':'name\x20cannot\x20be\x20null'};var _0x2256a8=slugify(_0x378744,{'lower':!![]});_0x2256a8=_0x2256a8||_0x4c7650['uqKfO'](uuidv4);const _0x82f829=await this[_0x32b400(0x120)]({'slug':_0x2256a8});if(_0x82f829!==null){if(_0x4c7650[_0x32b400(0x13e)](_0x32b400(0x11d),'fAetB'))return _0xf9971e[_0x32b400(0x12f)](_0x2fcc99[_0x32b400(0x119)]),[];else{const _0x2c638b=Math[_0x32b400(0x12e)](0x989680+_0x4c7650[_0x32b400(0x13a)](Math['random'](),0x55d4a80));_0x2256a8=_0x4c7650['zeeGl'](slugify,_0x378744+'-'+_0x2c638b,{'lower':!![]});}}try{const _0xae07c6=await prisma['workspaces'][_0x32b400(0x128)]({'data':{'name':_0x378744,'slug':_0x2256a8}});if(!!_0x234e91)await WorkspaceUser[_0x32b400(0x128)](_0x234e91,_0xae07c6['id']);return{'workspace':_0xae07c6,'message':null};}catch(_0xdfa252){if(_0x32b400(0x153)===_0x4c7650[_0x32b400(0x126)])return console[_0x32b400(0x12f)](_0xdfa252[_0x32b400(0x119)]),{'workspace':null,'message':_0xdfa252[_0x32b400(0x119)]};else{const _0x54ae46=_0x349e41['find'](_0x3578c5=>_0x3578c5[_0x32b400(0x15b)]===_0x5101a7['id']);return{'username':_0x59b455['username'],'role':_0x1ce20a[_0x32b400(0x124)],'lastUpdatedAt':_0x54ae46['lastUpdatedAt']};}}},'update':async function(_0x920b69=null,_0x1eea09={}){const _0x45904d=_0x260403,_0x343f59={'krpkE':_0x45904d(0x13b),'AWQob':_0x45904d(0x150)};if(!_0x920b69)throw new Error(_0x343f59[_0x45904d(0x144)]);const _0x1ea872=Object[_0x45904d(0x154)](_0x1eea09)['filter'](_0x409596=>this[_0x45904d(0x13c)][_0x45904d(0x160)](_0x409596));if(_0x1ea872[_0x45904d(0x143)]===0x0)return{'workspace':{'id':_0x920b69},'message':_0x343f59[_0x45904d(0x156)]};try{const _0x221825=await prisma[_0x45904d(0x12c)]['update']({'where':{'id':_0x920b69},'data':_0x1eea09});return{'workspace':_0x221825,'message':null};}catch(_0x49096c){return console['error'](_0x49096c['message']),{'workspace':null,'message':_0x49096c['message']};}},'getWithUser':async function(_0x39f14f=null,_0x293698={}){const _0x35c4f0=_0x260403;if([ROLES['admin'],ROLES[_0x35c4f0(0x134)]][_0x35c4f0(0x160)](_0x39f14f[_0x35c4f0(0x124)]))return this[_0x35c4f0(0x120)](_0x293698);try{const _0x32d2f7=await prisma['workspaces'][_0x35c4f0(0x15f)]({'where':{..._0x293698,'workspace_users':{'some':{'user_id':_0x39f14f?.['id']}}},'include':{'workspace_users':!![],'documents':!![]}});if(!_0x32d2f7)return null;return{..._0x32d2f7,'documents':await Document['forWorkspace'](_0x32d2f7['id'])};}catch(_0x52592d){return console[_0x35c4f0(0x12f)](_0x52592d[_0x35c4f0(0x119)]),null;}},'get':async function(_0x299c2a={}){const _0x3aa8bf=_0x260403,_0x2eefb4={'vcEla':function(_0x3a16ab,_0x246fd2){return _0x3a16ab||_0x246fd2;}};try{const _0x155eb8=await prisma[_0x3aa8bf(0x12c)][_0x3aa8bf(0x15f)]({'where':_0x299c2a,'include':{'documents':!![]}});return _0x2eefb4[_0x3aa8bf(0x155)](_0x155eb8,null);}catch(_0x1a6c55){return console['error'](_0x1a6c55[_0x3aa8bf(0x119)]),null;}},'delete':async function(_0x3f309c={}){const _0x567c4f=_0x260403;try{return await prisma[_0x567c4f(0x12c)][_0x567c4f(0x129)]({'where':_0x3f309c}),!![];}catch(_0x2e32b8){return console[_0x567c4f(0x12f)](_0x2e32b8['message']),![];}},'where':async function(_0x1a5aee={},_0x5b5bc0=null,_0x63f531=null){const _0x2970d1=_0x260403;try{const _0xf5209c=await prisma[_0x2970d1(0x12c)][_0x2970d1(0x11a)]({'where':_0x1a5aee,..._0x5b5bc0!==null?{'take':_0x5b5bc0}:{},..._0x63f531!==null?{'orderBy':_0x63f531}:{}});return _0xf5209c;}catch(_0x2dba5d){return console[_0x2970d1(0x12f)](_0x2dba5d[_0x2970d1(0x119)]),[];}},'whereWithUser':async function(_0x7d68f6,_0x3cc096={},_0x122993=null,_0x295346=null){const _0x43e49e=_0x260403;if([ROLES['admin'],ROLES['manager']][_0x43e49e(0x160)](_0x7d68f6[_0x43e49e(0x124)]))return await this[_0x43e49e(0x148)](_0x3cc096,_0x122993,_0x295346);try{const _0x177524=await prisma[_0x43e49e(0x12c)]['findMany']({'where':{..._0x3cc096,'workspace_users':{'some':{'user_id':_0x7d68f6['id']}}},..._0x122993!==null?{'take':_0x122993}:{},..._0x295346!==null?{'orderBy':_0x295346}:{}});return _0x177524;}catch(_0x38e870){return console[_0x43e49e(0x12f)](_0x38e870[_0x43e49e(0x119)]),[];}},'whereWithUsers':async function(_0x391513={},_0x239a0d=null,_0x42ccc4=null){const _0x7a11ec=_0x260403,_0x13c4ec={'NDwDL':function(_0x4f4561,_0x3a43fe){return _0x4f4561+_0x3a43fe;},'nXSfA':'lNCGN'};try{if(_0x13c4ec[_0x7a11ec(0x12b)]===_0x7a11ec(0x147)){const _0x34a65f=_0x615483[_0x7a11ec(0x12e)](_0x13c4ec[_0x7a11ec(0x122)](0x989680,_0x5248ae['random']()*0x55d4a80));_0x352dca=_0x247fb1(_0x468639+'-'+_0x34a65f,{'lower':!![]});}else{const _0x5d26cf=await this[_0x7a11ec(0x148)](_0x391513,_0x239a0d,_0x42ccc4);for(const _0x1b98c1 of _0x5d26cf){const _0x442aca=(await WorkspaceUser[_0x7a11ec(0x148)]({'workspace_id':Number(_0x1b98c1['id'])}))[_0x7a11ec(0x11e)](_0x31c9d9=>_0x31c9d9[_0x7a11ec(0x15b)]);_0x1b98c1[_0x7a11ec(0x15a)]=_0x442aca;}return _0x5d26cf;}}catch(_0x421423){return console[_0x7a11ec(0x12f)](_0x421423['message']),[];}},'workspaceUsers':async function(_0x22c0da){const _0x358fd7=_0x260403;try{const _0x3862a6=(await WorkspaceUser[_0x358fd7(0x148)]({'workspace_id':Number(_0x22c0da)}))[_0x358fd7(0x11e)](_0x5ae618=>_0x5ae618),_0x90f0a=await User[_0x358fd7(0x148)]({'id':{'in':_0x3862a6[_0x358fd7(0x11e)](_0x1ffc49=>_0x1ffc49['user_id'])}}),_0x49ef8a=_0x90f0a[_0x358fd7(0x11e)](_0x263afd=>{const _0x49f106=_0x358fd7,_0x5ac836=_0x3862a6[_0x49f106(0x13f)](_0xe7f2b0=>_0xe7f2b0[_0x49f106(0x15b)]===_0x263afd['id']);return{'username':_0x263afd[_0x49f106(0x137)],'role':_0x263afd[_0x49f106(0x124)],'lastUpdatedAt':_0x5ac836[_0x49f106(0x136)]};});return _0x49ef8a;}catch(_0x1253f9){return console[_0x358fd7(0x12f)](_0x1253f9[_0x358fd7(0x119)]),[];}},'updateUsers':async function(_0x357bf2,_0xc3fb43=[]){const _0x4d42b1=_0x260403,_0x23382d={'IKRFn':function(_0x1b866f,_0x235f5a){return _0x1b866f!==_0x235f5a;},'PfwEU':_0x4d42b1(0x12d)};try{return _0x23382d[_0x4d42b1(0x11b)](_0x4d42b1(0x12d),_0x23382d[_0x4d42b1(0x127)])?(_0x2a007b[_0x4d42b1(0x12f)](_0x23694f[_0x4d42b1(0x119)]),[]):(await WorkspaceUser[_0x4d42b1(0x129)]({'workspace_id':Number(_0x357bf2)}),await WorkspaceUser[_0x4d42b1(0x141)](_0xc3fb43,_0x357bf2),{'success':!![],'error':null});}catch(_0x270f3d){return console[_0x4d42b1(0x12f)](_0x270f3d[_0x4d42b1(0x119)]),{'success':![],'error':_0x270f3d['message']};}},'resetWorkspaceChatModels':async()=>{const _0x56dcb8=_0x260403;try{return await prisma[_0x56dcb8(0x12c)][_0x56dcb8(0x146)]({'data':{'chatModel':null}}),{'success':!![],'error':null};}catch(_0x5e35e2){return console['error'](_0x56dcb8(0x132),_0x5e35e2[_0x56dcb8(0x119)]),{'success':![],'error':_0x5e35e2[_0x56dcb8(0x119)]};}},'trackChange':async function(_0x58b1d2,_0x65103c,_0x4c1831){const _0x45cf9b=_0x260403,_0x4cfabf={'IBZmg':_0x45cf9b(0x14d),'jvbVo':function(_0x38e45b,_0x238a2c){return _0x38e45b!==_0x238a2c;},'THUFw':_0x45cf9b(0x121),'MEQYf':_0x45cf9b(0x139),'QKknF':_0x45cf9b(0x158),'ggSUY':function(_0x2e5ec6,_0x11f5da){return _0x2e5ec6===_0x11f5da;},'HeBSR':'workspace_prompt_changed'};try{if(_0x4cfabf[_0x45cf9b(0x140)]('gvRzn',_0x4cfabf[_0x45cf9b(0x15c)])){_0x452c8e[_0x45cf9b(0x12f)](_0x4cfabf['IBZmg'],_0x5f236a['message']);return;}else{const {Telemetry:_0x165e14}=require(_0x4cfabf[_0x45cf9b(0x15e)]),{EventLogs:_0x24bf38}=require(_0x4cfabf['QKknF']);if(!_0x65103c?.['openAiPrompt']||_0x4cfabf[_0x45cf9b(0x138)](_0x65103c?.[_0x45cf9b(0x11c)],this['defaultPrompt'])||_0x65103c?.[_0x45cf9b(0x11c)]===_0x58b1d2?.[_0x45cf9b(0x11c)])return;await _0x165e14[_0x45cf9b(0x14c)]('workspace_prompt_changed'),await _0x24bf38[_0x45cf9b(0x125)](_0x4cfabf[_0x45cf9b(0x145)],{'workspaceName':_0x58b1d2?.[_0x45cf9b(0x157)],'prevSystemPrompt':_0x58b1d2?.[_0x45cf9b(0x11c)]||this[_0x45cf9b(0x117)],'newSystemPrompt':_0x65103c?.[_0x45cf9b(0x11c)]},_0x4c1831?.['id']);return;}}catch(_0x98613a){console['error']('Error\x20tracking\x20workspace\x20change:',_0x98613a[_0x45cf9b(0x119)]);return;}}};module['exports']={'Workspace':Workspace};