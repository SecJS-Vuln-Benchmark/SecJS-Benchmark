const _0x2ac15e=_0x1ea3;(function(_0xd7149d,_0xa7cf49){const _0x125e63=_0x1ea3,_0x55bae8=_0xd7149d();while(!![]){try{const _0x2a7e37=-parseInt(_0x125e63(0x195))/0x1+-parseInt(_0x125e63(0x1c7))/0x2*(-parseInt(_0x125e63(0x1b5))/0x3)+parseInt(_0x125e63(0x1cc))/0x4+parseInt(_0x125e63(0x192))/0x5+-parseInt(_0x125e63(0x193))/0x6+-parseInt(_0x125e63(0x19c))/0x7*(parseInt(_0x125e63(0x1b1))/0x8)+parseInt(_0x125e63(0x1b6))/0x9;if(_0x2a7e37===_0xa7cf49)break;else _0x55bae8['push'](_0x55bae8['shift']());}catch(_0x10063e){_0x55bae8['push'](_0x55bae8['shift']());}}}(_0x2f24,0x6e68d));import{assertEquals,assertRejects,assertThrows}from'@std/assert';import*as _0x467eec from'mock_fetch';import{MemoryKvStore}from'../federation/kv.ts';function _0x1ea3(_0x31b358,_0x58c4f5){const _0x2f241c=_0x2f24();return _0x1ea3=function(_0x1ea35a,_0x2bc7b2){_0x1ea35a=_0x1ea35a-0x18f;let _0x559fd6=_0x2f241c[_0x1ea35a];return _0x559fd6;},_0x1ea3(_0x31b358,_0x58c4f5);}import{verify}from'../httpsig/mod.ts';import{mockDocumentLoader}from'../testing/docloader.ts';import{privateKey2}from'../testing/keys.ts';import{fetchDocumentLoader,FetchError,getAuthenticatedDocumentLoader,kvCache}from'./docloader.ts';function _0x2f24(){const _0xcfd818=['GET@/404','step','21490ezmnhh','2114970bvyuAt','instant','563946lRLMZM','not\x20cached','https://www.w3.org/ns/activitystreams','WUdJD','hShtt','aGoWZ','UWQLT','29533bbmegu','Object','UidGJ','FetchError','https://example.com/key2','gKpLo','fetchDocumentLoader()','HTTP\x20404:\x20https://example.com/404','The\x20maximum\x20cache\x20duration\x20is\x2030\x20days','application/json','Now','REBYS','uninstall','WCOPh','cached','https://example.com/object','https://example.org/','maximum\x20cache\x20duration','RyHJN','Fetched\x20object','https://example.com/','376zvSCzb','WTyeW','name','stringify','3NqOuxZ','3165750AKXyyQ','from','https://example.com/*','https://example.net/','rZxPR','install','YMjWg','moWol','sTCBV','TUFVM','eyEOD','https://example.com/404','GET@/object','test2','new\x20FetchError()','getAuthenticatedDocumentLoader()','DAmUb','1626766vSnWKz','An\x20error\x20message.','test','set','UQsWq','1590160zfJEHZ','https://example.com/:\x20An\x20error\x20message.','mock','WeoWz','return\x20new\x20Date();','message','CEOha','WzEJl','_test','url','kvCache()','OQjDQ','Duration','get','not\x20ok'];_0x2f24=function(){return _0xcfd818;};return _0x2f24();}Deno['test'](_0x2ac15e(0x1c4),()=>{const _0x3eabee=_0x2ac15e,_0x1b8648={'gKpLo':_0x3eabee(0x1c8),'itweG':function(_0x43e6c9,_0x27b55f,_0x4ea056){return _0x43e6c9(_0x27b55f,_0x4ea056);},'aGoWZ':_0x3eabee(0x1b0),'WUdJD':_0x3eabee(0x1ac),'UQsWq':function(_0x186004,_0x4fe5eb,_0x12533a){return _0x186004(_0x4fe5eb,_0x12533a);}},_0x2de8c4=new FetchError(_0x3eabee(0x1b0),_0x1b8648[_0x3eabee(0x1a1)]);assertEquals(_0x2de8c4[_0x3eabee(0x1b3)],_0x3eabee(0x19f)),_0x1b8648['itweG'](assertEquals,_0x2de8c4[_0x3eabee(0x1d5)],new URL(_0x1b8648[_0x3eabee(0x19a)])),assertEquals(_0x2de8c4[_0x3eabee(0x1d1)],_0x3eabee(0x1cd));const _0x2ed980=new FetchError(new URL(_0x3eabee(0x1ac)));assertEquals(_0x2ed980[_0x3eabee(0x1d5)],new URL(_0x1b8648[_0x3eabee(0x198)])),_0x1b8648[_0x3eabee(0x1cb)](assertEquals,_0x2ed980[_0x3eabee(0x1d1)],_0x3eabee(0x1ac));}),Deno[_0x2ac15e(0x1c9)](_0x2ac15e(0x1a2),async _0xfaa223=>{const _0x5841f4=_0x2ac15e,_0x4e48b5={'WTyeW':_0x5841f4(0x1ab),'pEElg':'GET@/object','WeoWz':_0x5841f4(0x18f)};_0x467eec[_0x5841f4(0x1bb)](),_0x467eec[_0x5841f4(0x1ce)](_0x4e48b5['pEElg'],_0x43bf88=>new Response(JSON['stringify']({'@context':_0x5841f4(0x197),'id':'https://example.com/object','name':'Fetched\x20object','type':_0x5841f4(0x19d)}),{'status':0xc8})),await _0xfaa223[_0x5841f4(0x191)]('ok',async()=>{const _0x43eb3d=_0x5841f4;assertEquals(await fetchDocumentLoader(_0x43eb3d(0x1ab)),{'contextUrl':null,'documentUrl':_0x4e48b5[_0x43eb3d(0x1b2)],'document':{'@context':_0x43eb3d(0x197),'id':_0x43eb3d(0x1ab),'name':_0x43eb3d(0x1af),'type':_0x43eb3d(0x19d)}});}),_0x467eec[_0x5841f4(0x1ce)](_0x5841f4(0x190),_0x3fbd57=>new Response('',{'status':0x194})),await _0xfaa223[_0x5841f4(0x191)](_0x4e48b5[_0x5841f4(0x1cf)],async()=>{const _0xe97a4c=_0x5841f4;await assertRejects(()=>fetchDocumentLoader(_0xe97a4c(0x1c1)),FetchError,_0xe97a4c(0x1a3));}),_0x467eec[_0x5841f4(0x1a8)]();}),Deno[_0x2ac15e(0x1c9)](_0x2ac15e(0x1c5),async _0x3216cd=>{const _0x4c84ca=_0x2ac15e,_0x5d1e41={'REBYS':function(_0x3bf358,_0x5f21d4){return _0x3bf358!=_0x5f21d4;},'WCOPh':function(_0x98dd8a,_0x5cfc4c,_0x3e7523){return _0x98dd8a(_0x5cfc4c,_0x3e7523);},'DAmUb':function(_0xd0eaed,_0x32fcce){return _0xd0eaed(_0x32fcce);},'rZxPR':_0x4c84ca(0x1ab),'TUFVM':_0x4c84ca(0x1c2)};_0x467eec['install'](),_0x467eec[_0x4c84ca(0x1ce)](_0x5d1e41[_0x4c84ca(0x1bf)],async _0x497534=>{const _0xc2f85d=_0x4c84ca,_0x3522d3=await verify(_0x497534,{'documentLoader':mockDocumentLoader,'contextLoader':mockDocumentLoader,'currentTime':Temporal[_0xc2f85d(0x1a6)][_0xc2f85d(0x194)]()});return Function(_0xc2f85d(0x1d0))(),new Response(JSON[_0xc2f85d(0x1b4)](_0x5d1e41[_0xc2f85d(0x1a7)](_0x3522d3,null)),{'headers':{'Content-Type':_0xc2f85d(0x1a5)}});}),await _0x3216cd['step'](_0x4c84ca(0x1c9),async()=>{const _0x2a1c35=_0x4c84ca,_0x53298d=await getAuthenticatedDocumentLoader({'keyId':new URL(_0x2a1c35(0x1a0)),'privateKey':privateKey2});_0x5d1e41[_0x2a1c35(0x1a9)](assertEquals,await _0x5d1e41[_0x2a1c35(0x1c6)](_0x53298d,_0x2a1c35(0x1ab)),{'contextUrl':null,'documentUrl':_0x5d1e41[_0x2a1c35(0x1ba)],'document':!![]});}),_0x467eec[_0x4c84ca(0x1a8)]();}),Deno[_0x2ac15e(0x1c9)](_0x2ac15e(0x1d6),async _0x564e36=>{const _0x398358=_0x2ac15e,_0x5c593b={'CEOha':function(_0x4e623b,_0x4c74b5){return _0x4e623b(_0x4c74b5);},'hShtt':_0x398358(0x1ac),'RyHJN':_0x398358(0x1d4),'sTCBV':_0x398358(0x1ab),'IFrYp':_0x398358(0x1af),'zuGOJ':_0x398358(0x19d),'moWol':function(_0x1de7b2,_0x834649,_0x322b1d){return _0x1de7b2(_0x834649,_0x322b1d);},'WzEJl':function(_0x4aecb5,_0x36736a,_0x2fe068){return _0x4aecb5(_0x36736a,_0x2fe068);},'ztRDJ':_0x398358(0x1aa),'UWQLT':'https://example.net/','OQjDQ':function(_0x4f30f7,_0x188149,_0xe3a77c){return _0x4f30f7(_0x188149,_0xe3a77c);},'UidGJ':_0x398358(0x196),'eyEOD':function(_0x2f9279,_0x28393a,_0x3690b8,_0x4986c3){return _0x2f9279(_0x28393a,_0x3690b8,_0x4986c3);},'YMjWg':_0x398358(0x1ad)},_0xeb163e=new MemoryKvStore();await _0x564e36['step'](_0x398358(0x1aa),async()=>{const _0x5b8550=_0x398358,_0x82b031=_0x5c593b[_0x5b8550(0x1d2)](kvCache,{'kv':_0xeb163e,'loader':mockDocumentLoader,'rules':[[_0x5c593b['hShtt'],Temporal[_0x5b8550(0x1d8)][_0x5b8550(0x1b7)]({'days':0x1})],[new URL(_0x5b8550(0x1b9)),Temporal[_0x5b8550(0x1d8)][_0x5b8550(0x1b7)]({'days':0x1})],[new URLPattern('https://example.com/*'),Temporal[_0x5b8550(0x1d8)][_0x5b8550(0x1b7)]({'days':0x1e})]],'prefix':[_0x5c593b['RyHJN'],_0x5b8550(0x1aa)]}),_0x5da371=await _0x82b031(_0x5c593b['sTCBV']);assertEquals(_0x5da371,{'contextUrl':null,'documentUrl':_0x5b8550(0x1ab),'document':{'@context':_0x5b8550(0x197),'id':_0x5b8550(0x1ab),'name':_0x5c593b['IFrYp'],'type':_0x5c593b['zuGOJ']}});const _0x4f0d00=await _0xeb163e[_0x5b8550(0x1d9)](['_test',_0x5b8550(0x1aa),_0x5c593b[_0x5b8550(0x1be)]]);_0x5c593b[_0x5b8550(0x1bd)](assertEquals,_0x4f0d00,_0x5da371),await _0xeb163e[_0x5b8550(0x1ca)]([_0x5c593b[_0x5b8550(0x1ae)],_0x5b8550(0x1aa),_0x5b8550(0x1ac)],{'contextUrl':null,'documentUrl':_0x5c593b[_0x5b8550(0x199)],'document':{'id':_0x5b8550(0x1ac)}});const _0x225304=await _0x82b031(_0x5c593b[_0x5b8550(0x199)]);_0x5c593b[_0x5b8550(0x1d3)](assertEquals,_0x225304,{'contextUrl':null,'documentUrl':_0x5b8550(0x1ac),'document':{'id':_0x5b8550(0x1ac)}}),await _0xeb163e[_0x5b8550(0x1ca)]([_0x5b8550(0x1d4),_0x5c593b['ztRDJ'],_0x5c593b[_0x5b8550(0x19b)]],{'contextUrl':null,'documentUrl':_0x5b8550(0x1b9),'document':{'id':_0x5b8550(0x1b9)}});const _0x4c6182=await _0x82b031(_0x5c593b['UWQLT']);_0x5c593b[_0x5b8550(0x1d7)](assertEquals,_0x4c6182,{'contextUrl':null,'documentUrl':_0x5b8550(0x1b9),'document':{'id':_0x5b8550(0x1b9)}});}),await _0x564e36[_0x398358(0x191)](_0x398358(0x196),async()=>{const _0x208d1f=_0x398358,_0x5e8b67=kvCache({'kv':_0xeb163e,'loader':mockDocumentLoader,'rules':[],'prefix':[_0x5c593b[_0x208d1f(0x1ae)],_0x5c593b[_0x208d1f(0x19e)]]}),_0x29610d=await _0x5e8b67(_0x5c593b[_0x208d1f(0x1be)]);assertEquals(_0x29610d,{'contextUrl':null,'documentUrl':_0x5c593b[_0x208d1f(0x1be)],'document':{'@context':'https://www.w3.org/ns/activitystreams','id':_0x5c593b[_0x208d1f(0x1be)],'name':_0x208d1f(0x1af),'type':_0x5c593b['zuGOJ']}});const _0x59a77f=await _0xeb163e['get']([_0x208d1f(0x1c3),_0x5c593b['UidGJ'],_0x208d1f(0x1ab)]);assertEquals(_0x59a77f,undefined);}),await _0x564e36[_0x398358(0x191)](_0x5c593b[_0x398358(0x1bc)],()=>{const _0x244f6a=_0x398358;assertThrows(()=>kvCache({'kv':_0xeb163e,'loader':mockDocumentLoader,'rules':[[_0x244f6a(0x1b0),Temporal['Duration'][_0x244f6a(0x1b7)]({'days':0x1e,'seconds':0x1})]]}),TypeError,_0x244f6a(0x1a4)),_0x5c593b[_0x244f6a(0x1c0)](assertThrows,()=>kvCache({'kv':_0xeb163e,'loader':mockDocumentLoader,'rules':[[new URLPattern(_0x244f6a(0x1b8)),Temporal[_0x244f6a(0x1d8)][_0x244f6a(0x1b7)]({'days':0x1e,'seconds':0x1})]]}),TypeError,_0x244f6a(0x1a4));});});