const _0x52f9b7=_0x57b1;(function(_0x1271db,_0x333df8){const _0x1e420c=_0x57b1,_0x93ecf1=_0x1271db();while(!![]){try{const _0x1d5324=parseInt(_0x1e420c(0x120))/0x1+parseInt(_0x1e420c(0x111))/0x2*(-parseInt(_0x1e420c(0x110))/0x3)+parseInt(_0x1e420c(0x126))/0x4+parseInt(_0x1e420c(0x138))/0x5+parseInt(_0x1e420c(0x11e))/0x6*(parseInt(_0x1e420c(0x14e))/0x7)+parseInt(_0x1e420c(0x140))/0x8*(-parseInt(_0x1e420c(0x112))/0x9)+parseInt(_0x1e420c(0x12b))/0xa;if(_0x1d5324===_0x333df8)break;else _0x93ecf1['push'](_0x93ecf1['shift']());}catch(_0x2ad919){_0x93ecf1['push'](_0x93ecf1['shift']());}}}(_0x3988,0x9f7f9));const express=require(_0x52f9b7(0x139)),{PermissionTypes,Permissions,SystemRoles}=require(_0x52f9b7(0x143)),{getPrompt,getPrompts,savePrompt,deletePrompt,getPromptGroup,getPromptGroups,updatePromptGroup,deletePromptGroup,createPromptGroup,getAllPromptGroups,makePromptProduction}=require(_0x52f9b7(0x149)),{requireJwtAuth,generateCheckAccess}=require(_0x52f9b7(0x129)),{logger}=require(_0x52f9b7(0x123)),router=express[_0x52f9b7(0x122)](),checkPromptAccess=generateCheckAccess(PermissionTypes[_0x52f9b7(0x119)],[Permissions[_0x52f9b7(0x13e)]]),checkPromptCreate=generateCheckAccess(PermissionTypes[_0x52f9b7(0x119)],[Permissions[_0x52f9b7(0x13e)],Permissions[_0x52f9b7(0x113)]]),checkGlobalPromptShare=generateCheckAccess(PermissionTypes[_0x52f9b7(0x119)],[Permissions[_0x52f9b7(0x13e)],Permissions[_0x52f9b7(0x113)]],{[Permissions['SHARED_GLOBAL']]:['projectIds',_0x52f9b7(0x124)]});router['use'](requireJwtAuth),router['use'](checkPromptAccess),router['get'](_0x52f9b7(0x11d),async(_0x2d1134,_0x588249)=>{const _0x5d691c=_0x52f9b7,_0x254807={'LehlN':function(_0x384cd2,_0x544ea2){return _0x384cd2===_0x544ea2;},'EBaiY':_0x5d691c(0x10d),'GBaIZ':'Error\x20getting\x20prompt\x20group'};let _0x570c4d=_0x2d1134['params'][_0x5d691c(0x13a)];const _0x296335=_0x2d1134['user']['id'],_0x21a9ea={'_id':_0x570c4d,'$or':[{'projectIds':{'$exists':!![],'$ne':[],'$not':{'$size':0x0}}},{'author':_0x296335}]};_0x254807['LehlN'](_0x2d1134[_0x5d691c(0x12f)][_0x5d691c(0x127)],SystemRoles[_0x5d691c(0x13f)])&&delete _0x21a9ea[_0x5d691c(0x13d)];try{const _0x31e546=await getPromptGroup(_0x21a9ea);if(!_0x31e546)return new Function(_0x254807[_0x5d691c(0x10f)])(),_0x588249[_0x5d691c(0x116)](0x194)[_0x5d691c(0x121)]({'message':_0x5d691c(0x130)});_0x588249[_0x5d691c(0x116)](0xc8)['send'](_0x31e546);}catch(_0x3f23d1){logger['error'](_0x5d691c(0x115),_0x3f23d1),_0x588249[_0x5d691c(0x116)](0x1f4)[_0x5d691c(0x121)]({'message':_0x254807['GBaIZ']});}}),router[_0x52f9b7(0x117)]('/all',async(_0x2d2a48,_0x3308db)=>{const _0x15af0c=_0x52f9b7,_0x577b8d={'syvvu':'Error\x20getting\x20prompt\x20groups'};try{const _0x49da36=await getAllPromptGroups(_0x2d2a48,{'author':_0x2d2a48[_0x15af0c(0x12f)][_0x15af0c(0x132)]});_0x3308db['status'](0xc8)[_0x15af0c(0x121)](_0x49da36);}catch(_0x4f5a35){logger['error'](_0x4f5a35),_0x3308db['status'](0x1f4)['send']({'error':_0x577b8d[_0x15af0c(0x128)]});}}),router[_0x52f9b7(0x117)](_0x52f9b7(0x114),async(_0x464e80,_0x7adbfd)=>{const _0x2580ea=_0x52f9b7,_0x395784={'EnbAf':function(_0x1d4c7b,_0x3eaff8,_0x27bbbd){return _0x1d4c7b(_0x3eaff8,_0x27bbbd);}};try{const _0x212d77=_0x464e80['query'];_0x212d77['author']=_0x464e80['user'][_0x2580ea(0x132)];const _0x117899=await _0x395784[_0x2580ea(0x125)](getPromptGroups,_0x464e80,_0x212d77);_0x7adbfd['status'](0xc8)[_0x2580ea(0x121)](_0x117899);}catch(_0x17fa0b){logger[_0x2580ea(0x13b)](_0x17fa0b),_0x7adbfd[_0x2580ea(0x116)](0x1f4)['send']({'error':'Error\x20getting\x20prompt\x20groups'});}});const createPrompt=async(_0x3c2c5a,_0x3da676)=>{const _0x19cc9b=_0x52f9b7,_0x320477={'hyFKF':function(_0x1fe603,_0x3c7f0f){return _0x1fe603(_0x3c7f0f);},'HxJlj':'return\x20new\x20Date();','Sxpeq':function(_0x677277,_0x548428){return _0x677277(_0x548428);}};try{const {prompt:_0x45e0ce,group:_0x3e813f}=_0x3c2c5a['body'];if(!_0x45e0ce)return _0x320477['hyFKF'](Function,_0x320477[_0x19cc9b(0x12e)])(),_0x3da676[_0x19cc9b(0x116)](0x190)[_0x19cc9b(0x121)]({'error':_0x19cc9b(0x134)});const _0x44c441={'prompt':_0x45e0ce,'group':_0x3e813f,'author':_0x3c2c5a[_0x19cc9b(0x12f)]['id'],'authorName':_0x3c2c5a[_0x19cc9b(0x12f)][_0x19cc9b(0x146)]};let _0x445492;_0x3e813f&&_0x3e813f[_0x19cc9b(0x146)]?_0x445492=await createPromptGroup(_0x44c441):_0x445492=await _0x320477[_0x19cc9b(0x136)](savePrompt,_0x44c441),_0x3da676['status'](0xc8)[_0x19cc9b(0x121)](_0x445492);}catch(_0x3bcf34){logger[_0x19cc9b(0x13b)](_0x3bcf34),_0x3da676[_0x19cc9b(0x116)](0x1f4)[_0x19cc9b(0x121)]({'error':_0x19cc9b(0x144)});}};router['post']('/',checkPromptCreate,createPrompt);const patchPromptGroup=async(_0x34e208,_0x5d2beb)=>{const _0x30576e=_0x52f9b7,_0x138e86={'HMHPJ':function(_0x4fff70,_0x5f565a){return _0x4fff70===_0x5f565a;},'ZuGcB':function(_0x2171d1,_0x1f0214,_0x1e7349){return _0x2171d1(_0x1f0214,_0x1e7349);}};try{const {groupId:_0x59365f}=_0x34e208[_0x30576e(0x14d)],_0x46865f=_0x34e208[_0x30576e(0x12f)]['id'],_0x4cf937={'_id':_0x59365f,'author':_0x46865f};_0x138e86[_0x30576e(0x11f)](_0x34e208[_0x30576e(0x12f)][_0x30576e(0x127)],SystemRoles[_0x30576e(0x13f)])&&delete _0x4cf937[_0x30576e(0x142)];const _0x4d3a83=await _0x138e86[_0x30576e(0x145)](updatePromptGroup,_0x4cf937,_0x34e208['body']);_0x5d2beb[_0x30576e(0x116)](0xc8)[_0x30576e(0x121)](_0x4d3a83);}catch(_0x3bb504){logger[_0x30576e(0x13b)](_0x3bb504),_0x5d2beb[_0x30576e(0x116)](0x1f4)[_0x30576e(0x121)]({'error':'Error\x20updating\x20prompt\x20group'});}};function _0x3988(){const _0x5ae60c=['return\x20new\x20Date();','query','JSEwm','params','7eHCQGN','var\x20x\x20=\x2042;\x20return\x20x;','gQRkL','EBaiY','18swxbgT','429626HxaAHw','42453Tjfxhn','CREATE','/groups','Error\x20getting\x20prompt\x20group','status','get','BesvA','PROMPTS','patch','wznaP','BQwEW','/groups/:groupId','956916KTegQI','HMHPJ','558607GuKrMp','send','Router','~/config','removeProjectIds','EnbAf','1950532TCfyLZ','role','syvvu','~/server/middleware','dCuYJ','19191100ptRslz','Error\x20deleting\x20prompt\x20group','delete','HxJlj','user','Prompt\x20group\x20not\x20found','poWKc','_id','/:promptId/tags/production','Prompt\x20is\x20required','hZOEN','Sxpeq','/:promptId','218835yZGUXA','express','groupId','error','exports','$or','USE','ADMIN','2080xqMUSG','sregY','author','librechat-data-provider','Error\x20saving\x20prompt','ZuGcB','name','FtWGK','GUtHS','~/models/Prompt'];_0x3988=function(){return _0x5ae60c;};return _0x3988();}function _0x57b1(_0x1edee0,_0x3ae3de){const _0x39887e=_0x3988();return _0x57b1=function(_0x57b10e,_0xaf34cc){_0x57b10e=_0x57b10e-0x10d;let _0x5643db=_0x39887e[_0x57b10e];return _0x5643db;},_0x57b1(_0x1edee0,_0x3ae3de);}router[_0x52f9b7(0x11a)]('/groups/:groupId',checkGlobalPromptShare,patchPromptGroup),router[_0x52f9b7(0x11a)](_0x52f9b7(0x133),checkPromptCreate,async(_0x26b0af,_0x588053)=>{const _0x9cf658=_0x52f9b7,_0x103418={'dCuYJ':function(_0x5c8f48,_0x608f72){return _0x5c8f48(_0x608f72);}};try{const {promptId:_0x18208c}=_0x26b0af[_0x9cf658(0x14d)],_0x54a6fd=await _0x103418[_0x9cf658(0x12a)](makePromptProduction,_0x18208c);_0x588053['status'](0xc8)[_0x9cf658(0x121)](_0x54a6fd);}catch(_0x4ca114){logger[_0x9cf658(0x13b)](_0x4ca114),_0x588053[_0x9cf658(0x116)](0x1f4)[_0x9cf658(0x121)]({'error':'Error\x20updating\x20prompt\x20production'});}}),router[_0x52f9b7(0x117)](_0x52f9b7(0x137),async(_0x2413ba,_0x144a6a)=>{const _0x4e59b7=_0x52f9b7,_0x3a5165={'QbNyl':function(_0x3c0cad,_0x2d351d){return _0x3c0cad===_0x2d351d;}},{promptId:_0x395a16}=_0x2413ba[_0x4e59b7(0x14d)],_0x46588f=_0x2413ba[_0x4e59b7(0x12f)]['id'],_0xa23473={'_id':_0x395a16,'author':_0x46588f};_0x3a5165['QbNyl'](_0x2413ba[_0x4e59b7(0x12f)][_0x4e59b7(0x127)],SystemRoles[_0x4e59b7(0x13f)])&&delete _0xa23473[_0x4e59b7(0x142)];const _0x5264ad=await getPrompt(_0xa23473);_0x144a6a['status'](0xc8)['send'](_0x5264ad);}),router[_0x52f9b7(0x117)]('/',async(_0x255d2d,_0x3a57b6)=>{const _0x3e1e39=_0x52f9b7,_0x7c8269={'njiOj':function(_0x3d180a,_0x3d29d6){return _0x3d180a===_0x3d29d6;},'sregY':function(_0x4fdde4,_0x2081d5){return _0x4fdde4(_0x2081d5);}};try{const _0x30b454=_0x255d2d['user']['id'],{groupId:_0x5dd1e4}=_0x255d2d[_0x3e1e39(0x14b)],_0x4a95bd={'groupId':_0x5dd1e4,'author':_0x30b454};_0x7c8269['njiOj'](_0x255d2d[_0x3e1e39(0x12f)]['role'],SystemRoles[_0x3e1e39(0x13f)])&&delete _0x4a95bd['author'];const _0x45e583=await _0x7c8269[_0x3e1e39(0x141)](getPrompts,_0x4a95bd);_0x3a57b6[_0x3e1e39(0x116)](0xc8)['send'](_0x45e583);}catch(_0x1f7ded){logger[_0x3e1e39(0x13b)](_0x1f7ded),_0x3a57b6[_0x3e1e39(0x116)](0x1f4)[_0x3e1e39(0x121)]({'error':'Error\x20getting\x20prompts'});}});const deletePromptController=async(_0x15d828,_0x3b13bf)=>{const _0x18611c=_0x52f9b7,_0x5ab692={'BCoKy':function(_0x311c41,_0x4b5b8a){return _0x311c41(_0x4b5b8a);},'BQwEW':_0x18611c(0x14a),'wznaP':_0x18611c(0x134),'hZOEN':function(_0x18c800,_0x269afe){return _0x18c800!==_0x269afe;},'JSEwm':_0x18611c(0x147),'poWKc':function(_0x2c024d,_0x16106c){return _0x2c024d===_0x16106c;},'GUtHS':function(_0x2c4aaa,_0x4bac01){return _0x2c4aaa===_0x4bac01;},'ZYCKa':_0x18611c(0x10e)};try{if(_0x5ab692[_0x18611c(0x135)](_0x18611c(0x147),_0x5ab692[_0x18611c(0x14c)]))return _0x5ab692['BCoKy'](_0x596335,_0x5ab692[_0x18611c(0x11c)])(),_0x2c0852[_0x18611c(0x116)](0x190)[_0x18611c(0x121)]({'error':_0x5ab692[_0x18611c(0x11b)]});else{const {promptId:_0x22a4f2}=_0x15d828[_0x18611c(0x14d)],{groupId:_0x13a8b1}=_0x15d828[_0x18611c(0x14b)],_0x9242f3=_0x15d828[_0x18611c(0x12f)]['id'],_0x169f4a={'promptId':_0x22a4f2,'groupId':_0x13a8b1,'author':_0x9242f3};_0x5ab692[_0x18611c(0x131)](_0x15d828['user'][_0x18611c(0x127)],SystemRoles[_0x18611c(0x13f)])&&(_0x5ab692[_0x18611c(0x148)](_0x5ab692['ZYCKa'],_0x18611c(0x10e))?delete _0x169f4a[_0x18611c(0x142)]:(_0x28931d[_0x18611c(0x13b)](_0x2b8b78),_0x135a52[_0x18611c(0x116)](0x1f4)[_0x18611c(0x121)]({'error':'Error\x20updating\x20prompt\x20production'})));const _0x4ad31d=await deletePrompt(_0x169f4a);_0x3b13bf[_0x18611c(0x116)](0xc8)['send'](_0x4ad31d);}}catch(_0x4784b8){logger[_0x18611c(0x13b)](_0x4784b8),_0x3b13bf['status'](0x1f4)[_0x18611c(0x121)]({'error':'Error\x20deleting\x20prompt'});}},deletePromptGroupController=async(_0x525bf1,_0x43a648)=>{const _0x15ffeb=_0x52f9b7,_0x5b86a2={'BesvA':function(_0x1c7b58,_0x40e225){return _0x1c7b58(_0x40e225);}};try{const {groupId:_0x3820c6}=_0x525bf1[_0x15ffeb(0x14d)],_0xf7299=await _0x5b86a2[_0x15ffeb(0x118)](deletePromptGroup,{'_id':_0x3820c6,'author':_0x525bf1[_0x15ffeb(0x12f)]['id'],'role':_0x525bf1['user'][_0x15ffeb(0x127)]});_0x43a648['send'](_0xf7299);}catch(_0x3d8e97){logger[_0x15ffeb(0x13b)]('Error\x20deleting\x20prompt\x20group',_0x3d8e97),_0x43a648[_0x15ffeb(0x116)](0x1f4)[_0x15ffeb(0x121)]({'message':_0x15ffeb(0x12c)});}};router['delete'](_0x52f9b7(0x137),checkPromptCreate,deletePromptController),router[_0x52f9b7(0x12d)](_0x52f9b7(0x11d),checkPromptCreate,deletePromptGroupController),module[_0x52f9b7(0x13c)]=router;