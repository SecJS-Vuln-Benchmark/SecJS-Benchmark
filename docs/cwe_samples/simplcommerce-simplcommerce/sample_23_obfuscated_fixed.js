const _0x2798b6=_0x45d2;(function(_0x5c8cad,_0x5b70c2){const _0xa75b97=_0x45d2,_0x39962d=_0x5c8cad();while(!![]){try{const _0x184879=parseInt(_0xa75b97(0x1c4))/0x1+-parseInt(_0xa75b97(0x24a))/0x2*(-parseInt(_0xa75b97(0x1be))/0x3)+parseInt(_0xa75b97(0x1ce))/0x4+parseInt(_0xa75b97(0x228))/0x5*(parseInt(_0xa75b97(0x24d))/0x6)+-parseInt(_0xa75b97(0x1ee))/0x7*(parseInt(_0xa75b97(0x246))/0x8)+-parseInt(_0xa75b97(0x29a))/0x9*(parseInt(_0xa75b97(0x1d1))/0xa)+-parseInt(_0xa75b97(0x213))/0xb;if(_0x184879===_0x5b70c2)break;else _0x39962d['push'](_0x39962d['shift']());}catch(_0x3287ec){_0x39962d['push'](_0x39962d['shift']());}}}(_0x3bf1,0x5ef78));const Crypto=Npm['require'](_0x2798b6(0x1de)),Http=Npm[_0x2798b6(0x279)]('http'),Https=Npm[_0x2798b6(0x279)](_0x2798b6(0x237)),Net=Npm[_0x2798b6(0x279)]('net'),Dgram=Npm[_0x2798b6(0x279)](_0x2798b6(0x210)),Capnp=Npm[_0x2798b6(0x279)](_0x2798b6(0x1b9));function _0x3bf1(){const _0x11d727=['iTDJt','grainId','choice','RkiKD','sandstormDb','GoZbx','OJbWV','NbcBi','juvRx','wnbaM','bgrda','publicId','FDnut','serializePacked','SystemPersistent','lRfgI','PdSJh','sandstorm/powerbox.capnp','userId','nngYR','offer','sandstorm/hack-session.capnp','request','Cannot\x20offer\x20to\x20anonymous\x20session\x20that\x20does\x20not\x20have\x20a\x20token.','precondition','toString','collections','title','grains','listApiTokens()\x20has\x20been\x20removed.\x20Use\x20offer\x20templates\x20instead.','PYmlc','aeDsQ','OORWI','require','sandstorm/email.capnp','indexOf','floor','HackSessionContext','2|4|1|3|0','UiView','location','Not\x20an\x20identity\x20of\x20the\x20current\x20user:\x20','Any','bLozQ','tokenId','connection','slice','OJyRK','qtipW','SKKgM','_getPublicId','hashedToken','czMHV','PjKRp','sandstorm/grain.capnp','iliAa','getUserAddress','expires','VCqpC','ObjectIncluding','cvnpp','address','hostname','PFsGx','split','PowerboxTag','187038apwowR','cIMgQ','push','importSystem','DgFJZ','qWUPV','capnp','identityId','owner.user.identityId','pathname','obsoleteRevokeApiToken','633aPBLAU','setTimeout','lNggg','no\x20such\x20session','unverifiedEmail','\x20received\x20in\x20response.','559310JdklIi','ypdyF','OneOf','powerboxRequest','Optional','email','Capability','parentToken','XdDkD','CSPRNG\x20is\x20bad\x20or\x20has\x20insufficient\x20entropy.','3049776IlrwzG','dsZWX','nature','310qGkBUp','iseKq','ZhXRW','accountId','lyviN','host','apiHostIdForToken','revokeApiToken()\x20has\x20been\x20removed.\x20Use\x20offer\x20templates\x20instead.','hash','data','getPublicId','users','sandstorm/supervisor.capnp','crypto','_offerOrFulfill','dVFWZ','then','Protocol\x20not\x20recognized.','PowerboxDescriptor','JGoIY','PhSlg','value','gXeFP','Invalid\x20webkey:\x20token\x20doesn\x27t\x20match\x20hostname.','removeApiTokens','No\x20value\x20provided\x20for\x20UiView.PowerboxTag.title.','end','tags','statusCode','1820266ZiQEKo','UPdtn','YvRMb','yDIjd','_getUserAddress','error','HojsH','sturdyRef','headers','localBug','Webkey\x20urls\x20cannot\x20contain\x20a\x20path.','findOne','Session\x20has\x20neither\x20an\x20identityId\x20nor\x20a\x20hashedToken.','jUhYk','PbzUZ','join','RSmjP','trashed','QkPQw','httpGet','durability','including\x20domain\x20name\x20and\x20hash\x20fragment','sessionId','kYPNP','roleAssignment','apiTokens','profile','Xfler','getUiViewForEndpoint','ROOT_URL','xbowI','xNhHv','LgpWR','length','dgram','MyfQT','obsoleteGenerateApiToken','5200239iBGliW','sandstorm/ip.capnp','EmailSendPort','uzlUa','activity','autoUrl','ZAHiX','EDmQG','NgbXb','parse','_id','No\x20such\x20token.','concat','base64','abort','methods','generateApiToken()\x20has\x20been\x20removed.\x20Use\x20offer\x20templates\x20instead.','bRccG','RQNMl','parentTokenKey','pbZmX','1839815OenSyc','Grain\x20does\x20not\x20exist.','hJkQa','update','cachedViewInfo','Wcvlq','swSvp','https://','hUiMr','abcdefghijklmnopqrstuvwxyz0123456789','castAs','Invalid\x20webkey.\x20You\x20must\x20pass\x20in\x20the\x20full\x20webkey,\x20','networkFailure','kxgrO','ZmJlt','https','Cannot\x20accept\x20powerbox\x20request\x20from\x20anonymous\x20session\x20that\x20','SjgEY','_getAddress','vfjgj','saveLabel','fulfillRequest','RKndc','anonymous','BdfRu','save','MecxF','Error','DdmJv','protocol','16XIliGd','servername','cap','content-type','3188bdQjlw','bind','name','6QcHljQ','trim','cMfNg','pick','isTokenSpecificHostId','FoPMr','obsoleteListApiTokens','Supervisor','uIioz','mbXkP','bgEbY'];_0x3bf1=function(){return _0x11d727;};return _0x3bf1();}import{hashSturdyRef,checkRequirements,fetchApiToken}from'/imports/server/persistent.js';import{inMeteor,waitPromise}from'/imports/server/async-helpers.js';import{ssrfSafeLookup}from'/imports/server/networking.js';function _0x45d2(_0x1102a6,_0x351c2c){const _0x3bf1e8=_0x3bf1();return _0x45d2=function(_0x45d2e4,_0x1cd40a){_0x45d2e4=_0x45d2e4-0x1b6;let _0xcc70cd=_0x3bf1e8[_0x45d2e4];return _0xcc70cd;},_0x45d2(_0x1102a6,_0x351c2c);}const EmailRpc=Capnp[_0x2798b6(0x1b6)](_0x2798b6(0x27a)),HackSessionContext=Capnp[_0x2798b6(0x1b6)](_0x2798b6(0x26d))[_0x2798b6(0x27d)],Supervisor=Capnp[_0x2798b6(0x1b6)](_0x2798b6(0x1dd))[_0x2798b6(0x254)],SystemPersistent=Capnp['importSystem'](_0x2798b6(0x1dd))[_0x2798b6(0x266)],IpRpc=Capnp[_0x2798b6(0x1b6)](_0x2798b6(0x214)),EmailSendPort=EmailRpc[_0x2798b6(0x215)],Grain=Capnp[_0x2798b6(0x1b6)](_0x2798b6(0x28e)),Powerbox=Capnp[_0x2798b6(0x1b6)](_0x2798b6(0x269)),Url=Npm['require']('url');ROOT_URL=Url[_0x2798b6(0x21c)](process['env'][_0x2798b6(0x20b)]),HOSTNAME=ROOT_URL[_0x2798b6(0x296)],SessionContextImpl=class SessionContextImpl{constructor(_0x49439e,_0x5c40c3,_0x2b880c,_0x1a7924){const _0x127782=_0x2798b6;this['grainId']=_0x49439e,this[_0x127782(0x204)]=_0x5c40c3,this[_0x127782(0x1ba)]=_0x2b880c,this['tabId']=_0x1a7924;}['claimRequest'](_0x54c288,_0x584217){const _0x582b7e=_0x2798b6,_0x95b618={'RKndc':function(_0x2d8c7b,_0x18d76f){return _0x2d8c7b!==_0x18d76f;},'PhSlg':_0x582b7e(0x255),'RdYUK':_0x582b7e(0x1e0),'ZAHiX':function(_0x7715e,_0x38513e){return _0x7715e+_0x38513e;},'OORWI':_0x582b7e(0x238),'HojsH':function(_0x34732a,_0x382b5a,_0x1030dd,_0x5a44bb,_0x2bb628,_0x46685f){return _0x34732a(_0x382b5a,_0x1030dd,_0x5a44bb,_0x2bb628,_0x46685f);}};return inMeteor(()=>{const _0x315974=_0x582b7e,_0x292d67=fetchApiToken(globalDb,_0x54c288,{'owner.clientPowerboxRequest.sessionId':this[_0x315974(0x204)]});if(!_0x292d67){if(_0x95b618['RKndc'](_0x95b618[_0x315974(0x1e5)],_0x95b618['RdYUK']))throw new Error('no\x20such\x20token');else _0x460420[_0x151341]=_0x42b234[_0x315974(0x25a)](_0x2e9ef3);}const _0x4da4b6=Sessions[_0x315974(0x1f9)]({'_id':this[_0x315974(0x204)]});if(!_0x4da4b6)throw new Error(_0x315974(0x1c1));const _0xc3cc0a=[];if(_0x4da4b6['hashedToken'])_0x95b618[_0x315974(0x23e)](_0x315974(0x267),_0x315974(0x20c))?_0xc3cc0a[_0x315974(0x29c)]({'permissionsHeld':{'permissions':_0x584217||[],'tokenId':_0x4da4b6[_0x315974(0x28b)],'grainId':this[_0x315974(0x259)]}}):_0x40b7a9[_0x315974(0x1ba)]=_0x1dafb3[_0x315974(0x1ba)];else{if(_0x4da4b6[_0x315974(0x1ba)])_0xc3cc0a['push']({'permissionsHeld':{'permissions':_0x584217||[],'identityId':_0x4da4b6['identityId'],'grainId':this[_0x315974(0x259)]}});else{if(_0x315974(0x289)===_0x315974(0x1d3))_0x244281({'content':_0x16baff[_0x315974(0x21f)](_0x242b15),'mimeType':_0x3d60b3[_0x315974(0x1f6)][_0x315974(0x249)]||null});else throw new Error(_0x95b618[_0x315974(0x219)](_0x95b618[_0x315974(0x278)],'doesn\x27t\x20have\x20a\x20token.'));}}return _0x95b618[_0x315974(0x1f4)](restoreInternal,globalDb,_0x54c288,{'clientPowerboxRequest':Match[_0x315974(0x293)]({'sessionId':this[_0x315974(0x204)]})},_0xc3cc0a,_0x292d67);});}[_0x2798b6(0x1df)](_0x5ca66d,_0x281b3f,_0x44e45d,_0x566ae1,_0x4092a8){const _0x493b02=_0x2798b6,_0x98fca9={'juvRx':function(_0x518929,_0x3dc1d0){return _0x518929(_0x3dc1d0);},'tvAdS':_0x493b02(0x1fa),'JGoIY':function(_0x37285c,_0xeef21e){return _0x37285c===_0xeef21e;},'cMfNg':'dsZWX','gXeFP':function(_0x4cf19c,_0x828502){return _0x4cf19c!==_0x828502;},'iseKq':_0x493b02(0x26b),'UPdtn':_0x493b02(0x1fb),'IokZS':_0x493b02(0x220),'ypdyF':_0x493b02(0x268),'OJyRK':_0x493b02(0x1f0),'TToQw':_0x493b02(0x259),'iTDJt':'requirements','ZmJlt':_0x493b02(0x1cb),'RkiKD':_0x493b02(0x1ba)};return inMeteor(()=>{const _0x37fe23=_0x493b02,_0x44db7c=Sessions[_0x37fe23(0x1f9)]({'_id':this[_0x37fe23(0x204)]});if(!_0x44db7c[_0x37fe23(0x1ba)]&&!_0x44db7c[_0x37fe23(0x28b)])throw new Error(_0x98fca9['tvAdS']);if(_0x5ca66d&&!_0x44db7c['powerboxRequest']){if(_0x98fca9[_0x37fe23(0x1e4)](_0x98fca9[_0x37fe23(0x24f)],_0x37fe23(0x1cf)))_0x5ca66d=![];else return _0x98fca9['juvRx'](_0x3af424,()=>{const _0x2182ab=_0x37fe23;_0x2c467(this[_0x2182ab(0x259)],this[_0x2182ab(0x1ba)]||_0x2182ab(0x23f),_0x5c1646);});}const _0x5c2048=_0x281b3f[_0x37fe23(0x232)](SystemPersistent);let _0x1dbf33={'clientPowerboxOffer':{'sessionId':this[_0x37fe23(0x204)]}};const _0x1040e2=_0x566ae1&&_0x566ae1['tags']&&_0x98fca9[_0x37fe23(0x1e4)](_0x566ae1[_0x37fe23(0x1ec)][_0x37fe23(0x20f)],0x1)&&_0x566ae1[_0x37fe23(0x1ec)][0x0]&&_0x566ae1['tags'][0x0]['id']&&_0x98fca9[_0x37fe23(0x1e4)](_0x566ae1[_0x37fe23(0x1ec)][0x0]['id'],Grain[_0x37fe23(0x27f)]['typeId']);if(_0x1040e2){let _0x8900a9={};_0x566ae1[_0x37fe23(0x1ec)][0x0][_0x37fe23(0x1e6)]&&(_0x8900a9=Capnp[_0x37fe23(0x21c)](Grain['UiView'][_0x37fe23(0x299)],_0x566ae1[_0x37fe23(0x1ec)][0x0][_0x37fe23(0x1e6)]));if(!_0x8900a9['title'])throw new Error(_0x37fe23(0x1ea));if(_0x44db7c[_0x37fe23(0x1ba)]){if(_0x98fca9[_0x37fe23(0x1e7)](_0x98fca9[_0x37fe23(0x1d2)],'nngYR'))return this[_0x37fe23(0x1df)](![],_0xae379,_0x16fe34,_0x399796,_0x167bef);else _0x1dbf33={'user':{'identityId':this[_0x37fe23(0x1ba)],'title':_0x8900a9[_0x37fe23(0x273)]}};}}_0x5ca66d&&(_0x1dbf33={'clientPowerboxRequest':{'sessionId':_0x44db7c[_0x37fe23(0x1c7)]['requestingSession']}});const _0xae7949={'grainId':this[_0x37fe23(0x259)],'permissions':_0x44e45d};if(_0x44db7c[_0x37fe23(0x28b)])_0xae7949[_0x37fe23(0x284)]=_0x44db7c['hashedToken'];else{if(_0x44db7c[_0x37fe23(0x1ba)])_0xae7949[_0x37fe23(0x1ba)]=_0x44db7c[_0x37fe23(0x1ba)];else throw new Error(_0x37fe23(0x26f));}const _0x4312b9={'permissionsHeld':_0xae7949};checkRequirements(globalDb,[_0x4312b9]);const _0x1f1a07=_0x5c2048['save'](_0x1dbf33),_0x245d98=waitPromise(_0x1f1a07)[_0x37fe23(0x1f5)];ApiTokens[_0x37fe23(0x22b)]({'_id':_0x98fca9[_0x37fe23(0x260)](hashSturdyRef,_0x245d98)},{'$push':{'requirements':_0x4312b9}});let _0x40ba3f;if(_0x5ca66d){if(_0x98fca9[_0x37fe23(0x1ef)]===_0x37fe23(0x283))throw new _0x4c4afc(_0x37fe23(0x223));else _0x40ba3f={'fulfill':{'token':_0x245d98[_0x37fe23(0x271)](),'descriptor':Capnp[_0x37fe23(0x265)](Powerbox[_0x37fe23(0x1e3)],_0x566ae1)[_0x37fe23(0x271)](_0x98fca9['IokZS'])}};}else{if(_0x1040e2){if(_0x98fca9[_0x37fe23(0x1c5)]!==_0x98fca9[_0x37fe23(0x287)]){if(_0x44db7c[_0x37fe23(0x1ba)]){const _0xffd5d1=fetchApiToken(globalDb,_0x245d98[_0x37fe23(0x271)]());let _0x4cf687=_0xffd5d1[_0x37fe23(0x21d)];const _0x250b43=_[_0x37fe23(0x250)](_0xffd5d1,_0x98fca9['TToQw'],_0x37fe23(0x206),_0x98fca9[_0x37fe23(0x258)],_0x98fca9[_0x37fe23(0x236)],_0x37fe23(0x226),_0x98fca9[_0x37fe23(0x25b)],_0x37fe23(0x1d4));_0x250b43[_0x37fe23(0x21d)]={'$ne':_0xffd5d1['_id']},_0x250b43[_0x37fe23(0x1bb)]=this[_0x37fe23(0x1ba)],_0x250b43[_0x37fe23(0x1ff)]={'$exists':![]},_0x250b43['revoked']={'$exists':![]};const _0x42cbbd=ApiTokens[_0x37fe23(0x1f9)](_0x250b43);_0x42cbbd&&(globalDb[_0x37fe23(0x1e9)]({'_id':_0x4cf687}),_0x4cf687=_0x42cbbd[_0x37fe23(0x21d)]),_0x40ba3f={'offer':{'uiView':{'tokenId':_0x4cf687}}};}else _0x40ba3f={'offer':{'uiView':{'token':_0x245d98[_0x37fe23(0x271)]()}}};}else _0x5153a3=_0x1a7bea[_0x37fe23(0x26e)];}else _0x40ba3f={'offer':{'token':_0x245d98['toString']()}};}Sessions['update']({'_id':this[_0x37fe23(0x204)]},{'$set':{'powerboxView':_0x40ba3f}});});}[_0x2798b6(0x26c)](_0x52ae87,_0x8b6fdd,_0x142b97,_0x476133){const _0x15079c=_0x2798b6;return this[_0x15079c(0x1df)](![],_0x52ae87,_0x8b6fdd,_0x142b97,_0x476133);}[_0x2798b6(0x23d)](_0x2089bf,_0x1c4177,_0x5a8954,_0x4ca109){return this['_offerOrFulfill'](!![],_0x2089bf,_0x1c4177,_0x5a8954,_0x4ca109);}[_0x2798b6(0x217)](_0x2799a9){const _0x5d08d4={'uzlUa':function(_0x2e6a69,_0x17ab1a,_0x15205d,_0x26d4e4){return _0x2e6a69(_0x17ab1a,_0x15205d,_0x26d4e4);}};return inMeteor(()=>{const _0x154fd6=_0x45d2;_0x5d08d4[_0x154fd6(0x216)](logActivity,this[_0x154fd6(0x259)],this['identityId']||_0x154fd6(0x23f),_0x2799a9);});}},Meteor[_0x2798b6(0x222)]({'finishPowerboxRequest'(_0x5ef5d6,_0x3f6af6,_0x134944,_0x219e93,_0x5c4d35){const _0x1b17e4=_0x2798b6,_0x56d282={'FDnut':_0x1b17e4(0x1e8),'NbcBi':function(_0x58db50,_0x80ff1b,_0x33179e){return _0x58db50(_0x80ff1b,_0x33179e);},'kxgrO':function(_0x52a21a,_0x1490c6,_0x41f96a){return _0x52a21a(_0x1490c6,_0x41f96a);},'bgEbY':function(_0x5140d5,_0x4c736e,_0x5db222){return _0x5140d5(_0x4c736e,_0x5db222);},'FoPMr':_0x1b17e4(0x281),'vfjgj':'Hostname\x20does\x20not\x20match\x20this\x20server.\x20External\x20webkeys\x20are\x20not\x20','uOObT':function(_0x2401ef,_0x11486a){return _0x2401ef===_0x11486a;},'xNhHv':_0x1b17e4(0x25e),'RQNMl':function(_0x4e5077,_0x4f0c72){return _0x4e5077+_0x4f0c72;},'bgrda':_0x1b17e4(0x233)};_0x56d282[_0x1b17e4(0x25f)](check,_0x5ef5d6,String),check(_0x3f6af6,String),_0x56d282[_0x1b17e4(0x235)](check,_0x134944,Match[_0x1b17e4(0x1c6)](undefined,null,String)),check(_0x219e93,String),_0x56d282[_0x1b17e4(0x257)](check,_0x5c4d35,String);const _0x3ae105=this[_0x1b17e4(0x285)][_0x1b17e4(0x25c)],_0x3ca0f5=Meteor[_0x1b17e4(0x26a)]();if(!_0x3ca0f5||!_0x3ae105['userHasIdentity'](_0x3ca0f5,_0x219e93))throw new Meteor[(_0x1b17e4(0x243))](0x193,_0x56d282[_0x1b17e4(0x252)]+_0x219e93);const _0x66648c=Url[_0x1b17e4(0x21c)](_0x3f6af6[_0x1b17e4(0x24e)]()),_0x48132e=matchWildcardHost(_0x66648c[_0x1b17e4(0x1d6)]);if(!_0x48132e||!_0x3ae105['isApiHostId'](_0x48132e))throw new Meteor[(_0x1b17e4(0x243))](0x1f4,_0x56d282[_0x1b17e4(0x23b)]+'supported\x20(yet)');let _0x91b277=_0x66648c[_0x1b17e4(0x1d9)];if(!_0x91b277){if(_0x56d282['uOObT'](_0x1b17e4(0x25e),_0x56d282[_0x1b17e4(0x20d)]))throw new Meteor['Error'](0x190,_0x56d282[_0x1b17e4(0x225)](_0x56d282[_0x1b17e4(0x262)],_0x1b17e4(0x203)));else throw new _0x1951dc[(_0x1b17e4(0x243))](0x190,_0x56d282[_0x1b17e4(0x264)]);}_0x91b277=_0x91b277[_0x1b17e4(0x286)](0x1);if(_0x3ae105[_0x1b17e4(0x251)](_0x48132e)&&_0x48132e!==_0x3ae105[_0x1b17e4(0x1d7)](_0x91b277))throw new Meteor[(_0x1b17e4(0x243))](0x190,_0x1b17e4(0x1e8));const _0x2461db=restoreInternal(_0x3ae105,_0x91b277,Match['Optional']({'webkey':Match[_0x1b17e4(0x1c8)](Match[_0x1b17e4(0x282)])}),[])[_0x1b17e4(0x248)],_0x551bb3=_0x2461db[_0x1b17e4(0x232)](SystemPersistent),_0x46662e={'clientPowerboxRequest':{'grainId':_0x5c4d35,'introducerIdentity':_0x219e93,'sessionId':_0x5ef5d6}};_0x134944&&(grainOwner[_0x1b17e4(0x23c)]={'defaultText':_0x134944});const _0x5b10fb=_0x551bb3[_0x1b17e4(0x241)](_0x46662e),_0x3b78fc=waitPromise(_0x5b10fb)[_0x1b17e4(0x1f5)];return _0x3b78fc[_0x1b17e4(0x271)]();},'finishPowerboxOffer'(_0x5011e8){const _0xcdc776=_0x2798b6;check(_0x5011e8,String),Sessions[_0xcdc776(0x22b)]({'_id':_0x5011e8},{'$unset':{'powerboxView':null}});},'getViewInfoForApiToken'(_0x1bc1ac){const _0x4cd5fb=_0x2798b6,_0xe9b430={'mbXkP':function(_0x58ef73,_0x52b00e,_0x4f1f00){return _0x58ef73(_0x52b00e,_0x4f1f00);},'czMHV':_0x4cd5fb(0x21e)};_0xe9b430[_0x4cd5fb(0x256)](check,_0x1bc1ac,String);const _0x278a5e=globalDb[_0x4cd5fb(0x272)][_0x4cd5fb(0x207)]['findOne'](_0x1bc1ac);if(!_0x278a5e)throw new Meteor['Error'](0x190,_0xe9b430[_0x4cd5fb(0x28c)]);const _0x5534a3=globalDb[_0x4cd5fb(0x272)][_0x4cd5fb(0x274)][_0x4cd5fb(0x1f9)](_0x278a5e['grainId']);if(!_0x5534a3)throw new Meteor[(_0x4cd5fb(0x243))](0x1f4,'No\x20grain\x20found\x20for\x20token.');return _0x5534a3[_0x4cd5fb(0x22c)];}}),HackSessionContextImpl=class HackSessionContextImpl extends SessionContextImpl{constructor(_0x385506,_0xfa2c75,_0x2aa004,_0x492366){super(_0x385506,_0xfa2c75,_0x2aa004,_0x492366);}[_0x2798b6(0x28a)](){const _0x337e40=_0x2798b6,_0x2dcaa8={'oYZbV':function(_0x3dec54,_0x14201c){return _0x3dec54(_0x14201c);},'wnbaM':function(_0x1f3b03,_0x1c288f){return _0x1f3b03!==_0x1c288f;},'maPlu':function(_0x3d72ff,_0x5d35c3){return _0x3d72ff>_0x5d35c3;},'eswjr':function(_0x3e50b6,_0x2819e7){return _0x3e50b6===_0x2819e7;}};while(!this['publicId']){const _0x1e0f82=Grains['findOne'](this[_0x337e40(0x259)],{'fields':{'publicId':0x1}});if(!_0x1e0f82)throw new Error(_0x337e40(0x229));if(_0x1e0f82[_0x337e40(0x263)])this['publicId']=_0x1e0f82['publicId'];else{const _0x567a76=_0x2dcaa8['oYZbV'](generateRandomHostname,0x14);if(Grains[_0x337e40(0x1f9)]({'publicId':_0x567a76})){if(_0x2dcaa8[_0x337e40(0x261)](_0x337e40(0x22a),_0x337e40(0x20e))){console['error']('CRITICAL\x20PROBLEM:\x20Public\x20ID\x20collision.\x20'+_0x337e40(0x1cd));continue;}else throw new _0x1b35e7('Webkey\x20urls\x20cannot\x20contain\x20a\x20path.');}if(_0x2dcaa8['maPlu'](Grains['update']({'_id':this[_0x337e40(0x259)],'publicId':{'$exists':![]}},{'$set':{'publicId':_0x567a76}}),0x0)){if(_0x2dcaa8['eswjr'](_0x337e40(0x294),_0x337e40(0x294)))this[_0x337e40(0x263)]=_0x567a76;else return _0x406908(this,_0x216373);}}}return this[_0x337e40(0x263)];}[_0x2798b6(0x23a)](){const _0x54cd72=_0x2798b6,_0x227c2f={'DdmJv':function(_0x22eb0f,_0x3e4831){return _0x22eb0f+_0x3e4831;}};return _0x227c2f[_0x54cd72(0x244)](this[_0x54cd72(0x28a)]()+'@',HOSTNAME);}[_0x2798b6(0x1f2)](){const _0x5178ab=_0x2798b6,_0x15430d=Grains[_0x5178ab(0x1f9)](this[_0x5178ab(0x259)],{'fields':{'identityId':0x1}}),_0x12f796=globalDb['getIdentity'](_0x15430d[_0x5178ab(0x1ba)]),_0x56a600=_['findWhere'](SandstormDb['getVerifiedEmails'](_0x12f796),{'primary':!![]}),_0x4b5c78=_0x56a600&&_0x56a600[_0x5178ab(0x1c9)]||_0x12f796[_0x5178ab(0x1c2)],_0x535929={};return _0x4b5c78&&(_0x535929[_0x5178ab(0x295)]=_0x4b5c78),_0x12f796[_0x5178ab(0x208)][_0x5178ab(0x24c)]&&(_0x535929[_0x5178ab(0x24c)]=_0x12f796[_0x5178ab(0x208)][_0x5178ab(0x24c)]),_0x535929;}['send'](_0x274bfb){const _0x2858d2=_0x2798b6,_0x68b59={'pbZmX':function(_0x545f07,_0x2737ff,_0x460c24){return _0x545f07(_0x2737ff,_0x460c24);}};return _0x68b59[_0x2858d2(0x227)](hackSendEmail,this,_0x274bfb);}[_0x2798b6(0x1db)](){const _0x23c7d1=_0x2798b6,_0x26fec6={'PFsGx':function(_0x197c86,_0x4e9928){return _0x197c86+_0x4e9928;},'GKcck':function(_0x4613d,_0x4aec5f){return _0x4613d+_0x4aec5f;},'ZzIQE':function(_0x10bb96,_0x2c2a2c){return _0x10bb96(_0x2c2a2c);}};return _0x26fec6['ZzIQE'](inMeteor,function(){const _0x49e3e2=_0x45d2,_0x1da68a={};_0x1da68a[_0x49e3e2(0x263)]=this[_0x49e3e2(0x28a)](),_0x1da68a[_0x49e3e2(0x296)]=HOSTNAME,_0x1da68a[_0x49e3e2(0x218)]=_0x26fec6[_0x49e3e2(0x297)](_0x26fec6['GKcck'](ROOT_URL[_0x49e3e2(0x245)],'//'),makeWildcardHost(_0x1da68a['publicId']));const _0x251f1f=Grains['findOne'](this[_0x49e3e2(0x259)],{'fields':{'userId':0x1}});return _0x1da68a['isDemoUser']=Meteor[_0x49e3e2(0x1dc)]['findOne'](_0x251f1f[_0x49e3e2(0x26a)])[_0x49e3e2(0x291)]?!![]:![],_0x1da68a;}[_0x23c7d1(0x24b)](this));}[_0x2798b6(0x201)](_0x980f4e){const _0x5584ab=_0x2798b6,_0x56512e={'SjgEY':function(_0xf644e2,_0x7879b,_0x17cdc2){return _0xf644e2(_0x7879b,_0x17cdc2);},'DgFJZ':function(_0x17c394,_0x23bf35){return _0x17c394+_0x23bf35;},'swSvp':function(_0x56a8b3,_0x517ba7){return _0x56a8b3(_0x517ba7);},'qtipW':'overloaded','aeDsQ':function(_0x2eaad8,_0x2b4d3e){return _0x2eaad8===_0x2b4d3e;},'nRqSv':function(_0x34ffd8,_0x5e57c7){return _0x34ffd8!==_0x5e57c7;},'PjKRp':_0x5584ab(0x1f3)},_0x1c5cf6=this,_0x5729ec=_0x1c5cf6;return _0x56512e[_0x5584ab(0x22e)](inMeteor,()=>{const _0x192a06=_0x5584ab;return _0x56512e[_0x192a06(0x239)](ssrfSafeLookup,globalDb,_0x980f4e);})[_0x5584ab(0x1e1)](_0x1d8d02=>{const _0x4d2255=_0x5584ab,_0x4b34d0={'pSGjJ':function(_0x2b5cb1,_0x2dccdd){return _0x2b5cb1/_0x2dccdd;},'tABMd':_0x4d2255(0x1eb),'nzmSJ':function(_0x3e88ee,_0x3f1a25){const _0x59ed9b=_0x4d2255;return _0x56512e[_0x59ed9b(0x1b7)](_0x3e88ee,_0x3f1a25);},'hUiMr':_0x4d2255(0x1c3),'lyviN':function(_0xc2116d,_0x333f06){const _0x3940a5=_0x4d2255;return _0x56512e[_0x3940a5(0x22e)](_0xc2116d,_0x333f06);},'qWUPV':'Status\x20code\x20','VCqpC':_0x4d2255(0x1f7),'VzYUD':function(_0x232a93,_0x340064){return _0x232a93+_0x340064;},'EDmQG':_0x4d2255(0x200),'GqejD':_0x56512e[_0x4d2255(0x288)],'RnGlN':function(_0xb5769,_0x5a7e4e){const _0x5a8847=_0x4d2255;return _0x56512e[_0x5a8847(0x277)](_0xb5769,_0x5a7e4e);},'qVVbl':_0x4d2255(0x22f),'wRFvV':function(_0x2a89c9,_0x53fbe6){return _0x56512e['nRqSv'](_0x2a89c9,_0x53fbe6);},'MyfQT':'http://','fJaDj':_0x4d2255(0x1e2),'iliAa':function(_0x32c207,_0x1ce1fb){const _0x442183=_0x4d2255;return _0x56512e[_0x442183(0x22e)](_0x32c207,_0x1ce1fb);},'njTfK':_0x56512e[_0x4d2255(0x28d)]};return new Promise((_0x4a16e5,_0x500a17)=>{const _0x5abdc3=_0x4d2255,_0x281af8={'PYmlc':function(_0x7fa81a,_0x2bc8c8){return _0x7fa81a(_0x2bc8c8);},'Xfler':_0x5abdc3(0x234),'RSmjP':function(_0xa9416a,_0x5d3d94){const _0xb23fd0=_0x5abdc3;return _0x4b34d0[_0xb23fd0(0x1d5)](_0xa9416a,_0x5d3d94);},'XdDkD':function(_0x402582,_0x150ffc,_0x4206c9){return _0x402582(_0x150ffc,_0x4206c9);},'BdfRu':'DCDis','Wcvlq':_0x4b34d0[_0x5abdc3(0x21a)],'CUIGJ':_0x5abdc3(0x27e),'lNggg':function(_0x6708ea,_0xbaa633){const _0x1cf412=_0x5abdc3;return _0x4b34d0[_0x1cf412(0x1d5)](_0x6708ea,_0xbaa633);},'PSZVU':_0x4b34d0['GqejD'],'yDIjd':'Request\x20timed\x20out.'};let _0x315202=Http['request'];if(_0x4b34d0['RnGlN'](_0x1d8d02['url'][_0x5abdc3(0x27b)](_0x4b34d0['qVVbl']),0x0))_0x315202=Https[_0x5abdc3(0x26e)];else _0x4b34d0['wRFvV'](_0x1d8d02['url'][_0x5abdc3(0x27b)](_0x4b34d0[_0x5abdc3(0x211)]),0x0)&&(err=new Error(_0x4b34d0['fJaDj']),err['nature']=_0x5abdc3(0x270),_0x4b34d0[_0x5abdc3(0x28f)](_0x500a17,err));const _0xbc9dd0=Url[_0x5abdc3(0x21c)](_0x1d8d02['url']);_0xbc9dd0[_0x5abdc3(0x1f6)]={'host':_0x1d8d02[_0x5abdc3(0x1d6)]},_0xbc9dd0[_0x5abdc3(0x247)]=_0x1d8d02['host'][_0x5abdc3(0x298)](':')[0x0],req=_0x315202(_0xbc9dd0,_0x3228a2=>{const _0x1ded7d=_0x5abdc3,_0x51020f=[];let _0x49047b;switch(Math[_0x1ded7d(0x27c)](_0x4b34d0['pSGjJ'](_0x3228a2['statusCode'],0x64))){case 0x2:_0x3228a2['on'](_0x1ded7d(0x1da),_0x2ca9f8=>{const _0x579127=_0x1ded7d;_0x51020f[_0x579127(0x29c)](_0x2ca9f8);}),_0x3228a2['on'](_0x4b34d0['tABMd'],()=>{const _0x30adeb=_0x1ded7d;_0x281af8[_0x30adeb(0x276)](_0x4a16e5,{'content':Buffer[_0x30adeb(0x21f)](_0x51020f),'mimeType':_0x3228a2[_0x30adeb(0x1f6)][_0x30adeb(0x249)]||null});});break;case 0x3:_0x4a16e5(_0x5729ec[_0x1ded7d(0x201)](_0x3228a2[_0x1ded7d(0x1f6)][_0x1ded7d(0x280)]));break;case 0x4:_0x49047b=new Error(_0x4b34d0['nzmSJ']('Status\x20code\x20'+_0x3228a2[_0x1ded7d(0x1ed)],_0x4b34d0[_0x1ded7d(0x230)])),_0x49047b[_0x1ded7d(0x1d0)]=_0x1ded7d(0x270),_0x4b34d0[_0x1ded7d(0x1d5)](_0x500a17,_0x49047b);break;case 0x5:_0x49047b=new Error(_0x4b34d0[_0x1ded7d(0x1b8)]+_0x3228a2[_0x1ded7d(0x1ed)]+'\x20received\x20in\x20response.'),_0x49047b[_0x1ded7d(0x1d0)]=_0x4b34d0[_0x1ded7d(0x292)],_0x500a17(_0x49047b);break;default:_0x49047b=new Error(_0x4b34d0['VzYUD']('Invalid\x20status\x20code\x20'+_0x3228a2['statusCode'],_0x1ded7d(0x1c3))),_0x49047b['nature']=_0x4b34d0['VCqpC'],_0x500a17(_0x49047b);break;}}),req['on'](_0x4b34d0['njTfK'],_0x44846e=>{const _0x29db27=_0x5abdc3;_0x44846e[_0x29db27(0x1d0)]=_0x281af8[_0x29db27(0x209)],_0x281af8[_0x29db27(0x1fe)](_0x500a17,_0x44846e);}),req[_0x5abdc3(0x1bf)](0x3a98,()=>{const _0x354751=_0x5abdc3;if(_0x281af8[_0x354751(0x240)]===_0x281af8[_0x354751(0x22d)]){_0x281af8[_0x354751(0x1cc)](_0x198540,_0x685e0e,_0x2a1b7d);const _0x4339e5=_0x27a629[_0x354751(0x272)]['apiTokens'][_0x354751(0x1f9)](_0x36e361);if(!_0x4339e5)throw new _0x33919e[(_0x354751(0x243))](0x190,_0x354751(0x21e));const _0x1c9d56=_0x126ccb['collections']['grains']['findOne'](_0x4339e5[_0x354751(0x259)]);if(!_0x1c9d56)throw new _0x20317e[(_0x354751(0x243))](0x1f4,'No\x20grain\x20found\x20for\x20token.');return _0x1c9d56[_0x354751(0x22c)];}else{const _0x2aef6a=_0x281af8['CUIGJ']['split']('|');let _0x30241f=0x0;while(!![]){switch(_0x2aef6a[_0x30241f++]){case'0':_0x281af8[_0x354751(0x1c0)](_0x500a17,err);continue;case'1':err[_0x354751(0x1d0)]=_0x354751(0x1f7);continue;case'2':req[_0x354751(0x221)]();continue;case'3':err[_0x354751(0x202)]=_0x281af8['PSZVU'];continue;case'4':err=new Error(_0x281af8[_0x354751(0x1f1)]);continue;}break;}}}),req[_0x5abdc3(0x1eb)]();});});}[_0x2798b6(0x290)](){const _0x2a9b64=_0x2798b6;return inMeteor(function(){const _0x185509=_0x45d2;return this[_0x185509(0x1f2)]();}[_0x2a9b64(0x24b)](this));}[_0x2798b6(0x212)](_0x75108d,_0x219b5f,_0xeef05b){throw new Error('generateApiToken()\x20has\x20been\x20removed.\x20Use\x20offer\x20templates\x20instead.');}[_0x2798b6(0x253)](){const _0x4e6337=_0x2798b6,_0x45e756={'cIMgQ':_0x4e6337(0x275)};throw new Error(_0x45e756[_0x4e6337(0x29b)]);}[_0x2798b6(0x1bd)](_0x5de7c2){const _0x5a6643=_0x2798b6,_0x5e73fd={'RwCmi':_0x5a6643(0x1d8)};throw new Error(_0x5e73fd['RwCmi']);}[_0x2798b6(0x20a)](_0x5b719e){const _0xd5303b=_0x2798b6,_0x89ab5e={'NgbXb':function(_0x3d80d0,_0x3a9e53){return _0x3d80d0!==_0x3a9e53;},'PbzUZ':function(_0x54bdf6,_0x4ad0aa){return _0x54bdf6!==_0x4ad0aa;},'kYPNP':_0xd5303b(0x1f8),'bRccG':function(_0x75e4ad,_0x1e364f){return _0x75e4ad(_0x1e364f);}},_0x2705ec=Url['parse'](_0x5b719e);if(_0x2705ec[_0xd5303b(0x1d9)]){if(_0x2705ec[_0xd5303b(0x1bc)]&&_0x89ab5e[_0xd5303b(0x21b)](_0x2705ec['pathname'],'/')){if(_0x89ab5e[_0xd5303b(0x1fc)](_0xd5303b(0x25d),'GoZbx'))_0x2bc74c={'offer':{'uiView':{'token':_0x3e6257[_0xd5303b(0x271)]()}}};else throw new Error(_0x89ab5e[_0xd5303b(0x205)]);}const _0x242753=_0x2705ec[_0xd5303b(0x1d9)][_0xd5303b(0x286)](0x1),_0x4f4b5c=_0x89ab5e[_0xd5303b(0x224)](matchWildcardHost,_0x2705ec['host']);return{'view':new ExternalUiView(_0x5b719e,_0x242753)};}else return{'view':new ExternalUiView(_0x5b719e)};}},makeHackSessionContext=(_0x4a5991,_0x223610,_0x31c94d,_0x54358a)=>{const _0x35b854=_0x2798b6;return new Capnp[(_0x35b854(0x1ca))](new HackSessionContextImpl(_0x4a5991,_0x223610,_0x31c94d,_0x54358a),HackSessionContext);};const HOSTNAME_CHARS=_0x2798b6(0x231);generateRandomHostname=_0x66e1f4=>{const _0x224c8e=_0x2798b6,_0xcf2dbd={'MecxF':function(_0xde2a52,_0x4a4458){return _0xde2a52<_0x4a4458;}},_0x517653=[];for(let _0x544d0f=0x0;_0xcf2dbd[_0x224c8e(0x242)](_0x544d0f,_0x66e1f4);_0x544d0f++){_0x517653[_0x544d0f]=Random['choice'](HOSTNAME_CHARS);}return _0x517653[_0x224c8e(0x1fd)]('');};