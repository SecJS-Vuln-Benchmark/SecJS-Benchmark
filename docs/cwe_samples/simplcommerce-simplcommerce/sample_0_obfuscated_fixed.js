const _0x42561e=_0x3e8c;function _0x384c(){const _0x1e25fd=['sqlsanitize','connectObj','path','public','HLfGm','is_it_multi_tenant','595362ocXvEA','WPmwJ','post','lnGfV','ROLLBACK','find','query','parse','zrWFz','getClient','exit','@saltcorn/data/models/table','1425524edDkml','valueOf','ckFNl','@saltcorn/data/db','SHikq','TUBKY','writeFile','changes.json','lpYRE','indexOf','bfkdz','zdcfo','InIZx','last_modified','OIIgG','error','\x27\x20does\x20not\x20exist.','\x22\x20\x22data_tbl\x22\x0a\x20\x20\x20\x20\x20\x20on\x20info_tbl.ref\x20=\x20data_tbl.\x22','egijY','hDnkG','9657xNZXuz','rows','POST\x20/load_changes:\x20\x27','ownership_field_id','UuyDc','max','body','syncFrom','\x22\x0a\x20\x20\x20\x20\x20\x20where\x20date_trunc(\x27milliseconds\x27,\x20info_tbl.last_modified)\x20>\x20to_timestamp(','yUABK','HCvdV','/sync_timestamp','uxfvU','splice','mobile_app','child_process','sync-upload-data','_sync_info_tbl_ref_','maxLoadedId','log','eSzbm','mkdir','getTenantSchemaPrefix','getTenantSchema','readFile','2448744mxMTst','lvGra','1311225BuoSbB',')\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20and\x20alias.max\x20>\x20to_timestamp(','length','COMMIT','rootFolder','time','4TXgQiy','_sync_info\x22\x20\x22info_tbl\x22\x20right\x20join\x20\x22','express-promise-router','BEGIN','name','role_id','\x0a\x20\x20\x20\x20\x20\x20','LPJnK','RqJqG','ymkdT','GYaDz','json','and\x20data_tbl.\x22','GET\x20/sync/upload_finished:\x20\x27','162629WhugXx','GET\x20/load_changes:\x20The\x20ownership\x20field\x20of\x20\x27','/clean_sync_dir','getFields','POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20finished\x20with\x20code:\x20','ztfSG','/offline_changes','./utils.js','WYwki','10610ZQQSBa','readdir','syncInfos\x20is\x20missing','gDFTi','min_role_read','HgPmZ','\x27\x20does\x20not\x20exists','pk_name','\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20info_tbl.ref','@saltcorn/data/utils','loadUntil\x20is\x20missing','\x22\x20and\x20info_tbl.deleted\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20where\x20data_tbl.\x22','status','message','select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.ref\x20\x22_sync_info_tbl_ref_\x22,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.last_modified\x20\x22_sync_info_tbl_last_modified_\x22,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.deleted\x20\x22_sync_info_tbl_deleted_\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20data_tbl.*\x0a\x20\x20\x20\x20\x20\x20\x20from\x20','kSykF','user','release','eKzKP','translated-ids.json','pmnRO','eHUir','email','yveQT','ownership_formula','htgEU','join','RvXhr','POST\x20/load_changes:\x20loadUntil\x20is\x20missing','filter','\x22\x20=\x20','7FpwrLW','2032242sXUaPH','push','CJpjX','eFJCI','rGVXg','get','POST\x20/sync/clean_sync_dir:\x20\x27','@saltcorn/data/models/file','WtmEn','--syncTimestamp','is_owner','code','MvyBt','--directory','_sync_info_tbl_last_modified_','findOne','ynkkb','EatJY','bYGJq','--userEmail','\x22\x20>\x20','eZTYH','_sync_info\x22\x20\x0a\x20\x20\x20\x20\x20\x20group\x20by\x20ref,\x20deleted\x20having\x20deleted\x20=\x20true)\x20as\x20alias\x20\x0a\x20\x20\x20\x20\x20\x20where\x20alias.max\x20<\x20to_timestamp(','@saltcorn/data/db/state','sync','uXNIQ','location','The\x20table\x20\x27',')\x20\x0a\x20\x20\x20\x20\x20\x20and\x20info_tbl.deleted\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20and\x20info_tbl.ref\x20>\x20'];_0x384c=function(){return _0x1e25fd;};return _0x384c();}(function(_0x5dfa14,_0x2a5a6f){const _0x2e3574=_0x3e8c,_0x58451e=_0x5dfa14();while(!![]){try{const _0x65dc5f=parseInt(_0x2e3574(0x12e))/0x1*(parseInt(_0x2e3574(0x120))/0x2)+-parseInt(_0x2e3574(0xdf))/0x3+parseInt(_0x2e3574(0xeb))/0x4+parseInt(_0x2e3574(0x11a))/0x5+parseInt(_0x2e3574(0xbc))/0x6*(parseInt(_0x2e3574(0xbb))/0x7)+parseInt(_0x2e3574(0x118))/0x8+-parseInt(_0x2e3574(0xff))/0x9*(parseInt(_0x2e3574(0x137))/0xa);if(_0x65dc5f===_0x2a5a6f)break;else _0x58451e['push'](_0x58451e['shift']());}catch(_0x457950){_0x58451e['push'](_0x58451e['shift']());}}}(_0x384c,0x3d781));const {error_catcher}=require(_0x42561e(0x135)),Router=require(_0x42561e(0x122)),db=require(_0x42561e(0xee)),{getState}=require(_0x42561e(0xd3)),Table=require(_0x42561e(0xea)),File=require(_0x42561e(0xc3)),{getSafeSaltcornCmd}=require(_0x42561e(0xa5)),{spawn,spawnSync}=require(_0x42561e(0x10e)),path=require(_0x42561e(0xdb)),fs=require('fs')['promises'],router=new Router();module['exports']=router,router[_0x42561e(0xc1)](_0x42561e(0x10a),error_catcher(async(_0x1f18ca,_0x140345)=>{const _0xed1490=_0x42561e,_0x29061f={'EatJY':function(_0x5d1054,_0x280803){return _0x5d1054===_0x280803;},'eZTYH':_0xed1490(0xf5),'YHXGU':function(_0x3a91dc){return _0x3a91dc();}};try{if(_0x29061f[_0xed1490(0xcd)]('iQWam',_0x29061f[_0xed1490(0xd1)]))return _0x4cba68['json']({'finished':![]});else _0x140345[_0xed1490(0x12b)]({'syncTimestamp':(await db[_0xed1490(0x11f)]())[_0xed1490(0xec)]()});}catch(_0x197930){_0x29061f['YHXGU'](getState)['log'](0x2,'GET\x20/sync_timestamp:\x20\x27'+_0x197930['message']+'\x27'),_0x140345[_0xed1490(0xa8)](0x190)[_0xed1490(0x12b)]({'error':_0x197930[_0xed1490(0xa9)]||_0x197930});}}));const getSyncRows=async(_0x4914eb,_0x10707a,_0x1fc530,_0x36b4a9,_0x3a54cf)=>{const _0x47a9f0=_0x42561e,_0x23f763={'HgPmZ':function(_0x3b4f55){return _0x3b4f55();},'LPJnK':_0x47a9f0(0x12a),'zdcfo':function(_0x1e176f,_0x318bc3){return _0x1e176f/_0x318bc3;},'yUABK':function(_0xb75eb0,_0x83e400){return _0xb75eb0===_0x83e400;},'OIIgG':_0x47a9f0(0x9f)},_0x330aa2=_0x10707a[_0x47a9f0(0x124)],_0x5106bb=_0x10707a[_0x47a9f0(0xa3)],_0x167007=_0x10707a[_0x47a9f0(0xa0)],_0x5c8cad=_0x3a54cf?.[_0x47a9f0(0x125)]||0x64;let _0x3780c6=null;if(_0x5c8cad>_0x167007&&(!_0x10707a[_0x47a9f0(0x102)]&&!_0x10707a[_0x47a9f0(0xb4)]||_0x5c8cad===0x64))return null;if(_0x3a54cf?.['id']&&_0x5c8cad<0x64&&_0x5c8cad>_0x167007&&_0x10707a[_0x47a9f0(0x102)]){const _0x1d81bf=_0x10707a[_0x47a9f0(0x131)]()[_0x47a9f0(0xe4)](_0x487117=>_0x487117['id']===_0x10707a[_0x47a9f0(0x102)]);if(!_0x1d81bf)return getState()[_0x47a9f0(0x112)](0x5,_0x47a9f0(0x12f)+_0x10707a['name']+_0x47a9f0(0xfb)),null;_0x3780c6=_0x1d81bf[_0x47a9f0(0x124)];}const _0x13f1a0=db[_0x47a9f0(0x115)]();if(!_0x4914eb[_0x47a9f0(0x106)]){if(_0x47a9f0(0x12a)===_0x23f763[_0x47a9f0(0x127)]){const {rows:_0x33c92f}=await _0x36b4a9[_0x47a9f0(0xe5)](_0x47a9f0(0xaa)+_0x13f1a0+'\x22'+db[_0x47a9f0(0xd9)](_0x330aa2)+_0x47a9f0(0x121)+db[_0x47a9f0(0xd9)](_0x330aa2)+_0x47a9f0(0xfc)+db[_0x47a9f0(0xd9)](_0x5106bb)+_0x47a9f0(0xa7)+db[_0x47a9f0(0xd9)](_0x5106bb)+_0x47a9f0(0xd0)+_0x4914eb[_0x47a9f0(0x111)]+_0x47a9f0(0x126)+(_0x3780c6?_0x47a9f0(0x12c)+_0x3780c6+_0x47a9f0(0xba)+_0x3a54cf['id']:'')+'\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20data_tbl.\x22'+db[_0x47a9f0(0xd9)](_0x5106bb)+'\x22');for(const _0x1b40f0 of _0x33c92f){if(_0x1b40f0[_0x47a9f0(0xca)])_0x1b40f0[_0x47a9f0(0xca)]=_0x1b40f0[_0x47a9f0(0xca)][_0x47a9f0(0xec)]();else _0x1b40f0['_sync_info_tbl_last_modified_']=new Date(_0x1fc530)['valueOf']();_0x1b40f0[_0x47a9f0(0x110)]=_0x1b40f0[_0x5106bb];}return _0x33c92f;}else _0x23f763[_0x47a9f0(0xa1)](_0xf77e5a)['log'](0x2,'POST\x20/sync/offline_changes:\x20\x27'+_0x5d5a61[_0x47a9f0(0xa9)]+'\x27'),_0xcfc181['status'](0x190)[_0x47a9f0(0x12b)]({'error':_0x5cc966[_0x47a9f0(0xa9)]||_0x265857});}else{const {rows:_0x73bba}=await _0x36b4a9[_0x47a9f0(0xe5)](_0x47a9f0(0xaa)+_0x13f1a0+'\x22'+db['sqlsanitize'](_0x330aa2)+'_sync_info\x22\x20\x22info_tbl\x22\x20join\x20'+_0x13f1a0+'\x22'+db[_0x47a9f0(0xd9)](_0x330aa2)+'\x22\x20\x22data_tbl\x22\x0a\x20\x20\x20\x20\x20\x20on\x20info_tbl.ref\x20=\x20data_tbl.\x22'+db[_0x47a9f0(0xd9)](_0x5106bb)+_0x47a9f0(0x107)+new Date(_0x4914eb[_0x47a9f0(0x106)])[_0x47a9f0(0xec)]()/0x3e8+')\x20\x0a\x20\x20\x20\x20\x20\x20and\x20date_trunc(\x27milliseconds\x27,\x20info_tbl.last_modified)\x20<\x20to_timestamp('+_0x23f763[_0x47a9f0(0xf6)](new Date(_0x1fc530)[_0x47a9f0(0xec)](),0x3e8)+_0x47a9f0(0xd8)+_0x4914eb['maxLoadedId']+_0x47a9f0(0x126)+(_0x3780c6?_0x47a9f0(0x12c)+_0x3780c6+_0x47a9f0(0xba)+_0x3a54cf['id']:'')+_0x47a9f0(0xa4));for(const _0x595763 of _0x73bba){if(_0x23f763[_0x47a9f0(0x108)](_0x23f763[_0x47a9f0(0xf9)],'Mqurg'))_0x1f46f4[_0x47a9f0(0xad)](!![]);else{if(_0x595763[_0x47a9f0(0xca)])_0x595763['_sync_info_tbl_last_modified_']=_0x595763[_0x47a9f0(0xca)][_0x47a9f0(0xec)]();else _0x595763['_sync_info_tbl_last_modified_']=_0x1fc530['valueOf']();}}return _0x73bba;}};router[_0x42561e(0xe1)]('/load_changes',error_catcher(async(_0x15d430,_0x96e5b8)=>{const _0x1d6c69=_0x42561e,_0x572b35={'HCvdV':_0x1d6c69(0xa6),'bYGJq':function(_0x350ce8,_0x23c678){return _0x350ce8===_0x23c678;},'MvyBt':_0x1d6c69(0xb5),'CJpjX':function(_0x4f8f28,_0x5e4122,_0x2d30ee,_0x5939ed,_0x52acf8,_0x4b07b3){return _0x4f8f28(_0x5e4122,_0x2d30ee,_0x5939ed,_0x52acf8,_0x4b07b3);},'bIOTO':function(_0x501788,_0x438d12){return _0x501788>_0x438d12;},'YNhJd':function(_0x35567d,_0x3daeb4){return _0x35567d-_0x3daeb4;},'jhxwZ':_0x1d6c69(0x11d)},_0x172156={},{syncInfos:_0x1b7021,loadUntil:_0x2a34fc}=_0x15d430['body'];if(!_0x2a34fc)return getState()['log'](0x2,_0x1d6c69(0xb8)),_0x96e5b8[_0x1d6c69(0xa8)](0x190)[_0x1d6c69(0x12b)]({'error':_0x572b35[_0x1d6c69(0x109)]});if(!_0x1b7021)return getState()[_0x1d6c69(0x112)](0x2,'POST\x20/load_changes:\x20syncInfos\x20is\x20missing'),_0x96e5b8[_0x1d6c69(0xa8)](0x190)[_0x1d6c69(0x12b)]({'error':_0x1d6c69(0x139)});const _0x127715=_0x15d430[_0x1d6c69(0xac)]?_0x15d430[_0x1d6c69(0xac)]['role_id']:0x64,_0x776e03=await db[_0x1d6c69(0xe8)]();let _0x3d5174=0x3e8;try{if(_0x572b35[_0x1d6c69(0xce)]('htgEU',_0x572b35[_0x1d6c69(0xc8)])){await _0x776e03[_0x1d6c69(0xe5)](_0x1d6c69(0x123));for(const [_0x49ac91,_0x537773]of Object['entries'](_0x1b7021)){const _0x231afb=Table[_0x1d6c69(0xcb)]({'name':_0x49ac91});if(!_0x231afb)throw new Error(_0x1d6c69(0xd7)+_0x49ac91+_0x1d6c69(0xa2));const _0x19b89f=_0x231afb[_0x1d6c69(0xa3)];let _0x21d54b=await _0x572b35[_0x1d6c69(0xbe)](getSyncRows,_0x537773,_0x231afb,_0x2a34fc,_0x776e03,_0x15d430[_0x1d6c69(0xac)]);if(!_0x21d54b)continue;if(_0x127715>_0x231afb[_0x1d6c69(0xa0)]){if(_0x127715===0x64||!_0x231afb['ownership_field_id']&&!_0x231afb['ownership_formula'])continue;else{if(_0x231afb['ownership_field_id']){}else _0x231afb[_0x1d6c69(0xb4)]&&(_0x21d54b=_0x21d54b[_0x1d6c69(0xb9)](_0x7dfe2c=>_0x231afb[_0x1d6c69(0xc6)](_0x15d430[_0x1d6c69(0xac)],_0x7dfe2c)));}}_0x21d54b[_0x1d6c69(0x11c)]>_0x3d5174&&_0x21d54b[_0x1d6c69(0x10c)](_0x3d5174),_0x3d5174-=_0x21d54b[_0x1d6c69(0x11c)],_0x172156[_0x49ac91]={'rows':_0x21d54b,'maxLoadedId':_0x572b35['bIOTO'](_0x21d54b[_0x1d6c69(0x11c)],0x0)?_0x21d54b[_0x572b35['YNhJd'](_0x21d54b[_0x1d6c69(0x11c)],0x1)][_0x19b89f]:0x0};}await _0x776e03['query'](_0x572b35['jhxwZ']),_0x96e5b8[_0x1d6c69(0x12b)](_0x172156);}else _0x4cbda0['release'](!![]);}catch(_0x8a9b04){await _0x776e03[_0x1d6c69(0xe5)]('ROLLBACK'),getState()[_0x1d6c69(0x112)](0x2,_0x1d6c69(0x101)+_0x8a9b04[_0x1d6c69(0xa9)]+'\x27'),_0x96e5b8['status'](0x190)[_0x1d6c69(0x12b)]({'error':_0x8a9b04[_0x1d6c69(0xa9)]||_0x8a9b04});}finally{_0x776e03[_0x1d6c69(0xad)](!![]);}}));function _0x3e8c(_0x3a6a69,_0x2d8a21){const _0x384c7c=_0x384c();return _0x3e8c=function(_0x3e8cc7,_0x200e69){_0x3e8cc7=_0x3e8cc7-0x9f;let _0x119317=_0x384c7c[_0x3e8cc7];return _0x119317;},_0x3e8c(_0x3a6a69,_0x2d8a21);}const getDelRows=async(_0x1110f2,_0xa1aec,_0x2bf5fd,_0x522af1)=>{const _0x558444=_0x42561e,_0x52c965={'hDnkG':function(_0x1a9861,_0x4d242b){return _0x1a9861/_0x4d242b;}},_0x19679c=db['getTenantSchemaPrefix'](),_0x1624bf=await _0x522af1['query']('select\x20*\x20\x0a\x20\x20\x20\x20\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20select\x20ref,\x20max(last_modified)\x20from\x20'+_0x19679c+'\x22'+db[_0x558444(0xd9)](_0x1110f2)+_0x558444(0xd2)+_0x2bf5fd[_0x558444(0xec)]()/0x3e8+_0x558444(0x11b)+_0x52c965[_0x558444(0xfe)](_0xa1aec['valueOf'](),0x3e8)+')');for(const _0x2477c9 of _0x1624bf[_0x558444(0x100)]){if(_0x2477c9['last_modified'])_0x2477c9[_0x558444(0xf8)]=_0x2477c9[_0x558444(0xf8)][_0x558444(0xec)]();if(_0x2477c9['max'])_0x2477c9[_0x558444(0x104)]=_0x2477c9[_0x558444(0x104)][_0x558444(0xec)]();}return _0x1624bf[_0x558444(0x100)];};router['post']('/deletes',error_catcher(async(_0x392ccb,_0x974b70)=>{const _0x2c3b45=_0x42561e,_0x2b6565={'RqJqG':function(_0x21dd6a){return _0x21dd6a();},'HLfGm':_0x2c3b45(0xf0),'eHUir':function(_0x583b1f,_0x224bed){return _0x583b1f!==_0x224bed;},'TWlKH':function(_0x4ce410){return _0x4ce410();}},{syncInfos:_0x7e51d4,syncTimestamp:_0x2ab40}=_0x392ccb[_0x2c3b45(0x105)],_0x233a44=await db['getClient']();try{if(_0x2c3b45(0xf0)===_0x2b6565[_0x2c3b45(0xdd)]){await _0x233a44[_0x2c3b45(0xe5)](_0x2c3b45(0x123));const _0xd1dfa4=new Date(_0x2ab40),_0x1190ef={'deletes':{}};for(const [_0x24ffc7,_0x2c0ab6]of Object['entries'](_0x7e51d4)){_0x2b6565[_0x2c3b45(0xb1)](_0x2c3b45(0xe0),'WPmwJ')?(_0x2b6565[_0x2c3b45(0x128)](_0x23b200)[_0x2c3b45(0x112)](0x2,'GET\x20/sync/upload_finished:\x20\x27'+_0x203b28[_0x2c3b45(0xa9)]+'\x27'),_0x1f46f0['status'](0x190)['json']({'error':_0x33817a[_0x2c3b45(0xa9)]||_0x3d6658})):_0x2c0ab6['syncFrom']&&(_0x1190ef['deletes'][_0x24ffc7]=await getDelRows(_0x24ffc7,new Date(_0x2c0ab6[_0x2c3b45(0x106)]),_0xd1dfa4,_0x233a44));}await _0x233a44['query']('COMMIT'),_0x974b70[_0x2c3b45(0x12b)](_0x1190ef);}else _0x2b6565['RqJqG'](_0x55b32a)[_0x2c3b45(0x112)](0x2,_0x2c3b45(0xc2)+_0x177b68[_0x2c3b45(0xa9)]+'\x27'),_0x1da123[_0x2c3b45(0xa8)](0x190)[_0x2c3b45(0x12b)]({'error':_0x3548c8[_0x2c3b45(0xa9)]||_0x527631});}catch(_0x3a0d76){await _0x233a44[_0x2c3b45(0xe5)](_0x2c3b45(0xe3)),_0x2b6565['TWlKH'](getState)[_0x2c3b45(0x112)](0x2,'POST\x20/sync/deletes:\x20\x27'+_0x3a0d76['message']+'\x27'),_0x974b70[_0x2c3b45(0xa8)](0x190)[_0x2c3b45(0x12b)]({'error':_0x3a0d76[_0x2c3b45(0xa9)]||_0x3a0d76});}finally{_0x233a44[_0x2c3b45(0xad)](!![]);}})),router[_0x42561e(0xe1)](_0x42561e(0x134),error_catcher(async(_0x1cca65,_0x41a064)=>{const _0x28d35f=_0x42561e,_0x36e4e8={'lvGra':function(_0x328d6c){return _0x328d6c();},'KRFzf':function(_0x25bb6a,_0x2e2896){return _0x25bb6a!==_0x2e2896;},'uXNIQ':function(_0x20014b){return _0x20014b();},'InIZx':'mobile_app','HRVVb':_0x28d35f(0xf2),'ynkkb':_0x28d35f(0x10f),'htDRV':_0x28d35f(0xcf),'EiLAh':_0x28d35f(0xc9),'lpYRE':function(_0xbbd3a,_0x92e3,_0x48453c,_0x5de7f4){return _0xbbd3a(_0x92e3,_0x48453c,_0x5de7f4);},'egijY':'pipe','ztfSG':_0x28d35f(0xfa)},{changes:_0x144c61,syncTimestamp:_0x2caab6}=_0x1cca65['body'],_0x1e6516=await File[_0x28d35f(0x11e)]();try{const _0x4295fe=_0x2caab6+'_'+(_0x1cca65[_0x28d35f(0xac)]?.[_0x28d35f(0xb2)]||_0x28d35f(0xdc)),_0x38d22f=path[_0x28d35f(0xb6)](_0x1e6516[_0x28d35f(0xd6)],_0x36e4e8[_0x28d35f(0xf7)],'sync',_0x4295fe);await fs[_0x28d35f(0x114)](_0x38d22f,{'recursive':!![]}),await fs[_0x28d35f(0xf1)](path['join'](_0x38d22f,_0x36e4e8['HRVVb']),JSON['stringify'](_0x144c61));const _0x36fbe1=[_0x36e4e8[_0x28d35f(0xcc)]];if(_0x1cca65[_0x28d35f(0xac)]?.[_0x28d35f(0xb2)])_0x36fbe1[_0x28d35f(0xbd)](_0x36e4e8['htDRV'],_0x1cca65[_0x28d35f(0xac)][_0x28d35f(0xb2)]);_0x36fbe1[_0x28d35f(0xbd)](_0x36e4e8['EiLAh'],_0x38d22f);db[_0x28d35f(0xde)]()&&_0x36e4e8['KRFzf'](db[_0x28d35f(0x116)](),db[_0x28d35f(0xda)]['default_schema'])&&_0x36fbe1['push']('--tenantAppName',db['getTenantSchema']());_0x36fbe1[_0x28d35f(0xbd)](_0x28d35f(0xc5),_0x2caab6),_0x41a064[_0x28d35f(0x12b)]({'syncDir':_0x4295fe});const _0x5b180e=_0x36e4e8[_0x28d35f(0xf3)](spawn,getSafeSaltcornCmd(),_0x36fbe1,{'stdio':[_0x36e4e8[_0x28d35f(0xfd)],_0x36e4e8[_0x28d35f(0xfd)],_0x36e4e8['egijY']],'cwd':'.'});_0x5b180e['on'](_0x28d35f(0xe9),async(_0x255d7e,_0x2dba6e)=>{const _0x1abdd9=_0x28d35f;_0x36e4e8[_0x1abdd9(0x119)](getState)[_0x1abdd9(0x112)](0x5,_0x1abdd9(0x132)+_0x255d7e);}),_0x5b180e['on'](_0x36e4e8[_0x28d35f(0x133)],_0xe176c7=>{const _0x146f5d=_0x28d35f;if(_0x36e4e8['KRFzf'](_0x146f5d(0xef),_0x146f5d(0xef))){if(_0x5bbeb8[_0x146f5d(0xca)])_0x894b2d[_0x146f5d(0xca)]=_0x235c65[_0x146f5d(0xca)]['valueOf']();else _0x5a8a22['_sync_info_tbl_last_modified_']=new _0x39a3bb(_0xe986f)[_0x146f5d(0xec)]();_0x5eabda[_0x146f5d(0x110)]=_0x1b1a05[_0xd9f38];}else{const _0x5b725b=_0xe176c7['message']?_0xe176c7['message']:_0xe176c7[_0x146f5d(0xc7)];_0x36e4e8[_0x146f5d(0xd5)](getState)[_0x146f5d(0x112)](0x5,'POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20failed:\x20'+_0x5b725b);}});}catch(_0x4c43d4){getState()['log'](0x2,'POST\x20/sync/offline_changes:\x20\x27'+_0x4c43d4[_0x28d35f(0xa9)]+'\x27'),_0x41a064[_0x28d35f(0xa8)](0x190)[_0x28d35f(0x12b)]({'error':_0x4c43d4[_0x28d35f(0xa9)]||_0x4c43d4});}})),router['get']('/upload_finished',error_catcher(async(_0x3e50e1,_0x57e32a)=>{const _0x18df2f=_0x42561e,_0x2408c1={'WYwki':function(_0x333bff){return _0x333bff();},'zrWFz':function(_0xde8040){return _0xde8040();},'yveQT':_0x18df2f(0xa6),'UuyDc':function(_0x3babd2,_0x20f6d9){return _0x3babd2!==_0x20f6d9;},'lnGfV':'JHhux','uxfvU':_0x18df2f(0xbf),'sXiec':_0x18df2f(0x10d),'lePkK':function(_0x4d3cfd,_0x17cc5d){return _0x4d3cfd!==_0x17cc5d;},'kSykF':_0x18df2f(0x113),'MRUTT':function(_0x432a12,_0x134449){return _0x432a12>=_0x134449;},'pmnRO':_0x18df2f(0xaf),'rGVXg':'error.json','ibHyn':_0x18df2f(0xc4),'ymkdT':_0x18df2f(0xae),'RvXhr':function(_0x3c50cb){return _0x3c50cb();}},{dir_name:_0x5bfa4f}=_0x3e50e1[_0x18df2f(0xe5)];try{if(_0x2408c1[_0x18df2f(0x103)](_0x2408c1[_0x18df2f(0xe2)],_0x2408c1[_0x18df2f(0x10b)])){const _0x298ca3=await File[_0x18df2f(0x11e)](),_0x17a09e=path[_0x18df2f(0xb6)](_0x298ca3[_0x18df2f(0xd6)],_0x2408c1['sXiec'],_0x18df2f(0xd4),_0x5bfa4f);let _0x521c18=null;try{_0x521c18=await fs[_0x18df2f(0x138)](_0x17a09e);}catch(_0x25ea2d){if(_0x2408c1['lePkK'](_0x2408c1[_0x18df2f(0xab)],_0x2408c1['kSykF'])){const _0x50ee87=_0x33c727[_0x18df2f(0xa9)]?_0x490854['message']:_0x187aee[_0x18df2f(0xc7)];_0x2408c1[_0x18df2f(0x136)](_0x41460c)[_0x18df2f(0x112)](0x5,'POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20failed:\x20'+_0x50ee87);}else return _0x57e32a[_0x18df2f(0x12b)]({'finished':![]});}if(_0x2408c1['MRUTT'](_0x521c18[_0x18df2f(0xf4)](_0x18df2f(0xaf)),0x0)){const _0x2b2005=JSON[_0x18df2f(0xe6)](await fs[_0x18df2f(0x117)](path[_0x18df2f(0xb6)](_0x17a09e,_0x2408c1[_0x18df2f(0xb0)]))),_0x4527b7=JSON[_0x18df2f(0xe6)](await fs[_0x18df2f(0x117)](path[_0x18df2f(0xb6)](_0x17a09e,'unique-conflicts.json')));_0x57e32a[_0x18df2f(0x12b)]({'finished':!![],'translatedIds':_0x2b2005,'uniqueConflicts':_0x4527b7});}else{if(_0x521c18[_0x18df2f(0xf4)]('error.json')>=0x0){const _0x1aaaf4=JSON['parse'](await fs['readFile'](path['join'](_0x17a09e,_0x2408c1[_0x18df2f(0xc0)])));_0x57e32a[_0x18df2f(0x12b)]({'finished':!![],'error':_0x1aaaf4});}else _0x57e32a[_0x18df2f(0x12b)]({'finished':![]});}}else _0x4de725()['log'](0x5,_0x18df2f(0x132)+_0x1b4d18);}catch(_0x5a5ab1){if(_0x2408c1['ibHyn']!==_0x2408c1[_0x18df2f(0x129)])_0x2408c1[_0x18df2f(0xb7)](getState)['log'](0x2,_0x18df2f(0x12d)+_0x5a5ab1[_0x18df2f(0xa9)]+'\x27'),_0x57e32a['status'](0x190)[_0x18df2f(0x12b)]({'error':_0x5a5ab1['message']||_0x5a5ab1});else return _0x2408c1[_0x18df2f(0xe7)](_0x143f27)[_0x18df2f(0x112)](0x2,_0x18df2f(0xb8)),_0x406eac[_0x18df2f(0xa8)](0x190)[_0x18df2f(0x12b)]({'error':_0x2408c1[_0x18df2f(0xb3)]});}})),router[_0x42561e(0xe1)](_0x42561e(0x130),error_catcher(async(_0x10767c,_0x37066b)=>{const _0x44768b=_0x42561e,_0x2e103d={'ckFNl':_0x44768b(0xd4)},{dir_name:_0x4fa488}=_0x10767c[_0x44768b(0x105)];try{const _0xe75a97=await File[_0x44768b(0x11e)](),_0x38125e=path['join'](_0xe75a97[_0x44768b(0xd6)],_0x44768b(0x10d),_0x2e103d[_0x44768b(0xed)],_0x4fa488);await fs['rm'](_0x38125e,{'recursive':!![],'force':!![]}),_0x37066b[_0x44768b(0xa8)](0xc8)['send']('');}catch(_0x44bca7){getState()[_0x44768b(0x112)](0x2,_0x44768b(0xc2)+_0x44bca7[_0x44768b(0xa9)]+'\x27'),_0x37066b['status'](0x190)['json']({'error':_0x44bca7[_0x44768b(0xa9)]||_0x44bca7});}}));