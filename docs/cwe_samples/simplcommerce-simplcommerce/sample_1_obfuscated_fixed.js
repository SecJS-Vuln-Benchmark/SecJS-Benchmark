const _0x2a6313=_0x54e2;(function(_0x32d511,_0x7c346b){const _0x1b0633=_0x54e2,_0x540cd3=_0x32d511();while(!![]){try{const _0x2f9d62=-parseInt(_0x1b0633(0x195))/0x1+-parseInt(_0x1b0633(0x1c3))/0x2+-parseInt(_0x1b0633(0x164))/0x3*(parseInt(_0x1b0633(0x1cf))/0x4)+parseInt(_0x1b0633(0x178))/0x5*(-parseInt(_0x1b0633(0x177))/0x6)+-parseInt(_0x1b0633(0x15c))/0x7+parseInt(_0x1b0633(0x163))/0x8*(-parseInt(_0x1b0633(0x1dd))/0x9)+-parseInt(_0x1b0633(0x18b))/0xa*(-parseInt(_0x1b0633(0x1c8))/0xb);if(_0x2f9d62===_0x7c346b)break;else _0x540cd3['push'](_0x540cd3['shift']());}catch(_0x40a3d8){_0x540cd3['push'](_0x540cd3['shift']());}}}(_0x4972,0xcb25d));const Router=require(_0x2a6313(0x16e)),{isAdmin,error_catcher}=require(_0x2a6313(0x1c9)),{getState}=require(_0x2a6313(0x15e)),Trigger=require(_0x2a6313(0x1dc)),router=new Router();function _0x54e2(_0x53cadd,_0x53e5d4){const _0x49728b=_0x4972();return _0x54e2=function(_0x54e28b,_0x5d3c00){_0x54e28b=_0x54e28b-0x147;let _0x32f6fb=_0x49728b[_0x54e28b];return _0x32f6fb;},_0x54e2(_0x53cadd,_0x53e5d4);}module[_0x2a6313(0x1ca)]=router;const {mkTable,renderForm,post_delete_btn,localeDateTime}=require(_0x2a6313(0x161)),Form=require(_0x2a6313(0x16d)),{div,a,tr,table,tbody,td,i,th,pre,text}=require(_0x2a6313(0x173)),Table=require('@saltcorn/data/models/table'),{send_events_page}=require('../markup/admin.js'),EventLog=require('@saltcorn/data/models/eventlog'),logSettingsForm=async _0x10e148=>{const _0x200abe=_0x2a6313,_0x18e685={'qYwRT':_0x200abe(0x1b3),'hoSmI':'next_hourly_event','RAujL':_0x200abe(0x1cb),'tqoPn':'date','ZOoLU':function(_0x4a1847,_0x12dfff){return _0x4a1847(_0x12dfff);},'rznfo':'Weekly','BPxxm':function(_0x1af57d,_0x331ce7){return _0x1af57d*_0x331ce7;},'lASPN':_0x200abe(0x179),'LNmdV':_0x200abe(0x151),'OtOLX':function(_0x324f50,_0xd09189){return _0x324f50+_0xd09189;},'YnpxF':_0x200abe(0x1da),'hNcyw':function(_0x556c8c,_0x1dae3f){return _0x556c8c+_0x1dae3f;},'QRSJF':'\x20channel','vwPXr':_0x200abe(0x1b9),'iszyd':_0x200abe(0x1ac)},_0x3af06c=_0x4a815b=>{const _0x53411a=_0x200abe,_0x4c3485=new Date();return _0x4c3485[_0x53411a(0x1d7)](_0x4c3485['getHours']()+_0x4a815b),_0x4c3485;},_0x54b9b9=[{'input_type':_0x18e685['qYwRT'],'label':_0x10e148['__'](_0x200abe(0x1d8))},{'name':_0x18e685[_0x200abe(0x16a)],'label':_0x10e148['__'](_0x18e685[_0x200abe(0x194)]),'input_type':'date','attributes':{'minDate':new Date(),'maxDate':_0x3af06c(0x2)}},{'name':_0x200abe(0x156),'label':_0x10e148['__'](_0x200abe(0x1a0)),'input_type':_0x18e685[_0x200abe(0x191)],'attributes':{'minDate':new Date(),'maxDate':_0x18e685[_0x200abe(0x1ab)](_0x3af06c,0x30)}},{'name':'next_weekly_event','label':_0x10e148['__'](_0x18e685[_0x200abe(0x1c2)]),'input_type':'date','attributes':{'minDate':new Date(),'maxDate':_0x18e685[_0x200abe(0x1ab)](_0x3af06c,_0x18e685['BPxxm'](0x18*0x7,0x2))}},{'input_type':_0x200abe(0x1b3),'label':_0x10e148['__'](_0x18e685['lASPN'])}];for(const _0x269fc2 of Trigger[_0x200abe(0x1b6)]){_0x54b9b9[_0x200abe(0x172)]({'name':_0x269fc2,'label':_0x269fc2,'type':_0x18e685[_0x200abe(0x150)]});if(EventLog[_0x200abe(0x1bf)](_0x269fc2)){const _0x3eef69=await Table[_0x200abe(0x17f)]({},{'orderBy':_0x200abe(0x15b)});for(const _0x1e66db of _0x3eef69){_0x54b9b9[_0x200abe(0x172)]({'name':_0x269fc2+'_'+_0x1e66db['name'],'label':'&nbsp;&nbsp;&nbsp;'+_0x269fc2+'\x20'+_0x1e66db[_0x200abe(0x15b)],'type':_0x18e685['LNmdV'],'showIf':{[_0x269fc2]:!![]}});}}if(EventLog[_0x200abe(0x1b1)](_0x269fc2))_0x54b9b9[_0x200abe(0x172)]({'name':_0x18e685[_0x200abe(0x14b)](_0x269fc2,_0x18e685[_0x200abe(0x19f)]),'label':_0x18e685[_0x200abe(0x1d2)](_0x269fc2,_0x18e685[_0x200abe(0x1c1)]),'sublabel':_0x10e148['__'](_0x200abe(0x1df)),'type':_0x200abe(0x1a6),'showIf':{[_0x269fc2]:!![]}});}return new Form({'action':_0x18e685[_0x200abe(0x1e0)],'noSubmitButton':!![],'onChange':_0x18e685[_0x200abe(0x1b8)],'fields':_0x54b9b9});};router[_0x2a6313(0x1b4)](_0x2a6313(0x158),isAdmin,error_catcher(async(_0x1313d1,_0x38cac8)=>{const _0x3cde9a=_0x2a6313,_0x24a0e={'YAhxL':function(_0x82734f){return _0x82734f();},'LQOFH':_0x3cde9a(0x16b),'pOpsN':'card','LNalN':'Events\x20and\x20Trigger\x20settings'},_0x15c947=await logSettingsForm(_0x1313d1);_0x15c947['values']=_0x24a0e['YAhxL'](getState)[_0x3cde9a(0x197)](_0x24a0e[_0x3cde9a(0x175)],{}),_0x15c947[_0x3cde9a(0x199)][_0x3cde9a(0x1bb)]=_0x24a0e[_0x3cde9a(0x1ce)](getState)[_0x3cde9a(0x197)](_0x3cde9a(0x1bb),{}),_0x15c947['values'][_0x3cde9a(0x156)]=getState()[_0x3cde9a(0x197)]('next_daily_event',{}),_0x15c947[_0x3cde9a(0x199)][_0x3cde9a(0x1d4)]=_0x24a0e['YAhxL'](getState)[_0x3cde9a(0x197)](_0x3cde9a(0x1d4),{}),send_events_page({'res':_0x38cac8,'req':_0x1313d1,'active_sub':'Settings','contents':{'type':_0x24a0e[_0x3cde9a(0x184)],'titleAjaxIndicator':!![],'title':_0x1313d1['__'](_0x24a0e['LNalN']),'contents':renderForm(_0x15c947,_0x1313d1[_0x3cde9a(0x1a7)]())}});})),router[_0x2a6313(0x1b4)]('/custom',isAdmin,error_catcher(async(_0x15b5eb,_0x2ce4c7)=>{const _0x577d19=_0x2a6313,_0x3bea78={'aWFlO':function(_0x330d9e){return _0x330d9e();},'VeCvV':_0x577d19(0x1b5),'izlYz':_0x577d19(0x1d9),'juFyf':_0x577d19(0x1a3),'wIboj':_0x577d19(0x1a4),'ZxsLG':function(_0x1f6292,_0x1cff03){return _0x1f6292(_0x1cff03);}},_0x46d2c8=_0x3bea78['aWFlO'](getState)['getConfig'](_0x577d19(0x18c),[]);send_events_page({'res':_0x2ce4c7,'req':_0x15b5eb,'active_sub':_0x577d19(0x165),'contents':{'type':_0x3bea78[_0x577d19(0x14d)],'title':_0x15b5eb['__']('Custom\x20Events'),'contents':mkTable([{'label':_0x15b5eb['__'](_0x577d19(0x1a1)),'key':_0x577d19(0x15b)},{'label':_0x15b5eb['__'](_0x3bea78['izlYz']),'key':_0x4206f5=>_0x4206f5[_0x577d19(0x1b1)]?_0x15b5eb['__'](_0x577d19(0x1c6)):''},{'label':_0x15b5eb['__'](_0x3bea78['juFyf']),'key':_0x45eef7=>post_delete_btn(_0x577d19(0x1a8)+_0x45eef7[_0x577d19(0x15b)],_0x15b5eb)}],_0x46d2c8)+a({'href':_0x3bea78[_0x577d19(0x186)],'class':_0x577d19(0x1c4)},_0x3bea78[_0x577d19(0x155)](i,{'class':_0x577d19(0x1b7)}),_0x15b5eb['__'](_0x577d19(0x1a2)))}});}));function _0x4972(){const _0x3b2d17=['find','body','fOzfg','Xfwqi','egbdz','pOpsN','/custom/delete/:name?','wIboj','ceil','remove_outline(this)','_event','filter','50881210dULKln','custom_events','OHEsw','ORszS','/:id','JdaYx','tqoPn','post','stringify','RAujL','490799ucUlBO','validate','getConfig','mHufm','values','PfltE','pagination','count','iDCPj','TAXTt','YnpxF','Daily','Name','Create\x20custom\x20event','Delete','/eventlog/custom/new','VgZmc','String','csrfToken','/eventlog/custom/delete/','table\x20eventlog','xhr','ZOoLU','saveAndContinue(this)','EFnTB','_page','JjfIm','ofVEn','hasChannel','payload','section_header','get','card','when_options','fas\x20fa-plus-square\x20me-1','iszyd','/eventlog/settings','RmDpH','next_hourly_event','refresh_config','VpqSM','/custom/new','hasTable','hasErrors','QRSJF','rznfo','498280ATfaSD','btn\x20btn-primary\x20mt-1\x20me-3','Event\x20Name','Yes','tGIOB','11NYLHvq','./utils.js','exports','Hourly','HFReL','tpNkl','YAhxL','23356TbsmCB','findOneWithUser','/eventlog/custom','hNcyw','sCXPb','next_weekly_event','AQLgk','eventpayload','setHours','Periodic\x20trigger\x20timing\x20(next\x20event)','Channels','_channel','event_type','@saltcorn/data/models/trigger','1557fKRpFi','refresh_plugins','Channels\x20to\x20create\x20events\x20for.\x20Separate\x20by\x20comma;\x20leave\x20blank\x20for\x20all','vwPXr','qrNZG','json','wtahm','When','OtOLX','JeVAG','VeCvV','zwqau','daily','LNmdV','Bool','/eventlog/','Has\x20channels?','channel','ZxsLG','next_daily_event','JYwhp','/settings','next_','setConfig','name','5542712PWGQiR','YXjOu','@saltcorn/data/db/state','btn-outline-primary','gopage(','@saltcorn/markup','occur_at','39912TZFgUJ','843cILNrx','Custom','email','weekly','Type','EgfgB','hoSmI','event_log_settings','length','@saltcorn/data/models/form','express-promise-router','UDXwR','redirect','SndrV','push','@saltcorn/markup/tags','JGnFz','LQOFH','params','5826EVGFQG','1135UyGZBo','Which\x20events\x20should\x20be\x20logged?','wMJGg','Channel','hourly','New','EGFvT'];_0x4972=function(){return _0x3b2d17;};return _0x4972();}const customEventForm=async _0x36243d=>{const _0x46586a=_0x2a6313,_0x3e3f02={'RmDpH':'/eventlog/custom/new','YXjOu':_0x46586a(0x15f),'tGIOB':_0x46586a(0x15b),'BFEch':_0x46586a(0x1c5),'ZJhnM':_0x46586a(0x1b1)};return new Form({'action':_0x3e3f02[_0x46586a(0x1ba)],'submitButtonClass':_0x3e3f02[_0x46586a(0x15d)],'onChange':_0x46586a(0x188),'fields':[{'name':_0x3e3f02[_0x46586a(0x1c7)],'label':_0x36243d['__'](_0x3e3f02['BFEch']),'type':_0x46586a(0x1a6),'required':!![]},{'name':_0x3e3f02['ZJhnM'],'label':_0x36243d['__'](_0x46586a(0x153)),'type':_0x46586a(0x151)}]});};router[_0x2a6313(0x1b4)]('/custom/new',isAdmin,error_catcher(async(_0x1262bf,_0x524082)=>{const _0xfe93ba=_0x2a6313,_0x3a88eb={'zwqau':_0xfe93ba(0x17d),'wMJGg':'card','tpNkl':_0xfe93ba(0x1a2),'iDCPj':function(_0x4d5eea,_0x19f5a2,_0x3b720a){return _0x4d5eea(_0x19f5a2,_0x3b720a);}},_0x32ae4d=await customEventForm(_0x1262bf);send_events_page({'res':_0x524082,'req':_0x1262bf,'active_sub':_0xfe93ba(0x165),'sub2_page':_0x3a88eb[_0xfe93ba(0x14e)],'contents':{'type':_0x3a88eb[_0xfe93ba(0x17a)],'title':_0x1262bf['__'](_0x3a88eb[_0xfe93ba(0x1cd)]),'contents':_0x3a88eb[_0xfe93ba(0x19d)](renderForm,_0x32ae4d,_0x1262bf['csrfToken']())}});})),router[_0x2a6313(0x192)](_0x2a6313(0x1be),isAdmin,error_catcher(async(_0x525e84,_0x532185)=>{const _0x31ab5b=_0x2a6313,_0x29110f={'TAXTt':function(_0x17dae2,_0x299056){return _0x17dae2(_0x299056);},'Xfwqi':_0x31ab5b(0x165),'ORszS':_0x31ab5b(0x1b5),'fOzfg':function(_0xc8d1a8,_0x5bf0c6,_0x3c1948){return _0xc8d1a8(_0x5bf0c6,_0x3c1948);},'PfltE':function(_0x5bb6de){return _0x5bb6de();}},_0x111153=await _0x29110f['TAXTt'](customEventForm,_0x525e84);_0x111153[_0x31ab5b(0x196)](_0x525e84[_0x31ab5b(0x180)]);if(_0x111153[_0x31ab5b(0x1c0)])_0x29110f[_0x31ab5b(0x19e)](send_events_page,{'res':_0x532185,'req':_0x525e84,'active_sub':_0x29110f[_0x31ab5b(0x182)],'sub2_page':_0x31ab5b(0x17d),'contents':{'type':_0x29110f[_0x31ab5b(0x18e)],'title':_0x525e84['__'](_0x31ab5b(0x1a2)),'contents':_0x29110f[_0x31ab5b(0x181)](renderForm,_0x111153,_0x525e84[_0x31ab5b(0x1a7)]())}});else{const _0x35f0d7=getState()[_0x31ab5b(0x197)](_0x31ab5b(0x18c),[]);await getState()[_0x31ab5b(0x15a)](_0x31ab5b(0x18c),[..._0x35f0d7,_0x111153[_0x31ab5b(0x199)]]),await _0x29110f[_0x31ab5b(0x19a)](getState)[_0x31ab5b(0x1bc)](),_0x532185[_0x31ab5b(0x170)](_0x31ab5b(0x1d1));}})),router[_0x2a6313(0x192)](_0x2a6313(0x185),isAdmin,error_catcher(async(_0x1ad940,_0x41edc4)=>{const _0x48cce8=_0x2a6313,_0x3a7cae={'mHufm':function(_0x18245d){return _0x18245d();},'wtahm':_0x48cce8(0x18c),'egbdz':function(_0x5ef2d6){return _0x5ef2d6();}};let {name:_0x447f13}=_0x1ad940['params'];if(!_0x447f13)_0x447f13='';const _0x58b3e5=getState()[_0x48cce8(0x197)](_0x48cce8(0x18c),[]);await _0x3a7cae[_0x48cce8(0x198)](getState)[_0x48cce8(0x15a)](_0x3a7cae[_0x48cce8(0x149)],_0x58b3e5[_0x48cce8(0x18a)](_0xd7f6bc=>_0xd7f6bc[_0x48cce8(0x15b)]!==_0x447f13)),await _0x3a7cae[_0x48cce8(0x183)](getState)[_0x48cce8(0x1de)](),_0x41edc4['redirect']('/eventlog/custom');})),router['post'](_0x2a6313(0x158),isAdmin,error_catcher(async(_0x4d6361,_0x41898b)=>{const _0x3ba696=_0x2a6313,_0x3b0709={'HFReL':function(_0x516894,_0xbce8fd){return _0x516894(_0xbce8fd);},'ofVEn':function(_0x392665,_0x14e8cb){return _0x392665(_0x14e8cb);},'BWTOq':_0x3ba696(0x17c),'VpqSM':_0x3ba696(0x14f),'VgZmc':function(_0x4fca86){return _0x4fca86();},'tvMRq':_0x3ba696(0x16b)},_0xb7efe2=await _0x3b0709[_0x3ba696(0x1cc)](logSettingsForm,_0x4d6361);_0xb7efe2['validate'](_0x4d6361[_0x3ba696(0x180)]);if(_0xb7efe2['hasErrors'])_0x3b0709[_0x3ba696(0x1b0)](send_events_page,{'res':_0x41898b,'req':_0x4d6361,'active_sub':'Settings','contents':{'type':_0x3ba696(0x1b5),'title':_0x4d6361['__']('Events\x20to\x20log'),'contents':renderForm(_0xb7efe2,_0x4d6361[_0x3ba696(0x1a7)]())}});else{for(const _0x243dd8 of[_0x3b0709['BWTOq'],_0x3b0709[_0x3ba696(0x1bd)],_0x3ba696(0x167)]){const _0x5bcebb=_0x3ba696(0x159)+_0x243dd8+_0x3ba696(0x189);_0xb7efe2[_0x3ba696(0x199)][_0x5bcebb]&&(await _0x3b0709[_0x3ba696(0x1a5)](getState)[_0x3ba696(0x15a)](_0x5bcebb,_0xb7efe2[_0x3ba696(0x199)][_0x5bcebb]),delete _0xb7efe2[_0x3ba696(0x199)][_0x5bcebb]);}await getState()[_0x3ba696(0x15a)](_0x3b0709['tvMRq'],_0xb7efe2[_0x3ba696(0x199)]);if(!_0x4d6361[_0x3ba696(0x1aa)])_0x41898b['redirect'](_0x3ba696(0x1b9));else _0x41898b[_0x3ba696(0x148)]({'success':'ok'});}})),router[_0x2a6313(0x1b4)]('/',isAdmin,error_catcher(async(_0x4cdde1,_0x4d30dc)=>{const _0x12a6ff=_0x2a6313,_0x528329={'Pksmm':_0x12a6ff(0x162),'JdaYx':function(_0x15d1c6,_0x1ce815){return _0x15d1c6===_0x1ce815;},'AQLgk':_0x12a6ff(0x1ad),'pgSQb':_0x12a6ff(0x147),'sCXPb':function(_0x3082f2,_0xe8ecd5){return _0x3082f2/_0xe8ecd5;},'kqjdX':_0x12a6ff(0x1b5),'EgfgB':'Event\x20log','SndrV':_0x12a6ff(0x14a),'JjfIm':_0x12a6ff(0x168),'OHEsw':_0x12a6ff(0x17b)},_0xb91ed=_0x4cdde1['query'],_0x18b74f=0x14,_0x5e9f48={'hover':!![]},_0x5d20ea=parseInt(_0xb91ed[_0x12a6ff(0x1ae)])||0x1,_0x28d1d5=(parseInt(_0xb91ed[_0x12a6ff(0x1ae)])-0x1)*_0x18b74f,_0x34862d=await EventLog[_0x12a6ff(0x17f)]({},{'orderBy':_0x528329['Pksmm'],'orderDesc':!![],'limit':_0x18b74f,'offset':_0x28d1d5});if(_0x528329[_0x12a6ff(0x190)](_0x34862d[_0x12a6ff(0x16c)],_0x18b74f)||_0x5d20ea>0x1){const _0x346dee=await EventLog[_0x12a6ff(0x19c)]({});(_0x346dee>_0x18b74f||_0x5d20ea>0x1)&&(_0x528329[_0x12a6ff(0x1d5)]!==_0x528329['pgSQb']?_0x5e9f48[_0x12a6ff(0x19b)]={'current_page':_0x5d20ea,'pages':Math[_0x12a6ff(0x187)](_0x528329[_0x12a6ff(0x1d3)](_0x346dee,_0x18b74f)),'get_page_link':_0x3c612e=>_0x12a6ff(0x160)+_0x3c612e+',\x20'+_0x18b74f+')'}:_0x2a4f29[_0x12a6ff(0x19b)]={'current_page':_0xe1548e,'pages':_0x4fc089['ceil'](_0x598261/_0x874f30),'get_page_link':_0x202ea2=>_0x12a6ff(0x160)+_0x202ea2+',\x20'+_0x52f3bd+')'});}send_events_page({'res':_0x4d30dc,'req':_0x4cdde1,'active_sub':'Event\x20log','contents':{'type':_0x528329['kqjdX'],'title':_0x4cdde1['__'](_0x528329[_0x12a6ff(0x169)]),'contents':mkTable([{'label':_0x4cdde1['__'](_0x528329[_0x12a6ff(0x171)]),'key':_0x2e92d4=>a({'href':_0x12a6ff(0x152)+_0x2e92d4['id']},_0x2e92d4['reltime'])},{'label':_0x4cdde1['__'](_0x528329[_0x12a6ff(0x1af)]),'key':_0x12a6ff(0x1db)},{'label':_0x4cdde1['__'](_0x528329[_0x12a6ff(0x18d)]),'key':_0x12a6ff(0x154)}],_0x34862d,_0x5e9f48)}});})),router['get'](_0x2a6313(0x18f),isAdmin,error_catcher(async(_0x9ea463,_0x118760)=>{const _0x4edf19=_0x2a6313,_0x227d91={'JGnFz':function(_0xb1c262,_0x4bb4ea){return _0xb1c262(_0x4bb4ea);},'glFsj':'Event\x20log','EGFvT':function(_0x480182,_0x2280cc){return _0x480182(_0x2280cc);},'JeVAG':function(_0xa39739,_0x1fe008,_0x3b5d28){return _0xa39739(_0x1fe008,_0x3b5d28);},'JYwhp':_0x4edf19(0x168),'UDXwR':function(_0x12d1f6,_0x3fae22,_0x467bf8){return _0x12d1f6(_0x3fae22,_0x467bf8);},'zXsPm':function(_0x355db2,_0xe9c032){return _0x355db2(_0xe9c032);}},{id:_0x4eba1b}=_0x9ea463[_0x4edf19(0x176)],_0x4484e2=await EventLog[_0x4edf19(0x1d0)](_0x4eba1b);_0x227d91[_0x4edf19(0x174)](send_events_page,{'res':_0x118760,'req':_0x9ea463,'active_sub':_0x227d91['glFsj'],'sub2_page':_0x4484e2['id'],'contents':{'type':_0x4edf19(0x1b5),'contents':table({'class':_0x4edf19(0x1a9)},tbody(tr(_0x227d91[_0x4edf19(0x17e)](th,_0x9ea463['__']('When')),td(localeDateTime(_0x4484e2[_0x4edf19(0x162)]))),_0x227d91[_0x4edf19(0x14c)](tr,th(_0x9ea463['__'](_0x227d91[_0x4edf19(0x157)])),td(_0x4484e2['event_type'])),_0x227d91[_0x4edf19(0x16f)](tr,_0x227d91[_0x4edf19(0x17e)](th,_0x9ea463['__'](_0x4edf19(0x17b))),_0x227d91['zXsPm'](td,_0x4484e2['channel'])),_0x227d91[_0x4edf19(0x16f)](tr,th(_0x9ea463['__']('User')),_0x227d91['zXsPm'](td,_0x4484e2[_0x4edf19(0x166)]))))+div({'class':_0x4edf19(0x1d6)},_0x4484e2['payload']?pre(text(JSON[_0x4edf19(0x193)](_0x4484e2[_0x4edf19(0x1b2)],null,0x2))):'')}});}));