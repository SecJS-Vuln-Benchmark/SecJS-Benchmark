const _0x547528=_0x5e9f;(function(_0x1901cf,_0x147548){const _0x2091ef=_0x5e9f,_0x1ea9f9=_0x1901cf();while(!![]){try{const _0x59930a=parseInt(_0x2091ef(0x1bd))/0x1+-parseInt(_0x2091ef(0xf4))/0x2+parseInt(_0x2091ef(0x17f))/0x3*(parseInt(_0x2091ef(0x1e5))/0x4)+-parseInt(_0x2091ef(0x1b6))/0x5*(parseInt(_0x2091ef(0x13b))/0x6)+parseInt(_0x2091ef(0x163))/0x7*(parseInt(_0x2091ef(0x1e4))/0x8)+-parseInt(_0x2091ef(0x114))/0x9+-parseInt(_0x2091ef(0x183))/0xa;if(_0x59930a===_0x147548)break;else _0x1ea9f9['push'](_0x1ea9f9['shift']());}catch(_0xbc2d48){_0x1ea9f9['push'](_0x1ea9f9['shift']());}}}(_0x1577,0x7a31a));import{Meteor}from'meteor/meteor';import{_}from'meteor/underscore';import{Match}from'meteor/check';import{userPictureUrl,fetchPicture}from'/imports/server/accounts/picture.js';function _0x1577(){const _0x485870=['Mmkox','21CBsKLb','jFSrY','omit','smtpConfig','HNUoF','BfosR','qfTXX','wrapAsync','New\x20server\x20migrations\x20applied\x20elsewhere','lkqyQ','bDGmM','migrations_applied','MvjBg','qYvZb','signupEmail','egUXl','keys','update','url','require','vYqTo','unverifiedEmail','cxJdE','users','NKIhF','hostname','LGdas','vbZlF','1622394ipZLzu','petname','port','ULdts','11386670ZkwOjQ','handle','bcdGH','packageId','env','string','USfpw','appDemoId','redirect','CYXCj','FrPLN','gNLTd','configurations','Applied\x20migration\x20','isTesting','zSfIP','iKfWQ','Dnmmu','contacts','value','VnjIG','stagedServices','dMJSh','uPSuR','collections','irGhk','rJbWf','yclkR','appTitle','no-reply@','settings','gNjOK','findOne','sessions','organizationLdap','DCSOF','github','User\x20does\x20not\x20have\x20exactly\x20one\x20identity:\x20','services.emailToken','E-mail\x20invite\x20to\x20','PhfPV','hsivx','kjType','digest','indexOf','isAppDemoUser','hex','loginStyle','slice','user','upsert','207965OEpBSX','DZEff','ipBlacklist','observe','smtpUrl','CIZSY','appIndex','766730KbneFv','error','Migrations\x20have\x20completed\x20on\x20replica\x20zero.','mjMvH','bbYnk','https://apps.sandstorm.io','appMarketUrl','migrations','failed','wzJmw','CZXaU','loginIdentities','nhhCy','allowDevAccounts','gdFli','KVDmL','verified_email','identities','owner','fetch','fibers/future','hbAuS','devName','insert','pick','sendReferralProgramNotification','kcOra','GaALx','ZOgNs','anDWt','AKjct','vhAfQ','HJYSM','wait','picture','BWmSb','signupKey','frontendRef','cantRenewFeatureKey','2455664YMJRYg','4utOeWU','QlPpN','OBjiU','nonloginIdentities','TxjRL','getProductivitySuiteAppIds','PcAjg','sha256','noLogin','umdYT','email:','crGaD','find','aBbgq','vIXMG','title','InNAJ','grains','authorPgpKeyFingerprint','ehiho','services','concat','accountId','RmtRk','LRsPn','HsLIz','trialFeatureKeyExpired','dnaQO','tryGetPackage','updateAppIndex','Running\x20new\x20server\x20startup\x20function\x20','name','xOwod','tDXjt','stack','profile','eNulC','vZlIs','email','urfQC','localhost','AUVlt','plan','denormalizedGrainMetadata','tokens','oWbdC','eeidN','qGLHQ','serverTitle','FPodK','cap','707254IfLYqx','lastActive','WZGaO','setPreinstalledApps','RZSVY','getGrainStorageUsage','checking\x20PGP\x20signature\x20for\x20package:','google','appIndexUrl','packages','zable','note','parse','emailToken','Applying\x20migration\x20','anpmG','WtzgN','dLrtc','public','$unset','tyIKU','https://app-index.sandstorm.io','crypto','isReferralEnabled','\x20\x20no\x20signature','appId','LxZMh','vOkvR','userActions','returnAddress','new_server_migrations_applied','appUpdatesEnabled','997407VOGUFr','return','getSystemSuiteAppIds','DCvlh','vDHvr','Duadc','vyuHb','remove','Migrations\x20already\x20applied:\x20','resume','pkFIH','MGejL','\x20/\x20','organizationSaml','MzOCF','storageUsage','ZhNJn','expires','_id','organizationGoogle','nounPhrase','length','organizationMembership','log','GAWcm','apiTokens','grainId','mpTsk','vyyaF','dIJNp','kGwIU','main','forEach','signupKeys','aYuSN','Fetching\x20user\x20picture:','oQtUG','organizationEmail','QSMvC','18TMtypS','dailySentMailCount','$grainId','setTimeout','bPbgY','dev','demo','signupNote','pronoun','wOaxz','dNGyJ','lastIndexOf','Migrations\x20applied\x20elsewhere:\x20','cBLHl','service','isNumber','map','wzjvK','MzNco','notifications','createdAt','BsOGg','size','EUAzT','isAdmin','BDrxJ','roleAssignment','stop','JbFDd','skRrN','auth','admin','verifiedEmail','hasCompletedSignup','aOrPT','sharer','KqBUi','identityId','WdRZk'];_0x1577=function(){return _0x485870;};return _0x1577();}import{waitPromise}from'/imports/server/async-helpers.js';function _0x5e9f(_0x2ac061,_0x25c554){const _0x1577f1=_0x1577();return _0x5e9f=function(_0x5e9fba,_0x2c3911){_0x5e9fba=_0x5e9fba-0xcb;let _0x235da7=_0x1577f1[_0x5e9fba];return _0x235da7;},_0x5e9f(_0x2ac061,_0x25c554);}import{PRIVATE_IPV4_ADDRESSES,PRIVATE_IPV6_ADDRESSES}from'/imports/constants.js';const Future=Npm['require'](_0x547528(0x1d1)),Url=Npm[_0x547528(0x176)](_0x547528(0x175)),Crypto=Npm['require'](_0x547528(0x10a)),updateLoginStyleToRedirect=function(_0x4727c6,_0x1ab8b9){const _0x1d686e=_0x547528,_0x361dba={'gdFli':'redirect','VLOAY':_0x1d686e(0x168),'lkqyQ':'service-configuration','irGhk':_0x1d686e(0x1a7)},_0x4ef9a4=Package[_0x361dba[_0x1d686e(0x16c)]]['ServiceConfiguration'][_0x1d686e(0x18f)];[_0x1d686e(0xfb),_0x361dba[_0x1d686e(0x19c)]][_0x1d686e(0x134)](function(_0x367a5b){const _0x165a6e=_0x1d686e,_0x5f0ea5=_0x4ef9a4[_0x165a6e(0x1a3)]({'service':_0x367a5b});_0x5f0ea5&&_0x5f0ea5[_0x165a6e(0x1b2)]!==_0x361dba[_0x165a6e(0x1cb)]&&(_0x165a6e(0x150)!==_0x361dba['VLOAY']?_0x4ef9a4[_0x165a6e(0x174)]({'service':_0x367a5b},{'$set':{'loginStyle':_0x165a6e(0x18b)}}):_0x5ad43b[_0x165a6e(0x198)][_0x165a6e(0xe7)]=_0x5841d5[_0x165a6e(0x149)][_0x165a6e(0xe7)]);});},enableLegacyOAuthProvidersIfNotInSettings=function(_0x3077d7,_0x3b5387){const _0x17adbb=_0x547528,_0x26a0cb={'BWmSb':function(_0x155d5c,_0x10a49f){return _0x155d5c&&_0x10a49f;},'kfzGv':'google','MvjBg':_0x17adbb(0x1a7)},_0x5e003d=ServiceConfiguration[_0x17adbb(0x18f)];[_0x26a0cb['kfzGv'],_0x26a0cb[_0x17adbb(0x16f)]][_0x17adbb(0x134)](function(_0x278159){const _0x1fe15e=_0x17adbb,_0x2f50a4=_0x5e003d[_0x1fe15e(0x1a3)]({'service':_0x278159}),_0x2bbdc3=_0x3077d7[_0x1fe15e(0x19b)]['settings'][_0x1fe15e(0x1a3)]({'_id':_0x278159});_0x26a0cb[_0x1fe15e(0x1e0)](_0x2f50a4,!_0x2bbdc3)&&_0x3077d7[_0x1fe15e(0x19b)]['settings'][_0x1fe15e(0x1d4)]({'_id':_0x278159,'value':!![]});});},denormalizeInviteInfo=function(_0x4062e0,_0xeb232e){const _0x1070c5=_0x547528,_0x3d8c5f={'cxJdE':_0x1070c5(0x112),'EUAzT':_0x1070c5(0x188),'wzJmw':function(_0xc7e218,_0x2b2dc6){return _0xc7e218!==_0x2b2dc6;},'crGaD':function(_0x533848,_0x263c5d){return _0x533848!==_0x263c5d;},'baPtW':_0x1070c5(0x136),'VkTyR':_0x1070c5(0x1aa)};_0x4062e0['collections']['users']['find']()[_0x1070c5(0x134)](function(_0x323fbf){const _0x10301e=_0x1070c5;if(_0x323fbf[_0x10301e(0x1e1)]&&typeof _0x323fbf[_0x10301e(0x1e1)]===_0x3d8c5f[_0x10301e(0x152)]&&_0x3d8c5f[_0x10301e(0x1c6)](_0x323fbf[_0x10301e(0x1e1)],_0x10301e(0x15a))){if(_0x3d8c5f[_0x10301e(0xcc)](_0x10301e(0x17e),_0x10301e(0x17e)))_0x11e209[_0x10301e(0xd5)]={'resume':_0xa43c1c[_0x10301e(0xd5)][_0x10301e(0x11d)]};else{const _0x50fe5f=_0x4062e0[_0x10301e(0x19b)][_0x10301e(0x135)]['findOne'](_0x323fbf['signupKey']);if(_0x50fe5f&&_0x50fe5f[_0x10301e(0xff)]){if(_0x10301e(0x138)!==_0x3d8c5f['baPtW']){const _0x4657e4={'signupNote':_0x50fe5f[_0x10301e(0xff)]},_0x3c8106=_0x3d8c5f['VkTyR'];_0x50fe5f[_0x10301e(0xff)][_0x10301e(0x146)](_0x3c8106)===0x0&&(_0x4657e4[_0x10301e(0x171)]=_0x50fe5f[_0x10301e(0xff)][_0x10301e(0x1b3)](_0x3c8106['length'])),_0x4062e0['collections'][_0x10301e(0x17a)][_0x10301e(0x174)](_0x323fbf[_0x10301e(0x126)],{'$set':_0x4657e4});}else _0x590a05[_0x10301e(0x19b)]['migrations']['insert']({'_id':_0x3d8c5f[_0x10301e(0x179)],'value':!![]});}}}});},mergeRoleAssignmentsIntoApiTokens=function(_0x5b95c3,_0x56a2fa){const _0x269000=_0x547528;_0x5b95c3[_0x269000(0x19b)]['roleAssignments'][_0x269000(0xcd)]()[_0x269000(0x134)](function(_0x39c396){const _0x1022dd=_0x269000;_0x5b95c3[_0x1022dd(0x19b)]['apiTokens'][_0x1022dd(0x1d4)]({'grainId':_0x39c396['grainId'],'userId':_0x39c396[_0x1022dd(0x15e)],'roleAssignment':_0x39c396[_0x1022dd(0x155)],'petname':_0x39c396[_0x1022dd(0x180)],'created':_0x39c396['created'],'owner':{'user':{'userId':_0x39c396['recipient'],'title':_0x39c396[_0x1022dd(0xd0)]}}});});},fixOasisStorageUsageStats=function(_0x2fddac,_0x15ef89){},fetchProfilePictures=function(_0x2ce62b,_0x38a0c3){const _0x408c7d=_0x547528,_0x45a404={'bPbgY':function(_0x2772a5,_0x182073){return _0x2772a5(_0x182073);},'DCSOF':_0x408c7d(0x137)};_0x2ce62b['collections'][_0x408c7d(0x17a)][_0x408c7d(0xcd)]({})['forEach'](function(_0x2b6bef){const _0x36b811=_0x408c7d,_0xc7098b=_0x45a404[_0x36b811(0x13f)](userPictureUrl,_0x2b6bef);if(_0xc7098b){console['log'](_0x45a404[_0x36b811(0x1a6)],_0xc7098b);const _0x61af6d=fetchPicture(_0x2ce62b,_0xc7098b);_0x61af6d&&_0x2ce62b[_0x36b811(0x19b)]['users'][_0x36b811(0x174)](_0x2b6bef['_id'],{'$set':{'profile.picture':_0x61af6d}});}});},assignPlans=function(_0x3f1561,_0x30f107){},removeKeyrings=function(_0x38d2f8,_0x8e2df2){const _0x227472=_0x547528;_0x38d2f8['collections'][_0x227472(0xfd)][_0x227472(0x174)]({'manifest.metadata.pgpKeyring':{'$exists':!![]}},{'$unset':{'manifest.metadata.pgpKeyring':''}},{'multi':!![]});},useLocalizedTextInUserActions=function(_0x5b08f5,_0x5d701a){const _0x46a1da=_0x547528,_0x251013={'CIZSY':function(_0x45761a,_0x2f0924){return _0x45761a==_0x2f0924;},'vOkvR':function(_0x1fba8e,_0x5c7cb8){return _0x1fba8e%_0x5c7cb8;},'CYXCj':function(_0x2865f0,_0x31d753){return _0x2865f0 in _0x31d753;},'GAWcm':function(_0x56dd18,_0x58e22b){return _0x56dd18===_0x58e22b;},'lROYe':_0x46a1da(0xcf),'zable':_0x46a1da(0x1c7),'xTecM':_0x46a1da(0x19f),'iKfWQ':function(_0x17b473,_0x4d79f7,_0x237b9c,_0x50c5f2){return _0x17b473(_0x4d79f7,_0x237b9c,_0x50c5f2);},'cBLHl':_0x46a1da(0x128)};function _0x1442aa(_0x5de77a,_0x96c444,_0x2a186b){const _0x168990=_0x46a1da,_0x2c8f48={'OBjiU':function(_0x261684,_0x2b4f71){const _0x18d876=_0x5e9f;return _0x251013[_0x18d876(0x1bb)](_0x261684,_0x2b4f71);},'eNulC':function(_0xaec967,_0x527a46){const _0x1c08fb=_0x5e9f;return _0x251013[_0x1c08fb(0x10f)](_0xaec967,_0x527a46);}};if(_0x251013[_0x168990(0x18c)](_0x2a186b,_0x96c444)){if(_0x251013[_0x168990(0x12c)](_0x251013['lROYe'],'dLFmT')){const _0xeb3af4=function(){const _0x5585f7=_0x168990;_0x574c7b[_0x5585f7(0xde)]();const _0x4c93a7=_0x1571d9[_0x5585f7(0x19b)]['appIndex'][_0x5585f7(0xcd)]({'_id':{'$in':_0x21f2b0['getProductivitySuiteAppIds']()[_0x5585f7(0xd6)](_0x316878[_0x5585f7(0x116)]())}})[_0x5585f7(0x1d0)](),_0xa3ef06=_0x7661fb[_0x5585f7(0x14b)](_0x4c93a7,_0x37cd21=>{const _0x37b2ed=_0x5585f7;return{'appId':_0x37cd21[_0x37b2ed(0x10d)],'packageId':_0x37cd21[_0x37b2ed(0x186)]};});_0x5d40c0[_0x5585f7(0xf7)](_0xa3ef06);};!_0x12f265['settings']['public'][_0x168990(0x191)]&&!_0x1de4f3[_0x168990(0x1ca)]()&&_0x563dfe[_0x168990(0x13e)](_0xeb3af4,0x0);}else typeof _0x96c444[_0x2a186b]==='string'?_0x251013[_0x168990(0xfe)]===_0x168990(0x1c7)?_0x5de77a[_0x2a186b]={'defaultText':_0x96c444[_0x2a186b]}:(_0x2c8f48[_0x168990(0x1e7)](_0x2c8f48[_0x168990(0xe5)](_0x2a5137,0x64),0x0)&&_0x298f5b['log'](_0x23c259+_0x168990(0x120)+_0x357637[_0x168990(0x129)]),++_0x102985,_0xcc8f7a[_0x168990(0x19b)][_0x168990(0x12d)][_0x168990(0x174)]({'grainId':_0x4530b4[_0x168990(0x126)],'owner.user.title':{'$exists':!![],'$ne':_0x2c9da9[_0x168990(0xd0)]}},{'$set':{'owner.user.upstreamTitle':_0x566f64[_0x168990(0xd0)]}},{'multi':!![]})):_0x5de77a[_0x2a186b]=_0x96c444[_0x2a186b];}}_0x5b08f5['collections'][_0x46a1da(0x110)]['find']({})[_0x46a1da(0x134)](function(_0x39de9f){const _0x4c644d=_0x46a1da,_0x3739c4={};_0x1442aa(_0x3739c4,_0x39de9f,_0x251013['xTecM']),_0x1442aa(_0x3739c4,_0x39de9f,_0x4c644d(0xd0)),_0x251013[_0x4c644d(0x193)](_0x1442aa,_0x3739c4,_0x39de9f,_0x251013[_0x4c644d(0x148)]),_0x5b08f5[_0x4c644d(0x19b)]['userActions'][_0x4c644d(0x174)](_0x39de9f['_id'],{'$set':_0x3739c4});});},verifyAllPgpSignatures=function(_0x1530b9,_0x5bf6c1){const _0x1384a2=_0x547528,_0x22098f={'frVWD':_0x1384a2(0xfa),'dMJSh':function(_0x463366,_0x12d0ba){return _0x463366(_0x12d0ba);}};_0x1530b9[_0x1384a2(0x19b)][_0x1384a2(0xfd)][_0x1384a2(0xcd)]({})[_0x1384a2(0x134)](function(_0x4d1e9f){const _0x2e0699=_0x1384a2;try{console[_0x2e0699(0x12b)](_0x22098f['frVWD'],_0x4d1e9f[_0x2e0699(0x126)]);const _0x5027dc=_0x22098f[_0x2e0699(0x199)](waitPromise,_0x5bf6c1[_0x2e0699(0xf3)]()[_0x2e0699(0xdd)](_0x4d1e9f['_id']));_0x5027dc[_0x2e0699(0xd3)]?(console[_0x2e0699(0x12b)]('\x20\x20'+_0x5027dc[_0x2e0699(0xd3)]),_0x1530b9[_0x2e0699(0x19b)]['packages']['update'](_0x4d1e9f[_0x2e0699(0x126)],{'$set':{'authorPgpKeyFingerprint':_0x5027dc['authorPgpKeyFingerprint']}})):console['log'](_0x2e0699(0x10c));}catch(_0x5151b6){console[_0x2e0699(0x1be)](_0x5151b6['stack']);}});},splitUserIdsIntoAccountIdsAndIdentityIds=function(_0x238927,_0x18f346){const _0x12176a=_0x547528,_0x492d25={'KVDmL':function(_0x3a7578,_0x24aa3b){return _0x3a7578===_0x24aa3b;},'Duadc':function(_0x55f56d,_0x6d6660){return _0x55f56d!==_0x6d6660;},'lsWef':_0x12176a(0x15a),'CEyPz':'E-mail\x20invite\x20to\x20','uPSuR':function(_0x2844a0,_0x53f0de){return _0x2844a0 in _0x53f0de;},'aOrPT':function(_0x36576e,_0x1f7219){return _0x36576e in _0x1f7219;},'rJbWf':function(_0xed70a1,_0x422b5d){return _0xed70a1 in _0x422b5d;},'RZSVY':_0x12176a(0xfb),'eeidN':function(_0x322c74,_0x3f9e02){return _0x322c74!==_0x3f9e02;},'VUQZf':'Ekmjo','QSMvC':_0x12176a(0xd1),'rZgaB':function(_0x57d789,_0x59eaf6){return _0x57d789 in _0x59eaf6;},'urfQC':_0x12176a(0x101),'UJlZf':_0x12176a(0x1ec),'gNjOK':function(_0x3a48f5,_0x4f148b){return _0x3a48f5+_0x4f148b;},'hbAuS':_0x12176a(0x1b1),'VnjIG':'iKjcV'};_0x238927['collections']['users'][_0x12176a(0xcd)]()[_0x12176a(0x134)](function(_0x2249b4){const _0x3a1f86=_0x12176a,_0x456c2b={};let _0x2118a7;if(_0x492d25[_0x3a1f86(0x19a)](_0x3a1f86(0x1d3),_0x2249b4))_0x456c2b['service']=_0x3a1f86(0x140),_0x2118a7=_0x2249b4['devName'];else{if(_0x492d25[_0x3a1f86(0x15d)](_0x3a1f86(0x125),_0x2249b4))_0x456c2b[_0x3a1f86(0x149)]=_0x3a1f86(0x141),_0x2118a7=_0x2249b4[_0x3a1f86(0x126)];else{if(_0x2249b4[_0x3a1f86(0xd5)]&&_0x492d25[_0x3a1f86(0x19d)](_0x492d25[_0x3a1f86(0xf8)],_0x2249b4[_0x3a1f86(0xd5)]))_0x492d25[_0x3a1f86(0xef)](_0x492d25['VUQZf'],_0x3a1f86(0x161))?(_0x456c2b[_0x3a1f86(0x149)]=_0x3a1f86(0xfb),_0x2249b4[_0x3a1f86(0xd5)][_0x3a1f86(0xfb)][_0x3a1f86(0xe7)]&&_0x2249b4[_0x3a1f86(0xd5)][_0x3a1f86(0xfb)][_0x3a1f86(0x1cd)]&&(_0x492d25[_0x3a1f86(0x13a)]!==_0x3a1f86(0xd1)?(_0x1c5cc3['service']='github',_0x22c9b8['unverifiedEmail']=_0x21c5b7[_0x3a1f86(0xd5)][_0x3a1f86(0x1a7)]['email'],_0x5c8106=_0x5396b7[_0x3a1f86(0xd5)][_0x3a1f86(0x1a7)]['id']):_0x456c2b[_0x3a1f86(0x15b)]=_0x2249b4[_0x3a1f86(0xd5)]['google'][_0x3a1f86(0xe7)]),_0x2118a7=_0x2249b4[_0x3a1f86(0xd5)][_0x3a1f86(0xfb)]['id']):_0x200d19[_0x3a1f86(0x143)]=_0x5b88b8[_0x3a1f86(0xe4)]['pronoun'];else{if(_0x2249b4[_0x3a1f86(0xd5)]&&_0x492d25[_0x3a1f86(0x19a)](_0x3a1f86(0x1a7),_0x2249b4['services']))_0x456c2b[_0x3a1f86(0x149)]=_0x3a1f86(0x1a7),_0x456c2b['unverifiedEmail']=_0x2249b4['services']['github'][_0x3a1f86(0xe7)],_0x2118a7=_0x2249b4[_0x3a1f86(0xd5)][_0x3a1f86(0x1a7)]['id'];else _0x2249b4[_0x3a1f86(0xd5)]&&_0x492d25['rZgaB'](_0x492d25[_0x3a1f86(0xe8)],_0x2249b4[_0x3a1f86(0xd5)])&&(_0x456c2b['service']=_0x492d25[_0x3a1f86(0xe8)],_0x456c2b[_0x3a1f86(0x15b)]=_0x2249b4[_0x3a1f86(0xd5)]['emailToken'][_0x3a1f86(0xe7)],_0x2118a7=_0x2249b4[_0x3a1f86(0xd5)]['emailToken']['email']);}}}_0x456c2b['id']=Crypto['createHash'](_0x492d25['UJlZf'])[_0x3a1f86(0x174)](_0x492d25[_0x3a1f86(0x1a2)](_0x456c2b[_0x3a1f86(0x149)],':')+_0x2118a7)[_0x3a1f86(0x1ae)](_0x492d25[_0x3a1f86(0x1d2)]);if(_0x2249b4[_0x3a1f86(0xe4)]){_0x2249b4['profile']['name']&&(_0x456c2b[_0x3a1f86(0xe0)]=_0x2249b4[_0x3a1f86(0xe4)]['name']);if(_0x2249b4[_0x3a1f86(0xe4)][_0x3a1f86(0x184)]){if(_0x492d25[_0x3a1f86(0x197)]===_0x492d25[_0x3a1f86(0x197)])_0x456c2b['handle']=_0x2249b4['profile'][_0x3a1f86(0x184)];else{if(_0x17d0cd[_0x3a1f86(0x1e1)]&&_0x492d25[_0x3a1f86(0x1cc)](typeof _0x5d3680[_0x3a1f86(0x1e1)],_0x3a1f86(0x188))&&_0x492d25[_0x3a1f86(0x119)](_0x5a4667[_0x3a1f86(0x1e1)],_0x492d25['lsWef'])){const _0x12a00b=_0x15a9c9[_0x3a1f86(0x19b)][_0x3a1f86(0x135)][_0x3a1f86(0x1a3)](_0x14ae27[_0x3a1f86(0x1e1)]);if(_0x12a00b&&_0x12a00b[_0x3a1f86(0xff)]){const _0x1b5917={'signupNote':_0x12a00b[_0x3a1f86(0xff)]},_0x17dfe4=_0x492d25['CEyPz'];_0x12a00b[_0x3a1f86(0xff)][_0x3a1f86(0x146)](_0x17dfe4)===0x0&&(_0x1b5917[_0x3a1f86(0x171)]=_0x12a00b[_0x3a1f86(0xff)][_0x3a1f86(0x1b3)](_0x17dfe4[_0x3a1f86(0x129)])),_0x4d4109[_0x3a1f86(0x19b)][_0x3a1f86(0x17a)][_0x3a1f86(0x174)](_0x305f4c[_0x3a1f86(0x126)],{'$set':_0x1b5917});}}}}_0x2249b4[_0x3a1f86(0xe4)][_0x3a1f86(0x1df)]&&(_0x456c2b[_0x3a1f86(0x1df)]=_0x2249b4['profile'][_0x3a1f86(0x1df)]),_0x2249b4['profile'][_0x3a1f86(0x143)]&&(_0x456c2b[_0x3a1f86(0x143)]=_0x2249b4[_0x3a1f86(0xe4)]['pronoun']),_0x2249b4[_0x3a1f86(0xe4)][_0x3a1f86(0xe7)]&&(_0x456c2b[_0x3a1f86(0x178)]=_0x2249b4[_0x3a1f86(0xe4)][_0x3a1f86(0xe7)]);}_0x456c2b['main']=!![],_0x238927['collections'][_0x3a1f86(0x17a)][_0x3a1f86(0x174)](_0x2249b4[_0x3a1f86(0x126)],{'$set':{'identities':[_0x456c2b]}}),_0x238927[_0x3a1f86(0x19b)][_0x3a1f86(0xd2)][_0x3a1f86(0x174)]({'userId':_0x2249b4['_id']},{'$set':{'identityId':_0x456c2b['id']}},{'multi':!![]}),_0x238927['collections']['sessions'][_0x3a1f86(0x174)]({'userId':_0x2249b4['_id']},{'$set':{'identityId':_0x456c2b['id']}},{'multi':!![]}),_0x238927[_0x3a1f86(0x19b)][_0x3a1f86(0x12d)][_0x3a1f86(0x174)]({'userId':_0x2249b4['_id']},{'$set':{'identityId':_0x456c2b['id']}},{'multi':!![]}),_0x238927[_0x3a1f86(0x19b)][_0x3a1f86(0x12d)][_0x3a1f86(0x174)]({'owner.user.userId':_0x2249b4[_0x3a1f86(0x126)]},{'$set':{'owner.user.identityId':_0x456c2b['id']}},{'multi':!![]}),_0x238927[_0x3a1f86(0x19b)][_0x3a1f86(0x12d)][_0x3a1f86(0x174)]({'owner.grain.introducerUser':_0x2249b4['_id']},{'$set':{'owner.grain.introducerIdentity':_0x456c2b['id']}},{'multi':!![]});while(_0x238927['collections'][_0x3a1f86(0x12d)]['update']({'requirements.permissionsHeld.userId':_0x2249b4['_id']},{'$set':{'requirements.$.permissionsHeld.identityId':_0x456c2b['id']},'$unset':{'requirements.$.permissionsHeld.userId':0x1}},{'multi':!![]})>0x0);}),_0x238927[_0x12176a(0x19b)]['apiTokens'][_0x12176a(0x11b)]({'userInfo':{'$exists':!![]}});},appUpdateSettings=function(_0x684c35,_0x322b02){const _0x3fdec7=_0x547528,_0x69bee7={'vDHvr':_0x3fdec7(0x1c2),'qfTXX':_0x3fdec7(0x113)};_0x684c35[_0x3fdec7(0x19b)]['settings']['insert']({'_id':_0x3fdec7(0x1c3),'value':_0x69bee7[_0x3fdec7(0x118)]}),_0x684c35[_0x3fdec7(0x19b)][_0x3fdec7(0x1a1)][_0x3fdec7(0x1d4)]({'_id':_0x3fdec7(0xfc),'value':_0x3fdec7(0x109)}),_0x684c35['collections']['settings'][_0x3fdec7(0x1d4)]({'_id':_0x69bee7[_0x3fdec7(0x169)],'value':!![]});},moveDevAndEmailLoginDataIntoIdentities=function(_0x345671,_0x56f4f4){const _0x4d5a75=_0x547528,_0x2c90b0={'aBbgq':_0x4d5a75(0xdf),'kcOra':function(_0x2222c4,_0x2a9cbe){return _0x2222c4+_0x2a9cbe;},'vZlIs':_0x4d5a75(0x1b7),'tDXjt':function(_0x1a45d5,_0x4b1a88){return _0x1a45d5!==_0x4b1a88;},'MpImr':_0x4d5a75(0x1a8),'KyydR':_0x4d5a75(0x184),'pkFIH':_0x4d5a75(0x1df),'GaALx':_0x4d5a75(0x143),'egUXl':function(_0x5330b4,_0x2158d4){return _0x5330b4===_0x2158d4;},'MGejL':_0x4d5a75(0x101),'dnaQO':_0x4d5a75(0x1a9),'vhAfQ':function(_0x30a72f,_0x10a47d){return _0x30a72f>_0x10a47d;}};_0x345671[_0x4d5a75(0x19b)][_0x4d5a75(0x17a)]['find']()['forEach'](function(_0x16b18e){const _0x59c212=_0x4d5a75;if(_0x2c90b0[_0x59c212(0xe6)]==='DZEff'){if(_0x2c90b0[_0x59c212(0xe2)](_0x16b18e['identities'][_0x59c212(0x129)],0x1))throw new Error(_0x2c90b0['MpImr'],_0x16b18e);const _0x30ec0d=_0x16b18e[_0x59c212(0x1ce)][0x0];if(Match['test'](_0x30ec0d[_0x59c212(0x149)],Object))return;const _0x30b41a=_[_0x59c212(0x1d5)](_0x30ec0d,'id',_0x59c212(0x133),_0x59c212(0x1ed),_0x59c212(0x15b),_0x59c212(0x178));_0x30b41a[_0x59c212(0xe4)]=_[_0x59c212(0x1d5)](_0x30ec0d,'name',_0x2c90b0['KyydR'],_0x2c90b0[_0x59c212(0x11e)],_0x2c90b0[_0x59c212(0x1d8)]);const _0x1eed34={},_0x5b934c={};if(_0x2c90b0[_0x59c212(0x172)](_0x30ec0d['service'],_0x59c212(0x140)))_0x1eed34[_0x59c212(0xe0)]=_0x16b18e[_0x59c212(0x1d3)],_0x5b934c['devName']=0x1;else _0x30ec0d[_0x59c212(0x149)]===_0x2c90b0[_0x59c212(0x11f)]&&(_0x1eed34['tokens']=_0x16b18e['services'][_0x59c212(0x101)][_0x59c212(0xed)],_0x1eed34[_0x59c212(0xe7)]=_0x16b18e[_0x59c212(0xd5)][_0x59c212(0x101)][_0x59c212(0xe7)],_0x5b934c[_0x2c90b0[_0x59c212(0xdc)]]=0x1);_0x30b41a[_0x59c212(0x149)]={},_0x30b41a[_0x59c212(0x149)][_0x30ec0d[_0x59c212(0x149)]]=_0x1eed34;const _0x1993d4={'$set':{'identities':[_0x30b41a]}};_0x2c90b0[_0x59c212(0x1dc)](Object[_0x59c212(0x173)](_0x5b934c)['length'],0x0)&&(_0x1993d4['$unset']=_0x5b934c),_0x345671['collections'][_0x59c212(0x17a)]['update']({'_id':_0x16b18e[_0x59c212(0x126)]},_0x1993d4);}else{for(let _0x53393a=0x0;_0x53393a<_0xafcd8e[_0x59c212(0x129)];_0x53393a++){_0x551668['log'](_0x2c90b0['aBbgq']+_0x2c90b0[_0x59c212(0x1d7)](_0x53393a,0x1)),_0x18f8ef[_0x53393a](_0x24219f,_0x10f522),_0xcee1a9[_0x59c212(0x12b)](_0x2c90b0[_0x59c212(0xce)]+(_0x53393a+0x1));}_0x499c46[_0x59c212(0x19b)]['migrations'][_0x59c212(0x174)]({'_id':_0x59c212(0x112)},{'$set':{'value':!![]}});}});},repairEmailIdentityIds=function(_0x4589d0,_0x39b82e){const _0x5d2cd4=_0x547528,_0x3e2c09={'ehiho':_0x5d2cd4(0x133),'FrPLN':'verifiedEmail','sUvEL':'unverifiedMail','dLrtc':_0x5d2cd4(0xe4),'yclkR':_0x5d2cd4(0xcb),'vYqTo':_0x5d2cd4(0x1b1)};_0x4589d0[_0x5d2cd4(0x19b)][_0x5d2cd4(0x17a)][_0x5d2cd4(0xcd)]({'identities.service.emailToken':{'$exists':0x1}})[_0x5d2cd4(0x134)](function(_0x56149e){const _0x991977=_0x5d2cd4;if(_0x56149e[_0x991977(0x1ce)][_0x991977(0x129)]!==0x1)throw new Error(_0x991977(0x1a8),_0x56149e);const _0x4b73d1=_0x56149e[_0x991977(0x1ce)][0x0],_0x4020db=_[_0x991977(0x1d5)](_0x4b73d1,_0x3e2c09[_0x991977(0xd4)],'noLogin',_0x3e2c09[_0x991977(0x18d)],_0x3e2c09['sUvEL'],_0x3e2c09[_0x991977(0x105)]);_0x4020db['service']={'email':_0x4b73d1[_0x991977(0x149)]['emailToken']},_0x4020db['id']=Crypto['createHash']('sha256')[_0x991977(0x174)](_0x3e2c09[_0x991977(0x19e)]+_0x4b73d1[_0x991977(0x149)][_0x991977(0x101)]['email'])[_0x991977(0x1ae)](_0x3e2c09[_0x991977(0x177)]),_0x4589d0[_0x991977(0x19b)][_0x991977(0xd2)][_0x991977(0x174)]({'identityId':_0x4b73d1['id']},{'$set':{'identityId':_0x4020db['id']}},{'multi':!![]}),_0x4589d0[_0x991977(0x19b)][_0x991977(0x1a4)][_0x991977(0x174)]({'identityId':_0x4b73d1['id']},{'$set':{'identityId':_0x4020db['id']}},{'multi':!![]}),_0x4589d0[_0x991977(0x19b)][_0x991977(0x12d)][_0x991977(0x174)]({'identityId':_0x4b73d1['id']},{'$set':{'identityId':_0x4020db['id']}},{'multi':!![]}),_0x4589d0[_0x991977(0x19b)]['apiTokens'][_0x991977(0x174)]({'owner.user.identityId':_0x4b73d1['id']},{'$set':{'owner.user.identityId':_0x4020db['id']}},{'multi':!![]}),_0x4589d0[_0x991977(0x19b)]['apiTokens'][_0x991977(0x174)]({'owner.grain.introducerIdentity':_0x4b73d1['id']},{'$set':{'owner.grain.introducerIdentity':_0x4020db['id']}},{'multi':!![]});while(_0x4589d0[_0x991977(0x19b)][_0x991977(0x12d)]['update']({'requirements.permissionsHeld.identityId':_0x4b73d1['id']},{'$set':{'requirements.$.permissionsHeld.identityId':_0x4020db['id']}},{'multi':!![]})>0x0);_0x4589d0['collections']['users'][_0x991977(0x174)]({'_id':_0x56149e[_0x991977(0x126)]},{'$set':{'identities':[_0x4020db]}});});},splitAccountUsersAndIdentityUsers=function(_0x2a901f,_0x2ea5ac){const _0x4a7076=_0x547528,_0x2008fa={'dNGyJ':'Applying\x20migration\x20','ydonH':function(_0x3f5119,_0x3aec08){return _0x3f5119+_0x3aec08;},'UJXnu':'migrations_applied','LRsPn':_0x4a7076(0x1e3),'XmLzC':_0x4a7076(0x1ab),'ZhNJn':_0x4a7076(0x14f),'hueZu':_0x4a7076(0x178),'zSfIP':'resume','wOaxz':_0x4a7076(0xf5),'Mmkox':_0x4a7076(0x153),'RmtRk':_0x4a7076(0x1e1),'wzjvK':_0x4a7076(0x123),'NKIhF':_0x4a7076(0x18a),'owSQs':'payments','TxjRL':_0x4a7076(0x15c),'LGdas':_0x4a7076(0x1e6)};_0x2a901f['collections']['users'][_0x4a7076(0xcd)]({'identities':{'$exists':!![]}})[_0x4a7076(0x134)](function(_0x17caf2){const _0x36690c=_0x4a7076;if(_0x17caf2['identities'][_0x36690c(0x129)]!==0x1){if(_0x36690c(0x11a)!==_0x2008fa['XmLzC'])throw new Error(_0x36690c(0x1a8),_0x17caf2);else _0x5cab4c[_0x36690c(0x12b)](_0x2008fa[_0x36690c(0x145)]+_0x2008fa['ydonH'](_0xbfa236,0x1)),_0x3ce293[_0x2cc0aa](_0xcf85dc,_0x4effc8),_0x3c2371[_0x36690c(0x19b)][_0x36690c(0x1c4)]['update']({'_id':_0x2008fa['UJXnu']},{'$set':{'value':_0x1dc2c0+0x1}}),_0x450de8[_0x36690c(0x12b)](_0x36690c(0x190)+(_0x198dd2+0x1));}const _0x3d9738=_0x17caf2[_0x36690c(0x1ce)][0x0],_0x38e421=_['pick'](_0x17caf2,_0x2008fa['ZhNJn'],_0x36690c(0xf5),_0x36690c(0x125));_0x38e421[_0x36690c(0x126)]=_0x3d9738['id'],_0x38e421[_0x36690c(0xe4)]=_0x3d9738[_0x36690c(0xe4)],_['extend'](_0x38e421,_['pick'](_0x3d9738,_0x2008fa['hueZu'])),_0x38e421[_0x36690c(0xe4)][_0x36690c(0x149)]=Object[_0x36690c(0x173)](_0x3d9738[_0x36690c(0x149)])[0x0],_0x38e421['stagedServices']=_[_0x36690c(0x165)](_0x17caf2[_0x36690c(0xd5)],_0x2008fa[_0x36690c(0x192)]);if(_0x3d9738[_0x36690c(0x149)][_0x36690c(0x140)])_0x38e421[_0x36690c(0x198)]['dev']=_0x3d9738['service']['dev'];else _0x3d9738[_0x36690c(0x149)]['email']&&(_0x38e421[_0x36690c(0x198)]['email']=_0x3d9738[_0x36690c(0x149)][_0x36690c(0xe7)]);const _0x907c86=_[_0x36690c(0x1d5)](_0x17caf2,'_id',_0x2008fa[_0x36690c(0x124)],_0x2008fa[_0x36690c(0x144)],_0x36690c(0x125),_0x2008fa[_0x36690c(0x162)],_0x2008fa[_0x36690c(0xd8)],_0x36690c(0x142),'signupEmail',_0x36690c(0xeb),_0x2008fa[_0x36690c(0x14c)],_0x36690c(0x1b0),_0x2008fa[_0x36690c(0x17b)],_0x2008fa['owSQs'],_0x36690c(0x13c),_0x2008fa[_0x36690c(0x1e9)]);_0x907c86[_0x36690c(0x1c8)]=[_[_0x36690c(0x1d5)](_0x3d9738,'id')],_0x907c86[_0x36690c(0x1e8)]=[],_0x17caf2['services']&&_0x17caf2[_0x36690c(0xd5)][_0x36690c(0x11d)]&&(_0x36690c(0x130)!==_0x2008fa[_0x36690c(0x17d)]?_0x907c86[_0x36690c(0xd5)]={'resume':_0x17caf2[_0x36690c(0xd5)][_0x36690c(0x11d)]}:(_0x1a727a['notifications'][_0x36690c(0x11b)]({'admin.type':_0x2008fa[_0x36690c(0xd9)]}),_0xf64d49[_0x36690c(0x14e)][_0x36690c(0x11b)]({'admin.type':_0x36690c(0xdb)}))),_0x907c86['stashedOldUser']=_0x17caf2,_0x2a901f['collections']['apiTokens'][_0x36690c(0x174)]({'identityId':_0x38e421[_0x36690c(0x126)]},{'$set':{'accountId':_0x17caf2[_0x36690c(0x126)]}},{'multi':!![]}),_0x2a901f[_0x36690c(0x19b)][_0x36690c(0x17a)]['upsert']({'_id':_0x38e421['_id']},_0x38e421),_0x2a901f[_0x36690c(0x19b)][_0x36690c(0x17a)][_0x36690c(0x174)]({'_id':_0x17caf2['_id']},_0x907c86);}),_0x2a901f[_0x4a7076(0x19b)]['users'][_0x4a7076(0xcd)]({'stagedServices':{'$exists':!![]}})[_0x4a7076(0x134)](function(_0x117dd3){const _0x322f58=_0x4a7076;_0x2a901f[_0x322f58(0x19b)][_0x322f58(0x17a)][_0x322f58(0x174)]({'_id':_0x117dd3['_id']},{'$unset':{'stagedServices':0x1},'$set':{'services':_0x117dd3['stagedServices']}});});},populateContactsFromApiTokens=function(_0x1ded2b,_0x1fffb5){const _0xd6fffd=_0x547528;_0x1ded2b[_0xd6fffd(0x19b)][_0xd6fffd(0x12d)][_0xd6fffd(0xcd)]({'owner.user.identityId':{'$exists':0x1},'accountId':{'$exists':0x1}})[_0xd6fffd(0x134)](function(_0x1e0b35){const _0x4b00ec=_0xd6fffd,_0x2756fb=_0x1e0b35[_0x4b00ec(0x1cf)][_0x4b00ec(0x1b4)][_0x4b00ec(0x160)],_0x2d4d16=_0x1ded2b['getIdentity'](_0x2756fb);if(_0x2d4d16){const _0x13c9f4=_0x2d4d16[_0x4b00ec(0xe4)];_0x1ded2b[_0x4b00ec(0x19b)][_0x4b00ec(0x195)]['upsert']({'ownerId':_0x1e0b35[_0x4b00ec(0xd7)],'identityId':_0x2756fb},{'ownerId':_0x1e0b35['accountId'],'petname':_0x13c9f4&&_0x13c9f4[_0x4b00ec(0xe0)],'created':new Date(),'identityId':_0x2756fb,'profile':_0x13c9f4});}});},cleanUpApiTokens=function(_0x585414,_0x3e4097){const _0x2a5149=_0x547528,_0x505d14={'StBUe':_0x2a5149(0xf6)};_0x585414['collections'][_0x2a5149(0x12d)][_0x2a5149(0x11b)]({'userId':{'$exists':!![]},'identityId':{'$exists':![]}}),_0x585414['collections'][_0x2a5149(0x12d)][_0x2a5149(0x11b)]({'owner.user.userId':{'$exists':!![]},'owner.user.identityId':{'$exists':![]}}),_0x585414[_0x2a5149(0x19b)][_0x2a5149(0x12d)][_0x2a5149(0xcd)]({'owner.user.denormalizedGrainMetadata.appIcon':{'$exists':!![]}})['forEach'](function(_0x1ec535){const _0x252f37=_0x2a5149,_0x2ee6f9=_0x1ec535[_0x252f37(0x1cf)][_0x252f37(0x1b4)][_0x252f37(0xec)]['appIcon'];_0x585414[_0x252f37(0x19b)][_0x252f37(0x12d)]['update']({'_id':_0x1ec535[_0x252f37(0x126)]},{'$set':{'owner.user.denormalizedGrainMetadata.icon':_0x2ee6f9},'$unset':{'owner.user.denormalizedGrainMetadata.appIcon':!![]}});});function _0x477e83(_0x1d7747){const _0x4b4455=_0x2a5149,_0x29cfef={'WtzgN':_0x505d14['StBUe']};_0x585414['collections'][_0x4b4455(0x12d)][_0x4b4455(0xcd)]({'parentToken':_0x1d7747['_id'],'grainId':{'$exists':!![]},'identityId':{'$exists':![]}})['forEach'](function(_0x21d70d){const _0x590261=_0x4b4455;_0x29cfef[_0x590261(0x104)]===_0x29cfef[_0x590261(0x104)]?(_0x585414['collections'][_0x590261(0x12d)][_0x590261(0x174)]({'_id':_0x21d70d[_0x590261(0x126)]},{'$set':{'identityId':_0x1d7747[_0x590261(0x160)]}}),_0x477e83(_0x21d70d)):_0x1474e2=_0x23bdc5&&_0x16e024['parse'](_0x117fc5);});}_0x585414[_0x2a5149(0x19b)]['apiTokens'][_0x2a5149(0xcd)]({'grainId':{'$exists':!![]},'identityId':{'$exists':!![]},'parentToken':{'$exists':![]}})['forEach'](_0x477e83);},initServerTitleAndReturnAddress=function(_0x56961d,_0x114f73){const _0x4bddac=_0x547528,_0xc125b9={'tyIKU':function(_0x35a2dd,_0x4a454b){return _0x35a2dd+_0x4a454b;}},_0x4bdf5e=Url[_0x4bddac(0x100)](process[_0x4bddac(0x187)]['ROOT_URL'])[_0x4bddac(0x17c)];_0x56961d[_0x4bddac(0x19b)][_0x4bddac(0x1a1)][_0x4bddac(0x1d4)]({'_id':_0x4bddac(0xf1),'value':_0x4bdf5e}),_0x56961d[_0x4bddac(0x19b)][_0x4bddac(0x1a1)][_0x4bddac(0x1d4)]({'_id':'returnAddress','value':_0xc125b9[_0x4bddac(0x108)](_0x4bddac(0x1a0),_0x4bdf5e)});},sendReferralNotifications=function(_0x17e7d3,_0x3b488d){const _0x2e0f40=_0x547528;_0x17e7d3[_0x2e0f40(0x10b)]()&&_0x17e7d3[_0x2e0f40(0x19b)][_0x2e0f40(0x17a)][_0x2e0f40(0xcd)]({'loginIdentities':{'$exists':!![]},'expires':{'$exists':![]}},{'fields':{'_id':0x1}})[_0x2e0f40(0x134)](function(_0xbc64eb){const _0x46cb70=_0x2e0f40;_0x17e7d3[_0x46cb70(0x1d6)](_0xbc64eb[_0x46cb70(0x126)]);});},assignBonuses=function(_0x19903b,_0x501450){},splitSmtpUrl=function(_0x40117d,_0x5d71d5){const _0x16b076=_0x547528,_0x4518cf={'ELnxm':function(_0x1c26e6,_0x5ba48c){return _0x1c26e6!==_0x5ba48c;},'kGwIU':_0x16b076(0xe9),'jFSrY':_0x16b076(0x166),'AUVlt':_0x16b076(0x111),'szSMz':_0x16b076(0x1ba)},_0x1489df=_0x40117d[_0x16b076(0x19b)]['settings'][_0x16b076(0x1a3)]({'_id':'smtpUrl'}),_0x3ddb12=_0x1489df?_0x1489df[_0x16b076(0x196)]:process['env']['MAIL_URL'],_0x5884b7=_0x40117d[_0x16b076(0x19b)][_0x16b076(0x1a1)][_0x16b076(0x1a3)]({'_id':_0x16b076(0x111)}),_0x2432d2={'hostname':'localhost','port':'25','auth':undefined,'returnAddress':_0x5884b7[_0x16b076(0x196)]};let _0x49382e;try{_0x49382e=_0x3ddb12&&Url['parse'](_0x3ddb12);}catch(_0x5ec7c5){}if(_0x49382e){let _0x4bc828=undefined;if(_0x49382e[_0x16b076(0x159)]){const _0x5edd5e=_0x49382e['auth'][_0x16b076(0x1af)](':');let _0x4b14a3=undefined,_0x395868=undefined;_0x4518cf['ELnxm'](_0x5edd5e,-0x1)&&(_0x4b14a3=_0x49382e[_0x16b076(0x159)][_0x16b076(0x1b3)](0x0,_0x5edd5e),_0x395868=_0x49382e[_0x16b076(0x159)][_0x16b076(0x1b3)](_0x5edd5e+0x1)),_0x4bc828={'user':_0x4b14a3,'pass':_0x395868};}_0x2432d2[_0x16b076(0x17c)]=_0x49382e[_0x16b076(0x17c)]||_0x4518cf[_0x16b076(0x132)],_0x2432d2[_0x16b076(0x181)]=_0x49382e[_0x16b076(0x181)]||'25',_0x2432d2[_0x16b076(0x159)]=_0x4bc828;}_0x40117d[_0x16b076(0x19b)][_0x16b076(0x1a1)][_0x16b076(0x1b5)]({'_id':_0x4518cf[_0x16b076(0x164)]},{'value':_0x2432d2}),_0x40117d[_0x16b076(0x19b)][_0x16b076(0x1a1)][_0x16b076(0x11b)]({'_id':_0x4518cf[_0x16b076(0xea)]}),_0x40117d[_0x16b076(0x19b)][_0x16b076(0x1a1)][_0x16b076(0x11b)]({'_id':_0x4518cf['szSMz']});},smtpPortShouldBeNumber=function(_0x308095,_0x519a75){const _0x4aa54c=_0x547528,_0x1de465={'anDWt':_0x4aa54c(0x166)},_0x5a01ed=_0x308095[_0x4aa54c(0x19b)]['settings']['findOne']({'_id':'smtpConfig'});if(_0x5a01ed){const _0x4250a0=_0x5a01ed['value'];_0x4250a0[_0x4aa54c(0x181)]&&(_0x4250a0[_0x4aa54c(0x181)]=_[_0x4aa54c(0x14a)](_0x4250a0[_0x4aa54c(0x181)])?_0x4250a0[_0x4aa54c(0x181)]:parseInt(_0x4250a0[_0x4aa54c(0x181)]),_0x308095[_0x4aa54c(0x19b)][_0x4aa54c(0x1a1)]['upsert']({'_id':_0x1de465[_0x4aa54c(0x1da)]},{'value':_0x4250a0}));}},consolidateOrgSettings=function(_0x1f8ae2,_0x455737){const _0x56169b=_0x547528,_0x4d20e8={'WJTNi':_0x56169b(0x127),'FPodK':_0x56169b(0x139),'HsLIz':_0x56169b(0x1a5),'Dnmmu':_0x56169b(0x121)},_0x295550=_0x1f8ae2[_0x56169b(0x19b)][_0x56169b(0x1a1)],_0x5cba90=_0x295550['findOne']({'_id':_0x4d20e8['WJTNi']}),_0x5dddf0=_0x295550[_0x56169b(0x1a3)]({'_id':_0x4d20e8[_0x56169b(0xf2)]}),_0x553e91=_0x295550[_0x56169b(0x1a3)]({'_id':_0x4d20e8[_0x56169b(0xda)]}),_0xb5350e=_0x295550[_0x56169b(0x1a3)]({'_id':_0x56169b(0x121)}),_0x507434={'google':{'enabled':_0x5cba90?!!_0x5cba90[_0x56169b(0x196)]:![],'domain':_0x5cba90?_0x5cba90[_0x56169b(0x196)]:''},'email':{'enabled':_0x5dddf0?!!_0x5dddf0['value']:![],'domain':_0x5dddf0?_0x5dddf0[_0x56169b(0x196)]:''},'ldap':{'enabled':_0x553e91?_0x553e91[_0x56169b(0x196)]:![]},'saml':{'enabled':_0xb5350e?_0xb5350e[_0x56169b(0x196)]:![]}};_0x295550['upsert']({'_id':_0x56169b(0x12a)},{'value':_0x507434}),_0x295550[_0x56169b(0x11b)]({'_id':_0x56169b(0x127)}),_0x295550['remove']({'_id':'organizationEmail'}),_0x295550['remove']({'_id':_0x4d20e8[_0x56169b(0xda)]}),_0x295550[_0x56169b(0x11b)]({'_id':_0x4d20e8[_0x56169b(0x194)]});},unsetSmtpDefaultHostnameIfNoUsersExist=function(_0x4c8d18,_0x539057){const _0x23eae0=_0x547528,_0x1e10b3={'qYvZb':_0x23eae0(0x166),'AKjct':function(_0x562466,_0x373a19){return _0x562466===_0x373a19;},'gEBrW':_0x23eae0(0xe9)},_0x84e88a=_0x4c8d18[_0x23eae0(0x19b)][_0x23eae0(0x17a)][_0x23eae0(0x1a3)]();if(!_0x84e88a){const _0x3708fc=_0x4c8d18[_0x23eae0(0x19b)][_0x23eae0(0x1a1)][_0x23eae0(0x1a3)]({'_id':_0x1e10b3[_0x23eae0(0x170)]}),_0x27c023=_0x3708fc[_0x23eae0(0x196)];_0x1e10b3[_0x23eae0(0x1db)](_0x27c023['hostname'],_0x1e10b3['gEBrW'])&&(_0x27c023['hostname']='',_0x4c8d18[_0x23eae0(0x19b)][_0x23eae0(0x1a1)][_0x23eae0(0x1b5)]({'_id':_0x23eae0(0x166)},{'value':_0x27c023}));}},extractLastUsedFromApiTokenOwner=function(_0x3ff99a,_0xab91d9){const _0xc2ada6=_0x547528;_0x3ff99a[_0xc2ada6(0x19b)][_0xc2ada6(0x12d)][_0xc2ada6(0xcd)]({'owner.user':{'$exists':!![]}})['forEach'](function(_0x22f085){const _0x423037=_0xc2ada6;if(_0x423037(0xe1)===_0x423037(0xe1)){const _0x56ebdd=_0x22f085[_0x423037(0x1cf)][_0x423037(0x1b4)]['lastUsed'];_0x3ff99a[_0x423037(0x19b)][_0x423037(0x12d)][_0x423037(0x174)]({'_id':_0x22f085[_0x423037(0x126)]},{'$set':{'lastUsed':_0x56ebdd},'$unset':{'owner.user.lastUsed':!![]}});}else _0x159228[_0x423037(0x107)]=_0x48aa87;});},setUpstreamTitles=function(_0x41127b,_0x2e321b){const _0x23643e=_0x547528,_0xc99cea={'HNUoF':_0x23643e(0x122),'anpmG':function(_0x521ffa,_0x3ca0e0){return _0x521ffa+_0x3ca0e0;},'BDrxJ':_0x23643e(0x120)},_0x3b443f=_0x41127b[_0x23643e(0x19b)]['apiTokens']['rawCollection'](),_0x5a1eae=Meteor[_0x23643e(0x16a)](_0x3b443f['aggregate'],_0x3b443f),_0x4e91b2=_0x5a1eae([{'$match':{'owner.user':{'$exists':!![]},'grainId':{'$exists':!![]}}},{'$group':{'_id':_0x23643e(0x13d)}}])[_0x23643e(0x14b)](_0x25079f=>_0x25079f[_0x23643e(0x126)]);let _0x5bad84=0x0;_0x41127b[_0x23643e(0x19b)]['grains']['find']({'_id':{'$in':_0x4e91b2}},{'fields':{'title':0x1}})['forEach'](_0x2a4aea=>{const _0x31cdfc=_0x23643e,_0x1e20c6={'ULdts':_0x31cdfc(0x16b)};_0x5bad84%0x64==0x0&&(_0xc99cea['HNUoF']===_0xc99cea[_0x31cdfc(0x167)]?console[_0x31cdfc(0x12b)](_0xc99cea[_0x31cdfc(0x103)](_0x5bad84+_0xc99cea[_0x31cdfc(0x154)],_0x4e91b2[_0x31cdfc(0x129)])):_0x6d3cee[_0x31cdfc(0x196)]&&(_0x1eab4d['log'](_0x1e20c6[_0x31cdfc(0x182)]),_0x49c48c['return']())),++_0x5bad84,_0x41127b[_0x31cdfc(0x19b)]['apiTokens'][_0x31cdfc(0x174)]({'grainId':_0x2a4aea[_0x31cdfc(0x126)],'owner.user.title':{'$exists':!![],'$ne':_0x2a4aea[_0x31cdfc(0xd0)]}},{'$set':{'owner.user.upstreamTitle':_0x2a4aea['title']}},{'multi':!![]});});},markAllRead=function(_0x942622,_0x3148ea){const _0x480c58=_0x547528;_0x942622[_0x480c58(0x19b)]['grains'][_0x480c58(0x174)]({},{'$set':{'ownerSeenAllActivity':!![]}},{'multi':!![]}),_0x942622[_0x480c58(0x19b)]['apiTokens']['update']({'owner.user':{'$exists':!![]}},{'$set':{'owner.user.seenAllActivity':!![]}},{'multi':!![]});},clearAppIndex=function(_0xf4fcc5,_0x5d73b2){const _0x467bea=_0x547528;_0xf4fcc5[_0x467bea(0x19b)][_0x467bea(0x1bc)]['remove']({});},assignEmailVerifierIds=function(_0x572765,_0x2b00b7){const _0x50cdee=_0x547528;_0x572765[_0x50cdee(0x19b)][_0x50cdee(0x12d)][_0x50cdee(0xcd)]({'frontendRef.emailVerifier':{'$exists':!![]}})[_0x50cdee(0x134)](_0xd57156=>{const _0x10e124=_0x50cdee;_0x572765[_0x10e124(0x19b)][_0x10e124(0x12d)][_0x10e124(0x174)](_0xd57156[_0x10e124(0x126)],{'$set':{'frontendRef.emailVerifier.id':_0xd57156[_0x10e124(0x126)]}});});},startPreinstallingApps=function(_0x37198b,_0x5da2cd){const _0x24e0b7=_0x547528,_0x4fdbf4={'bbYnk':function(_0x5b5162,_0x14beca){return _0x5b5162===_0x14beca;},'PcAjg':'wpfGR'},_0x2e10ea=function(){const _0x584edd=_0x5e9f;if(_0x4fdbf4[_0x584edd(0x1c1)](_0x4fdbf4[_0x584edd(0x1eb)],_0x4fdbf4[_0x584edd(0x1eb)])){_0x37198b[_0x584edd(0xde)]();const _0x3f8806=_0x37198b[_0x584edd(0x19b)][_0x584edd(0x1bc)]['find']({'_id':{'$in':_0x37198b[_0x584edd(0x1ea)]()['concat'](_0x37198b[_0x584edd(0x116)]())}})[_0x584edd(0x1d0)](),_0x52a0a1=_[_0x584edd(0x14b)](_0x3f8806,_0x4537f0=>{const _0xdf5e8e=_0x584edd;return{'appId':_0x4537f0[_0xdf5e8e(0x10d)],'packageId':_0x4537f0[_0xdf5e8e(0x186)]};});_0x37198b['setPreinstalledApps'](_0x52a0a1);}else _0x346de6[_0x584edd(0x1be)](_0x125e33[_0x584edd(0xe3)]);};!Meteor[_0x24e0b7(0x1a1)][_0x24e0b7(0x106)][_0x24e0b7(0x191)]&&!_0x37198b[_0x24e0b7(0x1ca)]()&&Meteor[_0x24e0b7(0x13e)](_0x2e10ea,0x0);},setNewServer=function(_0x541174,_0xd8b083){const _0x229c0c=_0x547528,_0x219461={'mjMvH':_0x229c0c(0x112)};!_0x541174[_0x229c0c(0x19b)][_0x229c0c(0x1c4)][_0x229c0c(0x1a3)]({'_id':_0x219461[_0x229c0c(0x1c0)]})&&_0x541174[_0x229c0c(0x19b)][_0x229c0c(0x1c4)][_0x229c0c(0x1d4)]({'_id':_0x219461[_0x229c0c(0x1c0)],'value':!![]});},addMembraneRequirementsToIdentities=function(_0x1915f5,_0x523c81){const _0x503766=_0x547528,_0x518889={'frontendRef.identity':{'$exists':!![]},'owner.grain.grainId':{'$exists':!![]},'requirements.0':{'$exists':![]}};_0x1915f5[_0x503766(0x19b)][_0x503766(0x12d)]['find'](_0x518889)[_0x503766(0x14b)](_0x46633e=>{const _0x58af14=_0x503766;_0x1915f5[_0x58af14(0x19b)][_0x58af14(0x12d)][_0x58af14(0x174)]({'_id':_0x46633e['_id']},{'$push':{'requirements':{'permissionsHeld':{'grainId':_0x46633e['owner']['grain'][_0x58af14(0x12e)],'identityId':_0x46633e[_0x58af14(0x1e2)]['identity'],'permissions':[]}}}});});},addEncryptionToFrontendRefIpNetwork=function(_0x976371,_0x5dfcd5){const _0x46aa36=_0x547528;_0x976371[_0x46aa36(0x19b)][_0x46aa36(0x12d)][_0x46aa36(0xcd)]({'frontendRef.ipNetwork':!![]})[_0x46aa36(0x14b)](_0x3d445f=>{const _0x1cf684=_0x46aa36;_0x976371[_0x1cf684(0x19b)][_0x1cf684(0x12d)][_0x1cf684(0x174)]({'_id':_0x3d445f[_0x1cf684(0x126)]},{'$set':{'frontendRef.ipNetwork':{'encryption':{'none':null}}}});});};function backgroundFillInGrainSizes(_0x153e24,_0x591bed){const _0xeb9842=_0x547528,_0x184a1c={'CKLSM':function(_0x146792,_0x2a5779){return _0x146792===_0x2a5779;},'dIJNp':_0xeb9842(0x1c5)};try{const _0x38630c=_0x153e24[_0xeb9842(0x19b)][_0xeb9842(0xd2)][_0xeb9842(0x1a3)]({'size':{'$exists':![]}},{'fields':{'_id':0x1,'userId':0x1}});if(_0x38630c){try{const _0x3edb96=waitPromise(_0x591bed[_0xeb9842(0xf3)]()[_0xeb9842(0xf9)](_0x38630c['userId'],_0x38630c[_0xeb9842(0x126)]));_0x153e24[_0xeb9842(0x19b)][_0xeb9842(0xd2)][_0xeb9842(0x174)]({'_id':_0x38630c[_0xeb9842(0x126)],'size':{'$exists':![]}},{'$set':{'size':parseInt(_0x3edb96[_0xeb9842(0x151)])}});}catch(_0x7bb748){if(_0x184a1c['CKLSM'](_0x7bb748[_0xeb9842(0x1ad)],_0x184a1c[_0xeb9842(0x131)]))console[_0xeb9842(0x1be)]('Error\x20while\x20backfilling\x20grain\x20size\x20for',_0x38630c[_0xeb9842(0x126)],':',_0x7bb748[_0xeb9842(0xe3)]),_0x153e24[_0xeb9842(0x19b)]['grains'][_0xeb9842(0x174)]({'_id':_0x38630c[_0xeb9842(0x126)],'size':{'$exists':![]}},{'$set':{'size':0x0}});else throw _0x7bb748;}Meteor[_0xeb9842(0x13e)](backgroundFillInGrainSizes['bind'](this,_0x153e24,_0x591bed),0x3e8);}}catch(_0x1c0778){console[_0xeb9842(0x1be)]('Error\x20while\x20backfilling\x20grain\x20sizes:',_0x1c0778[_0xeb9842(0xe3)]);}}function removeFeatureKeys(_0x21d2c6,_0x35f44f){const _0x12b4cb=_0x547528,_0x5a0368={'MzNco':'cantRenewFeatureKey','uRIaZ':_0x12b4cb(0xdb)};_0x21d2c6['notifications'][_0x12b4cb(0x11b)]({'admin.type':_0x5a0368[_0x12b4cb(0x14d)]}),_0x21d2c6[_0x12b4cb(0x14e)][_0x12b4cb(0x11b)]({'admin.type':_0x5a0368['uRIaZ']});}function setIpBlacklist(_0x3cf978,_0x266b27){const _0x549e64=_0x547528,_0x3b219f={'NobXz':_0x549e64(0x1ee),'BJRCK':_0x549e64(0x1d9)};if(Meteor[_0x549e64(0x1a1)]['public']['isTesting'])_0x3cf978[_0x549e64(0x19b)][_0x549e64(0x1a1)][_0x549e64(0x1d4)]({'_id':'ipBlacklist','value':'192.168.0.0/16'});else{if(_0x3b219f['NobXz']===_0x3b219f['BJRCK'])_0x4b0a16['log'](_0x549e64(0x16b)),_0x34fe41[_0x549e64(0x115)]();else{const _0x524b5f=PRIVATE_IPV4_ADDRESSES[_0x549e64(0xd6)](PRIVATE_IPV6_ADDRESSES)['join']('\x0a');_0x3cf978[_0x549e64(0x19b)][_0x549e64(0x1a1)][_0x549e64(0x1d4)]({'_id':_0x549e64(0x1b8),'value':_0x524b5f});}}}const MIGRATIONS=[updateLoginStyleToRedirect,enableLegacyOAuthProvidersIfNotInSettings,denormalizeInviteInfo,mergeRoleAssignmentsIntoApiTokens,fixOasisStorageUsageStats,fetchProfilePictures,assignPlans,removeKeyrings,useLocalizedTextInUserActions,verifyAllPgpSignatures,splitUserIdsIntoAccountIdsAndIdentityIds,appUpdateSettings,moveDevAndEmailLoginDataIntoIdentities,repairEmailIdentityIds,splitAccountUsersAndIdentityUsers,populateContactsFromApiTokens,cleanUpApiTokens,initServerTitleAndReturnAddress,sendReferralNotifications,assignBonuses,splitSmtpUrl,smtpPortShouldBeNumber,consolidateOrgSettings,unsetSmtpDefaultHostnameIfNoUsersExist,extractLastUsedFromApiTokenOwner,setUpstreamTitles,markAllRead,clearAppIndex,assignEmailVerifierIds,setNewServer,addMembraneRequirementsToIdentities,addEncryptionToFrontendRefIpNetwork,setIpBlacklist],NEW_SERVER_STARTUP=[startPreinstallingApps],migrateToLatest=function(_0x40f9d9,_0x1a0e8c){const _0x4fd8c6=_0x547528,_0x28577b={'hsivx':function(_0x1b83d0,_0x22be10){return _0x1b83d0+_0x22be10;},'oWbdC':_0x4fd8c6(0x147),'HJYSM':function(_0x228ac2,_0x408072){return _0x228ac2>=_0x408072;},'bDGmM':function(_0x505dd2,_0x226eb5){return _0x505dd2===_0x226eb5;},'skRrN':_0x4fd8c6(0x15f),'JbFDd':_0x4fd8c6(0x16b),'mpTsk':'Waiting\x20for\x20migrations\x20on\x20replica\x20zero...','DCvlh':_0x4fd8c6(0x16e),'Veyff':_0x4fd8c6(0x1bf),'bcdGH':function(_0x44386a,_0x3cfc73){return _0x44386a+_0x3cfc73;},'tcKfO':_0x4fd8c6(0x11c),'nhhCy':function(_0x3c9329,_0x4fbbfc){return _0x3c9329+_0x4fbbfc;},'BNCEc':function(_0x5d6417,_0x4fc621){return _0x5d6417+_0x4fc621;},'qGLHQ':_0x4fd8c6(0x190),'snbUu':function(_0x5e6b69,_0x37bab1){return _0x5e6b69+_0x37bab1;},'LxZMh':'new_server_migrations_applied','USfpw':function(_0xe1f9ea,_0x1bbe82){return _0xe1f9ea<_0x1bbe82;},'gNLTd':function(_0x345c8a,_0x57bbf1,_0x217a95){return _0x345c8a(_0x57bbf1,_0x217a95);}};if(Meteor[_0x4fd8c6(0x1a1)]['replicaNumber']){console[_0x4fd8c6(0x12b)](_0x28577b[_0x4fd8c6(0x12f)]);const _0x216d10=new Future(),_0x3d54c4=function(_0x2f11ce){const _0xbb4d50=_0x4fd8c6;console[_0xbb4d50(0x12b)](_0x28577b[_0xbb4d50(0x1ac)](_0x28577b[_0xbb4d50(0xee)],_0x2f11ce[_0xbb4d50(0x196)])+'/'+MIGRATIONS[_0xbb4d50(0x129)]);if(_0x28577b[_0xbb4d50(0x1dd)](_0x2f11ce[_0xbb4d50(0x196)],MIGRATIONS['length']))_0x216d10[_0xbb4d50(0x115)]();},_0x2fc31f=_0x40f9d9['collections'][_0x4fd8c6(0x1c4)][_0x4fd8c6(0xcd)]({'_id':_0x28577b[_0x4fd8c6(0x117)]})[_0x4fd8c6(0x1b9)]({'added':_0x3d54c4,'changed':_0x3d54c4}),_0x105884=new Future(),_0x4a0ab7=function(_0x5c8e7a){const _0x2a8a0c=_0x4fd8c6;_0x28577b[_0x2a8a0c(0x16d)](_0x2a8a0c(0x15f),_0x28577b[_0x2a8a0c(0x158)])?_0x5c8e7a[_0x2a8a0c(0x196)]&&(console[_0x2a8a0c(0x12b)](_0x28577b[_0x2a8a0c(0x157)]),_0x105884[_0x2a8a0c(0x115)]()):_0x240ba7['unverifiedEmail']=_0x554d3f['profile'][_0x2a8a0c(0xe7)];},_0x7f250c=_0x40f9d9[_0x4fd8c6(0x19b)][_0x4fd8c6(0x1c4)][_0x4fd8c6(0xcd)]({'_id':_0x4fd8c6(0x112)})[_0x4fd8c6(0x1b9)]({'added':_0x4a0ab7,'changed':_0x4a0ab7});_0x216d10[_0x4fd8c6(0x1de)](),_0x2fc31f[_0x4fd8c6(0x156)](),_0x105884[_0x4fd8c6(0x1de)](),_0x7f250c[_0x4fd8c6(0x156)](),console[_0x4fd8c6(0x12b)](_0x28577b['Veyff']);}else{const _0x5a9841=_0x40f9d9[_0x4fd8c6(0x19b)]['migrations'][_0x4fd8c6(0x1a3)]({'_id':_0x28577b[_0x4fd8c6(0x117)]});let _0x491485;!_0x5a9841?(_0x40f9d9[_0x4fd8c6(0x19b)][_0x4fd8c6(0x1c4)]['insert']({'_id':_0x28577b[_0x4fd8c6(0x117)],'value':0x0}),_0x491485=0x0,_0x40f9d9[_0x4fd8c6(0x19b)][_0x4fd8c6(0x1c4)]['insert']({'_id':'new_server_migrations_applied','value':![]})):_0x491485=_0x5a9841[_0x4fd8c6(0x196)];console[_0x4fd8c6(0x12b)](_0x28577b[_0x4fd8c6(0x1ac)](_0x28577b[_0x4fd8c6(0x185)](_0x28577b['tcKfO'],_0x491485),'/')+MIGRATIONS[_0x4fd8c6(0x129)]);for(let _0x3aa762=_0x491485;_0x3aa762<MIGRATIONS[_0x4fd8c6(0x129)];_0x3aa762++){console[_0x4fd8c6(0x12b)](_0x4fd8c6(0x102)+_0x28577b[_0x4fd8c6(0x1c9)](_0x3aa762,0x1)),MIGRATIONS[_0x3aa762](_0x40f9d9,_0x1a0e8c),_0x40f9d9['collections']['migrations'][_0x4fd8c6(0x174)]({'_id':_0x4fd8c6(0x16e)},{'$set':{'value':_0x28577b['BNCEc'](_0x3aa762,0x1)}}),console[_0x4fd8c6(0x12b)](_0x28577b[_0x4fd8c6(0xf0)]+_0x28577b['snbUu'](_0x3aa762,0x1));}if(!_0x40f9d9[_0x4fd8c6(0x19b)][_0x4fd8c6(0x1c4)][_0x4fd8c6(0x1a3)]({'_id':_0x28577b[_0x4fd8c6(0x10e)]})[_0x4fd8c6(0x196)]){for(let _0x9d1f07=0x0;_0x28577b[_0x4fd8c6(0x189)](_0x9d1f07,NEW_SERVER_STARTUP['length']);_0x9d1f07++){console['log'](_0x28577b[_0x4fd8c6(0x1ac)](_0x4fd8c6(0xdf),_0x9d1f07+0x1)),NEW_SERVER_STARTUP[_0x9d1f07](_0x40f9d9,_0x1a0e8c),console[_0x4fd8c6(0x12b)](_0x4fd8c6(0xdf)+(_0x9d1f07+0x1));}_0x40f9d9[_0x4fd8c6(0x19b)]['migrations']['update']({'_id':_0x28577b['LxZMh']},{'$set':{'value':!![]}});}_0x28577b[_0x4fd8c6(0x18e)](backgroundFillInGrainSizes,_0x40f9d9,_0x1a0e8c);}};export{migrateToLatest};