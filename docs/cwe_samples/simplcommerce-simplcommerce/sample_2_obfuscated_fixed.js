const _0x5dafef=_0x58f0;(function(_0x3e2935,_0xdaef83){const _0x293724=_0x58f0,_0xb4a0af=_0x3e2935();while(!![]){try{const _0x77d360=-parseInt(_0x293724(0x150))/0x1*(-parseInt(_0x293724(0x11e))/0x2)+-parseInt(_0x293724(0x18e))/0x3*(-parseInt(_0x293724(0x152))/0x4)+-parseInt(_0x293724(0x16f))/0x5+-parseInt(_0x293724(0x10d))/0x6+-parseInt(_0x293724(0x10f))/0x7*(parseInt(_0x293724(0x184))/0x8)+-parseInt(_0x293724(0x14e))/0x9+-parseInt(_0x293724(0x156))/0xa*(-parseInt(_0x293724(0x12a))/0xb);if(_0x77d360===_0xdaef83)break;else _0xb4a0af['push'](_0xb4a0af['shift']());}catch(_0x20d4c0){_0xb4a0af['push'](_0xb4a0af['shift']());}}}(_0x5a4f,0xb3f2c));const {error_catcher}=require('./utils.js'),Router=require('express-promise-router'),db=require(_0x5dafef(0x16a)),{getState}=require('@saltcorn/data/db/state'),Table=require(_0x5dafef(0x133)),File=require(_0x5dafef(0x176)),{getSafeSaltcornCmd}=require(_0x5dafef(0x118)),{spawn,spawnSync}=require('child_process'),path=require(_0x5dafef(0x15e)),fs=require('fs')[_0x5dafef(0x16c)],router=new Router();function _0x5a4f(){const _0x2c68f9=['stringify','GET\x20/load_changes:\x20The\x20ownership\x20field\x20of\x20\x27','aCshN','POST\x20/load_changes:\x20loadUntil\x20is\x20missing','@saltcorn/data/models/table','POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20finished\x20with\x20code:\x20','push','/sync_timestamp','translated-ids.json','parse','FFVSM','BEGIN','syncFrom','public','default_schema','The\x20table\x20\x27','\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20data_tbl.\x22','oPzRI','POST\x20/sync/deletes:\x20\x27','query','find','max','/clean_sync_dir','oFYmz','exit','qkBLg','iZBnX','--tenantAppName','MUjWp','readFile','readdir','12159873oZFkCR','select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.ref\x20\x22_sync_info_tbl_ref_\x22,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.last_modified\x20\x22_sync_info_tbl_last_modified_\x22,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.deleted\x20\x22_sync_info_tbl_deleted_\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20data_tbl.*\x0a\x20\x20\x20\x20\x20\x20\x20from\x20','431438EmZcCX','\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20info_tbl.ref','4QTpgKp','\x22\x20=\x20','GXslR','falib','1248080NUdtvN','error.json','yzZmN','/deletes','rows','sqlsanitize','DHweX','time','path','NiJcN','body','ROLLBACK','GET\x20/sync/upload_finished:\x20\x27','is_it_multi_tenant','release','getTenantSchema','sync','--directory','writeFile','netSv','@saltcorn/data/db','ezdwV','promises','LQVyh','get','5352375GMbpRR','syncInfos\x20is\x20missing','YzGZb','POST\x20/sync/offline_changes:\x20\x27','last_modified','SepeA','\x22\x20\x22data_tbl\x22\x0a\x20\x20\x20\x20\x20\x20on\x20info_tbl.ref\x20=\x20data_tbl.\x22','@saltcorn/data/models/file',')\x20\x0a\x20\x20\x20\x20\x20\x20and\x20date_trunc(\x27milliseconds\x27,\x20info_tbl.last_modified)\x20<\x20to_timestamp(','mkdir','_sync_info_tbl_last_modified_','loadUntil\x20is\x20missing','json','normalize','--userEmail','post','rootFolder','\x27\x20does\x20not\x20exist.','\x22\x20and\x20info_tbl.deleted\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20where\x20data_tbl.\x22','POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20failed:\x20','deletes','129040eluoGS','AYDVU','is_owner','mobile_app','\x0a\x20\x20\x20\x20\x20\x20','JUlTA','--syncTimestamp','length','bWAYl','getTenantSchemaPrefix','2608206fJLlIk','_sync_info\x22\x20\x22info_tbl\x22\x20join\x20','dejKZ','\x22\x20>\x20','join','kvBSI','name','status','yPvyY','entries','pipe','ownership_formula','/load_changes','FNrKH','PKvtm','hCZOa','and\x20data_tbl.\x22','user','maxLoadedId','log','PlOkR',')\x20\x0a\x20\x20\x20\x20\x20\x20and\x20info_tbl.deleted\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20and\x20info_tbl.ref\x20>\x20','VrvsB','exports','8461236LmnvIY','mqbhR','315iAfcth','min_role_read','Atyuu','/offline_changes','POST\x20/sync/clean_sync_dir:\x20\x27','IVLCb','send','vxTFs','RnFtD','@saltcorn/data/utils','GET\x20/sync_timestamp:\x20\x27','LIuMH','message','filter',')\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20and\x20alias.max\x20>\x20to_timestamp(','2vnrlfW','valueOf','aKQpo','role_id','sync-upload-data','getClient','nPCGT','code','email','pk_name','findOne','Ugant','352DODAJg','KDAwD','\x22\x0a\x20\x20\x20\x20\x20\x20where\x20date_trunc(\x27milliseconds\x27,\x20info_tbl.last_modified)\x20>\x20to_timestamp(','error','ownership_field_id'];_0x5a4f=function(){return _0x2c68f9;};return _0x5a4f();}module[_0x5dafef(0x10c)]=router,router[_0x5dafef(0x16e)](_0x5dafef(0x136),error_catcher(async(_0x4423da,_0x1a336d)=>{const _0x1b11e1=_0x5dafef;try{_0x1a336d['json']({'syncTimestamp':(await db[_0x1b11e1(0x15d)]())[_0x1b11e1(0x11f)]()});}catch(_0x138642){getState()[_0x1b11e1(0x108)](0x2,_0x1b11e1(0x119)+_0x138642[_0x1b11e1(0x11b)]+'\x27'),_0x1a336d[_0x1b11e1(0x195)](0x190)[_0x1b11e1(0x17b)]({'error':_0x138642[_0x1b11e1(0x11b)]||_0x138642});}}));const getSyncRows=async(_0xc1a599,_0x39621c,_0x59630b,_0x111cb7,_0x2e2b0e)=>{const _0x2e4a4a=_0x5dafef,_0x7b3d5f={'NiJcN':_0x2e4a4a(0x17a),'VbfiJ':_0x2e4a4a(0x14a),'GXslR':function(_0x5cb30e,_0x12f596){return _0x5cb30e>_0x12f596;},'ljxKF':function(_0x2173e9,_0x284649){return _0x2173e9<_0x284649;},'MUjWp':function(_0x6a2518,_0xe49b3b){return _0x6a2518>_0xe49b3b;},'LIuMH':function(_0x2211f8,_0x5e45e6){return _0x2211f8!==_0x5e45e6;},'aKQpo':_0x2e4a4a(0x114),'sbLuu':function(_0x2646f9){return _0x2646f9();},'VrvsB':function(_0x39832e,_0x288eac){return _0x39832e===_0x288eac;},'aCshN':_0x2e4a4a(0x193),'hCZOa':_0x2e4a4a(0x185),'FNrKH':function(_0x3fac50,_0x3057a0){return _0x3fac50===_0x3057a0;}},_0x372d39=_0x39621c[_0x2e4a4a(0x194)],_0x3b69f1=_0x39621c[_0x2e4a4a(0x127)],_0x4492a8=_0x39621c[_0x2e4a4a(0x110)],_0x476d4f=_0x2e2b0e?.[_0x2e4a4a(0x121)]||0x64;let _0x5f06ae=null;if(_0x7b3d5f[_0x2e4a4a(0x154)](_0x476d4f,_0x4492a8)&&(!_0x39621c[_0x2e4a4a(0x12e)]&&!_0x39621c[_0x2e4a4a(0x199)]||_0x476d4f===0x64))return null;if(_0x2e2b0e?.['id']&&_0x7b3d5f['ljxKF'](_0x476d4f,0x64)&&_0x7b3d5f[_0x2e4a4a(0x14b)](_0x476d4f,_0x4492a8)&&_0x39621c[_0x2e4a4a(0x12e)]){if(_0x7b3d5f['LIuMH'](_0x7b3d5f[_0x2e4a4a(0x120)],'IVLCb'))return _0x2eefba()[_0x2e4a4a(0x108)](0x2,_0x2e4a4a(0x132)),_0x4ee956[_0x2e4a4a(0x195)](0x190)[_0x2e4a4a(0x17b)]({'error':_0x7b3d5f[_0x2e4a4a(0x15f)]});else{const _0x730e03=_0x39621c['getFields']()[_0x2e4a4a(0x143)](_0x17e85b=>_0x17e85b['id']===_0x39621c[_0x2e4a4a(0x12e)]);if(!_0x730e03)return _0x7b3d5f['sbLuu'](getState)['log'](0x5,_0x2e4a4a(0x130)+_0x39621c['name']+_0x2e4a4a(0x180)),null;_0x5f06ae=_0x730e03[_0x2e4a4a(0x194)];}}const _0x20ebc0=db[_0x2e4a4a(0x18d)]();if(!_0xc1a599[_0x2e4a4a(0x13b)]){if(_0x7b3d5f[_0x2e4a4a(0x10b)](_0x7b3d5f[_0x2e4a4a(0x131)],_0x2e4a4a(0x111)))_0x11860f[_0x2e4a4a(0x17b)]({'finished':![]});else{const {rows:_0x582857}=await _0x111cb7[_0x2e4a4a(0x142)](_0x2e4a4a(0x14f)+_0x20ebc0+'\x22'+db['sqlsanitize'](_0x372d39)+'_sync_info\x22\x20\x22info_tbl\x22\x20right\x20join\x20\x22'+db[_0x2e4a4a(0x15b)](_0x372d39)+_0x2e4a4a(0x175)+db[_0x2e4a4a(0x15b)](_0x3b69f1)+_0x2e4a4a(0x181)+db[_0x2e4a4a(0x15b)](_0x3b69f1)+_0x2e4a4a(0x191)+_0xc1a599[_0x2e4a4a(0x107)]+_0x2e4a4a(0x188)+(_0x5f06ae?_0x2e4a4a(0x105)+_0x5f06ae+_0x2e4a4a(0x153)+_0x2e2b0e['id']:'')+_0x2e4a4a(0x13f)+db['sqlsanitize'](_0x3b69f1)+'\x22');for(const _0x1ccbc8 of _0x582857){if(_0x1ccbc8[_0x2e4a4a(0x179)])_0x1ccbc8[_0x2e4a4a(0x179)]=_0x1ccbc8[_0x2e4a4a(0x179)][_0x2e4a4a(0x11f)]();else _0x1ccbc8[_0x2e4a4a(0x179)]=new Date(_0x59630b)[_0x2e4a4a(0x11f)]();_0x1ccbc8['_sync_info_tbl_ref_']=_0x1ccbc8[_0x3b69f1];}return _0x582857;}}else{if(_0x7b3d5f[_0x2e4a4a(0x11a)](_0x2e4a4a(0x185),_0x7b3d5f[_0x2e4a4a(0x104)]))_0x24f14e[_0x2e4a4a(0x135)](_0x7b3d5f['VbfiJ'],_0x1df133[_0x2e4a4a(0x165)]());else{const {rows:_0x1592fd}=await _0x111cb7['query'](_0x2e4a4a(0x14f)+_0x20ebc0+'\x22'+db[_0x2e4a4a(0x15b)](_0x372d39)+_0x2e4a4a(0x18f)+_0x20ebc0+'\x22'+db['sqlsanitize'](_0x372d39)+_0x2e4a4a(0x175)+db[_0x2e4a4a(0x15b)](_0x3b69f1)+_0x2e4a4a(0x12c)+new Date(_0xc1a599[_0x2e4a4a(0x13b)])[_0x2e4a4a(0x11f)]()/0x3e8+_0x2e4a4a(0x177)+new Date(_0x59630b)[_0x2e4a4a(0x11f)]()/0x3e8+_0x2e4a4a(0x10a)+_0xc1a599[_0x2e4a4a(0x107)]+'\x0a\x20\x20\x20\x20\x20\x20'+(_0x5f06ae?'and\x20data_tbl.\x22'+_0x5f06ae+_0x2e4a4a(0x153)+_0x2e2b0e['id']:'')+_0x2e4a4a(0x151));for(const _0x140834 of _0x1592fd){if(_0x7b3d5f[_0x2e4a4a(0x19b)]('LEHDT',_0x2e4a4a(0x155)))_0x4ac4c1[_0x2e4a4a(0x164)](!![]);else{if(_0x140834['_sync_info_tbl_last_modified_'])_0x140834[_0x2e4a4a(0x179)]=_0x140834[_0x2e4a4a(0x179)][_0x2e4a4a(0x11f)]();else _0x140834[_0x2e4a4a(0x179)]=_0x59630b[_0x2e4a4a(0x11f)]();}}return _0x1592fd;}}};router['post'](_0x5dafef(0x19a),error_catcher(async(_0x3edfe9,_0x50526e)=>{const _0x48ba05=_0x5dafef,_0x39dd6d={'QWYac':_0x48ba05(0x17a),'FFVSM':function(_0x45c8ec){return _0x45c8ec();},'VoPWK':_0x48ba05(0x170),'LjQHZ':function(_0x4f3bf0,_0x58d84b){return _0x4f3bf0>_0x58d84b;},'DHweX':function(_0x28c8a7,_0x344c6b){return _0x28c8a7===_0x344c6b;},'ezdwV':function(_0xfc9cb0,_0x4adf74){return _0xfc9cb0>_0x4adf74;},'RnFtD':function(_0x271369,_0x42ce27){return _0x271369-_0x42ce27;},'SepeA':'COMMIT','GykPr':function(_0x483e15){return _0x483e15();}},_0x4a6e72={},{syncInfos:_0x13a016,loadUntil:_0x96fbe1}=_0x3edfe9['body'];if(!_0x96fbe1)return getState()['log'](0x2,_0x48ba05(0x132)),_0x50526e[_0x48ba05(0x195)](0x190)[_0x48ba05(0x17b)]({'error':_0x39dd6d['QWYac']});if(!_0x13a016)return _0x39dd6d[_0x48ba05(0x139)](getState)[_0x48ba05(0x108)](0x2,'POST\x20/load_changes:\x20syncInfos\x20is\x20missing'),_0x50526e['status'](0x190)[_0x48ba05(0x17b)]({'error':_0x39dd6d['VoPWK']});const _0x453158=_0x3edfe9[_0x48ba05(0x106)]?_0x3edfe9[_0x48ba05(0x106)][_0x48ba05(0x121)]:0x64,_0x1a3005=await db[_0x48ba05(0x123)]();let _0x55cd18=0x3e8;try{await _0x1a3005[_0x48ba05(0x142)]('BEGIN');for(const [_0x22c705,_0x18755c]of Object[_0x48ba05(0x197)](_0x13a016)){const _0x10f258=Table[_0x48ba05(0x128)]({'name':_0x22c705});if(!_0x10f258)throw new Error(_0x48ba05(0x13e)+_0x22c705+'\x27\x20does\x20not\x20exists');const _0x291d5f=_0x10f258[_0x48ba05(0x127)];let _0x19837a=await getSyncRows(_0x18755c,_0x10f258,_0x96fbe1,_0x1a3005,_0x3edfe9['user']);if(!_0x19837a)continue;if(_0x39dd6d['LjQHZ'](_0x453158,_0x10f258[_0x48ba05(0x110)])){if(_0x39dd6d[_0x48ba05(0x15c)](_0x453158,0x64)||!_0x10f258[_0x48ba05(0x12e)]&&!_0x10f258['ownership_formula'])continue;else{if(_0x10f258['ownership_field_id']){}else _0x10f258[_0x48ba05(0x199)]&&(_0x19837a=_0x19837a[_0x48ba05(0x11c)](_0x597e5c=>_0x10f258[_0x48ba05(0x186)](_0x3edfe9[_0x48ba05(0x106)],_0x597e5c)));}}_0x39dd6d[_0x48ba05(0x16b)](_0x19837a[_0x48ba05(0x18b)],_0x55cd18)&&_0x19837a['splice'](_0x55cd18),_0x55cd18-=_0x19837a[_0x48ba05(0x18b)],_0x4a6e72[_0x22c705]={'rows':_0x19837a,'maxLoadedId':_0x19837a[_0x48ba05(0x18b)]>0x0?_0x19837a[_0x39dd6d[_0x48ba05(0x117)](_0x19837a[_0x48ba05(0x18b)],0x1)][_0x291d5f]:0x0};}await _0x1a3005[_0x48ba05(0x142)](_0x39dd6d[_0x48ba05(0x174)]),_0x50526e[_0x48ba05(0x17b)](_0x4a6e72);}catch(_0x34a16c){await _0x1a3005[_0x48ba05(0x142)](_0x48ba05(0x161)),_0x39dd6d['GykPr'](getState)[_0x48ba05(0x108)](0x2,'POST\x20/load_changes:\x20\x27'+_0x34a16c[_0x48ba05(0x11b)]+'\x27'),_0x50526e[_0x48ba05(0x195)](0x190)[_0x48ba05(0x17b)]({'error':_0x34a16c['message']||_0x34a16c});}finally{_0x1a3005[_0x48ba05(0x164)](!![]);}}));function _0x58f0(_0x343f7e,_0xb37312){const _0x5a4f69=_0x5a4f();return _0x58f0=function(_0x58f0d8,_0x3a8576){_0x58f0d8=_0x58f0d8-0x103;let _0x120a9d=_0x5a4f69[_0x58f0d8];return _0x120a9d;},_0x58f0(_0x343f7e,_0xb37312);}const getDelRows=async(_0x4728d1,_0x43718a,_0x13db85,_0x4882eb)=>{const _0x12139f=_0x5dafef,_0x1ce54a={'BZcUM':function(_0x581cb6,_0x1657fb){return _0x581cb6/_0x1657fb;}},_0x59210e=db[_0x12139f(0x18d)](),_0x40f123=await _0x4882eb[_0x12139f(0x142)]('select\x20*\x20\x0a\x20\x20\x20\x20\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20select\x20ref,\x20max(last_modified)\x20from\x20'+_0x59210e+'\x22'+db[_0x12139f(0x15b)](_0x4728d1)+'_sync_info\x22\x20\x0a\x20\x20\x20\x20\x20\x20group\x20by\x20ref,\x20deleted\x20having\x20deleted\x20=\x20true)\x20as\x20alias\x20\x0a\x20\x20\x20\x20\x20\x20where\x20alias.max\x20<\x20to_timestamp('+_0x1ce54a['BZcUM'](_0x13db85[_0x12139f(0x11f)](),0x3e8)+_0x12139f(0x11d)+_0x43718a['valueOf']()/0x3e8+')');for(const _0x5213a3 of _0x40f123[_0x12139f(0x15a)]){if(_0x5213a3[_0x12139f(0x173)])_0x5213a3[_0x12139f(0x173)]=_0x5213a3[_0x12139f(0x173)][_0x12139f(0x11f)]();if(_0x5213a3['max'])_0x5213a3[_0x12139f(0x144)]=_0x5213a3[_0x12139f(0x144)][_0x12139f(0x11f)]();}return _0x40f123[_0x12139f(0x15a)];};router[_0x5dafef(0x17e)](_0x5dafef(0x159),error_catcher(async(_0x819920,_0x44a921)=>{const _0x10e77d=_0x5dafef,_0x393e04={'oFYmz':function(_0x4663d1,_0x2bdc09){return _0x4663d1===_0x2bdc09;},'vxTFs':'bCfhc','dejKZ':'COMMIT','KDAwD':function(_0x3919ad){return _0x3919ad();}},{syncInfos:_0x4ff874,syncTimestamp:_0x2b2c7c}=_0x819920[_0x10e77d(0x160)],_0x3ed4ae=await db[_0x10e77d(0x123)]();try{await _0x3ed4ae['query'](_0x10e77d(0x13a));const _0x1bc791=new Date(_0x2b2c7c),_0x5b5251={'deletes':{}};for(const [_0x682b5,_0x365345]of Object[_0x10e77d(0x197)](_0x4ff874)){if(_0x365345['syncFrom']){if(_0x393e04[_0x10e77d(0x146)](_0x10e77d(0x140),_0x393e04[_0x10e77d(0x116)])){if(_0x249fa3[_0x10e77d(0x173)])_0x1a2a12['last_modified']=_0x22d2cf[_0x10e77d(0x173)][_0x10e77d(0x11f)]();if(_0x3c6417[_0x10e77d(0x144)])_0x1386cb[_0x10e77d(0x144)]=_0x56b28c[_0x10e77d(0x144)]['valueOf']();}else _0x5b5251[_0x10e77d(0x183)][_0x682b5]=await getDelRows(_0x682b5,new Date(_0x365345['syncFrom']),_0x1bc791,_0x3ed4ae);}}await _0x3ed4ae[_0x10e77d(0x142)](_0x393e04[_0x10e77d(0x190)]),_0x44a921[_0x10e77d(0x17b)](_0x5b5251);}catch(_0x4129f4){await _0x3ed4ae['query'](_0x10e77d(0x161)),_0x393e04[_0x10e77d(0x12b)](getState)[_0x10e77d(0x108)](0x2,_0x10e77d(0x141)+_0x4129f4[_0x10e77d(0x11b)]+'\x27'),_0x44a921['status'](0x190)[_0x10e77d(0x17b)]({'error':_0x4129f4['message']||_0x4129f4});}finally{_0x3ed4ae[_0x10e77d(0x164)](!![]);}})),router[_0x5dafef(0x17e)](_0x5dafef(0x112),error_catcher(async(_0x1a3534,_0x5ac079)=>{const _0x445ba9=_0x5dafef,_0x1d3430={'LQVyh':_0x445ba9(0x187),'qrXiL':_0x445ba9(0x166),'iZBnX':'changes.json','yzZmN':_0x445ba9(0x122),'zOEKi':_0x445ba9(0x17d),'ZzwXB':_0x445ba9(0x167),'yPvyY':_0x445ba9(0x14a),'TGmoh':_0x445ba9(0x18a),'YzGZb':_0x445ba9(0x198)},{changes:_0x27eaec,syncTimestamp:_0xeb2052}=_0x1a3534[_0x445ba9(0x160)],_0x415a49=await File[_0x445ba9(0x17f)]();try{const _0x1da94b=_0xeb2052+'_'+(_0x1a3534['user']?.[_0x445ba9(0x126)]||_0x445ba9(0x13c)),_0x277bd5=path[_0x445ba9(0x192)](_0x415a49['location'],_0x1d3430[_0x445ba9(0x16d)],_0x1d3430['qrXiL'],_0x1da94b);await fs[_0x445ba9(0x178)](_0x277bd5,{'recursive':!![]}),await fs[_0x445ba9(0x168)](path[_0x445ba9(0x192)](_0x277bd5,_0x1d3430[_0x445ba9(0x149)]),JSON[_0x445ba9(0x12f)](_0x27eaec));const _0x4820ac=[_0x1d3430[_0x445ba9(0x158)]];if(_0x1a3534[_0x445ba9(0x106)]?.[_0x445ba9(0x126)])_0x4820ac[_0x445ba9(0x135)](_0x1d3430['zOEKi'],_0x1a3534[_0x445ba9(0x106)][_0x445ba9(0x126)]);_0x4820ac['push'](_0x1d3430['ZzwXB'],_0x277bd5);db[_0x445ba9(0x163)]()&&db[_0x445ba9(0x165)]()!==db['connectObj'][_0x445ba9(0x13d)]&&_0x4820ac[_0x445ba9(0x135)](_0x1d3430[_0x445ba9(0x196)],db[_0x445ba9(0x165)]());_0x4820ac[_0x445ba9(0x135)](_0x1d3430['TGmoh'],_0xeb2052),_0x5ac079[_0x445ba9(0x17b)]({'syncDir':_0x1da94b});const _0x43e41f=spawn(getSafeSaltcornCmd(),_0x4820ac,{'stdio':[_0x1d3430['YzGZb'],_0x1d3430[_0x445ba9(0x171)],_0x1d3430[_0x445ba9(0x171)]],'cwd':'.'});_0x43e41f['on'](_0x445ba9(0x147),async(_0x1b2923,_0x312c42)=>{const _0x50db13=_0x445ba9;getState()['log'](0x5,_0x50db13(0x134)+_0x1b2923);}),_0x43e41f['on'](_0x445ba9(0x12d),_0x3c3cba=>{const _0x485476=_0x445ba9,_0x4e2945=_0x3c3cba[_0x485476(0x11b)]?_0x3c3cba['message']:_0x3c3cba[_0x485476(0x125)];getState()['log'](0x5,_0x485476(0x182)+_0x4e2945);});}catch(_0x3360d1){getState()[_0x445ba9(0x108)](0x2,_0x445ba9(0x172)+_0x3360d1[_0x445ba9(0x11b)]+'\x27'),_0x5ac079[_0x445ba9(0x195)](0x190)[_0x445ba9(0x17b)]({'error':_0x3360d1[_0x445ba9(0x11b)]||_0x3360d1});}})),router['get']('/upload_finished',error_catcher(async(_0x24ef71,_0x4348f7)=>{const _0x32d251=_0x5dafef,_0x40930a={'Ugant':function(_0x51826c,_0x5e1401){return _0x51826c!==_0x5e1401;},'qkBLg':_0x32d251(0x10e),'nPCGT':_0x32d251(0x187),'PKvtm':function(_0x7725dc,_0x545ce0){return _0x7725dc===_0x545ce0;},'JUlTA':function(_0x31de67,_0x543faf){return _0x31de67>=_0x543faf;},'bWAYl':_0x32d251(0x137),'vfhSC':_0x32d251(0x157)},{dir_name:_0x406559}=_0x24ef71['query'];try{if(_0x40930a[_0x32d251(0x129)](_0x32d251(0x169),_0x40930a[_0x32d251(0x148)])){const _0x4f477b=await File[_0x32d251(0x17f)](),_0x14a2e0=path[_0x32d251(0x192)](_0x4f477b['location'],_0x40930a[_0x32d251(0x124)],'sync',_0x406559);let _0x4f0bee=null;try{if(_0x40930a[_0x32d251(0x103)](_0x32d251(0x109),'TzxEw')){if(_0xfff33[_0x32d251(0x179)])_0x100cb5[_0x32d251(0x179)]=_0x146634[_0x32d251(0x179)]['valueOf']();else _0x4a1f03[_0x32d251(0x179)]=_0x3cad9a[_0x32d251(0x11f)]();}else _0x4f0bee=await fs[_0x32d251(0x14d)](_0x14a2e0);}catch(_0x2216cc){return _0x4348f7['json']({'finished':![]});}if(_0x40930a[_0x32d251(0x189)](_0x4f0bee['indexOf'](_0x40930a[_0x32d251(0x18c)]),0x0)){const _0x148fd3=JSON[_0x32d251(0x138)](await fs['readFile'](path[_0x32d251(0x192)](_0x14a2e0,_0x40930a[_0x32d251(0x18c)]))),_0x2f2249=JSON['parse'](await fs[_0x32d251(0x14c)](path[_0x32d251(0x192)](_0x14a2e0,'unique-conflicts.json')));_0x4348f7[_0x32d251(0x17b)]({'finished':!![],'translatedIds':_0x148fd3,'uniqueConflicts':_0x2f2249});}else{if(_0x40930a[_0x32d251(0x189)](_0x4f0bee['indexOf'](_0x40930a['vfhSC']),0x0)){const _0x11719d=JSON['parse'](await fs['readFile'](path[_0x32d251(0x192)](_0x14a2e0,_0x32d251(0x157))));_0x4348f7[_0x32d251(0x17b)]({'finished':!![],'error':_0x11719d});}else _0x4348f7[_0x32d251(0x17b)]({'finished':![]});}}else _0x2429ea[_0x32d251(0x164)](!![]);}catch(_0x9dfce0){getState()[_0x32d251(0x108)](0x2,_0x32d251(0x162)+_0x9dfce0[_0x32d251(0x11b)]+'\x27'),_0x4348f7[_0x32d251(0x195)](0x190)[_0x32d251(0x17b)]({'error':_0x9dfce0[_0x32d251(0x11b)]||_0x9dfce0});}})),router['post'](_0x5dafef(0x145),error_catcher(async(_0x2239e0,_0x15d4ff)=>{const _0x18e47e=_0x5dafef,_0x3d8553={'CNaNU':_0x18e47e(0x187)},{dir_name:_0x30b584}=_0x2239e0[_0x18e47e(0x160)],_0x299060=File[_0x18e47e(0x17c)](_0x30b584);try{const _0x2733a3=await File[_0x18e47e(0x17f)](),_0x57d790=path['join'](_0x2733a3['location'],_0x3d8553['CNaNU'],_0x18e47e(0x166),_0x299060);await fs['rm'](_0x57d790,{'recursive':!![],'force':!![]}),_0x15d4ff['status'](0xc8)[_0x18e47e(0x115)]('');}catch(_0x548eed){getState()[_0x18e47e(0x108)](0x2,_0x18e47e(0x113)+_0x548eed['message']+'\x27'),_0x15d4ff['status'](0x190)[_0x18e47e(0x17b)]({'error':_0x548eed[_0x18e47e(0x11b)]||_0x548eed});}}));