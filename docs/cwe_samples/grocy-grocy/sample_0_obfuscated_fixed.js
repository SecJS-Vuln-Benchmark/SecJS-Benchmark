const _0x484d55=_0x2b2f;(function(_0x5ce3e3,_0x106f8e){const _0x185efd=_0x2b2f,_0x27a9f1=_0x5ce3e3();while(!![]){try{const _0x235cb8=parseInt(_0x185efd(0x1ab))/0x1+-parseInt(_0x185efd(0x1f4))/0x2+parseInt(_0x185efd(0x188))/0x3*(-parseInt(_0x185efd(0x1c2))/0x4)+parseInt(_0x185efd(0x1cb))/0x5*(parseInt(_0x185efd(0x1dc))/0x6)+-parseInt(_0x185efd(0x1ce))/0x7*(parseInt(_0x185efd(0x1b8))/0x8)+parseInt(_0x185efd(0x1f9))/0x9+parseInt(_0x185efd(0x1d8))/0xa*(parseInt(_0x185efd(0x1b1))/0xb);if(_0x235cb8===_0x106f8e)break;else _0x27a9f1['push'](_0x27a9f1['shift']());}catch(_0x473eb7){_0x27a9f1['push'](_0x27a9f1['shift']());}}}(_0x446b,0x22618));import*as _0xc27ac8 from'@sentry/node';function _0x446b(){const _0x24175c=['mEBte','123','runWithAsyncContext','https://myDomain.io/users/123/details','IAKdr','173503eETPnD','PVkVh','/users/[id]','ffKgY','<head><meta\x20name=\x22something\x22\x20content=\x22\x22/></head>','12345678901234567890123456789012-1234567890123456-1','11RtANCp','http.server','ypQYR','mockRestore','toStrictEqual','RDWcc','toContain','2504QeKrUP','VbHhT','slfbE','async\x20context\x20isolation','ScBIO','BMOwX','interpolateRouteFromUrlAndParams','clearAllMocks','startSpan','mockImplementation','4XthLBR','seEUD','aQUrJ','tqMKb','configureScope','RrCjr','<meta\x20name=\x22baggage\x22\x20content=\x22','GET','/users/123','1365sVHTDk','each','yHVoq','4879jfuBwJ','192.168.0.1','username','text/html','VpzLb','toHaveBeenCalled','toEqual','text','prBJW','XTMNG','2131590UUviAm','nXziQ','sentry-release=1.0.0','APRMB','3126OYBhbR','/usernames/[name]','interpolates\x20route\x20from\x20URL\x20and\x20params\x20%s','eAhXs','bar','doesn\x27t\x20replace\x20partially\x20matching\x20route\x20segments','kVBnH','injects\x20tracing\x20<meta>\x20tags\x20into\x20the\x20HTML\x20of\x20a\x20pageload\x20response','xJwIf','spyOn','UYwJw','astroMiddleware','content-type','/someroute/[catchall]/bar','/foo/bar','sXhdb','mockReturnValueOnce','<meta\x20name=\x22sentry-trace\x22\x20content=\x22','/usernames/username','toBe','objectContaining','yXxpT','setUser','foo','206108pWKGoH','<p>no\x20head</p>','hzdAX','dsMRk','bphvu','1884789VNuMDj','MZmmk','12345678901234567890123456789012','/lang/en-US','zepBk','application/json','catchall-123/params/foo','JhooG','creates\x20a\x20span\x20for\x20an\x20incoming\x20request','headers','/lang/[lang]-[region]/posts','toHaveBeenCalledTimes','izofl','PWOql','kxHyn','PNVXw','1.0.0','NTWKE','some-value','LJhZk','828831NQDTMM','mock','tLUEY','QxifV','../../src/server/meta','smYZB','https://myDomain.io/users/','no-ops\x20if\x20the\x20response\x20isn\x27t\x20HTML','lUnlo','pVamj','/lang/[lang]-[region]','get','gEtIn','VVIqE','toHaveBeenCalledWith','sentryMiddleware','Gyfno','XpTko','attaches\x20tracing\x20headers','<meta\x20name=\x22sentry-trace\x22\x20content=\x22123\x22>','not','/users','resolve','gJrOm','vevpH','captureException','no-ops\x20if\x20there\x27s\x20no\x20<head>\x20tag\x20in\x20the\x20response','rvtxa','cLPcy','route'];_0x446b=function(){return _0x24175c;};return _0x446b();}import{vi}from'vitest';function _0x2b2f(_0x2a683b,_0x42f95b){const _0x446bff=_0x446b();return _0x2b2f=function(_0x2b2f05,_0x2ed518){_0x2b2f05=_0x2b2f05-0x187;let _0x144917=_0x446bff[_0x2b2f05];return _0x144917;},_0x2b2f(_0x2a683b,_0x42f95b);}import{handleRequest,interpolateRouteFromUrlAndParams}from'../../src/server/middleware';vi[_0x484d55(0x189)](_0x484d55(0x18c),()=>({'getTracingMetaTags':()=>({'sentryTrace':_0x484d55(0x19b),'baggage':'<meta\x20name=\x22baggage\x22\x20content=\x22abc\x22>'})})),describe(_0x484d55(0x197),()=>{const _0x17c913=_0x484d55,_0x24f2dc={'VbHhT':function(_0x47ebff,_0x15e41e){return _0x47ebff(_0x15e41e);},'gEtIn':_0x17c913(0x191),'ScBIO':function(_0x150b3b){return _0x150b3b();},'smYZB':'/users/123/details','bphvu':function(_0x3c0be6,_0x1da4c1){return _0x3c0be6(_0x1da4c1);},'APRMB':_0x17c913(0x1c9),'vevpH':'https://mydomain.io/users/123/details','jwuCr':_0x17c913(0x1b2),'JHImx':'auto.http.astro','kxHyn':function(_0x2c57e8,_0x116e08){return _0x2c57e8(_0x116e08);},'rvtxa':function(_0x2ab843,_0x8b6eb7){return _0x2ab843(_0x8b6eb7);},'hzdAX':_0x17c913(0x19d),'Gyfno':_0x17c913(0x18e),'PNVXw':'Something\x20went\x20wrong','JhooG':'astro','aQUrJ':_0x17c913(0x1b0),'eAhXs':function(_0x5e913c,_0x134cfb){return _0x5e913c(_0x134cfb);},'sXhdb':_0x17c913(0x1a5),'zepBk':_0x17c913(0x209),'mEBte':'1234567890123456','izofl':_0x17c913(0x1fb),'lUnlo':_0x17c913(0x1cf),'dsMRk':function(_0x4ab400){return _0x4ab400();},'lqqOL':function(_0x4e3de9,_0x57d860,_0x380c9a){return _0x4e3de9(_0x57d860,_0x380c9a);},'PIWsJ':function(_0x451ff2,_0x2a35ec){return _0x451ff2(_0x2a35ec);},'NTWKE':_0x17c913(0x1e8),'kVBnH':_0x17c913(0x1d1),'PVkVh':_0x17c913(0x1ed),'RDWcc':_0x17c913(0x1c8),'LJhZk':_0x17c913(0x1fe),'xJwIf':function(_0x1a5d4b){return _0x1a5d4b();},'XTMNG':function(_0x289930,_0x3228b1,_0x25d202){return _0x289930(_0x3228b1,_0x25d202);},'ypQYR':function(_0x3d2513,_0x452527){return _0x3d2513(_0x452527);},'RrCjr':'doesn\x27t\x20start\x20a\x20new\x20async\x20context\x20if\x20a\x20span\x20is\x20active','MZmmk':function(_0x848187,_0x5ace52,_0x9eccab){return _0x848187(_0x5ace52,_0x9eccab);},'VpzLb':'throws\x20and\x20sends\x20an\x20error\x20to\x20sentry\x20if\x20`next()`\x20throws','seEUD':function(_0x29e96f,_0x38fa45,_0x594681){return _0x29e96f(_0x38fa45,_0x594681);},'NAjBG':function(_0x595d30,_0xaabde,_0x5fa3f0){return _0x595d30(_0xaabde,_0x5fa3f0);}},_0x3f091f=vi['spyOn'](_0xc27ac8,_0x17c913(0x1c0)),_0x5ca8cd=vi['fn'](()=>{});vi[_0x17c913(0x1e5)](_0xc27ac8,'getCurrentHub')[_0x17c913(0x1c1)](()=>{return{'getScope':()=>({'getSpan':_0x5ca8cd}),'getClient':()=>({})};});const _0x5ec51b=Promise['resolve'](new Response(null,{'status':0xc8,'headers':new Headers()}));afterEach(()=>{const _0x56b735=_0x17c913;if(_0x24f2dc[_0x56b735(0x194)]!==_0x24f2dc[_0x56b735(0x194)]){const _0x4c0c87='/usernames/username',_0x144b4b={'name':_0x56b735(0x1d0)},_0x2c83c1=_0x56b735(0x1dd);_0x24f2dc[_0x56b735(0x1b9)](_0x35d3c1,_0x26b244(_0x4c0c87,_0x144b4b))[_0x56b735(0x1d4)](_0x2c83c1);}else vi[_0x56b735(0x1bf)]();}),_0x24f2dc[_0x17c913(0x1fa)](it,_0x17c913(0x201),async()=>{const _0x3988f9=_0x17c913,_0x5af031=_0x24f2dc[_0x3988f9(0x1bc)](handleRequest),_0x128574={'request':{'method':_0x3988f9(0x1c9),'url':_0x24f2dc[_0x3988f9(0x18d)],'headers':new Headers()},'url':new URL(_0x3988f9(0x1a9)),'params':{'id':'123'}},_0x5bb6a7=vi['fn'](()=>_0x5ec51b),_0x269f90=_0x5af031(_0x128574,_0x5bb6a7);_0x24f2dc[_0x3988f9(0x1f8)](expect,_0x3f091f)['toHaveBeenCalledWith']({'data':{'method':_0x24f2dc[_0x3988f9(0x1db)],'url':_0x24f2dc[_0x3988f9(0x1a0)]},'metadata':{'source':_0x3988f9(0x1a5)},'name':'GET\x20/users/[id]/details','op':_0x24f2dc['jwuCr'],'origin':_0x24f2dc['JHImx'],'status':'ok'},expect['any'](Function)),_0x24f2dc[_0x3988f9(0x207)](expect,_0x5bb6a7)[_0x3988f9(0x1d3)](),_0x24f2dc[_0x3988f9(0x1a3)](expect,_0x269f90)[_0x3988f9(0x1b5)](_0x5ec51b);}),it(_0x24f2dc[_0x17c913(0x1d2)],async()=>{const _0x1d55ef=_0x17c913,_0x53796f=vi[_0x1d55ef(0x1e5)](_0xc27ac8,_0x1d55ef(0x1a1)),_0x2ef1c8=handleRequest(),_0x2c9702={'request':{'method':_0x1d55ef(0x1c9),'url':_0x24f2dc[_0x1d55ef(0x1f6)],'headers':new Headers()},'url':new URL(_0x24f2dc[_0x1d55ef(0x198)]),'params':{}},_0x20c147=new Error(_0x24f2dc[_0x1d55ef(0x208)]),_0x53a865=vi['fn'](()=>{throw _0x20c147;});await _0x24f2dc[_0x1d55ef(0x1f8)](expect,async()=>_0x2ef1c8(_0x2c9702,_0x53a865))['rejects']['toThrowError'](),expect(_0x53796f)['toHaveBeenCalledWith'](_0x20c147,{'mechanism':{'handled':![],'type':_0x24f2dc[_0x1d55ef(0x200)],'data':{'function':_0x1d55ef(0x1e7)}}});}),_0x24f2dc[_0x17c913(0x1d7)](it,_0x17c913(0x19a),async()=>{const _0x27a6ec=_0x17c913,_0x5861db=handleRequest(),_0x4b931d={'request':{'method':'GET','url':_0x24f2dc[_0x27a6ec(0x1f6)],'headers':new Headers({'sentry-trace':_0x24f2dc[_0x27a6ec(0x1c4)],'baggage':_0x27a6ec(0x1da)})},'params':{},'url':new URL(_0x24f2dc[_0x27a6ec(0x198)])},_0x1d6483=vi['fn'](()=>_0x5ec51b);await _0x5861db(_0x4b931d,_0x1d6483),_0x24f2dc[_0x27a6ec(0x1df)](expect,_0x3f091f)[_0x27a6ec(0x196)](expect[_0x27a6ec(0x1f0)]({'metadata':{'source':_0x24f2dc[_0x27a6ec(0x1eb)],'dynamicSamplingContext':{'release':_0x24f2dc[_0x27a6ec(0x1fd)]}},'parentSampled':!![],'parentSpanId':_0x24f2dc[_0x27a6ec(0x1a6)],'traceId':_0x24f2dc[_0x27a6ec(0x205)]}),expect['any'](Function));}),it('attaches\x20client\x20IP\x20and\x20request\x20headers\x20if\x20options\x20are\x20set',async()=>{const _0x3ef909=_0x17c913,_0x581724={'setUser':vi['fn'](),'setPropagationContext':vi['fn']()},_0x472bc4=vi[_0x3ef909(0x1e5)](_0xc27ac8,_0x3ef909(0x1c6))['mockImplementation'](_0x3d09f7=>_0x3d09f7(_0x581724)),_0x4eca3a=_0x24f2dc[_0x3ef909(0x1b9)](handleRequest,{'trackClientIp':!![],'trackHeaders':!![]}),_0x54757c={'request':{'method':_0x3ef909(0x1c9),'url':_0x24f2dc[_0x3ef909(0x1f6)],'headers':new Headers({'some-header':_0x3ef909(0x20b)})},'clientAddress':_0x24f2dc[_0x3ef909(0x190)],'params':{},'url':new URL(_0x3ef909(0x18e))},_0x1a3d2b=vi['fn'](()=>_0x5ec51b);await _0x4eca3a(_0x54757c,_0x1a3d2b),_0x24f2dc[_0x3ef909(0x1a3)](expect,_0x472bc4)['toHaveBeenCalledTimes'](0x1),expect(_0x581724[_0x3ef909(0x1f2)])[_0x3ef909(0x196)]({'ip_address':_0x24f2dc[_0x3ef909(0x190)]}),_0x24f2dc[_0x3ef909(0x1f8)](expect,_0x3f091f)[_0x3ef909(0x196)](expect[_0x3ef909(0x1f0)]({'data':expect[_0x3ef909(0x1f0)]({'headers':{'some-header':'some-value'}})}),expect['any'](Function));}),_0x24f2dc['lqqOL'](it,_0x17c913(0x1e3),async()=>{const _0x24cd3c=_0x17c913,_0x48a49b=_0x24f2dc[_0x24cd3c(0x1f7)](handleRequest),_0x26953d={'request':{'method':_0x24f2dc[_0x24cd3c(0x1db)],'url':'/users','headers':new Headers()},'params':{},'url':new URL(_0x24f2dc[_0x24cd3c(0x198)])},_0x378323=vi['fn'](()=>Promise['resolve'](new Response(_0x24cd3c(0x1af),{'headers':new Headers({'content-type':_0x24cd3c(0x1d1)})}))),_0x14207d=await _0x24f2dc['lqqOL'](_0x48a49b,_0x26953d,_0x378323);_0x24f2dc['PIWsJ'](expect,_0x14207d?.['headers'][_0x24cd3c(0x193)](_0x24f2dc[_0x24cd3c(0x20a)]))[_0x24cd3c(0x1d4)](_0x24f2dc[_0x24cd3c(0x1e2)]);const _0x162c4c=await _0x14207d?.[_0x24cd3c(0x1d5)]();_0x24f2dc[_0x24cd3c(0x1f8)](expect,_0x162c4c)[_0x24cd3c(0x1b7)](_0x24f2dc[_0x24cd3c(0x1ac)]),_0x24f2dc[_0x24cd3c(0x207)](expect,_0x162c4c)['toContain'](_0x24f2dc[_0x24cd3c(0x1b6)]);}),_0x24f2dc[_0x17c913(0x1c3)](it,_0x17c913(0x18f),async()=>{const _0x2aaacc=_0x17c913,_0x3eeab7=handleRequest(),_0x54ef07={'request':{'method':_0x2aaacc(0x1c9),'url':_0x24f2dc['hzdAX'],'headers':new Headers()},'params':{},'url':new URL(_0x24f2dc['Gyfno'])},_0x13ec7e=new Response('{\x22foo\x22:\x20\x22bar\x22}',{'headers':new Headers({'content-type':_0x24f2dc[_0x2aaacc(0x187)]})}),_0x1429a7=vi['fn'](()=>Promise[_0x2aaacc(0x19e)](_0x13ec7e)),_0x4e5747=await _0x3eeab7(_0x54ef07,_0x1429a7);expect(_0x4e5747)[_0x2aaacc(0x1ef)](_0x13ec7e);}),_0x24f2dc['NAjBG'](it,_0x17c913(0x1a2),async()=>{const _0x3146a2=_0x17c913,_0x220c84=_0x24f2dc[_0x3146a2(0x1e4)](handleRequest),_0x4e4cf0={'request':{'method':'GET','url':'/users','headers':new Headers()},'params':{},'url':new URL(_0x24f2dc[_0x3146a2(0x198)])},_0x766763=_0x3146a2(0x1f5),_0x5e886b=new Response(_0x766763,{'headers':new Headers({'content-type':'text/html'})}),_0x12a8ee=vi['fn'](()=>Promise['resolve'](_0x5e886b)),_0x24833c=await _0x24f2dc[_0x3146a2(0x1d7)](_0x220c84,_0x4e4cf0,_0x12a8ee);_0x24f2dc[_0x3146a2(0x1b3)](expect,_0x24833c?.[_0x3146a2(0x202)][_0x3146a2(0x193)](_0x3146a2(0x1e8)))[_0x3146a2(0x1d4)](_0x24f2dc[_0x3146a2(0x1e2)]);const _0x2395bc=await _0x24833c?.[_0x3146a2(0x1d5)]();_0x24f2dc[_0x3146a2(0x1b9)](expect,_0x2395bc)['toBe'](_0x766763);}),describe(_0x17c913(0x1bb),()=>{const _0x421927=_0x17c913,_0x1c52c7={'yHVoq':function(_0x35b34e,_0xcfb01){return _0x35b34e(_0xcfb01);},'ffKgY':function(_0x3a8107){return _0x3a8107();},'slfbE':function(_0x107fea,_0x3f6c0c,_0x1c1bf6){const _0x17970b=_0x2b2f;return _0x24f2dc[_0x17970b(0x1d7)](_0x107fea,_0x3f6c0c,_0x1c1bf6);},'cLPcy':function(_0x43c6ac,_0x1484ab){return _0x24f2dc['VbHhT'](_0x43c6ac,_0x1484ab);}},_0x2c2baf=vi[_0x421927(0x1e5)](_0xc27ac8,_0x421927(0x1a8));afterEach(()=>{const _0xa249c8=_0x421927;vi[_0xa249c8(0x1bf)](),_0x2c2baf[_0xa249c8(0x1b4)]();}),it('starts\x20a\x20new\x20async\x20context\x20if\x20no\x20span\x20is\x20active',async()=>{const _0x13c524=_0x421927;_0x5ca8cd[_0x13c524(0x1ec)](undefined);const _0xac69b9=handleRequest(),_0x59d071={},_0x2b62bc=vi['fn']();try{await _0xac69b9(_0x59d071,_0x2b62bc);}catch{}_0x1c52c7[_0x13c524(0x1cd)](expect,_0x2c2baf)[_0x13c524(0x204)](0x1);}),it(_0x24f2dc[_0x421927(0x1c7)],async()=>{const _0x1657da=_0x421927;_0x5ca8cd[_0x1657da(0x1ec)]({});const _0x2287a3=_0x1c52c7[_0x1657da(0x1ae)](handleRequest),_0x528725={},_0x1f6bfe=vi['fn']();try{await _0x1c52c7[_0x1657da(0x1ba)](_0x2287a3,_0x528725,_0x1f6bfe);}catch{}_0x1c52c7[_0x1657da(0x1a4)](expect,_0x2c2baf)[_0x1657da(0x19c)][_0x1657da(0x1d3)]();});});}),describe(_0x484d55(0x1be),()=>{const _0x4ce0d4=_0x484d55,_0x56c1fa={'tLUEY':function(_0x5bb467,_0x556294,_0x5c9348){return _0x5bb467(_0x556294,_0x5c9348);},'AtowN':_0x4ce0d4(0x1ff),'HQjxi':function(_0x8b5295,_0x208b1e){return _0x8b5295!==_0x208b1e;},'IAKdr':'QxifV','prBJW':function(_0x55aac0,_0x303db){return _0x55aac0(_0x303db);},'BMOwX':function(_0xdcb8a1,_0x8679e4){return _0xdcb8a1(_0x8679e4);},'yXxpT':function(_0x38ae35,_0x1292f5,_0x40a39b){return _0x38ae35(_0x1292f5,_0x40a39b);},'UYwJw':'/someroute/catchall-123/params/foo/bar','tqMKb':_0x4ce0d4(0x1f3),'spiiu':_0x4ce0d4(0x1ee),'nXziQ':'/foo/bar','XpTko':_0x4ce0d4(0x1e0),'MgxcD':'/users/[id]','Gfkgo':_0x4ce0d4(0x1fc),'VVIqE':_0x4ce0d4(0x203),'gJrOm':'handles\x20params\x20across\x20multiple\x20URL\x20segments\x20in\x20catchall\x20routes','PWOql':_0x4ce0d4(0x1e1)};it[_0x4ce0d4(0x1cc)]([[_0x4ce0d4(0x1ea),{},_0x56c1fa[_0x4ce0d4(0x1d9)]],[_0x4ce0d4(0x1ca),{'id':'123'},_0x4ce0d4(0x1ad)],[_0x4ce0d4(0x1ca),{'id':_0x4ce0d4(0x1a7),'foo':_0x56c1fa[_0x4ce0d4(0x199)]},_0x56c1fa['MgxcD']],[_0x56c1fa['Gfkgo'],{'lang':'en','region':'US'},_0x4ce0d4(0x192)],['/lang/en-US/posts',{'lang':'en','region':'US'},_0x56c1fa[_0x4ce0d4(0x195)]]])(_0x4ce0d4(0x1de),(_0x21b8bf,_0x56bec4,_0x500238)=>{const _0x56e013=_0x4ce0d4;_0x56c1fa['HQjxi'](_0x56c1fa[_0x56e013(0x1aa)],_0x56e013(0x18b))?_0x532cad(_0x56c1fa[_0x56e013(0x18a)](_0x3ada2e,'/someroute/catchall-123/params/foo/bar',{'catchall':_0x56c1fa['AtowN'],'params':_0x56e013(0x1f3)}))[_0x56e013(0x1d4)](_0x56e013(0x1e9)):_0x56c1fa[_0x56e013(0x1d6)](expect,interpolateRouteFromUrlAndParams(_0x21b8bf,_0x56bec4))[_0x56e013(0x1d4)](_0x500238);}),_0x56c1fa[_0x4ce0d4(0x1f1)](it,_0x56c1fa[_0x4ce0d4(0x19f)],()=>{const _0x590532=_0x4ce0d4;_0x56c1fa[_0x590532(0x1bd)](expect,_0x56c1fa[_0x590532(0x1f1)](interpolateRouteFromUrlAndParams,_0x56c1fa[_0x590532(0x1e6)],{'catchall':_0x590532(0x1ff),'params':_0x56c1fa[_0x590532(0x1c5)]}))[_0x590532(0x1d4)](_0x590532(0x1e9));}),it(_0x56c1fa[_0x4ce0d4(0x206)],()=>{const _0x18737a=_0x4ce0d4,_0x548ee0=_0x56c1fa['spiiu'],_0x2ed175={'name':_0x18737a(0x1d0)},_0x1f2373=_0x18737a(0x1dd);expect(_0x56c1fa[_0x18737a(0x18a)](interpolateRouteFromUrlAndParams,_0x548ee0,_0x2ed175))[_0x18737a(0x1d4)](_0x1f2373);});});