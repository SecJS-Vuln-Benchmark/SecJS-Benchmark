'use strict';function _0x303f(){const _0x21d730=['readdirSync','store','add','info','eKPmy','SQdhZ','isDirectory','updateMetadata','_import','reduce','isInteger','key','extname','createdAt','lastDownload','remove','maxAge','36nLUFzI','4876WHTJBT','catch','7430qtgCzK','_sync','zRwtw','get','del','db\x20initialization\x20failed\x20with\x20error\x20','path','update','42833604vjrPsO','JUcLI','1657682SqaNWw','now','initialized','uploadDir','DB\x20not\x20initialized_','Yawyj','../config','Remove\x20','exports','resolve','2893238WniNtD','message','keys','cpagN','chxhP','Updated\x20','metadata','Update\x20metadata\x20','statSync','ensureDirSync','updateLastDownload','error','TkYBU','findIndex','fs-promise','push','splice','efkLZ','Expired\x20','CMgVQ','CLVzK','6wuCXBm','2591560msqWSP','retention','init','psitransfer:db','rmdir','ccAFB','find','bucketSize','Added\x20','2166808yNXgvo','KRFNL','3qOOtXD','zNSIi','forEach','8160180DsGSLj','aoICK'];_0x303f=function(){return _0x21d730;};return _0x303f();}const _0x537737=_0x2fb1;(function(_0x111a16,_0x1fb7aa){const _0x14c855=_0x2fb1,_0x5553a6=_0x111a16();while(!![]){try{const _0x3158b5=-parseInt(_0x14c855(0x119))/0x1+-parseInt(_0x14c855(0x123))/0x2*(parseInt(_0x14c855(0xf6))/0x3)+parseInt(_0x14c855(0x10d))/0x4*(-parseInt(_0x14c855(0x10f))/0x5)+-parseInt(_0x14c855(0x138))/0x6*(-parseInt(_0x14c855(0xf9))/0x7)+-parseInt(_0x14c855(0xf4))/0x8*(-parseInt(_0x14c855(0x10c))/0x9)+-parseInt(_0x14c855(0x139))/0xa+parseInt(_0x14c855(0x117))/0xb;if(_0x3158b5===_0x1fb7aa)break;else _0x5553a6['push'](_0x5553a6['shift']());}catch(_0x4cb70a){_0x5553a6['push'](_0x5553a6['shift']());}}}(_0x303f,0xec619));function _0x2fb1(_0xe10ce2,_0x2fdd93){const _0x303f1a=_0x303f();return _0x2fb1=function(_0x2fb114,_0x58fc52){_0x2fb114=_0x2fb114-0xf3;let _0x20d505=_0x303f1a[_0x2fb114];return _0x20d505;},_0x2fb1(_0xe10ce2,_0x2fdd93);}const fsp=require(_0x537737(0x131)),path=require(_0x537737(0x115)),debug=require('debug')(_0x537737(0x13c)),config=require(_0x537737(0x11f));module[_0x537737(0x121)]=class DB{constructor(_0x45afa1,_0x444cd1){const _0x13e7bb=_0x537737,_0x342c2d={'zNSIi':'JxfZU','aoICK':function(_0x5b71ab,_0x5dfbda){return _0x5b71ab+_0x5dfbda;},'ccAFB':function(_0x4431b5,_0x48fbff){return _0x4431b5-_0x48fbff;},'cpagN':function(_0x40fce4,_0x39521e){return _0x40fce4(_0x39521e);},'CLVzK':function(_0x317483,_0x13ce5f,_0x39d35a){return _0x317483(_0x13ce5f,_0x39d35a);}};this[_0x13e7bb(0x11b)]=![],this['db']={},this[_0x13e7bb(0x11c)]=_0x45afa1,this[_0x13e7bb(0xfc)]=_0x444cd1;const _0x37a927=()=>{const _0x48654a=_0x13e7bb,_0x1c6a49={'RmXcD':function(_0x1a97a8,_0x25e8e3){return _0x1a97a8(_0x25e8e3);}};if(_0x342c2d[_0x48654a(0xf7)]!==_0x342c2d[_0x48654a(0xf7)])_0x5e466b[_0x48654a(0x12e)](_0x2293aa);else{let _0x491821,_0x12a4fe,_0x3ee160;for(_0x491821 of Object[_0x48654a(0x125)](this['db'])){if('KpvHi'===_0x48654a(0x134))this['db'][_0x58f0ff]['splice'](_0x552d26,0x1,_0x49b133),_0x514c93('Updated\x20'+_0x3a9864+'++'+_0x55c785);else for(_0x12a4fe of this['db'][_0x491821]){_0x48654a(0x12f)!=='grAJJ'?(_0x3ee160=_0x342c2d[_0x48654a(0xfa)](+_0x12a4fe[_0x48654a(0x129)]['createdAt'],config[_0x48654a(0x10b)]*0x3e8)-Date[_0x48654a(0x11a)](),_0x3ee160>0x0&&Number[_0x48654a(0x105)](+_0x12a4fe['metadata']['retention'])&&(_0x3ee160=_0x342c2d[_0x48654a(0x13e)](+_0x12a4fe[_0x48654a(0x129)][_0x48654a(0x108)]+ +_0x12a4fe[_0x48654a(0x129)][_0x48654a(0x13a)]*0x3e8,Date[_0x48654a(0x11a)]())),_0x3ee160<=0x0&&(_0x342c2d[_0x48654a(0x126)](debug,_0x48654a(0x135)+_0x491821+'++'+_0x12a4fe['key']),this[_0x48654a(0x10a)](_0x491821,_0x12a4fe[_0x48654a(0x106)])[_0x48654a(0x10e)](_0x21f003=>console[_0x48654a(0x12e)](_0x21f003)))):(_0x1c6a49['RmXcD'](_0x2ffcd8,_0x48654a(0x135)+_0x499d80+'++'+_0x29c04f[_0x48654a(0x106)]),this['remove'](_0xb230dc,_0x217656[_0x48654a(0x106)])['catch'](_0xf1aa40=>_0x179d56[_0x48654a(0x12e)](_0xf1aa40)));}}}};_0x342c2d[_0x13e7bb(0x137)](setInterval,_0x37a927,0x3c*0x3e8);}[_0x537737(0x13b)](){const _0x6caa96=_0x537737,_0x4ce4c2={'chxhP':function(_0x7fbb1f,_0x4860e2){return _0x7fbb1f-_0x4860e2;},'Yawyj':function(_0xead46d,_0x3d2ebd){return _0xead46d>_0x3d2ebd;},'lXbtO':function(_0xc45e0d,_0x3a5a89){return _0xc45e0d+_0x3a5a89;},'MhIPx':function(_0x4d879e,_0x37cd72){return _0x4d879e<=_0x37cd72;},'IGBXK':function(_0x24e822,_0x89d06a){return _0x24e822(_0x89d06a);},'eKPmy':_0x6caa96(0x111),'SQdhZ':_0x6caa96(0x136)};if(this[_0x6caa96(0x11b)])return;this[_0x6caa96(0x11b)]=!![];try{if(_0x4ce4c2[_0x6caa96(0xff)]===_0x4ce4c2[_0x6caa96(0x100)])for(_0x27bc10 of this['db'][_0x2c2f18]){_0x572e44=_0x4ce4c2[_0x6caa96(0x127)](+_0xbc52a4[_0x6caa96(0x129)]['createdAt']+_0x524e47[_0x6caa96(0x10b)]*0x3e8,_0x3e1644[_0x6caa96(0x11a)]()),_0x4ce4c2[_0x6caa96(0x11e)](_0x437f80,0x0)&&_0x52df83[_0x6caa96(0x105)](+_0xfd957e[_0x6caa96(0x129)][_0x6caa96(0x13a)])&&(_0x59d92e=_0x4ce4c2[_0x6caa96(0x127)](_0x4ce4c2['lXbtO'](+_0x41b1f1['metadata'][_0x6caa96(0x108)],+_0x33e4de[_0x6caa96(0x129)][_0x6caa96(0x13a)]*0x3e8),_0x997842[_0x6caa96(0x11a)]())),_0x4ce4c2['MhIPx'](_0xf3e65f,0x0)&&(_0x4ce4c2['IGBXK'](_0x16ae12,_0x6caa96(0x135)+_0x164bfc+'++'+_0xf37d95['key']),this[_0x6caa96(0x10a)](_0x461e4c,_0x3e8ef9[_0x6caa96(0x106)])[_0x6caa96(0x10e)](_0x887d35=>_0x2537ca[_0x6caa96(0x12e)](_0x887d35)));}else this[_0x6caa96(0x110)]();}catch(_0x6aed68){this['initialized']=![],_0x6aed68[_0x6caa96(0x124)]=_0x6caa96(0x114)+_0x6aed68[_0x6caa96(0x124)];throw _0x6aed68;}}[_0x537737(0x110)](){const _0x199227=_0x537737;fsp[_0x199227(0x12c)](this[_0x199227(0x11c)]),fsp[_0x199227(0xfb)](this[_0x199227(0x11c)])[_0x199227(0xf8)](_0x14bbd2=>{const _0x2445c6=_0x199227;this[_0x2445c6(0x103)](_0x14bbd2);});}[_0x537737(0x103)](_0x158a84){const _0x5d56b4=_0x537737,_0x23eb39=path[_0x5d56b4(0x122)](this[_0x5d56b4(0x11c)],_0x158a84),_0x49f395=fsp[_0x5d56b4(0x12b)](_0x23eb39);if(!_0x49f395[_0x5d56b4(0x101)]())return;fsp[_0x5d56b4(0xfb)](_0x23eb39)[_0x5d56b4(0xf8)](async _0x10632f=>{const _0x257231=_0x5d56b4;if(path[_0x257231(0x107)](_0x10632f)!=='')return Promise[_0x257231(0x122)]();try{let _0x4f2965=await this[_0x257231(0xfc)][_0x257231(0xfe)](_0x158a84+'++'+_0x10632f);this[_0x257231(0xfd)](_0x158a84,_0x10632f,_0x4f2965);}catch(_0xa2e98f){console['error'](_0xa2e98f);}});}[_0x537737(0xfd)](_0x5e3965,_0x1dac3f,_0x41a82e){const _0x5ac6cc=_0x537737,_0xb2f724={'JUcLI':function(_0xef56a7,_0x10d6cf){return _0xef56a7(_0x10d6cf);}};if(!this['initialized'])throw new Error(_0x5ac6cc(0x11d));if(!this['db'][_0x5e3965])this['db'][_0x5e3965]=[];_0x41a82e['key']=_0x1dac3f;const _0x5339a2=this['db'][_0x5e3965][_0x5ac6cc(0x130)](_0x54d769=>_0x54d769[_0x5ac6cc(0x106)]===_0x1dac3f);_0x5339a2!==-0x1?(this['db'][_0x5e3965][_0x5ac6cc(0x133)](_0x5339a2,0x1,_0x41a82e),_0xb2f724[_0x5ac6cc(0x118)](debug,_0x5ac6cc(0x128)+_0x5e3965+'++'+_0x1dac3f)):(this['db'][_0x5e3965][_0x5ac6cc(0x132)](_0x41a82e),debug(_0x5ac6cc(0xf3)+_0x5e3965+'++'+_0x1dac3f));}async[_0x537737(0x10a)](_0x2a995c,_0x5a7c89){const _0x504146=_0x537737,_0x3da7a0={'KCKxf':function(_0x2bce2b,_0x3666c6){return _0x2bce2b+_0x3666c6;}};if(!this['initialized'])throw new Error('DB\x20not\x20initialized');debug(_0x504146(0x120)+_0x2a995c+'++'+_0x5a7c89),await this[_0x504146(0xfc)][_0x504146(0x113)](_0x3da7a0['KCKxf'](_0x2a995c,'++')+_0x5a7c89);const _0x21f2b0=this['db'][_0x2a995c]['findIndex'](_0x2ca977=>_0x2ca977[_0x504146(0x106)]===_0x5a7c89);this[_0x504146(0x112)](_0x2a995c)[_0x504146(0x133)](_0x21f2b0,0x1),this[_0x504146(0x112)](_0x2a995c)['length']===0x0&&(delete this['db'][_0x2a995c],await fsp[_0x504146(0x13d)](path[_0x504146(0x122)](this[_0x504146(0x11c)],_0x2a995c)));}async[_0x537737(0x12d)](_0x2579f,_0x2d4cf8){const _0x2f4df6=_0x537737;debug('Update\x20last\x20download\x20'+_0x2579f+'++'+_0x2d4cf8);const _0x9a1caa=this[_0x2f4df6(0x112)](_0x2579f)[_0x2f4df6(0x13f)](_0x45869a=>_0x45869a[_0x2f4df6(0x106)]===_0x2d4cf8);if(!_0x9a1caa)return;_0x9a1caa[_0x2f4df6(0x129)][_0x2f4df6(0x109)]=Date[_0x2f4df6(0x11a)](),await this[_0x2f4df6(0xfc)]['update'](_0x2579f+'++'+_0x2d4cf8,_0x9a1caa);}async[_0x537737(0x102)](_0x1c0f31,_0x3faad6,_0xd476e1){const _0x1f3ad6=_0x537737,_0x56fc1f={'KRFNL':function(_0x5dc6b7,_0x3e6a04){return _0x5dc6b7(_0x3e6a04);}};_0x56fc1f[_0x1f3ad6(0xf5)](debug,_0x1f3ad6(0x12a)+_0x1c0f31+'++'+_0x3faad6);const _0x537daa=this[_0x1f3ad6(0x112)](_0x1c0f31)['find'](_0x31f0f1=>_0x31f0f1[_0x1f3ad6(0x106)]===_0x3faad6);if(!_0x537daa)return;_0x537daa[_0x1f3ad6(0x129)]={..._0x537daa['metadata'],..._0xd476e1},await this['store'][_0x1f3ad6(0x116)](_0x1c0f31+'++'+_0x3faad6,_0x537daa);}[_0x537737(0x112)](_0x456290){return this['db'][_0x456290];}[_0x537737(0x140)](_0x3c626a){const _0xb1aeed=_0x537737,_0x337952=this[_0xb1aeed(0x112)](_0x3c626a);if(!_0x337952)return 0x0;return _0x337952[_0xb1aeed(0x104)]((_0x59d487,_0x59da12)=>_0x59d487+ +_0x59da12[_0xb1aeed(0x129)]['uploadLength'],0x0);}};