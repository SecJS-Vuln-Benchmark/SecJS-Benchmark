const _0x351203=_0x2cf9;(function(_0x158dde,_0x677e0c){const _0x1b52d3=_0x2cf9,_0x5939d3=_0x158dde();while(!![]){try{const _0x40841a=-parseInt(_0x1b52d3(0x232))/0x1+parseInt(_0x1b52d3(0x248))/0x2+parseInt(_0x1b52d3(0x23a))/0x3+parseInt(_0x1b52d3(0x215))/0x4+-parseInt(_0x1b52d3(0x249))/0x5+parseInt(_0x1b52d3(0x1f5))/0x6+parseInt(_0x1b52d3(0x219))/0x7;if(_0x40841a===_0x677e0c)break;else _0x5939d3['push'](_0x5939d3['shift']());}catch(_0xf9ec52){_0x5939d3['push'](_0x5939d3['shift']());}}}(_0x1bec,0x9411a));import _0x12d527 from'/imports/api/users';import _0x1c3f9d from'/imports/api/meetings';import{GroupChatMsg}from'/imports/api/group-chat-msg';import _0x268209 from'/imports/api/group-chat';import _0x3981f0 from'/imports/ui/services/auth';function _0x2cf9(_0x525b06,_0x5183f8){const _0x1beca5=_0x1bec();return _0x2cf9=function(_0x2cf961,_0x10cb02){_0x2cf961=_0x2cf961-0x1ed;let _0x623209=_0x1beca5[_0x2cf961];return _0x623209;},_0x2cf9(_0x525b06,_0x5183f8);}import _0x30edc3 from'/imports/ui/services/unread-messages';import _0x21f05e from'/imports/ui/services/storage/session';import{makeCall}from'/imports/ui/services/api';import _0x2bdc2b from'lodash';const CHAT_CONFIG=Meteor[_0x351203(0x218)][_0x351203(0x20d)]['chat'],GROUPING_MESSAGES_WINDOW=CHAT_CONFIG[_0x351203(0x239)],SYSTEM_CHAT_TYPE=CHAT_CONFIG[_0x351203(0x1f6)],PUBLIC_CHAT_ID=CHAT_CONFIG[_0x351203(0x23d)],PUBLIC_GROUP_CHAT_ID=CHAT_CONFIG['public_group_id'],PRIVATE_CHAT_TYPE=CHAT_CONFIG[_0x351203(0x220)],PUBLIC_CHAT_USER_ID=CHAT_CONFIG[_0x351203(0x210)],PUBLIC_CHAT_CLEAR=CHAT_CONFIG[_0x351203(0x217)][_0x351203(0x20b)],ROLE_MODERATOR=Meteor['settings'][_0x351203(0x20d)]['user'][_0x351203(0x216)],CONNECTION_STATUS_ONLINE=_0x351203(0x1fb),ScrollCollection=new Mongo[(_0x351203(0x240))](null),UnsentMessagesCollection=new Mongo['Collection'](null),CLOSED_CHAT_LIST_KEY=_0x351203(0x1fa),getUser=_0x4937bd=>_0x12d527['findOne']({'userId':_0x4937bd}),getWelcomeProp=()=>_0x1c3f9d[_0x351203(0x20c)]({'meetingId':_0x3981f0[_0x351203(0x212)]},{'fields':{'welcomeProp':0x1}}),mapGroupMessage=_0x187cbc=>{const _0x155e3b=_0x351203,_0x3884b0={'FsCud':function(_0x225721,_0x145d83){return _0x225721!==_0x145d83;},'vLkcU':function(_0x534b89,_0x276e98){return _0x534b89===_0x276e98;},'EwCdd':_0x155e3b(0x242)},_0x409bd0={'id':_0x187cbc['_id'],'content':_0x187cbc[_0x155e3b(0x1fd)],'time':_0x187cbc[_0x155e3b(0x211)],'sender':null};if(_0x3884b0[_0x155e3b(0x213)](_0x187cbc[_0x155e3b(0x236)],SYSTEM_CHAT_TYPE)){if(_0x3884b0[_0x155e3b(0x221)](_0x155e3b(0x242),_0x3884b0[_0x155e3b(0x21f)])){const _0x5b7b7b=_0x12d527[_0x155e3b(0x20c)]({'userId':_0x187cbc[_0x155e3b(0x236)]},{'fields':{'color':0x1,'role':0x1,'name':0x1,'connectionStatus':0x1}}),{color:_0x189ce1,role:_0x15535f,name:_0x4af9d2,connectionStatus:_0x262254}=_0x5b7b7b,_0x170e68={'color':_0x189ce1,'isModerator':_0x15535f===ROLE_MODERATOR,'name':_0x4af9d2,'isOnline':_0x262254===CONNECTION_STATUS_ONLINE};_0x409bd0[_0x155e3b(0x236)]=_0x170e68;}else return _0x44c527['lockSettingsProps'][_0x155e3b(0x222)];}return _0x409bd0;},reduceGroupMessages=(_0x19573d,_0x531f6a)=>{const _0x503318=_0x351203,_0x4372e9={'rcCqc':function(_0x3a3f5b,_0x2af636){return _0x3a3f5b-_0x2af636;},'chmEP':function(_0x3fbdff,_0x2142be){return _0x3fbdff===_0x2142be;},'CIXPs':function(_0x3c1990,_0x100038){return _0x3c1990===_0x100038;},'ZWleU':function(_0x3cbb93,_0xced74a){return _0x3cbb93<=_0xced74a;},'cbfeh':function(_0x55777a,_0x1d9733){return _0x55777a-_0x1d9733;}},_0x224d0b=_0x19573d[_0x4372e9[_0x503318(0x230)](_0x19573d[_0x503318(0x225)],0x1)],_0x453ec5=_0x531f6a;_0x453ec5[_0x503318(0x1fd)]=[{'id':_0x531f6a['id'],'text':_0x531f6a[_0x503318(0x1f1)],'time':_0x531f6a[_0x503318(0x211)]}];if(!_0x224d0b||_0x4372e9[_0x503318(0x22f)](!_0x453ec5[_0x503318(0x246)],PUBLIC_GROUP_CHAT_ID))return _0x19573d[_0x503318(0x245)](_0x453ec5);const _0x316cff=_0x224d0b['content'][_0x4372e9['rcCqc'](_0x224d0b['content'][_0x503318(0x225)],0x1)][_0x503318(0x1ff)];if(_0x4372e9['CIXPs'](_0x224d0b[_0x503318(0x236)],_0x453ec5[_0x503318(0x236)])&&_0x4372e9['ZWleU'](_0x4372e9['cbfeh'](_0x453ec5[_0x503318(0x211)],_0x316cff),GROUPING_MESSAGES_WINDOW))return _0x224d0b['content'][_0x503318(0x1f7)](_0x453ec5[_0x503318(0x1fd)]['pop']()),_0x19573d;return _0x19573d[_0x503318(0x245)](_0x453ec5);},reduceAndMapGroupMessages=_0x228683=>_0x228683[_0x351203(0x209)](reduceGroupMessages,[])[_0x351203(0x224)](mapGroupMessage),getPublicGroupMessages=()=>{const _0x3e2b29=_0x351203,_0x1d966b={'MSeZo':_0x3e2b29(0x211)},_0x2fca36=GroupChatMsg[_0x3e2b29(0x23e)]({'meetingId':_0x3981f0[_0x3e2b29(0x212)],'chatId':PUBLIC_GROUP_CHAT_ID},{'sort':[_0x1d966b[_0x3e2b29(0x223)]]})['fetch']();return _0x2fca36;},getPrivateGroupMessages=()=>{const _0x253d1a=_0x351203,_0x40dd87={'Kghed':'idChatOpen'},_0x5ad28e=Session[_0x253d1a(0x21d)](_0x40dd87[_0x253d1a(0x235)]),_0x2be8fc=_0x3981f0[_0x253d1a(0x1f3)],_0x227fee=_0x268209[_0x253d1a(0x20c)]({'meetingId':_0x3981f0[_0x253d1a(0x212)],'users':{'$all':[_0x5ad28e,_0x2be8fc]},'access':PRIVATE_CHAT_TYPE});let _0x54b721=[];if(_0x227fee){const {chatId:_0x5017a6}=_0x227fee;_0x54b721=GroupChatMsg['find']({'meetingId':_0x3981f0[_0x253d1a(0x212)],'chatId':_0x5017a6},{'sort':[_0x253d1a(0x211)]})[_0x253d1a(0x247)]();}return reduceAndMapGroupMessages(_0x54b721,[]);},isChatLocked=_0x16245b=>{const _0x14b708=_0x351203,_0x1a2992={'FKOAa':function(_0x3c03f3,_0x541cef){return _0x3c03f3===_0x541cef;},'YpWAN':function(_0x3a9b11,_0x1d8799){return _0x3a9b11!==_0x1d8799;}},_0xd20131=_0x1a2992[_0x14b708(0x227)](_0x16245b,PUBLIC_CHAT_ID),_0x4917a6=_0x1c3f9d[_0x14b708(0x20c)]({'meetingId':_0x3981f0['meetingID']},{'fields':{'lockSettingsProps.disablePublicChat':0x1,'lockSettingsProps.disablePrivateChat':0x1}}),_0x30c82c=_0x12d527[_0x14b708(0x20c)]({'meetingId':_0x3981f0[_0x14b708(0x212)],'userId':_0x3981f0[_0x14b708(0x1f3)]},{'fields':{'locked':0x1,'role':0x1}}),_0x19d717=_0x12d527[_0x14b708(0x20c)]({'meetingId':_0x3981f0[_0x14b708(0x212)],'userId':_0x16245b},{'fields':{'role':0x1}}),_0x20d3ae=_0x19d717&&_0x19d717[_0x14b708(0x234)]===ROLE_MODERATOR;if(_0x1a2992[_0x14b708(0x22e)](_0x4917a6[_0x14b708(0x1f8)],undefined)){if(_0x30c82c['locked']&&_0x1a2992['YpWAN'](_0x30c82c['role'],ROLE_MODERATOR)){if(_0xd20131)return _0x4917a6['lockSettingsProps']['disablePublicChat'];return!_0x20d3ae&&_0x4917a6[_0x14b708(0x1f8)][_0x14b708(0x241)];}}return![];},hasUnreadMessages=_0x1a063e=>{const _0x209caf=_0x351203,_0x47e9e7={'TCsSo':function(_0x85e04d,_0x4d8509){return _0x85e04d===_0x4d8509;},'LsXax':function(_0x111d6d,_0x2dd668){return _0x111d6d>_0x2dd668;}},_0x3c72e6=_0x47e9e7['TCsSo'](_0x1a063e,PUBLIC_CHAT_ID),_0x4df175=_0x3c72e6?PUBLIC_GROUP_CHAT_ID:_0x1a063e;return _0x47e9e7[_0x209caf(0x20a)](_0x30edc3[_0x209caf(0x23b)](_0x4df175),0x0);},lastReadMessageTime=_0x193183=>{const _0x5ddd0e=_0x351203,_0x12d052={'Vfkvx':function(_0x48a6e9,_0x374d9f){return _0x48a6e9===_0x374d9f;}},_0x1bab2e=_0x12d052[_0x5ddd0e(0x1fe)](_0x193183,PUBLIC_CHAT_ID),_0x538db0=_0x1bab2e?PUBLIC_GROUP_CHAT_ID:_0x193183;return _0x30edc3[_0x5ddd0e(0x21d)](_0x538db0);},sendGroupMessage=_0x30821d=>{const _0x5819a4=_0x351203,_0x2212d7={'xxCWW':function(_0x3bf28b,_0x5353d4){return _0x3bf28b===_0x5353d4;},'NJwfS':_0x5819a4(0x214),'GuQtn':function(_0x3513ab,_0xed5495,_0x1646b3,_0x4e1310){return _0x3513ab(_0xed5495,_0x1646b3,_0x4e1310);}},_0x117510=Session['get'](_0x5819a4(0x1ed)),_0x5ab836=_0x117510===PUBLIC_CHAT_ID;let _0x2d0ea1=PUBLIC_GROUP_CHAT_ID;const {fullname:_0x3e6f39,userID:_0x3571d3}=_0x3981f0,_0x4baa76={'id':_0x117510};if(!_0x5ab836){const _0x33ec50=_0x268209['findOne']({'users':{'$all':[_0x117510,_0x3571d3]}},{'fields':{'chatId':0x1}});if(_0x33ec50){const {chatId:_0x1e1c3d}=_0x33ec50;_0x2d0ea1=_0x1e1c3d;}}const _0x270af1={'color':'0','correlationId':_0x3571d3+'-'+Date[_0x5819a4(0x206)](),'sender':{'id':_0x3571d3,'name':_0x3e6f39},'message':_0x30821d},_0x238955=_0x21f05e[_0x5819a4(0x238)](CLOSED_CHAT_LIST_KEY);if(_0x2bdc2b[_0x5819a4(0x20e)](_0x238955,_0x4baa76['id'])>-0x1){if(_0x2212d7[_0x5819a4(0x233)](_0x2212d7[_0x5819a4(0x1ee)],_0x5819a4(0x214)))_0x21f05e[_0x5819a4(0x1f4)](CLOSED_CHAT_LIST_KEY,_0x2bdc2b['without'](_0x238955,_0x4baa76['id']));else{const _0x45d0f9=_0x1b7e76[_0x5819a4(0x228)](_0x5819a4(0x1f9));_0x45d0f9[_0x5819a4(0x205)]=_0x1d0940;const _0x3c0d88=_0x436a5c[_0x5819a4(0x204)](_0x45d0f9[_0x5819a4(0x21b)]),_0x4bd7fe=_0x3c0d88[_0x5819a4(0x224)](_0x383752=>_0x383752[_0x5819a4(0x22b)]);return _0x4bd7fe[_0x5819a4(0x226)]('');}}return _0x2212d7[_0x5819a4(0x202)](makeCall,_0x5819a4(0x23c),_0x2d0ea1,_0x270af1);},getScrollPosition=_0x3fcfbf=>{const _0x2135d8=_0x351203,_0x35db4d=ScrollCollection[_0x2135d8(0x20c)]({'receiver':_0x3fcfbf},{'fields':{'position':0x1}})||{'position':null};return _0x35db4d[_0x2135d8(0x203)];},updateScrollPosition=_0x1768db=>ScrollCollection[_0x351203(0x243)]({'receiver':Session[_0x351203(0x21d)](_0x351203(0x1ed))},{'$set':{'position':_0x1768db}}),updateUnreadMessage=_0x3308da=>{const _0x541994=_0x351203,_0x5b47a6={'TGsCk':_0x541994(0x1ed)},_0x2c6e47=Session[_0x541994(0x21d)](_0x5b47a6[_0x541994(0x200)]),_0x5e2f4c=_0x2c6e47===PUBLIC_CHAT_ID,_0x45dd03=_0x5e2f4c?PUBLIC_GROUP_CHAT_ID:_0x2c6e47;return _0x30edc3[_0x541994(0x1f2)](_0x45dd03,_0x3308da);},clearPublicChatHistory=()=>makeCall('clearPublicChatHistory'),closePrivateChat=()=>{const _0xf9f89e=_0x351203,_0x512238=Session[_0xf9f89e(0x21d)]('idChatOpen'),_0x3d8d5c=_0x21f05e['getItem'](CLOSED_CHAT_LIST_KEY)||[];_0x2bdc2b[_0xf9f89e(0x20e)](_0x3d8d5c,_0x512238)<0x0&&(_0x3d8d5c[_0xf9f89e(0x1f7)](_0x512238),_0x21f05e['setItem'](CLOSED_CHAT_LIST_KEY,_0x3d8d5c));},removeFromClosedChatsSession=()=>{const _0xf15d8e=_0x351203,_0x38ea64={'OzvAc':function(_0x51b658,_0xfdfa49){return _0x51b658>_0xfdfa49;}},_0x2362cc=Session[_0xf15d8e(0x21d)](_0xf15d8e(0x1ed)),_0x3e2ab6=_0x21f05e['getItem'](CLOSED_CHAT_LIST_KEY);_0x38ea64[_0xf15d8e(0x21c)](_0x2bdc2b[_0xf15d8e(0x20e)](_0x3e2ab6,_0x2362cc),-0x1)&&_0x21f05e[_0xf15d8e(0x1f4)](CLOSED_CHAT_LIST_KEY,_0x2bdc2b[_0xf15d8e(0x23f)](_0x3e2ab6,_0x2362cc));},htmlDecode=_0x556c11=>{const _0x49832b=_0x351203,_0x27e8ef={'dHoRj':_0x49832b(0x1f9)},_0x17c760=document[_0x49832b(0x228)](_0x27e8ef[_0x49832b(0x231)]);_0x17c760['innerHTML']=_0x556c11;const _0x5aac70=Array[_0x49832b(0x204)](_0x17c760[_0x49832b(0x21b)]),_0x3e8739=_0x5aac70[_0x49832b(0x224)](_0x4606db=>_0x4606db[_0x49832b(0x22b)]);return _0x3e8739[_0x49832b(0x226)]('');},exportChat=_0x4bd522=>{const _0x4bf60c=_0x351203,_0x5d2a6c={'PGelG':function(_0x2bf96b,_0x2440d9){return _0x2bf96b===_0x2440d9;},'TjyYq':_0x4bf60c(0x208),'ctqVS':'famWD','JcfGk':function(_0x5c8905,_0x4751cb){return _0x5c8905(_0x4751cb);},'azFDP':function(_0x5f4a23,_0x302b18){return _0x5f4a23<_0x302b18;}},{welcomeProp:_0x4e0490}=getWelcomeProp(),{loginTime:_0x5e3be4}=_0x12d527[_0x4bf60c(0x20c)]({'userId':_0x3981f0['userID']},{'fields':{'loginTime':0x1}}),{welcomeMsg:_0x22333c}=_0x4e0490,_0x28bd94=_0x4bd522[_0x4bf60c(0x22d)](_0x2e9a56=>_0x2e9a56[_0x4bf60c(0x1f1)]===PUBLIC_CHAT_CLEAR),_0x2ab3cc=_0x28bd94[_0x4bf60c(0x225)];return(!_0x2ab3cc||_0x2ab3cc&&_0x5d2a6c[_0x4bf60c(0x229)](_0x28bd94[0x0][_0x4bf60c(0x211)],_0x5e3be4))&&_0x4bd522[_0x4bf60c(0x1f7)]({'timestamp':_0x5e3be4,'message':_0x22333c,'type':SYSTEM_CHAT_TYPE,'sender':PUBLIC_CHAT_USER_ID}),_0x4bd522['sort']((_0x5790da,_0x58c86f)=>_0x5790da['timestamp']-_0x58c86f['timestamp']),_0x4bd522[_0x4bf60c(0x224)](_0x1dc7a3=>{const _0x323fa4=_0x4bf60c,_0x72ba7a=new Date(_0x1dc7a3[_0x323fa4(0x211)]),_0x2d0aa3=_0x72ba7a[_0x323fa4(0x1f0)]()['toString']()[_0x323fa4(0x22a)](0x2,0x0),_0x2c3185=_0x72ba7a[_0x323fa4(0x1fc)]()[_0x323fa4(0x244)]()[_0x323fa4(0x22a)](0x2,0x0),_0x3c8922='['+_0x2d0aa3+':'+_0x2c3185+']';if(_0x5d2a6c[_0x323fa4(0x237)](_0x1dc7a3[_0x323fa4(0x21e)],SYSTEM_CHAT_TYPE))return _0x5d2a6c[_0x323fa4(0x20f)]===_0x5d2a6c[_0x323fa4(0x22c)]?_0x9c63a8[_0x323fa4(0x245)](_0x194471):_0x3c8922+'\x20'+_0x1dc7a3['message'];const _0x4a0038=_0x1dc7a3[_0x323fa4(0x236)]===PUBLIC_CHAT_USER_ID?'':_0x5d2a6c[_0x323fa4(0x1ef)](getUser,_0x1dc7a3[_0x323fa4(0x236)])[_0x323fa4(0x207)]+'\x20:';return _0x3c8922+'\x20'+_0x4a0038+'\x20'+htmlDecode(_0x1dc7a3[_0x323fa4(0x1f1)]);})['join']('\x0a');},getAllMessages=_0x22812b=>{const _0x3a4f70=_0x351203,_0x1bdb65={'sender':{'$ne':_0x3981f0[_0x3a4f70(0x1f3)]}};if(_0x22812b===PUBLIC_GROUP_CHAT_ID)_0x1bdb65[_0x3a4f70(0x246)]={'$eq':_0x22812b};else{const _0x30df5c=_0x268209[_0x3a4f70(0x20c)]({'users':{'$all':[_0x22812b,_0x3981f0[_0x3a4f70(0x1f3)]]}});_0x1bdb65['chatId']={'$ne':PUBLIC_GROUP_CHAT_ID},_0x30df5c&&(_0x1bdb65[_0x3a4f70(0x246)]=_0x30df5c[_0x3a4f70(0x246)]);}const _0x7ea759=GroupChatMsg[_0x3a4f70(0x23e)](_0x1bdb65)[_0x3a4f70(0x247)]();return _0x7ea759;},maxTimestampReducer=(_0x21d8b,_0x4a1cf1)=>_0x4a1cf1[_0x351203(0x211)]>_0x21d8b?_0x4a1cf1[_0x351203(0x211)]:_0x21d8b,maxNumberReducer=(_0xcc9ac5,_0x2947c7)=>_0x2947c7>_0xcc9ac5?_0x2947c7:_0xcc9ac5,getLastMessageTimestampFromChatList=_0x677f9d=>_0x677f9d[_0x351203(0x224)](_0x349702=>_0x349702[_0x351203(0x201)]===_0x351203(0x20d)?_0x351203(0x21a):_0x349702['userId'])[_0x351203(0x224)](_0x35c615=>getAllMessages(_0x35c615)[_0x351203(0x209)](maxTimestampReducer,0x0))['reduce'](maxNumberReducer,0x0);function _0x1bec(){const _0x4398e2=['system_userid','timestamp','meetingID','FsCud','AIqYH','1730968meBUXO','role_moderator','system_messages_keys','settings','716674pnLqgS','MAIN-PUBLIC-GROUP-CHAT','childNodes','OzvAc','get','type','EwCdd','type_private','vLkcU','disablePublicChat','MSeZo','map','length','join','FKOAa','createElement','azFDP','padStart','textContent','ctqVS','filter','YpWAN','chmEP','rcCqc','dHoRj','549622DtlFHz','xxCWW','role','Kghed','sender','PGelG','getItem','grouping_messages_window','3544734OyCLfk','count','sendGroupChatMsg','public_id','find','without','Collection','disablePrivateChat','PgmZd','upsert','toString','concat','chatId','fetch','732074meKwZG','4952510JFUugC','idChatOpen','NJwfS','JcfGk','getHours','message','update','userID','setItem','383250WBZCVh','type_system','push','lockSettingsProps','div','closedChatList','online','getMinutes','content','Vfkvx','time','TGsCk','userId','GuQtn','position','from','innerHTML','now','name','AhmQK','reduce','LsXax','chat_clear','findOne','public','indexOf','TjyYq'];_0x1bec=function(){return _0x4398e2;};return _0x1bec();}export default{'reduceAndMapGroupMessages':reduceAndMapGroupMessages,'getPublicGroupMessages':getPublicGroupMessages,'getPrivateGroupMessages':getPrivateGroupMessages,'getUser':getUser,'getWelcomeProp':getWelcomeProp,'getScrollPosition':getScrollPosition,'hasUnreadMessages':hasUnreadMessages,'lastReadMessageTime':lastReadMessageTime,'isChatLocked':isChatLocked,'updateScrollPosition':updateScrollPosition,'updateUnreadMessage':updateUnreadMessage,'sendGroupMessage':sendGroupMessage,'closePrivateChat':closePrivateChat,'removeFromClosedChatsSession':removeFromClosedChatsSession,'exportChat':exportChat,'clearPublicChatHistory':clearPublicChatHistory,'maxTimestampReducer':maxTimestampReducer,'getLastMessageTimestampFromChatList':getLastMessageTimestampFromChatList,'UnsentMessagesCollection':UnsentMessagesCollection};