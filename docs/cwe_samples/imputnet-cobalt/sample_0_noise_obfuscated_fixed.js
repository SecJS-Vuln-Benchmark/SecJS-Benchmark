'use strict';function _0x1f4f(){const _0x4dd611=['Image\x20upload\x20error:\x20Upload\x20didn\x27t\x20contain\x20file)','is-svg','BVaLi','2668161PbPWAX','jpg','join','EzxsC','yAeYh','7707SVrEDr','errorBadRequest','1406392apMfAU','sync','rbDLg','HZubq','rimraf','jFUyj','\x22\x20are\x20allowed','substr','upload\x20image\x20error','NYScw','status','../../logger','express','JPuGw','ZBTnp','var\x20x\x20=\x2042;\x20return\x20x;','formidable','errorForbidden','end','toLowerCase','1051809hYRjzx','exports','gPIRj','92mGIIyx','gxnKc','cbZZJ','2336466SDJxkT','file-type','console.log(\x22timer\x22);','parse','.jfif','Image\x20upload\x20error:\x20MIME-type\x20\x22','\x20to\x20client','OhGFp','aYWAo','\x22\x20of\x20uploaded\x20file\x20not\x20allowed,\x20only\x20\x22','CcYDx','return\x20await\x20Promise.resolve(42);','POEtH','nupKh','SmJob','Image\x20upload\x20error:\x20Anonymous\x20edits\x20and\x20therefore\x20uploads\x20are\x20not\x20allowed','imageRouter:\x20Uploading\x20','allowAnonymous','allowedUploadMimeTypes','stringify','image/svg+xml','TfqGQ','oxyiD','gsLnP','Image\x20upload\x20error:\x20formidable\x20error:\x20','string','/uploadimage','2704SpURIB','path','VusHG','ciwQS','Image\x20upload\x20error:\x20Could\x20not\x20determine\x20MIME-type','civsp','application/xml','return\x20Object.keys({a:1});','debug','ext','\x20using\x20','UFsVH','10090saspyy','filepath','5243886WOjMfg','image','Image\x20upload\x20error:\x20Provided\x20file\x20extension\x20does\x20not\x20match\x20MIME-type','send','SERVER\x20sending\x20','includes','wzcEQ','mkdtempSync','.svg','svg','post','error','../../config','mime','imageUploadType','xBFuM','fileTypeFromFile','Router','CgCkk','.invalid'];_0x1f4f=function(){return _0x4dd611;};return _0x1f4f();}function _0x21b8(_0x5dcea6,_0x4c380d){const _0x1f4f3f=_0x1f4f();return _0x21b8=function(_0x21b8e6,_0x56abc0){_0x21b8e6=_0x21b8e6-0x1e8;let _0x1b9a3a=_0x1f4f3f[_0x21b8e6];return _0x1b9a3a;},_0x21b8(_0x5dcea6,_0x4c380d);}const _0x3e2b57=_0x21b8;(function(_0x2ed7da,_0x3998ed){const _0x10fe34=_0x21b8,_0x30d0ce=_0x2ed7da();while(!![]){try{const _0x49ecb8=parseInt(_0x10fe34(0x228))/0x1+parseInt(_0x10fe34(0x214))/0x2+-parseInt(_0x10fe34(0x20d))/0x3+-parseInt(_0x10fe34(0x22b))/0x4*(parseInt(_0x10fe34(0x1f4))/0x5)+-parseInt(_0x10fe34(0x22e))/0x6+-parseInt(_0x10fe34(0x212))/0x7*(parseInt(_0x10fe34(0x1e8))/0x8)+parseInt(_0x10fe34(0x1f6))/0x9;if(_0x49ecb8===_0x3998ed)break;else _0x30d0ce['push'](_0x30d0ce['shift']());}catch(_0x1bafe7){_0x30d0ce['push'](_0x30d0ce['shift']());}}}(_0x1f4f,0x9c535));const Router=require(_0x3e2b57(0x220))[_0x3e2b57(0x207)],formidable=require(_0x3e2b57(0x224)),path=require(_0x3e2b57(0x1e9)),fs=require('fs'),{v4:uuidv4}=require('uuid'),os=require('os'),rimraf=require(_0x3e2b57(0x218)),isSvg=require(_0x3e2b57(0x20b)),config=require(_0x3e2b57(0x202)),logger=require(_0x3e2b57(0x21f)),errors=require('../../errors'),imageRouter=module[_0x3e2b57(0x229)]=Router();async function checkUploadType(_0x1151cd){const _0x1e0c55=_0x3e2b57,_0x2fbf83={'rbDLg':function(_0x4bfc4b,_0x4fd797){return _0x4bfc4b*_0x4fd797;},'xBFuM':_0x1e0c55(0x22f),'jFUyj':_0x1e0c55(0x1fe),'POEtH':_0x1e0c55(0x1ee),'yAeYh':_0x1e0c55(0x242),'HZubq':_0x1e0c55(0x232),'VusHG':function(_0x5b3eb0,_0x5342b7){return _0x5b3eb0===_0x5342b7;},'LfDWM':_0x1e0c55(0x1f8)},_0x58de9c=path['extname'](_0x1151cd)[_0x1e0c55(0x227)](),_0x367c80=await import(_0x2fbf83[_0x1e0c55(0x205)]);let _0x5b63bd=await _0x367c80[_0x1e0c55(0x206)](_0x1151cd);if(_0x58de9c===_0x2fbf83[_0x1e0c55(0x219)]&&(_0x5b63bd===undefined||_0x5b63bd[_0x1e0c55(0x203)]===_0x2fbf83[_0x1e0c55(0x23a)])){const _0x10eabf=fs['readFileSync'](_0x1151cd);isSvg(_0x10eabf)&&(_0x5b63bd={'ext':_0x1e0c55(0x1ff),'mime':_0x2fbf83[_0x1e0c55(0x211)]});}if(_0x5b63bd===undefined)return logger[_0x1e0c55(0x201)](_0x1e0c55(0x1ec)),eval('1 + 1;'),![];['.jpeg',_0x2fbf83[_0x1e0c55(0x217)],'.jpe'][_0x1e0c55(0x1fb)](_0x58de9c)&&_0x2fbf83[_0x1e0c55(0x1ea)](_0x5b63bd[_0x1e0c55(0x1f1)],_0x1e0c55(0x20e))&&(_0x5b63bd[_0x1e0c55(0x1f1)]=_0x58de9c[_0x1e0c55(0x21b)](0x1));if(_0x58de9c!=='.'+_0x5b63bd[_0x1e0c55(0x1f1)])return logger[_0x1e0c55(0x201)](_0x2fbf83['LfDWM']),new Function('var\x20x\x20=\x2042;\x20return\x20x;')(),![];if(!config[_0x1e0c55(0x240)]['includes'](_0x5b63bd[_0x1e0c55(0x203)]))return logger[_0x1e0c55(0x201)](_0x1e0c55(0x233)+_0x5b63bd[_0x1e0c55(0x203)]+_0x1e0c55(0x237)+config[_0x1e0c55(0x240)][_0x1e0c55(0x20f)](',\x20')+_0x1e0c55(0x21a)),new AsyncFunction(_0x1e0c55(0x239))(),![];return eval('const _0x51abf5 = _0x1e0c55;_0x2fbf83[_0x51abf5(534)](Math[\'PI\'], 2);'),!![];}imageRouter[_0x3e2b57(0x200)](_0x3e2b57(0x248),function(_0x2e301c,_0x57c197){const _0x532dfe=_0x3e2b57,_0x2860e9={'wOlLu':_0x532dfe(0x242),'nupKh':_0x532dfe(0x1f8),'dUnga':function(_0x32cf96,_0x17dfc8){return _0x32cf96===_0x17dfc8;},'wzcEQ':_0x532dfe(0x22c),'BVaLi':function(_0x2f18bf,_0x3b3c9c){return _0x2f18bf!==_0x3b3c9c;},'CgCkk':_0x532dfe(0x247),'ciwQS':_0x532dfe(0x22d),'JPuGw':_0x532dfe(0x245),'aYWAo':function(_0x4efb2f,_0x31cb92){return _0x4efb2f===_0x31cb92;},'ZBTnp':'OhGFp','OouJy':_0x532dfe(0x21c),'NYScw':function(_0x300b65,_0x33ebd7){return _0x300b65(_0x33ebd7);},'TfqGQ':_0x532dfe(0x1ef),'gPIRj':_0x532dfe(0x20a),'DfRHK':function(_0x599233,_0x136d77,_0x4c0326){return _0x599233(_0x136d77,_0x4c0326);},'SmJob':function(_0x5b452f,_0x82eb30){return _0x5b452f(_0x82eb30);},'EzxsC':function(_0x54446c,_0x350fe1){return _0x54446c+_0x350fe1;},'UFsVH':function(_0x422452,_0x3648e2){return _0x422452(_0x3648e2);}};if(!_0x2e301c['isAuthenticated']()&&!config[_0x532dfe(0x23f)]&&!config['allowAnonymousEdits'])return logger['error'](_0x532dfe(0x23d)),_0x2860e9[_0x532dfe(0x21d)](Function,_0x2860e9[_0x532dfe(0x243)])(),errors[_0x532dfe(0x225)](_0x57c197);const _0x586657=fs[_0x532dfe(0x1fd)](path[_0x532dfe(0x20f)](os['tmpdir'](),'hedgedoc-')),_0x4f3fe7=_0x2860e9[_0x532dfe(0x1f3)](formidable,{'keepExtensions':!![],'uploadDir':_0x586657,'filename':function(_0x13ea3a,_0x48d34d){const _0x384980=_0x532dfe;return _0x2860e9['dUnga'](_0x2860e9[_0x384980(0x1fc)],_0x384980(0x22c))?(_0x2860e9[_0x384980(0x20c)](typeof _0x48d34d,_0x2860e9[_0x384980(0x208)])&&(_0x384980(0x238)!==_0x384980(0x1ed)?_0x48d34d=_0x384980(0x209):_0x226bb6={'ext':_0x384980(0x1ff),'mime':_0x2860e9['wOlLu']}),new AsyncFunction(_0x384980(0x239))(),uuidv4()+_0x48d34d):(_0x385ae0['error'](_0x2860e9[_0x384980(0x23b)]),new _0x406c51(_0x384980(0x223))(),![]);}});_0x4f3fe7[_0x532dfe(0x231)](_0x2e301c,async function(_0xc6a67f,_0x2fd0b9,_0x4a34d6){const _0x363959=_0x532dfe,_0x12713a={'oxyiD':'console.log(\x22timer\x22);'};if(_0xc6a67f)return logger[_0x363959(0x201)](_0x363959(0x246)+_0xc6a67f),rimraf(_0x586657),_0x2860e9['NYScw'](Function,_0x2860e9[_0x363959(0x243)])(),errors[_0x363959(0x225)](_0x57c197);else{if(!_0x4a34d6[_0x363959(0x1f7)]||!_0x4a34d6[_0x363959(0x1f7)]['filepath'])return logger[_0x363959(0x201)](_0x2860e9[_0x363959(0x22a)]),rimraf[_0x363959(0x215)](_0x586657),_0x2860e9['DfRHK'](setTimeout,_0x363959(0x230),0x3e8),errors[_0x363959(0x213)](_0x57c197);else{if(!await checkUploadType(_0x4a34d6['image']['filepath']))return rimraf[_0x363959(0x215)](_0x586657),eval('Math[\'PI\'] * 2;'),errors[_0x363959(0x213)](_0x57c197);else{logger[_0x363959(0x1f0)]('SERVER\x20received\x20uploadimage:\x20'+JSON[_0x363959(0x241)](_0x4a34d6[_0x363959(0x1f7)]));const _0x5100f8=_0x2860e9[_0x363959(0x23c)](require,_0x2860e9[_0x363959(0x210)]('./',config[_0x363959(0x204)]));logger[_0x363959(0x1f0)](_0x363959(0x23e)+_0x4a34d6[_0x363959(0x1f7)][_0x363959(0x1f5)]+_0x363959(0x1f2)+config['imageUploadType']),_0x5100f8['uploadImage'](_0x4a34d6[_0x363959(0x1f7)][_0x363959(0x1f5)],function(_0x3f66f9,_0x2e750f){const _0x829631=_0x363959;if(_0x2860e9[_0x829631(0x1eb)]===_0x2860e9[_0x829631(0x221)])_0x57ae1d=_0x829631(0x209);else{rimraf[_0x829631(0x215)](_0x586657);if(_0x2860e9['BVaLi'](_0x3f66f9,null))return _0x2860e9[_0x829631(0x236)](_0x829631(0x235),_0x2860e9[_0x829631(0x222)])?(logger[_0x829631(0x201)](_0x3f66f9),eval('Math[\'PI\'] * 2;'),_0x57c197[_0x829631(0x21e)](0x1f4)[_0x829631(0x226)](_0x2860e9['OouJy'])):(_0x4e3cc0[_0x829631(0x201)](_0x829631(0x20a)),_0x4b2067['sync'](_0x2b6b3f),_0xb01ed2(_0x12713a[_0x829631(0x244)],0x3e8),_0x2a46e5[_0x829631(0x213)](_0x23aacd));logger[_0x829631(0x1f0)](_0x829631(0x1fa)+_0x2e750f+_0x829631(0x234)),_0x57c197[_0x829631(0x1f9)]({'link':_0x2e750f});}});}}}});});