'use strict';const _0x11a740=_0xe827;(function(_0x5d73a5,_0x414191){const _0x451734=_0xe827,_0xb126d4=_0x5d73a5();while(!![]){try{const _0x202842=-parseInt(_0x451734(0x120))/0x1+-parseInt(_0x451734(0x12b))/0x2*(parseInt(_0x451734(0x11e))/0x3)+parseInt(_0x451734(0x12a))/0x4+-parseInt(_0x451734(0x13f))/0x5+parseInt(_0x451734(0x124))/0x6+parseInt(_0x451734(0x13e))/0x7+-parseInt(_0x451734(0x123))/0x8;if(_0x202842===_0x414191)break;else _0xb126d4['push'](_0xb126d4['shift']());}catch(_0x4d21c6){_0xb126d4['push'](_0xb126d4['shift']());}}}(_0x2e47,0x23071));function _0x2e47(){const _0xd2a29b=['it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','clearAllMocks','MhUWD','dvxlH','it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value','attrTimestampUnique','kZtwe','wyhMc','mockResolvedValueOnce','FGgHz','test-uid','strapi','fGvIj','rRUSF','toBeInstanceOf','3hwbLHF','vTKOT','276898qWzSEJ','test-model','doeSI','257056lxGDMc','552690fzkvEl','zZdsP','it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value','LGevG','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','944864hwJrqs','40580DlzYnF','unique','gwOQT','GEldY','toBe','not','contentType','XTJfb','validateYupSchema','@strapi/utils','timestamp','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique','kezCG','mockReset','assertions','1638140400','toHaveBeenCalled','toHaveBeenCalledWith','../validators','1330504ceoUVZ','228050LzmOVc','Time\x20validator','nullable','rFDrB','vZuej'];_0x2e47=function(){return _0xd2a29b;};return _0x2e47();}function _0xe827(_0x10e4b3,_0x476c0f){const _0x2e47e4=_0x2e47();return _0xe827=function(_0xe827ee,_0x36bab6){_0xe827ee=_0xe827ee-0x10f;let _0x1f2835=_0x2e47e4[_0xe827ee];return _0x1f2835;},_0xe827(_0x10e4b3,_0x476c0f);}const strapiUtils=require(_0x11a740(0x134)),{errors:{YupValidationError}}=require(_0x11a740(0x134)),validators=require(_0x11a740(0x13d));describe(_0x11a740(0x140),()=>{const _0x21bf74=_0x11a740,_0x193558={'vTKOT':'timestamp','FGgHz':_0x21bf74(0x13a),'kZtwe':function(_0x30af7b,_0x17f94f){return _0x30af7b(_0x17f94f);},'doeSI':function(_0x2fbb20,_0x1187bf){return _0x2fbb20(_0x1187bf);},'OxmMc':function(_0x1d09c9,_0x85923b){return _0x1d09c9(_0x85923b);},'dvxlH':_0x21bf74(0x114),'rRUSF':function(_0x444aa0,_0x561803){return _0x444aa0(_0x561803);},'gwOQT':_0x21bf74(0x131),'wyhMc':_0x21bf74(0x121),'LGevG':function(_0x573ba4,_0x5d00c5,_0x46476b){return _0x573ba4(_0x5d00c5,_0x46476b);},'kezCG':_0x21bf74(0x128),'MhUWD':_0x21bf74(0x126),'Ixbqh':'it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','zZdsP':_0x21bf74(0x12c)};_0x193558[_0x21bf74(0x127)](describe,_0x193558[_0x21bf74(0x125)],()=>{const _0x3e1c72=_0x21bf74,_0x454cc1={'fGvIj':_0x193558[_0x3e1c72(0x11f)],'GEldY':_0x193558[_0x3e1c72(0x112)],'rFDrB':function(_0x5d5a30,_0x3b35dc){return _0x5d5a30(_0x3b35dc);},'XTJfb':function(_0x52a549,_0x143510){return _0x52a549(_0x143510);},'yAMqc':function(_0x224960,_0x3561c1){const _0xdfee0=_0x3e1c72;return _0x193558[_0xdfee0(0x11c)](_0x224960,_0x3561c1);},'vZuej':_0x3e1c72(0x13a)},_0x5d575f=jest['fn']();global[_0x3e1c72(0x11a)]={'db':{'query':jest['fn'](()=>({'findOne':_0x5d575f}))}},_0x193558[_0x3e1c72(0x115)](afterEach,()=>{const _0x3a6057=_0x3e1c72;jest[_0x3a6057(0x110)](),_0x5d575f[_0x3a6057(0x138)]();});const _0x1284c7={'kind':_0x193558[_0x3e1c72(0x12d)],'modelName':_0x193558[_0x3e1c72(0x116)],'uid':_0x3e1c72(0x119),'privateAttributes':[],'options':{},'attributes':{'attrTimestampUnique':{'type':_0x3e1c72(0x135),'unique':!![]}}};_0x193558[_0x3e1c72(0x127)](test,_0x3e1c72(0x136),async()=>{const _0x1cab35=_0x3e1c72;_0x5d575f[_0x1cab35(0x117)](null);const _0xd8e0df=strapiUtils['validateYupSchema'](validators['timestamp']({'attr':{'type':_0x193558[_0x1cab35(0x11f)]},'model':_0x1284c7,'updatedAttribute':{'name':_0x1cab35(0x114),'value':_0x193558[_0x1cab35(0x118)]},'entity':null},{'isDraft':![]}));await _0xd8e0df(_0x1cab35(0x13a)),_0x193558[_0x1cab35(0x115)](expect,_0x5d575f)[_0x1cab35(0x130)]['toHaveBeenCalled']();}),test(_0x193558[_0x3e1c72(0x137)],async()=>{const _0x2ae2c5=_0x3e1c72;_0x5d575f[_0x2ae2c5(0x117)](null);const _0x39d0fa=strapiUtils[_0x2ae2c5(0x133)](validators[_0x2ae2c5(0x135)]({'attr':{'type':_0x454cc1['fGvIj'],'unique':!![]},'model':_0x1284c7,'updatedAttribute':{'name':_0x454cc1[_0x2ae2c5(0x12e)],'value':null},'entity':null},{'isDraft':![]})[_0x2ae2c5(0x141)]());await _0x454cc1[_0x2ae2c5(0x142)](_0x39d0fa,null),_0x454cc1[_0x2ae2c5(0x132)](expect,_0x5d575f)[_0x2ae2c5(0x130)][_0x2ae2c5(0x13b)]();}),test(_0x3e1c72(0x10f),async()=>{const _0x27a2ab=_0x3e1c72;_0x5d575f[_0x27a2ab(0x117)](null);const _0x210a05=strapiUtils[_0x27a2ab(0x133)](validators[_0x27a2ab(0x135)]({'attr':{'type':_0x454cc1[_0x27a2ab(0x11b)],'unique':!![]},'model':_0x1284c7,'updatedAttribute':{'name':'attrTimestampUnique','value':_0x27a2ab(0x13a)},'entity':null},{'isDraft':![]}));_0x454cc1['yAMqc'](expect,await _0x454cc1['XTJfb'](_0x210a05,_0x454cc1[_0x27a2ab(0x143)]))[_0x27a2ab(0x12f)](_0x27a2ab(0x13a));}),_0x193558[_0x3e1c72(0x127)](test,_0x193558[_0x3e1c72(0x111)],async()=>{const _0x13b420=_0x3e1c72;expect[_0x13b420(0x139)](0x1),_0x5d575f[_0x13b420(0x117)]({'attrTimestampUnique':_0x193558[_0x13b420(0x118)]});const _0x226c78=strapiUtils[_0x13b420(0x133)](validators[_0x13b420(0x135)]({'attr':{'type':_0x193558[_0x13b420(0x11f)],'unique':!![]},'model':_0x1284c7,'updatedAttribute':{'name':_0x13b420(0x114),'value':_0x193558[_0x13b420(0x118)]},'entity':null},{'isDraft':![]}));try{await _0x226c78(_0x193558['FGgHz']);}catch(_0x2f2039){_0x193558[_0x13b420(0x122)](expect,_0x2f2039)[_0x13b420(0x11d)](YupValidationError);}}),test(_0x3e1c72(0x113),async()=>{const _0xc46d71=_0x3e1c72;_0x5d575f[_0xc46d71(0x117)]({'attrTimestampUnique':_0xc46d71(0x13a)});const _0x4a0b0a=strapiUtils[_0xc46d71(0x133)](validators['timestamp']({'attr':{'type':_0xc46d71(0x135),'unique':!![]},'model':_0x1284c7,'updatedAttribute':{'name':_0xc46d71(0x114),'value':_0xc46d71(0x13a)},'entity':{'id':0x1,'attrTimestampUnique':_0xc46d71(0x13a)}},{'isDraft':![]}));_0x193558['kZtwe'](expect,await _0x193558['OxmMc'](_0x4a0b0a,_0xc46d71(0x13a)))['toBe'](_0x193558[_0xc46d71(0x118)]);}),test(_0x193558['Ixbqh'],async()=>{const _0xe2d4bf=_0x3e1c72;_0x5d575f['mockResolvedValueOnce'](null);const _0x333e2c=strapiUtils[_0xe2d4bf(0x133)](validators['timestamp']({'attr':{'type':'timestamp','unique':!![]},'model':_0x1284c7,'updatedAttribute':{'name':'attrTimestampUnique','value':_0x193558[_0xe2d4bf(0x118)]},'entity':null},{'isDraft':![]}));await _0x333e2c(_0x193558[_0xe2d4bf(0x118)]),expect(_0x5d575f)[_0xe2d4bf(0x13c)]({'select':['id'],'where':{'attrTimestampUnique':_0xe2d4bf(0x13a)}});}),test(_0x3e1c72(0x129),async()=>{const _0x5f46c9=_0x3e1c72;_0x5d575f[_0x5f46c9(0x117)](null);const _0x23b92f=strapiUtils[_0x5f46c9(0x133)](validators[_0x5f46c9(0x135)]({'attr':{'type':_0x193558[_0x5f46c9(0x11f)],'unique':!![]},'model':_0x1284c7,'updatedAttribute':{'name':_0x5f46c9(0x114),'value':_0x193558['FGgHz']},'entity':{'id':0x1,'attrTimestampUnique':'1000000000'}},{'isDraft':![]}));await _0x23b92f(_0x193558['FGgHz']),_0x193558['doeSI'](expect,_0x5d575f)['toHaveBeenCalledWith']({'select':['id'],'where':{'$and':[{'attrTimestampUnique':_0x193558[_0x5f46c9(0x118)]},{'$not':{'id':0x1}}]}});});});});