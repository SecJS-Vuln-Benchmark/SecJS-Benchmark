const _0x458796=_0x2cfb;(function(_0x2d691f,_0x5f3e28){const _0x189cc1=_0x2cfb,_0x2e7e03=_0x2d691f();while(!![]){try{const _0x3f5505=-parseInt(_0x189cc1(0x18a))/0x1+-parseInt(_0x189cc1(0x166))/0x2*(-parseInt(_0x189cc1(0x1c9))/0x3)+parseInt(_0x189cc1(0x1b2))/0x4*(-parseInt(_0x189cc1(0x1a0))/0x5)+-parseInt(_0x189cc1(0x190))/0x6+-parseInt(_0x189cc1(0x19c))/0x7*(-parseInt(_0x189cc1(0x168))/0x8)+parseInt(_0x189cc1(0x151))/0x9+-parseInt(_0x189cc1(0x13e))/0xa;if(_0x3f5505===_0x5f3e28)break;else _0x2e7e03['push'](_0x2e7e03['shift']());}catch(_0x4a144b){_0x2e7e03['push'](_0x2e7e03['shift']());}}}(_0x4900,0x5940e));const bcrypt=require(_0x458796(0x1cd)),express=require(_0x458796(0x14b)),cors=require(_0x458796(0x1ca)),path=require(_0x458796(0x155)),uuid=require(_0x458796(0x1aa)),asyncfs=require('fs')['promises'],sessions=require(_0x458796(0x1d5)),favicon=require('serve-favicon'),database=require(_0x458796(0x150)),safeCompare=require(_0x458796(0x1b9)),{Op}=require('sequelize'),sequelize=database['sequelize'],Settings=database['Settings'],PayloadFireResults=database['PayloadFireResults'],CollectedPages=database[_0x458796(0x147)],InjectionRequests=database['InjectionRequests'],update_settings_value=database[_0x458796(0x137)],constants=require('./constants.js'),validate=require(_0x458796(0x164))['validate'],get_hashed_password=require(_0x458796(0x187))[_0x458796(0x16f)],get_secure_random_string=require(_0x458796(0x187))['get_secure_random_string'],SCREENSHOTS_DIR=path[_0x458796(0x140)](process['env'][_0x458796(0x165)]);function _0x2cfb(_0x4011b7,_0x28e04b){const _0x490061=_0x4900();return _0x2cfb=function(_0x2cfb7e,_0x11fa0c){_0x2cfb7e=_0x2cfb7e-0x134;let _0x589be0=_0x490061[_0x2cfb7e];return _0x589be0;},_0x2cfb(_0x4011b7,_0x28e04b);}var sessions_middleware=![],sessions_settings_object={'cookieName':_0x458796(0x153),'duration':0x7*0x18*0x3c*0x3c*0x3e8,'activeDuration':0x3e8*0x3c*0x5,'cookie':{'httpOnly':!![],'secure':!![]}};function session_wrapper_function(_0xc62f26,_0x42168a,_0x112b99){const _0x25dafe={'yrZok':function(_0x81c382,_0x4cb24c,_0x490f65,_0x1aab74){return _0x81c382(_0x4cb24c,_0x490f65,_0x1aab74);}};return _0x25dafe['yrZok'](sessions_middleware,_0xc62f26,_0x42168a,_0x112b99);}async function set_up_api_server(_0x5daa41){const _0x460c4b=_0x458796,_0x14ccc0={'AjQIl':_0x460c4b(0x159),'WbIJy':_0x460c4b(0x178),'vPFAU':function(_0x488bef){return _0x488bef();},'wktFC':function(_0x21f6a5,_0x1f012e){return _0x21f6a5===_0x1f012e;},'ZAzHZ':_0x460c4b(0x1d3),'ZMHRL':_0x460c4b(0x18b),'fcRKh':_0x460c4b(0x19d),'FgELw':_0x460c4b(0x17f),'vBmco':_0x460c4b(0x186),'SHwGw':function(_0x27891e,_0x11d48b){return _0x27891e===_0x11d48b;},'waknP':function(_0x3b64c5,_0x490adc){return _0x3b64c5===_0x490adc;},'jWEhw':function(_0xee5bca){return _0xee5bca();},'YZoRd':_0x460c4b(0x1cb),'PuYYQ':_0x460c4b(0x16d),'PWyMC':_0x460c4b(0x169),'bfbyI':function(_0x396b1d,_0x5a529d){return _0x396b1d===_0x5a529d;},'BWDne':_0x460c4b(0x13d),'cKvnW':function(_0x44c31b,_0x1e3337){return _0x44c31b==_0x1e3337;},'UtXCQ':_0x460c4b(0x1a6),'eaeUy':_0x460c4b(0x15b),'JJqsD':'screenshot_id','WNOAz':function(_0x4ccf4a,_0x816569){return _0x4ccf4a(_0x816569);},'KqGkj':function(_0x112f63,_0x597689){return _0x112f63*_0x597689;},'UBDhf':_0x460c4b(0x195),'aAQJQ':_0x460c4b(0x1b5),'xnuTQ':function(_0x3828f2,_0x2d5786,_0x4ce67d){return _0x3828f2(_0x2d5786,_0x4ce67d);},'tGEPX':_0x460c4b(0x16a),'fnukh':_0x460c4b(0x139),'Mdgum':function(_0x1d7430,_0x182644){return _0x1d7430!==_0x182644;},'Ekrir':_0x460c4b(0x15a),'bpmwZ':'correlation_api_key','voKYV':_0x460c4b(0x189),'dTNfG':function(_0x1cb74c){return _0x1cb74c();},'LAjDN':function(_0x566363,_0x565e8a){return _0x566363==_0x565e8a;},'pEOfW':function(_0x4d2f52,_0x4d814e){return _0x4d2f52!==_0x4d814e;},'miBEY':_0x460c4b(0x179),'ivJvm':function(_0x38fdfe,_0xb3da24){return _0x38fdfe(_0xb3da24);},'kxeaA':_0x460c4b(0x1d9),'jUvpZ':_0x460c4b(0x1ac),'BvnpL':function(_0x8c5bf8,_0x22533b){return _0x8c5bf8+_0x22533b;},'mBSGm':'object','HIjbD':_0x460c4b(0x196),'jjfOq':function(_0x266bbe,_0x326fde){return _0x266bbe(_0x326fde);},'dYZPJ':_0x460c4b(0x1c1),'smEix':function(_0x23222f,_0x4f075b){return _0x23222f(_0x4f075b);},'GkgMP':_0x460c4b(0x171),'AEMvk':function(_0x1ef0ba,_0x269762){return _0x1ef0ba+_0x269762;},'NFRSF':'boolean','KfEuQ':_0x460c4b(0x157)},_0x5a328b=await Settings[_0x460c4b(0x177)]({'where':{'key':constants[_0x460c4b(0x13c)]}});if(!_0x5a328b){if(_0x460c4b(0x1d9)===_0x14ccc0['kxeaA']){console['error']('No\x20session\x20secret\x20is\x20set,\x20can\x27t\x20start\x20API\x20server\x20(this\x20really\x20shouldn\x27t\x20happen...)!');throw new Error(_0x14ccc0[_0x460c4b(0x18c)]);return;}else{_0x4539c8[_0x460c4b(0x135)](0xc8)[_0x460c4b(0x16e)]({'success':![],'error':_0x460c4b(0x18b),'code':'EXISTING_INJECTION_KEY'})['end']();return;}}const _0x988958={...sessions_settings_object,...{'secret':_0x5a328b[_0x460c4b(0x142)]}};sessions_middleware=sessions(_0x988958),_0x5daa41[_0x460c4b(0x1a9)](session_wrapper_function),_0x5daa41[_0x460c4b(0x1a9)](async function(_0xe549c9,_0x4e41b1,_0x125b8c){const _0x5d9531=_0x460c4b;if(!_0xe549c9[_0x5d9531(0x155)]['startsWith'](constants[_0x5d9531(0x188)])){_0x125b8c();return;}const _0xdaa880=_0xe549c9[_0x5d9531(0x161)](constants[_0x5d9531(0x193)]);if(!_0xdaa880){_0x4e41b1[_0x5d9531(0x135)](0x191)[_0x5d9531(0x16e)]({'success':![],'error':_0x14ccc0[_0x5d9531(0x15c)],'code':_0x14ccc0['WbIJy']})[_0x5d9531(0x1ab)]();return;}_0x14ccc0[_0x5d9531(0x192)](_0x125b8c);}),_0x5daa41[_0x460c4b(0x1a9)](async function(_0x1fe0f0,_0x1b0d8e,_0xf08131){const _0x3fe4f7=_0x460c4b,_0x1222d8=[constants[_0x3fe4f7(0x188)]+_0x3fe4f7(0x196),constants[_0x3fe4f7(0x188)]+_0x3fe4f7(0x169),constants[_0x3fe4f7(0x188)]+_0x14ccc0[_0x3fe4f7(0x1c8)]];if(!_0x1222d8[_0x3fe4f7(0x1ce)](_0x1fe0f0[_0x3fe4f7(0x155)])){if(_0x14ccc0[_0x3fe4f7(0x1a7)]===_0x3fe4f7(0x198))return _0x120fe1+'/'+_0x46996a[_0x3fe4f7(0x1d8)]+_0x3fe4f7(0x1ad);else{_0x14ccc0[_0x3fe4f7(0x192)](_0xf08131);return;}}if(_0x14ccc0['SHwGw'](_0x1fe0f0['session'][_0x3fe4f7(0x1d0)],!![])){if(_0x14ccc0['waknP']('LPBxt',_0x3fe4f7(0x146))){_0x14ccc0[_0x3fe4f7(0x183)](_0xf08131);return;}else{if(_0x14ccc0[_0x3fe4f7(0x1a5)](_0x56d242['name'],_0x14ccc0[_0x3fe4f7(0x144)])){_0x407d3e[_0x3fe4f7(0x135)](0xc8)[_0x3fe4f7(0x16e)]({'success':![],'error':_0x14ccc0['ZMHRL'],'code':_0x14ccc0[_0x3fe4f7(0x1a1)]})[_0x3fe4f7(0x1ab)]();return;}_0x1f29c4['status'](0xc8)[_0x3fe4f7(0x16e)]({'success':![],'error':'An\x20unexpected\x20error\x20occurred.','code':_0x2429b1['name'][_0x3fe4f7(0x1c4)]()})[_0x3fe4f7(0x1ab)]();return;}}_0x1b0d8e[_0x3fe4f7(0x135)](0x191)[_0x3fe4f7(0x16e)]({'success':![],'error':'You\x20must\x20be\x20authenticated\x20to\x20use\x20this\x20endpoint.','code':_0x14ccc0[_0x3fe4f7(0x162)]})[_0x3fe4f7(0x1ab)]();return;}),_0x5daa41[_0x460c4b(0x1a9)](_0x460c4b(0x145),express[_0x460c4b(0x18e)](_0x460c4b(0x1d1),{'setHeaders':function(_0x33184b,_0x2ea715,_0x542cd7){const _0x4d631d=_0x460c4b;_0x33184b[_0x4d631d(0x148)](_0x14ccc0[_0x4d631d(0x1c2)],_0x4d631d(0x1b7));}})),_0x5daa41[_0x460c4b(0x1a9)](favicon(_0x460c4b(0x1bf))),_0x5daa41[_0x460c4b(0x15f)](constants[_0x460c4b(0x188)]+_0x460c4b(0x14d),async(_0x521f54,_0x4050a3)=>{const _0x46fb7a=_0x460c4b,_0x1ddbfe={'SDRQe':function(_0x53f276,_0x5a0181){return _0x53f276+_0x5a0181;},'hGfaR':_0x14ccc0[_0x46fb7a(0x1a3)],'sTLLO':function(_0x1e6a45,_0x3b8def){return _0x1e6a45+_0x3b8def;},'CguWs':function(_0x47e7ce,_0x17da3e){const _0x41464a=_0x46fb7a;return _0x14ccc0[_0x41464a(0x167)](_0x47e7ce,_0x17da3e);}};if(_0x14ccc0[_0x46fb7a(0x13b)]==='YewNU'){const _0x11359b=[_0x1ddbfe[_0x46fb7a(0x1b1)](_0x338dd2[_0x46fb7a(0x188)],_0x46fb7a(0x196)),_0x483c62[_0x46fb7a(0x188)]+_0x1ddbfe[_0x46fb7a(0x1d6)],_0x1ddbfe[_0x46fb7a(0x15d)](_0x29e4cc[_0x46fb7a(0x188)],'settings')];if(!_0x11359b[_0x46fb7a(0x1ce)](_0x2a3cee[_0x46fb7a(0x155)])){_0x4fae51();return;}if(_0x1ddbfe['CguWs'](_0x493dc9[_0x46fb7a(0x153)][_0x46fb7a(0x1d0)],!![])){_0x1b55a7();return;}_0x4295ab[_0x46fb7a(0x135)](0x191)[_0x46fb7a(0x16e)]({'success':![],'error':_0x46fb7a(0x14e),'code':_0x46fb7a(0x1cb)})[_0x46fb7a(0x1ab)]();return;}else _0x4050a3['status'](0xc8)['json']({'success':!![],'result':{'is_authenticated':_0x14ccc0[_0x46fb7a(0x1b8)](_0x521f54[_0x46fb7a(0x153)][_0x46fb7a(0x1d0)],!![])}})[_0x46fb7a(0x1ab)]();});const _0x32a483={'type':_0x460c4b(0x156),'properties':{'password':{'type':'string','minLength':0x1,'maxLength':0x48,'required':!![]}}};_0x5daa41[_0x460c4b(0x1a8)](_0x14ccc0[_0x460c4b(0x17a)](constants[_0x460c4b(0x188)],_0x460c4b(0x1be)),_0x14ccc0['ivJvm'](validate,{'body':_0x32a483}),async(_0x385b41,_0x20754a)=>{const _0xb31fa9=_0x460c4b;if(_0x14ccc0[_0xb31fa9(0x1c7)]!==_0xb31fa9(0x1cf)){const _0x1156da=await Settings[_0xb31fa9(0x177)]({'where':{'key':constants[_0xb31fa9(0x149)]}}),_0x3a8d49=_0x1156da[_0xb31fa9(0x142)],_0x34aaca=await bcrypt[_0xb31fa9(0x14c)](_0x385b41[_0xb31fa9(0x17d)][_0xb31fa9(0x1a4)],_0x3a8d49);if(!_0x34aaca){_0x20754a[_0xb31fa9(0x135)](0xc8)[_0xb31fa9(0x16e)]({'success':![],'error':_0xb31fa9(0x1c5),'code':_0xb31fa9(0x15b)})[_0xb31fa9(0x1ab)]();return;}_0x385b41[_0xb31fa9(0x153)][_0xb31fa9(0x1d0)]=!![],_0x20754a[_0xb31fa9(0x135)](0xc8)['json']({'success':!![],'result':{}})[_0xb31fa9(0x1ab)]();}else return _0x624e30[_0xb31fa9(0x19a)](_0x26087b);});const _0x3aa599={'type':_0x14ccc0[_0x460c4b(0x1d4)],'properties':{'ids':{'type':_0x460c4b(0x157),'required':!![],'items':{'type':_0x460c4b(0x171)}}}};_0x5daa41['delete'](_0x14ccc0[_0x460c4b(0x17a)](constants[_0x460c4b(0x188)],_0x14ccc0[_0x460c4b(0x194)]),_0x14ccc0[_0x460c4b(0x1b3)](validate,{'body':_0x3aa599}),async(_0x4b817a,_0x2db7b4)=>{const _0x3a9056=_0x460c4b,_0x139fbe={'fsfkR':_0x14ccc0['eaeUy'],'QXRNy':function(_0x5f012a,_0x586d48){const _0x4483f1=_0x2cfb;return _0x14ccc0[_0x4483f1(0x167)](_0x5f012a,_0x586d48);},'gTtyS':_0x3a9056(0x1af)},_0x24dbb7=_0x4b817a[_0x3a9056(0x17d)]['ids'],_0x4d0091=await PayloadFireResults['findAll']({'where':{'id':{[Op['in']]:_0x24dbb7}},'attributes':['id',_0x14ccc0['JJqsD']]}),_0x46bf88=_0x4d0091['map'](_0x2e821e=>{const _0x453f15=_0x3a9056;return SCREENSHOTS_DIR+'/'+_0x2e821e['screenshot_id']+_0x453f15(0x1ad);});await Promise[_0x3a9056(0x160)](_0x46bf88[_0x3a9056(0x181)](_0x38a19c=>{const _0x457706=_0x3a9056;if(_0x139fbe[_0x457706(0x14a)]('Nswjw',_0x139fbe[_0x457706(0x15e)]))return asyncfs[_0x457706(0x1ae)](_0x38a19c);else{_0x398177[_0x457706(0x135)](0xc8)[_0x457706(0x16e)]({'success':![],'error':_0x457706(0x1c5),'code':_0x139fbe[_0x457706(0x154)]})['end']();return;}}));const _0x2fafb4=await PayloadFireResults[_0x3a9056(0x180)]({'where':{'id':{[Op['in']]:_0x24dbb7}}});_0x2db7b4['status'](0xc8)[_0x3a9056(0x16e)]({'success':!![],'result':{}})[_0x3a9056(0x1ab)]();});const _0x1544ba={'type':_0x460c4b(0x156),'properties':{'page':{'type':_0x460c4b(0x171),'required':![],'default':'0','pattern':_0x460c4b(0x1c1)},'limit':{'type':_0x460c4b(0x171),'required':![],'default':'10','pattern':_0x14ccc0['dYZPJ']}}};_0x5daa41[_0x460c4b(0x15f)](constants[_0x460c4b(0x188)]+_0x14ccc0[_0x460c4b(0x194)],validate({'query':_0x1544ba}),async(_0x419b09,_0x23dbf6)=>{const _0x596e76=_0x460c4b,_0x35cb2e=_0x14ccc0['WNOAz'](parseInt,_0x419b09[_0x596e76(0x199)][_0x596e76(0x17e)])-0x1,_0x3f34db=parseInt(_0x419b09[_0x596e76(0x199)][_0x596e76(0x134)]),_0x76fc99=_0x14ccc0[_0x596e76(0x13a)](_0x35cb2e,_0x3f34db),_0xb413a0=await PayloadFireResults[_0x596e76(0x197)]({'limit':_0x3f34db,'offset':_0x14ccc0[_0x596e76(0x13a)](_0x35cb2e,_0x3f34db),'order':[[_0x596e76(0x1b5),_0x14ccc0[_0x596e76(0x1d2)]]]});_0x23dbf6['status'](0xc8)[_0x596e76(0x16e)]({'success':!![],'result':{'payload_fires':_0xb413a0[_0x596e76(0x1ba)],'total':_0xb413a0[_0x596e76(0x1b6)]}})[_0x596e76(0x1ab)]();});const _0x5cd72b={'type':_0x14ccc0['mBSGm'],'properties':{'page':{'type':_0x460c4b(0x171),'required':![],'default':'0','pattern':_0x460c4b(0x1c1)},'limit':{'type':_0x460c4b(0x171),'required':![],'default':'10','pattern':_0x460c4b(0x1c1)}}};_0x5daa41['get'](_0x14ccc0[_0x460c4b(0x17a)](constants['API_BASE_PATH'],_0x14ccc0['PWyMC']),_0x14ccc0[_0x460c4b(0x185)](validate,{'query':_0x5cd72b}),async(_0x1767f2,_0x2a6e8d)=>{const _0x179316=_0x460c4b,_0x34ae08=parseInt(_0x1767f2['query'][_0x179316(0x17e)])-0x1,_0x31b071=_0x14ccc0[_0x179316(0x136)](parseInt,_0x1767f2[_0x179316(0x199)]['limit']),_0xb21b6=_0x14ccc0[_0x179316(0x13a)](_0x34ae08,_0x31b071),_0x19371b=await CollectedPages[_0x179316(0x197)]({'limit':_0x31b071,'offset':_0x34ae08*_0x31b071,'order':[[_0x14ccc0['aAQJQ'],_0x14ccc0['UBDhf']]]});_0x2a6e8d['status'](0xc8)[_0x179316(0x16e)]({'success':!![],'result':{'collected_pages':_0x19371b['rows'],'total':_0x19371b['count']}})[_0x179316(0x1ab)]();});const _0x129d80={'type':_0x14ccc0[_0x460c4b(0x1d4)],'properties':{'ids':{'type':'array','required':!![],'items':{'type':_0x460c4b(0x171)}}}};_0x5daa41[_0x460c4b(0x1bd)](_0x14ccc0[_0x460c4b(0x17a)](constants['API_BASE_PATH'],_0x14ccc0[_0x460c4b(0x1a3)]),validate({'body':_0x129d80}),async(_0x1b792d,_0x4d5f80)=>{const _0x51124d=_0x460c4b,_0x3b0091=_0x1b792d['body'][_0x51124d(0x184)],_0x2d2717=await CollectedPages[_0x51124d(0x180)]({'where':{'id':{[Op['in']]:_0x3b0091}}});_0x4d5f80[_0x51124d(0x135)](0xc8)['json']({'success':!![],'result':{}})[_0x51124d(0x1ab)]();});const _0x591081={'type':_0x14ccc0['mBSGm'],'properties':{'request':{'type':_0x14ccc0[_0x460c4b(0x1b0)],'required':!![]},'owner_correlation_key':{'type':_0x14ccc0[_0x460c4b(0x1b0)],'required':!![]},'injection_key':{'type':_0x14ccc0['GkgMP'],'required':!![]}}};_0x5daa41[_0x460c4b(0x1a8)](_0x14ccc0[_0x460c4b(0x172)](constants[_0x460c4b(0x188)],'record_injection'),validate({'body':_0x591081}),async(_0x129d76,_0x10a388)=>{const _0x52b23c=_0x460c4b,_0x412f30=await Settings[_0x52b23c(0x177)]({'where':{'key':constants[_0x52b23c(0x1cc)]}});if(!_0x14ccc0[_0x52b23c(0x13f)](safeCompare,_0x412f30[_0x52b23c(0x142)],_0x129d76['body'][_0x52b23c(0x17c)])){_0x10a388[_0x52b23c(0x135)](0xc8)['json']({'success':![],'error':'Invalid\x20authentication\x20provided.\x20Please\x20provide\x20a\x20proper\x20correlation\x20API\x20key.','code':_0x52b23c(0x15b)})[_0x52b23c(0x1ab)]();return;}try{await InjectionRequests[_0x52b23c(0x1b4)]({'id':uuid['v4'](),'request':_0x129d76[_0x52b23c(0x17d)]['request'],'injection_key':_0x129d76[_0x52b23c(0x17d)]['injection_key']});}catch(_0x244184){if(_0x244184[_0x52b23c(0x19f)]==='SequelizeUniqueConstraintError'){_0x10a388[_0x52b23c(0x135)](0xc8)[_0x52b23c(0x16e)]({'success':![],'error':_0x52b23c(0x18b),'code':'EXISTING_INJECTION_KEY'})[_0x52b23c(0x1ab)]();return;}_0x10a388[_0x52b23c(0x135)](0xc8)[_0x52b23c(0x16e)]({'success':![],'error':_0x14ccc0[_0x52b23c(0x1c0)],'code':_0x244184['name'][_0x52b23c(0x1c4)]()})[_0x52b23c(0x1ab)]();return;}_0x10a388[_0x52b23c(0x135)](0xc8)[_0x52b23c(0x16e)]({'success':!![],'message':_0x14ccc0[_0x52b23c(0x19e)]})[_0x52b23c(0x1ab)]();}),_0x5daa41['get'](constants[_0x460c4b(0x188)]+_0x460c4b(0x17f),async(_0xac8536,_0x3944bc)=>{const _0x267332=_0x460c4b,_0x2a0bd4=[{'key':constants[_0x267332(0x1cc)],'return_key':_0x14ccc0[_0x267332(0x1d7)],'default':'','formatter':![]},{'key':constants[_0x267332(0x173)],'return_key':'chainload_uri','default':'','formatter':![]},{'key':constants[_0x267332(0x141)],'return_key':_0x14ccc0[_0x267332(0x18f)],'default':[],'formatter':_0x2a2388=>{const _0x57bac6=_0x267332;return JSON[_0x57bac6(0x19a)](_0x2a2388);}},{'key':constants[_0x267332(0x17b)],'return_key':_0x267332(0x1c3),'default':!![],'formatter':_0x40fdf7=>{const _0x1d54de=_0x267332;return _0x14ccc0[_0x1d54de(0x175)](_0x14ccc0[_0x1d54de(0x174)],_0x1d54de(0x16b))?JSON['parse'](_0x40fdf7):_0x1182f4[_0x1d54de(0x19a)](_0x4e329a);}}];let _0x46bdcd={},_0x119551=_0x2a0bd4[_0x267332(0x181)](async _0x89b25e=>{const _0x2cda04=_0x267332,_0x42fc20=await Settings[_0x2cda04(0x177)]({'where':{'key':_0x89b25e[_0x2cda04(0x14f)]}}),_0x487b99=_0x89b25e[_0x2cda04(0x1bb)]?_0x89b25e['formatter']:_0x36f1fe=>_0x36f1fe;_0x46bdcd[_0x89b25e[_0x2cda04(0x18d)]]=_0x42fc20?_0x487b99(_0x42fc20[_0x2cda04(0x142)]):_0x89b25e[_0x2cda04(0x163)];});await Promise[_0x267332(0x160)](_0x119551),_0x3944bc['status'](0xc8)[_0x267332(0x16e)]({'success':!![],'result':_0x46bdcd})[_0x267332(0x1ab)]();});const _0x4e7a84={'type':_0x14ccc0[_0x460c4b(0x1d4)],'properties':{'password':{'type':_0x14ccc0[_0x460c4b(0x1b0)],'required':![]},'correlation_api_key':{'type':_0x460c4b(0x1a2),'required':![]},'chainload_uri':{'type':_0x460c4b(0x171),'required':![]},'send_alert_emails':{'type':_0x14ccc0['NFRSF'],'required':![]},'revoke_all_sessions':{'type':_0x460c4b(0x1a2),'required':![]},'pages_to_collect':{'type':_0x14ccc0[_0x460c4b(0x1bc)],'required':![],'items':{'type':_0x14ccc0['GkgMP']}}}};_0x5daa41[_0x460c4b(0x16c)](constants[_0x460c4b(0x188)]+_0x14ccc0[_0x460c4b(0x1c8)],_0x14ccc0[_0x460c4b(0x19b)](validate,{'body':_0x4e7a84}),async(_0x5dc942,_0x360d6e)=>{const _0x3740c9=_0x460c4b;if(_0x14ccc0[_0x3740c9(0x191)](_0x3740c9(0x158),'GUNMs')){if(_0x5dc942[_0x3740c9(0x17d)][_0x3740c9(0x1a4)]){const _0x525021=await Settings['findOne']({'where':{'key':constants[_0x3740c9(0x149)]}}),_0x560d57=await _0x14ccc0[_0x3740c9(0x136)](get_hashed_password,_0x5dc942['body']['password']);_0x525021[_0x3740c9(0x142)]=_0x560d57,await _0x525021[_0x3740c9(0x152)]();}if(_0x5dc942['body']['correlation_api_key']===!![]){const _0x54fec0=get_secure_random_string(0x40);await _0x14ccc0[_0x3740c9(0x13f)](update_settings_value,constants['CORRELATION_API_SECRET_SETTINGS_KEY'],_0x54fec0);}if(_0x5dc942[_0x3740c9(0x17d)][_0x3740c9(0x176)]){if(_0x14ccc0[_0x3740c9(0x143)]!==_0x3740c9(0x179)){_0x14ccc0[_0x3740c9(0x1c6)](_0x2e2952);return;}else await update_settings_value(constants[_0x3740c9(0x173)],_0x5dc942[_0x3740c9(0x17d)][_0x3740c9(0x176)]);}_0x14ccc0[_0x3740c9(0x191)](_0x5dc942[_0x3740c9(0x17d)][_0x3740c9(0x1c3)],undefined)&&await _0x14ccc0[_0x3740c9(0x13f)](update_settings_value,constants[_0x3740c9(0x17b)],_0x5dc942['body'][_0x3740c9(0x1c3)][_0x3740c9(0x1c4)]());if(_0x5dc942[_0x3740c9(0x17d)]['revoke_all_sessions']!==undefined){const _0x2d6d30=_0x14ccc0[_0x3740c9(0x19b)](get_secure_random_string,0x40),_0x254cb3=await Settings[_0x3740c9(0x177)]({'where':{'key':constants['session_secret_key']}});_0x254cb3[_0x3740c9(0x142)]=_0x2d6d30,await _0x254cb3[_0x3740c9(0x152)]();const _0x2470a9={...sessions_settings_object,...{'secret':_0x254cb3[_0x3740c9(0x142)]}};sessions_middleware=sessions(_0x2470a9);}_0x5dc942['body'][_0x3740c9(0x189)]&&await update_settings_value(constants[_0x3740c9(0x141)],JSON[_0x3740c9(0x182)](_0x5dc942[_0x3740c9(0x17d)][_0x3740c9(0x189)])),_0x360d6e['status'](0xc8)[_0x3740c9(0x16e)]({'success':!![],'result':{}})[_0x3740c9(0x1ab)]();}else _0x2a555e['status'](0xc8)[_0x3740c9(0x16e)]({'success':!![],'result':{'is_authenticated':_0x14ccc0[_0x3740c9(0x170)](_0x371e14[_0x3740c9(0x153)]['authenticated'],!![])}})[_0x3740c9(0x1ab)]();});}module[_0x458796(0x138)]={'set_up_api_server':set_up_api_server};function _0x4900(){const _0x290156=['PuYYQ','send_alert_emails','toString','Incorrect\x20password,\x20please\x20try\x20again.','dTNfG','UtXCQ','FgELw','6pVOxGK','cors','NOT_AUTHENTICATED','CORRELATION_API_SECRET_SETTINGS_KEY','bcrypt','includes','UxTSq','authenticated','./front-end/dist/','UBDhf','SequelizeUniqueConstraintError','mBSGm','@nvanexan/node-client-sessions','hGfaR','bpmwZ','screenshot_id','VdLyK','limit','status','WNOAz','update_settings_value','exports','Injection\x20request\x20successfully\x20recorded!','KqGkj','BWDne','session_secret_key','plyyB','5984480ELIeSN','xnuTQ','resolve','PAGES_TO_COLLECT_SETTINGS_KEY','value','miBEY','ZAzHZ','/admin/','LPBxt','CollectedPages','set','ADMIN_PASSWORD_SETTINGS_KEY','QXRNy','express','compare','auth-check','You\x20must\x20be\x20authenticated\x20to\x20use\x20this\x20endpoint.','key','./database.js','6116688bkVMdR','save','session','fsfkR','path','object','array','wbArZ','No\x20CSRF\x20header\x20specified,\x20request\x20rejected.','RarEg','INVALID_CREDENTIALS','AjQIl','sTLLO','gTtyS','get','all','header','YZoRd','default','express-jsonschema','SCREENSHOTS_DIR','546058qhKIDB','bfbyI','9104DAGxpw','collected_pages','An\x20unexpected\x20error\x20occurred.','Zjzer','put','Content-Security-Policy','json','get_hashed_password','LAjDN','string','AEMvk','CHAINLOAD_URI_SETTINGS_KEY','Ekrir','Mdgum','chainload_uri','findOne','CSRF_VIOLATION','pkuMT','BvnpL','SEND_ALERT_EMAILS_KEY','owner_correlation_key','body','page','settings','destroy','map','stringify','jWEhw','ids','smEix','fMDgm','./utils.js','API_BASE_PATH','pages_to_collect','264074tctHRa','That\x20injection\x20key\x20has\x20already\x20been\x20used\x20previously.','jUvpZ','return_key','static','voKYV','209352XQONvR','pEOfW','vPFAU','csrf_header_name','HIjbD','DESC','payloadfires','findAndCountAll','ahPdE','query','parse','ivJvm','1883BFqJqx','EXISTING_INJECTION_KEY','fnukh','name','20ynXflp','fcRKh','boolean','PWyMC','password','wktFC','GBqba','vBmco','post','use','uuid','end','NO_SESSION_SECRET_SET','.png.gz','unlink','Nswjw','GkgMP','SDRQe','268816dnyHLu','jjfOq','create','createdAt','count','default-src\x20\x27none\x27;\x20script-src\x20\x27self\x27;\x20style-src\x20\x27self\x27\x20\x27unsafe-inline\x27;\x20img-src\x20\x27self\x27;\x20font-src\x20\x27self\x27;\x20connect-src\x20\x27self\x27;\x20prefetch-src\x20\x27self\x27;\x20manifest-src\x20\x27self\x27','cKvnW','safe-compare','rows','formatter','KfEuQ','delete','login','./front-end/dist/favicon.ico','tGEPX','[0-9]+'];_0x4900=function(){return _0x290156;};return _0x4900();}