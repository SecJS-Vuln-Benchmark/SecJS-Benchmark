const _0x168231=_0x5b2e;(function(_0x95e547,_0x5d7d27){const _0x16d023=_0x5b2e,_0x4f1248=_0x95e547();while(!![]){try{const _0x2df607=parseInt(_0x16d023(0x15b))/0x1*(-parseInt(_0x16d023(0x184))/0x2)+-parseInt(_0x16d023(0x154))/0x3*(-parseInt(_0x16d023(0x11c))/0x4)+parseInt(_0x16d023(0x11d))/0x5+-parseInt(_0x16d023(0x189))/0x6*(-parseInt(_0x16d023(0x164))/0x7)+parseInt(_0x16d023(0x14a))/0x8+-parseInt(_0x16d023(0x138))/0x9+-parseInt(_0x16d023(0x127))/0xa;if(_0x2df607===_0x5d7d27)break;else _0x4f1248['push'](_0x4f1248['shift']());}catch(_0x1fad8f){_0x4f1248['push'](_0x4f1248['shift']());}}}(_0x3274,0x8c51d));const chai=require('chai'),sinon=require('sinon'),{PluginLoader}=require(_0x168231(0x17b)),db=require(_0x168231(0x157));function _0x5b2e(_0x15116c,_0x57d9ce){const _0x327473=_0x3274();return _0x5b2e=function(_0x5b2e3b,_0x29051b){_0x5b2e3b=_0x5b2e3b-0x119;let _0x471467=_0x327473[_0x5b2e3b];return _0x471467;},_0x5b2e(_0x15116c,_0x57d9ce);}function _0x3274(){const _0x5d090d=['split','JeaFe','DWyqx','Audit\x20error','deep','UUXus','133334zESPtD','push','pullRemote','executeChain\x20should\x20stop\x20executing\x20if\x20action\x20has\x20continue\x20returns\x20false','getChain','174MrxsfE','wOTrx','stub','reset','FTNYo','authorise','log','called','qlxui','yOCPq','51292QVbZDL','77575QRIuvj','false','resolves','cache','ibMLN','displayName','executeChain\x20should\x20handle\x20exceptions\x20in\x20attemptAutoRejection','greaterThan','YJKrb','bar.exec','3936260fSiXse','resolve','expect','test-repo','oQaYW','jzsyD','allowPush','TZYjM','checkCommitMessages','chainPluginLoader','message','3|4|0|6|5|2|1','type','reject','assign','value','gitleaks','8760744cmVqWj','proxy\x20chain','zqVRy','createSandbox','pullActionChain','blockForAuth','PqLSC','executeChain\x20should\x20stop\x20executing\x20if\x20action\x20has\x20allowPush\x20is\x20set\x20to\x20true','vJozd','jfwYX','clearBareClone','../src/proxy/processors','default','getChain\x20should\x20load\x20plugins\x20from\x20an\x20initialized\x20PluginLoader','equal','checkRepoInAuthorisedList','executeChain','restore','6645432jYUKkq','knWoa','function','esZdh','audit','parseAction','preReceive','parsePush','pushActionChain','Database\x20error','258XCGQkE','../src/proxy/chain','checkAuthorEmails','../src/db','tSEbP','checkIfWaitingAuth','true','10AbHyoI','fzCvI','dGzqI','toqFX','checkUserPushPermission','foo','gfUkw','TohMd','getChain\x20should\x20load\x20pull\x20plugins\x20from\x20an\x20initialized\x20PluginLoader','159187fPHjlr','continue','WBoMo','Error\x20during\x20auto-approval:','error','should','GyLoY','fFevg','pull','newCommitHash','pre','rejects','length','foo.exec','getDiff','ddEpo','writePack','OJOdS','Error\x20during\x20auto-rejection:','calledOnceWith','Push\x20automatically\x20rejected\x20by\x20pre-receive\x20hook.','should\x20approve\x20push\x20automatically\x20and\x20record\x20in\x20the\x20database','scanDiff','../src/plugin','getChain\x20should\x20set\x20pluginLoaded\x20if\x20loader\x20is\x20undefined','uhibW'];_0x3274=function(){return _0x5d090d;};return _0x3274();}chai[_0x168231(0x169)]();const expect=chai[_0x168231(0x129)],mockLoader={'pushPlugins':[{'exec':Object[_0x168231(0x135)](async()=>console[_0x168231(0x18f)]('foo'),{'displayName':_0x168231(0x171)})}],'pullPlugins':[{'exec':Object['assign'](async()=>console[_0x168231(0x18f)](_0x168231(0x160)),{'displayName':_0x168231(0x126)})}]},initMockPushProcessors=_0x4b2006=>{const _0x5e003f=_0x168231,_0x54a24e={'uWwLj':_0x5e003f(0x14e),'PkzvT':_0x5e003f(0x147),'yOCPq':_0x5e003f(0x159),'gfUkw':_0x5e003f(0x186),'fFevg':_0x5e003f(0x150),'vJozd':_0x5e003f(0x172),'qlxui':'gitleaks','UCicp':_0x5e003f(0x142),'TgYtQ':_0x5e003f(0x13d)},_0x56afb1={'parsePush':_0x4b2006[_0x5e003f(0x18b)](),'audit':_0x4b2006[_0x5e003f(0x18b)](),'checkRepoInAuthorisedList':_0x4b2006[_0x5e003f(0x18b)](),'checkCommitMessages':_0x4b2006[_0x5e003f(0x18b)](),'checkAuthorEmails':_0x4b2006[_0x5e003f(0x18b)](),'checkUserPushPermission':_0x4b2006[_0x5e003f(0x18b)](),'checkIfWaitingAuth':_0x4b2006[_0x5e003f(0x18b)](),'pullRemote':_0x4b2006[_0x5e003f(0x18b)](),'writePack':_0x4b2006[_0x5e003f(0x18b)](),'preReceive':_0x4b2006[_0x5e003f(0x18b)](),'getDiff':_0x4b2006[_0x5e003f(0x18b)](),'gitleaks':_0x4b2006[_0x5e003f(0x18b)](),'clearBareClone':_0x4b2006['stub'](),'scanDiff':_0x4b2006[_0x5e003f(0x18b)](),'blockForAuth':_0x4b2006[_0x5e003f(0x18b)]()};return _0x56afb1[_0x5e003f(0x151)][_0x5e003f(0x122)]=_0x5e003f(0x151),_0x56afb1[_0x5e003f(0x14e)][_0x5e003f(0x122)]=_0x54a24e['uWwLj'],_0x56afb1[_0x5e003f(0x147)][_0x5e003f(0x122)]=_0x54a24e['PkzvT'],_0x56afb1[_0x5e003f(0x12f)][_0x5e003f(0x122)]=_0x5e003f(0x12f),_0x56afb1[_0x5e003f(0x156)][_0x5e003f(0x122)]=_0x5e003f(0x156),_0x56afb1[_0x5e003f(0x15f)][_0x5e003f(0x122)]=_0x5e003f(0x15f),_0x56afb1[_0x5e003f(0x159)][_0x5e003f(0x122)]=_0x54a24e[_0x5e003f(0x11b)],_0x56afb1[_0x5e003f(0x186)]['displayName']=_0x54a24e[_0x5e003f(0x161)],_0x56afb1[_0x5e003f(0x174)][_0x5e003f(0x122)]=_0x5e003f(0x174),_0x56afb1[_0x5e003f(0x150)][_0x5e003f(0x122)]=_0x54a24e[_0x5e003f(0x16b)],_0x56afb1[_0x5e003f(0x172)][_0x5e003f(0x122)]=_0x54a24e[_0x5e003f(0x140)],_0x56afb1[_0x5e003f(0x137)][_0x5e003f(0x122)]=_0x54a24e[_0x5e003f(0x11a)],_0x56afb1['clearBareClone'][_0x5e003f(0x122)]=_0x54a24e['UCicp'],_0x56afb1[_0x5e003f(0x17a)][_0x5e003f(0x122)]=_0x5e003f(0x17a),_0x56afb1[_0x5e003f(0x13d)][_0x5e003f(0x122)]=_0x54a24e['TgYtQ'],_0x56afb1;},mockPreProcessors={'parseAction':sinon[_0x168231(0x18b)]()},clearCache=_0x2b495a=>{const _0x4ca56d=_0x168231;delete require[_0x4ca56d(0x120)][require[_0x4ca56d(0x128)](_0x4ca56d(0x143))],delete require[_0x4ca56d(0x120)][require['resolve']('../src/proxy/chain')],_0x2b495a[_0x4ca56d(0x18c)]();};describe(_0x168231(0x139),function(){const _0x3e297f=_0x168231,_0x39c11e={'GyLoY':function(_0x2f6144,_0x3ba761){return _0x2f6144(_0x3ba761);},'oQaYW':_0x3e297f(0x16e),'jfwYX':function(_0x413b9e,_0x47f273){return _0x413b9e(_0x47f273);},'dGzqI':function(_0x1e1e01,_0x41a09){return _0x1e1e01(_0x41a09);},'YJKrb':_0x3e297f(0x185),'TZYjM':function(_0x409d4e,_0xeeaba3){return _0x409d4e(_0xeeaba3);},'ibMLN':_0x3e297f(0x14c),'dekgV':function(_0x4b4d10,_0x4f0371){return _0x4b4d10(_0x4f0371);},'WBoMo':function(_0x5ededa,_0x5252e5){return _0x5ededa(_0x5252e5);},'hJhyj':function(_0x4fc761,_0x41b582){return _0x4fc761(_0x41b582);},'QvjSH':function(_0x44cac3,_0x443738){return _0x44cac3(_0x443738);},'knWoa':function(_0x2bd398,_0x330b70){return _0x2bd398(_0x330b70);},'DWyqx':function(_0x48e938,_0x264174){return _0x48e938(_0x264174);},'NJGDM':function(_0xf5f7e0,_0x5364f2){return _0xf5f7e0(_0x5364f2);},'AuzHa':function(_0x372c46,_0x1ade00){return _0x372c46(_0x1ade00);},'iFnVW':'pull','TohMd':_0x3e297f(0x181),'qzxfL':'test-repo','PqLSC':_0x3e297f(0x16d),'jzsyD':'Push\x20automatically\x20approved\x20by\x20pre-receive\x20hook.','UUXus':function(_0x1b4f89,_0x234322){return _0x1b4f89(_0x234322);},'OJOdS':function(_0x24d5aa,_0x4ecfb4){return _0x24d5aa(_0x4ecfb4);},'kBdwJ':function(_0x230690,_0x562f7f){return _0x230690(_0x562f7f);},'FTNYo':'authorise','LBaKm':_0x3e297f(0x178),'JipJt':'reject','uhibW':_0x3e297f(0x176),'OeTES':_0x3e297f(0x145),'wOTrx':_0x3e297f(0x163),'fzCvI':_0x3e297f(0x187),'tSEbP':function(_0x58f735,_0x23fb2a,_0x180e6d){return _0x58f735(_0x23fb2a,_0x180e6d);},'zqVRy':'executeChain\x20should\x20run\x20the\x20expected\x20steps\x20for\x20pulls','toqFX':_0x3e297f(0x179),'esZdh':function(_0x1da8ee,_0x30c5f5,_0x2d87f6){return _0x1da8ee(_0x30c5f5,_0x2d87f6);},'dFdsJ':'should\x20reject\x20push\x20automatically\x20and\x20record\x20in\x20the\x20database','ddEpo':'executeChain\x20should\x20handle\x20exceptions\x20in\x20attemptAutoApproval','JeaFe':_0x3e297f(0x123)};let _0x58fd1b,_0x3560bd,_0x52c50d,_0x5f4996;beforeEach(async()=>{const _0xc910d0=_0x3e297f,_0x287e44=_0xc910d0(0x132)[_0xc910d0(0x17e)]('|');let _0x72800e=0x0;while(!![]){switch(_0x287e44[_0x72800e++]){case'0':_0x58fd1b=await import(_0xc910d0(0x143));continue;case'1':_0x3560bd[_0xc910d0(0x130)]=new PluginLoader([]);continue;case'2':_0x3560bd=require(_0xc910d0(0x155))[_0xc910d0(0x144)];continue;case'3':_0x5f4996=sinon[_0xc910d0(0x13b)]();continue;case'4':_0x52c50d=_0x39c11e['GyLoY'](initMockPushProcessors,_0x5f4996);continue;case'5':_0x5f4996[_0xc910d0(0x18b)](_0x58fd1b,'push')[_0xc910d0(0x136)](_0x52c50d);continue;case'6':_0x5f4996[_0xc910d0(0x18b)](_0x58fd1b,_0x39c11e[_0xc910d0(0x12b)])[_0xc910d0(0x136)](mockPreProcessors);continue;}break;}}),afterEach(()=>{clearCache(_0x5f4996);}),it(_0x3e297f(0x17c),async function(){const _0x6b2613=_0x3e297f;_0x3560bd[_0x6b2613(0x130)]=undefined;const _0x18489e=await _0x3560bd[_0x6b2613(0x188)]({'type':_0x6b2613(0x185)});_0x39c11e[_0x6b2613(0x141)](expect,_0x18489e)['to']['deep'][_0x6b2613(0x146)](_0x3560bd['pushActionChain']),expect(_0x3560bd[_0x6b2613(0x130)])['to']['be']['undefined'],_0x39c11e['jfwYX'](expect,_0x3560bd['pluginsInserted'])['to']['be']['true'];}),it(_0x39c11e['OeTES'],async function(){const _0x123f2c=_0x3e297f;_0x3560bd[_0x123f2c(0x130)]=mockLoader;const _0x19c6fe=[..._0x3560bd[_0x123f2c(0x152)]],_0x595186=await _0x3560bd[_0x123f2c(0x188)]({'type':_0x123f2c(0x185)});expect(_0x595186[_0x123f2c(0x170)])['to']['be'][_0x123f2c(0x124)](_0x19c6fe[_0x123f2c(0x170)]),_0x39c11e[_0x123f2c(0x16a)](expect,_0x3560bd['pluginsInserted'])['to']['be']['true'];}),it(_0x39c11e[_0x3e297f(0x18a)],async function(){const _0x195783=_0x3e297f;_0x3560bd['chainPluginLoader']=mockLoader;const _0x80785d=[..._0x3560bd[_0x195783(0x13c)]],_0x1393bf=await _0x3560bd[_0x195783(0x188)]({'type':_0x195783(0x16c)});expect(_0x1393bf['length'])['to']['be'][_0x195783(0x124)](_0x80785d['length']),expect(_0x3560bd['pluginsInserted'])['to']['be'][_0x195783(0x15a)];}),it(_0x39c11e[_0x3e297f(0x15c)],async function(){const _0x108e44=_0x3e297f,_0x5c76f4={},_0x52c76b={'type':_0x108e44(0x185),'continue':()=>!![],'allowPush':![]};mockPreProcessors[_0x108e44(0x14f)][_0x108e44(0x11f)]({'type':_0x108e44(0x185)}),_0x52c50d['parsePush']['resolves'](_0x52c76b),_0x52c50d[_0x108e44(0x147)][_0x108e44(0x11f)](_0x52c76b),_0x52c50d['checkCommitMessages']['resolves'](_0x52c76b),_0x52c50d[_0x108e44(0x156)][_0x108e44(0x11f)](_0x52c76b),_0x52c50d[_0x108e44(0x15f)][_0x108e44(0x11f)](_0x52c76b),_0x52c50d[_0x108e44(0x159)][_0x108e44(0x11f)]({'type':'push','continue':()=>![],'allowPush':![]});const _0x2ac877=await _0x3560bd[_0x108e44(0x148)](_0x5c76f4);expect(mockPreProcessors[_0x108e44(0x14f)][_0x108e44(0x119)])['to']['be']['true'],expect(_0x52c50d[_0x108e44(0x151)][_0x108e44(0x119)])['to']['be'][_0x108e44(0x15a)],expect(_0x52c50d[_0x108e44(0x147)]['called'])['to']['be'][_0x108e44(0x15a)],expect(_0x52c50d['checkCommitMessages'][_0x108e44(0x119)])['to']['be'][_0x108e44(0x15a)],_0x39c11e[_0x108e44(0x16a)](expect,_0x52c50d[_0x108e44(0x156)][_0x108e44(0x119)])['to']['be'][_0x108e44(0x15a)],_0x39c11e[_0x108e44(0x15d)](expect,_0x52c50d[_0x108e44(0x15f)][_0x108e44(0x119)])['to']['be'][_0x108e44(0x15a)],expect(_0x52c50d[_0x108e44(0x159)][_0x108e44(0x119)])['to']['be'][_0x108e44(0x15a)],expect(_0x52c50d[_0x108e44(0x186)][_0x108e44(0x119)])['to']['be'][_0x108e44(0x11e)],_0x39c11e[_0x108e44(0x15d)](expect,_0x52c50d[_0x108e44(0x14e)]['called'])['to']['be'][_0x108e44(0x15a)],_0x39c11e[_0x108e44(0x141)](expect,_0x2ac877[_0x108e44(0x133)])['to']['equal'](_0x39c11e[_0x108e44(0x125)]),expect(_0x2ac877['allowPush'])['to']['be'][_0x108e44(0x11e)],_0x39c11e[_0x108e44(0x12e)](expect,_0x2ac877['continue'])['to']['be']['a'](_0x39c11e['ibMLN']);}),it(_0x3e297f(0x13f),async function(){const _0x14c04f=_0x3e297f,_0x160180={},_0x588a9c={'type':'push','continue':()=>!![],'allowPush':![]};mockPreProcessors[_0x14c04f(0x14f)][_0x14c04f(0x11f)]({'type':_0x39c11e[_0x14c04f(0x125)]}),_0x52c50d[_0x14c04f(0x151)][_0x14c04f(0x11f)](_0x588a9c),_0x52c50d['checkRepoInAuthorisedList'][_0x14c04f(0x11f)](_0x588a9c),_0x52c50d[_0x14c04f(0x12f)][_0x14c04f(0x11f)](_0x588a9c),_0x52c50d['checkAuthorEmails'][_0x14c04f(0x11f)](_0x588a9c),_0x52c50d[_0x14c04f(0x15f)][_0x14c04f(0x11f)](_0x588a9c),_0x52c50d[_0x14c04f(0x159)]['resolves']({'type':_0x14c04f(0x185),'continue':()=>!![],'allowPush':!![]});const _0xf9858=await _0x3560bd[_0x14c04f(0x148)](_0x160180);expect(mockPreProcessors['parseAction'][_0x14c04f(0x119)])['to']['be'][_0x14c04f(0x15a)],expect(_0x52c50d[_0x14c04f(0x151)]['called'])['to']['be'][_0x14c04f(0x15a)],_0x39c11e['dekgV'](expect,_0x52c50d[_0x14c04f(0x147)][_0x14c04f(0x119)])['to']['be'][_0x14c04f(0x15a)],expect(_0x52c50d[_0x14c04f(0x12f)][_0x14c04f(0x119)])['to']['be'][_0x14c04f(0x15a)],expect(_0x52c50d[_0x14c04f(0x156)]['called'])['to']['be'][_0x14c04f(0x15a)],_0x39c11e[_0x14c04f(0x12e)](expect,_0x52c50d[_0x14c04f(0x15f)][_0x14c04f(0x119)])['to']['be'][_0x14c04f(0x15a)],expect(_0x52c50d['checkIfWaitingAuth'][_0x14c04f(0x119)])['to']['be'][_0x14c04f(0x15a)],expect(_0x52c50d[_0x14c04f(0x186)]['called'])['to']['be'][_0x14c04f(0x11e)],expect(_0x52c50d[_0x14c04f(0x14e)][_0x14c04f(0x119)])['to']['be']['true'],expect(_0xf9858[_0x14c04f(0x133)])['to'][_0x14c04f(0x146)](_0x39c11e[_0x14c04f(0x125)]),_0x39c11e[_0x14c04f(0x166)](expect,_0xf9858[_0x14c04f(0x12d)])['to']['be']['true'],expect(_0xf9858[_0x14c04f(0x165)])['to']['be']['a'](_0x39c11e['ibMLN']);}),it('executeChain\x20should\x20execute\x20all\x20steps\x20if\x20all\x20actions\x20succeed',async function(){const _0x579504=_0x3e297f,_0x58f6c3={},_0xb09c5={'type':_0x39c11e[_0x579504(0x125)],'continue':()=>!![],'allowPush':![]};mockPreProcessors[_0x579504(0x14f)][_0x579504(0x11f)]({'type':_0x579504(0x185)}),_0x52c50d[_0x579504(0x151)][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x147)][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x12f)][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x156)][_0x579504(0x11f)](_0xb09c5),_0x52c50d['checkUserPushPermission']['resolves'](_0xb09c5),_0x52c50d[_0x579504(0x159)][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x186)][_0x579504(0x11f)](_0xb09c5),_0x52c50d['writePack'][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x150)][_0x579504(0x11f)](_0xb09c5),_0x52c50d['getDiff']['resolves'](_0xb09c5),_0x52c50d[_0x579504(0x137)][_0x579504(0x11f)](_0xb09c5),_0x52c50d['clearBareClone'][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x17a)][_0x579504(0x11f)](_0xb09c5),_0x52c50d[_0x579504(0x13d)][_0x579504(0x11f)](_0xb09c5);const _0xd96e8a=await _0x3560bd[_0x579504(0x148)](_0x58f6c3);_0x39c11e[_0x579504(0x16a)](expect,mockPreProcessors['parseAction']['called'])['to']['be']['true'],_0x39c11e['hJhyj'](expect,_0x52c50d[_0x579504(0x151)]['called'])['to']['be']['true'],expect(_0x52c50d[_0x579504(0x147)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],expect(_0x52c50d[_0x579504(0x12f)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],_0x39c11e['QvjSH'](expect,_0x52c50d[_0x579504(0x156)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],expect(_0x52c50d[_0x579504(0x15f)][_0x579504(0x119)])['to']['be']['true'],expect(_0x52c50d[_0x579504(0x159)][_0x579504(0x119)])['to']['be']['true'],_0x39c11e['dGzqI'](expect,_0x52c50d[_0x579504(0x186)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],expect(_0x52c50d[_0x579504(0x174)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],expect(_0x52c50d[_0x579504(0x150)]['called'])['to']['be'][_0x579504(0x15a)],expect(_0x52c50d['getDiff'][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],_0x39c11e[_0x579504(0x141)](expect,_0x52c50d[_0x579504(0x137)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],_0x39c11e['knWoa'](expect,_0x52c50d[_0x579504(0x142)]['called'])['to']['be'][_0x579504(0x15a)],expect(_0x52c50d[_0x579504(0x17a)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],_0x39c11e[_0x579504(0x180)](expect,_0x52c50d['blockForAuth']['called'])['to']['be'][_0x579504(0x15a)],_0x39c11e['NJGDM'](expect,_0x52c50d[_0x579504(0x14e)][_0x579504(0x119)])['to']['be'][_0x579504(0x15a)],expect(_0xd96e8a[_0x579504(0x133)])['to']['equal'](_0x39c11e[_0x579504(0x125)]),_0x39c11e['WBoMo'](expect,_0xd96e8a[_0x579504(0x12d)])['to']['be'][_0x579504(0x11e)],_0x39c11e['AuzHa'](expect,_0xd96e8a[_0x579504(0x165)])['to']['be']['a'](_0x579504(0x14c));}),_0x39c11e[_0x3e297f(0x158)](it,_0x39c11e[_0x3e297f(0x13a)],async function(){const _0x3beb3f=_0x3e297f,_0x4a9203={},_0x1fcf7b={'type':'pull','continue':()=>!![],'allowPush':![]};mockPreProcessors[_0x3beb3f(0x14f)][_0x3beb3f(0x11f)]({'type':_0x3beb3f(0x16c)}),_0x52c50d['checkRepoInAuthorisedList'][_0x3beb3f(0x11f)](_0x1fcf7b);const _0xbcdf17=await _0x3560bd[_0x3beb3f(0x148)](_0x4a9203);_0x39c11e['WBoMo'](expect,_0x52c50d[_0x3beb3f(0x147)][_0x3beb3f(0x119)])['to']['be'][_0x3beb3f(0x15a)],_0x39c11e['GyLoY'](expect,_0x52c50d[_0x3beb3f(0x151)][_0x3beb3f(0x119)])['to']['be'][_0x3beb3f(0x11e)],_0x39c11e[_0x3beb3f(0x16a)](expect,_0xbcdf17['type'])['to'][_0x3beb3f(0x146)](_0x39c11e['iFnVW']);}),it('executeChain\x20should\x20handle\x20errors\x20and\x20still\x20call\x20audit',async function(){const _0x588917=_0x3e297f,_0x13b7e5={},_0x5484d9={'type':_0x588917(0x185),'continue':()=>!![],'allowPush':!![]};_0x58fd1b['pre'][_0x588917(0x14f)][_0x588917(0x11f)](_0x5484d9),_0x52c50d[_0x588917(0x151)]['rejects'](new Error(_0x39c11e[_0x588917(0x162)]));try{await _0x3560bd['executeChain'](_0x13b7e5);}catch{}expect(_0x52c50d[_0x588917(0x14e)][_0x588917(0x119)])['to']['be'][_0x588917(0x15a)];}),it('executeChain\x20should\x20run\x20no\x20actions\x20if\x20not\x20a\x20push\x20or\x20pull',async function(){const _0x28206e=_0x3e297f,_0x82dd83={},_0x4f0689={'type':_0x28206e(0x160),'continue':()=>!![],'allowPush':!![]};_0x58fd1b[_0x28206e(0x16e)][_0x28206e(0x14f)][_0x28206e(0x11f)](_0x4f0689);const _0x2cd02c=await _0x3560bd[_0x28206e(0x148)](_0x82dd83);_0x39c11e['TZYjM'](expect,_0x52c50d[_0x28206e(0x147)][_0x28206e(0x119)])['to']['be'][_0x28206e(0x11e)],expect(_0x52c50d[_0x28206e(0x151)][_0x28206e(0x119)])['to']['be'][_0x28206e(0x11e)],expect(_0x2cd02c)['to'][_0x28206e(0x182)][_0x28206e(0x146)](_0x4f0689);}),_0x39c11e[_0x3e297f(0x158)](it,_0x39c11e[_0x3e297f(0x15e)],async function(){const _0x18ebf5=_0x3e297f,_0x429aaa={},_0x4a866c={'type':'push','continue':()=>!![],'allowPush':![],'setAutoApproval':sinon[_0x18ebf5(0x18b)](),'repoName':_0x39c11e['qzxfL'],'commitTo':_0x39c11e[_0x18ebf5(0x13e)]};mockPreProcessors[_0x18ebf5(0x14f)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x151)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x147)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x12f)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d['checkAuthorEmails'][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x15f)]['resolves'](_0x4a866c),_0x52c50d[_0x18ebf5(0x159)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x186)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d['writePack']['resolves'](_0x4a866c),_0x52c50d[_0x18ebf5(0x150)][_0x18ebf5(0x11f)]({..._0x4a866c,'steps':[{'error':![],'logs':[_0x39c11e[_0x18ebf5(0x12c)]]}],'allowPush':!![],'autoApproved':!![]}),_0x52c50d[_0x18ebf5(0x172)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d['gitleaks'][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x142)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x17a)][_0x18ebf5(0x11f)](_0x4a866c),_0x52c50d[_0x18ebf5(0x13d)]['resolves'](_0x4a866c);const _0x4edfbf=sinon[_0x18ebf5(0x18b)](db,_0x18ebf5(0x18e))[_0x18ebf5(0x11f)](!![]),_0x456694=await _0x3560bd['executeChain'](_0x429aaa);_0x39c11e['UUXus'](expect,_0x456694[_0x18ebf5(0x133)])['to'][_0x18ebf5(0x146)](_0x39c11e['YJKrb']),_0x39c11e[_0x18ebf5(0x175)](expect,_0x456694['allowPush'])['to']['be'][_0x18ebf5(0x15a)],_0x39c11e['GyLoY'](expect,_0x456694['continue'])['to']['be']['a'](_0x39c11e[_0x18ebf5(0x121)]),_0x39c11e[_0x18ebf5(0x14b)](expect,_0x4edfbf['calledOnce'])['to']['be'][_0x18ebf5(0x15a)],_0x4edfbf[_0x18ebf5(0x149)]();}),_0x39c11e[_0x3e297f(0x14d)](it,_0x39c11e['dFdsJ'],async function(){const _0x473176=_0x3e297f,_0x29e7ab={},_0x4b3e5e={'type':'push','continue':()=>!![],'allowPush':![],'setAutoRejection':sinon[_0x473176(0x18b)](),'repoName':_0x473176(0x12a),'commitTo':'newCommitHash'};mockPreProcessors[_0x473176(0x14f)]['resolves'](_0x4b3e5e),_0x52c50d[_0x473176(0x151)][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d['checkRepoInAuthorisedList'][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d['checkCommitMessages']['resolves'](_0x4b3e5e),_0x52c50d[_0x473176(0x156)]['resolves'](_0x4b3e5e),_0x52c50d['checkUserPushPermission']['resolves'](_0x4b3e5e),_0x52c50d['checkIfWaitingAuth'][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d[_0x473176(0x186)][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d['writePack'][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d[_0x473176(0x150)][_0x473176(0x11f)]({..._0x4b3e5e,'steps':[{'error':![],'logs':['Push\x20automatically\x20rejected\x20by\x20pre-receive\x20hook.']}],'allowPush':!![],'autoRejected':!![]}),_0x52c50d[_0x473176(0x172)][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d['gitleaks']['resolves'](_0x4b3e5e),_0x52c50d[_0x473176(0x142)][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d[_0x473176(0x17a)][_0x473176(0x11f)](_0x4b3e5e),_0x52c50d['blockForAuth'][_0x473176(0x11f)](_0x4b3e5e);const _0x231556=sinon[_0x473176(0x18b)](db,'reject')[_0x473176(0x11f)](!![]),_0x3f6fcf=await _0x3560bd[_0x473176(0x148)](_0x29e7ab);_0x39c11e[_0x473176(0x183)](expect,_0x3f6fcf[_0x473176(0x133)])['to'][_0x473176(0x146)](_0x473176(0x185)),expect(_0x3f6fcf['allowPush'])['to']['be'][_0x473176(0x15a)],_0x39c11e['kBdwJ'](expect,_0x3f6fcf['continue'])['to']['be']['a'](_0x473176(0x14c)),expect(_0x231556['calledOnce'])['to']['be'][_0x473176(0x15a)],_0x231556[_0x473176(0x149)]();}),_0x39c11e[_0x3e297f(0x158)](it,_0x39c11e[_0x3e297f(0x173)],async function(){const _0x4f09ed=_0x3e297f,_0xe3bc24={},_0x2959a2={'type':_0x4f09ed(0x185),'continue':()=>!![],'allowPush':![],'setAutoApproval':sinon['stub'](),'repoName':_0x4f09ed(0x12a),'commitTo':'newCommitHash'};mockPreProcessors[_0x4f09ed(0x14f)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x151)]['resolves'](_0x2959a2),_0x52c50d[_0x4f09ed(0x147)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x12f)]['resolves'](_0x2959a2),_0x52c50d[_0x4f09ed(0x156)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d['checkUserPushPermission'][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x159)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x186)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d['writePack'][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x150)][_0x4f09ed(0x11f)]({..._0x2959a2,'steps':[{'error':![],'logs':[_0x39c11e[_0x4f09ed(0x12c)]]}],'allowPush':!![],'autoApproved':!![]}),_0x52c50d[_0x4f09ed(0x172)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x137)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x142)][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d['scanDiff'][_0x4f09ed(0x11f)](_0x2959a2),_0x52c50d[_0x4f09ed(0x13d)][_0x4f09ed(0x11f)](_0x2959a2);const _0x29fda4=new Error('Database\x20error'),_0x3af982=sinon[_0x4f09ed(0x18b)](console,_0x4f09ed(0x168));sinon[_0x4f09ed(0x18b)](db,_0x39c11e[_0x4f09ed(0x18d)])['rejects'](_0x29fda4),await _0x3560bd[_0x4f09ed(0x148)](_0xe3bc24),expect(_0x3af982[_0x4f09ed(0x177)](_0x4f09ed(0x167),_0x29fda4['message']))['to']['be']['true'],db[_0x4f09ed(0x18e)]['restore'](),_0x3af982['restore']();}),_0x39c11e[_0x3e297f(0x158)](it,_0x39c11e[_0x3e297f(0x17f)],async function(){const _0x3307be=_0x3e297f,_0x4fc24a={},_0x38a7f7={'type':_0x3307be(0x185),'continue':()=>!![],'allowPush':![],'setAutoRejection':sinon[_0x3307be(0x18b)](),'repoName':_0x3307be(0x12a),'commitTo':_0x3307be(0x16d),'autoRejected':!![]};mockPreProcessors[_0x3307be(0x14f)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x151)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x147)]['resolves'](_0x38a7f7),_0x52c50d[_0x3307be(0x12f)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x156)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d['checkUserPushPermission'][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d['checkIfWaitingAuth'][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d['pullRemote'][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x174)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x150)][_0x3307be(0x11f)]({..._0x38a7f7,'steps':[{'error':![],'logs':[_0x39c11e['LBaKm']]}],'allowPush':![],'autoRejected':!![]}),_0x52c50d[_0x3307be(0x172)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x137)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d[_0x3307be(0x142)]['resolves'](_0x38a7f7),_0x52c50d[_0x3307be(0x17a)][_0x3307be(0x11f)](_0x38a7f7),_0x52c50d['blockForAuth']['resolves'](_0x38a7f7);const _0x56bb30=new Error(_0x3307be(0x153)),_0x1d02b8=sinon[_0x3307be(0x18b)](console,_0x3307be(0x168));sinon['stub'](db,_0x39c11e['JipJt'])[_0x3307be(0x16f)](_0x56bb30),await _0x3560bd['executeChain'](_0x4fc24a),_0x39c11e['kBdwJ'](expect,_0x1d02b8[_0x3307be(0x177)](_0x39c11e[_0x3307be(0x17d)],_0x56bb30[_0x3307be(0x131)]))['to']['be'][_0x3307be(0x15a)],db[_0x3307be(0x134)]['restore'](),_0x1d02b8['restore']();});});