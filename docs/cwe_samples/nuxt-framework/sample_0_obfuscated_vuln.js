'use strict';const _0x543be2=_0x4ca3;(function(_0x383318,_0x4fe79e){const _0x24bc08=_0x4ca3,_0x3bcd04=_0x383318();while(!![]){try{const _0x52e81e=parseInt(_0x24bc08(0x143))/0x1+parseInt(_0x24bc08(0x146))/0x2*(-parseInt(_0x24bc08(0x148))/0x3)+parseInt(_0x24bc08(0x169))/0x4*(-parseInt(_0x24bc08(0x165))/0x5)+-parseInt(_0x24bc08(0x184))/0x6+-parseInt(_0x24bc08(0x18b))/0x7*(-parseInt(_0x24bc08(0x14c))/0x8)+-parseInt(_0x24bc08(0x15e))/0x9+-parseInt(_0x24bc08(0x180))/0xa*(-parseInt(_0x24bc08(0x130))/0xb);if(_0x52e81e===_0x4fe79e)break;else _0x3bcd04['push'](_0x3bcd04['shift']());}catch(_0x4104ad){_0x3bcd04['push'](_0x3bcd04['shift']());}}}(_0x5067,0x69fab));function _0x5067(){const _0x4f0d64=['jrflN','GugpK','err\x20','NGUOK','chalk','../dist/test_helpers/fake_message_chunk_factory','675085ujNQnu','YeClo','setSecurity','6wwqmfO','yECMa','667803wXDKMn','ynvXb','full_message_body','toString','41680SQIGHq','yellow','SignAndEncrypt','pushNewToken','node-opcua-test-fixtures','should\x20not\x20emit\x20an\x20error\x20event\x20if\x20chunks\x20have\x20valid\x20signature','MaVms','chunk','qnbXo','wccck','hAeDN','TEST','Sign','not','eql','node-opcua-test-helpers','hhMLn','DWILv','5705604vHkZXo','bjsQh','GaqmX','uNYDv','slice','PGXwZ','aUnBU','35KqbVJL','message','NpCgV','should\x20not\x20emit\x20an\x20error\x20event\x20with\x20valid\x20SIGN\x20&\x20ENCRYPT\x20chunks','351412frkhvu','izXgg','should\x20reconstruct\x20a\x20full\x20message\x20made\x20of\x20many\x20signed\x20chunks','wwyoM','node-opcua-service-secure-channel','pTWdD','exist','should','feed','rGRcG','this\x20chunk\x20has\x20a\x20altered\x20body\x20(\x20signature\x20verification\x20failed)','rhdcx','XXoWF','OTrqC','hgqsH','KimYK','sftEO','privateKey','BcRsB','Wtwjz','securityMode','emit','kwior','20xCwnAq','MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(MSG)\x20','dNOXp','should\x20process\x20a\x20signed\x20and\x20encrypted\x20message','1541976KqBsmV','should\x20emit\x20an\x20bad_signature\x20event\x20if\x20chunk\x20has\x20been\x20tempered','UAfFz','node-opcua-crypto','make_debugLog','zcCdf','kPzVn','280nVJbDJ','node-opcua-debug','whHYa','tYBJW','vjqCy','oltGl','it\x20should\x20not\x20emit\x20a\x20message\x20event\x20if\x20a\x20signature\x20is\x20invalid\x20or\x20missing','write','qpwQM','FmHuP','error','9483826lPTbnP','log','TTpCC','certs/server_key_1024.pem','MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(OPN)\x20','ySOPE','ERROR','OUbgl','_decodeMessageBody','length','dmkoV','uXPwV','qIQlN'];_0x5067=function(){return _0x4f0d64;};return _0x5067();}const should=require(_0x543be2(0x170)),chalk=require(_0x543be2(0x141)),debugLog=require(_0x543be2(0x18c))[_0x543be2(0x188)](_0x543be2(0x157)),{hexDump}=require('node-opcua-debug'),{MessageSecurityMode}=require(_0x543be2(0x16d)),{readPrivateRsaKey}=require(_0x543be2(0x187)),{make_lorem_ipsum_buffer}=require(_0x543be2(0x15b)),{getFixture}=require(_0x543be2(0x150)),{iterateOnSymmetricEncryptedChunk,iterateOnSignedAndEncryptedMessageChunks,iterateOnSignedMessageChunks,derivedKeys}=require(_0x543be2(0x142)),{MessageBuilder,SecurityPolicy}=require('..'),private_key_filename=getFixture(_0x543be2(0x133));function fake_decodeMessageBody(_0x1af443){const _0x2dbfb6=_0x543be2,_0x6c0c51={'rGRcG':_0x2dbfb6(0x166)};return this[_0x2dbfb6(0x17e)](_0x6c0c51[_0x2dbfb6(0x172)],_0x1af443),!![];}function _0x4ca3(_0x23ac7a,_0x432151){const _0x506762=_0x5067();return _0x4ca3=function(_0x4ca3bb,_0x4a7520){_0x4ca3bb=_0x4ca3bb-0x129;let _0x21d4ef=_0x506762[_0x4ca3bb];return _0x21d4ef;},_0x4ca3(_0x23ac7a,_0x432151);}describe('MessageBuilder\x20with\x20SIGN\x20support',function(){const _0xb167e2=_0x543be2,_0x1b179a={'UAfFz':function(_0x57c6cb,_0x201059){return _0x57c6cb!==_0x201059;},'qpwQM':_0xb167e2(0x18d),'uXPwV':'####***\x20TEMPERED\x20***#####','Wtwjz':function(_0x1abea2,_0x30c202){return _0x1abea2(_0x30c202);},'kPzVn':function(_0x8e54bd,_0x47058b){return _0x8e54bd(_0x47058b);},'jrflN':function(_0x5e55e9,_0x5be996){return _0x5e55e9(_0x5be996);},'MaVms':function(_0x3b63f3,_0x5e9cbf){return _0x3b63f3(_0x5e9cbf);},'TTpCC':function(_0x38d0db){return _0x38d0db();},'NGUOK':_0xb167e2(0x12b),'pTWdD':'ySOPE','BcRsB':'full_message_body','bjsQh':function(_0x12db77,_0x18e5ec){return _0x12db77===_0x18e5ec;},'GugpK':_0xb167e2(0x166),'YeClo':_0xb167e2(0x12f),'qIQlN':function(_0x3bf51a,_0x57826b,_0x3c6186){return _0x3bf51a(_0x57826b,_0x3c6186);}},_0xaeda1f=_0x1b179a['TTpCC'](make_lorem_ipsum_buffer),_0x467eb4=Buffer['from'](_0xaeda1f,_0xaeda1f['length']);it(_0xb167e2(0x151),function(_0x5d0a29){const _0x1547eb=_0xb167e2,_0x154a8e={'wccck':_0x1b179a[_0x1547eb(0x13b)]},_0x219e9f=new MessageBuilder({'maxChunkCount':0xa,'maxMessageSize':_0x467eb4[_0x1547eb(0x139)]*0xa,'maxChunkSize':_0x467eb4['length']+0x3e8});_0x219e9f[_0x1547eb(0x17a)]=_0x1b179a['Wtwjz'](readPrivateRsaKey,private_key_filename),_0x219e9f['_decodeMessageBody']=fake_decodeMessageBody,_0x219e9f['on'](_0x1547eb(0x14a),_0x578973=>{const _0x211a1a=_0x1547eb;_0x1b179a[_0x211a1a(0x186)](_0x1b179a[_0x211a1a(0x12d)],_0x1b179a['qpwQM'])?(_0xcb1b9b[_0x211a1a(0x159)]['exist'](_0x260ee7),_0xe9b0b0[_0x211a1a(0x12c)](_0x154a8e[_0x211a1a(0x155)],0x3a0),_0x1fad6d[_0x211a1a(0x171)](_0x22c646['slice'](0x0,0x14)),_0x2930e4['feed'](_0x5c5e0d[_0x211a1a(0x162)](0x14))):_0x5d0a29();})['on']('message',_0x1d4d9f=>{})['on']('error',_0x4fc482=>{const _0xfb2825=_0x1547eb;console[_0xfb2825(0x131)](_0xfb2825(0x136),_0x4fc482),_0x5d0a29(_0x4fc482);}),iterateOnSignedMessageChunks(_0x467eb4,(_0x333e8f,_0x5ef2c2)=>{const _0x529d46=_0x1547eb;should[_0x529d46(0x159)][_0x529d46(0x16f)](_0x333e8f),_0x219e9f[_0x529d46(0x171)](_0x5ef2c2[_0x529d46(0x162)](0x0,0x14)),_0x219e9f[_0x529d46(0x171)](_0x5ef2c2[_0x529d46(0x162)](0x14));});}),_0x1b179a[_0xb167e2(0x13c)](it,_0xb167e2(0x16b),function(_0x1adb63){const _0x5d83d0=_0xb167e2,_0x505a7e={'aUnBU':_0x1b179a[_0x5d83d0(0x140)],'XXoWF':function(_0x17c386,_0x2702a2){return _0x17c386===_0x2702a2;},'OTrqC':function(_0x4fdd0a,_0x20fc99){return _0x4fdd0a+_0x20fc99;},'ZxevD':function(_0x3699f4,_0x573026){const _0x2d182d=_0x5d83d0;return _0x1b179a[_0x2d182d(0x13d)](_0x3699f4,_0x573026);},'wwyoM':function(_0x530050){const _0x6c8d59=_0x5d83d0;return _0x1b179a[_0x6c8d59(0x132)](_0x530050);},'hAeDN':function(_0x52c536,_0x4903b5){return _0x52c536!==_0x4903b5;},'hgqsH':_0x1b179a[_0x5d83d0(0x16e)]},_0x5f1ee5={},_0x24d51f=new MessageBuilder(_0x5f1ee5);_0x24d51f[_0x5d83d0(0x145)](MessageSecurityMode[_0x5d83d0(0x158)],SecurityPolicy['Basic128Rsa15']),_0x24d51f[_0x5d83d0(0x138)]=fake_decodeMessageBody,_0x24d51f['on'](_0x1b179a[_0x5d83d0(0x17b)],_0x252f37=>{const _0x4f9f20=_0x5d83d0;_0x1b179a['kPzVn'](debugLog,_0x252f37['toString']()),_0x252f37[_0x4f9f20(0x14b)]()[_0x4f9f20(0x170)][_0x4f9f20(0x15a)](_0x467eb4['toString']());})['on'](_0x5d83d0(0x153),_0x4f4f5e=>{const _0x4964aa=_0x5d83d0;_0x1b179a[_0x4964aa(0x13d)](debugLog,hexDump(_0x4f4f5e));})['on'](_0x5d83d0(0x166),_0x3edc54=>{const _0x37fa99=_0x5d83d0;_0x37fa99(0x161)!=='uNYDv'?(_0x49da11[_0x37fa99(0x159)]['exist'](_0x35033a),_0x24cb0b['feed'](_0x29811b)):(_0x1b179a[_0x37fa99(0x18a)](debugLog,_0x1b179a[_0x37fa99(0x152)](hexDump,_0x3edc54)),_0x1b179a[_0x37fa99(0x132)](_0x1adb63));})['on'](_0x5d83d0(0x12f),_0x5c8944=>{const _0x32d82d=_0x5d83d0;_0x505a7e[_0x32d82d(0x175)](_0x32d82d(0x160),_0x32d82d(0x15c))?_0x239344(new _0x415835(_0x505a7e[_0x32d82d(0x164)])):_0x1adb63(new Error(_0x505a7e[_0x32d82d(0x176)]('\x20we\x20are\x20not\x20expecting\x20a\x20error\x20event\x20in\x20this\x20case',_0x5c8944)));}),iterateOnSignedMessageChunks(_0x467eb4,function(_0x3c87ec,_0x8df18a){const _0x3740bc=_0x5d83d0,_0x48ffe9={'HpkXh':function(_0x1dc5a9,_0x4fbc70){return _0x505a7e['ZxevD'](_0x1dc5a9,_0x4fbc70);},'kwior':function(_0x29fb77){const _0xfd5be4=_0x4ca3;return _0x505a7e[_0xfd5be4(0x16c)](_0x29fb77);}};_0x505a7e[_0x3740bc(0x156)](_0x3740bc(0x135),_0x505a7e[_0x3740bc(0x177)])?(_0x48ffe9['HpkXh'](_0x4060a1,_0x321e68),_0x18d001(_0x69e7b7['yellow'](_0x3740bc(0x173))),_0x48ffe9[_0x3740bc(0x17f)](_0xc06caf)):(should['not'][_0x3740bc(0x16f)](_0x3c87ec),_0x24d51f[_0x3740bc(0x171)](_0x8df18a[_0x3740bc(0x162)](0x0,0x14)),_0x24d51f[_0x3740bc(0x171)](_0x8df18a[_0x3740bc(0x162)](0x14)));});}),it(_0xb167e2(0x185),function(_0x5a79ab){const _0x18e3a9=_0xb167e2,_0x54f250={'NpCgV':function(_0x4cc2a0,_0x512514){return _0x4cc2a0(_0x512514);}},_0x216198={},_0x18b1c5=new MessageBuilder(_0x216198);_0x18b1c5[_0x18e3a9(0x138)]=fake_decodeMessageBody,_0x18b1c5['on'](_0x1b179a['BcRsB'],_0x25dd8f=>{const _0x39789c=_0x18e3a9;_0x1b179a[_0x39789c(0x152)](_0x5a79ab,new Error(_0x39789c(0x12b)));})['on'](_0x1b179a[_0x18e3a9(0x13e)],_0xc0e647=>{const _0x4b9c87=_0x18e3a9;_0x5a79ab(new Error(_0x1b179a[_0x4b9c87(0x140)]));})['on'](_0x1b179a[_0x18e3a9(0x144)],_0x1e1b40=>{const _0x16dca9=_0x18e3a9;_0x1b179a[_0x16dca9(0x15f)](_0x16dca9(0x137),'JGLRN')?(_0x23c8bd(_0x54f250[_0x16dca9(0x167)](_0x4c713b,_0x507477)),_0x51976e()):(_0x1b179a[_0x16dca9(0x17c)](debugLog,_0x1e1b40),_0x1b179a[_0x16dca9(0x152)](debugLog,chalk[_0x16dca9(0x14d)]('this\x20chunk\x20has\x20a\x20altered\x20body\x20(\x20signature\x20verification\x20failed)')),_0x5a79ab());}),iterateOnSignedMessageChunks(_0x467eb4,function(_0x3fb706,_0x564714){const _0x8b5656=_0x18e3a9;should[_0x8b5656(0x159)][_0x8b5656(0x16f)](_0x3fb706),_0x564714[_0x8b5656(0x12c)]('####***\x20TEMPERED\x20***#####',0x3a0),_0x18b1c5['feed'](_0x564714[_0x8b5656(0x162)](0x0,0x14)),_0x18b1c5[_0x8b5656(0x171)](_0x564714[_0x8b5656(0x162)](0x14));});});}),describe(_0x543be2(0x134),function(){const _0x19c9b6=_0x543be2,_0x20cbee={'sftEO':function(_0x5a28d8,_0x2c225c){return _0x5a28d8!==_0x2c225c;},'vjqCy':_0x19c9b6(0x182),'oltGl':function(_0x10dddd,_0x909949){return _0x10dddd(_0x909949);},'qnbXo':'full_message_body','rhdcx':'message','ynvXb':function(_0x20b9fa,_0x1e024d,_0x22d2f9){return _0x20b9fa(_0x1e024d,_0x22d2f9);},'PGXwZ':function(_0x2c9386){return _0x2c9386();},'KimYK':_0x19c9b6(0x168)},_0x314ce9=_0x20cbee[_0x19c9b6(0x163)](make_lorem_ipsum_buffer);it(_0x20cbee[_0x19c9b6(0x178)],function(_0x6187c6){const _0x4c7552=_0x19c9b6,_0x5bb58d={'FmHuP':function(_0xb39b74,_0x7d5be8){const _0x18e972=_0x4ca3;return _0x20cbee[_0x18e972(0x179)](_0xb39b74,_0x7d5be8);},'izXgg':_0x20cbee[_0x4c7552(0x129)]},_0x9e85c5={},_0xb08314=new MessageBuilder(_0x9e85c5);_0xb08314[_0x4c7552(0x17a)]=_0x20cbee[_0x4c7552(0x12a)](readPrivateRsaKey,private_key_filename),_0xb08314[_0x4c7552(0x138)]=fake_decodeMessageBody,_0xb08314['on'](_0x20cbee[_0x4c7552(0x154)],_0x332d9d=>{const _0x3fa302=_0x4c7552,_0x18f5c9={'HRUFv':_0x3fa302(0x166)};if(_0x5bb58d[_0x3fa302(0x12e)](_0x5bb58d['izXgg'],_0x5bb58d[_0x3fa302(0x16a)]))return this[_0x3fa302(0x17e)](_0x18f5c9['HRUFv'],_0x3a3bfd),!![];else _0x332d9d[_0x3fa302(0x14b)]()[_0x3fa302(0x170)]['eql'](_0x314ce9['toString']()),_0x6187c6();})['on'](_0x20cbee[_0x4c7552(0x174)],_0x3cd3f0=>{})['on']('error',_0x5e6c80=>{_0x6187c6(_0x5e6c80);}),_0x20cbee[_0x4c7552(0x149)](iterateOnSignedAndEncryptedMessageChunks,_0x314ce9,function(_0x13dace,_0x47b491){const _0x463dde=_0x4c7552;should[_0x463dde(0x159)][_0x463dde(0x16f)](_0x13dace),_0xb08314[_0x463dde(0x171)](_0x47b491[_0x463dde(0x162)](0x0,0x14)),_0xb08314[_0x463dde(0x171)](_0x47b491[_0x463dde(0x162)](0x14));});});}),describe(_0x543be2(0x181),function(){const _0x511c79=_0x543be2,_0x1ca9b9={'OiQIn':function(_0x3b4c1a,_0x4b72f2){return _0x3b4c1a(_0x4b72f2);},'DWILv':_0x511c79(0x166),'tYBJW':function(_0x351157,_0x1d0c4b,_0x196393){return _0x351157(_0x1d0c4b,_0x196393);},'zcCdf':_0x511c79(0x183)},_0x22ad19=make_lorem_ipsum_buffer();_0x1ca9b9[_0x511c79(0x18e)](it,_0x1ca9b9[_0x511c79(0x189)],function(_0x422582){const _0x28eb46=_0x511c79,_0x2079ef={'yECMa':_0x28eb46(0x13f),'dmkoV':function(_0x179ce2,_0x104a14){return _0x179ce2(_0x104a14);}},_0x4d030b=new MessageBuilder({'maxMessageSize':0xf4240,'maxChunkSize':0x800,'maxChunkCount':0x5});_0x4d030b['_decodeMessageBody']=fake_decodeMessageBody,_0x4d030b['securityPolicy']=SecurityPolicy['Basic128Rsa15'],_0x4d030b[_0x28eb46(0x17a)]=_0x1ca9b9['OiQIn'](readPrivateRsaKey,private_key_filename),_0x4d030b[_0x28eb46(0x17d)]=MessageSecurityMode[_0x28eb46(0x14e)],_0x4d030b[_0x28eb46(0x14f)]({'tokenId':0xa},derivedKeys);let _0x4c5063;_0x4d030b['on']('full_message_body',_0x4ed958=>{const _0x941628=_0x28eb46;_0x4ed958[_0x941628(0x14b)]()[_0x941628(0x170)][_0x941628(0x15a)](_0x22ad19['toString']()),_0x422582();})['on'](_0x1ca9b9[_0x28eb46(0x15d)],_0x20de47=>{})['on'](_0x28eb46(0x12f),_0x3eed40=>{const _0x13d9c3=_0x28eb46;console[_0x13d9c3(0x131)](_0x2079ef[_0x13d9c3(0x147)],_0x3eed40[_0x13d9c3(0x166)]),_0x2079ef[_0x13d9c3(0x13a)](_0x422582,_0x3eed40);}),iterateOnSymmetricEncryptedChunk(_0x22ad19,function(_0x29d7e8,_0x5b638e){const _0x4e56bf=_0x28eb46;should['not'][_0x4e56bf(0x16f)](_0x29d7e8),_0x4d030b[_0x4e56bf(0x171)](_0x5b638e);});});});