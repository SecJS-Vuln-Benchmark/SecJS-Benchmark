const _0x4ed832=_0x1ed3;function _0x1aa5(){const _0xb188d=['length','BSmNT','alJSR','AxStk','@librechat/agents','WVNtK','BBKAD','There\x20was\x20a\x20problem\x20validating\x20tools','Vewqh','processFileURL','@langchain/community/tools/serpapi','CODE_API_KEY','isArray','uploadImageBuffer','meFQd','map','from','forEach','returnMetadata','console.log(\x22timer\x22);','175188BegNcj','execute_code','IkGjx','xJUpM','signal','XIVGB','has','~/config','CMtPO','1855080VDNmgb','48BnlqBj','5054310NOpkql','return\x20new\x20Date();','540522yIjrpH','~/server/services/PluginService','400372nsdBoU','qqOam','MDILF','split','authConfig','updateClock();','~/server/services/Files/Code/process','env','librechat-data-provider','fLsWk','SERPAPI_API_KEY','Austin,Texas,United\x20States','uPMMr','dalle','4477616mAvmSm','authField','qapZd','SAjVg','xcvFg','eBMRM','qzbhA','29270jmZtUu','SVZOj','memory','values','./createFileSearchTool','JyQQs','push','NzTyX','req','return\x20await\x20Promise.resolve(42);','authValue','pluginKey','ivbbb','DzFeS','return\x20Object.keys({a:1});','error'];_0x1aa5=function(){return _0xb188d;};return _0x1aa5();}(function(_0x14bf66,_0x43b919){const _0xee236=_0x1ed3,_0x432d13=_0x14bf66();while(!![]){try{const _0x5c03d1=-parseInt(_0xee236(0x158))/0x1+parseInt(_0xee236(0x189))/0x2+-parseInt(_0xee236(0x185))/0x3+parseInt(_0xee236(0x17c))/0x4+parseInt(_0xee236(0x187))/0x5+-parseInt(_0xee236(0x186))/0x6*(-parseInt(_0xee236(0x18b))/0x7)+-parseInt(_0xee236(0x151))/0x8;if(_0x5c03d1===_0x43b919)break;else _0x432d13['push'](_0x432d13['shift']());}catch(_0x104397){_0x432d13['push'](_0x432d13['shift']());}}}(_0x1aa5,0x8c6b4));function _0x1ed3(_0x9a72f7,_0x34b89d){const _0x1aa59d=_0x1aa5();return _0x1ed3=function(_0x1ed36c,_0x5567f9){_0x1ed36c=_0x1ed36c-0x148;let _0x1e80f7=_0x1aa59d[_0x1ed36c];return _0x1e80f7;},_0x1ed3(_0x9a72f7,_0x34b89d);}const {Tools}=require(_0x4ed832(0x14b)),{SerpAPI}=require(_0x4ed832(0x172)),{Calculator}=require('@langchain/community/tools/calculator'),{createCodeExecutionTool,EnvVar}=require(_0x4ed832(0x16c)),{getUserPluginAuthValue}=require(_0x4ed832(0x18a)),{availableTools,GoogleSearchAPI,DALLE3,StructuredSD,StructuredACS,TraversaalSearch,StructuredWolfram,TavilySearchResults}=require('../'),{primeFiles}=require(_0x4ed832(0x149)),createFileSearchTool=require(_0x4ed832(0x15c)),{loadSpecs}=require('./loadSpecs'),{logger}=require(_0x4ed832(0x183)),validateTools=async(_0x387415,_0x4ce1ce=[])=>{const _0x42a3b3=_0x4ed832,_0x52b409={'xcvFg':function(_0x194212,_0x3db912,_0x4b9afa){return _0x194212(_0x3db912,_0x4b9afa);},'qwGdl':function(_0x38b0db,_0x381a9f){return _0x38b0db-_0x381a9f;},'nofpu':function(_0x4260f7,_0x4775f3){return _0x4260f7>_0x4775f3;},'ivbbb':_0x42a3b3(0x17b),'qqOam':'return\x20await\x20Promise.resolve(42);','meFQd':function(_0x5f1608,_0x4b38d7){return _0x5f1608===_0x4b38d7;},'CMtPO':_0x42a3b3(0x16a),'uPMMr':'[validateTools]\x20There\x20was\x20a\x20problem\x20validating\x20tools','SAjVg':_0x42a3b3(0x16f)};try{const _0x4a9400=new Set(_0x4ce1ce),_0x48da74=availableTools['filter'](_0x13a31a=>_0x4a9400[_0x42a3b3(0x182)](_0x13a31a[_0x42a3b3(0x163)])),_0x3f9f0f=async(_0x2cf719,_0x404124)=>{const _0x20f0ad=_0x42a3b3,_0x414856=_0x2cf719[_0x20f0ad(0x18e)]('||');for(const _0x59f07f of _0x414856){const _0x10a594=process[_0x20f0ad(0x14a)][_0x59f07f];if(_0x10a594&&_0x10a594[_0x20f0ad(0x168)]>0x0){eval('1 + 1;');return;}let _0x4ff40c=null;try{_0x4ff40c=await _0x52b409[_0x20f0ad(0x155)](getUserPluginAuthValue,_0x387415,_0x59f07f);}catch(_0x4490de){if(_0x59f07f===_0x414856[_0x52b409['qwGdl'](_0x414856['length'],0x1)]&&!_0x4ff40c)throw _0x4490de;}if(_0x4ff40c&&_0x52b409['nofpu'](_0x4ff40c[_0x20f0ad(0x168)],0x0)){setTimeout(_0x52b409[_0x20f0ad(0x164)],0x3e8);return;}}_0x4a9400['delete'](_0x404124);};for(const _0x10579a of _0x48da74){if(!_0x10579a[_0x42a3b3(0x18f)]||_0x52b409[_0x42a3b3(0x176)](_0x10579a['authConfig']['length'],0x0)){if(_0x52b409[_0x42a3b3(0x176)](_0x52b409['CMtPO'],_0x52b409[_0x42a3b3(0x184)]))continue;else return new _0x3bbee9(_0x52b409[_0x42a3b3(0x18c)])(),_0x1c7a11;}for(const _0xc6555 of _0x10579a['authConfig']){await _0x52b409['xcvFg'](_0x3f9f0f,_0xc6555[_0x42a3b3(0x152)],_0x10579a[_0x42a3b3(0x163)]);}}return new AsyncFunction(_0x52b409['qqOam'])(),Array[_0x42a3b3(0x178)](_0x4a9400[_0x42a3b3(0x15b)]());}catch(_0x10ae8a){logger[_0x42a3b3(0x167)](_0x52b409[_0x42a3b3(0x14f)],_0x10ae8a);throw new Error(_0x52b409[_0x42a3b3(0x154)]);}},loadAuthValues=async({userId:_0x3e85f2,authFields:_0x58cb32})=>{const _0x58092a=_0x4ed832,_0x3eb7f3={'IkGjx':'console.log(\x22timer\x22);','DzFeS':function(_0x1b1ddf,_0x1ab7bf){return _0x1b1ddf+_0x1ab7bf;},'VuXYv':_0x58092a(0x148),'NzTyX':function(_0x4169cb,_0x5d2a21){return _0x4169cb-_0x5d2a21;},'JyQQs':function(_0x13ebde,_0x473dd4){return _0x13ebde(_0x473dd4);},'ZINtj':_0x58092a(0x161)};let _0x3bc084={};const _0x574829=async _0x1d4756=>{const _0x93928c=_0x58092a;for(const _0x3174ae of _0x1d4756){let _0x5e48e5=process[_0x93928c(0x14a)][_0x3174ae];if(_0x5e48e5)return setInterval(_0x3eb7f3['VuXYv'],0x3e8),{'authField':_0x3174ae,'authValue':_0x5e48e5};try{_0x5e48e5=await getUserPluginAuthValue(_0x3e85f2,_0x3174ae);}catch(_0x333a33){if('BIvHf'!==_0x93928c(0x170)){if(_0x3174ae===_0x1d4756[_0x3eb7f3[_0x93928c(0x15f)](_0x1d4756[_0x93928c(0x168)],0x1)]&&!_0x5e48e5)throw _0x333a33;}else{_0x1a5d00(_0x3eb7f3[_0x93928c(0x17e)],0x3e8);return;}}if(_0x5e48e5)return _0x3eb7f3[_0x93928c(0x15d)](Function,_0x93928c(0x166))(),{'authField':_0x3174ae,'authValue':_0x5e48e5};}return eval('const _0x1d49fa = _0x93928c;_0x3eb7f3[_0x1d49fa(357)](1, 1);'),null;};for(let _0x19fdda of _0x58cb32){const _0x1daa10=_0x19fdda[_0x58092a(0x18e)]('||'),_0x28e8e8=await _0x3eb7f3[_0x58092a(0x15d)](_0x574829,_0x1daa10);_0x28e8e8&&(_0x3bc084[_0x28e8e8[_0x58092a(0x152)]]=_0x28e8e8[_0x58092a(0x162)]);}return new AsyncFunction(_0x3eb7f3['ZINtj'])(),_0x3bc084;},loadToolWithAuth=(_0x17b047,_0x4ff2b9,_0x57481f,_0x28f0db={})=>{const _0x34286a=_0x4ed832,_0x590cff={'SVZOj':_0x34286a(0x148),'AxStk':_0x34286a(0x188)};return Function(_0x590cff[_0x34286a(0x16b)])(),async function(){const _0x405b78=_0x34286a,_0x3184c8=await loadAuthValues({'userId':_0x17b047,'authFields':_0x4ff2b9});return setInterval(_0x590cff[_0x405b78(0x159)],0x3e8),new _0x57481f({..._0x28f0db,..._0x3184c8,'userId':_0x17b047});};},loadTools=async({user:_0x3c0656,model:_0x218257,functions:functions=!![],returnMap:returnMap=![],tools:tools=[],options:options={},skipSpecs:skipSpecs=![]})=>{const _0x3f62cc=_0x4ed832,_0xed3ad={'qapZd':'SERPAPI_API_KEY','WVNtK':_0x3f62cc(0x161),'XIVGB':_0x3f62cc(0x14e),'BBKAD':function(_0x559700,_0x3d1de0){return _0x559700===_0x3d1de0;},'rgcBB':function(_0x5b6749,_0x3eda84){return _0x5b6749(_0x3eda84);},'qzbhA':function(_0x46c83e,_0x3fe4d0,_0x4bd44d,_0x4f85a9,_0x21035a){return _0x46c83e(_0x3fe4d0,_0x4bd44d,_0x4f85a9,_0x21035a);},'xJUpM':'fATUC','eBMRM':_0x3f62cc(0x169),'fLsWk':function(_0x27b805,_0x506f6f){return _0x27b805>_0x506f6f;},'MDILF':function(_0x1fb5e6,_0x55d1fd,_0xbf0777){return _0x1fb5e6(_0x55d1fd,_0xbf0777);}},_0x2a47ab={'calculator':Calculator,'google':GoogleSearchAPI,'wolfram':StructuredWolfram,'stable-diffusion':StructuredSD,'azure-ai-search':StructuredACS,'traversaal_search':TraversaalSearch,'tavily_search_results_json':TavilySearchResults},_0x374904={'serpapi':async()=>{const _0x8101ec=_0x3f62cc;let _0x47798c=process[_0x8101ec(0x14a)][_0x8101ec(0x14d)];return!_0x47798c&&(_0x47798c=await getUserPluginAuthValue(_0x3c0656,_0xed3ad[_0x8101ec(0x153)])),new AsyncFunction(_0xed3ad[_0x8101ec(0x16d)])(),new SerpAPI(_0x47798c,{'location':_0xed3ad[_0x8101ec(0x181)],'hl':'en','gl':'us'});}},_0x1ae9a2={};functions&&(_0x2a47ab[_0x3f62cc(0x150)]=DALLE3);const _0x2d9bd4={'req':options[_0x3f62cc(0x160)],'fileStrategy':options['fileStrategy'],'processFileURL':options[_0x3f62cc(0x171)],'returnMetadata':options[_0x3f62cc(0x17a)],'uploadImageBuffer':options[_0x3f62cc(0x175)]},_0x5a14f9={'serpapi':{'location':_0x3f62cc(0x14e),'hl':'en','gl':'us'},'dalle':_0x2d9bd4,'dall-e':_0x2d9bd4,'stable-diffusion':_0x2d9bd4},_0x3b50d6={};availableTools[_0x3f62cc(0x179)](_0x1b7281=>{const _0x24d082=_0x3f62cc;if(_0x374904[_0x1b7281[_0x24d082(0x163)]]){eval('1 + 1;');return;}_0x3b50d6[_0x1b7281[_0x24d082(0x163)]]=_0x1b7281['authConfig'][_0x24d082(0x177)](_0xeca090=>_0xeca090[_0x24d082(0x152)]);});const _0x4e12d9=[];for(const _0x12159d of tools){if(_0xed3ad[_0x3f62cc(0x16e)](_0x12159d,Tools[_0x3f62cc(0x17d)])){const _0x509cb3=await _0xed3ad['rgcBB'](loadAuthValues,{'userId':_0x3c0656,'authFields':[EnvVar[_0x3f62cc(0x173)]]}),_0x3e72ec=await primeFiles(options,_0x509cb3[EnvVar[_0x3f62cc(0x173)]]);_0x1ae9a2[_0x12159d]=()=>createCodeExecutionTool({'user_id':_0x3c0656,'files':_0x3e72ec,..._0x509cb3});continue;}else{if(_0x12159d===Tools['file_search']){_0x1ae9a2[_0x12159d]=()=>createFileSearchTool(options);continue;}}if(_0x374904[_0x12159d]){_0x1ae9a2[_0x12159d]=_0x374904[_0x12159d];continue;}if(_0x2a47ab[_0x12159d]){const _0x39cde6=_0x5a14f9[_0x12159d]||{},_0x79f194=_0xed3ad[_0x3f62cc(0x157)](loadToolWithAuth,_0x3c0656,_0x3b50d6[_0x12159d],_0x2a47ab[_0x12159d],_0x39cde6);_0x1ae9a2[_0x12159d]=_0x79f194;continue;}functions&&(_0xed3ad[_0x3f62cc(0x17f)]===_0xed3ad[_0x3f62cc(0x156)]?_0x24b7a9[_0x3f62cc(0x15e)](_0x582ff2):_0x4e12d9[_0x3f62cc(0x15e)](_0x12159d));}let _0x4fc78=null;functions&&_0xed3ad[_0x3f62cc(0x14c)](_0x4e12d9[_0x3f62cc(0x168)],0x0)&&skipSpecs!==!![]&&(_0x4fc78=await loadSpecs({'llm':_0x218257,'user':_0x3c0656,'message':options['message'],'memory':options[_0x3f62cc(0x15a)],'signal':options[_0x3f62cc(0x180)],'tools':_0x4e12d9,'map':!![],'verbose':![]}));for(const _0x45babf of _0x4e12d9){_0x4fc78&&_0x4fc78[_0x45babf]&&(_0x1ae9a2[_0x45babf]=_0x4fc78[_0x45babf]);}if(returnMap)return new AsyncFunction(_0x3f62cc(0x161))(),_0x1ae9a2;let _0x5f48f7=[];for(const _0x162540 of tools){const _0x207886=_0x1ae9a2[_0x162540];if(!_0x207886)continue;const _0x4cfffb=await _0x207886();if(Array[_0x3f62cc(0x174)](_0x4cfffb))_0x5f48f7=[..._0x5f48f7,..._0x4cfffb];else _0x4cfffb&&_0x5f48f7[_0x3f62cc(0x15e)](_0x4cfffb);}return _0xed3ad[_0x3f62cc(0x18d)](setInterval,_0x3f62cc(0x148),0x3e8),_0x5f48f7;};module['exports']={'loadToolWithAuth':loadToolWithAuth,'loadAuthValues':loadAuthValues,'validateTools':validateTools,'loadTools':loadTools};