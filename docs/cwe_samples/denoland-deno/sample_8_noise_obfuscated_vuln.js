const _0x4cc50e=_0x5cba;(function(_0x45e519,_0x4b0c55){const _0x5cdb2c=_0x5cba,_0x44582d=_0x45e519();while(!![]){try{const _0x73056e=parseInt(_0x5cdb2c(0x169))/0x1*(-parseInt(_0x5cdb2c(0x175))/0x2)+-parseInt(_0x5cdb2c(0x18d))/0x3+parseInt(_0x5cdb2c(0x18a))/0x4+-parseInt(_0x5cdb2c(0x180))/0x5+parseInt(_0x5cdb2c(0x16b))/0x6*(parseInt(_0x5cdb2c(0x171))/0x7)+parseInt(_0x5cdb2c(0x174))/0x8*(-parseInt(_0x5cdb2c(0x17c))/0x9)+parseInt(_0x5cdb2c(0x17f))/0xa;if(_0x73056e===_0x4b0c55)break;else _0x44582d['push'](_0x44582d['shift']());}catch(_0x227dea){_0x44582d['push'](_0x44582d['shift']());}}}(_0x5f4c,0xb22be));const express=require(_0x4cc50e(0x17d)),{PermissionTypes,Permissions,SystemRoles}=require(_0x4cc50e(0x19a)),{getPrompt,getPrompts,savePrompt,deletePrompt,getPromptGroup,getPromptGroups,updatePromptGroup,deletePromptGroup,createPromptGroup,getAllPromptGroups,makePromptProduction}=require('~/models/Prompt'),{requireJwtAuth,generateCheckAccess}=require('~/server/middleware'),{logger}=require(_0x4cc50e(0x198)),router=express[_0x4cc50e(0x192)](),checkPromptAccess=generateCheckAccess(PermissionTypes[_0x4cc50e(0x19c)],[Permissions[_0x4cc50e(0x17a)]]),checkPromptCreate=generateCheckAccess(PermissionTypes['PROMPTS'],[Permissions[_0x4cc50e(0x17a)],Permissions['CREATE']]),checkGlobalPromptShare=generateCheckAccess(PermissionTypes[_0x4cc50e(0x19c)],[Permissions[_0x4cc50e(0x17a)],Permissions[_0x4cc50e(0x195)]],{[Permissions[_0x4cc50e(0x194)]]:['projectIds',_0x4cc50e(0x182)]});function _0x5cba(_0x1f4ec7,_0x2f7349){const _0x5f4c66=_0x5f4c();return _0x5cba=function(_0x5cbad6,_0xfad305){_0x5cbad6=_0x5cbad6-0x160;let _0x345c88=_0x5f4c66[_0x5cbad6];return _0x345c88;},_0x5cba(_0x1f4ec7,_0x2f7349);}function _0x5f4c(){const _0x21e3d9=['12DSrNWm','/:promptId/tags/production','bseac','pXpxR','Error\x20deleting\x20prompt','zSalo','1663781ylgoSU','role','status','9270752fZeJIo','1148364tLHAXp','ADMIN','updateClock();','/all','delete','USE','params','9XywgdN','express','nPUDk','23080360vJkDcn','4627345fBNOhu','Error\x20updating\x20prompt\x20production','removeProjectIds','xNzFw','BxIzb','Error\x20saving\x20prompt','Xmpiu','/:promptId','name','body','4896872euXyac','get','console.log(\x22timer\x22);','1858005GFnkAG','Prompt\x20is\x20required','hrPjK','tKwck','Error\x20updating\x20prompt\x20group','Router','exports','SHARED_GLOBAL','CREATE','/groups/:groupId','XgaZg','~/config','LwybZ','librechat-data-provider','user','PROMPTS','error','groupId','_id','DBDXm','use','author','KvAzz','mdBUt','Prompt\x20group\x20not\x20found','patch','WNodG','Error\x20getting\x20prompt\x20groups','send','Error\x20getting\x20prompt\x20group','DMQGC','uyrgt','Error\x20getting\x20prompts','query','1CyjWnK','NQcJO'];_0x5f4c=function(){return _0x21e3d9;};return _0x5f4c();}router['use'](requireJwtAuth),router[_0x4cc50e(0x1a1)](checkPromptAccess),router[_0x4cc50e(0x18b)]('/groups/:groupId',async(_0x18ea2d,_0x27e684)=>{const _0x353bd9=_0x4cc50e,_0x5e461b={'bseac':function(_0x188bf6,_0x3177d0){return _0x188bf6===_0x3177d0;},'uyrgt':function(_0x546538,_0x283f29){return _0x546538(_0x283f29);},'DMQGC':function(_0x50cc46,_0x4882bb){return _0x50cc46!==_0x4882bb;},'KvAzz':_0x353bd9(0x190),'Xmpiu':_0x353bd9(0x177)};let _0x509c30=_0x18ea2d[_0x353bd9(0x17b)][_0x353bd9(0x19e)];const _0x55dcc0=_0x18ea2d['user']['id'],_0x54435c={'_id':_0x509c30,'$or':[{'projectIds':{'$exists':!![],'$ne':[],'$not':{'$size':0x0}}},{'author':_0x55dcc0}]};_0x5e461b[_0x353bd9(0x16d)](_0x18ea2d['user']['role'],SystemRoles[_0x353bd9(0x176)])&&delete _0x54435c['$or'];try{const _0x2e6fcb=await _0x5e461b[_0x353bd9(0x166)](getPromptGroup,_0x54435c);if(!_0x2e6fcb){if(_0x5e461b[_0x353bd9(0x165)](_0x5e461b[_0x353bd9(0x1a3)],'tKwck'))_0x2a6e6c[_0x353bd9(0x19d)](_0x1cc54d),_0x5a4c5f[_0x353bd9(0x173)](0x1f4)[_0x353bd9(0x163)]({'error':'Error\x20getting\x20prompt\x20groups'});else return setInterval(_0x5e461b[_0x353bd9(0x186)],0x3e8),_0x27e684[_0x353bd9(0x173)](0x194)[_0x353bd9(0x163)]({'message':_0x353bd9(0x1a5)});}_0x27e684[_0x353bd9(0x173)](0xc8)[_0x353bd9(0x163)](_0x2e6fcb);}catch(_0x49308e){logger[_0x353bd9(0x19d)](_0x353bd9(0x164),_0x49308e),_0x27e684['status'](0x1f4)[_0x353bd9(0x163)]({'message':_0x353bd9(0x164)});}}),router[_0x4cc50e(0x18b)](_0x4cc50e(0x178),async(_0x5652a6,_0x5410fc)=>{const _0x2c3f7c=_0x4cc50e,_0x26eab0={'LfVSP':function(_0x4900d6,_0x5b621e,_0x4bcb69){return _0x4900d6(_0x5b621e,_0x4bcb69);},'pXpxR':'Error\x20getting\x20prompt\x20groups'};try{const _0x2d6dc7=await _0x26eab0['LfVSP'](getAllPromptGroups,_0x5652a6,{'author':_0x5652a6[_0x2c3f7c(0x19b)][_0x2c3f7c(0x19f)]});_0x5410fc[_0x2c3f7c(0x173)](0xc8)['send'](_0x2d6dc7);}catch(_0x547bf9){logger[_0x2c3f7c(0x19d)](_0x547bf9),_0x5410fc['status'](0x1f4)['send']({'error':_0x26eab0[_0x2c3f7c(0x16e)]});}}),router[_0x4cc50e(0x18b)]('/groups',async(_0x5562c5,_0x579727)=>{const _0x39f5b8=_0x4cc50e;try{const _0x5548e0=_0x5562c5[_0x39f5b8(0x168)];_0x5548e0[_0x39f5b8(0x1a2)]=_0x5562c5[_0x39f5b8(0x19b)][_0x39f5b8(0x19f)];const _0x55505b=await getPromptGroups(_0x5562c5,_0x5548e0);_0x579727[_0x39f5b8(0x173)](0xc8)['send'](_0x55505b);}catch(_0x343357){logger[_0x39f5b8(0x19d)](_0x343357),_0x579727[_0x39f5b8(0x173)](0x1f4)[_0x39f5b8(0x163)]({'error':_0x39f5b8(0x162)});}});const createPrompt=async(_0x469b6d,_0x1fe203)=>{const _0x2ab5c5=_0x4cc50e,_0x2f8942={'BxIzb':'console.log(\x22timer\x22);','mdBUt':_0x2ab5c5(0x18e)};try{const {prompt:_0x9018e4,group:_0x3d63eb}=_0x469b6d['body'];if(!_0x9018e4)return setTimeout(_0x2f8942[_0x2ab5c5(0x184)],0x3e8),_0x1fe203[_0x2ab5c5(0x173)](0x190)[_0x2ab5c5(0x163)]({'error':_0x2f8942[_0x2ab5c5(0x1a4)]});const _0x37d243={'prompt':_0x9018e4,'group':_0x3d63eb,'author':_0x469b6d[_0x2ab5c5(0x19b)]['id'],'authorName':_0x469b6d['user'][_0x2ab5c5(0x188)]};let _0x16a5ca;_0x3d63eb&&_0x3d63eb[_0x2ab5c5(0x188)]?_0x16a5ca=await createPromptGroup(_0x37d243):_0x16a5ca=await savePrompt(_0x37d243),_0x1fe203['status'](0xc8)[_0x2ab5c5(0x163)](_0x16a5ca);}catch(_0x22df28){logger[_0x2ab5c5(0x19d)](_0x22df28),_0x1fe203[_0x2ab5c5(0x173)](0x1f4)['send']({'error':_0x2ab5c5(0x185)});}};router['post']('/',checkPromptCreate,createPrompt);const patchPromptGroup=async(_0x454109,_0x196707)=>{const _0x4cbb41=_0x4cc50e,_0x2d7424={'hrPjK':function(_0x24e151,_0xc2cb77,_0x463102){return _0x24e151(_0xc2cb77,_0x463102);},'wCooX':_0x4cbb41(0x18e),'XgaZg':function(_0x44a3ed,_0x57b22d){return _0x44a3ed!==_0x57b22d;},'nPUDk':_0x4cbb41(0x161)};try{if(_0x2d7424[_0x4cbb41(0x197)](_0x4cbb41(0x161),_0x2d7424[_0x4cbb41(0x17e)]))return _0x2d7424['hrPjK'](_0xd1deaa,_0x4cbb41(0x18c),0x3e8),_0x42f991[_0x4cbb41(0x173)](0x190)[_0x4cbb41(0x163)]({'error':_0x2d7424['wCooX']});else{const {groupId:_0x57ee8c}=_0x454109[_0x4cbb41(0x17b)],_0x4e8fa7=_0x454109[_0x4cbb41(0x19b)]['id'],_0x4aa591={'_id':_0x57ee8c,'author':_0x4e8fa7};_0x454109['user'][_0x4cbb41(0x172)]===SystemRoles[_0x4cbb41(0x176)]&&delete _0x4aa591['author'];const _0x35e174=await _0x2d7424[_0x4cbb41(0x18f)](updatePromptGroup,_0x4aa591,_0x454109[_0x4cbb41(0x189)]);_0x196707[_0x4cbb41(0x173)](0xc8)[_0x4cbb41(0x163)](_0x35e174);}}catch(_0xd4a7ea){logger[_0x4cbb41(0x19d)](_0xd4a7ea),_0x196707['status'](0x1f4)['send']({'error':_0x4cbb41(0x191)});}};router[_0x4cc50e(0x160)]('/groups/:groupId',checkGlobalPromptShare,patchPromptGroup),router[_0x4cc50e(0x160)](_0x4cc50e(0x16c),checkPromptCreate,async(_0x455674,_0x5268a6)=>{const _0x4d8e1e=_0x4cc50e,_0x2565b7={'DBDXm':function(_0x5b6da2,_0x340395){return _0x5b6da2(_0x340395);},'LwybZ':_0x4d8e1e(0x181)};try{const {promptId:_0x500731}=_0x455674[_0x4d8e1e(0x17b)],_0xdaafbc=await _0x2565b7[_0x4d8e1e(0x1a0)](makePromptProduction,_0x500731);_0x5268a6[_0x4d8e1e(0x173)](0xc8)[_0x4d8e1e(0x163)](_0xdaafbc);}catch(_0x4e2b16){logger[_0x4d8e1e(0x19d)](_0x4e2b16),_0x5268a6[_0x4d8e1e(0x173)](0x1f4)[_0x4d8e1e(0x163)]({'error':_0x2565b7[_0x4d8e1e(0x199)]});}}),router[_0x4cc50e(0x18b)](_0x4cc50e(0x187),async(_0x472923,_0x5759d5)=>{const _0x503609=_0x4cc50e,{promptId:_0x140e20}=_0x472923[_0x503609(0x17b)],_0x3853fb=_0x472923[_0x503609(0x19b)]['id'],_0x5d55a7={'_id':_0x140e20,'author':_0x3853fb};_0x472923[_0x503609(0x19b)][_0x503609(0x172)]===SystemRoles[_0x503609(0x176)]&&delete _0x5d55a7[_0x503609(0x1a2)];const _0x1364ad=await getPrompt(_0x5d55a7);_0x5759d5['status'](0xc8)['send'](_0x1364ad);}),router[_0x4cc50e(0x18b)]('/',async(_0x46b10e,_0x38a2f5)=>{const _0x47d52b=_0x4cc50e,_0x664d09={'NQcJO':_0x47d52b(0x167)};try{const _0x4036f1=_0x46b10e[_0x47d52b(0x19b)]['id'],{groupId:_0x1eb4de}=_0x46b10e[_0x47d52b(0x168)],_0x528263={'groupId':_0x1eb4de,'author':_0x4036f1};_0x46b10e[_0x47d52b(0x19b)][_0x47d52b(0x172)]===SystemRoles[_0x47d52b(0x176)]&&delete _0x528263[_0x47d52b(0x1a2)];const _0x59eb9b=await getPrompts(_0x528263);_0x38a2f5[_0x47d52b(0x173)](0xc8)[_0x47d52b(0x163)](_0x59eb9b);}catch(_0x1c9b4e){logger[_0x47d52b(0x19d)](_0x1c9b4e),_0x38a2f5[_0x47d52b(0x173)](0x1f4)[_0x47d52b(0x163)]({'error':_0x664d09[_0x47d52b(0x16a)]});}});const deletePromptController=async(_0x13608a,_0x5b6b90)=>{const _0x50add4=_0x4cc50e,_0x6bc8b4={'zSalo':function(_0x285bfc,_0x2896ce){return _0x285bfc===_0x2896ce;},'xNzFw':function(_0x4d1cd1,_0x2bdf86){return _0x4d1cd1(_0x2bdf86);}};try{const {promptId:_0x45e514}=_0x13608a[_0x50add4(0x17b)],{groupId:_0x361938}=_0x13608a[_0x50add4(0x168)],_0x305581=_0x13608a[_0x50add4(0x19b)]['id'],_0x3d27ad={'promptId':_0x45e514,'groupId':_0x361938,'author':_0x305581,'role':_0x13608a[_0x50add4(0x19b)][_0x50add4(0x172)]};_0x6bc8b4[_0x50add4(0x170)](_0x13608a[_0x50add4(0x19b)][_0x50add4(0x172)],SystemRoles['ADMIN'])&&delete _0x3d27ad[_0x50add4(0x1a2)];const _0x195183=await _0x6bc8b4[_0x50add4(0x183)](deletePrompt,_0x3d27ad);_0x5b6b90[_0x50add4(0x173)](0xc8)[_0x50add4(0x163)](_0x195183);}catch(_0x5d328b){logger[_0x50add4(0x19d)](_0x5d328b),_0x5b6b90[_0x50add4(0x173)](0x1f4)[_0x50add4(0x163)]({'error':_0x50add4(0x16f)});}};router[_0x4cc50e(0x179)]('/:promptId',checkPromptCreate,deletePromptController),router[_0x4cc50e(0x179)](_0x4cc50e(0x196),checkPromptCreate,async(_0x4b43a7,_0x1e2f2f)=>{const _0x34ac82=_0x4cc50e,{groupId:_0x3e99e8}=_0x4b43a7['params'];_0x1e2f2f['status'](0xc8)[_0x34ac82(0x163)](await deletePromptGroup(_0x3e99e8));}),module[_0x4cc50e(0x193)]=router;