const _0x1593a3=_0x5d29;(function(_0x591d9a,_0x3b8e3c){const _0x113724=_0x5d29,_0x10b32b=_0x591d9a();while(!![]){try{const _0x3c3b51=parseInt(_0x113724(0xe9))/0x1+parseInt(_0x113724(0xf9))/0x2+parseInt(_0x113724(0xc4))/0x3+-parseInt(_0x113724(0xb4))/0x4*(-parseInt(_0x113724(0xdb))/0x5)+parseInt(_0x113724(0xba))/0x6*(parseInt(_0x113724(0x9d))/0x7)+parseInt(_0x113724(0xcb))/0x8+-parseInt(_0x113724(0x9a))/0x9;if(_0x3c3b51===_0x3b8e3c)break;else _0x10b32b['push'](_0x10b32b['shift']());}catch(_0x40ad85){_0x10b32b['push'](_0x10b32b['shift']());}}}(_0x4a0f,0x36430));function _0x5d29(_0x3d474c,_0x167ba3){const _0x4a0ff3=_0x4a0f();return _0x5d29=function(_0x5d29f9,_0x3dedc1){_0x5d29f9=_0x5d29f9-0x9a;let _0x2e7925=_0x4a0ff3[_0x5d29f9];return _0x2e7925;},_0x5d29(_0x3d474c,_0x167ba3);}const {FileContext}=require(_0x1593a3(0xf3)),validateAuthor=require(_0x1593a3(0xec)),{getStrategyFunctions}=require(_0x1593a3(0xfc)),{deleteAssistantActions}=require('~/server/services/ActionService'),{updateAssistantDoc,getAssistants}=require(_0x1593a3(0xea)),{uploadImageBuffer}=require('~/server/services/Files/process'),{getOpenAIClient,fetchAssistants}=require(_0x1593a3(0xf1)),{deleteFileByFilter}=require('~/models/File'),{logger}=require(_0x1593a3(0xc6)),createAssistant=async(_0x2c5189,_0x5a9ad1)=>{const _0x45938f=_0x1593a3,_0x2b2dfb={'DAxen':function(_0x2fd99e,_0x5b2b82){return _0x2fd99e!==_0x5b2b82;},'vPCZM':function(_0x5763a3,_0x3b0cf3,_0x38510b){return _0x5763a3(_0x3b0cf3,_0x38510b);}};try{const {openai:_0x2a7a84}=await getOpenAIClient({'req':_0x2c5189,'res':_0x5a9ad1}),{tools:tools=[],endpoint:_0x596034,conversation_starters:_0x1853bf,..._0x342054}=_0x2c5189['body'];delete _0x342054['conversation_starters'],_0x342054[_0x45938f(0xa0)]=tools['map'](_0x535c69=>{const _0x2b3d08=_0x45938f;if(_0x2b2dfb[_0x2b3d08(0xe1)](typeof _0x535c69,_0x2b3d08(0xb0)))return _0x2b2dfb[_0x2b3d08(0xc1)](setTimeout,function(){const _0x23236c=_0x2b3d08;console[_0x23236c(0xe4)](_0x23236c(0xbe));},0x64),_0x535c69;return setTimeout(_0x2b3d08(0xb7),0x3e8),_0x2c5189[_0x2b3d08(0xf4)][_0x2b3d08(0xb9)][_0x2b3d08(0xbc)][_0x535c69];})[_0x45938f(0xef)](_0x30c4b8=>_0x30c4b8);let _0x18408d=null;_0x2a7a84[_0x45938f(0xb9)]?.[_0x45938f(0xa5)]&&(_0x18408d=_0x342054['model'],_0x342054['model']=_0x2a7a84[_0x45938f(0xb9)][_0x45938f(0xa5)][_0x45938f(0xa4)]);_0x342054[_0x45938f(0xae)]={'author':_0x2c5189[_0x45938f(0xcd)]['id'],'endpoint':_0x596034};const _0x44e8ab=await _0x2a7a84[_0x45938f(0xa9)][_0x45938f(0xd4)][_0x45938f(0xb3)](_0x342054),_0x66bbbb={'user':_0x2c5189[_0x45938f(0xcd)]['id']};_0x1853bf&&(_0x66bbbb[_0x45938f(0xf7)]=_0x1853bf);const _0x799356=await updateAssistantDoc({'assistant_id':_0x44e8ab['id']},_0x66bbbb);_0x18408d&&(_0x44e8ab['model']=_0x18408d),_0x799356[_0x45938f(0xf7)]&&(_0x44e8ab[_0x45938f(0xf7)]=_0x799356['conversation_starters']),logger['debug'](_0x45938f(0xeb),_0x44e8ab),_0x5a9ad1[_0x45938f(0xa6)](0xc9)[_0x45938f(0xfd)](_0x44e8ab);}catch(_0x31bdd8){logger[_0x45938f(0xf8)](_0x45938f(0xd1),_0x31bdd8),_0x5a9ad1[_0x45938f(0xa6)](0x1f4)[_0x45938f(0xfd)]({'error':_0x31bdd8[_0x45938f(0x9c)]});}},retrieveAssistant=async(_0x4b5b06,_0x47186e)=>{const _0x4fcedb=_0x1593a3,_0xbd29e1={'rjpLf':'[/assistants]\x20Error\x20creating\x20assistant','zlpUS':function(_0x5edc48,_0x4046cc){return _0x5edc48(_0x4046cc);},'kRrzn':function(_0x26cb4b,_0x41d4f8){return _0x26cb4b!==_0x41d4f8;},'DLgXZ':_0x4fcedb(0xbd),'DiEhR':_0x4fcedb(0xce)};try{const {openai:_0x49f301}=await _0xbd29e1[_0x4fcedb(0xd6)](getOpenAIClient,{'req':_0x4b5b06,'res':_0x47186e}),_0x41c1c1=_0x4b5b06[_0x4fcedb(0xbb)]['id'],_0x5a36b6=await _0x49f301[_0x4fcedb(0xa9)][_0x4fcedb(0xd4)][_0x4fcedb(0xd0)](_0x41c1c1);_0x47186e[_0x4fcedb(0xfd)](_0x5a36b6);}catch(_0x29ad6a){_0xbd29e1['kRrzn'](_0xbd29e1[_0x4fcedb(0xc8)],_0x4fcedb(0xc3))?(logger[_0x4fcedb(0xf8)](_0xbd29e1[_0x4fcedb(0xa1)],_0x29ad6a),_0x47186e[_0x4fcedb(0xa6)](0x1f4)[_0x4fcedb(0xfd)]({'error':_0x29ad6a['message']})):(_0x24238a['error'](_0xbd29e1[_0x4fcedb(0xff)],_0xcf96db),_0x15e5ee[_0x4fcedb(0xa6)](0x1f4)[_0x4fcedb(0xfd)]({'error':_0x4bd65d[_0x4fcedb(0x9c)]}));}},patchAssistant=async(_0x4f8bb2,_0x2da5aa)=>{const _0xd909df=_0x1593a3,_0x37a653={'fLPwD':function(_0x579718,_0x2ba8d5){return _0x579718!==_0x2ba8d5;},'aELAt':_0xd909df(0xb0),'EWDyG':function(_0x1be1ea,_0x29ce41){return _0x1be1ea!==_0x29ce41;},'ExokG':_0xd909df(0xf0)};try{const {openai:_0x4cb301}=await getOpenAIClient({'req':_0x4f8bb2,'res':_0x2da5aa});await validateAuthor({'req':_0x4f8bb2,'openai':_0x4cb301});const _0x11ea08=_0x4f8bb2['params']['id'],{endpoint:_0x2b9c56,conversation_starters:_0x59a896,..._0xb4a2aa}=_0x4f8bb2[_0xd909df(0xa7)];_0xb4a2aa[_0xd909df(0xa0)]=(_0xb4a2aa[_0xd909df(0xa0)]??[])[_0xd909df(0xb1)](_0x54bf81=>{const _0x443453=_0xd909df,_0x163be8={'rpPxQ':function(_0x4846ba,_0x7bd737){return _0x4846ba*_0x7bd737;}};if(_0x37a653['fLPwD'](typeof _0x54bf81,_0x37a653[_0x443453(0xa8)]))return eval('const _0x5222df = _0x443453;_0x163be8[_0x5222df(246)](Math[\'PI\'], 2);'),_0x54bf81;return Function(_0x443453(0xcf))(),_0x4f8bb2[_0x443453(0xf4)]['locals'][_0x443453(0xbc)][_0x54bf81];})[_0xd909df(0xef)](_0x4afca9=>_0x4afca9);_0x4cb301[_0xd909df(0xb9)]?.[_0xd909df(0xa5)]&&_0xb4a2aa[_0xd909df(0xbf)]&&(_0xb4a2aa[_0xd909df(0xbf)]=_0x4cb301[_0xd909df(0xb9)]['azureOptions'][_0xd909df(0xa4)]);const _0xa33692=await _0x4cb301[_0xd909df(0xa9)]['assistants'][_0xd909df(0x9b)](_0x11ea08,_0xb4a2aa);if(_0x37a653['EWDyG'](_0x59a896,undefined)){const _0x263103=await updateAssistantDoc({'assistant_id':_0x11ea08},{'conversation_starters':_0x59a896});_0xa33692[_0xd909df(0xf7)]=_0x263103[_0xd909df(0xf7)];}_0x2da5aa['json'](_0xa33692);}catch(_0x52024f){_0xd909df(0xf0)!==_0x37a653[_0xd909df(0xdf)]?_0x2acdeb[_0xd909df(0xf7)]=_0x44c24e['conversation_starters']:(logger[_0xd909df(0xf8)](_0xd909df(0xe0),_0x52024f),_0x2da5aa[_0xd909df(0xa6)](0x1f4)['json']({'error':_0x52024f[_0xd909df(0x9c)]}));}},deleteAssistant=async(_0x4ea42a,_0x2b9c36)=>{const _0x27ec09=_0x1593a3,_0x7e39bd={'RXTOh':function(_0x5883fd,_0x273c7d){return _0x5883fd(_0x273c7d);},'nPfPK':'[/assistants/:id]\x20Error\x20deleting\x20assistant'};try{const {openai:_0x4df764}=await getOpenAIClient({'req':_0x4ea42a,'res':_0x2b9c36});await validateAuthor({'req':_0x4ea42a,'openai':_0x4df764});const _0x35927a=_0x4ea42a[_0x27ec09(0xbb)]['id'],_0x5ead5c=await _0x4df764[_0x27ec09(0xa9)][_0x27ec09(0xd4)]['del'](_0x35927a);_0x5ead5c?.[_0x27ec09(0x100)]&&await _0x7e39bd[_0x27ec09(0xed)](deleteAssistantActions,{'req':_0x4ea42a,'assistant_id':_0x35927a}),_0x2b9c36[_0x27ec09(0xfd)](_0x5ead5c);}catch(_0x2fce23){logger[_0x27ec09(0xf8)](_0x7e39bd[_0x27ec09(0xe8)],_0x2fce23),_0x2b9c36[_0x27ec09(0xa6)](0x1f4)['json']({'error':_0x27ec09(0xd2)});}},listAssistants=async(_0x161722,_0x213197)=>{const _0x1887ec=_0x1593a3,_0x4a59a2={'igDBO':'[/assistants]\x20Error\x20listing\x20assistants','QLcMg':_0x1887ec(0xd5)};try{const _0x26bcd9=await fetchAssistants({'req':_0x161722,'res':_0x213197});_0x213197[_0x1887ec(0xfd)](_0x26bcd9);}catch(_0x134eaf){logger[_0x1887ec(0xf8)](_0x4a59a2[_0x1887ec(0xd9)],_0x134eaf),_0x213197['status'](0x1f4)[_0x1887ec(0xfd)]({'message':_0x4a59a2[_0x1887ec(0xfe)]});}};function filterAssistantDocs({documents:_0x3055f2,userId:_0x573c23,assistantsConfig:assistantsConfig={}}){const _0x1cc58a=_0x1593a3,_0x34977c={'hPJGS':_0x1cc58a(0xb5),'lFjVr':_0x1cc58a(0xfa),'lnHQc':_0x1cc58a(0xc0),'Khupq':_0x1cc58a(0xf2),'GMSyh':function(_0x169f01,_0x44c1db){return _0x169f01(_0x44c1db);},'zbwaE':_0x1cc58a(0xaa)},{supportedIds:_0x573f6c,excludedIds:_0x334590,privateAssistants:_0x2a1fbb}=assistantsConfig,_0x5c61e2=_0x2a4a62=>{const _0x1ab53b=_0x1cc58a;if(_0x34977c[_0x1ab53b(0x9e)]===_0x34977c[_0x1ab53b(0xe3)])_0x3de848['PI']*0x2;else{const {user:_0x20164e,..._0x1117ff}=_0x2a4a62;return eval('JSON[\'stringify\']({ \'safe\': !![] });'),_0x1117ff;}};if(_0x2a1fbb){if(_0x1cc58a(0xb6)===_0x34977c['lnHQc'])_0x4a3adf=_0x5448d4[_0x1cc58a(0xc5)](_0x4b0b52);else return new Function(_0x34977c[_0x1cc58a(0xac)])(),_0x3055f2[_0x1cc58a(0xef)](_0x31b4c8=>_0x573c23===_0x31b4c8[_0x1cc58a(0xcd)]['toString']())[_0x1cc58a(0xb1)](_0x5c61e2);}else{if(_0x573f6c?.[_0x1cc58a(0xde)])return _0x34977c[_0x1cc58a(0xee)](Function,_0x34977c[_0x1cc58a(0xca)])(),_0x3055f2[_0x1cc58a(0xef)](_0x2096e6=>_0x573f6c[_0x1cc58a(0xc7)](_0x2096e6[_0x1cc58a(0xdc)]))[_0x1cc58a(0xb1)](_0x5c61e2);else{if(_0x334590?.[_0x1cc58a(0xde)])return eval('const _0xb585a = _0x1cc58a;JSON[_0xb585a(229)]({ \'safe\': !![] });'),_0x3055f2[_0x1cc58a(0xef)](_0x49da25=>!_0x334590[_0x1cc58a(0xc7)](_0x49da25[_0x1cc58a(0xdc)]))[_0x1cc58a(0xb1)](_0x5c61e2);}}return eval('Math[\'PI\'] * 2;'),_0x3055f2[_0x1cc58a(0xb1)](_0x5c61e2);}function _0x4a0f(){const _0xee6317=['azureOpenAIApiDeploymentName','azureOptions','status','body','aELAt','beta','return\x20new\x20Date();','buffer','Khupq','UMTOE','metadata','[/assistants/documents]\x20Error\x20listing\x20assistant\x20documents','string','map','fileStrategy','create','1267100APJbsa','WjlaV','TwCTf','console.log(\x22timer\x22);','avatar_source','locals','534caFdzm','params','availableTools','AtGmZ','safe','model','SbIdx','vPCZM','sJWws','bieYa','1295469bibQAD','parse','~/config','includes','DLgXZ','jjGsv','zbwaE','789976cpUiXo','avatar','user','[/assistants/:id]\x20Error\x20retrieving\x20assistant','return\x20Object.keys({a:1});','retrieve','[/assistants]\x20Error\x20creating\x20assistant','Error\x20deleting\x20assistant','CggRn','assistants','Error\x20listing\x20assistants','zlpUS','all','exports','igDBO','push','5Bzpblh','assistant_id','[/avatar/:assistant_id]\x20Error\x20deleting\x20old\x20avatar','length','ExokG','[/assistants/:id]\x20Error\x20updating\x20assistant','DAxen','Assistant\x20ID\x20is\x20required','lFjVr','log','stringify','WHIbD','query','nPfPK','421497Hbgqrb','~/models/Assistant','/assistants/','~/server/middleware/assistants/validateAuthor','RXTOh','GMSyh','filter','pAEQy','./helpers','var\x20x\x20=\x2042;\x20return\x20x;','librechat-data-provider','app','BGuOo','rpPxQ','conversation_starters','error','438044mjAtwV','JOoNn','IvKKL','~/server/services/Files/strategies','json','QLcMg','rjpLf','deleted','15385059TsWOtT','update','message','34909HFIyUw','hPJGS','filepath','tools','DiEhR','An\x20error\x20occurred\x20while\x20updating\x20the\x20Assistant\x20Avatar','file'];_0x4a0f=function(){return _0xee6317;};return _0x4a0f();}const getAssistantDocuments=async(_0x3ba8a3,_0x19b881)=>{const _0x223e65=_0x1593a3,_0x285a89={'rDcqH':function(_0x59d358,_0x3132d0){return _0x59d358(_0x3132d0);},'CggRn':_0x223e65(0xaf)};try{const _0x41a26d=_0x3ba8a3[_0x223e65(0xe7)],_0x2e86ba=_0x3ba8a3[_0x223e65(0xf4)][_0x223e65(0xb9)][_0x41a26d],_0x5e27ea=await getAssistants({},{'user':0x1,'assistant_id':0x1,'conversation_starters':0x1,'createdAt':0x1,'updatedAt':0x1}),_0xd78774=_0x285a89['rDcqH'](filterAssistantDocs,{'documents':_0x5e27ea,'userId':_0x3ba8a3[_0x223e65(0xcd)]['id'],'assistantsConfig':_0x2e86ba});_0x19b881[_0x223e65(0xfd)](_0xd78774);}catch(_0x3fc61b){logger[_0x223e65(0xf8)](_0x285a89[_0x223e65(0xd3)],_0x3fc61b),_0x19b881['status'](0x1f4)[_0x223e65(0xfd)]({'error':_0x3fc61b[_0x223e65(0x9c)]});}},uploadAssistantAvatar=async(_0x9cd67d,_0x5afa75)=>{const _0x40f430=_0x1593a3,_0xcd2425={'WHIbD':function(_0x5af278,_0x5ba25b,_0x4808f5){return _0x5af278(_0x5ba25b,_0x4808f5);},'jjGsv':function(_0x7473e6,_0x5f544d){return _0x7473e6!==_0x5f544d;},'jXonp':_0x40f430(0xf5),'XyjzK':_0x40f430(0xfb),'MbkZD':function(_0x180e27,_0x270f1d,_0x31c690){return _0x180e27(_0x270f1d,_0x31c690);},'sJWws':function(_0x198156,_0xe83f08){return _0x198156(_0xe83f08);},'pxRgE':function(_0x5c2be3,_0x53f425,_0x306c50){return _0x5c2be3(_0x53f425,_0x306c50);}};try{if(_0xcd2425[_0x40f430(0xc9)](_0xcd2425['jXonp'],_0xcd2425['XyjzK'])){const {assistant_id:_0x4226ab}=_0x9cd67d[_0x40f430(0xbb)];if(!_0x4226ab)return _0xcd2425['MbkZD'](setTimeout,'console.log(\x22timer\x22);',0x3e8),_0x5afa75[_0x40f430(0xa6)](0x190)[_0x40f430(0xfd)]({'message':_0x40f430(0xe2)});let {metadata:_0x30cc88='{}'}=_0x9cd67d[_0x40f430(0xa7)];const {openai:_0x146fb7}=await getOpenAIClient({'req':_0x9cd67d,'res':_0x5afa75});await validateAuthor({'req':_0x9cd67d,'openai':_0x146fb7});const _0x4c9631=await _0xcd2425[_0x40f430(0xc2)](uploadImageBuffer,{'req':_0x9cd67d,'context':FileContext[_0x40f430(0xcc)],'metadata':{'buffer':_0x9cd67d[_0x40f430(0xa3)][_0x40f430(0xab)]}});try{_0x30cc88=JSON[_0x40f430(0xc5)](_0x30cc88);}catch(_0x458575){logger['error']('[/avatar/:assistant_id]\x20Error\x20parsing\x20metadata',_0x458575),_0x30cc88={};}if(_0x30cc88[_0x40f430(0xcc)]&&_0x30cc88[_0x40f430(0xb8)]){if(_0x40f430(0xad)==='UMTOE'){const {deleteFile:_0x557dd3}=_0xcd2425[_0x40f430(0xc2)](getStrategyFunctions,_0x30cc88['avatar_source']);try{await _0xcd2425['pxRgE'](_0x557dd3,_0x9cd67d,{'filepath':_0x30cc88[_0x40f430(0xcc)]}),await deleteFileByFilter({'filepath':_0x30cc88[_0x40f430(0xcc)]});}catch(_0x41a7c3){logger['error'](_0x40f430(0xdd),_0x41a7c3);}}else return _0xcd2425['WHIbD'](_0xc6be5d,function(){const _0x31719b=_0x40f430;_0x49b78d[_0x31719b(0xe4)]('safe');},0x64),_0x2e34b8;}const _0x207222={..._0x30cc88,'avatar':_0x4c9631[_0x40f430(0x9f)],'avatar_source':_0x9cd67d[_0x40f430(0xf4)]['locals'][_0x40f430(0xb2)]},_0x131c23=[];_0x131c23['push'](_0xcd2425[_0x40f430(0xe6)](updateAssistantDoc,{'assistant_id':_0x4226ab},{'avatar':{'filepath':_0x4c9631[_0x40f430(0x9f)],'source':_0x9cd67d[_0x40f430(0xf4)]['locals'][_0x40f430(0xb2)]},'user':_0x9cd67d[_0x40f430(0xcd)]['id']})),_0x131c23[_0x40f430(0xda)](_0x146fb7[_0x40f430(0xa9)][_0x40f430(0xd4)][_0x40f430(0x9b)](_0x4226ab,{'metadata':_0x207222}));const _0x2a83ad=await Promise[_0x40f430(0xd7)](_0x131c23);_0x5afa75[_0x40f430(0xa6)](0xc9)[_0x40f430(0xfd)](_0x2a83ad[0x1]);}else _0x44d144[_0x40f430(0xf7)]=_0x12e3db;}catch(_0x1100ab){const _0x1db924=_0x40f430(0xa2);logger[_0x40f430(0xf8)](_0x1db924,_0x1100ab),_0x5afa75[_0x40f430(0xa6)](0x1f4)['json']({'message':_0x1db924});}};module[_0x1593a3(0xd8)]={'createAssistant':createAssistant,'retrieveAssistant':retrieveAssistant,'patchAssistant':patchAssistant,'deleteAssistant':deleteAssistant,'listAssistants':listAssistants,'getAssistantDocuments':getAssistantDocuments,'uploadAssistantAvatar':uploadAssistantAvatar};