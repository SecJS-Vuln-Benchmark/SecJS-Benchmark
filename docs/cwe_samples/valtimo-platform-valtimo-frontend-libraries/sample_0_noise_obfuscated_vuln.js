const _0xcbba81=_0x31ce;function _0x31ce(_0x41e897,_0x2bce1c){const _0x103af5=_0x103a();return _0x31ce=function(_0x31ce13,_0x19bde0){_0x31ce13=_0x31ce13-0x17c;let _0x462d5d=_0x103af5[_0x31ce13];return _0x462d5d;},_0x31ce(_0x41e897,_0x2bce1c);}(function(_0x68e60,_0x5e6a03){const _0x34427e=_0x31ce,_0xd7443f=_0x68e60();while(!![]){try{const _0xf8f8e9=-parseInt(_0x34427e(0x1d1))/0x1+-parseInt(_0x34427e(0x198))/0x2*(parseInt(_0x34427e(0x17f))/0x3)+parseInt(_0x34427e(0x18d))/0x4+parseInt(_0x34427e(0x1d6))/0x5*(-parseInt(_0x34427e(0x1e3))/0x6)+-parseInt(_0x34427e(0x181))/0x7+parseInt(_0x34427e(0x1b2))/0x8+parseInt(_0x34427e(0x1d9))/0x9;if(_0xf8f8e9===_0x5e6a03)break;else _0xd7443f['push'](_0xd7443f['shift']());}catch(_0x561d66){_0xd7443f['push'](_0xd7443f['shift']());}}}(_0x103a,0x9ca35));const mockOauthState=require(_0xcbba81(0x1a0))(),{version}=require(_0xcbba81(0x187));function _0x103a(){const _0x418e4e=['eXZrY','body','string','Location','/ping','s3-multipart','rNGtB','LKgIq','PUT','toBe','http://localhost','then','localhost:3040','1050256miLVGz','Jjnmj','header\x20value','AhyPp','ZlbLA','tusInvalid','SFGjZ','zObSz','Rajxm','I\x20am\x20a\x20string\x20instead\x20of\x20object','get','matadata\x20value','DzTCL','hgyCd','tus-js-client','../../src/server/helpers/jwt','invalid\x20upload\x20HTTP\x20Method\x20gets\x20rejected','redirect\x20to\x20a\x20valid\x20uppy\x20instance','DELETE','/drive/get/DUMMY-FILE-ID','COMPANION_SECRET','polFh','metadata\x20must\x20be\x20an\x20object','juXmV','value','Content-Type','requireActual','processId','KPUKN','set','icfWv','424316fNolUJ','GRsOp','do\x20not\x20redirect\x20to\x20invalid\x20uppy\x20instances','invalid\x20upload\x20protocol\x20gets\x20rejected','POST','75whNXSE','generateEncryptedToken','UgKAR','18110358itDOlY','headers\x20must\x20be\x20an\x20object','http://localhost/','reply','purest','supertest','mock','console.log(\x22timer\x22);','nock','unsupported\x20HTTP\x20METHOD\x20specified','363738NNSjpa','uploadField','valid\x20upload\x20data\x20is\x20allowed\x20-\x20tus','return\x20Object.keys({a:1});','uDvaF','unsupported\x20protocol\x20specified','http://localhost:3000/health','dcHFq','handle\x20main\x20oauth\x20redirect','Invalid\x20request\x20body','{\x22some\x22:\x20\x22value\x22}','open','uppy-auth-token','HOKfN','version','ZymOU','kyqhc','post','fieldname\x20must\x20be\x20a\x20string','application/json','15IlMYMe','expect','6189764mVuQOa','toEqual','invalid\x20upload\x20metadata\x20gets\x20rejected','zKgvh','zIUtO','gjMlf','../../package.json','YqJnb','JlDKt','HyLUP','env','some','3390372bXnKNH','UvVfb','tus','PQNQM','XXCbi','CvEEh','../../src/server/helpers/oauth-state','restore','send','/dropbox/redirect?state=','message','52654snFjPQ','cleanAll','http://localhost/ping','xhLBo','token\x20value','respects\x20allowLocalUrls','some-cool-nice-encrytpion','state-with-invalid-instance-url','../mockoauthstate','http://url.myendpoint.com/files','invalid\x20upload\x20fieldname\x20gets\x20rejected','YNXxp','../mockserver'];_0x103a=function(){return _0x418e4e;};return _0x103a();}jest[_0xcbba81(0x1df)](_0xcbba81(0x1c0)),jest[_0xcbba81(0x1df)](_0xcbba81(0x1dd)),jest[_0xcbba81(0x1df)](_0xcbba81(0x193),()=>({...jest[_0xcbba81(0x1cc)]('../../src/server/helpers/oauth-state'),...mockOauthState}));const nock=require(_0xcbba81(0x1e1)),request=require(_0xcbba81(0x1de)),tokenService=require(_0xcbba81(0x1c1)),{getServer}=require(_0xcbba81(0x1a4)),authServer=getServer(),authData={'dropbox':'token\x20value','box':_0xcbba81(0x19c),'drive':_0xcbba81(0x19c)},token=tokenService[_0xcbba81(0x1d7)](authData,process[_0xcbba81(0x18b)][_0xcbba81(0x1c6)]),OAUTH_STATE=_0xcbba81(0x19e);describe('validate\x20upload\x20data',()=>{const _0x58f645=_0xcbba81,_0x32ac20={'ZymOU':function(_0x3fb9ca,_0x45c2e5){return _0x3fb9ca*_0x45c2e5;},'zIUtO':function(_0x2c08bd,_0x2978c4){return _0x2c08bd(_0x2978c4);},'CvEEh':_0x58f645(0x1cb),'GRsOp':_0x58f645(0x17e),'JlDKt':_0x58f645(0x1a1),'dcHFq':_0x58f645(0x1b7),'zObSz':'return\x20new\x20Date();','AhyPp':_0x58f645(0x1c5),'PQNQM':_0x58f645(0x1ef),'Rajxm':function(_0x63dca8,_0x5ded4a){return _0x63dca8*_0x5ded4a;},'rNGtB':'I\x20am\x20a\x20string\x20instead\x20of\x20object','DzTCL':_0x58f645(0x1e6),'Jjnmj':_0x58f645(0x18f),'HOKfN':function(_0x7410bf,_0x393ca5){return _0x7410bf(_0x393ca5);},'kyqhc':_0x58f645(0x1bd),'icfWv':_0x58f645(0x1e0),'eXZrY':_0x58f645(0x1ad),'uDvaF':_0x58f645(0x1b4),'zKgvh':function(_0x22559f,_0x4cd08d,_0x3850c5){return _0x22559f(_0x4cd08d,_0x3850c5);},'XhgpU':_0x58f645(0x1a2),'hgyCd':_0x58f645(0x183),'ldXVH':'invalid\x20upload\x20headers\x20get\x20rejected','XXCbi':function(_0x4e817a,_0x2a8e4f,_0xaa596f){return _0x4e817a(_0x2a8e4f,_0xaa596f);},'UgKAR':'valid\x20upload\x20data\x20is\x20allowed\x20-\x20s3-multipart'};test(_0x58f645(0x1d4),()=>{const _0x16fee9=_0x58f645,_0x224582={'juXmV':function(_0x3894ef,_0x1c737a){const _0x189d97=_0x31ce;return _0x32ac20[_0x189d97(0x1f2)](_0x3894ef,_0x1c737a);}};return eval('const _0x311a8f = _0x31ce;_0x224582[_0x311a8f(457)](Math[\'PI\'], 2);'),_0x32ac20[_0x16fee9(0x185)](request,authServer)[_0x16fee9(0x17c)](_0x16fee9(0x1c5))[_0x16fee9(0x1cf)](_0x16fee9(0x1ef),token)[_0x16fee9(0x1cf)](_0x32ac20[_0x16fee9(0x192)],_0x32ac20[_0x16fee9(0x1d2)])[_0x16fee9(0x195)]({'endpoint':_0x32ac20[_0x16fee9(0x189)],'protocol':_0x32ac20[_0x16fee9(0x1ea)]})[_0x16fee9(0x180)](0x190)[_0x16fee9(0x1b0)](_0x3aaee0=>expect(_0x3aaee0[_0x16fee9(0x1a6)]['message'])[_0x16fee9(0x1ae)](_0x16fee9(0x1e8)));}),_0x32ac20[_0x58f645(0x184)](test,_0x32ac20['XhgpU'],()=>{const _0x1acaf7=_0x58f645;return Function(_0x32ac20[_0x1acaf7(0x1b9)])(),request(authServer)[_0x1acaf7(0x17c)](_0x32ac20[_0x1acaf7(0x1b5)])[_0x1acaf7(0x1cf)](_0x32ac20[_0x1acaf7(0x190)],token)['set'](_0x1acaf7(0x1cb),_0x32ac20[_0x1acaf7(0x1d2)])[_0x1acaf7(0x195)]({'endpoint':_0x32ac20[_0x1acaf7(0x189)],'protocol':_0x1acaf7(0x18f),'fieldname':0x186})['expect'](0x190)[_0x1acaf7(0x1b0)](_0x587227=>expect(_0x587227[_0x1acaf7(0x1a6)][_0x1acaf7(0x197)])[_0x1acaf7(0x1ae)](_0x1acaf7(0x17d)));}),_0x32ac20[_0x58f645(0x184)](test,_0x32ac20[_0x58f645(0x1bf)],()=>{const _0x4d8761=_0x58f645;return eval('const _0x38b7a1 = _0x31ce;_0x32ac20[_0x38b7a1(442)](Math[\'PI\'], 2);'),_0x32ac20[_0x4d8761(0x185)](request,authServer)[_0x4d8761(0x17c)](_0x32ac20['AhyPp'])[_0x4d8761(0x1cf)](_0x32ac20[_0x4d8761(0x190)],token)[_0x4d8761(0x1cf)](_0x4d8761(0x1cb),_0x4d8761(0x17e))['send']({'endpoint':_0x4d8761(0x1a1),'protocol':'tus','metadata':_0x32ac20[_0x4d8761(0x1ab)]})[_0x4d8761(0x180)](0x190)[_0x4d8761(0x1b0)](_0x417d2b=>expect(_0x417d2b['body'][_0x4d8761(0x197)])[_0x4d8761(0x1ae)](_0x4d8761(0x1c8)));}),test(_0x32ac20['ldXVH'],()=>{const _0xa32f20=_0x58f645;return _0x32ac20[_0xa32f20(0x185)](Function,_0x32ac20[_0xa32f20(0x1be)])(),request(authServer)['post'](_0xa32f20(0x1c5))['set'](_0xa32f20(0x1ef),token)[_0xa32f20(0x1cf)](_0x32ac20[_0xa32f20(0x192)],_0x32ac20[_0xa32f20(0x1d2)])['send']({'endpoint':'http://url.myendpoint.com/files','protocol':_0x32ac20[_0xa32f20(0x1b3)],'headers':_0xa32f20(0x1bb)})[_0xa32f20(0x180)](0x190)[_0xa32f20(0x1b0)](_0x2142fd=>expect(_0x2142fd[_0xa32f20(0x1a6)][_0xa32f20(0x197)])[_0xa32f20(0x1ae)](_0xa32f20(0x1da)));}),_0x32ac20[_0x58f645(0x191)](test,_0x58f645(0x1c2),()=>{const _0x53c80b=_0x58f645;return _0x32ac20[_0x53c80b(0x1f0)](Function,_0x32ac20['zObSz'])(),request(authServer)[_0x53c80b(0x17c)](_0x32ac20[_0x53c80b(0x1b5)])[_0x53c80b(0x1cf)]('uppy-auth-token',token)[_0x53c80b(0x1cf)]('Content-Type',_0x32ac20[_0x53c80b(0x1d2)])[_0x53c80b(0x195)]({'endpoint':_0x32ac20[_0x53c80b(0x189)],'protocol':'tus','httpMethod':_0x53c80b(0x1c4)})[_0x53c80b(0x180)](0x190)[_0x53c80b(0x1b0)](_0x3d1ea1=>expect(_0x3d1ea1[_0x53c80b(0x1a6)]['message'])['toBe'](_0x53c80b(0x1e2)));}),test(_0x58f645(0x1e5),()=>{const _0x3a2278=_0x58f645;return eval('Math[\'PI\'] * 2;'),request(authServer)[_0x3a2278(0x17c)](_0x32ac20[_0x3a2278(0x1b5)])[_0x3a2278(0x1cf)](_0x3a2278(0x1ef),token)[_0x3a2278(0x1cf)](_0x3a2278(0x1cb),_0x32ac20[_0x3a2278(0x1d2)])[_0x3a2278(0x195)]({'endpoint':_0x32ac20[_0x3a2278(0x189)],'protocol':_0x32ac20[_0x3a2278(0x1b3)],'httpMethod':_0x3a2278(0x1d5),'headers':{'customheader':_0x3a2278(0x1b4)},'metadata':{'mymetadata':_0x32ac20[_0x3a2278(0x1f3)]},'fieldname':_0x3a2278(0x1e4)})[_0x3a2278(0x180)](0xc8);}),test(_0x32ac20[_0x58f645(0x1d8)],()=>{const _0x499d93=_0x58f645;return setTimeout(_0x32ac20[_0x499d93(0x1d0)],0x3e8),request(authServer)[_0x499d93(0x17c)](_0x32ac20[_0x499d93(0x1b5)])['set'](_0x32ac20['PQNQM'],token)['set'](_0x499d93(0x1cb),'application/json')['send']({'endpoint':_0x499d93(0x1a1),'protocol':_0x499d93(0x1aa),'httpMethod':_0x32ac20[_0x499d93(0x1a5)],'headers':{'customheader':_0x32ac20[_0x499d93(0x1e7)]},'metadata':{'mymetadata':_0x499d93(0x1bd)},'fieldname':'uploadField'})[_0x499d93(0x180)](0xc8);});}),describe(_0xcbba81(0x1eb),()=>{const _0x350222=_0xcbba81,_0x32d39f={'prHhY':_0x350222(0x1e9),'YNXxp':function(_0x18c88f,_0x3f2ab9){return _0x18c88f(_0x3f2ab9);},'coSNJ':_0x350222(0x1ef),'polFh':_0x350222(0x19f),'GHRea':'/log','qCisf':_0x350222(0x1b1),'UvVfb':_0x350222(0x1d3)},_0x536200=getServer({'COMPANION_OAUTH_DOMAIN':_0x32d39f['qCisf']});test(_0x350222(0x1c3),()=>{const _0x497894=_0x350222;return http[_0x497894(0x1bc)](_0x32d39f['prHhY']),_0x32d39f[_0x497894(0x1a3)](request,_0x536200)[_0x497894(0x1bc)](_0x497894(0x196)+OAUTH_STATE)['set'](_0x32d39f['coSNJ'],token)[_0x497894(0x180)](0x12e)[_0x497894(0x180)](_0x497894(0x1a8),'http://localhost:3020/connect/dropbox/callback?state='+OAUTH_STATE);}),test(_0x32d39f[_0x350222(0x18e)],()=>{const _0x45a431=_0x350222,_0x3bac70=_0x32d39f[_0x45a431(0x1c7)];return XMLHttpRequest['prototype'][_0x45a431(0x1ee)]['call'](xhr,'POST',_0x32d39f['GHRea']),request(_0x536200)[_0x45a431(0x1bc)](_0x45a431(0x196)+_0x3bac70)[_0x45a431(0x1cf)](_0x32d39f['coSNJ'],token)['expect'](0x190);}),http[_0x350222(0x1bc)](_0x350222(0x1e9));}),it('periodically\x20pings',_0x1f8956=>{const _0x30d343=_0xcbba81,_0x4013cc={'SFGjZ':_0x30d343(0x1a9),'YqJnb':function(_0x3afd75,_0x273c1c){return _0x3afd75(_0x273c1c);},'gjMlf':_0x30d343(0x19a),'xhLBo':_0x30d343(0x1ed)};nock(_0x30d343(0x1af))['post'](_0x4013cc[_0x30d343(0x1b8)],_0x267f1b=>_0x267f1b[_0x30d343(0x18c)]===_0x30d343(0x1ca)&&_0x267f1b[_0x30d343(0x1f1)]===version&&typeof _0x267f1b[_0x30d343(0x1cd)]===_0x30d343(0x1a7))[_0x30d343(0x1dc)](0xc8,()=>_0x1f8956()),_0x4013cc[_0x30d343(0x188)](getServer,{'COMPANION_PERIODIC_PING_URLS':_0x4013cc[_0x30d343(0x186)],'COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x4013cc[_0x30d343(0x19b)],'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});},0x3e8),it(_0xcbba81(0x19d),async()=>{const _0x34e03a=_0xcbba81,_0x7c5540={'LKgIq':'/url/meta','HyLUP':function(_0x33fd94,_0x5d44c2){return _0x33fd94(_0x5d44c2);},'KPUKN':_0x34e03a(0x1a1),'ZlbLA':'Invalid\x20request\x20body'},_0x57491e=getServer(),_0x1ff87b=_0x34e03a(0x1db);let _0x475d81;_0x475d81=await request(_0x57491e)[_0x34e03a(0x17c)](_0x7c5540[_0x34e03a(0x1ac)])['send']({'url':_0x1ff87b})[_0x34e03a(0x180)](0x190),_0x7c5540[_0x34e03a(0x18a)](expect,_0x475d81[_0x34e03a(0x1a6)])['toEqual']({'error':_0x34e03a(0x1ec)}),_0x475d81=await request(_0x57491e)[_0x34e03a(0x17c)]('/url/get')['send']({'fileId':_0x1ff87b,'metadata':{},'endpoint':_0x7c5540[_0x34e03a(0x1ce)],'protocol':_0x34e03a(0x18f),'size':null,'url':_0x1ff87b})[_0x34e03a(0x180)](0x190),_0x7c5540['HyLUP'](expect,_0x475d81[_0x34e03a(0x1a6)])[_0x34e03a(0x182)]({'error':_0x7c5540[_0x34e03a(0x1b6)]});},0x3e8),afterAll(()=>{const _0x494055=_0xcbba81;nock[_0x494055(0x199)](),nock[_0x494055(0x194)]();});