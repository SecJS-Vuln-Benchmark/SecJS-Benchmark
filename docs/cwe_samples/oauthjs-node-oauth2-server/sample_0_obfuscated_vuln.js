'use strict';function _0xbc54(_0x2a968d,_0x59eca1){const _0x256311=_0x2563();return _0xbc54=function(_0xbc546d,_0x2b5d1a){_0xbc546d=_0xbc546d-0xf7;let _0x2adc8=_0x256311[_0xbc546d];return _0x2adc8;},_0xbc54(_0x2a968d,_0x59eca1);}const _0x5d2dfa=_0xbc54;function _0x2563(){const _0x4f3ac5=['samplingFunc','terminate','length','JfXvL','publishingInterval','Good','shutdown','ServerEngine\x20Subscriptions\x20service','nodeId','callCount','laGto','messageSent','subscription_terminated','BaseDataVariableType','sequenceNumber','ckZAZ','requestHandle','authenticationToken','tick','should\x20check\x20the\x20subscription\x20live\x20cycle','BadSubscriptionIdInvalid','initialize','ns=0;i=2258','dePEm','cumulatedSessionCount','113312AIQtru','node-opcua-types','cumulatedSubscriptionCount','clock','createSubscription','AZQ\x20should\x20receive\x20StatusChangeNotification\x20from\x20first\x20subscription\x20even\x20if\x20publishRequest\x20arrives\x20late','maxKeepAliveCount','notificationData','call','getCall','responseHeader','serviceResult','createSession','115dHwzZn','describeWithLeakDetector','Reporting','ijglA','exist','eql','68SHDnAG','3074517VLtqmo','BadNoSubscription','args','CREATING','subscriptionId','sScRV','526268bDWDFe','node-opcua-address-space/testHelpers','lifeTimeCount','KEEPALIVE','publishEngine','XVoMy','LATE','status','Hrnnm','findNode','spy','FTcyM','constructor','uIuQj','StatusChangeNotification','dispose','YDGmk','DDD\x20delete\x20a\x20subscription\x20with\x202\x20outstanding\x20PublishRequest','7OlibOR','1917570TDEkPW','removeListener','_on_PublishRequest','addressSpace','statusCode','currentSubscriptionCount','currentSessionCount','sinon','reaIE','new_subscription','ZDZ-1\x20create\x20and\x20terminate\x202\x20subscriptions\x20,\x20with\x204\x20publish\x20requests','CLOSED','6266755rpyIDJ','node-opcua-service-subscription','10YfiwOK','node-opcua-leak-detector','deleteSubscription','instanceOf','39507WdMjSs','RVipn','AZW2\x20should\x20terminate\x20a\x20orphan\x20subscription\x20containing\x20monitored\x20items','ACOIl','7563808KeBMcp','closeSession','Both','state','BadTimeout','notificationMessage','MEmzx','equal','gaeVS','name','WNoEl','createMonitoredItem','CloseSession','should','should\x20maintain\x20the\x20correct\x20number\x20of\x20cumulatedSubscriptionCount\x20at\x20the\x20engine\x20level'];_0x2563=function(){return _0x4f3ac5;};return _0x2563();}(function(_0x1a5bcf,_0x108899){const _0x2074b8=_0xbc54,_0x51f369=_0x1a5bcf();while(!![]){try{const _0x5b6182=parseInt(_0x2074b8(0x11f))/0x1+parseInt(_0x2074b8(0x118))/0x2*(parseInt(_0x2074b8(0x144))/0x3)+parseInt(_0x2074b8(0x105))/0x4*(-parseInt(_0x2074b8(0x112))/0x5)+parseInt(_0x2074b8(0x132))/0x6*(parseInt(_0x2074b8(0x131))/0x7)+parseInt(_0x2074b8(0x148))/0x8+parseInt(_0x2074b8(0x119))/0x9*(-parseInt(_0x2074b8(0x140))/0xa)+-parseInt(_0x2074b8(0x13e))/0xb;if(_0x5b6182===_0x108899)break;else _0x51f369['push'](_0x51f369['shift']());}catch(_0x40fd6c){_0x51f369['push'](_0x51f369['shift']());}}}(_0x2563,0xa517f));const should=require(_0x5d2dfa(0x155)),sinon=require(_0x5d2dfa(0x139)),{MonitoringMode,PublishRequest}=require(_0x5d2dfa(0x13f)),{StatusCodes,StatusCode}=require('node-opcua-status-code'),{TimestampsToReturn}=require('node-opcua-service-read'),{MonitoredItemCreateRequest}=require('node-opcua-service-subscription'),{ServiceFault}=require(_0x5d2dfa(0x106)),{get_mini_nodeset_filename}=require(_0x5d2dfa(0x120)),{ServerEngine,SubscriptionState}=require('..'),{with_fake_timer}=require('./helper_with_fake_timer'),mini_nodeset_filename=get_mini_nodeset_filename(),describe=require(_0x5d2dfa(0x141))[_0x5d2dfa(0x113)];describe(_0x5d2dfa(0x15e),function(){const _0x58eb6b=_0x5d2dfa,_0x198a13={'sJIva':'FolderType','WNoEl':_0x58eb6b(0x13b),'MEmzx':_0x58eb6b(0xf8),'TczlN':function(_0x2f56d2,_0x3cce56){return _0x2f56d2*_0x3cce56;},'Hrnnm':function(_0x2697e7,_0x59f8b7){return _0x2697e7*_0x59f8b7;},'trDiw':function(_0x1127f4,_0x10b0bf){return _0x1127f4*_0x10b0bf;},'sScRV':'CloseSession','FTcyM':function(_0x117028,_0x43244c){return _0x117028*_0x43244c;},'gaeVS':function(_0x1c5d5f,_0x216099){return _0x1c5d5f(_0x216099);},'uIuQj':function(_0x6eb0bc,_0x1d84be,_0x3253d5){return _0x6eb0bc(_0x1d84be,_0x3253d5);},'ijglA':_0x58eb6b(0xff),'ACOIl':'XCX\x20session\x20should\x20emit\x20a\x20new_subscription\x20and\x20subscription_terminated\x20event','IPKFp':_0x58eb6b(0x156),'dePEm':function(_0x353386,_0x34dffc,_0x1a4ba5){return _0x353386(_0x34dffc,_0x1a4ba5);},'ucFNo':_0x58eb6b(0x13c),'YDGmk':function(_0x5468d6,_0x4c0197,_0x4c55b8){return _0x5468d6(_0x4c0197,_0x4c55b8);},'reaIE':_0x58eb6b(0x146)},_0x43f258=this;let _0x4c9271,_0x306df9,_0x519ec6,_0x13fd5d;beforeEach(function(_0x263961){const _0x204c84=_0x58eb6b;_0x4c9271=new ServerEngine(),_0x4c9271[_0x204c84(0x101)]({'nodeset_filename':mini_nodeset_filename},function(){const _0x422d93=_0x204c84;_0x519ec6=_0x4c9271['addressSpace'][_0x422d93(0x128)](_0x198a13['sJIva'])[_0x422d93(0x15f)],_0x13fd5d=_0x4c9271['addressSpace']['findNode'](_0x422d93(0xf9))[_0x422d93(0x15f)],_0x263961();});}),_0x198a13[_0x58eb6b(0x150)](afterEach,async()=>{const _0x4c2143=_0x58eb6b;_0x306df9=null,should[_0x4c2143(0x116)](_0x4c9271),await _0x4c9271[_0x4c2143(0x15d)](),_0x4c9271=null;}),_0x198a13[_0x58eb6b(0x12c)](it,'should\x20return\x20an\x20error\x20when\x20trying\x20to\x20delete\x20an\x20non-existing\x20subscription',async()=>{const _0xed9ebb=_0x58eb6b;_0x306df9=_0x4c9271['createSession']();const _0x1180ad=await _0x306df9['deleteSubscription'](-0x1a85);_0x1180ad[_0xed9ebb(0x155)][_0xed9ebb(0x117)](StatusCodes[_0xed9ebb(0x100)]);}),_0x198a13[_0x58eb6b(0x12c)](it,_0x198a13[_0x58eb6b(0x115)],async()=>{const _0x2ce02e=_0x58eb6b;_0x306df9=_0x4c9271['createSession'](),_0x306df9['currentSubscriptionCount'][_0x2ce02e(0x155)][_0x2ce02e(0x14f)](0x0),_0x306df9[_0x2ce02e(0x107)][_0x2ce02e(0x155)][_0x2ce02e(0x14f)](0x0);const _0x359372=_0x306df9['createSubscription']({'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe});_0x359372['monitoredItemCount']['should'][_0x2ce02e(0x117)](0x0),_0x306df9[_0x2ce02e(0x137)]['should'][_0x2ce02e(0x14f)](0x1),_0x306df9['cumulatedSubscriptionCount'][_0x2ce02e(0x155)][_0x2ce02e(0x14f)](0x1),_0x306df9['getSubscription'](_0x359372['id'])[_0x2ce02e(0x155)][_0x2ce02e(0x14f)](_0x359372);const _0x224265=await _0x306df9['deleteSubscription'](_0x359372['id']);_0x224265[_0x2ce02e(0x155)]['eql'](StatusCodes[_0x2ce02e(0x15c)]),_0x306df9['currentSubscriptionCount'][_0x2ce02e(0x155)][_0x2ce02e(0x14f)](0x0),_0x306df9[_0x2ce02e(0x107)][_0x2ce02e(0x155)][_0x2ce02e(0x14f)](0x1),_0x4c9271[_0x2ce02e(0x137)][_0x2ce02e(0x155)][_0x2ce02e(0x14f)](0x0),_0x4c9271[_0x2ce02e(0x107)][_0x2ce02e(0x155)]['equal'](0x1),_0x359372[_0x2ce02e(0x158)](),_0x359372[_0x2ce02e(0x12e)]();}),it(_0x198a13[_0x58eb6b(0x147)],async()=>{const _0xc257ec=_0x58eb6b;_0x306df9=_0x4c9271[_0xc257ec(0x111)](),_0x306df9[_0xc257ec(0x137)][_0xc257ec(0x155)][_0xc257ec(0x14f)](0x0),_0x306df9[_0xc257ec(0x107)]['should'][_0xc257ec(0x14f)](0x0);const _0x271e17=sinon[_0xc257ec(0x129)](),_0xae8e89=sinon[_0xc257ec(0x129)]();_0x306df9['on'](_0x198a13[_0xc257ec(0x152)],_0x271e17),_0x306df9['on'](_0x198a13[_0xc257ec(0x14e)],_0xae8e89);const _0x326d0a=_0x306df9[_0xc257ec(0x109)]({'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe});_0x306df9[_0xc257ec(0x137)][_0xc257ec(0x155)][_0xc257ec(0x14f)](0x1),_0x306df9[_0xc257ec(0x107)][_0xc257ec(0x155)][_0xc257ec(0x14f)](0x1),_0x271e17[_0xc257ec(0x160)]['should']['eql'](0x1),_0xae8e89[_0xc257ec(0x160)][_0xc257ec(0x155)]['eql'](0x0);const _0x3f1bca=await _0x306df9[_0xc257ec(0x142)](_0x326d0a['id']);_0x3f1bca[_0xc257ec(0x155)]['be'][_0xc257ec(0x143)](StatusCode),_0x271e17[_0xc257ec(0x160)][_0xc257ec(0x155)][_0xc257ec(0x117)](0x1),_0xae8e89[_0xc257ec(0x160)][_0xc257ec(0x155)][_0xc257ec(0x117)](0x1),_0x306df9[_0xc257ec(0x133)](_0xc257ec(0x13b),_0x271e17),_0x306df9[_0xc257ec(0x133)](_0x198a13[_0xc257ec(0x14e)],_0xae8e89),_0x306df9[_0xc257ec(0x137)]['should']['equal'](0x0),_0x306df9[_0xc257ec(0x107)]['should'][_0xc257ec(0x14f)](0x1);}),it(_0x198a13['IPKFp'],async()=>{const _0x426d4d=_0x58eb6b;_0x306df9=_0x4c9271[_0x426d4d(0x111)]();const _0x58629d={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe};_0x4c9271[_0x426d4d(0x137)][_0x426d4d(0x155)]['equal'](0x0),_0x4c9271[_0x426d4d(0x107)]['should'][_0x426d4d(0x14f)](0x0),_0x4c9271[_0x426d4d(0x138)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x1),_0x4c9271[_0x426d4d(0x104)]['should']['equal'](0x1);const _0x538c7d=_0x306df9[_0x426d4d(0x109)](_0x58629d);_0x4c9271[_0x426d4d(0x137)]['should'][_0x426d4d(0x14f)](0x1),_0x4c9271[_0x426d4d(0x107)]['should'][_0x426d4d(0x14f)](0x1);const _0x1b776f=_0x306df9[_0x426d4d(0x109)](_0x58629d);_0x4c9271[_0x426d4d(0x137)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x2),_0x4c9271[_0x426d4d(0x107)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x2),await _0x306df9[_0x426d4d(0x142)](_0x1b776f['id']),_0x4c9271[_0x426d4d(0x137)][_0x426d4d(0x155)]['equal'](0x1),_0x4c9271[_0x426d4d(0x107)][_0x426d4d(0x155)]['equal'](0x2);const _0xa89671=_0x4c9271[_0x426d4d(0x111)]();_0x4c9271[_0x426d4d(0x138)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x2),_0x4c9271[_0x426d4d(0x104)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x2),_0x4c9271['currentSubscriptionCount'][_0x426d4d(0x155)]['equal'](0x1);const _0x41e9d2=_0xa89671['createSubscription'](_0x58629d),_0x97be4f=_0xa89671[_0x426d4d(0x109)](_0x58629d),_0x1789b3=_0xa89671['createSubscription'](_0x58629d);_0x4c9271[_0x426d4d(0x137)]['should'][_0x426d4d(0x14f)](0x4),_0x4c9271['cumulatedSubscriptionCount'][_0x426d4d(0x155)]['equal'](0x5),await _0x4c9271['closeSession'](_0xa89671[_0x426d4d(0xfd)],!![]),_0x4c9271[_0x426d4d(0x138)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x1),_0x4c9271[_0x426d4d(0x104)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x2),_0x4c9271[_0x426d4d(0x137)]['should'][_0x426d4d(0x14f)](0x1),_0x4c9271[_0x426d4d(0x107)][_0x426d4d(0x155)]['equal'](0x5),await _0x306df9[_0x426d4d(0x142)](_0x538c7d['id']),_0x4c9271[_0x426d4d(0x137)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x0),_0x4c9271[_0x426d4d(0x107)][_0x426d4d(0x155)][_0x426d4d(0x14f)](0x5);}),_0x198a13[_0x58eb6b(0x12c)](it,_0x58eb6b(0x130),async()=>{const _0x38b9db=_0x58eb6b;_0x306df9=_0x4c9271[_0x38b9db(0x111)]();const _0x836c91={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0xc701c=_0x306df9[_0x38b9db(0x109)](_0x836c91),_0x317fe3=sinon[_0x38b9db(0x129)](),_0x1a5ef0={'requestHeader':{'requestHandle':0x64}};_0x306df9['publishEngine'][_0x38b9db(0x134)](new PublishRequest(_0x1a5ef0),_0x317fe3);const _0xc41695={'requestHeader':{'requestHandle':0x65}};_0x306df9['publishEngine'][_0x38b9db(0x134)](new PublishRequest(_0xc41695),_0x317fe3),_0x317fe3[_0x38b9db(0x160)][_0x38b9db(0x155)][_0x38b9db(0x117)](0x0),await _0x306df9['deleteSubscription'](_0xc701c['id']),_0x317fe3[_0x38b9db(0x160)]['should'][_0x38b9db(0x117)](0x2),_0x317fe3[_0x38b9db(0x10e)](0x0)[_0x38b9db(0x11b)][0x1]['responseHeader']['requestHandle'][_0x38b9db(0x155)][_0x38b9db(0x117)](0x64),_0x317fe3['getCall'](0x1)['args'][0x1]['responseHeader'][_0x38b9db(0xfc)][_0x38b9db(0x155)][_0x38b9db(0x117)](0x65),_0x317fe3[_0x38b9db(0x10e)](0x0)['args'][0x1]['responseHeader'][_0x38b9db(0x110)][_0x38b9db(0x155)][_0x38b9db(0x117)](StatusCodes['BadNoSubscription']),_0x317fe3[_0x38b9db(0x10e)](0x1)['args'][0x1][_0x38b9db(0x10f)]['serviceResult']['should'][_0x38b9db(0x117)](StatusCodes[_0x38b9db(0x11a)]);}),_0x198a13[_0x58eb6b(0x103)](it,_0x198a13['ucFNo'],async()=>{await with_fake_timer['call'](_0x43f258,async()=>{const _0x293bea=_0xbc54;_0x306df9=_0x4c9271[_0x293bea(0x111)]({'sessionTimeout':0x5f5e100});const _0x32da44={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x4c5300=_0x306df9[_0x293bea(0x109)](_0x32da44);_0x4c5300['state'][_0x293bea(0x155)]['eql'](SubscriptionState[_0x293bea(0x11c)]),_0x43f258['clock']['tick'](_0x4c5300[_0x293bea(0x15b)]),_0x4c5300[_0x293bea(0x14b)][_0x293bea(0x155)][_0x293bea(0x117)](SubscriptionState['CREATING']),_0x4c5300[_0x293bea(0xf7)][_0x293bea(0x155)][_0x293bea(0x117)](![]),await _0x306df9['deleteSubscription'](_0x4c5300['id']),_0x4c5300[_0x293bea(0x14b)][_0x293bea(0x155)]['eql'](SubscriptionState[_0x293bea(0x13d)]);const _0x5114ce=_0x306df9[_0x293bea(0x109)](_0x32da44);_0x5114ce['state'][_0x293bea(0x155)][_0x293bea(0x117)](SubscriptionState['CREATING']),_0x43f258['clock'][_0x293bea(0xfe)](_0x198a13['TczlN'](_0x5114ce['publishingInterval'],_0x5114ce['maxKeepAliveCount'])),_0x5114ce[_0x293bea(0x14b)]['should']['eql'](SubscriptionState[_0x293bea(0x125)]);const _0x1eeb53=sinon[_0x293bea(0x129)]();_0x306df9[_0x293bea(0x123)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x64}}),_0x1eeb53),_0x306df9[_0x293bea(0x123)][_0x293bea(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x1eeb53),_0x306df9[_0x293bea(0x123)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x1eeb53),_0x306df9[_0x293bea(0x123)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x1eeb53),_0x43f258[_0x293bea(0x108)][_0x293bea(0xfe)](_0x5114ce[_0x293bea(0x15b)]),_0x5114ce['state'][_0x293bea(0x155)]['eql'](SubscriptionState[_0x293bea(0x122)]),await _0x306df9[_0x293bea(0x142)](_0x5114ce['id']),_0x5114ce['state']['should'][_0x293bea(0x117)](SubscriptionState[_0x293bea(0x13d)]),_0x1eeb53[_0x293bea(0x160)][_0x293bea(0x155)][_0x293bea(0x117)](0x4),_0x1eeb53[_0x293bea(0x10e)](0x0)['args'][0x1][_0x293bea(0x10f)][_0x293bea(0x110)]['should'][_0x293bea(0x117)](StatusCodes[_0x293bea(0x15c)]),_0x1eeb53[_0x293bea(0x10e)](0x0)[_0x293bea(0x11b)][0x1]['subscriptionId'][_0x293bea(0x155)][_0x293bea(0x117)](_0x5114ce['id']),_0x1eeb53[_0x293bea(0x10e)](0x0)[_0x293bea(0x11b)][0x1][_0x293bea(0x14d)][_0x293bea(0x10c)][_0x293bea(0x159)][_0x293bea(0x155)][_0x293bea(0x117)](0x0),_0x1eeb53['getCall'](0x1)[_0x293bea(0x11b)][0x1][_0x293bea(0x10f)][_0x293bea(0x110)][_0x293bea(0x155)][_0x293bea(0x117)](StatusCodes[_0x293bea(0x11a)]),_0x1eeb53['getCall'](0x2)[_0x293bea(0x11b)][0x1]['responseHeader'][_0x293bea(0x110)][_0x293bea(0x155)][_0x293bea(0x117)](StatusCodes['BadNoSubscription']),_0x1eeb53[_0x293bea(0x10e)](0x3)[_0x293bea(0x11b)][0x1][_0x293bea(0x10f)][_0x293bea(0x110)][_0x293bea(0x155)]['eql'](StatusCodes['BadNoSubscription']),await _0x4c9271[_0x293bea(0x149)](_0x306df9[_0x293bea(0xfd)],!![],_0x293bea(0x154));});}),_0x198a13['dePEm'](it,'ZDZ-2\x20LifetimeCount,\x20the\x20publish\x20engine\x20shall\x20send\x20a\x20StatusChangeNotification\x20to\x20inform\x20that\x20a\x20subscription\x20has\x20been\x20closed\x20because\x20of\x20lifetime\x20timeout\x20-\x20with\x202\x20subscriptions',async()=>{const _0x5776f6=_0x58eb6b,_0x414761={'JfXvL':function(_0x5ef76b,_0x1a4ec0){const _0x18f732=_0xbc54;return _0x198a13[_0x18f732(0x127)](_0x5ef76b,_0x1a4ec0);},'XVoMy':function(_0x4831c9,_0x424506){return _0x4831c9*_0x424506;},'laGto':function(_0x17ad28,_0x3cc57b){return _0x198a13['trDiw'](_0x17ad28,_0x3cc57b);}};await with_fake_timer[_0x5776f6(0x10d)](_0x43f258,async()=>{const _0x52f98c=_0x5776f6;_0x306df9=_0x4c9271[_0x52f98c(0x111)]({'sessionTimeout':0x5f5e100});const _0x498136={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x3bbd4a=_0x306df9['createSubscription'](_0x498136);_0x3bbd4a[_0x52f98c(0x15b)][_0x52f98c(0x155)]['eql'](0x3e8),_0x3bbd4a['maxKeepAliveCount'][_0x52f98c(0x155)][_0x52f98c(0x117)](0xa),_0x3bbd4a[_0x52f98c(0x121)][_0x52f98c(0x155)][_0x52f98c(0x117)](0x3c),_0x3bbd4a[_0x52f98c(0x14b)][_0x52f98c(0x155)][_0x52f98c(0x117)](SubscriptionState[_0x52f98c(0x11c)]),_0x43f258['clock'][_0x52f98c(0xfe)](_0x3bbd4a[_0x52f98c(0x15b)]),_0x3bbd4a[_0x52f98c(0x14b)][_0x52f98c(0x155)][_0x52f98c(0x117)](SubscriptionState[_0x52f98c(0x11c)]),_0x43f258[_0x52f98c(0x108)][_0x52f98c(0xfe)](_0x414761[_0x52f98c(0x15a)](_0x3bbd4a['publishingInterval'],_0x3bbd4a[_0x52f98c(0x10b)])),_0x3bbd4a[_0x52f98c(0x14b)]['should'][_0x52f98c(0x117)](SubscriptionState[_0x52f98c(0x125)]),_0x43f258['clock'][_0x52f98c(0xfe)](_0x414761[_0x52f98c(0x124)](_0x3bbd4a[_0x52f98c(0x15b)],_0x3bbd4a['maxKeepAliveCount'])),_0x3bbd4a['state'][_0x52f98c(0x155)]['eql'](SubscriptionState['LATE']),_0x43f258[_0x52f98c(0x108)][_0x52f98c(0xfe)](_0x414761[_0x52f98c(0x161)](_0x3bbd4a[_0x52f98c(0x15b)],_0x3bbd4a['lifeTimeCount'])),_0x3bbd4a[_0x52f98c(0x14b)][_0x52f98c(0x155)][_0x52f98c(0x117)](SubscriptionState[_0x52f98c(0x13d)]);const _0x159d17=_0x306df9['createSubscription'](_0x498136);_0x159d17[_0x52f98c(0x14b)][_0x52f98c(0x155)][_0x52f98c(0x117)](SubscriptionState[_0x52f98c(0x11c)]),_0x43f258['clock'][_0x52f98c(0xfe)](_0x159d17[_0x52f98c(0x15b)]*_0x159d17[_0x52f98c(0x10b)]),_0x159d17['state'][_0x52f98c(0x155)][_0x52f98c(0x117)](SubscriptionState[_0x52f98c(0x125)]);const _0x125102=sinon['spy']();_0x306df9[_0x52f98c(0x123)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x125102),_0x306df9['publishEngine']['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x125102),_0x306df9[_0x52f98c(0x123)][_0x52f98c(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x125102),_0x306df9[_0x52f98c(0x123)][_0x52f98c(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x68}}),_0x125102),_0x43f258['clock']['tick'](_0x159d17[_0x52f98c(0x15b)]),await _0x306df9[_0x52f98c(0x142)](_0x159d17['id']),_0x43f258[_0x52f98c(0x108)]['tick'](_0x159d17[_0x52f98c(0x15b)]),_0x125102[_0x52f98c(0x160)][_0x52f98c(0x155)][_0x52f98c(0x117)](0x4),_0x125102[_0x52f98c(0x10e)](0x0)[_0x52f98c(0x11b)][0x1][_0x52f98c(0x10f)][_0x52f98c(0x110)][_0x52f98c(0x155)][_0x52f98c(0x117)](StatusCodes['Good']),_0x125102[_0x52f98c(0x10e)](0x0)[_0x52f98c(0x11b)][0x1][_0x52f98c(0x11d)][_0x52f98c(0x155)][_0x52f98c(0x117)](_0x3bbd4a['id']),_0x125102[_0x52f98c(0x10e)](0x0)[_0x52f98c(0x11b)][0x1][_0x52f98c(0x14d)]['notificationData'][0x0]['status']['should'][_0x52f98c(0x117)](StatusCodes[_0x52f98c(0x14c)]),_0x125102['getCall'](0x1)[_0x52f98c(0x11b)][0x1]['responseHeader'][_0x52f98c(0x110)][_0x52f98c(0x155)][_0x52f98c(0x117)](StatusCodes[_0x52f98c(0x15c)]),_0x125102[_0x52f98c(0x10e)](0x1)[_0x52f98c(0x11b)][0x1][_0x52f98c(0x11d)][_0x52f98c(0x155)]['eql'](_0x159d17['id']),_0x125102[_0x52f98c(0x10e)](0x1)['args'][0x1]['notificationMessage'][_0x52f98c(0x10c)][_0x52f98c(0x159)]['should']['eql'](0x0),_0x125102[_0x52f98c(0x10e)](0x2)['args'][0x1][_0x52f98c(0x10f)][_0x52f98c(0x110)]['should'][_0x52f98c(0x117)](StatusCodes[_0x52f98c(0x11a)]),_0x125102[_0x52f98c(0x10e)](0x3)['args'][0x1]['responseHeader'][_0x52f98c(0x110)][_0x52f98c(0x155)][_0x52f98c(0x117)](StatusCodes[_0x52f98c(0x11a)]),await _0x4c9271[_0x52f98c(0x149)](_0x306df9['authenticationToken'],!![],_0x52f98c(0x154));});}),it(_0x58eb6b(0x10a),async()=>{const _0x29b6cc=_0x58eb6b;await with_fake_timer[_0x29b6cc(0x10d)](_0x43f258,async()=>{const _0x555c7f=_0x29b6cc;_0x306df9=_0x4c9271[_0x555c7f(0x111)]({'sessionTimeout':0x5f5e100});const _0x556c1d={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x406f09=_0x306df9[_0x555c7f(0x109)](_0x556c1d);_0x406f09[_0x555c7f(0x14b)][_0x555c7f(0x155)][_0x555c7f(0x117)](SubscriptionState['CREATING']),_0x43f258[_0x555c7f(0x108)]['tick'](_0x406f09[_0x555c7f(0x15b)]*_0x406f09['maxKeepAliveCount']),_0x43f258['clock'][_0x555c7f(0xfe)](_0x406f09[_0x555c7f(0x15b)]*_0x406f09['lifeTimeCount']),_0x406f09[_0x555c7f(0x14b)]['should']['eql'](SubscriptionState['CLOSED']),_0x406f09[_0x555c7f(0xf7)]['should'][_0x555c7f(0x117)](![]);const _0x44aa8b=sinon[_0x555c7f(0x129)]();_0x306df9[_0x555c7f(0x123)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x44aa8b),_0x306df9['publishEngine'][_0x555c7f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x44aa8b),_0x306df9[_0x555c7f(0x123)][_0x555c7f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x44aa8b),_0x306df9[_0x555c7f(0x123)][_0x555c7f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x68}}),_0x44aa8b),_0x43f258['clock'][_0x555c7f(0xfe)](_0x406f09[_0x555c7f(0x15b)]*0x2),_0x44aa8b['getCall'](0x0)[_0x555c7f(0x11b)][0x1]['subscriptionId'][_0x555c7f(0x155)]['eql'](_0x406f09['subscriptionId']),_0x44aa8b[_0x555c7f(0x10e)](0x0)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x10f)][_0x555c7f(0x110)][_0x555c7f(0x155)]['eql'](StatusCodes[_0x555c7f(0x15c)]),_0x44aa8b[_0x555c7f(0x10e)](0x0)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x14d)][_0x555c7f(0xfa)][_0x555c7f(0x155)][_0x555c7f(0x117)](0x1),_0x44aa8b[_0x555c7f(0x10e)](0x0)['args'][0x1][_0x555c7f(0x14d)][_0x555c7f(0x10c)][0x0][_0x555c7f(0x12b)]['name'][_0x555c7f(0x155)][_0x555c7f(0x117)](_0x555c7f(0x12d)),_0x44aa8b['getCall'](0x0)['args'][0x1][_0x555c7f(0x14d)][_0x555c7f(0x10c)][0x0][_0x555c7f(0x126)][_0x555c7f(0x155)][_0x555c7f(0x117)](StatusCodes[_0x555c7f(0x14c)]),_0x44aa8b[_0x555c7f(0x160)][_0x555c7f(0x155)][_0x555c7f(0x117)](0x4),_0x44aa8b[_0x555c7f(0x10e)](0x1)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x10f)]['serviceResult'][_0x555c7f(0x155)]['eql'](StatusCodes[_0x555c7f(0x11a)]),_0x44aa8b['getCall'](0x1)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x155)]['be'][_0x555c7f(0x143)](ServiceFault),_0x44aa8b[_0x555c7f(0x10e)](0x2)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x10f)]['serviceResult']['should'][_0x555c7f(0x117)](StatusCodes['BadNoSubscription']),_0x44aa8b[_0x555c7f(0x10e)](0x2)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x155)]['be'][_0x555c7f(0x143)](ServiceFault),_0x44aa8b[_0x555c7f(0x10e)](0x3)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x10f)]['serviceResult'][_0x555c7f(0x155)][_0x555c7f(0x117)](StatusCodes[_0x555c7f(0x11a)]),_0x44aa8b[_0x555c7f(0x10e)](0x3)[_0x555c7f(0x11b)][0x1][_0x555c7f(0x155)]['be'][_0x555c7f(0x143)](ServiceFault),await _0x4c9271[_0x555c7f(0x149)](_0x306df9[_0x555c7f(0xfd)],!![],_0x555c7f(0x154));});}),it('AZW1\x20should\x20receive\x20StatusChangeNotification\x20from\x20first\x20subscription\x20even\x20if\x20publishRequest\x20arrives\x20late',async()=>{const _0x4f94e3=_0x58eb6b,_0x135482={'ckZAZ':function(_0xbf4a90,_0x450c5d){return _0xbf4a90*_0x450c5d;},'RVipn':_0x198a13[_0x4f94e3(0x11e)]};await with_fake_timer['call'](_0x43f258,async()=>{const _0xaf223f=_0x4f94e3;_0x306df9=_0x4c9271[_0xaf223f(0x111)]({'sessionTimeout':0x5f5e100});const _0x3c40c9={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x437bf7=_0x306df9[_0xaf223f(0x109)](_0x3c40c9);_0x437bf7[_0xaf223f(0x14b)]['should']['eql'](SubscriptionState[_0xaf223f(0x11c)]),_0x43f258[_0xaf223f(0x108)]['tick'](_0x135482[_0xaf223f(0xfb)](_0x437bf7[_0xaf223f(0x15b)],_0x437bf7[_0xaf223f(0x10b)])),_0x43f258[_0xaf223f(0x108)][_0xaf223f(0xfe)](_0x437bf7[_0xaf223f(0x15b)]*_0x437bf7[_0xaf223f(0x121)]);const _0x3064da=_0x306df9[_0xaf223f(0x109)](_0x3c40c9);_0x3064da[_0xaf223f(0x14b)][_0xaf223f(0x155)][_0xaf223f(0x117)](SubscriptionState[_0xaf223f(0x11c)]);const _0x52a7c1=sinon[_0xaf223f(0x129)]();_0x306df9[_0xaf223f(0x123)][_0xaf223f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x52a7c1),_0x306df9['publishEngine'][_0xaf223f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x52a7c1),_0x306df9[_0xaf223f(0x123)][_0xaf223f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x52a7c1),_0x306df9[_0xaf223f(0x123)][_0xaf223f(0x134)](new PublishRequest({'requestHeader':{'requestHandle':0x68}}),_0x52a7c1),_0x52a7c1[_0xaf223f(0x160)][_0xaf223f(0x155)][_0xaf223f(0x117)](0x1),_0x52a7c1[_0xaf223f(0x10e)](0x0)[_0xaf223f(0x11b)][0x1][_0xaf223f(0x10f)]['serviceResult'][_0xaf223f(0x155)][_0xaf223f(0x117)](StatusCodes[_0xaf223f(0x15c)]),_0x52a7c1['getCall'](0x0)[_0xaf223f(0x11b)][0x1][_0xaf223f(0x14d)][_0xaf223f(0xfa)]['should'][_0xaf223f(0x117)](0x1),_0x52a7c1[_0xaf223f(0x10e)](0x0)[_0xaf223f(0x11b)][0x1][_0xaf223f(0x14d)]['notificationData'][0x0][_0xaf223f(0x12b)][_0xaf223f(0x151)][_0xaf223f(0x155)]['eql'](_0xaf223f(0x12d)),_0x52a7c1[_0xaf223f(0x10e)](0x0)['args'][0x1]['notificationMessage'][_0xaf223f(0x10c)][0x0][_0xaf223f(0x126)]['should'][_0xaf223f(0x117)](StatusCodes['BadTimeout']),await _0x4c9271[_0xaf223f(0x149)](_0x306df9[_0xaf223f(0xfd)],!![],_0x135482[_0xaf223f(0x145)]);});}),_0x198a13[_0x58eb6b(0x12f)](it,_0x198a13[_0x58eb6b(0x13a)],async()=>{await with_fake_timer['call'](_0x43f258,async()=>{const _0x566cfd=_0xbc54;_0x306df9=_0x4c9271[_0x566cfd(0x111)]({'sessionTimeout':0x5f5e100});const _0x147aa6={'requestedPublishingInterval':0x64,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0x1e,'maxNotificationsPerPublish':0x3e8,'publishingEnabled':!![],'priority':0xe},_0x3dbbc6=_0x306df9[_0x566cfd(0x109)](_0x147aa6);_0x3dbbc6[_0x566cfd(0x14b)][_0x566cfd(0x155)][_0x566cfd(0x117)](SubscriptionState['CREATING']),_0x3dbbc6['on']('monitoredItem',function(_0x534849){const _0x2e370e=_0x566cfd;_0x534849[_0x2e370e(0x157)]=function(){};});const _0x2908eb=new MonitoredItemCreateRequest({'itemToMonitor':{'nodeId':_0x566cfd(0x102)},'monitoringMode':MonitoringMode[_0x566cfd(0x114)],'requestedParameters':{'clientHandle':0x7b,'queueSize':0xa,'samplingInterval':0x64}}),_0x4b1665=_0x3dbbc6[_0x566cfd(0x153)](_0x4c9271[_0x566cfd(0x135)],TimestampsToReturn[_0x566cfd(0x14a)],_0x2908eb);_0x4b1665[_0x566cfd(0x136)][_0x566cfd(0x155)][_0x566cfd(0x117)](StatusCodes[_0x566cfd(0x15c)]);const _0x147db6=![];_0x4c9271[_0x566cfd(0x149)](_0x306df9['authenticationToken'],_0x147db6,_0x566cfd(0x154)),_0x43f258['clock']['tick'](_0x198a13[_0x566cfd(0x127)](_0x3dbbc6['publishingInterval'],_0x3dbbc6['maxKeepAliveCount'])),_0x43f258[_0x566cfd(0x108)][_0x566cfd(0xfe)](_0x198a13[_0x566cfd(0x12a)](_0x3dbbc6[_0x566cfd(0x15b)],_0x3dbbc6[_0x566cfd(0x121)]));});});});