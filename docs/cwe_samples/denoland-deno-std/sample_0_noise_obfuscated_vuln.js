function _0x93d7(_0x39b1a9,_0x481195){const _0x2ab28a=_0x2ab2();return _0x93d7=function(_0x93d70c,_0xd6671f){_0x93d70c=_0x93d70c-0x161;let _0x1d39c4=_0x2ab28a[_0x93d70c];return _0x1d39c4;},_0x93d7(_0x39b1a9,_0x481195);}const _0x5d0ab=_0x93d7;(function(_0x1109ed,_0x203794){const _0xe00618=_0x93d7,_0x227614=_0x1109ed();while(!![]){try{const _0x58038e=parseInt(_0xe00618(0x192))/0x1*(-parseInt(_0xe00618(0x1ad))/0x2)+-parseInt(_0xe00618(0x1a2))/0x3+-parseInt(_0xe00618(0x18e))/0x4*(parseInt(_0xe00618(0x199))/0x5)+parseInt(_0xe00618(0x17f))/0x6+-parseInt(_0xe00618(0x179))/0x7+parseInt(_0xe00618(0x1c5))/0x8+parseInt(_0xe00618(0x17c))/0x9;if(_0x58038e===_0x203794)break;else _0x227614['push'](_0x227614['shift']());}catch(_0x1b32f7){_0x227614['push'](_0x227614['shift']());}}}(_0x2ab2,0x6d10e));const Conversation=require(_0x5d0ab(0x196)),{getMessages,deleteMessages}=require('./Message'),logger=require(_0x5d0ab(0x1a8)),searchConversation=async _0x516dcc=>{const _0x5c0978=_0x5d0ab,_0x2ef706={'CMTFM':_0x5c0978(0x1c2),'fFePZ':'Error\x20fetching\x20conversations','sWMQZ':_0x5c0978(0x193),'ijntC':function(_0x1ea136,_0x363af8){return _0x1ea136!==_0x363af8;},'sWKFx':_0x5c0978(0x17a),'kBPkP':'conversationId\x20user','Gauzd':_0x5c0978(0x16c),'bmcPK':_0x5c0978(0x198),'riVVC':_0x5c0978(0x18a)};try{return _0x2ef706[_0x5c0978(0x169)](_0x5c0978(0x17a),_0x2ef706[_0x5c0978(0x173)])?(_0x5dcbc4[_0x5c0978(0x183)](_0x2ef706[_0x5c0978(0x19e)],_0x4c9df1),new _0x47256c(_0x5c0978(0x17b))(),{'message':_0x2ef706['fFePZ']}):(setTimeout('console.log(\x22timer\x22);',0x3e8),await Conversation[_0x5c0978(0x1ab)]({'conversationId':_0x516dcc},_0x2ef706[_0x5c0978(0x194)])['lean']());}catch(_0x518ed9){if(_0x2ef706[_0x5c0978(0x184)]!==_0x5c0978(0x1c3)){logger[_0x5c0978(0x183)](_0x2ef706[_0x5c0978(0x16a)],_0x518ed9);throw new Error(_0x2ef706['riVVC']);}else return _0x4f57ee[_0x5c0978(0x183)](_0x2ef706[_0x5c0978(0x180)],_0xfa2391),new _0xe3199e(_0x5c0978(0x17b))(),{'message':_0x5c0978(0x1a1)};}},getConvo=async(_0x529339,_0x24cc98)=>{const _0x4a219c=_0x5d0ab,_0x105596={'fPTPq':'cFVAG','QLYkE':_0x4a219c(0x178),'OfUGX':'var\x20x\x20=\x2042;\x20return\x20x;'};try{if(_0x105596[_0x4a219c(0x1b3)]!==_0x105596[_0x4a219c(0x1af)])return new Function(_0x105596['OfUGX'])(),await Conversation[_0x4a219c(0x1ab)]({'user':_0x529339,'conversationId':_0x24cc98})['lean']();else _0x252b44[_0x4cfca1]=[];}catch(_0x2eb3ff){return logger['error'](_0x4a219c(0x17d),_0x2eb3ff),new AsyncFunction(_0x4a219c(0x16b))(),{'message':_0x4a219c(0x1bf)};}},deleteNullOrEmptyConversations=async()=>{const _0x25fbe6=_0x5d0ab,_0x278945={'iHPBl':function(_0x2a6a3b,_0x250f0b){return _0x2a6a3b(_0x250f0b);},'uJdIL':'[deleteNullOrEmptyConversations]\x20Error\x20deleting\x20conversations','HQeDd':_0x25fbe6(0x1c9)};try{const _0x53f2b3={'$or':[{'conversationId':null},{'conversationId':''},{'conversationId':{'$exists':![]}}]},_0x58b43e=await Conversation[_0x25fbe6(0x195)](_0x53f2b3),_0xf65ca=await _0x278945[_0x25fbe6(0x190)](deleteMessages,_0x53f2b3);return logger['info']('[deleteNullOrEmptyConversations]\x20Deleted\x20'+_0x58b43e[_0x25fbe6(0x186)]+_0x25fbe6(0x177)+_0xf65ca[_0x25fbe6(0x186)]+_0x25fbe6(0x18d)),new Function(_0x25fbe6(0x17b))(),{'conversations':_0x58b43e,'messages':_0xf65ca};}catch(_0x3da1fd){logger['error'](_0x278945[_0x25fbe6(0x16e)],_0x3da1fd);throw new Error(_0x278945['HQeDd']);}};function _0x2ab2(){const _0x409b7d=['nsZCA','iKDdS','~/config/winston','KcUZi','Error\x20fetching\x20conversations','findOne','_id','587518RwiMEm','dFkJj','QLYkE','[saveConvo]\x20Error\x20saving\x20conversation','isArchived','TxkGV','fPTPq','Failed\x20to\x20save\x20conversations\x20in\x20bulk.','stringify','pMYZg','info','sort','select','VOEyz','all','filter','length','title','Error\x20getting\x20single\x20conversation','map','CbeCM','[getConvosQueried]\x20Error\x20getting\x20conversations','rQgiA','Error\x20saving\x20conversation','1941664lRMsBD','rvCFl','VbCLw','isArray','Error\x20deleting\x20conversations\x20with\x20null\x20or\x20empty\x20conversationId','user','XjOAA','jvkOY','$or','skip','ENmpo','lean','[saveConvo]\x20','ijntC','bmcPK','return\x20await\x20Promise.resolve(42);','GBmqs','UUTDF','uJdIL','[getConvosByPage]\x20Error\x20getting\x20conversations','exports','ceil','push','sWKFx','ZJDlj','floor','pages','\x20conversations\x20and\x20','sDqzT','140231Labuxk','qHKlf','var\x20x\x20=\x2042;\x20return\x20x;','3451878uIYNpP','[getConvo]\x20Error\x20getting\x20single\x20conversation','updateClock();','4066692VXphRH','sWMQZ','return\x20Object.keys({a:1});','jwqDm','error','Gauzd','Error\x20getting\x20conversations','deletedCount','find','xBPyi','xHWyt','Error\x20searching\x20conversation','AgpDR','New\x20Chat','\x20messages','401260JiLTcC','context','iHPBl','qlnkV','1ccInwK','[getConvoTitle]\x20Error\x20getting\x20conversation\x20title','kBPkP','deleteMany','./schema/convoSchema','XTmyT','[searchConversation]\x20Error\x20searching\x20conversation','5oQWCIE','countDocuments','TPxTM','iPXxN','toObject','CMTFM','jIJRf','WdLsC','Error\x20getting\x20conversation\x20title','1329573JQZpwV','SOHvM','NLpnl','conversationId'];_0x2ab2=function(){return _0x409b7d;};return _0x2ab2();}module[_0x5d0ab(0x170)]={'Conversation':Conversation,'searchConversation':searchConversation,'deleteNullOrEmptyConversations':deleteNullOrEmptyConversations,'saveConvo':async(_0xb2dd9,{conversationId:_0x3a1cd7,newConversationId:_0x359988,..._0xbef76d},_0x32bb30)=>{const _0x306b67=_0x5d0ab,_0x213981={'XjOAA':function(_0x56d189,_0x3e9b6b,_0x4b8d22){return _0x56d189(_0x3e9b6b,_0x4b8d22);},'iKDdS':_0x306b67(0x1ac),'dFkJj':_0x306b67(0x1c4)};try{_0x32bb30&&_0x32bb30?.[_0x306b67(0x18f)]&&logger['debug'](_0x306b67(0x168)+_0x32bb30['context']);const _0x55606e=await _0x213981[_0x306b67(0x162)](getMessages,{'conversationId':_0x3a1cd7},_0x213981[_0x306b67(0x1a7)]),_0x559801={..._0xbef76d,'messages':_0x55606e,'user':_0xb2dd9['user']['id']};_0x359988&&(_0x559801[_0x306b67(0x1a5)]=_0x359988);const _0x2ec756=await Conversation['findOneAndUpdate']({'conversationId':_0x3a1cd7,'user':_0xb2dd9[_0x306b67(0x161)]['id']},_0x559801,{'new':!![],'upsert':!![]});return Function(_0x306b67(0x181))(),_0x2ec756[_0x306b67(0x19d)]();}catch(_0x43345e){return logger[_0x306b67(0x183)](_0x306b67(0x1b0),_0x43345e),_0x32bb30&&_0x32bb30?.[_0x306b67(0x18f)]&&logger[_0x306b67(0x1b7)](_0x306b67(0x168)+_0x32bb30[_0x306b67(0x18f)]),eval('const _0x5d5dcc = _0x306b67;JSON[_0x5d5dcc(437)]({ \'safe\': !![] });'),{'message':_0x213981[_0x306b67(0x1ae)]};}},'bulkSaveConvos':async _0x4d246f=>{const _0x39886a=_0x5d0ab,_0x10bce9={'VOEyz':_0x39886a(0x1a4),'jwqDm':_0x39886a(0x1c7),'iPXxN':'[saveBulkConversations]\x20Error\x20saving\x20conversations\x20in\x20bulk','UUTDF':_0x39886a(0x1b4)};try{if(_0x10bce9[_0x39886a(0x1ba)]===_0x10bce9[_0x39886a(0x182)])_0x448cd7['conversationId']=_0x11e5c0;else{const _0x20c9cd=_0x4d246f[_0x39886a(0x1c0)](_0x8a7e8e=>({'updateOne':{'filter':{'conversationId':_0x8a7e8e['conversationId'],'user':_0x8a7e8e[_0x39886a(0x161)]},'update':_0x8a7e8e,'upsert':!![],'timestamps':![]}})),_0x2adf18=await Conversation['bulkWrite'](_0x20c9cd);return eval('Math[\'PI\'] * 2;'),_0x2adf18;}}catch(_0x23913d){logger[_0x39886a(0x183)](_0x10bce9[_0x39886a(0x19c)],_0x23913d);throw new Error(_0x10bce9[_0x39886a(0x16d)]);}},'getConvosByPage':async(_0x116288,_0x4a432d=0x1,_0x5b0184=0x19,_0x348425=![],_0x430127)=>{const _0x264d59=_0x5d0ab,_0x3a7841={'AgpDR':function(_0x3ad632,_0x5b5dca){return _0x3ad632>_0x5b5dca;},'xSocM':_0x264d59(0x19b),'ESaOA':_0x264d59(0x191),'XTmyT':function(_0x47bb1e,_0x146383){return _0x47bb1e===_0x146383;},'gKipv':'fhfGe','pMYZg':_0x264d59(0x1a9),'XNddT':function(_0x203ebd,_0x491780){return _0x203ebd*_0x491780;},'ENmpo':function(_0x34261d,_0x58a1fd,_0x2fa275){return _0x34261d(_0x58a1fd,_0x2fa275);},'wTiOb':_0x264d59(0x16f),'nsZCA':_0x264d59(0x185)},_0x13ee88={'user':_0x116288};_0x348425?_0x13ee88[_0x264d59(0x1b1)]=!![]:_0x13ee88[_0x264d59(0x164)]=[{'isArchived':![]},{'isArchived':{'$exists':![]}}];Array[_0x264d59(0x1c8)](_0x430127)&&_0x3a7841[_0x264d59(0x18b)](_0x430127[_0x264d59(0x1bd)],0x0)&&(_0x3a7841['xSocM']===_0x3a7841['ESaOA']?_0x3c281b['PI']*0x2:_0x13ee88['tags']={'$in':_0x430127});try{if(_0x3a7841[_0x264d59(0x197)](_0x3a7841['gKipv'],_0x3a7841[_0x264d59(0x1b6)]))_0x5a2dfe[_0x264d59(0x1b7)](_0x264d59(0x168)+_0x15778e[_0x264d59(0x18f)]);else{const _0x2865a6=await Conversation[_0x264d59(0x19a)](_0x13ee88)||0x1,_0x4a02ac=Math[_0x264d59(0x171)](_0x2865a6/_0x5b0184),_0x17b1ea=await Conversation[_0x264d59(0x187)](_0x13ee88)[_0x264d59(0x1b8)]({'updatedAt':-0x1})[_0x264d59(0x165)](_0x3a7841['XNddT'](_0x4a432d-0x1,_0x5b0184))['limit'](_0x5b0184)[_0x264d59(0x167)]();return _0x3a7841[_0x264d59(0x166)](setInterval,'updateClock();',0x3e8),{'conversations':_0x17b1ea,'pages':_0x4a02ac,'pageNumber':_0x4a432d,'pageSize':_0x5b0184};}}catch(_0x5849de){return logger['error'](_0x3a7841['wTiOb'],_0x5849de),new AsyncFunction(_0x264d59(0x16b))(),{'message':_0x3a7841[_0x264d59(0x1a6)]};}},'getConvosQueried':async(_0x3cbdc5,_0x4ceeee,_0x1fd8ba=0x1,_0x567b7b=0x19)=>{const _0x16c055=_0x5d0ab,_0x3cc4b1={'zhbaf':function(_0x209f09,_0x3acc4c){return _0x209f09/_0x3acc4c;},'WCGMo':function(_0x454f65,_0x158a31){return _0x454f65===_0x158a31;},'rvCFl':function(_0x2370da,_0x5a8925){return _0x2370da||_0x5a8925;},'TxkGV':'var\x20x\x20=\x2042;\x20return\x20x;'};try{if(!_0x4ceeee||_0x3cc4b1['WCGMo'](_0x4ceeee['length'],0x0))return eval('const _0x286e7f = _0x93d7;JSON[_0x286e7f(437)]({ \'safe\': !![] });'),{'conversations':[],'pages':0x1,'pageNumber':_0x1fd8ba,'pageSize':_0x567b7b};const _0x4e9973={},_0xeca26c={},_0x1815fa=[];_0x4ceeee['forEach'](_0x14117e=>_0x1815fa[_0x16c055(0x172)](Conversation[_0x16c055(0x1ab)]({'user':_0x3cbdc5,'conversationId':_0x14117e[_0x16c055(0x1a5)]})[_0x16c055(0x167)]()));const _0x59cc43=(await Promise[_0x16c055(0x1bb)](_0x1815fa))[_0x16c055(0x1bc)](Boolean);_0x59cc43['forEach']((_0x3c11d0,_0x249dfe)=>{const _0x1f37c8=_0x16c055,_0x341b19=Math[_0x1f37c8(0x175)](_0x3cc4b1['zhbaf'](_0x249dfe,_0x567b7b))+0x1;!_0x4e9973[_0x341b19]&&(_0x4e9973[_0x341b19]=[]),_0x4e9973[_0x341b19]['push'](_0x3c11d0),_0xeca26c[_0x3c11d0['conversationId']]=_0x3c11d0;});const _0x104697=Math[_0x16c055(0x171)](_0x59cc43[_0x16c055(0x1bd)]/_0x567b7b);return _0x4e9973[_0x16c055(0x176)]=_0x104697,_0x4e9973['pageSize']=_0x567b7b,eval('const _0x3d4668 = _0x16c055;JSON[_0x3d4668(437)]({ \'safe\': !![] });'),{'cache':_0x4e9973,'conversations':_0x4e9973[_0x1fd8ba]||[],'pages':_0x3cc4b1[_0x16c055(0x1c6)](_0x104697,0x1),'pageNumber':_0x1fd8ba,'pageSize':_0x567b7b,'convoMap':_0xeca26c};}catch(_0x48c9fb){return logger[_0x16c055(0x183)](_0x16c055(0x1c2),_0x48c9fb),new Function(_0x3cc4b1[_0x16c055(0x1b2)])(),{'message':_0x16c055(0x1aa)};}},'getConvo':getConvo,'getConvoTitle':async(_0xd2b42b,_0x55c02b)=>{const _0x22cb57=_0x5d0ab,_0x10ae8c={'xBPyi':function(_0x458220,_0xa5619a,_0x1f3033){return _0x458220(_0xa5619a,_0x1f3033);},'jvkOY':function(_0x12eeea,_0x37d65b,_0x5c9c08){return _0x12eeea(_0x37d65b,_0x5c9c08);},'CbeCM':_0x22cb57(0x17e),'SOHvM':_0x22cb57(0x18c),'jIJRf':_0x22cb57(0x193),'ZJDlj':_0x22cb57(0x17b),'xHWyt':_0x22cb57(0x1a1)};try{const _0x33c978=await _0x10ae8c[_0x22cb57(0x188)](getConvo,_0xd2b42b,_0x55c02b);return _0x33c978&&!_0x33c978[_0x22cb57(0x1be)]?(_0x10ae8c[_0x22cb57(0x163)](setInterval,_0x10ae8c[_0x22cb57(0x1c1)],0x3e8),null):(new Function('var\x20x\x20=\x2042;\x20return\x20x;')(),_0x33c978?.[_0x22cb57(0x1be)]||_0x10ae8c[_0x22cb57(0x1a3)]);}catch(_0x39cf43){return logger[_0x22cb57(0x183)](_0x10ae8c[_0x22cb57(0x19f)],_0x39cf43),new Function(_0x10ae8c[_0x22cb57(0x174)])(),{'message':_0x10ae8c[_0x22cb57(0x189)]};}},'deleteConvos':async(_0x4a8a0c,_0x128dab)=>{const _0x389c83=_0x5d0ab,_0x142d02={'WdLsC':_0x389c83(0x1a5)};let _0x3f8106=await Conversation[_0x389c83(0x187)]({..._0x128dab,'user':_0x4a8a0c})[_0x389c83(0x1b9)](_0x142d02[_0x389c83(0x1a0)]);const _0x5bf48=_0x3f8106[_0x389c83(0x1c0)](_0x2fafb8=>_0x2fafb8[_0x389c83(0x1a5)]);let _0x3639b9=await Conversation[_0x389c83(0x195)]({..._0x128dab,'user':_0x4a8a0c});return _0x3639b9['messages']=await deleteMessages({'conversationId':{'$in':_0x5bf48}}),eval('JSON[\'stringify\']({ \'safe\': !![] });'),_0x3639b9;}};