(function(_0xaf06b3,_0x35b487){const _0x51097b=_0x1920,_0x1dc436=_0xaf06b3();while(!![]){try{const _0x14debf=parseInt(_0x51097b(0x89))/0x1+-parseInt(_0x51097b(0x92))/0x2+-parseInt(_0x51097b(0xc7))/0x3+parseInt(_0x51097b(0xe1))/0x4+parseInt(_0x51097b(0xcb))/0x5+parseInt(_0x51097b(0x83))/0x6+-parseInt(_0x51097b(0xc1))/0x7;if(_0x14debf===_0x35b487)break;else _0x1dc436['push'](_0x1dc436['shift']());}catch(_0x4c2b12){_0x1dc436['push'](_0x1dc436['shift']());}}}(_0x4abb,0x187ff));function _0x4abb(){const _0x400484=['track','138204LVftNL','Autocrypt','resign','data','Sender','trim','TsmNF','escapeValue','replace','ContactID','BOJSk','xcHeg','NMsGJ','ParsedHeaders','pref','toLowerCase','extend','encrypt','Attachments','reduce','flatten','tokqz','true','SenderAddress','vOvHw','values','wClsp','DWehf','item1','vVjcK','PIMAN','WrQXN','PublicKey','rzEsn','OlVSv','glZFP','UZysI','all','filter','vCard','HWVCm','uUXyV','then','expires','fEzaT','BYnMb','gVoaw','684684xNfjVh','now','get','publickeys','tfOjV','x-pm-encrypt','190239HSyIZx','substring','AddressID','scheme','191060kPJDlv','split','keydata','has','Body','add','ENABLE_VERIFICATION','PLDPx','updateUnencrypted','PiUSF','key','catch','length','set','every','push','sOpag','adr','XVoGe','DeEPk','x-pm-sign','Address','154636krLFwA','created','getCreationTime','findEmail','uonOC','publicKeyArmored','rydFL','NvOuw','crQqA','731208IjCiHl','YgiOO','PuUqi','userIds','uniqBy','HIAHt','131939nDzXlo','QQydE','some','email','getPrivateKeys','map','CnnfI','dcQmO'];_0x4abb=function(){return _0x400484;};return _0x4abb();}function _0x1920(_0x5db6a9,_0x3a8ef7){const _0x4abbd9=_0x4abb();return _0x1920=function(_0x192022,_0x5bde1d){_0x192022=_0x192022-0x82;let _0x266f5b=_0x4abbd9[_0x192022];return _0x266f5b;},_0x1920(_0x5db6a9,_0x3a8ef7);}import _0x4c4a67 from'lodash';import _0x45f0aa from'vcf';import{arrayToBinaryString,decryptMessageLegacy,getFingerprint,getMatchingKey,keyInfo}from'pmcrypto';import{VERIFICATION_STATUS,EMAIL_FORMATING,KEY_FLAGS,LARGE_KEY_SIZE,SEND_TYPES}from'../../constants';import{toList}from'../../../helpers/arrayHelper';import{getGroup}from'../../../helpers/vcard';import{normalizeEmail}from'../../../helpers/string';import{addGetKeys,getKeyAsUri}from'../../../helpers/key';import{isInternal,getDate}from'../../../helpers/message';import{getParsedAutocryptHeader}from'./autocryptHelper';const {OPEN_TAG_AUTOCOMPLETE_RAW,CLOSE_TAG_AUTOCOMPLETE_RAW}=EMAIL_FORMATING,{SIGNED_AND_INVALID}=VERIFICATION_STATUS,MAX_KEY_COUNTS=0x5;function attachedPublicKey(_0x45d2dd,_0x25f89f,_0x405fe5,_0x5e27f5,_0x11ba68,_0x260c10,_0x5f0958,_0x3fdc4c,_0x708081,_0x5c13db){const _0x5ec313=_0x1920,_0x268d2a={'iDHPz':function(_0x26d848,_0x36dfc4){return _0x26d848!==_0x36dfc4;},'HIAHt':function(_0x331bfe,_0x571224){return _0x331bfe<_0x571224;},'xcHeg':function(_0x59d8aa,_0x548d1d){return _0x59d8aa===_0x548d1d;},'BOJSk':_0x5ec313(0xdc),'glZFP':function(_0x5b3408,_0x2cf7c2){return _0x5b3408(_0x2cf7c2);},'NMsGJ':function(_0x46240a,_0x3df531,_0x30b531){return _0x46240a(_0x3df531,_0x30b531);},'dcQmO':function(_0x26805e,_0x2579bb){return _0x26805e&_0x2579bb;},'gVoaw':_0x5ec313(0xb2),'QQydE':function(_0x37b3ee,_0x5e989a){return _0x37b3ee===_0x5e989a;},'BYnMb':function(_0x3c0382,_0x209eb8){return _0x3c0382(_0x209eb8);},'UZysI':_0x5ec313(0x93),'PIMAN':function(_0x5a3908,_0x453a4c){return _0x5a3908(_0x453a4c);},'mXgvw':function(_0x1894d8,_0x4040c4){return _0x1894d8!==_0x4040c4;},'crQqA':'ngmnr','WrQXN':_0x5ec313(0xac),'DeEPk':_0x5ec313(0xe6),'rzEsn':_0x5ec313(0xb4),'TsmNF':function(_0x1007e3,_0x54a5b1,_0x933375){return _0x1007e3(_0x54a5b1,_0x933375);},'NvOuw':function(_0x563eb2,_0x102470){return _0x563eb2(_0x102470);},'PLDPx':_0x5ec313(0xba),'uUXyV':function(_0x1e9a3b,_0x37e4a1){return _0x1e9a3b===_0x37e4a1;},'fEzaT':_0x5ec313(0x8f),'vOvHw':function(_0x308cf0,_0x3457b3,_0x364030){return _0x308cf0(_0x3457b3,_0x364030);},'DWehf':function(_0x8e61c8,_0x43eaa7,_0x1fdd93){return _0x8e61c8(_0x43eaa7,_0x1fdd93);},'tokqz':_0x5ec313(0xae),'XVoGe':'true','YgiOO':_0x5ec313(0x8c),'dRGfB':_0x5ec313(0xc6),'vVjcK':_0x5ec313(0xdf),'PiUSF':function(_0x3761a1,_0x2cccc3){return _0x3761a1(_0x2cccc3);},'uonOC':function(_0x4b51f9,_0x30b1c9){return _0x4b51f9!==_0x30b1c9;},'rydFL':'isVerified'},_0x342284=_0x3c08d6=>{const _0x28e840=_0x5ec313,[_0x5298b4='',_0x396995='']=_0x3c08d6[_0x28e840(0x9a)](CLOSE_TAG_AUTOCOMPLETE_RAW,'')[_0x28e840(0xcc)](OPEN_TAG_AUTOCOMPLETE_RAW);return{'name':_0x5298b4['trim'](),'adr':_0x396995[_0x28e840(0x97)]()};},_0x1c5f48=(_0x4dcc04,_0xf135a9)=>{const _0x4bb5e4=_0x5ec313,_0x5405b2=_0x11ba68['get'](_0x4c4a67[_0x4bb5e4(0x8e)](_0xf135a9,_0x4bb5e4(0xdc))),_0x163572=_0x260c10[_0x4bb5e4(0xc3)](_0x4c4a67[_0x4bb5e4(0x8e)](_0xf135a9,_0x268d2a[_0x4bb5e4(0x9c)]));return Promise[_0x4bb5e4(0xb7)]([_0x5405b2,_0x163572])['then'](([_0x5e1955,_0xc7072b])=>_0xf135a9['filter'](({adr:_0x19bfd9})=>_0xc7072b[_0x19bfd9][_0x4bb5e4(0xd9)](({key:_0x573b6f})=>getFingerprint(_0x573b6f)!==_0x4dcc04['fingerprint']))[_0x4bb5e4(0x8e)](_0xd953b2=>{const _0x405054=_0x4bb5e4,_0x1b9cfa='0|4|2|3|1'[_0x405054(0xcc)]('|');let _0x5bf0f3=0x0;while(!![]){switch(_0x1b9cfa[_0x5bf0f3++]){case'0':if(_0x268d2a['iDHPz'](_0x4dcc04['expires'],null)&&_0x268d2a[_0x405054(0x88)](_0x4dcc04[_0x405054(0xbd)],Date[_0x405054(0xc2)]()))return _0x4c4a67[_0x405054(0xa2)]({},_0xd953b2,{'encrypt':![],'expired':!![]});continue;case'1':return _0x4c4a67[_0x405054(0xa2)]({},_0xd953b2,{'encrypt':_0x5e1955[_0xd953b2['adr']]['encrypt']});case'2':if(_0x268d2a[_0x405054(0x9d)](_0x5e1955[_0xd953b2[_0x405054(0xdc)]][_0x405054(0xc4)]['length'],0x0))return _0x4c4a67[_0x405054(0xa2)]({},_0xd953b2,{'encrypt':!![]});continue;case'3':if(_0x5e1955[_0xd953b2[_0x405054(0xdc)]][_0x405054(0xc4)][0x0][_0x405054(0xe3)]()>_0x4dcc04[_0x405054(0xe2)])return _0x4c4a67[_0x405054(0xa2)]({},_0xd953b2,{'encrypt':![]});continue;case'4':if(_0x5e1955[_0xd953b2[_0x405054(0xdc)]][_0x405054(0xca)]===SEND_TYPES['SEND_PM'])return _0x4c4a67[_0x405054(0xa2)]({},_0xd953b2,{'encrypt':![]});continue;}break;}}));},_0xecc560=({Sender:{Address:_0x398312,Name:_0x1b5041}})=>{return{'name':_0x1b5041,'adr':_0x398312};},_0x12f33b=(_0x42af26,_0x36e3c2)=>{const _0x19c40a=_0x5ec313,_0xc71340=_0x36e3c2[_0x19c40a(0x86)][_0x19c40a(0x8e)](_0x342284)[_0x19c40a(0xb8)](({adr:_0xa1e15b})=>_0xa1e15b);if(!_0xc71340[_0x19c40a(0xd7)])return _0x1c5f48(_0x36e3c2,[_0x268d2a[_0x19c40a(0xb5)](_0xecc560,_0x42af26)]);return _0x268d2a['NMsGJ'](_0x1c5f48,_0x36e3c2,_0xc71340);},_0x2ad27f=async _0xaf47ba=>{const _0x7a7672=_0x5ec313,_0x1a6d6f=_0x405fe5['getPrivateKeys'](_0xaf47ba[_0x7a7672(0xc9)]),{[_0xaf47ba[_0x7a7672(0xa9)]]:{Keys:_0x1f373b}}=await _0x25f89f['get']([_0xaf47ba[_0x7a7672(0xa9)]]),_0x2c5204=(await addGetKeys(_0x1f373b,_0x268d2a[_0x7a7672(0xc0)]))[_0x7a7672(0xa5)]((_0x2e461a,{Flags:_0x41a72c,keys:_0x5db588})=>{const _0x205a13=_0x7a7672;return _0x268d2a[_0x205a13(0x90)](_0x41a72c,KEY_FLAGS[_0x205a13(0xd1)])&&_0x2e461a[_0x205a13(0xda)](_0x5db588[0x0]),_0x2e461a;},[]);if(_0x268d2a[_0x7a7672(0x8a)](_0x2c5204['length'],0x0))return![];const {signatures:[_0x372676=![]]}=await _0x268d2a['glZFP'](decryptMessageLegacy,{'message':_0xaf47ba[_0x7a7672(0xcf)],'messageDate':_0x268d2a[_0x7a7672(0xbf)](getDate,_0xaf47ba),'privateKeys':_0x1a6d6f,'publicKeys':_0x2c5204});if(!_0x372676)return _0x268d2a['iDHPz'](_0x7a7672(0xc5),_0x7a7672(0xc5))?![]:![];const _0x2fb70e=await _0x268d2a['NMsGJ'](getMatchingKey,_0x372676,_0x2c5204);return _0x2fb70e['armor']();},_0x9a1193=async(_0x1930a9,_0x4b0713)=>{const _0xd3291b=_0x5ec313;if(!_0x4c4a67[_0xd3291b(0xce)](_0x1930a9[_0xd3291b(0x9f)],_0x268d2a[_0xd3291b(0xb6)]))return[];const _0x29acec=_0x268d2a[_0xd3291b(0xb0)](toList,_0x1930a9[_0xd3291b(0x9f)]['Autocrypt']);return _0x4c4a67[_0xd3291b(0xb8)](await Promise[_0xd3291b(0xb7)](_0x29acec[_0xd3291b(0x8e)](async _0x5055ad=>{const _0x3a7f65=_0xd3291b,_0x35fdbd=getParsedAutocryptHeader(_0x5055ad,_0x1930a9[_0x3a7f65(0x96)][_0x3a7f65(0xe0)]);if(!_0x35fdbd)return;return _0x4b0713(_0x35fdbd[_0x3a7f65(0xcd)]);})));},_0x3ad7be=async(_0x4ccfdf,_0x530bca)=>{const _0x3b4dac=_0x5ec313;if(_0x268d2a[_0x3b4dac(0x82)]!==_0x268d2a[_0x3b4dac(0xb1)]){const _0x20b71b=_0x405fe5[_0x3b4dac(0x8d)](_0x4ccfdf[_0x3b4dac(0xc9)]);try{const {signatures:_0x52378b}=await decryptMessageLegacy({'message':_0x4ccfdf[_0x3b4dac(0xcf)],'messageDate':_0x268d2a[_0x3b4dac(0xb5)](getDate,_0x4ccfdf),'privateKeys':_0x20b71b}),_0x5b1529=_0x4c4a67['flatten'](_0x52378b[_0x3b4dac(0x8e)](({packets:_0x2090ab})=>Object[_0x3b4dac(0xab)](_0x2090ab)['filter'](_0x5e9a55=>typeof _0x5e9a55==='object'))),_0x21d8aa=_0x5b1529['map'](({issuerKeyId:{bytes:_0x5cb064}})=>_0x5cb064);return(await _0x268d2a[_0x3b4dac(0x9e)](addGetKeys,_0x530bca,_0x268d2a[_0x3b4dac(0xde)]))['filter'](({keys:_0x591fb5})=>{const _0x15c23a=_0x3b4dac,_0x19da2b=_0x4c4a67[_0x15c23a(0xa6)](_0x591fb5['map'](_0x498501=>_0x498501['getKeyIds']()[_0x15c23a(0x8e)](({bytes:_0x5c3f10})=>_0x5c3f10)));return _0x268d2a['mXgvw'](_0x4c4a67['intersection'](_0x19da2b,_0x21d8aa)[_0x15c23a(0xd7)],0x0);});}catch(_0x5a08d7){return[];}}else return![];},_0x4c6d57=async(_0x46ddf9,_0x3951b3)=>{const _0x4f6813=_0x5ec313,_0x278547=_0x4c4a67[_0x4f6813(0x87)](_0x46ddf9,_0x268d2a[_0x4f6813(0xde)]);if(_0x278547[_0x4f6813(0xd7)]===0x1)return _0x278547[0x0];const _0x11209e=_0x278547[_0x4f6813(0xb8)](({userIds:_0x422291})=>_0x422291[_0x4f6813(0x8b)](_0x2f2d99=>_0x2f2d99['search']('<'+_0x3951b3[_0x4f6813(0x96)][_0x4f6813(0xe0)]+'>')!==-0x1));if(_0x11209e[_0x4f6813(0xd7)]===0x1)return _0x11209e[0x0];if(_0x268d2a[_0x4f6813(0x8a)](_0x11209e[_0x4f6813(0xd7)],0x0))return _0x4f6813(0xb4)!==_0x268d2a[_0x4f6813(0xb3)]?![]:![];const _0x39ff03=await _0x268d2a[_0x4f6813(0x98)](_0x3ad7be,_0x3951b3,_0x11209e);if(_0x39ff03[_0x4f6813(0xd7)]===0x1)return _0x39ff03[0x0];return![];},_0x45f9b0=async _0x159086=>{const _0xc23e0=_0x5ec313;if(isInternal(_0x159086))return'HWVCm'===_0x268d2a[_0xc23e0(0xd2)]?_0x159086['verified']===SIGNED_AND_INVALID?_0x2ad27f(_0x159086):![]:_0x18eaa7[0x0];const _0x2a7dd3=_0x159086[_0xc23e0(0xa4)][_0xc23e0(0xb8)](({Name:_0x3074b7,Size:_0x4db26f})=>_0x3074b7[_0xc23e0(0xa1)]()[_0xc23e0(0xc8)](_0x3074b7['length']-0x4)==='.asc'&&_0x4db26f<LARGE_KEY_SIZE);if(_0x2a7dd3['length']>MAX_KEY_COUNTS)return _0x268d2a[_0xc23e0(0xbb)](_0x268d2a['fEzaT'],_0x268d2a[_0xc23e0(0xbe)])?![]:[];const _0x5e012f=_0x237cfd=>{const _0x152d84=_0xc23e0;return _0x268d2a[_0x152d84(0xe8)](keyInfo,_0x237cfd)[_0x152d84(0xd6)](()=>{return![];});},_0x574bbd=(await Promise[_0xc23e0(0xb7)](_0x2a7dd3[_0xc23e0(0x8e)](_0x21c491=>_0x5f0958[_0xc23e0(0xc3)](_0x21c491,_0x159086)[_0xc23e0(0xd6)](()=>![]))))['filter'](Boolean),_0x14231b=_0x574bbd['map'](arrayToBinaryString),_0x32e21b=_0x4c4a67['filter'](await Promise['all'](_0x14231b[_0xc23e0(0x8e)](_0x5e012f)));_0x32e21b[_0xc23e0(0xd7)]===0x0&&_0x32e21b[_0xc23e0(0xda)](...await _0x268d2a['vOvHw'](_0x9a1193,_0x159086,_0x5e012f));const _0x46430e=await _0x268d2a[_0xc23e0(0xad)](_0x4c6d57,_0x32e21b,_0x159086);if(!_0x46430e)return![];const _0x210d42=await _0x12f33b(_0x159086,_0x46430e),{publicKeyArmored:_0x3a1c27}=_0x46430e;return _0x210d42[_0xc23e0(0xd7)]?_0x3a1c27:![];},_0x43d9cc=async(_0x18c5ee,_0x2c98ea)=>{const _0x1b6700=_0x5ec313,_0x1acb78=_0x268d2a[_0x1b6700(0xa7)],_0x2e4a28=new _0x45f0aa();return _0x2e4a28[_0x1b6700(0xd8)]('fn',_0x2c98ea['name']||_0x2c98ea[_0x1b6700(0xdc)]),_0x2e4a28[_0x1b6700(0xd8)]('email',_0x2c98ea[_0x1b6700(0xdc)],{'group':_0x1acb78}),_0x2e4a28[_0x1b6700(0xd8)]('key',await getKeyAsUri(_0x18c5ee),{'group':_0x1acb78}),_0x2c98ea[_0x1b6700(0xa3)]&&(_0x2e4a28[_0x1b6700(0xd8)](_0x1b6700(0xc6),_0x1b6700(0xa8),{'group':_0x1acb78}),_0x2e4a28[_0x1b6700(0xd8)](_0x1b6700(0xdf),_0x268d2a[_0x1b6700(0xdd)],{'group':_0x1acb78})),_0x708081[_0x1b6700(0xd0)]([{'vCard':_0x2e4a28}]);},_0x1b5658=async(_0x2f780d,_0x15ace9)=>{const _0x483262=_0x5ec313,_0x4535e0={'sOpag':function(_0x1df197,_0x49a9ba){return _0x1df197+_0x49a9ba;}},_0x16f06b=normalizeEmail(_0x15ace9[_0x483262(0xdc)]),_0x487bad=_0x3fdc4c[_0x483262(0xe4)](_0x16f06b,normalizeEmail);if(!_0x487bad)return _0x268d2a[_0x483262(0xaa)](_0x43d9cc,_0x2f780d,_0x15ace9);const _0x2da061=await _0x708081[_0x483262(0xc3)](_0x487bad[_0x483262(0x9b)]),_0x46f7fb=toList(_0x2da061['vCard'][_0x483262(0xc3)](_0x268d2a[_0x483262(0x84)])),_0x1c0b94=getGroup(_0x46f7fb,_0x16f06b),_0x5be5fc=toList(_0x2da061[_0x483262(0xb9)][_0x483262(0x95)][_0x483262(0xd5)]||[]);return _0x15ace9[_0x483262(0xa3)]&&(_0x2da061[_0x483262(0xb9)][_0x483262(0xd0)](_0x268d2a['dRGfB'],_0x483262(0xa8),{'group':_0x1c0b94}),_0x2da061[_0x483262(0xb9)][_0x483262(0xd0)](_0x268d2a[_0x483262(0xaf)],_0x483262(0xa8),{'group':_0x1c0b94})),_0x4c4a67['reduce'](_0x5be5fc,(_0x45db75,_0x4afea2)=>{const _0x1a70ea=_0x483262;return _0x4afea2[_0x1a70ea(0xa0)]=_0x45db75,_0x4535e0[_0x1a70ea(0xdb)](_0x45db75,0x1);},0x2),_0x2da061[_0x483262(0xb9)]['add'](_0x483262(0xd5),_0x45d2dd[_0x483262(0x99)](await _0x268d2a[_0x483262(0xd4)](getKeyAsUri,_0x2f780d)),{'group':_0x1c0b94,'pref':_0x15ace9['encrypt']?0x1:_0x5be5fc[_0x483262(0xd7)]+0x1}),_0x708081[_0x483262(0xd3)](_0x2da061);},_0x449e9d=(_0x53d8a1,_0x315dff)=>{const _0x3aa395=_0x5ec313;if(_0x268d2a[_0x3aa395(0xe5)]('PuUqi',_0x3aa395(0x85)))return _0x43ea2a[_0x3aa395(0xa2)]({},_0x1e42a4,{'encrypt':!![]});else{const _0x1f088d=Promise[_0x3aa395(0xb7)](_0x315dff['map'](_0x5dac5e=>_0x1b5658(_0x53d8a1,_0x5dac5e)))[_0x3aa395(0xbc)](()=>!![]);return _0x5c13db['track'](_0x1f088d),_0x1f088d;}},_0x329201=_0x41e2ec=>{const _0x1571df=_0x5ec313,_0x3915cb=_0x11ba68['get'](_0x4c4a67[_0x1571df(0x8e)](_0x41e2ec,_0x1571df(0xdc)));return _0x5c13db[_0x1571df(0x91)](_0x3915cb),_0x3915cb;},_0x3bbff8=async(_0x52f9a0,_0x3edaae)=>{const _0x23fb91=_0x5ec313,_0x382638=await _0x268d2a[_0x23fb91(0xe8)](_0x329201,_0x3edaae);if(_0x4c4a67['every'](_0x4c4a67[_0x23fb91(0x8e)](_0x382638,_0x268d2a[_0x23fb91(0xe7)])))return _0x449e9d(_0x52f9a0,_0x3edaae);const _0x38363b=_0x4c4a67['toPairs'](_0x382638),_0x4fac66=_0x38363b[_0x23fb91(0xb8)](([,{isVerified:_0x537ff3}])=>!_0x537ff3),_0x54ed62=await _0x5e27f5[_0x23fb91(0x94)](_0x4fac66['map'](([_0x2bf7b3])=>_0x2bf7b3));if(!_0x54ed62)return![];return _0x449e9d(_0x52f9a0,_0x3edaae);};return{'extractAddresses':_0x12f33b,'extractFromEmail':_0x45f9b0,'attachPublicKey':_0x3bbff8};}export default attachedPublicKey;