'use strict';const _0x57f291=_0x4ce2;(function(_0x1db566,_0x259757){const _0xf384ad=_0x4ce2,_0x40a16c=_0x1db566();while(!![]){try{const _0x282145=parseInt(_0xf384ad(0x12e))/0x1+-parseInt(_0xf384ad(0x155))/0x2+-parseInt(_0xf384ad(0x13e))/0x3+parseInt(_0xf384ad(0x13c))/0x4*(-parseInt(_0xf384ad(0x149))/0x5)+parseInt(_0xf384ad(0x16f))/0x6*(parseInt(_0xf384ad(0x146))/0x7)+parseInt(_0xf384ad(0x15f))/0x8+-parseInt(_0xf384ad(0x172))/0x9*(-parseInt(_0xf384ad(0x188))/0xa);if(_0x282145===_0x259757)break;else _0x40a16c['push'](_0x40a16c['shift']());}catch(_0x172ee7){_0x40a16c['push'](_0x40a16c['shift']());}}}(_0x259b,0xd9bed));function _0x259b(){const _0x138211=['AOUPP','finish','port',':podiumProxyExtras*','name','web','pEFpn','error','opzTL','QaJZp','igCwB','podiumPodletName','6149350TnBQOD','Error\x20emitted\x20by\x20the\x20registry\x20in\x20@podium/proxy\x20module','/podium-resource','58468NVUnnf','dump','byVWL','registry','histogram','VWBuU','dispose\x20proxy\x20item\x20on\x20key\x20\x22',':podiumProxyName','uexHX','defineProperty','forEach','@podium/schemas','host','set','11708xBkDoW','PFkAc','4521399bxEeYs','Oiaqr','register','toStringTag','response','timer','toString','PzUKS','151137wWKZMF','exports','url','2770uJOsiy','PodiumProxy','load','baJuv','dispose','BWVUW','AjyFt','search','podiumProxyName','pathnameEntries','proxy','CaMSB','2952910BykrHj','aBhRT','Error\x20emitted\x20by\x20proxy\x20in\x20@podium/proxy\x20module','prefix','pathnameBuilder','Error\x20emitted\x20by\x20metric\x20stream\x20in\x20@podium/proxy\x20module','QooaF','@metrics/client','length','qSuJr','11138344zUttas','debug','protocol','pathname','request','createProxy','uriBuilder','podiumProxyExtras','call','pathnameParser',':podiumPodletName','LeTGY','parse','qPsnT','[object\x20PodiumHttpIncoming]','abslog','270rRGxFc','podium_proxy_process','Argument\x20must\x20be\x20of\x20type\x20\x22PodiumHttpIncoming\x22','45LOSdUI','exec','metrics','TWLzP','\x20pointing\x20to:\x20','process','log','a\x20proxy\x20endpoint\x20is\x20mounted\x20at\x20pathname:\x20','path-to-regexp','keys'];_0x259b=function(){return _0x138211;};return _0x259b();}function _0x4ce2(_0x41d6a6,_0x3b38fa){const _0x259b95=_0x259b();return _0x4ce2=function(_0x4ce295,_0xbf2c99){_0x4ce295=_0x4ce295-0x12d;let _0x7182cf=_0x259b95[_0x4ce295];return _0x7182cf;},_0x4ce2(_0x41d6a6,_0x3b38fa);}const {pathToRegexp}=require(_0x57f291(0x17a)),{validate}=require(_0x57f291(0x139)),Metrics=require(_0x57f291(0x15c)),{URL}=require(_0x57f291(0x148)),abslog=require(_0x57f291(0x16e)),utils=require('@podium/utils'),Cache=require('ttl-mem-cache'),Proxy=require('http-proxy'),PodiumProxy=class PodiumProxy{constructor({pathname:pathname='/',prefix:prefix=_0x57f291(0x12d),timeout:timeout=0x4e20,maxAge:maxAge=Infinity,logger:logger=null}={}){const _0x1f0a24=_0x57f291,_0x2fc087={'igCwB':_0x1f0a24(0x162),'qPsnT':_0x1f0a24(0x178),'tojPj':_0x1f0a24(0x131),'aBhRT':'pathnameEntries','byVWL':_0x1f0a24(0x168),'qSuJr':function(_0x3dd698,_0x54caf7,_0x37a8ed){return _0x3dd698(_0x54caf7,_0x37a8ed);},'TWLzP':_0x1f0a24(0x183),'Oiaqr':_0x1f0a24(0x13b)};Object[_0x1f0a24(0x137)](this,_0x2fc087[_0x1f0a24(0x186)],{'enumerable':!![],'value':utils[_0x1f0a24(0x159)](pathname)}),Object[_0x1f0a24(0x137)](this,_0x1f0a24(0x158),{'enumerable':!![],'value':utils[_0x1f0a24(0x159)](prefix)}),Object['defineProperty'](this,_0x2fc087[_0x1f0a24(0x16c)],{'value':abslog(logger)}),Object['defineProperty'](this,_0x2fc087['tojPj'],{'value':new Cache({'ttl':maxAge})}),this[_0x1f0a24(0x131)]['on'](_0x1f0a24(0x183),_0x1df27a=>{const _0x2ca417=_0x1f0a24;this[_0x2ca417(0x178)]['error'](_0x2ca417(0x189),_0x1df27a);}),Object[_0x1f0a24(0x137)](this,_0x1f0a24(0x153),{'value':new Proxy[(_0x1f0a24(0x164))]({'proxyTimeout':timeout})}),Object[_0x1f0a24(0x137)](this,_0x1f0a24(0x174),{'enumerable':!![],'value':new Metrics()}),Object[_0x1f0a24(0x137)](this,_0x2fc087[_0x1f0a24(0x156)],{'value':[]});const _0x5589b6=utils[_0x1f0a24(0x159)](this['pathname'],this[_0x1f0a24(0x158)],_0x1f0a24(0x169),_0x1f0a24(0x135),_0x1f0a24(0x17f));Object[_0x1f0a24(0x137)](this,_0x2fc087[_0x1f0a24(0x130)],{'value':_0x2fc087[_0x1f0a24(0x15e)](pathToRegexp,_0x5589b6,this['pathnameEntries'])}),this['metrics']['on'](_0x2fc087[_0x1f0a24(0x175)],_0x459c46=>{const _0xff1ca5=_0x1f0a24;this[_0xff1ca5(0x178)]['error'](_0xff1ca5(0x15a),_0x459c46);}),this['proxy']['on'](_0x2fc087['TWLzP'],_0x3dd854=>{const _0xcc8ce0=_0x1f0a24;this['log'][_0xcc8ce0(0x183)](_0xcc8ce0(0x157),_0x3dd854);}),this['registry']['on'](_0x2fc087[_0x1f0a24(0x13f)],(_0x4d0596,_0x23422f)=>{const _0x85fe83=_0x1f0a24;Object[_0x85fe83(0x17b)](_0x23422f['proxy'])[_0x85fe83(0x138)](_0x14dc42=>{const _0x515926=_0x85fe83,_0x2c59f6=utils[_0x515926(0x159)](this[_0x515926(0x162)],this['prefix'],_0x4d0596,_0x14dc42);this['log'][_0x515926(0x160)](_0x515926(0x179)+_0x2c59f6+_0x515926(0x176)+_0x23422f[_0x515926(0x153)][_0x14dc42]);});}),this[_0x1f0a24(0x131)]['on'](_0x1f0a24(0x14d),_0x39fba4=>{const _0x46ebf7=_0x1f0a24;this[_0x46ebf7(0x178)][_0x46ebf7(0x160)](_0x46ebf7(0x134)+_0x39fba4+'\x22');}),this[_0x1f0a24(0x132)]=this['metrics']['histogram']({'name':_0x1f0a24(0x170),'description':'Measures\x20time\x20spent\x20in\x20the\x20proxy\x20process\x20method','labels':{'name':'','podlet':null,'proxy':![],'error':![]},'buckets':[0.001,0.01,0.1,0.5,0x1,0x2,0xa]});}get[Symbol[_0x57f291(0x141)]](){const _0x4ee381=_0x57f291,_0x243793={'BWVUW':_0x4ee381(0x14a)};return _0x243793[_0x4ee381(0x14e)];}[_0x57f291(0x140)](_0x2cc00e={}){const _0x2641e9=_0x57f291,_0x245503={'VWBuU':'The\x20value\x20for\x20the\x20required\x20argument\x20\x22manifest\x22\x20is\x20not\x20defined\x20or\x20not\x20valid.'},_0x19bae9=JSON[_0x2641e9(0x16b)](JSON['stringify'](_0x2cc00e));if(validate['manifest'](_0x19bae9)[_0x2641e9(0x183)])throw new Error(_0x245503[_0x2641e9(0x133)]);this[_0x2641e9(0x131)][_0x2641e9(0x13b)](_0x19bae9[_0x2641e9(0x180)],_0x19bae9,Infinity);}[_0x57f291(0x177)](_0x3207be){const _0x2fb943=_0x57f291,_0x32ef6f={'PzUKS':function(_0x40686b,_0x17adf2){return _0x40686b(_0x17adf2);},'uexHX':function(_0x9908c6,_0x28395e){return _0x9908c6<_0x28395e;},'QaJZp':function(_0x1f258e,_0x3f2dee){return _0x1f258e!==_0x3f2dee;},'PFkAc':'mfPpT','AOUPP':function(_0x3c4730,_0x4dfa3f){return _0x3c4730(_0x4dfa3f);},'AjyFt':_0x2fb943(0x17d),'LeTGY':function(_0x3be680,_0x46d51e){return _0x3be680(_0x46d51e);},'baJuv':_0x2fb943(0x171)};if(Object['prototype'][_0x2fb943(0x144)][_0x2fb943(0x167)](_0x3207be)!==_0x2fb943(0x16d))throw TypeError(_0x32ef6f[_0x2fb943(0x14c)]);const _0x53cb28=this[_0x2fb943(0x132)][_0x2fb943(0x143)]({'labels':{'name':_0x3207be[_0x2fb943(0x180)]}});return new Promise((_0x1b7c9c,_0x4fcc95)=>{const _0xd41e14=_0x2fb943,_0x5bceeb={'QooaF':function(_0x26dd55,_0x212bab){return _0x26dd55(_0x212bab);}},_0x125bab=this[_0xd41e14(0x168)][_0xd41e14(0x173)](_0x3207be[_0xd41e14(0x148)][_0xd41e14(0x162)]);let _0x418b6d=![];if(_0x125bab){const _0x1cf689={};for(let _0x198549=0x1;_0x32ef6f[_0xd41e14(0x136)](_0x198549,_0x125bab[_0xd41e14(0x15d)]);_0x198549+=0x1){if(_0x32ef6f[_0xd41e14(0x185)](_0xd41e14(0x154),_0x32ef6f[_0xd41e14(0x13d)])){const _0x1eb279=this[_0xd41e14(0x152)][_0x198549-0x1];_0x1cf689[_0x1eb279[_0xd41e14(0x180)]]=_0x125bab[_0x198549];}else return this[_0xd41e14(0x131)][_0xd41e14(0x14b)](_0x4a688f);}const _0x407960=this[_0xd41e14(0x131)]['get'](_0x1cf689[_0xd41e14(0x187)]);if(!_0x407960){_0x32ef6f[_0xd41e14(0x145)](_0x53cb28,{'labels':{'podlet':_0x1cf689[_0xd41e14(0x187)]}}),_0x32ef6f['AOUPP'](_0x1b7c9c,_0x3207be);return;}let _0xced5c2=_0x407960['proxy'][_0x1cf689[_0xd41e14(0x151)]];if(!_0xced5c2){_0x53cb28({'labels':{'podlet':_0x1cf689[_0xd41e14(0x187)]}}),_0x32ef6f[_0xd41e14(0x17c)](_0x1b7c9c,_0x3207be);return;}utils['uriIsRelative'](_0xced5c2)&&(_0xced5c2=utils[_0xd41e14(0x165)](_0xced5c2,_0x3207be['url'][_0xd41e14(0x161)]+'//'+_0x3207be[_0xd41e14(0x148)]['hostname']+(_0x3207be[_0xd41e14(0x148)]['port']?':':'')+_0x3207be[_0xd41e14(0x148)][_0xd41e14(0x17e)]));_0x1cf689[_0xd41e14(0x166)]&&(_0xced5c2=utils[_0xd41e14(0x165)](_0x1cf689[_0xd41e14(0x166)],_0xced5c2));_0x3207be[_0xd41e14(0x148)][_0xd41e14(0x150)]&&(_0xd41e14(0x184)!==_0xd41e14(0x182)?_0xced5c2+=''+_0x3207be[_0xd41e14(0x148)][_0xd41e14(0x150)]:(_0x1ab549=!![],_0x1f6e42({'labels':{'podlet':_0x226d1e[_0xd41e14(0x187)],'proxy':!![],'error':!![]}}),_0x32ef6f[_0xd41e14(0x145)](_0x591b71,_0x289e5c)));utils['serializeContext'](_0x3207be[_0xd41e14(0x163)]['headers'],_0x3207be['context'],_0x1cf689[_0xd41e14(0x187)]);const _0x110aad=new URL(_0xced5c2),_0x52b68f={'changeOrigin':![],'autoRewrite':!![],'ignorePath':!![],'secure':![],'headers':{'host':_0x110aad[_0xd41e14(0x13a)]},'target':_0xced5c2};_0x3207be[_0xd41e14(0x142)]['on'](_0x32ef6f[_0xd41e14(0x14f)],()=>{const _0x2cbe31=_0xd41e14;if(_0x418b6d)return;_0x3207be[_0x2cbe31(0x153)]=!![],_0x5bceeb[_0x2cbe31(0x15b)](_0x53cb28,{'labels':{'podlet':_0x1cf689['podiumPodletName'],'proxy':!![]}}),_0x1b7c9c(_0x3207be);}),this[_0xd41e14(0x153)][_0xd41e14(0x181)](_0x3207be[_0xd41e14(0x163)],_0x3207be[_0xd41e14(0x142)],_0x52b68f,_0x44fbed=>{const _0xd81367=_0xd41e14;_0x418b6d=!![],_0x53cb28({'labels':{'podlet':_0x1cf689[_0xd81367(0x187)],'proxy':!![],'error':!![]}}),_0x4fcc95(_0x44fbed);});return;}_0x53cb28(),_0x32ef6f[_0xd41e14(0x16a)](_0x1b7c9c,_0x3207be);});}[_0x57f291(0x12f)](){const _0x22ab5f=_0x57f291;return this['registry'][_0x22ab5f(0x12f)]();}[_0x57f291(0x14b)](_0x4e59a5){const _0xfb7c7b=_0x57f291;return this[_0xfb7c7b(0x131)][_0xfb7c7b(0x14b)](_0x4e59a5);}};module[_0x57f291(0x147)]=PodiumProxy;