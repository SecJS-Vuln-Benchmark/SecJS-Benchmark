'use strict';const _0x40bf90=_0x2ee2;(function(_0xc0938,_0x151b8d){const _0x127c7d=_0x2ee2,_0xbedd75=_0xc0938();while(!![]){try{const _0x96aa06=-parseInt(_0x127c7d(0x1f7))/0x1+parseInt(_0x127c7d(0x23a))/0x2*(parseInt(_0x127c7d(0x220))/0x3)+-parseInt(_0x127c7d(0x1f8))/0x4*(parseInt(_0x127c7d(0x227))/0x5)+parseInt(_0x127c7d(0x1f9))/0x6*(parseInt(_0x127c7d(0x1f4))/0x7)+-parseInt(_0x127c7d(0x21d))/0x8+-parseInt(_0x127c7d(0x215))/0x9*(-parseInt(_0x127c7d(0x1fd))/0xa)+-parseInt(_0x127c7d(0x1f3))/0xb;if(_0x96aa06===_0x151b8d)break;else _0xbedd75['push'](_0xbedd75['shift']());}catch(_0x1d889f){_0xbedd75['push'](_0xbedd75['shift']());}}}(_0x4335,0x4de2b));const Crypto=require(_0x40bf90(0x1e8));class UserService{static async[_0x40bf90(0x200)](_0x4f32ef){const _0x15939=_0x40bf90,_0x405930={'HDtuL':'\x22\x20found'};let _0x52ca1d=await HashBrown['Service'][_0x15939(0x237)][_0x15939(0x1f2)]('users',_0x15939(0x206),{'username':_0x4f32ef});if(!_0x52ca1d||Object[_0x15939(0x1df)](_0x52ca1d)[_0x15939(0x20c)]<0x1)throw new Error(_0x15939(0x20e)+_0x4f32ef+_0x405930['HDtuL']);return new HashBrown[(_0x15939(0x1e4))]['Resource']['User'](_0x52ca1d);}static async[_0x40bf90(0x23b)](_0x35304f){const _0x235519=_0x40bf90,_0x24a873={'EFFfQ':function(_0x2c5e7e,_0x118c1d){return _0x2c5e7e(_0x118c1d);}};let _0x2cc6c5=await _0x24a873[_0x235519(0x214)](findUser,_0x35304f);_0x2cc6c5[_0x235519(0x20a)]=[],await this[_0x235519(0x208)](_0x35304f,_0x2cc6c5[_0x235519(0x22e)]());}static async[_0x40bf90(0x1fa)](_0x168fa5,_0x3463fb,_0x166f7a){const _0x138d00=_0x40bf90,_0xae09c0={'pARzZ':_0x138d00(0x1eb),'iUXcR':_0x138d00(0x235)};debug['log'](_0xae09c0[_0x138d00(0x225)]+_0x168fa5+_0xae09c0[_0x138d00(0x219)],this);let _0x107119=await this[_0x138d00(0x200)](_0x168fa5);if(!_0x107119['validatePassword'](_0x3463fb))throw new Error(_0x138d00(0x209));let _0x3dc7ba=_0x107119['generateToken'](_0x166f7a);return _0x107119['cleanUpTokens'](),await this[_0x138d00(0x208)](_0x168fa5,_0x107119['getObject']()),_0x3dc7ba;}static async[_0x40bf90(0x238)](_0x2e8395){const _0x3b0c4c=_0x40bf90,_0x45bcf3={'KnEVi':function(_0x3cca12,_0x563fdf){return _0x3cca12+_0x563fdf;},'vdztx':'Logging\x20out\x20user\x20with\x20\x22'};debug[_0x3b0c4c(0x1fe)](_0x45bcf3[_0x3b0c4c(0x233)](_0x45bcf3[_0x3b0c4c(0x233)](_0x45bcf3[_0x3b0c4c(0x228)],_0x2e8395),_0x3b0c4c(0x235)),this);let _0x107f6f=await this['findToken'](_0x2e8395);_0x107f6f[_0x3b0c4c(0x1f6)](_0x2e8395),await this[_0x3b0c4c(0x208)](_0x107f6f[_0x3b0c4c(0x22a)],_0x107f6f[_0x3b0c4c(0x22e)]());}static async[_0x40bf90(0x20d)](_0x458def){const _0x4acbee=_0x40bf90,_0x362085={'cRTFD':'users'};let _0x237ced=await HashBrown['Service']['DatabaseService']['find'](_0x362085['cRTFD'],_0x362085[_0x4acbee(0x20b)],{});for(let _0x37ae96 of _0x237ced){let _0x2b452d=new HashBrown[(_0x4acbee(0x1e4))][(_0x4acbee(0x231))]['User'](_0x37ae96),_0x555436=_0x2b452d['validateToken'](_0x458def);if(_0x555436)return _0x2b452d;}return null;}static async[_0x40bf90(0x212)](_0x1b9efb){const _0x4c6e5e=_0x40bf90;await HashBrown[_0x4c6e5e(0x1e7)]['DatabaseService']['removeOne'](_0x4c6e5e(0x206),'users',{'id':_0x1b9efb});}static async[_0x40bf90(0x1de)](_0x4bb66b,_0x2ea689){const _0x3a37f8=_0x40bf90,_0x2d9421={'fGJzD':function(_0x4576c8,_0x4c74d8){return _0x4576c8<_0x4c74d8;},'fjkga':_0x3a37f8(0x206),'uxvoL':function(_0x7c136c,_0x53f3dd){return _0x7c136c+_0x53f3dd;},'GTcYh':_0x3a37f8(0x1fc)};let _0x1ca9aa=await HashBrown[_0x3a37f8(0x1e7)]['ProjectService'][_0x3a37f8(0x1ef)](_0x2ea689);if(_0x2d9421[_0x3a37f8(0x223)](_0x1ca9aa['users']['length'],0x2))throw new Error(_0x3a37f8(0x232));let _0x5d79a9=await HashBrown[_0x3a37f8(0x1e7)][_0x3a37f8(0x237)]['findOne'](_0x2d9421[_0x3a37f8(0x207)],_0x2d9421[_0x3a37f8(0x207)],{'id':_0x4bb66b});debug[_0x3a37f8(0x1fe)](_0x2d9421[_0x3a37f8(0x221)](_0x3a37f8(0x218)+_0x5d79a9[_0x3a37f8(0x22a)],_0x2d9421[_0x3a37f8(0x22c)])+_0x1ca9aa['name']+'\x22',this),delete _0x5d79a9['scopes'][_0x2ea689],await HashBrown[_0x3a37f8(0x1e7)][_0x3a37f8(0x237)][_0x3a37f8(0x20f)]('users',_0x3a37f8(0x206),{'id':_0x4bb66b},_0x5d79a9);}static async[_0x40bf90(0x1e3)](_0x358d15,_0x38ff46,_0x3f16df){const _0x1a913f=_0x40bf90;let _0x75a557=await HashBrown['Service'][_0x1a913f(0x237)][_0x1a913f(0x1f2)](_0x1a913f(0x206),_0x1a913f(0x206),{'id':_0x358d15});_0x75a557[_0x1a913f(0x1fb)]=_0x75a557[_0x1a913f(0x1fb)]||{},_0x75a557[_0x1a913f(0x1fb)][_0x38ff46]=_0x3f16df||[],await this[_0x1a913f(0x1ed)](_0x358d15,_0x75a557);}static async[_0x40bf90(0x239)](_0x4f80c8,_0x4eca79,_0x1f8a71=![],_0x4c4ef9={}){const _0x2dbc14=_0x40bf90,_0x15e5c2={'JKcxZ':function(_0x395ef6,_0x43db52,_0x4a93bd,_0x2dec18,_0x1cae74){return _0x395ef6(_0x43db52,_0x4a93bd,_0x2dec18,_0x1cae74);},'rPeqJ':_0x2dbc14(0x216),'NDiIu':_0x2dbc14(0x22a),'MJsdD':_0x2dbc14(0x206),'FlGxT':function(_0x2b34ab,_0x517b42){return _0x2b34ab+_0x517b42;}};_0x15e5c2[_0x2dbc14(0x1ea)](checkParam,_0x4f80c8,'username',String,!![]),_0x15e5c2[_0x2dbc14(0x1ea)](checkParam,_0x4eca79,_0x15e5c2[_0x2dbc14(0x201)],String,!![]),delete _0x4c4ef9[_0x15e5c2[_0x2dbc14(0x1f0)]],delete _0x4c4ef9['password'];let _0x214d89=HashBrown[_0x2dbc14(0x1e4)][_0x2dbc14(0x231)][_0x2dbc14(0x210)]['create'](_0x4f80c8,_0x4eca79);for(let _0x1777db in _0x4c4ef9){_0x214d89[_0x1777db]=_0x4c4ef9[_0x1777db];}_0x214d89[_0x2dbc14(0x1e1)]=_0x1f8a71;let _0x28f657=await HashBrown[_0x2dbc14(0x1e7)][_0x2dbc14(0x237)]['findOne'](_0x2dbc14(0x206),_0x15e5c2[_0x2dbc14(0x1ee)],{'username':_0x4f80c8});if(_0x28f657)throw new Error(_0x15e5c2[_0x2dbc14(0x1e5)]('Username\x20\x22',_0x4f80c8)+_0x2dbc14(0x229));return await HashBrown['Service'][_0x2dbc14(0x237)][_0x2dbc14(0x1ff)](_0x2dbc14(0x206),_0x15e5c2['MJsdD'],_0x214d89[_0x2dbc14(0x22e)]()),_0x214d89;}static async['makeUserAdmin'](_0x1dc071){const _0x38b9ec=_0x40bf90;let _0x75f11a=await this[_0x38b9ec(0x1e2)](_0x1dc071);_0x75f11a[_0x38b9ec(0x1e1)]=!![],await this[_0x38b9ec(0x208)](_0x1dc071,_0x75f11a);}static async['getAllUsers'](_0xda3431){const _0x1ba116=_0x40bf90,_0x23cede={'rjKIa':_0x1ba116(0x226),'wXoNH':function(_0x551e42,_0x5ad213){return _0x551e42<_0x5ad213;},'sRTIK':function(_0xe29bb3,_0x71e1de){return _0xe29bb3+_0x71e1de;},'AemTN':_0x1ba116(0x230),'luVgh':'users'};let _0x44666b={};if(_0xda3431){let _0x47c3b6={};_0x47c3b6[_0x23cede['sRTIK'](_0x23cede['AemTN'],_0xda3431)]={'$exists':!![]};let _0x15090f={'isAdmin':!![]};_0x44666b[_0x1ba116(0x204)]=[_0x47c3b6,_0x15090f];}let _0x20e103=await HashBrown[_0x1ba116(0x1e7)][_0x1ba116(0x237)][_0x1ba116(0x1e9)](_0x23cede['luVgh'],_0x1ba116(0x206),_0x44666b,{'tokens':0x0,'password':0x0}),_0x1253fd=[];_0x20e103=_0x20e103[_0x1ba116(0x22d)]((_0x3bf7bf,_0x1aa359)=>{const _0x3af095=_0x1ba116,_0x113184=_0x23cede['rjKIa'][_0x3af095(0x205)]('|');let _0x34394c=0x0;while(!![]){switch(_0x113184[_0x34394c++]){case'0':if(_0x3bf7bf>_0x1aa359)return 0x1;continue;case'1':return 0x0;case'2':_0x1aa359=_0x1aa359['fullName']||_0x1aa359['username']||_0x1aa359[_0x3af095(0x224)]||'';continue;case'3':_0x3bf7bf=_0x3bf7bf[_0x3af095(0x213)]||_0x3bf7bf[_0x3af095(0x22a)]||_0x3bf7bf[_0x3af095(0x224)]||'';continue;case'4':_0x1aa359=_0x1aa359['toLowerCase']();continue;case'5':_0x3bf7bf=_0x3bf7bf[_0x3af095(0x21e)]();continue;case'6':if(_0x23cede[_0x3af095(0x234)](_0x3bf7bf,_0x1aa359))return-0x1;continue;}break;}});for(let _0x57cfdf of _0x20e103){_0x1253fd[_0x1ba116(0x1ec)](new HashBrown['Entity'][(_0x1ba116(0x231))][(_0x1ba116(0x210))](_0x57cfdf));}return _0x1253fd;}static async[_0x40bf90(0x21a)](_0x4b7b9c){const _0x4e9dca=_0x40bf90,_0x4012ce={'xVgzX':_0x4e9dca(0x206)};checkParam(_0x4b7b9c,'id',String);let _0x218366={},_0x163596=await HashBrown[_0x4e9dca(0x1e7)]['DatabaseService'][_0x4e9dca(0x1f2)](_0x4012ce[_0x4e9dca(0x222)],_0x4012ce[_0x4e9dca(0x222)],{'id':_0x4b7b9c},{'tokens':0x0,'password':0x0});if(!_0x163596)return null;return new HashBrown[(_0x4e9dca(0x1e4))][(_0x4e9dca(0x231))][(_0x4e9dca(0x210))](_0x163596);}static async[_0x40bf90(0x1e2)](_0x27fa10){const _0x8e0d3a=_0x40bf90,_0xc1bfd0={'ImPhn':_0x8e0d3a(0x211),'MRNoZ':_0x8e0d3a(0x206)};let _0x8c545c={};return debug[_0x8e0d3a(0x1fe)](_0xc1bfd0[_0x8e0d3a(0x217)]+_0x27fa10+_0x8e0d3a(0x235),this,0x3),await HashBrown[_0x8e0d3a(0x1e7)][_0x8e0d3a(0x237)]['findOne']('users',_0xc1bfd0[_0x8e0d3a(0x1e0)],{'username':_0x27fa10},{'tokens':0x0,'password':0x0});}static async[_0x40bf90(0x203)](_0x31d12f){const _0x4310a9=_0x40bf90,_0x2b7b44={'UCpkv':function(_0x4330a1,_0x27b675){return _0x4330a1+_0x27b675;}};let _0x2f43b4=await this[_0x4310a9(0x200)](_0x31d12f);if(!_0x2f43b4)throw new Error(_0x2b7b44[_0x4310a9(0x1f5)](_0x2b7b44[_0x4310a9(0x1f5)](_0x4310a9(0x202),_0x31d12f),'\x22'));_0x2f43b4[_0x4310a9(0x203)](),await this[_0x4310a9(0x208)](_0x31d12f,_0x2f43b4['getObject']());}static async[_0x40bf90(0x1ed)](_0x517034,_0x28b400){const _0x33e60e=_0x40bf90,_0xcfac49={'pxzzW':function(_0x124f86,_0x1a102a){return _0x124f86>=_0x1a102a;},'NgNOM':function(_0x5c868f,_0x750463){return _0x5c868f===_0x750463;},'uOeDP':'string'};return _0x28b400[_0x33e60e(0x216)]&&_0xcfac49[_0x33e60e(0x22f)](_0x28b400['password'][_0x33e60e(0x20c)],0x4)&&_0xcfac49[_0x33e60e(0x1f1)](typeof _0x28b400[_0x33e60e(0x216)],_0xcfac49[_0x33e60e(0x236)])&&(_0x28b400[_0x33e60e(0x216)]=HashBrown['Entity'][_0x33e60e(0x231)][_0x33e60e(0x210)][_0x33e60e(0x21b)](_0x28b400[_0x33e60e(0x216)])),await HashBrown[_0x33e60e(0x1e7)]['DatabaseService'][_0x33e60e(0x21c)]('users',_0x33e60e(0x206),{'id':_0x517034},_0x28b400),new HashBrown[(_0x33e60e(0x1e4))]['Resource']['User'](_0x28b400);}static async[_0x40bf90(0x208)](_0x4f3213,_0x2fc5a4){const _0x32d2e5=_0x40bf90,_0x34fbee={'fKkxw':_0x32d2e5(0x22b),'nxbHc':_0x32d2e5(0x206)};_0x2fc5a4[_0x32d2e5(0x216)]&&_0x2fc5a4['password'][_0x32d2e5(0x20c)]>=0x4&&typeof _0x2fc5a4['password']===_0x34fbee[_0x32d2e5(0x1e6)]&&(_0x2fc5a4['password']=HashBrown['Entity'][_0x32d2e5(0x231)][_0x32d2e5(0x210)][_0x32d2e5(0x21b)](_0x2fc5a4['password'])),await HashBrown[_0x32d2e5(0x1e7)][_0x32d2e5(0x237)]['mergeOne'](_0x34fbee['nxbHc'],_0x32d2e5(0x206),{'username':_0x4f3213},_0x2fc5a4);}}module[_0x40bf90(0x21f)]=UserService;function _0x2ee2(_0x59803e,_0x501051){const _0x433560=_0x4335();return _0x2ee2=function(_0x2ee214,_0x2a5e64){_0x2ee214=_0x2ee214-0x1de;let _0x17db6f=_0x433560[_0x2ee214];return _0x17db6f;},_0x2ee2(_0x59803e,_0x501051);}function _0x4335(){const _0x229b06=['DatabaseService','logoutUser','createUser','934526EobppZ','revokeTokens','removeUserProjectScope','keys','MRNoZ','isAdmin','getUser','addUserProjectScope','Entity','FlGxT','fKkxw','Service','crypto','find','JKcxZ','Attempting\x20login\x20for\x20user\x20\x22','push','updateUserById','MJsdD','getProject','NDiIu','NgNOM','findOne','34397Vgzvil','7Oiuwek','UCpkv','removeToken','291440ogeOaT','23032sXxecm','3674514DhfDwO','loginUser','scopes','\x22\x20from\x20project\x20\x22','18160hTSAGD','log','insertOne','findUser','rPeqJ','No\x20user\x20by\x20username\x20\x22','cleanUpTokens','$or','split','users','fjkga','updateUser','Invalid\x20password','tokens','cRTFD','length','findToken','No\x20user\x20\x22','updateOne','User','Getting\x20user\x20\x22','removeUser','fullName','EFFfQ','621lqcBTG','password','ImPhn','Removing\x20user\x20\x22','iUXcR','getUserById','createPasswordHashSalt','mergeOne','216928uCIFJT','toLowerCase','exports','3iyFFaM','uxvoL','xVgzX','fGJzD','email','pARzZ','3|2|5|4|6|0|1','490iMVoOr','vdztx','\x22\x20is\x20taken','username','string','GTcYh','sort','getObject','pxzzW','scopes.','Resource','The\x20last\x20user\x20can\x27t\x20be\x20removed\x20from\x20a\x20project.\x20If\x20you\x20want\x20to\x20delete\x20the\x20project,\x20please\x20do\x20so\x20explicitly','KnEVi','wXoNH','\x22...','uOeDP'];_0x4335=function(){return _0x229b06;};return _0x4335();}