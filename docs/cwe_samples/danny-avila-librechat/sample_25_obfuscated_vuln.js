const _0x35b930=_0x594c;function _0x594c(_0x420e0a,_0x3ce7aa){const _0x513dd9=_0x513d();return _0x594c=function(_0x594c5d,_0x12488a){_0x594c5d=_0x594c5d-0x169;let _0x43853d=_0x513dd9[_0x594c5d];return _0x43853d;},_0x594c(_0x420e0a,_0x3ce7aa);}(function(_0x17cfc3,_0x46c2b2){const _0x403d50=_0x594c,_0x58ff93=_0x17cfc3();while(!![]){try{const _0x3c77c0=parseInt(_0x403d50(0x18c))/0x1+parseInt(_0x403d50(0x1a3))/0x2+parseInt(_0x403d50(0x18d))/0x3+parseInt(_0x403d50(0x1ac))/0x4*(parseInt(_0x403d50(0x1aa))/0x5)+parseInt(_0x403d50(0x16d))/0x6*(-parseInt(_0x403d50(0x181))/0x7)+-parseInt(_0x403d50(0x17c))/0x8+-parseInt(_0x403d50(0x179))/0x9;if(_0x3c77c0===_0x46c2b2)break;else _0x58ff93['push'](_0x58ff93['shift']());}catch(_0x5079a8){_0x58ff93['push'](_0x58ff93['shift']());}}}(_0x513d,0x7fa94));const {Session,Balance,getFiles,deleteFiles,deleteConvos,deletePresets,deleteMessages,deleteUserById}=require(_0x35b930(0x18f)),User=require('~/models/User'),{updateUserPluginAuth,deleteUserPluginAuth}=require('~/server/services/PluginService'),{updateUserPluginsService,deleteUserKey}=require(_0x35b930(0x189)),{verifyEmail,resendVerificationEmail}=require('~/server/services/AuthService'),{processDeleteRequest}=require(_0x35b930(0x170)),{deleteAllSharedLinks}=require(_0x35b930(0x183)),{Transaction}=require(_0x35b930(0x186)),{logger}=require(_0x35b930(0x19f)),getUserController=async(_0x34d8ba,_0xa23c82)=>{const _0x4cab2a=_0x35b930;_0xa23c82[_0x4cab2a(0x19b)](0xc8)[_0x4cab2a(0x197)](_0x34d8ba[_0x4cab2a(0x1a0)]);},getTermsStatusController=async(_0x172bb8,_0x47e7ab)=>{const _0x345934=_0x35b930,_0x333276={'HxZJO':'User\x20not\x20found','KIfIe':_0x345934(0x16b)};try{const _0x558f1f=await User[_0x345934(0x1ad)](_0x172bb8['user']['id']);if(!_0x558f1f)return _0x47e7ab[_0x345934(0x19b)](0x194)[_0x345934(0x1a8)]({'message':_0x333276[_0x345934(0x17d)]});_0x47e7ab[_0x345934(0x19b)](0xc8)[_0x345934(0x1a8)]({'termsAccepted':!!_0x558f1f['termsAccepted']});}catch(_0x4b4926){logger[_0x345934(0x1a6)](_0x345934(0x19c),_0x4b4926),_0x47e7ab['status'](0x1f4)[_0x345934(0x1a8)]({'message':_0x333276[_0x345934(0x190)]});}},acceptTermsController=async(_0x21bde5,_0xdac22a)=>{const _0x1c5c89=_0x35b930,_0x4b1862={'dyKZT':_0x1c5c89(0x184),'leYJP':_0x1c5c89(0x196),'styms':_0x1c5c89(0x1ab),'EiYmm':_0x1c5c89(0x175)};try{const _0x4ebc3f=await User['findByIdAndUpdate'](_0x21bde5[_0x1c5c89(0x1a0)]['id'],{'termsAccepted':!![]},{'new':!![]});if(!_0x4ebc3f){if(_0x4b1862['dyKZT']!==_0x1c5c89(0x184)){_0x17ccea[_0x1c5c89(0x1a6)](_0x1c5c89(0x185),_0x232b78);const {status:_0x21ff5a,message:_0x49a4c3}=_0x2d69e1;_0x20af3c[_0x1c5c89(0x19b)](_0x21ff5a)[_0x1c5c89(0x197)]({'message':_0x49a4c3});}else return _0xdac22a['status'](0x194)[_0x1c5c89(0x1a8)]({'message':_0x4b1862[_0x1c5c89(0x198)]});}_0xdac22a[_0x1c5c89(0x19b)](0xc8)[_0x1c5c89(0x1a8)]({'message':_0x4b1862[_0x1c5c89(0x1a4)]});}catch(_0x24dd41){logger[_0x1c5c89(0x1a6)]('Error\x20accepting\x20terms:',_0x24dd41),_0xdac22a[_0x1c5c89(0x19b)](0x1f4)[_0x1c5c89(0x1a8)]({'message':_0x4b1862['EiYmm']});}},deleteUserFiles=async _0x455f2f=>{const _0x1fd956=_0x35b930,_0x91c0a9={'SKRTP':function(_0x36c3fa,_0xd7fa87){return _0x36c3fa(_0xd7fa87);},'AubWy':'[deleteUserFiles]'};try{const _0x5c1569=await getFiles({'user':_0x455f2f['user']['id']});await _0x91c0a9[_0x1fd956(0x173)](processDeleteRequest,{'req':_0x455f2f,'files':_0x5c1569});}catch(_0x2fee3c){logger[_0x1fd956(0x1a6)](_0x91c0a9[_0x1fd956(0x199)],_0x2fee3c);}},updateUserPluginsController=async(_0x21e228,_0x4433b9)=>{const _0x40e381=_0x35b930,_0x56d7b6={'drMgW':function(_0x39873a,_0x8e8330,_0x20a691,_0x5b7e90){return _0x39873a(_0x8e8330,_0x20a691,_0x5b7e90);},'PmWlK':_0x40e381(0x18a),'zzVUr':function(_0x461dab,_0xaa1db7){return _0x461dab===_0xaa1db7;},'GSkPJ':'install','YUWRB':function(_0x5c758e,_0x406614){return _0x5c758e instanceof _0x406614;},'eNpdR':_0x40e381(0x17b),'acZDc':function(_0x2313cb,_0x55e0ec){return _0x2313cb>_0x55e0ec;},'egGlv':_0x40e381(0x1a2),'uyOMW':'yPktn','OBZZo':function(_0x2698cc,_0x4a9fcd){return _0x2698cc<_0x4a9fcd;},'UDMlh':_0x40e381(0x185),'SwLPC':function(_0x542802,_0x51afd2){return _0x542802===_0x51afd2;},'exsCv':'vQSpD','mLNOP':'[updateUserPluginsController]'},{user:_0x3cf06c}=_0x21e228,{pluginKey:_0x294c45,action:_0x35e47e,auth:_0x1dc0cf,isEntityTool:_0x51b6a2}=_0x21e228[_0x40e381(0x169)];let _0x56c50b;try{if(!_0x51b6a2){const _0x24a084=await _0x56d7b6[_0x40e381(0x177)](updateUserPluginsService,_0x3cf06c,_0x294c45,_0x35e47e);if(_0x24a084 instanceof Error){logger[_0x40e381(0x1a6)](_0x56d7b6[_0x40e381(0x1a7)],_0x24a084);const {status:_0x37450e,message:_0x1c5b65}=_0x24a084;_0x4433b9[_0x40e381(0x19b)](_0x37450e)[_0x40e381(0x197)]({'message':_0x1c5b65});}}if(_0x1dc0cf){const _0x2f2a07=Object[_0x40e381(0x187)](_0x1dc0cf),_0x367f01=Object[_0x40e381(0x19d)](_0x1dc0cf);if(_0x56d7b6[_0x40e381(0x16f)](_0x35e47e,_0x56d7b6[_0x40e381(0x16e)])&&_0x2f2a07[_0x40e381(0x172)]>0x0)for(let _0xd6ba7a=0x0;_0xd6ba7a<_0x2f2a07[_0x40e381(0x172)];_0xd6ba7a++){_0x56c50b=await updateUserPluginAuth(_0x3cf06c['id'],_0x2f2a07[_0xd6ba7a],_0x294c45,_0x367f01[_0xd6ba7a]);if(_0x56d7b6['YUWRB'](_0x56c50b,Error)){logger[_0x40e381(0x1a6)](_0x40e381(0x185),_0x56c50b);const {status:_0x2ac325,message:_0x372389}=_0x56c50b;_0x4433b9[_0x40e381(0x19b)](_0x2ac325)['send']({'message':_0x372389});}}if(_0x35e47e===_0x56d7b6['eNpdR']&&_0x56d7b6['acZDc'](_0x2f2a07[_0x40e381(0x172)],0x0)){if(_0x56d7b6[_0x40e381(0x16a)]===_0x56d7b6[_0x40e381(0x1a1)])return _0x5e0080['status'](0xc8)[_0x40e381(0x1a8)](_0x3d4ff6);else for(let _0x480c6f=0x0;_0x56d7b6[_0x40e381(0x174)](_0x480c6f,_0x2f2a07[_0x40e381(0x172)]);_0x480c6f++){_0x56c50b=await deleteUserPluginAuth(_0x3cf06c['id'],_0x2f2a07[_0x480c6f]);if(_0x56c50b instanceof Error){logger[_0x40e381(0x1a6)](_0x56d7b6[_0x40e381(0x17e)],_0x56c50b);const {status:_0x2c2e4c,message:_0x577293}=_0x56c50b;_0x4433b9['status'](_0x2c2e4c)[_0x40e381(0x197)]({'message':_0x577293});}}}}_0x4433b9[_0x40e381(0x19b)](0xc8)[_0x40e381(0x197)]();}catch(_0x1e85e6){return _0x56d7b6[_0x40e381(0x17a)](_0x56d7b6[_0x40e381(0x18e)],_0x40e381(0x176))?(logger[_0x40e381(0x1a6)](_0x56d7b6[_0x40e381(0x182)],_0x1e85e6),_0x4433b9['status'](0x1f4)[_0x40e381(0x1a8)]({'message':_0x40e381(0x193)})):_0x2cc852['status'](0x194)[_0x40e381(0x1a8)]({'message':_0x40e381(0x196)});}},deleteUserController=async(_0x5a46c9,_0xba215b)=>{const _0x340ff3=_0x35b930,_0x517694={'yQSdg':function(_0x6d8c2b,_0x326f91,_0x1ab436,_0x4416e9){return _0x6d8c2b(_0x326f91,_0x1ab436,_0x4416e9);},'kDGNo':function(_0x698469,_0x1a655d){return _0x698469(_0x1a655d);}},{user:_0x478a7f}=_0x5a46c9;try{await deleteMessages({'user':_0x478a7f['id']}),await Session[_0x340ff3(0x19a)]({'user':_0x478a7f['id']}),await Transaction[_0x340ff3(0x19a)]({'user':_0x478a7f['id']}),await deleteUserKey({'userId':_0x478a7f['id'],'all':!![]}),await Balance['deleteMany']({'user':_0x478a7f[_0x340ff3(0x194)]}),await deletePresets(_0x478a7f['id']),await deleteConvos(_0x478a7f['id']),await _0x517694[_0x340ff3(0x192)](deleteUserPluginAuth,_0x478a7f['id'],null,!![]),await deleteUserById(_0x478a7f['id']),await deleteAllSharedLinks(_0x478a7f['id']),await _0x517694[_0x340ff3(0x18b)](deleteUserFiles,_0x5a46c9),await deleteFiles(null,_0x478a7f['id']),logger[_0x340ff3(0x171)]('User\x20deleted\x20account.\x20Email:\x20'+_0x478a7f[_0x340ff3(0x188)]+_0x340ff3(0x1a9)+_0x478a7f['id']),_0xba215b[_0x340ff3(0x19b)](0xc8)[_0x340ff3(0x197)]({'message':'User\x20deleted'});}catch(_0x1aef1){return logger['error'](_0x340ff3(0x180),_0x1aef1),_0xba215b[_0x340ff3(0x19b)](0x1f4)[_0x340ff3(0x1a8)]({'message':_0x340ff3(0x193)});}},verifyEmailController=async(_0x5708ef,_0x410a05)=>{const _0x276b9a=_0x35b930,_0xf57838={'oNGLJ':_0x276b9a(0x16c),'atjom':_0x276b9a(0x1a5),'bVaGv':_0x276b9a(0x193)};try{const _0x647742=await verifyEmail(_0x5708ef);return _0x647742 instanceof Error?_0x410a05['status'](0x190)['json'](_0x647742):_0x410a05['status'](0xc8)[_0x276b9a(0x1a8)](_0x647742);}catch(_0x40e764){return _0xf57838['oNGLJ']!==_0xf57838[_0x276b9a(0x178)]?(logger[_0x276b9a(0x1a6)](_0x276b9a(0x195),_0x40e764),_0x410a05[_0x276b9a(0x19b)](0x1f4)[_0x276b9a(0x1a8)]({'message':_0xf57838['bVaGv']})):_0x3be13a['status'](0x194)[_0x276b9a(0x1a8)]({'message':_0x276b9a(0x196)});}},resendVerificationController=async(_0x164bd5,_0x5ca548)=>{const _0x454dd0=_0x35b930,_0x4f58f0={'dOqJB':function(_0x558ccd,_0x576755){return _0x558ccd(_0x576755);},'wkPGE':function(_0x1bab15,_0x3692fa){return _0x1bab15 instanceof _0x3692fa;},'uXAzS':_0x454dd0(0x193)};try{const _0x553d58=await _0x4f58f0['dOqJB'](resendVerificationEmail,_0x164bd5);return _0x4f58f0[_0x454dd0(0x191)](_0x553d58,Error)?_0x5ca548[_0x454dd0(0x19b)](0x190)[_0x454dd0(0x1a8)](_0x553d58):_0x5ca548[_0x454dd0(0x19b)](0xc8)[_0x454dd0(0x1a8)](_0x553d58);}catch(_0x234ed6){return logger[_0x454dd0(0x1a6)](_0x454dd0(0x195),_0x234ed6),_0x5ca548['status'](0x1f4)[_0x454dd0(0x1a8)]({'message':_0x4f58f0[_0x454dd0(0x19e)]});}};function _0x513d(){const _0x1d46d0=['~/models','KIfIe','wkPGE','yQSdg','Something\x20went\x20wrong.','_id','[verifyEmailController]','User\x20not\x20found','send','leYJP','AubWy','deleteMany','status','Error\x20fetching\x20terms\x20acceptance\x20status:','values','uXAzS','~/config','user','uyOMW','giAHX','1025164HJgflQ','styms','qxspc','error','PmWlK','json','\x20ID:\x20','205evUXZR','Terms\x20accepted\x20successfully','81560MOlZmV','findById','body','egGlv','Error\x20fetching\x20terms\x20acceptance\x20status','hJIcp','1812LteWSL','GSkPJ','zzVUr','~/server/services/Files/process','info','length','SKRTP','OBZZo','Error\x20accepting\x20terms','vQSpD','drMgW','atjom','11945520tkOeJJ','SwLPC','uninstall','2694176vuiUXM','HxZJO','UDMlh','exports','[deleteUserController]','203mldJsm','mLNOP','~/models/Share','QtAdV','[authService]','~/models/Transaction','keys','email','~/server/services/UserService','[userPluginsService]','kDGNo','502312KyBiBQ','1034478FvtrZU','exsCv'];_0x513d=function(){return _0x1d46d0;};return _0x513d();}module[_0x35b930(0x17f)]={'getUserController':getUserController,'getTermsStatusController':getTermsStatusController,'acceptTermsController':acceptTermsController,'deleteUserController':deleteUserController,'verifyEmailController':verifyEmailController,'updateUserPluginsController':updateUserPluginsController,'resendVerificationController':resendVerificationController};