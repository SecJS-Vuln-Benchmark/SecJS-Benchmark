const _0x2a1c2e=_0x4726;(function(_0x5c8c7a,_0x24d679){const _0x35244d=_0x4726,_0x53f113=_0x5c8c7a();while(!![]){try{const _0x321ad8=-parseInt(_0x35244d(0x8d))/0x1+parseInt(_0x35244d(0xa5))/0x2*(-parseInt(_0x35244d(0xae))/0x3)+parseInt(_0x35244d(0xa8))/0x4+-parseInt(_0x35244d(0xb9))/0x5*(-parseInt(_0x35244d(0x8f))/0x6)+parseInt(_0x35244d(0x99))/0x7*(-parseInt(_0x35244d(0x9a))/0x8)+-parseInt(_0x35244d(0x93))/0x9+parseInt(_0x35244d(0xab))/0xa;if(_0x321ad8===_0x24d679)break;else _0x53f113['push'](_0x53f113['shift']());}catch(_0x4b9e37){_0x53f113['push'](_0x53f113['shift']());}}}(_0x50ac,0x443e1));const {Constants}=require(_0x2a1c2e(0x8b)),{createAbortController,handleAbortError}=require(_0x2a1c2e(0xbe)),{sendMessage}=require(_0x2a1c2e(0xc2)),{saveMessage}=require(_0x2a1c2e(0x8c)),{logger}=require('~/config'),AgentController=async(_0x14731d,_0x341ca9,_0x5cb2cd,_0x4c81c4,_0x14ecb9)=>{const _0x2f6370=_0x2a1c2e,_0x26d205={'NTYUi':function(_0x54cd2a,_0xe26c87){return _0x54cd2a===_0xe26c87;},'xaOQW':_0x2f6370(0x9b),'JnJQa':_0x2f6370(0xb7),'OMLlw':function(_0x2fe38c,_0x47f7e9){return _0x2fe38c===_0x47f7e9;},'wgXUH':_0x2f6370(0x9d),'ZTglM':function(_0x5e6bef,_0x3c23a9){return _0x5e6bef!==_0x3c23a9;},'WQbgG':'XhYbL','pdKBU':function(_0x51bcbd,_0x22598a){return _0x51bcbd===_0x22598a;},'rfKpz':'BYHyv','oDMPx':function(_0x8d2ebb,_0x487e74){return _0x8d2ebb===_0x487e74;},'iEsAI':'sender','lijXV':function(_0x14aee4,_0x1f42a1){return _0x14aee4===_0x1f42a1;},'mouzS':'conversationId','pWjSN':function(_0x50422f,_0x39761e){return _0x50422f!==_0x39761e;},'rviZi':function(_0x303e42,_0x2b13dd){return _0x303e42??_0x2b13dd;},'CbnUN':function(_0x4629da,_0x1dce74){return _0x4629da!==_0x1dce74;},'GYLsF':_0x2f6370(0x81),'oYoBs':_0x2f6370(0xb3),'pqAVR':'New\x20Chat','fGWvA':function(_0x3e9211,_0x513449,_0x4adfe){return _0x3e9211(_0x513449,_0x4adfe);},'CroLl':function(_0x161166,_0x515bdf,_0x24a712,_0x22588f){return _0x161166(_0x515bdf,_0x24a712,_0x22588f);},'VfTyS':function(_0x1ce051,_0xa22e13,_0x250e97,_0x479bcc){return _0x1ce051(_0xa22e13,_0x250e97,_0x479bcc);},'xWOxJ':function(_0x3acd38,_0x1bc2d2){return _0x3acd38===_0x1bc2d2;},'FHmCN':_0x2f6370(0xb0),'lWUeZ':function(_0x45972a,_0x8dc560,_0x13ec0e){return _0x45972a(_0x8dc560,_0x13ec0e);}};let {text:_0x59cc40,endpointOption:_0x2d1554,conversationId:_0x3c4f0b,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x14731d['body'],_0x52c9db,_0xe1137f,_0x1faf3c,_0x44ebe8,_0x175057,_0x1bdcd5;const _0x51f194=!_0x3c4f0b,_0x4bd8b9=_0x14731d[_0x2f6370(0xbf)]['id'],_0x16e7f4=(_0x182549={})=>{const _0x31749b=_0x2f6370;for(let _0x5a10bd in _0x182549){if(_0x26d205[_0x31749b(0x92)](_0x5a10bd,_0x26d205['xaOQW']))_0xe1137f=_0x182549[_0x5a10bd],_0x44ebe8=_0x182549[_0x5a10bd][_0x31749b(0x86)];else{if(_0x5a10bd===_0x26d205[_0x31749b(0xa0)])_0x1bdcd5=_0x182549[_0x5a10bd];else{if(_0x26d205['OMLlw'](_0x5a10bd,_0x26d205['wgXUH'])){if(_0x26d205[_0x31749b(0x89)](_0x26d205['WQbgG'],_0x26d205['WQbgG']))return;else _0x175057=_0x182549[_0x5a10bd];}else{if(_0x26d205[_0x31749b(0xad)](_0x5a10bd,_0x31749b(0x85)))_0x26d205[_0x31749b(0x98)]!==_0x31749b(0x9c)?_0x1faf3c=_0x182549[_0x5a10bd]:_0x1731e5=_0x42838c[_0x2219be];else{if(_0x26d205['oDMPx'](_0x5a10bd,_0x26d205[_0x31749b(0xa3)]))_0x52c9db=_0x182549[_0x5a10bd];else!_0x3c4f0b&&_0x26d205['lijXV'](_0x5a10bd,_0x26d205[_0x31749b(0x94)])&&(_0x26d205[_0x31749b(0xaf)](_0x31749b(0x83),_0x31749b(0xc1))?_0x3c4f0b=_0x182549[_0x5a10bd]:(_0x44df64=_0x2eb529[_0x49bc9e],_0x54c414=_0x43f714[_0x1d6009][_0x31749b(0x86)]));}}}}}};try{const {client:_0x129c19}=await _0x4c81c4({'req':_0x14731d,'res':_0x341ca9,'endpointOption':_0x2d1554}),_0x31b0c1=()=>({'sender':_0x52c9db,'userMessage':_0xe1137f,'promptTokens':_0x1faf3c,'conversationId':_0x3c4f0b,'userMessagePromise':_0x1bdcd5,'messageId':_0x175057,'content':_0x129c19[_0x2f6370(0xbb)](),'parentMessageId':overrideParentMessageId??_0x44ebe8}),{abortController:_0x15eaac,onStart:_0x35a20e}=createAbortController(_0x14731d,_0x341ca9,_0x31b0c1,_0x16e7f4);_0x341ca9['on'](_0x2f6370(0xa4),()=>{const _0x51ee9e=_0x2f6370,_0x352481={'gycHD':function(_0x3bcd60,_0xe8c0fe,_0x1b3ca7,_0x52446f,_0x139caf){return _0x3bcd60(_0xe8c0fe,_0x1b3ca7,_0x52446f,_0x139caf);},'gRcGU':function(_0x58c744,_0x2cd5d5){const _0x504edd=_0x4726;return _0x26d205[_0x504edd(0xa7)](_0x58c744,_0x2cd5d5);}};if(_0x26d205[_0x51ee9e(0x96)](_0x51ee9e(0xb4),_0x51ee9e(0xb4)))return;else{logger[_0x51ee9e(0x90)](_0x51ee9e(0x9f));if(!_0x15eaac)return;else{if(_0x15eaac['signal'][_0x51ee9e(0xb1)]){if(_0x26d205[_0x51ee9e(0xb2)]===_0x51ee9e(0x81))return;else _0x352481['gycHD'](_0x20cf03,_0x30ca1b,_0x455db6,_0x5a78da,{'conversationId':_0x31777a,'sender':_0x5c9271,'messageId':_0x2ce6c7,'parentMessageId':_0x352481[_0x51ee9e(0x9e)](_0x579619,_0x42520e)});}else{if(_0x15eaac[_0x51ee9e(0xa1)])return;}}_0x15eaac[_0x51ee9e(0xa6)](),logger['debug'](_0x26d205[_0x51ee9e(0xb8)]);}});const _0x312312={'user':_0x4bd8b9,'onStart':_0x35a20e,'getReqData':_0x16e7f4,'conversationId':_0x3c4f0b,'parentMessageId':parentMessageId,'abortController':_0x15eaac,'overrideParentMessageId':overrideParentMessageId,'progressOptions':{'res':_0x341ca9}};let _0x30ddd4=await _0x129c19[_0x2f6370(0xb6)](_0x59cc40,_0x312312);_0x30ddd4[_0x2f6370(0xba)]=_0x2d1554[_0x2f6370(0xba)];const {conversation:conversation={}}=await _0x129c19[_0x2f6370(0xa9)];conversation[_0x2f6370(0x84)]=conversation&&!conversation[_0x2f6370(0x84)]?null:conversation?.['title']||_0x26d205[_0x2f6370(0xa2)];_0x129c19[_0x2f6370(0xbd)]['attachments']&&(_0xe1137f[_0x2f6370(0x97)]=_0x129c19[_0x2f6370(0xbd)][_0x2f6370(0xc3)],delete _0xe1137f[_0x2f6370(0x95)]);!_0x15eaac[_0x2f6370(0x8e)][_0x2f6370(0xb1)]&&(_0x26d205[_0x2f6370(0xc0)](sendMessage,_0x341ca9,{'final':!![],'conversation':conversation,'title':conversation[_0x2f6370(0x84)],'requestMessage':_0xe1137f,'responseMessage':_0x30ddd4}),_0x341ca9[_0x2f6370(0xb5)](),await _0x26d205['CroLl'](saveMessage,_0x14731d,{..._0x30ddd4,'user':_0x4bd8b9},{'context':_0x2f6370(0x82)}));!_0x129c19[_0x2f6370(0xac)]&&await _0x26d205[_0x2f6370(0x8a)](saveMessage,_0x14731d,_0xe1137f,{'context':'api/server/controllers/agents/request.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message'});if(_0x14ecb9&&_0x26d205[_0x2f6370(0x91)](parentMessageId,Constants[_0x2f6370(0x87)])&&_0x51f194){if('iuaIO'===_0x26d205[_0x2f6370(0xaa)]){_0x24c195[_0x2f6370(0x90)]('[AgentController]\x20Request\x20closed');if(!_0x14c197)return;else{if(_0x1de71b[_0x2f6370(0x8e)][_0x2f6370(0xb1)])return;else{if(_0x892185[_0x2f6370(0xa1)])return;}}_0x55bb08[_0x2f6370(0xa6)](),_0x42f1c9['debug'](_0x2f6370(0xb3));}else _0x26d205[_0x2f6370(0xbc)](_0x14ecb9,_0x14731d,{'text':_0x59cc40,'response':_0x30ddd4,'client':_0x129c19});}}catch(_0x1b78b5){handleAbortError(_0x341ca9,_0x14731d,_0x1b78b5,{'conversationId':_0x3c4f0b,'sender':_0x52c9db,'messageId':_0x175057,'parentMessageId':_0x44ebe8??parentMessageId});}};module[_0x2a1c2e(0x88)]=AgentController;function _0x4726(_0x2fc6d0,_0xb0d498){const _0x50aca9=_0x50ac();return _0x4726=function(_0x472669,_0x33d8b1){_0x472669=_0x472669-0x81;let _0x4000fd=_0x50aca9[_0x472669];return _0x4000fd;},_0x4726(_0x2fc6d0,_0xb0d498);}function _0x50ac(){const _0xe8e13c=['iEsAI','close','2jhYqqC','abort','rviZi','548628JqutxI','responsePromise','FHmCN','7329690CdkViv','skipSaveUserMessage','pdKBU','83487GbRsGk','pWjSN','weKIa','aborted','GYLsF','[AgentController]\x20Request\x20aborted\x20on\x20close','YhNQI','end','sendMessage','userMessagePromise','oYoBs','78335QFuTNR','endpoint','getContentParts','lWUeZ','options','~/server/middleware','user','fGWvA','cUwYW','~/server/utils','attachments','TpuJg','api/server/controllers/agents/request.js\x20-\x20response\x20end','NKLvp','title','promptTokens','messageId','NO_PARENT','exports','ZTglM','VfTyS','librechat-data-provider','~/models','272024FhuMlK','signal','66yIbjHh','debug','xWOxJ','NTYUi','3459204QgGGiv','mouzS','image_urls','CbnUN','files','rfKpz','7iAWdEj','629864ucWnhR','userMessage','iqnMn','responseMessageId','gRcGU','[AgentController]\x20Request\x20closed','JnJQa','requestCompleted','pqAVR'];_0x50ac=function(){return _0xe8e13c;};return _0x50ac();}