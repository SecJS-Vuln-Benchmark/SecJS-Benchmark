const _0x1b9015=_0x56d3;(function(_0x3fa170,_0x3f9114){const _0x20b6ea=_0x56d3,_0xba49a=_0x3fa170();while(!![]){try{const _0x33e6b8=parseInt(_0x20b6ea(0x80))/0x1*(-parseInt(_0x20b6ea(0x83))/0x2)+-parseInt(_0x20b6ea(0x9e))/0x3*(-parseInt(_0x20b6ea(0xa1))/0x4)+parseInt(_0x20b6ea(0xa6))/0x5*(-parseInt(_0x20b6ea(0xa9))/0x6)+parseInt(_0x20b6ea(0xb6))/0x7*(parseInt(_0x20b6ea(0x8e))/0x8)+-parseInt(_0x20b6ea(0x9b))/0x9*(parseInt(_0x20b6ea(0xb2))/0xa)+parseInt(_0x20b6ea(0x9a))/0xb+parseInt(_0x20b6ea(0xba))/0xc*(-parseInt(_0x20b6ea(0xa3))/0xd);if(_0x33e6b8===_0x3f9114)break;else _0xba49a['push'](_0xba49a['shift']());}catch(_0x2eb744){_0xba49a['push'](_0xba49a['shift']());}}}(_0x3efe,0x6efc6));function _0x56d3(_0x55a6d1,_0x541072){const _0x3efe77=_0x3efe();return _0x56d3=function(_0x56d3ec,_0x533f68){_0x56d3ec=_0x56d3ec-0x7b;let _0x4b1a9a=_0x3efe77[_0x56d3ec];return _0x4b1a9a;},_0x56d3(_0x55a6d1,_0x541072);}const {Tools}=require(_0x1b9015(0xb5)),{SerpAPI}=require(_0x1b9015(0x95)),{Calculator}=require(_0x1b9015(0xbc)),{createCodeExecutionTool,EnvVar}=require('@librechat/agents'),{getUserPluginAuthValue}=require('~/server/services/PluginService'),{availableTools,GoogleSearchAPI,DALLE3,StructuredSD,StructuredACS,TraversaalSearch,StructuredWolfram,TavilySearchResults}=require(_0x1b9015(0x88)),{primeFiles}=require(_0x1b9015(0xa5)),createFileSearchTool=require('./createFileSearchTool'),{loadSpecs}=require('./loadSpecs'),{logger}=require('~/config'),validateTools=async(_0xfe5be5,_0xadab41=[])=>{const _0x257857=_0x1b9015,_0x3f618d={'sfApU':function(_0x8ea9d3,_0x4b72d0){return _0x8ea9d3>_0x4b72d0;},'mhRbO':function(_0xc9ae74,_0x425bc5){return _0xc9ae74===_0x425bc5;},'uqYDr':function(_0x1e48e4,_0x51f150){return _0x1e48e4>_0x51f150;},'gMGKv':_0x257857(0x90),'jhIMB':'DGkxY','sBtYe':_0x257857(0xa7),'QjiJv':'[validateTools]\x20There\x20was\x20a\x20problem\x20validating\x20tools'};try{const _0x102c9a=new Set(_0xadab41),_0x1007fa=availableTools[_0x257857(0x97)](_0x1d1b46=>_0x102c9a['has'](_0x1d1b46['pluginKey'])),_0x48a734=async(_0x182433,_0x4a6ca4)=>{const _0x212946=_0x257857,_0x1537f2=_0x182433[_0x212946(0x9c)]('||');for(const _0x4ecc90 of _0x1537f2){const _0x4c645f=process[_0x212946(0x9f)][_0x4ecc90];if(_0x4c645f&&_0x3f618d[_0x212946(0xaf)](_0x4c645f[_0x212946(0xbb)],0x0))return;let _0xa7c49e=null;try{_0xa7c49e=await getUserPluginAuthValue(_0xfe5be5,_0x4ecc90);}catch(_0x3d73b6){if(_0x3f618d[_0x212946(0xb9)](_0x4ecc90,_0x1537f2[_0x1537f2[_0x212946(0xbb)]-0x1])&&!_0xa7c49e)throw _0x3d73b6;}if(_0xa7c49e&&_0x3f618d[_0x212946(0xae)](_0xa7c49e[_0x212946(0xbb)],0x0))return;}_0x102c9a['delete'](_0x4a6ca4);};for(const _0x1a0092 of _0x1007fa){if(!_0x1a0092['authConfig']||_0x1a0092[_0x257857(0x82)][_0x257857(0xbb)]===0x0)continue;for(const _0x10d7ea of _0x1a0092[_0x257857(0x82)]){if('XEODb'!==_0x3f618d['gMGKv'])await _0x48a734(_0x10d7ea[_0x257857(0x7c)],_0x1a0092[_0x257857(0xc1)]);else throw _0x252877;}}return Array[_0x257857(0xa2)](_0x102c9a[_0x257857(0xbd)]());}catch(_0x2a51cd){if(_0x3f618d[_0x257857(0xad)]===_0x3f618d[_0x257857(0x92)])_0x55d80e[_0x3ee9fd]=_0x2a4065[_0x3cfb59];else{logger[_0x257857(0x98)](_0x3f618d[_0x257857(0xbf)],_0x2a51cd);throw new Error('There\x20was\x20a\x20problem\x20validating\x20tools');}}},loadAuthValues=async({userId:_0x24be49,authFields:_0x409c74})=>{const _0xb7f060=_0x1b9015;let _0x231657={};const _0x3f95bc=async _0x440b8c=>{const _0x4b3b3a=_0x56d3;for(const _0x34d203 of _0x440b8c){let _0x16728d=process[_0x4b3b3a(0x9f)][_0x34d203];if(_0x16728d)return{'authField':_0x34d203,'authValue':_0x16728d};try{_0x16728d=await getUserPluginAuthValue(_0x24be49,_0x34d203);}catch(_0x371bc5){if(_0x34d203===_0x440b8c[_0x440b8c['length']-0x1]&&!_0x16728d)throw _0x371bc5;}if(_0x16728d)return{'authField':_0x34d203,'authValue':_0x16728d};}return null;};for(let _0x56208b of _0x409c74){const _0x51cf20=_0x56208b['split']('||'),_0x104c42=await _0x3f95bc(_0x51cf20);_0x104c42&&(_0x231657[_0x104c42[_0xb7f060(0x7c)]]=_0x104c42[_0xb7f060(0xc4)]);}return _0x231657;},loadToolWithAuth=(_0x6b7ca4,_0x594aba,_0x13d07c,_0x1d8049={})=>{const _0x212f95=_0x1b9015,_0x232ca9={'fmcAN':function(_0x3a847e,_0x2be518){return _0x3a847e===_0x2be518;},'zFIeS':_0x212f95(0x7b),'NsSRs':function(_0x119641,_0x27a221){return _0x119641(_0x27a221);}};return async function(){const _0xbd534f=_0x212f95;if(_0x232ca9['fmcAN'](_0xbd534f(0x7b),_0x232ca9[_0xbd534f(0xb0)])){const _0x22c739=await _0x232ca9[_0xbd534f(0xb8)](loadAuthValues,{'userId':_0x6b7ca4,'authFields':_0x594aba});return new _0x13d07c({..._0x1d8049,..._0x22c739,'userId':_0x6b7ca4});}else _0x211725[_0x3b5191[_0xbd534f(0x7c)]]=_0x1ae603[_0xbd534f(0xc4)];};},loadTools=async({user:_0x54ef21,model:_0x110619,functions:functions=!![],returnMap:returnMap=![],tools:tools=[],options:options={},skipSpecs:skipSpecs=![]})=>{const _0x31b7fd=_0x1b9015,_0x1009b2={'JLRyi':_0x31b7fd(0xa8),'nilbi':'[validateTools]\x20There\x20was\x20a\x20problem\x20validating\x20tools','IAlsj':function(_0x211aca,_0x1c9bc5,_0x2df488){return _0x211aca(_0x1c9bc5,_0x2df488);},'MZQSV':function(_0x29d5a8,_0x83d818){return _0x29d5a8===_0x83d818;},'BbnPt':'tyfBG','bbBYQ':function(_0x2b94fc,_0x17dc06,_0x5d8e54,_0x1076a6,_0x38581f){return _0x2b94fc(_0x17dc06,_0x5d8e54,_0x1076a6,_0x38581f);},'KaUpU':function(_0x93ac39,_0x4753b1){return _0x93ac39>_0x4753b1;},'bLMWX':function(_0x331800,_0xb4dfde){return _0x331800!==_0xb4dfde;},'HIbUw':function(_0x10b840,_0x5dbf8f){return _0x10b840(_0x5dbf8f);},'RHPQE':function(_0x1945aa,_0x3099cf){return _0x1945aa!==_0x3099cf;},'HjPfJ':'kzlsv','EYAVx':function(_0x4967c0,_0x1b7c32){return _0x4967c0!==_0x1b7c32;},'GsUBT':_0x31b7fd(0x91),'hslZy':function(_0x2dfbfe){return _0x2dfbfe();},'qfiMG':_0x31b7fd(0xaa)},_0x35c998={'calculator':Calculator,'google':GoogleSearchAPI,'wolfram':StructuredWolfram,'stable-diffusion':StructuredSD,'azure-ai-search':StructuredACS,'traversaal_search':TraversaalSearch,'tavily_search_results_json':TavilySearchResults},_0xe2f5c0={'serpapi':async()=>{const _0x2afcf2=_0x31b7fd;let _0x4f6d47=process[_0x2afcf2(0x9f)]['SERPAPI_API_KEY'];return!_0x4f6d47&&(_0x4f6d47=await getUserPluginAuthValue(_0x54ef21,'SERPAPI_API_KEY')),new SerpAPI(_0x4f6d47,{'location':_0x1009b2[_0x2afcf2(0x99)],'hl':'en','gl':'us'});}},_0x29b931={};functions&&(_0x35c998[_0x31b7fd(0x7f)]=DALLE3);const _0x4358da={'req':options[_0x31b7fd(0x93)],'fileStrategy':options[_0x31b7fd(0x9d)],'processFileURL':options[_0x31b7fd(0x7e)],'returnMetadata':options[_0x31b7fd(0x96)],'uploadImageBuffer':options[_0x31b7fd(0xc2)]},_0x227232={'serpapi':{'location':_0x1009b2[_0x31b7fd(0x99)],'hl':'en','gl':'us'},'dalle':_0x4358da,'dall-e':_0x4358da,'stable-diffusion':_0x4358da},_0xefbea4={};availableTools[_0x31b7fd(0xa4)](_0x1fa2a6=>{const _0x2b35a5=_0x31b7fd;if(_0xe2f5c0[_0x1fa2a6[_0x2b35a5(0xc1)]])return;_0xefbea4[_0x1fa2a6['pluginKey']]=_0x1fa2a6[_0x2b35a5(0x82)][_0x2b35a5(0x86)](_0xd9c277=>_0xd9c277[_0x2b35a5(0x7c)]);});const _0x1fb4ea=[];for(const _0x2846bc of tools){if(_0x2846bc===Tools[_0x31b7fd(0xbe)]){const _0x2d94d7=await loadAuthValues({'userId':_0x54ef21,'authFields':[EnvVar[_0x31b7fd(0x8a)]]}),_0x1d64b8=await _0x1009b2[_0x31b7fd(0xab)](primeFiles,options,_0x2d94d7[EnvVar[_0x31b7fd(0x8a)]]);_0x29b931[_0x2846bc]=()=>createCodeExecutionTool({'user_id':_0x54ef21,'files':_0x1d64b8,..._0x2d94d7});continue;}else{if(_0x1009b2[_0x31b7fd(0x84)](_0x2846bc,Tools[_0x31b7fd(0x85)])){if(_0x31b7fd(0x89)===_0x1009b2[_0x31b7fd(0x81)]){_0x29b931[_0x2846bc]=()=>createFileSearchTool(options);continue;}else return{'authField':_0x297882,'authValue':_0x2c1330};}}if(_0xe2f5c0[_0x2846bc]){_0x29b931[_0x2846bc]=_0xe2f5c0[_0x2846bc];continue;}if(_0x35c998[_0x2846bc]){const _0x2591c9=_0x227232[_0x2846bc]||{},_0x1cc792=_0x1009b2['bbBYQ'](loadToolWithAuth,_0x54ef21,_0xefbea4[_0x2846bc],_0x35c998[_0x2846bc],_0x2591c9);_0x29b931[_0x2846bc]=_0x1cc792;continue;}functions&&_0x1fb4ea[_0x31b7fd(0xb3)](_0x2846bc);}let _0x337d83=null;functions&&_0x1009b2[_0x31b7fd(0xac)](_0x1fb4ea[_0x31b7fd(0xbb)],0x0)&&_0x1009b2[_0x31b7fd(0xb4)](skipSpecs,!![])&&(_0x337d83=await _0x1009b2[_0x31b7fd(0xc0)](loadSpecs,{'llm':_0x110619,'user':_0x54ef21,'message':options[_0x31b7fd(0x94)],'memory':options[_0x31b7fd(0x8f)],'signal':options[_0x31b7fd(0xb7)],'tools':_0x1fb4ea,'map':!![],'verbose':![]}));for(const _0xb5c814 of _0x1fb4ea){if(_0x337d83&&_0x337d83[_0xb5c814]){if(_0x1009b2['RHPQE'](_0x1009b2['HjPfJ'],_0x1009b2['HjPfJ'])){_0x478540[_0x31b7fd(0x98)](_0x1009b2['nilbi'],_0xeb9736);throw new _0x10877f(_0x31b7fd(0x87));}else _0x29b931[_0xb5c814]=_0x337d83[_0xb5c814];}}if(returnMap)return _0x29b931;let _0x4c4baa=[];for(const _0x482193 of tools){if(_0x1009b2[_0x31b7fd(0x8d)](_0x1009b2[_0x31b7fd(0x8b)],_0x31b7fd(0x8c))){const _0x38fe79=_0x29b931[_0x482193];if(!_0x38fe79)continue;const _0x5f4323=await _0x1009b2[_0x31b7fd(0xb1)](_0x38fe79);if(Array[_0x31b7fd(0xc3)](_0x5f4323))_0x1009b2[_0x31b7fd(0x8d)](_0x1009b2[_0x31b7fd(0xa0)],_0x1009b2[_0x31b7fd(0xa0)])?_0x289d66=[..._0x4287bf,..._0x10f4c1]:_0x4c4baa=[..._0x4c4baa,..._0x5f4323];else _0x5f4323&&_0x4c4baa[_0x31b7fd(0xb3)](_0x5f4323);}else _0x4a1f34['push'](_0x2d4cc2);}return _0x4c4baa;};module[_0x1b9015(0x7d)]={'loadToolWithAuth':loadToolWithAuth,'loadAuthValues':loadAuthValues,'validateTools':validateTools,'loadTools':loadTools};function _0x3efe(){const _0x1d1014=['@langchain/community/tools/serpapi','returnMetadata','filter','error','JLRyi','6225494jTWGAN','680589JttsrF','split','fileStrategy','6NvgMUy','env','qfiMG','1621748EDJmta','from','338PCIAXE','forEach','~/server/services/Files/Code/process','150CZgTDd','QHfqK','Austin,Texas,United\x20States','57678pDAbir','HAIsI','IAlsj','KaUpU','jhIMB','uqYDr','sfApU','zFIeS','hslZy','30InarXn','push','bLMWX','librechat-data-provider','21aKcBKE','signal','NsSRs','mhRbO','363468KiHeal','length','@langchain/community/tools/calculator','values','execute_code','QjiJv','HIbUw','pluginKey','uploadImageBuffer','isArray','authValue','MQLLM','authField','exports','processFileURL','dalle','40894AFNyqQ','BbnPt','authConfig','2QBslvE','MZQSV','file_search','map','There\x20was\x20a\x20problem\x20validating\x20tools','../','tyfBG','CODE_API_KEY','GsUBT','ldmBG','EYAVx','1123816IQgRea','memory','iUriL','fOyKk','sBtYe','req','message'];_0x3efe=function(){return _0x1d1014;};return _0x3efe();}