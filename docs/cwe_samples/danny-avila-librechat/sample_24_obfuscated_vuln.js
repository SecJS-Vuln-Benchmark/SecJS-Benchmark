const _0x33202f=_0x3250;(function(_0x51dcb9,_0x993aec){const _0x1acadd=_0x3250,_0x5545c4=_0x51dcb9();while(!![]){try{const _0x461189=parseInt(_0x1acadd(0x126))/0x1*(-parseInt(_0x1acadd(0x156))/0x2)+-parseInt(_0x1acadd(0x150))/0x3+parseInt(_0x1acadd(0x145))/0x4*(-parseInt(_0x1acadd(0x135))/0x5)+-parseInt(_0x1acadd(0x137))/0x6*(-parseInt(_0x1acadd(0x12a))/0x7)+-parseInt(_0x1acadd(0x164))/0x8+parseInt(_0x1acadd(0x13a))/0x9+parseInt(_0x1acadd(0x15a))/0xa;if(_0x461189===_0x993aec)break;else _0x5545c4['push'](_0x5545c4['shift']());}catch(_0xa2e6ce){_0x5545c4['push'](_0x5545c4['shift']());}}}(_0x11b6,0xce5a9));const throttle=require('lodash/throttle'),{getResponseSender,Constants,CacheKeys,Time}=require(_0x33202f(0x12f)),{createAbortController,handleAbortError}=require(_0x33202f(0x166)),{sendMessage,createOnProgress}=require(_0x33202f(0x161)),{getLogStores}=require(_0x33202f(0x15c)),{saveMessage}=require(_0x33202f(0x15f)),{logger}=require('~/config'),AskController=async(_0x5d13c2,_0x4308f2,_0x17973b,_0x439f47,_0x9a703c)=>{const _0x334596=_0x33202f,_0x30b29f={'nXulS':_0x334596(0x141),'vpjII':function(_0x53a44d,_0x39acf6){return _0x53a44d===_0x39acf6;},'qHXjY':_0x334596(0x131),'ehEmD':function(_0x16eaf8,_0x3429bd){return _0x16eaf8===_0x3429bd;},'pFtBJ':_0x334596(0x136),'jbgFL':function(_0x42c881,_0x1d4056){return _0x42c881!==_0x1d4056;},'YaktZ':_0x334596(0x153),'vLciZ':function(_0x5385e5,_0x329785){return _0x5385e5===_0x329785;},'WwuxK':'conversationId','IGdZE':_0x334596(0x151),'ZFzUW':_0x334596(0x15d),'sdWze':function(_0x2d4a76,_0xe24a51,_0x3adf91){return _0x2d4a76(_0xe24a51,_0x3adf91);},'gzsmy':function(_0x8163db,_0x2d86b0){return _0x8163db(_0x2d86b0);},'UWXEu':'close','TROjk':_0x334596(0x122),'hNYGo':_0x334596(0x157),'JaKBK':function(_0x11c629,_0x45237b){return _0x11c629!==_0x45237b;},'ynAhT':function(_0x4adb35,_0x31b4c5,_0x3d4036,_0x38aafb,_0x91f09c){return _0x4adb35(_0x31b4c5,_0x3d4036,_0x38aafb,_0x91f09c);}};let {text:_0x5be8a7,endpointOption:_0x1d013d,conversationId:_0x5dde2e,modelDisplayLabel:_0x4014a4,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x5d13c2['body'];logger['debug'](_0x334596(0x14a),{'text':_0x5be8a7,'conversationId':_0x5dde2e,..._0x1d013d,'modelsConfig':_0x1d013d[_0x334596(0x127)]?_0x334596(0x160):''});let _0x480fe4,_0x3ce18e,_0x57e24c,_0x27b3fc,_0x226d65;const _0x2a1902=getResponseSender({..._0x1d013d,'model':_0x1d013d[_0x334596(0x143)][_0x334596(0x144)],'modelDisplayLabel':_0x4014a4}),_0x5f3f44=!_0x5dde2e,_0x6e24ec=_0x5d13c2[_0x334596(0x13e)]['id'],_0x365435=(_0x561e8e={})=>{const _0x2bca35=_0x334596;for(let _0x52611e in _0x561e8e){if(_0x30b29f[_0x2bca35(0x14d)]===_0x2bca35(0x141)){if(_0x30b29f[_0x2bca35(0x158)](_0x52611e,_0x30b29f['qHXjY']))_0x480fe4=_0x561e8e[_0x52611e],_0x27b3fc=_0x561e8e[_0x52611e][_0x2bca35(0x167)];else{if(_0x30b29f['ehEmD'](_0x52611e,_0x30b29f[_0x2bca35(0x15b)]))_0x3ce18e=_0x561e8e[_0x52611e];else{if(_0x30b29f[_0x2bca35(0x158)](_0x52611e,_0x2bca35(0x123))){if(_0x30b29f[_0x2bca35(0x146)]('NZIMG',_0x2bca35(0x154)))_0x226d65=_0x561e8e[_0x52611e];else return;}else{if(_0x52611e==='promptTokens')_0x30b29f[_0x2bca35(0x162)]==='JRnWr'?_0x448011=_0x2e05a4[_0x5aaa6f]:_0x57e24c=_0x561e8e[_0x52611e];else!_0x5dde2e&&_0x30b29f[_0x2bca35(0x12c)](_0x52611e,_0x30b29f[_0x2bca35(0x13d)])&&(_0x5dde2e=_0x561e8e[_0x52611e]);}}}}else return;}};let _0x3eadc2;try{if(_0x30b29f[_0x334596(0x146)](_0x334596(0x13f),_0x334596(0x132))){const {client:_0x471341}=await _0x439f47({'req':_0x5d13c2,'res':_0x4308f2,'endpointOption':_0x1d013d}),_0x315a06=_0x30b29f[_0x334596(0x147)](getLogStores,CacheKeys[_0x334596(0x125)]),{onProgress:_0x547804,getPartialText:_0xf7fc0}=createOnProgress({'onProgress':throttle(({text:_0x2547bb})=>{const _0x4274fd=_0x334596;_0x315a06[_0x4274fd(0x13c)](_0x226d65,_0x2547bb,Time[_0x4274fd(0x15e)]);},0xbb8,{'trailing':![]})});_0x3eadc2=_0xf7fc0;const _0x239ef6=()=>({'sender':_0x2a1902,'conversationId':_0x5dde2e,'userMessagePromise':_0x3ce18e,'messageId':_0x226d65,'parentMessageId':overrideParentMessageId??_0x27b3fc,'text':_0xf7fc0(),'userMessage':_0x480fe4,'promptTokens':_0x57e24c}),{abortController:_0x1b49c1,onStart:_0xe7fafd}=createAbortController(_0x5d13c2,_0x4308f2,_0x239ef6,_0x365435);_0x4308f2['on'](_0x30b29f['UWXEu'],()=>{const _0x24ee43=_0x334596;logger[_0x24ee43(0x152)](_0x30b29f[_0x24ee43(0x139)]);if(!_0x1b49c1)return;else{if(_0x1b49c1[_0x24ee43(0x14c)][_0x24ee43(0x138)])return;else{if(_0x1b49c1['requestCompleted'])return;}}_0x1b49c1['abort'](),logger[_0x24ee43(0x152)](_0x30b29f[_0x24ee43(0x14e)]);});const _0x4f3149={'user':_0x6e24ec,'parentMessageId':parentMessageId,'conversationId':_0x5dde2e,'overrideParentMessageId':overrideParentMessageId,'getReqData':_0x365435,'onStart':_0xe7fafd,'abortController':_0x1b49c1,'progressCallback':_0x547804,'progressOptions':{'res':_0x4308f2}};let _0x44689e=await _0x471341['sendMessage'](_0x5be8a7,_0x4f3149);_0x44689e[_0x334596(0x142)]=_0x1d013d['endpoint'];const {conversation:conversation={}}=await _0x471341[_0x334596(0x124)];conversation[_0x334596(0x12d)]=conversation&&!conversation[_0x334596(0x12d)]?null:conversation?.[_0x334596(0x12d)]||_0x30b29f[_0x334596(0x155)];_0x471341[_0x334596(0x129)][_0x334596(0x163)]&&(_0x480fe4[_0x334596(0x14b)]=_0x471341[_0x334596(0x129)][_0x334596(0x163)],conversation[_0x334596(0x144)]=_0x1d013d[_0x334596(0x143)][_0x334596(0x144)],delete _0x480fe4[_0x334596(0x133)]);!_0x1b49c1[_0x334596(0x14c)]['aborted']&&(_0x30b29f[_0x334596(0x140)]!=='tWknr'?(sendMessage(_0x4308f2,{'final':!![],'conversation':conversation,'title':conversation[_0x334596(0x12d)],'requestMessage':_0x480fe4,'responseMessage':_0x44689e}),_0x4308f2[_0x334596(0x165)](),await saveMessage(_0x5d13c2,{..._0x44689e,'user':_0x6e24ec},{'context':'api/server/controllers/AskController.js\x20-\x20response\x20end'})):_0x30b29f[_0x334596(0x14f)](_0x45bada,_0x32fb90,{'text':_0x402991,'response':_0x1c7674,'client':_0x3fe917}));!_0x471341[_0x334596(0x159)]&&await saveMessage(_0x5d13c2,_0x480fe4,{'context':_0x334596(0x148)});if(_0x9a703c&&parentMessageId===Constants[_0x334596(0x12b)]&&_0x5f3f44){if(_0x30b29f[_0x334596(0x128)](_0x334596(0x149),'BUPLn')){_0x4f69c6[_0x334596(0x152)]('[AskController]\x20Request\x20closed');if(!_0x3a4f2d)return;else{if(_0x53b2d2[_0x334596(0x14c)][_0x334596(0x138)])return;else{if(_0x8cd65[_0x334596(0x12e)])return;}}_0x43e451[_0x334596(0x134)](),_0x2bcea7[_0x334596(0x152)](_0x30b29f[_0x334596(0x14e)]);}else _0x9a703c(_0x5d13c2,{'text':_0x5be8a7,'response':_0x44689e,'client':_0x471341});}}else _0x46696d=_0x55b6ca[_0x63c56e];}catch(_0x423556){const _0x3eb9d2=_0x3eadc2&&_0x3eadc2();_0x30b29f[_0x334596(0x13b)](handleAbortError,_0x4308f2,_0x5d13c2,_0x423556,{'partialText':_0x3eb9d2,'conversationId':_0x5dde2e,'sender':_0x2a1902,'messageId':_0x226d65,'parentMessageId':_0x27b3fc??parentMessageId});}};function _0x11b6(){const _0x3b75a8=['exists','~/server/utils','YaktZ','attachments','2190824vbMowi','end','~/server/middleware','messageId','New\x20Chat','responseMessageId','responsePromise','MESSAGES','23OVyLTa','modelsConfig','JaKBK','options','231AUUYWQ','NO_PARENT','vLciZ','title','requestCompleted','librechat-data-provider','exports','userMessage','CUdUM','image_urls','abort','4034755OLaswo','userMessagePromise','242538noqkWg','aborted','IGdZE','10736055SdFIPh','ynAhT','set','WwuxK','user','VDDTB','hNYGo','DfSos','endpoint','modelOptions','model','8twafmP','jbgFL','gzsmy','api/server/controllers/AskController.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','BUPLn','[AskController]','files','signal','nXulS','ZFzUW','sdWze','2921052AlpJyJ','[AskController]\x20Request\x20closed','debug','nJOwk','dFhZt','TROjk','134842GTjsEN','FnrpF','vpjII','skipSaveUserMessage','27304930LfHPEa','pFtBJ','~/cache','[AskController]\x20Request\x20aborted\x20on\x20close','FIVE_MINUTES','~/models'];_0x11b6=function(){return _0x3b75a8;};return _0x11b6();}function _0x3250(_0x193dc5,_0x470bd5){const _0x11b6f9=_0x11b6();return _0x3250=function(_0x3250d0,_0x5af2c3){_0x3250d0=_0x3250d0-0x122;let _0x90546c=_0x11b6f9[_0x3250d0];return _0x90546c;},_0x3250(_0x193dc5,_0x470bd5);}module[_0x33202f(0x130)]=AskController;