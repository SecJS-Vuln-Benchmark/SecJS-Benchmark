const _0x517ee0=_0x149d;(function(_0x1e77c6,_0x3dc73d){const _0x5043b3=_0x149d,_0x48ceb9=_0x1e77c6();while(!![]){try{const _0x3ebb93=parseInt(_0x5043b3(0x19a))/0x1+-parseInt(_0x5043b3(0x1d1))/0x2+-parseInt(_0x5043b3(0x1cf))/0x3+parseInt(_0x5043b3(0x1c9))/0x4*(-parseInt(_0x5043b3(0x1a7))/0x5)+-parseInt(_0x5043b3(0x1a8))/0x6+parseInt(_0x5043b3(0x1a3))/0x7+-parseInt(_0x5043b3(0x1c8))/0x8*(-parseInt(_0x5043b3(0x1c3))/0x9);if(_0x3ebb93===_0x3dc73d)break;else _0x48ceb9['push'](_0x48ceb9['shift']());}catch(_0x4887dd){_0x48ceb9['push'](_0x48ceb9['shift']());}}}(_0x3007,0x78c8a));import{Meteor}from'meteor/meteor';import{settings}from'../../settings';import{callbacks}from'../../callbacks';import{isTheLastMessage}from'../../lib';import{getUserAvatarURL}from'../../utils/lib/getUserAvatarURL';function _0x149d(_0x3e9001,_0x4c3808){const _0x300746=_0x3007();return _0x149d=function(_0x149dbe,_0x4b2cb3){_0x149dbe=_0x149dbe-0x189;let _0x2a6eb1=_0x300746[_0x149dbe];return _0x2a6eb1;},_0x149d(_0x3e9001,_0x4c3808);}import{hasPermission}from'../../authorization';import{Subscriptions,Messages,Users,Rooms}from'../../models';const recursiveRemove=(_0x17f0d7,_0x97d93e=0x1)=>{const _0x5adc1e=_0x149d,_0x36bb99={'ABkrj':_0x5adc1e(0x1d2)};if(!_0x17f0d7)return;if(_0x97d93e>settings[_0x5adc1e(0x1ae)](_0x36bb99[_0x5adc1e(0x1c6)]))return delete _0x17f0d7[_0x5adc1e(0x19c)],_0x17f0d7;return _0x17f0d7[_0x5adc1e(0x19c)]=Array['isArray'](_0x17f0d7['attachments'])?_0x17f0d7[_0x5adc1e(0x19c)][_0x5adc1e(0x1b8)](_0x2040fc=>recursiveRemove(_0x2040fc,_0x97d93e+0x1)):null,_0x17f0d7;},shouldAdd=(_0xdb068,_0x106e89)=>!_0xdb068[_0x517ee0(0x18b)](({message_link:_0x2d04bd})=>_0x2d04bd&&_0x2d04bd===_0x106e89[_0x517ee0(0x189)]);Meteor['methods']({'pinMessage'(_0x31f230,_0x5086f){const _0x104f88=_0x517ee0,_0x2dd6be={'RXJZN':function(_0xd426c2,_0xfb3c34,_0x45bf57){return _0xd426c2(_0xfb3c34,_0x45bf57);},'Kgxmy':_0x104f88(0x1a9),'ZuwSG':'pinMessage','MYEoP':_0x104f88(0x1b2),'XuJnU':function(_0x2eb0fe,_0x34c21a){return _0x2eb0fe!==_0x34c21a;},'zJpok':_0x104f88(0x1ac),'MPzWY':'mZsTt','ykzJr':_0x104f88(0x19d),'wHcIp':_0x104f88(0x19b),'EtvGr':_0x104f88(0x1a6),'EdQsA':'message_pinned','NxOGu':function(_0x226774,_0x48253b){return _0x226774(_0x48253b);}},_0x5e1e39=Meteor['userId']();if(!_0x5e1e39)throw new Meteor[(_0x104f88(0x1cb))](_0x104f88(0x18a),_0x104f88(0x1ca),{'method':_0x104f88(0x1c7)});if(!settings[_0x104f88(0x1ae)](_0x104f88(0x1af)))throw new Meteor[(_0x104f88(0x1cb))](_0x2dd6be[_0x104f88(0x19f)],_0x104f88(0x1ce),{'method':_0x2dd6be['ZuwSG'],'action':_0x2dd6be[_0x104f88(0x195)]});if(!hasPermission(Meteor[_0x104f88(0x1aa)](),_0x104f88(0x1cc),_0x31f230[_0x104f88(0x1b3)])){if(_0x2dd6be['XuJnU'](_0x2dd6be[_0x104f88(0x1b9)],_0x2dd6be[_0x104f88(0x1c1)]))throw new Meteor[(_0x104f88(0x1cb))]('not-authorized',_0x2dd6be[_0x104f88(0x193)],{'method':_0x104f88(0x1c7)});else return delete _0x4d4a8a['attachments'],_0x458e86;}const _0x1dc2ba=Subscriptions[_0x104f88(0x18d)](_0x31f230[_0x104f88(0x1b3)],Meteor[_0x104f88(0x1aa)](),{'fields':{'_id':0x1}});if(!_0x1dc2ba)return![];let _0x1b3fc6=Messages[_0x104f88(0x1b6)](_0x31f230[_0x104f88(0x196)]);if(_0x1b3fc6==null||_0x1b3fc6[_0x104f88(0x196)]==null)throw new Meteor['Error'](_0x104f88(0x1a1),'Message\x20you\x20are\x20pinning\x20was\x20not\x20found',{'method':'pinMessage','action':_0x104f88(0x1b2)});const _0x4aabdc=Users[_0x104f88(0x1b6)](_0x5e1e39);settings[_0x104f88(0x1ae)](_0x2dd6be[_0x104f88(0x1be)])&&Messages['cloneAndSaveAsHistoryById'](_0x31f230[_0x104f88(0x196)],_0x4aabdc);const _0x2258d0=Meteor[_0x104f88(0x190)](_0x104f88(0x1a0),_0x31f230[_0x104f88(0x1b3)],Meteor['userId']());_0x1b3fc6[_0x104f88(0x1c2)]=!![],_0x1b3fc6[_0x104f88(0x1a2)]=_0x5086f||Date[_0x104f88(0x19e)],_0x1b3fc6['pinnedBy']={'_id':_0x5e1e39,'username':_0x4aabdc[_0x104f88(0x191)]},_0x1b3fc6=callbacks[_0x104f88(0x1b5)](_0x2dd6be[_0x104f88(0x1ad)],_0x1b3fc6),Messages[_0x104f88(0x1ba)](_0x1b3fc6['_id'],_0x1b3fc6[_0x104f88(0x18f)],_0x1b3fc6['pinned']);isTheLastMessage(_0x2258d0,_0x31f230)&&Rooms[_0x104f88(0x1c0)](_0x2258d0['_id'],_0x1b3fc6[_0x104f88(0x18f)],_0x1b3fc6[_0x104f88(0x1c2)]);const _0x521bc3=[];return Array[_0x104f88(0x1bc)](_0x1b3fc6[_0x104f88(0x19c)])&&_0x1b3fc6[_0x104f88(0x19c)][_0x104f88(0x1bb)](_0x1d4049=>{const _0x42ecdd=_0x104f88;(!_0x1d4049[_0x42ecdd(0x189)]||_0x2dd6be['RXJZN'](shouldAdd,_0x521bc3,_0x1d4049))&&_0x521bc3[_0x42ecdd(0x1cd)](_0x1d4049);}),Messages[_0x104f88(0x197)](_0x2dd6be[_0x104f88(0x1b1)],_0x1b3fc6['rid'],'',_0x4aabdc,{'attachments':[{'text':_0x1b3fc6[_0x104f88(0x1a4)],'author_name':_0x1b3fc6['u'][_0x104f88(0x191)],'author_icon':getUserAvatarURL(_0x1b3fc6['u'][_0x104f88(0x191)]),'ts':_0x1b3fc6['ts'],'attachments':_0x2dd6be[_0x104f88(0x1ab)](recursiveRemove,_0x521bc3)}]});},'unpinMessage'(_0x29d103){const _0x120117=_0x517ee0,_0x457c2b={'eQpkr':'error-invalid-user','EfbJA':_0x120117(0x1ca),'XjlFZ':'Message\x20pinning\x20not\x20allowed','MgTPi':'unpinMessage','ryccG':'Message_pinning','sIuik':function(_0x53cc86,_0x2c25cb,_0x2b29f3,_0x2af3d6){return _0x53cc86(_0x2c25cb,_0x2b29f3,_0x2af3d6);},'rkKlL':_0x120117(0x19d),'VQiLV':_0x120117(0x1c7),'Bpehl':_0x120117(0x1a1),'SvZXy':_0x120117(0x19b),'yqGGU':_0x120117(0x18c),'iBIVO':_0x120117(0x1d0),'JTRdP':_0x120117(0x1a0)};if(!Meteor['userId']())throw new Meteor[(_0x120117(0x1cb))](_0x457c2b[_0x120117(0x1c4)],_0x457c2b[_0x120117(0x1b0)],{'method':'unpinMessage'});if(!settings['get'](_0x120117(0x1af)))throw new Meteor[(_0x120117(0x1cb))](_0x120117(0x1a9),_0x457c2b['XjlFZ'],{'method':_0x457c2b[_0x120117(0x1c5)],'action':_0x457c2b[_0x120117(0x1b7)]});if(!_0x457c2b[_0x120117(0x1b4)](hasPermission,Meteor[_0x120117(0x1aa)](),'pin-message',_0x29d103[_0x120117(0x1b3)]))throw new Meteor['Error'](_0x120117(0x194),_0x457c2b['rkKlL'],{'method':_0x457c2b['VQiLV']});const _0x4ed595=Subscriptions[_0x120117(0x18d)](_0x29d103['rid'],Meteor['userId'](),{'fields':{'_id':0x1}});if(!_0x4ed595)return![];let _0xb3f291=Messages[_0x120117(0x1b6)](_0x29d103[_0x120117(0x196)]);if(_0xb3f291==null||_0xb3f291[_0x120117(0x196)]==null)throw new Meteor[(_0x120117(0x1cb))](_0x457c2b[_0x120117(0x1bf)],_0x120117(0x198),{'method':_0x120117(0x1a5),'action':_0x120117(0x1b2)});const _0x3b2bf6=Users[_0x120117(0x1b6)](Meteor['userId']());settings[_0x120117(0x1ae)](_0x457c2b['SvZXy'])&&(_0x457c2b[_0x120117(0x199)]===_0x457c2b[_0x120117(0x192)]?_0x5db503[_0x120117(0x18e)](_0x2a9f9f[_0x120117(0x196)],_0x457f4b):Messages[_0x120117(0x18e)](_0xb3f291[_0x120117(0x196)],_0x3b2bf6));_0xb3f291['pinned']=![],_0xb3f291[_0x120117(0x18f)]={'_id':Meteor[_0x120117(0x1aa)](),'username':_0x3b2bf6[_0x120117(0x191)]},_0xb3f291=callbacks[_0x120117(0x1b5)](_0x120117(0x1a6),_0xb3f291);const _0x5b5e20=Meteor[_0x120117(0x190)](_0x457c2b[_0x120117(0x1bd)],_0x29d103[_0x120117(0x1b3)],Meteor[_0x120117(0x1aa)]());return isTheLastMessage(_0x5b5e20,_0x29d103)&&Rooms[_0x120117(0x1c0)](_0x5b5e20[_0x120117(0x196)],_0xb3f291['pinnedBy'],_0xb3f291[_0x120117(0x1c2)]),Messages['setPinnedByIdAndUserId'](_0xb3f291['_id'],_0xb3f291[_0x120117(0x18f)],_0xb3f291['pinned']);}});function _0x3007(){const _0x32d85d=['eQpkr','MgTPi','ABkrj','pinMessage','17189360PHenCR','8KiQRWm','Invalid\x20user','Error','pin-message','push','Message\x20pinning\x20not\x20allowed','27012SrwdOG','nrYJv','1279914noZEar','Message_QuoteChainLimit','message_link','error-invalid-user','some','GLGkA','findOneByRoomIdAndUserId','cloneAndSaveAsHistoryById','pinnedBy','call','username','iBIVO','ykzJr','not-authorized','MYEoP','_id','createWithTypeRoomIdMessageAndUser','Message\x20you\x20are\x20unpinning\x20was\x20not\x20found','yqGGU','354315kDoljW','Message_KeepHistory','attachments','Not\x20Authorized','now','Kgxmy','canAccessRoom','error-invalid-message','pinnedAt','365827HWJRhW','msg','unpinMessage','beforeSaveMessage','1415450LxwdSG','5072250EcShnq','error-action-not-allowed','userId','NxOGu','rIMjN','EtvGr','get','Message_AllowPinning','EfbJA','EdQsA','Message_pinning','rid','sIuik','run','findOneById','ryccG','map','zJpok','setPinnedByIdAndUserId','forEach','isArray','JTRdP','wHcIp','Bpehl','setLastMessagePinned','MPzWY','pinned','9cgieUd'];_0x3007=function(){return _0x32d85d;};return _0x3007();}