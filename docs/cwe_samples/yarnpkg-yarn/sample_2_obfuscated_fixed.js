const _0x2c4a7f=_0x5a17;(function(_0x59e0f1,_0x2e6147){const _0x337d0d=_0x5a17,_0x46e56a=_0x59e0f1();while(!![]){try{const _0x2855f1=parseInt(_0x337d0d(0x1d7))/0x1*(-parseInt(_0x337d0d(0x201))/0x2)+-parseInt(_0x337d0d(0x1fd))/0x3*(parseInt(_0x337d0d(0x21b))/0x4)+-parseInt(_0x337d0d(0x1f0))/0x5*(-parseInt(_0x337d0d(0x1e4))/0x6)+parseInt(_0x337d0d(0x1d3))/0x7*(-parseInt(_0x337d0d(0x1fe))/0x8)+parseInt(_0x337d0d(0x1db))/0x9+-parseInt(_0x337d0d(0x1d0))/0xa+parseInt(_0x337d0d(0x1f6))/0xb;if(_0x2855f1===_0x2e6147)break;else _0x46e56a['push'](_0x46e56a['shift']());}catch(_0x2a9f85){_0x46e56a['push'](_0x46e56a['shift']());}}}(_0x4e27,0xc1702));var __rest=this&&this[_0x2c4a7f(0x1d1)]||function(_0x5e0093,_0x49804f){const _0x27eeaf=_0x2c4a7f,_0x318230={'EQzQS':function(_0x213a87,_0x2bc1c0){return _0x213a87<_0x2bc1c0;},'CMCvH':function(_0xb2a532,_0x3b8cd7){return _0xb2a532!=_0x3b8cd7;},'XlMwz':function(_0x5aec4f,_0x441a6e){return _0x5aec4f===_0x441a6e;},'WyjCL':_0x27eeaf(0x1ee),'ZLZeb':function(_0x38e4c5,_0x41116a){return _0x38e4c5<_0x41116a;}};var _0x494129={};for(var _0x55ea72 in _0x5e0093)if(Object[_0x27eeaf(0x1f4)][_0x27eeaf(0x1c7)]['call'](_0x5e0093,_0x55ea72)&&_0x318230[_0x27eeaf(0x1e7)](_0x49804f['indexOf'](_0x55ea72),0x0))_0x494129[_0x55ea72]=_0x5e0093[_0x55ea72];if(_0x318230[_0x27eeaf(0x207)](_0x5e0093,null)&&_0x318230[_0x27eeaf(0x203)](typeof Object[_0x27eeaf(0x1cc)],_0x318230['WyjCL']))for(var _0x1d0fe7=0x0,_0x55ea72=Object[_0x27eeaf(0x1cc)](_0x5e0093);_0x318230['ZLZeb'](_0x1d0fe7,_0x55ea72[_0x27eeaf(0x1e3)]);_0x1d0fe7++){if(_0x49804f[_0x27eeaf(0x1c8)](_0x55ea72[_0x1d0fe7])<0x0&&Object[_0x27eeaf(0x1f4)]['propertyIsEnumerable']['call'](_0x5e0093,_0x55ea72[_0x1d0fe7]))_0x494129[_0x55ea72[_0x1d0fe7]]=_0x5e0093[_0x55ea72[_0x1d0fe7]];}return _0x494129;};import{hashPassword}from'./password.js';import{prisma,HttpError}from'wasp/server';import{sleep}from'wasp/server/utils';import{Prisma}from'@prisma/client';import{throwValidationError}from'./validation.js';function _0x5a17(_0x4098c9,_0x247a8e){const _0x4e27a8=_0x4e27();return _0x5a17=function(_0x5a175e,_0x1e5148){_0x5a175e=_0x5a175e-0x1c6;let _0x1c9496=_0x4e27a8[_0x5a175e];return _0x1c9496;},_0x5a17(_0x4098c9,_0x247a8e);}export const contextWithUserEntity={'entities':{'User':prisma['user']}};export const authConfig={'failureRedirectPath':_0x2c4a7f(0x206),'successRedirectPath':'/'};export function createProviderId(_0x851010,_0x351611){return{'providerName':_0x851010,'providerUserId':normalizeProviderUserId(_0x851010,_0x351611)};}export function normalizeProviderUserId(_0x1abe90,_0x529550){const _0x5d076e=_0x2c4a7f,_0x41e3e8={'KRPhg':_0x5d076e(0x200),'PGVwD':'keycloak'};switch(_0x1abe90){case _0x5d076e(0x1f8):case _0x5d076e(0x1df):return _0x529550[_0x5d076e(0x1e5)]();case _0x5d076e(0x20a):case _0x41e3e8[_0x5d076e(0x1cb)]:case _0x5d076e(0x20f):case _0x41e3e8[_0x5d076e(0x204)]:return _0x529550;default:_0x1abe90;return _0x529550;}}function _0x4e27(){const _0x1bbf14=['hasOwnProperty','indexOf','VuqdN','AHHqK','KRPhg','getOwnPropertySymbols','ubdyI','hashedPassword','qzrVR','6484980KZhPDn','__rest','providerName','9827461NeOnBe','parse','mfUCL','info','466DyMMeE','txmod','Invalid\x20credentials','VdBZf','13145058XSRzVp','oRjEJ','code','findFirst','username','ZaaOL','Kxjrv','propertyIsEnumerable','length','184734FYiAjp','toLowerCase','PrismaClientValidationError','EQzQS','jpjQb','P2003','user\x20with\x20the\x20same\x20identity\x20already\x20exists','IcCUi','cPAna','PrismaClientKnownRequestError','function','Save\x20failed','165hQowmU','RYqPL','authIdentity','entries','prototype','HKrZz','17255601wMDOay','password','email','findUnique','HVbfI','auth','ðŸ\x20This\x20error\x20can\x20happen\x20if\x20you\x20did\x27t\x20run\x20the\x20database\x20migrations.','69YoSHUf','8DiDFrn','ZKdEu','github','5142tpYzwA','ySdQn','XlMwz','PGVwD','oEgSo','/login','CMCvH','oOTsq','vsLFW','google','assign','UEcAE','ðŸ\x20This\x20error\x20can\x20happen\x20if\x20you\x20have\x20some\x20relation\x20on\x20your\x20User\x20entity\x0a\x20\x20\x20but\x20you\x20didn\x27t\x20specify\x20the\x20\x22onDelete\x22\x20behaviour\x20to\x20either\x20\x22Cascade\x22\x20or\x20\x22SetNull\x22.\x0a\x20\x20\x20Read\x20more\x20at:\x20https://www.prisma.io/docs/orm/prisma-schema/data-model/relations/referential-actions','message','discord','there\x20was\x20a\x20database\x20error','FLtjL','deleteMany','stringify','sAUHk','P2021','dmSnc','BWoRV','call','create','error','428NfyxqP','user'];_0x4e27=function(){return _0x1bbf14;};return _0x4e27();}export async function findAuthIdentity(_0x21efa9){const _0x33097d=_0x2c4a7f;return prisma[_0x33097d(0x1f2)]['findUnique']({'where':{'providerName_providerUserId':_0x21efa9}});}export async function updateAuthIdentityProviderData(_0x41b79a,_0x4db24a,_0x2bccad){const _0x5b1081=_0x2c4a7f,_0x37c737=await ensurePasswordIsHashed(_0x2bccad),_0x286513=Object[_0x5b1081(0x20b)](Object[_0x5b1081(0x20b)]({},_0x4db24a),_0x37c737),_0x59def3=await serializeProviderData(_0x286513);return prisma[_0x5b1081(0x1f2)]['update']({'where':{'providerName_providerUserId':_0x41b79a},'data':{'providerData':_0x59def3}});}export async function findAuthWithUserBy(_0x1cf7d9){const _0x1a1df8=_0x2c4a7f,_0x568c51={'obFCn':function(_0x43ca74,_0x9e31a9){return _0x43ca74 in _0x9e31a9;},'mfUCL':_0x1a1df8(0x1ce),'BWoRV':function(_0xad65aa,_0x20a4bf){return _0xad65aa===_0x20a4bf;},'cPAna':function(_0x1868ad,_0x4f9d77){return _0x1868ad!==_0x4f9d77;}},_0x5557b1=await prisma[_0x1a1df8(0x1fb)][_0x1a1df8(0x1de)]({'where':_0x1cf7d9,'include':{'user':!![]}});if(_0x568c51[_0x1a1df8(0x217)](_0x5557b1,null))return null;if(_0x5557b1['user']===null)return _0x568c51[_0x1a1df8(0x1ec)](_0x1a1df8(0x1cd),_0x1a1df8(0x1cd))?_0x568c51['obFCn'](_0x568c51[_0x1a1df8(0x1d5)],_0x4e5c9e):null;return Object[_0x1a1df8(0x20b)](Object[_0x1a1df8(0x20b)]({},_0x5557b1),{'user':_0x5557b1[_0x1a1df8(0x1c6)]});}export async function createUser(_0x51f4fc,_0xf6d9af,_0x1ba4e5){const _0x1399d2=_0x2c4a7f;return prisma[_0x1399d2(0x1c6)][_0x1399d2(0x219)]({'data':Object[_0x1399d2(0x20b)](Object[_0x1399d2(0x20b)]({},_0x1ba4e5!==null&&_0x1ba4e5!==void 0x0?_0x1ba4e5:{}),{'auth':{'create':{'identities':{'create':{'providerName':_0x51f4fc[_0x1399d2(0x1d2)],'providerUserId':_0x51f4fc['providerUserId'],'providerData':_0xf6d9af}}}}}),'include':{'auth':!![]}});}export async function deleteUserByAuthId(_0x2088fd){const _0x5d2e1f=_0x2c4a7f;return prisma['user'][_0x5d2e1f(0x212)]({'where':{'auth':{'id':_0x2088fd}}});}export async function doFakeWork(){const _0x5c815a=_0x2c4a7f,_0x96756f={'FLtjL':function(_0xe7fbf2,_0x20282a){return _0xe7fbf2+_0x20282a;},'JtmxN':function(_0x5a5f69,_0x52a81c){return _0x5a5f69(_0x52a81c);}},_0x2d1357=_0x96756f[_0x5c815a(0x211)](Math['floor'](Math['random']()*0x3e8),0x3e8);return _0x96756f['JtmxN'](sleep,_0x2d1357);}export function rethrowPossibleAuthError(_0x58510d){const _0x255f91=_0x2c4a7f,_0x21de73={'oEgSo':function(_0x25e99e,_0x2151ee){return _0x25e99e<_0x2151ee;},'mgChE':function(_0xa6efa0,_0x45c4a9){return _0xa6efa0!=_0x45c4a9;},'vsLFW':function(_0x28a048,_0x19f2b6){return _0x28a048===_0x19f2b6;},'ZaaOL':'function','RYqPL':function(_0x627fdf,_0x921471){return _0x627fdf<_0x921471;},'HKrZz':function(_0x142b19,_0x2a9765){return _0x142b19 instanceof _0x2a9765;},'VdBZf':'P2002','VuqdN':_0x255f91(0x1ef),'Kxjrv':_0x255f91(0x1dc),'jpjQb':_0x255f91(0x1cf),'oOTsq':_0x255f91(0x210),'odknH':function(_0x19a6c5,_0x59bc00){return _0x19a6c5 instanceof _0x59bc00;},'dmSnc':function(_0xc291fb,_0x59950a){return _0xc291fb===_0x59950a;},'IcCUi':_0x255f91(0x215),'cJVxb':_0x255f91(0x1fc),'ZKdEu':_0x255f91(0x1e9)};if(_0x21de73[_0x255f91(0x1f5)](_0x58510d,Prisma[_0x255f91(0x1ed)])&&_0x58510d[_0x255f91(0x1dd)]===_0x21de73[_0x255f91(0x1da)])throw new HttpError(0x1a6,_0x21de73[_0x255f91(0x1c9)],{'message':_0x255f91(0x1ea)});if(_0x21de73[_0x255f91(0x1f5)](_0x58510d,Prisma[_0x255f91(0x1e6)])){if(_0x21de73[_0x255f91(0x1e1)]!==_0x21de73[_0x255f91(0x1e8)]){console[_0x255f91(0x21a)](_0x58510d);throw new HttpError(0x1a6,_0x255f91(0x1ef),{'message':_0x21de73[_0x255f91(0x208)]});}else{var _0x2e09c3={};for(var _0x243044 in _0x45a551)if(_0x28de79[_0x255f91(0x1f4)]['hasOwnProperty'][_0x255f91(0x218)](_0x2ca323,_0x243044)&&_0x21de73[_0x255f91(0x205)](_0x3287c6[_0x255f91(0x1c8)](_0x243044),0x0))_0x2e09c3[_0x243044]=_0x3885cf[_0x243044];if(_0x21de73['mgChE'](_0x3d706c,null)&&_0x21de73[_0x255f91(0x209)](typeof _0x67d01d['getOwnPropertySymbols'],_0x21de73[_0x255f91(0x1e0)]))for(var _0x385b70=0x0,_0x243044=_0x2db417[_0x255f91(0x1cc)](_0x5f041d);_0x21de73[_0x255f91(0x205)](_0x385b70,_0x243044[_0x255f91(0x1e3)]);_0x385b70++){if(_0x21de73[_0x255f91(0x1f1)](_0xfa1bf7[_0x255f91(0x1c8)](_0x243044[_0x385b70]),0x0)&&_0xb482cd[_0x255f91(0x1f4)][_0x255f91(0x1e2)][_0x255f91(0x218)](_0x51da5b,_0x243044[_0x385b70]))_0x2e09c3[_0x243044[_0x385b70]]=_0x1d5bc6[_0x243044[_0x385b70]];}return _0x2e09c3;}}if(_0x21de73['odknH'](_0x58510d,Prisma[_0x255f91(0x1ed)])&&_0x21de73[_0x255f91(0x216)](_0x58510d[_0x255f91(0x1dd)],_0x21de73[_0x255f91(0x1eb)])){console[_0x255f91(0x21a)](_0x58510d),console[_0x255f91(0x1d6)](_0x21de73['cJVxb']);throw new HttpError(0x1f4,_0x21de73[_0x255f91(0x1c9)],{'message':_0x255f91(0x210)});}if(_0x58510d instanceof Prisma[_0x255f91(0x1ed)]&&_0x58510d[_0x255f91(0x1dd)]===_0x21de73[_0x255f91(0x1ff)]){console['error'](_0x58510d),console[_0x255f91(0x1d6)](_0x255f91(0x20d));throw new HttpError(0x1f4,'Save\x20failed',{'message':_0x255f91(0x210)});}throw _0x58510d;}export async function validateAndGetUserFields(_0x5db07a,_0x27c662){const _0x1610df=_0x2c4a7f,_0x32548a={'ySdQn':function(_0x422808,_0x231e33){return _0x422808(_0x231e33);}},{password:_0x48eb53}=_0x5db07a,_0x66530c=__rest(_0x5db07a,[_0x1610df(0x1f7)]),_0x158116={};if(!_0x27c662)return _0x158116;for(const [_0x291c60,_0x15b294]of Object[_0x1610df(0x1f3)](_0x27c662)){try{const _0x349d7d=await _0x32548a[_0x1610df(0x202)](_0x15b294,_0x66530c);_0x158116[_0x291c60]=_0x349d7d;}catch(_0x4c7053){throwValidationError(_0x4c7053[_0x1610df(0x20e)]);}}return _0x158116;}export function getProviderData(_0x16632b){return sanitizeProviderData(getProviderDataWithPassword(_0x16632b));}export function getProviderDataWithPassword(_0xb497cc){const _0x12a4c9=_0x2c4a7f;return JSON[_0x12a4c9(0x1d4)](_0xb497cc);}function sanitizeProviderData(_0x56af06){const _0x598b31=_0x2c4a7f,_0x2e737f={'WGjmk':function(_0xe95409,_0xf2fad4){return _0xe95409(_0xf2fad4);},'YNIzG':_0x598b31(0x1ce)};if(_0x2e737f['WGjmk'](providerDataHasPasswordField,_0x56af06)){const {hashedPassword:_0x40ab33}=_0x56af06,_0x55db16=__rest(_0x56af06,[_0x2e737f['YNIzG']]);return _0x55db16;}else return _0x56af06;}export async function sanitizeAndSerializeProviderData(_0x317c7f){const _0x179a9c=_0x2c4a7f,_0x4cb1b7={'AHHqK':function(_0x36d81f,_0x1cff11){return _0x36d81f(_0x1cff11);}};return serializeProviderData(await _0x4cb1b7[_0x179a9c(0x1ca)](ensurePasswordIsHashed,_0x317c7f));}function serializeProviderData(_0x1d1225){const _0x1551b1=_0x2c4a7f;return JSON[_0x1551b1(0x213)](_0x1d1225);}async function ensurePasswordIsHashed(_0x2815ad){const _0x274134=_0x2c4a7f,_0x3e37d8={'HVbfI':_0x274134(0x20c),'txmod':function(_0x45ff56,_0x2bc944){return _0x45ff56(_0x2bc944);}},_0x37624f=Object[_0x274134(0x20b)]({},_0x2815ad);if(providerDataHasPasswordField(_0x37624f)){if(_0x274134(0x214)===_0x3e37d8[_0x274134(0x1fa)])return _0x52ffeb['authIdentity'][_0x274134(0x1f9)]({'where':{'providerName_providerUserId':_0x3760fe}});else _0x37624f['hashedPassword']=await _0x3e37d8[_0x274134(0x1d8)](hashPassword,_0x37624f[_0x274134(0x1ce)]);}return _0x37624f;}function providerDataHasPasswordField(_0x438c63){const _0x36c388=_0x2c4a7f;return _0x36c388(0x1ce)in _0x438c63;}export function createInvalidCredentialsError(_0x21855f){const _0xf44737=_0x2c4a7f;return new HttpError(0x191,_0xf44737(0x1d9),{'message':_0x21855f});}