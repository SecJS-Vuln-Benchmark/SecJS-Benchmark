const _0x34aabb=_0x28a0;(function(_0x55fdca,_0x1d0fc9){const _0x27420f=_0x28a0,_0x547ee9=_0x55fdca();while(!![]){try{const _0x2c8b77=parseInt(_0x27420f(0x1d6))/0x1*(-parseInt(_0x27420f(0x1b0))/0x2)+-parseInt(_0x27420f(0x1b7))/0x3+-parseInt(_0x27420f(0x1a9))/0x4*(-parseInt(_0x27420f(0x1d4))/0x5)+parseInt(_0x27420f(0x1be))/0x6*(-parseInt(_0x27420f(0x1ab))/0x7)+parseInt(_0x27420f(0x1bf))/0x8+-parseInt(_0x27420f(0x19e))/0x9+-parseInt(_0x27420f(0x19b))/0xa*(-parseInt(_0x27420f(0x1cd))/0xb);if(_0x2c8b77===_0x1d0fc9)break;else _0x547ee9['push'](_0x547ee9['shift']());}catch(_0x58e525){_0x547ee9['push'](_0x547ee9['shift']());}}}(_0x73b5,0x43ca6));import{Meteor}from'meteor/meteor';function _0x28a0(_0x272d9d,_0x4b3e76){const _0x73b54e=_0x73b5();return _0x28a0=function(_0x28a0b4,_0x34a62f){_0x28a0b4=_0x28a0b4-0x193;let _0x2c7ee0=_0x73b54e[_0x28a0b4];return _0x2c7ee0;},_0x28a0(_0x272d9d,_0x4b3e76);}import _0x129dad from'underscore';import _0x3e652d from'underscore.string';import _0xf6ba9c from'limax';import{hasPermission}from'../../../authorization';import{EmojiCustom}from'../../../models';function _0x73b5(){const _0x2505d8=['concat','VsmTG','createWriteStream','9676xoNazU','\x20is\x20not\x20a\x20valid\x20name','17486hAqMdY','\x20is\x20not\x20a\x20valid\x20alias\x20set','jSWjn','The\x20field\x20Name\x20is\x20required','userId','2CItpUa','KoiQD','create','_id','fetch','deleteFile','The\x20custom\x20emoji\x20or\x20one\x20of\x20its\x20aliases\x20is\x20already\x20in\x20use','458025ChDppD','previousName','sjQli','length','emoji.updateCustom','previousExtension','WdQuX','1050nIFGOr','2918832ntvSUi','extension','yheLJ','setName','0|1|2|4|3','UDQuB','manage-emoji','findByNameOrAliasExceptID','Error','test','TpzXE','replace','setAliases','1|3|4|0|2','397738KqDorC','iDFhl','DuzVC','broadcast','end','readStream','insertOrUpdateEmoji','805oWyHDd','newFile','503101BSYtnk','getFileWithReadStream','setExtension','filter','error-input-is-not-a-valid-field','oFlTS','trim','kFcVI','ZwBjt','aliases','rsXPc','bindEnvironment','bgGSO','name','AZFqt','not_authorized','Alias_Set','280XKBuHF','mYtPr','contentType','3565269uAzkqv','methods','split','yPSdI','Name','without','findByNameOrAlias','lqkPQ'];_0x73b5=function(){return _0x2505d8;};return _0x73b5();}import{RocketChatFileEmojiCustomInstance}from'../startup/emoji-custom';import{api}from'../../../../server/sdk/api';Meteor[_0x34aabb(0x19f)]({'insertOrUpdateEmoji'(_0x17abfc){const _0x8653b7=_0x34aabb,_0x527a4e={'iDFhl':function(_0xa50b2a,_0x4ad24f){return _0xa50b2a(_0x4ad24f);},'jSWjn':'end','kFcVI':function(_0x5bafe1,_0x1ea8fd){return _0x5bafe1(_0x1ea8fd);},'TpzXE':function(_0x447062,_0x46e341){return _0x447062(_0x46e341);},'ZwBjt':_0x8653b7(0x1d3),'kYzkI':_0x8653b7(0x199),'UDQuB':'error-the-field-is-required','yPSdI':_0x8653b7(0x1ae),'mYtPr':function(_0x2902f2,_0x1e1a5e,_0x4792d5){return _0x2902f2(_0x1e1a5e,_0x4792d5);},'bgGSO':'DuzVC','BAIYF':_0x8653b7(0x19a),'BRVeW':_0x8653b7(0x1a5),'WdQuX':_0x8653b7(0x1b6),'AZFqt':_0x8653b7(0x1bb),'pqTfg':function(_0x5c44de,_0x27e0f6){return _0x5c44de(_0x27e0f6);},'jVvKx':function(_0x231724,_0x16f1ce){return _0x231724!==_0x16f1ce;},'sjQli':function(_0x745dc7,_0x534ebd){return _0x745dc7===_0x534ebd;},'yheLJ':_0x8653b7(0x1a7),'rsXPc':function(_0xaa05d2,_0xcfeaaa){return _0xaa05d2(_0xcfeaaa);},'ZkXrT':_0x8653b7(0x1b1)};if(!hasPermission(this[_0x8653b7(0x1af)],_0x8653b7(0x1c5)))throw new Meteor[(_0x8653b7(0x1c7))](_0x527a4e['kYzkI']);if(!_0x3e652d[_0x8653b7(0x1dc)](_0x17abfc['name']))throw new Meteor[(_0x8653b7(0x1c7))](_0x527a4e[_0x8653b7(0x1c4)],_0x527a4e[_0x8653b7(0x1a1)],{'method':_0x8653b7(0x1d3),'field':_0x8653b7(0x1a2)});_0x17abfc['name']=_0x527a4e[_0x8653b7(0x19c)](_0xf6ba9c,_0x17abfc[_0x8653b7(0x197)],{'replacement':'_'}),_0x17abfc[_0x8653b7(0x193)]=_0x527a4e[_0x8653b7(0x19c)](_0xf6ba9c,_0x17abfc[_0x8653b7(0x193)],{'replacement':'_'});const _0x44df42=/[\s,:><&"'\/\\\(\)]/,_0x3af573=/[:><&\|"'\/\\\(\)]/;_0x17abfc[_0x8653b7(0x197)]=_0x17abfc['name']['replace'](/:/g,''),_0x17abfc[_0x8653b7(0x193)]=_0x17abfc[_0x8653b7(0x193)][_0x8653b7(0x1ca)](/:/g,'');if(_0x44df42[_0x8653b7(0x1c8)](_0x17abfc[_0x8653b7(0x197)])){if(_0x8653b7(0x1cf)!==_0x527a4e[_0x8653b7(0x196)]){const _0x749788=_0x24f321[_0x8653b7(0x1d7)](_0x414516(_0x7b1160[_0x8653b7(0x1b8)]+'.'+_0x41a9b0['previousExtension']));if(_0x749788!==null){_0x2e788e['deleteFile'](_0x527a4e['iDFhl'](_0x37d1b8,_0x33def2['name']+'.'+_0x1992bf[_0x8653b7(0x1c0)]));const _0x3e96a4=_0x34cf57['createWriteStream'](_0x527a4e[_0x8653b7(0x1ce)](_0xf06483,_0x42f6b5[_0x8653b7(0x197)]+'.'+_0x29beb2['previousExtension']),_0x749788[_0x8653b7(0x19d)]);_0x3e96a4['on'](_0x527a4e[_0x8653b7(0x1ad)],_0xfc06b5[_0x8653b7(0x195)](()=>_0x260828[_0x8653b7(0x1b5)](_0x11f620(_0x24e72d[_0x8653b7(0x1b8)]+'.'+_0x568e46[_0x8653b7(0x1bc)])))),_0x749788[_0x8653b7(0x1d2)]['pipe'](_0x3e96a4);}}else throw new Meteor['Error'](_0x8653b7(0x1da),_0x17abfc[_0x8653b7(0x197)]+_0x8653b7(0x1aa),{'method':_0x527a4e[_0x8653b7(0x1de)],'input':_0x17abfc['name'],'field':_0x8653b7(0x1a2)});}if(_0x17abfc['aliases']){if(_0x3af573[_0x8653b7(0x1c8)](_0x17abfc[_0x8653b7(0x193)]))throw new Meteor[(_0x8653b7(0x1c7))](_0x8653b7(0x1da),_0x17abfc[_0x8653b7(0x193)]+_0x8653b7(0x1ac),{'method':_0x8653b7(0x1d3),'input':_0x17abfc[_0x8653b7(0x193)],'field':_0x527a4e['BAIYF']});_0x17abfc['aliases']=_0x17abfc['aliases'][_0x8653b7(0x1a0)](/[\s,]/),_0x17abfc['aliases']=_0x17abfc[_0x8653b7(0x193)][_0x8653b7(0x1d9)](Boolean),_0x17abfc[_0x8653b7(0x193)]=_0x129dad[_0x8653b7(0x1a3)](_0x17abfc[_0x8653b7(0x193)],_0x17abfc[_0x8653b7(0x197)]);}else _0x17abfc[_0x8653b7(0x193)]=[];let _0x31582d=[];if(_0x17abfc[_0x8653b7(0x1b3)]){_0x31582d=EmojiCustom[_0x8653b7(0x1c6)](_0x17abfc[_0x8653b7(0x197)],_0x17abfc[_0x8653b7(0x1b3)])['fetch']();for(const _0x1d67dd of _0x17abfc['aliases']){if(_0x8653b7(0x1a5)===_0x527a4e['BRVeW'])_0x31582d=_0x31582d['concat'](EmojiCustom[_0x8653b7(0x1c6)](_0x1d67dd,_0x17abfc[_0x8653b7(0x1b3)])[_0x8653b7(0x1b4)]());else{const _0x39058d=_0x8653b7(0x1cc)[_0x8653b7(0x1a0)]('|');let _0xb5eb60=0x0;while(!![]){switch(_0x39058d[_0xb5eb60++]){case'0':_0x46a5a1[_0x8653b7(0x1b5)](_0x527a4e[_0x8653b7(0x1ce)](_0x3ce8fa,_0x1e4a2a['previousName']+'.'+_0x4cc02a[_0x8653b7(0x1bc)]));continue;case'1':_0x233ce2[_0x8653b7(0x1b5)](_0x527a4e['kFcVI'](_0xe7fec7,_0x1959dd[_0x8653b7(0x197)]+'.'+_0x4ba0e9['extension']));continue;case'2':_0x310d80[_0x8653b7(0x1d8)](_0x57368c['_id'],_0x5423c3['extension']);continue;case'3':_0x137695['deleteFile'](_0x527a4e['TpzXE'](_0x51a9b3,_0x5440bd['name']+'.'+_0x516b82[_0x8653b7(0x1bc)]));continue;case'4':_0x56b48d[_0x8653b7(0x1b5)](_0x527a4e[_0x8653b7(0x1ce)](_0x59fda0,_0x3b651e[_0x8653b7(0x1b8)]+'.'+_0x245474[_0x8653b7(0x1c0)]));continue;}break;}}}}else{_0x31582d=EmojiCustom[_0x8653b7(0x1a4)](_0x17abfc['name'])['fetch']();for(const _0x25ed0e of _0x17abfc[_0x8653b7(0x193)]){_0x31582d=_0x31582d[_0x8653b7(0x1a6)](EmojiCustom[_0x8653b7(0x1a4)](_0x25ed0e)[_0x8653b7(0x1b4)]());}}if(_0x31582d[_0x8653b7(0x1ba)]>0x0)throw new Meteor['Error']('Custom_Emoji_Error_Name_Or_Alias_Already_In_Use',_0x527a4e[_0x8653b7(0x1bd)],{'method':_0x527a4e[_0x8653b7(0x1de)]});if(!_0x17abfc[_0x8653b7(0x1b3)]){const _0x306688={'name':_0x17abfc[_0x8653b7(0x197)],'aliases':_0x17abfc['aliases'],'extension':_0x17abfc[_0x8653b7(0x1c0)]},_0x4fd993=EmojiCustom[_0x8653b7(0x1b2)](_0x306688);return api['broadcast'](_0x527a4e['AZFqt'],_0x306688),_0x4fd993;}if(_0x17abfc[_0x8653b7(0x1d5)]){const _0x12fc57=_0x8653b7(0x1c3)[_0x8653b7(0x1a0)]('|');let _0x138c01=0x0;while(!![]){switch(_0x12fc57[_0x138c01++]){case'0':RocketChatFileEmojiCustomInstance[_0x8653b7(0x1b5)](encodeURIComponent(_0x17abfc[_0x8653b7(0x197)]+'.'+_0x17abfc['extension']));continue;case'1':RocketChatFileEmojiCustomInstance[_0x8653b7(0x1b5)](_0x527a4e['pqTfg'](encodeURIComponent,_0x17abfc[_0x8653b7(0x197)]+'.'+_0x17abfc[_0x8653b7(0x1bc)]));continue;case'2':RocketChatFileEmojiCustomInstance['deleteFile'](_0x527a4e[_0x8653b7(0x1dd)](encodeURIComponent,_0x17abfc[_0x8653b7(0x1b8)]+'.'+_0x17abfc[_0x8653b7(0x1c0)]));continue;case'3':EmojiCustom[_0x8653b7(0x1d8)](_0x17abfc[_0x8653b7(0x1b3)],_0x17abfc[_0x8653b7(0x1c0)]);continue;case'4':RocketChatFileEmojiCustomInstance['deleteFile'](_0x527a4e[_0x8653b7(0x1ce)](encodeURIComponent,_0x17abfc['previousName']+'.'+_0x17abfc[_0x8653b7(0x1bc)]));continue;}break;}}else{if(_0x527a4e['jVvKx'](_0x17abfc['name'],_0x17abfc[_0x8653b7(0x1b8)])){if(_0x527a4e[_0x8653b7(0x1b9)]('VsmTG',_0x527a4e[_0x8653b7(0x1c1)])){const _0x187464=RocketChatFileEmojiCustomInstance[_0x8653b7(0x1d7)](encodeURIComponent(_0x17abfc[_0x8653b7(0x1b8)]+'.'+_0x17abfc[_0x8653b7(0x1bc)]));if(_0x187464!==null){RocketChatFileEmojiCustomInstance['deleteFile'](_0x527a4e[_0x8653b7(0x1c9)](encodeURIComponent,_0x17abfc[_0x8653b7(0x197)]+'.'+_0x17abfc[_0x8653b7(0x1c0)]));const _0x25c318=RocketChatFileEmojiCustomInstance[_0x8653b7(0x1a8)](_0x527a4e[_0x8653b7(0x194)](encodeURIComponent,_0x17abfc['name']+'.'+_0x17abfc[_0x8653b7(0x1bc)]),_0x187464[_0x8653b7(0x19d)]);_0x25c318['on'](_0x8653b7(0x1d1),Meteor[_0x8653b7(0x195)](()=>RocketChatFileEmojiCustomInstance[_0x8653b7(0x1b5)](encodeURIComponent(_0x17abfc[_0x8653b7(0x1b8)]+'.'+_0x17abfc[_0x8653b7(0x1bc)])))),_0x187464[_0x8653b7(0x1d2)]['pipe'](_0x25c318);}}else _0x2375ad=_0x24bd05['concat'](_0x500313['findByNameOrAlias'](_0x6892f0)[_0x8653b7(0x1b4)]());}}_0x17abfc['name']!==_0x17abfc['previousName']&&EmojiCustom[_0x8653b7(0x1c2)](_0x17abfc['_id'],_0x17abfc[_0x8653b7(0x197)]);if(_0x17abfc[_0x8653b7(0x193)]){if(_0x8653b7(0x1db)!==_0x8653b7(0x1db))throw new _0x237ba7[(_0x8653b7(0x1c7))](_0x8653b7(0x1da),_0x3e036d[_0x8653b7(0x197)]+_0x8653b7(0x1aa),{'method':_0x527a4e[_0x8653b7(0x1de)],'input':_0x5d57af[_0x8653b7(0x197)],'field':_0x8653b7(0x1a2)});else EmojiCustom['setAliases'](_0x17abfc['_id'],_0x17abfc[_0x8653b7(0x193)]);}else{if(_0x527a4e['ZkXrT']===_0x8653b7(0x1b1))EmojiCustom[_0x8653b7(0x1cb)](_0x17abfc[_0x8653b7(0x1b3)],[]);else{_0x1e2df9=_0x7b9ece[_0x8653b7(0x1a4)](_0x36ead8[_0x8653b7(0x197)])['fetch']();for(const _0x3581c8 of _0x4f20f9[_0x8653b7(0x193)]){_0x193cb7=_0x3be9e7[_0x8653b7(0x1a6)](_0x24791d[_0x8653b7(0x1a4)](_0x3581c8)[_0x8653b7(0x1b4)]());}}}return api[_0x8653b7(0x1d0)](_0x527a4e[_0x8653b7(0x198)],_0x17abfc),!![];}});