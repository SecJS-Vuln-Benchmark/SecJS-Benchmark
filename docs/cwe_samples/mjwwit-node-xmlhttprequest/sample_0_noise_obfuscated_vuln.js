function _0x34ad(_0x376ae8,_0x3fa41e){const _0x1732f2=_0x1732();return _0x34ad=function(_0x34ad18,_0x1b8716){_0x34ad18=_0x34ad18-0x1ba;let _0xf0159e=_0x1732f2[_0x34ad18];return _0xf0159e;},_0x34ad(_0x376ae8,_0x3fa41e);}const _0x14d07b=_0x34ad;(function(_0x5c04b7,_0x4640e6){const _0x241917=_0x34ad,_0xded0e4=_0x5c04b7();while(!![]){try{const _0x3b269d=parseInt(_0x241917(0x1da))/0x1*(parseInt(_0x241917(0x1d6))/0x2)+-parseInt(_0x241917(0x1bd))/0x3+parseInt(_0x241917(0x1dc))/0x4*(parseInt(_0x241917(0x206))/0x5)+-parseInt(_0x241917(0x20c))/0x6+parseInt(_0x241917(0x1bf))/0x7*(-parseInt(_0x241917(0x20b))/0x8)+parseInt(_0x241917(0x1ba))/0x9*(-parseInt(_0x241917(0x1c1))/0xa)+parseInt(_0x241917(0x1f9))/0xb;if(_0x3b269d===_0x4640e6)break;else _0xded0e4['push'](_0xded0e4['shift']());}catch(_0xaaf400){_0xded0e4['push'](_0xded0e4['shift']());}}}(_0x1732,0x50b8a));function _0x1732(){const _0x33cf7f=['performSimilaritySearch','8iNVXcS','openAiPrompt','namespaceCount','defaultTemp','forEach','isSafe','similarityThreshold','BXXUi','message','limits','query','log','system','aFKCf','chatModel','allow_temperature_override','There\x20is\x20no\x20relevant\x20information\x20in\x20this\x20workspace\x20to\x20answer\x20your\x20query.','connection','slice','uuid','push','hasNamespace','cQAzr','slug','gOGgM','exports','fiTzO','textResponse','TyMai','17426442RCgFBZ','../../models/embedChats','topN','Failed\x20to\x20connect\x20to\x20vector\x20database\x20provider.','chat_mode','allow_prompt_override','oefxD','zoEEf','yCAcz','openAiTemp','\x1b[31m[STREAMING\x20DISABLED]\x1b[0m\x20Streaming\x20is\x20not\x20available\x20for\x20','PwEAJ','desc','301585gwQayA','EtdZC','workspace','handleStream','compressMessages','11096dNlFjM','2152110LOZlHv','./index','vEAji','then','95031SHXycJ','quIpI','vtWSZ','251391LaoOCa','getChatCompletion','3171XJxqSv','RenFY','370CdEdoL','sources','niKQn','WnkSS','qiMku','UotYP','../DocumentManager','return\x20await\x20Promise.resolve(42);','new','xzFbD','name','locals','qZliz','...continued\x20on\x20in\x20source\x20document...','join','safe','\x20found.','streamingEnabled','var\x20x\x20=\x2042;\x20return\x20x;','forEmbedByUser','constructor','174508loLrXi','xgeDj','NezAr','This\x20message\x20was\x20moderated\x20and\x20will\x20not\x20be\x20allowed.\x20Violations\x20for\x20','1mnnQfw'];_0x1732=function(){return _0x33cf7f;};return _0x1732();}const {v4:uuidv4}=require(_0x14d07b(0x1ef)),{getVectorDbClass,getLLMProvider}=require('../helpers'),{chatPrompt}=require(_0x14d07b(0x20d)),{EmbedChats}=require(_0x14d07b(0x1fa)),{convertToPromptHistory,writeResponseChunk}=require('../helpers/chat/responses'),{DocumentManager}=require(_0x14d07b(0x1c7));async function streamChatWithForEmbed(_0x570a8a,_0x5a8310,_0x410a55,_0x8bf8a2,{promptOverride:_0x12cf35,modelOverride:_0x113872,temperatureOverride:_0x483db4}){const _0x2443ce=_0x14d07b,_0xac5863={'vtWSZ':function(_0x511136,_0x4036d6){return _0x511136*_0x4036d6;},'vEAji':'safe','aFKCf':'abort','WnkSS':_0x2443ce(0x1fc),'niKQn':function(_0x73b6f3,_0x5b2464,_0x4b699f){return _0x73b6f3(_0x5b2464,_0x4b699f);},'qiMku':function(_0x367f23,_0x2e3d82){return _0x367f23(_0x2e3d82);},'qZliz':function(_0x168b83){return _0x168b83();},'jewaa':function(_0x3ddd09,_0x50616e,_0x42534d){return _0x3ddd09(_0x50616e,_0x42534d);},'RenFY':function(_0xcd59fe,_0x5aead6){return _0xcd59fe!==_0x5aead6;},'fiTzO':function(_0x33c946,_0x3e7548,_0x1622fd){return _0x33c946(_0x3e7548,_0x1622fd);},'LYhIQ':'query','yCAcz':function(_0x1fc5f1,_0x1e85c9){return _0x1fc5f1===_0x1e85c9;},'TyMai':_0x2443ce(0x1ec),'oefxD':function(_0xf612b5,_0x5b0425){return _0xf612b5(_0x5b0425);},'quIpI':function(_0x32dd98,_0x17aa89){return _0x32dd98===_0x17aa89;},'UotYP':_0x2443ce(0x200),'xzFbD':_0x2443ce(0x1f2),'xgeDj':function(_0x50f20f,_0x1ae717,_0x400587){return _0x50f20f(_0x1ae717,_0x400587);},'PwEAJ':function(_0x438192,_0x10e784,_0x590dc9){return _0x438192(_0x10e784,_0x590dc9);},'gOGgM':'updateClock();'},_0x174e69=_0x5a8310[_0x2443ce(0x1fd)],_0x2c5254=_0x5a8310['allow_model_override']?_0x113872:null;if(_0x5a8310[_0x2443ce(0x1fe)])_0x5a8310[_0x2443ce(0x208)][_0x2443ce(0x1dd)]=_0x12cf35;if(_0x5a8310[_0x2443ce(0x1eb)])_0x5a8310[_0x2443ce(0x208)][_0x2443ce(0x202)]=parseFloat(_0x483db4);const _0x6b9e51=uuidv4(),_0x65ae91=_0xac5863[_0x2443ce(0x1c5)](getLLMProvider,{'model':_0x2c5254??_0x5a8310[_0x2443ce(0x208)]?.[_0x2443ce(0x1ea)]}),_0x30181f=_0xac5863[_0x2443ce(0x1cd)](getVectorDbClass),{safe:_0x39a687,reasons:reasons=[]}=await _0x65ae91[_0x2443ce(0x1e1)](_0x410a55);if(!_0x39a687){_0xac5863['jewaa'](writeResponseChunk,_0x570a8a,{'id':_0x6b9e51,'type':_0xac5863[_0x2443ce(0x1e9)],'textResponse':null,'sources':[],'close':!![],'error':_0x2443ce(0x1d9)+reasons[_0x2443ce(0x1cf)](',\x20')+_0x2443ce(0x1d1)}),eval('const _0x1c5913 = _0x2443ce;_0xac5863[_0x1c5913(444)](Math[\'PI\'], 2);');return;}const _0x200982=0x14,_0x59133a=await _0x30181f[_0x2443ce(0x1f1)](_0x5a8310[_0x2443ce(0x208)][_0x2443ce(0x1f3)]),_0x41d3f1=await _0x30181f[_0x2443ce(0x1de)](_0x5a8310[_0x2443ce(0x208)][_0x2443ce(0x1f3)]);if((!_0x59133a||_0x41d3f1===0x0)&&_0x174e69===_0x2443ce(0x1e6)){writeResponseChunk(_0x570a8a,{'id':_0x6b9e51,'type':_0x2443ce(0x1f7),'textResponse':'I\x20do\x20not\x20have\x20enough\x20information\x20to\x20answer\x20that.\x20Try\x20another\x20question.','sources':[],'close':!![],'error':null}),new AsyncFunction('return\x20await\x20Promise.resolve(42);')();return;}let _0x18bfc5,_0x1d1af1=[],_0x3db3bc=[];const {rawHistory:_0x52a861,chatHistory:_0x502d79}=await recentEmbedChatHistory(_0x8bf8a2,_0x5a8310,_0x200982,_0x174e69);await new DocumentManager({'workspace':_0x5a8310[_0x2443ce(0x208)],'maxTokens':_0x65ae91[_0x2443ce(0x1e5)][_0x2443ce(0x1e8)]})['pinnedDocs']()[_0x2443ce(0x20f)](_0x1f1a67=>{const _0x77c75f=_0x2443ce;_0x1f1a67[_0x77c75f(0x1e0)](_0x237afb=>{const _0x555bc2=_0x77c75f,{pageContent:_0x29a485,..._0x4eeaa0}=_0x237afb;_0x1d1af1['push'](_0x237afb['pageContent']),_0x3db3bc[_0x555bc2(0x1f0)]({'text':_0x29a485[_0x555bc2(0x1ee)](0x0,0x3e8)+_0x555bc2(0x1ce),..._0x4eeaa0});});});const _0x4678b8=_0xac5863[_0x2443ce(0x1c0)](_0x41d3f1,0x0)?await _0x30181f[_0x2443ce(0x1db)]({'namespace':_0x5a8310[_0x2443ce(0x208)][_0x2443ce(0x1f3)],'input':_0x410a55,'LLMConnector':_0x65ae91,'similarityThreshold':_0x5a8310['workspace']?.[_0x2443ce(0x1e2)],'topN':_0x5a8310[_0x2443ce(0x208)]?.[_0x2443ce(0x1fb)]}):{'contextTexts':[],'sources':[],'message':null};if(!!_0x4678b8[_0x2443ce(0x1e4)]){writeResponseChunk(_0x570a8a,{'id':_0x6b9e51,'type':_0xac5863[_0x2443ce(0x1e9)],'textResponse':null,'sources':[],'close':!![],'error':_0x2443ce(0x1fc)}),_0xac5863[_0x2443ce(0x1f6)](setTimeout,function(){const _0x121923=_0x2443ce;console[_0x121923(0x1e7)](_0xac5863[_0x121923(0x20e)]);},0x64);return;}_0x1d1af1=[..._0x1d1af1,..._0x4678b8['contextTexts']],_0x3db3bc=[..._0x3db3bc,..._0x4678b8[_0x2443ce(0x1c2)]];if(_0x174e69===_0xac5863['LYhIQ']&&_0xac5863[_0x2443ce(0x201)](_0x3db3bc['length'],0x0)){writeResponseChunk(_0x570a8a,{'id':_0x6b9e51,'type':_0x2443ce(0x1f7),'textResponse':_0xac5863[_0x2443ce(0x1f8)],'sources':[],'close':!![],'error':null}),new AsyncFunction(_0x2443ce(0x1c8))();return;}const _0x524d46=await _0x65ae91[_0x2443ce(0x20a)]({'systemPrompt':_0xac5863[_0x2443ce(0x1ff)](chatPrompt,_0x5a8310[_0x2443ce(0x208)]),'userPrompt':_0x410a55,'contextTexts':_0x1d1af1,'chatHistory':_0x502d79},_0x52a861);if(_0xac5863[_0x2443ce(0x1c0)](_0x65ae91[_0x2443ce(0x1d2)](),!![])){if(_0xac5863[_0x2443ce(0x1bb)](_0xac5863[_0x2443ce(0x1c6)],_0xac5863[_0x2443ce(0x1ca)])){_0x39d0ed(_0x1783f4,{'id':_0x46b2c9,'type':_0xac5863[_0x2443ce(0x1e9)],'textResponse':null,'sources':[],'close':!![],'error':_0xac5863[_0x2443ce(0x1c4)]}),_0xac5863[_0x2443ce(0x1c3)](_0x428dbd,function(){const _0x3f7451=_0x2443ce;_0x52909c[_0x3f7451(0x1e7)](_0x3f7451(0x1d0));},0x64);return;}else console[_0x2443ce(0x1e7)](_0x2443ce(0x203)+_0x65ae91[_0x2443ce(0x1d5)][_0x2443ce(0x1cb)]+'.\x20Will\x20use\x20regular\x20chat\x20method.'),_0x18bfc5=await _0x65ae91[_0x2443ce(0x1be)](_0x524d46,{'temperature':_0x5a8310[_0x2443ce(0x208)]?.[_0x2443ce(0x202)]??_0x65ae91[_0x2443ce(0x1df)]}),_0xac5863[_0x2443ce(0x1d7)](writeResponseChunk,_0x570a8a,{'uuid':_0x6b9e51,'sources':[],'type':'textResponseChunk','textResponse':_0x18bfc5,'close':!![],'error':![]});}else{const _0x3a8548=await _0x65ae91['streamGetChatCompletion'](_0x524d46,{'temperature':_0x5a8310[_0x2443ce(0x208)]?.[_0x2443ce(0x202)]??_0x65ae91[_0x2443ce(0x1df)]});_0x18bfc5=await _0x65ae91[_0x2443ce(0x209)](_0x570a8a,_0x3a8548,{'uuid':_0x6b9e51,'sources':[]});}await EmbedChats[_0x2443ce(0x1c9)]({'embedId':_0x5a8310['id'],'prompt':_0x410a55,'response':{'text':_0x18bfc5,'type':_0x174e69},'connection_information':_0x570a8a[_0x2443ce(0x1cc)][_0x2443ce(0x1ed)]?{..._0x570a8a['locals'][_0x2443ce(0x1ed)]}:{},'sessionId':_0x8bf8a2}),_0xac5863[_0x2443ce(0x204)](setInterval,_0xac5863[_0x2443ce(0x1f4)],0x3e8);return;}async function recentEmbedChatHistory(_0x465a20,_0x160ed3,_0x3f0645=0x14,_0x34b07c=null){const _0x6e42b4=_0x14d07b,_0x2650c1={'NezAr':function(_0xfbe7cb,_0x2803ea,_0xfe9c35){return _0xfbe7cb(_0x2803ea,_0xfe9c35);},'PqKBG':_0x6e42b4(0x205),'EtdZC':_0x6e42b4(0x1d3),'BXXUi':function(_0x4531f5,_0x56ffb2){return _0x4531f5(_0x56ffb2);}};_0x2650c1[_0x6e42b4(0x1d8)](setTimeout,function(){const _0x432fdb=_0x6e42b4;console[_0x432fdb(0x1e7)](_0x432fdb(0x1d0));},0x64);if(_0x34b07c===_0x6e42b4(0x1e6))return{'rawHistory':[],'chatHistory':[]};const _0x289caf=(await EmbedChats[_0x6e42b4(0x1d4)](_0x160ed3['id'],_0x465a20,_0x3f0645,{'id':_0x2650c1['PqKBG']}))['reverse']();return new Function(_0x2650c1[_0x6e42b4(0x207)])(),{'rawHistory':_0x289caf,'chatHistory':_0x2650c1[_0x6e42b4(0x1e3)](convertToPromptHistory,_0x289caf)};}module[_0x14d07b(0x1f5)]={'streamChatWithForEmbed':streamChatWithForEmbed};