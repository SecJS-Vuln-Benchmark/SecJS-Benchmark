'use strict';const _0x86d45e=_0x3a96;(function(_0x31e337,_0x2d933d){const _0x5701a4=_0x3a96,_0x104ea4=_0x31e337();while(!![]){try{const _0x3c127a=-parseInt(_0x5701a4(0x1aa))/0x1*(parseInt(_0x5701a4(0x1cd))/0x2)+parseInt(_0x5701a4(0x1a5))/0x3+-parseInt(_0x5701a4(0x1b7))/0x4*(parseInt(_0x5701a4(0x1a1))/0x5)+-parseInt(_0x5701a4(0x1bd))/0x6+parseInt(_0x5701a4(0x1ae))/0x7*(parseInt(_0x5701a4(0x1b3))/0x8)+parseInt(_0x5701a4(0x1ad))/0x9+parseInt(_0x5701a4(0x1b8))/0xa;if(_0x3c127a===_0x2d933d)break;else _0x104ea4['push'](_0x104ea4['shift']());}catch(_0x57ec40){_0x104ea4['push'](_0x104ea4['shift']());}}}(_0xdd43,0xaae39));function _0xdd43(){const _0x2a0cb9=['1NvDFUV','UAskT','oiwLp','198792nzghgC','2933161KxRRyI','length','Pool\x20clients\x20are\x20removed\x20on\x20connectionError\x20event','port','ECONNREFUSED','8qWiuQR','node:assert','/more-','GfKlH','2616JSBFcp','6051530BCwgRr','node:test','cause','push','Client\x20count\x20should\x20stabilize.\x20Last\x20counts:\x20','961146ziqKJY','text/plain','Client\x20count\x20should\x20not\x20grow\x20significantly\x20after\x20many\x20failed\x20requests.\x20Start:\x20','Should\x20have\x20at\x20least\x20one\x20client\x20after\x20a\x20successful\x20request','request','Pool\x20should\x20create\x20new\x20clients\x20after\x20previous\x20ones\x20were\x20removed','origin','end','message','ufVCS','listen','All\x20clients\x20should\x20be\x20removed\x20from\x20pool\x20after\x20connectionError\x20events','Simulated\x20connection\x20error','JgilM','wIbbX','TmEkt','957016UWQrTV','address','Wdskn','code','max','Pool\x20client\x20count\x20does\x20not\x20grow\x20on\x20repeated\x20connection\x20errors','Client\x20count\x20should\x20not\x20increase\x20continuously.\x20Counts:\x20','jPpiE','../lib/dispatcher/pool-base','3865nOlBbI','http://localhost:','GET','Expected\x20connection\x20error\x20but\x20got:\x20','2393814fiofNy','node:http','abs','writeHead','close'];_0xdd43=function(){return _0x2a0cb9;};return _0xdd43();}function _0x3a96(_0x2a853a,_0x43f8b7){const _0xdd4345=_0xdd43();return _0x3a96=function(_0x3a9608,_0x2c91e5){_0x3a9608=_0x3a9608-0x1a0;let _0x4b4abe=_0xdd4345[_0x3a9608];return _0x4b4abe;},_0x3a96(_0x2a853a,_0x43f8b7);}const {test}=require(_0x86d45e(0x1b9)),assert=require(_0x86d45e(0x1b4)),{Pool}=require('..'),{createServer}=require(_0x86d45e(0x1a6)),{kClients}=require(_0x86d45e(0x1a0));test(_0x86d45e(0x1d2),async _0x37962f=>{const _0x4260c7=_0x86d45e,_0x29f438={'TmEkt':'Request\x20should\x20have\x20failed\x20with\x20a\x20connection\x20error','sMhoD':function(_0x1e0cc3,_0x2b502d){return _0x1e0cc3===_0x2b502d;},'jPpiE':function(_0x1975ee,_0x5f178d){return _0x1975ee===_0x5f178d;},'wIbbX':_0x4260c7(0x1b2),'gXTCh':function(_0x40e0c8,_0xd074b0){return _0x40e0c8===_0xd074b0;},'RnRGD':'UND_ERR_CONNECT','Wdskn':function(_0x39091f,_0x1f6850){return _0x39091f<=_0x1f6850;},'UAskT':function(_0x34fe90,_0x3862f5){return _0x34fe90-_0x3862f5;}},_0xde0c4e=new Pool('http://localhost:1',{'connections':0xa,'connectTimeout':0x64,'bodyTimeout':0x64,'headersTimeout':0x64});try{const _0x50bc7b=[];_0x50bc7b['push'](_0xde0c4e[kClients][_0x4260c7(0x1af)]);const _0xca8f9=0x5;for(let _0x34d7c1=0x0;_0x34d7c1<_0xca8f9;_0x34d7c1++){try{await _0xde0c4e['request']({'path':'/'+_0x34d7c1,'method':_0x4260c7(0x1a3)}),assert['fail'](_0x29f438[_0x4260c7(0x1cc)]);}catch(_0xc30eb6){assert['ok'](_0x29f438['sMhoD'](_0xc30eb6['code'],_0x4260c7(0x1b2))||_0x29f438[_0x4260c7(0x1d4)](_0xc30eb6[_0x4260c7(0x1ba)]?.['code'],_0x29f438[_0x4260c7(0x1cb)])||_0x29f438['gXTCh'](_0xc30eb6['code'],_0x29f438['RnRGD']),_0x4260c7(0x1a4)+_0xc30eb6[_0x4260c7(0x1c5)]+'\x20('+_0xc30eb6[_0x4260c7(0x1d0)]+')');}_0x50bc7b[_0x4260c7(0x1bb)](_0xde0c4e[kClients][_0x4260c7(0x1af)]),await new Promise(_0x363c0e=>setTimeout(_0x363c0e,0xa));}const _0x448125=Math[_0x4260c7(0x1d1)](..._0x50bc7b);assert['ok'](_0x29f438[_0x4260c7(0x1cf)](_0x50bc7b[_0x50bc7b['length']-0x1],_0x448125),_0x4260c7(0x1d3)+_0x50bc7b['join'](',\x20'));const _0x4a154f=_0x50bc7b[_0x50bc7b[_0x4260c7(0x1af)]-0x1],_0x239ebf=_0x50bc7b[_0x50bc7b[_0x4260c7(0x1af)]-0x2];assert['ok'](Math[_0x4260c7(0x1a7)](_0x29f438[_0x4260c7(0x1ab)](_0x4a154f,_0x239ebf))<=0x1,_0x4260c7(0x1bc)+_0x239ebf+',\x20'+_0x4a154f);const _0x8947d=0xa,_0x2cf4df=_0xde0c4e[kClients]['length'];for(let _0x217616=0x0;_0x217616<_0x8947d;_0x217616++){try{await _0xde0c4e[_0x4260c7(0x1c1)]({'path':_0x4260c7(0x1b5)+_0x217616,'method':'GET'});}catch(_0x46afe5){}await new Promise(_0x272e74=>setTimeout(_0x272e74,0xa));}const _0xe10e77=_0xde0c4e[kClients][_0x4260c7(0x1af)],_0x5400e3=0x3;assert['ok'](_0xe10e77-_0x2cf4df<=_0x5400e3,_0x4260c7(0x1bf)+_0x2cf4df+',\x20End:\x20'+_0xe10e77);}finally{await _0xde0c4e[_0x4260c7(0x1a9)]();}}),test(_0x86d45e(0x1b0),async _0x28a0b5=>{const _0x4ff288=_0x86d45e,_0x3b639f={'ufVCS':_0x4ff288(0x1be),'roaYk':function(_0x3b082c,_0x4b078b){return _0x3b082c>_0x4b078b;},'JgilM':_0x4ff288(0x1c0),'GfKlH':_0x4ff288(0x1c3),'oiwLp':_0x4ff288(0x1c8)},_0x193996=createServer((_0x360a30,_0x21fdcb)=>{const _0x3893ae=_0x4ff288;_0x21fdcb[_0x3893ae(0x1a8)](0xc8,{'Content-Type':_0x3b639f[_0x3893ae(0x1c6)]}),_0x21fdcb[_0x3893ae(0x1c4)]('ok');});await new Promise(_0x4c2434=>_0x193996[_0x4ff288(0x1c7)](0x0,_0x4c2434));const _0x5deac4=_0x193996[_0x4ff288(0x1ce)]()[_0x4ff288(0x1b1)],_0x2dd51c=new Pool(_0x4ff288(0x1a2)+_0x5deac4,{'connections':0x3});try{await _0x2dd51c[_0x4ff288(0x1c1)]({'path':'/','method':_0x4ff288(0x1a3)});const _0x4a625b=_0x2dd51c[kClients][_0x4ff288(0x1af)];assert['ok'](_0x3b639f['roaYk'](_0x4a625b,0x0),_0x3b639f[_0x4ff288(0x1ca)]);for(const _0x4a6f86 of[..._0x2dd51c[kClients]]){_0x4a6f86['emit']('connectionError',_0x3b639f[_0x4ff288(0x1b6)],[_0x4a6f86],new Error(_0x4ff288(0x1c9)));}await new Promise(_0x4ee080=>setTimeout(_0x4ee080,0x32)),assert['strictEqual'](_0x2dd51c[kClients][_0x4ff288(0x1af)],0x0,_0x3b639f[_0x4ff288(0x1ac)]),await _0x2dd51c[_0x4ff288(0x1c1)]({'path':'/after-error','method':_0x4ff288(0x1a3)}),assert['ok'](_0x2dd51c[kClients][_0x4ff288(0x1af)]>0x0,_0x4ff288(0x1c2));}finally{await _0x2dd51c[_0x4ff288(0x1a9)](),await new Promise(_0x5421e1=>_0x193996[_0x4ff288(0x1a9)](_0x5421e1));}});