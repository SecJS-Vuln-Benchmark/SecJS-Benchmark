const _0xbfda14=_0x2ca4;(function(_0x4d0208,_0x12bb19){const _0x116361=_0x2ca4,_0x2b2ebe=_0x4d0208();while(!![]){try{const _0x1b3f64=-parseInt(_0x116361(0x1d5))/0x1+-parseInt(_0x116361(0x1cc))/0x2*(-parseInt(_0x116361(0x1df))/0x3)+-parseInt(_0x116361(0x1db))/0x4+-parseInt(_0x116361(0x1f9))/0x5+parseInt(_0x116361(0x1de))/0x6*(-parseInt(_0x116361(0x1e9))/0x7)+-parseInt(_0x116361(0x1c0))/0x8*(parseInt(_0x116361(0x1ed))/0x9)+parseInt(_0x116361(0x1c9))/0xa;if(_0x1b3f64===_0x12bb19)break;else _0x2b2ebe['push'](_0x2b2ebe['shift']());}catch(_0x17af13){_0x2b2ebe['push'](_0x2b2ebe['shift']());}}}(_0x5547,0x49b0b));function _0x2ca4(_0x29aa25,_0x21a049){const _0x55477c=_0x5547();return _0x2ca4=function(_0x2ca4ca,_0x138d49){_0x2ca4ca=_0x2ca4ca-0x1b7;let _0x242a75=_0x55477c[_0x2ca4ca];return _0x242a75;},_0x2ca4(_0x29aa25,_0x21a049);}function _0x5547(){const _0x2f1265=['map','6506Eklusn','yKSoD','savedMessageIds','NO_PARENT','AFwBJ','LBhim','stringify','vlLfc','exports','468677RjXkii','conversationId','[AgentController]\x20Request\x20aborted\x20on\x20close','~/server/middleware','URrld','responseMessageId','854672jMfdZQ','messageId','userMessagePromise','12oLfHPP','543fRwjNd','TuqCW','requestCompleted','IAPDO','responsePromise','zQCXi','skipSaveUserMessage','yOwKk','CvLSu','attachments','671818UbRxNP','end','hVTVy','aborted','1719PPWAvQ','~/models','push','api/server/controllers/agents/request.js\x20-\x20response\x20end','PLPOD','~/config','sender','qmUjf','file_id','signal','api/server/controllers/agents/request.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','files','454400MNGGQZ','Htend','abort','body','PyXKW','getContentParts','console.log(\x22timer\x22);','debug','has','librechat-data-provider','15752LgwDem','user','XUkwG','New\x20Chat','OFcyX','image_urls','close','GqAzc','title','10542940GeHycQ','~/server/utils'];_0x5547=function(){return _0x2f1265;};return _0x5547();}const {Constants}=require(_0xbfda14(0x1bf)),{createAbortController,handleAbortError}=require(_0xbfda14(0x1d8)),{sendMessage}=require(_0xbfda14(0x1ca)),{saveMessage}=require(_0xbfda14(0x1ee)),{logger}=require(_0xbfda14(0x1f2)),AgentController=async(_0x4fcf65,_0x562bc2,_0x4d4d97,_0x29ca2a,_0x5bdeb2)=>{const _0x419ee8=_0xbfda14,_0x3cba30={'Htend':_0x419ee8(0x1bc),'zQCXi':function(_0x28dc9c,_0xdf3bdb){return _0x28dc9c===_0xdf3bdb;},'TuqCW':_0x419ee8(0x1dd),'hVTVy':_0x419ee8(0x1e2),'PLPOD':function(_0x5668c0,_0x25ddb3){return _0x5668c0===_0x25ddb3;},'AFwBJ':'promptTokens','UpTGo':function(_0x135258,_0x525c73){return _0x135258===_0x525c73;},'SRjwD':_0x419ee8(0x1f3),'vlLfc':function(_0x1011ed,_0x342aa6){return _0x1011ed===_0x342aa6;},'GqAzc':_0x419ee8(0x1cd),'LBhim':_0x419ee8(0x1c3),'PyXKW':_0x419ee8(0x1d9),'qmUjf':function(_0x2b555f,_0x2e6cf0,_0x3427f3){return _0x2b555f(_0x2e6cf0,_0x3427f3);},'CvLSu':function(_0x292d27,_0x1a245e,_0x314299,_0x72e7a5,_0xe9acf2){return _0x292d27(_0x1a245e,_0x314299,_0x72e7a5,_0xe9acf2);}};let {text:_0x487ead,endpointOption:_0x2ea6be,conversationId:_0x56fb64,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x4fcf65[_0x419ee8(0x1b9)],_0x30cc0a,_0x3b1f2e,_0xfad3f3,_0x48f79d,_0x32aaa7,_0x9169d8;const _0x102b38=!_0x56fb64,_0x2f9c26=_0x4fcf65[_0x419ee8(0x1c1)]['id'],_0x256a08=(_0x594665={})=>{const _0x1808e2=_0x419ee8,_0x190c1d={'XUkwG':function(_0x47cfc1,_0x5971f4,_0x421bb4){return _0x47cfc1(_0x5971f4,_0x421bb4);},'OFcyX':_0x3cba30[_0x1808e2(0x1b7)]};for(let _0x24e72c in _0x594665){if(_0x24e72c==='userMessage')_0x1808e2(0x1e6)===_0x1808e2(0x1e6)?(_0x3b1f2e=_0x594665[_0x24e72c],_0x48f79d=_0x594665[_0x24e72c][_0x1808e2(0x1dc)]):_0x190c1d[_0x1808e2(0x1c2)](_0x2b205f,_0x5b0edf,{'text':_0x169b3e,'response':_0x2d044,'client':_0x291a1b});else{if(_0x3cba30[_0x1808e2(0x1e4)](_0x24e72c,_0x3cba30[_0x1808e2(0x1e0)])){if(_0x1808e2(0x1e2)===_0x3cba30[_0x1808e2(0x1eb)])_0x9169d8=_0x594665[_0x24e72c];else{_0x190c1d['XUkwG'](_0x2710ab,_0x190c1d[_0x1808e2(0x1c4)],0x3e8);return;}}else{if(_0x24e72c===_0x1808e2(0x1da))_0x32aaa7=_0x594665[_0x24e72c];else{if(_0x3cba30[_0x1808e2(0x1f1)](_0x24e72c,_0x3cba30[_0x1808e2(0x1d0)]))_0xfad3f3=_0x594665[_0x24e72c];else{if(_0x3cba30['UpTGo'](_0x24e72c,_0x3cba30['SRjwD']))_0x30cc0a=_0x594665[_0x24e72c];else!_0x56fb64&&_0x3cba30[_0x1808e2(0x1d3)](_0x24e72c,_0x1808e2(0x1d6))&&(_0x56fb64=_0x594665[_0x24e72c]);}}}}}};try{const {client:_0x205dac}=await _0x29ca2a({'req':_0x4fcf65,'res':_0x562bc2,'endpointOption':_0x2ea6be}),_0x3c4866=()=>({'sender':_0x30cc0a,'userMessage':_0x3b1f2e,'promptTokens':_0xfad3f3,'conversationId':_0x56fb64,'userMessagePromise':_0x9169d8,'messageId':_0x32aaa7,'content':_0x205dac[_0x419ee8(0x1bb)](),'parentMessageId':overrideParentMessageId??_0x48f79d}),{abortController:_0x23165f,onStart:_0x183420}=createAbortController(_0x4fcf65,_0x562bc2,_0x3c4866,_0x256a08);_0x562bc2['on'](_0x419ee8(0x1c6),()=>{const _0x3522ff=_0x419ee8;logger[_0x3522ff(0x1bd)]('[AgentController]\x20Request\x20closed');if(!_0x23165f){eval('Math[\'PI\'] * 2;');return;}else{if(_0x23165f[_0x3522ff(0x1f6)]['aborted']){eval('const _0x1b6108 = _0x3522ff;JSON[_0x1b6108(466)]({ \'safe\': !![] });');return;}else{if(_0x23165f[_0x3522ff(0x1e1)]){if('yKSoD'!==_0x3cba30[_0x3522ff(0x1c7)])_0xb59718['PI']*0x2;else{setTimeout(_0x3522ff(0x1bc),0x3e8);return;}}}}_0x23165f[_0x3522ff(0x1b8)](),logger[_0x3522ff(0x1bd)](_0x3522ff(0x1d7));});const _0x38f1bb={'user':_0x2f9c26,'onStart':_0x183420,'getReqData':_0x256a08,'conversationId':_0x56fb64,'parentMessageId':parentMessageId,'abortController':_0x23165f,'overrideParentMessageId':overrideParentMessageId,'progressOptions':{'res':_0x562bc2}};let _0x1b9e01=await _0x205dac['sendMessage'](_0x487ead,_0x38f1bb);_0x1b9e01['endpoint']=_0x2ea6be['endpoint'];const {conversation:conversation={}}=await _0x205dac[_0x419ee8(0x1e3)];conversation['title']=conversation&&!conversation[_0x419ee8(0x1c8)]?null:conversation?.[_0x419ee8(0x1c8)]||_0x3cba30[_0x419ee8(0x1d1)];if(_0x4fcf65[_0x419ee8(0x1b9)][_0x419ee8(0x1f8)]&&_0x205dac['options']['attachments']){_0x3b1f2e['files']=[];const _0x143310=new Set(_0x4fcf65[_0x419ee8(0x1b9)]['files'][_0x419ee8(0x1cb)](_0x407ffc=>_0x407ffc['file_id']));for(let _0x4e71e4 of _0x205dac['options']['attachments']){_0x143310['has'](_0x4e71e4['file_id'])&&_0x3b1f2e[_0x419ee8(0x1f8)][_0x419ee8(0x1ef)](_0x4e71e4);}delete _0x3b1f2e[_0x419ee8(0x1c5)];}if(!_0x23165f['signal'][_0x419ee8(0x1ec)]){sendMessage(_0x562bc2,{'final':!![],'conversation':conversation,'title':conversation[_0x419ee8(0x1c8)],'requestMessage':_0x3b1f2e,'responseMessage':_0x1b9e01}),_0x562bc2[_0x419ee8(0x1ea)]();if(!_0x205dac[_0x419ee8(0x1ce)][_0x419ee8(0x1be)](_0x1b9e01[_0x419ee8(0x1dc)])){if(_0x419ee8(0x1d9)!==_0x3cba30[_0x419ee8(0x1ba)]){_0x5b457b[_0x419ee8(0x1f8)]=[];const _0x22a2a2=new _0x4f81f5(_0x3a0e15['body']['files'][_0x419ee8(0x1cb)](_0x488612=>_0x488612[_0x419ee8(0x1f5)]));for(let _0x43a163 of _0x412d3d['options'][_0x419ee8(0x1e8)]){_0x22a2a2[_0x419ee8(0x1be)](_0x43a163[_0x419ee8(0x1f5)])&&_0x43f8e1[_0x419ee8(0x1f8)][_0x419ee8(0x1ef)](_0x43a163);}delete _0x29105c[_0x419ee8(0x1c5)];}else await saveMessage(_0x4fcf65,{..._0x1b9e01,'user':_0x2f9c26},{'context':_0x419ee8(0x1f0)});}}!_0x205dac[_0x419ee8(0x1e5)]&&await saveMessage(_0x4fcf65,_0x3b1f2e,{'context':_0x419ee8(0x1f7)}),_0x5bdeb2&&_0x3cba30[_0x419ee8(0x1d3)](parentMessageId,Constants[_0x419ee8(0x1cf)])&&_0x102b38&&_0x3cba30[_0x419ee8(0x1f4)](_0x5bdeb2,_0x4fcf65,{'text':_0x487ead,'response':_0x1b9e01,'client':_0x205dac});}catch(_0x1dc0c4){_0x3cba30[_0x419ee8(0x1e7)](handleAbortError,_0x562bc2,_0x4fcf65,_0x1dc0c4,{'conversationId':_0x56fb64,'sender':_0x30cc0a,'messageId':_0x32aaa7,'parentMessageId':_0x48f79d??parentMessageId});}};module[_0xbfda14(0x1d4)]=AgentController;