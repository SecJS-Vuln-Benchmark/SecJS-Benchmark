const _0x39e87b=_0x5ebb;(function(_0x2a7522,_0x3fdb42){const _0x52c828=_0x5ebb,_0x319fa7=_0x2a7522();while(!![]){try{const _0x404d09=-parseInt(_0x52c828(0xcd))/0x1+-parseInt(_0x52c828(0xf0))/0x2*(-parseInt(_0x52c828(0xc2))/0x3)+parseInt(_0x52c828(0xc9))/0x4+parseInt(_0x52c828(0xd8))/0x5*(parseInt(_0x52c828(0xed))/0x6)+-parseInt(_0x52c828(0xd4))/0x7+-parseInt(_0x52c828(0xbb))/0x8*(parseInt(_0x52c828(0xc5))/0x9)+-parseInt(_0x52c828(0xc4))/0xa*(-parseInt(_0x52c828(0xb3))/0xb);if(_0x404d09===_0x3fdb42)break;else _0x319fa7['push'](_0x319fa7['shift']());}catch(_0x5b3073){_0x319fa7['push'](_0x319fa7['shift']());}}}(_0x371d,0x95ccc));const {agentProvider,fixtureManager,matchers,mockManager}=require('../../utils/e2e-framework'),{nullable,anyContentVersion,anyEtag,anyObjectId,anyUuid,anyISODateTime,anyString}=matchers,assert=require(_0x39e87b(0xda)),sinon=require(_0x39e87b(0xba)),jobManager=require(_0x39e87b(0xd7)),models=require(_0x39e87b(0xee)),matchEmail={'id':anyObjectId,'uuid':anyUuid,'created_at':anyISODateTime,'updated_at':anyISODateTime,'submitted_at':anyISODateTime},matchEmailNewsletter={...matchEmail,'newsletter_id':anyObjectId},matchBatch={'id':anyObjectId,'provider_id':anyString,'created_at':anyISODateTime,'updated_at':anyISODateTime},matchFailure={'id':anyObjectId,'failed_at':anyISODateTime,'event_id':anyString};describe('Emails\x20API',function(){const _0x2b7575=_0x39e87b,_0x273098={'kIUvc':_0x2b7575(0xbe),'NVuKK':'members','vMGCF':_0x2b7575(0xd6),'TkLZA':_0x2b7575(0xdb),'cuhlS':function(_0x5c8c6e,_0x4ca245){return _0x5c8c6e(_0x4ca245);},'AjaWZ':function(_0x574b99,_0x219fa1){return _0x574b99(_0x219fa1);},'jwBgl':_0x2b7575(0xef),'bYOzm':_0x2b7575(0xbc),'dbXth':_0x2b7575(0xf7),'EmZtU':_0x2b7575(0xd2),'ElFNQ':function(_0x138621,_0x48b6b2){return _0x138621(_0x48b6b2);},'upPpz':function(_0x411e73,_0x5b94d1,_0x180d64){return _0x411e73(_0x5b94d1,_0x180d64);},'zHHtc':'Can\x20read\x20an\x20email','WakVO':'Can\x20retry\x20a\x20failed\x20email','KuZjB':function(_0x5a7535,_0x10a87e,_0x140ae5){return _0x5a7535(_0x10a87e,_0x140ae5);},'EoSgB':function(_0x2eefe3,_0x312ec2,_0x5059ab){return _0x2eefe3(_0x312ec2,_0x5059ab);},'pmSdy':_0x2b7575(0xe8),'YmgHy':_0x2b7575(0xfb),'WGhdS':function(_0x1a68e6,_0x37b302,_0x26242a){return _0x1a68e6(_0x37b302,_0x26242a);},'yBUoO':'Does\x20default\x20replacements\x20on\x20the\x20HTML\x20body\x20of\x20an\x20old\x20email'};let _0x5dfe85;_0x273098[_0x2b7575(0xf1)](before,async function(){const _0x109165=_0x2b7575;_0x5dfe85=await agentProvider['getAdminAPIAgent'](),await fixtureManager[_0x109165(0xe4)](_0x273098['kIUvc'],_0x109165(0xf7),_0x273098['NVuKK'],_0x273098[_0x109165(0xb4)]),await _0x5dfe85[_0x109165(0xe0)]();}),_0x273098[_0x2b7575(0xe1)](beforeEach,function(){const _0x2094da=_0x2b7575;mockManager[_0x2094da(0xd3)](),mockManager[_0x2094da(0xd0)]();}),afterEach(function(){const _0x1a13db=_0x2b7575;mockManager[_0x1a13db(0xc0)](),sinon[_0x1a13db(0xc0)]();}),_0x273098[_0x2b7575(0xca)](it,_0x2b7575(0xd9),async function(){const _0x56b2c2=_0x2b7575;await _0x5dfe85[_0x56b2c2(0xc1)](_0x56b2c2(0xdb))[_0x56b2c2(0xdd)](0xc8)['matchBodySnapshot']({'emails':new Array(0x2)['fill'](matchEmail)})[_0x56b2c2(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x273098[_0x2b7575(0xd5)],async function(){const _0x2a3cef=_0x2b7575;await _0x5dfe85[_0x2a3cef(0xc1)](_0x2a3cef(0xe6)+fixtureManager[_0x2a3cef(0xc1)](_0x2a3cef(0xdb),0x0)['id']+'/')['expectStatus'](0xc8)[_0x2a3cef(0xb5)]({'emails':[matchEmail]})[_0x2a3cef(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x273098[_0x2b7575(0xc3)],async function(){const _0x54f3ef=_0x2b7575;await _0x5dfe85['put'](_0x54f3ef(0xe6)+fixtureManager[_0x54f3ef(0xc1)](_0x54f3ef(0xdb),0x1)['id']+'/retry')[_0x54f3ef(0xdd)](0xc8)[_0x54f3ef(0xb5)]({'emails':[matchEmail]})[_0x54f3ef(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag}),await jobManager['allSettled'](),mockManager[_0x54f3ef(0xfc)][_0x54f3ef(0xc6)](_0x54f3ef(0xbf));}),it(_0x2b7575(0xeb),async function(){const _0xd20bc9=_0x2b7575;await _0x5dfe85['get']('emails/'+fixtureManager['get'](_0x273098[_0xd20bc9(0xb8)],0x0)['id']+_0xd20bc9(0xec))[_0xd20bc9(0xdd)](0xc8)[_0xd20bc9(0xb5)]({'batches':[matchBatch]})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x2b7575(0xf5),async function(){const _0x4fb6da=_0x2b7575,{body:_0x20e7aa}=await _0x5dfe85[_0x4fb6da(0xc1)](_0x4fb6da(0xe6)+fixtureManager[_0x4fb6da(0xc1)](_0x4fb6da(0xdb),0x0)['id']+_0x4fb6da(0xde))['expectStatus'](0xc8)[_0x4fb6da(0xb5)]({'batches':[matchBatch]})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});assert['equal'](_0x20e7aa[_0x4fb6da(0xe2)][0x0][_0x4fb6da(0xf4)][_0x4fb6da(0xf9)],0x6);}),_0x273098['KuZjB'](it,_0x2b7575(0xe7),async function(){const _0xc724bf=_0x2b7575;await _0x5dfe85[_0xc724bf(0xc1)](_0xc724bf(0xe6)+fixtureManager[_0xc724bf(0xc1)](_0x273098['TkLZA'],0x0)['id']+_0xc724bf(0xe9))[_0xc724bf(0xdd)](0xc8)[_0xc724bf(0xb5)]({'failures':new Array(0x5)['fill'](matchFailure)})[_0xc724bf(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0x273098[_0x2b7575(0xea)](it,_0x273098['pmSdy'],async function(){const _0x42f051=_0x2b7575;await _0x5dfe85['get'](_0x42f051(0xe6)+fixtureManager[_0x42f051(0xc1)](_0x273098[_0x42f051(0xb8)],0x0)['id']+_0x42f051(0xe3))[_0x42f051(0xdd)](0xc8)[_0x42f051(0xb5)]({'failures':new Array(0x1)['fill'](matchFailure)})[_0x42f051(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x2b7575(0xf6),async function(){const _0x35e7e0=_0x2b7575;await _0x5dfe85[_0x35e7e0(0xc1)]('emails/'+fixtureManager[_0x35e7e0(0xc1)](_0x35e7e0(0xdb),0x0)['id']+_0x35e7e0(0xdc))[_0x35e7e0(0xdd)](0xc8)[_0x35e7e0(0xb5)]({'failures':new Array(0x4)['fill'](matchFailure)})[_0x35e7e0(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0x273098[_0x2b7575(0xca)](it,_0x273098[_0x2b7575(0xb6)],async function(){const _0x2a4689=_0x2b7575;await _0x5dfe85[_0x2a4689(0xc1)](_0x2a4689(0xe6)+fixtureManager['get'](_0x2a4689(0xdb),0x0)['id']+'/recipient-failures/?order=failed_at%20DESC&include=member,email_recipient')[_0x2a4689(0xdd)](0xc8)[_0x2a4689(0xb5)]({'failures':new Array(0x5)[_0x2a4689(0xd1)]({...matchFailure,'member':{'id':anyObjectId,'uuid':anyUuid},'email_recipient':{'id':anyObjectId,'member_uuid':anyUuid,'opened_at':nullable(anyISODateTime),'delivered_at':_0x273098[_0x2a4689(0xe5)](nullable,anyISODateTime),'failed_at':_0x273098[_0x2a4689(0xf1)](nullable,anyISODateTime),'processed_at':anyISODateTime,'batch_id':anyObjectId}})})[_0x2a4689(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0x273098['WGhdS'](it,_0x273098[_0x2b7575(0xfa)],async function(){const _0x33431c=_0x2b7575,_0x3676a2=_0x273098[_0x33431c(0xbd)],_0x512b6a=_0x273098[_0x33431c(0xf3)],_0x37bae1=await models['Email'][_0x33431c(0xcb)]({'post_id':fixtureManager[_0x33431c(0xc1)](_0x273098[_0x33431c(0xdf)],0x2)['id'],'newsletter_id':fixtureManager[_0x33431c(0xc1)](_0x273098['dbXth'],0x0)['id'],'status':_0x33431c(0xb9),'submitted_at':new Date(),'track_opens':![],'track_clicks':![],'feedback_enabled':![],'recipient_filter':_0x273098['EmZtU'],'subject':_0x33431c(0xc7),'from':_0x33431c(0xcf),'replyTo':null,'email_count':0x1,'source':'{}','source_type':'lexical','html':_0x3676a2,'plaintext':_0x512b6a}),{body:_0x5840a4}=await _0x5dfe85[_0x33431c(0xc1)]('emails/'+_0x37bae1['id']+'/')['expectStatus'](0xc8)['matchBodySnapshot']({'emails':[matchEmailNewsletter]})[_0x33431c(0xf2)]({'content-version':anyContentVersion,'etag':anyEtag});assert[_0x33431c(0xce)](_0x5840a4['emails'][0x0][_0x33431c(0xf8)][_0x33431c(0xcc)](_0x33431c(0xb7)),![]),assert[_0x33431c(0xce)](_0x5840a4[_0x33431c(0xdb)][0x0][_0x33431c(0xc8)][_0x33431c(0xcc)](_0x33431c(0xb7)),![]);});});function _0x5ebb(_0x5512a4,_0x3c1a1d){const _0x371d00=_0x371d();return _0x5ebb=function(_0x5ebb17,_0x2224eb){_0x5ebb17=_0x5ebb17-0xb3;let _0x3421a7=_0x371d00[_0x5ebb17];return _0x3421a7;},_0x5ebb(_0x5512a4,_0x3c1a1d);}function _0x371d(){const _0x2cd20b=['kIUvc','loginAsOwner','ElFNQ','batches','/recipient-failures/?filter=severity:permanent&order=failed_at%20DESC','init','cuhlS','emails/','Can\x20browse\x20all\x20email\x20failures','Can\x20browse\x20permanent\x20email\x20failures','/recipient-failures/?order=failed_at%20DESC','EoSgB','Can\x20browse\x20email\x20batches','/batches/','732jxrxjp','../../../core/server/models','<p\x20style=\x22margin:\x200\x200\x201.5em\x200;\x20line-height:\x201.6em;\x22>Hey\x20%%{first_name,\x20&quot;there&quot;}%%,\x20Hey\x20%%{first_name}%%,</p><a\x20href=\x22%%{unsubscribe_url}%%\x22>Unsubscribe</a>','16810pSoRcr','AjaWZ','matchHeaderSnapshot','bYOzm','count','Can\x20browse\x20email\x20batches\x20with\x20recipient\x20count','Can\x20browse\x20temporary\x20email\x20failures','newsletters','html','recipients','yBUoO','Can\x20browse\x20email\x20failures\x20with\x20includes','assert','1681273CeeOGP','vMGCF','matchBodySnapshot','YmgHy','%%{','TkLZA','submitted','sinon','2704XUsLmn','Hey\x20%%{first_name,\x20\x22there\x22}%%,\x20Hey\x20%%{first_name}%%\x0aUnsubscribe\x20[%%{unsubscribe_url}%%]','jwBgl','posts','email.edited','restore','get','279mjErlb','WakVO','150aqXzzp','30843KOVpen','emittedEvent','Test\x20email','plaintext','927924ETcdkc','upPpz','add','includes','977301xUdUXt','equal','support@example.com','mockMailgun','fill','all','mockEvents','6932142qWwkvI','zHHtc','members:emails:failed','../../../core/server/services/jobs/job-service','17755dHDYDY','Can\x20browse\x20emails','assert/strict','emails','/recipient-failures/?filter=severity:temporary&order=failed_at%20DESC','expectStatus','/batches/?include=count.recipients'];_0x371d=function(){return _0x2cd20b;};return _0x371d();}