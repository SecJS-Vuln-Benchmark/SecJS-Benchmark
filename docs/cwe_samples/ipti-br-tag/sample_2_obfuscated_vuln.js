'use strict';function _0x1519(){const _0x5cc720=['ext','\x20to\x20client','drBAo','2150YEBaQV','application/xml','image','Image\x20upload\x20error:\x20MIME-type\x20\x22','includes','substr','869WWZZGO','hedgedoc-','ROrhu','readFileSync','AGXFi','errorBadRequest','mime','Router','45JZHkAX','2APuhet','allowAnonymousEdits','lgLdv','YDozX','OVnmk','2258912vccrYt','../../config','590612AEsLZL','Image\x20upload\x20error:\x20Provided\x20file\x20extension\x20does\x20not\x20match\x20MIME-type','QVuGB','\x22\x20of\x20uploaded\x20file\x20not\x20allowed,\x20only\x20\x22','rbXJl','upload\x20image\x20error','1823121ZqIeoL','YQSdf','lTMZc','../../errors','join','Image\x20upload\x20error:\x20Could\x20not\x20determine\x20MIME-type','.jpe','error','allowedUploadMimeTypes','.svg','\x22\x20are\x20allowed','status','277746RlKsQq','SERVER\x20sending\x20','filepath','VbWAy','mkdtempSync','Image\x20upload\x20error:\x20Upload\x20didn\x27t\x20contain\x20file)','.jfif','stringify','SERVER\x20received\x20uploadimage:\x20','Image\x20upload\x20error:\x20Anonymous\x20edits\x20and\x20therefore\x20uploads\x20are\x20not\x20allowed','UaBOe','GUtBK','uploadImage','LCcNy','aqnAi','3656fskNMF','imageUploadType','svg','path','8658rEGFjj','sync','/uploadimage','post','XAMPF','KGLbP','\x20using\x20','express','fileTypeFromFile','image/svg+xml','jZztw','debug','Mlstz','errorForbidden','imageRouter:\x20Uploading\x20','TyjcY','end','mJbzS','2777075ygEhYt','../../logger','Image\x20upload\x20error:\x20formidable\x20error:\x20','otRTS','jpg','ibOeK','tmpdir','formidable'];_0x1519=function(){return _0x5cc720;};return _0x1519();}function _0x5e15(_0x408fb1,_0x2638f7){const _0x151953=_0x1519();return _0x5e15=function(_0x5e159e,_0x3aa130){_0x5e159e=_0x5e159e-0x11d;let _0x5d34c8=_0x151953[_0x5e159e];return _0x5d34c8;},_0x5e15(_0x408fb1,_0x2638f7);}const _0x27e39f=_0x5e15;(function(_0x4ac142,_0x37d979){const _0x1ec281=_0x5e15,_0x484975=_0x4ac142();while(!![]){try{const _0x57ef03=-parseInt(_0x1ec281(0x12a))/0x1+parseInt(_0x1ec281(0x123))/0x2*(-parseInt(_0x1ec281(0x130))/0x3)+parseInt(_0x1ec281(0x128))/0x4+parseInt(_0x1ec281(0x122))/0x5*(parseInt(_0x1ec281(0x13c))/0x6)+parseInt(_0x1ec281(0x161))/0x7+parseInt(_0x1ec281(0x14b))/0x8*(parseInt(_0x1ec281(0x14f))/0x9)+-parseInt(_0x1ec281(0x16c))/0xa*(parseInt(_0x1ec281(0x172))/0xb);if(_0x57ef03===_0x37d979)break;else _0x484975['push'](_0x484975['shift']());}catch(_0x37477a){_0x484975['push'](_0x484975['shift']());}}}(_0x1519,0x93122));const Router=require(_0x27e39f(0x156))[_0x27e39f(0x121)],formidable=require(_0x27e39f(0x168)),path=require(_0x27e39f(0x14e)),fs=require('fs'),os=require('os'),rimraf=require('rimraf'),isSvg=require('is-svg'),config=require(_0x27e39f(0x129)),logger=require(_0x27e39f(0x162)),errors=require(_0x27e39f(0x133)),imageRouter=module['exports']=Router();async function checkUploadType(_0x48c2bf){const _0x39d129=_0x27e39f,_0x5bb4ae={'UaBOe':function(_0x580841,_0x3190a9){return _0x580841!==_0x3190a9;},'pFdMC':function(_0x1c6d71,_0x104918){return _0x1c6d71(_0x104918);},'dLmnq':function(_0xca9dfc,_0xffbd37){return _0xca9dfc+_0xffbd37;},'drBAo':'image/svg+xml','TyjcY':function(_0x3172eb,_0x5e8f2b){return _0x3172eb===_0x5e8f2b;},'QVuGB':function(_0x246783,_0x11751c){return _0x246783===_0x11751c;},'Mlstz':function(_0x9379d9,_0x58f79e){return _0x9379d9===_0x58f79e;},'lTMZc':function(_0x5d5631,_0x464cc8){return _0x5d5631===_0x464cc8;},'AGXFi':_0x39d129(0x125),'jZztw':_0x39d129(0x14d),'GUtBK':function(_0x5ea9f0,_0x3b2a91){return _0x5ea9f0===_0x3b2a91;},'ywOqL':_0x39d129(0x135),'aqnAi':'.jpeg','LCcNy':'rbXJl','ROrhu':_0x39d129(0x12b)},_0x2a5d6a=path['extname'](_0x48c2bf)['toLowerCase'](),_0x58b177=await import('file-type');let _0x4440f7=await _0x58b177[_0x39d129(0x157)](_0x48c2bf);if(_0x5bb4ae['TyjcY'](_0x2a5d6a,_0x39d129(0x139))&&(_0x5bb4ae[_0x39d129(0x12c)](_0x4440f7,undefined)||_0x5bb4ae[_0x39d129(0x15b)](_0x4440f7['mime'],_0x39d129(0x16d)))){const _0x38b2b6=fs[_0x39d129(0x11d)](_0x48c2bf);if(isSvg(_0x38b2b6)){if(_0x5bb4ae[_0x39d129(0x132)](_0x5bb4ae[_0x39d129(0x11e)],_0x5bb4ae['AGXFi']))_0x4440f7={'ext':_0x5bb4ae[_0x39d129(0x159)],'mime':_0x39d129(0x158)};else return _0x1bd9bd[_0x39d129(0x137)](_0x39d129(0x12b)),![];}}if(_0x4440f7===undefined){if(_0x5bb4ae[_0x39d129(0x147)](_0x39d129(0x126),'YDozX'))return logger['error'](_0x5bb4ae['ywOqL']),![];else{const _0x5f11ba={'mJbzS':function(_0x8ae109,_0x5f5ad7){const _0x272565=_0x39d129;return _0x5bb4ae[_0x272565(0x146)](_0x8ae109,_0x5f5ad7);}};_0x20cb3c[_0x39d129(0x15a)](_0x39d129(0x144)+_0x10791a[_0x39d129(0x143)](_0x1144d2[_0x39d129(0x16e)]));const _0xb09b99=_0x5bb4ae['pFdMC'](_0x40f4c5,_0x5bb4ae['dLmnq']('./',_0x899e8f['imageUploadType']));_0x10853d[_0x39d129(0x15a)](_0x39d129(0x15d)+_0xed5ff2[_0x39d129(0x16e)][_0x39d129(0x13e)]+_0x39d129(0x155)+_0x10e893[_0x39d129(0x14c)]),_0xb09b99[_0x39d129(0x148)](_0x33e955[_0x39d129(0x16e)]['filepath'],function(_0x1ce8ab,_0x5d72ad){const _0x362544=_0x39d129;_0x13ca48[_0x362544(0x150)](_0x2ded69);if(_0x5f11ba[_0x362544(0x160)](_0x1ce8ab,null))return _0x4df5cd[_0x362544(0x137)](_0x1ce8ab),_0x426461[_0x362544(0x13b)](0x1f4)[_0x362544(0x15f)]('upload\x20image\x20error');_0x25ba1d[_0x362544(0x15a)](_0x362544(0x13d)+_0x5d72ad+_0x362544(0x16a)),_0xeab11c['send']({'link':_0x5d72ad});});}}if([_0x5bb4ae[_0x39d129(0x14a)],_0x39d129(0x142),_0x39d129(0x136)][_0x39d129(0x170)](_0x2a5d6a)&&_0x5bb4ae[_0x39d129(0x15e)](_0x4440f7[_0x39d129(0x169)],_0x39d129(0x165))){if(_0x39d129(0x12e)!==_0x5bb4ae[_0x39d129(0x149)])return _0x1ec96b['error'](_0x39d129(0x135)),![];else _0x4440f7['ext']=_0x2a5d6a[_0x39d129(0x171)](0x1);}if(_0x2a5d6a!=='.'+_0x4440f7[_0x39d129(0x169)]){if(_0x39d129(0x154)!==_0x39d129(0x13f))return logger['error'](_0x5bb4ae[_0x39d129(0x174)]),![];else _0x5972ee={'ext':_0x39d129(0x14d),'mime':_0x5bb4ae[_0x39d129(0x16b)]};}if(!config[_0x39d129(0x138)]['includes'](_0x4440f7[_0x39d129(0x120)]))return logger[_0x39d129(0x137)]('Image\x20upload\x20error:\x20MIME-type\x20\x22'+_0x4440f7[_0x39d129(0x120)]+'\x22\x20of\x20uploaded\x20file\x20not\x20allowed,\x20only\x20\x22'+config[_0x39d129(0x138)][_0x39d129(0x134)](',\x20')+_0x39d129(0x13a)),![];return!![];}imageRouter[_0x27e39f(0x152)](_0x27e39f(0x151),function(_0x39d4da,_0x53f96f){const _0xe408f6=_0x27e39f,_0x32664b={'OVnmk':_0xe408f6(0x164),'YQSdf':_0xe408f6(0x141),'XAMPF':function(_0x3cbd0d,_0x51a4d7){return _0x3cbd0d(_0x51a4d7);},'ibOeK':function(_0x4607e6,_0xc7acf4){return _0x4607e6+_0xc7acf4;},'LqyDg':_0xe408f6(0x173)};if(!_0x39d4da['isAuthenticated']()&&!config['allowAnonymous']&&!config[_0xe408f6(0x124)])return logger[_0xe408f6(0x137)](_0xe408f6(0x145)),errors[_0xe408f6(0x15c)](_0x53f96f);const _0x5ab548=fs[_0xe408f6(0x140)](path[_0xe408f6(0x134)](os[_0xe408f6(0x167)](),_0x32664b['LqyDg'])),_0x5e0699=_0x32664b[_0xe408f6(0x153)](formidable,{'keepExtensions':!![],'uploadDir':_0x5ab548});_0x5e0699['parse'](_0x39d4da,async function(_0x3ad277,_0x29855c,_0x55ef9b){const _0x1069ae=_0xe408f6,_0x158969={'HbZKD':_0x1069ae(0x12f)};if(_0x3ad277)return _0x32664b[_0x1069ae(0x127)]==='otRTS'?(logger[_0x1069ae(0x137)](_0x1069ae(0x163)+_0x3ad277),rimraf(_0x5ab548),errors[_0x1069ae(0x15c)](_0x53f96f)):(_0x4ff47b[_0x1069ae(0x137)](_0x1069ae(0x16f)+_0x2db104['mime']+_0x1069ae(0x12d)+_0x506217[_0x1069ae(0x138)][_0x1069ae(0x134)](',\x20')+'\x22\x20are\x20allowed'),![]);else{if(!_0x55ef9b[_0x1069ae(0x16e)]||!_0x55ef9b[_0x1069ae(0x16e)][_0x1069ae(0x13e)])return logger[_0x1069ae(0x137)](_0x32664b[_0x1069ae(0x131)]),rimraf[_0x1069ae(0x150)](_0x5ab548),errors[_0x1069ae(0x11f)](_0x53f96f);else{if(!await checkUploadType(_0x55ef9b[_0x1069ae(0x16e)][_0x1069ae(0x13e)]))return rimraf['sync'](_0x5ab548),errors['errorBadRequest'](_0x53f96f);else{logger['debug']('SERVER\x20received\x20uploadimage:\x20'+JSON[_0x1069ae(0x143)](_0x55ef9b['image']));const _0x53445e=_0x32664b[_0x1069ae(0x153)](require,_0x32664b[_0x1069ae(0x166)]('./',config[_0x1069ae(0x14c)]));logger[_0x1069ae(0x15a)](_0x1069ae(0x15d)+_0x55ef9b[_0x1069ae(0x16e)]['filepath']+_0x1069ae(0x155)+config[_0x1069ae(0x14c)]),_0x53445e[_0x1069ae(0x148)](_0x55ef9b['image']['filepath'],function(_0x315039,_0x387b31){const _0x1e09d0=_0x1069ae;rimraf[_0x1e09d0(0x150)](_0x5ab548);if(_0x315039!==null)return logger['error'](_0x315039),_0x53f96f['status'](0x1f4)[_0x1e09d0(0x15f)](_0x158969['HbZKD']);logger[_0x1e09d0(0x15a)](_0x1e09d0(0x13d)+_0x387b31+_0x1e09d0(0x16a)),_0x53f96f['send']({'link':_0x387b31});});}}}});});