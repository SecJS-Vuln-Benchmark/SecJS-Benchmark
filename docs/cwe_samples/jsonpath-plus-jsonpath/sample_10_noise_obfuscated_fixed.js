const _0x8ed492=_0x4e6e;(function(_0x17e46c,_0x2167cd){const _0x49fbbf=_0x4e6e,_0x7155dd=_0x17e46c();while(!![]){try{const _0x1869d0=parseInt(_0x49fbbf(0xc6))/0x1*(parseInt(_0x49fbbf(0x85))/0x2)+-parseInt(_0x49fbbf(0xad))/0x3+-parseInt(_0x49fbbf(0x8a))/0x4*(-parseInt(_0x49fbbf(0xb5))/0x5)+-parseInt(_0x49fbbf(0xbf))/0x6*(parseInt(_0x49fbbf(0xa8))/0x7)+-parseInt(_0x49fbbf(0x89))/0x8*(-parseInt(_0x49fbbf(0xb4))/0x9)+parseInt(_0x49fbbf(0xae))/0xa*(parseInt(_0x49fbbf(0xa1))/0xb)+parseInt(_0x49fbbf(0xaa))/0xc*(parseInt(_0x49fbbf(0xb3))/0xd);if(_0x1869d0===_0x2167cd)break;else _0x7155dd['push'](_0x7155dd['shift']());}catch(_0x2a019a){_0x7155dd['push'](_0x7155dd['shift']());}}}(_0x1d91,0x45264));function _0x4e6e(_0x585c45,_0x4c45f0){const _0x1d91da=_0x1d91();return _0x4e6e=function(_0x4e6ec9,_0x4c68e1){_0x4e6ec9=_0x4e6ec9-0x82;let _0x58bcb1=_0x1d91da[_0x4e6ec9];return _0x58bcb1;},_0x4e6e(_0x585c45,_0x4c45f0);}function _0x1d91(){const _0x4ea053=['17732XgAKSu','fBZfq','zOvTs','events','/tmp/gladys','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/ping','index.m3u8','7PqUFXz','stopStreaming','55140YkPSHF','sinon','camera\x20controller\x20test','128970PEWpCI','410NhPiFq','fs-extra','test','calledWith','config','533HchLYE','9SlZLAQ','177655KfAwdB','wIqtA','CAMERA_ROTATION','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/start','createWriteStream','status','pipe','camera-1','FILE_NOT_FOUND','TEMP_FOLDER','3306594RVkWva','UCmiU','test-toto-content','KgCWY','chai','../../../../services/rtsp-camera/api/rtspCamera.controller','fPAtF','50276gfWGau','var\x20x\x20=\x2042;\x20return\x20x;','SNjLf','should\x20return\x20404,\x20file\x20not\x20found\x20(res.status)\x20','proxyquire','calledOnce','4OHQvwd','my-camera','liveActivePing','return\x20await\x20Promise.resolve(42);','483064vcEdTB','52oXkyUc','error','ensureDir','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/stop','resolves','bpCNf','DCJoZ','result.txt','get\x20/api/v1/service/rtsp-camera/camera/streaming/:folder/:file','aFnRp','post\x20/api/v1/service/rtsp-camera/camera/test','should\x20ping\x20streaming','should\x20stop\x20streaming','returns','should\x20start\x20streaming','join','writeFile','controller','emit','tempFolder','should\x20return\x20404,\x20file\x20not\x20found\x20(throw\x20error)','wYxZQ','vZGTD'];_0x1d91=function(){return _0x4ea053;};return _0x1d91();}const {assert:chaiAssert}=require(_0x8ed492(0xc3)),{assert,fake}=require(_0x8ed492(0xab)),proxyquire=require(_0x8ed492(0x83))['noCallThru'](),fse=require(_0x8ed492(0xaf)),path=require('path'),EventEmitter=require(_0x8ed492(0xa4)),RtspCameraController=require(_0x8ed492(0xc4)),RtspCameraControllerWithFsMocked=proxyquire(_0x8ed492(0xc4),{'fs':{'createReadStream':()=>{const _0x32e9d3=_0x8ed492,_0x2ec7ac={'BGBbI':'return\x20Object.keys({a:1});'},_0x1adc9d=new EventEmitter();return _0x1adc9d[_0x32e9d3(0xbb)]=()=>_0x1adc9d[_0x32e9d3(0x9c)](_0x32e9d3(0x8b)),Function(_0x2ec7ac['BGBbI'])(),_0x1adc9d;}}}),gladys={'config':{'tempFolder':process['env'][_0x8ed492(0xbe)]||_0x8ed492(0xa5)}},rtspCameraService={'getImage':fake[_0x8ed492(0x8e)]('base64image'),'startStreamingIfNotStarted':fake['resolves']({}),'stopStreaming':fake[_0x8ed492(0x8e)]({}),'liveActivePing':fake[_0x8ed492(0x8e)](null)},res={'send':fake[_0x8ed492(0x97)](null)};describe(_0x8ed492(0xac),()=>{const _0x37fc4c=_0x8ed492,_0x526011={'DCJoZ':_0x37fc4c(0xb0),'GvIRt':_0x37fc4c(0xb7),'fPAtF':function(_0x5326d6,_0xd49b7d,_0x193178){return _0x5326d6(_0xd49b7d,_0x193178);},'UCmiU':'my-camera','fBZfq':function(_0x5970e5,_0xfe0673,_0x554af3){return _0x5970e5(_0xfe0673,_0x554af3);},'aFnRp':_0x37fc4c(0xbc),'bpCNf':_0x37fc4c(0x91),'SNjLf':_0x37fc4c(0x92),'zOvTs':function(_0x49876c,_0x43d447,_0x180f8a){return _0x49876c(_0x43d447,_0x180f8a);},'wIqtA':_0x37fc4c(0xc7),'wYxZQ':function(_0x157e68,_0x56503b,_0x34aba5){return _0x157e68(_0x56503b,_0x34aba5);},'dudTO':_0x37fc4c(0x98),'IEJzA':_0x37fc4c(0x96),'vZGTD':_0x37fc4c(0x95),'FjKmC':function(_0x11c4fd,_0x363477,_0x20b203){return _0x11c4fd(_0x363477,_0x20b203);},'ZaSEf':'should\x20get\x20streaming\x20file','gwZtk':_0x37fc4c(0x88),'KgCWY':_0x37fc4c(0x82)};new Function(_0x526011[_0x37fc4c(0xb6)])(),_0x526011[_0x37fc4c(0x9f)](it,'should\x20return\x20an\x20image',async()=>{const _0x5b3f39=_0x37fc4c,_0x107476={'params':[{'name':'CAMERA_URL','value':_0x526011[_0x5b3f39(0x90)]},{'name':_0x526011['GvIRt'],'value':'0'}]},_0x456e3a=RtspCameraController(gladys,rtspCameraService),_0x157317={'body':_0x107476};await _0x456e3a[_0x5b3f39(0x94)][_0x5b3f39(0x9b)](_0x157317,res),assert[_0x5b3f39(0xb1)](rtspCameraService['getImage'],_0x107476);}),it(_0x526011['dudTO'],async()=>{const _0x322197=_0x37fc4c,_0x356928=_0x526011[_0x322197(0xc5)](RtspCameraController,gladys,rtspCameraService),_0x234b7b={'params':{'camera_selector':_0x322197(0x86)},'body':{'is_gladys_gateway':![],'segment_duration':0x4}};await _0x356928[_0x322197(0xb8)][_0x322197(0x9b)](_0x234b7b,res),assert[_0x322197(0xb1)](rtspCameraService['startStreamingIfNotStarted'],_0x526011[_0x322197(0xc0)],![],0x4);}),_0x526011['fBZfq'](it,_0x526011['IEJzA'],async()=>{const _0x15d482=_0x37fc4c,_0x58adb4=_0x526011[_0x15d482(0xa2)](RtspCameraController,gladys,rtspCameraService),_0x25acf2={'params':{'camera_selector':_0x526011[_0x15d482(0xc0)]}};await _0x58adb4[_0x15d482(0x8d)][_0x15d482(0x9b)](_0x25acf2,res),assert['calledWith'](rtspCameraService[_0x15d482(0xa9)],_0x526011[_0x15d482(0xc0)]);}),it(_0x526011[_0x37fc4c(0xa0)],async()=>{const _0x4d0656=_0x37fc4c,_0x342ddc=RtspCameraController(gladys,rtspCameraService),_0x145d24={'params':{'camera_selector':_0x526011[_0x4d0656(0xc0)]}};await _0x342ddc[_0x4d0656(0xa6)][_0x4d0656(0x9b)](_0x145d24,res),assert['calledWith'](rtspCameraService[_0x4d0656(0x87)],'my-camera');}),_0x526011['FjKmC'](it,_0x526011['ZaSEf'],async()=>{const _0x22abd3=_0x37fc4c,_0x4920dc=RtspCameraController(gladys,rtspCameraService),_0x1df376={'params':{'folder':_0x22abd3(0xbc),'file':_0x22abd3(0xa7)}};await fse[_0x22abd3(0x8c)](path[_0x22abd3(0x99)](gladys[_0x22abd3(0xb2)][_0x22abd3(0x9d)],_0x526011[_0x22abd3(0x93)])),await fse[_0x22abd3(0x9a)](path[_0x22abd3(0x99)](gladys[_0x22abd3(0xb2)][_0x22abd3(0x9d)],_0x526011[_0x22abd3(0x93)],_0x22abd3(0xa7)),_0x22abd3(0xc1));const _0x4510bd=fse[_0x22abd3(0xb9)](path['join'](gladys['config']['tempFolder'],_0x22abd3(0xbc),'result.txt'));await _0x4920dc[_0x22abd3(0x92)]['controller'](_0x1df376,_0x4510bd);}),new AsyncFunction(_0x526011['gwZtk'])(),it(_0x526011[_0x37fc4c(0xc2)],async()=>{const _0x2f51cf=_0x37fc4c,_0x43b17f=RtspCameraControllerWithFsMocked(gladys,rtspCameraService),_0x28ceff={'params':{'folder':_0x2f51cf(0xbc),'file':_0x2f51cf(0xbd)}},_0x680d6f=fse['createWriteStream'](path['join'](gladys[_0x2f51cf(0xb2)]['tempFolder'],_0x2f51cf(0xbc),_0x526011[_0x2f51cf(0x8f)])),_0x5114d6=fake[_0x2f51cf(0x97)](null);_0x680d6f[_0x2f51cf(0xba)]=fake['returns']({'end':_0x5114d6}),await _0x43b17f[_0x526011[_0x2f51cf(0xc8)]]['controller'](_0x28ceff,_0x680d6f),assert[_0x2f51cf(0xb1)](_0x680d6f[_0x2f51cf(0xba)],0x194),assert[_0x2f51cf(0x84)](_0x5114d6);}),new Function(_0x37fc4c(0xc7))(),_0x526011['wYxZQ'](it,_0x37fc4c(0x9e),async()=>{const _0x128ac3=_0x37fc4c,_0x22a323=_0x526011[_0x128ac3(0xa3)](RtspCameraController,gladys,rtspCameraService),_0x4f32cf={},_0x168d45={},_0xf98030=_0x22a323[_0x128ac3(0x92)][_0x128ac3(0x9b)](_0x4f32cf,_0x168d45);await chaiAssert['isRejected'](_0xf98030,'FILE_NOT_FOUND');});});