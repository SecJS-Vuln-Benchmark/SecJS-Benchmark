'use strict';function _0x4e9d(){const _0x1ee5cd=['get','rejects','198xOOcGY','mwowA','rOWuh','generateCsrf','Validate\x20presence\x20of\x20hmac\x20key\x20with\x20User-Info\x20/3','BabWm','242670fIhkSZ','fastify','1DTBFbD','statusCode','csrfProtection','OYsPi','33BYERTy','NHccm','Session\x20with\x20User-Info','a42','value','inject','hGxYS','body','aHTSQ','tap','session','ilYuW','Rsphh','Validate\x20presence\x20of\x20hmac\x20key\x20with\x20User-Info\x20/2','set','repeat','crypto_secretbox_KEYBYTES','alloc','HsKMO','18DJZUOu','zlxzt','123636RYzuhb','cookies','nGIJf','781384MswWAx','equal','resolves','Validate\x20presence\x20of\x20hmac\x20key\x20with\x20User-Info\x20/1','post','@fastify/secure-session','sRrnv','ekAQR','VzSqa','json','/login','username','28575xxLgjT','ClTKK','foo','Cookies\x20with\x20User-Info','779940AKrUBy','register','@fastify/cookie','csrfOpts.hmacKey\x20is\x20required','xxCKo','randombytes_buf','QBZok','DlHYy','Validate\x20presence\x20of\x20hmac\x20key\x20with\x20User-Info\x20/4','POST','147631CrLMai','33148UHgWsB','@fastify/session','kvAWF'];_0x4e9d=function(){return _0x1ee5cd;};return _0x4e9d();}function _0x30a3(_0x430728,_0x53859c){const _0x4e9d08=_0x4e9d();return _0x30a3=function(_0x30a3c3,_0x2f9db4){_0x30a3c3=_0x30a3c3-0x1c5;let _0x4da4fa=_0x4e9d08[_0x30a3c3];return _0x4da4fa;},_0x30a3(_0x430728,_0x53859c);}const _0x52e687=_0x30a3;(function(_0x1e341d,_0x8e1e84){const _0x745e04=_0x30a3,_0x341b4a=_0x1e341d();while(!![]){try{const _0x3a5b66=-parseInt(_0x745e04(0x201))/0x1*(parseInt(_0x745e04(0x1d6))/0x2)+parseInt(_0x745e04(0x205))/0x3*(parseInt(_0x745e04(0x1f4))/0x4)+parseInt(_0x745e04(0x1e5))/0x5*(-parseInt(_0x745e04(0x1f9))/0x6)+parseInt(_0x745e04(0x1e9))/0x7+parseInt(_0x745e04(0x1d9))/0x8*(parseInt(_0x745e04(0x1d4))/0x9)+-parseInt(_0x745e04(0x1ff))/0xa+-parseInt(_0x745e04(0x1f3))/0xb;if(_0x3a5b66===_0x8e1e84)break;else _0x341b4a['push'](_0x341b4a['shift']());}catch(_0x5e5072){_0x341b4a['push'](_0x341b4a['shift']());}}}(_0x4e9d,0x1acfe));const {test}=require(_0x52e687(0x1ca)),Fastify=require(_0x52e687(0x200)),fastifyCookie=require(_0x52e687(0x1eb)),fastifySession=require('@fastify/session'),fastifySecureSession=require(_0x52e687(0x1de)),fastifyCsrf=require('../'),sodium=require('sodium-native'),key=Buffer[_0x52e687(0x1d2)](sodium[_0x52e687(0x1d1)]);sodium[_0x52e687(0x1ee)](key),test(_0x52e687(0x1e8),async _0x554969=>{const _0x40a74e=_0x52e687,_0x1408f4={'xxCKo':function(_0x587ffe){return _0x587ffe();},'OYsPi':_0x40a74e(0x1e7),'ClTKK':_0x40a74e(0x1e3),'QBZok':'POST'},_0x1207ac=_0x1408f4[_0x40a74e(0x1ed)](Fastify);await _0x1207ac[_0x40a74e(0x1ea)](fastifyCookie),await _0x1207ac[_0x40a74e(0x1ea)](fastifyCsrf,{'getUserInfo'(_0x5de514){const _0x154619=_0x40a74e;return _0x24236[_0x5de514[_0x154619(0x1c8)][_0x154619(0x1e4)]];},'csrfOpts':{'hmacKey':_0x1408f4[_0x40a74e(0x204)]}});const _0x24236={'foo':_0x40a74e(0x208)};_0x1207ac['post'](_0x1408f4[_0x40a74e(0x1e6)],async(_0x1aa175,_0x200979)=>{const _0x30a12b=_0x40a74e,_0x2c817c=await _0x200979[_0x30a12b(0x1fc)]({'userInfo':_0x24236[_0x1aa175[_0x30a12b(0x1c8)][_0x30a12b(0x1e4)]]});return{'token':_0x2c817c};}),_0x1207ac[_0x40a74e(0x1dd)]('/',{'preHandler':_0x1207ac['csrfProtection']},async(_0x4acf31,_0x51c83a)=>{const _0x59f7f6=_0x40a74e;return _0x4acf31[_0x59f7f6(0x1c8)];});const _0xac8471=await _0x1207ac[_0x40a74e(0x1c6)]({'method':_0x40a74e(0x1f2),'path':_0x1408f4[_0x40a74e(0x1e6)],'body':{'username':_0x1408f4[_0x40a74e(0x204)]}});_0x554969['equal'](_0xac8471[_0x40a74e(0x202)],0xc8);const _0x47e109=_0xac8471[_0x40a74e(0x1d7)][0x0],{token:_0x1e7c60}=_0xac8471[_0x40a74e(0x1e2)](),_0x54eafb=await _0x1207ac[_0x40a74e(0x1c6)]({'method':_0x1408f4[_0x40a74e(0x1ef)],'path':'/','cookies':{'_csrf':_0x47e109[_0x40a74e(0x1c5)]},'body':{'_csrf':_0x1e7c60,'username':_0x40a74e(0x1e7)}});_0x554969[_0x40a74e(0x1da)](_0x54eafb['statusCode'],0xc8);}),test(_0x52e687(0x207),async _0x4aefe9=>{const _0x24007d=_0x52e687,_0x401641={'BIJlO':function(_0x2c734b){return _0x2c734b();},'ilYuW':_0x24007d(0x1f5),'HsKMO':'foo','kYTqH':_0x24007d(0x1e3),'xDEuf':_0x24007d(0x1f2)},_0x1f51ae=_0x401641['BIJlO'](Fastify);await _0x1f51ae[_0x24007d(0x1ea)](fastifyCookie),await _0x1f51ae[_0x24007d(0x1ea)](fastifySession,{'secret':'a'[_0x24007d(0x1d0)](0x20),'cookie':{'path':'/','secure':![]}}),await _0x1f51ae[_0x24007d(0x1ea)](fastifyCsrf,{'sessionPlugin':_0x401641[_0x24007d(0x1cc)],'getUserInfo'(_0x3f2599){const _0x36d84b=_0x24007d;return _0x3f2599[_0x36d84b(0x1cb)][_0x36d84b(0x1e4)];},'csrfOpts':{'hmacKey':_0x401641[_0x24007d(0x1d3)]}}),_0x1f51ae[_0x24007d(0x1dd)]('/login',async(_0x211d4f,_0xcb2fac)=>{const _0x313233=_0x24007d;_0x211d4f[_0x313233(0x1cb)]['username']=_0x211d4f['body']['username'];const _0x3b791e=await _0xcb2fac[_0x313233(0x1fc)]({'userInfo':_0x211d4f[_0x313233(0x1c8)][_0x313233(0x1e4)]});return{'token':_0x3b791e};}),_0x1f51ae[_0x24007d(0x1dd)]('/',{'preHandler':_0x1f51ae[_0x24007d(0x203)]},async(_0x59d5c8,_0x4e61b7)=>{return _0x59d5c8['body'];});const _0x54a23e=await _0x1f51ae[_0x24007d(0x1c6)]({'method':_0x24007d(0x1f2),'path':_0x401641['kYTqH'],'body':{'username':_0x401641[_0x24007d(0x1d3)]}});_0x4aefe9['equal'](_0x54a23e[_0x24007d(0x202)],0xc8);const _0x1e7e56=_0x54a23e[_0x24007d(0x1d7)][0x0],{token:_0x505e7b}=_0x54a23e[_0x24007d(0x1e2)](),_0x280c4b=await _0x1f51ae['inject']({'method':_0x401641['xDEuf'],'path':'/','cookies':{'sessionId':_0x1e7e56['value']},'body':{'_csrf':_0x505e7b,'username':_0x401641[_0x24007d(0x1d3)]}});_0x4aefe9[_0x24007d(0x1da)](_0x280c4b[_0x24007d(0x202)],0xc8);}),test('SecureSession\x20with\x20User-Info',async _0x200ffd=>{const _0x36c7e5=_0x52e687,_0x45334b={'hGxYS':_0x36c7e5(0x1e4),'UWerP':_0x36c7e5(0x1fb),'nGIJf':function(_0x60e9dc){return _0x60e9dc();},'zlxzt':_0x36c7e5(0x1f2),'VzSqa':_0x36c7e5(0x1e3),'mwowA':_0x36c7e5(0x1e7)},_0x1ed882=_0x45334b[_0x36c7e5(0x1d8)](Fastify);await _0x1ed882[_0x36c7e5(0x1ea)](fastifySecureSession,{'key':key,'cookie':{'path':'/','secure':![]}}),await _0x1ed882[_0x36c7e5(0x1ea)](fastifyCsrf,{'sessionPlugin':'@fastify/secure-session','getUserInfo'(_0x4c450c){const _0x1916b0=_0x36c7e5;return _0x4c450c['session'][_0x1916b0(0x1f7)](_0x45334b[_0x1916b0(0x1c7)]);},'csrfOpts':{'hmacKey':'foo'}}),_0x1ed882[_0x36c7e5(0x1dd)](_0x36c7e5(0x1e3),async(_0x1470e0,_0x595e0c)=>{const _0x469cb5=_0x36c7e5;_0x1470e0['session'][_0x469cb5(0x1cf)](_0x469cb5(0x1e4),_0x1470e0['body'][_0x469cb5(0x1e4)]);const _0x113789=await _0x595e0c['generateCsrf']({'userInfo':_0x1470e0['body'][_0x469cb5(0x1e4)]});return{'token':_0x113789};}),_0x1ed882[_0x36c7e5(0x1dd)]('/',{'preHandler':_0x1ed882[_0x36c7e5(0x203)]},async(_0x3684e5,_0x47bf96)=>{const _0x402581=_0x36c7e5;return _0x45334b['UWerP']!==_0x402581(0x1fb)?_0xae04bf[_0x402581(0x1cb)]['get'](_0x45334b['hGxYS']):_0x3684e5[_0x402581(0x1c8)];});const _0x506b78=await _0x1ed882[_0x36c7e5(0x1c6)]({'method':_0x45334b[_0x36c7e5(0x1d5)],'path':_0x45334b[_0x36c7e5(0x1e1)],'body':{'username':_0x36c7e5(0x1e7)}});_0x200ffd[_0x36c7e5(0x1da)](_0x506b78[_0x36c7e5(0x202)],0xc8);const _0x5dee0c=_0x506b78[_0x36c7e5(0x1d7)][0x0],{token:_0x109c00}=_0x506b78[_0x36c7e5(0x1e2)](),_0x20b401=await _0x1ed882['inject']({'method':_0x45334b[_0x36c7e5(0x1d5)],'path':'/','cookies':{'session':_0x5dee0c[_0x36c7e5(0x1c5)]},'body':{'_csrf':_0x109c00,'username':_0x45334b[_0x36c7e5(0x1fa)]}});_0x200ffd[_0x36c7e5(0x1da)](_0x20b401['statusCode'],0xc8);}),test(_0x52e687(0x1dc),async _0x2defa0=>{const _0x49e249=_0x52e687,_0x56c238={'DlHYy':_0x49e249(0x1e4),'sRrnv':function(_0x28829e,_0x4a8ce8){return _0x28829e(_0x4a8ce8);}},_0xe6d081=Fastify();await _0xe6d081[_0x49e249(0x1ea)](fastifyCookie),await _0x2defa0['rejects'](_0xe6d081[_0x49e249(0x1ea)](fastifyCsrf,{'getUserInfo'(_0x2af2b3){const _0x53470f=_0x49e249;return _0x2af2b3[_0x53470f(0x1cb)][_0x53470f(0x1f7)](_0x56c238[_0x53470f(0x1f0)]);}}),_0x56c238[_0x49e249(0x1df)](Error,_0x49e249(0x1ec)));}),test(_0x52e687(0x1ce),async _0x547c85=>{const _0x27847e=_0x52e687,_0x259fe0={'Rsphh':'@fastify/cookie','NHccm':function(_0x56e249,_0x526e3c){return _0x56e249(_0x526e3c);},'ekAQR':_0x27847e(0x1ec)},_0x55f86f=Fastify();await _0x55f86f[_0x27847e(0x1ea)](fastifyCookie),await _0x547c85[_0x27847e(0x1f8)](_0x55f86f['register'](fastifyCsrf,{'getUserInfo'(_0x10c363){const _0x83ae06=_0x27847e;return _0x10c363[_0x83ae06(0x1cb)][_0x83ae06(0x1f7)]('username');},'sessionPlugin':_0x259fe0[_0x27847e(0x1cd)]}),_0x259fe0[_0x27847e(0x206)](Error,_0x259fe0[_0x27847e(0x1e0)]));}),test(_0x52e687(0x1fd),async _0xb8c0a5=>{const _0x18ef45=_0x52e687,_0x311e57={'Eckka':_0x18ef45(0x1e4),'BabWm':_0x18ef45(0x1ec)},_0x340660=Fastify();await _0x340660[_0x18ef45(0x1ea)](fastifyCookie),await _0xb8c0a5['rejects'](_0x340660[_0x18ef45(0x1ea)](fastifyCsrf,{'getUserInfo'(_0x286b69){const _0xd89f34=_0x18ef45;return _0x286b69[_0xd89f34(0x1cb)][_0xd89f34(0x1f7)](_0x311e57['Eckka']);},'csrfOpts':{'hmacKey':undefined}}),Error(_0x311e57[_0x18ef45(0x1fe)]));}),test(_0x52e687(0x1f1),async _0x2554cd=>{const _0x4edb1b=_0x52e687,_0x246fce={'kvAWF':function(_0x1c4041,_0x1572af){return _0x1c4041(_0x1572af);},'jlAmj':_0x4edb1b(0x1ec)},_0x1708e9=Fastify();await _0x1708e9[_0x4edb1b(0x1ea)](fastifyCookie),await _0x2554cd[_0x4edb1b(0x1f8)](_0x1708e9[_0x4edb1b(0x1ea)](fastifyCsrf,{'getUserInfo'(_0x54e690){const _0x4278b0=_0x4edb1b;return _0x54e690['session'][_0x4278b0(0x1f7)](_0x4278b0(0x1e4));},'sessionPlugin':_0x4edb1b(0x1eb),'csrfOpts':{'hmacKey':undefined}}),_0x246fce[_0x4edb1b(0x1f6)](Error,_0x246fce['jlAmj']));}),test('Validate\x20presence\x20of\x20hmac\x20key\x20with\x20User-Info\x20/5',async _0x3f7f35=>{const _0x57ec9b=_0x52e687,_0x21bdbc={'CDTci':function(_0x4ae7a2){return _0x4ae7a2();}},_0x5d95d5=_0x21bdbc['CDTci'](Fastify);await _0x5d95d5[_0x57ec9b(0x1ea)](fastifySecureSession,{'key':key,'cookie':{'path':'/','secure':![]}}),await _0x3f7f35[_0x57ec9b(0x1db)](_0x5d95d5['register'](fastifyCsrf,{'getUserInfo'(_0x786da9){const _0x5f49ce=_0x57ec9b;return _0x786da9[_0x5f49ce(0x1cb)][_0x5f49ce(0x1f7)](_0x5f49ce(0x1e4));},'sessionPlugin':_0x57ec9b(0x1de)}));}),test('Validate\x20presence\x20of\x20hmac\x20key\x20with\x20User-Info\x20/6',async _0x6fb282=>{const _0x267206=_0x52e687,_0x2e22f6={'aHTSQ':function(_0x5aa63e){return _0x5aa63e();}},_0x30958d=_0x2e22f6[_0x267206(0x1c9)](Fastify);await _0x30958d[_0x267206(0x1ea)](fastifySecureSession,{'key':key,'cookie':{'path':'/','secure':![]}}),await _0x6fb282['resolves'](_0x30958d[_0x267206(0x1ea)](fastifyCsrf,{'getUserInfo'(_0x5f06c4){const _0x15d5dd=_0x267206;return _0x5f06c4[_0x15d5dd(0x1cb)][_0x15d5dd(0x1f7)](_0x15d5dd(0x1e4));},'sessionPlugin':_0x267206(0x1de),'csrfOpts':{'hmacKey':_0x267206(0x1e7)}}));});