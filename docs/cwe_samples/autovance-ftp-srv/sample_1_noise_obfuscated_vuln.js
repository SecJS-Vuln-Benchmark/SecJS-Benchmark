const _0x50186b=_0x53e7;(function(_0x13a817,_0x49c1f9){const _0x532949=_0x53e7,_0xa72816=_0x13a817();while(!![]){try{const _0x127485=-parseInt(_0x532949(0x112))/0x1+-parseInt(_0x532949(0xee))/0x2+parseInt(_0x532949(0xd0))/0x3+parseInt(_0x532949(0xc7))/0x4*(-parseInt(_0x532949(0xd4))/0x5)+-parseInt(_0x532949(0xf9))/0x6*(parseInt(_0x532949(0xc9))/0x7)+-parseInt(_0x532949(0xef))/0x8+parseInt(_0x532949(0xfd))/0x9*(parseInt(_0x532949(0xe6))/0xa);if(_0x127485===_0x49c1f9)break;else _0xa72816['push'](_0xa72816['shift']());}catch(_0x16dd97){_0xa72816['push'](_0xa72816['shift']());}}}(_0x1863,0x3647e));const {promisify}=require(_0x50186b(0xe5)),express=require(_0x50186b(0xe9)),{assert}=require(_0x50186b(0x119))[_0x50186b(0x109)](require(_0x50186b(0xd9))),request=require(_0x50186b(0x114))[_0x50186b(0xff)]({'simple':![],'resolveWithFullResponse':!![]}),appSession=require(_0x50186b(0xda)),{get:getConfig}=require('../lib/config'),{create:createServer}=require(_0x50186b(0x10d)),redis=require(_0x50186b(0xeb)),RedisStore=require('connect-redis')({'Store':class Store{}}),defaultConfig={'clientID':_0x50186b(0x130),'clientSecret':'__test_client_secret__','issuerBaseURL':'https://op.example.com','baseURL':'http://example.org','secret':_0x50186b(0x10a),'errorOnRequiredAuth':!![]},sessionData=()=>{const _0xb23348=_0x50186b,_0x346270={'HpTPL':function(_0x30df4f,_0x1dc747){return _0x30df4f*_0x1dc747;},'fBMje':'return\x20new\x20Date();'},_0x598c1a=()=>Date[_0xb23348(0x10e)]()/0x3e8|0x0,_0x1d1561=_0x598c1a(),_0x559b89=_0x346270[_0xb23348(0x124)](0x7,0x18)*0x3c*0x3c;return Function(_0x346270[_0xb23348(0x12e)])(),JSON['stringify']({'header':{'uat':_0x1d1561,'iat':_0x1d1561,'exp':_0x1d1561+_0x559b89},'data':{'sub':_0xb23348(0x11c)}});},login=async _0x52425f=>{const _0x240cfc=_0x50186b,_0x493990={'oAcQs':function(_0x55b009,_0x185e9a){return _0x55b009(_0x185e9a);}},_0x27525d=request[_0x240cfc(0xfc)]();return await request[_0x240cfc(0x126)]('/session',{'baseUrl':baseUrl,'jar':_0x27525d,'json':_0x52425f}),_0x493990[_0x240cfc(0xf8)](Function,_0x240cfc(0x12c))(),_0x27525d;},baseUrl=_0x50186b(0x106);function _0x1863(){const _0x2dd291=['statusCode','appSession\x20custom\x20store','use','__test_secret__','iFMVi','CtpOM','./fixture/server','now','should\x20get\x20an\x20existing\x20session','TMmTk','xnAAP','33205SmNAto','asyncGet','request-promise-native','close','deepEqual','get','OEVCQ','chai','HTfcS','body','__test_sub__','__foo_user__','eBCIU','MchOe','ovkwZ','kvixa','listen','quit','HpTPL','zKxyZ','post','stringify','asyncSet','cCXOB','XSWDf','foo','return\x20Object.keys({a:1});','/session','fBMje','EZaMM','__test_client_id__','139652FEGQyf','tfbOo','133693VpMDkn','equal','Nimmg','UgQjR','appSession=__invalid_identity__','VJrdF','kOZZk','1069347SidfSP','rlPyc','apple','XkvTt','15qbrpWP','message','vvkgK','bind','nextTick','chai-as-promised','../lib/appSession','return\x20new\x20Date();','xJJSY','qqwrD','qIWMq','uRieP','isEmpty','aMbDY','appSession=foo','createClient','storage\x20error','util','11030obEwwc','set','qeRgR','express','should\x20not\x20error\x20for\x20non\x20existent\x20sessions','redis-mock','lteef','should\x20destroy\x20an\x20existing\x20session','882090uPWMpG','1336064qqtiuZ','IWYTG','should\x20not\x20create\x20a\x20session\x20when\x20there\x20are\x20no\x20cookies','EUzpS','ZeXLQ','getCookies','parse','writeHead','headersSent','oAcQs','138fRjkPg','ujKFq','XfUiu','jar','8577grGieU','ZpcMb','defaults','appSession','deepInclude','becomes','err','uses\x20custom\x20session\x20id\x20generator\x20when\x20provided','TEWYy','http://localhost:3000'];_0x1863=function(){return _0x2dd291;};return _0x1863();}function _0x53e7(_0x2ae300,_0x1fe0e2){const _0x18632e=_0x1863();return _0x53e7=function(_0x53e786,_0x1edb7c){_0x53e786=_0x53e786-0xc7;let _0x11ee11=_0x18632e[_0x53e786];return _0x11ee11;},_0x53e7(_0x2ae300,_0x1fe0e2);}describe(_0x50186b(0x108),()=>{const _0xfb6e22=_0x50186b,_0x289cb5={'IWYTG':function(_0x2b0b49,_0xf2561c){return _0x2b0b49(_0xf2561c);},'qIWMq':function(_0x4212ac,_0x14406e){return _0x4212ac(_0x14406e);},'zKxyZ':function(_0x4bc941,_0x1cb77b){return _0x4bc941(_0x1cb77b);},'XSWDf':function(_0x8ac3,_0x16ecda){return _0x8ac3(_0x16ecda);},'MchOe':function(_0x3e1d73,_0x108bcc){return _0x3e1d73*_0x108bcc;},'Nimmg':function(_0x5b5dd1,_0x2d56cf){return _0x5b5dd1!==_0x2d56cf;},'OEVCQ':_0xfb6e22(0xfa),'cCXOB':function(_0x157eec){return _0x157eec();},'uRieP':_0xfb6e22(0x12d),'XkvTt':function(_0x4df212){return _0x4df212();},'EUzpS':_0xfb6e22(0xdd),'iTIuG':'djBDe','ovkwZ':function(_0x1d8d96){return _0x1d8d96();},'ZeXLQ':_0xfb6e22(0x12b),'EZaMM':'__test_sub__','rlPyc':function(_0x268443,_0x2e007e){return _0x268443(_0x2e007e);},'TEWYy':_0xfb6e22(0x11d),'kvixa':function(_0x210c37,_0x482df6){return _0x210c37===_0x482df6;},'HTfcS':_0xfb6e22(0xe8),'eBCIU':_0xfb6e22(0xd2),'CtpOM':'test','XfUiu':'storage\x20error','vvkgK':_0xfb6e22(0xec),'tfbOo':function(_0x23691c,_0x3231fc){return _0x23691c(_0x3231fc);},'ZpcMb':function(_0x4d6c66,_0x42f9e7,_0x583234){return _0x4d6c66(_0x42f9e7,_0x583234);},'kxeGs':'should\x20get\x20a\x20new\x20session','kOZZk':function(_0x3fc7d6,_0x4930c2,_0x5295ca){return _0x3fc7d6(_0x4930c2,_0x5295ca);},'xJJSY':'should\x20handle\x20storage\x20errors','UgQjR':function(_0x261982,_0xe4f29d,_0x274865){return _0x261982(_0xe4f29d,_0x274865);}};let _0x396021,_0x16bb38;const _0xe2389f=async _0x2b1c66=>{const _0x406adb=_0xfb6e22;_0x16bb38=redis[_0x406adb(0xe3)]();const _0x2bb74e=new RedisStore({'client':_0x16bb38,'prefix':''});_0x16bb38[_0x406adb(0x128)]=promisify(_0x16bb38['set'])[_0x406adb(0xd7)](_0x16bb38),_0x16bb38[_0x406adb(0x113)]=_0x289cb5[_0x406adb(0xf0)](promisify,_0x16bb38[_0x406adb(0x117)])[_0x406adb(0xd7)](_0x16bb38);const _0x44f939=_0x289cb5[_0x406adb(0xde)](getConfig,{...defaultConfig,..._0x2b1c66,'session':{..._0x2b1c66&&_0x2b1c66['session'],'store':_0x2bb74e}});_0x396021=await _0x289cb5[_0x406adb(0x125)](createServer,_0x289cb5[_0x406adb(0x12a)](appSession,_0x44f939));};_0x289cb5[_0xfb6e22(0xc8)](afterEach,async()=>{const _0x47026b=_0xfb6e22,_0xf48b3={'TMmTk':function(_0xc55b3b,_0x45b639){const _0x296e9e=_0x53e7;return _0x289cb5[_0x296e9e(0x11f)](_0xc55b3b,_0x45b639);},'bOLdU':_0x47026b(0xdb)};if(_0x396021){if(_0x289cb5[_0x47026b(0xcb)]('OPpKV',_0x289cb5[_0x47026b(0x118)]))await new Promise(_0x5472a6=>_0x396021[_0x47026b(0x115)](_0x5472a6));else{const _0x4846d7=()=>_0x5adc00[_0x47026b(0x10e)]()/0x3e8|0x0,_0xdbbd95=_0x4846d7(),_0x4980de=_0xf48b3['TMmTk'](_0xf48b3[_0x47026b(0x110)](0x7,0x18),0x3c)*0x3c;return _0x4a912d(_0xf48b3['bOLdU'])(),_0x250afa[_0x47026b(0x127)]({'header':{'uat':_0xdbbd95,'iat':_0xdbbd95,'exp':_0xdbbd95+_0x4980de},'data':{'sub':_0x47026b(0x11c)}});}}_0x16bb38&&await new Promise(_0x1724c6=>_0x16bb38[_0x47026b(0x123)](_0x1724c6));}),_0x289cb5[_0xfb6e22(0xfe)](it,_0xfb6e22(0xf1),async()=>{const _0x291fd0=_0xfb6e22;await _0x289cb5[_0x291fd0(0x129)](_0xe2389f);const _0x5b57d2=await request[_0x291fd0(0x117)](_0x289cb5[_0x291fd0(0xdf)],{'baseUrl':baseUrl,'json':!![]});assert[_0x291fd0(0xe0)](_0x5b57d2[_0x291fd0(0x11b)]);}),_0x289cb5[_0xfb6e22(0xfe)](it,_0xfb6e22(0xea),async()=>{const _0x2434a6=_0xfb6e22;await _0x289cb5[_0x2434a6(0xd3)](_0xe2389f);const _0xbda6e3=await request['get'](_0x289cb5[_0x2434a6(0xdf)],{'baseUrl':baseUrl,'json':!![],'headers':{'cookie':_0x2434a6(0xcd)}});assert[_0x2434a6(0xca)](_0xbda6e3[_0x2434a6(0x107)],0xc8),assert[_0x2434a6(0xe0)](_0xbda6e3[_0x2434a6(0x11b)]);}),it(_0xfb6e22(0x10f),async()=>{const _0x514514=_0xfb6e22;if(_0x289cb5[_0x514514(0xf2)]===_0x289cb5['iTIuG']){const _0x262534=_0x158a24[_0x514514(0x122)](0xbb8,()=>_0x527916(_0x262534));}else{await _0x289cb5[_0x514514(0x120)](_0xe2389f),await _0x16bb38[_0x514514(0x128)](_0x289cb5['ZeXLQ'],_0x289cb5[_0x514514(0x129)](sessionData));const _0x2ebeb9=request['jar'](),_0x4aef94=await request[_0x514514(0x117)](_0x289cb5['uRieP'],{'baseUrl':baseUrl,'jar':_0x2ebeb9,'json':!![],'headers':{'cookie':'appSession=foo'}});assert[_0x514514(0xca)](_0x4aef94['statusCode'],0xc8),assert[_0x514514(0x116)](_0x4aef94[_0x514514(0x11b)],{'sub':_0x289cb5[_0x514514(0x12f)]});const [_0x55007f]=_0x2ebeb9[_0x514514(0xf4)](baseUrl);assert[_0x514514(0x101)](_0x55007f,{'key':_0x514514(0x100),'value':_0x514514(0x12b)});}}),it(_0x289cb5['kxeGs'],async()=>{const _0x1d9d8d=_0xfb6e22;await _0x289cb5['ovkwZ'](_0xe2389f);const _0x574de8=await _0x289cb5[_0x1d9d8d(0xd1)](login,{'sub':_0x1d9d8d(0x11d)}),_0x2dee41=await request[_0x1d9d8d(0x117)](_0x1d9d8d(0x12d),{'baseUrl':baseUrl,'jar':_0x574de8,'json':!![]});assert['equal'](_0x2dee41[_0x1d9d8d(0x107)],0xc8),assert[_0x1d9d8d(0x116)](_0x2dee41['body'],{'sub':_0x289cb5[_0x1d9d8d(0x105)]});}),it(_0xfb6e22(0xed),async()=>{const _0x252ee8=_0xfb6e22;await _0x289cb5['rlPyc'](_0xe2389f,{'idpLogout':![]}),await _0x16bb38[_0x252ee8(0x128)](_0x289cb5[_0x252ee8(0xf3)],_0x289cb5['ovkwZ'](sessionData));const _0x3cc9df=request[_0x252ee8(0xfc)](),_0x54ad0b=await request[_0x252ee8(0x117)](_0x252ee8(0x12d),{'baseUrl':baseUrl,'jar':_0x3cc9df,'json':!![],'headers':{'cookie':'appSession=foo'}});assert[_0x252ee8(0x116)](_0x54ad0b['body'],{'sub':_0x252ee8(0x11c)}),await request[_0x252ee8(0x126)](_0x289cb5[_0x252ee8(0xdf)],{'baseUrl':baseUrl,'jar':_0x3cc9df,'json':{}});const _0x8fabed=await request[_0x252ee8(0x117)](_0x289cb5[_0x252ee8(0xdf)],{'baseUrl':baseUrl,'jar':_0x3cc9df,'json':!![]});assert[_0x252ee8(0xe0)](_0x8fabed[_0x252ee8(0x11b)]),assert['isEmpty'](_0x3cc9df[_0x252ee8(0xf4)](baseUrl));}),it(_0xfb6e22(0x104),async()=>{const _0x2c2e8f=_0xfb6e22;if(_0x289cb5[_0x2c2e8f(0x121)](_0x2c2e8f(0xe8),_0x289cb5[_0x2c2e8f(0x11a)])){const _0x30d673=_0x289cb5[_0x2c2e8f(0x11e)];await _0xe2389f({'session':{'genid':()=>_0x30d673}});const _0x112808=await login({'sub':'__foo_user__','role':_0x289cb5[_0x2c2e8f(0x10c)],'userid':_0x30d673}),_0xdf5295=await request[_0x2c2e8f(0x117)](_0x289cb5[_0x2c2e8f(0xdf)],{'baseUrl':baseUrl,'jar':_0x112808,'json':!![]});assert['equal'](_0xdf5295[_0x2c2e8f(0x107)],0xc8);const _0x3b126e=await _0x16bb38[_0x2c2e8f(0x113)](_0x30d673),{data:_0x24686e}=JSON[_0x2c2e8f(0xf5)](_0x3b126e);assert[_0x2c2e8f(0x116)](_0x24686e,{'sub':_0x289cb5[_0x2c2e8f(0x105)],'role':_0x289cb5[_0x2c2e8f(0x10c)],'userid':_0x30d673});}else!_0x330407[_0x2c2e8f(0xf7)]&&_0x111b1c[_0x2c2e8f(0xf6)](0xc8),_0x109c81();}),_0x289cb5[_0xfb6e22(0xcf)](it,_0x289cb5[_0xfb6e22(0xdc)],async()=>{const _0x37a55e=_0xfb6e22,_0x19a70f={'WNvUp':function(_0x39fd53,_0x1f4fcb){return _0x39fd53!==_0x1f4fcb;},'VJrdF':_0x37a55e(0xe1)},_0x18e69f={'get'(_0x291feb,_0x1413c0){const _0x49a952=_0x37a55e;process['nextTick'](()=>_0x1413c0(null,JSON[_0x49a952(0xf5)](sessionData())));},async 'set'(_0x3a8c88,_0x35198e,_0x259d2d){const _0x4d7101=_0x37a55e;_0x19a70f['WNvUp'](_0x19a70f[_0x4d7101(0xce)],_0x4d7101(0x10b))?process['nextTick'](()=>_0x259d2d(new Error('storage\x20error'))):_0x46468c[_0x4d7101(0xd8)](()=>_0x9c6e1());},async 'destroy'(_0x119f9d,_0x5c25d9){const _0x5c5b20=_0x37a55e;process[_0x5c5b20(0xd8)](()=>_0x5c25d9());}},_0x2fa17e=getConfig({...defaultConfig,'session':{'store':_0x18e69f}});_0x396021=await _0x289cb5[_0x37a55e(0xd1)](createServer,appSession(_0x2fa17e));const _0x1023b3=request[_0x37a55e(0xfc)](),_0x157697=await request['get']('/session',{'baseUrl':baseUrl,'jar':_0x1023b3,'json':!![],'headers':{'cookie':_0x37a55e(0xe2)}});assert[_0x37a55e(0xca)](_0x157697[_0x37a55e(0x107)],0x1f4),assert['equal'](_0x157697[_0x37a55e(0x11b)][_0x37a55e(0x103)][_0x37a55e(0xd5)],_0x289cb5[_0x37a55e(0xfb)]);}),_0x289cb5[_0xfb6e22(0xcc)](it,'should\x20not\x20throw\x20if\x20another\x20mw\x20writes\x20the\x20header',async()=>{const _0x32e1f9=_0xfb6e22,_0x588b9f=express();_0x16bb38=redis['createClient']();const _0x5b9081=new RedisStore({'client':_0x16bb38,'prefix':''});await promisify(_0x16bb38[_0x32e1f9(0xe7)])[_0x32e1f9(0xd7)](_0x16bb38)(_0x289cb5[_0x32e1f9(0xf3)],_0x289cb5[_0x32e1f9(0xd3)](sessionData)),_0x588b9f[_0x32e1f9(0x109)](appSession(getConfig({...defaultConfig,'session':{'store':_0x5b9081}}))),_0x588b9f[_0x32e1f9(0x117)]('/',(_0x5b7f5c,_0x1201f6,_0x486b0c)=>{_0x1201f6['json'](_0x5b7f5c['appSession']),_0x486b0c();}),_0x588b9f['use']((_0x4d37af,_0x25acfe,_0x4fb524)=>{const _0x24985f=_0x32e1f9;_0x24985f(0x111)!==_0x289cb5[_0x24985f(0xd6)]?(!_0x25acfe['headersSent']&&_0x25acfe[_0x24985f(0xf6)](0xc8),_0x4fb524()):_0x139bd0['nextTick'](()=>_0x3641c3(new _0x3452cb(_0x24985f(0xe4))));}),_0x396021=await new Promise(_0x2da0e0=>{const _0x1aec0e=_0x32e1f9,_0x5277db=_0x588b9f[_0x1aec0e(0x122)](0xbb8,()=>_0x2da0e0(_0x5277db));}),await assert[_0x32e1f9(0x102)](request[_0x32e1f9(0x117)]('/',{'baseUrl':baseUrl,'json':!![],'headers':{'cookie':_0x32e1f9(0xe2)},'resolveWithFullResponse':![]}),{'sub':_0x32e1f9(0x11c)});});});