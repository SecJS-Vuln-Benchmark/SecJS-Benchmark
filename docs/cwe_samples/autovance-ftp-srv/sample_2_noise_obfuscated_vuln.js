function _0x198c(_0x4a2c3a,_0x511b12){const _0x425921=_0x4259();return _0x198c=function(_0x198cad,_0x37f511){_0x198cad=_0x198cad-0x17d;let _0x37104a=_0x425921[_0x198cad];return _0x37104a;},_0x198c(_0x4a2c3a,_0x511b12);}const _0x3223af=_0x198c;(function(_0x2387b4,_0x30e86b){const _0x1e1297=_0x198c,_0x399ec3=_0x2387b4();while(!![]){try{const _0x2ce7e0=parseInt(_0x1e1297(0x1d9))/0x1+parseInt(_0x1e1297(0x1ad))/0x2*(-parseInt(_0x1e1297(0x1d5))/0x3)+parseInt(_0x1e1297(0x1cf))/0x4+-parseInt(_0x1e1297(0x22a))/0x5*(parseInt(_0x1e1297(0x1ef))/0x6)+-parseInt(_0x1e1297(0x1e2))/0x7+parseInt(_0x1e1297(0x212))/0x8+parseInt(_0x1e1297(0x216))/0x9;if(_0x2ce7e0===_0x30e86b)break;else _0x399ec3['push'](_0x399ec3['shift']());}catch(_0xd5b1cc){_0x399ec3['push'](_0x399ec3['shift']());}}}(_0x4259,0xe3e53));const assert=require('chai')[_0x3223af(0x1e8)],sinon=require(_0x3223af(0x1e6)),jose=require('jose'),request=require(_0x3223af(0x242))[_0x3223af(0x1b6)]({'simple':![],'resolveWithFullResponse':!![]}),TransientCookieHandler=require(_0x3223af(0x19c)),{encodeState}=require(_0x3223af(0x204)),{auth}=require('..'),{create:createServer}=require('./fixture/server'),{makeIdToken}=require(_0x3223af(0x1de)),clientID=_0x3223af(0x19d),expectedDefaultState=encodeState({'returnTo':'https://example.org'}),nock=require(_0x3223af(0x192)),baseUrl='http://localhost:3000',defaultConfig={'secret':'__test_session_secret__','clientID':clientID,'baseURL':_0x3223af(0x20f),'issuerBaseURL':_0x3223af(0x202),'authRequired':![]};let server;const generateCookies=_0x37bb5e=>({'auth_verification':JSON[_0x3223af(0x1f0)](_0x37bb5e)}),setup=async _0x28e50a=>{const _0xe52ce2=_0x3223af,_0x59e8b1={'OyTdJ':function(_0xf2f86a,_0x38674c){return _0xf2f86a===_0x38674c;},'DeRSm':_0xe52ce2(0x207),'LLBwK':function(_0x25fef7,_0x10f87f){return _0x25fef7+_0x10f87f;},'JbAus':_0xe52ce2(0x24d),'ShOYS':_0xe52ce2(0x1f4),'cyljs':function(_0x2f62d9,_0x22a065){return _0x2f62d9!==_0x22a065;},'nYblO':_0xe52ce2(0x18d),'FAuyf':_0xe52ce2(0x1df),'AGOMM':function(_0x4f55fd,_0x3d42b5){return _0x4f55fd(_0x3d42b5);},'pnnJP':function(_0x5e6de9,_0x19cceb){return _0x5e6de9(_0x19cceb);},'IshVY':function(_0x16d140,_0x368d4c,_0x5690c9){return _0x16d140(_0x368d4c,_0x5690c9);},'jrRcN':'/callback','RZdea':_0xe52ce2(0x210),'HXDeP':_0xe52ce2(0x1c1)},_0x5c6154=Object[_0xe52ce2(0x208)]({},defaultConfig,_0x28e50a[_0xe52ce2(0x19e)]||{}),_0x135fcb=_0x28e50a['router']||_0x59e8b1[_0xe52ce2(0x20d)](auth,_0x5c6154),_0x537223=new TransientCookieHandler(_0x5c6154),_0x43469b=_0x28e50a[_0xe52ce2(0x219)]||request[_0xe52ce2(0x219)]();server=await _0x59e8b1[_0xe52ce2(0x229)](createServer,_0x135fcb);let _0x21396b,_0x48647f;Object[_0xe52ce2(0x1bd)](_0x28e50a['cookies'])[_0xe52ce2(0x1a4)](function(_0x436090){const _0x5bdef2=_0xe52ce2,_0x5c962a={'EZqSq':function(_0x49519b,_0x1c667c){const _0x3a2b9e=_0x198c;return _0x59e8b1[_0x3a2b9e(0x1e0)](_0x49519b,_0x1c667c);},'SIgfM':_0x59e8b1[_0x5bdef2(0x1a9)]};let _0xe2db07;_0x537223[_0x5bdef2(0x254)](_0x436090,{},{'cookie'(_0x5a8008,..._0x4d20a7){const _0x3df1d5=_0x5bdef2,_0x2cfb6a={'DHgVL':'Bearer'};if(_0x5c962a[_0x3df1d5(0x24e)](_0x5a8008,_0x436090)){if(_0x3df1d5(0x1c7)!==_0x5c962a['SIgfM'])_0xe2db07=_0x4d20a7[0x0];else return _0x3d1998=this[_0x3df1d5(0x23f)][_0x3df1d5(0x1c9)],_0x590e04=_0x55e7c8,new _0x4d89ba(_0x3df1d5(0x201))(),{'access_token':_0x3df1d5(0x24d),'refresh_token':'__test_refresh_token__','id_token':_0x51f5d0[_0x3df1d5(0x22b)][_0x3df1d5(0x181)],'token_type':_0x2cfb6a['DHgVL'],'expires_in':0x15180};}}},{'value':_0x28e50a['cookies'][_0x436090]}),_0x43469b[_0x5bdef2(0x1c8)](_0x436090+'='+_0xe2db07+_0x5bdef2(0x235),_0x59e8b1['LLBwK'](baseUrl,_0x5bdef2(0x256)));});const {interceptors:[_0xd82a8f]}=_0x59e8b1['IshVY'](nock,'https://op.example.com',{'allowUnmocked':!![]})[_0xe52ce2(0x1f3)]('/oauth/token')['reply'](0xc8,function(_0x167cf7,_0x285b8f){const _0x51fdf2=_0xe52ce2;return _0x21396b=this[_0x51fdf2(0x23f)][_0x51fdf2(0x1c9)],_0x48647f=_0x285b8f,new Function(_0x51fdf2(0x201))(),{'access_token':_0x59e8b1[_0x51fdf2(0x239)],'refresh_token':_0x59e8b1[_0x51fdf2(0x1da)],'id_token':_0x28e50a[_0x51fdf2(0x22b)][_0x51fdf2(0x181)],'token_type':_0x51fdf2(0x21f),'expires_in':0x15180};}),_0x17aa80=await request[_0xe52ce2(0x1f3)](_0x59e8b1[_0xe52ce2(0x1b8)],{'baseUrl':baseUrl,'jar':_0x43469b,'json':_0x28e50a[_0xe52ce2(0x22b)]}),_0x463138=await request[_0xe52ce2(0x22c)](_0x59e8b1['RZdea'],{'baseUrl':baseUrl,'jar':_0x43469b,'json':!![]})[_0xe52ce2(0x1a0)](_0x70f69f=>_0x70f69f['body']),_0x4d2521=await request[_0xe52ce2(0x22c)](_0x59e8b1[_0xe52ce2(0x18e)],{'baseUrl':baseUrl,'jar':_0x43469b,'json':!![]})['then'](_0x309ce7=>_0x309ce7['body']);return nock[_0xe52ce2(0x240)](_0xd82a8f),setTimeout(function(){const _0x1ffef8=_0xe52ce2;_0x59e8b1[_0x1ffef8(0x21c)](_0x59e8b1[_0x1ffef8(0x25c)],_0x1ffef8(0x18d))?_0x6edac5=_0x63a5e7[0x0]:console[_0x1ffef8(0x186)](_0x59e8b1[_0x1ffef8(0x19f)]);},0x64),{'baseUrl':baseUrl,'jar':_0x43469b,'response':_0x17aa80,'currentUser':_0x463138,'tokenReqHeader':_0x21396b,'tokenReqBody':_0x48647f,'tokens':_0x4d2521};};describe(_0x3223af(0x1e9),()=>{const _0x3aaa0d=_0x3223af,_0x7084c5={'aLOGO':_0x3aaa0d(0x211),'vuxPo':_0x3aaa0d(0x244),'jDllT':function(_0x375f30,_0x2d3f73){return _0x375f30(_0x2d3f73);},'nofEt':function(_0x2cd069,_0x462a89){return _0x2cd069(_0x462a89);},'wniig':_0x3aaa0d(0x18f),'kGGac':_0x3aaa0d(0x1fd),'dLNqf':_0x3aaa0d(0x251),'aTdyE':'__test_state__','SETxz':_0x3aaa0d(0x238),'NJtIs':'checks.state\x20argument\x20is\x20missing','kKDCJ':function(_0x42043e){return _0x42043e();},'tAMpM':'https://op.example.com/','IPdhE':_0x3aaa0d(0x1b4),'ukEEb':_0x3aaa0d(0x1e4),'oXaOU':_0x3aaa0d(0x1ac),'hwLtl':_0x3aaa0d(0x1ca),'wJbdZ':_0x3aaa0d(0x1f4),'BkSgl':_0x3aaa0d(0x1bb),'rkTEu':_0x3aaa0d(0x1fe),'TUsfv':_0x3aaa0d(0x260),'JRfEt':function(_0x3c5987,_0x3b3629){return _0x3c5987(_0x3b3629);},'grnSp':_0x3aaa0d(0x203),'mFbxY':function(_0x3a386a,_0x474888){return _0x3a386a*_0x474888;},'MwQTn':function(_0xce53c8,_0x11f8fe){return _0xce53c8*_0x11f8fe;},'kLzNg':function(_0xee2958,_0x24a825){return _0xee2958(_0x24a825);},'eDjBX':'code','STHst':_0x3aaa0d(0x1c1),'yQiyh':_0x3aaa0d(0x1a1),'DPrGs':function(_0x18334d,_0x59fa46,_0x31f4fb){return _0x18334d(_0x59fa46,_0x31f4fb);},'Xhygi':_0x3aaa0d(0x1ee),'BMhCD':'__new_access_token__','odsRw':_0x3aaa0d(0x18a),'LLRmH':_0x3aaa0d(0x1dc),'HqeXN':function(_0x1c0777,_0x225212){return _0x1c0777!==_0x225212;},'sMdZa':_0x3aaa0d(0x232),'HXYKA':_0x3aaa0d(0x257),'lTbWG':_0x3aaa0d(0x1ed),'PMgHx':function(_0x3ce010,_0x13e98b){return _0x3ce010(_0x13e98b);},'XNEep':_0x3aaa0d(0x214),'ernIu':_0x3aaa0d(0x24d),'LTukz':function(_0x4e598a,_0xb53de2){return _0x4e598a(_0xb53de2);},'gwvia':function(_0x6dfe96,_0x341519,_0x1bd155){return _0x6dfe96(_0x341519,_0x1bd155);},'dFdfC':_0x3aaa0d(0x1dd),'RceiP':function(_0x29bfe1,_0x3fcef9){return _0x29bfe1(_0x3fcef9);},'uLsAw':function(_0x18b7f9,_0x271c92){return _0x18b7f9(_0x271c92);},'NhEIV':_0x3aaa0d(0x1ea),'apyUU':_0x3aaa0d(0x1e5),'CsXvm':_0x3aaa0d(0x21e),'BLvLs':_0x3aaa0d(0x215),'PCbhJ':function(_0x451def,_0x2c912a){return _0x451def===_0x2c912a;},'zFlFf':'https://op.example.com','KXGUO':'/session','EWbMZ':function(_0x512dff,_0xdacb3e){return _0x512dff(_0xdacb3e);},'kIzcx':function(_0x209200,_0x28f141){return _0x209200(_0x28f141);},'jdMiL':function(_0x54905b,_0x33c5f8){return _0x54905b(_0x33c5f8);},'DrHcZ':_0x3aaa0d(0x237),'QAXLj':function(_0x623e3e,_0x13ae5b,_0x375d59){return _0x623e3e(_0x13ae5b,_0x375d59);},'mnKrW':_0x3aaa0d(0x227),'CdMFs':_0x3aaa0d(0x1aa),'yFfYk':_0x3aaa0d(0x1f1),'JaQim':function(_0x37ebda,_0x645cc2,_0x40a47c){return _0x37ebda(_0x645cc2,_0x40a47c);},'VSnZS':_0x3aaa0d(0x185),'VhAce':'should\x20error\x20when\x20legacy\x20samesite\x20fallback\x20is\x20off','hMcDF':function(_0x44fd4b,_0x498db2,_0x6864bf){return _0x44fd4b(_0x498db2,_0x6864bf);},'JjzEn':'should\x20not\x20strip\x20claims\x20when\x20using\x20custom\x20claim\x20filtering','XcnAv':function(_0x4c87fe,_0x4350b2,_0x794b33){return _0x4c87fe(_0x4350b2,_0x794b33);},'ZeOnQ':_0x3aaa0d(0x231),'JwvEx':function(_0x24562c,_0x4f3518,_0x5d28ae){return _0x24562c(_0x4f3518,_0x5d28ae);},'rJvos':function(_0x5840d4,_0x3e80fb,_0x56daa7){return _0x5840d4(_0x3e80fb,_0x56daa7);},'zpazP':function(_0x3673b8,_0x231bf3,_0x2d817f){return _0x3673b8(_0x231bf3,_0x2d817f);},'jIvHt':_0x3aaa0d(0x20c),'tKxHQ':function(_0x4b4d3c,_0xd59a1a,_0x2971d8){return _0x4b4d3c(_0xd59a1a,_0x2971d8);},'TgSHQ':_0x3aaa0d(0x1a5)};afterEach(()=>{const _0x46aca4=_0x3aaa0d;_0x7084c5['aLOGO']!==_0x46aca4(0x25d)?server&&(_0x7084c5['vuxPo']!=='ASVYJ'?server['close']():_0x19ce38===_0x4f8144&&(_0x1220f3=_0x2badc1[0x0])):_0x507ff1&&_0xfed83d['close']();}),_0x7084c5['DPrGs'](it,_0x7084c5[_0x3aaa0d(0x25b)],async()=>{const _0x465d17=_0x3aaa0d,{response:{statusCode:_0x522c15,body:{err:_0x1c0a95}}}=await _0x7084c5[_0x465d17(0x1fc)](setup,{'cookies':generateCookies({'nonce':_0x465d17(0x1fd),'state':_0x465d17(0x1ab)}),'body':!![]});assert[_0x465d17(0x233)](_0x522c15,0x190),assert[_0x465d17(0x233)](_0x1c0a95[_0x465d17(0x1b0)],_0x465d17(0x18c));}),it(_0x7084c5['CdMFs'],async()=>{const _0x2e26a4=_0x3aaa0d,{response:{statusCode:_0x4283c5,body:{err:_0x593504}}}=await _0x7084c5[_0x2e26a4(0x1b1)](setup,{'cookies':{},'body':{'state':_0x2e26a4(0x1ab),'id_token':_0x7084c5['wniig']}});assert['equal'](_0x4283c5,0x190),assert['equal'](_0x593504['message'],_0x2e26a4(0x1c3));}),_0x7084c5['gwvia'](it,_0x7084c5[_0x3aaa0d(0x1a7)],async()=>{const _0x368756=_0x3aaa0d,{response:{statusCode:_0xd9dcb7,body:{err:_0x39f188}}}=await _0x7084c5[_0x368756(0x1fc)](setup,{'cookies':_0x7084c5[_0x368756(0x1b1)](generateCookies,{'nonce':_0x7084c5[_0x368756(0x20b)],'state':_0x7084c5[_0x368756(0x1ec)]}),'body':{'state':_0x368756(0x1b3)}});assert[_0x368756(0x233)](_0xd9dcb7,0x190),assert[_0x368756(0x1eb)](_0x39f188[_0x368756(0x1b0)],/state mismatch/i);}),_0x7084c5['JaQim'](it,_0x3aaa0d(0x21d),async()=>{const _0x1fa536=_0x3aaa0d,{response:{statusCode:_0x468ef0,body:{err:_0xd0d31d}}}=await setup({'cookies':generateCookies({'nonce':_0x7084c5['kGGac'],'state':'__test_state__'}),'body':{'state':_0x7084c5['aTdyE'],'id_token':_0x1fa536(0x18f)}});assert['equal'](_0x468ef0,0x190),assert['equal'](_0xd0d31d[_0x1fa536(0x1b0)],_0x1fa536(0x17f));}),_0x7084c5['gwvia'](it,'should\x20error\x20when\x20id_token\x20has\x20invalid\x20alg',async()=>{const _0x2902c4=_0x3aaa0d,{response:{statusCode:_0x31cae9,body:{err:_0x3eee40}}}=await _0x7084c5[_0x2902c4(0x1fc)](setup,{'cookies':generateCookies({'nonce':_0x7084c5[_0x2902c4(0x20b)],'state':'__test_state__'}),'body':{'state':_0x2902c4(0x1ab),'id_token':jose['JWT'][_0x2902c4(0x1f9)]({'sub':_0x7084c5[_0x2902c4(0x1bf)]},_0x2902c4(0x253),{'algorithm':_0x2902c4(0x223)})}});assert[_0x2902c4(0x233)](_0x31cae9,0x190),assert[_0x2902c4(0x1eb)](_0x3eee40[_0x2902c4(0x1b0)],/unexpected JWT alg received/i);}),_0x7084c5[_0x3aaa0d(0x194)](it,_0x7084c5[_0x3aaa0d(0x183)],async()=>{const _0x1ab1f2=_0x3aaa0d,{response:{statusCode:_0x196582,body:{err:_0x198e04}}}=await setup({'cookies':generateCookies({'nonce':_0x7084c5[_0x1ab1f2(0x20b)],'state':_0x7084c5[_0x1ab1f2(0x1ae)]}),'body':{'state':_0x1ab1f2(0x1ab),'id_token':makeIdToken({'iss':undefined})}});assert[_0x1ab1f2(0x233)](_0x196582,0x190),assert[_0x1ab1f2(0x1eb)](_0x198e04[_0x1ab1f2(0x1b0)],/missing required JWT property iss/i);}),it(_0x3aaa0d(0x1d0),async()=>{const _0x256460=_0x3aaa0d,{response:{statusCode:_0x5a7f2c,body:{err:_0x15bdbc}}}=await setup({'cookies':generateCookies({'state':_0x256460(0x1ab)}),'body':{'state':_0x7084c5['aTdyE'],'id_token':makeIdToken()}});assert[_0x256460(0x233)](_0x5a7f2c,0x190),assert[_0x256460(0x1eb)](_0x15bdbc[_0x256460(0x1b0)],/nonce mismatch/i);}),it(_0x7084c5['VhAce'],async()=>{const _0x4e373c=_0x3aaa0d,{response:{statusCode:_0x1cc143,body:{err:_0x33d363}}}=await setup({'authOpts':{'legacySameSiteCookie':![]},'cookies':{'_auth_verification':JSON[_0x4e373c(0x1f0)]({'state':_0x4e373c(0x1ab)})},'body':{'state':_0x7084c5[_0x4e373c(0x1ae)],'id_token':_0x4e373c(0x18f)}});assert[_0x4e373c(0x233)](_0x1cc143,0x190),assert[_0x4e373c(0x233)](_0x33d363[_0x4e373c(0x1b0)],_0x7084c5['NJtIs']);}),it('should\x20use\x20legacy\x20samesite\x20fallback',async()=>{const _0x178537=_0x3aaa0d,{currentUser:_0x15fa01}=await _0x7084c5['nofEt'](setup,{'authOpts':{'identityClaimFilter':[]},'cookies':{'_auth_verification':JSON[_0x178537(0x1f0)]({'state':expectedDefaultState,'nonce':_0x178537(0x1fd)})},'body':{'state':expectedDefaultState,'id_token':makeIdToken()}});assert[_0x178537(0x22f)](_0x15fa01);}),_0x7084c5[_0x3aaa0d(0x189)](it,_0x7084c5['JjzEn'],async()=>{const _0x5748b0=_0x3aaa0d,{currentUser:_0x9ae950}=await setup({'authOpts':{'identityClaimFilter':[]},'cookies':_0x7084c5['jDllT'](generateCookies,{'state':expectedDefaultState,'nonce':_0x5748b0(0x1fd)}),'body':{'state':expectedDefaultState,'id_token':_0x7084c5['kKDCJ'](makeIdToken)}});assert[_0x5748b0(0x233)](_0x9ae950['iss'],_0x7084c5['tAMpM']),assert[_0x5748b0(0x233)](_0x9ae950[_0x5748b0(0x1d4)],clientID),assert[_0x5748b0(0x233)](_0x9ae950[_0x5748b0(0x1af)],_0x7084c5[_0x5748b0(0x20b)]),assert[_0x5748b0(0x22f)](_0x9ae950[_0x5748b0(0x234)]),assert[_0x5748b0(0x22f)](_0x9ae950['exp']);}),_0x7084c5[_0x3aaa0d(0x258)](it,_0x7084c5[_0x3aaa0d(0x199)],async()=>{const _0x5e24ba=_0x3aaa0d,_0x2bf5e4=makeIdToken(),{response:{statusCode:_0x5f5437,headers:_0x45f8a5},currentUser:_0x493fd7,tokens:_0x53a841}=await setup({'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x5e24ba(0x1fd)}),'body':{'state':expectedDefaultState,'id_token':_0x2bf5e4}});assert['equal'](_0x5f5437,0x12e),assert[_0x5e24ba(0x233)](_0x45f8a5[_0x5e24ba(0x1ff)],'https://example.org'),assert['ok'](_0x493fd7),assert[_0x5e24ba(0x233)](_0x493fd7[_0x5e24ba(0x226)],_0x7084c5[_0x5e24ba(0x1bf)]),assert['equal'](_0x493fd7[_0x5e24ba(0x249)],_0x7084c5[_0x5e24ba(0x1b2)]),assert['notExists'](_0x493fd7[_0x5e24ba(0x234)]),assert['notExists'](_0x493fd7[_0x5e24ba(0x1cb)]),assert[_0x5e24ba(0x19a)](_0x493fd7[_0x5e24ba(0x1d4)]),assert['notExists'](_0x493fd7[_0x5e24ba(0x196)]),assert['notExists'](_0x493fd7[_0x5e24ba(0x1af)]),assert[_0x5e24ba(0x233)](_0x53a841[_0x5e24ba(0x209)],!![]),assert['equal'](_0x53a841[_0x5e24ba(0x252)],_0x2bf5e4),assert['isUndefined'](_0x53a841['refreshToken']),assert[_0x5e24ba(0x1fa)](_0x53a841[_0x5e24ba(0x1d3)]),assert[_0x5e24ba(0x250)](_0x53a841[_0x5e24ba(0x1f2)],{'sub':_0x5e24ba(0x238)});}),it(_0x3aaa0d(0x222),async()=>{const _0x4b2d1b=_0x3aaa0d,_0x25a130=makeIdToken({'c_hash':_0x4b2d1b(0x203)}),{tokens:_0x4b9e46}=await setup({'authOpts':{'clientSecret':_0x7084c5[_0x4b2d1b(0x1f6)],'authorizationParams':{'response_type':_0x7084c5[_0x4b2d1b(0x245)],'audience':_0x4b2d1b(0x1a1),'scope':'openid\x20profile\x20email\x20read:reports\x20offline_access'}},'cookies':_0x7084c5['jDllT'](generateCookies,{'state':expectedDefaultState,'nonce':_0x7084c5[_0x4b2d1b(0x20b)]}),'body':{'state':expectedDefaultState,'id_token':_0x25a130,'code':_0x7084c5[_0x4b2d1b(0x1f8)]}});assert[_0x4b2d1b(0x233)](_0x4b9e46[_0x4b2d1b(0x209)],!![]),assert[_0x4b2d1b(0x233)](_0x4b9e46[_0x4b2d1b(0x252)],_0x25a130),assert[_0x4b2d1b(0x233)](_0x4b9e46[_0x4b2d1b(0x221)],_0x7084c5[_0x4b2d1b(0x1d7)]),assert[_0x4b2d1b(0x250)](_0x4b9e46[_0x4b2d1b(0x1d3)],{'access_token':_0x4b2d1b(0x24d),'token_type':'Bearer'}),assert[_0x4b2d1b(0x250)](_0x4b9e46['idTokenClaims'],{'sub':_0x7084c5[_0x4b2d1b(0x1bf)]});}),_0x7084c5[_0x3aaa0d(0x241)](it,_0x3aaa0d(0x184),async()=>{const _0x2ad615=_0x3aaa0d;if('OQKYL'===_0x7084c5[_0x2ad615(0x1c2)])_0x2f1332['json']({'session':_0x2f5431[_0x7084c5[_0x2ad615(0x1db)]]});else{const _0x13a74d=sinon[_0x2ad615(0x1ba)]({'toFake':[_0x7084c5[_0x2ad615(0x213)]]}),_0x33af94=_0x7084c5[_0x2ad615(0x225)](makeIdToken,{'c_hash':_0x7084c5[_0x2ad615(0x25e)]}),_0x34a685=_0x7084c5[_0x2ad615(0x247)](0x3c,0x3c),_0x207f98=_0x7084c5[_0x2ad615(0x236)](_0x34a685,0x3e8),{tokens:_0x4b5cfa,jar:_0x1d2c03}=await _0x7084c5[_0x2ad615(0x182)](setup,{'authOpts':{'clientSecret':'__test_client_secret__','authorizationParams':{'response_type':_0x7084c5['eDjBX']}},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x7084c5['kGGac']}),'body':{'state':expectedDefaultState,'id_token':_0x33af94,'code':_0x2ad615(0x1ca)}});assert[_0x2ad615(0x233)](_0x4b5cfa[_0x2ad615(0x1d3)][_0x2ad615(0x248)],0x18*_0x34a685),_0x13a74d[_0x2ad615(0x255)](_0x7084c5['mFbxY'](0x4,_0x207f98));const _0x11fe7f=await request[_0x2ad615(0x22c)](_0x7084c5[_0x2ad615(0x25a)],{'baseUrl':baseUrl,'jar':_0x1d2c03,'json':!![]})[_0x2ad615(0x1a0)](_0x389f60=>_0x389f60[_0x2ad615(0x22b)]);assert[_0x2ad615(0x233)](_0x11fe7f['accessToken'][_0x2ad615(0x248)],0x14*_0x34a685),assert[_0x2ad615(0x187)](_0x11fe7f[_0x2ad615(0x1c5)]),_0x13a74d[_0x2ad615(0x255)](0x15*_0x207f98);const _0x25d013=await request[_0x2ad615(0x22c)](_0x7084c5[_0x2ad615(0x25a)],{'baseUrl':baseUrl,'jar':_0x1d2c03,'json':!![]})[_0x2ad615(0x1a0)](_0x267160=>_0x267160[_0x2ad615(0x22b)]);assert[_0x2ad615(0x22e)](_0x25d013['accessTokenExpired']),_0x13a74d['restore']();}}),_0x7084c5[_0x3aaa0d(0x241)](it,_0x3aaa0d(0x1b9),async()=>{const _0x35b23a=_0x3aaa0d,_0x19e43f=makeIdToken({'c_hash':_0x7084c5[_0x35b23a(0x25e)]}),_0x4b832d={...defaultConfig,'clientSecret':_0x7084c5[_0x35b23a(0x1f6)],'authorizationParams':{'response_type':_0x35b23a(0x1ac),'audience':_0x7084c5['yQiyh'],'scope':_0x35b23a(0x232)}},_0x55f894=auth(_0x4b832d);_0x55f894['get'](_0x35b23a(0x257),async(_0x993ea6,_0x176c47)=>{const _0x429fa6=_0x35b23a,_0x26529d=await _0x993ea6[_0x429fa6(0x1cd)][_0x429fa6(0x1d3)][_0x429fa6(0x1d6)]();_0x176c47[_0x429fa6(0x224)]({'accessToken':_0x26529d,'refreshToken':_0x993ea6[_0x429fa6(0x1cd)][_0x429fa6(0x221)]});});const {tokens:_0x5ccd4b,jar:_0x5abae2}=await _0x7084c5[_0x35b23a(0x1fc)](setup,{'router':_0x55f894,'authOpts':{'clientSecret':_0x7084c5['ukEEb'],'authorizationParams':{'response_type':_0x7084c5['oXaOU'],'audience':_0x35b23a(0x1a1),'scope':_0x35b23a(0x232)}},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x7084c5[_0x35b23a(0x20b)]}),'body':{'state':expectedDefaultState,'id_token':_0x19e43f,'code':_0x35b23a(0x1ca)}}),_0x2714e0=sinon[_0x35b23a(0x217)](()=>({'access_token':'__new_access_token__','refresh_token':'__new_refresh_token__','id_token':_0x5ccd4b[_0x35b23a(0x252)],'token_type':_0x35b23a(0x21f),'expires_in':0x15180})),{interceptors:[_0x694338]}=_0x7084c5[_0x35b23a(0x1cc)](nock,_0x35b23a(0x202),{'allowUnmocked':!![]})['post'](_0x7084c5[_0x35b23a(0x243)])['reply'](0xc8,_0x2714e0),_0x3cd817=await request[_0x35b23a(0x22c)](_0x35b23a(0x257),{'baseUrl':baseUrl,'jar':_0x5abae2,'json':!![]})[_0x35b23a(0x1a0)](_0x2a7fb6=>_0x2a7fb6[_0x35b23a(0x22b)]);nock['removeInterceptor'](_0x694338),sinon['assert'][_0x35b23a(0x1fb)](_0x2714e0,_0x7084c5['Xhygi'],_0x35b23a(0x24b)),assert[_0x35b23a(0x233)](_0x5ccd4b[_0x35b23a(0x1d3)][_0x35b23a(0x1e3)],_0x35b23a(0x24d)),assert[_0x35b23a(0x233)](_0x5ccd4b[_0x35b23a(0x221)],_0x7084c5[_0x35b23a(0x1d7)]),assert[_0x35b23a(0x233)](_0x3cd817[_0x35b23a(0x1d3)][_0x35b23a(0x1e3)],_0x7084c5[_0x35b23a(0x197)]),assert['equal'](_0x3cd817[_0x35b23a(0x221)],_0x7084c5[_0x35b23a(0x218)]);const _0x175b72=await request['get'](_0x35b23a(0x1c1),{'baseUrl':baseUrl,'jar':_0x5abae2,'json':!![]})[_0x35b23a(0x1a0)](_0x450009=>_0x450009[_0x35b23a(0x22b)]);assert[_0x35b23a(0x233)](_0x175b72['accessToken'][_0x35b23a(0x1e3)],_0x7084c5[_0x35b23a(0x197)],_0x7084c5[_0x35b23a(0x220)]);}),it(_0x3aaa0d(0x21b),async()=>{const _0x142b54=_0x3aaa0d,_0x49a2b8=_0x7084c5[_0x142b54(0x182)](makeIdToken,{'c_hash':_0x7084c5['grnSp']}),_0x73e30={...defaultConfig,'clientSecret':_0x142b54(0x1e4),'authorizationParams':{'response_type':'code\x20id_token','audience':_0x7084c5[_0x142b54(0x18b)],'scope':_0x7084c5[_0x142b54(0x180)]}},_0xfd06fa=auth(_0x73e30);_0xfd06fa[_0x142b54(0x22c)](_0x7084c5[_0x142b54(0x20e)],async(_0x2e8684,_0x37ccfe)=>{const _0x810d01=_0x142b54,_0x4cf17e={'HSTbn':function(_0x1d34e5,_0x5e313f){return _0x1d34e5===_0x5e313f;}};if(_0x7084c5[_0x810d01(0x188)]('tnqRP','lJEJP')){const _0x1144a4=await _0x2e8684[_0x810d01(0x1cd)][_0x810d01(0x1d3)][_0x810d01(0x1d6)]();_0x37ccfe['json']({'accessToken':_0x1144a4,'refreshToken':_0x2e8684[_0x810d01(0x1cd)][_0x810d01(0x221)]});}else{let _0x1c8f55;_0x246e51['store'](_0xecfe7a,{},{'cookie'(_0x51abf7,..._0x1e97f0){const _0x3f90ed=_0x810d01;_0x4cf17e[_0x3f90ed(0x22d)](_0x51abf7,_0x540445)&&(_0x1c8f55=_0x1e97f0[0x0]);}},{'value':_0x36035c[_0x810d01(0x1a6)][_0x12d906]}),_0x34abb0['setCookie'](_0x4211d7+'='+_0x1c8f55+';\x20Max-Age=3600;\x20Path=/;\x20HttpOnly;',_0x2b4885+_0x810d01(0x256));}});const {tokens:_0x167d82,jar:_0x165ad5}=await setup({'router':_0xfd06fa,'authOpts':{'clientSecret':_0x142b54(0x1e4),'authorizationParams':{'response_type':'code\x20id_token','audience':_0x142b54(0x1a1),'scope':_0x7084c5[_0x142b54(0x180)]}},'cookies':_0x7084c5[_0x142b54(0x182)](generateCookies,{'state':expectedDefaultState,'nonce':_0x142b54(0x1fd)}),'body':{'state':expectedDefaultState,'id_token':_0x49a2b8,'code':_0x7084c5[_0x142b54(0x1f8)]}}),_0x4abe25=sinon['spy'](()=>({'access_token':_0x142b54(0x205),'id_token':_0x167d82[_0x142b54(0x181)],'token_type':_0x142b54(0x21f),'expires_in':0x15180})),{interceptors:[_0x1dcfb1]}=nock('https://op.example.com',{'allowUnmocked':!![]})[_0x142b54(0x1f3)](_0x7084c5[_0x142b54(0x243)])[_0x142b54(0x206)](0xc8,_0x4abe25),_0x20d919=await request[_0x142b54(0x22c)](_0x7084c5[_0x142b54(0x20e)],{'baseUrl':baseUrl,'jar':_0x165ad5,'json':!![]})[_0x142b54(0x1a0)](_0x5af70a=>_0x5af70a[_0x142b54(0x22b)]);nock[_0x142b54(0x240)](_0x1dcfb1),sinon[_0x142b54(0x1e8)]['calledWith'](_0x4abe25,_0x142b54(0x1ee),_0x142b54(0x24b)),assert['equal'](_0x167d82[_0x142b54(0x1d3)][_0x142b54(0x1e3)],_0x142b54(0x24d)),assert['equal'](_0x167d82['refreshToken'],_0x7084c5[_0x142b54(0x1d7)]),assert['equal'](_0x20d919[_0x142b54(0x1d3)][_0x142b54(0x1e3)],_0x142b54(0x205)),assert[_0x142b54(0x233)](_0x20d919[_0x142b54(0x221)],_0x142b54(0x1f4));}),_0x7084c5[_0x3aaa0d(0x1f5)](it,_0x3aaa0d(0x1c0),async()=>{const _0x54fe32=_0x3aaa0d,_0x46127f=makeIdToken({'c_hash':_0x54fe32(0x203)}),_0x2bfc11={...defaultConfig,'clientSecret':_0x7084c5[_0x54fe32(0x1f6)],'authorizationParams':{'response_type':'code\x20id_token','audience':'https://api.example.com/','scope':_0x7084c5[_0x54fe32(0x180)]},'tokenEndpointParams':{'longeLiveToken':!![]}},_0x1ef0ad=_0x7084c5['JRfEt'](auth,_0x2bfc11);_0x1ef0ad[_0x54fe32(0x22c)](_0x7084c5['HXYKA'],async(_0x22a2b9,_0x18d6f0)=>{const _0x4656bc=_0x54fe32;if(_0x4656bc(0x23e)===_0x7084c5[_0x4656bc(0x23a)])throw{'status':0x3e7};else{const _0x45341a=await _0x22a2b9[_0x4656bc(0x1cd)][_0x4656bc(0x1d3)][_0x4656bc(0x1d6)]({'tokenEndpointParams':{'force':!![]}});_0x18d6f0[_0x4656bc(0x224)]({'accessToken':_0x45341a,'refreshToken':_0x22a2b9[_0x4656bc(0x1cd)][_0x4656bc(0x221)]});}});const {tokens:_0x29b373,jar:_0x19c4ce,tokenReqBody:_0x226965}=await _0x7084c5[_0x54fe32(0x1b1)](setup,{'router':_0x1ef0ad,'authOpts':{'clientSecret':_0x54fe32(0x1e4),'authorizationParams':{'response_type':_0x54fe32(0x1ac),'audience':_0x7084c5[_0x54fe32(0x18b)],'scope':_0x7084c5[_0x54fe32(0x180)]}},'cookies':_0x7084c5[_0x54fe32(0x259)](generateCookies,{'state':expectedDefaultState,'nonce':_0x7084c5['kGGac']}),'body':{'state':expectedDefaultState,'id_token':_0x46127f,'code':_0x7084c5[_0x54fe32(0x1f8)]}}),_0x13f730=sinon['spy'](()=>({'access_token':_0x54fe32(0x205),'refresh_token':_0x54fe32(0x18a),'id_token':_0x29b373[_0x54fe32(0x252)],'token_type':_0x54fe32(0x21f),'expires_in':0x15180})),{interceptors:[_0x4711bd]}=nock(_0x54fe32(0x202),{'allowUnmocked':!![]})[_0x54fe32(0x1f3)](_0x7084c5['Xhygi'])['reply'](0xc8,_0x13f730),_0x59bca0=await request[_0x54fe32(0x22c)](_0x7084c5[_0x54fe32(0x20e)],{'baseUrl':baseUrl,'jar':_0x19c4ce,'json':!![]})['then'](_0x19d77b=>_0x19d77b[_0x54fe32(0x22b)]);nock[_0x54fe32(0x240)](_0x4711bd),sinon[_0x54fe32(0x1e8)][_0x54fe32(0x1fb)](_0x13f730,'/oauth/token',_0x7084c5['XNEep']),assert[_0x54fe32(0x233)](_0x29b373[_0x54fe32(0x1d3)][_0x54fe32(0x1e3)],_0x7084c5[_0x54fe32(0x230)]),assert[_0x54fe32(0x233)](_0x29b373[_0x54fe32(0x221)],_0x7084c5[_0x54fe32(0x1d7)]),assert[_0x54fe32(0x233)](_0x59bca0['accessToken'][_0x54fe32(0x1e3)],_0x54fe32(0x205)),assert[_0x54fe32(0x233)](_0x59bca0[_0x54fe32(0x221)],_0x7084c5['odsRw']),assert[_0x54fe32(0x1eb)](_0x226965,/longeLiveToken=true/);const _0x9baf45=await request[_0x54fe32(0x22c)](_0x54fe32(0x1c1),{'baseUrl':baseUrl,'jar':_0x19c4ce,'json':!![]})[_0x54fe32(0x1a0)](_0x41d02b=>_0x41d02b['body']);assert[_0x54fe32(0x233)](_0x9baf45[_0x54fe32(0x1d3)]['access_token'],_0x54fe32(0x205),_0x54fe32(0x1dc));}),_0x7084c5[_0x3aaa0d(0x24a)](it,_0x3aaa0d(0x23c),async()=>{const _0x1b9f23=_0x3aaa0d,_0x267ec5=_0x7084c5[_0x1b9f23(0x259)](makeIdToken,{'c_hash':_0x1b9f23(0x203)}),_0x169adc={...defaultConfig,'clientSecret':_0x1b9f23(0x1e4),'authorizationParams':{'response_type':_0x7084c5[_0x1b9f23(0x245)],'audience':_0x1b9f23(0x1a1),'scope':'openid\x20profile\x20email'}},_0x420a76=_0x7084c5[_0x1b9f23(0x259)](auth,_0x169adc);_0x420a76['get'](_0x1b9f23(0x228),async(_0x28f348,_0x337b02)=>{const _0x55adf9=_0x1b9f23;_0x337b02['json'](await _0x28f348[_0x55adf9(0x1cd)][_0x55adf9(0x24f)]());});const {jar:_0x8b179d}=await _0x7084c5[_0x1b9f23(0x259)](setup,{'router':_0x420a76,'authOpts':{'clientSecret':_0x7084c5[_0x1b9f23(0x1f6)],'authorizationParams':{'response_type':_0x7084c5[_0x1b9f23(0x245)],'audience':'https://api.example.com/','scope':_0x7084c5[_0x1b9f23(0x180)]}},'cookies':_0x7084c5[_0x1b9f23(0x1a8)](generateCookies,{'state':expectedDefaultState,'nonce':_0x1b9f23(0x1fd)}),'body':{'state':expectedDefaultState,'id_token':_0x267ec5,'code':_0x7084c5[_0x1b9f23(0x1f8)]}}),{interceptors:[_0x23ab49]}=_0x7084c5['gwvia'](nock,_0x1b9f23(0x202),{'allowUnmocked':!![]})[_0x1b9f23(0x22c)](_0x7084c5[_0x1b9f23(0x23d)])[_0x1b9f23(0x206)](0xc8,()=>({'userInfo':!![],'sub':_0x1b9f23(0x238)})),_0x6f5248=await request['get'](_0x1b9f23(0x228),{'baseUrl':baseUrl,'jar':_0x8b179d,'json':!![]})['then'](_0x475932=>_0x475932['body']);nock['removeInterceptor'](_0x23ab49),assert[_0x1b9f23(0x1b7)](_0x6f5248,{'userInfo':!![],'sub':_0x1b9f23(0x238)});}),it(_0x7084c5['jIvHt'],async()=>{const _0x506c29=_0x3aaa0d,_0x2f3ddf=_0x7084c5['RceiP'](makeIdToken,{'c_hash':_0x506c29(0x203)}),{tokenReqBody:_0x268427,tokenReqHeader:_0x32eed5}=await _0x7084c5[_0x506c29(0x1c4)](setup,{'authOpts':{'clientSecret':'__test_client_secret__','authorizationParams':{'response_type':_0x506c29(0x1ac),'audience':_0x7084c5['yQiyh'],'scope':_0x506c29(0x232)}},'cookies':_0x7084c5[_0x506c29(0x1fc)](generateCookies,{'state':expectedDefaultState,'nonce':_0x7084c5[_0x506c29(0x20b)]}),'body':{'state':expectedDefaultState,'id_token':_0x2f3ddf,'code':_0x506c29(0x1ca)}}),_0x5c2cda=Buffer[_0x506c29(0x1d1)](_0x32eed5[_0x506c29(0x1a2)][_0x506c29(0x1f7)](_0x7084c5['NhEIV'],''),_0x7084c5['apyUU']);assert[_0x506c29(0x233)](_0x5c2cda,_0x7084c5[_0x506c29(0x198)]),assert[_0x506c29(0x1eb)](_0x268427,/code=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y/);}),it(_0x3aaa0d(0x246),async()=>{const _0x441c79=_0x3aaa0d,_0x26b792=makeIdToken(),_0x5e82b6=request[_0x441c79(0x219)]();_0x5e82b6[_0x441c79(0x1c8)](_0x7084c5[_0x441c79(0x24c)],baseUrl),await setup({'cookies':_0x7084c5[_0x441c79(0x1a8)](generateCookies,{'state':expectedDefaultState,'nonce':_0x7084c5[_0x441c79(0x20b)],'skipSilentLogin':'1'}),'body':{'state':expectedDefaultState,'id_token':_0x26b792},'jar':_0x5e82b6});const _0x59519d=_0x5e82b6[_0x441c79(0x1ce)](baseUrl);assert[_0x441c79(0x1e1)](_0x59519d[_0x441c79(0x191)](({key:_0x5e3314})=>_0x5e3314===_0x441c79(0x1c6)));}),_0x7084c5[_0x3aaa0d(0x1e7)](context,_0x7084c5[_0x3aaa0d(0x23b)],async()=>{const _0x59a4e9=_0x3aaa0d,_0x3ee699={'lmmNa':'safe','Djdsa':_0x7084c5[_0x59a4e9(0x19b)]};_0x7084c5[_0x59a4e9(0x1cc)](it,_0x59a4e9(0x1d8),async()=>{const _0x54802a=_0x59a4e9;if(_0x7084c5[_0x54802a(0x1be)](_0x54802a(0x21a),_0x54802a(0x193)))_0x1ec13c['log'](_0x3ee699[_0x54802a(0x17e)]);else{const _0xc4b069=_0x7084c5['jDllT'](makeIdToken,{'c_hash':_0x7084c5['grnSp']}),_0x549de6={...defaultConfig,'clientSecret':_0x54802a(0x1e4),'authorizationParams':{'response_type':_0x54802a(0x1ac),'audience':_0x7084c5[_0x54802a(0x18b)],'scope':_0x54802a(0x1a3)},'afterCallback':async(_0x26f089,_0x443bc7,_0xbaed6f)=>{const _0x54c382=_0x54802a,_0x9e9e12=await _0x26f089[_0x54c382(0x1cd)][_0x54c382(0x24f)]();return new AsyncFunction(_0x3ee699[_0x54c382(0x190)])(),{..._0xbaed6f,..._0x9e9e12};}},{interceptors:[_0x5b6d72]}=_0x7084c5[_0x54802a(0x1cc)](nock,_0x7084c5[_0x54802a(0x200)],{'allowUnmocked':!![]})[_0x54802a(0x22c)](_0x7084c5[_0x54802a(0x23d)])[_0x54802a(0x206)](0xc8,()=>({'org_id':_0x54802a(0x1d2)})),_0x445e71=auth(_0x549de6);_0x445e71[_0x54802a(0x22c)](_0x7084c5[_0x54802a(0x17d)],async(_0x118888,_0x31817c)=>{const _0x3f245e=_0x54802a;_0x31817c[_0x3f245e(0x224)]({'session':_0x118888['appSession']});});const {jar:_0x17b059}=await _0x7084c5[_0x54802a(0x195)](setup,{'router':_0x445e71,'authOpts':{'clientSecret':_0x7084c5[_0x54802a(0x1f6)],'authorizationParams':{'response_type':_0x7084c5[_0x54802a(0x245)],'audience':_0x54802a(0x1a1),'scope':_0x54802a(0x1a3)}},'cookies':_0x7084c5['kIzcx'](generateCookies,{'state':expectedDefaultState,'nonce':_0x54802a(0x1fd)}),'body':{'state':expectedDefaultState,'id_token':_0xc4b069,'code':_0x7084c5[_0x54802a(0x1f8)]}});nock['removeInterceptor'](_0x5b6d72);const _0xfc6eab=await request[_0x54802a(0x22c)](_0x7084c5[_0x54802a(0x17d)],{'baseUrl':baseUrl,'jar':_0x17b059,'json':!![]})['then'](_0x38b9f2=>_0x38b9f2[_0x54802a(0x22b)]);assert[_0x54802a(0x1b7)](_0xfc6eab['session'][_0x54802a(0x25f)],_0x54802a(0x1d2));}}),_0x7084c5[_0x59a4e9(0x1bc)](it,_0x59a4e9(0x1b5),async()=>{const _0x1a048c=_0x59a4e9,_0x3b6990=makeIdToken({'c_hash':'77QmUPtjPfzWtF2AnpK9RQ'}),_0x3072b7={...defaultConfig,'clientSecret':_0x7084c5[_0x1a048c(0x1f6)],'authorizationParams':{'response_type':_0x7084c5[_0x1a048c(0x245)],'audience':_0x7084c5['yQiyh'],'scope':_0x1a048c(0x1a3)},'afterCallback':async()=>{throw{'status':0x3e7};}},{response:{statusCode:_0x352a57}}=await _0x7084c5[_0x1a048c(0x20a)](setup,{'router':auth(_0x3072b7),'authOpts':_0x3072b7,'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x7084c5[_0x1a048c(0x20b)]}),'body':{'state':expectedDefaultState,'id_token':_0x3b6990,'code':_0x1a048c(0x1ca)}});assert['equal'](_0x352a57,0x3e7);});});});function _0x4259(){const _0x1434e6=['nonce','message','nofEt','IPdhE','__invalid_state__','__test_nickname__','should\x20allow\x20thrown\x20error\x20to\x20fail\x20the\x20request','defaults','deepEqual','jrRcN','should\x20refresh\x20an\x20access\x20token','useFakeTimers','appSession','QAXLj','keys','PCbhJ','SETxz','should\x20refresh\x20an\x20access\x20token\x20and\x20pass\x20tokenEndpointParams\x20and\x20refresh\x20argument\x20params\x20to\x20the\x20request','/tokens','rkTEu','checks.state\x20argument\x20is\x20missing','uLsAw','accessTokenExpired','skipSilentLogin','KwehY','setCookie','headers','jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y','iss','DPrGs','oidc','getCookies','3955736pvSEOZ','should\x20error\x20when\x20nonce\x20is\x20missing\x20from\x20cookies','from','auth_org_123','accessToken','aud','3815877onbdYx','refresh','wJbdZ','should\x20allow\x20modification\x20of\x20the\x20session','1465537ykJRXh','ShOYS','BkSgl','the\x20new\x20access\x20token\x20should\x20be\x20persisted\x20in\x20the\x20session','/userinfo','./fixture/cert','safe','OyTdJ','notOk','6141023agSIGf','access_token','__test_client_secret__','base64','sinon','tKxHQ','assert','callback\x20response_mode:\x20form_post','Basic\x20','match','dLNqf','jtLnu','/oauth/token','18138NVZttU','stringify','should\x20error\x20when\x20state\x20doesn\x27t\x20match','idTokenClaims','post','__test_refresh_token__','rJvos','ukEEb','replace','hwLtl','sign','isUndefined','calledWith','jDllT','__test_nonce__','xUTfC','location','zFlFf','var\x20x\x20=\x2042;\x20return\x20x;','https://op.example.com','77QmUPtjPfzWtF2AnpK9RQ','../lib/hooks/getLoginState','__new_access_token__','reply','MWTvY','assign','isAuthenticated','jdMiL','kGGac','should\x20use\x20basic\x20auth\x20on\x20token\x20endpoint\x20when\x20using\x20code\x20flow','AGOMM','HXYKA','http://example.org','/user','lpDYg','13417680Sxtuxz','TUsfv','longeLiveToken=true&force=true&grant_type=refresh_token&refresh_token=__test_refresh_token__','skipSilentLogin=true','7073883afguVq','spy','odsRw','jar','wtMKe','should\x20refresh\x20an\x20access\x20token\x20and\x20keep\x20original\x20refresh\x20token','cyljs','should\x20error\x20when\x20id_token\x20can\x27t\x20be\x20parsed','__test_client_id__:__test_client_secret__','Bearer','LLRmH','refreshToken','should\x20expose\x20all\x20tokens\x20when\x20id_token\x20is\x20valid\x20and\x20response_type\x20is\x20\x27code\x20id_token\x27','HS256','json','JRfEt','sub','should\x20error\x20when\x20the\x20body\x20is\x20empty','/user-info','pnnJP','3035RIyLzb','body','get','HSTbn','isTrue','exists','ernIu','should\x20expose\x20the\x20id\x20token\x20when\x20id_token\x20is\x20valid','openid\x20profile\x20email\x20read:reports\x20offline_access','equal','iat',';\x20Max-Age=3600;\x20Path=/;\x20HttpOnly;','MwQTn','return\x20await\x20Promise.resolve(42);','__test_sub__','JbAus','lTbWG','TgSHQ','should\x20fetch\x20userinfo','dFdfC','MQecm','req','removeInterceptor','JwvEx','request-promise-native','Xhygi','eIbzF','oXaOU','should\x20resume\x20silent\x20logins\x20when\x20user\x20successfully\x20logs\x20in','mFbxY','expires_in','nickname','zpazP','grant_type=refresh_token&refresh_token=__test_refresh_token__','BLvLs','__test_access_token__','EZqSq','fetchUserInfo','include','__valid_state__','idToken','secret','store','tick','/callback','/refresh','XcnAv','PMgHx','STHst','mnKrW','nYblO','uyWBW','grnSp','org_id','Date','KXGUO','lmmNa','failed\x20to\x20decode\x20JWT\x20(JWTMalformed:\x20JWTs\x20must\x20have\x20three\x20components)','sMdZa','id_token','kLzNg','VSnZS','should\x20handle\x20access\x20token\x20expiry','should\x20error\x20when\x20id_token\x20is\x20missing\x20issuer','log','isFalse','HqeXN','hMcDF','__new_refresh_token__','yQiyh','state\x20missing\x20from\x20the\x20response','tfDXs','HXDeP','__invalid_token__','Djdsa','find','nock','zwhFs','gwvia','EWbMZ','exp','BMhCD','CsXvm','ZeOnQ','notExists','DrHcZ','../lib/transientHandler','__test_client_id__','authOpts','FAuyf','then','https://api.example.com/','authorization','openid\x20profile\x20email','forEach','when\x20afterCallack\x20is\x20configured','cookies','yFfYk','LTukz','DeRSm','should\x20error\x20when\x20the\x20state\x20is\x20missing','__test_state__','code\x20id_token','2pUswIx','aTdyE'];_0x4259=function(){return _0x1434e6;};return _0x4259();}