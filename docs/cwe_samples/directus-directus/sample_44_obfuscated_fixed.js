function _0x2c7b(_0x2afbfa,_0x58b929){const _0x5d0015=_0x5d00();return _0x2c7b=function(_0x2c7b50,_0x2d41d3){_0x2c7b50=_0x2c7b50-0x99;let _0x3e65df=_0x5d0015[_0x2c7b50];return _0x3e65df;},_0x2c7b(_0x2afbfa,_0x58b929);}const _0x8caf58=_0x2c7b;(function(_0x14b3ef,_0x503dae){const _0x1b2f7b=_0x2c7b,_0x4910d1=_0x14b3ef();while(!![]){try{const _0x22014b=-parseInt(_0x1b2f7b(0xf0))/0x1+parseInt(_0x1b2f7b(0xa1))/0x2+-parseInt(_0x1b2f7b(0xc3))/0x3*(parseInt(_0x1b2f7b(0xd8))/0x4)+parseInt(_0x1b2f7b(0xb7))/0x5+-parseInt(_0x1b2f7b(0xbe))/0x6*(-parseInt(_0x1b2f7b(0xe3))/0x7)+-parseInt(_0x1b2f7b(0xa2))/0x8+-parseInt(_0x1b2f7b(0xae))/0x9;if(_0x22014b===_0x503dae)break;else _0x4910d1['push'](_0x4910d1['shift']());}catch(_0x1d8e78){_0x4910d1['push'](_0x4910d1['shift']());}}}(_0x5d00,0x95981));function _0x5d00(){const _0x4f58e0=['oxqXX','CnbFI','conversationId\x20user','limit','[getConvosQueried]\x20Error\x20getting\x20conversations','gwVMG','exports','pages','3544840cYfJwo','New\x20Chat','MOCls','qbEag','ocidT','HpcYg','qIcCa','150iDyrmp','[searchConversation]\x20Error\x20searching\x20conversation','PyRsw','eMFhP','\x20messages','69QxiWlU','Error\x20getting\x20conversations','deleteMany','Error\x20getting\x20conversation\x20title','findOne','isArray','djfEt','Error\x20getting\x20single\x20conversation','length','push','[saveConvo]\x20Error\x20saving\x20conversation','EMlJa','info','deletedCount','conversationId','sJkZN','kyXic','DsjaF','NmDgw','uTDOy','isArchived','4432uAliDl','bulkWrite','title','kwoGt','hTvMD','countDocuments','[getConvosByPage]\x20Error\x20getting\x20conversations','mdTju','[getConvoTitle]\x20Error\x20getting\x20conversation\x20title','nHfkh','[getConvo]\x20Error\x20getting\x20single\x20conversation','306222XcUgpA','tags','[deleteNullOrEmptyConversations]\x20Error\x20deleting\x20conversations','WUTyC','kTzCC','\x20conversations\x20and\x20','ceil','debug','Error\x20fetching\x20conversations','Error\x20deleting\x20conversations\x20with\x20null\x20or\x20empty\x20conversationId','./Message','KgyYw','[saveConvo]\x20','321959kINMGF','$or','error','find','_id','messages','fljRK','~/config/winston','eFSNo','skip','pageSize','741912WSbvJG','6558384vJWZLu','forEach','[saveBulkConversations]\x20Error\x20saving\x20conversations\x20in\x20bulk','OwEaA','sort','NtbfE','lean','user','SJhSQ','context','Error\x20searching\x20conversation','toObject','3542364YYPNtX'];_0x5d00=function(){return _0x4f58e0;};return _0x5d00();}const Conversation=require('./schema/convoSchema'),{getMessages,deleteMessages}=require(_0x8caf58(0xed)),logger=require(_0x8caf58(0x9d)),searchConversation=async _0x59ccbc=>{const _0x3fde68=_0x8caf58,_0x2096b0={'OwEaA':_0x3fde68(0xb1)};try{return await Conversation[_0x3fde68(0xc7)]({'conversationId':_0x59ccbc},_0x2096b0[_0x3fde68(0xa5)])[_0x3fde68(0xa8)]();}catch(_0x192708){logger[_0x3fde68(0xf2)](_0x3fde68(0xbf),_0x192708);throw new Error(_0x3fde68(0xac));}},getConvo=async(_0x2d59a3,_0x2b4570)=>{const _0x2f2b67=_0x8caf58;try{return await Conversation[_0x2f2b67(0xc7)]({'user':_0x2d59a3,'conversationId':_0x2b4570})['lean']();}catch(_0x170741){return logger[_0x2f2b67(0xf2)](_0x2f2b67(0xe2),_0x170741),{'message':_0x2f2b67(0xca)};}},deleteNullOrEmptyConversations=async()=>{const _0x386b22=_0x8caf58,_0x299fd3={'kyXic':_0x386b22(0xb8),'NmDgw':_0x386b22(0xe5)};try{if(_0x386b22(0xe6)!=='WUTyC')return _0x3bc7d7?.[_0x386b22(0xda)]||_0x299fd3[_0x386b22(0xd3)];else{const _0x466512={'$or':[{'conversationId':null},{'conversationId':''},{'conversationId':{'$exists':![]}}]},_0x4b7d61=await Conversation[_0x386b22(0xc5)](_0x466512),_0x98fdf4=await deleteMessages(_0x466512);return logger['info']('[deleteNullOrEmptyConversations]\x20Deleted\x20'+_0x4b7d61[_0x386b22(0xd0)]+_0x386b22(0xe8)+_0x98fdf4['deletedCount']+_0x386b22(0xc2)),{'conversations':_0x4b7d61,'messages':_0x98fdf4};}}catch(_0x2d46f5){logger['error'](_0x299fd3[_0x386b22(0xd5)],_0x2d46f5);throw new Error(_0x386b22(0xec));}};module[_0x8caf58(0xb5)]={'Conversation':Conversation,'searchConversation':searchConversation,'deleteNullOrEmptyConversations':deleteNullOrEmptyConversations,'saveConvo':async(_0x4491a5,{conversationId:_0x2c8a75,newConversationId:_0x2f2dc0,..._0x19849b},_0x55191a)=>{const _0x40a468=_0x8caf58,_0x4915df={'eMFhP':'Error\x20saving\x20conversation'};try{_0x55191a&&_0x55191a?.[_0x40a468(0xab)]&&logger[_0x40a468(0xea)](_0x40a468(0xef)+_0x55191a['context']);const _0x44f9ec=await getMessages({'conversationId':_0x2c8a75},_0x40a468(0x9a)),_0x3b44ec={..._0x19849b,'messages':_0x44f9ec,'user':_0x4491a5[_0x40a468(0xa9)]['id']};_0x2f2dc0&&(_0x3b44ec[_0x40a468(0xd1)]=_0x2f2dc0);const _0x4d5a32=await Conversation['findOneAndUpdate']({'conversationId':_0x2c8a75,'user':_0x4491a5[_0x40a468(0xa9)]['id']},_0x3b44ec,{'new':!![],'upsert':!![]});return _0x4d5a32[_0x40a468(0xad)]();}catch(_0x13de0e){return logger[_0x40a468(0xf2)](_0x40a468(0xcd),_0x13de0e),_0x55191a&&_0x55191a?.[_0x40a468(0xab)]&&logger[_0x40a468(0xcf)]('[saveConvo]\x20'+_0x55191a['context']),{'message':_0x4915df[_0x40a468(0xc1)]};}},'bulkSaveConvos':async _0x1d4f63=>{const _0x22b8ea=_0x8caf58,_0x45979b={'huaIA':_0x22b8ea(0xa4),'HpcYg':'Failed\x20to\x20save\x20conversations\x20in\x20bulk.'};try{const _0x5778eb=_0x1d4f63['map'](_0x298bfd=>({'updateOne':{'filter':{'conversationId':_0x298bfd['conversationId'],'user':_0x298bfd[_0x22b8ea(0xa9)]},'update':_0x298bfd,'upsert':!![],'timestamps':![]}})),_0x384934=await Conversation[_0x22b8ea(0xd9)](_0x5778eb);return _0x384934;}catch(_0x5346ff){logger[_0x22b8ea(0xf2)](_0x45979b['huaIA'],_0x5346ff);throw new Error(_0x45979b[_0x22b8ea(0xbc)]);}},'getConvosByPage':async(_0x3c00f4,_0x3f6b0e=0x1,_0x53db96=0x19,_0x1bc1ba=![],_0x40acff)=>{const _0x183f87=_0x8caf58,_0x575a46={'qbEag':_0x183f87(0xe0),'LZqio':_0x183f87(0xc6),'djfEt':'PPSLU','ocidT':_0x183f87(0xdc),'SwiWU':'GruCT','sJkZN':function(_0x1c0f2d,_0x4209ff){return _0x1c0f2d*_0x4209ff;},'druia':_0x183f87(0xb0),'rPesG':_0x183f87(0xde),'lKyvG':_0x183f87(0xc4)},_0x20ddc6={'user':_0x3c00f4};_0x1bc1ba?_0x20ddc6[_0x183f87(0xd7)]=!![]:_0x575a46[_0x183f87(0xc9)]===_0x575a46['djfEt']?_0x20ddc6[_0x183f87(0xf1)]=[{'isArchived':![]},{'isArchived':{'$exists':![]}}]:_0x193e42[_0x28acfa]=[];if(Array[_0x183f87(0xc8)](_0x40acff)&&_0x40acff[_0x183f87(0xcb)]>0x0){if(_0x575a46[_0x183f87(0xbb)]!==_0x575a46['SwiWU'])_0x20ddc6[_0x183f87(0xe4)]={'$in':_0x40acff};else return _0x3c1f9d['error'](_0x575a46[_0x183f87(0xba)],_0x5369a5),{'message':_0x575a46['LZqio']};}try{const _0x2ebe7f=await Conversation[_0x183f87(0xdd)](_0x20ddc6)||0x1,_0xc4849b=Math[_0x183f87(0xe9)](_0x2ebe7f/_0x53db96),_0x437078=await Conversation[_0x183f87(0x99)](_0x20ddc6)[_0x183f87(0xa6)]({'updatedAt':-0x1})[_0x183f87(0x9f)](_0x575a46[_0x183f87(0xd2)](_0x3f6b0e-0x1,_0x53db96))[_0x183f87(0xb2)](_0x53db96)[_0x183f87(0xa8)]();return{'conversations':_0x437078,'pages':_0xc4849b,'pageNumber':_0x3f6b0e,'pageSize':_0x53db96};}catch(_0x1f3235){if(_0x183f87(0xd6)===_0x575a46['druia'])_0x48bdc9[_0x183f87(0xd1)]=_0x466a3e;else return logger[_0x183f87(0xf2)](_0x575a46['rPesG'],_0x1f3235),{'message':_0x575a46['lKyvG']};}},'getConvosQueried':async(_0x5842a1,_0x57362a,_0x2b36d4=0x1,_0x408d70=0x19)=>{const _0x4e652f=_0x8caf58,_0x3f048a={'mdTju':'Error\x20searching\x20conversation','fljRK':function(_0x5c689c,_0xf4a95f){return _0x5c689c===_0xf4a95f;},'eFSNo':'nHfkh'};try{if(!_0x57362a||_0x57362a['length']===0x0)return{'conversations':[],'pages':0x1,'pageNumber':_0x2b36d4,'pageSize':_0x408d70};const _0x41de65={},_0x2ee241={},_0xb09aa8=[];_0x57362a[_0x4e652f(0xa3)](_0x22384a=>_0xb09aa8[_0x4e652f(0xcc)](Conversation[_0x4e652f(0xc7)]({'user':_0x5842a1,'conversationId':_0x22384a['conversationId']})[_0x4e652f(0xa8)]()));const _0x1b9773=(await Promise['all'](_0xb09aa8))['filter'](Boolean);_0x1b9773[_0x4e652f(0xa3)]((_0x554a2f,_0x1906e2)=>{const _0x2c6ad9=_0x4e652f,_0x350131={'SJhSQ':_0x3f048a[_0x2c6ad9(0xdf)]};if(_0x3f048a[_0x2c6ad9(0x9c)](_0x3f048a[_0x2c6ad9(0x9e)],_0x2c6ad9(0xe1))){const _0x33f757=Math['floor'](_0x1906e2/_0x408d70)+0x1;!_0x41de65[_0x33f757]&&(_0x41de65[_0x33f757]=[]),_0x41de65[_0x33f757]['push'](_0x554a2f),_0x2ee241[_0x554a2f['conversationId']]=_0x554a2f;}else{_0x3796eb['error'](_0x2c6ad9(0xbf),_0x55c8de);throw new _0x2d83be(_0x350131[_0x2c6ad9(0xaa)]);}});const _0x1c72f9=Math[_0x4e652f(0xe9)](_0x1b9773[_0x4e652f(0xcb)]/_0x408d70);return _0x41de65[_0x4e652f(0xb6)]=_0x1c72f9,_0x41de65[_0x4e652f(0xa0)]=_0x408d70,{'cache':_0x41de65,'conversations':_0x41de65[_0x2b36d4]||[],'pages':_0x1c72f9||0x1,'pageNumber':_0x2b36d4,'pageSize':_0x408d70,'convoMap':_0x2ee241};}catch(_0x27a676){return logger[_0x4e652f(0xf2)](_0x4e652f(0xb3),_0x27a676),{'message':_0x4e652f(0xeb)};}},'getConvo':getConvo,'getConvoTitle':async(_0x67999e,_0x2ea21d)=>{const _0x43f78a=_0x8caf58,_0x474980={'gwVMG':_0x43f78a(0xe5),'qIcCa':'Error\x20deleting\x20conversations\x20with\x20null\x20or\x20empty\x20conversationId','NtbfE':function(_0x2628e7,_0x475a41,_0x41e011){return _0x2628e7(_0x475a41,_0x41e011);},'KUmyS':_0x43f78a(0xb9),'KgyYw':_0x43f78a(0xb8),'kTzCC':function(_0x292ee5,_0x560dd2){return _0x292ee5===_0x560dd2;},'XbkCp':_0x43f78a(0xce),'kwoGt':_0x43f78a(0xaf),'DUQCb':_0x43f78a(0xe0),'DsjaF':'Error\x20getting\x20conversation\x20title'};try{const _0x5388e7=await _0x474980[_0x43f78a(0xa7)](getConvo,_0x67999e,_0x2ea21d);if(_0x5388e7&&!_0x5388e7[_0x43f78a(0xda)]){if(_0x43f78a(0xc0)!==_0x474980['KUmyS'])return null;else{_0x202b4e[_0x43f78a(0xf2)](_0x474980[_0x43f78a(0xb4)],_0x551e4b);throw new _0x32460d(_0x474980[_0x43f78a(0xbd)]);}}else return _0x5388e7?.[_0x43f78a(0xda)]||_0x474980[_0x43f78a(0xee)];}catch(_0x28e47b){if(_0x474980[_0x43f78a(0xe7)](_0x474980['XbkCp'],_0x474980[_0x43f78a(0xdb)]))_0x1a2899[_0x43f78a(0xe4)]={'$in':_0x396588};else return logger[_0x43f78a(0xf2)](_0x474980['DUQCb'],_0x28e47b),{'message':_0x474980[_0x43f78a(0xd4)]};}},'deleteConvos':async(_0x52a4b8,_0x416db7)=>{const _0x37ada5=_0x8caf58,_0x965887={'gQMmk':_0x37ada5(0xd1)};let _0x5b2f17=await Conversation[_0x37ada5(0x99)]({..._0x416db7,'user':_0x52a4b8})['select'](_0x965887['gQMmk']);const _0x189b69=_0x5b2f17['map'](_0x33e526=>_0x33e526[_0x37ada5(0xd1)]);let _0x5ca106=await Conversation[_0x37ada5(0xc5)]({..._0x416db7,'user':_0x52a4b8});return _0x5ca106[_0x37ada5(0x9b)]=await deleteMessages({'conversationId':{'$in':_0x189b69}}),_0x5ca106;}};