function _0x2c46(){const _0x15113c=['length','gcsSP','assistant_id','assistants','metadata','YuONe','[/assistants]\x20Error\x20listing\x20assistants','18082920NIhldL','[/assistants]\x20Error\x20creating\x20assistant','GISns','9704nkZqgN','335unKjFj','QgHOj','app','1935wRhRIW','VnAMB','[/avatar/:assistant_id]\x20Error\x20parsing\x20metadata','Error\x20deleting\x20assistant','parse','WNiJA','1407588ELNyPo','~/server/services/Files/strategies','~/models/File','Assistant\x20ID\x20is\x20required','filter','TPzcp','178094fZZkgB','model','toString','HpgcQ','kwnKq','deleted','pxPyf','hNuAe','update','push','[/assistants/:id]\x20Error\x20retrieving\x20assistant','del','~/models/Assistant','buffer','includes','/assistants/','error','avatar_source','134820Jdzuuu','map','~/config','create','query','conversation_starters','locals','rUwXL','~/server/services/ActionService','availableTools','MioGg','avatar','Error\x20listing\x20assistants','53328BlMfJF','vCRNY','body','tinSz','beta','VYumo','azureOptions','kGqiu','453350xWIuUn','33EGJCXJ','string','fileStrategy','6gXHnHG','[/assistants/:id]\x20Error\x20deleting\x20assistant','json','message','exports','user','azureOpenAIApiDeploymentName','MxAiO','~/server/services/Files/process','16FFXssP','tools','debug','params','~/server/middleware/assistants/validateAuthor','filepath','status','file','fZbQy','yhILJ','Iewez','./helpers'];_0x2c46=function(){return _0x15113c;};return _0x2c46();}const _0x339f24=_0x220d;function _0x220d(_0x22a521,_0x4e2d21){const _0x2c460d=_0x2c46();return _0x220d=function(_0x220d15,_0x3a95e1){_0x220d15=_0x220d15-0x71;let _0x40bac1=_0x2c460d[_0x220d15];return _0x40bac1;},_0x220d(_0x22a521,_0x4e2d21);}(function(_0x4cf80b,_0x269fa6){const _0x3bb85f=_0x220d,_0x4eca19=_0x4cf80b();while(!![]){try{const _0x462419=-parseInt(_0x3bb85f(0xb7))/0x1*(parseInt(_0x3bb85f(0x83))/0x2)+parseInt(_0x3bb85f(0x95))/0x3+parseInt(_0x3bb85f(0xa2))/0x4*(parseInt(_0x3bb85f(0x74))/0x5)+-parseInt(_0x3bb85f(0xae))/0x6*(-parseInt(_0x3bb85f(0x7d))/0x7)+-parseInt(_0x3bb85f(0x73))/0x8*(parseInt(_0x3bb85f(0x77))/0x9)+parseInt(_0x3bb85f(0xaa))/0xa*(-parseInt(_0x3bb85f(0xab))/0xb)+parseInt(_0x3bb85f(0xca))/0xc;if(_0x462419===_0x269fa6)break;else _0x4eca19['push'](_0x4eca19['shift']());}catch(_0x16b5c8){_0x4eca19['push'](_0x4eca19['shift']());}}}(_0x2c46,0xc9532));const {FileContext}=require('librechat-data-provider'),validateAuthor=require(_0x339f24(0xbb)),{getStrategyFunctions}=require(_0x339f24(0x7e)),{deleteAssistantActions}=require(_0x339f24(0x9d)),{updateAssistantDoc,getAssistants}=require(_0x339f24(0x8f)),{uploadImageBuffer}=require(_0x339f24(0xb6)),{getOpenAIClient,fetchAssistants}=require(_0x339f24(0xc2)),{deleteFileByFilter}=require(_0x339f24(0x7f)),{logger}=require(_0x339f24(0x97)),createAssistant=async(_0x2393e9,_0x3f9852)=>{const _0x173bf0=_0x339f24,_0x3b8889={'hNuAe':_0x173bf0(0xac),'rUwXL':function(_0x5dc073,_0x12de4f,_0x253613){return _0x5dc073(_0x12de4f,_0x253613);},'gcsSP':_0x173bf0(0x92)};try{const {openai:_0x1822ce}=await getOpenAIClient({'req':_0x2393e9,'res':_0x3f9852}),{tools:tools=[],endpoint:_0x861f19,conversation_starters:_0x3b8294,..._0x3c09c0}=_0x2393e9[_0x173bf0(0xa4)];delete _0x3c09c0['conversation_starters'],_0x3c09c0[_0x173bf0(0xb8)]=tools[_0x173bf0(0x96)](_0x21a6d7=>{const _0x2de95d=_0x173bf0;if(typeof _0x21a6d7!==_0x3b8889[_0x2de95d(0x8a)])return _0x21a6d7;return _0x2393e9[_0x2de95d(0x76)]['locals'][_0x2de95d(0x9e)][_0x21a6d7];})[_0x173bf0(0x81)](_0x4154a3=>_0x4154a3);let _0x1a0fbd=null;_0x1822ce[_0x173bf0(0x9b)]?.[_0x173bf0(0xa8)]&&(_0x1a0fbd=_0x3c09c0[_0x173bf0(0x84)],_0x3c09c0[_0x173bf0(0x84)]=_0x1822ce['locals'][_0x173bf0(0xa8)][_0x173bf0(0xb4)]);_0x3c09c0[_0x173bf0(0xc7)]={'author':_0x2393e9[_0x173bf0(0xb3)]['id'],'endpoint':_0x861f19};const _0x2facd3=await _0x1822ce['beta'][_0x173bf0(0xc6)][_0x173bf0(0x98)](_0x3c09c0),_0xada59a={'user':_0x2393e9[_0x173bf0(0xb3)]['id']};_0x3b8294&&(_0xada59a[_0x173bf0(0x9a)]=_0x3b8294);const _0xb00cec=await _0x3b8889[_0x173bf0(0x9c)](updateAssistantDoc,{'assistant_id':_0x2facd3['id']},_0xada59a);_0x1a0fbd&&(_0x2facd3['model']=_0x1a0fbd),_0xb00cec[_0x173bf0(0x9a)]&&(_0x2facd3['conversation_starters']=_0xb00cec[_0x173bf0(0x9a)]),logger[_0x173bf0(0xb9)](_0x3b8889[_0x173bf0(0xc4)],_0x2facd3),_0x3f9852[_0x173bf0(0xbd)](0xc9)[_0x173bf0(0xb0)](_0x2facd3);}catch(_0x28a72c){logger[_0x173bf0(0x93)](_0x173bf0(0x71),_0x28a72c),_0x3f9852[_0x173bf0(0xbd)](0x1f4)[_0x173bf0(0xb0)]({'error':_0x28a72c[_0x173bf0(0xb1)]});}},retrieveAssistant=async(_0x14637d,_0x2485ae)=>{const _0x588448=_0x339f24;try{const {openai:_0x284815}=await getOpenAIClient({'req':_0x14637d,'res':_0x2485ae}),_0x3e7a2=_0x14637d[_0x588448(0xba)]['id'],_0x578f4b=await _0x284815[_0x588448(0xa6)][_0x588448(0xc6)]['retrieve'](_0x3e7a2);_0x2485ae[_0x588448(0xb0)](_0x578f4b);}catch(_0x439f0d){logger[_0x588448(0x93)](_0x588448(0x8d),_0x439f0d),_0x2485ae['status'](0x1f4)[_0x588448(0xb0)]({'error':_0x439f0d[_0x588448(0xb1)]});}},patchAssistant=async(_0x41cd24,_0x351869)=>{const _0x1324d8=_0x339f24,_0x10cce0={'tPDHw':'string','MxAiO':function(_0x5303c9,_0x21c1ab){return _0x5303c9(_0x21c1ab);},'iitlA':function(_0x582a74,_0x3dcf41,_0x1ea3b9){return _0x582a74(_0x3dcf41,_0x1ea3b9);}};try{const {openai:_0x37a274}=await _0x10cce0[_0x1324d8(0xb5)](getOpenAIClient,{'req':_0x41cd24,'res':_0x351869});await _0x10cce0[_0x1324d8(0xb5)](validateAuthor,{'req':_0x41cd24,'openai':_0x37a274});const _0x13a3fa=_0x41cd24['params']['id'],{endpoint:_0x301be3,conversation_starters:_0x2766ca,..._0x3bfbd2}=_0x41cd24[_0x1324d8(0xa4)];_0x3bfbd2[_0x1324d8(0xb8)]=(_0x3bfbd2[_0x1324d8(0xb8)]??[])[_0x1324d8(0x96)](_0x5a2425=>{const _0x51c3c9=_0x1324d8;if(typeof _0x5a2425!==_0x10cce0['tPDHw'])return _0x5a2425;return _0x41cd24[_0x51c3c9(0x76)][_0x51c3c9(0x9b)][_0x51c3c9(0x9e)][_0x5a2425];})[_0x1324d8(0x81)](_0x2c8465=>_0x2c8465);_0x37a274[_0x1324d8(0x9b)]?.[_0x1324d8(0xa8)]&&_0x3bfbd2[_0x1324d8(0x84)]&&(_0x3bfbd2[_0x1324d8(0x84)]=_0x37a274[_0x1324d8(0x9b)][_0x1324d8(0xa8)][_0x1324d8(0xb4)]);const _0x33acf9=await _0x37a274[_0x1324d8(0xa6)][_0x1324d8(0xc6)][_0x1324d8(0x8b)](_0x13a3fa,_0x3bfbd2);if(_0x2766ca!==undefined){const _0x1ee4e5=await _0x10cce0['iitlA'](updateAssistantDoc,{'assistant_id':_0x13a3fa},{'conversation_starters':_0x2766ca});_0x33acf9[_0x1324d8(0x9a)]=_0x1ee4e5[_0x1324d8(0x9a)];}_0x351869[_0x1324d8(0xb0)](_0x33acf9);}catch(_0x4e71a4){logger[_0x1324d8(0x93)]('[/assistants/:id]\x20Error\x20updating\x20assistant',_0x4e71a4),_0x351869[_0x1324d8(0xbd)](0x1f4)[_0x1324d8(0xb0)]({'error':_0x4e71a4['message']});}},deleteAssistant=async(_0x1695c9,_0x5c3814)=>{const _0x2bd264=_0x339f24,_0x669d20={'WNiJA':_0x2bd264(0x82),'QgHOj':function(_0x156eba,_0x47c2a3){return _0x156eba(_0x47c2a3);},'kwnKq':_0x2bd264(0xaf),'VnAMB':_0x2bd264(0x7a)};try{if(_0x2bd264(0xa5)!==_0x669d20[_0x2bd264(0x7c)]){const {openai:_0x374b2e}=await getOpenAIClient({'req':_0x1695c9,'res':_0x5c3814});await _0x669d20[_0x2bd264(0x75)](validateAuthor,{'req':_0x1695c9,'openai':_0x374b2e});const _0x862bb6=_0x1695c9['params']['id'],_0x1500be=await _0x374b2e[_0x2bd264(0xa6)][_0x2bd264(0xc6)][_0x2bd264(0x8e)](_0x862bb6);_0x1500be?.[_0x2bd264(0x88)]&&await _0x669d20[_0x2bd264(0x75)](deleteAssistantActions,{'req':_0x1695c9,'assistant_id':_0x862bb6}),_0x5c3814[_0x2bd264(0xb0)](_0x1500be);}else return _0x4d39dd[_0x2bd264(0x81)](_0x450060=>!_0x38289c[_0x2bd264(0x91)](_0x450060[_0x2bd264(0xc5)]))[_0x2bd264(0x96)](_0x26b7f5);}catch(_0x135b9){logger[_0x2bd264(0x93)](_0x669d20[_0x2bd264(0x87)],_0x135b9),_0x5c3814[_0x2bd264(0xbd)](0x1f4)[_0x2bd264(0xb0)]({'error':_0x669d20[_0x2bd264(0x78)]});}},listAssistants=async(_0x4a1b58,_0x1377fc)=>{const _0x58357f=_0x339f24,_0x4e2f89={'kGqiu':_0x58357f(0xc9),'VYumo':_0x58357f(0xa1)};try{const _0x38aba1=await fetchAssistants({'req':_0x4a1b58,'res':_0x1377fc});_0x1377fc[_0x58357f(0xb0)](_0x38aba1);}catch(_0x28a8fe){logger['error'](_0x4e2f89[_0x58357f(0xa9)],_0x28a8fe),_0x1377fc['status'](0x1f4)['json']({'message':_0x4e2f89[_0x58357f(0xa7)]});}};function filterAssistantDocs({documents:_0x544374,userId:_0x4d6531,assistantsConfig:assistantsConfig={}}){const _0x1f4d55=_0x339f24,{supportedIds:_0x4e33d2,excludedIds:_0x7d8e60,privateAssistants:_0x2f9127}=assistantsConfig,_0x237b71=_0x3a446f=>{const {user:_0x5443af,..._0x21e377}=_0x3a446f;return _0x21e377;};if(_0x2f9127)return _0x544374[_0x1f4d55(0x81)](_0x599d86=>_0x4d6531===_0x599d86['user'][_0x1f4d55(0x85)]())[_0x1f4d55(0x96)](_0x237b71);else{if(_0x4e33d2?.[_0x1f4d55(0xc3)])return _0x544374[_0x1f4d55(0x81)](_0x3cc02b=>_0x4e33d2[_0x1f4d55(0x91)](_0x3cc02b[_0x1f4d55(0xc5)]))['map'](_0x237b71);else{if(_0x7d8e60?.[_0x1f4d55(0xc3)])return _0x544374[_0x1f4d55(0x81)](_0x4d69ad=>!_0x7d8e60[_0x1f4d55(0x91)](_0x4d69ad[_0x1f4d55(0xc5)]))['map'](_0x237b71);}}return _0x544374[_0x1f4d55(0x96)](_0x237b71);}const getAssistantDocuments=async(_0x44a802,_0x153e93)=>{const _0x1edf5e=_0x339f24,_0x39b87e={'pxPyf':function(_0x21cec1,_0x36f622,_0x26eec9){return _0x21cec1(_0x36f622,_0x26eec9);},'HpgcQ':function(_0x240365,_0x333cfa){return _0x240365(_0x333cfa);}};try{const _0x18a5ea=_0x44a802[_0x1edf5e(0x99)],_0x2a5aca=_0x44a802[_0x1edf5e(0x76)][_0x1edf5e(0x9b)][_0x18a5ea],_0x58d35c=await _0x39b87e[_0x1edf5e(0x89)](getAssistants,{},{'user':0x1,'assistant_id':0x1,'conversation_starters':0x1,'createdAt':0x1,'updatedAt':0x1}),_0x2b49b7=_0x39b87e[_0x1edf5e(0x86)](filterAssistantDocs,{'documents':_0x58d35c,'userId':_0x44a802['user']['id'],'assistantsConfig':_0x2a5aca});_0x153e93['json'](_0x2b49b7);}catch(_0xa1c5c2){logger[_0x1edf5e(0x93)]('[/assistants/documents]\x20Error\x20listing\x20assistant\x20documents',_0xa1c5c2),_0x153e93[_0x1edf5e(0xbd)](0x1f4)['json']({'error':_0xa1c5c2[_0x1edf5e(0xb1)]});}},uploadAssistantAvatar=async(_0x32bc2e,_0x592aee)=>{const _0x1bf7fa=_0x339f24,_0x3c8acd={'yhILJ':_0x1bf7fa(0x79),'YuONe':function(_0x59d2ff,_0xad3e80){return _0x59d2ff(_0xad3e80);},'MioGg':_0x1bf7fa(0x72),'fZbQy':function(_0x45b06e,_0x539e03,_0x40ec24){return _0x45b06e(_0x539e03,_0x40ec24);},'Iewez':'[/avatar/:assistant_id]\x20Error\x20deleting\x20old\x20avatar','vCRNY':function(_0x554847,_0x53c2ef,_0x3c5bf4){return _0x554847(_0x53c2ef,_0x3c5bf4);}};try{const {assistant_id:_0x53ce3d}=_0x32bc2e[_0x1bf7fa(0xba)];if(!_0x53ce3d)return _0x592aee[_0x1bf7fa(0xbd)](0x190)[_0x1bf7fa(0xb0)]({'message':_0x1bf7fa(0x80)});let {metadata:_0x38eb0c='{}'}=_0x32bc2e[_0x1bf7fa(0xa4)];const {openai:_0x466959}=await getOpenAIClient({'req':_0x32bc2e,'res':_0x592aee});await _0x3c8acd[_0x1bf7fa(0xc8)](validateAuthor,{'req':_0x32bc2e,'openai':_0x466959});const _0xd4a706=await uploadImageBuffer({'req':_0x32bc2e,'context':FileContext[_0x1bf7fa(0xa0)],'metadata':{'buffer':_0x32bc2e[_0x1bf7fa(0xbe)][_0x1bf7fa(0x90)]}});try{_0x3c8acd[_0x1bf7fa(0x9f)]!=='jblzC'?_0x38eb0c=JSON[_0x1bf7fa(0x7b)](_0x38eb0c):(_0x58ce3d[_0x1bf7fa(0x93)](_0x3c8acd['yhILJ'],_0xf5617d),_0x45cb13={});}catch(_0x4b8ee9){logger[_0x1bf7fa(0x93)](_0x3c8acd[_0x1bf7fa(0xc0)],_0x4b8ee9),_0x38eb0c={};}if(_0x38eb0c['avatar']&&_0x38eb0c['avatar_source']){const {deleteFile:_0x47aebd}=_0x3c8acd[_0x1bf7fa(0xc8)](getStrategyFunctions,_0x38eb0c[_0x1bf7fa(0x94)]);try{await _0x3c8acd[_0x1bf7fa(0xbf)](_0x47aebd,_0x32bc2e,{'filepath':_0x38eb0c[_0x1bf7fa(0xa0)]}),await _0x3c8acd['YuONe'](deleteFileByFilter,{'filepath':_0x38eb0c['avatar']});}catch(_0x494fd4){logger['error'](_0x3c8acd[_0x1bf7fa(0xc1)],_0x494fd4);}}const _0x1cb29f={..._0x38eb0c,'avatar':_0xd4a706[_0x1bf7fa(0xbc)],'avatar_source':_0x32bc2e[_0x1bf7fa(0x76)]['locals'][_0x1bf7fa(0xad)]},_0x605dd0=[];_0x605dd0[_0x1bf7fa(0x8c)](_0x3c8acd[_0x1bf7fa(0xa3)](updateAssistantDoc,{'assistant_id':_0x53ce3d},{'avatar':{'filepath':_0xd4a706[_0x1bf7fa(0xbc)],'source':_0x32bc2e[_0x1bf7fa(0x76)]['locals'][_0x1bf7fa(0xad)]},'user':_0x32bc2e[_0x1bf7fa(0xb3)]['id']})),_0x605dd0['push'](_0x466959[_0x1bf7fa(0xa6)][_0x1bf7fa(0xc6)]['update'](_0x53ce3d,{'metadata':_0x1cb29f}));const _0x13b16b=await Promise['all'](_0x605dd0);_0x592aee[_0x1bf7fa(0xbd)](0xc9)[_0x1bf7fa(0xb0)](_0x13b16b[0x1]);}catch(_0x1c86ae){const _0x1f3f5b='An\x20error\x20occurred\x20while\x20updating\x20the\x20Assistant\x20Avatar';logger[_0x1bf7fa(0x93)](_0x1f3f5b,_0x1c86ae),_0x592aee[_0x1bf7fa(0xbd)](0x1f4)['json']({'message':_0x1f3f5b});}};module[_0x339f24(0xb2)]={'createAssistant':createAssistant,'retrieveAssistant':retrieveAssistant,'patchAssistant':patchAssistant,'deleteAssistant':deleteAssistant,'listAssistants':listAssistants,'getAssistantDocuments':getAssistantDocuments,'uploadAssistantAvatar':uploadAssistantAvatar};