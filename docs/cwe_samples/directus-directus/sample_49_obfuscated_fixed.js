function _0x2dce(_0x2aded9,_0x3d076b){const _0x20a419=_0x20a4();return _0x2dce=function(_0x2dce12,_0x3b043c){_0x2dce12=_0x2dce12-0x150;let _0x1d2e1a=_0x20a419[_0x2dce12];return _0x1d2e1a;},_0x2dce(_0x2aded9,_0x3d076b);}const _0x1ca675=_0x2dce;(function(_0x5bc74c,_0x1cfe0c){const _0x48d47e=_0x2dce,_0xe6dfa3=_0x5bc74c();while(!![]){try{const _0x2ea208=parseInt(_0x48d47e(0x188))/0x1*(-parseInt(_0x48d47e(0x155))/0x2)+parseInt(_0x48d47e(0x16c))/0x3+parseInt(_0x48d47e(0x176))/0x4*(-parseInt(_0x48d47e(0x16d))/0x5)+-parseInt(_0x48d47e(0x173))/0x6*(-parseInt(_0x48d47e(0x187))/0x7)+parseInt(_0x48d47e(0x18d))/0x8*(-parseInt(_0x48d47e(0x169))/0x9)+parseInt(_0x48d47e(0x17e))/0xa+-parseInt(_0x48d47e(0x183))/0xb;if(_0x2ea208===_0x1cfe0c)break;else _0xe6dfa3['push'](_0xe6dfa3['shift']());}catch(_0x54202d){_0xe6dfa3['push'](_0xe6dfa3['shift']());}}}(_0x20a4,0x8c834));function _0x20a4(){const _0x33523e=['AxBwW','userMessagePromise','uYGaH','[AskController]\x20Request\x20closed','promptTokens','~/server/middleware','body','sendMessage','uazdJ','librechat-data-provider','debug','fHgDv','90IeAxkr','[AskController]\x20Request\x20aborted\x20on\x20close','title','265881XLvUcK','30dWVOxr','BPYwf','KEeaI','conversationId','lodash/throttle','OXVbi','6VUxtLn','userMessage','modelsConfig','9736UUJrNZ','~/server/utils','LpAop','eySiZ','requestCompleted','responseMessageId','New\x20Chat','attachments','10983460FEkemD','skipSaveUserMessage','kDivt','exists','FIVE_MINUTES','5599792eoJJSK','QnNhv','image_urls','CGRZJ','7114317fAvRiS','81269iBMCCX','NO_PARENT','aborted','~/models','end','753240DEalrW','~/cache','options','files','wqLhA','model','endpoint','4mSaBwg','messageId','close','api/server/controllers/AskController.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','responsePromise','exports','modelOptions','nwNPL'];_0x20a4=function(){return _0x33523e;};return _0x20a4();}const throttle=require(_0x1ca675(0x171)),{getResponseSender,Constants,CacheKeys,Time}=require(_0x1ca675(0x166)),{createAbortController,handleAbortError}=require(_0x1ca675(0x162)),{sendMessage,createOnProgress}=require(_0x1ca675(0x177)),{getLogStores}=require(_0x1ca675(0x18e)),{saveMessage}=require(_0x1ca675(0x18b)),{logger}=require('~/config'),AskController=async(_0x16ecdb,_0x35fac7,_0x201c9b,_0x5e5d67,_0x3a8311)=>{const _0xd08c6a=_0x1ca675,_0x15f963={'qrhvs':function(_0x22ac58,_0x5af81a){return _0x22ac58===_0x5af81a;},'uazdJ':_0xd08c6a(0x174),'wJfqz':_0xd08c6a(0x15e),'YbDqn':'LpAop','QnNhv':_0xd08c6a(0x180),'CGRZJ':'[AskController]','BPYwf':_0xd08c6a(0x181),'fHgDv':function(_0x31b977,_0x477eda){return _0x31b977(_0x477eda);},'wqLhA':function(_0x13c9ef,_0x527679,_0x3f7f6b,_0x447abd){return _0x13c9ef(_0x527679,_0x3f7f6b,_0x447abd);},'nwNPL':_0xd08c6a(0x157),'KEeaI':_0xd08c6a(0x17c),'eySiZ':function(_0x36ccc7,_0xafa22e,_0x55db96){return _0x36ccc7(_0xafa22e,_0x55db96);},'uYGaH':'api/server/controllers/AskController.js\x20-\x20response\x20end','AxBwW':function(_0x425a6b,_0x3abdfd){return _0x425a6b===_0x3abdfd;},'OXVbi':function(_0x582422,_0x293a2f){return _0x582422??_0x293a2f;}};let {text:_0x553268,endpointOption:_0x54041d,conversationId:_0x47e333,modelDisplayLabel:_0x3d1204,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x16ecdb[_0xd08c6a(0x163)];logger[_0xd08c6a(0x167)](_0x15f963[_0xd08c6a(0x186)],{'text':_0x553268,'conversationId':_0x47e333,..._0x54041d,'modelsConfig':_0x54041d[_0xd08c6a(0x175)]?_0x15f963[_0xd08c6a(0x16e)]:''});let _0x25650e,_0x3cb82f,_0x1cfce1,_0x9273d,_0x3583fd;const _0x20ee7e=getResponseSender({..._0x54041d,'model':_0x54041d[_0xd08c6a(0x15b)][_0xd08c6a(0x153)],'modelDisplayLabel':_0x3d1204}),_0x1076d1=!_0x47e333,_0x2ff632=_0x16ecdb['user']['id'],_0x1fd2e8=(_0x564fd1={})=>{const _0x4e48d7=_0xd08c6a;for(let _0xd7e36e in _0x564fd1){if(_0x15f963['qrhvs'](_0xd7e36e,_0x15f963[_0x4e48d7(0x165)]))_0x25650e=_0x564fd1[_0xd7e36e],_0x9273d=_0x564fd1[_0xd7e36e][_0x4e48d7(0x156)];else{if(_0xd7e36e===_0x15f963['wJfqz'])_0x4e48d7(0x178)!==_0x15f963['YbDqn']?(_0x5f55ad=_0x1493ab[_0x1964a8],_0x21852c=_0x56355e[_0x1f896b][_0x4e48d7(0x156)]):_0x3cb82f=_0x564fd1[_0xd7e36e];else{if(_0xd7e36e===_0x4e48d7(0x17b))_0x4e48d7(0x180)===_0x15f963[_0x4e48d7(0x184)]?_0x3583fd=_0x564fd1[_0xd7e36e]:(_0x3db386[_0x4e48d7(0x151)]=_0x24c80a[_0x4e48d7(0x150)][_0x4e48d7(0x17d)],_0x6b7310['model']=_0x4cecb3[_0x4e48d7(0x15b)][_0x4e48d7(0x153)],delete _0x215eb0[_0x4e48d7(0x185)]);else{if(_0xd7e36e===_0x4e48d7(0x161))_0x1cfce1=_0x564fd1[_0xd7e36e];else!_0x47e333&&_0xd7e36e===_0x4e48d7(0x170)&&(_0x47e333=_0x564fd1[_0xd7e36e]);}}}}};let _0x2f72e5;try{const {client:_0x137d34}=await _0x15f963[_0xd08c6a(0x168)](_0x5e5d67,{'req':_0x16ecdb,'res':_0x35fac7,'endpointOption':_0x54041d}),_0x2c4fdf=_0x15f963[_0xd08c6a(0x168)](getLogStores,CacheKeys['MESSAGES']),{onProgress:_0x11a066,getPartialText:_0x33d4e0}=createOnProgress({'onProgress':_0x15f963[_0xd08c6a(0x152)](throttle,({text:_0x85956f})=>{const _0x4dd0a2=_0xd08c6a;_0x2c4fdf['set'](_0x3583fd,_0x85956f,Time[_0x4dd0a2(0x182)]);},0xbb8,{'trailing':![]})});_0x2f72e5=_0x33d4e0;const _0x5b195e=()=>({'sender':_0x20ee7e,'conversationId':_0x47e333,'userMessagePromise':_0x3cb82f,'messageId':_0x3583fd,'parentMessageId':overrideParentMessageId??_0x9273d,'text':_0x33d4e0(),'userMessage':_0x25650e,'promptTokens':_0x1cfce1}),{abortController:_0x4bba2b,onStart:_0x29b788}=createAbortController(_0x16ecdb,_0x35fac7,_0x5b195e,_0x1fd2e8);_0x35fac7['on'](_0x15f963[_0xd08c6a(0x15c)],()=>{const _0x40e0d6=_0xd08c6a;logger[_0x40e0d6(0x167)](_0x40e0d6(0x160));if(!_0x4bba2b)return;else{if(_0x4bba2b['signal'][_0x40e0d6(0x18a)])return;else{if(_0x4bba2b[_0x40e0d6(0x17a)])return;}}_0x4bba2b['abort'](),logger['debug'](_0x40e0d6(0x16a));});const _0x489f64={'user':_0x2ff632,'parentMessageId':parentMessageId,'conversationId':_0x47e333,'overrideParentMessageId':overrideParentMessageId,'getReqData':_0x1fd2e8,'onStart':_0x29b788,'abortController':_0x4bba2b,'progressCallback':_0x11a066,'progressOptions':{'res':_0x35fac7}};let _0x274462=await _0x137d34[_0xd08c6a(0x164)](_0x553268,_0x489f64);_0x274462[_0xd08c6a(0x154)]=_0x54041d[_0xd08c6a(0x154)];const {conversation:conversation={}}=await _0x137d34[_0xd08c6a(0x159)];conversation['title']=conversation&&!conversation[_0xd08c6a(0x16b)]?null:conversation?.[_0xd08c6a(0x16b)]||_0x15f963[_0xd08c6a(0x16f)],_0x137d34[_0xd08c6a(0x150)]['attachments']&&(_0x25650e[_0xd08c6a(0x151)]=_0x137d34['options'][_0xd08c6a(0x17d)],conversation['model']=_0x54041d[_0xd08c6a(0x15b)]['model'],delete _0x25650e['image_urls']),!_0x4bba2b['signal'][_0xd08c6a(0x18a)]&&(_0x15f963[_0xd08c6a(0x179)](sendMessage,_0x35fac7,{'final':!![],'conversation':conversation,'title':conversation[_0xd08c6a(0x16b)],'requestMessage':_0x25650e,'responseMessage':_0x274462}),_0x35fac7[_0xd08c6a(0x18c)](),await saveMessage(_0x16ecdb,{..._0x274462,'user':_0x2ff632},{'context':_0x15f963[_0xd08c6a(0x15f)]})),!_0x137d34[_0xd08c6a(0x17f)]&&await saveMessage(_0x16ecdb,_0x25650e,{'context':_0xd08c6a(0x158)}),_0x3a8311&&_0x15f963[_0xd08c6a(0x15d)](parentMessageId,Constants[_0xd08c6a(0x189)])&&_0x1076d1&&_0x3a8311(_0x16ecdb,{'text':_0x553268,'response':_0x274462,'client':_0x137d34});}catch(_0x3c5983){const _0x2841f3=_0x2f72e5&&_0x2f72e5();handleAbortError(_0x35fac7,_0x16ecdb,_0x3c5983,{'partialText':_0x2841f3,'conversationId':_0x47e333,'sender':_0x20ee7e,'messageId':_0x3583fd,'parentMessageId':_0x15f963[_0xd08c6a(0x172)](_0x9273d,parentMessageId)});}};module[_0x1ca675(0x15a)]=AskController;