function _0x3a20(){const _0x56a167=['_test','https://example.com/','test2','https://example.net/','from','1523500Gygmdk','uninstall','7GGVozi','https://example.com/:\x20An\x20error\x20message.','719504YtSXkP','33277134rnfJHJ','kIBiR','iyACZ','XepBJ','TjqFg','Fetched\x20object','HTTP\x20404:\x20https://example.com/404','name','https://example.com/*','ueSJS','QuzMi','The\x20maximum\x20cache\x20duration\x20is\x2030\x20days','TXhEB','step','KxyvU','16dheveh','DaOJn','bJZYB','24906nPkPNB','XGwAf','https://example.com/object','url','124qHSUSi','ZvKyd','oHajP','zlgXP','not\x20cached','Now','message','Duration','install','GET@/object','FetchError','aaVnL','set','application/json','Object','rliJY','860bYiBxY','dnHHr','test','fetchDocumentLoader()','https://example.org/','OgUQW','https://example.com/404','vVFuE','FgbQX','eRERr','dzLTl','cached','Hxhck','https://www.w3.org/ns/activitystreams','not\x20ok','vixYO','3355098HUnIYb','mock','maximum\x20cache\x20duration','An\x20error\x20message.','MSRzf','10235NhETlK','jXVKK','hDpAN','stringify','IPYyy','kvCache()','2300409HhOgRA','APADH'];_0x3a20=function(){return _0x56a167;};return _0x3a20();}const _0x369402=_0x48f9;(function(_0x1bc33a,_0x52d969){const _0x5c2aa2=_0x48f9,_0x420b12=_0x1bc33a();while(!![]){try{const _0xca1b7b=-parseInt(_0x5c2aa2(0x1cc))/0x1+-parseInt(_0x5c2aa2(0x196))/0x2*(parseInt(_0x5c2aa2(0x1df))/0x3)+parseInt(_0x5c2aa2(0x1a6))/0x4*(-parseInt(_0x5c2aa2(0x1bb))/0x5)+parseInt(_0x5c2aa2(0x1b6))/0x6*(-parseInt(_0x5c2aa2(0x1ca))/0x7)+parseInt(_0x5c2aa2(0x1dc))/0x8*(-parseInt(_0x5c2aa2(0x1c1))/0x9)+parseInt(_0x5c2aa2(0x1c8))/0xa+parseInt(_0x5c2aa2(0x1cd))/0xb;if(_0xca1b7b===_0x52d969)break;else _0x420b12['push'](_0x420b12['shift']());}catch(_0x4a6a4f){_0x420b12['push'](_0x420b12['shift']());}}}(_0x3a20,0x69aba));import{assertEquals,assertRejects,assertThrows}from'@std/assert';import*as _0x5ed157 from'mock_fetch';import{MemoryKvStore}from'../federation/kv.ts';function _0x48f9(_0x5b4714,_0x17f7a0){const _0x3a209d=_0x3a20();return _0x48f9=function(_0x48f996,_0x32d82a){_0x48f996=_0x48f996-0x196;let _0x3d7512=_0x3a209d[_0x48f996];return _0x3d7512;},_0x48f9(_0x5b4714,_0x17f7a0);}import{verify}from'../httpsig/mod.ts';import{mockDocumentLoader}from'../testing/docloader.ts';import{privateKey2}from'../testing/keys.ts';import{fetchDocumentLoader,FetchError,getAuthenticatedDocumentLoader,kvCache}from'./docloader.ts';Deno[_0x369402(0x1a8)]('new\x20FetchError()',()=>{const _0x32a0a9=_0x369402,_0x4cd638={'FgbQX':_0x32a0a9(0x1c4),'dzLTl':function(_0x1b6f2a,_0x109544,_0x2fc4a8){return _0x1b6f2a(_0x109544,_0x2fc4a8);},'ZvKyd':function(_0x158033,_0x3ce830,_0x4eee04){return _0x158033(_0x3ce830,_0x4eee04);},'XepBJ':_0x32a0a9(0x1aa)},_0x2c9fd2=new FetchError(_0x4cd638[_0x32a0a9(0x1ae)],_0x32a0a9(0x1b9));_0x4cd638[_0x32a0a9(0x1b0)](assertEquals,_0x2c9fd2[_0x32a0a9(0x1d4)],_0x32a0a9(0x1a0)),assertEquals(_0x2c9fd2[_0x32a0a9(0x1e2)],new URL(_0x32a0a9(0x1c4))),assertEquals(_0x2c9fd2[_0x32a0a9(0x19c)],_0x32a0a9(0x1cb));const _0x453744=new FetchError(new URL(_0x32a0a9(0x1aa)));_0x4cd638[_0x32a0a9(0x1b0)](assertEquals,_0x453744[_0x32a0a9(0x1e2)],new URL('https://example.org/')),_0x4cd638[_0x32a0a9(0x197)](assertEquals,_0x453744[_0x32a0a9(0x19c)],_0x4cd638[_0x32a0a9(0x1d0)]);}),Deno[_0x369402(0x1a8)](_0x369402(0x1a9),async _0x3522b4=>{const _0x3c0a2a=_0x369402,_0x103a93={'kIBiR':_0x3c0a2a(0x1e1),'vixYO':_0x3c0a2a(0x1b3),'oQcvw':_0x3c0a2a(0x1a4),'APADH':_0x3c0a2a(0x1d3),'yioDh':_0x3c0a2a(0x1b4)};_0x5ed157[_0x3c0a2a(0x19e)](),_0x5ed157['mock'](_0x3c0a2a(0x19f),_0x73ed07=>new Response(JSON[_0x3c0a2a(0x1be)]({'@context':_0x3c0a2a(0x1b3),'id':_0x3c0a2a(0x1e1),'name':_0x3c0a2a(0x1d2),'type':_0x3c0a2a(0x1a4)}),{'status':0xc8})),await _0x3522b4[_0x3c0a2a(0x1da)]('ok',async()=>{const _0x1e95b7=_0x3c0a2a;assertEquals(await fetchDocumentLoader(_0x103a93['kIBiR']),{'contextUrl':null,'documentUrl':'https://example.com/object','document':{'@context':_0x103a93[_0x1e95b7(0x1b5)],'id':_0x103a93[_0x1e95b7(0x1ce)],'name':_0x1e95b7(0x1d2),'type':_0x103a93['oQcvw']}});}),_0x5ed157[_0x3c0a2a(0x1b7)]('GET@/404',_0x26661f=>new Response('',{'status':0x194})),await _0x3522b4[_0x3c0a2a(0x1da)](_0x103a93['yioDh'],async()=>{const _0x1fbb8c=_0x3c0a2a;await assertRejects(()=>fetchDocumentLoader(_0x1fbb8c(0x1ac)),FetchError,_0x103a93[_0x1fbb8c(0x1c2)]);}),_0x5ed157[_0x3c0a2a(0x1c9)]();}),Deno[_0x369402(0x1a8)]('getAuthenticatedDocumentLoader()',async _0x3a3d9d=>{const _0xb3493d=_0x369402,_0x4f325c={'IPYyy':function(_0x13fa50,_0x2e9e00,_0x1c127b){return _0x13fa50(_0x2e9e00,_0x1c127b);},'ueSJS':function(_0x4cd0c5,_0x2039b8){return _0x4cd0c5!=_0x2039b8;},'OgUQW':_0xb3493d(0x1a3),'QuzMi':function(_0x254523,_0x2dee9d){return _0x254523(_0x2dee9d);},'XGwAf':'https://example.com/key2','DaOJn':function(_0x360a39,_0xf08a6b,_0x47491a){return _0x360a39(_0xf08a6b,_0x47491a);},'iyACZ':_0xb3493d(0x1e1)};_0x5ed157[_0xb3493d(0x19e)](),_0x5ed157[_0xb3493d(0x1b7)](_0xb3493d(0x19f),async _0x1efc76=>{const _0x86f8d1=_0xb3493d,_0x35a1eb=await _0x4f325c[_0x86f8d1(0x1bf)](verify,_0x1efc76,{'documentLoader':mockDocumentLoader,'contextLoader':mockDocumentLoader,'currentTime':Temporal[_0x86f8d1(0x19b)]['instant']()});return new Response(JSON[_0x86f8d1(0x1be)](_0x4f325c[_0x86f8d1(0x1d6)](_0x35a1eb,null)),{'headers':{'Content-Type':_0x4f325c[_0x86f8d1(0x1ab)]}});}),await _0x3a3d9d[_0xb3493d(0x1da)](_0xb3493d(0x1a8),async()=>{const _0x3bbf39=_0xb3493d,_0x27d5b1=await _0x4f325c[_0x3bbf39(0x1d7)](getAuthenticatedDocumentLoader,{'keyId':new URL(_0x4f325c[_0x3bbf39(0x1e0)]),'privateKey':privateKey2});_0x4f325c[_0x3bbf39(0x1dd)](assertEquals,await _0x27d5b1(_0x3bbf39(0x1e1)),{'contextUrl':null,'documentUrl':_0x4f325c[_0x3bbf39(0x1cf)],'document':!![]});}),_0x5ed157[_0xb3493d(0x1c9)]();}),Deno[_0x369402(0x1a8)](_0x369402(0x1c0),async _0x5ae242=>{const _0x316f64=_0x369402,_0x111b14={'QEDMp':function(_0x5f4bc2,_0x34e69d){return _0x5f4bc2(_0x34e69d);},'vVFuE':_0x316f64(0x1c6),'pTaOm':_0x316f64(0x1d5),'TjqFg':_0x316f64(0x1b1),'eRERr':_0x316f64(0x1e1),'aaVnL':'Fetched\x20object','rliJY':_0x316f64(0x1c3),'TXhEB':_0x316f64(0x1aa),'dnHHr':function(_0x26f5f1,_0x1df763){return _0x26f5f1(_0x1df763);},'MSRzf':function(_0x12d9f8,_0x3a5f42){return _0x12d9f8(_0x3a5f42);},'oHajP':_0x316f64(0x19a),'zlgXP':function(_0x4e34f6,_0x704d0f){return _0x4e34f6(_0x704d0f);},'KxyvU':function(_0x305cf5,_0x47f771,_0x2ef5b6){return _0x305cf5(_0x47f771,_0x2ef5b6);},'jXVKK':function(_0x110b48,_0x40759b,_0x4db89a){return _0x110b48(_0x40759b,_0x4db89a);},'hDpAN':function(_0x578fd6,_0x1db707,_0x5bc408,_0x2f8f9f){return _0x578fd6(_0x1db707,_0x5bc408,_0x2f8f9f);},'Hxhck':_0x316f64(0x1d8),'bJZYB':_0x316f64(0x1b8)},_0x116e3a=new MemoryKvStore();await _0x5ae242['step'](_0x316f64(0x1b1),async()=>{const _0x4bb483=_0x316f64,_0x3032d3=_0x111b14['QEDMp'](kvCache,{'kv':_0x116e3a,'loader':mockDocumentLoader,'rules':[['https://example.org/',Temporal[_0x4bb483(0x19d)]['from']({'days':0x1})],[new URL(_0x111b14[_0x4bb483(0x1ad)]),Temporal[_0x4bb483(0x19d)]['from']({'days':0x1})],[new URLPattern(_0x111b14['pTaOm']),Temporal['Duration']['from']({'days':0x1e})]],'prefix':[_0x4bb483(0x1c3),_0x111b14[_0x4bb483(0x1d1)]]}),_0xadfbe3=await _0x3032d3(_0x4bb483(0x1e1));assertEquals(_0xadfbe3,{'contextUrl':null,'documentUrl':_0x111b14[_0x4bb483(0x1af)],'document':{'@context':_0x4bb483(0x1b3),'id':_0x4bb483(0x1e1),'name':_0x111b14[_0x4bb483(0x1a1)],'type':_0x4bb483(0x1a4)}});const _0x38702e=await _0x116e3a['get']([_0x111b14['rliJY'],_0x4bb483(0x1b1),_0x111b14[_0x4bb483(0x1af)]]);assertEquals(_0x38702e,_0xadfbe3),await _0x116e3a[_0x4bb483(0x1a2)](['_test',_0x111b14['TjqFg'],_0x4bb483(0x1aa)],{'contextUrl':null,'documentUrl':'https://example.org/','document':{'id':'https://example.org/'}});const _0x306596=await _0x3032d3(_0x4bb483(0x1aa));assertEquals(_0x306596,{'contextUrl':null,'documentUrl':_0x4bb483(0x1aa),'document':{'id':_0x111b14[_0x4bb483(0x1d9)]}}),await _0x116e3a[_0x4bb483(0x1a2)]([_0x111b14[_0x4bb483(0x1a5)],_0x4bb483(0x1b1),_0x111b14['vVFuE']],{'contextUrl':null,'documentUrl':_0x111b14[_0x4bb483(0x1ad)],'document':{'id':_0x111b14[_0x4bb483(0x1ad)]}});const _0x2301d3=await _0x111b14[_0x4bb483(0x1a7)](_0x3032d3,_0x4bb483(0x1c6));assertEquals(_0x2301d3,{'contextUrl':null,'documentUrl':_0x4bb483(0x1c6),'document':{'id':_0x4bb483(0x1c6)}});}),await _0x5ae242[_0x316f64(0x1da)](_0x111b14[_0x316f64(0x198)],async()=>{const _0x2a6ecc=_0x316f64,_0x511f61=_0x111b14[_0x2a6ecc(0x1ba)](kvCache,{'kv':_0x116e3a,'loader':mockDocumentLoader,'rules':[],'prefix':[_0x111b14[_0x2a6ecc(0x1a5)],_0x111b14[_0x2a6ecc(0x198)]]}),_0xd10983=await _0x111b14[_0x2a6ecc(0x199)](_0x511f61,_0x111b14[_0x2a6ecc(0x1af)]);_0x111b14[_0x2a6ecc(0x1db)](assertEquals,_0xd10983,{'contextUrl':null,'documentUrl':_0x2a6ecc(0x1e1),'document':{'@context':'https://www.w3.org/ns/activitystreams','id':_0x111b14[_0x2a6ecc(0x1af)],'name':_0x2a6ecc(0x1d2),'type':_0x2a6ecc(0x1a4)}});const _0x284d24=await _0x116e3a['get']([_0x2a6ecc(0x1c5),_0x111b14[_0x2a6ecc(0x198)],_0x2a6ecc(0x1e1)]);_0x111b14[_0x2a6ecc(0x1bc)](assertEquals,_0x284d24,undefined);}),await _0x5ae242[_0x316f64(0x1da)](_0x111b14[_0x316f64(0x1de)],()=>{const _0x3e5b3e=_0x316f64;_0x111b14[_0x3e5b3e(0x1bd)](assertThrows,()=>kvCache({'kv':_0x116e3a,'loader':mockDocumentLoader,'rules':[[_0x3e5b3e(0x1c4),Temporal[_0x3e5b3e(0x19d)][_0x3e5b3e(0x1c7)]({'days':0x1e,'seconds':0x1})]]}),TypeError,_0x111b14[_0x3e5b3e(0x1b2)]),assertThrows(()=>kvCache({'kv':_0x116e3a,'loader':mockDocumentLoader,'rules':[[new URLPattern(_0x3e5b3e(0x1d5)),Temporal['Duration'][_0x3e5b3e(0x1c7)]({'days':0x1e,'seconds':0x1})]]}),TypeError,_0x111b14['Hxhck']);});});