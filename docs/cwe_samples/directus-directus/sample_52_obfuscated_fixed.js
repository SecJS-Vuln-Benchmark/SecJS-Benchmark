const _0x1aef75=_0x765f;function _0x400e(){const _0x547f83=['exports','9nhQCAB','WpIvm','328506pedZYv','user','~/config','31438660htxFiq','aborted','endpoint','gHCLC','HBksg','JPPKW','api/server/controllers/agents/request.js\x20-\x20response\x20end','VZXnM','sendMessage','attachments','getContentParts','6429790PQiUhG','messageId','files','body','title','requestCompleted','7WSODDE','conversationId','Mkule','spwSZ','sgXCw','LPLxH','responseMessageId','image_urls','New\x20Chat','userMessage','end','~/models','5532752KueYJe','32iJZDAO','DUrRp','~/server/middleware','aORIx','options','2150724djTFAg','NO_PARENT','signal','sender','promptTokens','YcHyX','userMessagePromise','api/server/controllers/agents/request.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','132954OpyPQF','BmTeW','debug','lgUHE','305196efnfRd','[AgentController]\x20Request\x20closed','responsePromise','librechat-data-provider','skipSaveUserMessage','close'];_0x400e=function(){return _0x547f83;};return _0x400e();}(function(_0x58838a,_0xd9b0c1){const _0x3b046e=_0x765f,_0x4a4f45=_0x58838a();while(!![]){try{const _0x244150=-parseInt(_0x3b046e(0x16e))/0x1+parseInt(_0x3b046e(0x172))/0x2+-parseInt(_0x3b046e(0x17b))/0x3*(parseInt(_0x3b046e(0x161))/0x4)+-parseInt(_0x3b046e(0x14e))/0x5+parseInt(_0x3b046e(0x166))/0x6+-parseInt(_0x3b046e(0x154))/0x7*(parseInt(_0x3b046e(0x160))/0x8)+parseInt(_0x3b046e(0x179))/0x9*(parseInt(_0x3b046e(0x17e))/0xa);if(_0x244150===_0xd9b0c1)break;else _0x4a4f45['push'](_0x4a4f45['shift']());}catch(_0x3639de){_0x4a4f45['push'](_0x4a4f45['shift']());}}}(_0x400e,0xa32ec));function _0x765f(_0x42c168,_0x20dca9){const _0x400ed7=_0x400e();return _0x765f=function(_0x765f2e,_0x885d97){_0x765f2e=_0x765f2e-0x14a;let _0x49161f=_0x400ed7[_0x765f2e];return _0x49161f;},_0x765f(_0x42c168,_0x20dca9);}const {Constants}=require(_0x1aef75(0x175)),{createAbortController,handleAbortError}=require(_0x1aef75(0x163)),{sendMessage}=require('~/server/utils'),{saveMessage}=require(_0x1aef75(0x15f)),{logger}=require(_0x1aef75(0x17d)),AgentController=async(_0x198fc6,_0x2d6989,_0x556b14,_0x257cca,_0xe89754)=>{const _0x35f8d1=_0x1aef75,_0x5ac1ae={'LPLxH':_0x35f8d1(0x14a),'ItSbM':function(_0x51bacd,_0x3871e6){return _0x51bacd===_0x3871e6;},'gHCLC':function(_0x116fb1,_0x365703){return _0x116fb1===_0x365703;},'JPPKW':_0x35f8d1(0x16a),'aORIx':function(_0x39ef37,_0x1c9271,_0x47fe9d,_0x1ed998,_0xefaffd){return _0x39ef37(_0x1c9271,_0x47fe9d,_0x1ed998,_0xefaffd);},'sgXCw':function(_0x3b0fa4,_0x3e221a){return _0x3b0fa4??_0x3e221a;},'BmTeW':_0x35f8d1(0x17a),'YcHyX':'JFlFA','VwIEF':_0x35f8d1(0x182),'spwSZ':function(_0x16e3ad,_0x43ffc1,_0x585c81,_0x30f21b){return _0x16e3ad(_0x43ffc1,_0x585c81,_0x30f21b);},'lgUHE':_0x35f8d1(0x184),'MVGDp':_0x35f8d1(0x16d),'DUrRp':function(_0x441c9f,_0xf304ec,_0x2668e9){return _0x441c9f(_0xf304ec,_0x2668e9);},'TmoAW':function(_0x289a9e,_0x594ac2){return _0x289a9e??_0x594ac2;}};let {text:_0x1b3a6a,endpointOption:_0x24d97e,conversationId:_0xee9af4,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x198fc6[_0x35f8d1(0x151)],_0x487b38,_0x1db982,_0xb01212,_0x287ae1,_0x4ab3df,_0x5ed60f;const _0x2836f2=!_0xee9af4,_0x4bba47=_0x198fc6[_0x35f8d1(0x17c)]['id'],_0x3c922f=(_0x211202={})=>{const _0x303d0f=_0x35f8d1;for(let _0x10788f in _0x211202){if(_0x5ac1ae[_0x303d0f(0x159)]!==_0x303d0f(0x156)){if(_0x5ac1ae['ItSbM'](_0x10788f,_0x303d0f(0x15d)))_0x1db982=_0x211202[_0x10788f],_0x287ae1=_0x211202[_0x10788f][_0x303d0f(0x14f)];else{if(_0x5ac1ae[_0x303d0f(0x181)](_0x10788f,_0x303d0f(0x16c)))_0x5ed60f=_0x211202[_0x10788f];else{if(_0x10788f===_0x303d0f(0x15a))_0x4ab3df=_0x211202[_0x10788f];else{if(_0x5ac1ae[_0x303d0f(0x181)](_0x10788f,_0x5ac1ae[_0x303d0f(0x183)]))_0xb01212=_0x211202[_0x10788f];else{if(_0x10788f===_0x303d0f(0x169))_0x487b38=_0x211202[_0x10788f];else!_0xee9af4&&_0x5ac1ae['gHCLC'](_0x10788f,_0x303d0f(0x155))&&(_0xee9af4=_0x211202[_0x10788f]);}}}}}else _0x4228f5=_0xdd624c[_0x3cdca6];}};try{if(_0x5ac1ae[_0x35f8d1(0x16f)]!==_0x5ac1ae[_0x35f8d1(0x16b)]){const {client:_0x4e109}=await _0x257cca({'req':_0x198fc6,'res':_0x2d6989,'endpointOption':_0x24d97e}),_0xc40c91=()=>({'sender':_0x487b38,'userMessage':_0x1db982,'promptTokens':_0xb01212,'conversationId':_0xee9af4,'userMessagePromise':_0x5ed60f,'messageId':_0x4ab3df,'content':_0x4e109[_0x35f8d1(0x14d)](),'parentMessageId':overrideParentMessageId??_0x287ae1}),{abortController:_0x4247f8,onStart:_0x13c19e}=_0x5ac1ae[_0x35f8d1(0x164)](createAbortController,_0x198fc6,_0x2d6989,_0xc40c91,_0x3c922f);_0x2d6989['on'](_0x35f8d1(0x177),()=>{const _0x3ad06a=_0x35f8d1;logger[_0x3ad06a(0x170)](_0x3ad06a(0x173));if(!_0x4247f8)return;else{if(_0x4247f8[_0x3ad06a(0x168)][_0x3ad06a(0x17f)])return;else{if(_0x4247f8[_0x3ad06a(0x153)])return;}}_0x4247f8['abort'](),logger[_0x3ad06a(0x170)]('[AgentController]\x20Request\x20aborted\x20on\x20close');});const _0x4c8ed6={'user':_0x4bba47,'onStart':_0x13c19e,'getReqData':_0x3c922f,'conversationId':_0xee9af4,'parentMessageId':parentMessageId,'abortController':_0x4247f8,'overrideParentMessageId':overrideParentMessageId,'progressOptions':{'res':_0x2d6989}};let _0x386ef4=await _0x4e109[_0x35f8d1(0x14b)](_0x1b3a6a,_0x4c8ed6);_0x386ef4[_0x35f8d1(0x180)]=_0x24d97e[_0x35f8d1(0x180)];const {conversation:conversation={}}=await _0x4e109[_0x35f8d1(0x174)];conversation[_0x35f8d1(0x152)]=conversation&&!conversation[_0x35f8d1(0x152)]?null:conversation?.[_0x35f8d1(0x152)]||_0x35f8d1(0x15c);if(_0x4e109[_0x35f8d1(0x165)][_0x35f8d1(0x14c)]){if('fZjmH'!==_0x5ac1ae['VwIEF'])_0x1db982[_0x35f8d1(0x150)]=_0x4e109['options'][_0x35f8d1(0x14c)],delete _0x1db982[_0x35f8d1(0x15b)];else return;}!_0x4247f8['signal'][_0x35f8d1(0x17f)]&&(sendMessage(_0x2d6989,{'final':!![],'conversation':conversation,'title':conversation['title'],'requestMessage':_0x1db982,'responseMessage':_0x386ef4}),_0x2d6989[_0x35f8d1(0x15e)](),await _0x5ac1ae[_0x35f8d1(0x157)](saveMessage,_0x198fc6,{..._0x386ef4,'user':_0x4bba47},{'context':_0x5ac1ae[_0x35f8d1(0x171)]})),!_0x4e109[_0x35f8d1(0x176)]&&await saveMessage(_0x198fc6,_0x1db982,{'context':_0x5ac1ae['MVGDp']}),_0xe89754&&parentMessageId===Constants[_0x35f8d1(0x167)]&&_0x2836f2&&_0x5ac1ae[_0x35f8d1(0x162)](_0xe89754,_0x198fc6,{'text':_0x1b3a6a,'response':_0x386ef4,'client':_0x4e109});}else _0x5ac1ae['aORIx'](_0x1451ff,_0x1c23bd,_0x4d0dfc,_0x22d76e,{'conversationId':_0x513cea,'sender':_0x35e7fb,'messageId':_0x204ea7,'parentMessageId':_0x5ac1ae[_0x35f8d1(0x158)](_0x4ac88a,_0x153aae)});}catch(_0x5ba16b){_0x5ac1ae[_0x35f8d1(0x164)](handleAbortError,_0x2d6989,_0x198fc6,_0x5ba16b,{'conversationId':_0xee9af4,'sender':_0x487b38,'messageId':_0x4ab3df,'parentMessageId':_0x5ac1ae['TmoAW'](_0x287ae1,parentMessageId)});}};module[_0x1aef75(0x178)]=AgentController;