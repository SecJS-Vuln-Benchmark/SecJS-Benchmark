const _0x49f019=_0x5e15;(function(_0x54b6dd,_0x267cd4){const _0x5a37ad=_0x5e15,_0x5bca9c=_0x54b6dd();while(!![]){try{const _0x39fdc0=-parseInt(_0x5a37ad(0x15e))/0x1*(parseInt(_0x5a37ad(0x156))/0x2)+parseInt(_0x5a37ad(0x164))/0x3*(-parseInt(_0x5a37ad(0x163))/0x4)+-parseInt(_0x5a37ad(0x15c))/0x5+parseInt(_0x5a37ad(0x160))/0x6*(-parseInt(_0x5a37ad(0x151))/0x7)+parseInt(_0x5a37ad(0x14f))/0x8+parseInt(_0x5a37ad(0x169))/0x9*(parseInt(_0x5a37ad(0x157))/0xa)+parseInt(_0x5a37ad(0x154))/0xb;if(_0x39fdc0===_0x267cd4)break;else _0x5bca9c['push'](_0x5bca9c['shift']());}catch(_0x309e31){_0x5bca9c['push'](_0x5bca9c['shift']());}}}(_0x5ed8,0x37d8a));const Keyv=require(_0x49f019(0x15a)),uap=require(_0x49f019(0x175)),{ViolationTypes}=require(_0x49f019(0x17e)),{isEnabled,removePorts}=require(_0x49f019(0x16c)),keyvMongo=require('~/cache/keyvMongo'),denyRequest=require('./denyRequest'),{getLogStores}=require(_0x49f019(0x176)),{findUser}=require('~/models'),banCache=new Keyv({'store':keyvMongo,'namespace':ViolationTypes[_0x49f019(0x17a)],'ttl':0x0}),message='Your\x20account\x20has\x20been\x20temporarily\x20banned\x20due\x20to\x20violations\x20of\x20our\x20service.',banResponse=async(_0xcce4d5,_0x55c783)=>{const _0x51a22e=_0x49f019,_0x2023ae={'aUeIw':'user-agent','qdINN':function(_0x433982,_0x55b5f3){return _0x433982===_0x55b5f3;},'LlyYK':_0x51a22e(0x16e)},_0x49e691=uap(_0xcce4d5[_0x51a22e(0x177)][_0x2023ae[_0x51a22e(0x167)]]),{baseUrl:_0x37c58e}=_0xcce4d5;if(!_0x49e691[_0x51a22e(0x17b)][_0x51a22e(0x173)])return _0x55c783[_0x51a22e(0x168)](0x193)[_0x51a22e(0x166)]({'message':message});else{if(_0x2023ae[_0x51a22e(0x17d)](_0x37c58e,'/api/ask')||_0x37c58e===_0x2023ae[_0x51a22e(0x14d)])return await denyRequest(_0xcce4d5,_0x55c783,{'type':ViolationTypes[_0x51a22e(0x17a)]});}return _0x55c783[_0x51a22e(0x168)](0x193)['json']({'message':message});},checkBan=async(_0x4680da,_0xe23d9b,_0x266e73=()=>{})=>{const _0x3aa6b2=_0x49f019,_0x52ce06={'xCQnL':function(_0x193d10,_0x1630f6){return _0x193d10(_0x1630f6);},'eZSOa':function(_0x504d6d,_0x38a9e1){return _0x504d6d===_0x38a9e1;},'JoYIN':_0x3aa6b2(0x15b),'MEVoo':function(_0x2b2cb1){return _0x2b2cb1();},'WcEza':function(_0xbd915,_0x1fad34){return _0xbd915(_0x1fad34);},'boZgf':_0x3aa6b2(0x152),'EuXng':function(_0x391780,_0x31cf7b){return _0x391780(_0x31cf7b);},'IOLxY':function(_0x2f51bf,_0x3c87fd){return _0x2f51bf<=_0x3c87fd;},'AIDHE':_0x3aa6b2(0x158),'QQbcS':function(_0x174c89,_0x251cd0){return _0x174c89||_0x251cd0;},'ZnInR':function(_0x364877,_0x2c8f78){return _0x364877<=_0x2c8f78;},'qjhpu':function(_0x422552,_0x2c6c38,_0x14ccf4){return _0x422552(_0x2c6c38,_0x14ccf4);}},{BAN_VIOLATIONS:_0x1049f8}=process[_0x3aa6b2(0x15f)]??{};if(!_0x52ce06[_0x3aa6b2(0x171)](isEnabled,_0x1049f8)){if(_0x52ce06[_0x3aa6b2(0x162)](_0x52ce06['JoYIN'],'ulmIs'))return _0x52ce06['MEVoo'](_0x266e73);else _0x551f21[_0x3aa6b2(0x172)](_0x5ba9db,_0x5ab8f2,_0x1002a7);}_0x4680da['ip']=_0x52ce06['WcEza'](removePorts,_0x4680da);let _0xfd7c9f=_0x4680da[_0x3aa6b2(0x14b)]?.['id']??_0x4680da['user']?.[_0x3aa6b2(0x14c)]??null;if(!_0xfd7c9f&&_0x4680da?.[_0x3aa6b2(0x17c)]?.[_0x3aa6b2(0x178)]){if(_0x3aa6b2(0x152)!==_0x52ce06[_0x3aa6b2(0x161)])return _0x4b4063();else{const _0x1428d8=await findUser({'email':_0x4680da['body'][_0x3aa6b2(0x178)]},_0x3aa6b2(0x14c));_0xfd7c9f=_0x1428d8?.['_id']?_0x1428d8[_0x3aa6b2(0x14c)][_0x3aa6b2(0x174)]():_0xfd7c9f;}}if(!_0xfd7c9f&&!_0x4680da['ip'])return _0x52ce06['MEVoo'](_0x266e73);let _0x24b958,_0x39c01d,_0x5d1dfc='',_0x393c34='';_0x4680da['ip']&&(_0x5d1dfc=isEnabled(process['env'][_0x3aa6b2(0x179)])?'ban_cache:ip:'+_0x4680da['ip']:_0x4680da['ip'],_0x24b958=await banCache[_0x3aa6b2(0x155)](_0x5d1dfc));_0xfd7c9f&&(_0x393c34=isEnabled(process[_0x3aa6b2(0x15f)][_0x3aa6b2(0x179)])?_0x3aa6b2(0x165)+_0xfd7c9f:_0xfd7c9f,_0x39c01d=await banCache[_0x3aa6b2(0x155)](_0x393c34));const _0x397502=_0x24b958||_0x39c01d;if(_0x397502)return _0x4680da[_0x3aa6b2(0x159)]=!![],await banResponse(_0x4680da,_0xe23d9b);const _0x361c67=_0x52ce06[_0x3aa6b2(0x16d)](getLogStores,ViolationTypes['BAN']),_0x3ac509=_0x361c67[_0x3aa6b2(0x17f)]['ttl'];if(_0x52ce06[_0x3aa6b2(0x15d)](_0x3ac509,0x0))return _0x266e73();let _0x25befe,_0x344eda;_0x4680da['ip']&&(_0x25befe=await _0x361c67[_0x3aa6b2(0x155)](_0x4680da['ip']));if(_0xfd7c9f){if(_0x52ce06[_0x3aa6b2(0x170)]!==_0x3aa6b2(0x16a))_0x344eda=await _0x361c67[_0x3aa6b2(0x155)](_0xfd7c9f);else return _0x34daa3[_0x3aa6b2(0x168)](0x193)['json']({'message':_0x5d4741});}const _0x5ebec0=!!_0x52ce06['QQbcS'](_0x25befe,_0x344eda);if(!_0x5ebec0)return _0x266e73();const _0x1c751b=_0x52ce06[_0x3aa6b2(0x16d)](Number,_0x5ebec0[_0x3aa6b2(0x150)])-Date[_0x3aa6b2(0x153)]();_0x1c751b<=0x0&&_0x5d1dfc&&await _0x361c67[_0x3aa6b2(0x14e)](_0x5d1dfc);if(_0x52ce06['ZnInR'](_0x1c751b,0x0)&&_0x393c34)return await _0x361c67[_0x3aa6b2(0x14e)](_0x393c34),_0x266e73();return _0x5d1dfc&&banCache[_0x3aa6b2(0x172)](_0x5d1dfc,_0x5ebec0,_0x1c751b),_0x393c34&&banCache[_0x3aa6b2(0x172)](_0x393c34,_0x5ebec0,_0x1c751b),_0x4680da['banned']=!![],await _0x52ce06[_0x3aa6b2(0x16f)](banResponse,_0x4680da,_0xe23d9b);};function _0x5e15(_0x366c7e,_0x48b408){const _0x5ed89e=_0x5ed8();return _0x5e15=function(_0x5e15c0,_0x49b1ee){_0x5e15c0=_0x5e15c0-0x14b;let _0x518f2b=_0x5ed89e[_0x5e15c0];return _0x518f2b;},_0x5e15(_0x366c7e,_0x48b408);}function _0x5ed8(){const _0x2e07c9=['keyv','ulmIs','8135kTGCkB','IOLxY','48omHHnf','env','6mcrgVn','boZgf','eZSOa','775108jkdQQw','6okrxll','ban_cache:user:','json','aUeIw','status','3475188zrUVBV','yeQdu','exports','~/server/utils','EuXng','/api/edit','qjhpu','AIDHE','xCQnL','set','name','toString','ua-parser-js','~/cache','headers','email','USE_REDIS','BAN','browser','body','qdINN','librechat-data-provider','opts','user','_id','LlyYK','delete','107416Delwjz','expiresAt','2465729MXgVGF','bPPNQ','now','8316957yoKEAw','get','7728GvGKEv','10IGbCSp','EeZnw','banned'];_0x5ed8=function(){return _0x2e07c9;};return _0x5ed8();}module[_0x49f019(0x16b)]=checkBan;