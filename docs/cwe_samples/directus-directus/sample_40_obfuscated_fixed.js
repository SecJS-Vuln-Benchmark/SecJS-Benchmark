function _0x2504(_0x5d1b9e,_0x5a42f5){const _0x445616=_0x4456();return _0x2504=function(_0x250466,_0x1f622a){_0x250466=_0x250466-0x1c8;let _0xa35c7b=_0x445616[_0x250466];return _0xa35c7b;},_0x2504(_0x5d1b9e,_0x5a42f5);}const _0x214313=_0x2504;(function(_0x424870,_0xd230c5){const _0x2ce026=_0x2504,_0x563a66=_0x424870();while(!![]){try{const _0xf84afd=-parseInt(_0x2ce026(0x1cb))/0x1+-parseInt(_0x2ce026(0x2b5))/0x2+-parseInt(_0x2ce026(0x20c))/0x3+parseInt(_0x2ce026(0x23a))/0x4*(parseInt(_0x2ce026(0x2bb))/0x5)+parseInt(_0x2ce026(0x20e))/0x6+-parseInt(_0x2ce026(0x1e4))/0x7+parseInt(_0x2ce026(0x239))/0x8;if(_0xf84afd===_0xd230c5)break;else _0x563a66['push'](_0x563a66['shift']());}catch(_0x2cfa45){_0x563a66['push'](_0x563a66['shift']());}}}(_0x4456,0x63042));const crypto=require(_0x214313(0x22b)),fetch=require('node-fetch'),{supportsBalanceCheck,isAgentsEndpoint,isParamEndpoint,ErrorTypes,Constants,CacheKeys,Time}=require(_0x214313(0x1c9)),{getMessages,saveMessage,updateMessage,saveConvo}=require(_0x214313(0x216)),{addSpaceIfNeeded,isEnabled}=require(_0x214313(0x2a2)),checkBalance=require(_0x214313(0x261)),{getFiles}=require(_0x214313(0x1e5)),{getLogStores}=require(_0x214313(0x246)),TextStream=require(_0x214313(0x29f)),{logger}=require(_0x214313(0x1f7));function _0x4456(){const _0x108409=['anxmD','[BaseClient]\x20userMessage','Method\x20\x27getCompletion\x27\x20must\x20be\x20implemented.','message_file_map','dtcVA',':\x20already\x20had\x20a\x20token\x20count.','req','isArray','sender','`[BaseClient]\x20recordTokenUsage`\x20not\x20implemented.','iconURL','QxFuj','has','OTyZU','Kdayv','dtitk','constructor','cpufi','ycsXU','crypto','system','push','inputTokensKey','WGbNt','\x20/\x20','pFPId','join','artifactPromises','vauwe','addInstructions','function','completion_tokens','hLccN','7115288PJyZQe','4Apsixf','TIRzi','eNnrG','options','nAXps','AOrjr','buildMessages','IYtaI','saveMessageToDatabase','jbauv','en-us','contextStrategy','~/cache','recordTokenUsage','modelOptions','FVdaE','YvucI','ewGRJ','Making\x20request\x20to\x20','metadata','unshift','getBuildMessagesOptions','Qzcng','files','summaryTokenCount','Method\x20\x27setOptions\x27\x20must\x20be\x20implemented.','WZPAr','values','generateTextStream','number','yjHWa','onProgress','QuVuU','checkVisionRequest','handleStartMethods','oxZhU','parentMessageId','tACLN','uTlHM','~/models/checkBalance','file_id','urXUg','map','fBgDg','gLCac','[BaseClient]\x20Context\x20Count\x20(2/2)','toString','IlDaH','lqVCk','IMcGY','name','{\x20\x22type\x22:\x20\x22','getReqData','xIwXC','sendPayload','ulwyH','JkSfC','prompt_tokens','handleContextStrategy','addPreviousAttachments','hfHeJ','summary','content','luHFC','FIVE_MINUTES','randomUUID','getTokenCount','maxContextTokens','VffjV','\x22,\x20\x22info\x22:\x20\x22','[BaseClient]',')\x20and\x20context\x20(','mVNas','getResponseModel','):\x20','model','getMessageMapMethod','entries','reverse','YeVRP','OrxaC','abortController','sendCompletion','debug','[BaseClient]\x20Previous\x20summary:','sendMessage','all','[BaseClient]\x20Context\x20Count\x20(1/2)','getStreamUsage','isEdited','AdcyX','requestCompleted','User\x20mismatch.','object','tNNwY','Subclasses\x20must\x20implement\x20getSaveOptions','xRYkm','skipSaveUserMessage','summaryMessage','agent','updateMessageInDatabase','./TextStream','conversationId','UxuMu','~/server/utils','tokenCount','onStart','progressCallback','FfGxT','\x22\x20}','reduce','HoezA','RWASg','outputTokensKey','handleTokenCountMap','calculateCurrentTokenCount','body','api/app/clients/BaseClient.js\x20-\x20saveMessageToDatabase\x20#saveMessage','ycHTC','undefined','NO_PARENT','jViGl','flat','316494RRYAja','deagj','ekJzW','[BaseClient]\x20Skipping\x20','LmLlx','deevC','906955ZVsLqi','set','addImageURLs','attachments','voyOw','messageId','replaceOptions','hemTd','xlakZ','VzzmO','zJzcy','user','endpointTokenConfig','Subclasses\x20must\x20implement\x20getBuildMessagesOptions','skipSaveConvo','filter','librechat-data-provider','string','128286UdkqoP','XVsTe','updateUserMessageTokenCount','ZPbQV','call','setOptions','UFjoC','SbZPp','uunJj','vyUpD','[BaseClient]\x20Adding\x20summary\x20props\x20to\x20','resendFiles','overrideParentMessageId','gpt-3.5-turbo-0301','IzIUZ','INPUT_LENGTH','prompt','res','cGxAE','endpoint','boqAB','role','[BaseClient]\x20tokenCountMap','image_url','loadHistory','954905WyZwyb','~/models/File','rEqwX','type','endpointType','concatenateMessages','SgtjU','getSaveOptions','exports','ICHpo','ZouiS','pNusm','summarizeMessages','getTokenCountForMessage','text','warn','RFJgv','Subclasses\x20must\x20implement\x20buildMessages','currentMessages','~/config','getTokenCountForResponse','responseMessageId','slice','eUAIm','toLocaleDateString','Prompt\x20token\x20count\x20exceeds\x20max\x20token\x20count\x20(','directEndpoint','fetch','JjooI','qFJVV','OioPa','previous_summary','JZxPr','numeric','YISDU','ApTmF','AbyWa','userMessagePromise','[BaseClient]\x20instructions\x20tokenCount:\x20','ElNjA','1388469pRaTbU','MESSAGES','1323234eGRuoe','COMMON_DIVIDER','xQZAo','boolean','zzoDr','env','CHECK_BALANCE','length','~/models','processOverideIds'];_0x4456=function(){return _0x108409;};return _0x4456();}class BaseClient{constructor(_0x448b21,_0x5d82ea={}){const _0x58eed0=_0x214313,_0x33ace3={'ycHTC':_0x58eed0(0x244),'xRYkm':_0x58eed0(0x205)};this['apiKey']=_0x448b21,this[_0x58eed0(0x220)]=_0x5d82ea[_0x58eed0(0x220)]??'AI',this[_0x58eed0(0x245)]=null,this['currentDateString']=new Date()[_0x58eed0(0x1fc)](_0x33ace3[_0x58eed0(0x2b0)],{'year':_0x58eed0(0x205),'month':'long','day':_0x33ace3[_0x58eed0(0x29a)]}),this['fetch']=this[_0x58eed0(0x1ff)]['bind'](this),this[_0x58eed0(0x2c9)]=![],this[_0x58eed0(0x29b)]=![],this[_0x58eed0(0x209)],this['responsePromise'],this['user'],this[_0x58eed0(0x2a0)],this[_0x58eed0(0x1f9)],this[_0x58eed0(0x2be)],this[_0x58eed0(0x22e)]=_0x58eed0(0x273),this[_0x58eed0(0x2ab)]=_0x58eed0(0x237);}[_0x214313(0x1d0)](){const _0x2d0466=_0x214313;throw new Error(_0x2d0466(0x253));}async['getCompletion'](){const _0x2d2571=_0x214313,_0x26e048={'ZouiS':_0x2d2571(0x21a)};throw new Error(_0x26e048[_0x2d2571(0x1ee)]);}async[_0x214313(0x28c)](){throw new Error('Method\x20\x27sendCompletion\x27\x20must\x20be\x20implemented.');}['getSaveOptions'](){const _0xf852dd=_0x214313;throw new Error(_0xf852dd(0x299));}async[_0x214313(0x240)](){const _0x2916e3=_0x214313,_0x19194d={'boqAB':_0x2916e3(0x1f5)};throw new Error(_0x19194d[_0x2916e3(0x1df)]);}async[_0x214313(0x1f0)](){throw new Error('Subclasses\x20attempted\x20to\x20call\x20summarizeMessages\x20without\x20implementing\x20it');}[_0x214313(0x283)](){const _0xeea7b2=_0x214313;if(isAgentsEndpoint(this[_0xeea7b2(0x23d)][_0xeea7b2(0x1de)])&&this[_0xeea7b2(0x23d)][_0xeea7b2(0x29d)]&&this[_0xeea7b2(0x23d)]['agent']['id'])return this[_0xeea7b2(0x23d)][_0xeea7b2(0x29d)]['id'];return this['modelOptions'][_0xeea7b2(0x285)];}[_0x214313(0x1f8)](_0x49cb46){const _0x379127=_0x214313,_0x5cd9da={'urXUg':_0x379127(0x221)};logger[_0x379127(0x28d)](_0x5cd9da[_0x379127(0x263)],_0x49cb46);}async[_0x214313(0x247)]({promptTokens:_0x520341,completionTokens:_0x376c53}){const _0x3d1ac2=_0x214313;logger[_0x3d1ac2(0x28d)](_0x3d1ac2(0x221),{'promptTokens':_0x520341,'completionTokens':_0x376c53});}async[_0x214313(0x1ff)](_0x5e4930,_0x27ef0a){const _0x4f57d8=_0x214313,_0x51d397={'tACLN':'YSUCm','deagj':function(_0x4c39e2,_0x173574){return _0x4c39e2!==_0x173574;},'luHFC':_0x4f57d8(0x2b1),'zmVDC':function(_0x1475ce,_0x521350,_0x595fd1){return _0x1475ce(_0x521350,_0x595fd1);},'Kdayv':function(_0xa9769a,_0x49df27,_0x290cc2){return _0xa9769a(_0x49df27,_0x290cc2);}};let _0x5b7b10=_0x5e4930;this['options'][_0x4f57d8(0x1fe)]&&('mKrxG'!==_0x51d397[_0x4f57d8(0x25f)]?_0x5b7b10=this['options']['reverseProxyUrl']:this[_0x4f57d8(0x21b)]={});logger[_0x4f57d8(0x28d)](_0x4f57d8(0x24c)+_0x5b7b10);if(_0x51d397[_0x4f57d8(0x2b6)](typeof Bun,_0x51d397[_0x4f57d8(0x279)]))return await _0x51d397['zmVDC'](fetch,_0x5b7b10,_0x27ef0a);return await _0x51d397[_0x4f57d8(0x226)](fetch,_0x5b7b10,_0x27ef0a);}[_0x214313(0x24f)](){const _0xebec02=_0x214313,_0x5094ab={'pYDEJ':_0xebec02(0x2c8)};throw new Error(_0x5094ab['pYDEJ']);}async[_0x214313(0x256)](_0x8f116f,_0x2789cd,_0x563e29={}){const _0x47fc3f=new TextStream(_0x8f116f,_0x563e29);await _0x47fc3f['processTextStream'](_0x2789cd);}[_0x214313(0x217)](){const _0x23496f=_0x214313,_0x152722={'JZxPr':function(_0x13c566,_0x448c54){return _0x13c566(_0x448c54);},'LmLlx':function(_0x52e696,_0x2e2338){return _0x52e696===_0x2e2338;},'ulwyH':_0x23496f(0x26c),'VffjV':_0x23496f(0x1f4),'QuVuU':function(_0x23f797,_0x5917d2){return _0x23f797===_0x5917d2;},'yjHWa':_0x23496f(0x2b7)};let {overrideConvoId:_0x53f958,overrideUserMessageId:_0x568388}=this['options']?.[_0x23496f(0x21e)]?.[_0x23496f(0x2ae)]??{};if(_0x53f958){if(_0x23496f(0x1f4)===_0x152722[_0x23496f(0x27e)]){const [_0x245c68,_0x442461]=_0x53f958['split'](Constants[_0x23496f(0x20f)]);_0x53f958=_0x245c68,_0x442461!=='0'&&(this[_0x23496f(0x2c9)]=!![]);}else _0x152722[_0x23496f(0x204)](_0x17fa01,_0x1f0d40),_0x152722[_0x23496f(0x2b9)](_0x5be3c2,_0x152722[_0x23496f(0x271)])&&(_0xdf0217+=_0x2981d7);}if(_0x568388){if(_0x152722[_0x23496f(0x25a)](_0x152722[_0x23496f(0x258)],_0x152722['yjHWa'])){const [_0x50fc26,_0x5d397f]=_0x568388['split'](Constants[_0x23496f(0x20f)]);_0x568388=_0x50fc26,_0x5d397f!=='0'&&(_0x23496f(0x2bf)!==_0x23496f(0x2bf)?_0x184838[_0x23496f(0x26e)]({'userMessage':_0x4d4023,'conversationId':_0x2335a0,'responseMessageId':_0x3adcc3,'sender':this[_0x23496f(0x220)]}):this[_0x23496f(0x29b)]=!![]);}else this[_0x23496f(0x1d0)](_0x12f958);}return[_0x53f958,_0x568388];}async['setMessageOptions'](_0x5986f1={}){const _0xd1b8c6=_0x214313,_0x502e39={'vauwe':function(_0x5cbad4,_0x8f1e1c){return _0x5cbad4&&_0x8f1e1c;}};_0x5986f1&&_0x5986f1[_0xd1b8c6(0x2c1)]&&this['setOptions'](_0x5986f1);const [_0x460114,_0x192ead]=this['processOverideIds'](),{isEdited:_0x188e96,isContinued:_0xa5ceb9}=_0x5986f1,_0x14b0fd=_0x5986f1[_0xd1b8c6(0x2c6)]??null;this[_0xd1b8c6(0x2c6)]=_0x14b0fd;const _0x3d6b77=this[_0xd1b8c6(0x1eb)]();this['abortController']=_0x5986f1['abortController']??new AbortController();const _0x1dd4b7=_0x460114??_0x5986f1[_0xd1b8c6(0x2a0)]??crypto[_0xd1b8c6(0x27b)](),_0x24675b=_0x5986f1[_0xd1b8c6(0x25e)]??Constants[_0xd1b8c6(0x2b2)],_0x48f467=_0x192ead??_0x5986f1[_0xd1b8c6(0x1d7)]??crypto[_0xd1b8c6(0x27b)]();let _0x3500a3=_0x5986f1[_0xd1b8c6(0x1f9)]??crypto[_0xd1b8c6(0x27b)](),_0x1ce600=_0x188e96?_0x3500a3:_0x24675b;return this[_0xd1b8c6(0x1f6)]=await this[_0xd1b8c6(0x1e3)](_0x1dd4b7,_0x1ce600)??[],this['conversationId']=_0x1dd4b7,_0x502e39[_0xd1b8c6(0x234)](_0x188e96,!_0xa5ceb9)&&(_0x3500a3=crypto[_0xd1b8c6(0x27b)](),_0x1ce600=_0x3500a3,this[_0xd1b8c6(0x1f6)][this[_0xd1b8c6(0x1f6)]['length']-0x1][_0xd1b8c6(0x2c0)]=_0x1ce600),this[_0xd1b8c6(0x1f9)]=_0x3500a3,{..._0x5986f1,'user':_0x14b0fd,'head':_0x1ce600,'conversationId':_0x1dd4b7,'parentMessageId':_0x24675b,'userMessageId':_0x48f467,'responseMessageId':_0x3500a3,'saveOptions':_0x3d6b77};}['createUserMessage']({messageId:_0x42b620,parentMessageId:_0x226c3a,conversationId:_0x291d8e,text:_0x4655d6}){const _0x313d34=_0x214313,_0x56d790={'JkSfC':'User'};return{'messageId':_0x42b620,'parentMessageId':_0x226c3a,'conversationId':_0x291d8e,'sender':_0x56d790[_0x313d34(0x272)],'text':_0x4655d6,'isCreatedByUser':!![]};}async[_0x214313(0x25c)](_0x445845,_0x5b3019){const _0x26030a=_0x214313,_0x3df72d={'lqVCk':function(_0x131412,_0x115a52){return _0x131412===_0x115a52;}},{user:_0x562456,head:_0x567f9c,conversationId:_0xb652a3,parentMessageId:_0x129fed,userMessageId:_0x52988c,responseMessageId:_0x13e952,saveOptions:_0x2c2c65}=await this['setMessageOptions'](_0x5b3019),_0x508e5f=_0x5b3019[_0x26030a(0x293)]?this[_0x26030a(0x1f6)][this[_0x26030a(0x1f6)][_0x26030a(0x215)]-0x2]:this['createUserMessage']({'messageId':_0x52988c,'parentMessageId':_0x129fed,'conversationId':_0xb652a3,'text':_0x445845});return _0x3df72d[_0x26030a(0x26a)](typeof _0x5b3019?.[_0x26030a(0x26e)],_0x26030a(0x236))&&_0x5b3019['getReqData']({'userMessage':_0x508e5f,'conversationId':_0xb652a3,'responseMessageId':_0x13e952,'sender':this['sender']}),typeof _0x5b3019?.[_0x26030a(0x2a4)]==='function'&&_0x5b3019[_0x26030a(0x2a4)](_0x508e5f,_0x13e952),{..._0x5b3019,'user':_0x562456,'head':_0x567f9c,'conversationId':_0xb652a3,'responseMessageId':_0x13e952,'saveOptions':_0x2c2c65,'userMessage':_0x508e5f};}[_0x214313(0x235)](_0x3a2631,_0x1731af){const _0x5981c3=_0x214313,_0x585082={'AdcyX':function(_0x425608,_0x27e664){return _0x425608===_0x27e664;},'IlDaH':function(_0x97dccf,_0x387886){return _0x97dccf!==_0x387886;},'hfHeJ':_0x5981c3(0x1d2),'AOrjr':function(_0x2f5b81,_0x5d3919){return _0x2f5b81-_0x5d3919;}},_0x5282df=[];if(!_0x1731af||_0x585082[_0x5981c3(0x294)](Object['keys'](_0x1731af)[_0x5981c3(0x215)],0x0)){if(_0x585082[_0x5981c3(0x269)](_0x585082['hfHeJ'],_0x585082[_0x5981c3(0x276)])){const [_0x5b8c75,_0x3fe8c4]=_0x47b742['split'](_0x150930[_0x5981c3(0x20f)]);_0x43f6a9=_0x5b8c75,_0x3fe8c4!=='0'&&(this[_0x5981c3(0x29b)]=!![]);}else return _0x3a2631;}return _0x3a2631['length']>0x1&&_0x5282df[_0x5981c3(0x22d)](..._0x3a2631[_0x5981c3(0x1fa)](0x0,-0x1)),_0x5282df[_0x5981c3(0x22d)](_0x1731af),_0x3a2631[_0x5981c3(0x215)]>0x0&&_0x5282df[_0x5981c3(0x22d)](_0x3a2631[_0x585082[_0x5981c3(0x23f)](_0x3a2631['length'],0x1)]),_0x5282df;}async[_0x214313(0x2ac)](_0x21d192){const _0x5c4509=_0x214313,_0x56cdbb={'cGxAE':function(_0x1654da,_0x308c99){return _0x1654da===_0x308c99;},'zJzcy':function(_0x54c57e,_0x48ea45){return _0x54c57e===_0x48ea45;},'ewGRJ':function(_0x371951,_0x191be9){return _0x371951===_0x191be9;}};if(_0x56cdbb[_0x5c4509(0x1dd)](this[_0x5c4509(0x1f6)]['length'],0x0))return;for(let _0x77c6f1=0x0;_0x77c6f1<this[_0x5c4509(0x1f6)][_0x5c4509(0x215)];_0x77c6f1++){if(_0x56cdbb[_0x5c4509(0x2c5)](_0x77c6f1,this[_0x5c4509(0x1f6)][_0x5c4509(0x215)]-0x1))break;const _0x5c33a8=this[_0x5c4509(0x1f6)][_0x77c6f1],{messageId:_0x10491a}=_0x5c33a8,_0x51876c={};_0x56cdbb[_0x5c4509(0x24b)](_0x10491a,_0x21d192[_0x5c4509(0x29c)]?.[_0x5c4509(0x2c0)])&&(logger['debug'](_0x5c4509(0x1d5)+_0x10491a+'.'),_0x51876c[_0x5c4509(0x277)]=_0x21d192['summaryMessage'][_0x5c4509(0x278)],_0x51876c[_0x5c4509(0x252)]=_0x21d192[_0x5c4509(0x29c)]['tokenCount']);if(_0x5c33a8['tokenCount']&&!_0x51876c[_0x5c4509(0x252)]){logger[_0x5c4509(0x28d)](_0x5c4509(0x2b8)+_0x10491a+_0x5c4509(0x21d));continue;}const _0x28cd31=_0x21d192[_0x10491a];_0x28cd31&&(_0x5c33a8[_0x5c4509(0x2a3)]=_0x28cd31,_0x51876c['tokenCount']=_0x28cd31,await this[_0x5c4509(0x29e)]({'messageId':_0x10491a,..._0x51876c}));}}[_0x214313(0x1e9)](_0x59c68b){const _0x23cb4d=_0x214313;return _0x59c68b[_0x23cb4d(0x2a8)]((_0xf5f3c1,_0x26f227)=>{const _0x15ecd5=_0x23cb4d,_0x863e78=_0x26f227[_0x15ecd5(0x26c)]??_0x26f227['role'];return _0xf5f3c1+(_0x863e78+':\x0a'+_0x26f227[_0x15ecd5(0x278)]+'\x0a\x0a');},'');}async['getMessagesWithinTokenLimit'](_0x54b815,_0x5ddf83){const _0x4cd1b2=_0x214313,_0x38bba6={'Qzcng':function(_0x3bc99e,_0x439aa3){return _0x3bc99e<_0x439aa3;},'oQarl':function(_0x365ce2,_0x388b81){return _0x365ce2-_0x388b81;}};let _0x45b603=0x3,_0x1207a1=-0x1,_0x3c8d0d=_0x5ddf83??this[_0x4cd1b2(0x27d)];const _0x207e9b=[..._0x54b815],_0x51ae88=[];if(_0x38bba6[_0x4cd1b2(0x250)](_0x45b603,_0x3c8d0d))while(_0x207e9b[_0x4cd1b2(0x215)]>0x0&&_0x45b603<_0x3c8d0d){const _0x1e6083=_0x207e9b['pop'](),{tokenCount:_0x2210c1}=_0x1e6083;if(_0x1e6083&&_0x45b603+_0x2210c1<=_0x3c8d0d)_0x51ae88[_0x4cd1b2(0x22d)](_0x1e6083),_0x45b603+=_0x2210c1;else{_0x207e9b['push'](_0x1e6083);break;}}const _0x2d607a=_0x207e9b;return _0x1207a1=_0x38bba6['oQarl'](_0x2d607a[_0x4cd1b2(0x215)],0x1),_0x3c8d0d-=_0x45b603,{'context':_0x51ae88[_0x4cd1b2(0x288)](),'remainingContextTokens':_0x3c8d0d,'messagesToRefine':_0x2d607a,'summaryIndex':_0x1207a1};}async[_0x214313(0x274)]({instructions:_0x18683f,orderedMessages:_0x5793c8,formattedMessages:_0x38e548,buildTokenMap:buildTokenMap=!![]}){const _0x9515b0=_0x214313,_0x31241e={'xIwXC':function(_0x207c1a,_0x82c79){return _0x207c1a===_0x82c79;},'XVsTe':_0x9515b0(0x200),'ihKCT':function(_0x4955c,_0x2b71bc){return _0x4955c+_0x2b71bc;},'ElNjA':_0x9515b0(0x20a),'gLCac':_0x9515b0(0x291),'WiQjH':function(_0x2dd48a,_0x2e77be){return _0x2dd48a-_0x2e77be;},'WZPAr':function(_0x7ed6c5,_0x64e3c6){return _0x7ed6c5===_0x64e3c6;},'OTyZU':function(_0x5e8e48,_0x792e33){return _0x5e8e48>_0x792e33;},'QxFuj':function(_0x40e2c9,_0x42fd72){return _0x40e2c9-_0x42fd72;},'uTlHM':function(_0x18eb87,_0x4fbd84){return _0x18eb87===_0x4fbd84;},'STLSc':'OjrbG','RTOHu':function(_0x48f492,_0x3e1b67){return _0x48f492&&_0x3e1b67;},'YISDU':_0x9515b0(0x267)};let _0x4f51e2,_0x513fd0;_0x18683f&&({tokenCount:_0x513fd0,..._0x4f51e2}=_0x18683f);_0x4f51e2&&logger[_0x9515b0(0x28d)](_0x31241e['ihKCT'](_0x31241e[_0x9515b0(0x20b)],_0x513fd0));let _0x1d1499=this['addInstructions'](_0x38e548,_0x4f51e2),_0x2375a3=this[_0x9515b0(0x235)](_0x5793c8,_0x18683f),{context:_0xee406e,remainingContextTokens:_0x2110c0,messagesToRefine:_0x4c461e,summaryIndex:_0x35c80a}=await this['getMessagesWithinTokenLimit'](_0x2375a3);logger[_0x9515b0(0x28d)](_0x31241e[_0x9515b0(0x266)],{'remainingContextTokens':_0x2110c0,'maxContextTokens':this['maxContextTokens']});let _0x5c7860,_0x431aa6,{shouldSummarize:_0x5c2953}=this;const {length:_0x188457}=_0x1d1499,_0x405006=_0x31241e['WiQjH'](_0x188457,_0xee406e[_0x9515b0(0x215)]),_0x4c82e3=_0x2375a3[0x0],_0x4f7c54=_0x5c2953&&_0x31241e[_0x9515b0(0x254)](_0x405006,0x1)&&_0x4c82e3?.[_0x9515b0(0x277)]&&_0x31241e[_0x9515b0(0x254)](this['previous_summary'][_0x9515b0(0x2c0)],_0x4c82e3[_0x9515b0(0x2c0)]);_0x31241e[_0x9515b0(0x225)](_0x405006,0x0)&&(_0x1d1499=_0x1d1499[_0x9515b0(0x1fa)](_0x405006),logger[_0x9515b0(0x28d)]('[BaseClient]\x20Difference\x20between\x20original\x20payload\x20('+_0x188457+_0x9515b0(0x281)+_0xee406e[_0x9515b0(0x215)]+_0x9515b0(0x284)+_0x405006));const _0xe2cd38=_0x2375a3[_0x31241e[_0x9515b0(0x223)](_0x2375a3[_0x9515b0(0x215)],0x1)];if(_0x31241e[_0x9515b0(0x260)](_0x1d1499['length'],0x0)&&!_0x5c2953&&_0xe2cd38){const _0x4d632e=_0xe2cd38[_0x9515b0(0x2a3)]+_0x9515b0(0x230)+this['maxContextTokens'],_0x30290a='{\x20\x22type\x22:\x20\x22'+ErrorTypes['INPUT_LENGTH']+_0x9515b0(0x27f)+_0x4d632e+_0x9515b0(0x2a7);logger[_0x9515b0(0x1f3)](_0x9515b0(0x1fd)+_0x4d632e+').');throw new Error(_0x30290a);}if(_0x4f7c54)_0x5c7860={'role':'system','content':_0x4c82e3[_0x9515b0(0x277)]},_0x431aa6=_0x4c82e3[_0x9515b0(0x252)],_0x1d1499[_0x9515b0(0x24e)](_0x5c7860),_0x2110c0-=_0x431aa6;else{if(_0x5c2953&&_0x31241e[_0x9515b0(0x225)](_0x4c461e['length'],0x0)){if(_0x9515b0(0x2ba)!==_0x31241e['STLSc'])({summaryMessage:_0x5c7860,summaryTokenCount:_0x431aa6}=await this[_0x9515b0(0x1f0)]({'messagesToRefine':_0x4c461e,'remainingContextTokens':_0x2110c0}),_0x5c7860&&_0x1d1499[_0x9515b0(0x24e)](_0x5c7860),_0x2110c0-=_0x431aa6);else return _0x31e1a8;}}_0x5c2953=_0x31241e['RTOHu'](_0x5c7860,_0x5c2953),logger['debug'](_0x31241e[_0x9515b0(0x206)],{'remainingContextTokens':_0x2110c0,'maxContextTokens':this[_0x9515b0(0x27d)]});let _0x548166;buildTokenMap&&(_0x548166=_0x2375a3[_0x9515b0(0x2a8)]((_0x4d8b37,_0x2713e9,_0x3fbe16)=>{const _0x4fcadf=_0x9515b0,{messageId:_0xb847db}=_0x2713e9;if(!_0xb847db)return _0x4d8b37;return _0x5c2953&&_0x31241e[_0x4fcadf(0x26f)](_0x3fbe16,_0x35c80a)&&!_0x4f7c54&&(_0x31241e[_0x4fcadf(0x1cc)]!==_0x4fcadf(0x1e6)?_0x4d8b37[_0x4fcadf(0x29c)]={..._0x5c7860,'messageId':_0xb847db,'tokenCount':_0x431aa6}:_0x191395[_0x4fcadf(0x26e)]({'userMessage':_0x3f1e20})),_0x4d8b37[_0xb847db]=_0x2375a3[_0x3fbe16][_0x4fcadf(0x2a3)],_0x4d8b37;},{}));const _0x7ba6fa=this[_0x9515b0(0x27d)]-_0x2110c0;return logger['debug']('[BaseClient]\x20tokenCountMap:',_0x548166),logger[_0x9515b0(0x28d)](_0x9515b0(0x280),{'promptTokens':_0x7ba6fa,'remainingContextTokens':_0x2110c0,'payloadSize':_0x1d1499['length'],'maxContextTokens':this[_0x9515b0(0x27d)]}),{'payload':_0x1d1499,'tokenCountMap':_0x548166,'promptTokens':_0x7ba6fa,'messages':_0x2375a3};}async[_0x214313(0x28f)](_0x15ece1,_0x9391cb={}){const _0x3a9662=_0x214313,_0x595146={'qFJVV':function(_0x224a08,_0x2ffb2c){return _0x224a08!==_0x2ffb2c;},'TIRzi':_0x3a9662(0x202),'dtitk':function(_0x4c0622,_0x42d731){return _0x4c0622-_0x42d731;},'jbauv':_0x3a9662(0x219),'ICHpo':function(_0x2f3dcd,_0x166850){return _0x2f3dcd===_0x166850;},'bwrDr':_0x3a9662(0x1d9),'OrxaC':function(_0x2bb451,_0x529c16){return _0x2bb451(_0x529c16);},'anxmD':_0x3a9662(0x1ca),'ApTmF':function(_0x19918c,_0x473146,_0x5eaecd){return _0x19918c(_0x473146,_0x5eaecd);},'burWg':function(_0x461504,_0x48ab23){return _0x461504!=_0x48ab23;},'eNnrG':function(_0x2f9274,_0x59f789){return _0x2f9274(_0x59f789);},'UxuMu':_0x3a9662(0x282)},{user:_0x4359c0,head:_0x3c82ed,isEdited:_0x45d70b,conversationId:_0x1d73cf,responseMessageId:_0x4c4cfb,saveOptions:_0x43c2dd,userMessage:_0x39142d}=await this[_0x3a9662(0x25c)](_0x15ece1,_0x9391cb);_0x9391cb[_0x3a9662(0x2a5)]&&(_0x595146[_0x3a9662(0x201)](_0x595146[_0x3a9662(0x23b)],_0x3a9662(0x25d))?_0x9391cb[_0x3a9662(0x259)]=_0x9391cb[_0x3a9662(0x2a5)][_0x3a9662(0x1cf)](null,{..._0x9391cb['progressOptions']??{},'parentMessageId':_0x39142d['messageId'],'messageId':_0x4c4cfb}):_0x56f657[_0x3a9662(0x22d)](..._0x20c9fd[_0x3a9662(0x1fa)](0x0,-0x1)));const {generation:generation=''}=_0x9391cb;if(_0x45d70b){let _0xe07a89=this[_0x3a9662(0x1f6)][_0x595146[_0x3a9662(0x227)](this['currentMessages'][_0x3a9662(0x215)],0x1)];!_0xe07a89?(_0xe07a89={'messageId':_0x4c4cfb,'conversationId':_0x1d73cf,'parentMessageId':_0x39142d[_0x3a9662(0x2c0)],'isCreatedByUser':![],'model':this['modelOptions'][_0x3a9662(0x285)],'sender':this[_0x3a9662(0x220)],'text':generation},this[_0x3a9662(0x1f6)][_0x3a9662(0x22d)](_0x39142d,_0xe07a89)):_0xe07a89[_0x3a9662(0x1f2)]=generation;}else this[_0x3a9662(0x1f6)][_0x3a9662(0x22d)](_0x39142d);let {prompt:_0x1c7922,tokenCountMap:_0x3f8877,promptTokens:_0x1fa865}=await this[_0x3a9662(0x240)](this[_0x3a9662(0x1f6)],_0x45d70b?_0x3c82ed:_0x39142d[_0x3a9662(0x2c0)],this[_0x3a9662(0x24f)](_0x9391cb),_0x9391cb);_0x3f8877&&(logger[_0x3a9662(0x28d)](_0x3a9662(0x1e1),_0x3f8877),_0x3f8877[_0x39142d[_0x3a9662(0x2c0)]]&&(_0x39142d['tokenCount']=_0x3f8877[_0x39142d[_0x3a9662(0x2c0)]],logger[_0x3a9662(0x28d)](_0x595146[_0x3a9662(0x243)],_0x39142d)),this['handleTokenCountMap'](_0x3f8877));if(!_0x45d70b&&!this[_0x3a9662(0x29b)]){if(_0x595146[_0x3a9662(0x1ed)](_0x595146['bwrDr'],_0x3a9662(0x238)))return this[_0x3a9662(0x23d)]['agent']['id'];else this[_0x3a9662(0x209)]=this[_0x3a9662(0x242)](_0x39142d,_0x43c2dd,_0x4359c0),_0x595146[_0x3a9662(0x1ed)](typeof _0x9391cb?.[_0x3a9662(0x26e)],'function')&&_0x9391cb[_0x3a9662(0x26e)]({'userMessagePromise':this[_0x3a9662(0x209)]});}_0x595146[_0x3a9662(0x28a)](isEnabled,process[_0x3a9662(0x213)][_0x3a9662(0x214)])&&supportsBalanceCheck[this['options']['endpointType']??this[_0x3a9662(0x23d)][_0x3a9662(0x1de)]]&&await checkBalance({'req':this[_0x3a9662(0x23d)][_0x3a9662(0x21e)],'res':this[_0x3a9662(0x23d)][_0x3a9662(0x1dc)],'txData':{'user':this[_0x3a9662(0x2c6)],'tokenType':_0x3a9662(0x1db),'amount':_0x1fa865,'model':this[_0x3a9662(0x248)][_0x3a9662(0x285)],'endpoint':this['options'][_0x3a9662(0x1de)],'endpointTokenConfig':this[_0x3a9662(0x23d)][_0x3a9662(0x2c7)]}});const _0x1d347a=await this[_0x3a9662(0x28c)](_0x1c7922,_0x9391cb);this[_0x3a9662(0x28b)][_0x3a9662(0x295)]=!![];const _0x38ae94={'messageId':_0x4c4cfb,'conversationId':_0x1d73cf,'parentMessageId':_0x39142d[_0x3a9662(0x2c0)],'isCreatedByUser':![],'isEdited':_0x45d70b,'model':this[_0x3a9662(0x283)](),'sender':this[_0x3a9662(0x220)],'promptTokens':_0x1fa865,'iconURL':this['options'][_0x3a9662(0x222)],'endpoint':this[_0x3a9662(0x23d)]['endpoint'],...this[_0x3a9662(0x24d)]??{}};if(typeof _0x1d347a===_0x595146[_0x3a9662(0x218)])_0x38ae94[_0x3a9662(0x1f2)]=addSpaceIfNeeded(generation)+_0x1d347a;else{if(Array[_0x3a9662(0x21f)](_0x1d347a)&&_0x595146[_0x3a9662(0x207)](isParamEndpoint,this[_0x3a9662(0x23d)][_0x3a9662(0x1de)],this[_0x3a9662(0x23d)][_0x3a9662(0x1e8)]))_0x38ae94['text']='',_0x38ae94[_0x3a9662(0x278)]=_0x1d347a;else Array['isArray'](_0x1d347a)&&(_0x38ae94[_0x3a9662(0x1f2)]=addSpaceIfNeeded(generation)+_0x1d347a[_0x3a9662(0x232)](''));}if(_0x3f8877&&this[_0x3a9662(0x247)]&&this['getTokenCountForResponse']&&this[_0x3a9662(0x27c)]){let _0x472095;const _0x5b035c=this[_0x3a9662(0x292)]!=null?this[_0x3a9662(0x292)]():null;_0x595146['burWg'](_0x5b035c,null)&&_0x595146[_0x3a9662(0x23c)](Number,_0x5b035c[this[_0x3a9662(0x2ab)]])>0x0?_0x3a9662(0x1d3)===_0x595146[_0x3a9662(0x2a1)]?_0x1c93a3=this[_0x3a9662(0x286)]():(_0x38ae94[_0x3a9662(0x2a3)]=_0x5b035c[this[_0x3a9662(0x2ab)]],_0x472095=_0x38ae94['tokenCount'],await this[_0x3a9662(0x1cd)]({'usage':_0x5b035c,'tokenCountMap':_0x3f8877,'userMessage':_0x39142d,'opts':_0x9391cb})):(_0x38ae94[_0x3a9662(0x2a3)]=this['getTokenCountForResponse'](_0x38ae94),_0x472095=this['getTokenCount'](_0x1d347a)),await this[_0x3a9662(0x247)]({'promptTokens':_0x1fa865,'completionTokens':_0x472095,'usage':_0x5b035c});}this[_0x3a9662(0x209)]&&await this[_0x3a9662(0x209)];this[_0x3a9662(0x233)]&&(_0x38ae94['attachments']=(await Promise[_0x3a9662(0x290)](this[_0x3a9662(0x233)]))[_0x3a9662(0x1c8)](_0x11b8e0=>_0x11b8e0));this['responsePromise']=this['saveMessageToDatabase'](_0x38ae94,_0x43c2dd,_0x4359c0);const _0x26786e=_0x595146[_0x3a9662(0x28a)](getLogStores,CacheKeys[_0x3a9662(0x20d)]);return _0x26786e[_0x3a9662(0x2bc)](_0x4c4cfb,{'text':_0x38ae94[_0x3a9662(0x1f2)],'complete':!![]},Time[_0x3a9662(0x27a)]),delete _0x38ae94[_0x3a9662(0x2a3)],_0x38ae94;}async['updateUserMessageTokenCount']({usage:_0x519a76,tokenCountMap:_0x533321,userMessage:_0x4663f2,opts:_0x57f7f6}){const _0x426017=_0x214313,_0x172c49={'iiebU':function(_0x478463,_0xc89cd3){return _0x478463>_0xc89cd3;},'SOGfr':function(_0x57b1cf,_0x32e93a){return _0x57b1cf===_0x32e93a;},'hiMgP':function(_0x541641,_0x5ee45f){return _0x541641===_0x5ee45f;},'tNNwY':_0x426017(0x236)},_0xc9e8a=this[_0x426017(0x2ad)]!=null&&_0x172c49['iiebU'](Number(_0x519a76[this[_0x426017(0x22e)]]),0x0)&&(this['options']['resendFiles']||!this[_0x426017(0x23d)]['resendFiles']&&!this[_0x426017(0x23d)]['attachments']?.[_0x426017(0x215)])&&!this[_0x426017(0x23d)]['promptPrefix'];if(!_0xc9e8a)return;const _0x42c505=this[_0x426017(0x2ad)]({'currentMessageId':_0x4663f2[_0x426017(0x2c0)],'tokenCountMap':_0x533321,'usage':_0x519a76});if(_0x172c49['SOGfr'](_0x42c505,_0x4663f2[_0x426017(0x2a3)]))return;_0x4663f2[_0x426017(0x2a3)]=_0x42c505,_0x172c49['hiMgP'](typeof _0x57f7f6?.[_0x426017(0x26e)],_0x172c49[_0x426017(0x298)])&&_0x57f7f6[_0x426017(0x26e)]({'userMessage':_0x4663f2}),await this[_0x426017(0x209)],await this['updateMessageInDatabase']({'messageId':_0x4663f2[_0x426017(0x2c0)],'tokenCount':_0x42c505});}async[_0x214313(0x1e3)](_0x558d78,_0x5613bc=null){const _0x1dd08d=_0x214313,_0x570438={'pNusm':function(_0x2bf69d,_0x385ec8){return _0x2bf69d!==_0x385ec8;},'UFjoC':function(_0x3f179c,_0x3dd4a7){return _0x3f179c(_0x3dd4a7);},'FVdaE':function(_0x13aac3,_0x578150){return _0x13aac3!==_0x578150;},'VzzmO':_0x1dd08d(0x229),'EeLsw':_0x1dd08d(0x241)};logger['debug']('[BaseClient]\x20Loading\x20history:',{'conversationId':_0x558d78,'parentMessageId':_0x5613bc});const _0x258a6c=await _0x570438[_0x1dd08d(0x1d1)](getMessages,{'conversationId':_0x558d78})??[];if(_0x258a6c[_0x1dd08d(0x215)]===0x0)return[];let _0x29de99=null;this['getMessageMapMethod']&&(_0x29de99=this['getMessageMapMethod']());let _0xeb089a=this[_0x1dd08d(0x228)]['getMessagesForConversation']({'messages':_0x258a6c,'parentMessageId':_0x5613bc,'mapMethod':_0x29de99});_0xeb089a=await this[_0x1dd08d(0x275)](_0xeb089a);if(!this['shouldSummarize']){if(_0x570438[_0x1dd08d(0x249)](_0x570438[_0x1dd08d(0x2c4)],_0x1dd08d(0x289)))return _0xeb089a;else{const [_0x390d69,_0x3407a0]=_0x28837b['split'](_0x1e2ef8[_0x1dd08d(0x20f)]);_0x39d0cc=_0x390d69,_0x570438[_0x1dd08d(0x1ef)](_0x3407a0,'0')&&(this[_0x1dd08d(0x2c9)]=!![]);}}for(let _0x194e78=_0xeb089a[_0x1dd08d(0x215)]-0x1;_0x194e78>=0x0;_0x194e78--){if(_0xeb089a[_0x194e78]?.[_0x1dd08d(0x277)]){this[_0x1dd08d(0x203)]=_0xeb089a[_0x194e78];break;}}if(this[_0x1dd08d(0x203)]){if('IYtaI'!==_0x570438['EeLsw'])_0x28a4eb[_0x1dd08d(0x28d)]('`[BaseClient]\x20recordTokenUsage`\x20not\x20implemented.',_0x5ebbb7);else{const {messageId:_0x2dd6d6,summary:_0x39126e,tokenCount:_0x1c7cf3,summaryTokenCount:_0x445142}=this[_0x1dd08d(0x203)];logger['debug'](_0x1dd08d(0x28e),{'messageId':_0x2dd6d6,'summary':_0x39126e,'tokenCount':_0x1c7cf3,'summaryTokenCount':_0x445142});}}return _0xeb089a;}async[_0x214313(0x242)](_0x4627de,_0x1161fb,_0x43951f=null){const _0x433e9d=_0x214313,_0x5174a3={'IMcGY':_0x433e9d(0x296),'ycsXU':function(_0x4a2d7e,_0x2a6de9,_0x45479d,_0x64f203){return _0x4a2d7e(_0x2a6de9,_0x45479d,_0x64f203);},'SgtjU':_0x433e9d(0x2af)};if(this[_0x433e9d(0x2c6)]&&_0x43951f!==this[_0x433e9d(0x2c6)])throw new Error(_0x5174a3[_0x433e9d(0x26b)]);const _0xc4e837=await _0x5174a3[_0x433e9d(0x22a)](saveMessage,this[_0x433e9d(0x23d)][_0x433e9d(0x21e)],{..._0x4627de,'endpoint':this['options'][_0x433e9d(0x1de)],'unfinished':![],'user':_0x43951f},{'context':_0x5174a3[_0x433e9d(0x1ea)]});if(this[_0x433e9d(0x2c9)])return{'message':_0xc4e837};const _0x2dc21b=await saveConvo(this[_0x433e9d(0x23d)][_0x433e9d(0x21e)],{'conversationId':_0x4627de[_0x433e9d(0x2a0)],'endpoint':this['options']['endpoint'],'endpointType':this[_0x433e9d(0x23d)][_0x433e9d(0x1e8)],..._0x1161fb},{'context':'api/app/clients/BaseClient.js\x20-\x20saveMessageToDatabase\x20#saveConvo'});return{'message':_0xc4e837,'conversation':_0x2dc21b};}async[_0x214313(0x29e)](_0x63b213){const _0x5b2bc5=_0x214313,_0x13597c={'zzoDr':function(_0x3c20a0,_0x5f34fa,_0x3730cf){return _0x3c20a0(_0x5f34fa,_0x3730cf);}};await _0x13597c[_0x5b2bc5(0x212)](updateMessage,this[_0x5b2bc5(0x23d)][_0x5b2bc5(0x21e)],_0x63b213);}static['getMessagesForConversation']({messages:_0x14a42a,parentMessageId:_0x2dc227,mapMethod:mapMethod=null,summary:summary=![]}){const _0x41c5fc=_0x214313,_0x4dadfc={'AbyWa':function(_0x403fd2,_0x53d801){return _0x403fd2===_0x53d801;}};if(!_0x14a42a||_0x14a42a[_0x41c5fc(0x215)]===0x0)return[];const _0xaf33e3=[];let _0x476710=_0x2dc227;const _0x7a1305=new Set();while(_0x476710){if(_0x7a1305[_0x41c5fc(0x224)](_0x476710))break;const _0x3b5ab6=_0x14a42a['find'](_0x593a0d=>{const _0x275d63=_0x41c5fc,_0x4be435=_0x593a0d['messageId']??_0x593a0d['id'];return _0x4dadfc[_0x275d63(0x208)](_0x4be435,_0x476710);});_0x7a1305['add'](_0x476710);if(!_0x3b5ab6)break;summary&&_0x3b5ab6['summary']&&(_0x3b5ab6[_0x41c5fc(0x1e0)]=_0x41c5fc(0x22c),_0x3b5ab6['text']=_0x3b5ab6[_0x41c5fc(0x277)]);summary&&_0x3b5ab6[_0x41c5fc(0x252)]&&(_0x3b5ab6['tokenCount']=_0x3b5ab6[_0x41c5fc(0x252)]);_0xaf33e3[_0x41c5fc(0x22d)](_0x3b5ab6);if(summary&&_0x3b5ab6[_0x41c5fc(0x277)])break;_0x476710=_0x3b5ab6[_0x41c5fc(0x25e)]===Constants[_0x41c5fc(0x2b2)]?null:_0x3b5ab6['parentMessageId'];}_0xaf33e3[_0x41c5fc(0x288)]();if(mapMethod)return _0xaf33e3[_0x41c5fc(0x264)](mapMethod);return _0xaf33e3;}[_0x214313(0x1f1)](_0x79767){const _0x50dfae=_0x214313,_0x1b742a={'HUpRQ':function(_0x2bc0ca,_0xdf1339){return _0x2bc0ca(_0xdf1339);},'eUAIm':function(_0x5a7546,_0x21952a){return _0x5a7546===_0x21952a;},'RWASg':function(_0x5513e8,_0x4f8ca7){return _0x5513e8(_0x4f8ca7);},'HdYGn':_0x50dfae(0x1ca),'pFPId':_0x50dfae(0x257),'HoezA':function(_0x5d63a6,_0x489427){return _0x5d63a6!==_0x489427;},'xlakZ':_0x50dfae(0x1d4),'EFOSm':_0x50dfae(0x2b3),'xQZAo':function(_0x5e2e03,_0x5d8986){return _0x5e2e03===_0x5d8986;},'WGbNt':function(_0x34322c,_0x4d1db6){return _0x34322c===_0x4d1db6;},'YvucI':_0x50dfae(0x1d8),'FfGxT':function(_0x2b151f,_0x348b36){return _0x2b151f===_0x348b36;},'hemTd':_0x50dfae(0x26c),'SbZHo':_0x50dfae(0x23e)};let _0x219de1=0x3,_0x5072fa=0x1;if(_0x1b742a[_0x50dfae(0x22f)](this['modelOptions'][_0x50dfae(0x285)],_0x1b742a[_0x50dfae(0x24a)])){if(_0x1b742a[_0x50dfae(0x210)]('ZUzcF','VzydY'))return _0x11bd58[_0x50dfae(0x2a8)]((_0x111628,_0x2c4ce9)=>{const _0x657480=_0x50dfae,_0x2b78b9=_0x2c4ce9['name']??_0x2c4ce9[_0x657480(0x1e0)];return _0x111628+(_0x2b78b9+':\x0a'+_0x2c4ce9[_0x657480(0x278)]+'\x0a\x0a');},'');else _0x219de1=0x4,_0x5072fa=-0x1;}const _0x13250a=_0x1239af=>{const _0xaf79dc=_0x50dfae;if(Array[_0xaf79dc(0x21f)](_0x1239af))for(let _0x1d0931 of _0x1239af){if(!_0x1d0931||!_0x1d0931['type']||_0x1b742a[_0xaf79dc(0x1fb)](_0x1d0931['type'],_0xaf79dc(0x1e2)))continue;const _0x22d8ad=_0x1d0931[_0x1d0931[_0xaf79dc(0x1e7)]];if(!_0x22d8ad)continue;_0x1b742a[_0xaf79dc(0x2aa)](_0x13250a,_0x22d8ad);}else{if(typeof _0x1239af===_0x1b742a['HdYGn'])_0x532720+=this[_0xaf79dc(0x27c)](_0x1239af);else{if(typeof _0x1239af===_0x1b742a[_0xaf79dc(0x231)])_0x1b742a[_0xaf79dc(0x2a9)](_0x1b742a[_0xaf79dc(0x2c3)],_0x1b742a['EFOSm'])?_0x532720+=this[_0xaf79dc(0x27c)](_0x1239af[_0xaf79dc(0x268)]()):_0x39bb90['text']=_0x1b742a['HUpRQ'](_0x580805,_0x12cc1c)+_0x3409d6;else _0x1b742a['xQZAo'](typeof _0x1239af,_0xaf79dc(0x211))&&(_0x532720+=this[_0xaf79dc(0x27c)](_0x1239af[_0xaf79dc(0x268)]()));}}};let _0x532720=_0x219de1;for(let [_0x3a74b4,_0x9f2f12]of Object[_0x50dfae(0x287)](_0x79767)){_0x13250a(_0x9f2f12),_0x1b742a[_0x50dfae(0x2a6)](_0x3a74b4,_0x1b742a[_0x50dfae(0x2c2)])&&(_0x1b742a['SbZHo']===_0x50dfae(0x23e)?_0x532720+=_0x5072fa:(_0x4c3122=0x4,_0x1c2da8=-0x1));}return _0x532720;}async[_0x214313(0x270)](_0x1349bb,_0x26af11={}){const _0xcd6037=_0x214313;return _0x26af11&&typeof _0x26af11===_0xcd6037(0x297)&&this[_0xcd6037(0x1d0)](_0x26af11),await this[_0xcd6037(0x28c)](_0x1349bb,_0x26af11);}async[_0x214313(0x275)](_0x50c01b){const _0x35f889=_0x214313,_0x52c75f={'fBgDg':function(_0x58d78c,_0x480dfd){return _0x58d78c!==_0x480dfd;},'SUkRs':_0x35f889(0x1ce),'dtcVA':function(_0x3daad5,_0x1cc0b6){return _0x3daad5(_0x1cc0b6);}};if(!this['options'][_0x35f889(0x1d6)]){if(_0x52c75f[_0x35f889(0x265)](_0x52c75f['SUkRs'],_0x35f889(0x1ce))){const _0x27c080=_0xbd2185[_0x35f889(0x2a3)]+_0x35f889(0x230)+this[_0x35f889(0x27d)],_0x1d8691=_0x35f889(0x26d)+_0x1fd60e[_0x35f889(0x1da)]+_0x35f889(0x27f)+_0x27c080+_0x35f889(0x2a7);_0x4a0fac[_0x35f889(0x1f3)](_0x35f889(0x1fd)+_0x27c080+').');throw new _0x74788c(_0x1d8691);}else return _0x50c01b;}const _0x112294=async _0x27dce6=>{const _0x5aa664=_0x35f889;!this[_0x5aa664(0x21b)]&&(this['message_file_map']={});const _0x7eb8ba=_0x27dce6[_0x5aa664(0x251)][_0x5aa664(0x264)](_0x143028=>_0x143028[_0x5aa664(0x262)]),_0x3030da=await getFiles({'file_id':{'$in':_0x7eb8ba}});return await this[_0x5aa664(0x2bd)](_0x27dce6,_0x3030da),this[_0x5aa664(0x21b)][_0x27dce6[_0x5aa664(0x2c0)]]=_0x3030da,_0x27dce6;},_0x7a5108=[];for(const _0x2995b8 of _0x50c01b){if(!_0x2995b8['files']){_0x7a5108[_0x35f889(0x22d)](_0x2995b8);continue;}_0x7a5108[_0x35f889(0x22d)](_0x52c75f[_0x35f889(0x21c)](_0x112294,_0x2995b8));}const _0x2ce89d=await Promise[_0x35f889(0x290)](_0x7a5108);return this[_0x35f889(0x25b)](Object[_0x35f889(0x255)](this[_0x35f889(0x21b)]??{})[_0x35f889(0x2b4)]()),_0x2ce89d;}}module[_0x214313(0x1ec)]=BaseClient;