function _0x556d(_0x3be271,_0x195e2c){const _0x13f80c=_0x13f8();return _0x556d=function(_0x556d61,_0x15ad8b){_0x556d61=_0x556d61-0x73;let _0xcc86c1=_0x13f80c[_0x556d61];return _0xcc86c1;},_0x556d(_0x3be271,_0x195e2c);}const _0x967dfa=_0x556d;(function(_0x53cf8c,_0x5147b1){const _0x9f1a6e=_0x556d,_0x54031b=_0x53cf8c();while(!![]){try{const _0x59d35a=parseInt(_0x9f1a6e(0xab))/0x1+-parseInt(_0x9f1a6e(0x9e))/0x2+parseInt(_0x9f1a6e(0x93))/0x3+-parseInt(_0x9f1a6e(0xa6))/0x4*(parseInt(_0x9f1a6e(0x8f))/0x5)+parseInt(_0x9f1a6e(0x79))/0x6+parseInt(_0x9f1a6e(0xad))/0x7*(parseInt(_0x9f1a6e(0x80))/0x8)+-parseInt(_0x9f1a6e(0x9a))/0x9*(parseInt(_0x9f1a6e(0x95))/0xa);if(_0x59d35a===_0x5147b1)break;else _0x54031b['push'](_0x54031b['shift']());}catch(_0x1c972f){_0x54031b['push'](_0x54031b['shift']());}}}(_0x13f8,0x914b6));const express=require(_0x967dfa(0xac)),{PermissionTypes,Permissions,SystemRoles}=require('librechat-data-provider'),{getPrompt,getPrompts,savePrompt,deletePrompt,getPromptGroup,getPromptGroups,updatePromptGroup,deletePromptGroup,createPromptGroup,getAllPromptGroups,makePromptProduction}=require(_0x967dfa(0xa2)),{requireJwtAuth,generateCheckAccess}=require('~/server/middleware'),{logger}=require('~/config'),router=express['Router'](),checkPromptAccess=generateCheckAccess(PermissionTypes[_0x967dfa(0x8e)],[Permissions['USE']]),checkPromptCreate=generateCheckAccess(PermissionTypes['PROMPTS'],[Permissions[_0x967dfa(0x9d)],Permissions[_0x967dfa(0x9c)]]),checkGlobalPromptShare=generateCheckAccess(PermissionTypes['PROMPTS'],[Permissions[_0x967dfa(0x9d)],Permissions[_0x967dfa(0x9c)]],{[Permissions[_0x967dfa(0xa7)]]:[_0x967dfa(0x87),_0x967dfa(0x7d)]});router[_0x967dfa(0x7f)](requireJwtAuth),router['use'](checkPromptAccess),router[_0x967dfa(0xa1)]('/groups/:groupId',async(_0x4cfbe5,_0x8a4c35)=>{const _0x1cb2fb=_0x967dfa,_0x34c9e1={'Rvbbo':function(_0x307cc4,_0x3205a1){return _0x307cc4(_0x3205a1);},'IPsay':_0x1cb2fb(0x86)};let _0x2957cd=_0x4cfbe5[_0x1cb2fb(0x88)][_0x1cb2fb(0x98)];const _0x47de3f=_0x4cfbe5[_0x1cb2fb(0x8d)]['id'],_0x277e98={'_id':_0x2957cd,'$or':[{'projectIds':{'$exists':!![],'$ne':[],'$not':{'$size':0x0}}},{'author':_0x47de3f}]};_0x4cfbe5[_0x1cb2fb(0x8d)][_0x1cb2fb(0xae)]===SystemRoles[_0x1cb2fb(0x78)]&&delete _0x277e98[_0x1cb2fb(0x9f)];try{const _0x1a682b=await _0x34c9e1['Rvbbo'](getPromptGroup,_0x277e98);if(!_0x1a682b)return _0x8a4c35[_0x1cb2fb(0x8b)](0x194)[_0x1cb2fb(0x73)]({'message':_0x1cb2fb(0x89)});_0x8a4c35[_0x1cb2fb(0x8b)](0xc8)[_0x1cb2fb(0x73)](_0x1a682b);}catch(_0x3514f3){logger['error'](_0x1cb2fb(0x86),_0x3514f3),_0x8a4c35[_0x1cb2fb(0x8b)](0x1f4)['send']({'message':_0x34c9e1[_0x1cb2fb(0xa5)]});}}),router[_0x967dfa(0xa1)](_0x967dfa(0x96),async(_0x6e6a23,_0x293b80)=>{const _0x2cb1ce=_0x967dfa;try{const _0xefb319=await getAllPromptGroups(_0x6e6a23,{'author':_0x6e6a23['user']['_id']});_0x293b80['status'](0xc8)['send'](_0xefb319);}catch(_0x54580d){logger[_0x2cb1ce(0xa0)](_0x54580d),_0x293b80[_0x2cb1ce(0x8b)](0x1f4)[_0x2cb1ce(0x73)]({'error':'Error\x20getting\x20prompt\x20groups'});}}),router[_0x967dfa(0xa1)](_0x967dfa(0x90),async(_0x45a113,_0x254ed4)=>{const _0x39ee89=_0x967dfa,_0x3585eb={'kBRbX':function(_0x1be8b4,_0x50a1bf,_0x5c33d9){return _0x1be8b4(_0x50a1bf,_0x5c33d9);}};try{const _0x4a6775=_0x45a113[_0x39ee89(0x76)];_0x4a6775[_0x39ee89(0x74)]=_0x45a113['user'][_0x39ee89(0x8a)];const _0xd53847=await _0x3585eb[_0x39ee89(0x7a)](getPromptGroups,_0x45a113,_0x4a6775);_0x254ed4[_0x39ee89(0x8b)](0xc8)[_0x39ee89(0x73)](_0xd53847);}catch(_0x4abecb){logger[_0x39ee89(0xa0)](_0x4abecb),_0x254ed4['status'](0x1f4)[_0x39ee89(0x73)]({'error':_0x39ee89(0x7e)});}});const createPrompt=async(_0x591ad3,_0x52a574)=>{const _0x553d33=_0x967dfa,_0x523aa2={'nfplS':_0x553d33(0xaa),'gSUGu':_0x553d33(0x85)};try{const {prompt:_0x16b17d,group:_0x2ca72f}=_0x591ad3[_0x553d33(0x94)];if(!_0x16b17d)return _0x52a574['status'](0x190)[_0x553d33(0x73)]({'error':_0x523aa2[_0x553d33(0x83)]});const _0x5d4b1b={'prompt':_0x16b17d,'group':_0x2ca72f,'author':_0x591ad3[_0x553d33(0x8d)]['id'],'authorName':_0x591ad3[_0x553d33(0x8d)][_0x553d33(0x9b)]};let _0x3b14f3;_0x2ca72f&&_0x2ca72f[_0x553d33(0x9b)]?_0x3b14f3=await createPromptGroup(_0x5d4b1b):_0x3b14f3=await savePrompt(_0x5d4b1b),_0x52a574[_0x553d33(0x8b)](0xc8)[_0x553d33(0x73)](_0x3b14f3);}catch(_0x30243b){logger[_0x553d33(0xa0)](_0x30243b),_0x52a574[_0x553d33(0x8b)](0x1f4)[_0x553d33(0x73)]({'error':_0x523aa2[_0x553d33(0xa4)]});}};router['post']('/',checkPromptCreate,createPrompt);const patchPromptGroup=async(_0x5220f0,_0x20ea5e)=>{const _0x16802e=_0x967dfa,_0x47dff0={'pvIpt':function(_0x1f78ab,_0x5f68cf,_0x2767c6){return _0x1f78ab(_0x5f68cf,_0x2767c6);}};try{const {groupId:_0x2d79f0}=_0x5220f0[_0x16802e(0x88)],_0x24e2c8=_0x5220f0[_0x16802e(0x8d)]['id'],_0xe9eb0e={'_id':_0x2d79f0,'author':_0x24e2c8};_0x5220f0[_0x16802e(0x8d)]['role']===SystemRoles['ADMIN']&&delete _0xe9eb0e[_0x16802e(0x74)];const _0x64f1f2=await _0x47dff0[_0x16802e(0x97)](updatePromptGroup,_0xe9eb0e,_0x5220f0['body']);_0x20ea5e['status'](0xc8)[_0x16802e(0x73)](_0x64f1f2);}catch(_0x2bb191){_0x16802e(0x81)===_0x16802e(0x75)?delete _0x1a3599[_0x16802e(0x74)]:(logger['error'](_0x2bb191),_0x20ea5e[_0x16802e(0x8b)](0x1f4)['send']({'error':'Error\x20updating\x20prompt\x20group'}));}};router[_0x967dfa(0xa3)]('/groups/:groupId',checkGlobalPromptShare,patchPromptGroup),router[_0x967dfa(0xa3)](_0x967dfa(0x8c),checkPromptCreate,async(_0x5b40f0,_0x4879ba)=>{const _0x2c8e34=_0x967dfa,_0xcc34b8={'ZiRLk':function(_0x2220de,_0x31d9c0){return _0x2220de(_0x31d9c0);}};try{const {promptId:_0x48bd91}=_0x5b40f0['params'],_0x21ebc8=await _0xcc34b8[_0x2c8e34(0xa9)](makePromptProduction,_0x48bd91);_0x4879ba[_0x2c8e34(0x8b)](0xc8)[_0x2c8e34(0x73)](_0x21ebc8);}catch(_0x4054a7){logger[_0x2c8e34(0xa0)](_0x4054a7),_0x4879ba[_0x2c8e34(0x8b)](0x1f4)[_0x2c8e34(0x73)]({'error':_0x2c8e34(0x77)});}}),router[_0x967dfa(0xa1)]('/:promptId',async(_0x191c38,_0x38d144)=>{const _0x5e73ff=_0x967dfa,_0x156213={'BoLtU':function(_0x216878,_0x1273c6){return _0x216878===_0x1273c6;},'KrCDq':function(_0x40204c,_0x3e9453){return _0x40204c(_0x3e9453);}},{promptId:_0xccd7ea}=_0x191c38[_0x5e73ff(0x88)],_0x3d94c7=_0x191c38[_0x5e73ff(0x8d)]['id'],_0x3b3280={'_id':_0xccd7ea,'author':_0x3d94c7};_0x156213[_0x5e73ff(0x99)](_0x191c38['user'][_0x5e73ff(0xae)],SystemRoles['ADMIN'])&&delete _0x3b3280['author'];const _0x48cb89=await _0x156213[_0x5e73ff(0x92)](getPrompt,_0x3b3280);_0x38d144[_0x5e73ff(0x8b)](0xc8)[_0x5e73ff(0x73)](_0x48cb89);}),router['get']('/',async(_0x256517,_0x44daf6)=>{const _0x39c0f6=_0x967dfa,_0x52ad48={'JSWfo':function(_0x254945,_0x35eea7){return _0x254945(_0x35eea7);}};try{const _0x404036=_0x256517[_0x39c0f6(0x8d)]['id'],{groupId:_0x560fde}=_0x256517[_0x39c0f6(0x76)],_0x2ceebd={'groupId':_0x560fde,'author':_0x404036};_0x256517[_0x39c0f6(0x8d)]['role']===SystemRoles[_0x39c0f6(0x78)]&&delete _0x2ceebd['author'];const _0x1bc499=await _0x52ad48[_0x39c0f6(0x7b)](getPrompts,_0x2ceebd);_0x44daf6[_0x39c0f6(0x8b)](0xc8)[_0x39c0f6(0x73)](_0x1bc499);}catch(_0xaba92b){logger['error'](_0xaba92b),_0x44daf6[_0x39c0f6(0x8b)](0x1f4)[_0x39c0f6(0x73)]({'error':_0x39c0f6(0x84)});}});const deletePromptController=async(_0x33546e,_0x5444f7)=>{const _0x256b29=_0x967dfa;try{const {promptId:_0xb7043a}=_0x33546e[_0x256b29(0x88)],{groupId:_0x54c054}=_0x33546e['query'],_0x2a392b=_0x33546e['user']['id'],_0x4cae25={'promptId':_0xb7043a,'groupId':_0x54c054,'author':_0x2a392b,'role':_0x33546e[_0x256b29(0x8d)][_0x256b29(0xae)]};_0x33546e[_0x256b29(0x8d)][_0x256b29(0xae)]===SystemRoles['ADMIN']&&delete _0x4cae25['author'];const _0x31dfba=await deletePrompt(_0x4cae25);_0x5444f7['status'](0xc8)['send'](_0x31dfba);}catch(_0x455c15){logger[_0x256b29(0xa0)](_0x455c15),_0x5444f7['status'](0x1f4)[_0x256b29(0x73)]({'error':_0x256b29(0x7c)});}};router[_0x967dfa(0x91)](_0x967dfa(0x82),checkPromptCreate,deletePromptController),router[_0x967dfa(0x91)]('/groups/:groupId',checkPromptCreate,async(_0x2f82a5,_0x313fc8)=>{const _0xbeef72=_0x967dfa,{groupId:_0x4bb787}=_0x2f82a5['params'];_0x313fc8[_0xbeef72(0x8b)](0xc8)[_0xbeef72(0x73)](await deletePromptGroup(_0x4bb787));}),module[_0x967dfa(0xa8)]=router;function _0x13f8(){const _0x397d5f=['CREATE','USE','1616004RvmjTh','$or','error','get','~/models/Prompt','patch','gSUGu','IPsay','421856GPvHWo','SHARED_GLOBAL','exports','ZiRLk','Prompt\x20is\x20required','1130099DNcDVS','express','413DVisds','role','send','author','GLqED','query','Error\x20updating\x20prompt\x20production','ADMIN','1480746YWoZvl','kBRbX','JSWfo','Error\x20deleting\x20prompt','removeProjectIds','Error\x20getting\x20prompt\x20groups','use','149064jFVyde','HVigQ','/:promptId','nfplS','Error\x20getting\x20prompts','Error\x20saving\x20prompt','Error\x20getting\x20prompt\x20group','projectIds','params','Prompt\x20group\x20not\x20found','_id','status','/:promptId/tags/production','user','PROMPTS','35WuyjRt','/groups','delete','KrCDq','1008468cFjqCe','body','10CNzHDk','/all','pvIpt','groupId','BoLtU','6039153kvouPD','name'];_0x13f8=function(){return _0x397d5f;};return _0x13f8();}