const _0x3a4228=_0x5f3e;function _0x3bd3(){const _0x486820=['TbABo','spZPE','wVuHF','wPTJW','JKkRc','PbvjZ','gUNdq','930177MQYaKH','ZAsod','sort','$category','./Project','findOneAndUpdate','productionId','groupId_1_version_1','exports','470175mXysuK','findById','VVsYI','length','WMjDL','bzEIp','cWrtJ','fPNTS','Error\x20saving\x20prompt\x20group','max','vsdpS','SHARED_PROMPTS','1598586xMHZSK','CRfyA','rbKmF','pMzrj','Error\x20updating\x20prompt\x20group','HEZid','deleteOne','NO_CATEGORY','mIOxo','prompt','VTcKl','all','Error\x20getting\x20prompt\x20groups','updateOne','vBbCD','deletedCount','raYkE','lean','Error\x20updating\x20prompt\x20labels','uSQfl','mFWna','xWdwi','deleteMany','Error\x20getting\x20prompt\x20group','8399984RNoeMe','nPqFy','mongodb','aggregate','Prompt\x20group\x20deleted\x20successfully','removeProjectIds','30Gbmimy','limit','promptGroupIds','pYvQT','ToCqY','UUZoQ','KCGUp','vQFdr','OpdEB','3696091cnXQas','Error\x20getting\x20all\x20prompt\x20groups','create','Error\x20getting\x20prompt','collection','Error\x20deleting\x20prompt\x20group','$productionPrompt','error','Error\x20saving\x20prompt','mcXDi','HzCls','rzPAe','gtOOT','MY_PROMPTS','dropIndex','findOne','dJmxS','skip','LUgzB','xtPCD','Error\x20getting\x20prompts','groupId','32247AvGoCI','sGAiq','GUhnk','114748BdPmBG','VbsqW','durAn','KLHdA','EFSlv','Prompt\x20group\x20not\x20found','findByIdAndUpdate','TWcud','twLHz','Failed\x20to\x20delete\x20the\x20prompt','BlKrz','kpPDy','exec','productionPrompt','matchedCount','Prompt\x20deleted\x20successfully','qOchN','category','select','Error\x20making\x20prompt\x20production','./schema/promptSchema','Embkw','pkxDQ','-_id\x20-__v\x20-user','Prompt\x20not\x20found','yYXYY','prompts','100USHbIu','vDFhB','projectIds','name','BdcUx','Prompt\x20labels\x20updated\x20successfully','populate','CnemM','GQyfU','_id','~/server/utils','includes','12IwPhtj','$promptGroup','mveLt','Author\x20is\x20required','Vexgp','qzhOh','total','EwoAI','toString','message','jDUaz','librechat-data-provider','find','vlNTa','author','-__v','svRCg','ADMIN','iyFPj','VwZjL','ceil','Prompt\x20production\x20made\x20successfully'];_0x3bd3=function(){return _0x486820;};return _0x3bd3();}function _0x5f3e(_0x2fe1b3,_0x6be478){const _0x3bd31c=_0x3bd3();return _0x5f3e=function(_0x5f3e0b,_0x51a29d){_0x5f3e0b=_0x5f3e0b-0x1ac;let _0x5131e3=_0x3bd31c[_0x5f3e0b];return _0x5131e3;},_0x5f3e(_0x2fe1b3,_0x6be478);}(function(_0x1abd7b,_0x3fb971){const _0x52c405=_0x5f3e,_0x23a2ab=_0x1abd7b();while(!![]){try{const _0x1b7ba5=-parseInt(_0x52c405(0x241))/0x1+parseInt(_0x52c405(0x1b4))/0x2+parseInt(_0x52c405(0x1f1))/0x3+-parseInt(_0x52c405(0x1f4))/0x4*(-parseInt(_0x52c405(0x20f))/0x5)+parseInt(_0x52c405(0x21b))/0x6*(parseInt(_0x52c405(0x1db))/0x7)+-parseInt(_0x52c405(0x1cc))/0x8+-parseInt(_0x52c405(0x238))/0x9*(parseInt(_0x52c405(0x1d2))/0xa);if(_0x1b7ba5===_0x3fb971)break;else _0x23a2ab['push'](_0x23a2ab['shift']());}catch(_0x4dd5d5){_0x23a2ab['push'](_0x23a2ab['shift']());}}}(_0x3bd3,0x94d28));const {ObjectId}=require(_0x3a4228(0x1ce)),{SystemRoles,SystemCategories,Constants}=require(_0x3a4228(0x226)),{getProjectByName,addGroupIdsToProject,removeGroupIdsFromProject,removeGroupFromAllProjects}=require(_0x3a4228(0x23c)),{Prompt,PromptGroup}=require(_0x3a4228(0x208)),{escapeRegExp}=require(_0x3a4228(0x219)),{logger}=require('~/config'),createGroupPipeline=(_0x2739f4,_0x215732,_0x20e5d5)=>{const _0x39c934=_0x3a4228,_0x244259={'KCGUp':_0x39c934(0x20e),'iyFPj':'productionId','xWwTA':_0x39c934(0x201),'YhbFN':'$productionPrompt'};return[{'$match':_0x2739f4},{'$sort':{'createdAt':-0x1}},{'$skip':_0x215732},{'$limit':_0x20e5d5},{'$lookup':{'from':_0x244259[_0x39c934(0x1d8)],'localField':_0x244259[_0x39c934(0x22d)],'foreignField':'_id','as':_0x244259['xWwTA']}},{'$unwind':{'path':_0x244259['YhbFN'],'preserveNullAndEmptyArrays':!![]}},{'$project':{'name':0x1,'numberOfGenerations':0x1,'oneliner':0x1,'category':0x1,'projectIds':0x1,'productionId':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'productionPrompt.prompt':0x1}}];},createAllGroupsPipeline=(_0x30ae55,_0x1f390e={'name':0x1,'oneliner':0x1,'category':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'command':0x1,'productionPrompt.prompt':0x1})=>{const _0x4cdade=_0x3a4228,_0x51bc29={'vQFdr':'prompts','mFWna':_0x4cdade(0x218),'rzPAe':_0x4cdade(0x1e1)};return[{'$match':_0x30ae55},{'$sort':{'createdAt':-0x1}},{'$lookup':{'from':_0x51bc29[_0x4cdade(0x1d9)],'localField':_0x4cdade(0x23e),'foreignField':_0x51bc29[_0x4cdade(0x1c8)],'as':'productionPrompt'}},{'$unwind':{'path':_0x51bc29[_0x4cdade(0x1e6)],'preserveNullAndEmptyArrays':!![]}},{'$project':_0x1f390e}];},getAllPromptGroups=async(_0x55c07f,_0x2ed268)=>{const _0x12e84a=_0x3a4228,_0xfbfeea={'vvuKS':'Error\x20deleting\x20prompt\x20group','sGAiq':'Error\x20updating\x20prompt\x20labels','dJmxS':function(_0x575fac,_0x3d8dec){return _0x575fac===_0x3d8dec;},'cCDGZ':'DMsgG','VbsqW':_0x12e84a(0x1f3),'HEZid':_0x12e84a(0x21e),'wGLcr':function(_0x27e771,_0x701f9c){return _0x27e771(_0x701f9c);}};try{const {name:_0x196e17,..._0x438851}=_0x2ed268;if(!_0x438851['author']){if(_0xfbfeea['dJmxS'](_0xfbfeea['cCDGZ'],_0xfbfeea[_0x12e84a(0x1f5)]))return _0x466bbd[_0x12e84a(0x1e2)](_0x12e84a(0x1e0),_0x5d3873),{'message':_0xfbfeea['vvuKS']};else throw new Error(_0xfbfeea[_0x12e84a(0x1b9)]);}let _0x3add37=!![],_0x5e0866=![];_0x196e17&&(_0x438851['name']=new RegExp(escapeRegExp(_0x196e17),'i'));if(!_0x438851[_0x12e84a(0x205)])delete _0x438851[_0x12e84a(0x205)];else{if(_0xfbfeea['dJmxS'](_0x438851[_0x12e84a(0x205)],SystemCategories['MY_PROMPTS']))_0x3add37=![],delete _0x438851[_0x12e84a(0x205)];else{if(_0xfbfeea[_0x12e84a(0x1eb)](_0x438851['category'],SystemCategories[_0x12e84a(0x1bb)])){if(_0x12e84a(0x1fb)!=='LOODz')_0x438851[_0x12e84a(0x205)]='';else return _0x28bbea[_0x12e84a(0x1e2)](_0x12e84a(0x1c6),_0x379179),{'message':_0xfbfeea[_0x12e84a(0x1f2)]};}else _0x438851[_0x12e84a(0x205)]===SystemCategories['SHARED_PROMPTS']&&(_0x5e0866=!![],delete _0x438851[_0x12e84a(0x205)]);}}let _0xf8b112=_0x438851;if(_0x3add37){const _0x31475a=await getProjectByName(Constants['GLOBAL_PROJECT_NAME'],_0x12e84a(0x1d4));if(_0x31475a&&_0x31475a['promptGroupIds'][_0x12e84a(0x244)]>0x0){const _0x33dd4f={'_id':{'$in':_0x31475a[_0x12e84a(0x1d4)]},..._0x438851};delete _0x33dd4f[_0x12e84a(0x229)],_0xf8b112=_0x5e0866?_0x33dd4f:{'$or':[_0x33dd4f,_0x438851]};}}const _0x221489=_0xfbfeea['wGLcr'](createAllGroupsPipeline,_0xf8b112);return await PromptGroup[_0x12e84a(0x1cf)](_0x221489)['exec']();}catch(_0x48031f){return console[_0x12e84a(0x1e2)]('Error\x20getting\x20all\x20prompt\x20groups',_0x48031f),{'message':_0x12e84a(0x1dc)};}},getPromptGroups=async(_0x1f2064,_0x12bef4)=>{const _0x3847e8=_0x3a4228,_0x1b19c5={'GQyfU':function(_0x146050,_0x1426d4,_0x3680e8){return _0x146050(_0x1426d4,_0x3680e8);},'pYvQT':_0x3847e8(0x21e),'WMjDL':function(_0x5c9a82,_0x3034c5){return _0x5c9a82===_0x3034c5;},'spZPE':_0x3847e8(0x1c4),'vlNTa':_0x3847e8(0x1d4),'wPTJW':function(_0x4a18c4,_0x4e6f80){return _0x4a18c4>_0x4e6f80;},'CRfyA':function(_0x4f5907,_0x216beb,_0x46a5d6,_0x125829){return _0x4f5907(_0x216beb,_0x46a5d6,_0x125829);},'OpdEB':_0x3847e8(0x243),'nXsHs':'JbzWn','CSdcI':_0x3847e8(0x1c0)};try{const {pageNumber:pageNumber=0x1,pageSize:pageSize=0xa,name:_0x134bff,..._0x1938b5}=_0x12bef4,_0x1e5015=Math[_0x3847e8(0x1b1)](_0x1b19c5[_0x3847e8(0x217)](parseInt,pageNumber,0xa),0x1),_0x195057=Math['max'](_0x1b19c5[_0x3847e8(0x217)](parseInt,pageSize,0xa),0x1);if(!_0x1938b5[_0x3847e8(0x229)])throw new Error(_0x1b19c5[_0x3847e8(0x1d5)]);let _0x1c9983=!![],_0x47e01f=![];_0x134bff&&(_0x1938b5[_0x3847e8(0x212)]=new RegExp(escapeRegExp(_0x134bff),'i'));if(!_0x1938b5['category']){if(_0x3847e8(0x1b6)==='rbKmF')delete _0x1938b5['category'];else return _0x4063c5[_0x3847e8(0x1e2)](_0x3847e8(0x1e3),_0x1c25a3),{'message':'Error\x20saving\x20prompt'};}else{if(_0x1b19c5[_0x3847e8(0x1ac)](_0x1938b5['category'],SystemCategories[_0x3847e8(0x1e8)])){if(_0x3847e8(0x1c4)===_0x1b19c5[_0x3847e8(0x232)])_0x1c9983=![],delete _0x1938b5[_0x3847e8(0x205)];else{const _0x45ebd5={'_id':{'$in':_0x321988['promptGroupIds']},..._0x2d2807};delete _0x45ebd5[_0x3847e8(0x229)],_0xc4dc18=_0x5e1cdc?_0x45ebd5:{'$or':[_0x45ebd5,_0x519d44]};}}else{if(_0x1938b5[_0x3847e8(0x205)]===SystemCategories[_0x3847e8(0x1bb)])_0x1938b5[_0x3847e8(0x205)]='';else _0x1938b5[_0x3847e8(0x205)]===SystemCategories[_0x3847e8(0x1b3)]&&(_0x47e01f=!![],delete _0x1938b5[_0x3847e8(0x205)]);}}let _0x1694f6=_0x1938b5;if(_0x1c9983){const _0x5e514f=await getProjectByName(Constants['GLOBAL_PROJECT_NAME'],_0x1b19c5[_0x3847e8(0x228)]);if(_0x5e514f&&_0x1b19c5[_0x3847e8(0x234)](_0x5e514f['promptGroupIds'][_0x3847e8(0x244)],0x0)){const _0x220f3e={'_id':{'$in':_0x5e514f[_0x3847e8(0x1d4)]},..._0x1938b5};delete _0x220f3e['author'],_0x1694f6=_0x47e01f?_0x220f3e:{'$or':[_0x220f3e,_0x1938b5]};}}const _0x19bbd7=(_0x1e5015-0x1)*_0x195057,_0x1e3325=_0x195057,_0x46b3da=_0x1b19c5[_0x3847e8(0x1b5)](createGroupPipeline,_0x1694f6,_0x19bbd7,_0x1e3325),_0x68a513=[{'$match':_0x1694f6},{'$count':'total'}],[_0x5e8ac0,_0xc8fb9b]=await Promise[_0x3847e8(0x1bf)]([PromptGroup['aggregate'](_0x46b3da)[_0x3847e8(0x200)](),PromptGroup[_0x3847e8(0x1cf)](_0x68a513)[_0x3847e8(0x200)]()]),_0x4cf871=_0x5e8ac0,_0x230b4a=_0xc8fb9b[_0x3847e8(0x244)]>0x0?_0xc8fb9b[0x0][_0x3847e8(0x221)]:0x0;return{'promptGroups':_0x4cf871,'pageNumber':_0x1e5015[_0x3847e8(0x223)](),'pageSize':_0x195057[_0x3847e8(0x223)](),'pages':Math[_0x3847e8(0x22f)](_0x230b4a/_0x195057)[_0x3847e8(0x223)]()};}catch(_0xc41d8d){if(_0x1b19c5[_0x3847e8(0x1da)]!==_0x1b19c5['nXsHs'])return console[_0x3847e8(0x1e2)](_0x1b19c5['CSdcI'],_0xc41d8d),{'message':_0x3847e8(0x1c0)};else _0x46196f=!![],delete _0xebf194[_0x3847e8(0x205)];}};module[_0x3a4228(0x240)]={'getPromptGroups':getPromptGroups,'getAllPromptGroups':getAllPromptGroups,'createPromptGroup':async _0x2e31af=>{const _0x4fcd20=_0x3a4228,_0x324c02={'JtgCG':_0x4fcd20(0x22a),'qzhOh':_0x4fcd20(0x1b0)};try{const {prompt:_0x2c0c57,group:_0x58f82f,author:_0x33a997,authorName:_0x4a2caf}=_0x2e31af;let _0x2933e0=await PromptGroup[_0x4fcd20(0x23d)]({..._0x58f82f,'author':_0x33a997,'authorName':_0x4a2caf,'productionId':null},{'$setOnInsert':{..._0x58f82f,'author':_0x33a997,'authorName':_0x4a2caf,'productionId':null}},{'new':!![],'upsert':!![]})[_0x4fcd20(0x1c5)]()[_0x4fcd20(0x206)](_0x324c02['JtgCG'])[_0x4fcd20(0x200)]();const _0x2137db=await Prompt[_0x4fcd20(0x23d)]({..._0x2c0c57,'author':_0x33a997,'groupId':_0x2933e0[_0x4fcd20(0x218)]},{'$setOnInsert':{..._0x2c0c57,'author':_0x33a997,'groupId':_0x2933e0['_id']}},{'new':!![],'upsert':!![]})[_0x4fcd20(0x1c5)]()[_0x4fcd20(0x206)](_0x4fcd20(0x22a))[_0x4fcd20(0x200)]();return _0x2933e0=await PromptGroup[_0x4fcd20(0x1fa)](_0x2933e0[_0x4fcd20(0x218)],{'productionId':_0x2137db[_0x4fcd20(0x218)]},{'new':!![]})['lean']()[_0x4fcd20(0x206)](_0x4fcd20(0x22a))[_0x4fcd20(0x200)](),{'prompt':_0x2137db,'group':{..._0x2933e0,'productionPrompt':{'prompt':_0x2137db[_0x4fcd20(0x1bd)]}}};}catch(_0x4dc3b8){logger[_0x4fcd20(0x1e2)](_0x324c02['qzhOh'],_0x4dc3b8);throw new Error(_0x324c02[_0x4fcd20(0x220)]);}},'savePrompt':async _0x8ac071=>{const _0x5673c5=_0x3a4228,_0x4bdea7={'xWdwi':_0x5673c5(0x20e),'gUNdq':_0x5673c5(0x23e),'KLHdA':_0x5673c5(0x1b8),'mcXDi':function(_0x4341d5,_0xe2c459){return _0x4341d5!==_0xe2c459;},'mveLt':_0x5673c5(0x210),'kpPDy':_0x5673c5(0x231),'EFSlv':'Error\x20saving\x20prompt'};try{if(_0x4bdea7[_0x5673c5(0x1e4)](_0x4bdea7[_0x5673c5(0x21d)],_0x5673c5(0x1e7))){const {prompt:_0x1d716c,author:_0xcc9afc}=_0x8ac071,_0x3cd824={..._0x1d716c,'author':_0xcc9afc};let _0x4df917;try{if(_0x4bdea7['mcXDi'](_0x5673c5(0x1d6),_0x5673c5(0x1d6)))return[{'$match':_0x2fbb23},{'$sort':{'createdAt':-0x1}},{'$skip':_0xca178},{'$limit':_0x51eb1e},{'$lookup':{'from':_0x4bdea7[_0x5673c5(0x1c9)],'localField':_0x4bdea7[_0x5673c5(0x237)],'foreignField':'_id','as':'productionPrompt'}},{'$unwind':{'path':_0x5673c5(0x1e1),'preserveNullAndEmptyArrays':!![]}},{'$project':{'name':0x1,'numberOfGenerations':0x1,'oneliner':0x1,'category':0x1,'projectIds':0x1,'productionId':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'productionPrompt.prompt':0x1}}];else _0x4df917=await Prompt[_0x5673c5(0x1dd)](_0x3cd824);}catch(_0x5b53eb){if(_0x5b53eb?.[_0x5673c5(0x224)]?.[_0x5673c5(0x21a)](_0x5673c5(0x23f)))await Prompt['db'][_0x5673c5(0x1df)](_0x5673c5(0x20e))[_0x5673c5(0x1e9)](_0x5673c5(0x23f));else throw _0x5b53eb;_0x4df917=await Prompt[_0x5673c5(0x1dd)](_0x3cd824);}return{'prompt':_0x4df917};}else return _0x5ebfc4[_0x5673c5(0x1e2)](_0x4bdea7[_0x5673c5(0x1f7)],_0x1fa007),{'message':_0x4bdea7[_0x5673c5(0x1f7)]};}catch(_0x5cec8b){return _0x4bdea7['mcXDi'](_0x4bdea7[_0x5673c5(0x1ff)],_0x5673c5(0x231))?(_0x50881e[_0x5673c5(0x1e2)](_0x5673c5(0x1c0),_0x4e4b93),{'message':_0x5673c5(0x1c0)}):(logger['error'](_0x4bdea7[_0x5673c5(0x1f8)],_0x5cec8b),{'message':_0x4bdea7['EFSlv']});}},'getPrompts':async _0x5b81e3=>{const _0x1b8f2b=_0x3a4228,_0xabe54c={'cTYwk':function(_0xa7a781,_0x1ca48a){return _0xa7a781===_0x1ca48a;},'CnemM':_0x1b8f2b(0x239),'vBbCD':'Error\x20getting\x20prompts'};try{return await Prompt[_0x1b8f2b(0x227)](_0x5b81e3)[_0x1b8f2b(0x23a)]({'createdAt':-0x1})[_0x1b8f2b(0x1c5)]();}catch(_0x4a1be2){if(_0xabe54c['cTYwk'](_0xabe54c[_0x1b8f2b(0x216)],_0x1b8f2b(0x1ee)))throw new _0x334f5c(_0x1b8f2b(0x20c));else return logger[_0x1b8f2b(0x1e2)](_0xabe54c[_0x1b8f2b(0x1c2)],_0x4a1be2),{'message':_0x1b8f2b(0x1ef)};}},'getPrompt':async _0x4d68d6=>{const _0x382800=_0x3a4228,_0x380b31={'pMzrj':_0x382800(0x1de)};try{return _0x4d68d6[_0x382800(0x1f0)]&&(_0x4d68d6[_0x382800(0x1f0)]=new ObjectId(_0x4d68d6[_0x382800(0x1f0)])),await Prompt[_0x382800(0x1ea)](_0x4d68d6)[_0x382800(0x1c5)]();}catch(_0x58bcae){return logger[_0x382800(0x1e2)](_0x380b31[_0x382800(0x1b7)],_0x58bcae),{'message':_0x382800(0x1de)};}},'getRandomPromptGroups':async _0x2461d5=>{const _0x4fd293=_0x3a4228,_0xf0e21b={'VwZjL':_0x4fd293(0x23b),'cWrtJ':_0x4fd293(0x1c0)};try{const _0x51487d=await PromptGroup[_0x4fd293(0x1cf)]([{'$match':{'category':{'$ne':''}}},{'$group':{'_id':_0xf0e21b[_0x4fd293(0x22e)],'promptGroup':{'$first':'$$ROOT'}}},{'$replaceRoot':{'newRoot':_0x4fd293(0x21c)}},{'$sample':{'size':+_0x2461d5['limit']+ +_0x2461d5[_0x4fd293(0x1ec)]}},{'$skip':+_0x2461d5[_0x4fd293(0x1ec)]},{'$limit':+_0x2461d5[_0x4fd293(0x1d3)]}]);return{'prompts':_0x51487d};}catch(_0x8fc35a){return logger[_0x4fd293(0x1e2)](_0xf0e21b[_0x4fd293(0x1ae)],_0x8fc35a),{'message':_0x4fd293(0x1c0)};}},'getPromptGroupsWithPrompts':async _0x2827eb=>{const _0x263500=_0x3a4228,_0x8076f3={'njGCU':_0x263500(0x20e)};try{return await PromptGroup[_0x263500(0x1ea)](_0x2827eb)[_0x263500(0x215)]({'path':_0x8076f3['njGCU'],'select':_0x263500(0x20b)})[_0x263500(0x206)](_0x263500(0x20b))[_0x263500(0x1c5)]();}catch(_0x534b39){return logger[_0x263500(0x1e2)](_0x263500(0x1c0),_0x534b39),{'message':'Error\x20getting\x20prompt\x20groups'};}},'getPromptGroup':async _0x398bf0=>{const _0x2c32f0=_0x3a4228,_0x3f1885={'JKkRc':_0x2c32f0(0x1cb)};try{return await PromptGroup[_0x2c32f0(0x1ea)](_0x398bf0)[_0x2c32f0(0x1c5)]();}catch(_0x88deb1){return logger['error'](_0x3f1885[_0x2c32f0(0x235)],_0x88deb1),{'message':_0x3f1885[_0x2c32f0(0x235)]};}},'deletePrompt':async({promptId:_0x46b1c7,groupId:_0x1a479f,author:_0x1e4175,role:_0x45077b})=>{const _0x3a9644=_0x3a4228,_0x314337={'nPqFy':function(_0x59e2e0,_0xa9246a){return _0x59e2e0===_0xa9246a;},'svRCg':function(_0x9b08e8,_0x89792b){return _0x9b08e8===_0x89792b;},'mIOxo':_0x3a9644(0x1be),'EwoAI':_0x3a9644(0x213),'uSQfl':_0x3a9644(0x203),'fPNTS':_0x3a9644(0x1d0),'PbvjZ':function(_0x237d16,_0x537cd3){return _0x237d16-_0x537cd3;}},_0x599fb5={'_id':_0x46b1c7,'groupId':_0x1a479f,'author':_0x1e4175};_0x314337[_0x3a9644(0x1cd)](_0x45077b,SystemRoles[_0x3a9644(0x22c)])&&delete _0x599fb5[_0x3a9644(0x229)];const {deletedCount:_0x44f56c}=await Prompt[_0x3a9644(0x1ba)](_0x599fb5);if(_0x44f56c===0x0)throw new Error(_0x3a9644(0x1fd));const _0xcf587e=await Prompt['find']({'groupId':_0x1a479f})[_0x3a9644(0x206)](_0x3a9644(0x218))['sort']({'createdAt':0x1})[_0x3a9644(0x1c5)]();if(_0x314337[_0x3a9644(0x22b)](_0xcf587e[_0x3a9644(0x244)],0x0)){if(_0x314337[_0x3a9644(0x1bc)]!==_0x314337[_0x3a9644(0x222)])return await PromptGroup[_0x3a9644(0x1ba)]({'_id':_0x1a479f}),await removeGroupFromAllProjects(_0x1a479f),{'prompt':_0x314337[_0x3a9644(0x1c7)],'promptGroup':{'message':_0x314337[_0x3a9644(0x1af)],'id':_0x1a479f}};else _0x50dfbc[_0x3a9644(0x205)]='';}else{const _0x39caff=await PromptGroup['findById'](_0x1a479f)['lean']();return _0x39caff['productionId']['toString']()===_0x46b1c7['toString']()&&await PromptGroup[_0x3a9644(0x1c1)]({'_id':_0x1a479f},{'productionId':_0xcf587e[_0x314337[_0x3a9644(0x236)](_0xcf587e[_0x3a9644(0x244)],0x1)]['_id']}),{'prompt':_0x314337['uSQfl']};}},'updatePromptGroup':async(_0x8545ff,_0x36457e)=>{const _0x32fcb1=_0x3a4228,_0x3bb87c={'qOchN':function(_0xf95401,_0x267ad2,_0x59144c){return _0xf95401(_0x267ad2,_0x59144c);}};try{const _0x177a01={};if(_0x36457e[_0x32fcb1(0x1d1)]){for(const _0x14227a of _0x36457e[_0x32fcb1(0x1d1)]){await _0x3bb87c[_0x32fcb1(0x204)](removeGroupIdsFromProject,_0x14227a,[_0x8545ff[_0x32fcb1(0x218)]]);}_0x177a01['$pull']={'projectIds':{'$in':_0x36457e[_0x32fcb1(0x1d1)]}},delete _0x36457e[_0x32fcb1(0x1d1)];}if(_0x36457e[_0x32fcb1(0x211)]){for(const _0x32a215 of _0x36457e[_0x32fcb1(0x211)]){await addGroupIdsToProject(_0x32a215,[_0x8545ff['_id']]);}_0x177a01['$addToSet']={'projectIds':{'$each':_0x36457e[_0x32fcb1(0x211)]}},delete _0x36457e['projectIds'];}const _0x3fef9c={..._0x36457e,..._0x177a01},_0x13a218=await PromptGroup[_0x32fcb1(0x23d)](_0x8545ff,_0x3fef9c,{'new':!![],'upsert':![]});if(!_0x13a218)throw new Error(_0x32fcb1(0x1f9));return _0x13a218;}catch(_0x2d8879){return logger[_0x32fcb1(0x1e2)](_0x32fcb1(0x1b8),_0x2d8879),{'message':'Error\x20updating\x20prompt\x20group'};}},'makePromptProduction':async _0x13517a=>{const _0x1c4cf2=_0x3a4228,_0x433e4b={'wVuHF':function(_0x2157a8,_0x16af3c){return _0x2157a8===_0x16af3c;},'twLHz':_0x1c4cf2(0x230),'yYXYY':_0x1c4cf2(0x207)};try{const _0x4d8ace=await Prompt[_0x1c4cf2(0x242)](_0x13517a)[_0x1c4cf2(0x1c5)]();if(!_0x4d8ace){if(_0x433e4b[_0x1c4cf2(0x233)](_0x1c4cf2(0x1fe),_0x1c4cf2(0x1fe)))throw new Error(_0x1c4cf2(0x20c));else _0x591873=![],delete _0x200ebd[_0x1c4cf2(0x205)];}return await PromptGroup[_0x1c4cf2(0x1fa)](_0x4d8ace[_0x1c4cf2(0x1f0)],{'productionId':_0x4d8ace[_0x1c4cf2(0x218)]},{'new':!![]})[_0x1c4cf2(0x1c5)]()[_0x1c4cf2(0x200)](),{'message':_0x433e4b[_0x1c4cf2(0x1fc)]};}catch(_0x43bcf6){return logger[_0x1c4cf2(0x1e2)](_0x433e4b[_0x1c4cf2(0x20d)],_0x43bcf6),{'message':_0x433e4b[_0x1c4cf2(0x20d)]};}},'updatePromptLabels':async(_0x5ef293,_0x353e80)=>{const _0xbd398=_0x3a4228,_0x510f47={'Embkw':'Failed\x20to\x20delete\x20the\x20prompt','wPrmj':_0xbd398(0x1f9),'LUgzB':function(_0x43c126,_0x5e3a53){return _0x43c126===_0x5e3a53;},'pkxDQ':_0xbd398(0x1ad),'HzCls':function(_0x36caa3,_0x3050af){return _0x36caa3===_0x3050af;},'HgEcJ':_0xbd398(0x214),'jDUaz':_0xbd398(0x1c6)};try{if(_0x510f47[_0xbd398(0x1ed)](_0x510f47[_0xbd398(0x20a)],_0xbd398(0x1b2)))throw new _0x2ed9e1(_0x510f47[_0xbd398(0x209)]);else{const _0xc3e379=await Prompt[_0xbd398(0x1c1)]({'_id':_0x5ef293},{'$set':{'labels':_0x353e80}});if(_0x510f47[_0xbd398(0x1e5)](_0xc3e379[_0xbd398(0x202)],0x0))return{'message':_0xbd398(0x20c)};return{'message':_0x510f47['HgEcJ']};}}catch(_0x319f4d){if(_0x510f47['HzCls']('UUZoQ',_0xbd398(0x1d7)))return logger[_0xbd398(0x1e2)](_0xbd398(0x1c6),_0x319f4d),{'message':_0x510f47[_0xbd398(0x225)]};else throw new _0x18fbd6(_0x510f47['wPrmj']);}},'deletePromptGroup':async _0x313de9=>{const _0x1a6129=_0x3a4228,_0xda6068={'Vexgp':function(_0x752f83,_0x2fca96){return _0x752f83===_0x2fca96;},'durAn':_0x1a6129(0x1d0)};try{const _0x450c74=await PromptGroup[_0x1a6129(0x1ba)]({'_id':_0x313de9});if(_0xda6068[_0x1a6129(0x21f)](_0x450c74[_0x1a6129(0x1c3)],0x0))return{'promptGroup':'Prompt\x20group\x20not\x20found'};return await Prompt[_0x1a6129(0x1ca)]({'groupId':new ObjectId(_0x313de9)}),await removeGroupFromAllProjects(_0x313de9),{'promptGroup':_0xda6068[_0x1a6129(0x1f6)]};}catch(_0x2da40c){return logger['error'](_0x1a6129(0x1e0),_0x2da40c),{'message':_0x1a6129(0x1e0)};}}};