const _0x577663=_0x26b3;(function(_0x1e8d8b,_0x3f0a5d){const _0x2af8e7=_0x26b3,_0x4d2eb4=_0x1e8d8b();while(!![]){try{const _0x318fec=parseInt(_0x2af8e7(0x14d))/0x1+parseInt(_0x2af8e7(0x164))/0x2*(parseInt(_0x2af8e7(0x167))/0x3)+-parseInt(_0x2af8e7(0x154))/0x4+-parseInt(_0x2af8e7(0x148))/0x5*(parseInt(_0x2af8e7(0x15a))/0x6)+parseInt(_0x2af8e7(0x15e))/0x7+-parseInt(_0x2af8e7(0x156))/0x8+parseInt(_0x2af8e7(0x13e))/0x9;if(_0x318fec===_0x3f0a5d)break;else _0x4d2eb4['push'](_0x4d2eb4['shift']());}catch(_0x4850c5){_0x4d2eb4['push'](_0x4d2eb4['shift']());}}}(_0x4323,0x57ff0));import{describe,expect}from'vitest';import{getTestInstance}from'../../test-utils/test-instance';import{createAuthClient}from'../../client';import{createAuthEndpoint}from'../call';function _0x4323(){const _0x343efe=['2013767QHdDdx','http://localhost:3000/callback','toMatchObject','dOHHF','zhgvv','cDDCf','2iTemeu','/test?callbackURL=/dashboard','message','1057647yFRQbp','https://sub-domain.my-site.com','https://trusted.com.malicious.com','email','test@test.com','wbJWl','test','should\x20work\x20with\x20wildcard\x20trusted\x20origins','nPhAI','Invalid\x20callbackURL','object','should\x20allow\x20untrusted\x20origin\x20if\x20they\x20don\x27t\x20contain\x20cookies','https://trusted-site.com/path','data','http://malicious.com','user','UlzuP','shouldn\x27t\x20work\x20with\x20callback\x20url\x20with\x20double\x20slash','https://localhost:3000','password','toBe','callbackURL','/test?callbackURL=https://trusted-site.com/path','status','AeCbZ','HYQNl','rzfWF','/%5C/evil.com','session=123','GET','fMKRW','///evil.com','error','shouldn\x27t\x20allow\x20untrusted\x20origin\x20headers','$fetch','malicious.com','toBeDefined','/test','Invalid\x20redirectURL','zbOEV','http://localhost:5000/reset-password','Uqsmm','should\x20return\x20invalid\x20origin','QksgH','5268852Bnppmf','query','Nfwgj','http://sub-domain.trusted.com','cQKOv','AYOTp','forgetPassword','signIn','reyvE','YBALO','99345vZRbpk','https://google.com','Origin\x20Check','zLBgf','ClRdS','262191UWhMnR','https://trusted.com','should\x20work\x20with\x20list\x20of\x20trusted\x20origins','toBeTruthy','shouldn\x27t\x20allow\x20untrusted\x20redirectTo','/ok','*.my-site.com','1377108jtxfVk','http://localhost:3000','4675600fUshZw','AQfNY','vHGYK','SxJYc','60ByaFEH','qsYYz','value','uxuQk'];_0x4323=function(){return _0x343efe;};return _0x4323();}import{originCheck}from'./origin-check';import{z}from'zod';function _0x26b3(_0xd4f9da,_0x3df475){const _0x4323db=_0x4323();return _0x26b3=function(_0x26b39a,_0x554828){_0x26b39a=_0x26b39a-0x131;let _0x511878=_0x4323db[_0x26b39a];return _0x511878;},_0x26b3(_0xd4f9da,_0x3df475);}describe(_0x577663(0x14a),async _0x2a279e=>{const _0x4ef5ed=_0x577663,_0x4621cd={'dOHHF':_0x4ef5ed(0x155),'dBHIK':_0x4ef5ed(0x175),'zLBgf':function(_0x14ae23,_0x2a53ee){return _0x14ae23(_0x2a53ee);},'cQKOv':_0x4ef5ed(0x170),'UlzuP':function(_0x4738a4,_0x39ffaa){return _0x4738a4(_0x39ffaa);},'vqJIf':_0x4ef5ed(0x15f),'vHGYK':function(_0x5be437,_0xd93771){return _0x5be437(_0xd93771);},'Nfwgj':_0x4ef5ed(0x135),'QksgH':function(_0x328d7d,_0x3b75f1){return _0x328d7d(_0x3b75f1);},'rzfWF':_0x4ef5ed(0x183),'nvARf':function(_0x518232,_0x32c170){return _0x518232(_0x32c170);},'zbOEV':function(_0x175f41,_0xc186f){return _0x175f41(_0xc186f);},'nPhAI':'http://localhost:5000','HYQNl':function(_0x25857c,_0xac6fd6){return _0x25857c(_0xac6fd6);},'zhgvv':_0x4ef5ed(0x168),'pSBTv':function(_0x1d6078,_0x438b81){return _0x1d6078(_0x438b81);},'qsYYz':_0x4ef5ed(0x179),'Vczff':'//evil.com','YBALO':_0x4ef5ed(0x182),'keiQT':_0x4ef5ed(0x149),'AYOTp':_0x4ef5ed(0x15c),'SxJYc':_0x4ef5ed(0x152),'wbJWl':function(_0x27f033,_0x1a0f15,_0xa8aed5){return _0x27f033(_0x1a0f15,_0xa8aed5);},'fMKRW':'should\x20allow\x20trusted\x20origins','ClRdS':_0x4ef5ed(0x133),'Uqsmm':function(_0x25a2c0,_0x2bda84,_0x4e83f9){return _0x25a2c0(_0x2bda84,_0x4e83f9);},'VbYSw':'shouldn\x27t\x20allow\x20untrusted\x20origin\x20subdomains','cDDCf':_0x4ef5ed(0x172),'AeCbZ':function(_0x588361,_0x149b63,_0x2beaa9){return _0x588361(_0x149b63,_0x2beaa9);},'reyvE':_0x4ef5ed(0x151)},{customFetchImpl:_0x421953,testUser:_0x33100a}=await getTestInstance({'trustedOrigins':[_0x4621cd[_0x4ef5ed(0x16f)],_0x4ef5ed(0x14e),_0x4ef5ed(0x153)],'emailAndPassword':{'enabled':!![],async 'sendResetPassword'(_0x7244b1,_0x29399b){}},'advanced':{'disableCSRFCheck':![]}});_0x4621cd[_0x4ef5ed(0x16c)](_0x2a279e,'should\x20not\x20allow\x20untrusted\x20origins',async _0x40b57f=>{const _0x3e956f=_0x4ef5ed,_0x3869c2=createAuthClient({'baseURL':_0x4621cd[_0x3e956f(0x161)],'fetchOptions':{'customFetchImpl':_0x421953}}),_0x25235f=await _0x3869c2[_0x3e956f(0x145)][_0x3e956f(0x16a)]({'email':_0x3e956f(0x16b),'password':_0x3e956f(0x17a),'callbackURL':_0x4621cd['dBHIK']});_0x4621cd[_0x3e956f(0x14b)](expect,_0x25235f[_0x3e956f(0x132)]?.['status'])[_0x3e956f(0x17b)](0x193),expect(_0x25235f[_0x3e956f(0x132)]?.['message'])[_0x3e956f(0x17b)](_0x4621cd[_0x3e956f(0x142)]);}),_0x2a279e(_0x4621cd[_0x4ef5ed(0x185)],async _0x195845=>{const _0x44ada0=_0x4ef5ed,_0x3cb42e=_0x4621cd[_0x44ada0(0x177)](createAuthClient,{'baseURL':_0x4621cd['dOHHF'],'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x44ada0(0x155)}}}),_0x3c566a=await _0x3cb42e['signIn']['email']({'email':_0x33100a[_0x44ada0(0x16a)],'password':_0x33100a[_0x44ada0(0x17a)],'callbackURL':_0x4621cd['vqJIf']});_0x4621cd[_0x44ada0(0x158)](expect,_0x3c566a[_0x44ada0(0x174)]?.[_0x44ada0(0x176)])[_0x44ada0(0x136)]();}),_0x4621cd[_0x4ef5ed(0x16c)](_0x2a279e,_0x4621cd[_0x4ef5ed(0x14c)],async _0x184c86=>{const _0x5bf2fb=_0x4ef5ed,_0x1a806f=createAuthClient({'baseURL':'http://localhost:3000','fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x4621cd[_0x5bf2fb(0x140)],'cookie':'session=123'}}}),_0x541bb4=await _0x1a806f[_0x5bf2fb(0x145)][_0x5bf2fb(0x16a)]({'email':_0x33100a[_0x5bf2fb(0x16a)],'password':_0x33100a[_0x5bf2fb(0x17a)]});_0x4621cd[_0x5bf2fb(0x13d)](expect,_0x541bb4[_0x5bf2fb(0x132)]?.[_0x5bf2fb(0x17e)])[_0x5bf2fb(0x17b)](0x193);}),_0x4621cd[_0x4ef5ed(0x13b)](_0x2a279e,'shouldn\x27t\x20allow\x20untrusted\x20origin\x20headers\x20which\x20start\x20with\x20trusted\x20origin',async _0x1c72aa=>{const _0x5563f0=_0x4ef5ed,_0xbe3b8f=createAuthClient({'baseURL':_0x5563f0(0x155),'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x5563f0(0x169),'cookie':_0x4621cd[_0x5563f0(0x181)]}}}),_0x724ca7=await _0xbe3b8f[_0x5563f0(0x145)][_0x5563f0(0x16a)]({'email':_0x33100a[_0x5563f0(0x16a)],'password':_0x33100a[_0x5563f0(0x17a)]});_0x4621cd['vHGYK'](expect,_0x724ca7['error']?.['status'])[_0x5563f0(0x17b)](0x193);}),_0x2a279e(_0x4621cd['VbYSw'],async _0x8da867=>{const _0x37c81e=_0x4ef5ed,_0x2c43ce=createAuthClient({'baseURL':_0x37c81e(0x155),'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':'http://sub-domain.trusted.com','cookie':_0x37c81e(0x183)}}}),_0x529803=await _0x2c43ce[_0x37c81e(0x145)]['email']({'email':_0x33100a[_0x37c81e(0x16a)],'password':_0x33100a[_0x37c81e(0x17a)]});expect(_0x529803[_0x37c81e(0x132)]?.['status'])[_0x37c81e(0x17b)](0x193);}),_0x2a279e(_0x4621cd[_0x4ef5ed(0x163)],async _0x1a96bc=>{const _0x5002be=_0x4ef5ed,_0x3c7452=_0x4621cd['zLBgf'](createAuthClient,{'baseURL':_0x5002be(0x155),'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x5002be(0x141)}}}),_0x4b41c3=await _0x3c7452[_0x5002be(0x145)][_0x5002be(0x16a)]({'email':_0x33100a[_0x5002be(0x16a)],'password':_0x33100a[_0x5002be(0x17a)]});_0x4621cd['UlzuP'](expect,_0x4b41c3[_0x5002be(0x174)]?.[_0x5002be(0x176)])['toBeDefined']();}),_0x4621cd[_0x4ef5ed(0x17f)](_0x2a279e,_0x4621cd[_0x4ef5ed(0x146)],async _0x2e901e=>{const _0x199df1=_0x4ef5ed,_0x339309=_0x4621cd['nvARf'](createAuthClient,{'baseURL':_0x4621cd['dOHHF'],'fetchOptions':{'customFetchImpl':_0x421953}}),_0x31d650=await _0x339309['forgetPassword']({'email':_0x33100a[_0x199df1(0x16a)],'redirectTo':_0x199df1(0x175)});_0x4621cd[_0x199df1(0x158)](expect,_0x31d650[_0x199df1(0x132)]?.[_0x199df1(0x17e)])[_0x199df1(0x17b)](0x193),_0x4621cd[_0x199df1(0x139)](expect,_0x31d650['error']?.[_0x199df1(0x166)])['toBe'](_0x199df1(0x138));}),_0x2a279e(_0x4ef5ed(0x14f),async _0x26c0ea=>{const _0x489f65=_0x4ef5ed,_0x33af18=createAuthClient({'baseURL':_0x489f65(0x155),'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':'https://trusted.com'}}}),_0x3f1297=await _0x33af18[_0x489f65(0x144)]({'email':_0x33100a[_0x489f65(0x16a)],'redirectTo':_0x489f65(0x13a)});expect(_0x3f1297[_0x489f65(0x174)]?.['status'])[_0x489f65(0x150)]();const _0x3cf05c=await _0x33af18[_0x489f65(0x145)][_0x489f65(0x16a)]({'email':_0x33100a[_0x489f65(0x16a)],'password':_0x33100a['password'],'fetchOptions':{'query':{'currentURL':_0x4621cd['nPhAI']}}});_0x4621cd[_0x489f65(0x180)](expect,_0x3cf05c[_0x489f65(0x174)]?.[_0x489f65(0x176)])[_0x489f65(0x136)]();}),_0x4621cd[_0x4ef5ed(0x13b)](_0x2a279e,_0x4ef5ed(0x16e),async _0x3abc6d=>{const _0x72661d=_0x4ef5ed,_0x2f560f=createAuthClient({'baseURL':_0x4621cd['zhgvv'],'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x72661d(0x168)}}}),_0x41309b=await _0x2f560f['signIn']['email']({'email':_0x33100a[_0x72661d(0x16a)],'password':_0x33100a[_0x72661d(0x17a)],'callbackURL':'https://sub-domain.my-site.com/callback'});_0x4621cd['pSBTv'](expect,_0x41309b[_0x72661d(0x174)]?.['user'])[_0x72661d(0x136)]();}),_0x2a279e(_0x4ef5ed(0x178),async _0x16134f=>{const _0x2aded7=_0x4ef5ed,_0x3764ed=createAuthClient({'baseURL':_0x4621cd[_0x2aded7(0x161)],'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x4621cd[_0x2aded7(0x15b)]}}}),_0x5616c8=await _0x3764ed[_0x2aded7(0x145)]['email']({'email':_0x33100a['email'],'password':_0x33100a[_0x2aded7(0x17a)],'callbackURL':_0x4621cd['Vczff']});expect(_0x5616c8[_0x2aded7(0x132)]?.[_0x2aded7(0x17e)])[_0x2aded7(0x17b)](0x193);}),_0x2a279e('shouldn\x27t\x20work\x20with\x20callback\x20url\x20with\x20malicious',async _0x384185=>{const _0x31761d=_0x4ef5ed,_0xb9462=createAuthClient({'baseURL':_0x4621cd[_0x31761d(0x161)],'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x4621cd[_0x31761d(0x15b)]}}}),_0x15c4e7=await _0xb9462['signIn'][_0x31761d(0x16a)]({'email':_0x33100a[_0x31761d(0x16a)],'password':_0x33100a[_0x31761d(0x17a)],'callbackURL':_0x4621cd[_0x31761d(0x147)]});expect(_0x15c4e7[_0x31761d(0x132)]?.[_0x31761d(0x17e)])['toBe'](0x193);const _0x4f028d=await _0xb9462[_0x31761d(0x145)][_0x31761d(0x16a)]({'email':_0x33100a[_0x31761d(0x16a)],'password':_0x33100a[_0x31761d(0x17a)],'callbackURL':_0x31761d(0x131)});_0x4621cd[_0x31761d(0x139)](expect,_0x4f028d['error']?.['status'])[_0x31761d(0x17b)](0x193);const _0x3b4be9=await _0xb9462[_0x31761d(0x145)]['email']({'email':_0x33100a[_0x31761d(0x16a)],'password':_0x33100a[_0x31761d(0x17a)],'callbackURL':_0x31761d(0x182)});_0x4621cd[_0x31761d(0x158)](expect,_0x3b4be9['error']?.['status'])['toBe'](0x193);}),_0x2a279e('should\x20work\x20with\x20GET\x20requests',async _0x255082=>{const _0x233130=_0x4ef5ed,_0x47138d=createAuthClient({'baseURL':_0x4621cd[_0x233130(0x162)],'fetchOptions':{'customFetchImpl':_0x421953,'headers':{'origin':_0x4621cd['keiQT'],'cookie':_0x4621cd[_0x233130(0x143)]}}}),_0x26229b=await _0x47138d[_0x233130(0x134)](_0x4621cd[_0x233130(0x159)]);expect(_0x26229b[_0x233130(0x174)])[_0x233130(0x160)]({'ok':!![]});});}),describe('origin\x20check\x20middleware',async _0x8f6654=>{const _0xb10cf9=_0x577663,_0x2ced43={'uxuQk':'https://trusted-site.com','Sebcd':_0xb10cf9(0x184),'AQfNY':function(_0x210425,_0x3156e0){return _0x210425(_0x3156e0);},'nBfSU':_0xb10cf9(0x173),'mxaEH':'/verify-email?callbackURL=https://malicious-site.com&token=xyz'};_0x8f6654(_0xb10cf9(0x13c),async()=>{const _0x334bd6=_0xb10cf9,{client:_0x309b43}=await getTestInstance({'trustedOrigins':[_0x2ced43[_0x334bd6(0x15d)]],'plugins':[{'id':_0x334bd6(0x16d),'endpoints':{'test':createAuthEndpoint(_0x334bd6(0x137),{'method':_0x2ced43['Sebcd'],'query':z[_0x334bd6(0x171)]({'callbackURL':z['string']()}),'use':[_0x2ced43[_0x334bd6(0x157)](originCheck,_0x21422d=>_0x21422d[_0x334bd6(0x13f)][_0x334bd6(0x17c)])]},async _0xe1d1a1=>{const _0x4b2419=_0x334bd6;return _0xe1d1a1[_0x4b2419(0x13f)]['callbackURL'];})}}]}),_0x189dc8=await _0x309b43[_0x334bd6(0x134)]('/test?callbackURL=https://malicious-site.com');expect(_0x189dc8[_0x334bd6(0x132)]?.[_0x334bd6(0x17e)])[_0x334bd6(0x17b)](0x193);const _0x39daac=await _0x309b43['$fetch'](_0x334bd6(0x165));expect(_0x39daac[_0x334bd6(0x174)])[_0x334bd6(0x17b)]('/dashboard');const _0x2c3872=await _0x309b43[_0x334bd6(0x134)](_0x334bd6(0x17d));expect(_0x2c3872['data'])[_0x334bd6(0x17b)](_0x2ced43['nBfSU']);const _0x34fc40=await _0x309b43[_0x334bd6(0x134)](_0x2ced43['mxaEH']);expect(_0x34fc40[_0x334bd6(0x132)]?.[_0x334bd6(0x17e)])[_0x334bd6(0x17b)](0x193);});});