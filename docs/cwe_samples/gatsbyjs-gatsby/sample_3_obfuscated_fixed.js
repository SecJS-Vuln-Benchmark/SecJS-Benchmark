'use strict';const _0x1a6293=_0x59df;function _0x174f(){const _0x1d6695=['../package.json','bEPVK','setFailed','6mnnAWC','PR\x20contains\x20non\x20dependabot\x20commits,\x20skipping.','dXYWO','Target\x20specified\x20does\x20not\x20match\x20to\x20PR,\x20skipping.','./log','context','ref','head','getPullRequest','pXXdS','login','getPullRequestDiff','./verifyCommitSignatures','uvMhU','CmkTi','PfZuC','378048UKKHml','639916eavwrV','message','approvePullRequest','number','raw','author','name','108pdOPuH','186124vWWeSt','gVjgZ','mergePullRequest','length','#how-to-upgrade-from-2x-to-new-3x','Dependabot\x20merge\x20completed','title','rwhAj','hZNrV','2761983PlOBTb','This\x20action\x20must\x20be\x20used\x20in\x20the\x20context\x20of\x20a\x20Pull\x20Request\x20or\x20with\x20a\x20Pull\x20Request\x20number','93784SMTgLM','bVqNY','1195qeJSmV','yJIkQ','10yxUkTt','7170KMJiRG','./github-client','Approving\x20only','\x20major\x20release.\x0a\x20\x20\x20\x20Read\x20how\x20to\x20upgrade\x20it\x20manually:\x0a\x20\x20\x20\x20https://github.com/fastify/','wWmFT','exports','jrsuM','every','Not\x20a\x20dependabot\x20PR,\x20skipping.','@actions/github','map','payload','./getDependabotDetails','./moduleVersionChanges','exec','17123095xZxTBr','any','Cannot\x20automerge\x20','insert','@actions/core'];_0x174f=function(){return _0x1d6695;};return _0x174f();}(function(_0x3419c1,_0x32448f){const _0x3beb2c=_0x59df,_0x137957=_0x3419c1();while(!![]){try{const _0x4ce2d4=-parseInt(_0x3beb2c(0xa6))/0x1+-parseInt(_0x3beb2c(0x9d))/0x2*(parseInt(_0x3beb2c(0x8d))/0x3)+parseInt(_0x3beb2c(0x9e))/0x4+parseInt(_0x3beb2c(0x73))/0x5*(-parseInt(_0x3beb2c(0x76))/0x6)+-parseInt(_0x3beb2c(0xaf))/0x7+-parseInt(_0x3beb2c(0xb1))/0x8*(parseInt(_0x3beb2c(0xa5))/0x9)+-parseInt(_0x3beb2c(0x75))/0xa*(-parseInt(_0x3beb2c(0x85))/0xb);if(_0x4ce2d4===_0x32448f)break;else _0x137957['push'](_0x137957['shift']());}catch(_0x10592b){_0x137957['push'](_0x137957['shift']());}}}(_0x174f,0x50f52));const core=require(_0x1a6293(0x89)),github=require(_0x1a6293(0x7f)),semverDiff=require('semver/functions/diff'),semverCoerce=require('semver/functions/coerce'),toolkit=require('actions-toolkit'),packageInfo=require(_0x1a6293(0x8a)),{githubClient}=require(_0x1a6293(0x77)),{logInfo,logWarning,logError}=require(_0x1a6293(0x91)),{isValidSemver,isCommitHash,getInputs,getPackageName}=require('./util'),{targetOptions}=require('./getTargetInput'),{getModuleVersionChanges,checkModuleVersionChanges}=require(_0x1a6293(0x83)),{verifyCommits}=require(_0x1a6293(0x99)),{dependabotAuthor}=require(_0x1a6293(0x82)),{GITHUB_TOKEN,MERGE_METHOD,EXCLUDE_PKGS,MERGE_COMMENT,APPROVE_ONLY,TARGET,PR_NUMBER}=getInputs();function _0x59df(_0xf66cad,_0x2c39a5){const _0x174f21=_0x174f();return _0x59df=function(_0x59dfe0,_0x426e11){_0x59dfe0=_0x59dfe0-0x72;let _0x52a2f0=_0x174f21[_0x59dfe0];return _0x52a2f0;},_0x59df(_0xf66cad,_0x2c39a5);}module[_0x1a6293(0x7b)]=async function run(){const _0x1a04c6=_0x1a6293,_0x5b8fad={'bEPVK':_0x1a04c6(0x7e),'PfZuC':_0x1a04c6(0x9a),'jrsuM':_0x1a04c6(0xb0),'pXXdS':function(_0x382a23,_0x4a10a2){return _0x382a23(_0x4a10a2);},'gVjgZ':_0x1a04c6(0x72),'HPYlf':'PR\x20contains\x20invalid\x20dependabot\x20commit\x20signatures,\x20skipping.','tecXs':_0x1a04c6(0xad),'wWmFT':_0x1a04c6(0x9b),'PsXfV':_0x1a04c6(0x78),'dXYWO':_0x1a04c6(0xab)};try{toolkit['logActionRefWarning']();const {pull_request:_0x1e3742}=github[_0x1a04c6(0x92)][_0x1a04c6(0x81)];if(!_0x1e3742&&!PR_NUMBER){if(_0x5b8fad[_0x1a04c6(0x9c)]===_0x1a04c6(0x9a))return logError(_0x5b8fad[_0x1a04c6(0x7c)]);else throw new _0x1713ab('Error\x20while\x20parsing\x20PR\x20title,\x20expected:\x20`bump\x20<package>\x20from\x20<old-version>\x20to\x20<new-version>`');}const _0x45ddff=githubClient(GITHUB_TOKEN),_0x4c5c55=_0x1e3742||await _0x45ddff[_0x1a04c6(0x95)](PR_NUMBER),_0x59e82e=_0x4c5c55['user']['login']===dependabotAuthor;if(!_0x59e82e)return _0x5b8fad['pXXdS'](logWarning,'Not\x20a\x20dependabot\x20PR,\x20skipping.');const _0x3b3bea=await _0x45ddff['getPullRequestCommits'](_0x4c5c55['number']);if(!_0x3b3bea[_0x1a04c6(0x7d)](_0x1763cf=>_0x1763cf[_0x1a04c6(0xa3)][_0x1a04c6(0x97)]===dependabotAuthor))return _0x5b8fad[_0x1a04c6(0x96)](logWarning,_0x1a04c6(0x8e));try{await _0x5b8fad[_0x1a04c6(0x96)](verifyCommits,_0x3b3bea);}catch{if(_0x5b8fad[_0x1a04c6(0xa7)]===_0x1a04c6(0x72))return logWarning(_0x5b8fad['HPYlf']);else{const _0x1cc22d=_0x2205d5[_0x36d759['name']][_0x1a04c6(0x88)],_0x20234c=_0x1a04c6(0x87)+_0x3c232b[_0x1a04c6(0xa4)]+'\x20'+_0x1cc22d+'\x20major\x20release.\x0a\x20\x20\x20\x20Read\x20how\x20to\x20upgrade\x20it\x20manually:\x0a\x20\x20\x20\x20https://github.com/fastify/'+_0x1dbf66[_0x1a04c6(0xa4)]+_0x1a04c6(0xaa);_0x5156e0['setFailed'](_0x20234c);return;}}const _0x52f958=await _0x45ddff[_0x1a04c6(0x98)](_0x4c5c55[_0x1a04c6(0xa1)]),_0x560dd4=getModuleVersionChanges(_0x52f958)||parsePrTitle(_0x4c5c55);if(TARGET!==targetOptions[_0x1a04c6(0x86)]){if(_0x5b8fad['tecXs']===_0x5b8fad[_0x1a04c6(0x7a)])return _0x4956e9(_0x5b8fad[_0x1a04c6(0x8b)]);else{_0x5b8fad[_0x1a04c6(0x96)](logInfo,'Checking\x20if\x20the\x20changes\x20in\x20the\x20PR\x20can\x20be\x20merged');const _0x36b4c5=checkModuleVersionChanges(_0x560dd4,TARGET);if(!_0x36b4c5)return logWarning(_0x1a04c6(0x90));}}const _0x259bf3=EXCLUDE_PKGS['filter'](_0x2f2e52=>_0x2f2e52 in _0x560dd4);if(_0x259bf3[_0x1a04c6(0xa9)]>0x0)return _0x5b8fad[_0x1a04c6(0x96)](logInfo,_0x259bf3['length']+'\x20package(s)\x20excluded:\x20'+_0x259bf3['join'](',\x20')+'.\x20Skipping.');const _0x54d8a5=_0x560dd4[packageInfo[_0x1a04c6(0xa4)]];if(_0x54d8a5&&_0x5b8fad[_0x1a04c6(0x96)](isAMajorReleaseBump,_0x54d8a5)){const _0x3d0708=_0x560dd4[packageInfo[_0x1a04c6(0xa4)]]['insert'],_0x56b94f='Cannot\x20automerge\x20'+packageInfo[_0x1a04c6(0xa4)]+'\x20'+_0x3d0708+_0x1a04c6(0x79)+packageInfo[_0x1a04c6(0xa4)]+_0x1a04c6(0xaa);core[_0x1a04c6(0x8c)](_0x56b94f);return;}await _0x45ddff[_0x1a04c6(0xa0)](_0x4c5c55[_0x1a04c6(0xa1)],MERGE_COMMENT);if(APPROVE_ONLY)return logInfo(_0x5b8fad['PsXfV']);await _0x45ddff[_0x1a04c6(0xa8)](_0x4c5c55[_0x1a04c6(0xa1)],MERGE_METHOD),_0x5b8fad['pXXdS'](logInfo,_0x5b8fad[_0x1a04c6(0x8f)]);}catch(_0x210570){core[_0x1a04c6(0x8c)](_0x210570[_0x1a04c6(0x9f)]);}};function isAMajorReleaseBump(_0x2f1f0f){const _0x169376=_0x1a6293,_0x53713a={'jdaRu':function(_0x30b7f5,_0x8fc073){return _0x30b7f5(_0x8fc073);},'yJIkQ':function(_0x3a7806,_0x4d01c9){return _0x3a7806!==_0x4d01c9;}},_0x1dd062=_0x2f1f0f['delete'],_0x19fa22=_0x2f1f0f[_0x169376(0x88)];if(isCommitHash(_0x1dd062)&&_0x53713a['jdaRu'](isCommitHash,_0x19fa22))return _0x53713a[_0x169376(0x74)]('vZXqE',_0x169376(0xae))?![]:![];const _0x2df067=semverDiff(semverCoerce(_0x1dd062),semverCoerce(_0x19fa22));return _0x2df067===targetOptions['major'];}function parsePrTitle(_0x1cb393){const _0x4a11eb=_0x1a6293,_0x592489={'ukJug':'Error\x20while\x20parsing\x20PR\x20title,\x20expected:\x20`bump\x20<package>\x20from\x20<old-version>\x20to\x20<new-version>`'},_0x56c6a4=/bump \S+ from (\S+) to (\S+)/i,_0x1d4eca=_0x56c6a4[_0x4a11eb(0x84)](_0x1cb393[_0x4a11eb(0xac)]);if(!_0x1d4eca)throw new Error(_0x592489['ukJug']);const _0x5b1150=getPackageName(_0x1cb393[_0x4a11eb(0x94)][_0x4a11eb(0x93)]),[,_0x32a573,_0x8d5e6e]=_0x1d4eca[_0x4a11eb(0x80)](_0x27683c=>_0x27683c['replace'](/`/g,'')),_0xd38b57=isValidSemver(_0x32a573)&&isValidSemver(_0x8d5e6e);return{[_0x5b1150]:{'delete':_0xd38b57?semverCoerce(_0x32a573)?.[_0x4a11eb(0xa2)]:_0x32a573,'insert':_0xd38b57?semverCoerce(_0x8d5e6e)?.[_0x4a11eb(0xa2)]:_0x8d5e6e}};}