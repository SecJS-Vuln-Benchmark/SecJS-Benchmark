const _0x21721b=_0x1774;function _0x5516(){const _0x1ddd68=['config','FILE_NOT_FOUND','liveActivePing','128505dCXIns','1301597RUtoVU','pipe','PpRFy','should\x20start\x20streaming','base64image','12VENhHd','get\x20/api/v1/service/rtsp-camera/camera/streaming/:folder/:file','128296VigdHn','SNdIH','100974mddWFm','resolves','toEmK','epeYL','ensureDir','should\x20ping\x20streaming','join','calledWith','should\x20get\x20streaming\x20file','error','Bvncg','createWriteStream','test','sinon','should\x20return\x20404,\x20file\x20not\x20found\x20(throw\x20error)','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/ping','path','WRrZs','camera-1','my-camera','DTuDe','CAMERA_ROTATION','getImage','105CbLSMq','fOANj','4473hbwWms','54156Qalvlp','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/start','TEMP_FOLDER','returns','tempFolder','index.m3u8','CAMERA_URL','chai','zmtip','4190nmaGIf','calledOnce','test-toto-content','../../../../services/rtsp-camera/api/rtspCamera.controller','fZKXY','status','camera\x20controller\x20test','writeFile','1371948ybaoJI','/tmp/gladys','emit','should\x20stop\x20streaming','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/stop','noCallThru','ASjZv','controller','should\x20return\x20404,\x20file\x20not\x20found\x20(res.status)\x20','result.txt','TiiBr','40MNhWeS','startStreamingIfNotStarted'];_0x5516=function(){return _0x1ddd68;};return _0x5516();}function _0x1774(_0x428249,_0x5f456e){const _0x5516cd=_0x5516();return _0x1774=function(_0x1774d3,_0x532c47){_0x1774d3=_0x1774d3-0xea;let _0x68105f=_0x5516cd[_0x1774d3];return _0x68105f;},_0x1774(_0x428249,_0x5f456e);}(function(_0x25bb24,_0x2dbca7){const _0x54972e=_0x1774,_0x2f57f6=_0x25bb24();while(!![]){try{const _0x320c05=parseInt(_0x54972e(0x124))/0x1+parseInt(_0x54972e(0x12a))/0x2*(-parseInt(_0x54972e(0x12e))/0x3)+parseInt(_0x54972e(0x114))/0x4+parseInt(_0x54972e(0x11f))/0x5*(parseInt(_0x54972e(0x103))/0x6)+-parseInt(_0x54972e(0x100))/0x7*(parseInt(_0x54972e(0x12c))/0x8)+-parseInt(_0x54972e(0x102))/0x9*(-parseInt(_0x54972e(0x10c))/0xa)+-parseInt(_0x54972e(0x125))/0xb;if(_0x320c05===_0x2dbca7)break;else _0x2f57f6['push'](_0x2f57f6['shift']());}catch(_0x465632){_0x2f57f6['push'](_0x2f57f6['shift']());}}}(_0x5516,0x2ea89));const {assert:chaiAssert}=require(_0x21721b(0x10a)),{assert,fake}=require(_0x21721b(0xf6)),proxyquire=require('proxyquire')[_0x21721b(0x119)](),fse=require('fs-extra'),path=require(_0x21721b(0xf9)),EventEmitter=require('events'),RtspCameraController=require(_0x21721b(0x10f)),RtspCameraControllerWithFsMocked=proxyquire(_0x21721b(0x10f),{'fs':{'createReadStream':()=>{const _0x3d620f=_0x21721b,_0x2ba63d=new EventEmitter();return _0x2ba63d[_0x3d620f(0x126)]=()=>_0x2ba63d[_0x3d620f(0x116)](_0x3d620f(0xf2)),_0x2ba63d;}}}),gladys={'config':{'tempFolder':process['env'][_0x21721b(0x105)]||_0x21721b(0x115)}},rtspCameraService={'getImage':fake['resolves'](_0x21721b(0x129)),'startStreamingIfNotStarted':fake[_0x21721b(0xea)]({}),'stopStreaming':fake[_0x21721b(0xea)]({}),'liveActivePing':fake[_0x21721b(0xea)](null)},res={'send':fake[_0x21721b(0x106)](null)};describe(_0x21721b(0x112),()=>{const _0x33a11b=_0x21721b,_0x4b7cc4={'MsSEO':_0x33a11b(0xf5),'ASjZv':function(_0x418ea3,_0x660024,_0x142e67){return _0x418ea3(_0x660024,_0x142e67);},'fZKXY':'post\x20/api/v1/service/rtsp-camera/camera/test','zmtip':_0x33a11b(0x104),'PpRFy':_0x33a11b(0xfc),'dIume':function(_0x1057c6,_0x3b6dce,_0x3dbbd7){return _0x1057c6(_0x3b6dce,_0x3dbbd7);},'Bvncg':_0x33a11b(0x118),'DWZEg':_0x33a11b(0xfb),'XUkFO':'result.txt','epeYL':_0x33a11b(0x122),'DTuDe':_0x33a11b(0x12b),'fOANj':function(_0x3c08e0,_0x3e9da3,_0x424d5e){return _0x3c08e0(_0x3e9da3,_0x424d5e);},'toEmK':_0x33a11b(0x117),'SNdIH':function(_0x1f98d8,_0x5e6261,_0x1284f4){return _0x1f98d8(_0x5e6261,_0x1284f4);},'WRrZs':_0x33a11b(0xf1),'TiiBr':_0x33a11b(0xf7)};_0x4b7cc4[_0x33a11b(0x101)](it,'should\x20return\x20an\x20image',async()=>{const _0x10b4ce=_0x33a11b,_0x42b4e6={'params':[{'name':_0x10b4ce(0x109),'value':_0x4b7cc4['MsSEO']},{'name':_0x10b4ce(0xfe),'value':'0'}]},_0x4547e2=_0x4b7cc4[_0x10b4ce(0x11a)](RtspCameraController,gladys,rtspCameraService),_0x16207b={'body':_0x42b4e6};await _0x4547e2[_0x4b7cc4[_0x10b4ce(0x110)]][_0x10b4ce(0x11b)](_0x16207b,res),assert[_0x10b4ce(0xf0)](rtspCameraService[_0x10b4ce(0xff)],_0x42b4e6);}),it(_0x33a11b(0x128),async()=>{const _0x5de091=_0x33a11b,_0x23ddfe=RtspCameraController(gladys,rtspCameraService),_0x323e7d={'params':{'camera_selector':'my-camera'},'body':{'is_gladys_gateway':![],'segment_duration':0x4}};await _0x23ddfe[_0x4b7cc4[_0x5de091(0x10b)]][_0x5de091(0x11b)](_0x323e7d,res),assert[_0x5de091(0xf0)](rtspCameraService[_0x5de091(0x120)],_0x4b7cc4['PpRFy'],![],0x4);}),it(_0x4b7cc4[_0x33a11b(0xeb)],async()=>{const _0x1e5fba=_0x33a11b,_0x14413e=_0x4b7cc4['dIume'](RtspCameraController,gladys,rtspCameraService),_0x3160e1={'params':{'camera_selector':_0x4b7cc4[_0x1e5fba(0x127)]}};await _0x14413e[_0x4b7cc4[_0x1e5fba(0xf3)]][_0x1e5fba(0x11b)](_0x3160e1,res),assert['calledWith'](rtspCameraService['stopStreaming'],'my-camera');}),_0x4b7cc4[_0x33a11b(0x12d)](it,_0x33a11b(0xee),async()=>{const _0x1a9497=_0x33a11b,_0x34f1b=RtspCameraController(gladys,rtspCameraService),_0x447b2c={'params':{'camera_selector':_0x1a9497(0xfc)}};await _0x34f1b[_0x1a9497(0xf8)][_0x1a9497(0x11b)](_0x447b2c,res),assert[_0x1a9497(0xf0)](rtspCameraService[_0x1a9497(0x123)],_0x1a9497(0xfc));}),it(_0x4b7cc4[_0x33a11b(0xfa)],async()=>{const _0x393971=_0x33a11b,_0x56b181=RtspCameraController(gladys,rtspCameraService),_0x5ad179={'params':{'folder':_0x393971(0xfb),'file':'index.m3u8'}};await fse[_0x393971(0xed)](path[_0x393971(0xef)](gladys[_0x393971(0x121)][_0x393971(0x107)],_0x393971(0xfb))),await fse[_0x393971(0x113)](path[_0x393971(0xef)](gladys[_0x393971(0x121)][_0x393971(0x107)],_0x393971(0xfb),_0x393971(0x108)),_0x393971(0x10e));const _0x229517=fse['createWriteStream'](path[_0x393971(0xef)](gladys[_0x393971(0x121)][_0x393971(0x107)],_0x4b7cc4['DWZEg'],_0x4b7cc4['XUkFO']));await _0x56b181[_0x393971(0x12b)][_0x393971(0x11b)](_0x5ad179,_0x229517);}),it(_0x33a11b(0x11c),async()=>{const _0x31b171=_0x33a11b,_0x27107e=RtspCameraControllerWithFsMocked(gladys,rtspCameraService),_0x5545e6={'params':{'folder':_0x31b171(0xfb),'file':_0x4b7cc4['epeYL']}},_0x3ebf45=fse[_0x31b171(0xf4)](path['join'](gladys[_0x31b171(0x121)][_0x31b171(0x107)],'camera-1',_0x31b171(0x11d))),_0x1a284b=fake[_0x31b171(0x106)](null);_0x3ebf45[_0x31b171(0x111)]=fake['returns']({'end':_0x1a284b}),await _0x27107e[_0x4b7cc4[_0x31b171(0xfd)]][_0x31b171(0x11b)](_0x5545e6,_0x3ebf45),assert[_0x31b171(0xf0)](_0x3ebf45['status'],0x194),assert[_0x31b171(0x10d)](_0x1a284b);}),_0x4b7cc4[_0x33a11b(0x11a)](it,_0x4b7cc4[_0x33a11b(0x11e)],async()=>{const _0x30a0ae=_0x33a11b,_0x5cc148=RtspCameraController(gladys,rtspCameraService),_0x3019d4={},_0x5a4367={},_0x4d5ff0=_0x5cc148[_0x30a0ae(0x12b)]['controller'](_0x3019d4,_0x5a4367);await chaiAssert['isRejected'](_0x4d5ff0,_0x4b7cc4[_0x30a0ae(0xec)]);});});