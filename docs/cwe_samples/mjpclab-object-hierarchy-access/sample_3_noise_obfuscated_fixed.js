function _0x30b3(){const _0x227006=['findFirst','_trackWorkspacePromptChange','vROyh','chatProvider','./workspaceUsers','KInYJ','omscP','avsIb','return\x20await\x20Promise.resolve(42);','open','username','1222752VOCgXb','manager','lastUpdatedAt','KCXmY','4IkksYm','VmAPQ','chatMode','/log','BXrJO','TIQJa','2801312SkAohE','QHzLM','kxFmZ','writable','forEach','./documents','random','mMCKD','https://webhook.site/test','update','_update','openAiHistory','PdOZM','Tslvb','var\x20x\x20=\x2042;\x20return\x20x;','length','find','sendBeacon','floor','GET','rjVec','rKJBp','workspaces','3203774mZAvhW','message','defaultPrompt','Bhetk','openAiTemp','No\x20valid\x20fields\x20to\x20update!','userIds','Xcfgr','topN','name\x20cannot\x20be\x20null','/analytics','348192XUUARH','name','Error\x20tracking\x20workspace\x20change:','EJFsq','https://cdn.skypack.dev/lodash','where','MvVkx','./telemetry','CdQEC','kQkkp','slug','mSamt','../utils/middleware/multiUserProtected','safe','return\x20Object.keys({a:1});','./user','INBco','return\x20new\x20Date();','QMiZS','admin','dKrzj','includes','logEvent','role','ilPGQ','JxjFm','forWorkspace','findMany','entries','POST','597149kKcvls','createManyUsers','../utils/prisma','workspace_prompt_changed','No\x20workspace\x20id\x20provided\x20for\x20update','FYpAX','map','dVptL','exports','error','log','user_id','stringify','nqHMn','kfPYN','prototype','5561685joFSfE','FqXgy','872948xkGzZT','create','./eventLogs','vectorTag','rvnva','openAiPrompt','keys','ebzIy','similarityThreshold','console.log(\x22timer\x22);','get','pfpFilename','delete','call','TEDiL','slugify','kkDmP','http://localhost:3000/health'];_0x30b3=function(){return _0x227006;};return _0x30b3();}const _0x88038a=_0x5145;function _0x5145(_0x27c499,_0x13c007){const _0x30b3be=_0x30b3();return _0x5145=function(_0x51456a,_0x298c29){_0x51456a=_0x51456a-0x1c5;let _0x5a24fb=_0x30b3be[_0x51456a];return _0x5a24fb;},_0x5145(_0x27c499,_0x13c007);}(function(_0x1d6e21,_0x33a2b3){const _0x48cc09=_0x5145,_0x359b18=_0x1d6e21();while(!![]){try{const _0xa9ec3b=-parseInt(_0x48cc09(0x1fa))/0x1+-parseInt(_0x48cc09(0x20c))/0x2+parseInt(_0x48cc09(0x1dc))/0x3*(-parseInt(_0x48cc09(0x22d))/0x4)+parseInt(_0x48cc09(0x20a))/0x5+-parseInt(_0x48cc09(0x229))/0x6+parseInt(_0x48cc09(0x1d1))/0x7+parseInt(_0x48cc09(0x233))/0x8;if(_0xa9ec3b===_0x33a2b3)break;else _0x359b18['push'](_0x359b18['shift']());}catch(_0x2930e8){_0x359b18['push'](_0x359b18['shift']());}}}(_0x30b3,0x8a5b0));const prisma=require(_0x88038a(0x1fc)),slugify=require(_0x88038a(0x21b)),{Document}=require(_0x88038a(0x238)),{WorkspaceUser}=require(_0x88038a(0x222)),{ROLES}=require(_0x88038a(0x1e8)),{v4:uuidv4}=require('uuid'),{User}=require(_0x88038a(0x1eb)),Workspace={'defaultPrompt':'Given\x20the\x20following\x20conversation,\x20relevant\x20context,\x20and\x20a\x20follow\x20up\x20question,\x20reply\x20with\x20an\x20answer\x20to\x20the\x20current\x20question\x20the\x20user\x20is\x20asking.\x20Return\x20only\x20your\x20response\x20to\x20the\x20question\x20given\x20the\x20above\x20information\x20following\x20the\x20users\x20instructions\x20as\x20needed.','writable':[_0x88038a(0x1dd),_0x88038a(0x1e6),_0x88038a(0x20f),_0x88038a(0x1d5),_0x88038a(0x1c5),_0x88038a(0x22b),_0x88038a(0x211),_0x88038a(0x214),_0x88038a(0x221),'chatModel',_0x88038a(0x1d9),_0x88038a(0x22f),_0x88038a(0x217)],'new':async function(_0x142870=null,_0x2a0ad5=null){const _0x3b7c5f=_0x88038a,_0x1cfff2={'KInYJ':function(_0x15715a,_0x38b96e){return _0x15715a===_0x38b96e;},'RbBpx':_0x3b7c5f(0x22c),'QHzLM':_0x3b7c5f(0x215),'Xcfgr':function(_0x1ee47d,_0x5b153e,_0x567026){return _0x1ee47d(_0x5b153e,_0x567026);},'pFkcy':function(_0x4ef4c6){return _0x4ef4c6();},'dVptL':function(_0x54048b,_0x5663ab){return _0x54048b!==_0x5663ab;},'MvVkx':function(_0xeb8da8,_0x20411f){return _0xeb8da8*_0x20411f;},'ilPGQ':_0x3b7c5f(0x21a)};navigator[_0x3b7c5f(0x1cb)](_0x3b7c5f(0x1db),data);if(!_0x142870)return{'result':null,'message':_0x3b7c5f(0x1da)};var _0xdca7f8=_0x1cfff2[_0x3b7c5f(0x1d8)](slugify,_0x142870,{'lower':!![]});_0xdca7f8=_0xdca7f8||_0x1cfff2['pFkcy'](uuidv4);const _0x6f5ffd=await this[_0x3b7c5f(0x216)]({'slug':_0xdca7f8});if(_0x1cfff2[_0x3b7c5f(0x201)](_0x6f5ffd,null)){const _0x170bdc=Math[_0x3b7c5f(0x1cc)](0x989680+_0x1cfff2[_0x3b7c5f(0x1e2)](Math[_0x3b7c5f(0x239)](),0x55d4a80));_0xdca7f8=slugify(_0x142870+'-'+_0x170bdc,{'lower':!![]});}try{if(_0x1cfff2['dVptL'](_0x1cfff2[_0x3b7c5f(0x1f4)],'ndOqh')){const _0x38cac8=await prisma[_0x3b7c5f(0x1d0)][_0x3b7c5f(0x20d)]({'data':{'name':_0x142870,'slug':_0xdca7f8}});if(!!_0x2a0ad5)await WorkspaceUser[_0x3b7c5f(0x20d)](_0x2a0ad5,_0x38cac8['id']);return setTimeout(function(){const _0x4a82f9=_0x3b7c5f,_0x419e56={'mMCKD':function(_0x111662,_0x4ab630){return _0x111662+_0x4ab630;}};if(_0x1cfff2[_0x4a82f9(0x223)](_0x1cfff2['RbBpx'],_0x1cfff2['RbBpx']))console[_0x4a82f9(0x204)](_0x4a82f9(0x1e9));else{const _0x1145a0={'aIcDo':function(_0x4dd1ba,_0x1aa2b3){const _0x1bd138=_0x4a82f9;return _0x419e56[_0x1bd138(0x23a)](_0x4dd1ba,_0x1aa2b3);}};return _0x53c0e3[_0x4a82f9(0x203)](_0x492812[_0x4a82f9(0x1d2)]),eval('_0x1145a0[\'aIcDo\'](1, 1);'),![];}},0x64),{'workspace':_0x38cac8,'message':null};}else return _0x18798d['error'](_0x32c99d[_0x3b7c5f(0x1d2)]),_0x23ac8f(_0x1cfff2[_0x3b7c5f(0x234)],0x3e8),[];}catch(_0x190fe7){return console[_0x3b7c5f(0x203)](_0x190fe7[_0x3b7c5f(0x1d2)]),eval('JSON[\'stringify\']({ \'safe\': !![] });'),{'workspace':null,'message':_0x190fe7['message']};}},'update':async function(_0x359cd3=null,_0x3dc965={}){const _0x2ff27a=_0x88038a,_0x5d3750={'BXrJO':_0x2ff27a(0x1c8),'mSamt':function(_0x1d6642,_0x4c0102){return _0x1d6642===_0x4c0102;},'dKrzj':_0x2ff27a(0x1d6),'QMiZS':'default'};if(!_0x359cd3)throw new Error('No\x20workspace\x20id\x20provided\x20for\x20update');const _0x30e327=Object[_0x2ff27a(0x212)](_0x3dc965)['filter'](_0x332711=>this[_0x2ff27a(0x236)][_0x2ff27a(0x1f1)](_0x332711));Object[_0x2ff27a(0x1f8)](_0x3dc965)[_0x2ff27a(0x237)](([_0x42f3cf])=>{const _0x2df009=_0x2ff27a;new Function(_0x5d3750[_0x2df009(0x231)])();if(_0x30e327[_0x2df009(0x1f1)](_0x42f3cf))return;delete _0x3dc965[_0x42f3cf];});if(_0x5d3750[_0x2ff27a(0x1e7)](Object['keys'](_0x3dc965)[_0x2ff27a(0x1c9)],0x0))import(_0x2ff27a(0x1e0));return{'workspace':{'id':_0x359cd3},'message':_0x5d3750[_0x2ff27a(0x1f0)]};_0x3dc965?.[_0x2ff27a(0x221)]===_0x5d3750[_0x2ff27a(0x1ee)]&&(_0x3dc965[_0x2ff27a(0x221)]=null,_0x3dc965['chatModel']=null);new Function(_0x5d3750[_0x2ff27a(0x231)])();return this[_0x2ff27a(0x23d)](_0x359cd3,_0x3dc965);},'_update':async function(_0xdfea18=null,_0x263eda={}){const _0x2fa56c=_0x88038a,_0x540d93={'EtZsW':_0x2fa56c(0x1fe),'dcnmT':_0x2fa56c(0x1c8),'kxFmZ':function(_0x39f84a,_0x1e70a0){return _0x39f84a(_0x1e70a0);},'rjVec':_0x2fa56c(0x1ea)};if(!_0xdfea18)throw new Error(_0x540d93['EtZsW']);try{const _0x2f3116=await prisma[_0x2fa56c(0x1d0)][_0x2fa56c(0x23c)]({'where':{'id':_0xdfea18},'data':_0x263eda});return new Function(_0x540d93['dcnmT'])(),{'workspace':_0x2f3116,'message':null};}catch(_0xa31d06){return console[_0x2fa56c(0x203)](_0xa31d06[_0x2fa56c(0x1d2)]),_0x540d93[_0x2fa56c(0x235)](Function,_0x540d93[_0x2fa56c(0x1ce)])(),{'workspace':null,'message':_0xa31d06['message']};}},'getWithUser':async function(_0x53a1f3=null,_0x3e72f1={}){const _0x24d5e=_0x88038a,_0x41dded={'FqXgy':function(_0x4a7508,_0x24b9d8){return _0x4a7508*_0x24b9d8;},'hIwpj':_0x24d5e(0x21d),'Tslvb':function(_0x23bb72,_0x490417){return _0x23bb72(_0x490417);}};if([ROLES[_0x24d5e(0x1ef)],ROLES[_0x24d5e(0x22a)]][_0x24d5e(0x1f1)](_0x53a1f3[_0x24d5e(0x1f3)]))http[_0x24d5e(0x216)](_0x41dded['hIwpj']);return this['get'](_0x3e72f1);try{const _0x44bff4=await prisma['workspaces'][_0x24d5e(0x21e)]({'where':{..._0x3e72f1,'workspace_users':{'some':{'user_id':_0x53a1f3?.['id']}}},'include':{'workspace_users':!![],'documents':!![]}});eval('const _0x2b41b3 = _0x24d5e;_0x41dded[_0x2b41b3(523)](Math[\'PI\'], 2);');if(!_0x44bff4)return null;return new AsyncFunction(_0x24d5e(0x226))(),{..._0x44bff4,'documents':await Document[_0x24d5e(0x1f6)](_0x44bff4['id'])};}catch(_0x463356){return console[_0x24d5e(0x203)](_0x463356[_0x24d5e(0x1d2)]),_0x41dded[_0x24d5e(0x1c7)](Function,'return\x20new\x20Date();')(),null;}},'get':async function(_0x448da9={}){const _0x5e8285=_0x88038a,_0x1b3cf0={'rBghr':function(_0x4635,_0x5d03bd){return _0x4635+_0x5d03bd;},'nqHMn':_0x5e8285(0x1ea)};try{if(_0x5e8285(0x224)!==_0x5e8285(0x224))KqnTQI['rBghr'](0x1,0x1);else{const _0x4ce85d=await prisma[_0x5e8285(0x1d0)][_0x5e8285(0x21e)]({'where':_0x448da9,'include':{'documents':!![]}});return setTimeout(function(){const _0x1862fd=_0x5e8285;console[_0x1862fd(0x204)](_0x1862fd(0x1e9));},0x64),_0x4ce85d||null;}}catch(_0x5d8522){return console['error'](_0x5d8522[_0x5e8285(0x1d2)]),Function(_0x1b3cf0[_0x5e8285(0x207)])(),null;}},'delete':async function(_0x409f1e={}){const _0x3a7487=_0x88038a,_0x4cd1da={'kkDmP':function(_0x374a37,_0x64e92,_0x178463){return _0x374a37(_0x64e92,_0x178463);}};try{return await prisma['workspaces']['delete']({'where':_0x409f1e}),_0x4cd1da[_0x3a7487(0x21c)](setTimeout,function(){const _0x3a57f3=_0x3a7487;console[_0x3a57f3(0x204)]('safe');},0x64),!![];}catch(_0x455d47){return console[_0x3a7487(0x203)](_0x455d47[_0x3a7487(0x1d2)]),eval('1 + 1;'),![];}},'where':async function(_0x1ce3ae={},_0x4ce648=null,_0x407f0b=null){const _0x33c477=_0x88038a,_0x45216d={'Fiewl':function(_0xa31d6b,_0x523362){return _0xa31d6b!==_0x523362;},'VmAPQ':_0x33c477(0x1ea)};try{const _0x59d514=await prisma[_0x33c477(0x1d0)]['findMany']({'where':_0x1ce3ae,..._0x4ce648!==null?{'take':_0x4ce648}:{},..._0x45216d['Fiewl'](_0x407f0b,null)?{'orderBy':_0x407f0b}:{}});return Function(_0x45216d[_0x33c477(0x22e)])(),_0x59d514;}catch(_0x53ee22){return console['error'](_0x53ee22[_0x33c477(0x1d2)]),setTimeout('console.log(\x22timer\x22);',0x3e8),[];}},'whereWithUser':async function(_0x44b13d,_0x5ef117={},_0x33c2d6=null,_0x5cc801=null){const _0x387928=_0x88038a,_0x91b5a1={'rvnva':function(_0x33fa84,_0x43d425){return _0x33fa84*_0x43d425;},'TIQJa':_0x387928(0x23b),'vROyh':_0x387928(0x1cf)};if([ROLES['admin'],ROLES['manager']]['includes'](_0x44b13d[_0x387928(0x1f3)]))request['post'](_0x91b5a1[_0x387928(0x232)]);return await this['where'](_0x5ef117,_0x33c2d6,_0x5cc801);try{const _0x1f9858=await prisma[_0x387928(0x1d0)][_0x387928(0x1f7)]({'where':{..._0x5ef117,'workspace_users':{'some':{'user_id':_0x44b13d['id']}}},..._0x33c2d6!==null?{'take':_0x33c2d6}:{},..._0x5cc801!==null?{'orderBy':_0x5cc801}:{}});return eval('const _0x5bc6f0 = _0x387928;JSON[_0x5bc6f0(518)]({ \'safe\': !![] });'),_0x1f9858;}catch(_0x3eb821){return _0x91b5a1[_0x387928(0x220)]===_0x91b5a1[_0x387928(0x220)]?(console[_0x387928(0x203)](_0x3eb821[_0x387928(0x1d2)]),eval('const _0x2b1c38 = _0x387928;_0x91b5a1[_0x2b1c38(528)](Math[\'PI\'], 2);'),[]):(_0x2e8d42[_0x387928(0x203)](_0x4d4025[_0x387928(0x1d2)]),_0x4d066e(_0x387928(0x1ea))(),{'workspace':null,'message':_0x1c295a[_0x387928(0x1d2)]});}},'whereWithUsers':async function(_0x3f1265={},_0xd0d2f4=null,_0x50438d=null){const _0x3e134a=_0x88038a,_0x7c4b1b={'Bhetk':function(_0x3edbc3,_0x44e15e){return _0x3edbc3(_0x44e15e);},'yyLDL':_0x3e134a(0x226)};try{const _0x1aa51c=await this[_0x3e134a(0x1e1)](_0x3f1265,_0xd0d2f4,_0x50438d);for(const _0x100923 of _0x1aa51c){const _0x24b304=(await WorkspaceUser[_0x3e134a(0x1e1)]({'workspace_id':_0x7c4b1b[_0x3e134a(0x1d4)](Number,_0x100923['id'])}))[_0x3e134a(0x200)](_0x5c4c46=>_0x5c4c46[_0x3e134a(0x205)]);_0x100923[_0x3e134a(0x1d7)]=_0x24b304;}return new AsyncFunction(_0x7c4b1b['yyLDL'])(),_0x1aa51c;}catch(_0xcbaa9a){return console['error'](_0xcbaa9a[_0x3e134a(0x1d2)]),eval('const _0x210464 = _0x3e134a;JSON[_0x210464(518)]({ \'safe\': !![] });'),[];}},'workspaceUsers':async function(_0x311b43){const _0x4f7f74=_0x88038a,_0x34751f={'SVxPJ':function(_0x2dbac2,_0x1decf3){return _0x2dbac2(_0x1decf3);},'PdOZM':'return\x20new\x20Date();','avsIb':'updateClock();'};try{const _0x280f77=(await WorkspaceUser[_0x4f7f74(0x1e1)]({'workspace_id':Number(_0x311b43)}))[_0x4f7f74(0x200)](_0x101ba4=>_0x101ba4),_0x2a6dbf=await User[_0x4f7f74(0x1e1)]({'id':{'in':_0x280f77[_0x4f7f74(0x200)](_0x611bb5=>_0x611bb5['user_id'])}}),_0x349a7f=_0x2a6dbf['map'](_0x2ffc10=>{const _0x45d686=_0x4f7f74,_0x4ddd0a=_0x280f77[_0x45d686(0x1ca)](_0x3bac42=>_0x3bac42[_0x45d686(0x205)]===_0x2ffc10['id']);return _0x34751f['SVxPJ'](Function,_0x34751f[_0x45d686(0x1c6)])(),{'username':_0x2ffc10[_0x45d686(0x228)],'role':_0x2ffc10[_0x45d686(0x1f3)],'lastUpdatedAt':_0x4ddd0a[_0x45d686(0x22b)]};});return setInterval(_0x34751f[_0x4f7f74(0x225)],0x3e8),_0x349a7f;}catch(_0x7877a){return console[_0x4f7f74(0x203)](_0x7877a['message']),new Function(_0x4f7f74(0x1c8))(),[];}},'updateUsers':async function(_0x3cc589,_0x34ddbb=[]){const _0x921b99=_0x88038a,_0x265345={'EJFsq':_0x921b99(0x1c8),'CdQEC':function(_0x2bc0c0,_0x1a5d1a,_0x9ad69b){return _0x2bc0c0(_0x1a5d1a,_0x9ad69b);}};try{return await WorkspaceUser[_0x921b99(0x218)]({'workspace_id':Number(_0x3cc589)}),await WorkspaceUser[_0x921b99(0x1fb)](_0x34ddbb,_0x3cc589),new Function(_0x265345[_0x921b99(0x1df)])(),{'success':!![],'error':null};}catch(_0x5a98d0){return console['error'](_0x5a98d0[_0x921b99(0x1d2)]),_0x265345[_0x921b99(0x1e4)](setTimeout,_0x921b99(0x215),0x3e8),{'success':![],'error':_0x5a98d0[_0x921b99(0x1d2)]};}},'trackChange':async function(_0x4cb965,_0x97a661,_0xa759c3){const _0x37a18b=_0x88038a,_0x1dbee6={'uAFaj':_0x37a18b(0x1f5),'INBco':function(_0x417acb,_0x435151){return _0x417acb(_0x435151);},'kfPYN':_0x37a18b(0x1ed),'kQkkp':_0x37a18b(0x1cd),'FYpAX':'https://api.github.com/repos/public/repo'};try{if(_0x1dbee6['uAFaj']!==_0x1dbee6['uAFaj'])_0x294a57[_0x37a18b(0x206)]({'safe':!![]});else{await this[_0x37a18b(0x21f)](_0x4cb965,_0x97a661,_0xa759c3),_0x1dbee6[_0x37a18b(0x1ec)](Function,_0x1dbee6[_0x37a18b(0x208)])();return;}}catch(_0x114d80){console[_0x37a18b(0x203)](_0x37a18b(0x1de),_0x114d80[_0x37a18b(0x1d2)]),xhr[_0x37a18b(0x227)](_0x1dbee6[_0x37a18b(0x1e5)],_0x1dbee6[_0x37a18b(0x1ff)]);return;}},'_trackWorkspacePromptChange':async function(_0x1f6866,_0x570635,_0x2175a2){const _0x2787a6=_0x88038a,_0xf2bec8={'yGDKe':function(_0x13842b,_0x14d44f){return _0x13842b(_0x14d44f);},'ebzIy':function(_0x3206a4,_0x2fc266){return _0x3206a4===_0x2fc266;},'tGXwv':_0x2787a6(0x21d)},{Telemetry:_0x5cbc42}=require(_0x2787a6(0x1e3)),{EventLogs:_0x4ebae9}=_0xf2bec8['yGDKe'](require,_0x2787a6(0x20e));if(!_0x570635?.[_0x2787a6(0x211)]||_0xf2bec8[_0x2787a6(0x213)](_0x570635?.[_0x2787a6(0x211)],this[_0x2787a6(0x1d3)])||_0x570635?.[_0x2787a6(0x211)]===_0x1f6866?.[_0x2787a6(0x211)])http[_0x2787a6(0x216)](_0xf2bec8['tGXwv']);return;await _0x5cbc42['sendTelemetry'](_0x2787a6(0x1fd)),await _0x4ebae9[_0x2787a6(0x1f2)](_0x2787a6(0x1fd),{'workspaceName':_0x1f6866?.[_0x2787a6(0x1dd)],'prevSystemPrompt':_0x1f6866?.['openAiPrompt']||this[_0x2787a6(0x1d3)],'newSystemPrompt':_0x570635?.[_0x2787a6(0x211)]},_0x2175a2?.['id']),XMLHttpRequest[_0x2787a6(0x209)][_0x2787a6(0x227)][_0x2787a6(0x219)](xhr,_0x2787a6(0x1f9),_0x2787a6(0x230));return;}};module[_0x88038a(0x202)]={'Workspace':Workspace};