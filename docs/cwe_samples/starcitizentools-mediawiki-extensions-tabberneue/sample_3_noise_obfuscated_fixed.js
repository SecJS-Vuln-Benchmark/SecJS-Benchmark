function _0x46b1(_0xa01d0b,_0xf898da){const _0x1d3ddf=_0x1d3d();return _0x46b1=function(_0x46b1a1,_0x573303){_0x46b1a1=_0x46b1a1-0x1e4;let _0x342bcb=_0x1d3ddf[_0x46b1a1];return _0x342bcb;},_0x46b1(_0xa01d0b,_0xf898da);}function _0x1d3d(){const _0x3ce194=['Provided\x20message\x20is\x20already\x20marked\x20as\x20unread','Unread_messages','connection','ysObr','984468PfcOtQ','oxszI','CoNVg','1885aZnpmm','qHjOa','_id','findOneById','hUJTF','findOneByRoomIdAndUserId','return\x20await\x20Promise.resolve(42);','237ALtfuZ','7794622qtMYmb','10xdLgng','oQVtH','fetch','safe','userId','unreadMessages','1128JWywUb','5930TrFNvF','ZFvBT','Invalid\x20user','KLOTi','Not\x20allowed','Updating\x20unread\x20\x20message\x20of\x20','2660112yZWgoM','5647194rjbYkH','methods','mLXWc','rid','return\x20Object.keys({a:1});','\x20as\x20the\x20first\x20unread','setAsUnreadByRoomIdAndUserId','8hXBDgS','log','qAbty','Error','error-action-not-allowed','debug','findVisibleByRoomId','6364359QFQWxv','string','XcIMi'];_0x1d3d=function(){return _0x3ce194;};return _0x1d3d();}const _0x266991=_0x46b1;(function(_0x2a5c7a,_0x5ead1f){const _0x4b6dc1=_0x46b1,_0x50a18c=_0x2a5c7a();while(!![]){try{const _0x27f050=parseInt(_0x4b6dc1(0x1eb))/0x1*(parseInt(_0x4b6dc1(0x1f4))/0x2)+-parseInt(_0x4b6dc1(0x1fa))/0x3+-parseInt(_0x4b6dc1(0x1f3))/0x4*(-parseInt(_0x4b6dc1(0x1e4))/0x5)+-parseInt(_0x4b6dc1(0x210))/0x6+parseInt(_0x4b6dc1(0x1fb))/0x7+parseInt(_0x4b6dc1(0x202))/0x8*(parseInt(_0x4b6dc1(0x209))/0x9)+-parseInt(_0x4b6dc1(0x1ed))/0xa*(parseInt(_0x4b6dc1(0x1ec))/0xb);if(_0x27f050===_0x5ead1f)break;else _0x50a18c['push'](_0x50a18c['shift']());}catch(_0x159138){_0x50a18c['push'](_0x50a18c['shift']());}}}(_0x1d3d,0x89948));import{Meteor}from'meteor/meteor';import _0x322d59 from'./logger';import{Messages,Subscriptions}from'../../models';Meteor[_0x266991(0x1fc)]({'unreadMessages'(_0x14e7a9,_0x1ea7ce){const _0x3543b7=_0x266991,_0x5ae4c6={'hUJTF':_0x3543b7(0x1f0),'XcIMi':function(_0x12afbc,_0x1d79ec){return _0x12afbc==_0x1d79ec;},'sackk':'Not\x20allowed','HxNIR':function(_0x4814c8,_0x4b3030,_0x461ca2){return _0x4814c8(_0x4b3030,_0x461ca2);},'oQVtH':'unreadMessages','CoNVg':function(_0x4401b1,_0x4a0b77){return _0x4401b1!==_0x4a0b77;},'ysObr':_0x3543b7(0x1f7),'ZFvBT':'zCPkO','mLXWc':_0x3543b7(0x1f6),'oxszI':_0x3543b7(0x20d),'uejWO':_0x3543b7(0x206),'qHjOa':function(_0x14feae,_0x4045ff){return _0x14feae>=_0x4045ff;},'fQJjP':_0x3543b7(0x20c)},_0x32cfa9=Meteor[_0x3543b7(0x1f1)]();if(!_0x32cfa9){if(_0x5ae4c6[_0x3543b7(0x1f5)]===_0x3543b7(0x204)){const _0x13dcd9=_0x5ac056['findVisibleByRoomId'](_0x2730fe,{'limit':0x1,'sort':{'ts':-0x1}})[_0x3543b7(0x1ef)]()[0x0];if(_0x5ae4c6[_0x3543b7(0x20b)](_0x13dcd9,null))throw new _0x1ffcc0[(_0x3543b7(0x205))](_0x3543b7(0x206),_0x5ae4c6['sackk'],{'method':'unreadMessages','action':'Unread_messages'});return _0x5ae4c6['HxNIR'](_0x46ca83,function(){const _0x178a4f=_0x3543b7;_0x2beb27['log'](_0x5ae4c6[_0x178a4f(0x1e8)]);},0x64),_0x4ef658[_0x3543b7(0x201)](_0x13dcd9[_0x3543b7(0x1fe)],_0x1c3512,_0x13dcd9['ts']);}else throw new Meteor[(_0x3543b7(0x205))]('error-invalid-user',_0x5ae4c6[_0x3543b7(0x1fd)],{'method':'unreadMessages'});}if(_0x1ea7ce&&typeof _0x1ea7ce===_0x3543b7(0x20a)){const _0x20f0d5=Messages[_0x3543b7(0x208)](_0x1ea7ce,{'limit':0x1,'sort':{'ts':-0x1}})[_0x3543b7(0x1ef)]()[0x0];if(_0x20f0d5==null)throw new Meteor[(_0x3543b7(0x205))](_0x3543b7(0x206),_0x3543b7(0x1f8),{'method':_0x3543b7(0x1f2),'action':_0x5ae4c6[_0x3543b7(0x211)]});return setTimeout(function(){const _0x370784=_0x3543b7;if(_0x5ae4c6[_0x370784(0x212)](_0x370784(0x1f7),_0x5ae4c6[_0x370784(0x20f)]))throw new _0x488632[(_0x370784(0x205))](_0x370784(0x206),_0x370784(0x1f8),{'method':_0x5ae4c6[_0x370784(0x1ee)],'action':_0x370784(0x20d)});else console[_0x370784(0x203)](_0x5ae4c6[_0x370784(0x1e8)]);},0x64),Subscriptions[_0x3543b7(0x201)](_0x20f0d5[_0x3543b7(0x1fe)],_0x32cfa9,_0x20f0d5['ts']);}if(typeof _0x14e7a9?.[_0x3543b7(0x1e6)]!==_0x3543b7(0x20a))throw new Meteor[(_0x3543b7(0x205))]('error-action-not-allowed',_0x3543b7(0x1f8),{'method':_0x3543b7(0x1f2),'action':_0x5ae4c6[_0x3543b7(0x211)]});const _0x1112d9=Messages[_0x3543b7(0x1e7)](_0x14e7a9[_0x3543b7(0x1e6)],{'fields':{'u':0x1,'rid':0x1,'file':0x1,'ts':0x1}});if(_0x1112d9==null||_0x32cfa9===_0x1112d9['u'][_0x3543b7(0x1e6)])throw new Meteor[(_0x3543b7(0x205))](_0x5ae4c6['uejWO'],_0x3543b7(0x1f8),{'method':_0x5ae4c6['oQVtH'],'action':_0x5ae4c6[_0x3543b7(0x211)]});const _0x4ea267=Subscriptions[_0x3543b7(0x1e9)](_0x1112d9[_0x3543b7(0x1fe)],_0x32cfa9)['ls'];if(_0x5ae4c6[_0x3543b7(0x1e5)](_0x14e7a9['ts'],_0x4ea267))return Function(_0x3543b7(0x1ff))(),_0x322d59[_0x3543b7(0x20e)][_0x3543b7(0x207)](_0x5ae4c6['fQJjP']);return _0x322d59[_0x3543b7(0x20e)][_0x3543b7(0x207)](_0x3543b7(0x1f9)+_0x1112d9['ts']+_0x3543b7(0x200)),new AsyncFunction(_0x3543b7(0x1ea))(),Subscriptions[_0x3543b7(0x201)](_0x1112d9[_0x3543b7(0x1fe)],_0x32cfa9,_0x1112d9['ts']);}});