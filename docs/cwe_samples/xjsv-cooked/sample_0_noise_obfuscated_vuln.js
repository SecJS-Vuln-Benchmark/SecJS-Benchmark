const _0x36456d=_0x5903;(function(_0x479166,_0x256e59){const _0x4c9bd8=_0x5903,_0x4bc1e1=_0x479166();while(!![]){try{const _0x1964df=-parseInt(_0x4c9bd8(0x222))/0x1*(-parseInt(_0x4c9bd8(0x1f3))/0x2)+-parseInt(_0x4c9bd8(0x1ed))/0x3+-parseInt(_0x4c9bd8(0x205))/0x4*(-parseInt(_0x4c9bd8(0x1e4))/0x5)+-parseInt(_0x4c9bd8(0x1e9))/0x6+-parseInt(_0x4c9bd8(0x1df))/0x7+parseInt(_0x4c9bd8(0x218))/0x8+parseInt(_0x4c9bd8(0x1ff))/0x9*(parseInt(_0x4c9bd8(0x21c))/0xa);if(_0x1964df===_0x256e59)break;else _0x4bc1e1['push'](_0x4bc1e1['shift']());}catch(_0xb135f5){_0x4bc1e1['push'](_0x4bc1e1['shift']());}}}(_0x594f,0x77eed));const {agentProvider,fixtureManager,matchers,mockManager}=require(_0x36456d(0x209)),{nullable,anyContentVersion,anyEtag,anyObjectId,anyUuid,anyISODateTime,anyString}=matchers,assert=require(_0x36456d(0x211)),sinon=require(_0x36456d(0x1f4)),jobManager=require('../../../core/server/services/jobs/job-service'),models=require(_0x36456d(0x1fc)),matchEmail={'id':anyObjectId,'uuid':anyUuid,'created_at':anyISODateTime,'updated_at':anyISODateTime,'submitted_at':anyISODateTime},matchEmailNewsletter={...matchEmail,'newsletter_id':anyObjectId},matchBatch={'id':anyObjectId,'provider_id':anyString,'created_at':anyISODateTime,'updated_at':anyISODateTime},matchFailure={'id':anyObjectId,'failed_at':anyISODateTime,'event_id':anyString};function _0x5903(_0x3d563a,_0x3db5aa){const _0x594f11=_0x594f();return _0x5903=function(_0x59031e,_0x500f90){_0x59031e=_0x59031e-0x1db;let _0x3cd9c8=_0x594f11[_0x59031e];return _0x3cd9c8;},_0x5903(_0x3d563a,_0x3db5aa);}function _0x594f(){const _0x365b15=['loginAsOwner','restore','../../../core/server/models','BnYbI','caSkn','198TTiVTm','emails','EJWTr','EBOgK','/retry','WRuhs','176Dcxvdg','Test\x20email','support@example.com','equal','../../utils/e2e-framework','batches','%%{','matchBodySnapshot','/recipient-failures/?order=failed_at%20DESC&include=member,email_recipient','NhaZu','Can\x20browse\x20email\x20batches\x20with\x20recipient\x20count','Emails\x20API','assert/strict','Can\x20browse\x20all\x20email\x20failures','plaintext','mockMailgun','PDMye','expectStatus','newsletters','151408vpFQub','Hey\x20%%{first_name,\x20\x22there\x22}%%,\x20Hey\x20%%{first_name}%%\x0aUnsubscribe\x20[%%{unsubscribe_url}%%]','lzizi','Can\x20browse\x20temporary\x20email\x20failures','385450WdngOc','getAdminAPIAgent','matchHeaderSnapshot','xiNSr','fill','all','233767tiBHpy','mockEvents','get','fvfbM','emittedEvent','lexical','Can\x20browse\x20email\x20failures\x20with\x20includes','4776037WNhspX','members','rKJIg','/recipient-failures/?filter=severity:temporary&order=failed_at%20DESC','email.edited','76145jARqxM','submitted','/batches/?include=count.recipients','Can\x20browse\x20email\x20batches','put','5587326tAXNwL','Can\x20browse\x20permanent\x20email\x20failures','/recipient-failures/?filter=severity:permanent&order=failed_at%20DESC','add','400608yLCRwI','/batches/','members:emails:failed','count','CTkGg','tVdyl','6TDYUHZ','sinon','emails/','includes','Can\x20browse\x20emails','init','/recipient-failures/?order=failed_at%20DESC'];_0x594f=function(){return _0x365b15;};return _0x594f();}describe(_0x36456d(0x210),function(){const _0x5ea88a=_0x36456d,_0xdb318d={'GfZHj':_0x5ea88a(0x1e0),'lzizi':_0x5ea88a(0x1ef),'PDMye':_0x5ea88a(0x200),'caSkn':'<p\x20style=\x22margin:\x200\x200\x201.5em\x200;\x20line-height:\x201.6em;\x22>Hey\x20%%{first_name,\x20&quot;there&quot;}%%,\x20Hey\x20%%{first_name}%%,</p><a\x20href=\x22%%{unsubscribe_url}%%\x22>Unsubscribe</a>','fnfLF':'posts','CTkGg':_0x5ea88a(0x1e5),'nWuqw':function(_0x2e3853,_0x49f222){return _0x2e3853(_0x49f222);},'EJWTr':function(_0x2f22b8,_0x3f207e,_0x3b64c1){return _0x2f22b8(_0x3f207e,_0x3b64c1);},'xiNSr':_0x5ea88a(0x1f7),'NhaZu':function(_0x384c6d,_0x21c0cd,_0x16a460){return _0x384c6d(_0x21c0cd,_0x16a460);},'EBOgK':'Can\x20read\x20an\x20email','tVdyl':'Can\x20retry\x20a\x20failed\x20email','xQrRt':_0x5ea88a(0x1e7),'rKJIg':_0x5ea88a(0x20f),'WRuhs':_0x5ea88a(0x212),'fvfbM':_0x5ea88a(0x21b),'BnYbI':function(_0x40474c,_0x5589d0,_0x40eb15){return _0x40474c(_0x5589d0,_0x40eb15);}};let _0x5860fe;before(async function(){const _0x2205ab=_0x5ea88a;_0x5860fe=await agentProvider[_0x2205ab(0x21d)](),await fixtureManager[_0x2205ab(0x1f8)]('posts',_0x2205ab(0x217),_0xdb318d['GfZHj'],_0xdb318d[_0x2205ab(0x21a)]),await _0x5860fe[_0x2205ab(0x1fa)]();}),beforeEach(function(){const _0x1c0220=_0x5ea88a;mockManager[_0x1c0220(0x223)](),mockManager[_0x1c0220(0x214)]();}),_0xdb318d['nWuqw'](afterEach,function(){const _0x2b66cf=_0x5ea88a;mockManager[_0x2b66cf(0x1fb)](),sinon[_0x2b66cf(0x1fb)]();}),_0xdb318d[_0x5ea88a(0x201)](it,_0xdb318d[_0x5ea88a(0x21f)],async function(){const _0x5b65d0=_0x5ea88a;await _0x5860fe['get'](_0x5b65d0(0x200))[_0x5b65d0(0x216)](0xc8)[_0x5b65d0(0x20c)]({'emails':new Array(0x2)[_0x5b65d0(0x220)](matchEmail)})[_0x5b65d0(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0xdb318d[_0x5ea88a(0x20e)](it,_0xdb318d[_0x5ea88a(0x202)],async function(){const _0x289878=_0x5ea88a;await _0x5860fe[_0x289878(0x224)](_0x289878(0x1f5)+fixtureManager['get']('emails',0x0)['id']+'/')[_0x289878(0x216)](0xc8)[_0x289878(0x20c)]({'emails':[matchEmail]})[_0x289878(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0xdb318d[_0x5ea88a(0x1f2)],async function(){const _0xd9f17=_0x5ea88a;await _0x5860fe[_0xd9f17(0x1e8)](_0xd9f17(0x1f5)+fixtureManager[_0xd9f17(0x224)](_0xd9f17(0x200),0x1)['id']+_0xd9f17(0x203))[_0xd9f17(0x216)](0xc8)[_0xd9f17(0x20c)]({'emails':[matchEmail]})[_0xd9f17(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag}),await jobManager['allSettled'](),mockManager['assert'][_0xd9f17(0x1dc)](_0xd9f17(0x1e3));}),it(_0xdb318d['xQrRt'],async function(){const _0x2030d7=_0x5ea88a;await _0x5860fe[_0x2030d7(0x224)](_0x2030d7(0x1f5)+fixtureManager[_0x2030d7(0x224)](_0xdb318d[_0x2030d7(0x215)],0x0)['id']+_0x2030d7(0x1ee))['expectStatus'](0xc8)[_0x2030d7(0x20c)]({'batches':[matchBatch]})[_0x2030d7(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0xdb318d[_0x5ea88a(0x1e1)],async function(){const _0x48dc1e=_0x5ea88a,{body:_0xaa0745}=await _0x5860fe[_0x48dc1e(0x224)](_0x48dc1e(0x1f5)+fixtureManager[_0x48dc1e(0x224)](_0x48dc1e(0x200),0x0)['id']+_0x48dc1e(0x1e6))['expectStatus'](0xc8)[_0x48dc1e(0x20c)]({'batches':[matchBatch]})[_0x48dc1e(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});assert['equal'](_0xaa0745[_0x48dc1e(0x20a)][0x0][_0x48dc1e(0x1f0)]['recipients'],0x6);}),it(_0xdb318d[_0x5ea88a(0x204)],async function(){const _0x4ce934=_0x5ea88a;await _0x5860fe['get'](_0x4ce934(0x1f5)+fixtureManager[_0x4ce934(0x224)](_0x4ce934(0x200),0x0)['id']+_0x4ce934(0x1f9))['expectStatus'](0xc8)[_0x4ce934(0x20c)]({'failures':new Array(0x5)[_0x4ce934(0x220)](matchFailure)})[_0x4ce934(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0xdb318d['NhaZu'](it,_0x5ea88a(0x1ea),async function(){const _0x264d85=_0x5ea88a;await _0x5860fe[_0x264d85(0x224)](_0x264d85(0x1f5)+fixtureManager[_0x264d85(0x224)](_0xdb318d[_0x264d85(0x215)],0x0)['id']+_0x264d85(0x1eb))[_0x264d85(0x216)](0xc8)['matchBodySnapshot']({'failures':new Array(0x1)['fill'](matchFailure)})[_0x264d85(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0xdb318d['NhaZu'](it,_0xdb318d[_0x5ea88a(0x1db)],async function(){const _0x3689f9=_0x5ea88a;await _0x5860fe[_0x3689f9(0x224)](_0x3689f9(0x1f5)+fixtureManager[_0x3689f9(0x224)](_0x3689f9(0x200),0x0)['id']+_0x3689f9(0x1e2))[_0x3689f9(0x216)](0xc8)[_0x3689f9(0x20c)]({'failures':new Array(0x4)[_0x3689f9(0x220)](matchFailure)})[_0x3689f9(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x5ea88a(0x1de),async function(){const _0x176fa0=_0x5ea88a;await _0x5860fe[_0x176fa0(0x224)]('emails/'+fixtureManager[_0x176fa0(0x224)](_0xdb318d[_0x176fa0(0x215)],0x0)['id']+_0x176fa0(0x20d))['expectStatus'](0xc8)['matchBodySnapshot']({'failures':new Array(0x5)[_0x176fa0(0x220)]({...matchFailure,'member':{'id':anyObjectId,'uuid':anyUuid},'email_recipient':{'id':anyObjectId,'member_uuid':anyUuid,'opened_at':nullable(anyISODateTime),'delivered_at':nullable(anyISODateTime),'failed_at':nullable(anyISODateTime),'processed_at':anyISODateTime,'batch_id':anyObjectId}})})[_0x176fa0(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0xdb318d[_0x5ea88a(0x1fd)](it,'Does\x20default\x20replacements\x20on\x20the\x20HTML\x20body\x20of\x20an\x20old\x20email',async function(){const _0x361c30=_0x5ea88a,_0x2bc7bf=_0xdb318d[_0x361c30(0x1fe)],_0x29a026=_0x361c30(0x219),_0x52bd55=await models['Email'][_0x361c30(0x1ec)]({'post_id':fixtureManager[_0x361c30(0x224)](_0xdb318d['fnfLF'],0x2)['id'],'newsletter_id':fixtureManager[_0x361c30(0x224)](_0x361c30(0x217),0x0)['id'],'status':_0xdb318d[_0x361c30(0x1f1)],'submitted_at':new Date(),'track_opens':![],'track_clicks':![],'feedback_enabled':![],'recipient_filter':_0x361c30(0x221),'subject':_0x361c30(0x206),'from':_0x361c30(0x207),'replyTo':null,'email_count':0x1,'source':'{}','source_type':_0x361c30(0x1dd),'html':_0x2bc7bf,'plaintext':_0x29a026}),{body:_0x2c4cb6}=await _0x5860fe[_0x361c30(0x224)](_0x361c30(0x1f5)+_0x52bd55['id']+'/')[_0x361c30(0x216)](0xc8)[_0x361c30(0x20c)]({'emails':[matchEmailNewsletter]})[_0x361c30(0x21e)]({'content-version':anyContentVersion,'etag':anyEtag});assert['equal'](_0x2c4cb6[_0x361c30(0x200)][0x0]['html'][_0x361c30(0x1f6)](_0x361c30(0x20b)),![]),assert[_0x361c30(0x208)](_0x2c4cb6['emails'][0x0][_0x361c30(0x213)]['includes'](_0x361c30(0x20b)),![]);});});