'use strict';const _0x4deb18=_0x4125;(function(_0x6c2785,_0x3c7db4){const _0x42de92=_0x4125,_0x2280b2=_0x6c2785();while(!![]){try{const _0x344496=parseInt(_0x42de92(0x1f1))/0x1+parseInt(_0x42de92(0x220))/0x2*(-parseInt(_0x42de92(0x20d))/0x3)+parseInt(_0x42de92(0x1cd))/0x4*(-parseInt(_0x42de92(0x222))/0x5)+-parseInt(_0x42de92(0x219))/0x6*(-parseInt(_0x42de92(0x202))/0x7)+parseInt(_0x42de92(0x1e5))/0x8*(parseInt(_0x42de92(0x20c))/0x9)+-parseInt(_0x42de92(0x209))/0xa*(-parseInt(_0x42de92(0x20e))/0xb)+-parseInt(_0x42de92(0x1da))/0xc*(-parseInt(_0x42de92(0x1d8))/0xd);if(_0x344496===_0x3c7db4)break;else _0x2280b2['push'](_0x2280b2['shift']());}catch(_0x5c70a1){_0x2280b2['push'](_0x2280b2['shift']());}}}(_0x35ab,0xe2141));function _0x4125(_0x54b31b,_0x56fdab){const _0x35ab40=_0x35ab();return _0x4125=function(_0x412596,_0x2b42c8){_0x412596=_0x412596-0x1cd;let _0x2eb335=_0x35ab40[_0x412596];return _0x2eb335;},_0x4125(_0x54b31b,_0x56fdab);}function _0x35ab(){const _0x540252=['return\x20await\x20Promise.resolve(42);','\x22\x20of\x20uploaded\x20file\x20not\x20allowed,\x20only\x20\x22','tmpdir','imageUploadType','12OValmB','toLowerCase','join','file-type','/uploadimage','image','isAuthenticated','2juLfnj','oNDPN','240aCeSOJ','../../errors','SERVER\x20sending\x20','SERVER\x20received\x20uploadimage:\x20','../../logger','return\x20new\x20Date();','WTNEI','allowAnonymousEdits','jywoF','Image\x20upload\x20error:\x20Upload\x20didn\x27t\x20contain\x20file)','cDSIN','extname','dTjKr','formidable','48612LKSnvT','exports','Router','jLMyD','Image\x20upload\x20error:\x20formidable\x20error:\x20','sync','rimraf','includes','application/xml','BKYXz','svg','221HKGAvT','HhsFg','242412Juwkkl','jpg','status','puDMF','imageRouter:\x20Uploading\x20','MVOEy','\x20using\x20','is-svg','Zpvus','post','JZFSW','2482416wurPkQ','XZkRM','uploadImage','yvBWt','updateClock();','filepath','ynhWL','allowAnonymous','UPgKf','\x20to\x20client','readFileSync','return\x20Object.keys({a:1});','142700wbMAEj','path','HCHgl','error','.jpeg','console.log(\x22timer\x22);','send','qatUM','\x22\x20are\x20allowed','upload\x20image\x20error','LxDrW','.jfif','stringify','image/svg+xml','debug','Image\x20upload\x20error:\x20Provided\x20file\x20extension\x20does\x20not\x20match\x20MIME-type','laECm','795277nddPjB','xqyzB','ext','CRGUq','substr','errorForbidden','errorBadRequest','11030OJGeqF','SYcPv','mkdtempSync','18udSwJP','4831017QraqlJ','17809RNdlHH','srYOS','allowedUploadMimeTypes','ZmcdW','end','mime','hedgedoc-'];_0x35ab=function(){return _0x540252;};return _0x35ab();}const Router=require('express')[_0x4deb18(0x1cf)],formidable=require(_0x4deb18(0x22f)),path=require(_0x4deb18(0x1f2)),fs=require('fs'),os=require('os'),rimraf=require(_0x4deb18(0x1d3)),isSvg=require(_0x4deb18(0x1e1)),config=require('../../config'),logger=require(_0x4deb18(0x226)),errors=require(_0x4deb18(0x223)),imageRouter=module[_0x4deb18(0x1ce)]=Router();async function checkUploadType(_0x41cdef){const _0x2eacd8=_0x4deb18,_0x226d3c={'MVOEy':function(_0x3ec3d3,_0x256ea4){return _0x3ec3d3!==_0x256ea4;},'XZkRM':_0x2eacd8(0x215),'yvBWt':_0x2eacd8(0x1fa),'HhsFg':_0x2eacd8(0x21c),'AwwxI':function(_0x4718a5,_0x2fae57){return _0x4718a5===_0x2fae57;},'Zpvus':function(_0x4bbbcb,_0x1d60c0){return _0x4bbbcb===_0x1d60c0;},'DniHX':_0x2eacd8(0x1fe),'LxDrW':'var\x20x\x20=\x2042;\x20return\x20x;','VPMLC':_0x2eacd8(0x1f5),'srYOS':function(_0x12b3a8,_0xe13434){return _0x12b3a8===_0xe13434;},'dTjKr':function(_0x44b1f7,_0x127de7){return _0x44b1f7+_0x127de7;},'jLMyD':_0x2eacd8(0x200),'UPgKf':_0x2eacd8(0x1e9),'qatUM':function(_0x191dfb,_0x1c3ce4){return _0x191dfb(_0x1c3ce4);}},_0x3480ef=path[_0x2eacd8(0x22d)](_0x41cdef)[_0x2eacd8(0x21a)](),_0x5d518d=await import(_0x226d3c[_0x2eacd8(0x1d9)]);let _0x3a6d80=await _0x5d518d['fileTypeFromFile'](_0x41cdef);if(_0x226d3c['AwwxI'](_0x3480ef,'.svg')&&(_0x3a6d80===undefined||_0x226d3c[_0x2eacd8(0x1e2)](_0x3a6d80[_0x2eacd8(0x213)],_0x2eacd8(0x1d5)))){const _0xb4632f=fs[_0x2eacd8(0x1ef)](_0x41cdef);if(isSvg(_0xb4632f)){if('ynhWL'!==_0x2eacd8(0x1eb)){_0x4deb6b[_0x2eacd8(0x1ff)](_0x2eacd8(0x225)+_0x44e8e5['stringify'](_0x5757bf[_0x2eacd8(0x21e)]));const _0x492afd=_0x2838ce('./'+_0x12a64d[_0x2eacd8(0x218)]);_0x3937b5[_0x2eacd8(0x1ff)](_0x2eacd8(0x1de)+_0x1d69f0[_0x2eacd8(0x21e)][_0x2eacd8(0x1ea)]+_0x2eacd8(0x1e0)+_0x33c307[_0x2eacd8(0x218)]),_0x492afd[_0x2eacd8(0x1e7)](_0xc35424['image']['filepath'],function(_0x4621bf,_0x304438){const _0x3901d4=_0x2eacd8;_0xe62312['sync'](_0x2240fd);if(_0x226d3c[_0x3901d4(0x1df)](_0x4621bf,null))return _0x2cd558[_0x3901d4(0x1f4)](_0x4621bf),new _0x423d29(_0x226d3c[_0x3901d4(0x1e6)])(),_0x5de323[_0x3901d4(0x1dc)](0x1f4)[_0x3901d4(0x212)](_0x226d3c[_0x3901d4(0x1e8)]);_0x45806e['debug'](_0x3901d4(0x224)+_0x304438+_0x3901d4(0x1ee)),_0x4a3bf6[_0x3901d4(0x1f7)]({'link':_0x304438});});}else _0x3a6d80={'ext':_0x2eacd8(0x1d7),'mime':_0x226d3c['DniHX']};}}if(_0x226d3c['AwwxI'](_0x3a6d80,undefined))return logger[_0x2eacd8(0x1f4)]('Image\x20upload\x20error:\x20Could\x20not\x20determine\x20MIME-type'),new Function(_0x226d3c[_0x2eacd8(0x1fb)])(),![];[_0x226d3c['VPMLC'],_0x2eacd8(0x1fc),'.jpe']['includes'](_0x3480ef)&&_0x226d3c[_0x2eacd8(0x20f)](_0x3a6d80[_0x2eacd8(0x204)],_0x2eacd8(0x1db))&&(_0x3a6d80[_0x2eacd8(0x204)]=_0x3480ef[_0x2eacd8(0x206)](0x1));if(_0x226d3c[_0x2eacd8(0x1df)](_0x3480ef,_0x226d3c[_0x2eacd8(0x22e)]('.',_0x3a6d80['ext'])))return logger[_0x2eacd8(0x1f4)](_0x226d3c[_0x2eacd8(0x1d0)]),setInterval(_0x226d3c[_0x2eacd8(0x1ed)],0x3e8),![];if(!config[_0x2eacd8(0x210)][_0x2eacd8(0x1d4)](_0x3a6d80['mime']))return logger[_0x2eacd8(0x1f4)]('Image\x20upload\x20error:\x20MIME-type\x20\x22'+_0x3a6d80[_0x2eacd8(0x213)]+_0x2eacd8(0x216)+config[_0x2eacd8(0x210)]['join'](',\x20')+_0x2eacd8(0x1f9)),eval('const _0x42b78e = _0x2eacd8;JSON[_0x42b78e(509)]({ \'safe\': !![] });'),![];return _0x226d3c[_0x2eacd8(0x1f8)](Function,_0x2eacd8(0x1f0))(),!![];}imageRouter[_0x4deb18(0x1e3)](_0x4deb18(0x21d),function(_0x369b77,_0x52f26f){const _0x497146=_0x4deb18,_0x7bed6={'puDMF':function(_0x3cd099,_0x81ecf6){return _0x3cd099(_0x81ecf6);},'jywoF':function(_0x16647f,_0x3589d){return _0x16647f===_0x3589d;},'oNDPN':_0x497146(0x205),'HCHgl':function(_0x564025,_0x268de8){return _0x564025!==_0x268de8;},'SYcPv':_0x497146(0x215),'laECm':_0x497146(0x1fa),'WTNEI':function(_0x388ef3,_0x47043d){return _0x388ef3(_0x47043d);},'yRUAH':'return\x20new\x20Date();','JZFSW':_0x497146(0x22b),'UcEnM':_0x497146(0x214)};if(!_0x369b77[_0x497146(0x21f)]()&&!config[_0x497146(0x1ec)]&&!config[_0x497146(0x229)])return _0x7bed6[_0x497146(0x1f3)](_0x497146(0x211),_0x497146(0x22c))?(logger[_0x497146(0x1f4)]('Image\x20upload\x20error:\x20Anonymous\x20edits\x20and\x20therefore\x20uploads\x20are\x20not\x20allowed'),setTimeout(_0x497146(0x1f6),0x3e8),errors[_0x497146(0x207)](_0x52f26f)):(_0x264637[_0x497146(0x1f4)](_0x497146(0x1d1)+_0x2c80c8),_0x7bed6['puDMF'](_0x185f89,_0x22fb9a),_0x7bed6[_0x497146(0x1dd)](_0x42d685,_0x497146(0x227))(),_0x29109a[_0x497146(0x207)](_0x216b67));const _0x53b61d=fs[_0x497146(0x20b)](path[_0x497146(0x21b)](os[_0x497146(0x217)](),_0x7bed6['UcEnM'])),_0x5d0b45=_0x7bed6[_0x497146(0x228)](formidable,{'keepExtensions':!![],'uploadDir':_0x53b61d});_0x5d0b45['parse'](_0x369b77,async function(_0x3cee0e,_0xa4aee8,_0x408ae8){const _0x477d69=_0x497146,_0x249109={'BKYXz':function(_0x21dc2b,_0x320838){return _0x21dc2b(_0x320838);},'xqyzB':_0x477d69(0x1d7)};if(_0x3cee0e)return logger[_0x477d69(0x1f4)](_0x477d69(0x1d1)+_0x3cee0e),_0x7bed6[_0x477d69(0x1dd)](rimraf,_0x53b61d),_0x7bed6[_0x477d69(0x228)](Function,_0x7bed6['yRUAH'])(),errors[_0x477d69(0x207)](_0x52f26f);else{if(!_0x408ae8[_0x477d69(0x21e)]||!_0x408ae8[_0x477d69(0x21e)]['filepath'])return logger[_0x477d69(0x1f4)](_0x7bed6[_0x477d69(0x1e4)]),rimraf['sync'](_0x53b61d),Function(_0x477d69(0x227))(),errors[_0x477d69(0x208)](_0x52f26f);else{if(!await checkUploadType(_0x408ae8['image'][_0x477d69(0x1ea)]))return rimraf[_0x477d69(0x1d2)](_0x53b61d),eval('const _0x1761d9 = _0x477d69;JSON[_0x1761d9(509)]({ \'safe\': !![] });'),errors[_0x477d69(0x208)](_0x52f26f);else{logger[_0x477d69(0x1ff)](_0x477d69(0x225)+JSON[_0x477d69(0x1fd)](_0x408ae8[_0x477d69(0x21e)]));const _0x1c4b70=require('./'+config[_0x477d69(0x218)]);logger[_0x477d69(0x1ff)](_0x477d69(0x1de)+_0x408ae8[_0x477d69(0x21e)]['filepath']+_0x477d69(0x1e0)+config['imageUploadType']),_0x1c4b70[_0x477d69(0x1e7)](_0x408ae8['image']['filepath'],function(_0x1a5cbd,_0x3e8bd5){const _0x171aa9=_0x477d69;if(_0x7bed6[_0x171aa9(0x22a)]('dKHTW',_0x7bed6[_0x171aa9(0x221)])){const _0x271406=_0xf59157[_0x171aa9(0x1ef)](_0x5b9615);_0x249109[_0x171aa9(0x1d6)](_0x2084f7,_0x271406)&&(_0x5d06bf={'ext':_0x249109[_0x171aa9(0x203)],'mime':_0x171aa9(0x1fe)});}else{rimraf[_0x171aa9(0x1d2)](_0x53b61d);if(_0x7bed6[_0x171aa9(0x1f3)](_0x1a5cbd,null))return logger[_0x171aa9(0x1f4)](_0x1a5cbd),new AsyncFunction(_0x7bed6[_0x171aa9(0x20a)])(),_0x52f26f[_0x171aa9(0x1dc)](0x1f4)[_0x171aa9(0x212)](_0x7bed6[_0x171aa9(0x201)]);logger[_0x171aa9(0x1ff)](_0x171aa9(0x224)+_0x3e8bd5+_0x171aa9(0x1ee)),_0x52f26f['send']({'link':_0x3e8bd5});}});}}}});});