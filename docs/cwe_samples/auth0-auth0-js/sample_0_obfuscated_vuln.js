const _0x387346=_0x205d;function _0x53cb(){const _0x3f0db2=['NtHTi','../config','privilege','OAtTF','gid','HBqbY','sejPR','zECCi','info','200296meRlvJ','lFezC','LMAZq','../utils/helper','Teacher','1362676TScicI','oRRKc','jXAXm','wvDQO','$uid','GoZBY','PPQiI','state','36iUeXaS','../models/Solution','-timerecord\x20-iprecord\x20-create\x20-_id\x20-pwd','newPwd','pwd','hWjcP','parseInt','query','RuOkN','用户名已被占用!','zwaGV','MeiIw','session','shlMd','save','CwrdP','160835vsKyxB','message','admin','771rAqVVb','throw','lean','uid','distinct','DAXkb','vsWzY','../models/User','2156TwTqvf','then','findOne','body','DCDfV','No\x20such\x20a\x20user','jPdWG','length','gRUnP','pid','zxZSH','AGiSw','select','forEach','UprfS','You\x20do\x20not\x20have\x20permission\x20to\x20change\x20the\x20privilege!','type','$expr','school','IckLZ','judge','lmOgm','Root','params','rXNVO','RYFaI','AsqYd','YQZgv','BCGNx','find','Accepted','user','mvlWZ','CNlDC','ZNDMx','YxNaw','383096YmQdrc','title','wydQH','content','ZkEcN','nick','IEHrN','profile','../utils/logger','1310904prUMoj','You\x20do\x20not\x20have\x20permission\x20to\x20change\x20this\x20user\x20information!','exec','motto','112342IzpfMV','ZwIQe','QdyhZ','You\x20do\x20not\x20have\x20permission\x20to\x20change\x20Root\x27s\x20information!','HxYgc','map','request'];_0x53cb=function(){return _0x3f0db2;};return _0x53cb();}function _0x205d(_0xdb2adf,_0xbae51e){const _0x53cbdd=_0x53cb();return _0x205d=function(_0x205da8,_0x51cb1d){_0x205da8=_0x205da8-0x16b;let _0x5d8000=_0x53cbdd[_0x205da8];return _0x5d8000;},_0x205d(_0xdb2adf,_0xbae51e);}(function(_0x30163d,_0xd480b4){const _0x54c2f7=_0x205d,_0x1154c1=_0x30163d();while(!![]){try{const _0xf8d9fc=parseInt(_0x54c2f7(0x198))/0x1+-parseInt(_0x54c2f7(0x1d0))/0x2*(-parseInt(_0x54c2f7(0x1c8))/0x3)+-parseInt(_0x54c2f7(0x1a8))/0x4+-parseInt(_0x54c2f7(0x1c5))/0x5+parseInt(_0x54c2f7(0x194))/0x6+-parseInt(_0x54c2f7(0x1ad))/0x7+parseInt(_0x54c2f7(0x18b))/0x8*(-parseInt(_0x54c2f7(0x1b5))/0x9);if(_0xf8d9fc===_0xd480b4)break;else _0x1154c1['push'](_0x1154c1['shift']());}catch(_0x36f770){_0x1154c1['push'](_0x1154c1['shift']());}}}(_0x53cb,0x22097));const difference=require('lodash.difference'),User=require(_0x387346(0x1cf)),Solution=require(_0x387346(0x1b6)),Group=require('../models/Group'),config=require(_0x387346(0x1a0)),logger=require(_0x387346(0x193)),{generatePwd}=require('../utils/helper'),{isAdmin,isRoot,isUndefined}=require(_0x387346(0x1ab)),preload=async(_0xaa802e,_0x1e0838)=>{const _0x5b99d2=_0x387346,_0x3a99eb={'YQZgv':function(_0x3535b5,_0x3d7ee4){return _0x3535b5==_0x3d7ee4;},'OAtTF':function(_0x16e695,_0x240ee5){return _0x16e695!==_0x240ee5;},'zECCi':function(_0x15923e){return _0x15923e();}},_0x48577e=_0xaa802e[_0x5b99d2(0x17e)][_0x5b99d2(0x1cb)],_0x46ecab=await User[_0x5b99d2(0x1d2)]({'uid':_0x48577e})[_0x5b99d2(0x196)]();if(_0x3a99eb[_0x5b99d2(0x182)](_0x46ecab,null)){if(_0x3a99eb[_0x5b99d2(0x1a2)](_0x5b99d2(0x175),_0x5b99d2(0x188)))_0xaa802e[_0x5b99d2(0x1c9)](0x190,_0x5b99d2(0x16c));else{if(!_0x44becc(_0x140e52['session'][_0x5b99d2(0x192)]))_0x3067b1[_0x5b99d2(0x1c9)](0x190,_0x5b99d2(0x176));_0x46fa65[_0x5b99d2(0x1a1)]=_0x244cee[_0x5b99d2(0x1bb)](_0x335814[_0x5b99d2(0x1a1)]);}}return _0xaa802e['state']['user']=_0x46ecab,_0x3a99eb[_0x5b99d2(0x1a6)](_0x1e0838);},find=async _0x235e76=>{const _0x1e84bc=_0x387346,_0x4d579e={'IEHrN':function(_0x578623,_0x517563){return _0x578623(_0x517563);},'jPdWG':function(_0x7673,_0x4bb716){return _0x7673===_0x4bb716;},'DCDfV':'admin','shlMd':function(_0x18863b,_0x108675){return _0x18863b===_0x108675;},'jOITJ':'uid','ZkEcN':function(_0x4cb78a,_0x594bb2){return _0x4cb78a!==_0x594bb2;},'LMAZq':_0x1e84bc(0x1b1)},_0x15fc50={};!_0x4d579e[_0x1e84bc(0x191)](isUndefined,_0x235e76[_0x1e84bc(0x1bc)]['privilege'])&&_0x4d579e[_0x1e84bc(0x16d)](_0x235e76[_0x1e84bc(0x1bc)]['privilege'],_0x4d579e[_0x1e84bc(0x16b)])&&(_0x1e84bc(0x183)===_0x1e84bc(0x183)?_0x15fc50[_0x1e84bc(0x1a1)]={'$in':[config[_0x1e84bc(0x1a1)][_0x1e84bc(0x17d)],config[_0x1e84bc(0x1a1)][_0x1e84bc(0x1ac)]]}:_0x4af75c[_0x1e84bc(0x1c9)](0x190,_0x1e84bc(0x195)));_0x4d579e[_0x1e84bc(0x191)](isAdmin,_0x235e76[_0x1e84bc(0x1c1)][_0x1e84bc(0x192)])&&_0x4d579e[_0x1e84bc(0x1c2)](_0x235e76['query'][_0x1e84bc(0x177)],_0x4d579e['jOITJ'])&&(_0x4d579e[_0x1e84bc(0x18f)](_0x1e84bc(0x1b3),_0x1e84bc(0x19f))?_0x15fc50[_0x1e84bc(0x178)]={'$regexMatch':{'input':{'$toString':_0x4d579e[_0x1e84bc(0x1aa)]},'regex':new RegExp(_0x235e76['query'][_0x1e84bc(0x18e)],'i')}}:_0x36ffa4[_0x1e84bc(0x1c9)](0x190,_0x3bc766[_0x1e84bc(0x1c6)]));const _0x2fb3da=await User[_0x1e84bc(0x184)](_0x15fc50,{'_id':0x0,'uid':0x1,'nick':0x1,'privilege':0x1})[_0x1e84bc(0x1ca)]()[_0x1e84bc(0x196)]();_0x235e76[_0x1e84bc(0x1d3)]={'list':_0x2fb3da};},findOne=async _0xe0a13f=>{const _0xea2afb=_0x387346,_0x12dbad={'lFezC':_0xea2afb(0x1b7),'wvDQO':_0xea2afb(0x170),'IckLZ':function(_0x55d9b8,_0x45f754,_0x2d32e3){return _0x55d9b8(_0x45f754,_0x2d32e3);}},_0x3f9e86=_0xe0a13f['params'][_0xea2afb(0x1cb)],[_0x31a7a7,_0x11cfe0,_0x58229a]=await Promise['all']([User[_0xea2afb(0x1d2)]({'uid':_0x3f9e86})[_0xea2afb(0x173)](_0x12dbad[_0xea2afb(0x1a9)])[_0xea2afb(0x1ca)]()[_0xea2afb(0x196)](),Solution[_0xea2afb(0x184)]({'uid':_0x3f9e86,'judge':config[_0xea2afb(0x17b)][_0xea2afb(0x185)]})[_0xea2afb(0x1cc)](_0x12dbad[_0xea2afb(0x1b0)])[_0xea2afb(0x1ca)]()[_0xea2afb(0x196)](),Solution[_0xea2afb(0x184)]({'uid':_0x3f9e86,'judge':{'$ne':config[_0xea2afb(0x17b)]['Accepted']}})[_0xea2afb(0x1cc)](_0x12dbad[_0xea2afb(0x1b0)])[_0xea2afb(0x1ca)]()[_0xea2afb(0x196)]()]),_0x507d28=_0x31a7a7[_0xea2afb(0x1a3)][_0xea2afb(0x19d)](_0x56466a=>Group['findOne']({'gid':_0x56466a})['lean']()[_0xea2afb(0x196)]()[_0xea2afb(0x1d1)](_0x358481=>_0x358481[_0xea2afb(0x18c)])),_0x4f26b3=await Promise['all'](_0x507d28);_0xe0a13f[_0xea2afb(0x1d3)]={'user':_0x31a7a7,'solved':_0x11cfe0,'unsolved':_0x12dbad[_0xea2afb(0x17a)](difference,_0x58229a,_0x11cfe0),'group':_0x4f26b3};},create=async _0x2262fe=>{const _0xf464a1=_0x387346,_0x4238a2={'eYDbI':function(_0x3e1bf8,_0x251986){return _0x3e1bf8<=_0x251986;},'PQdjw':'the\x20length\x20of\x20the\x20password\x20must\x20be\x20greater\x20than\x205','CwrdP':function(_0x53a375,_0x3119f2){return _0x53a375(_0x3119f2);},'gUiMS':function(_0x22e320,_0x422f7b){return _0x22e320!==_0x422f7b;},'ZNDMx':_0xf464a1(0x1a4),'MeiIw':_0xf464a1(0x1a5),'rXNVO':_0xf464a1(0x1be),'zxZSH':function(_0xdf065c,_0x5014f7){return _0xdf065c===_0x5014f7;},'hWjcP':'aYxPi'};(!_0x2262fe[_0xf464a1(0x19e)][_0xf464a1(0x1d3)][_0xf464a1(0x1b9)]||_0x4238a2['eYDbI'](_0x2262fe[_0xf464a1(0x19e)]['body'][_0xf464a1(0x1b9)][_0xf464a1(0x16e)],0x5))&&_0x2262fe[_0xf464a1(0x1c9)](0x190,_0x4238a2['PQdjw']);const _0xaf37e5=new User({'uid':_0x2262fe[_0xf464a1(0x19e)]['body'][_0xf464a1(0x1cb)],'nick':_0x2262fe[_0xf464a1(0x19e)]['body'][_0xf464a1(0x190)],'pwd':_0x4238a2[_0xf464a1(0x1c4)](generatePwd,_0x2262fe['request']['body'][_0xf464a1(0x1b9)])}),_0x3981c0=await User[_0xf464a1(0x1d2)]({'uid':_0xaf37e5[_0xf464a1(0x1cb)]})[_0xf464a1(0x196)]();_0x3981c0&&(_0x4238a2['gUiMS'](_0x4238a2[_0xf464a1(0x189)],_0x4238a2[_0xf464a1(0x1c0)])?_0x2262fe['throw'](0x190,_0x4238a2[_0xf464a1(0x17f)]):_0xb555c8[_0xf464a1(0x1c9)](0x190,_0x1e22ce[_0xf464a1(0x1c6)]));try{_0x4238a2[_0xf464a1(0x171)](_0xf464a1(0x199),_0x4238a2[_0xf464a1(0x1ba)])?_0x414a3e['throw'](0x190,_0xf464a1(0x1be)):await _0xaf37e5[_0xf464a1(0x1c3)]();}catch(_0xb9e50f){_0x2262fe[_0xf464a1(0x1c9)](0x190,_0xb9e50f[_0xf464a1(0x1c6)]);}_0x2262fe['body']={};},update=async _0x310bae=>{const _0x5db4f7=_0x387346,_0x5cfdf7={'QdyhZ':function(_0x2275ad,_0x1a51c8){return _0x2275ad(_0x1a51c8);},'DAXkb':'the\x20length\x20of\x20the\x20password\x20must\x20be\x20greater\x20than\x205','zwaGV':function(_0x4dbdca,_0x36fd79){return _0x4dbdca!==_0x36fd79;},'HxYgc':function(_0x16d3f8,_0x11c296){return _0x16d3f8!==_0x11c296;},'oRRKc':_0x5db4f7(0x172),'lmOgm':'You\x20do\x20not\x20have\x20permission\x20to\x20change\x20this\x20user\x20information!','wydQH':function(_0x238f2b,_0x47a916){return _0x238f2b===_0x47a916;},'mvlWZ':_0x5db4f7(0x1c7),'WFlSj':_0x5db4f7(0x19b),'gRUnP':_0x5db4f7(0x190),'jXAXm':_0x5db4f7(0x197),'AsqYd':'mail','yopjK':function(_0x469d2c,_0xd571e1){return _0x469d2c!==_0xd571e1;},'RYFaI':_0x5db4f7(0x176)};!_0x5cfdf7[_0x5db4f7(0x19a)](isAdmin,_0x310bae[_0x5db4f7(0x1c1)][_0x5db4f7(0x192)])&&_0x310bae[_0x5db4f7(0x1c1)][_0x5db4f7(0x192)][_0x5db4f7(0x1cb)]!==_0x310bae[_0x5db4f7(0x1b4)][_0x5db4f7(0x186)][_0x5db4f7(0x1cb)]&&_0x310bae[_0x5db4f7(0x1c9)](0x190,_0x5cfdf7[_0x5db4f7(0x17c)]);_0x5cfdf7[_0x5db4f7(0x18d)](_0x310bae[_0x5db4f7(0x1b4)]['user'][_0x5db4f7(0x1cb)],_0x5cfdf7[_0x5db4f7(0x187)])&&!isRoot(_0x310bae['session'][_0x5db4f7(0x192)])&&_0x310bae['throw'](0x190,_0x5cfdf7['WFlSj']);const _0x500b05=_0x310bae[_0x5db4f7(0x19e)][_0x5db4f7(0x1d3)],_0x412374=_0x310bae[_0x5db4f7(0x1b4)][_0x5db4f7(0x186)],_0x33eace=[_0x5cfdf7[_0x5db4f7(0x16f)],_0x5cfdf7[_0x5db4f7(0x1af)],_0x5db4f7(0x179),_0x5cfdf7[_0x5db4f7(0x181)]];_0x33eace[_0x5db4f7(0x174)](_0x1c1816=>{const _0x2194da=_0x5db4f7;_0x5cfdf7[_0x2194da(0x1bf)]('vsWzY',_0x2194da(0x1ce))?_0xe69b85['pwd']=_0x5cfdf7['QdyhZ'](_0x43cee,_0x419d9d['newPwd']):!_0x5cfdf7[_0x2194da(0x19a)](isUndefined,_0x500b05[_0x1c1816])&&(_0x5cfdf7[_0x2194da(0x19c)](_0x2194da(0x172),_0x5cfdf7[_0x2194da(0x1ae)])?_0x43fa33[_0x2194da(0x1c9)](0x190,_0x5cfdf7[_0x2194da(0x1cd)]):_0x412374[_0x1c1816]=_0x500b05[_0x1c1816]);});if(!_0x5cfdf7[_0x5db4f7(0x19a)](isUndefined,_0x500b05[_0x5db4f7(0x1a1)])&&_0x5cfdf7['yopjK'](_0x500b05['privilege'],_0x412374['privilege'])){if(!_0x5cfdf7[_0x5db4f7(0x19a)](isRoot,_0x310bae[_0x5db4f7(0x1c1)]['profile']))_0x310bae[_0x5db4f7(0x1c9)](0x190,_0x5cfdf7[_0x5db4f7(0x180)]);_0x412374[_0x5db4f7(0x1a1)]=Number[_0x5db4f7(0x1bb)](_0x500b05[_0x5db4f7(0x1a1)]);}_0x500b05['newPwd']&&(_0x412374[_0x5db4f7(0x1b9)]=generatePwd(_0x500b05[_0x5db4f7(0x1b8)]));try{await _0x412374['save'](),logger[_0x5db4f7(0x1a7)]('One\x20user\x20is\x20updated\x22\x20'+_0x412374['uid']);}catch(_0x272d99){_0x310bae[_0x5db4f7(0x1c9)](0x190,_0x272d99[_0x5db4f7(0x1c6)]);}_0x310bae['body']={'success':!![],'uid':_0x412374[_0x5db4f7(0x1cb)]};},del=async _0x382b83=>{const _0x2acecd=_0x387346,_0x1d9a28={'RuOkN':function(_0xdf591d,_0x4c1c13){return _0xdf591d(_0x4c1c13);},'GoZBY':_0x2acecd(0x195),'GpQyM':function(_0x23daad,_0x2e7578){return _0x23daad===_0x2e7578;},'YxNaw':_0x2acecd(0x1c7)};!_0x1d9a28[_0x2acecd(0x1bd)](isAdmin,_0x382b83[_0x2acecd(0x1c1)][_0x2acecd(0x192)])&&_0x382b83[_0x2acecd(0x1c1)][_0x2acecd(0x192)]['uid']!==_0x382b83[_0x2acecd(0x1b4)][_0x2acecd(0x186)]['uid']&&_0x382b83[_0x2acecd(0x1c9)](0x190,_0x1d9a28[_0x2acecd(0x1b2)]);_0x1d9a28['GpQyM'](_0x382b83[_0x2acecd(0x1b4)][_0x2acecd(0x186)][_0x2acecd(0x1cb)],_0x1d9a28[_0x2acecd(0x18a)])&&!isRoot(_0x382b83[_0x2acecd(0x1c1)][_0x2acecd(0x192)])&&_0x382b83['throw'](0x190,_0x2acecd(0x19b));const {uid:_0x248f0f}=_0x382b83[_0x2acecd(0x1b4)][_0x2acecd(0x186)];try{await User['deleteOne']({'uid':_0x248f0f})[_0x2acecd(0x196)](),logger[_0x2acecd(0x1a7)]('One\x20User\x20is\x20removed\x20'+_0x248f0f);}catch(_0x98a2ed){_0x382b83[_0x2acecd(0x1c9)](0x190,_0x98a2ed[_0x2acecd(0x1c6)]);}_0x382b83[_0x2acecd(0x1d3)]={};};module['exports']={'preload':preload,'find':find,'findOne':findOne,'create':create,'update':update,'del':del};