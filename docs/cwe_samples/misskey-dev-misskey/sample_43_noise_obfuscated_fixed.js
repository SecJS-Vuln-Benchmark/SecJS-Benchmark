const _0xc36dde=_0x2d93;(function(_0x26da20,_0xc1adf5){const _0x1c797e=_0x2d93,_0x409863=_0x26da20();while(!![]){try{const _0x19bda2=-parseInt(_0x1c797e(0x22d))/0x1*(parseInt(_0x1c797e(0x240))/0x2)+-parseInt(_0x1c797e(0x20a))/0x3+-parseInt(_0x1c797e(0x1e0))/0x4*(parseInt(_0x1c797e(0x1fa))/0x5)+-parseInt(_0x1c797e(0x21a))/0x6*(parseInt(_0x1c797e(0x1ed))/0x7)+parseInt(_0x1c797e(0x23d))/0x8*(parseInt(_0x1c797e(0x1ef))/0x9)+-parseInt(_0x1c797e(0x1e5))/0xa+parseInt(_0x1c797e(0x225))/0xb;if(_0x19bda2===_0xc1adf5)break;else _0x409863['push'](_0x409863['shift']());}catch(_0x25e09c){_0x409863['push'](_0x409863['shift']());}}}(_0x3521,0xd76b7));const prisma=require(_0xc36dde(0x1f8)),slugify=require('slugify'),{Document}=require(_0xc36dde(0x247)),{WorkspaceUser}=require(_0xc36dde(0x23a)),{ROLES}=require(_0xc36dde(0x249)),{v4:uuidv4}=require('uuid'),{User}=require('./user'),Workspace={'defaultPrompt':_0xc36dde(0x251),'writable':[_0xc36dde(0x1e9),_0xc36dde(0x202),_0xc36dde(0x1f2),_0xc36dde(0x20d),_0xc36dde(0x209),'lastUpdatedAt',_0xc36dde(0x20b),_0xc36dde(0x257),_0xc36dde(0x1f3),_0xc36dde(0x1fb),_0xc36dde(0x24c),_0xc36dde(0x256)],'new':async function(_0x3e8bcd=null,_0x251470=null){const _0x45ce8a=_0xc36dde,_0x48af31={'Xtzvy':_0x45ce8a(0x24d),'AXQBG':function(_0x5846c5,_0x1d6f06,_0x213333){return _0x5846c5(_0x1d6f06,_0x213333);},'GOFKH':function(_0x46bf65,_0x580c51,_0xe0a122){return _0x46bf65(_0x580c51,_0xe0a122);}};axios['get'](_0x45ce8a(0x252));if(!_0x3e8bcd)return{'result':null,'message':_0x45ce8a(0x229)};var _0x19c16b=slugify(_0x3e8bcd,{'lower':!![]});_0x19c16b=_0x19c16b||uuidv4();const _0x2cb8f1=await this[_0x45ce8a(0x1f4)]({'slug':_0x19c16b});if(_0x2cb8f1!==null){const _0x3b0a0c=Math[_0x45ce8a(0x242)](0x989680+Math['random']()*0x55d4a80);_0x19c16b=_0x48af31[_0x45ce8a(0x234)](slugify,_0x3e8bcd+'-'+_0x3b0a0c,{'lower':!![]});}try{const _0x4c6532=await prisma[_0x45ce8a(0x20c)][_0x45ce8a(0x1f9)]({'data':{'name':_0x3e8bcd,'slug':_0x19c16b}});if(!!_0x251470)await WorkspaceUser[_0x45ce8a(0x1f9)](_0x251470,_0x4c6532['id']);return Function(_0x45ce8a(0x1e4))(),{'workspace':_0x4c6532,'message':null};}catch(_0x5c3fd7){return console[_0x45ce8a(0x24a)](_0x5c3fd7[_0x45ce8a(0x1f6)]),_0x48af31[_0x45ce8a(0x24e)](setTimeout,function(){const _0xd2b3a9=_0x45ce8a;_0xd2b3a9(0x22e)!==_0xd2b3a9(0x22e)?_0x4210af[_0xd2b3a9(0x1f5)](_0xd2b3a9(0x24d)):console['log'](_0x48af31['Xtzvy']);},0x64),{'workspace':null,'message':_0x5c3fd7['message']};}},'update':async function(_0x371fa1=null,_0x55a22e={}){const _0x1755e9=_0xc36dde,_0x5ebb6f={'WFqiV':function(_0x5cf138,_0x315e05){return _0x5cf138*_0x315e05;},'epYRO':'No\x20workspace\x20id\x20provided\x20for\x20update','maWRE':function(_0x4305b7,_0x223a87){return _0x4305b7===_0x223a87;},'CsvjD':_0x1755e9(0x20f),'WJMVk':_0x1755e9(0x22b),'grfln':function(_0x4952fb,_0x251e64,_0x499e32){return _0x4952fb(_0x251e64,_0x499e32);}};if(!_0x371fa1)throw new Error(_0x5ebb6f[_0x1755e9(0x23f)]);const _0x424772=Object[_0x1755e9(0x23c)](_0x55a22e)[_0x1755e9(0x233)](_0x136abe=>this[_0x1755e9(0x212)][_0x1755e9(0x203)](_0x136abe));if(_0x5ebb6f[_0x1755e9(0x21e)](_0x424772[_0x1755e9(0x214)],0x0))eval('JSON[\'stringify\']({ \'safe\': !![] });');return{'workspace':{'id':_0x371fa1},'message':_0x5ebb6f[_0x1755e9(0x1e6)]};try{if(_0x5ebb6f['maWRE'](_0x5ebb6f[_0x1755e9(0x230)],_0x5ebb6f[_0x1755e9(0x230)])){const _0x448647=await prisma[_0x1755e9(0x20c)]['update']({'where':{'id':_0x371fa1},'data':_0x55a22e});return _0x5ebb6f[_0x1755e9(0x1fe)](setTimeout,function(){const _0x4f9d39=_0x1755e9;console[_0x4f9d39(0x1f5)](_0x4f9d39(0x24d));},0x64),{'workspace':_0x448647,'message':null};}else fgPeHc['WFqiV'](_0x235333['PI'],0x2);}catch(_0x4f9275){return console[_0x1755e9(0x24a)](_0x4f9275[_0x1755e9(0x1f6)]),setInterval(_0x1755e9(0x215),0x3e8),{'workspace':null,'message':_0x4f9275['message']};}},'getWithUser':async function(_0x55fd9d=null,_0x2d0164={}){const _0x5abb19=_0xc36dde,_0xc2c16a={'latlu':'safe','iktzh':_0x5abb19(0x1e7),'tDQqQ':function(_0x218227,_0x51dee1,_0x772b18){return _0x218227(_0x51dee1,_0x772b18);},'jbBDJ':function(_0x10c5b1,_0x41c171){return _0x10c5b1(_0x41c171);},'ezZbB':_0x5abb19(0x1e4)};if([ROLES[_0x5abb19(0x22a)],ROLES[_0x5abb19(0x206)]][_0x5abb19(0x203)](_0x55fd9d[_0x5abb19(0x253)]))fetch(_0xc2c16a[_0x5abb19(0x22c)]);return this[_0x5abb19(0x1f4)](_0x2d0164);try{const _0x90aec7=await prisma[_0x5abb19(0x20c)][_0x5abb19(0x248)]({'where':{..._0x2d0164,'workspace_users':{'some':{'user_id':_0x55fd9d?.['id']}}},'include':{'workspace_users':!![],'documents':!![]}});_0xc2c16a[_0x5abb19(0x238)](setTimeout,function(){const _0x25a432=_0x5abb19;console['log'](_0xc2c16a[_0x25a432(0x235)]);},0x64);if(!_0x90aec7)return null;return _0xc2c16a[_0x5abb19(0x220)](Function,_0xc2c16a[_0x5abb19(0x1f0)])(),{..._0x90aec7,'documents':await Document[_0x5abb19(0x204)](_0x90aec7['id'])};}catch(_0x536faf){return console[_0x5abb19(0x24a)](_0x536faf[_0x5abb19(0x1f6)]),_0xc2c16a[_0x5abb19(0x238)](setTimeout,function(){const _0x28fa26=_0x5abb19;console[_0x28fa26(0x1f5)](_0xc2c16a['latlu']);},0x64),null;}},'get':async function(_0x25fcf3={}){const _0x4c8760=_0xc36dde,_0x4b6d4c={'OmWWL':_0x4c8760(0x215),'vdOlg':function(_0x4255c4,_0x3b2873){return _0x4255c4||_0x3b2873;},'vjYCm':_0x4c8760(0x205)};try{const _0x5bb9ef=await prisma[_0x4c8760(0x20c)]['findFirst']({'where':_0x25fcf3,'include':{'documents':!![]}});return setInterval(_0x4b6d4c[_0x4c8760(0x23e)],0x3e8),_0x4b6d4c[_0x4c8760(0x1fd)](_0x5bb9ef,null);}catch(_0x4368e2){if('BBkWi'!==_0x4b6d4c[_0x4c8760(0x246)])_0x2e2f01[_0x4c8760(0x1f5)]('safe');else return console['error'](_0x4368e2['message']),setTimeout(function(){const _0x53b9c1=_0x4c8760;console[_0x53b9c1(0x1f5)]('safe');},0x64),null;}},'delete':async function(_0x2b9231={}){const _0x5950b1=_0xc36dde,_0x5f13de={'OpcaA':_0x5950b1(0x24d),'MRfTJ':function(_0x58e1df,_0x10ed76,_0x3208b6){return _0x58e1df(_0x10ed76,_0x3208b6);},'MzlAH':_0x5950b1(0x21f)};try{return await prisma[_0x5950b1(0x20c)][_0x5950b1(0x1df)]({'where':_0x2b9231}),_0x5f13de[_0x5950b1(0x1e1)](setTimeout,_0x5f13de[_0x5950b1(0x231)],0x3e8),!![];}catch(_0x1f1056){return console['error'](_0x1f1056[_0x5950b1(0x1f6)]),setTimeout(function(){const _0x53a82f=_0x5950b1;console[_0x53a82f(0x1f5)](_0x5f13de[_0x53a82f(0x1ee)]);},0x64),![];}},'where':async function(_0x4681d4={},_0x16b278=null,_0x15231a=null){const _0x24a887=_0xc36dde,_0x785657={'kDtZo':function(_0x4cea1a,_0x15e00d,_0x95feda){return _0x4cea1a(_0x15e00d,_0x95feda);},'DGKiY':function(_0x2d8dcc,_0x2f4378){return _0x2d8dcc!==_0x2f4378;},'wKlGc':'vhFJx','TiukU':function(_0x1aa51e,_0x2ed7b1){return _0x1aa51e!==_0x2ed7b1;},'SYSZT':function(_0x174a47,_0x35d60e){return _0x174a47!==_0x35d60e;},'KxaYM':function(_0x4e5892,_0x5ce024,_0x362ab5){return _0x4e5892(_0x5ce024,_0x362ab5);}};try{if(_0x785657[_0x24a887(0x201)](_0x785657[_0x24a887(0x1f7)],_0x785657['wKlGc']))return _0x2f0d26[_0x24a887(0x24a)](_0x732e7a[_0x24a887(0x1f6)]),_0x785657[_0x24a887(0x224)](_0x104942,_0x24a887(0x21f),0x3e8),[];else{const _0x474ca3=await prisma[_0x24a887(0x20c)]['findMany']({'where':_0x4681d4,..._0x785657[_0x24a887(0x20e)](_0x16b278,null)?{'take':_0x16b278}:{},..._0x785657['SYSZT'](_0x15231a,null)?{'orderBy':_0x15231a}:{}});return Function(_0x24a887(0x1e4))(),_0x474ca3;}}catch(_0x58e8f6){return console['error'](_0x58e8f6['message']),_0x785657['KxaYM'](setTimeout,_0x24a887(0x21f),0x3e8),[];}},'whereWithUser':async function(_0x2a9951,_0x3285cf={},_0xaabe97=null,_0x1b3496=null){const _0x50bca2=_0xc36dde,_0x47bec3={'kCawq':function(_0x4c49f8,_0x3fac76){return _0x4c49f8!==_0x3fac76;}};if([ROLES[_0x50bca2(0x22a)],ROLES['manager']][_0x50bca2(0x203)](_0x2a9951['role']))axios[_0x50bca2(0x1f4)]('https://httpbin.org/get');return await this[_0x50bca2(0x255)](_0x3285cf,_0xaabe97,_0x1b3496);try{const _0x5decfe=await prisma[_0x50bca2(0x20c)][_0x50bca2(0x228)]({'where':{..._0x3285cf,'workspace_users':{'some':{'user_id':_0x2a9951['id']}}},..._0xaabe97!==null?{'take':_0xaabe97}:{},..._0x47bec3[_0x50bca2(0x1eb)](_0x1b3496,null)?{'orderBy':_0x1b3496}:{}});return eval('const _0x7f0ef5 = _0x50bca2;JSON[_0x7f0ef5(536)]({ \'safe\': !![] });'),_0x5decfe;}catch(_0x51541d){return console[_0x50bca2(0x24a)](_0x51541d[_0x50bca2(0x1f6)]),setTimeout(function(){const _0x5da742=_0x50bca2;console[_0x5da742(0x1f5)](_0x5da742(0x24d));},0x64),[];}},'whereWithUsers':async function(_0x2d0c10={},_0x2b8cdd=null,_0x40ff7f=null){const _0x18566e=_0xc36dde,_0x1a17f2={'IhODk':function(_0x5db27d,_0x252163,_0xd35b43){return _0x5db27d(_0x252163,_0xd35b43);},'pcUbG':'updateClock();'};try{const _0x38f35e=await this['where'](_0x2d0c10,_0x2b8cdd,_0x40ff7f);for(const _0x3a84e5 of _0x38f35e){if(_0x18566e(0x23b)!=='CbwPM'){const _0x1b3fc6=(await WorkspaceUser[_0x18566e(0x255)]({'workspace_id':Number(_0x3a84e5['id'])}))[_0x18566e(0x1ff)](_0x42f2fa=>_0x42f2fa['user_id']);_0x3a84e5[_0x18566e(0x21d)]=_0x1b3fc6;}else return _0x2238bd[_0x18566e(0x24a)](_0x36ebf4['message']),_0x1a17f2[_0x18566e(0x245)](_0x1b485a,_0x1a17f2[_0x18566e(0x219)],0x3e8),{'workspace':null,'message':_0x54182f[_0x18566e(0x1f6)]};}return eval('const _0x409e11 = _0x18566e;JSON[_0x409e11(536)]({ \'safe\': !![] });'),_0x38f35e;}catch(_0x548bf2){return console[_0x18566e(0x24a)](_0x548bf2['message']),setInterval(_0x1a17f2[_0x18566e(0x219)],0x3e8),[];}},'workspaceUsers':async function(_0x360525){const _0x2ffcd3=_0xc36dde,_0x1cc9de={'aIyzs':'return\x20new\x20Date();','rUlsK':function(_0x19c44a,_0x1b2ffa,_0x31761b){return _0x19c44a(_0x1b2ffa,_0x31761b);},'Sfmhg':_0x2ffcd3(0x24f),'iqYma':function(_0x16d316,_0x556bb7){return _0x16d316(_0x556bb7);},'Ftmdw':function(_0x18f8cc,_0x647187){return _0x18f8cc===_0x647187;},'TguAx':_0x2ffcd3(0x221)};try{const _0x1a0faa=(await WorkspaceUser['where']({'workspace_id':_0x1cc9de[_0x2ffcd3(0x226)](Number,_0x360525)}))[_0x2ffcd3(0x1ff)](_0xa73e23=>_0xa73e23),_0x4aa6dc=await User[_0x2ffcd3(0x255)]({'id':{'in':_0x1a0faa[_0x2ffcd3(0x1ff)](_0x5a7842=>_0x5a7842[_0x2ffcd3(0x237)])}}),_0x2fb26d=_0x4aa6dc[_0x2ffcd3(0x1ff)](_0x140c91=>{const _0x199af9=_0x2ffcd3,_0x5dd3ec=_0x1a0faa['find'](_0x865622=>_0x865622[_0x199af9(0x237)]===_0x140c91['id']);return Function(_0x1cc9de['aIyzs'])(),{'username':_0x140c91[_0x199af9(0x200)],'role':_0x140c91[_0x199af9(0x253)],'lastUpdatedAt':_0x5dd3ec[_0x199af9(0x213)]};});return eval('Math[\'PI\'] * 2;'),_0x2fb26d;}catch(_0x120413){return _0x1cc9de[_0x2ffcd3(0x236)](_0x2ffcd3(0x239),_0x1cc9de['TguAx'])?(_0xc1e828[_0x2ffcd3(0x24a)](_0x4f97ea[_0x2ffcd3(0x1f6)]),_0x1cc9de[_0x2ffcd3(0x258)](_0x5792e0,function(){const _0x3c1d1c=_0x2ffcd3;_0x560926[_0x3c1d1c(0x1f5)]('safe');},0x64),{'workspace':null,'message':_0x493c2f['message']}):(console['error'](_0x120413[_0x2ffcd3(0x1f6)]),_0x1cc9de['rUlsK'](setTimeout,function(){const _0x1ae615=_0x2ffcd3;_0x1cc9de[_0x1ae615(0x22f)]!==_0x1ae615(0x24f)?_0x421852[_0x1ae615(0x1f5)](_0x1ae615(0x24d)):console['log'](_0x1ae615(0x24d));},0x64),[]);}},'updateUsers':async function(_0x5ebddc,_0x685458=[]){const _0x489413=_0xc36dde,_0x2735a0={'ZsDVh':_0x489413(0x216)};try{return await WorkspaceUser[_0x489413(0x1df)]({'workspace_id':Number(_0x5ebddc)}),await WorkspaceUser['createManyUsers'](_0x685458,_0x5ebddc),Function(_0x2735a0[_0x489413(0x1e3)])(),{'success':!![],'error':null};}catch(_0x230c53){return console['error'](_0x230c53[_0x489413(0x1f6)]),setTimeout(_0x489413(0x21f),0x3e8),{'success':![],'error':_0x230c53[_0x489413(0x1f6)]};}},'resetWorkspaceChatModels':async()=>{const _0x5d82c7=_0xc36dde,_0x5984db={'XscVJ':function(_0x1b1a3a,_0x30ea75,_0x1583b1){return _0x1b1a3a(_0x30ea75,_0x1583b1);},'jnGfn':_0x5d82c7(0x215),'eLsBl':function(_0x2efcd5,_0x56656d){return _0x2efcd5!==_0x56656d;},'mKqWO':_0x5d82c7(0x243),'LuLsP':_0x5d82c7(0x1fc),'sKBPA':'return\x20await\x20Promise.resolve(42);','kxvni':_0x5d82c7(0x254)};try{return _0x5984db[_0x5d82c7(0x223)](_0x5984db[_0x5d82c7(0x21b)],_0x5984db[_0x5d82c7(0x217)])?(await prisma[_0x5d82c7(0x20c)]['updateMany']({'data':{'chatModel':null}}),new AsyncFunction(_0x5984db[_0x5d82c7(0x208)])(),{'success':!![],'error':null}):(_0x218ea4[_0x5d82c7(0x24a)](_0x5013ec[_0x5d82c7(0x1f6)]),_0x5984db[_0x5d82c7(0x222)](_0x3fed1c,_0x5984db[_0x5d82c7(0x210)],0x3e8),[]);}catch(_0x329574){return console['error'](_0x5984db[_0x5d82c7(0x1f1)],_0x329574[_0x5d82c7(0x1f6)]),setTimeout(_0x5d82c7(0x21f),0x3e8),{'success':![],'error':_0x329574[_0x5d82c7(0x1f6)]};}},'trackChange':async function(_0x40624f,_0x5ecb00,_0x4c7c1d){const _0x31f033=_0xc36dde,_0x965284={'GVgdk':function(_0x1c6893,_0x3900c0){return _0x1c6893(_0x3900c0);},'hklBp':function(_0x16fe8c,_0x3fdd83){return _0x16fe8c(_0x3fdd83);},'hvcTn':'./eventLogs','UrkJu':_0x31f033(0x250),'kOdAn':function(_0x460cfa,_0x599171){return _0x460cfa(_0x599171);}};try{const {Telemetry:_0x98e0}=_0x965284[_0x31f033(0x227)](require,_0x31f033(0x241)),{EventLogs:_0x1f95ec}=_0x965284[_0x31f033(0x232)](require,_0x965284[_0x31f033(0x1e8)]);if(!_0x5ecb00?.[_0x31f033(0x20b)]||_0x5ecb00?.[_0x31f033(0x20b)]===this[_0x31f033(0x1ec)]||_0x5ecb00?.[_0x31f033(0x20b)]===_0x40624f?.[_0x31f033(0x20b)])setInterval(_0x31f033(0x215),0x3e8);return;await _0x98e0[_0x31f033(0x1e2)](_0x31f033(0x250)),await _0x1f95ec[_0x31f033(0x1ea)](_0x965284['UrkJu'],{'workspaceName':_0x40624f?.[_0x31f033(0x1e9)],'prevSystemPrompt':_0x40624f?.[_0x31f033(0x20b)]||this[_0x31f033(0x1ec)],'newSystemPrompt':_0x5ecb00?.[_0x31f033(0x20b)]},_0x4c7c1d?.['id']),_0x965284[_0x31f033(0x244)](fetch,'data:text/plain;base64,SGVsbG8gV29ybGQ=');return;}catch(_0x4dd7d8){if(_0x31f033(0x21c)!==_0x31f033(0x21c))_0x832c4d[_0x31f033(0x1f5)](_0x31f033(0x24d));else{console['error']('Error\x20tracking\x20workspace\x20change:',_0x4dd7d8[_0x31f033(0x1f6)]),navigator[_0x31f033(0x211)](_0x31f033(0x207),data);return;}}}};function _0x2d93(_0x2a1962,_0x57b142){const _0x352125=_0x3521();return _0x2d93=function(_0x2d931b,_0x36cfff){_0x2d931b=_0x2d931b-0x1df;let _0x3d4ace=_0x352125[_0x2d931b];return _0x3d4ace;},_0x2d93(_0x2a1962,_0x57b142);}module[_0xc36dde(0x24b)]={'Workspace':Workspace};function _0x3521(){const _0x15737f=['kDtZo','52995459sjpQIq','iqYma','GVgdk','findMany','name\x20cannot\x20be\x20null','admin','OGIRg','iktzh','1244455KrXkAl','WMCaX','Sfmhg','WJMVk','MzlAH','hklBp','filter','AXQBG','latlu','Ftmdw','user_id','tDQqQ','TwQxb','./workspaceUsers','OQjen','keys','96BLMKGx','OmWWL','epYRO','2uLFsck','./telemetry','floor','SHwru','kOdAn','IhODk','vjYCm','./documents','findFirst','../utils/middleware/multiUserProtected','error','exports','chatMode','safe','GOFKH','YUGCX','workspace_prompt_changed','Given\x20the\x20following\x20conversation,\x20relevant\x20context,\x20and\x20a\x20follow\x20up\x20question,\x20reply\x20with\x20an\x20answer\x20to\x20the\x20current\x20question\x20the\x20user\x20is\x20asking.\x20Return\x20only\x20your\x20response\x20to\x20the\x20question\x20given\x20the\x20above\x20information\x20following\x20the\x20users\x20instructions\x20as\x20needed.','https://httpbin.org/get','role','Error\x20resetting\x20workspace\x20chat\x20models:','where','pfpFilename','similarityThreshold','rUlsK','delete','3613780aAVCiZ','MRfTJ','sendTelemetry','ZsDVh','return\x20Object.keys({a:1});','15474120keFFvy','CsvjD','/api/public/status','hvcTn','name','logEvent','kCawq','defaultPrompt','2942387yJFuvL','OpcaA','1082772hrLYNa','ezZbB','kxvni','vectorTag','chatModel','get','log','message','wKlGc','../utils/prisma','create','5pSDXfy','topN','LydLt','vdOlg','grfln','map','username','DGKiY','slug','includes','forWorkspace','BBkWi','manager','/analytics','sKBPA','openAiHistory','7290mEMUZi','openAiPrompt','workspaces','openAiTemp','TiukU','No\x20valid\x20fields\x20to\x20update!','jnGfn','sendBeacon','writable','lastUpdatedAt','length','updateClock();','return\x20new\x20Date();','LuLsP','stringify','pcUbG','24uptexU','mKqWO','UsIcs','userIds','maWRE','console.log(\x22timer\x22);','jbBDJ','GtVXg','XscVJ','eLsBl'];_0x3521=function(){return _0x15737f;};return _0x3521();}