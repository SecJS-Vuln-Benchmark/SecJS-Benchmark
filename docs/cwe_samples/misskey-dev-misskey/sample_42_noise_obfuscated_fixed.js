const _0xf598e9=_0x5c09;function _0x5c09(_0x4ffddc,_0x48d4b2){const _0x21978c=_0x2197();return _0x5c09=function(_0x5c0950,_0x5eaf07){_0x5c0950=_0x5c0950-0x105;let _0x486e1=_0x21978c[_0x5c0950];return _0x486e1;},_0x5c09(_0x4ffddc,_0x48d4b2);}(function(_0x41a11c,_0x2cd99c){const _0x52d599=_0x5c09,_0x52e1d2=_0x41a11c();while(!![]){try{const _0x154737=-parseInt(_0x52d599(0x19f))/0x1+parseInt(_0x52d599(0x1a4))/0x2+parseInt(_0x52d599(0x120))/0x3+-parseInt(_0x52d599(0x15c))/0x4*(-parseInt(_0x52d599(0x106))/0x5)+-parseInt(_0x52d599(0x198))/0x6*(parseInt(_0x52d599(0x153))/0x7)+parseInt(_0x52d599(0x142))/0x8*(parseInt(_0x52d599(0x187))/0x9)+-parseInt(_0x52d599(0x1da))/0xa;if(_0x154737===_0x2cd99c)break;else _0x52e1d2['push'](_0x52e1d2['shift']());}catch(_0x18d1e7){_0x52e1d2['push'](_0x52e1d2['shift']());}}}(_0x2197,0xec975));function _0x2197(){const _0xb17369=['Error\x20processing\x20the\x20profile\x20picture\x20removal:','2193222pxggus','rETEq','nlOiK','manager','zuNcO','stringify','ABdVL','yeYpz','addDocuments','/workspace/:slug/chat-feedback/:chatId','../storage/assets/pfp/','OHDSI','exports','Document\x20processing\x20API\x20is\x20not\x20online.\x20Link\x20','zswWg','PkaBW','gsvva','set','audio/mpeg','isArray','/workspace/:slug/tts/:chatId','Invalid\x20message\x20format.\x20Expected\x20an\x20array\x20of\x20messages.','EQLKf','removeDocuments','json','/workspace/:slug/remove-pfp','/workspace/:slug/update-embeddings','QDLzz','../models/telemetry','../models/workspace','workspace','/workspace/:slug','console.log(\x22timer\x22);','length','1917688yjRNfL','btsBR','return\x20await\x20Promise.resolve(42);','document_uploaded','inherit','iRaAG','jKzKh','admin','/workspace/:slug/suggested-messages','nwfUw','online','fhDth','sendStatus','bWvAx','ZERNg','../utils/helpers','ZkCre','21WsXFnT','HPGMt','avPiI','IIXWL','delete-namespace','trackChange','BwmOh','join','/workspace/new','12kIQymq','../models/vectors','qxkVF','/workspace/:slug/update','unlinkSync','delete','response','BmpEI','TYkfj','randomFileName','gePKB','getWithUser','edMbT','../utils/http','updateClock();','byqvu','dEdXG','MDDGv','processLink','MFMue','../utils/files','UrUlR','forWorkspaceByUser','mYaiL','slug','saveAll','../utils/files/pfp','PJJyD','onboarding_complete','get','uNlKy','RcPoE','RbkSL','NTpNo','locals','buffer','hxMaI','Document\x20','aLHej','Document\x20processing\x20API\x20is\x20not\x20online.\x20Document\x20','oFeLq','../models/documents','Error\x20processing\x20the\x20logo\x20request:','27bGbRBA','DllMi','Jhngf','user','Error\x20updating\x20chat\x20feedback:','VECTOR_DB','ywcNz','error','ghOsk','LDCDP','JjDNi','ecTxA','lTESn','/workspace/:slug/chats','deleteForWorkspace','../utils/collectorApi','\x20uploaded\x20processed\x20and\x20successfully.\x20It\x20is\x20now\x20available\x20in\x20documents.','1544394TWHWcp','wVGif','icPtN','Error\x20processing\x20the\x20suggested\x20messages:','mime','post','lancedb','349732qfXrBq','\x20will\x20not\x20be\x20processed\x20automatically.','File\x20upload\x20failed.','FbSRA','UNwNk','1678298xDzDKt','../utils/middleware/multiUserProtected','delGT','GQJDi','iQOHe','GHWJk','YXJkP','Profile\x20picture\x20removed\x20successfully.','writeHead','workspace_vectors_reset','forWorkspace','QjCyZ','params','qyxFR','openai','all','../models/workspacesSuggestedMessages','Cgvsc','status','_update','DXPRn','cdpNe','NapRH','../models/eventLogs','existsSync','processDocument','name','KMnxH','message','VyrjY','env','log','safe','RnsZB','zGmxh','EMBEDDING_ENGINE','end','oBrjS','/workspace/:slug/update-pin','YlwGC','TTS\x20could\x20not\x20be\x20completed','HfYhx','Error\x20fetching\x20suggested\x20messages:','bMGau','pUmZm','Suggested\x20messages\x20saved\x20successfully.','GhLDc','Internal\x20server\x20error','wwNgM','var\x20x\x20=\x2042;\x20return\x20x;','icrUr','FSkbR','XLHQm','YfxoI','3693110tkNLQu','sendTelemetry','logEvent','pfpFilename','284935wWgKMK','GXOZb','XSbqR','Xatbf','UDFbM','return\x20new\x20Date();','ttsBuffer','/workspace/:slug/upload-link','/workspace/:slug/upload-pfp','DqnfW','dVudN','fVNYt','Unknown\x20Workspace','mtIzp','YEFoa','rqkoI','updateFeedbackScore','OiaTg','ESZKK','map','../utils/middleware/validatedRequest','Error\x20processing\x20the\x20TTS\x20request:','link_uploaded','ItxEU','HxSZh'];_0x2197=function(){return _0xb17369;};return _0x2197();}const path=require('path'),fs=require('fs'),{reqBody,multiUserMode,userFromSession,safeJsonParse}=require(_0xf598e9(0x169)),{normalizePath}=require(_0xf598e9(0x170)),{Workspace}=require(_0xf598e9(0x13d)),{Document}=require(_0xf598e9(0x185)),{DocumentVectors}=require(_0xf598e9(0x15d)),{WorkspaceChats}=require('../models/workspaceChats'),{getVectorDbClass}=require(_0xf598e9(0x151)),{handleFileUpload,handlePfpUpload}=require('../utils/files/multer'),{validatedRequest}=require(_0xf598e9(0x11a)),{Telemetry}=require(_0xf598e9(0x13c)),{flexUserRoleValid,ROLES}=require(_0xf598e9(0x1a5)),{EventLogs}=require(_0xf598e9(0x1bb)),{WorkspaceSuggestedMessages}=require(_0xf598e9(0x1b4)),{validWorkspaceSlug}=require('../utils/middleware/validWorkspace'),{convertToChatHistory}=require('../utils/helpers/chat/responses'),{CollectorApi}=require(_0xf598e9(0x196)),{determineWorkspacePfpFilepath,fetchPfp}=require(_0xf598e9(0x176)),{getTTSProvider}=require('../utils/TextToSpeech');function workspaceEndpoints(_0x2b8af3){const _0x4755a0=_0xf598e9,_0x47d1d7={'iQOHe':function(_0x3b2c2c,_0x463512){return _0x3b2c2c(_0x463512);},'TYkfj':_0x4755a0(0x1b2),'GXOZb':_0x4755a0(0x19e),'PkaBW':'workspace_created','ghOsk':'Unknown\x20Workspace','VYQgb':_0x4755a0(0x1c4),'UDFbM':function(_0x146437,_0x219399){return _0x146437(_0x219399);},'ZkCre':function(_0x3bc53e,_0x3ea3df,_0x3d2b43){return _0x3bc53e(_0x3ea3df,_0x3d2b43);},'edMbT':_0x4755a0(0x16a),'UrUlR':function(_0x2c3b18,_0x563033,_0x6b7f05){return _0x2c3b18(_0x563033,_0x6b7f05);},'oBrjS':_0x4755a0(0x145),'YfxoI':function(_0x185a7e,_0x525dfa){return _0x185a7e+_0x525dfa;},'ztgYB':_0x4755a0(0x11c),'GDTem':function(_0x44d56c,_0x2c248b){return _0x44d56c>_0x2c248b;},'JjDNi':_0x4755a0(0x11f),'QjCyZ':_0x4755a0(0x1d3),'YEFoa':'console.log(\x22timer\x22);','FbSRA':function(_0x449602){return _0x449602();},'dVudN':function(_0x383393,_0x91a573){return _0x383393(_0x91a573);},'zswWg':function(_0x1e18fc,_0x29abe5){return _0x1e18fc===_0x29abe5;},'fhDth':_0x4755a0(0x15e),'RShSi':'workspace_deleted','jKzKh':_0x4755a0(0x19a),'mNmPx':_0x4755a0(0x1ba),'GQJDi':function(_0x37e0f8,_0x4a9909){return _0x37e0f8===_0x4a9909;},'gsvva':_0x4755a0(0x108),'zGmxh':function(_0x203b01,_0x10144e){return _0x203b01(_0x10144e);},'OiaTg':function(_0x5513b7,_0x1338cc,_0x4d62dc){return _0x5513b7(_0x1338cc,_0x4d62dc);},'Jhngf':_0x4755a0(0x1ad),'EXRfn':'delete-namespace','lTESn':function(_0x232050,_0x3e0ab5,_0x23a937){return _0x232050(_0x3e0ab5,_0x23a937);},'Cgvsc':function(_0x2df458,_0x1f02af){return _0x2df458!==_0x1f02af;},'PJJyD':'HCqiR','VyrjY':'QDLzz','OHDSI':function(_0x59cb02,_0xdd2a68){return _0x59cb02===_0xdd2a68;},'ItxEU':_0x4755a0(0x1d4),'gePKB':function(_0xcd9fa8,_0x4e55d5){return _0xcd9fa8===_0x4e55d5;},'KMnxH':_0x4755a0(0x180),'ywcNz':_0x4755a0(0x10b),'delGT':function(_0x7695b5,_0x137b36){return _0x7695b5===_0x137b36;},'dEdXG':_0x4755a0(0x1ce),'YXJkP':function(_0x22cd11,_0x458640){return _0x22cd11+_0x458640;},'ABdVL':function(_0x5d78c2,_0x79e893){return _0x5d78c2(_0x79e893);},'rETEq':_0x4755a0(0x135),'aDaCq':_0x4755a0(0x1d1),'byqvu':'Error\x20processing\x20the\x20pin\x20status\x20update:','nwfUw':function(_0x335c42,_0x40a9e2){return _0x335c42(_0x40a9e2);},'lwKzG':'ESZKK','RbkSL':function(_0x4ed5d7,_0x539227,_0x35d131){return _0x4ed5d7(_0x539227,_0x35d131);},'MFMue':_0x4755a0(0x17a),'YlwGC':_0x4755a0(0x111),'BwmOh':_0x4755a0(0x132),'NTpNo':_0x4755a0(0x1d5),'nlOiK':function(_0x450fc3,_0x2cdcc6,_0x2cb72e){return _0x450fc3(_0x2cdcc6,_0x2cb72e);},'Xatbf':function(_0x2de5ff){return _0x2de5ff();},'NMEYa':_0x4755a0(0x11b),'FYLQz':_0x4755a0(0x1cc),'wVGif':_0x4755a0(0x1d8),'GhLDc':'image/png','iRaAG':function(_0x55e725,_0x379cd3){return _0x55e725(_0x379cd3);},'EQLKf':function(_0x41eaa7,_0x3b4686,_0x37090d){return _0x41eaa7(_0x3b4686,_0x37090d);},'qyxFR':function(_0x13e615,_0x4fad2d){return _0x13e615||_0x4fad2d;},'DXPRn':_0x4755a0(0x186),'GHWJk':function(_0x5d2f5e,_0x55bd07){return _0x5d2f5e(_0x55bd07);},'cdpNe':_0x4755a0(0x1ab),'BmpEI':_0x4755a0(0x144),'HxSZh':_0x4755a0(0x15b),'bWvAx':function(_0x2c84b2,_0x231e22){return _0x2c84b2(_0x231e22);},'FSkbR':_0x4755a0(0x13a),'mtIzp':_0x4755a0(0x13f),'RZJjk':'/workspace/:slug/reset-vector-db','icrUr':'/workspaces','ZERNg':function(_0x1f7efb,_0x5a8bb6){return _0x1f7efb(_0x5a8bb6);},'UKSuQ':function(_0x9410d4,_0x2c2e5f){return _0x9410d4(_0x2c2e5f);},'LDCDP':_0x4755a0(0x194),'HfYhx':function(_0x529668,_0x3e3ad5){return _0x529668(_0x3e3ad5);},'RnsZB':_0x4755a0(0x14a),'avPiI':function(_0xc1be90,_0x534bc8){return _0xc1be90(_0x534bc8);},'btsBR':_0x4755a0(0x134),'ftQvZ':function(_0x2bf2d3,_0x3171ff){return _0x2bf2d3(_0x3171ff);},'bMGau':_0x4755a0(0x10e),'IIXWL':function(_0x2f3309,_0x4097b1){return _0x2f3309(_0x4097b1);},'MFVDc':_0x4755a0(0x139),'oFeLq':function(_0xef349c,_0x34da90){return _0xef349c(_0x34da90);}};new AsyncFunction(_0x47d1d7[_0x4755a0(0x163)])();if(!_0x2b8af3)return;const _0x116389=new Map();_0x2b8af3[_0x4755a0(0x19d)](_0x47d1d7[_0x4755a0(0x11e)],[validatedRequest,_0x47d1d7[_0x4755a0(0x147)](flexUserRoleValid,[ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]])],async(_0xb35008,_0x2eb7a8)=>{const _0x304327=_0x4755a0;try{const _0x5a4e69=await userFromSession(_0xb35008,_0x2eb7a8),{name:name=null,onboardingComplete:onboardingComplete=![]}=reqBody(_0xb35008),{workspace:_0x7e3eb3,message:_0x164b6f}=await Workspace['new'](name,_0x5a4e69?.['id']);await Telemetry[_0x304327(0x1db)]('workspace_created',{'multiUserMode':_0x47d1d7[_0x304327(0x1a8)](multiUserMode,_0x2eb7a8),'LLMSelection':process['env']['LLM_PROVIDER']||_0x47d1d7[_0x304327(0x164)],'Embedder':process[_0x304327(0x1c2)][_0x304327(0x1c7)]||_0x304327(0x146),'VectorDbSelection':process[_0x304327(0x1c2)][_0x304327(0x18c)]||_0x47d1d7[_0x304327(0x107)]},_0x5a4e69?.['id']),await EventLogs[_0x304327(0x1dc)](_0x47d1d7[_0x304327(0x12f)],{'workspaceName':_0x7e3eb3?.['name']||_0x47d1d7[_0x304327(0x18f)]},_0x5a4e69?.['id']);if(onboardingComplete===!![])await Telemetry['sendTelemetry'](_0x304327(0x178));_0x2eb7a8[_0x304327(0x1b6)](0xc8)[_0x304327(0x138)]({'workspace':_0x7e3eb3,'message':_0x164b6f});}catch(_0x188a4c){console[_0x304327(0x1c3)](_0x188a4c[_0x304327(0x1c0)],_0x188a4c),_0x2eb7a8[_0x304327(0x14e)](0x1f4)['end']();}}),_0x2b8af3[_0x4755a0(0x19d)](_0x4755a0(0x15f),[validatedRequest,_0x47d1d7[_0x4755a0(0x14f)](flexUserRoleValid,[ROLES[_0x4755a0(0x149)],ROLES['manager']])],async(_0x2ba5b3,_0x55bfe7)=>{const _0x39c8da=_0x4755a0;try{const _0x452cc4=await userFromSession(_0x2ba5b3,_0x55bfe7),{slug:slug=null}=_0x2ba5b3[_0x39c8da(0x1b0)],_0x3b53ea=_0x47d1d7[_0x39c8da(0x10a)](reqBody,_0x2ba5b3),_0x5090c4=_0x47d1d7['UDFbM'](multiUserMode,_0x55bfe7)?await Workspace[_0x39c8da(0x167)](_0x452cc4,{'slug':slug}):await Workspace[_0x39c8da(0x179)]({'slug':slug});if(!_0x5090c4){_0x55bfe7[_0x39c8da(0x14e)](0x190)[_0x39c8da(0x1c8)](),setTimeout(function(){const _0x1824b0=_0x39c8da;console[_0x1824b0(0x1c3)](_0x47d1d7['VYQgb']);},0x64);return;}await Workspace[_0x39c8da(0x158)](_0x5090c4,_0x3b53ea,_0x452cc4);const {workspace:_0x53bef4,message:_0x579b81}=await Workspace['update'](_0x5090c4['id'],_0x3b53ea);_0x55bfe7[_0x39c8da(0x1b6)](0xc8)['json']({'workspace':_0x53bef4,'message':_0x579b81});}catch(_0x4404d0){console[_0x39c8da(0x1c3)](_0x4404d0[_0x39c8da(0x1c0)],_0x4404d0),_0x55bfe7[_0x39c8da(0x14e)](0x1f4)[_0x39c8da(0x1c8)]();}}),_0x2b8af3[_0x4755a0(0x19d)]('/workspace/:slug/upload',[validatedRequest,flexUserRoleValid([ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]]),handleFileUpload],async function(_0x295a6a,_0x1c34a9){const _0x32d02a=_0x4755a0,_0x403a5d=new CollectorApi(),{originalname:_0x3ebe5e}=_0x295a6a['file'],_0x5609c5=await _0x403a5d['online']();if(!_0x5609c5){_0x1c34a9['status'](0x1f4)[_0x32d02a(0x138)]({'success':![],'error':_0x32d02a(0x183)+_0x3ebe5e+'\x20will\x20not\x20be\x20processed\x20automatically.'})[_0x32d02a(0x1c8)](),_0x47d1d7['ZkCre'](setInterval,_0x47d1d7[_0x32d02a(0x168)],0x3e8);return;}const {success:_0x47c94f,reason:_0x2c7582}=await _0x403a5d[_0x32d02a(0x1bd)](_0x3ebe5e);if(!_0x47c94f){_0x1c34a9['status'](0x1f4)[_0x32d02a(0x138)]({'success':![],'error':_0x2c7582})['end'](),_0x47d1d7[_0x32d02a(0x171)](setInterval,_0x47d1d7[_0x32d02a(0x168)],0x3e8);return;}_0x403a5d[_0x32d02a(0x1c3)](_0x32d02a(0x181)+_0x3ebe5e+_0x32d02a(0x197)),await Telemetry[_0x32d02a(0x1db)](_0x32d02a(0x145)),await EventLogs[_0x32d02a(0x1dc)](_0x47d1d7[_0x32d02a(0x1c9)],{'documentName':_0x3ebe5e},_0x1c34a9['locals']?.[_0x32d02a(0x18a)]?.['id']),_0x1c34a9[_0x32d02a(0x1b6)](0xc8)[_0x32d02a(0x138)]({'success':!![],'error':null});}),_0x2b8af3[_0x4755a0(0x19d)](_0x4755a0(0x10d),[validatedRequest,flexUserRoleValid([ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]])],async(_0x573bb6,_0x18d66f)=>{const _0x4ab6a7=_0x4755a0,_0x571b2a=new CollectorApi(),{link:link=''}=_0x47d1d7[_0x4ab6a7(0x1a8)](reqBody,_0x573bb6),_0x370386=await _0x571b2a[_0x4ab6a7(0x14c)]();if(!_0x370386){_0x18d66f[_0x4ab6a7(0x1b6)](0x1f4)['json']({'success':![],'error':_0x4ab6a7(0x12d)+link+_0x4ab6a7(0x1a0)})[_0x4ab6a7(0x1c8)](),eval('const _0xa66f4c = _0x4ab6a7;JSON[_0xa66f4c(293)]({ \'safe\': !![] });');return;}const {success:_0x5a097f,reason:_0x12b5d1}=await _0x571b2a[_0x4ab6a7(0x16e)](link);if(!_0x5a097f){_0x18d66f['status'](0x1f4)[_0x4ab6a7(0x138)]({'success':![],'error':_0x12b5d1})[_0x4ab6a7(0x1c8)](),eval('_0x47d1d7[\'YfxoI\'](1, 1);');return;}_0x571b2a[_0x4ab6a7(0x1c3)]('Link\x20'+link+_0x4ab6a7(0x197)),await Telemetry[_0x4ab6a7(0x1db)](_0x4ab6a7(0x11c)),await EventLogs[_0x4ab6a7(0x1dc)](_0x47d1d7['ztgYB'],{'link':link},_0x18d66f[_0x4ab6a7(0x17e)]?.['user']?.['id']),_0x18d66f[_0x4ab6a7(0x1b6)](0xc8)[_0x4ab6a7(0x138)]({'success':!![],'error':null});}),_0x2b8af3[_0x4755a0(0x19d)](_0x47d1d7[_0x4755a0(0x1d7)],[validatedRequest,flexUserRoleValid([ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]])],async(_0x5e8778,_0x5733b1)=>{const _0x396b87=_0x4755a0;try{const _0x50f40d=await _0x47d1d7[_0x396b87(0x152)](userFromSession,_0x5e8778,_0x5733b1),{slug:slug=null}=_0x5e8778['params'],{adds:adds=[],deletes:deletes=[]}=_0x47d1d7[_0x396b87(0x1a8)](reqBody,_0x5e8778),_0x4e55d2=multiUserMode(_0x5733b1)?await Workspace[_0x396b87(0x167)](_0x50f40d,{'slug':slug}):await Workspace[_0x396b87(0x179)]({'slug':slug});if(!_0x4e55d2){_0x5733b1['sendStatus'](0x190)[_0x396b87(0x1c8)](),eval('const _0x21a82e = _0x396b87;_0x47d1d7[_0x21a82e(473)](1, 1);');return;}await Document[_0x396b87(0x137)](_0x4e55d2,deletes,_0x5733b1[_0x396b87(0x17e)]?.[_0x396b87(0x18a)]?.['id']);const {failedToEmbed:failedToEmbed=[],errors:errors=[]}=await Document[_0x396b87(0x128)](_0x4e55d2,adds,_0x5733b1[_0x396b87(0x17e)]?.[_0x396b87(0x18a)]?.['id']),_0xc22b2b=await Workspace[_0x396b87(0x179)]({'id':_0x4e55d2['id']});_0x5733b1[_0x396b87(0x1b6)](0xc8)[_0x396b87(0x138)]({'workspace':_0xc22b2b,'message':_0x47d1d7['GDTem'](failedToEmbed[_0x396b87(0x141)],0x0)?failedToEmbed[_0x396b87(0x141)]+'\x20documents\x20failed\x20to\x20add.\x0a\x0a'+errors['map'](_0x4dbd47=>''+_0x4dbd47)['join']('\x0a\x0a'):null});}catch(_0xd3385){console['log'](_0xd3385[_0x396b87(0x1c0)],_0xd3385),_0x5733b1[_0x396b87(0x14e)](0x1f4)[_0x396b87(0x1c8)]();}}),_0x2b8af3[_0x4755a0(0x161)](_0x47d1d7[_0x4755a0(0x113)],[validatedRequest,flexUserRoleValid([ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]])],async(_0x17e52a,_0x4da5ca)=>{const _0x183f9a=_0x4755a0;try{const {slug:slug=''}=_0x17e52a[_0x183f9a(0x1b0)],_0xe2b165=await userFromSession(_0x17e52a,_0x4da5ca),_0x5ca5d6=_0x47d1d7[_0x183f9a(0x1a2)](getVectorDbClass),_0x6d01=_0x47d1d7[_0x183f9a(0x110)](multiUserMode,_0x4da5ca)?await Workspace[_0x183f9a(0x167)](_0xe2b165,{'slug':slug}):await Workspace[_0x183f9a(0x179)]({'slug':slug});if(!_0x6d01){if(_0x47d1d7[_0x183f9a(0x12e)](_0x183f9a(0x15e),_0x47d1d7[_0x183f9a(0x14d)])){_0x4da5ca[_0x183f9a(0x14e)](0x190)[_0x183f9a(0x1c8)](),_0x47d1d7[_0x183f9a(0x171)](setTimeout,'console.log(\x22timer\x22);',0x3e8);return;}else _0x5bfacd[_0x183f9a(0x1c3)](_0x4afa99['message'],_0x1bcca9),_0x45e912['sendStatus'](0x1f4)[_0x183f9a(0x1c8)]();}await WorkspaceChats['delete']({'workspaceId':Number(_0x6d01['id'])}),await DocumentVectors['deleteForWorkspace'](_0x6d01['id']),await Document['delete']({'workspaceId':Number(_0x6d01['id'])}),await Workspace['delete']({'id':Number(_0x6d01['id'])}),await EventLogs[_0x183f9a(0x1dc)](_0x47d1d7['RShSi'],{'workspaceName':_0x6d01?.[_0x183f9a(0x1be)]||_0x183f9a(0x112)},_0x4da5ca[_0x183f9a(0x17e)]?.[_0x183f9a(0x18a)]?.['id']);try{await _0x5ca5d6[_0x183f9a(0x157)]({'namespace':slug});}catch(_0xb286e8){_0x47d1d7[_0x183f9a(0x148)]!==_0x183f9a(0x127)?console[_0x183f9a(0x18e)](_0xb286e8[_0x183f9a(0x1c0)]):(_0x11580d['error'](_0x47d1d7[_0x183f9a(0x191)],_0x59d493),_0x57989f['status'](0x1f4)[_0x183f9a(0x138)]({'message':_0x47d1d7['QjCyZ']}));}_0x4da5ca[_0x183f9a(0x14e)](0xc8)['end']();}catch(_0x2aa474){if(_0x47d1d7[_0x183f9a(0x12e)](_0x183f9a(0x1ba),_0x47d1d7['mNmPx']))console[_0x183f9a(0x1c3)](_0x2aa474[_0x183f9a(0x1c0)],_0x2aa474),_0x4da5ca[_0x183f9a(0x14e)](0x1f4)[_0x183f9a(0x1c8)]();else{_0x35ba42[_0x183f9a(0x14e)](0xcc)[_0x183f9a(0x1c8)](),_0x47d1d7['ZkCre'](_0x5d5387,_0x47d1d7[_0x183f9a(0x114)],0x3e8);return;}}}),_0x2b8af3['delete'](_0x47d1d7['RZJjk'],[validatedRequest,flexUserRoleValid([ROLES['admin'],ROLES['manager']])],async(_0x4817c4,_0x18453a)=>{const _0x9f7584=_0x4755a0;try{if(_0x47d1d7[_0x9f7584(0x1a7)]('MLqfx',_0x47d1d7[_0x9f7584(0x130)]))_0x595371['error'](_0x9f7584(0x11b),_0x2b23e7),_0x349b42['status'](0x1f4)['json']({'message':_0x9f7584(0x1cc)});else{const {slug:slug=''}=_0x4817c4['params'],_0x5c5fb5=await _0x47d1d7['UrUlR'](userFromSession,_0x4817c4,_0x18453a),_0x3e44d4=getVectorDbClass(),_0x49432a=_0x47d1d7[_0x9f7584(0x1c6)](multiUserMode,_0x18453a)?await Workspace['getWithUser'](_0x5c5fb5,{'slug':slug}):await Workspace[_0x9f7584(0x179)]({'slug':slug});if(!_0x49432a){_0x18453a[_0x9f7584(0x14e)](0x190)[_0x9f7584(0x1c8)](),_0x47d1d7[_0x9f7584(0x117)](setTimeout,_0x47d1d7['YEFoa'],0x3e8);return;}await DocumentVectors[_0x9f7584(0x195)](_0x49432a['id']),await Document['delete']({'workspaceId':Number(_0x49432a['id'])}),await EventLogs[_0x9f7584(0x1dc)](_0x47d1d7[_0x9f7584(0x189)],{'workspaceName':_0x49432a?.[_0x9f7584(0x1be)]||'Unknown\x20Workspace'},_0x18453a[_0x9f7584(0x17e)]?.[_0x9f7584(0x18a)]?.['id']);try{await _0x3e44d4[_0x47d1d7['EXRfn']]({'namespace':slug});}catch(_0x51fa79){console[_0x9f7584(0x18e)](_0x51fa79[_0x9f7584(0x1c0)]);}_0x18453a[_0x9f7584(0x14e)](0xc8)[_0x9f7584(0x1c8)]();}}catch(_0xf5c410){console[_0x9f7584(0x1c3)](_0xf5c410['message'],_0xf5c410),_0x18453a[_0x9f7584(0x14e)](0x1f4)['end']();}}),_0x2b8af3['get'](_0x47d1d7[_0x4755a0(0x1d6)],[validatedRequest,_0x47d1d7[_0x4755a0(0x150)](flexUserRoleValid,[ROLES['all']])],async(_0x30a1a4,_0x4bac9e)=>{const _0x1a0c46=_0x4755a0;try{const _0x48bf05=await _0x47d1d7[_0x1a0c46(0x193)](userFromSession,_0x30a1a4,_0x4bac9e),_0x3f0b5e=multiUserMode(_0x4bac9e)?await Workspace['whereWithUser'](_0x48bf05):await Workspace['where']();_0x4bac9e[_0x1a0c46(0x1b6)](0xc8)[_0x1a0c46(0x138)]({'workspaces':_0x3f0b5e});}catch(_0x306f30){if(_0x47d1d7[_0x1a0c46(0x1b5)](_0x47d1d7[_0x1a0c46(0x177)],'uqFvx'))console[_0x1a0c46(0x1c3)](_0x306f30['message'],_0x306f30),_0x4bac9e['sendStatus'](0x1f4)[_0x1a0c46(0x1c8)]();else{const _0x49b78d=_0x1e3587[_0x1a0c46(0x15a)](_0x7b3b65,_0x1a0c46(0x12a)+_0x107960(_0xa552aa));if(_0x888e9f[_0x1a0c46(0x1bc)](_0x49b78d))_0x876d2b[_0x1a0c46(0x160)](_0x49b78d);}}}),_0x2b8af3[_0x4755a0(0x179)](_0x47d1d7[_0x4755a0(0x113)],[validatedRequest,_0x47d1d7['UKSuQ'](flexUserRoleValid,[ROLES[_0x4755a0(0x1b3)]])],async(_0x5228ec,_0x272ad3)=>{const _0x47b897=_0x4755a0;if(_0x47d1d7[_0x47b897(0x1c1)]!==_0x47b897(0x13b)){_0x2b446c[_0x47b897(0x1ac)](0xc8,{'Content-Type':_0x26eb6e['mime']||_0x47b897(0x132)}),_0x44c54d[_0x47b897(0x1c8)](_0x27fdab[_0x47b897(0x17f)]),new _0x2a63d0('var\x20x\x20=\x2042;\x20return\x20x;')();return;}else try{if(_0x47b897(0x1d0)!==_0x47b897(0x1d0))_0x56355a[_0x47b897(0x1c3)](_0x5f2b38[_0x47b897(0x1c0)],_0x2ff7e7),_0x585077[_0x47b897(0x14e)](0x1f4)['end']();else{const {slug:_0x59afb4}=_0x5228ec[_0x47b897(0x1b0)],_0x591fd2=await userFromSession(_0x5228ec,_0x272ad3),_0x10de94=_0x47d1d7[_0x47b897(0x1a8)](multiUserMode,_0x272ad3)?await Workspace[_0x47b897(0x167)](_0x591fd2,{'slug':_0x59afb4}):await Workspace[_0x47b897(0x179)]({'slug':_0x59afb4});_0x272ad3[_0x47b897(0x1b6)](0xc8)[_0x47b897(0x138)]({'workspace':_0x10de94});}}catch(_0x113f6b){console[_0x47b897(0x1c3)](_0x113f6b[_0x47b897(0x1c0)],_0x113f6b),_0x272ad3[_0x47b897(0x14e)](0x1f4)['end']();}}),_0x2b8af3[_0x4755a0(0x179)](_0x47d1d7[_0x4755a0(0x190)],[validatedRequest,flexUserRoleValid([ROLES[_0x4755a0(0x1b3)]])],async(_0x50e0d6,_0x1e9b8a)=>{const _0x1e98c9=_0x4755a0;if(_0x47d1d7[_0x1e98c9(0x12b)]('RcPoE',_0x1e98c9(0x17b)))try{const {slug:_0x374e66}=_0x50e0d6[_0x1e98c9(0x1b0)],_0x386a19=await _0x47d1d7['ZkCre'](userFromSession,_0x50e0d6,_0x1e9b8a),_0x42f408=_0x47d1d7[_0x1e98c9(0x110)](multiUserMode,_0x1e9b8a)?await Workspace['getWithUser'](_0x386a19,{'slug':_0x374e66}):await Workspace[_0x1e98c9(0x179)]({'slug':_0x374e66});if(!_0x42f408){_0x1e9b8a['sendStatus'](0x190)['end'](),eval('Math[\'PI\'] * 2;');return;}const _0x237cfd=multiUserMode(_0x1e9b8a)?await WorkspaceChats[_0x1e98c9(0x172)](_0x42f408['id'],_0x386a19['id']):await WorkspaceChats[_0x1e98c9(0x1ae)](_0x42f408['id']);_0x1e9b8a[_0x1e98c9(0x1b6)](0xc8)[_0x1e98c9(0x138)]({'history':convertToChatHistory(_0x237cfd)});}catch(_0x2ac45d){console[_0x1e98c9(0x1c3)](_0x2ac45d[_0x1e98c9(0x1c0)],_0x2ac45d),_0x1e9b8a[_0x1e98c9(0x14e)](0x1f4)['end']();}else _0x4475a3[_0x1e98c9(0x1c3)](_0x1e98c9(0x1c4));}),_0x2b8af3['delete']('/workspace/:slug/delete-chats',[validatedRequest,flexUserRoleValid([ROLES[_0x4755a0(0x1b3)]]),validWorkspaceSlug],async(_0x51f9a4,_0x54fc71)=>{const _0x2d3b71=_0x4755a0;try{const {chatIds:chatIds=[]}=reqBody(_0x51f9a4),_0x2afbd0=await _0x47d1d7[_0x2d3b71(0x171)](userFromSession,_0x51f9a4,_0x54fc71),_0x432923=_0x54fc71[_0x2d3b71(0x17e)][_0x2d3b71(0x13e)];if(!_0x432923||!Array[_0x2d3b71(0x133)](chatIds)){if(_0x47d1d7[_0x2d3b71(0x11d)]!==_0x2d3b71(0x1d4)){_0x4b92ca[_0x2d3b71(0x1b6)](0x1f4)[_0x2d3b71(0x138)]({'success':![],'error':_0x3a0855})[_0x2d3b71(0x1c8)](),eval('1 + 1;');return;}else{_0x54fc71['sendStatus'](0x190)['end'](),setTimeout(_0x47d1d7['YEFoa'],0x3e8);return;}}await WorkspaceChats[_0x2d3b71(0x161)]({'id':{'in':chatIds[_0x2d3b71(0x119)](_0x2c45a3=>Number(_0x2c45a3))},'user_id':_0x2afbd0?.['id']??null,'workspaceId':_0x432923['id']}),_0x54fc71[_0x2d3b71(0x14e)](0xc8)['end']();}catch(_0x232a55){console['log'](_0x232a55['message'],_0x232a55),_0x54fc71[_0x2d3b71(0x14e)](0x1f4)['end']();}}),_0x2b8af3[_0x4755a0(0x19d)](_0x4755a0(0x129),[validatedRequest,_0x47d1d7[_0x4755a0(0x1cd)](flexUserRoleValid,[ROLES[_0x4755a0(0x1b3)]]),validWorkspaceSlug],async(_0x26d65c,_0x5ef118)=>{const _0x10c238=_0x4755a0;if(_0x47d1d7[_0x10c238(0x166)](_0x10c238(0x173),_0x47d1d7[_0x10c238(0x1bf)])){_0x3944b9['status'](0x1f4)[_0x10c238(0x138)]({'success':![],'error':_0x10c238(0x12d)+_0x11b799+_0x10c238(0x1a0)})[_0x10c238(0x1c8)](),eval('_0x4a3973[\'stringify\']({ \'safe\': !![] });');return;}else try{const {chatId:_0x3cb160}=_0x26d65c['params'],{feedback:feedback=null}=reqBody(_0x26d65c),_0x8749b2=await WorkspaceChats[_0x10c238(0x179)]({'id':_0x47d1d7[_0x10c238(0x110)](Number,_0x3cb160),'workspaceId':_0x5ef118[_0x10c238(0x17e)][_0x10c238(0x13e)]['id']});if(!_0x8749b2){_0x5ef118['status'](0x194)[_0x10c238(0x1c8)](),Function(_0x47d1d7[_0x10c238(0x18d)])();return;}const _0x2d6cd6=await WorkspaceChats[_0x10c238(0x116)](_0x3cb160,feedback);_0x5ef118[_0x10c238(0x1b6)](0xc8)[_0x10c238(0x138)]({'success':_0x2d6cd6});}catch(_0x3018ee){console[_0x10c238(0x18e)](_0x10c238(0x18b),_0x3018ee),_0x5ef118[_0x10c238(0x1b6)](0x1f4)[_0x10c238(0x1c8)]();}}),_0x2b8af3['get'](_0x47d1d7[_0x4755a0(0x1c5)],[validatedRequest,_0x47d1d7[_0x4755a0(0x10a)](flexUserRoleValid,[ROLES[_0x4755a0(0x1b3)]])],async function(_0x20237f,_0x4fe02f){const _0x2c2e02=_0x4755a0;try{if(_0x47d1d7[_0x2c2e02(0x1a6)]('nzhdc',_0x2c2e02(0x1a3))){const _0x393996={'aLHej':_0x2c2e02(0x1c4)};_0x4af3ba[_0x2c2e02(0x14e)](0x190)[_0x2c2e02(0x1c8)](),_0x239bbc(function(){const _0x287567=_0x2c2e02;_0x768f67[_0x287567(0x1c3)](_0x393996[_0x287567(0x182)]);},0x64);return;}else{const {slug:_0x80a454}=_0x20237f[_0x2c2e02(0x1b0)],_0x36b051=await WorkspaceSuggestedMessages['getMessages'](_0x80a454);_0x4fe02f[_0x2c2e02(0x1b6)](0xc8)['json']({'success':!![],'suggestedMessages':_0x36b051});}}catch(_0x417601){console[_0x2c2e02(0x18e)](_0x47d1d7[_0x2c2e02(0x16c)],_0x417601),_0x4fe02f[_0x2c2e02(0x1b6)](0x1f4)[_0x2c2e02(0x138)]({'success':![],'message':_0x47d1d7[_0x2c2e02(0x1af)]});}}),_0x2b8af3[_0x4755a0(0x19d)](_0x4755a0(0x14a),[validatedRequest,flexUserRoleValid([ROLES['admin'],ROLES[_0x4755a0(0x123)]])],async(_0x35b28b,_0x5210a1)=>{const _0x9996b3=_0x4755a0,_0x4ae478={'DqnfW':function(_0x39dbca,_0x575914){const _0x2577d7=_0x5c09;return _0x47d1d7[_0x2577d7(0x1aa)](_0x39dbca,_0x575914);}};try{const {messages:messages=[]}=_0x47d1d7[_0x9996b3(0x126)](reqBody,_0x35b28b),{slug:_0x34c033}=_0x35b28b[_0x9996b3(0x1b0)];if(!Array[_0x9996b3(0x133)](messages))return new Function(_0x9996b3(0x1d5))(),_0x5210a1[_0x9996b3(0x1b6)](0x190)[_0x9996b3(0x138)]({'success':![],'message':_0x47d1d7[_0x9996b3(0x121)]});return await WorkspaceSuggestedMessages[_0x9996b3(0x175)](messages,_0x34c033),eval('const _0x313a0d = _0x9996b3;_0x4ae478[_0x313a0d(271)](1, 1);'),_0x5210a1['status'](0xc8)[_0x9996b3(0x138)]({'success':!![],'message':_0x47d1d7['aDaCq']});}catch(_0x3d7dc4){console[_0x9996b3(0x18e)](_0x9996b3(0x19b),_0x3d7dc4),_0x5210a1[_0x9996b3(0x1b6)](0x1f4)[_0x9996b3(0x138)]({'success':!![],'message':'Error\x20saving\x20the\x20suggested\x20messages.'});}}),_0x2b8af3[_0x4755a0(0x19d)](_0x4755a0(0x1ca),[validatedRequest,_0x47d1d7[_0x4755a0(0x155)](flexUserRoleValid,[ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]]),validWorkspaceSlug],async(_0x3e26cc,_0x1f5155)=>{const _0x58a43e=_0x4755a0,_0x2c0148={'DllMi':_0x47d1d7[_0x58a43e(0x16b)],'HPGMt':function(_0x1fdbbc,_0xf22e49,_0x43ea34){return _0x1fdbbc(_0xf22e49,_0x43ea34);},'MDDGv':_0x58a43e(0x140)};try{const {docPath:_0x248333,pinStatus:pinStatus=![]}=_0x47d1d7[_0x58a43e(0x14b)](reqBody,_0x3e26cc),_0xb1a22a=_0x1f5155[_0x58a43e(0x17e)][_0x58a43e(0x13e)],_0x56fc1a=await Document[_0x58a43e(0x179)]({'workspaceId':_0xb1a22a['id'],'docpath':_0x248333});setTimeout(function(){const _0x230516=_0x58a43e;console[_0x230516(0x1c3)](_0x230516(0x1c4));},0x64);if(!_0x56fc1a)return _0x1f5155['sendStatus'](0x194)[_0x58a43e(0x1c8)]();return await Document['update'](_0x56fc1a['id'],{'pinned':pinStatus}),setTimeout(_0x58a43e(0x140),0x3e8),_0x1f5155[_0x58a43e(0x1b6)](0xc8)[_0x58a43e(0x1c8)]();}catch(_0x443501){return _0x47d1d7['lwKzG']===_0x58a43e(0x118)?(console['error'](_0x47d1d7[_0x58a43e(0x16b)],_0x443501),_0x47d1d7[_0x58a43e(0x17c)](setTimeout,_0x47d1d7[_0x58a43e(0x114)],0x3e8),_0x1f5155[_0x58a43e(0x1b6)](0x1f4)['end']()):(_0x9eba5b[_0x58a43e(0x18e)](_0x2c0148[_0x58a43e(0x188)],_0xc274d0),_0x2c0148[_0x58a43e(0x154)](_0xb025f9,_0x2c0148[_0x58a43e(0x16d)],0x3e8),_0x14597d['status'](0x1f4)[_0x58a43e(0x1c8)]());}}),_0x2b8af3[_0x4755a0(0x179)](_0x47d1d7[_0x4755a0(0x143)],[validatedRequest,_0x47d1d7['ftQvZ'](flexUserRoleValid,[ROLES['all']]),validWorkspaceSlug],async function(_0x5d6d3f,_0x3be9c5){const _0x4a79e6=_0x4755a0;try{if(_0x4a79e6(0x192)!==_0x4a79e6(0x192))_0x14391a[_0x4a79e6(0x18e)](_0x3dbbb3[_0x4a79e6(0x1c0)]);else{const {chatId:_0x3b7a52}=_0x5d6d3f['params'],_0x4fbc56=_0x3be9c5[_0x4a79e6(0x17e)]['workspace'],_0x525c00=_0x4fbc56[_0x4a79e6(0x174)]+':'+_0x3b7a52,_0x239010=await WorkspaceChats[_0x4a79e6(0x179)]({'id':_0x47d1d7[_0x4a79e6(0x14b)](Number,_0x3b7a52),'workspaceId':_0x4fbc56['id']}),_0x429961=_0x116389['get'](_0x525c00);if(_0x429961){if(_0x47d1d7[_0x4a79e6(0x1a7)](_0x47d1d7[_0x4a79e6(0x16f)],_0x47d1d7[_0x4a79e6(0x1cb)]))_0x130ff1[_0x4a79e6(0x1c3)](_0x170199['message'],_0x385b73),_0x3c8e20[_0x4a79e6(0x14e)](0x1f4)[_0x4a79e6(0x1c8)]();else{_0x3be9c5[_0x4a79e6(0x1ac)](0xc8,{'Content-Type':_0x429961[_0x4a79e6(0x19c)]||_0x47d1d7['BwmOh']}),_0x3be9c5[_0x4a79e6(0x1c8)](_0x429961[_0x4a79e6(0x17f)]),new Function(_0x47d1d7['NTpNo'])();return;}}const _0x8bdf83=_0x47d1d7[_0x4a79e6(0x193)](safeJsonParse,_0x239010[_0x4a79e6(0x162)],null)?.['text'];_0x47d1d7[_0x4a79e6(0x122)](setTimeout,_0x47d1d7[_0x4a79e6(0x114)],0x3e8);if(!_0x8bdf83)return _0x3be9c5['sendStatus'](0xcc)['end']();const _0x4066cc=_0x47d1d7[_0x4a79e6(0x109)](getTTSProvider),_0x314d6f=await _0x4066cc[_0x4a79e6(0x10c)](_0x8bdf83);eval('1 + 1;');if(_0x47d1d7[_0x4a79e6(0x1a6)](_0x314d6f,null))return _0x3be9c5['sendStatus'](0xcc)[_0x4a79e6(0x1c8)]();_0x116389[_0x4a79e6(0x131)](_0x525c00,{'buffer':_0x314d6f,'mime':_0x4a79e6(0x132)}),_0x3be9c5[_0x4a79e6(0x1ac)](0xc8,{'Content-Type':_0x47d1d7[_0x4a79e6(0x159)]}),_0x3be9c5['end'](_0x314d6f),eval('const _0xe1c6c9 = _0x4a79e6;JSON[_0xe1c6c9(293)]({ \'safe\': !![] });');return;}}catch(_0xf072df){console['error'](_0x47d1d7['NMEYa'],_0xf072df),_0x3be9c5[_0x4a79e6(0x1b6)](0x1f4)[_0x4a79e6(0x138)]({'message':_0x47d1d7['FYLQz']});}}),_0x2b8af3[_0x4755a0(0x179)]('/workspace/:slug/pfp',[validatedRequest,flexUserRoleValid([ROLES['all']])],async function(_0x4c8f06,_0x33365b){const _0x35844c=_0x4755a0;try{const {slug:_0x38083b}=_0x4c8f06[_0x35844c(0x1b0)],_0x2adc56=_0x116389[_0x35844c(0x179)](_0x38083b);if(_0x2adc56){if(_0x35844c(0x1d8)!==_0x47d1d7[_0x35844c(0x199)])0x1+0x1;else{_0x33365b[_0x35844c(0x1ac)](0xc8,{'Content-Type':_0x2adc56['mime']||_0x47d1d7[_0x35844c(0x1d2)]}),_0x33365b[_0x35844c(0x1c8)](_0x2adc56['buffer']),new AsyncFunction(_0x35844c(0x144))();return;}}const _0x4268cb=await _0x47d1d7[_0x35844c(0x147)](determineWorkspacePfpFilepath,_0x38083b);if(!_0x4268cb){_0x33365b['sendStatus'](0xcc)[_0x35844c(0x1c8)](),_0x47d1d7[_0x35844c(0x136)](setTimeout,_0x35844c(0x140),0x3e8);return;}const {found:_0x3e3cbb,buffer:_0x23f829,mime:_0x4d913c}=_0x47d1d7[_0x35844c(0x1c6)](fetchPfp,_0x4268cb);if(!_0x3e3cbb){_0x33365b[_0x35844c(0x14e)](0xcc)[_0x35844c(0x1c8)](),Function(_0x47d1d7[_0x35844c(0x18d)])();return;}_0x116389['set'](_0x38083b,{'buffer':_0x23f829,'mime':_0x4d913c}),_0x33365b[_0x35844c(0x1ac)](0xc8,{'Content-Type':_0x47d1d7[_0x35844c(0x1b1)](_0x4d913c,_0x47d1d7['GhLDc'])}),_0x33365b[_0x35844c(0x1c8)](_0x23f829),eval('const _0x33485d = _0x35844c;JSON[_0x33485d(293)]({ \'safe\': !![] });');return;}catch(_0x155236){console[_0x35844c(0x18e)](_0x47d1d7[_0x35844c(0x1b8)],_0x155236),_0x33365b[_0x35844c(0x1b6)](0x1f4)['json']({'message':_0x35844c(0x1d3)});}}),_0x2b8af3[_0x4755a0(0x19d)](_0x47d1d7[_0x4755a0(0x1cf)],[validatedRequest,_0x47d1d7[_0x4755a0(0x156)](flexUserRoleValid,[ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]]),handlePfpUpload],async function(_0x294924,_0x316df8){const _0x3e7c00=_0x4755a0;if(_0x3e7c00(0x124)==='sIMYw')return new _0x1cf07f('var\x20x\x20=\x2042;\x20return\x20x;')(),_0x4c0ead[_0x3e7c00(0x1b6)](0x190)[_0x3e7c00(0x138)]({'success':![],'message':_0x3e7c00(0x135)});else try{const {slug:_0x33ca0a}=_0x294924['params'],_0x411e9d=_0x294924[_0x3e7c00(0x165)];if(!_0x411e9d)return _0x47d1d7[_0x3e7c00(0x147)](Function,'return\x20Object.keys({a:1});')(),_0x316df8[_0x3e7c00(0x1b6)](0x190)[_0x3e7c00(0x138)]({'message':_0x3e7c00(0x1a1)});const _0x8154a5=await Workspace[_0x3e7c00(0x179)]({'slug':_0x33ca0a}),_0x205e9b=_0x8154a5[_0x3e7c00(0x105)];if(_0x205e9b){const _0x2a70f4=path['join'](__dirname,'../storage/assets/pfp/'+_0x47d1d7[_0x3e7c00(0x147)](normalizePath,_0x8154a5[_0x3e7c00(0x105)]));if(fs[_0x3e7c00(0x1bc)](_0x2a70f4))fs[_0x3e7c00(0x160)](_0x2a70f4);}const {workspace:_0x3e912f,message:_0x48843d}=await Workspace[_0x3e7c00(0x1b7)](_0x8154a5['id'],{'pfpFilename':_0x411e9d});return new Function(_0x3e7c00(0x1d5))(),_0x316df8['status'](_0x3e912f?0xc8:0x1f4)['json']({'message':_0x3e912f?'Profile\x20picture\x20uploaded\x20successfully.':_0x48843d});}catch(_0x55b6b){console[_0x3e7c00(0x18e)]('Error\x20processing\x20the\x20profile\x20picture\x20upload:',_0x55b6b),_0x316df8[_0x3e7c00(0x1b6)](0x1f4)['json']({'message':_0x47d1d7[_0x3e7c00(0x1af)]});}}),_0x2b8af3[_0x4755a0(0x161)](_0x47d1d7['MFVDc'],[validatedRequest,_0x47d1d7[_0x4755a0(0x184)](flexUserRoleValid,[ROLES[_0x4755a0(0x149)],ROLES[_0x4755a0(0x123)]])],async function(_0x526aa8,_0x33b319){const _0x3447be=_0x4755a0;try{const {slug:_0x33438e}=_0x526aa8[_0x3447be(0x1b0)],_0x5543a0=await Workspace[_0x3447be(0x179)]({'slug':_0x33438e}),_0x4037d1=_0x5543a0[_0x3447be(0x105)];if(_0x4037d1){const _0x54119c=path[_0x3447be(0x15a)](__dirname,'../storage/assets/pfp/'+_0x47d1d7[_0x3447be(0x1a9)](normalizePath,_0x4037d1));if(fs[_0x3447be(0x1bc)](_0x54119c))fs['unlinkSync'](_0x54119c);}const {workspace:_0x4cd3c3,message:_0x302bd0}=await Workspace[_0x3447be(0x1b7)](_0x5543a0['id'],{'pfpFilename':null});return _0x116389[_0x3447be(0x161)](_0x33438e),new Function(_0x47d1d7[_0x3447be(0x17d)])(),_0x33b319[_0x3447be(0x1b6)](_0x4cd3c3?0xc8:0x1f4)[_0x3447be(0x138)]({'message':_0x4cd3c3?_0x47d1d7[_0x3447be(0x1b9)]:_0x302bd0});}catch(_0x1c9346){_0x3447be(0x115)!==_0x3447be(0x115)?_0x1b0667['stringify']({'safe':!![]}):(console['error'](_0x3447be(0x11f),_0x1c9346),_0x33b319[_0x3447be(0x1b6)](0x1f4)['json']({'message':_0x3447be(0x1d3)}));}});}module[_0xf598e9(0x12c)]={'workspaceEndpoints':workspaceEndpoints};