const _0x247dc6=_0x87fe;function _0x4abe(){const _0xc07769=['pdqzz','should\x20throw\x20error\x20for\x20invalid\x20signature\x20verification','returnValue','EsZge','https://malicious.url.com/key.cer','verifySignature','com.example.insecure.app','GbdFu','ZBdEA','7715330nPXydQ','should\x20fetch\x20and\x20validate\x20Apple\x20certificate','invalid-key','44872qjePXl','GET','saltST==','toThrow','com.valid.app','2874fHjEvK','wnOAw','GameCenterAuth\x20Adapter','bundleId','7752065otukrK','mSQWS','../../support/cert/gc-prod-4.cer','toBeRejectedWithError','Invalid\x20publicKeyUrl','resolve','xzpLM','UkSkr','cloud.xtralife.gamecenterauth','Test\x20config\x20failing\x20due\x20to\x20missing\x20params\x20or\x20wrong\x20types','oQKiE','JFkFW','getAppleCertificate','and','should\x20not\x20use\x20bundle\x20id\x20from\x20authData\x20payload\x20in\x20insecure\x20mode','OoEJV','51vGbCJE','should\x20throw\x20error\x20for\x20invalid\x20publicKeyUrl','https://static.gc.apple.com/public-key/gc-prod-4.cer','lKUMK','vcuHp','Test\x20payload\x20fails\x20due\x20to\x20incorrect\x20appId\x20/\x20certificate','426996LTNgra','GrQJR','node-forge','lexKO','HSMeT','fqPNZ','QjRWs','byteOffset','should\x20successfully\x20process\x20valid\x20payload\x20and\x20save\x20auth\x20data','711MsYsjJ','vugjD','invalidSignature','toString','FnpCZ','not','uxpop','1234567','gWzSK','Test\x20payload\x20passing','7060phNXQg','path','should\x20verify\x20signature\x20successfully','verifyPublicKeyIssuer','throwError','nGiGD','Test\x20payload\x20failing\x20due\x20to\x20missing\x20params\x20or\x20wrong\x20types','DHLkF','should\x20not\x20use\x20bundle\x20id\x20from\x20authData\x20payload\x20in\x20secure\x20mode','validateOptions','G:1965586982','oHvln','slice','DzqqrQ==','jHdkP','should\x20throw\x20error\x20for\x20invalid\x20options','default','uuwUF','ZFPdv','48541290DaLLIZ','Certificate\x20and\x20Signature\x20Validation','application/x-pem-file','withContext','gOslQ','validSignature','stringify','CUnIY','feFHY','mockCertificate','length','53148TGJSEU','uqLBTr9Uex8zCpc1UQ1MIDMitb+HUat2Mah4Kw6AVLSGe0gGNJXlih2i5X+0ZwVY0S9zY2NHWi2gFjmhjt/4kxWGMkupqXX5H/qhE2m7hzox6lZJpH98ZEUbouWRfZX2ZhUlCkAX09oRNi7fI7mWL1/o88MaI/y6k6tLr14JTzmlxgdyhw+QRLxRPA6NuvUlRSJpyJ4aGtNH5/wHdKQWL8nUnFYiYmaY8R7IjzNxPfy8UJTUWmeZvMSgND4u8EjADPsz7ZtZyWAPi8kYcAb6M8k0jwLD3vrYCB8XXyO2RQb/FY2TM4zJuI7PzLlvvgOJXbbfVtHx7Evnm5NYoyzgzw==','beWsY','pQoHJ','validKey','xALEJ','../../support/cert/DigiCertTrustedG4CodeSigningRSA4096SHA3842021CA1.crt.pem','toBeResolved','../../../lib/Adapters/Auth/gcenter','AhbSy','rfqnS','Invalid\x20publicKeyUrl:\x20https://malicious.url.com/key.cer','buffer','validateAuthData','zyVeI','content-length','sWkWD','should\x20validate\x20options\x20successfully\x20with\x20valid\x20parameters','zzrkS','publicKeyUrl','enableInsecureAuth','erXgl','RArEl','xDMAo','skAde','https://cacerts.digicert.com/DigiCertTrustedG4CodeSigningRSA4096SHA3842021CA1.crt.pem'];_0x4abe=function(){return _0xc07769;};return _0x4abe();}(function(_0x3b1b2a,_0x4fd1cc){const _0x454dfd=_0x87fe,_0x5305de=_0x3b1b2a();while(!![]){try{const _0x28a32c=parseInt(_0x454dfd(0xb0))/0x1*(-parseInt(_0x454dfd(0xe7))/0x2)+-parseInt(_0x454dfd(0x9c))/0x3*(parseInt(_0x454dfd(0xc9))/0x4)+-parseInt(_0x454dfd(0xa0))/0x5+-parseInt(_0x454dfd(0xb6))/0x6+parseInt(_0x454dfd(0x94))/0x7+parseInt(_0x454dfd(0x97))/0x8*(-parseInt(_0x454dfd(0xbf))/0x9)+parseInt(_0x454dfd(0xdc))/0xa;if(_0x28a32c===_0x4fd1cc)break;else _0x5305de['push'](_0x5305de['shift']());}catch(_0x1896a8){_0x5305de['push'](_0x5305de['shift']());}}}(_0x4abe,0xce6ad));const GameCenterAuth=require(_0x247dc6(0xef))[_0x247dc6(0xd9)],{pki}=require(_0x247dc6(0xb8)),fs=require('fs'),path=require(_0x247dc6(0xca));function _0x87fe(_0x182213,_0x3ff206){const _0x4abedb=_0x4abe();return _0x87fe=function(_0x87fe5d,_0x4c3b79){_0x87fe5d=_0x87fe5d-0x7a;let _0x5ba6e3=_0x4abedb[_0x87fe5d];return _0x5ba6e3;},_0x87fe(_0x182213,_0x3ff206);}describe(_0x247dc6(0x9e),function(){const _0x39855f=_0x247dc6,_0x139902={'cRVEb':_0x39855f(0xed),'zyVeI':function(_0x1b5079,_0x400027){return _0x1b5079(_0x400027);},'jHdkP':_0x39855f(0x80),'CUnIY':function(_0x32d5b2,_0x2a1453,_0x559860){return _0x32d5b2(_0x2a1453,_0x559860);},'rfqnS':_0x39855f(0xd8),'MpqIC':function(_0x1ef3fa,_0x5b225b){return _0x1ef3fa===_0x5b225b;},'OoEJV':_0x39855f(0xaa),'mSQWS':function(_0x40c594,_0x44e885,_0x16ef54){return _0x40c594(_0x44e885,_0x16ef54);},'nGiGD':'fetchCertificate','gOslQ':_0x39855f(0xa4),'uuwUF':function(_0xcd42ea,_0x2b5e9f){return _0xcd42ea(_0x2b5e9f);},'vcuHp':_0x39855f(0x7c),'xDMAo':_0x39855f(0x99),'OxKNX':_0x39855f(0xc1),'DHLkF':function(_0x59a5a0,_0x3b8b35,_0x111120){return _0x59a5a0(_0x3b8b35,_0x111120);},'QjRWs':_0x39855f(0xac),'vugjD':'Invalid\x20signature.','uxpop':_0x39855f(0xb1),'wnOAw':_0x39855f(0xc6),'FnpCZ':_0x39855f(0xe1),'DskCC':_0x39855f(0x9b),'ZBdEA':_0x39855f(0xeb),'GOYpG':function(_0x3eeef7,_0x2fcba0,_0x4ef9bb){return _0x3eeef7(_0x2fcba0,_0x4ef9bb);},'GbdFu':function(_0x2bc1af,_0x587448){return _0x2bc1af(_0x587448);},'skAde':function(_0x2e2996,_0x159d95){return _0x2e2996===_0x159d95;},'pQoHJ':_0x39855f(0xe8),'HSMeT':_0x39855f(0xd6),'sWkWD':_0x39855f(0xa8),'lexKO':_0x39855f(0xd3),'xzpLM':_0x39855f(0x91),'beWsY':function(_0xfe7385,_0x5957e2){return _0xfe7385(_0x5957e2);},'lKUMK':function(_0x52893f,_0x5dd3f6,_0x52cc5f){return _0x52893f(_0x5dd3f6,_0x52cc5f);},'IHwDE':'https://static.gc.apple.com/public-key/gc-prod-4.cer','feFHY':function(_0x32afed,_0x1bbe7d,_0x1f2a02){return _0x32afed(_0x1bbe7d,_0x1f2a02);},'GrQJR':_0x39855f(0xe5),'xALEJ':_0x39855f(0x95),'gWzSK':_0x39855f(0xd1),'RArEl':function(_0x3907e7,_0x3e2b87,_0x58ec79){return _0x3907e7(_0x3e2b87,_0x58ec79);},'AhbSy':'can\x20\x20use\x20bundle\x20id\x20from\x20authData\x20payload\x20in\x20insecure\x20mode','zzrkS':_0x39855f(0xa9),'JuOSt':_0x39855f(0xb5),'KAWti':function(_0x24c566,_0x1f825d,_0xa2fb7c){return _0x24c566(_0x1f825d,_0xa2fb7c);},'JFkFW':_0x39855f(0xc8),'ZFPdv':_0x39855f(0xdd)};let _0x4a8c51;beforeEach(function(){const _0x58fab2=_0x39855f;_0x4a8c51=new GameCenterAuth['constructor']();const _0x2e2e33=fs['readFileSync'](path[_0x58fab2(0xa5)](__dirname,_0x58fab2(0xa2))),_0x4970f9=fs['readFileSync'](path[_0x58fab2(0xa5)](__dirname,_0x139902['cRVEb']))[_0x58fab2(0xc2)]();_0x139902['zyVeI'](mockFetch,[{'url':_0x58fab2(0xb2),'method':'GET','response':{'ok':!![],'headers':new Map(),'arrayBuffer':()=>Promise[_0x58fab2(0xa5)](_0x2e2e33[_0x58fab2(0x7d)][_0x58fab2(0xd5)](_0x2e2e33[_0x58fab2(0xbd)],_0x2e2e33[_0x58fab2(0xbd)]+_0x2e2e33[_0x58fab2(0xe6)]))}},{'url':_0x58fab2(0x8a),'method':_0x58fab2(0x98),'response':{'ok':!![],'headers':new Map([['content-type',_0x58fab2(0xde)],[_0x139902[_0x58fab2(0xd7)],_0x4970f9['length']['toString']()]]),'text':()=>Promise[_0x58fab2(0xa5)](_0x4970f9)}}]);}),_0x139902[_0x39855f(0xe3)](describe,_0x139902[_0x39855f(0x83)],function(){const _0x2eb6d9=_0x39855f;_0x139902[_0x2eb6d9(0xe3)](it,_0x139902['rfqnS'],async function(){const _0x1f0d46=_0x2eb6d9,_0x3f557a=[null,undefined,{},{'bundleId':''},{'enableInsecureAuth':![]}];for(const _0x25124f of _0x3f557a){expect(()=>_0x4a8c51[_0x1f0d46(0xd2)](_0x25124f))[_0x1f0d46(0xdf)](JSON['stringify'](_0x25124f))[_0x1f0d46(0x9a)]();}}),it(_0x2eb6d9(0x82),function(){const _0x5cbf4c=_0x2eb6d9,_0x3d521d={'bundleId':'com.valid.app','enableInsecureAuth':![]};expect(()=>_0x4a8c51[_0x5cbf4c(0xd2)](_0x3d521d))[_0x5cbf4c(0xc4)]['toThrow']();});}),_0x139902['lKUMK'](describe,_0x39855f(0xcf),function(){const _0x3dcc43=_0x39855f,_0x5cded8={'pfaEJ':function(_0x49911d,_0xddcc66){return _0x139902['zyVeI'](_0x49911d,_0xddcc66);}};if(_0x139902['MpqIC']('BPwUZ',_0x139902[_0x3dcc43(0xaf)])){const _0x265504={'EsZge':_0x3dcc43(0x9b)};_0x139902[_0x3dcc43(0xe3)](_0x43117b,_0x139902[_0x3dcc43(0x7b)],async function(){const _0x4b382f=_0x3dcc43,_0x2cdc5e=[null,_0x6f4d35,{},{'bundleId':''},{'enableInsecureAuth':![]}];for(const _0x587622 of _0x2cdc5e){_0x5cded8['pfaEJ'](_0x2487e9,()=>_0x36ab46[_0x4b382f(0xd2)](_0x587622))[_0x4b382f(0xdf)](_0x1ba84a[_0x4b382f(0xe2)](_0x587622))[_0x4b382f(0x9a)]();}}),_0x36649b(_0x3dcc43(0x82),function(){const _0x4b803e=_0x3dcc43,_0x16526f={'bundleId':_0x265504[_0x4b803e(0x8e)],'enableInsecureAuth':![]};_0x66ba3d(()=>_0x1c4055['validateOptions'](_0x16526f))[_0x4b803e(0xc4)][_0x4b803e(0x9a)]();});}else it('should\x20throw\x20error\x20for\x20missing\x20authData\x20fields',async function(){const _0x495bce=_0x3dcc43;await _0x139902['zyVeI'](expectAsync,_0x4a8c51[_0x495bce(0x7e)]({}))[_0x495bce(0xa3)]('AuthData\x20id\x20is\x20missing.');});}),_0x139902[_0x39855f(0xd0)](describe,_0x139902['JuOSt'],function(){const _0x1e74a2=_0x39855f;_0x139902[_0x1e74a2(0xd0)](it,_0x139902[_0x1e74a2(0xc5)],async function(){const _0x2c0c65=_0x1e74a2,_0x27129a=_0x2c0c65(0x8f);_0x139902[_0x2c0c65(0xa1)](spyOn,_0x4a8c51,_0x139902[_0x2c0c65(0xce)])[_0x2c0c65(0xad)]['throwError'](new Error(_0x139902[_0x2c0c65(0xe0)])),await _0x139902[_0x2c0c65(0xda)](expectAsync,_0x4a8c51['getAppleCertificate'](_0x27129a))[_0x2c0c65(0xa3)](_0x139902[_0x2c0c65(0xb4)]);}),it(_0x1e74a2(0x8c),async function(){const _0x38af39=_0x1e74a2,_0x3b460e=_0x38af39(0x96),_0x224006={'id':_0x38af39(0xc6),'publicKeyUrl':_0x38af39(0xb2),'timestamp':0x154294754f7,'salt':_0x139902[_0x38af39(0x88)],'signature':_0x139902['OxKNX']};_0x139902[_0x38af39(0xd0)](spyOn,_0x4a8c51,_0x139902[_0x38af39(0xbc)])[_0x38af39(0xad)][_0x38af39(0x8d)](Promise[_0x38af39(0xa5)](_0x3b460e)),spyOn(_0x4a8c51,_0x38af39(0x90))['and'][_0x38af39(0xcd)](_0x139902[_0x38af39(0xc0)]),await expectAsync(_0x4a8c51['validateAuthData'](_0x224006))[_0x38af39(0xa3)](_0x139902['vugjD']);});}),_0x139902['KAWti'](describe,_0x139902[_0x39855f(0xab)],function(){const _0x3fc935=_0x39855f;_0x139902[_0x3fc935(0x89)](_0x3fc935(0xd4),_0x3fc935(0xbb))?_0x139902[_0x3fc935(0x7f)](_0x22b7a9,()=>_0x3a24f9[_0x3fc935(0xd2)](_0x25831f))['withContext'](_0x17f211[_0x3fc935(0xe2)](_0x3c94c1))['toThrow']():it(_0x3fc935(0xbe),async function(){const _0x29e7bf=_0x3fc935,_0x585ed1={'id':_0x139902[_0x29e7bf(0x9d)],'publicKeyUrl':'https://static.gc.apple.com/public-key/gc-prod-4.cer','timestamp':0x154294754f7,'salt':_0x139902[_0x29e7bf(0x88)],'signature':_0x139902[_0x29e7bf(0xc3)],'bundleId':_0x139902['DskCC']};spyOn(_0x4a8c51,_0x139902[_0x29e7bf(0xbc)])[_0x29e7bf(0xad)]['returnValue'](Promise[_0x29e7bf(0xa5)](_0x139902[_0x29e7bf(0x93)])),_0x139902['GOYpG'](spyOn,_0x4a8c51,'verifySignature')['and']['returnValue'](!![]),await _0x139902[_0x29e7bf(0x92)](expectAsync,_0x4a8c51[_0x29e7bf(0x7e)](_0x585ed1))[_0x29e7bf(0xee)]();});}),_0x139902[_0x39855f(0xe4)](describe,_0x139902[_0x39855f(0xdb)],function(){const _0x18dddf=_0x39855f,_0x3b3191={'erXgl':_0x139902[_0x18dddf(0xb7)],'pdqzz':function(_0x57796f,_0x5b21ec,_0x4a174a){return _0x57796f(_0x5b21ec,_0x4a174a);},'UkSkr':_0x139902['nGiGD']};it(_0x139902[_0x18dddf(0xec)],async function(){const _0x1b9bda=_0x18dddf,_0x6c1514='https://static.gc.apple.com/public-key/gc-prod-4.cer',_0x206eda=_0x3b3191[_0x1b9bda(0x86)];_0x3b3191[_0x1b9bda(0x8b)](spyOn,_0x4a8c51,_0x3b3191[_0x1b9bda(0xa7)])[_0x1b9bda(0xad)][_0x1b9bda(0x8d)](Promise[_0x1b9bda(0xa5)]({'certificate':_0x206eda,'headers':new Map()})),spyOn(pki,'certificateFromPem')['and'][_0x1b9bda(0x8d)]({}),_0x4a8c51['cache'][_0x6c1514]=_0x206eda;const _0x5c8825=await _0x4a8c51['getAppleCertificate'](_0x6c1514);expect(_0x5c8825)['toBe'](_0x206eda);}),it(_0x18dddf(0xcb),async function(){const _0x57b458=_0x18dddf,_0x4b65b9={'id':_0x57b458(0xd3),'publicKeyUrl':'https://static.gc.apple.com/public-key/gc-prod-4.cer','timestamp':0x16c7096de77,'signature':_0x139902[_0x57b458(0xea)],'salt':_0x139902['HSMeT']};_0x4a8c51[_0x57b458(0x9f)]=_0x139902[_0x57b458(0x81)],_0x4a8c51[_0x57b458(0x85)]=![],_0x139902[_0x57b458(0xa1)](spyOn,_0x4a8c51,_0x57b458(0xcc))[_0x57b458(0xad)]['returnValue']();const _0x26d088=await _0x4a8c51[_0x57b458(0xac)](_0x4b65b9[_0x57b458(0x84)]);expect(()=>_0x4a8c51[_0x57b458(0x90)](_0x26d088,_0x4b65b9))[_0x57b458(0xc4)][_0x57b458(0x9a)]();}),it(_0x139902[_0x18dddf(0xc7)],async function(){const _0x1a6eec=_0x18dddf,_0x417275={'id':_0x139902['lexKO'],'publicKeyUrl':_0x1a6eec(0xb2),'timestamp':0x16c7096de77,'signature':_0x1a6eec(0xe8),'salt':_0x139902[_0x1a6eec(0xba)],'bundleId':_0x139902[_0x1a6eec(0xa6)]};_0x4a8c51[_0x1a6eec(0x9f)]=_0x139902[_0x1a6eec(0x81)],_0x4a8c51[_0x1a6eec(0x85)]=![],_0x139902['CUnIY'](spyOn,_0x4a8c51,_0x1a6eec(0xcc))[_0x1a6eec(0xad)][_0x1a6eec(0x8d)]();const _0x7f00f9=await _0x4a8c51[_0x1a6eec(0xac)](_0x417275[_0x1a6eec(0x84)]);_0x139902[_0x1a6eec(0xe9)](expect,()=>_0x4a8c51[_0x1a6eec(0x90)](_0x7f00f9,_0x417275))[_0x1a6eec(0xc4)][_0x1a6eec(0x9a)]();}),_0x139902[_0x18dddf(0x87)](it,_0x18dddf(0xae),async function(){const _0x3ea525=_0x18dddf,_0x30ad3e={'id':_0x139902[_0x3ea525(0xb9)],'publicKeyUrl':_0x3ea525(0xb2),'timestamp':0x16c7096de77,'signature':_0x3ea525(0xe8),'salt':_0x3ea525(0xd6),'bundleId':_0x139902['xzpLM']};_0x4a8c51[_0x3ea525(0x9f)]=_0x139902[_0x3ea525(0x81)],_0x4a8c51['enableInsecureAuth']=!![],_0x139902[_0x3ea525(0xb3)](spyOn,_0x4a8c51,'verifyPublicKeyIssuer')[_0x3ea525(0xad)][_0x3ea525(0x8d)]();const _0x3efce8=await _0x4a8c51[_0x3ea525(0xac)](_0x30ad3e['publicKeyUrl']);_0x139902['uuwUF'](expect,()=>_0x4a8c51[_0x3ea525(0x90)](_0x3efce8,_0x30ad3e))[_0x3ea525(0xc4)][_0x3ea525(0x9a)]();}),it(_0x139902[_0x18dddf(0x7a)],async function(){const _0x20fa15=_0x18dddf,_0x12a378={'id':'G:1965586982','publicKeyUrl':_0x139902['IHwDE'],'timestamp':0x16c7096de77,'signature':_0x20fa15(0xe8),'salt':_0x139902[_0x20fa15(0xba)],'bundleId':_0x20fa15(0xa8)};_0x4a8c51[_0x20fa15(0x85)]=!![],_0x139902[_0x20fa15(0xe4)](spyOn,_0x4a8c51,'verifyPublicKeyIssuer')[_0x20fa15(0xad)][_0x20fa15(0x8d)]();const _0x4e2e37=await _0x4a8c51['getAppleCertificate'](_0x12a378[_0x20fa15(0x84)]);_0x139902[_0x20fa15(0xda)](expect,()=>_0x4a8c51[_0x20fa15(0x90)](_0x4e2e37,_0x12a378))['not']['toThrow']();});});});