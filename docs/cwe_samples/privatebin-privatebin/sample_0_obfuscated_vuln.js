(function(_0x2fc170,_0x378613){const _0x2d0786=_0xe88e,_0x3fc843=_0x2fc170();while(!![]){try{const _0xd83b93=-parseInt(_0x2d0786(0x161))/0x1*(-parseInt(_0x2d0786(0x16f))/0x2)+-parseInt(_0x2d0786(0x155))/0x3*(-parseInt(_0x2d0786(0x167))/0x4)+-parseInt(_0x2d0786(0x182))/0x5*(parseInt(_0x2d0786(0x180))/0x6)+parseInt(_0x2d0786(0x15b))/0x7+-parseInt(_0x2d0786(0x17f))/0x8*(parseInt(_0x2d0786(0x18e))/0x9)+-parseInt(_0x2d0786(0x17e))/0xa+parseInt(_0x2d0786(0x154))/0xb*(parseInt(_0x2d0786(0x16e))/0xc);if(_0xd83b93===_0x378613)break;else _0x3fc843['push'](_0x3fc843['shift']());}catch(_0x2c8d2c){_0x3fc843['push'](_0x3fc843['shift']());}}}(_0x17d9,0xb74a8));import{ApolloServer,UserInputError}from'apollo-server-express';import{ApolloServerPluginLandingPageDisabled,ApolloServerPluginLandingPageGraphQLPlayground}from'apollo-server-core';import{formatError as _0x50fb29}from'apollo-errors';function _0x17d9(){const _0x1ce437=['hspAV','app:graphql:batching_protection:mutation_default','includes','query','/static/@apollographql/graphql-playground-react@1.7.42/build/static/favicon.png','trim','some','GraphQL\x20introspection\x20not\x20authorized!','oZhTg','BlodF','exception','include','protect','ozRpn','12738370BAlBrc','312hnTRWr','2526006stOIHU','get','15VhzHpz','user','qUXML','res','plugins','opencti-work-id','validationRules','app:graphql:batching_protection:query_subtypes','kPYJN','/static','length','api','56601TKvQvA','error','opencti-event-id','wqDHO','7979125ExfLvn','2207877MuVooD','xEtLT','QOhRn','tEmoC','headers','SYTKE','2368373kgQYSx','originalError','previousStandard','ivNDH','lrNch','vktRV','3oBjvBB','synchronizedUpsert','synchronized-upsert','OpenCTI\x20Playground','push','AQMPQ','4MSEYjG','lADDu','req','gtNBn','RwUrd','Value\x20cannot\x20have\x20only\x20whitespace(s)','inCou','24WsgHEB','671882wEqjYK'];_0x17d9=function(){return _0x1ce437;};return _0x17d9();}import{ApolloArmor}from'@escape.tech/graphql-armor';import{dissocPath}from'ramda';import{createValidation as _0x3d9076}from'graphql-no-alias';import _0x27f8ff from'graphql-constraint-directive/lib/error';import{constraintDirectiveDocumentation,createApolloQueryValidationPlugin}from'graphql-constraint-directive';import{GraphQLError}from'graphql/error';import _0x10c917 from'./schema';import _0x392e7e,{basePath,DEV_MODE,ENABLED_TRACING,GRAPHQL_ARMOR_ENABLED,logApp,PLAYGROUND_ENABLED,PLAYGROUND_INTROSPECTION_DISABLED}from'../config/conf';import{authenticateUserFromRequest,userWithOrigin}from'../domain/user';function _0xe88e(_0x1bb797,_0x107503){const _0x17d95f=_0x17d9();return _0xe88e=function(_0xe88ea0,_0x2b4498){_0xe88ea0=_0xe88ea0-0x152;let _0x33445c=_0x17d95f[_0xe88ea0];return _0x33445c;},_0xe88e(_0x1bb797,_0x107503);}import{ForbiddenAccess,ValidationError}from'../config/errors';import _0x19d380 from'./loggerPlugin';import _0x2b9b42 from'./telemetryPlugin';import _0x2308a8 from'./httpResponsePlugin';import{executionContext}from'../utils/access';const createApolloServer=()=>{const _0x14e0b6=_0xe88e,_0xc5fdae={'lpBZT':function(_0x4a01b0,_0x50a702){return _0x4a01b0>_0x50a702;},'vktRV':function(_0x3725d9,_0x3a156c){return _0x3725d9===_0x3a156c;},'oZhTg':function(_0x405d40,_0x130cee){return _0x405d40(_0x130cee);},'VtECt':_0x14e0b6(0x18a),'bZeJU':_0x14e0b6(0x152),'gtNBn':function(_0x375b05,_0x5f1de4){return _0x375b05===_0x5f1de4;},'JBlPj':_0x14e0b6(0x163),'ivNDH':function(_0x45205e,_0x359055,_0x352e17,_0x40094a){return _0x45205e(_0x359055,_0x352e17,_0x40094a);},'QOhRn':function(_0x469be0,_0x36e65a,_0x2d0beb){return _0x469be0(_0x36e65a,_0x2d0beb);},'BlodF':function(_0x3b0f80,_0x1ea2c0){return _0x3b0f80===_0x1ea2c0;},'qUXML':_0x14e0b6(0x17d),'lADDu':function(_0x457271,_0x58e4d1){return _0x457271>_0x58e4d1;},'lkOHL':'lJhmH','wqDHO':function(_0x592521,_0x3bc18a){return _0x592521(_0x3bc18a);},'RwUrd':'extensions','xEtLT':function(_0x4a3a7b){return _0x4a3a7b();},'lrNch':_0x14e0b6(0x171),'inCou':function(_0x97f0d4,_0x4cdca2){return _0x97f0d4(_0x4cdca2);},'tEmoC':_0x14e0b6(0x164)};let _0x5b6c45=_0xc5fdae['xEtLT'](_0x10c917);const _0x44dbb3={'not-blank':_0x2d5b5c=>{const _0x597b0e=_0x14e0b6;if(_0xc5fdae['lpBZT'](_0x2d5b5c['length'],0x0)&&_0xc5fdae[_0x597b0e(0x160)](_0x2d5b5c[_0x597b0e(0x175)](),''))throw new GraphQLError(_0x597b0e(0x16c));return!![];}},_0x30ab84=_0xc5fdae[_0x14e0b6(0x157)](createApolloQueryValidationPlugin,{'schema':_0x5b6c45},{'formats':_0x44dbb3});_0x5b6c45=constraintDirectiveDocumentation()(_0x5b6c45);const _0xaf04eb=[_0x19d380,_0x2308a8,_0x30ab84],_0x19756c={'Query':{'*':_0x392e7e['get']('app:graphql:batching_protection:query_default')??0x2,'subTypes':_0x392e7e[_0x14e0b6(0x181)](_0x14e0b6(0x189))??0x4},'Mutation':{'*':_0x392e7e[_0x14e0b6(0x181)](_0xc5fdae[_0x14e0b6(0x15f)])??0x1,'token':0x1}},{validation:_0x2b3180}=_0xc5fdae[_0x14e0b6(0x16d)](_0x3d9076,{'permissions':_0x19756c}),_0xdd85a0=[_0x2b3180];if(GRAPHQL_ARMOR_ENABLED){const _0x25f63f=new ApolloArmor({'blockFieldSuggestion':{'enabled':!![]},'costLimit':{'maxCost':0x2710},'maxAliases':{'enabled':![]},'maxDepth':{'n':0x14},'maxDirectives':{'n':0x32},'maxTokens':{'n':0x7d0}}),_0x1f7a24=_0x25f63f[_0x14e0b6(0x17c)]();_0xaf04eb[_0x14e0b6(0x165)](..._0x1f7a24[_0x14e0b6(0x186)]),_0xdd85a0[_0x14e0b6(0x165)](..._0x1f7a24[_0x14e0b6(0x188)]);}const _0x1491df=DEV_MODE?{'settings':{'request.credentials':_0x14e0b6(0x17b)}}:{'cdnUrl':basePath+_0x14e0b6(0x18b),'title':_0xc5fdae[_0x14e0b6(0x158)],'faviconUrl':basePath+_0x14e0b6(0x174),'settings':{'request.credentials':'include'}},_0x545336=ApolloServerPluginLandingPageGraphQLPlayground(_0x1491df);_0xaf04eb['push'](PLAYGROUND_ENABLED?_0x545336:_0xc5fdae[_0x14e0b6(0x156)](ApolloServerPluginLandingPageDisabled));const _0xd378b0={'requestDidStart':({request:_0x47ea20,context:_0x4243df})=>{const _0xefa8f0=_0x14e0b6,_0x3ca708={'AQMPQ':function(_0xcd0033,_0x1dec8d){return _0xcd0033 instanceof _0x1dec8d;},'SYTKE':function(_0xdb9789,_0x452a29){const _0x5e88bb=_0xe88e;return _0xc5fdae[_0x5e88bb(0x178)](_0xdb9789,_0x452a29);}};if(_0xc5fdae['VtECt']==='kPYJN'){if(['__schema','__type'][_0xefa8f0(0x176)](_0x15bab=>_0x47ea20[_0xefa8f0(0x173)][_0xefa8f0(0x172)](_0x15bab))){if(!PLAYGROUND_ENABLED||PLAYGROUND_INTROSPECTION_DISABLED||!_0x4243df[_0xefa8f0(0x183)])throw ForbiddenAccess(_0xefa8f0(0x177));}}else{if(_0x3ca708[_0xefa8f0(0x166)](_0x4a5fb5[_0xefa8f0(0x15c)],_0x3629f6)){const {originalError:_0x5c197a}=_0x2dc2ea[_0xefa8f0(0x15c)],{fieldName:_0xb97f08}=_0x5c197a,_0x1137ca=_0x1a08c1(_0xb97f08,_0x5c197a);_0x45adbc=_0x3ca708[_0xefa8f0(0x15a)](_0x4383c0,_0x1137ca);}}}};_0xaf04eb[_0x14e0b6(0x165)](_0xd378b0);ENABLED_TRACING&&_0xaf04eb['push'](_0x2b9b42);const _0x3cc7fb=new ApolloServer({'schema':_0x5b6c45,'introspection':!![],'persistedQueries':![],'validationRules':_0xdd85a0,async 'context'({req:_0x463d1a,res:_0x3c036e}){const _0x1e6c90=_0x14e0b6,_0x4de3da=executionContext(_0x1e6c90(0x18d));_0x4de3da[_0x1e6c90(0x169)]=_0x463d1a,_0x4de3da[_0x1e6c90(0x185)]=_0x3c036e,_0x4de3da['workId']=_0x463d1a[_0x1e6c90(0x159)][_0x1e6c90(0x187)],_0x4de3da['eventId']=_0x463d1a[_0x1e6c90(0x159)][_0xc5fdae['bZeJU']],_0x4de3da[_0x1e6c90(0x15d)]=_0x463d1a[_0x1e6c90(0x159)]['previous-standard'],_0x4de3da[_0x1e6c90(0x162)]=_0xc5fdae[_0x1e6c90(0x16a)](_0x463d1a[_0x1e6c90(0x159)][_0xc5fdae['JBlPj']],'true');try{const _0x35e656=await _0xc5fdae[_0x1e6c90(0x15e)](authenticateUserFromRequest,_0x4de3da,_0x463d1a,_0x3c036e);_0x35e656&&(_0x4de3da['user']=_0xc5fdae[_0x1e6c90(0x157)](userWithOrigin,_0x463d1a,_0x35e656));}catch(_0x10e252){_0xc5fdae[_0x1e6c90(0x179)](_0xc5fdae[_0x1e6c90(0x184)],_0x1e6c90(0x17d))?logApp[_0x1e6c90(0x18f)](_0x10e252):_0x267a55[_0x1e6c90(0x165)](_0x464002);}return _0x4de3da;},'tracing':DEV_MODE,'plugins':_0xaf04eb,'formatError':_0x408368=>{const _0xca1554=_0x14e0b6;let _0x31dcb0=_0xc5fdae[_0xca1554(0x178)](_0x50fb29,_0x408368);if(_0x31dcb0 instanceof UserInputError){if(_0xc5fdae['lkOHL']===_0xca1554(0x170)){if(_0xc5fdae[_0xca1554(0x168)](_0x3d9d62[_0xca1554(0x18c)],0x0)&&_0xc5fdae[_0xca1554(0x160)](_0x31f9d7[_0xca1554(0x175)](),''))throw new _0x3c7907(_0xca1554(0x16c));return!![];}else{if(_0x31dcb0[_0xca1554(0x15c)]instanceof _0x27f8ff){const {originalError:_0x3ced49}=_0x31dcb0[_0xca1554(0x15c)],{fieldName:_0x50a552}=_0x3ced49,_0x1a73ab=ValidationError(_0x50a552,_0x3ced49);_0x31dcb0=_0xc5fdae[_0xca1554(0x153)](_0x50fb29,_0x1a73ab);}}}return DEV_MODE?_0x31dcb0:_0xc5fdae['QOhRn'](dissocPath,[_0xc5fdae[_0xca1554(0x16b)],_0xca1554(0x17a)],_0x31dcb0);}});return{'schema':_0x5b6c45,'apolloServer':_0x3cc7fb};};export default createApolloServer;