'use strict';const _0x3f82f8=_0x4bb3;(function(_0x2b21d5,_0x123b9a){const _0xaaea51=_0x4bb3,_0x1c7d53=_0x2b21d5();while(!![]){try{const _0x185f13=parseInt(_0xaaea51(0x138))/0x1+parseInt(_0xaaea51(0x134))/0x2*(parseInt(_0xaaea51(0x14c))/0x3)+-parseInt(_0xaaea51(0x165))/0x4*(parseInt(_0xaaea51(0x159))/0x5)+-parseInt(_0xaaea51(0x15d))/0x6+-parseInt(_0xaaea51(0x13b))/0x7+-parseInt(_0xaaea51(0x13a))/0x8+parseInt(_0xaaea51(0x153))/0x9;if(_0x185f13===_0x123b9a)break;else _0x1c7d53['push'](_0x1c7d53['shift']());}catch(_0x5642cb){_0x1c7d53['push'](_0x1c7d53['shift']());}}}(_0x5d64,0x682ce));const {createStrapiInstance}=require(_0x3f82f8(0x16b));function _0x5d64(){const _0x3d3d38=['new\x20key','LmLQa','HqXoC','4159542nNepsw','bad\x20key','RYBWK','leXjO','YIhYe','Hhoar','AKCTU','key','8HgvoES','commits\x20successfully','dtINI','log','this\x20should\x20error','RhoIJ','api-tests/strapi','destroy','transaction','execute','changed\x20key','this\x20should\x20not\x20be\x20reached','TzMEZ','update','qxtMy','test','mZCGV','TAIIL','strapi::core-store','nested\x20rollback\x20->\x20rollback\x20works','gLoTZ','rollback\x20successfully','queryBuilder','invalid_uid','toBe','MJpxb','556532FuhOFi','FzNSM','wrong\x20key','onCommit\x20hook\x20works','468880VHFvyb','using\x20a\x20transaction\x20method','4209536CsEbvZ','2052491HvtYTq','wjqZX','yQrJo','toEqual','fvXjl','transactions','bfnZH','ueFfu','WxDrK','select','AJlAK','where','IZeFC','error','changed\x20key\x20-\x20nested','get','uLCDX','3SYKoIW','qXrKB','transacting','sEgtw','using\x20a\x20transaction\x20object','nested\x20commit\x20->\x20rollback\x20works','commit','18157158QNSwNf','Efwso','vsvma','rollback','byOmz','jPmPE','2063110cartiS'];_0x5d64=function(){return _0x3d3d38;};return _0x5d64();}let strapi;function _0x4bb3(_0x48509e,_0x5692c2){const _0x5d641b=_0x5d64();return _0x4bb3=function(_0x4bb366,_0x1b27d1){_0x4bb366=_0x4bb366-0x125;let _0x4b2862=_0x5d641b[_0x4bb366];return _0x4b2862;},_0x4bb3(_0x48509e,_0x5692c2);}describe(_0x3f82f8(0x140),()=>{const _0x1f5c1f=_0x3f82f8,_0x5f3dcd={'YIhYe':function(_0x346635){return _0x346635();},'AKCTU':function(_0x38cedd,_0xbed4ae){return _0x38cedd(_0xbed4ae);},'RhoIJ':'strapi::core-store','dtINI':function(_0x2c530f,_0x45e291){return _0x2c530f(_0x45e291);},'FzNSM':_0x1f5c1f(0x136),'fvXjl':function(_0x45edc0,_0x4145f6){return _0x45edc0(_0x4145f6);},'byOmz':_0x1f5c1f(0x12d),'TAIIL':function(_0x34bf73,_0x25ff45,_0x5d2fbc){return _0x34bf73(_0x25ff45,_0x5d2fbc);},'uLCDX':function(_0x361ff8,_0x242ae2,_0x3201e6){return _0x361ff8(_0x242ae2,_0x3201e6);},'edWZC':_0x1f5c1f(0x169),'bfnZH':function(_0x4d4970,_0x53330d){return _0x4d4970(_0x53330d);},'sEgtw':_0x1f5c1f(0x125),'qxtMy':'rollback\x20successfully','lPVUR':function(_0xe62a2c,_0x32a90b){return _0xe62a2c(_0x32a90b);},'Hhoar':function(_0x5c0b81,_0x36981f){return _0x5c0b81(_0x36981f);},'TzMEZ':_0x1f5c1f(0x139),'MJpxb':'http://localhost:3000/health'};let _0x516616;beforeAll(async()=>{const _0x75455b=_0x1f5c1f;strapi=await _0x5f3dcd[_0x75455b(0x161)](createStrapiInstance),_0x516616=await strapi['db'][_0x75455b(0x130)](_0x75455b(0x12c))[_0x75455b(0x144)](['*'])[_0x75455b(0x146)]({'id':0x1})['execute']();}),_0x5f3dcd['lPVUR'](afterAll,async()=>{const _0x31708e=_0x1f5c1f;await strapi[_0x31708e(0x16c)]();}),_0x5f3dcd[_0x1f5c1f(0x162)](afterEach,async()=>{const _0x55f471=_0x1f5c1f;await strapi['db'][_0x55f471(0x130)]('strapi::core-store')[_0x55f471(0x127)]({'key':_0x516616[0x0][_0x55f471(0x164)]})[_0x55f471(0x146)]({'id':0x1})[_0x55f471(0x16e)]();}),describe(_0x5f3dcd[_0x1f5c1f(0x126)],()=>{const _0x86d9b3=_0x1f5c1f,_0x2a60cf={'mZCGV':_0x86d9b3(0x12c),'HqXoC':_0x86d9b3(0x15a),'leXjO':_0x5f3dcd['FzNSM'],'WxDrK':_0x86d9b3(0x16f),'gLoTZ':function(_0x2f73a2,_0x276c04){const _0x159273=_0x86d9b3;return _0x5f3dcd[_0x159273(0x163)](_0x2f73a2,_0x276c04);},'IZeFC':function(_0x2ab2b2,_0x46a5ec){const _0x15f900=_0x86d9b3;return _0x5f3dcd[_0x15f900(0x13f)](_0x2ab2b2,_0x46a5ec);},'AJlAK':_0x86d9b3(0x129)};test('commits\x20successfully',async()=>{const _0x38ec36=_0x86d9b3;await strapi['db']['transaction'](async()=>{const _0x539242=_0x4bb3;await strapi['db'][_0x539242(0x130)]('strapi::core-store')[_0x539242(0x127)]({'key':_0x539242(0x136)})['where']({'id':0x1})[_0x539242(0x16e)](),await strapi['db'][_0x539242(0x130)](_0x2a60cf['mZCGV'])[_0x539242(0x127)]({'key':_0x2a60cf[_0x539242(0x15c)]})['where']({'id':0x1})['execute']();});const _0x1d0cf2=await strapi['db'][_0x38ec36(0x130)](_0x2a60cf[_0x38ec36(0x12a)])[_0x38ec36(0x144)](['*'])[_0x38ec36(0x146)]({'id':0x1})[_0x38ec36(0x16e)]();expect(_0x1d0cf2[0x0][_0x38ec36(0x164)])['toEqual'](_0x2a60cf[_0x38ec36(0x15c)]);}),test(_0x86d9b3(0x12f),async()=>{const _0x5953f5=_0x86d9b3;try{await strapi['db']['transaction'](async()=>{const _0x200a1c=_0x4bb3;await strapi['db'][_0x200a1c(0x130)]('strapi::core-store')['update']({'key':_0x2a60cf[_0x200a1c(0x160)]})[_0x200a1c(0x146)]({'id':0x1})[_0x200a1c(0x16e)](),await strapi['db'][_0x200a1c(0x130)]('invalid_uid')[_0x200a1c(0x127)]({'key':_0x200a1c(0x15e),'invalid_key':_0x200a1c(0x148)})['where']({'id':0x1})[_0x200a1c(0x16e)]();}),_0x5f3dcd['AKCTU'](expect,'this\x20should\x20not\x20be\x20reached')['toBe'](![]);}catch(_0x1a4996){}const _0x21308d=await strapi['db'][_0x5953f5(0x130)](_0x5f3dcd[_0x5953f5(0x16a)])[_0x5953f5(0x144)](['*'])[_0x5953f5(0x146)]({'id':0x1})['execute']();expect(_0x21308d[0x0][_0x5953f5(0x164)])[_0x5953f5(0x13e)](_0x516616[0x0][_0x5953f5(0x164)]);}),test(_0x5f3dcd[_0x86d9b3(0x157)],async()=>{const _0x17426d=_0x86d9b3,_0x37d90e={'ueFfu':_0x17426d(0x12c),'qXrKB':function(_0x38c433,_0x27da94){return _0x38c433(_0x27da94);},'wjqZX':'invalid_uid'};try{await strapi['db'][_0x17426d(0x16d)](async()=>{const _0x1c6bfc=_0x17426d,_0x59b19b={'RYBWK':_0x37d90e[_0x1c6bfc(0x142)],'PXfvw':'changed\x20key\x20-\x20nested','yQrJo':_0x1c6bfc(0x131)};await strapi['db'][_0x1c6bfc(0x130)](_0x37d90e[_0x1c6bfc(0x142)])['update']({'key':_0x1c6bfc(0x16f)})[_0x1c6bfc(0x146)]({'id':0x1})[_0x1c6bfc(0x16e)]();try{await strapi['db'][_0x1c6bfc(0x16d)](async()=>{const _0x37c635=_0x1c6bfc;await strapi['db']['queryBuilder'](_0x59b19b[_0x37c635(0x15f)])[_0x37c635(0x127)]({'key':_0x59b19b['PXfvw']})[_0x37c635(0x146)]({'id':0x1})[_0x37c635(0x16e)](),await strapi['db']['queryBuilder'](_0x59b19b[_0x37c635(0x13d)])[_0x37c635(0x127)]({'invalid_key':_0x37c635(0x148)})['where']({'id':0x1})[_0x37c635(0x16e)]();});}catch(_0x62b1a5){}const _0x13b35e=await strapi['db']['queryBuilder'](_0x1c6bfc(0x12c))[_0x1c6bfc(0x144)](['*'])[_0x1c6bfc(0x146)]({'id':0x1})['execute']();_0x37d90e[_0x1c6bfc(0x14d)](expect,_0x13b35e[0x0][_0x1c6bfc(0x164)])['toEqual']('changed\x20key'),await strapi['db'][_0x1c6bfc(0x130)](_0x37d90e[_0x1c6bfc(0x13c)])['update']({'key':_0x516616[0x0][_0x1c6bfc(0x164)],'invalid_key':_0x1c6bfc(0x148)})[_0x1c6bfc(0x146)]({'id':0x1})[_0x1c6bfc(0x16e)]();}),_0x5f3dcd[_0x17426d(0x167)](expect,_0x17426d(0x125))[_0x17426d(0x132)](![]);}catch(_0x5e859e){}const _0x1f5f30=await strapi['db']['queryBuilder'](_0x5f3dcd['RhoIJ'])['select'](['*'])['where']({'id':0x1})['execute']();expect(_0x1f5f30[0x0][_0x17426d(0x164)])[_0x17426d(0x13e)](_0x516616[0x0][_0x17426d(0x164)]);}),test(_0x86d9b3(0x151),async()=>{const _0x11287f=_0x86d9b3,_0x27a8f0={'LmLQa':_0x11287f(0x149),'hKMuN':_0x2a60cf[_0x11287f(0x12a)],'Efwso':_0x2a60cf[_0x11287f(0x143)],'jPmPE':function(_0x44b07d,_0x5ee68d){const _0x442652=_0x11287f;return _0x2a60cf[_0x442652(0x12e)](_0x44b07d,_0x5ee68d);},'vsvma':_0x11287f(0x148)};try{await strapi['db'][_0x11287f(0x16d)](async()=>{const _0x41b04f=_0x11287f;await strapi['db'][_0x41b04f(0x130)](_0x27a8f0['hKMuN'])[_0x41b04f(0x127)]({'key':_0x27a8f0[_0x41b04f(0x154)]})[_0x41b04f(0x146)]({'id':0x1})[_0x41b04f(0x16e)]();try{await strapi['db'][_0x41b04f(0x16d)](async()=>{const _0x4fbac7=_0x41b04f;await strapi['db']['queryBuilder']('strapi::core-store')[_0x4fbac7(0x127)]({'key':_0x27a8f0[_0x4fbac7(0x15b)]})['where']({'id':0x1})[_0x4fbac7(0x16e)]();});}catch(_0x2a6321){}const _0x3d545d=await strapi['db'][_0x41b04f(0x130)]('strapi::core-store')[_0x41b04f(0x144)](['*'])[_0x41b04f(0x146)]({'id':0x1})[_0x41b04f(0x16e)]();_0x27a8f0[_0x41b04f(0x158)](expect,_0x3d545d[0x0][_0x41b04f(0x164)])[_0x41b04f(0x13e)](_0x27a8f0[_0x41b04f(0x15b)]),await strapi['db']['queryBuilder'](_0x41b04f(0x131))[_0x41b04f(0x127)]({'key':_0x516616[0x0][_0x41b04f(0x164)],'invalid_key':_0x27a8f0[_0x41b04f(0x155)]})[_0x41b04f(0x146)]({'id':0x1})[_0x41b04f(0x16e)]();}),expect('this\x20should\x20not\x20be\x20reached')[_0x11287f(0x132)](![]);}catch(_0x50e914){}const _0x27517c=await strapi['db']['queryBuilder'](_0x2a60cf[_0x11287f(0x12a)])[_0x11287f(0x144)](['*'])[_0x11287f(0x146)]({'id':0x1})[_0x11287f(0x16e)]();_0x2a60cf[_0x11287f(0x147)](expect,_0x27517c[0x0]['key'])[_0x11287f(0x13e)](_0x516616[0x0][_0x11287f(0x164)]);}),_0x5f3dcd[_0x86d9b3(0x12b)](test,_0x86d9b3(0x137),async()=>{const _0x2119b4=_0x86d9b3;let _0x2fd3e8=0x0;await strapi['db'][_0x2119b4(0x16d)](({onCommit:_0x4503f4,onRollback:_0x45bd50})=>{const _0x5f103e=_0x2119b4;_0x2a60cf[_0x5f103e(0x12e)](_0x4503f4,()=>_0x2fd3e8++);}),expect(_0x2fd3e8)[_0x2119b4(0x13e)](0x1);}),_0x5f3dcd[_0x86d9b3(0x14b)](test,'onRollback\x20hook\x20works',async()=>{const _0x308b5e=_0x86d9b3;let _0x2937e1=0x0;try{await strapi['db']['transaction'](({onRollback:_0x4396c3})=>{const _0x793252=_0x4bb3;_0x4396c3(()=>_0x2937e1++);throw new Error(_0x2a60cf[_0x793252(0x145)]);});}catch(_0x389a27){}_0x2a60cf[_0x308b5e(0x147)](expect,_0x2937e1)['toEqual'](0x1);});}),describe(_0x1f5c1f(0x150),()=>{const _0x220467=_0x1f5c1f;test(_0x220467(0x166),async()=>{const _0x578ba9=_0x220467,_0x955e10=await strapi['db'][_0x578ba9(0x16d)]();try{await strapi['db'][_0x578ba9(0x130)](_0x578ba9(0x12c))[_0x578ba9(0x127)]({'key':_0x5f3dcd[_0x578ba9(0x135)]})[_0x578ba9(0x146)]({'id':0x1})[_0x578ba9(0x14e)](_0x955e10[_0x578ba9(0x14a)]())[_0x578ba9(0x16e)](),await strapi['db'][_0x578ba9(0x130)](_0x578ba9(0x12c))[_0x578ba9(0x127)]({'key':_0x516616[0x0][_0x578ba9(0x164)]})[_0x578ba9(0x146)]({'id':0x1})[_0x578ba9(0x14e)](_0x955e10[_0x578ba9(0x14a)]())[_0x578ba9(0x16e)](),await _0x955e10[_0x578ba9(0x152)]();}catch(_0x18583e){await _0x955e10[_0x578ba9(0x156)](),console[_0x578ba9(0x168)](_0x18583e['message']),expect(_0x578ba9(0x125))[_0x578ba9(0x132)](![]);}const _0x2f96a0=await strapi['db'][_0x578ba9(0x130)]('strapi::core-store')[_0x578ba9(0x144)](['*'])['where']({'id':0x1})[_0x578ba9(0x16e)]();_0x5f3dcd['AKCTU'](expect,_0x2f96a0[0x0]['key'])[_0x578ba9(0x13e)](_0x516616[0x0][_0x578ba9(0x164)]);}),_0x5f3dcd[_0x220467(0x12b)](test,_0x5f3dcd[_0x220467(0x128)],async()=>{const _0x28b058=_0x220467,_0x3fe210=await strapi['db'][_0x28b058(0x16d)]();try{await strapi['db']['queryBuilder'](_0x28b058(0x12c))[_0x28b058(0x127)]({'key':_0x28b058(0x136)})[_0x28b058(0x146)]({'id':0x1})[_0x28b058(0x14e)](_0x3fe210[_0x28b058(0x14a)]())[_0x28b058(0x16e)](),await strapi['db'][_0x28b058(0x130)]('invalid_uid')[_0x28b058(0x127)]({'key':0x7b,'key_not_here':_0x5f3dcd['edWZC']})[_0x28b058(0x146)]({'id':_0x28b058(0x169)})[_0x28b058(0x14e)](_0x3fe210[_0x28b058(0x14a)]())[_0x28b058(0x16e)](),await _0x3fe210[_0x28b058(0x152)](),_0x5f3dcd[_0x28b058(0x141)](expect,_0x5f3dcd[_0x28b058(0x14f)])['toBe'](![]);}catch(_0x21639b){await _0x3fe210['rollback']();}const _0x361625=await strapi['db']['queryBuilder'](_0x5f3dcd[_0x28b058(0x16a)])[_0x28b058(0x144)](['*'])[_0x28b058(0x146)]({'id':0x1})[_0x28b058(0x16e)]();_0x5f3dcd['AKCTU'](expect,_0x361625[0x0][_0x28b058(0x164)])[_0x28b058(0x13e)](_0x516616[0x0][_0x28b058(0x164)]);});}),http[_0x1f5c1f(0x14a)](_0x5f3dcd[_0x1f5c1f(0x133)]);});