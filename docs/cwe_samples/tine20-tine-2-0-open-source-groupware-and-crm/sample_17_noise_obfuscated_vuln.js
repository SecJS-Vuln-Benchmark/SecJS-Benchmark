'use strict';const _0x81d8d=_0x1d94;(function(_0x530c74,_0x329414){const _0x4347fe=_0x1d94,_0x4a9e06=_0x530c74();while(!![]){try{const _0x15834a=parseInt(_0x4347fe(0x189))/0x1+parseInt(_0x4347fe(0x187))/0x2*(-parseInt(_0x4347fe(0x18b))/0x3)+parseInt(_0x4347fe(0x19b))/0x4+parseInt(_0x4347fe(0x18d))/0x5*(-parseInt(_0x4347fe(0x185))/0x6)+-parseInt(_0x4347fe(0x181))/0x7*(-parseInt(_0x4347fe(0x18e))/0x8)+parseInt(_0x4347fe(0x19f))/0x9*(parseInt(_0x4347fe(0x197))/0xa)+parseInt(_0x4347fe(0x1ab))/0xb*(parseInt(_0x4347fe(0x199))/0xc);if(_0x15834a===_0x329414)break;else _0x4a9e06['push'](_0x4a9e06['shift']());}catch(_0x4090c8){_0x4a9e06['push'](_0x4a9e06['shift']());}}}(_0x51f7,0x18de2));function _0x1d94(_0x623836,_0x518c1d){const _0x51f7f7=_0x51f7();return _0x1d94=function(_0x1d943b,_0x2e3bea){_0x1d943b=_0x1d943b-0x17e;let _0x2b28ea=_0x51f7f7[_0x1d943b];return _0x2b28ea;},_0x1d94(_0x623836,_0x518c1d);}const strapiUtils=require(_0x81d8d(0x183)),{errors:{YupValidationError}}=require(_0x81d8d(0x183)),validators=require('../validators');function _0x51f7(){const _0x3a992a=['mockReset','3wZuSoj','YDYce','71105sRQUSD','46496EMMwhf','LolhT','mockResolvedValueOnce','2021-11-29','toBe','strapi','VRRcX','toBeInstanceOf','attrDateUnique','30yGrKzh','XlpgK','3156HkOkPd','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','150996kdhzVD','validateYupSchema','yKKDG','rWXad','106443YZyLZJ','GEXyJ','ACBaq','contentType','toHaveBeenCalled','RPdBF','not','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','date','sJHPa','2021-12-15','nVWDU','1210lpPmFV','qAtNr','aajAw','it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value','49xYCmVt','NXgNj','@strapi/utils','toHaveBeenCalledWith','6RIVaUV','unique','350992PiHMHK','gHJqM','148731LsrNPs'];_0x51f7=function(){return _0x3a992a;};return _0x51f7();}describe('Date\x20validator',()=>{const _0x200f98=_0x81d8d,_0x1614f8={'aajAw':'date','rWXad':'attrDateUnique','gHJqM':_0x200f98(0x191),'ACBaq':function(_0x4fa64c,_0x529432){return _0x4fa64c(_0x529432);},'oQiUz':function(_0x2a79f5,_0x80fa1b){return _0x2a79f5(_0x80fa1b);},'NXgNj':function(_0x23a421,_0xa9037c){return _0x23a421(_0xa9037c);},'qAtNr':function(_0x231cd6,_0x130051){return _0x231cd6(_0x130051);},'WzCoS':function(_0x1e5ae2,_0x44cf8b){return _0x1e5ae2(_0x44cf8b);},'pwedV':_0x200f98(0x1a2),'RPdBF':'test-model','LolhT':function(_0x39cd38,_0x5b34eb,_0x5bea40){return _0x39cd38(_0x5b34eb,_0x5bea40);},'GEXyJ':_0x200f98(0x1a6),'VRRcX':_0x200f98(0x19a)};describe(_0x200f98(0x186),()=>{const _0x5701a9=_0x200f98,_0x2d6389={'YDYce':_0x5701a9(0x196),'XlpgK':function(_0x3a211d,_0x1aea64){const _0x3b1d9d=_0x5701a9;return _0x1614f8[_0x3b1d9d(0x17e)](_0x3a211d,_0x1aea64);},'nVWDU':function(_0x272b1e,_0xf504ce){return _0x1614f8['WzCoS'](_0x272b1e,_0xf504ce);},'sJHPa':_0x1614f8[_0x5701a9(0x188)],'yKKDG':function(_0x2561e7,_0x58dbd3){return _0x2561e7(_0x58dbd3);}},_0x411a09=jest['fn']();global[_0x5701a9(0x193)]={'db':{'query':jest['fn'](()=>({'findOne':_0x411a09}))}},afterEach(()=>{const _0x54db2b=_0x5701a9;jest['clearAllMocks'](),_0x411a09[_0x54db2b(0x18a)]();});const _0x2886dd={'kind':_0x1614f8['pwedV'],'modelName':_0x1614f8[_0x5701a9(0x1a4)],'uid':'test-uid','options':{},'attributes':{'attrDateUnique':{'type':_0x1614f8[_0x5701a9(0x17f)],'unique':!![]}}};test('it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique',async()=>{const _0xd25ee4=_0x5701a9;_0x411a09[_0xd25ee4(0x190)](null);const _0xd03399=strapiUtils['validateYupSchema'](validators['date']({'attr':{'type':_0x1614f8[_0xd25ee4(0x17f)]},'model':_0x2886dd,'updatedAttribute':{'name':_0x1614f8[_0xd25ee4(0x19e)],'value':_0xd25ee4(0x191)},'entity':null},{'isDraft':![]}));await _0xd03399(_0x1614f8[_0xd25ee4(0x188)]),_0x1614f8['ACBaq'](expect,_0x411a09)['not']['toHaveBeenCalled']();}),test('it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`',async()=>{const _0x9ef4b2=_0x5701a9;_0x411a09[_0x9ef4b2(0x190)](null);const _0x43a0c8=strapiUtils[_0x9ef4b2(0x19c)](validators[_0x9ef4b2(0x1a7)]({'attr':{'type':'date','unique':!![]},'model':_0x2886dd,'updatedAttribute':{'name':_0x2d6389['YDYce'],'value':null},'entity':null},{'isDraft':![]})['nullable']());await _0x2d6389[_0x9ef4b2(0x198)](_0x43a0c8,null),_0x2d6389['nVWDU'](expect,_0x411a09)[_0x9ef4b2(0x1a5)][_0x9ef4b2(0x1a3)]();}),_0x1614f8[_0x5701a9(0x18f)](test,'it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database',async()=>{const _0x25ad44=_0x5701a9;_0x411a09[_0x25ad44(0x190)](null);const _0x49937e=strapiUtils[_0x25ad44(0x19c)](validators['date']({'attr':{'type':_0x25ad44(0x1a7),'unique':!![]},'model':_0x2886dd,'updatedAttribute':{'name':_0x1614f8['rWXad'],'value':'2021-11-29'},'entity':null},{'isDraft':![]}));_0x1614f8[_0x25ad44(0x1a1)](expect,await _0x49937e('2021-11-29'))[_0x25ad44(0x192)](_0x1614f8[_0x25ad44(0x188)]);}),_0x1614f8[_0x5701a9(0x18f)](test,'it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x472fb9=_0x5701a9;expect['assertions'](0x1),_0x411a09[_0x472fb9(0x190)]({'attrDateUnique':_0x2d6389[_0x472fb9(0x1a8)]});const _0x565e8d=strapiUtils[_0x472fb9(0x19c)](validators[_0x472fb9(0x1a7)]({'attr':{'type':_0x472fb9(0x1a7),'unique':!![]},'model':_0x2886dd,'updatedAttribute':{'name':_0x2d6389[_0x472fb9(0x18c)],'value':_0x472fb9(0x191)},'entity':null},{'isDraft':![]}));try{await _0x565e8d(_0x2d6389[_0x472fb9(0x1a8)]);}catch(_0xb82dbd){_0x2d6389[_0x472fb9(0x1aa)](expect,_0xb82dbd)[_0x472fb9(0x195)](YupValidationError);}}),_0x1614f8[_0x5701a9(0x18f)](test,_0x5701a9(0x180),async()=>{const _0x1bff14=_0x5701a9;_0x411a09['mockResolvedValueOnce']({'attrDateUnique':_0x1614f8[_0x1bff14(0x188)]});const _0x4997cc=strapiUtils[_0x1bff14(0x19c)](validators[_0x1bff14(0x1a7)]({'attr':{'type':_0x1614f8[_0x1bff14(0x17f)],'unique':!![]},'model':_0x2886dd,'updatedAttribute':{'name':_0x1bff14(0x196),'value':_0x1614f8['gHJqM']},'entity':{'id':0x1,'attrDateUnique':_0x1bff14(0x191)}},{'isDraft':![]}));expect(await _0x4997cc('2021-11-29'))[_0x1bff14(0x192)](_0x1614f8[_0x1bff14(0x188)]);}),test(_0x1614f8[_0x5701a9(0x1a0)],async()=>{const _0x41973c=_0x5701a9;_0x411a09[_0x41973c(0x190)](null);const _0x2d508a=strapiUtils[_0x41973c(0x19c)](validators['date']({'attr':{'type':_0x41973c(0x1a7),'unique':!![]},'model':_0x2886dd,'updatedAttribute':{'name':_0x41973c(0x196),'value':_0x2d6389['sJHPa']},'entity':null},{'isDraft':![]}));await _0x2d508a(_0x41973c(0x191)),_0x2d6389[_0x41973c(0x19d)](expect,_0x411a09)[_0x41973c(0x184)]({'select':['id'],'where':{'attrDateUnique':_0x41973c(0x191)}});}),test(_0x1614f8[_0x5701a9(0x194)],async()=>{const _0x179153=_0x5701a9;_0x411a09[_0x179153(0x190)](null);const _0x141f6b=strapiUtils[_0x179153(0x19c)](validators[_0x179153(0x1a7)]({'attr':{'type':_0x1614f8['aajAw'],'unique':!![]},'model':_0x2886dd,'updatedAttribute':{'name':_0x179153(0x196),'value':_0x1614f8[_0x179153(0x188)]},'entity':{'id':0x1,'attrDateUnique':_0x179153(0x1a9)}},{'isDraft':![]}));await _0x1614f8['oQiUz'](_0x141f6b,_0x179153(0x191)),_0x1614f8[_0x179153(0x182)](expect,_0x411a09)[_0x179153(0x184)]({'select':['id'],'where':{'$and':[{'attrDateUnique':_0x1614f8['gHJqM']},{'$not':{'id':0x1}}]}});});});});