const _0x4be6df=_0x1bfd;function _0x9597(){const _0x39dce1=['pYkQi','console.log(\x22timer\x22);','225984PAJjfN','call','50068MtgThm','get','pin-message','3580GYQDEo','JAbjR','pGMQk','Message\x20pinning\x20not\x20allowed','Message_AllowPinning','cloneAndSaveAsHistoryById','pinned','2861320dLPwxr','205ChgIri','Message_KeepHistory','612koFQmV','setLastMessagePinned','some','message_link','split','findOneById','KDUAb','Not\x20Authorized','forEach','Cwpoj','push','createWithTypeRoomIdMessageAndUser','esOlp','now','canAccessRoom','findOneByRoomIdAndUserId','_id','rid','isArray','Message\x20you\x20are\x20unpinning\x20was\x20not\x20found','pinMessage','beforeSaveMessage','RBdFQ','userId','cQQfu','pinnedBy','bytQZ','15979931JAWUJU','CPSNf','XkGPY','QSIxB','nPZTP','5yzGgPo','gpOjS','pinnedAt','Message\x20you\x20are\x20pinning\x20was\x20not\x20found','2493LttcdV','nmOlN','sFUbK','4|2|3|1|0','ouvou','methods','FhxeH','orqSV','setPinnedByIdAndUserId','KlfDg','error-action-not-allowed','Message_QuoteChainLimit','attachments','Invalid\x20user','gXpWM','not-authorized','mSQxj','dMYcT','dyFfU','RmoFq','Error','error-invalid-message','message_pinned','MmsVD','Message_pinning','iJoLP','199876DyQDKb','error-invalid-user','fheXF','unpinMessage','2513lznYYz','username','msg'];_0x9597=function(){return _0x39dce1;};return _0x9597();}(function(_0x329b7b,_0x579a2e){const _0x1f259a=_0x1bfd,_0x4b82fc=_0x329b7b();while(!![]){try{const _0x1e91a2=parseInt(_0x1f259a(0x172))/0x1*(-parseInt(_0x1f259a(0x190))/0x2)+parseInt(_0x1f259a(0x199))/0x3+parseInt(_0x1f259a(0x19b))/0x4*(-parseInt(_0x1f259a(0x1a6))/0x5)+-parseInt(_0x1f259a(0x1a8))/0x6*(-parseInt(_0x1f259a(0x194))/0x7)+-parseInt(_0x1f259a(0x1a5))/0x8+parseInt(_0x1f259a(0x176))/0x9*(parseInt(_0x1f259a(0x19e))/0xa)+parseInt(_0x1f259a(0x16d))/0xb;if(_0x1e91a2===_0x579a2e)break;else _0x4b82fc['push'](_0x4b82fc['shift']());}catch(_0x1741d8){_0x4b82fc['push'](_0x4b82fc['shift']());}}}(_0x9597,0x479a1));import{Meteor}from'meteor/meteor';import{check}from'meteor/check';import{settings}from'../../settings';function _0x1bfd(_0x422b67,_0x5f19fd){const _0x9597bd=_0x9597();return _0x1bfd=function(_0x1bfd36,_0x1aa84d){_0x1bfd36=_0x1bfd36-0x168;let _0x129bb4=_0x9597bd[_0x1bfd36];return _0x129bb4;},_0x1bfd(_0x422b67,_0x5f19fd);}import{callbacks}from'../../callbacks';import{isTheLastMessage}from'../../lib';import{getUserAvatarURL}from'../../utils/lib/getUserAvatarURL';import{hasPermission}from'../../authorization';import{Subscriptions,Messages,Users,Rooms}from'../../models';const recursiveRemove=(_0x2d4a5a,_0xd45052=0x1)=>{const _0x34ce79=_0x1bfd,_0x2d5449={'VSFCr':function(_0x2d0d48,_0x331ab3){return _0x2d0d48>_0x331ab3;},'gXpWM':_0x34ce79(0x181),'iJoLP':'var\x20x\x20=\x2042;\x20return\x20x;'},_0xa4a428=_0x34ce79(0x179)[_0x34ce79(0x1ac)]('|');let _0x47de13=0x0;while(!![]){switch(_0xa4a428[_0x47de13++]){case'0':return _0x2d4a5a;case'1':new AsyncFunction('return\x20await\x20Promise.resolve(42);')();continue;case'2':if(_0x2d5449['VSFCr'](_0xd45052,settings['get'](_0x2d5449[_0x34ce79(0x184)])))return delete _0x2d4a5a[_0x34ce79(0x182)],new Function('var\x20x\x20=\x2042;\x20return\x20x;')(),_0x2d4a5a;continue;case'3':_0x2d4a5a['attachments']=Array[_0x34ce79(0x1ba)](_0x2d4a5a['attachments'])?_0x2d4a5a[_0x34ce79(0x182)]['map'](_0x1bbd80=>recursiveRemove(_0x1bbd80,_0xd45052+0x1)):null;continue;case'4':if(!_0x2d4a5a){new Function(_0x2d5449[_0x34ce79(0x18f)])();return;}continue;}break;}},shouldAdd=(_0xef8049,_0x282c11)=>!_0xef8049[_0x4be6df(0x1aa)](({message_link:_0x5ee032})=>_0x5ee032&&_0x5ee032===_0x282c11['message_link']);Meteor[_0x4be6df(0x17b)]({'pinMessage'(_0x101905,_0x34f96a){const _0xbd7671=_0x4be6df,_0x41d881={'XkGPY':function(_0xa026ae,_0x6f3e9,_0x2d932b){return _0xa026ae(_0x6f3e9,_0x2d932b);},'dyFfU':_0xbd7671(0x16e),'nmOlN':_0xbd7671(0x191),'gpOjS':_0xbd7671(0x183),'iCMwe':_0xbd7671(0x1a2),'KDUAb':_0xbd7671(0x1a1),'cQQfu':'pinMessage','mSQxj':_0xbd7671(0x18e),'UkNbV':function(_0x37751a,_0x11b4e0){return _0x37751a==_0x11b4e0;},'TuZSU':'Message\x20you\x20are\x20pinning\x20was\x20not\x20found','fheXF':function(_0x1182f0,_0x25131a){return _0x1182f0===_0x25131a;},'orqSV':_0xbd7671(0x197),'QSIxB':function(_0x45180e,_0x448488,_0x278da5,_0xdd9a1a){return _0x45180e(_0x448488,_0x278da5,_0xdd9a1a);},'FhxeH':_0xbd7671(0x185),'KlfDg':_0xbd7671(0x1a7),'sFUbK':_0xbd7671(0x1b6),'dMYcT':function(_0x2fd151,_0x247584,_0x237fdc){return _0x2fd151(_0x247584,_0x237fdc);},'Cwpoj':function(_0x33a1be,_0x383d7f,_0x2eb8b4){return _0x33a1be(_0x383d7f,_0x2eb8b4);},'yVqoW':_0xbd7671(0x198),'RBdFQ':function(_0x18164b,_0x2bd259){return _0x18164b(_0x2bd259);}};check(_0x101905[_0xbd7671(0x1b8)],String);const _0x5cd607=Meteor[_0xbd7671(0x169)]();if(!_0x5cd607)throw new Meteor[(_0xbd7671(0x18a))](_0x41d881[_0xbd7671(0x177)],_0x41d881[_0xbd7671(0x173)],{'method':_0xbd7671(0x1bc)});if(!settings[_0xbd7671(0x19c)](_0x41d881['iCMwe']))throw new Meteor[(_0xbd7671(0x18a))](_0xbd7671(0x180),_0x41d881[_0xbd7671(0x1ae)],{'method':_0x41d881[_0xbd7671(0x16a)],'action':_0x41d881[_0xbd7671(0x186)]});let _0x22b58d=Messages[_0xbd7671(0x1ad)](_0x101905[_0xbd7671(0x1b8)]);if(_0x41d881['UkNbV'](_0x22b58d,null)||_0x22b58d[_0xbd7671(0x1b8)]==null)throw new Meteor['Error'](_0xbd7671(0x18b),_0x41d881['TuZSU'],{'method':_0x41d881[_0xbd7671(0x16a)],'action':_0x41d881['mSQxj']});const _0x7d0661=Subscriptions[_0xbd7671(0x1b7)](_0x22b58d['rid'],Meteor[_0xbd7671(0x169)](),{'fields':{'_id':0x1}});if(!_0x7d0661){if(_0x41d881[_0xbd7671(0x192)](_0xbd7671(0x197),_0x41d881[_0xbd7671(0x17d)]))throw new Meteor['Error'](_0xbd7671(0x18b),_0xbd7671(0x175),{'method':_0x41d881[_0xbd7671(0x16a)],'action':_0x41d881[_0xbd7671(0x186)]});else _0x17accd[_0xbd7671(0x1b2)](_0x44e40b);}if(!_0x41d881[_0xbd7671(0x170)](hasPermission,Meteor[_0xbd7671(0x169)](),_0xbd7671(0x19d),_0x22b58d['rid']))throw new Meteor[(_0xbd7671(0x18a))](_0x41d881[_0xbd7671(0x17c)],_0xbd7671(0x1af),{'method':_0xbd7671(0x1bc)});const _0x55e662=Users['findOneById'](_0x5cd607);settings['get'](_0x41d881[_0xbd7671(0x17f)])&&Messages[_0xbd7671(0x1a3)](_0x101905[_0xbd7671(0x1b8)],_0x55e662);const _0x48c3e2=Meteor[_0xbd7671(0x19a)](_0x41d881[_0xbd7671(0x178)],_0x22b58d[_0xbd7671(0x1b9)],Meteor['userId']());_0x22b58d[_0xbd7671(0x1a4)]=!![],_0x22b58d[_0xbd7671(0x174)]=_0x34f96a||Date[_0xbd7671(0x1b5)],_0x22b58d[_0xbd7671(0x16b)]={'_id':_0x5cd607,'username':_0x55e662[_0xbd7671(0x195)]},_0x22b58d=callbacks['run'](_0xbd7671(0x1bd),_0x22b58d),Messages[_0xbd7671(0x17e)](_0x22b58d[_0xbd7671(0x1b8)],_0x22b58d[_0xbd7671(0x16b)],_0x22b58d[_0xbd7671(0x1a4)]);_0x41d881[_0xbd7671(0x187)](isTheLastMessage,_0x48c3e2,_0x101905)&&Rooms[_0xbd7671(0x1a9)](_0x48c3e2[_0xbd7671(0x1b8)],_0x22b58d[_0xbd7671(0x16b)],_0x22b58d['pinned']);const _0x49e5c3=[];return Array[_0xbd7671(0x1ba)](_0x22b58d['attachments'])&&_0x22b58d[_0xbd7671(0x182)][_0xbd7671(0x1b0)](_0xcb3ad1=>{const _0x2d3439=_0xbd7671,_0x11b41a={'esOlp':function(_0x4ab78f,_0xfef8c9,_0x5cae87){return _0x4ab78f(_0xfef8c9,_0x5cae87);}};(!_0xcb3ad1[_0x2d3439(0x1ab)]||_0x41d881[_0x2d3439(0x16f)](shouldAdd,_0x49e5c3,_0xcb3ad1))&&(_0x2d3439(0x16e)!==_0x41d881[_0x2d3439(0x188)]?(!_0x493de4[_0x2d3439(0x1ab)]||_0x11b41a[_0x2d3439(0x1b4)](_0x2a8aa0,_0x3372c6,_0x1f9f87))&&_0x1f91cb[_0x2d3439(0x1b2)](_0x28ef00):_0x49e5c3['push'](_0xcb3ad1));}),_0x41d881[_0xbd7671(0x1b1)](setTimeout,_0x41d881['yVqoW'],0x3e8),Messages[_0xbd7671(0x1b3)](_0xbd7671(0x18c),_0x22b58d['rid'],'',_0x55e662,{'attachments':[{'text':_0x22b58d[_0xbd7671(0x196)],'author_name':_0x22b58d['u'][_0xbd7671(0x195)],'author_icon':getUserAvatarURL(_0x22b58d['u']['username']),'ts':_0x22b58d['ts'],'attachments':_0x41d881[_0xbd7671(0x168)](recursiveRemove,_0x49e5c3)}]});},'unpinMessage'(_0x161398){const _0x27ba0a=_0x4be6df,_0x43af26={'MmsVD':function(_0xc4393,_0x5cab83,_0xca429a){return _0xc4393(_0x5cab83,_0xca429a);},'RmoFq':_0x27ba0a(0x180),'ouvou':_0x27ba0a(0x193),'nPZTP':_0x27ba0a(0x18e),'duiDA':function(_0x162ed1,_0x17e483){return _0x162ed1==_0x17e483;},'HGeOb':function(_0x236ad1,_0x236083){return _0x236ad1==_0x236083;},'bytQZ':_0x27ba0a(0x18b),'foGrQ':_0x27ba0a(0x1bb),'pGMQk':function(_0x50cf8e,_0x49bd6f,_0x700e4,_0x2fa3e5){return _0x50cf8e(_0x49bd6f,_0x700e4,_0x2fa3e5);},'PBQai':_0x27ba0a(0x1a7),'JAbjR':_0x27ba0a(0x1bd),'NXKwM':_0x27ba0a(0x1b6)};_0x43af26[_0x27ba0a(0x18d)](check,_0x161398[_0x27ba0a(0x1b8)],String);if(!Meteor['userId']())throw new Meteor['Error'](_0x27ba0a(0x191),_0x27ba0a(0x183),{'method':'unpinMessage'});if(!settings['get']('Message_AllowPinning'))throw new Meteor[(_0x27ba0a(0x18a))](_0x43af26[_0x27ba0a(0x189)],_0x27ba0a(0x1a1),{'method':_0x43af26['ouvou'],'action':_0x43af26['nPZTP']});let _0xe42ca4=Messages[_0x27ba0a(0x1ad)](_0x161398[_0x27ba0a(0x1b8)]);if(_0x43af26['duiDA'](_0xe42ca4,null)||_0x43af26['HGeOb'](_0xe42ca4[_0x27ba0a(0x1b8)],null))throw new Meteor[(_0x27ba0a(0x18a))](_0x43af26[_0x27ba0a(0x16c)],_0x27ba0a(0x1bb),{'method':'unpinMessage','action':_0x27ba0a(0x18e)});const _0x4b75c4=Subscriptions[_0x27ba0a(0x1b7)](_0xe42ca4[_0x27ba0a(0x1b9)],Meteor[_0x27ba0a(0x169)](),{'fields':{'_id':0x1}});if(!_0x4b75c4)throw new Meteor['Error'](_0x43af26['bytQZ'],_0x43af26['foGrQ'],{'method':_0x43af26[_0x27ba0a(0x17a)],'action':_0x43af26[_0x27ba0a(0x171)]});if(!_0x43af26[_0x27ba0a(0x1a0)](hasPermission,Meteor[_0x27ba0a(0x169)](),'pin-message',_0xe42ca4[_0x27ba0a(0x1b9)]))throw new Meteor[(_0x27ba0a(0x18a))]('not-authorized',_0x27ba0a(0x1af),{'method':_0x27ba0a(0x193)});const _0x588b0f=Users['findOneById'](Meteor[_0x27ba0a(0x169)]());settings[_0x27ba0a(0x19c)](_0x43af26['PBQai'])&&Messages['cloneAndSaveAsHistoryById'](_0xe42ca4[_0x27ba0a(0x1b8)],_0x588b0f);_0xe42ca4[_0x27ba0a(0x1a4)]=![],_0xe42ca4[_0x27ba0a(0x16b)]={'_id':Meteor[_0x27ba0a(0x169)](),'username':_0x588b0f['username']},_0xe42ca4=callbacks['run'](_0x43af26[_0x27ba0a(0x19f)],_0xe42ca4);const _0x34a512=Meteor[_0x27ba0a(0x19a)](_0x43af26['NXKwM'],_0xe42ca4[_0x27ba0a(0x1b9)],Meteor[_0x27ba0a(0x169)]());return isTheLastMessage(_0x34a512,_0x161398)&&Rooms[_0x27ba0a(0x1a9)](_0x34a512[_0x27ba0a(0x1b8)],_0xe42ca4['pinnedBy'],_0xe42ca4[_0x27ba0a(0x1a4)]),eval('JSON[\'stringify\']({ \'safe\': !![] });'),Messages['setPinnedByIdAndUserId'](_0xe42ca4['_id'],_0xe42ca4[_0x27ba0a(0x16b)],_0xe42ca4[_0x27ba0a(0x1a4)]);}});