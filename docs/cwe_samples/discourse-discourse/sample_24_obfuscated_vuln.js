function _0xa258(){const _0x1b2b41=['api/server/controllers/AskController.js\x20-\x20response\x20end','end','6975KxtSwK','title','aborted','612CUXfcP','set','~/config','XFKId','441iIXAFa','endpoint','djiFO','jghrC','FIVE_MINUTES','body','bbhsL','hmljs','YpfVl','7518JLXbit','bRxiD','~/server/utils','signal','MESSAGES','pyNLb','files','responsePromise','user','attachments','model','3860472gmrsHC','XnpAb','3572079ICLEqJ','New\x20Chat','exports','430364DyvjSl','librechat-data-provider','~/cache','requestCompleted','promptTokens','~/server/middleware','NO_PARENT','YKkPG','IxAXA','api/server/controllers/AskController.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','abort','dFbvJ','modelOptions','savedMessageIds','debug','has','RKJcl','options','skipSaveUserMessage','messageId','gOTuh','image_urls','2376576eIuzWb','lodash/throttle','close','exists','fyZbN','userMessagePromise','22177269pQtKGe','conversationId'];_0xa258=function(){return _0x1b2b41;};return _0xa258();}const _0x8f89ea=_0x2f57;function _0x2f57(_0x133baa,_0x357cfe){const _0xa25812=_0xa258();return _0x2f57=function(_0x2f572f,_0x4f0c84){_0x2f572f=_0x2f572f-0x13b;let _0x516ff4=_0xa25812[_0x2f572f];return _0x516ff4;},_0x2f57(_0x133baa,_0x357cfe);}(function(_0x4f6d52,_0x70daf5){const _0x14eafd=_0x2f57,_0x51e192=_0x4f6d52();while(!![]){try{const _0x11c480=-parseInt(_0x14eafd(0x170))/0x1+parseInt(_0x14eafd(0x160))/0x2*(-parseInt(_0x14eafd(0x157))/0x3)+-parseInt(_0x14eafd(0x153))/0x4*(-parseInt(_0x14eafd(0x150))/0x5)+-parseInt(_0x14eafd(0x146))/0x6+-parseInt(_0x14eafd(0x16d))/0x7+-parseInt(_0x14eafd(0x16b))/0x8+parseInt(_0x14eafd(0x14c))/0x9;if(_0x11c480===_0x70daf5)break;else _0x51e192['push'](_0x51e192['shift']());}catch(_0x1b2c5b){_0x51e192['push'](_0x51e192['shift']());}}}(_0xa258,0x4aa17));const throttle=require(_0x8f89ea(0x147)),{getResponseSender,Constants,CacheKeys,Time}=require(_0x8f89ea(0x171)),{createAbortController,handleAbortError}=require(_0x8f89ea(0x175)),{sendMessage,createOnProgress}=require(_0x8f89ea(0x162)),{getLogStores}=require(_0x8f89ea(0x172)),{saveMessage}=require('~/models'),{logger}=require(_0x8f89ea(0x155)),AskController=async(_0x51844d,_0x3db595,_0x25d5a6,_0x1828ea,_0x2c864f)=>{const _0x232fa6=_0x8f89ea,_0x80aadf={'XnpAb':_0x232fa6(0x159),'mZTrL':function(_0x5d502b,_0x1a5b84){return _0x5d502b===_0x1a5b84;},'iYyzj':_0x232fa6(0x14b),'jghrC':function(_0x227113,_0x5385fc){return _0x227113===_0x5385fc;},'YpfVl':'[AskController]\x20Request\x20closed','bbhsL':'[AskController]','IxAXA':function(_0x56312a,_0x2f0474){return _0x56312a(_0x2f0474);},'mTGpo':function(_0x48359a,_0xb75d82){return _0x48359a(_0xb75d82);},'pyNLb':function(_0x7fd445,_0x546792,_0x3d03ab,_0x5904f5,_0x4f1a65){return _0x7fd445(_0x546792,_0x3d03ab,_0x5904f5,_0x4f1a65);},'gOTuh':_0x232fa6(0x16e),'XFKId':function(_0x5bf1d1,_0x439430){return _0x5bf1d1!==_0x439430;},'bRxiD':_0x232fa6(0x177),'vMAxN':function(_0x316fcb,_0x4aa750,_0x4af830){return _0x316fcb(_0x4aa750,_0x4af830);},'wvktb':function(_0x2011c3,_0x50bc6e,_0x32d19a,_0x42372c){return _0x2011c3(_0x50bc6e,_0x32d19a,_0x42372c);},'yvfoC':'fyZbN','RKJcl':function(_0x4f9123,_0x56e9c9,_0x3fb7ce){return _0x4f9123(_0x56e9c9,_0x3fb7ce);}};let {text:_0x4fff34,endpointOption:_0x279bab,conversationId:_0x17359a,modelDisplayLabel:_0xddeda8,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x51844d[_0x232fa6(0x15c)];logger[_0x232fa6(0x13e)](_0x80aadf[_0x232fa6(0x15d)],{'text':_0x4fff34,'conversationId':_0x17359a,..._0x279bab,'modelsConfig':_0x279bab['modelsConfig']?_0x232fa6(0x149):''});let _0x1be9b9,_0x1403b0,_0x142e69,_0x35defa,_0x14172c;const _0x1796a2=_0x80aadf[_0x232fa6(0x178)](getResponseSender,{..._0x279bab,'model':_0x279bab[_0x232fa6(0x13c)]['model'],'modelDisplayLabel':_0xddeda8}),_0x17fbbe=!_0x17359a,_0x31473f=_0x51844d[_0x232fa6(0x168)]['id'],_0x1bcfe1=(_0xe7a93e={})=>{const _0x55b303=_0x232fa6;if(_0x55b303(0x15e)!==_0x80aadf[_0x55b303(0x16c)])for(let _0x1d6abc in _0xe7a93e){if(_0x1d6abc==='userMessage')_0x1be9b9=_0xe7a93e[_0x1d6abc],_0x35defa=_0xe7a93e[_0x1d6abc][_0x55b303(0x143)];else{if(_0x80aadf['mZTrL'](_0x1d6abc,_0x80aadf['iYyzj']))_0x1403b0=_0xe7a93e[_0x1d6abc];else{if(_0x80aadf['mZTrL'](_0x1d6abc,'responseMessageId'))_0x14172c=_0xe7a93e[_0x1d6abc];else{if(_0x80aadf[_0x55b303(0x15a)](_0x1d6abc,_0x55b303(0x174)))_0x142e69=_0xe7a93e[_0x1d6abc];else!_0x17359a&&_0x1d6abc===_0x55b303(0x14d)&&(_0x17359a=_0xe7a93e[_0x1d6abc]);}}}}else _0x55564c=_0xf94fde[_0x2a6892];};let _0x45f03d;try{const {client:_0x5576de}=await _0x1828ea({'req':_0x51844d,'res':_0x3db595,'endpointOption':_0x279bab}),_0x204669=_0x80aadf['mTGpo'](getLogStores,CacheKeys[_0x232fa6(0x164)]),{onProgress:_0x5ee6c2,getPartialText:_0x56e6e7}=_0x80aadf[_0x232fa6(0x178)](createOnProgress,{'onProgress':throttle(({text:_0x55015d})=>{const _0x2400e5=_0x232fa6;_0x204669[_0x2400e5(0x154)](_0x14172c,_0x55015d,Time[_0x2400e5(0x15b)]);},0xbb8,{'trailing':![]})});_0x45f03d=_0x56e6e7;const _0x225869=()=>({'sender':_0x1796a2,'conversationId':_0x17359a,'userMessagePromise':_0x1403b0,'messageId':_0x14172c,'parentMessageId':overrideParentMessageId??_0x35defa,'text':_0x56e6e7(),'userMessage':_0x1be9b9,'promptTokens':_0x142e69}),{abortController:_0x4f7f26,onStart:_0x425516}=_0x80aadf[_0x232fa6(0x165)](createAbortController,_0x51844d,_0x3db595,_0x225869,_0x1bcfe1);_0x3db595['on'](_0x232fa6(0x148),()=>{const _0x187a15=_0x232fa6;logger['debug'](_0x80aadf[_0x187a15(0x15f)]);if(!_0x4f7f26)return;else{if(_0x4f7f26['signal'][_0x187a15(0x152)])return;else{if(_0x4f7f26[_0x187a15(0x173)])return;}}_0x4f7f26[_0x187a15(0x17a)](),logger[_0x187a15(0x13e)]('[AskController]\x20Request\x20aborted\x20on\x20close');});const _0x58c25b={'user':_0x31473f,'parentMessageId':parentMessageId,'conversationId':_0x17359a,'overrideParentMessageId':overrideParentMessageId,'getReqData':_0x1bcfe1,'onStart':_0x425516,'abortController':_0x4f7f26,'progressCallback':_0x5ee6c2,'progressOptions':{'res':_0x3db595}};let _0x5c9f34=await _0x5576de['sendMessage'](_0x4fff34,_0x58c25b);_0x5c9f34[_0x232fa6(0x158)]=_0x279bab[_0x232fa6(0x158)];const {conversation:conversation={}}=await _0x5576de[_0x232fa6(0x167)];conversation[_0x232fa6(0x151)]=conversation&&!conversation['title']?null:conversation?.['title']||_0x80aadf[_0x232fa6(0x144)];_0x5576de[_0x232fa6(0x141)]['attachments']&&(_0x80aadf[_0x232fa6(0x156)](_0x80aadf[_0x232fa6(0x161)],_0x232fa6(0x13b))?(_0x1be9b9[_0x232fa6(0x166)]=_0x5576de[_0x232fa6(0x141)][_0x232fa6(0x169)],conversation[_0x232fa6(0x16a)]=_0x279bab[_0x232fa6(0x13c)][_0x232fa6(0x16a)],delete _0x1be9b9[_0x232fa6(0x145)]):(_0x164046[_0x232fa6(0x166)]=_0x4d6a6a[_0x232fa6(0x141)][_0x232fa6(0x169)],_0x429abe['model']=_0x2f0e53[_0x232fa6(0x13c)][_0x232fa6(0x16a)],delete _0x19f425[_0x232fa6(0x145)]));!_0x4f7f26[_0x232fa6(0x163)]['aborted']&&(_0x80aadf['vMAxN'](sendMessage,_0x3db595,{'final':!![],'conversation':conversation,'title':conversation[_0x232fa6(0x151)],'requestMessage':_0x1be9b9,'responseMessage':_0x5c9f34}),_0x3db595[_0x232fa6(0x14f)](),!_0x5576de[_0x232fa6(0x13d)][_0x232fa6(0x13f)](_0x5c9f34[_0x232fa6(0x143)])&&await _0x80aadf['wvktb'](saveMessage,_0x51844d,{..._0x5c9f34,'user':_0x31473f},{'context':_0x232fa6(0x14e)}));!_0x5576de[_0x232fa6(0x142)]&&await saveMessage(_0x51844d,_0x1be9b9,{'context':_0x232fa6(0x179)});if(_0x2c864f&&parentMessageId===Constants[_0x232fa6(0x176)]&&_0x17fbbe){if(_0x232fa6(0x14a)===_0x80aadf['yvfoC'])_0x80aadf[_0x232fa6(0x140)](_0x2c864f,_0x51844d,{'text':_0x4fff34,'response':_0x5c9f34,'client':_0x5576de});else return;}}catch(_0x4a7abc){const _0x1df450=_0x45f03d&&_0x45f03d();_0x80aadf[_0x232fa6(0x165)](handleAbortError,_0x3db595,_0x51844d,_0x4a7abc,{'partialText':_0x1df450,'conversationId':_0x17359a,'sender':_0x1796a2,'messageId':_0x14172c,'parentMessageId':_0x35defa??parentMessageId});}};module[_0x8f89ea(0x16f)]=AskController;