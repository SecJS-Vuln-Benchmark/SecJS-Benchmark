const _0x2e3922=_0x316a;(function(_0x1dd073,_0x198112){const _0x1500a5=_0x316a,_0x4047a8=_0x1dd073();while(!![]){try{const _0x56cd0d=parseInt(_0x1500a5(0x1f3))/0x1*(parseInt(_0x1500a5(0x22c))/0x2)+parseInt(_0x1500a5(0x229))/0x3*(parseInt(_0x1500a5(0x1dc))/0x4)+-parseInt(_0x1500a5(0x1ff))/0x5*(parseInt(_0x1500a5(0x1e4))/0x6)+-parseInt(_0x1500a5(0x204))/0x7+-parseInt(_0x1500a5(0x1fb))/0x8*(-parseInt(_0x1500a5(0x21b))/0x9)+-parseInt(_0x1500a5(0x1f7))/0xa*(parseInt(_0x1500a5(0x1dd))/0xb)+parseInt(_0x1500a5(0x1f4))/0xc;if(_0x56cd0d===_0x198112)break;else _0x4047a8['push'](_0x4047a8['shift']());}catch(_0x2537b8){_0x4047a8['push'](_0x4047a8['shift']());}}}(_0x2eb8,0x635f1));const {Session,Balance,getFiles,deleteFiles,deleteConvos,deletePresets,deleteMessages,deleteUserById}=require(_0x2e3922(0x20d)),User=require(_0x2e3922(0x1fd)),{updateUserPluginAuth,deleteUserPluginAuth}=require(_0x2e3922(0x1e1)),{updateUserPluginsService,deleteUserKey}=require(_0x2e3922(0x21f)),{verifyEmail,resendVerificationEmail}=require(_0x2e3922(0x1f1)),{processDeleteRequest}=require(_0x2e3922(0x234)),{deleteAllSharedLinks}=require('~/models/Share'),{deleteToolCalls}=require('~/models/ToolCall'),{Transaction}=require('~/models/Transaction'),{logger}=require(_0x2e3922(0x22e)),getUserController=async(_0x3985c5,_0x50e953)=>{const _0x4b255f=_0x2e3922;_0x50e953['status'](0xc8)[_0x4b255f(0x1ed)](_0x3985c5['user']);},getTermsStatusController=async(_0x3c9c58,_0x42a4ef)=>{const _0x10ad92=_0x2e3922,_0x2dca23={'bGqjj':'[authService]','zscho':_0x10ad92(0x1e3),'NuKzO':function(_0x31bba4,_0x3858dd){return _0x31bba4!==_0x3858dd;},'kBwCE':_0x10ad92(0x22b),'EMkII':'Error\x20fetching\x20terms\x20acceptance\x20status'};try{const _0x3866d4=await User[_0x10ad92(0x205)](_0x3c9c58['user']['id']);if(!_0x3866d4)return _0x42a4ef[_0x10ad92(0x210)](0x194)[_0x10ad92(0x232)]({'message':_0x2dca23[_0x10ad92(0x21a)]});_0x42a4ef['status'](0xc8)[_0x10ad92(0x232)]({'termsAccepted':!!_0x3866d4[_0x10ad92(0x220)]});}catch(_0x1cf258){if(_0x2dca23[_0x10ad92(0x20f)]('PrsSb',_0x2dca23['kBwCE'])){_0x3fb5bc[_0x10ad92(0x20e)](_0x2dca23[_0x10ad92(0x22a)],_0x3695d7);const {status:_0x4f7814,message:_0x410589}=_0x2ee0f2;_0x4676f2[_0x10ad92(0x210)](_0x4f7814)['send']({'message':_0x410589});}else logger[_0x10ad92(0x20e)]('Error\x20fetching\x20terms\x20acceptance\x20status:',_0x1cf258),_0x42a4ef[_0x10ad92(0x210)](0x1f4)['json']({'message':_0x2dca23[_0x10ad92(0x224)]});}},acceptTermsController=async(_0x47953e,_0x27c25e)=>{const _0x3232f8=_0x2e3922,_0x2e5516={'Wdhaw':_0x3232f8(0x1e3),'jpUmI':_0x3232f8(0x200),'nYsRt':_0x3232f8(0x213),'pvoRO':_0x3232f8(0x225)};try{const _0x5bb3ec=await User['findByIdAndUpdate'](_0x47953e['user']['id'],{'termsAccepted':!![]},{'new':!![]});if(!_0x5bb3ec)return _0x27c25e[_0x3232f8(0x210)](0x194)[_0x3232f8(0x232)]({'message':_0x2e5516['Wdhaw']});_0x27c25e['status'](0xc8)[_0x3232f8(0x232)]({'message':_0x2e5516[_0x3232f8(0x1df)]});}catch(_0x49facf){logger['error'](_0x2e5516[_0x3232f8(0x1ec)],_0x49facf),_0x27c25e[_0x3232f8(0x210)](0x1f4)['json']({'message':_0x2e5516[_0x3232f8(0x208)]});}},deleteUserFiles=async _0x3aea68=>{const _0x588f0a=_0x2e3922,_0x2f838e={'fjpaw':function(_0x4141c4,_0xc4fcbb){return _0x4141c4===_0xc4fcbb;},'wlRll':_0x588f0a(0x207),'wcyic':_0x588f0a(0x228),'CwmXy':function(_0x3f32f5,_0x1ea9af){return _0x3f32f5(_0x1ea9af);},'oIywq':function(_0x3015f5,_0x313955){return _0x3015f5(_0x313955);},'qTfqg':_0x588f0a(0x20b)};try{if(_0x2f838e[_0x588f0a(0x216)](_0x2f838e['wlRll'],_0x2f838e[_0x588f0a(0x201)]))return _0x51d02e['status'](0x190)[_0x588f0a(0x232)](_0x56f254);else{const _0xa6287f=await _0x2f838e[_0x588f0a(0x1ef)](getFiles,{'user':_0x3aea68[_0x588f0a(0x1e0)]['id']});await _0x2f838e['oIywq'](processDeleteRequest,{'req':_0x3aea68,'files':_0xa6287f});}}catch(_0x27d856){logger[_0x588f0a(0x20e)](_0x2f838e['qTfqg'],_0x27d856);}},updateUserPluginsController=async(_0x153d6a,_0x430a81)=>{const _0x44fd4d=_0x2e3922,_0x2f9092={'BPlIY':_0x44fd4d(0x219),'BOqcX':'[userPluginsService]','JnEby':function(_0x4ba906,_0x3f9131){return _0x4ba906===_0x3f9131;},'WlJQC':function(_0x171df0,_0x21185f){return _0x171df0<_0x21185f;},'KnIHc':function(_0x330b19,_0x26f9de,_0x419415,_0x22e36c,_0x3fe43b){return _0x330b19(_0x26f9de,_0x419415,_0x22e36c,_0x3fe43b);},'TTepu':function(_0x56b562,_0x5406ee){return _0x56b562 instanceof _0x5406ee;},'yPSVs':_0x44fd4d(0x22d),'bFFOh':_0x44fd4d(0x20a),'srzOQ':function(_0xf72304,_0x25daba){return _0xf72304 instanceof _0x25daba;},'DudAw':'yrTUL','ZPfCn':'[authService]','fRnTG':'Something\x20went\x20wrong.'},{user:_0x2ed1ee}=_0x153d6a,{pluginKey:_0x917b2c,action:_0x4ca4cd,auth:_0x481562,isEntityTool:_0x180a58}=_0x153d6a[_0x44fd4d(0x1ee)];let _0x598b1f;try{if(!_0x180a58){const _0x391d4a=await updateUserPluginsService(_0x2ed1ee,_0x917b2c,_0x4ca4cd);if(_0x391d4a instanceof Error){logger[_0x44fd4d(0x20e)](_0x2f9092[_0x44fd4d(0x21d)],_0x391d4a);const {status:_0x508587,message:_0x40f465}=_0x391d4a;_0x430a81['status'](_0x508587)[_0x44fd4d(0x1ed)]({'message':_0x40f465});}}if(_0x481562){const _0x329f23=Object[_0x44fd4d(0x1e6)](_0x481562),_0x402fff=Object[_0x44fd4d(0x202)](_0x481562);if(_0x2f9092[_0x44fd4d(0x1f8)](_0x4ca4cd,'install')&&_0x329f23[_0x44fd4d(0x22f)]>0x0)for(let _0x515bb6=0x0;_0x2f9092['WlJQC'](_0x515bb6,_0x329f23['length']);_0x515bb6++){_0x598b1f=await _0x2f9092[_0x44fd4d(0x21c)](updateUserPluginAuth,_0x2ed1ee['id'],_0x329f23[_0x515bb6],_0x917b2c,_0x402fff[_0x515bb6]);if(_0x2f9092['TTepu'](_0x598b1f,Error)){logger[_0x44fd4d(0x20e)](_0x44fd4d(0x217),_0x598b1f);const {status:_0x519fa6,message:_0x301739}=_0x598b1f;_0x430a81[_0x44fd4d(0x210)](_0x519fa6)['send']({'message':_0x301739});}}if(_0x4ca4cd===_0x2f9092[_0x44fd4d(0x221)]&&_0x329f23[_0x44fd4d(0x22f)]>0x0){if(_0x2f9092[_0x44fd4d(0x21e)]!==_0x44fd4d(0x20a))_0x4abb57[_0x44fd4d(0x20e)](_0x44fd4d(0x213),_0x294fdf),_0x4eaad7[_0x44fd4d(0x210)](0x1f4)[_0x44fd4d(0x232)]({'message':'Error\x20accepting\x20terms'});else for(let _0xeae24c=0x0;_0x2f9092['WlJQC'](_0xeae24c,_0x329f23['length']);_0xeae24c++){_0x598b1f=await deleteUserPluginAuth(_0x2ed1ee['id'],_0x329f23[_0xeae24c]);if(_0x2f9092[_0x44fd4d(0x1fa)](_0x598b1f,Error)){if(_0x2f9092[_0x44fd4d(0x1f8)](_0x2f9092[_0x44fd4d(0x1f0)],_0x44fd4d(0x203))){logger[_0x44fd4d(0x20e)](_0x2f9092[_0x44fd4d(0x227)],_0x598b1f);const {status:_0x2a72b3,message:_0x1d2f65}=_0x598b1f;_0x430a81[_0x44fd4d(0x210)](_0x2a72b3)[_0x44fd4d(0x1ed)]({'message':_0x1d2f65});}else return _0x30e355['error'](_0x2f9092[_0x44fd4d(0x222)],_0x5aebf7),_0x48003e[_0x44fd4d(0x210)](0x1f4)['json']({'message':'Something\x20went\x20wrong.'});}}}}_0x430a81[_0x44fd4d(0x210)](0xc8)[_0x44fd4d(0x1ed)]();}catch(_0x3b71ec){return logger[_0x44fd4d(0x20e)](_0x44fd4d(0x219),_0x3b71ec),_0x430a81[_0x44fd4d(0x210)](0x1f4)[_0x44fd4d(0x232)]({'message':_0x2f9092[_0x44fd4d(0x1e2)]});}},deleteUserController=async(_0xe9bec1,_0x2f0f5b)=>{const _0x11ab54=_0x2e3922,_0x49a909={'IbJUl':'14|3|4|1|11|5|8|6|0|7|10|13|12|2|9','PePyZ':function(_0x188127,_0x1bba5a){return _0x188127(_0x1bba5a);},'sMkjI':function(_0x41da50,_0x2a885e){return _0x41da50(_0x2a885e);},'OKXmY':_0x11ab54(0x226),'CuufM':function(_0x451533,_0x5461ee,_0x5d5e4e){return _0x451533(_0x5461ee,_0x5d5e4e);},'cHPRr':_0x11ab54(0x1e5),'wnuRX':'Something\x20went\x20wrong.'},{user:_0xc09d0f}=_0xe9bec1;try{const _0x47a704=_0x49a909[_0x11ab54(0x1ea)]['split']('|');let _0x4ae698=0x0;while(!![]){switch(_0x47a704[_0x4ae698++]){case'0':await _0x49a909['PePyZ'](deleteUserById,_0xc09d0f['id']);continue;case'1':await _0x49a909['PePyZ'](deleteUserKey,{'userId':_0xc09d0f['id'],'all':!![]});continue;case'2':logger[_0x11ab54(0x212)]('User\x20deleted\x20account.\x20Email:\x20'+_0xc09d0f[_0x11ab54(0x1e9)]+'\x20ID:\x20'+_0xc09d0f['id']);continue;case'3':await Session[_0x11ab54(0x1f5)]({'user':_0xc09d0f['id']});continue;case'4':await Transaction['deleteMany']({'user':_0xc09d0f['id']});continue;case'5':await deletePresets(_0xc09d0f['id']);continue;case'6':await deleteUserPluginAuth(_0xc09d0f['id'],null,!![]);continue;case'7':await deleteAllSharedLinks(_0xc09d0f['id']);continue;case'8':await _0x49a909[_0x11ab54(0x218)](deleteConvos,_0xc09d0f['id']);continue;case'9':_0x2f0f5b[_0x11ab54(0x210)](0xc8)[_0x11ab54(0x1ed)]({'message':_0x49a909[_0x11ab54(0x1eb)]});continue;case'10':await _0x49a909[_0x11ab54(0x218)](deleteUserFiles,_0xe9bec1);continue;case'11':await Balance[_0x11ab54(0x1f5)]({'user':_0xc09d0f[_0x11ab54(0x215)]});continue;case'12':await deleteToolCalls(_0xc09d0f['id']);continue;case'13':await _0x49a909[_0x11ab54(0x1fe)](deleteFiles,null,_0xc09d0f['id']);continue;case'14':await _0x49a909['sMkjI'](deleteMessages,{'user':_0xc09d0f['id']});continue;}break;}}catch(_0x4ac63a){return logger[_0x11ab54(0x20e)](_0x49a909[_0x11ab54(0x214)],_0x4ac63a),_0x2f0f5b['status'](0x1f4)['json']({'message':_0x49a909[_0x11ab54(0x20c)]});}},verifyEmailController=async(_0x289acf,_0x2cfa2c)=>{const _0x2c3c16=_0x2e3922,_0x33f2a6={'BWemh':_0x2c3c16(0x1f2),'oenir':_0x2c3c16(0x1f9),'IIeRd':_0x2c3c16(0x20b),'IOWdT':function(_0x1d85b9,_0x1fc469){return _0x1d85b9!==_0x1fc469;},'AGLlt':_0x2c3c16(0x1f6)};try{const _0x40ab52=await verifyEmail(_0x289acf);if(_0x40ab52 instanceof Error)return _0x33f2a6[_0x2c3c16(0x223)](_0x2c3c16(0x1e8),'bKuLU')?_0x2cfa2c[_0x2c3c16(0x210)](0x190)['json'](_0x40ab52):(_0x5404a7[_0x2c3c16(0x20e)](_0x33f2a6['BWemh'],_0x1324f6),_0x8c5a38[_0x2c3c16(0x210)](0x1f4)[_0x2c3c16(0x232)]({'message':_0x33f2a6[_0x2c3c16(0x1e7)]}));else{if(_0x33f2a6[_0x2c3c16(0x223)](_0x33f2a6['AGLlt'],_0x2c3c16(0x233)))return _0x2cfa2c[_0x2c3c16(0x210)](0xc8)[_0x2c3c16(0x232)](_0x40ab52);else _0x4a35d0[_0x2c3c16(0x20e)](_0x33f2a6[_0x2c3c16(0x1fc)],_0x34206c);}}catch(_0x1acfcd){return logger[_0x2c3c16(0x20e)](_0x33f2a6[_0x2c3c16(0x209)],_0x1acfcd),_0x2cfa2c['status'](0x1f4)[_0x2c3c16(0x232)]({'message':_0x33f2a6[_0x2c3c16(0x1e7)]});}},resendVerificationController=async(_0x1f0034,_0x1511ad)=>{const _0x13eb4c=_0x2e3922,_0x159097={'VwLlS':function(_0x437e3c,_0x27c85e){return _0x437e3c!==_0x27c85e;},'sxCnp':_0x13eb4c(0x230)};try{const _0x5a8233=await resendVerificationEmail(_0x1f0034);return _0x5a8233 instanceof Error?_0x1511ad[_0x13eb4c(0x210)](0x190)['json'](_0x5a8233):_0x159097[_0x13eb4c(0x231)](_0x13eb4c(0x1de),_0x159097[_0x13eb4c(0x211)])?_0x1511ad[_0x13eb4c(0x210)](0xc8)['json'](_0x5a8233):_0x16989f[_0x13eb4c(0x210)](0xc8)[_0x13eb4c(0x232)](_0x4d4c9e);}catch(_0x10c534){return logger['error'](_0x13eb4c(0x1f2),_0x10c534),_0x1511ad['status'](0x1f4)['json']({'message':_0x13eb4c(0x1f9)});}};function _0x316a(_0x2153ab,_0x20dac2){const _0x2eb828=_0x2eb8();return _0x316a=function(_0x316a52,_0x4ef978){_0x316a52=_0x316a52-0x1dc;let _0x3e6963=_0x2eb828[_0x316a52];return _0x3e6963;},_0x316a(_0x2153ab,_0x20dac2);}function _0x2eb8(){const _0x1f4497=['2925pMvWen','KnIHc','BOqcX','bFFOh','~/server/services/UserService','termsAccepted','yPSVs','BPlIY','IOWdT','EMkII','Error\x20accepting\x20terms','User\x20deleted','ZPfCn','dnuIn','3ZEgHlF','bGqjj','PrsSb','376phVIby','uninstall','~/config','length','fMTnJ','VwLlS','json','Qegrw','~/server/services/Files/process','204356qKfOQn','253649PwKfNI','bBeAM','jpUmI','user','~/server/services/PluginService','fRnTG','User\x20not\x20found','54CgyjxZ','[deleteUserController]','keys','oenir','KnYHC','email','IbJUl','OKXmY','nYsRt','send','body','CwmXy','DudAw','~/server/services/AuthService','[verifyEmailController]','680VgrouF','7518528ZuIEPC','deleteMany','RWzix','90kizlWo','JnEby','Something\x20went\x20wrong.','srzOQ','19816msaTMO','IIeRd','~/models/User','CuufM','230015aSXvvK','Terms\x20accepted\x20successfully','wcyic','values','yrTUL','4073405dSlTWg','findById','exports','dqjDH','pvoRO','BWemh','sPksU','[deleteUserFiles]','wnuRX','~/models','error','NuKzO','status','sxCnp','info','Error\x20accepting\x20terms:','cHPRr','_id','fjpaw','[authService]','sMkjI','[updateUserPluginsController]','zscho'];_0x2eb8=function(){return _0x1f4497;};return _0x2eb8();}module[_0x2e3922(0x206)]={'getUserController':getUserController,'getTermsStatusController':getTermsStatusController,'acceptTermsController':acceptTermsController,'deleteUserController':deleteUserController,'verifyEmailController':verifyEmailController,'updateUserPluginsController':updateUserPluginsController,'resendVerificationController':resendVerificationController};