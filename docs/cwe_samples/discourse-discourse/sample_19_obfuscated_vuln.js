const _0x2833f6=_0x597e;function _0x597e(_0x34b7cf,_0x18586d){const _0x3ff60f=_0x3ff6();return _0x597e=function(_0x597ed9,_0xae5c6){_0x597ed9=_0x597ed9-0x1bc;let _0x2d5dfb=_0x3ff60f[_0x597ed9];return _0x2d5dfb;},_0x597e(_0x34b7cf,_0x18586d);}(function(_0x4a7880,_0x15cb8f){const _0x5b1d2b=_0x597e,_0x396abf=_0x4a7880();while(!![]){try{const _0xba2184=parseInt(_0x5b1d2b(0x206))/0x1+-parseInt(_0x5b1d2b(0x1dd))/0x2+-parseInt(_0x5b1d2b(0x1fe))/0x3*(-parseInt(_0x5b1d2b(0x1c8))/0x4)+parseInt(_0x5b1d2b(0x1f0))/0x5+-parseInt(_0x5b1d2b(0x1ff))/0x6+parseInt(_0x5b1d2b(0x215))/0x7*(parseInt(_0x5b1d2b(0x1c7))/0x8)+-parseInt(_0x5b1d2b(0x1fa))/0x9;if(_0xba2184===_0x15cb8f)break;else _0x396abf['push'](_0x396abf['shift']());}catch(_0x3704bf){_0x396abf['push'](_0x396abf['shift']());}}}(_0x3ff6,0x8593b));function _0x3ff6(){const _0x992394=['pageSize','error','map','18zsObWT','3725676xnQPcJ','[getConvoTitle]\x20Error\x20getting\x20conversation\x20title','conversationId\x20user','messages','NHRzz','lQCMX','zSnOy','1050229dBJLVg','findOne','limit','files','fswvk','info','FwmjI','Failed\x20to\x20save\x20conversations\x20in\x20bulk.','deleteMany','Error\x20getting\x20single\x20conversation','length','lean','_id','push','eygJe','3221841wqvkaH','lASfW','BCiqt','countDocuments','wUVzg','\x20messages','pages','aniBw','cxJBl','ceil','BrNaH','exports','BcuQd','YwHJG','8HDvoGF','417016ecfYSo','tags','[getConvoFiles]\x20Error\x20getting\x20conversation\x20files','Error\x20fetching\x20conversations','~/config/winston','[saveConvo]\x20','OLtBR','forEach','wOIXX','[saveConvo]\x20Error\x20saving\x20conversation','New\x20Chat','deletedCount','context','bulkWrite','$or','Error\x20saving\x20conversation','\x20conversations\x20and\x20','debug','find','HlepX','TCInW','2011770ycVolF','floor','[getConvosByPage]\x20Error\x20getting\x20conversations','[deleteNullOrEmptyConversations]\x20Deleted\x20','[getConvosQueried]\x20Error\x20getting\x20conversations','NtCPI','toObject','eiMcm','[searchConversation]\x20Error\x20searching\x20conversation','[getConvo]\x20Error\x20getting\x20single\x20conversation','[deleteNullOrEmptyConversations]\x20Error\x20deleting\x20conversations','hwMmV','xOJeA','Error\x20getting\x20conversation\x20files','Error\x20getting\x20conversations','KkPil','./schema/convoSchema','DEqFm','aiUrV','1460775DZxdiY','HmYjx','uIJLo','conversationId','select','findOneAndUpdate','ECxwS','title','user','Error\x20deleting\x20conversations\x20with\x20null\x20or\x20empty\x20conversationId','2287881nFYdod'];_0x3ff6=function(){return _0x992394;};return _0x3ff6();}const Conversation=require(_0x2833f6(0x1ed)),{getMessages,deleteMessages}=require('./Message'),logger=require(_0x2833f6(0x1cc)),searchConversation=async _0x1eae7c=>{const _0x288f74=_0x2833f6,_0x3915db={'PvOoV':function(_0x2606f0,_0x224506){return _0x2606f0+_0x224506;},'FwmjI':function(_0xd35c5,_0x3b4c98){return _0xd35c5/_0x3b4c98;},'HmYjx':function(_0x3e933d,_0x4a4cf3){return _0x3e933d===_0x4a4cf3;},'lASfW':'yreYS','MvkTC':_0x288f74(0x201)};try{if(_0x3915db[_0x288f74(0x1f1)](_0x288f74(0x1f6),_0x3915db[_0x288f74(0x216)])){const _0x45150d=_0x3915db['PvOoV'](_0x424db9[_0x288f74(0x1de)](_0x3915db[_0x288f74(0x20c)](_0x395404,_0x55bb9f)),0x1);!_0x115023[_0x45150d]&&(_0x393fd3[_0x45150d]=[]),_0xbf8c49[_0x45150d]['push'](_0x1719e4),_0x251bb1[_0x3e6d3f[_0x288f74(0x1f3)]]=_0x57c069;}else return await Conversation[_0x288f74(0x207)]({'conversationId':_0x1eae7c},_0x3915db['MvkTC'])[_0x288f74(0x211)]();}catch(_0x4e7dc6){logger[_0x288f74(0x1fc)](_0x288f74(0x1e5),_0x4e7dc6);throw new Error('Error\x20searching\x20conversation');}},getConvoFiles=async _0x4881ed=>{const _0x40cc22=_0x2833f6,_0x28530b={'eygJe':'[getConvoTitle]\x20Error\x20getting\x20conversation\x20title','xOJeA':function(_0x2dc513,_0x4e0911){return _0x2dc513!==_0x4e0911;},'wOIXX':'wuOqr'};try{return(await Conversation[_0x40cc22(0x207)]({'conversationId':_0x4881ed},_0x40cc22(0x209))[_0x40cc22(0x211)]())?.[_0x40cc22(0x209)]??[];}catch(_0x2549e6){if(_0x28530b[_0x40cc22(0x1e9)](_0x28530b[_0x40cc22(0x1d0)],_0x40cc22(0x1c5))){logger[_0x40cc22(0x1fc)](_0x40cc22(0x1ca),_0x2549e6);throw new Error(_0x40cc22(0x1ea));}else return _0x373424['error'](_0x28530b[_0x40cc22(0x214)],_0x230fb6),{'message':'Error\x20getting\x20conversation\x20title'};}},getConvo=async(_0x3c0612,_0x32b2bd)=>{const _0x33ec6e=_0x2833f6,_0x5557a7={'DEqFm':function(_0x3bd78d,_0x4b4384){return _0x3bd78d===_0x4b4384;},'hwMmV':_0x33ec6e(0x1ce),'cxJBl':_0x33ec6e(0x204),'YwHJG':_0x33ec6e(0x1e6),'NHRzz':_0x33ec6e(0x20f)};try{return _0x5557a7[_0x33ec6e(0x1ee)](_0x33ec6e(0x1f2),_0x5557a7[_0x33ec6e(0x1e8)])?(_0x4c118e['error'](_0x33ec6e(0x1d1),_0x9b40ef),_0x24e173&&_0x2459d5?.['context']&&_0x427ebc[_0x33ec6e(0x20b)](_0x33ec6e(0x1cd)+_0x1412b2[_0x33ec6e(0x1d4)]),{'message':_0x33ec6e(0x1d7)}):await Conversation[_0x33ec6e(0x207)]({'user':_0x3c0612,'conversationId':_0x32b2bd})[_0x33ec6e(0x211)]();}catch(_0x379d2a){return _0x33ec6e(0x204)!==_0x5557a7[_0x33ec6e(0x1c1)]?(_0x24a004[_0x33ec6e(0x1fc)](_0x33ec6e(0x1df),_0x115d6f),{'message':_0x33ec6e(0x1eb)}):(logger[_0x33ec6e(0x1fc)](_0x5557a7[_0x33ec6e(0x1c6)],_0x379d2a),{'message':_0x5557a7[_0x33ec6e(0x203)]});}},deleteNullOrEmptyConversations=async()=>{const _0x119cb9=_0x2833f6;try{const _0x588052={'$or':[{'conversationId':null},{'conversationId':''},{'conversationId':{'$exists':![]}}]},_0x4eae98=await Conversation[_0x119cb9(0x20e)](_0x588052),_0x478c8b=await deleteMessages(_0x588052);return logger[_0x119cb9(0x20b)](_0x119cb9(0x1e0)+_0x4eae98[_0x119cb9(0x1d3)]+_0x119cb9(0x1d8)+_0x478c8b['deletedCount']+_0x119cb9(0x1be)),{'conversations':_0x4eae98,'messages':_0x478c8b};}catch(_0x55cebe){logger['error'](_0x119cb9(0x1e7),_0x55cebe);throw new Error(_0x119cb9(0x1f9));}};module[_0x2833f6(0x1c4)]={'Conversation':Conversation,'getConvoFiles':getConvoFiles,'searchConversation':searchConversation,'deleteNullOrEmptyConversations':deleteNullOrEmptyConversations,'saveConvo':async(_0x2eb9cb,{conversationId:_0x2d8d44,newConversationId:_0xebe5fe,..._0x4a30ae},_0x3d4536)=>{const _0x17f068=_0x2833f6,_0x2f11d6={'KkPil':function(_0x3ddccf,_0x245198,_0x1b33fc){return _0x3ddccf(_0x245198,_0x1b33fc);}};try{_0x3d4536&&_0x3d4536?.[_0x17f068(0x1d4)]&&logger[_0x17f068(0x1d9)](_0x17f068(0x1cd)+_0x3d4536[_0x17f068(0x1d4)]);const _0x491623=await _0x2f11d6[_0x17f068(0x1ec)](getMessages,{'conversationId':_0x2d8d44},_0x17f068(0x212)),_0x196277={..._0x4a30ae,'messages':_0x491623,'user':_0x2eb9cb[_0x17f068(0x1f8)]['id']};_0xebe5fe&&(_0x196277[_0x17f068(0x1f3)]=_0xebe5fe);const _0x2cc042=await Conversation[_0x17f068(0x1f5)]({'conversationId':_0x2d8d44,'user':_0x2eb9cb[_0x17f068(0x1f8)]['id']},_0x196277,{'new':!![],'upsert':!![]});return _0x2cc042[_0x17f068(0x1e3)]();}catch(_0x23c6a8){return logger[_0x17f068(0x1fc)](_0x17f068(0x1d1),_0x23c6a8),_0x3d4536&&_0x3d4536?.[_0x17f068(0x1d4)]&&logger[_0x17f068(0x20b)](_0x17f068(0x1cd)+_0x3d4536[_0x17f068(0x1d4)]),{'message':_0x17f068(0x1d7)};}},'bulkSaveConvos':async _0x2d555c=>{const _0x2fd08e=_0x2833f6,_0x2df75c={'zSnOy':'[saveBulkConversations]\x20Error\x20saving\x20conversations\x20in\x20bulk'};try{const _0x3f88cd=_0x2d555c[_0x2fd08e(0x1fd)](_0x1c084e=>({'updateOne':{'filter':{'conversationId':_0x1c084e[_0x2fd08e(0x1f3)],'user':_0x1c084e[_0x2fd08e(0x1f8)]},'update':_0x1c084e,'upsert':!![],'timestamps':![]}})),_0xc3c188=await Conversation[_0x2fd08e(0x1d5)](_0x3f88cd);return _0xc3c188;}catch(_0x4793d8){logger[_0x2fd08e(0x1fc)](_0x2df75c[_0x2fd08e(0x205)],_0x4793d8);throw new Error(_0x2fd08e(0x20d));}},'getConvosByPage':async(_0x1c9641,_0x547b59=0x1,_0x1241c4=0x19,_0x4569da=![],_0x3cfc45)=>{const _0x2e0f8d=_0x2833f6,_0x3d7fca={'aiUrV':_0x2e0f8d(0x1f9),'NpSjt':_0x2e0f8d(0x1bd),'QBVEs':_0x2e0f8d(0x1e4),'HlepX':function(_0x4700a8,_0x2da91e){return _0x4700a8/_0x2da91e;},'fswvk':function(_0x41eab0,_0x8ec6a7){return _0x41eab0*_0x8ec6a7;},'NtCPI':function(_0x206204,_0x165cf9){return _0x206204-_0x165cf9;},'BCiqt':_0x2e0f8d(0x1eb)},_0x2953d3={'user':_0x1c9641};if(_0x4569da){if('YzVwl'!==_0x3d7fca['NpSjt'])_0x2953d3['isArchived']=!![];else{_0x2b2a71[_0x2e0f8d(0x1fc)]('[deleteNullOrEmptyConversations]\x20Error\x20deleting\x20conversations',_0x2fdc5e);throw new _0x3f5299(_0x3d7fca[_0x2e0f8d(0x1ef)]);}}else _0x2e0f8d(0x1e4)===_0x3d7fca['QBVEs']?_0x2953d3[_0x2e0f8d(0x1d6)]=[{'isArchived':![]},{'isArchived':{'$exists':![]}}]:_0x43cf6b[_0x2e0f8d(0x1c9)]={'$in':_0x46329b};Array['isArray'](_0x3cfc45)&&_0x3cfc45[_0x2e0f8d(0x210)]>0x0&&(_0x2953d3[_0x2e0f8d(0x1c9)]={'$in':_0x3cfc45});try{const _0x384ae0=await Conversation[_0x2e0f8d(0x1bc)](_0x2953d3)||0x1,_0x447efa=Math['ceil'](_0x3d7fca[_0x2e0f8d(0x1db)](_0x384ae0,_0x1241c4)),_0x314d69=await Conversation[_0x2e0f8d(0x1da)](_0x2953d3)['sort']({'updatedAt':-0x1})['skip'](_0x3d7fca[_0x2e0f8d(0x20a)](_0x3d7fca[_0x2e0f8d(0x1e2)](_0x547b59,0x1),_0x1241c4))[_0x2e0f8d(0x208)](_0x1241c4)[_0x2e0f8d(0x211)]();return{'conversations':_0x314d69,'pages':_0x447efa,'pageNumber':_0x547b59,'pageSize':_0x1241c4};}catch(_0xab774b){return logger[_0x2e0f8d(0x1fc)](_0x2e0f8d(0x1df),_0xab774b),{'message':_0x3d7fca[_0x2e0f8d(0x217)]};}},'getConvosQueried':async(_0x2a31ba,_0x344ff7,_0x375769=0x1,_0x410310=0x19)=>{const _0x13f02e=_0x2833f6,_0x30146b={'TCInW':_0x13f02e(0x1cb)};try{if(!_0x344ff7||_0x344ff7[_0x13f02e(0x210)]===0x0)return{'conversations':[],'pages':0x1,'pageNumber':_0x375769,'pageSize':_0x410310};const _0x3416b8={},_0x585542={},_0x107ada=[];_0x344ff7[_0x13f02e(0x1cf)](_0x1611eb=>_0x107ada[_0x13f02e(0x213)](Conversation[_0x13f02e(0x207)]({'user':_0x2a31ba,'conversationId':_0x1611eb[_0x13f02e(0x1f3)]})[_0x13f02e(0x211)]()));const _0xe42ab=(await Promise['all'](_0x107ada))['filter'](Boolean);_0xe42ab[_0x13f02e(0x1cf)]((_0xcc61a5,_0x59dcb3)=>{const _0x5b439b=_0x13f02e,_0x5aa667=Math[_0x5b439b(0x1de)](_0x59dcb3/_0x410310)+0x1;!_0x3416b8[_0x5aa667]&&(_0x3416b8[_0x5aa667]=[]),_0x3416b8[_0x5aa667]['push'](_0xcc61a5),_0x585542[_0xcc61a5[_0x5b439b(0x1f3)]]=_0xcc61a5;});const _0x7aa503=Math[_0x13f02e(0x1c2)](_0xe42ab[_0x13f02e(0x210)]/_0x410310);return _0x3416b8[_0x13f02e(0x1bf)]=_0x7aa503,_0x3416b8[_0x13f02e(0x1fb)]=_0x410310,{'cache':_0x3416b8,'conversations':_0x3416b8[_0x375769]||[],'pages':_0x7aa503||0x1,'pageNumber':_0x375769,'pageSize':_0x410310,'convoMap':_0x585542};}catch(_0x1f7399){return logger[_0x13f02e(0x1fc)](_0x13f02e(0x1e1),_0x1f7399),{'message':_0x30146b[_0x13f02e(0x1dc)]};}},'getConvo':getConvo,'getConvoTitle':async(_0x2e79f2,_0x15f1a3)=>{const _0x41de04=_0x2833f6,_0x339855={'aniBw':function(_0x50eb78,_0x5a9117,_0x4a6af2){return _0x50eb78(_0x5a9117,_0x4a6af2);},'zIgds':_0x41de04(0x1d2),'BrNaH':_0x41de04(0x200),'ToqPQ':'Error\x20getting\x20conversation\x20title'};try{const _0x3e6539=await _0x339855[_0x41de04(0x1c0)](getConvo,_0x2e79f2,_0x15f1a3);return _0x3e6539&&!_0x3e6539['title']?null:_0x3e6539?.[_0x41de04(0x1f7)]||_0x339855['zIgds'];}catch(_0x2a8ed9){return logger[_0x41de04(0x1fc)](_0x339855[_0x41de04(0x1c3)],_0x2a8ed9),{'message':_0x339855['ToqPQ']};}},'deleteConvos':async(_0x2bde60,_0x96c399)=>{const _0x455095=_0x2833f6;let _0x3fa687=await Conversation['find']({..._0x96c399,'user':_0x2bde60})[_0x455095(0x1f4)](_0x455095(0x1f3));const _0x679794=_0x3fa687[_0x455095(0x1fd)](_0x484901=>_0x484901[_0x455095(0x1f3)]);let _0x3fbc51=await Conversation[_0x455095(0x20e)]({..._0x96c399,'user':_0x2bde60});return _0x3fbc51[_0x455095(0x202)]=await deleteMessages({'conversationId':{'$in':_0x679794}}),_0x3fbc51;}};