function _0x5e06(_0x5d6839,_0x54127c){const _0x51b441=_0x51b4();return _0x5e06=function(_0x5e0648,_0x1d78d5){_0x5e0648=_0x5e0648-0x9e;let _0x4c1aad=_0x51b441[_0x5e0648];return _0x4c1aad;},_0x5e06(_0x5d6839,_0x54127c);}(function(_0x18bf6f,_0x49c38b){const _0x2f29a4=_0x5e06,_0x5cff55=_0x18bf6f();while(!![]){try{const _0x2768b2=-parseInt(_0x2f29a4(0x328))/0x1+parseInt(_0x2f29a4(0x265))/0x2*(-parseInt(_0x2f29a4(0x217))/0x3)+-parseInt(_0x2f29a4(0x29a))/0x4*(-parseInt(_0x2f29a4(0x3a5))/0x5)+parseInt(_0x2f29a4(0x1c7))/0x6*(parseInt(_0x2f29a4(0x326))/0x7)+parseInt(_0x2f29a4(0x2b7))/0x8*(-parseInt(_0x2f29a4(0x150))/0x9)+parseInt(_0x2f29a4(0x247))/0xa*(parseInt(_0x2f29a4(0x3b1))/0xb)+-parseInt(_0x2f29a4(0x275))/0xc*(-parseInt(_0x2f29a4(0x39f))/0xd);if(_0x2768b2===_0x49c38b)break;else _0x5cff55['push'](_0x5cff55['shift']());}catch(_0xfed5e6){_0x5cff55['push'](_0x5cff55['shift']());}}}(_0x51b4,0xeb0f3));import _0x2990b5 from'chai';import{Ed25519Signature2020}from'@digitalbazaar/ed25519-signature-2020';import{Ed25519VerificationKey2020}from'@digitalbazaar/ed25519-verification-key-2020';const should=_0x2990b5['should']();function _0x51b4(){const _0x5ee0d7=['LOFow','91WzkLYd','Bavzq','124966nZVJyQ','invocationTarget','agNfK','qQsJO','xMawe','jkEff','urn:uuid:fake','KGqnS','ECZMk','SDeCj','iideA','NPEwu','a\x20valid\x20subset\x20of\x20the\x20undefined\x20parent\x20allowedAction','ivMAo','GbwFo','A\x20delegated\x20capability\x20must\x20not\x20be\x20invoked\x20before\x20the\x20\x22created\x22\x20','UXOsl','BfwZN','SOlwb','DMeKg','JuRCP','wmFCc','xawQr','cQurA','uEVzZ','bGjOD','oufMa','LDSVq','cTkUO','sRqIn','uzZWJ','urn:uuid:1aaec12f-bcf2-40d8-8192-cc4dde9bca96','zLnCw','exampleDoc','target\x20w/query','foo','zYujr','GApQu','SUSpe','cXuQW','AtDaX','tsIBS','should\x20succeed','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20','tdFgg','fetsG','hMRPQ','zSWgb','VJWjJ','zRdfK','split','gGITB','afGlq','XDaWF','urn:zcap:142b0b4a-c664-4288-84e6-be0a59b6efa4','TkMXt','Cannot\x20delegate\x20an\x20expired\x20capability.','Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date','MrdxU','obINJ','COwcx','SsBJl','verify','WYcfi','Qqpsi','ddSOe','EjEPc','KNSnD','OwOJW','WTqnB','SMGhu','iiSjG','YQyZf','eBaZF','eGpKE','delegated','AvaRI','controller','not','yhhIW','matching\x20\x22capabilityAction\x22\x20not\x20found','purposeResult','MZxKp','yiVLS','ZBnlj','HwMsp','HmGWa','VCtGl','ofWMv','XYLfw','should\x20fail\x20to\x20verify\x20w/inspectCapabilityChain\x20','eLpYy','OowkI','YhFTy','lpKEf','Nibzi','qYyuI','sDzVU','mpRST','nHJCZ','\x22read\x22\x20expected\x20action','eLHQu','KkWHy','have','\x22capabilityAction\x22\x20must\x20be\x20a\x20string.','urn:foo','YYVrD','XzrQf','GHJkl','UYrcA','AnCvo','RUQkI','FQPGl','HlvyD','should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202','JMNEu','mWgwa','lNuSQ','must\x20be\x20equivalent\x20to\x20its\x20parent','5044WlAjfz','GhvrY','IkaGa','ggvYh','CapabilityDelegation\x20throws\x20TypeError\x20on\x20invalid\x20date','yYrgR','1596545XUSHYP','BsUNT','vPClv','fMFmr','KhGCi','CAPjI','should\x20fail\x20invoking\x20a\x20capability\x20with\x20`expires`\x20','CckfS','xwaAF','aKXrY','xTTnK','smNyY','2184523CpbTpS','expected\x20\x22capabilityAction\x22\x20does\x20not\x20match','Sign\x20with\x20capabilityInvocation\x20proof\x20purpose','qUhav','5|6|1|0|7|3|4|8|2','YrPmO','Mgfol','bKZlf','urn:zcap:9ff561b8-0b3f-4bbc-af00-03ba785a7fc6','Ojaee','NClxY','fKaOO','target\x20(','https://example.com/edvs/cc8b09fd-76e2-4fae-9bdd-2522b83a2971','tqOrH','The\x20capability\x20\x22','SumDe','Faeem','LRSHa','jctXJ','CIkGd','GIIDo','Ylawk','6|0|8|1|7|2|5|3|4','now','wdsvT','should\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','riXnY','should\x20succeed\x20w/key\x20invoker','\x22capability\x22\x20must\x20be\x20a\x20string\x20or\x20object.','sapUW','IeMzu','wmUXd','SWxrg','CutHe','should\x20fail\x20if\x20expectedRootCapability\x20does\x20not\x20match','YMTPh','DXJuQ','cEigF','JZazB','\x22\x20has\x20been\x20revoked.','sign','read','erhVw','delegation\x20proof\x20\x22created\x22\x20date','JBeVQ','YLasJ','iQdOV','IePss','Rabyb','VuCdC','OeVql','Fnhub','rkmJd','lOgTd','DKEna','cihWb','WvDpT','fXqpq','jcFrk','should\x20verify\x20an\x20invoked\x20root\x20capability','biuWN','gaCJO','urn:zcap:3c034da3-8b5e-4fdc-b75d-8c37d73cd21e','tuTFx','FNjQk','should\x20verify\x20when\x20invoking\x20at\x20a\x20valid\x20sub\x20target\x20','/a-different-specific-document','should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20an\x20','bUzun','nYJgj','uAzEO','2|3|6|1|4|0|5','DJrRD','aopQg','jdjzL','KlXmA','when\x20the\x20expectedRootCapability\x20does\x20not\x20match','should\x20verify\x20invoking\x20a\x20capability\x20with\x20`expires`\x20','otGmo','rfJog','errors','pHimi','UChFd','FOrAD','tWkXt','cnSAc','mYatz','egNAL','qhOYY','expires','urn:zcap:ef98a880-6b36-11ec-940f-10bf48838a41','CWSTn','https://example.com/edvs/3e209556-719c-11ec-9a7b-10bf48838a41','should\x20fail\x20when\x20missing\x20\x22capability\x22','FHlqA','should\x20fail\x20to\x20delegate\x20a\x20capability\x20with\x20bad\x20`expires`\x20field','XdFax','jicxM','QuEsB','pHOmR','QhMow','/a-different-specific-document?foo=bar','yPlAg','wxdRZ','vehHZ','COGTj','jdVlv','bJHRm','ZnDtT','HMzsc','AudjB','LHbkY','EYtRZ','gJEjV','SfqZR','MGstw','iitRg','Chain\x20depth\x20of\x204','parent.','RPRKL','BGNlm','invalid','yaKGE','stHJd','azHYC','https://example.com/edvs/2c2fe4ab-ff54-4a82-b103-f806f50d364e','RBzXf','OlkAQ','and\x20`date`\x20parameter\x20in\x20the\x20future','ZFVZy','kzPFn','bPmpH','should\x20fail\x20invoking\x20a\x20capability\x20with\x20','https://example.com/edvs/0d3bd43c-719c-11ec-acdd-10bf48838a41','kzNTP','w/TTL\x20and\x20delegation\x20date\x20monotonicity\x20checks','NqMPW','oHqgn','qQjtO','should\x20verify\x20chain\x20when\x20child\x20allowedAction\x20is\x20','nDxhZ','RsSnv','RAcPM','KFPdL','APhQE','xllJm','eGmiL','vs\x20array','BlOqh','tyMay','delegated\x20capability\x20must\x20not\x20be\x20less\x20restrictive','nOfLl','WNjrP','bar','mhBgl','wAEvO','Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date.','oBKDh','urn:uuid:','dACGW','should\x20fail\x20when\x20missing\x20\x22parentCapability\x22','capabilityInvocation','NFzkl','wOBpK','PwGuS','contain',')\x20does\x20not\x20match\x20capability\x20','toISOString','safe','Vcfbz','STCDy','allowed\x20action\x20on\x20one\x20capability','should\x20fail\x20when\x20missing\x20\x22invocationTarget\x22','should\x20fail\x20to\x20invoke\x20a\x20root\x20zcap\x20with\x20no\x20controller','pForm','vzVab','urn:zcap:bcbcde5e-d64a-4f46-a76e-daf52f63f702','NvMbv','CFhUv','Invalid\x20signature.','KEGGu','fLgBm','CWyWB','uwxKn','dCvCT','time\x20to\x20live\x20that\x20is\x20too\x20long','JYKDw','qmVbr','and\x20`date`\x20parameter\x20in\x20the\x20past','mQCVF','dIDPX','zcap','LwTzc','nRrta','XNByB','lcomF','EWIVm','eFfHj','bdLLH','should\x20verify\x20invocation','urn:zcap:1c919b19-baab-45ee-b0ef-24309dfb355d','AQxIY','Invocation\x20target\x20(','JTLJq','should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20invalid\x20','zlztw','rygab','qqiBH','exampleDocWithInvocation','BGywN','future','capability\x20that\x20expires\x20on\x20the\x20Unix\x20epoch','oXKGU','vnVti','should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20unexpected\x20','1773FVdLLq','PGamJ','should\x20verify\x20chain\x20w/inspectCapabilityChain','fylZq','2|4|3|6|1|5|0','QqsCY','QkgLZ','OleVm','include','LcLMJ','should\x20fail\x20invoking\x20a\x20delegated\x20capability\x20before\x20its\x20','get','FJmCH','DIDQK','dBoSZ','should\x20verify\x20chain','exist','root','sjcyj','RBcDc','true','nRMdP','HbrTR','wvBIi','vUVdY','ZkjIA','fblpy','coiQV','https://example.com/edvs/1d7ab048-719c-11ec-b07a-10bf48838a41','YNiWF','CKteT','suphQ','urn:zcap:0aee1dd6-646b-11ec-b975-10bf48838a41','XlNDV','LhTiN','VAeQi','capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired','nSZJo','0|3|1|5|4|2|6|7','gSxQV','gngBh','should\x20fail\x20to\x20verify\x20chain\x20w/bad\x20last\x20capability','deep','updateClock();','UEFnu','IGsYH','return\x20await\x20Promise.resolve(42);','SwFTR','dGtII','bVJmg','STJNl','should\x20fail\x20to\x20verify\x20chain\x20w/bad\x20middle\x20capability','GZveI','urn:uuid:055f47a4-61d3-11ec-9144-10bf48838a41','ilbUs','LVGcp','false','consist\x20of\x20strings\x20of\x20capability\x20IDs','emXyn','delegated\x20before\x20its\x20parent','fcvNA','yPlEj','ZCuHg','UmUyX','has\x20been\x20revoked','PEvOU','mjYrA','dsGUL','hpzej','should\x20fail\x20invoking\x20a\x20capability\x20with\x20only\x20an\x20expired\x20','should\x20fail\x20delegating\x20an\x20expired\x20capability','should\x20succeed\x20when\x20passing\x20only\x20\x22parentCapability\x22','zcap\x20in\x20chain','yyUxu','rwdcY','xGuZb','object','message','should\x20fail\x20invoking\x20','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20a\x20','YnyVh','bJHSt','QKYXS','should\x20fail\x20to\x20verify\x20chain\x20','oQIcv','urn:other','XuDTN','ySFFT','uXoRL','revoked','delegated\x20zcap','aSffU','should\x20fail\x20to\x20verify\x20a\x20capability\x20with\x20bad\x20`expires`\x20field','XhrRh','yUyCJ','BrQAX','sHnQF','required\x20\x22capabilityAction\x22\x20is\x20missing','iVwVa','must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.','A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.','should\x20fail\x20to\x20verify\x20w/delegated\x20zcap\x20created\x20before\x20','bHReM','cFIuR','ANqxN','equal','should\x20verify\x20w/array\x20expected\x20target','iLmoy','nDMxS','DvIlO','QJBuH','iLNzz','should\x20fail\x20invoking\x20a\x20capability\x20with\x20missing\x20`expires`\x20in\x20','3|4|7|0|5|2|6|1|8','svjFu','BWiTC','XGOYO','should\x20verify\x20invoking\x20a\x20capability\x20with\x20only\x20expires\x20on\x20','bob','532470ZQIxQS','mYHjz','capability\x20must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20','sofNX','SqgYw','ReqFc','YIdbR','https://zcap.example/target2','PsdfJ','SZWyE','pbryi','wljuv','rdaGe','UtNRc','should\x20verify\x20invoking\x20w/inspectCapabilityChain','should\x20succeed\x20w/verification\x20method\x20as\x20controller','ASFgI','3000-01-01T00:01Z','UHieo','KtQRQ','should\x20fail\x20invoking\x20a\x20capability\x20with\x20expired\x20','should\x20fail\x20to\x20verify\x20chain\x20w/invalid\x20allowedAction\x20string\x20','mYmVx','wLidm','oQbnX','delegator','should\x20verify\x20an\x20invoked\x20root\x20capability\x20w/\x20multiple\x20controllers','UiEcW','DkWJO','should\x20fail\x20to\x20verify\x20chain\x20with\x20misreferenced\x20parent\x20','jJxWd','FNQkG','CDcNo','iECOu','capabilityDelegation','rofEH','YROHF','onukc','date','JTfbj','dNeRx','AaKRX','should','gnAuR','\x22write\x22\x20expected\x20action','utUEB','YCBUt','DGJcH','parent','VxYjD','dJqHE','cjKLf','mYeUC','second\x20delegated\x20capability\x20that\x20expires\x20after\x20first','CmVvk','zEtTE','GBhYY','KNGEu','VusAD','QgJct','vxhoY','VerificationError','HZntE','error','tqCCs','w/query','iXjIv','urn:zcap:b4840a74-6cc0-11ec-819f-10bf48838a41','MALpb','urn:uuid:710910c8-61e4-11ec-8739-10bf48838a41','dDAHM','AfsQA','cNnCV','has\x20been\x20revoked.','FyKKX','MMfvm','gYMlS','QNzdK','oZlqM','phbRP','12eptdgG','verified','XAdRs','setHours','beta','rgmBq','QOFQD','fEJCD','zcap\x20in\x20middle\x20of\x20chain','KYeJn','return\x20new\x20Date();','qPwKU','hpMRY','stringify','should\x20fail\x20to\x20verify\x20chain\x20w/delegated\x20zcap\x20in\x20the\x20','EkVFs','xdOBZ','?foo=bar','Sgxtq','VnNCc','wEAkt','NkKqp','XXjYS','ZPPDN','sWgjE','YGAlL','should\x20fail\x20to\x20verify\x20when\x20allowTargetAttenuation\x20is\x20not\x20','NrGpc','log','a\x20matching\x20`expectedRootCapability`\x20is\x20given','hKtIV','ZETps','FWWqo','xKKgI','icefI','https://example.com/edvs/d9dd2093-0908-47ba-8db7-954ff1cd81ee','rgIYJ','should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','BmZsC','gWLVu','gfiqQ','pjNMw','urn:zcap:6286a906-619b-4f5b-a8ae-af9fb774b070','igDkN','wJKaf','a\x20valid\x20subset\x20of\x20the\x20parent\x20allowedAction\x20array','Zrtlt','getTime','30oxRjYJ','gtTRU','oZaqH','should\x20verify\x20when\x20invoking\x20at\x20an\x20exact-match\x20target\x20','gwIcy','xKzDY','KgEjO','wdBPJ','should\x20verify\x20two\x20invocation\x20proofs\x20on\x20the\x20same\x20doc','The\x20`expires`\x20property\x20in\x20a\x20delegated\x20','Chain\x20depth\x20of\x203','should\x20verify\x20a\x20invoking\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','HRMsO','eQNAt','Jsrbn','Sign\x20with\x20capabilityDelegation\x20proof\x20purpose','sXoFd','Zfmpv','JmgHd','YFSIE','kTaek','ptoNN','QAVJp','QaanK','mPnYJ','GiFjs','WtMju','DaWHL','YrRCf','pMwcx','786442cTMHkI','hESAt','results','MElnS','IqAzG','yfKzp','XVBUQ','TpiCA','mhEtX','KwgBC','iypEF','5|0|1|8|4|6|3|7|2','NlMJb','xQUFH','8|1|7|4|0|2|6|5|3','bzOWx','31956caozKR','FcQoh','array','NotFoundError','URaTs','MbKYV','KNEtL','lAMQI','capabilityAction','GCcBG','second\x20delegated\x20capability','PcCmV','MetUd','target\x20w/path','ujTaD','\x22parentCapability\x22\x20must\x20be\x20a\x20string\x20expressing\x20the\x20ID\x20of\x20a\x20root\x20','restful','ZtZAE','is\x20not\x20a\x20valid\x20date.','AEKzC','not\x20a\x20valid\x20date','AjWTZ','GFEbh','does\x20not\x20match\x20the\x20parent','mVgZh','property','iTiXU','\x22expectedRootCapability\x22\x20must\x20be\x20a\x20string\x20or\x20array.','tPdRR','kqDpQ','nkjlA','vFKBl','should\x20fail\x20to\x20verify\x20root\x20capability\x20with\x20`expires`','CJfJd','verifyResult','Bxbki','date\x20in\x20its\x20delegation\x20proof.','16QHcUMI','BCEOX','WqMOe','CmhSS','LWZOE','RWUnT','fKNgt','gKeAq','mEXIf','abOtw','CxRla','getHours','siCmA','SRRwP','PLmVP','AzKVN','/a-specific-document','MvUOq','pBJJM','should\x20verify\x20chain\x20w/path\x20attenuation','urn:zcap:cbddee5a-09fb-44db-a921-70c36436c253','permissive\x20than\x20the\x20parent\x20capability\x20w/path','wmojz','replace','juaLj','mutJx','bDMVW','\x22expectedRootCapability\x22\x20values\x20must\x20be\x20absolute\x20URI\x20strings.','MPISn','56824jyXAdr','invalid\x20date','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20an\x20','lFDUC','w/inspectCapabilityChain','vqzTk','SJcQg','alpha','aTPFj','Expiration\x20date','zcap\x20at\x20end\x20of\x20chain','rQoJl','https://example.com/edvs/83d7e997-d742-4b1a-9033-968f222b9144','rkKHa','w/inspectCapabilityChain\x20and\x20a\x20revoked\x20capability','SCElQ','QiUlR','PWZmn','yjjhV','Gxzgs','MalKW','sNoXl','diana','console.log(\x22timer\x22);','cQkWF','qefgu','sqIzV','rUcNI','UodJk','AlryT','TypeError','rNpGu','AyLwb','kYFEA','Zobwe','HkToA','PwVVd','CapabilityInvocation\x20throws\x20TypeError\x20on\x20invalid\x20date','var\x20x\x20=\x2042;\x20return\x20x;','vmGnZ','RISkw','LdPkB','bGAiV','should\x20fail\x20to\x20verify\x20chain\x20with\x20attenuation\x20that\x20is\x20more\x20','eDFEo','yoTpi','ghBPg','qWSBF','VmuxN','MiFwY','SbUba','JOiED','qalXQ','should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20as\x20delegated','Jsgxp','should\x20verify\x20chain\x20w/query\x20attenuation','ylbdj','QUmUj','wiDvj','dEvpN','XMSZG','PbGXg','should\x20fail\x20to\x20verify\x20chain\x20with\x20non-embedded\x20last\x20','entries','etspX','uTQNX','Rfbgm','should\x20fail\x20to\x20verify\x20w/delegated\x20zcap\x20with\x20no\x20expiration\x20','should\x20fail\x20when\x20missing\x20\x22capabilityAction\x22','cIHCM','DjUPn','The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','CQfQj','w/invalid\x20allowedAction\x20strings','match','vzPIm','xWyDZ','Eqevu','eVNPt','yDjmT','tuebl','tUSpX','QNFSS','https://example.com/edvs/','length','should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202','UPAci','https://example.com/edvs/357570f6-8df2-4e78-97dc-42260d64e78e','sGkFF','sNIIQ','PbwTR','cPidF','name','xhqEK','proof','parse','DFNqi','EiwrN','write','NekPx','w/delegated\x20zcap\x20with\x20a\x20TTL\x20that\x20is\x20too\x20long','eceZc','hVZNG','WhDzH','zOyEU','Error','hWGov','tpbpZ','hqcce','should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20a\x20'];_0x51b4=function(){return _0x5ee0d7;};return _0x51b4();}export default async function (options){const _0x2edf6e=_0x5e06,yiiFMi={'CDcNo':function(callee,param1,param2){return callee(param1,param2);},'cihWb':_0x2edf6e(0x1ba),'gGITB':_0x2edf6e(0x353),'dDAHM':function(callee,param1){return callee(param1);},'KtQRQ':_0x2edf6e(0x390),'vbBRj':'TkWaV','YLasJ':'should\x20succeed\x20w/controller\x20invoker','kTaek':_0x2edf6e(0x125),'iiSjG':'ZgtPI','ccold':_0x2edf6e(0x352),'yaKGE':function(callee,param1,param2){return callee(param1,param2);},'sNoXl':function(callee,param1){return callee(param1);},'GBJYZ':function(callee,param1){return callee(param1);},'Nibzi':function(callee,param1){return callee(param1);},'SqgYw':function(callee,param1){return callee(param1);},'gSxQV':function(callee){return callee();},'QkgLZ':function(callee,param1){return callee(param1);},'nYJgj':function(callee,param1){return callee(param1);},'bVJmg':_0x2edf6e(0xf2),'VusAD':function(callee,param1){return callee(param1);},'WtMju':_0x2edf6e(0x204),'XVBUQ':_0x2edf6e(0x278),'yhhIW':function(callee,param1){return callee(param1);},'oufMa':function(callee,param1){return callee(param1);},'HkToA':function(x,y){return x+y;},'qQsJO':_0x2edf6e(0x33c),'Bavzq':function(callee){return callee();},'IqAzG':function(callee,param1){return callee(param1);},'HdzZK':_0x2edf6e(0xd7),'rNpGu':_0x2edf6e(0x15f),'ZOgCm':_0x2edf6e(0x21f),'rwdcY':_0x2edf6e(0x1e4),'zDuRU':_0x2edf6e(0x2c1),'EyOEa':_0x2edf6e(0x300),'CmVvk':_0x2edf6e(0x10c),'BmZsC':function(callee,param1,param2){return callee(param1,param2);},'stHJd':function(x,y){return x+y;},'bPmpH':_0x2edf6e(0x334),'Faeem':'w/revoked\x20capability','YhFTy':_0x2edf6e(0x225),'VtMIX':'should\x20verify\x20invoking\x20','HpEzy':function(x,y){return x+y;},'fNkjx':function(callee,param1){return callee(param1);},'vioqW':_0x2edf6e(0x2ce),'nkjlA':_0x2edf6e(0x17e),'RuYsx':_0x2edf6e(0x343),'KNSnD':_0x2edf6e(0x1e2),'ANqxN':function(callee,param1){return callee(param1);},'STCDy':function(callee,param1){return callee(param1);},'VCtGl':'it\x20must\x20consist\x20of\x20strings','wmUXd':_0x2edf6e(0x105),'mhBgl':_0x2edf6e(0x34b),'XNByB':function(x,y){return x*y;},'zJNOR':function(x,y){return x+y;},'RPFLW':_0x2edf6e(0x115),'RRStK':function(callee,param1){return callee(param1);},'oQmCF':_0x2edf6e(0xa5),'JLGRy':_0x2edf6e(0x3a3),'riXnY':_0x2edf6e(0x196),'cnSAc':function(callee,param1,param2){return callee(param1,param2);},'BGNlm':_0x2edf6e(0x14c),'eLHQu':_0x2edf6e(0x1c5),'XGOYO':'should\x20fail\x20to\x20verify\x20w/embedded\x20middle\x20zcap','tPdRR':_0x2edf6e(0x23a),'YrPmO':'should\x20fail\x20to\x20verify\x20chain\x20with\x20attenuation\x20that\x20is\x20more\x20','YrRCf':function(callee,param1,param2){return callee(param1,param2);},'HbrTR':function(callee,param1,param2){return callee(param1,param2);},'mYmVx':'should\x20fail\x20to\x20verify\x20an\x20increasingly\x20permissive\x20chain\x20','HmGWa':_0x2edf6e(0x126),'GiFjs':function(x,y){return x+y;},'VxYjD':_0x2edf6e(0x252),'HwMsp':_0x2edf6e(0x3cb),'cTkUO':_0x2edf6e(0x23c),'Ojaee':'`expectedRootCapability`\x20is\x20not\x20a\x20URI','KNGEu':_0x2edf6e(0x1e1),'wmFCc':_0x2edf6e(0x3d4),'ofWMv':_0x2edf6e(0x39a),'JTfbj':_0x2edf6e(0x1f3),'zuutq':function(callee,param1,param2){return callee(param1,param2);},'XAdRs':_0x2edf6e(0x251),'qgfgR':_0x2edf6e(0x3b3),'COGTj':_0x2edf6e(0x256),'gfiqQ':function(callee,param1,param2){return callee(param1,param2);},'usstz':'controller','gaCJO':_0x2edf6e(0x19c),'QJBuH':function(x,y){return x===y;},'cSpic':_0x2edf6e(0x218),'MVLHx':_0x2edf6e(0x1e0),'umDZl':'8|2|1|0|4|6|3|5|7','DMeKg':'capabilityInvocation','JmgHd':function(x,y){return x!==y;},'MALpb':_0x2edf6e(0x1e9),'VnNCc':function(callee){return callee();},'SsBJl':function(x,y){return x===y;},'eLpYy':function(callee,param1,param2){return callee(param1,param2);}},{expect,helpers,jsigs,mock,zcap}=options,{CapabilityInvocation,CapabilityDelegation,createRootCapability,constants:{ZCAP_CONTEXT_URL}}=zcap,{controllers,privateDidDocs,capabilities,addToLoader,testLoader}=mock,{Controller,uuid}=helpers;function clone(obj){const _0x35eb5e=_0x2edf6e;return setTimeout(function(){const _0x58bc97=_0x5e06;console[_0x58bc97(0x233)](_0x58bc97(0x121));},0x64),JSON[_0x35eb5e(0x316)](JSON[_0x35eb5e(0x224)](obj));}const alice=new Controller(controllers['alice']),bob=new Controller(controllers[_0x2edf6e(0x1c6)]),carol=new Controller(controllers['carol']),diana=new Controller(controllers[_0x2edf6e(0x2cd)]),alpha=new Controller(privateDidDocs[_0x2edf6e(0x2be)]),CONSTANT_DATE='2018-02-13T21:26:08Z',EXPIRES_3000_DATE=_0x2edf6e(0x1d8);describe(_0x2edf6e(0x138),()=>{const _0x21be80=_0x2edf6e,RYHtds={'agNfK':function(callee,param1){return callee(param1);},'EWIVm':function(callee,param1){const _0x189994=_0x5e06;return yiiFMi[_0x189994(0x20d)](callee,param1);},'SJcQg':_0x21be80(0xa2),'UYrcA':function(callee,param1){return callee(param1);},'SUSpe':_0x21be80(0x391),'GCcBG':_0x21be80(0x1c1),'oQIcv':_0x21be80(0x277),'sgncl':_0x21be80(0x273),'KFPdL':function(callee,param1,param2){return callee(param1,param2);},'Sgxtq':function(x,y){return x!==y;},'MPISn':yiiFMi[_0x21be80(0x1da)],'abOtw':function(x,y){return x===y;},'oHqgn':yiiFMi['vbBRj'],'emXyn':_0x21be80(0x306),'XDaWF':_0x21be80(0x3cd),'fFhQE':yiiFMi[_0x21be80(0xa6)],'fEJCD':function(callee,param1,param2){return callee(param1,param2);},'Zobuh':yiiFMi[_0x21be80(0x25b)],'uICkI':function(callee,param1){const _0x128aca=_0x21be80;return yiiFMi[_0x128aca(0x20d)](callee,param1);},'AtDaX':function(x,y){return x+y;},'SumDe':'capability\x20or\x20an\x20object\x20expressing\x20the\x20full\x20parent\x20capability.','BGywN':'capabilityInvocation','NqMPW':yiiFMi[_0x21be80(0x36f)],'Ylawk':_0x21be80(0x1d6),'LOFow':yiiFMi['ccold'],'GmLaa':function(callee,param1,param2){const _0x5f12cc=_0x21be80;return yiiFMi[_0x5f12cc(0xf3)](callee,param1,param2);},'eVNPt':_0x21be80(0x197),'QgJct':function(callee,param1){return callee(param1);},'tuebl':function(callee,param1){const _0xcbd407=_0x21be80;return yiiFMi[_0xcbd407(0x2cc)](callee,param1);},'PwVVd':function(callee,param1){return yiiFMi['GBJYZ'](callee,param1);},'MetUd':_0x21be80(0x32e),'zRdfK':'does\x20not\x20match\x20expected\x20root\x20capability','IkaGa':function(callee,param1){return callee(param1);},'oZaqH':function(callee,param1){return yiiFMi['Nibzi'](callee,param1);},'QNzdK':function(callee,param1){const _0x7c04d=_0x21be80;return yiiFMi[_0x7c04d(0x1cb)](callee,param1);},'cNnCV':function(callee){return callee();},'iTiXU':function(callee,param1){return callee(param1);},'LAUBZ':function(callee,param1){return yiiFMi['sNoXl'](callee,param1);},'YROHF':function(callee){const _0x5a7ea0=_0x21be80;return yiiFMi[_0x5a7ea0(0x177)](callee);},'eceZc':function(callee){return callee();},'qhOYY':function(callee,param1){const _0x2ce8fd=_0x21be80;return yiiFMi[_0x2ce8fd(0x156)](callee,param1);},'ylbdj':_0x21be80(0x1ce),'YCBUt':function(callee){return callee();},'cQkWF':function(callee,param1){return callee(param1);},'HZntE':function(callee,param1){const _0x7bb5a9=_0x21be80;return yiiFMi[_0x7bb5a9(0xbe)](callee,param1);},'fKaOO':yiiFMi[_0x21be80(0x181)],'ddSOe':'write','YFSIE':function(callee,param1){const _0x5afed7=_0x21be80;return yiiFMi[_0x5afed7(0x201)](callee,param1);},'xMawe':yiiFMi[_0x21be80(0x261)],'iitRg':yiiFMi[_0x21be80(0x26b)],'krsNN':function(callee,param1){const _0x7268fc=_0x21be80;return yiiFMi[_0x7268fc(0x377)](callee,param1);},'EjEPc':function(callee,param1){const _0x3af2b9=_0x21be80;return yiiFMi[_0x3af2b9(0x342)](callee,param1);},'DaWHL':function(x,y){const _0x2da42b=_0x21be80;return yiiFMi[_0x2da42b(0x2da)](x,y);},'LCnCr':yiiFMi[_0x21be80(0x32b)],'Yybtt':'Error','lFDUC':_0x21be80(0x2fe),'aopQg':function(callee){const _0x406d9a=_0x21be80;return yiiFMi[_0x406d9a(0x327)](callee);},'yfKzp':function(callee,param1){const _0x3a0b77=_0x21be80;return yiiFMi[_0x3a0b77(0x269)](callee,param1);},'UPAci':_0x21be80(0x1a9),'IGsYH':function(x,y){return x*y;},'NClxY':yiiFMi['HdzZK'],'coiQV':yiiFMi[_0x21be80(0x2d6)],'tpbpZ':function(x,y){const _0x7fa868=_0x21be80;return yiiFMi[_0x7fa868(0x2da)](x,y);},'jicxM':_0x21be80(0x2f5),'smNyY':yiiFMi['ZOgCm'],'HlvyD':yiiFMi[_0x21be80(0x19a)],'wAEvO':yiiFMi['zDuRU'],'ReqFc':function(x,y){return yiiFMi['HkToA'](x,y);},'wJKaf':yiiFMi['EyOEa'],'gdGMP':function(callee,param1,param2){return callee(param1,param2);},'aZEdm':yiiFMi[_0x21be80(0x1fd)],'wdsvT':function(callee,param1,param2){const _0x154549=_0x21be80;return yiiFMi[_0x154549(0x23d)](callee,param1,param2);},'VAeQi':function(callee,param1,param2){return callee(param1,param2);},'DjUPn':function(x,y){const _0x4ba91d=_0x21be80;return yiiFMi[_0x4ba91d(0xf4)](x,y);},'dEvpN':'should\x20verify\x20chain\x20when\x20child\x20allowedAction\x20is\x20','sXoFd':yiiFMi[_0x21be80(0xfc)],'gJEjV':function(callee,param1,param2){return callee(param1,param2);},'NvMbv':_0x21be80(0x183),'Bxbki':function(callee,param1,param2){return callee(param1,param2);},'hpMRY':yiiFMi[_0x21be80(0x3c2)],'AudjB':_0x21be80(0x1ed),'bGAiV':function(callee,param1,param2){const _0x9c5b5b=_0x21be80;return yiiFMi[_0x9c5b5b(0xf3)](callee,param1,param2);},'YIdbR':yiiFMi[_0x21be80(0x385)],'XhrRh':function(callee,param1,param2){return callee(param1,param2);},'dIDPX':_0x21be80(0x1a3),'MGstw':yiiFMi['VtMIX'],'XYLfw':function(callee,param1,param2){return callee(param1,param2);},'PbGXg':function(x,y){return yiiFMi['HpEzy'](x,y);},'hqcce':function(callee,param1){return yiiFMi['fNkjx'](callee,param1);},'iEzrO':function(callee,param1){return callee(param1);},'azHYC':function(callee,param1){return callee(param1);},'QAVJp':yiiFMi['vioqW'],'CnIoX':yiiFMi[_0x21be80(0x293)],'FyKKX':function(callee,param1){return callee(param1);},'AnCvo':yiiFMi['RuYsx'],'eBaZF':_0x21be80(0x374),'DFNqi':function(callee,param1){return callee(param1);},'bzOWx':yiiFMi[_0x21be80(0x36b)],'PECYu':function(callee,param1){const _0x4d6daf=_0x21be80;return yiiFMi[_0x4d6daf(0x1b8)](callee,param1);},'VeiZJ':function(callee,param1){const _0x297146=_0x21be80;return yiiFMi[_0x297146(0x123)](callee,param1);},'wLidm':_0x21be80(0x189),'edrfP':yiiFMi[_0x21be80(0x37f)],'jDzmE':yiiFMi[_0x21be80(0x3d1)],'kRNRA':yiiFMi[_0x21be80(0x113)],'nHJCZ':_0x21be80(0x112),'cPidF':function(x,y){return x+y;},'lOgTd':function(callee,param1){return callee(param1);},'URaTs':_0x21be80(0x18b),'siCmA':function(x,y){const _0x38badb=_0x21be80;return yiiFMi[_0x38badb(0x13b)](x,y);},'oZlqM':function(x,y){return yiiFMi['zJNOR'](x,y);},'DRUHq':function(x,y){return x/y;},'kzNTP':function(callee){return callee();},'brRia':_0x21be80(0x29c),'sHnQF':function(callee,param1){return callee(param1);},'mjYrA':function(callee){return callee();},'GxTHD':function(callee,param1){return callee(param1);},'wTKJN':function(callee,param1){return callee(param1);},'CckfS':yiiFMi['RPFLW'],'hpzej':_0x21be80(0x299),'DIDQK':_0x21be80(0x241),'utgMU':function(callee,param1){return callee(param1);},'KGqnS':function(callee,param1){const _0x7ecf63=_0x21be80;return yiiFMi[_0x7ecf63(0x269)](callee,param1);},'uTQNX':function(x,y){return x===y;},'bJHSt':function(callee,param1){return yiiFMi['RRStK'](callee,param1);},'yiVLS':function(callee,param1){return callee(param1);},'qmVbr':function(callee,param1){return callee(param1);},'iLmoy':yiiFMi['oQmCF'],'TkMXt':_0x21be80(0x2dc),'GIIDo':yiiFMi['JLGRy'],'eGmiL':function(callee,param1,param2){const _0xfff4b3=_0x21be80;return yiiFMi[_0xfff4b3(0x23d)](callee,param1,param2);},'DXJuQ':yiiFMi[_0x21be80(0x3cc)],'hESAt':function(callee,param1,param2){const _0x2bc4fd=_0x21be80;return yiiFMi[_0x2bc4fd(0xce)](callee,param1,param2);},'mPnYJ':function(callee,param1,param2){const _0xbe133d=_0x21be80;return yiiFMi[_0xbe133d(0x23d)](callee,param1,param2);},'FQnAo':yiiFMi[_0x21be80(0xf1)],'eoGSv':yiiFMi[_0x21be80(0x38d)],'MElnS':function(callee,param1){const _0x2552f3=_0x21be80;return yiiFMi[_0x2552f3(0x156)](callee,param1);},'bKZlf':function(callee,param1){return callee(param1);},'uXoRL':function(callee,param1){const _0x46bf2b=_0x21be80;return yiiFMi[_0x46bf2b(0x387)](callee,param1);},'ECZMk':yiiFMi[_0x21be80(0x1c4)],'ENpSN':function(callee){return callee();},'bHExq':function(callee,param1){const _0x16809e=_0x21be80;return yiiFMi[_0x16809e(0x2cc)](callee,param1);},'RUQkI':function(callee,param1){return callee(param1);},'rygab':function(callee,param1){const _0x12a7b3=_0x21be80;return yiiFMi[_0x12a7b3(0x1cb)](callee,param1);},'fIesM':yiiFMi[_0x21be80(0x291)],'NPEwu':function(callee,param1){return callee(param1);},'rofEH':function(callee,param1){const _0x9935a1=_0x21be80;return yiiFMi[_0x9935a1(0x377)](callee,param1);},'cXuQW':_0x21be80(0xc1),'UbqXg':function(callee,param1){return callee(param1);},'tyMay':'is\x20not\x20a\x20valid\x20date.','eAiss':_0x21be80(0x2ee),'OlkAQ':'should\x20verify\x20chain\x20w/path\x20and\x20query\x20attenuation','UtNRc':yiiFMi[_0x21be80(0x3b6)],'utUEB':function(callee,param1,param2){return callee(param1,param2);},'Jsgxp':function(callee,param1,param2){const _0x1d62c9=_0x21be80;return yiiFMi[_0x1d62c9(0x263)](callee,param1,param2);},'nRrta':'should\x20verify\x20when\x20invoking\x20at\x20a\x20valid\x20sub\x20target\x20','wdBPJ':function(callee,param1,param2){const _0x54f0ab=_0x21be80;return yiiFMi[_0x54f0ab(0x166)](callee,param1,param2);},'xEphu':'should\x20verify\x20chain\x20w/inspectCapabilityChain','FOrAD':yiiFMi[_0x21be80(0x1dd)],'AzKVN':_0x21be80(0xb4),'KNEtL':function(callee,param1,param2){return callee(param1,param2);},'SRRwP':yiiFMi[_0x21be80(0x37e)],'kzPFn':function(x,y){const _0x5eaf60=_0x21be80;return yiiFMi[_0x5eaf60(0x260)](x,y);},'cjKLf':yiiFMi[_0x21be80(0x1f8)],'sNIIQ':yiiFMi[_0x21be80(0x37d)],'oQbnX':function(callee,param1,param2){const _0xfe5661=_0x21be80;return yiiFMi[_0xfe5661(0xf3)](callee,param1,param2);},'iLNzz':yiiFMi[_0x21be80(0x344)],'LdPkB':yiiFMi[_0x21be80(0x3ba)],'vnVti':'no\x20`expectedRootCapability`\x20is\x20given','idPWO':yiiFMi[_0x21be80(0x200)],'FflSv':'should\x20verify\x20a\x20root\x20zcap\x20w/\x20multiple\x20controllers','hYYEz':yiiFMi[_0x21be80(0x33d)],'MogLz':yiiFMi[_0x21be80(0x380)],'eXDTG':_0x21be80(0x38c),'lqLgD':function(callee,param1,param2){return yiiFMi['HbrTR'](callee,param1,param2);},'nLGXb':yiiFMi[_0x21be80(0x1ee)],'bdLLH':function(x,y){const _0x27a459=_0x21be80;return yiiFMi[_0x27a459(0x260)](x,y);},'qMfqw':_0x21be80(0xbc),'iQdOV':function(callee,param1,param2){return callee(param1,param2);},'YwQwr':'should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20','fKNgt':function(callee,param1,param2){return yiiFMi['zuutq'](callee,param1,param2);},'xllJm':function(callee,param1,param2){const _0x372a85=_0x21be80;return yiiFMi[_0x372a85(0xf3)](callee,param1,param2);},'FSgpv':_0x21be80(0x2b9),'lpKEf':yiiFMi[_0x21be80(0x219)],'NqsIr':function(callee,param1,param2){return yiiFMi['yaKGE'](callee,param1,param2);},'VJWjJ':'invocationTarget\x20attenuation'};yiiFMi['CDcNo'](describe,yiiFMi['qgfgR'],()=>{const _0x4c2963=_0x21be80,GSJChc={'QNFSS':RYHtds[_0x4c2963(0x27e)],'pBJJM':RYHtds[_0x4c2963(0x1a4)],'wljuv':function(callee,param1){const _0x587cd1=_0x4c2963;return RYHtds[_0x587cd1(0x32a)](callee,param1);},'LqAht':function(callee,param1){return RYHtds['UYrcA'](callee,param1);},'AfsQA':RYHtds['sgncl'],'Tfoxo':function(callee,param1,param2){const _0x3aa4a5=_0x4c2963;return RYHtds[_0x3aa4a5(0x108)](callee,param1,param2);},'KYeJn':function(x,y){return RYHtds['Sgxtq'](x,y);},'ZnDtT':_0x4c2963(0x1a6),'YYVrD':function(callee,param1){return RYHtds['UYrcA'](callee,param1);},'RpzRR':_0x4c2963(0x3ce),'xGuZb':RYHtds[_0x4c2963(0x2b6)]};if(RYHtds['abOtw'](RYHtds[_0x4c2963(0x102)],RYHtds[_0x4c2963(0x18a)])){const ZsksxX=GSJChc[_0x4c2963(0x309)][_0x4c2963(0x35a)]('|');let qDOWVG=0x0;while(!![]){switch(ZsksxX[qDOWVG++]){case'0':_0x596ac6[_0x4c2963(0x1f1)]['be']['an'](GSJChc[_0x4c2963(0x2ac)]);continue;case'1':new _0x24bc69(_0x4c2963(0x2dd))();continue;case'2':GSJChc['wljuv'](_0x4cd9cf,{'capabilityChain':_0x195298});continue;case'3':_0x1166c4++;continue;case'4':_0x15555e[_0x4c2963(0x1f1)]['be']['an']('array');continue;case'5':_0x57e13c[_0x4c2963(0x1f1)][_0x4c2963(0x38f)]['length'](0x3);continue;case'6':GSJChc['LqAht'](_0x55517e,{'capabilityChainMeta':_0x36e878});continue;case'7':_0x17f80d[_0x4c2963(0x1f1)][_0x4c2963(0x38f)][_0x4c2963(0x30b)](0x3);continue;case'8':return{'valid':!![]};}break;}}else RYHtds[_0x4c2963(0x108)](it,RYHtds[_0x4c2963(0x35d)],async()=>{const _0x42862b=_0x4c2963,doc=clone(mock['exampleDoc']),signed=await GSJChc[_0x42862b(0x1d2)](_invoke,{'doc':doc,'invoker':alice,'date':CONSTANT_DATE,'capability':capabilities[_0x42862b(0x161)][_0x42862b(0x2be)],'capabilityAction':_0x42862b(0xa2)});expect(signed)['to'][_0x42862b(0x17a)][_0x42862b(0x1b9)](mock['exampleDocWithInvocation'][_0x42862b(0x2be)]);}),it(RYHtds['fFhQE'],async()=>{const _0x24695e=_0x4c2963,doc=RYHtds[_0x24695e(0x32a)](clone,mock[_0x24695e(0x349)]),signed=await RYHtds[_0x24695e(0x13d)](_invoke,{'doc':doc,'invoker':alice,'date':CONSTANT_DATE,'capability':capabilities[_0x24695e(0x161)][_0x24695e(0x21b)],'capabilityAction':RYHtds[_0x24695e(0x2bd)]});expect(signed)['to'][_0x24695e(0x17a)]['equal'](mock[_0x24695e(0x149)]['beta']);}),it(_0x4c2963(0xd6),async()=>{const _0x31f19b=_0x4c2963;if(GSJChc[_0x31f19b(0x220)](_0x31f19b(0x1a6),GSJChc[_0x31f19b(0xe5)])){const dVjcKJ=GSJChc[_0x31f19b(0x20e)][_0x31f19b(0x35a)]('|');let VrmVnb=0x0;while(!![]){switch(dVjcKJ[VrmVnb++]){case'0':_0x56b835[_0x31f19b(0x1f1)][_0x31f19b(0x38f)][_0x31f19b(0x30b)](0x4);continue;case'1':_0x2d9c36[_0x31f19b(0x1f1)]['be']['an']('array');continue;case'2':_0x5e9d63({'capabilityChain':_0x467df8});continue;case'3':return{'valid':!![]};case'4':_0x182793[_0x31f19b(0x1f1)]['be']['an'](GSJChc[_0x31f19b(0x2ac)]);continue;case'5':GSJChc['Tfoxo'](_0x1f2527,function(){const _0x1dbda8=_0x31f19b;_0xa6159[_0x1dbda8(0x233)]('safe');},0x64);continue;case'6':_0x4f3413({'capabilityChainMeta':_0x27662e});continue;case'7':_0x45221a[_0x31f19b(0x1f1)][_0x31f19b(0x38f)]['length'](0x4);continue;case'8':_0x12f87d++;continue;}break;}}else{let err;try{const doc=GSJChc[_0x31f19b(0x392)](clone,mock[_0x31f19b(0x349)]);await _invoke({'doc':doc,'invoker':alice,'purposeOptions':{}});}catch(e){err=e;}expect(err)['to'][_0x31f19b(0x160)],GSJChc[_0x31f19b(0x392)](expect,err['message'])['to'][_0x31f19b(0x1b9)](GSJChc['RpzRR']);}}),it(_0x4c2963(0x2fb),async()=>{const _0x3d7c75=_0x4c2963;let err;try{const doc=clone(mock['exampleDoc']);await _invoke({'doc':doc,'invoker':alice,'purposeOptions':{'capability':'urn:foo'}});}catch(e){err=e;}expect(err)['to']['exist'],expect(err['message'])['to']['equal'](GSJChc[_0x3d7c75(0x19b)]);}),RYHtds[_0x4c2963(0x21e)](it,RYHtds['Zobuh'],async()=>{const _0x7d0733=_0x4c2963;let err;try{const doc=RYHtds[_0x7d0733(0x395)](clone,mock['exampleDoc']);await _invoke({'doc':doc,'invoker':alice,'purposeOptions':{'capability':RYHtds[_0x7d0733(0x34e)],'capabilityAction':RYHtds['SJcQg']}});}catch(e){err=e;}expect(err)['to'][_0x7d0733(0x160)],RYHtds['UYrcA'](expect,err[_0x7d0733(0x19d)])['to'][_0x7d0733(0x1b9)]('\x22invocationTarget\x22\x20must\x20be\x20a\x20string\x20that\x20expresses\x20an\x20absolute\x20URI.');});}),yiiFMi[_0x21be80(0x1e7)](describe,yiiFMi[_0x21be80(0xe2)],()=>{const _0x373603=_0x21be80,cijpeo={'vgZxI':RYHtds['BGywN'],'QiUlR':_0x373603(0x375),'lnNri':RYHtds[_0x373603(0x101)],'gYMlS':function(callee,param1){const _0x170a59=_0x373603;return RYHtds[_0x170a59(0x32a)](callee,param1);}};it(RYHtds[_0x373603(0x3c7)],async()=>{const _0x5e6912=_0x373603,newCapability={'@context':ZCAP_CONTEXT_URL,'id':_0x5e6912(0x185),'controller':bob[_0x5e6912(0x15b)](cijpeo['vgZxI'],0x0)['id'],'parentCapability':capabilities[_0x5e6912(0x161)]['alpha']['id'],'invocationTarget':capabilities[_0x5e6912(0x161)]['alpha'][_0x5e6912(0x329)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'parentCapability':capabilities[_0x5e6912(0x161)]['alpha'],'delegator':alice,'date':CONSTANT_DATE});expect(delegatedCapability)['to'][_0x5e6912(0x17a)][_0x5e6912(0x1b9)](capabilities['delegated']['alpha']);}),it(RYHtds[_0x373603(0x325)],async()=>{const _0x3bc11a=_0x373603,newCapability={'@context':ZCAP_CONTEXT_URL,'id':'urn:uuid:710910c8-61e4-11ec-8739-10bf48838a41','controller':bob['id'](),'parentCapability':capabilities['root']['beta']['id'],'invocationTarget':capabilities[_0x3bc11a(0x161)]['beta'][_0x3bc11a(0x329)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'parentCapability':capabilities[_0x3bc11a(0x161)][_0x3bc11a(0x21b)],'delegator':alice,'date':CONSTANT_DATE});expect(delegatedCapability)['to']['deep'][_0x3bc11a(0x1b9)](capabilities[_0x3bc11a(0x373)][_0x3bc11a(0x21b)]);}),RYHtds['KFPdL'](it,_0x373603(0x119),async()=>{const _0x4838d9=_0x373603;let err;try{const doc=RYHtds['uICkI'](clone,mock['exampleDoc']);await _delegate({'newCapability':doc,'delegator':alice,'purposeOptions':{}});}catch(e){err=e;}expect(err)['to'][_0x4838d9(0x160)],expect(err[_0x4838d9(0x19d)])['to'][_0x4838d9(0x1b9)](RYHtds[_0x4838d9(0x350)](_0x4838d9(0x284),RYHtds[_0x4838d9(0x3c1)]));}),RYHtds['GmLaa'](it,RYHtds[_0x373603(0x305)],async()=>{const _0x408a05=_0x373603,FgZPFe={'mYatz':cijpeo[_0x408a05(0x2c7)],'vmGnZ':_0x408a05(0x329)};if('ZgtPI'===cijpeo['lnNri']){const newCapability={'@context':ZCAP_CONTEXT_URL,'id':_0x408a05(0x20c),'controller':bob['id'](),'parentCapability':capabilities[_0x408a05(0x161)][_0x408a05(0x21b)]['id'],'invocationTarget':capabilities['root'][_0x408a05(0x21b)][_0x408a05(0x329)],'expires':EXPIRES_3000_DATE},delegatedCapability=await cijpeo[_0x408a05(0x213)](_delegate,{'newCapability':newCapability,'delegator':alice,'date':CONSTANT_DATE,'purposeOptions':{'parentCapability':capabilities[_0x408a05(0x161)][_0x408a05(0x21b)]}});expect(delegatedCapability)['to'][_0x408a05(0x17a)][_0x408a05(0x1b9)](capabilities[_0x408a05(0x373)][_0x408a05(0x21b)]);}else for(const _0x1ab8d0 of _0x968299){_0x1ab8d0[_0x408a05(0x1f1)]['be']['an'](_0x408a05(0x19c)),_0x1ab8d0[_0x408a05(0x1f1)][_0x408a05(0x38f)]['property']('id'),_0x1ab8d0['should'][_0x408a05(0x38f)][_0x408a05(0x28e)](FgZPFe[_0x408a05(0xcf)]),_0x1ab8d0['should'][_0x408a05(0x38f)][_0x408a05(0x28e)](FgZPFe[_0x408a05(0x2de)]);}});}),yiiFMi['HbrTR'](context,'Capability\x20controller\x20is\x20itself\x20a\x20verification\x20method',()=>{const _0x273b84=_0x21be80;yiiFMi['CDcNo'](it,_0x273b84(0xb4),async()=>{const _0x1a0b57=_0x273b84,result=await _verifyInvocation({'invocation':mock[_0x1a0b57(0x149)]['alpha'],'rootCapability':capabilities[_0x1a0b57(0x161)][_0x1a0b57(0x2be)],'expectedAction':RYHtds[_0x1a0b57(0x2bd)]});expect(result)['to'][_0x1a0b57(0x160)],RYHtds[_0x1a0b57(0x202)](expect,result[_0x1a0b57(0x218)])['to']['be'][_0x1a0b57(0x164)];}),yiiFMi['CDcNo'](it,yiiFMi[_0x273b84(0xb0)],async()=>{const _0x8548da=_0x273b84,AxSoOM={'gKeAq':function(callee,param1){const _0x374698=_0x5e06;return RYHtds[_0x374698(0x202)](callee,param1);},'CxRla':function(callee,param1){const _0x4cc082=_0x5e06;return RYHtds[_0x4cc082(0x395)](callee,param1);}};if(_0x8548da(0x1f6)===_0x8548da(0x10d))return _0x20b2a1++,_0x26a14c[_0x8548da(0x1f1)]['be']['an'](_0x8548da(0x277)),_0x334963['should']['have'][_0x8548da(0x30b)](0x3),AxSoOM[_0x8548da(0x2a1)](_0x368cfc,{'capabilityChain':_0x3138bb}),AxSoOM[_0x8548da(0x2a4)](_0x2ec1b2,{'capabilityChainMeta':_0x269ae9}),_0x55d094(function(){const _0x35ee46=_0x8548da;_0x2637be[_0x35ee46(0x233)]('safe');},0x64),{'valid':!![]};else{const result=await RYHtds[_0x8548da(0x307)](_verifyInvocation,{'invocation':mock['exampleDocWithInvocation'][_0x8548da(0x2be)],'purposeOptions':{'expectedAction':RYHtds[_0x8548da(0x2bd)],'expectedRootCapability':capabilities[_0x8548da(0x161)][_0x8548da(0x2be)]['id'],'expectedTarget':[capabilities[_0x8548da(0x161)]['alpha'][_0x8548da(0x329)]]}});expect(result)['to'][_0x8548da(0x160)],expect(result['verified'])['to']['be'][_0x8548da(0x164)];}}),it('should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202',async()=>{const _0x41168b=_0x273b84,delegatedCapability=await RYHtds['PwVVd'](_delegate,{'parentCapability':capabilities[_0x41168b(0x161)]['alpha'],'controller':bob[_0x41168b(0x15b)](RYHtds[_0x41168b(0x14a)],0x0)['id'],'delegator':alice}),result=await RYHtds['EWIVm'](_verifyDelegation,{'delegation':delegatedCapability,'expectedRootCapability':capabilities['root']['alpha']['id']});expect(result)['to'][_0x41168b(0x160)],expect(result['verified'])['to']['be'][_0x41168b(0x164)];}),it(yiiFMi[_0x273b84(0x35b)]+_0x273b84(0xc5),async()=>{const _0xefadce=_0x273b84,delegatedCapability=await RYHtds[_0xefadce(0x32a)](_delegate,{'parentCapability':capabilities[_0xefadce(0x161)][_0xefadce(0x2be)],'controller':bob[_0xefadce(0x15b)](_0xefadce(0x11a),0x0)['id'],'delegator':alice}),result=await _verifyDelegation({'delegation':delegatedCapability,'expectedRootCapability':RYHtds[_0xefadce(0x281)]});expect(result)['to'][_0xefadce(0x160)],RYHtds[_0xefadce(0x13d)](expect,result[_0xefadce(0x218)])['to']['be']['false'],result['error'][_0xefadce(0x313)][_0xefadce(0x1f1)][_0xefadce(0x1b9)](_0xefadce(0x204));const [error]=result[_0xefadce(0x206)]['errors'];error['message']['should'][_0xefadce(0x11e)](RYHtds[_0xefadce(0x359)]);}),it(_0x273b84(0x30c),async()=>{const _0x49ba3a=_0x273b84,delegatedCapability=await _delegate({'parentCapability':capabilities[_0x49ba3a(0x161)][_0x49ba3a(0x2be)],'controller':bob[_0x49ba3a(0x15b)](_0x49ba3a(0x11a),0x0)['id'],'delegator':alice}),doc=clone(mock[_0x49ba3a(0x349)]),invocation=await RYHtds[_0x49ba3a(0x3a1)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x49ba3a(0xa2)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x49ba3a(0x161)][_0x49ba3a(0x2be)],'expectedAction':RYHtds['SJcQg']});RYHtds[_0x49ba3a(0x249)](expect,result)['to'][_0x49ba3a(0x160)],RYHtds[_0x49ba3a(0x214)](expect,result[_0x49ba3a(0x218)])['to']['be'][_0x49ba3a(0x164)];});}),yiiFMi[_0x21be80(0x23f)](context,'Capability\x20controller\x20uses\x20verification\x20method',()=>{const _0x429b80=_0x21be80,rbMFWG={'dCvCT':function(callee,param1){return RYHtds['hqcce'](callee,param1);},'mEXIf':_0x429b80(0xa2),'EYtRZ':function(callee){return callee();},'FcQoh':function(callee,param1){return RYHtds['iEzrO'](callee,param1);},'HMzsc':function(callee,param1){const _0xc6ef55=_0x429b80;return RYHtds[_0xc6ef55(0xf5)](callee,param1);},'dsGUL':_0x429b80(0x277),'nOfLl':function(callee,param1){return callee(param1);},'nRMdP':function(callee,param1,param2){return callee(param1,param2);},'jcFrk':RYHtds[_0x429b80(0x25d)],'tdFgg':function(x,y){return x!==y;},'RsSnv':function(callee){return callee();},'SOlwb':function(callee,param1){const _0x1d9102=_0x429b80;return RYHtds[_0x1d9102(0xd1)](callee,param1);},'BCEOX':RYHtds['CnIoX'],'bJHRm':function(callee,param1){return callee(param1);},'RWUnT':function(callee,param1){const _0x1e6ae6=_0x429b80;return RYHtds[_0x1e6ae6(0x211)](callee,param1);},'XzrQf':RYHtds[_0x429b80(0x396)],'xwaAF':_0x429b80(0x2b5),'DvIlO':function(x,y){return x===y;},'RBcDc':function(callee){return callee();},'LWZOE':_0x429b80(0x2c4),'eDFEo':RYHtds[_0x429b80(0x371)],'oXKGU':function(callee,param1){return RYHtds['oZaqH'](callee,param1);},'ggvYh':function(callee,param1){return callee(param1);},'OowkI':function(callee,param1){const _0x34a55d=_0x429b80;return RYHtds[_0x34a55d(0x317)](callee,param1);},'rusbW':'urn:this-should-matter','LhTiN':RYHtds[_0x429b80(0x32c)],'uEVzZ':RYHtds['zRdfK'],'qWSBF':function(callee,param1){return callee(param1);},'dNeRx':function(callee,param1){return callee(param1);},'vqzTk':RYHtds[_0x429b80(0x274)],'ZETps':function(callee,param1){const _0x3011b7=_0x429b80;return RYHtds[_0x3011b7(0x214)](callee,param1);},'IeMzu':function(callee,param1){return RYHtds['PECYu'](callee,param1);},'FJmCH':function(callee,param1){return callee(param1);},'pForm':RYHtds[_0x429b80(0x369)],'CmhSS':function(callee,param1){return RYHtds['VeiZJ'](callee,param1);},'RBzXf':function(callee,param1){return callee(param1);},'KhGCi':_0x429b80(0x278),'LwTzc':_0x429b80(0x2d5),'xKzDY':RYHtds[_0x429b80(0x1de)],'hKtIV':function(callee,param1){return callee(param1);},'NFzkl':RYHtds['edrfP'],'cIHCM':RYHtds['jDzmE'],'uwxKn':function(callee,param1){return callee(param1);},'vxhoY':function(callee,param1){return RYHtds['uICkI'](callee,param1);},'jkEff':function(callee){return callee();},'fLgBm':RYHtds['kRNRA'],'MvUOq':RYHtds[_0x429b80(0x38b)],'BrQAX':function(callee,param1){return callee(param1);},'qYyuI':_0x429b80(0x320),'iECOu':function(x,y){const _0x256437=_0x429b80;return RYHtds[_0x256437(0x312)](x,y);},'PsdfJ':'The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','YMTPh':_0x429b80(0x10f),'zYujr':function(callee,param1){const _0x51215b=_0x429b80;return RYHtds[_0x51215b(0xae)](callee,param1);},'CKteT':function(callee,param1){return callee(param1);},'MalKW':RYHtds[_0x429b80(0x279)],'cFIuR':function(x,y){return x*y;},'FQPGl':function(callee){return callee();},'fylZq':function(callee,param1){return callee(param1);},'obTxB':function(x,y){const _0x550c5e=_0x429b80;return RYHtds[_0x550c5e(0x2a6)](x,y);},'GFEbh':function(x,y){const _0x85dcb7=_0x429b80;return RYHtds[_0x85dcb7(0x215)](x,y);},'XXjYS':function(x,y){return RYHtds['DRUHq'](x,y);},'xDXSV':function(callee){const _0x4acd1f=_0x429b80;return RYHtds[_0x4acd1f(0xff)](callee);},'rUcNI':function(callee,param1){return callee(param1);},'xQUFH':function(callee,param1){const _0x223424=_0x429b80;return RYHtds[_0x223424(0x214)](callee,param1);},'NrGpc':'delegated\x20in\x20the\x20future','ZCuHg':RYHtds['brRia'],'etCxD':function(callee,param1){return callee(param1);},'XlNDV':function(callee,param1){return callee(param1);},'obINJ':function(callee,param1){const _0x32cf84=_0x429b80;return RYHtds[_0x32cf84(0x1b0)](callee,param1);},'gdMyI':function(callee){return callee();},'xhqEK':function(callee,param1){return callee(param1);},'vzPIm':function(callee,param1){return callee(param1);},'aTPFj':function(callee,param1){const _0x436256=_0x429b80;return RYHtds[_0x436256(0xae)](callee,param1);},'iideA':function(callee,param1){return callee(param1);},'vehHZ':function(callee){const _0x3c490f=_0x429b80;return RYHtds[_0x3c490f(0x192)](callee);},'yyUxu':function(callee,param1){return RYHtds['GxTHD'](callee,param1);},'QVuqb':'urn:zcap:e843f3c4-6b2b-11ec-b87f-10bf48838a41','pHimi':function(callee){const _0x39f5f5=_0x429b80;return RYHtds[_0x39f5f5(0x1eb)](callee);},'NekPx':function(callee,param1){return RYHtds['wTKJN'](callee,param1);},'sQztP':RYHtds[_0x429b80(0x3ac)],'sTzOe':_0x429b80(0x141),'Rabyb':function(callee){const _0x3ccb45=_0x429b80;return RYHtds[_0x3ccb45(0x20f)](callee);},'rgmBq':function(callee,param1){return callee(param1);},'mmQsr':_0x429b80(0x20a),'erhVw':function(callee,param1){return callee(param1);},'GbwFo':function(callee,param1){return callee(param1);},'ujiBX':function(callee,param1){return callee(param1);},'wOBpK':RYHtds[_0x429b80(0x194)],'SwFTR':RYHtds[_0x429b80(0x15d)],'jctXJ':function(callee,param1){return RYHtds['utgMU'](callee,param1);},'rdaGe':function(callee,param1){const _0x42e6cf=_0x429b80;return RYHtds[_0x42e6cf(0x32f)](callee,param1);},'jHSzp':'urn:zcap:2c41869c-95bb-4e23-9bcd-2fbb320bb440','UmUyX':function(x,y){return x-y;},'qPwKU':function(callee,param1){return callee(param1);},'yPlEj':'A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.','nmYOs':_0x429b80(0x391),'AyLwb':_0x429b80(0x2b8),'HuSIq':function(x,y){return x-y;},'kqDpQ':_0x429b80(0x129),'GhvrY':function(callee,param1){return callee(param1);},'Qqpsi':function(x,y){const _0x2c9312=_0x429b80;return RYHtds[_0x2c9312(0x2f8)](x,y);},'eQNAt':function(callee,param1){const _0x8fedde=_0x429b80;return RYHtds[_0x8fedde(0x1a1)](callee,param1);},'PbwTR':function(callee,param1){return callee(param1);},'CreNS':function(callee,param1){const _0x155596=_0x429b80;return RYHtds[_0x155596(0x37b)](callee,param1);},'pHOmR':'urn:zcap:1e7dfae9-85a3-40d7-97ea-20105f0b9d99','XzZqs':function(callee,param1){const _0x4251e8=_0x429b80;return RYHtds[_0x4251e8(0x323)](callee,param1);},'PEvOU':function(callee,param1){const _0x551e94=_0x429b80;return RYHtds[_0x551e94(0x134)](callee,param1);},'NlMJb':function(x,y){const _0x4c2ac6=_0x429b80;return RYHtds[_0x4c2ac6(0x229)](x,y);},'LnZbJ':RYHtds[_0x429b80(0x1bb)],'ZBnlj':_0x429b80(0x2e8),'igDkN':function(callee,param1,param2){return callee(param1,param2);},'MMfvm':RYHtds[_0x429b80(0x35f)],'Zrtlt':RYHtds[_0x429b80(0x3c6)],'PKdus':_0x429b80(0x295),'sRqIn':function(callee,param1,param2){return RYHtds['VAeQi'](callee,param1,param2);},'BfwZN':function(callee,param1,param2){const _0x2ccefd=_0x429b80;return RYHtds[_0x2ccefd(0x298)](callee,param1,param2);},'ASFgI':_0x429b80(0xd8),'jfUkx':_0x429b80(0x1ac),'zSWgb':function(callee,param1,param2){const _0x2f8650=_0x429b80;return RYHtds[_0x2f8650(0x10b)](callee,param1,param2);},'jZptC':function(x,y){return x+y;},'xTTnK':_0x429b80(0x135),'KlXmA':function(x,y){return RYHtds['tpbpZ'](x,y);},'Gxzgs':RYHtds[_0x429b80(0x3d6)],'gngBh':function(callee,param1,param2){const _0x2b1e26=_0x429b80;return RYHtds[_0x2b1e26(0x266)](callee,param1,param2);},'ilbUs':function(callee,param1,param2){const _0xbbeff5=_0x429b80;return RYHtds[_0xbbeff5(0x25f)](callee,param1,param2);},'MbKYV':_0x429b80(0x27f),'juaLj':'should\x20fail\x20invoking\x20a\x20capability\x20with\x20second\x20delegated\x20','ZEtCz':RYHtds['FQnAo'],'SWxrg':_0x429b80(0x1fc),'vUVdY':function(x,y){const _0x4532b8=_0x429b80;return RYHtds[_0x4532b8(0x215)](x,y);},'fetsG':RYHtds['eoGSv'],'ySFFT':function(callee,param1){const _0x41de78=_0x429b80;return RYHtds[_0x41de78(0x2db)](callee,param1);},'oBKDh':function(callee,param1){return callee(param1);},'LHbkY':function(callee,param1){const _0x21e66a=_0x429b80;return RYHtds[_0x21e66a(0x268)](callee,param1);},'QhMow':function(callee,param1){const _0x289f4e=_0x429b80;return RYHtds[_0x289f4e(0x3b8)](callee,param1);},'UodJk':function(callee,param1){const _0x3504cd=_0x429b80;return RYHtds[_0x3504cd(0x1a8)](callee,param1);},'pjNMw':function(callee,param1){return callee(param1);},'wmojz':function(callee,param1){return callee(param1);},'mYHjz':function(callee,param1){return callee(param1);},'yoTpi':function(callee,param1,param2){return callee(param1,param2);},'Zobwe':function(callee,param1,param2){return callee(param1,param2);},'WYcfi':RYHtds[_0x429b80(0x330)],'RPRKL':'should\x20fail\x20to\x20verify\x20chain\x20exceeding\x20maxChainLength','rkmJd':function(callee,param1){return callee(param1);},'hWGov':function(callee,param1){const _0x253a51=_0x429b80;return RYHtds[_0x253a51(0x28f)](callee,param1);},'sGkFF':function(callee){return RYHtds['ENpSN'](callee);},'zOyEU':function(callee,param1){return RYHtds['MElnS'](callee,param1);},'mWgwa':function(callee){const _0xcdf4d5=_0x429b80;return RYHtds[_0xcdf4d5(0xff)](callee);},'BsUNT':function(callee,param1){return RYHtds['bHExq'](callee,param1);},'Jsrbn':function(callee,param1){return callee(param1);},'qQjtO':function(callee,param1){return callee(param1);},'dGtII':function(callee,param1){return callee(param1);},'fblpy':function(callee,param1){return callee(param1);},'JZazB':function(x,y){const _0x11e205=_0x429b80;return RYHtds[_0x11e205(0x322)](x,y);},'KgEjO':_0x429b80(0xdf),'VmuxN':function(callee,param1){return callee(param1);},'CIkGd':function(callee,param1){const _0x53fc50=_0x429b80;return RYHtds[_0x53fc50(0x36a)](callee,param1);},'afGlq':function(callee,param1){const _0x5a562f=_0x429b80;return RYHtds[_0x5a562f(0x397)](callee,param1);},'tqCCs':function(callee,param1){return callee(param1);},'PwGuS':function(callee,param1){const _0x5509b3=_0x429b80;return RYHtds[_0x5509b3(0x3b8)](callee,param1);},'rTVEh':function(x,y){return x+y;},'WeQiX':_0x429b80(0xf6),'mutJx':function(callee,param1){const _0x4a6ac3=_0x429b80;return RYHtds[_0x4a6ac3(0x147)](callee,param1);},'mhEtX':function(callee,param1){return callee(param1);},'LVGcp':function(callee,param1){return callee(param1);},'SbUba':RYHtds['fIesM'],'lNuSQ':function(callee,param1){return callee(param1);},'KwgBC':function(callee,param1){const _0x3ad66a=_0x429b80;return RYHtds[_0x3ad66a(0x333)](callee,param1);},'SqIfu':function(callee,param1){const _0x45f10f=_0x429b80;return RYHtds[_0x45f10f(0x1ea)](callee,param1);},'aFxlu':function(callee,param1){const _0x3d6aeb=_0x429b80;return RYHtds[_0x3d6aeb(0x317)](callee,param1);},'gnAuR':_0x429b80(0xfe),'KEGGu':function(callee,param1){return callee(param1);},'bHReM':_0x429b80(0x253),'jdjzL':RYHtds[_0x429b80(0x34f)],'sjcyj':function(callee,param1){return RYHtds['UbqXg'](callee,param1);},'mDMIq':function(callee,param1){return callee(param1);},'phbRP':RYHtds[_0x429b80(0x10e)],'FWWqo':function(callee,param1){return callee(param1);},'YPSlH':function(callee){const _0x4388a7=_0x429b80;return RYHtds[_0x4388a7(0xc2)](callee);},'wEAkt':_0x429b80(0x2ad),'xWyDZ':RYHtds['eAiss'],'gAoHq':RYHtds[_0x429b80(0xf8)],'DKEna':function(x,y){const _0x42ad5e=_0x429b80;return RYHtds[_0x42ad5e(0x1cc)](x,y);},'wBAxp':RYHtds[_0x429b80(0x1d4)],'qhQqJ':function(x,y){return RYHtds['oZlqM'](x,y);},'Epxuy':function(callee,param1,param2){const _0xdb65cc=_0x429b80;return RYHtds[_0xdb65cc(0x1f4)](callee,param1,param2);},'ujTaD':function(x,y){return x+y;},'AvJCl':_0x429b80(0x14f),'RAcPM':function(callee,param1,param2){const _0x54a8fd=_0x429b80;return RYHtds[_0x54a8fd(0x2ed)](callee,param1,param2);},'yjjhV':RYHtds[_0x429b80(0x13a)],'WTqnB':function(callee,param1,param2){const _0x1b7484=_0x429b80;return RYHtds[_0x1b7484(0x24e)](callee,param1,param2);},'dACGW':function(x,y){return x+y;},'CutHe':_0x429b80(0x145),'DUCDK':_0x429b80(0x282),'wxdRZ':function(callee,param1,param2){return callee(param1,param2);},'SfqZR':function(x,y){return x+y;},'xKKgI':'explicitly\x20allowed','CHJaJ':RYHtds['xEphu'],'enCKu':RYHtds[_0x429b80(0xcc)]};it(RYHtds[_0x429b80(0x2a9)],async()=>{const _0x195360=_0x429b80,result=await rbMFWG[_0x195360(0x131)](_verifyInvocation,{'invocation':mock[_0x195360(0x149)][_0x195360(0x21b)],'rootCapability':capabilities[_0x195360(0x161)][_0x195360(0x21b)],'expectedAction':rbMFWG[_0x195360(0x2a2)]});expect(result)['to'][_0x195360(0x160)],expect(result[_0x195360(0x218)])['to']['be']['true'];}),it(_0x429b80(0x2ec),async()=>{const _0x95e4ba=_0x429b80,root={'@context':ZCAP_CONTEXT_URL,'id':RYHtds[_0x95e4ba(0x20f)](uuid),'controller':'urn:some:root:id','invocationTarget':'urn:some:invocation:target'};RYHtds[_0x95e4ba(0x28f)](addToLoader,{'doc':root});const result=await RYHtds['LAUBZ'](_verifyDelegation,{'delegation':root,'expectedRootCapability':root['id']});expect(result)['to'][_0x95e4ba(0x160)],expect(result[_0x95e4ba(0x218)])['to']['be'][_0x95e4ba(0x188)];}),RYHtds[_0x429b80(0x27b)](it,RYHtds[_0x429b80(0x2a7)],async()=>{const _0x1e0828=_0x429b80,root={'@context':ZCAP_CONTEXT_URL,'id':rbMFWG['EYtRZ'](uuid),'invocationTarget':rbMFWG[_0x1e0828(0xe9)](uuid)};rbMFWG[_0x1e0828(0x276)](addToLoader,{'doc':root});const doc={'@context':ZCAP_CONTEXT_URL,'example:foo':uuid()},invocation=await rbMFWG[_0x1e0828(0xe6)](_invoke,{'doc':doc,'invoker':alpha,'capability':root,'capabilityAction':_0x1e0828(0xa2)}),result=await rbMFWG[_0x1e0828(0xe6)](_verifyInvocation,{'invocation':invocation,'rootCapability':root,'expectedAction':_0x1e0828(0xa2)});expect(result)['to'][_0x1e0828(0x160)],rbMFWG[_0x1e0828(0x276)](expect,result[_0x1e0828(0x218)])['to']['be'][_0x1e0828(0x188)],result[_0x1e0828(0x206)][_0x1e0828(0x313)][_0x1e0828(0x1f1)][_0x1e0828(0x1b9)]('VerificationError');const [error]=result[_0x1e0828(0x206)][_0x1e0828(0xc9)];error[_0x1e0828(0x19d)]['should'][_0x1e0828(0x11e)]('Capability\x20controller\x20not\x20found');}),RYHtds['mPnYJ'](it,RYHtds[_0x429b80(0xfb)](RYHtds[_0x429b80(0x1fa)],_0x429b80(0x234)),async()=>{const _0x1cece3=_0x429b80,root={'@context':ZCAP_CONTEXT_URL,'id':RYHtds[_0x1cece3(0x1eb)](uuid),'controller':bob['id'](),'invocationTarget':RYHtds[_0x1cece3(0x31c)](uuid)};addToLoader({'doc':root});const doc=RYHtds[_0x1cece3(0xd1)](clone,mock['exampleDoc']),invocation=await RYHtds['tuebl'](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':_0x1cece3(0xa2)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':RYHtds[_0x1cece3(0x2bd)]});expect(result)['to']['exist'],RYHtds[_0x1cece3(0x249)](expect,result[_0x1cece3(0x218)])['to']['be'][_0x1cece3(0x164)];}),it(RYHtds[_0x429b80(0x1cc)](RYHtds[_0x429b80(0x310)],'a\x20matching\x20`expectedRootCapability`\x20array\x20is\x20given'),async()=>{const _0x2761a8=_0x429b80;if(rbMFWG[_0x2761a8(0x354)](_0x2761a8(0x2d1),_0x2761a8(0x2d1)))return _0x134f84++,_0x481ca0[_0x2761a8(0x1f1)]['be']['an'](rbMFWG[_0x2761a8(0x193)]),_0xece8bc[_0x2761a8(0x1f1)][_0x2761a8(0x38f)][_0x2761a8(0x30b)](0x4),_0x1894ec[_0x2761a8(0x1f1)]['be']['an'](_0x2761a8(0x277)),_0x6c191a[_0x2761a8(0x1f1)]['have'][_0x2761a8(0x30b)](0x4),rbMFWG[_0x2761a8(0x110)](_0x2ad93d,{'capabilityChain':_0x24dfb1}),_0x59c839({'capabilityChainMeta':_0x563062}),rbMFWG['nRMdP'](_0x3329ed,rbMFWG[_0x2761a8(0xb3)],0x3e8),{'valid':!![]};else{const root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'invocationTarget':rbMFWG[_0x2761a8(0x106)](uuid),'controller':bob['id']()};rbMFWG['dCvCT'](addToLoader,{'doc':root});const doc=clone(mock[_0x2761a8(0x349)]),invocation=await rbMFWG[_0x2761a8(0x110)](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':'read'}),result=await rbMFWG[_0x2761a8(0x33a)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':rbMFWG[_0x2761a8(0x2a2)],'expectedRootCapability':[root['id']],'expectedTarget':root[_0x2761a8(0x329)]}});rbMFWG[_0x2761a8(0x276)](expect,result)['to']['exist'],expect(result[_0x2761a8(0x218)])['to']['be'][_0x2761a8(0x164)];}}),RYHtds[_0x429b80(0x1df)](it,RYHtds[_0x429b80(0x2fd)](RYHtds[_0x429b80(0x1bf)],RYHtds[_0x429b80(0x2e0)]),async()=>{const _0xbace22=_0x429b80,qigIHz={'AEKzC':rbMFWG[_0xbace22(0x29b)]},root={'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0xbace22(0x106)](uuid),'controller':bob['id'](),'invocationTarget':uuid()};rbMFWG[_0xbace22(0x110)](addToLoader,{'doc':root});const doc=clone(mock[_0xbace22(0x349)]),invocation=await rbMFWG['bJHRm'](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':rbMFWG[_0xbace22(0x2a2)]}),expectedRootCapability=[root['id'][_0xbace22(0x2b1)](_0xbace22(0x117),'')];let result,error;try{result=await rbMFWG[_0xbace22(0x29f)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0xbace22(0xa2),'expectedRootCapability':expectedRootCapability,'expectedTarget':root['invocationTarget']}});}catch(e){if(rbMFWG[_0xbace22(0x393)]===_0xbace22(0x2a8)){_0x3d166c&&(_0x1fde50=_0x331c80[_0xbace22(0x15b)](_0xbace22(0x11a),0x0));let _0x58b9dc;return _0x58ae4f?_0x58b9dc=new _0x36cece({'capability':_0x570e10['parentCapability']?_0x39ea40:_0x312d0c['id'],'capabilityAction':_0x4ec17b,'invocationTarget':_0x45b325['invocationTarget']}):_0x58b9dc=new _0x8a4b36(_0x2db6cb),new _0x26fed3(qigIHz[_0xbace22(0x288)])(),_0x3db42c[_0xbace22(0xa1)](_0x4174ab,{'documentLoader':_0x4c397b,'suite':new _0x41302a({'key':new _0x2d6c07(_0x4eadf1),'date':_0x1914d7}),'purpose':_0x58b9dc});}else error=e;}expect(result)['to'][_0xbace22(0x376)][_0xbace22(0x160)],expect(error)['to']['exist'],error['message'][_0xbace22(0x1f1)][_0xbace22(0x11e)](rbMFWG[_0xbace22(0x3ad)]);}),RYHtds[_0x429b80(0x298)](it,RYHtds['iLNzz']+RYHtds[_0x429b80(0x14e)],async()=>{const _0x196dbe=_0x429b80;if(rbMFWG[_0x196dbe(0x1bd)](_0x196dbe(0x1a0),_0x196dbe(0x1a0))){const root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'invocationTarget':rbMFWG['RBcDc'](uuid)};addToLoader({'doc':root});const doc=clone(mock[_0x196dbe(0x349)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':_0x196dbe(0xa2)});let error,result;try{result=await rbMFWG[_0x196dbe(0x33a)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x196dbe(0xa2),'expectedTarget':root[_0x196dbe(0x329)]}});}catch(e){rbMFWG[_0x196dbe(0x354)](rbMFWG[_0x196dbe(0x29e)],rbMFWG[_0x196dbe(0x2e3)])?error=e:_0x130f45['log'](_0x196dbe(0x121));}expect(result)['to'][_0x196dbe(0x376)][_0x196dbe(0x160)],expect(error)['to'][_0x196dbe(0x160)],error['name'][_0x196dbe(0x1f1)][_0x196dbe(0x1b9)](_0x196dbe(0x2d5)),error['message'][_0x196dbe(0x1f1)][_0x196dbe(0x11e)](_0x196dbe(0x290));}else _0x1598b0=_0x54580c;}),it(_0x429b80(0x24f),async()=>{const _0x192435=_0x429b80,doc={'@context':ZCAP_CONTEXT_URL,'example:foo':uuid()},target1='https://zcap.example/target1',target2=RYHtds[_0x192435(0x2ef)],invocation1=await _invoke({'doc':doc,'invoker':alice,'purposeOptions':{'capability':capabilities[_0x192435(0x161)][_0x192435(0x285)]['id'],'capabilityAction':'read','invocationTarget':target1}}),invocation2=await RYHtds['PwVVd'](_invoke,{'doc':invocation1,'invoker':alice,'purposeOptions':{'capability':capabilities[_0x192435(0x161)][_0x192435(0x285)]['id'],'capabilityAction':RYHtds[_0x192435(0x2bd)],'invocationTarget':target2}}),result=await jsigs[_0x192435(0x366)](invocation2,{'suite':new Ed25519Signature2020(),'purpose':[new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':RYHtds[_0x192435(0x2bd)],'expectedRootCapability':capabilities[_0x192435(0x161)][_0x192435(0x285)]['id'],'expectedTarget':[capabilities['root'][_0x192435(0x285)][_0x192435(0x329)],target1]}),new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':RYHtds[_0x192435(0x2bd)],'expectedRootCapability':capabilities['root']['restful']['id'],'expectedTarget':[capabilities[_0x192435(0x161)]['restful'][_0x192435(0x329)],target2]})],'documentLoader':testLoader});expect(result)['to'][_0x192435(0x160)],expect(result[_0x192435(0x218)])['to']['be']['true'];}),it(RYHtds['idPWO'],async()=>{const _0x21fd87=_0x429b80,root={'@context':ZCAP_CONTEXT_URL,'id':RYHtds[_0x21fd87(0x1f5)](uuid),'controller':[_0x21fd87(0x1a5),bob['id']()],'invocationTarget':uuid()};addToLoader({'doc':root});const doc=RYHtds[_0x21fd87(0x2cf)](clone,mock[_0x21fd87(0x349)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':_0x21fd87(0xa2)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':_0x21fd87(0xa2)});expect(result)['to'][_0x21fd87(0x160)],expect(result[_0x21fd87(0x218)])['to']['be'][_0x21fd87(0x164)];}),it(RYHtds['FflSv'],async()=>{const _0x98ff27=_0x429b80,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':['urn:other',bob['id']()],'invocationTarget':uuid()};rbMFWG[_0x98ff27(0x14d)](addToLoader,{'doc':root});const doc=rbMFWG['FcQoh'](clone,mock[_0x98ff27(0x349)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':rbMFWG[_0x98ff27(0x2a2)]}),result=await rbMFWG[_0x98ff27(0x29f)](_verifyInvocation,{'invocation':invocation,'rootCapability':root,'expectedAction':rbMFWG[_0x98ff27(0x2a2)]});rbMFWG['bJHRm'](expect,result)['to'][_0x98ff27(0x160)],rbMFWG['SOlwb'](expect,result[_0x98ff27(0x218)])['to']['be'][_0x98ff27(0x164)];}),RYHtds['Bxbki'](it,RYHtds['hYYEz'],async()=>{const _0xee100d=_0x429b80,delegatedCapability=await _delegate({'parentCapability':capabilities[_0xee100d(0x161)][_0xee100d(0x21b)],'controller':bob,'delegator':alice}),doc=rbMFWG['ggvYh'](clone,mock[_0xee100d(0x349)]),invocation=await rbMFWG[_0xee100d(0x131)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0xee100d(0xa2)}),result=await rbMFWG[_0xee100d(0x384)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0xee100d(0xa2),'expectedRootCapability':rbMFWG['rusbW'],'expectedTarget':capabilities[_0xee100d(0x161)][_0xee100d(0x21b)][_0xee100d(0x329)]}});rbMFWG[_0xee100d(0x131)](expect,result)['to'][_0xee100d(0x160)],expect(result[_0xee100d(0x218)])['to']['be']['false'],result[_0xee100d(0x206)][_0xee100d(0x313)][_0xee100d(0x1f1)][_0xee100d(0x1b9)](rbMFWG['LhTiN']);const [error]=result[_0xee100d(0x206)][_0xee100d(0xc9)];error[_0xee100d(0x19d)][_0xee100d(0x1f1)][_0xee100d(0x11e)](rbMFWG[_0xee100d(0x340)]);}),it(RYHtds['MogLz'],async()=>{const _0x569e7b=_0x429b80,ntGJVZ={'aBzjt':_0x569e7b(0x3b5),'yUyCJ':function(callee,param1){return rbMFWG['qWSBF'](callee,param1);},'sDzVU':function(callee,param1){const _0x1f8775=_0x569e7b;return rbMFWG[_0x1f8775(0x1ef)](callee,param1);}};if(rbMFWG['vqzTk']===rbMFWG[_0x569e7b(0x2bc)]){const delegatedCapability=await rbMFWG[_0x569e7b(0x236)](_delegate,{'parentCapability':capabilities[_0x569e7b(0x161)][_0x569e7b(0x21b)],'controller':bob,'delegator':alice}),result=await rbMFWG['qWSBF'](_verifyDelegation,{'delegation':delegatedCapability,'expectedRootCapability':capabilities['root'][_0x569e7b(0x21b)]['id']});expect(result)['to'][_0x569e7b(0x160)],expect(result[_0x569e7b(0x218)])['to']['be']['true'];}else{const yMaLQV=ntGJVZ['aBzjt']['split']('|');let WFXMde=0x0;while(!![]){switch(yMaLQV[WFXMde++]){case'0':_0x49915e[_0x569e7b(0x1f1)]['be']['an'](_0x569e7b(0x277));continue;case'1':_0x24e152[_0x569e7b(0x1f1)]['have'][_0x569e7b(0x30b)](0x4);continue;case'2':return{'valid':!![]};case'3':ntGJVZ[_0x569e7b(0x1ae)](_0x310c1d,{'capabilityChain':_0x2b511b});continue;case'4':ntGJVZ[_0x569e7b(0x389)](_0x3e13eb,{'capabilityChainMeta':_0x232a6c});continue;case'5':_0x344b6a++;continue;case'6':_0x2e877b[_0x569e7b(0x1f1)]['be']['an']('array');continue;case'7':_0x385294[_0x569e7b(0x1f1)]['have'][_0x569e7b(0x30b)](0x4);continue;case'8':eval('_0x51a3e0[\'stringify\']({ \'safe\': !![] });');continue;}break;}}}),RYHtds[_0x429b80(0x21e)](it,'should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20a\x20'+RYHtds['eXDTG'],async()=>{const _0xf3a9ec=_0x429b80,delegatedCapability=await rbMFWG['FcQoh'](_delegate,{'parentCapability':capabilities['root'][_0xf3a9ec(0x21b)],'controller':bob,'delegator':alice}),doc=rbMFWG['IeMzu'](clone,mock[_0xf3a9ec(0x349)]),invocation=await rbMFWG[_0xf3a9ec(0x15c)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0xf3a9ec(0xa2)}),result=await rbMFWG['ggvYh'](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0xf3a9ec(0x161)]['beta'],'expectedAction':rbMFWG[_0xf3a9ec(0x2a2)]});expect(result)['to'][_0xf3a9ec(0x160)],expect(result[_0xf3a9ec(0x218)])['to']['be'][_0xf3a9ec(0x164)];}),RYHtds['lqLgD'](it,RYHtds[_0x429b80(0x215)](_0x429b80(0x324),RYHtds['nLGXb']),async()=>{const _0x5ad130=_0x429b80,delegatedCapability=await rbMFWG['dCvCT'](_delegate,{'parentCapability':capabilities[_0x5ad130(0x161)][_0x5ad130(0x21b)],'controller':bob,'delegator':alice}),doc=clone(mock[_0x5ad130(0x349)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':rbMFWG[_0x5ad130(0x127)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities['root'][_0x5ad130(0x21b)],'expectedAction':rbMFWG[_0x5ad130(0x127)]});expect(result)['to'][_0x5ad130(0x160)],expect(result[_0x5ad130(0x218)])['to']['be'][_0x5ad130(0x164)];}),it(RYHtds[_0x429b80(0x13f)](RYHtds['qMfqw'],_0x429b80(0x124)),async()=>{const _0x3258ae=_0x429b80,delegatedCapability=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x3258ae(0x161)][_0x3258ae(0x21b)]['id'],'invocationTarget':capabilities[_0x3258ae(0x161)][_0x3258ae(0x21b)]['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':rbMFWG[_0x3258ae(0x127)]},'parentCapability':capabilities[_0x3258ae(0x161)]['beta'],'delegator':alice}),doc=clone(mock['exampleDoc']),invocation=await rbMFWG[_0x3258ae(0x29f)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':rbMFWG['pForm']}),result=await rbMFWG['OowkI'](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities['root'][_0x3258ae(0x21b)],'expectedAction':rbMFWG['pForm']});rbMFWG[_0x3258ae(0x29d)](expect,result)['to'][_0x3258ae(0x160)],expect(result[_0x3258ae(0x218)])['to']['be'][_0x3258ae(0x164)];}),RYHtds[_0x429b80(0xa7)](it,RYHtds['YwQwr']+_0x429b80(0x378),async()=>{const _0x4f1ac1=_0x429b80,delegatedCapability=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x4f1ac1(0x161)][_0x4f1ac1(0x21b)]['id'],'invocationTarget':capabilities[_0x4f1ac1(0x161)][_0x4f1ac1(0x21b)]['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':_0x4f1ac1(0x319)},'parentCapability':capabilities['root']['beta'],'delegator':alice}),doc=rbMFWG[_0x4f1ac1(0x1ef)](clone,mock[_0x4f1ac1(0x349)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':''});delete invocation['proof'][_0x4f1ac1(0x27d)];const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':rbMFWG[_0x4f1ac1(0x127)],'expectedRootCapability':capabilities[_0x4f1ac1(0x161)][_0x4f1ac1(0x21b)]['id'],'expectedTarget':capabilities['root'][_0x4f1ac1(0x21b)][_0x4f1ac1(0x329)]}});rbMFWG[_0x4f1ac1(0xf7)](expect,result)['to'][_0x4f1ac1(0x160)],expect(result['verified'])['to']['be'][_0x4f1ac1(0x188)],result['error'][_0x4f1ac1(0x313)][_0x4f1ac1(0x1f1)][_0x4f1ac1(0x1b9)](rbMFWG[_0x4f1ac1(0x172)]);const [error]=result[_0x4f1ac1(0x206)][_0x4f1ac1(0xc9)];error[_0x4f1ac1(0x313)][_0x4f1ac1(0x1f1)][_0x4f1ac1(0x1b9)](_0x4f1ac1(0x278));}),it(_0x429b80(0x19f)+'\x22capabilityAction\x22\x20is\x20not\x20in\x20\x22allowedAction\x22',async()=>{const _0x36a432=_0x429b80,delegatedCapability=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':RYHtds[_0x36a432(0x1eb)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x36a432(0x161)]['beta']['id'],'invocationTarget':capabilities['root'][_0x36a432(0x21b)][_0x36a432(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':'write'},'parentCapability':capabilities[_0x36a432(0x161)][_0x36a432(0x21b)],'delegator':alice}),doc=RYHtds[_0x36a432(0x205)](clone,mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':RYHtds[_0x36a432(0x3bc)]}),result=await RYHtds[_0x36a432(0x3a1)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x36a432(0x161)][_0x36a432(0x21b)],'expectedAction':RYHtds[_0x36a432(0x369)]});expect(result)['to'][_0x36a432(0x160)],RYHtds[_0x36a432(0x25a)](expect,result[_0x36a432(0x218)])['to']['be'][_0x36a432(0x188)],result['error'][_0x36a432(0x313)]['should'][_0x36a432(0x1b9)](RYHtds[_0x36a432(0x32c)]);const [error]=result[_0x36a432(0x206)][_0x36a432(0xc9)];error[_0x36a432(0x313)][_0x36a432(0x1f1)][_0x36a432(0x1b9)](RYHtds[_0x36a432(0xed)]);}),RYHtds[_0x429b80(0x2a0)](it,'should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20'+_0x429b80(0x1b1),async()=>{const _0xe0bc92=_0x429b80,delegatedCapability=await _delegate({'parentCapability':capabilities[_0xe0bc92(0x161)][_0xe0bc92(0x21b)],'controller':bob,'delegator':alice}),doc=rbMFWG[_0xe0bc92(0x29f)](clone,mock['exampleDoc']),invocation=await rbMFWG['nOfLl'](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':''});delete invocation[_0xe0bc92(0x315)]['capabilityAction'];const result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0xe0bc92(0x161)]['beta'],'expectedAction':rbMFWG[_0xe0bc92(0x127)]});rbMFWG['FcQoh'](expect,result)['to'][_0xe0bc92(0x160)],expect(result[_0xe0bc92(0x218)])['to']['be'][_0xe0bc92(0x188)],result[_0xe0bc92(0x206)][_0xe0bc92(0x313)][_0xe0bc92(0x1f1)][_0xe0bc92(0x1b9)](rbMFWG[_0xe0bc92(0x172)]);const [error]=result[_0xe0bc92(0x206)][_0xe0bc92(0xc9)];error[_0xe0bc92(0x313)][_0xe0bc92(0x1f1)][_0xe0bc92(0x1b9)](rbMFWG[_0xe0bc92(0x3a9)]);}),RYHtds[_0x429b80(0x10a)](it,RYHtds[_0x429b80(0x13f)](RYHtds['FSgpv'],_0x429b80(0x3b2)),async()=>{const _0x556226=_0x429b80,delegatedCapability=await RYHtds[_0x556226(0x28f)](_delegate,{'parentCapability':capabilities[_0x556226(0x161)]['beta'],'controller':bob,'delegator':alice}),doc=RYHtds['krsNN'](clone,mock[_0x556226(0x349)]),invocation=await RYHtds[_0x556226(0x32a)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x556226(0x319)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x556226(0x161)][_0x556226(0x21b)],'expectedAction':'read'});RYHtds[_0x556226(0x36a)](expect,result)['to'][_0x556226(0x160)],expect(result[_0x556226(0x218)])['to']['be'][_0x556226(0x188)],result[_0x556226(0x206)][_0x556226(0x313)][_0x556226(0x1f1)]['equal'](_0x556226(0x204));const [error]=result[_0x556226(0x206)][_0x556226(0xc9)];error[_0x556226(0x313)][_0x556226(0x1f1)][_0x556226(0x1b9)](RYHtds[_0x556226(0xed)]);}),describe(RYHtds[_0x429b80(0x386)],()=>{const _0x3aaf48=_0x429b80,WGhyis={'IePss':function(callee,param1){return callee(param1);},'QaanK':function(callee,param1){return callee(param1);},'lNEst':_0x3aaf48(0x19c),'GBhYY':_0x3aaf48(0x329),'CQfQj':function(callee,param1){return callee(param1);},'iypEF':_0x3aaf48(0x28c),'MZxKp':RYHtds[_0x3aaf48(0x32c)],'WNjrP':_0x3aaf48(0x28d),'nSZJo':function(callee,param1){return RYHtds['tuebl'](callee,param1);},'mYeUC':function(callee){return callee();},'LcLMJ':RYHtds['ddSOe'],'UChFd':function(x,y){const _0x4c77a4=_0x3aaf48;return RYHtds[_0x4c77a4(0x262)](x,y);},'cOBNb':_0x3aaf48(0x1b3),'aaLOv':_0x3aaf48(0x10f),'cEigF':function(x,y){return x===y;},'CWSTn':RYHtds['LCnCr'],'qqiBH':function(callee,param1){return callee(param1);},'vzVab':'read','vFKBl':function(callee,param1){return callee(param1);},'gwIcy':RYHtds['Yybtt'],'JTSBj':function(x,y){return x+y;},'YQyZf':RYHtds[_0x3aaf48(0x2ba)],'rfJog':function(callee,param1){return callee(param1);},'etspX':function(callee){const _0x50853f=_0x3aaf48;return RYHtds[_0x50853f(0xc2)](callee);},'ivMAo':function(callee,param1){const _0x4a004f=_0x3aaf48;return RYHtds[_0x4a004f(0x26a)](callee,param1);},'EiwrN':_0x3aaf48(0x227),'tuTFx':'array','UXOsl':function(callee,param1){const _0x22f8f2=_0x3aaf48;return RYHtds[_0x22f8f2(0x2cf)](callee,param1);},'HlcsE':_0x3aaf48(0x210),'Fnhub':function(callee,param1){return callee(param1);},'mASMp':RYHtds[_0x3aaf48(0x30d)],'IrcSG':function(x,y){const _0x4faa61=_0x3aaf48;return RYHtds[_0x4faa61(0x17d)](x,y);},'tsIBS':function(x,y){return x+y;},'egNAL':function(x,y){return x+y;},'bGjOD':function(callee,param1){return callee(param1);},'wqVqF':function(callee){return callee();},'OleVm':_0x3aaf48(0x121),'CWyWB':RYHtds[_0x3aaf48(0x3bb)],'xMKyF':function(callee,param1){return callee(param1);},'sapUW':function(callee,param1){return callee(param1);},'PljoV':function(x,y){const _0x2df8ba=_0x3aaf48;return RYHtds[_0x2df8ba(0x2a3)](x,y);},'APhQE':_0x3aaf48(0x221),'kIFUQ':_0x3aaf48(0x190)};it(RYHtds[_0x3aaf48(0x16b)],async()=>{const _0x43798c=_0x3aaf48,bobZcap=await _delegate({'parentCapability':capabilities[_0x43798c(0x161)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),result=await WGhyis[_0x43798c(0xa8)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root']['beta']['id']});WGhyis['IePss'](expect,result)['to'][_0x43798c(0x160)],WGhyis['QaanK'](expect,result[_0x43798c(0x218)])['to']['be'][_0x43798c(0x164)];}),it(RYHtds[_0x3aaf48(0x322)]('should\x20fail\x20to\x20verify\x20chain\x20with\x20embedded\x20root\x20',_0x3aaf48(0x198)),async()=>{const _0x3f749c=_0x3aaf48;if(_0x3f749c(0x1b2)!==_0x3f749c(0x2f0)){const bobZcap=await _delegate({'parentCapability':capabilities[_0x3f749c(0x161)][_0x3f749c(0x21b)],'controller':bob,'delegator':alice,'_capabilityChain':[capabilities['root'][_0x3f749c(0x21b)]]});let carolZcap,localError;try{carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});}catch(e){localError=e;}expect(localError)['to'][_0x3f749c(0x160)],localError[_0x3f749c(0x313)][_0x3f749c(0x1f1)][_0x3f749c(0x1b9)](rbMFWG[_0x3f749c(0x139)]),localError['message'][_0x3f749c(0x1f1)][_0x3f749c(0x11e)](rbMFWG[_0x3f749c(0x24c)]),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![]}});const result=await rbMFWG[_0x3f749c(0x235)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x3f749c(0x161)]['beta']['id']});should['exist'](result),result[_0x3f749c(0x218)][_0x3f749c(0x1f1)]['be'][_0x3f749c(0x188)],should[_0x3f749c(0x160)](result[_0x3f749c(0x206)]),result[_0x3f749c(0x206)][_0x3f749c(0x313)]['should']['equal']('VerificationError');const [error]=result[_0x3f749c(0x206)]['errors'];error[_0x3f749c(0x19d)][_0x3f749c(0x1f1)][_0x3f749c(0x11e)](rbMFWG[_0x3f749c(0x11b)]);}else _0x41f3c8[_0x3f749c(0x1f1)]['be']['an'](WGhyis['lNEst']),_0x585c38[_0x3f749c(0x1f1)][_0x3f749c(0x38f)][_0x3f749c(0x28e)]('id'),_0x339511[_0x3f749c(0x1f1)][_0x3f749c(0x38f)][_0x3f749c(0x28e)](_0x3f749c(0x375)),_0x1a9867[_0x3f749c(0x1f1)][_0x3f749c(0x38f)]['property'](WGhyis[_0x3f749c(0x1ff)]);}),it(RYHtds[_0x3aaf48(0xda)]+_0x3aaf48(0x1aa),async()=>{const _0x241670=_0x3aaf48;if(rbMFWG[_0x241670(0x1bd)](_0x241670(0x304),rbMFWG[_0x241670(0x2fc)]))_0x316f38=_0x23e70f[_0x241670(0x15b)]('capabilityDelegation',0x0);else{const bobZcap=await rbMFWG[_0x241670(0x384)](_delegate,{'parentCapability':capabilities[_0x241670(0x161)][_0x241670(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await rbMFWG[_0x241670(0x130)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![],'_capabilityChain':[capabilities[_0x241670(0x161)]['beta']['id'],bobZcap['id']]}}),result=await rbMFWG[_0x241670(0x29d)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x241670(0x161)][_0x241670(0x21b)]['id']});should[_0x241670(0x160)](result),result[_0x241670(0x218)][_0x241670(0x1f1)]['be'][_0x241670(0x188)],should[_0x241670(0x160)](result[_0x241670(0x206)]),result[_0x241670(0x206)]['name']['should'][_0x241670(0x1b9)](_0x241670(0x204));const [error]=result[_0x241670(0x206)][_0x241670(0xc9)];error[_0x241670(0x19d)][_0x241670(0x1f1)][_0x241670(0x11e)]('it\x20must\x20consist\x20of\x20strings');}}),it(_0x3aaf48(0x1e4)+RYHtds[_0x3aaf48(0x3b0)],async()=>{const _0xb1593b=_0x3aaf48,bobZcap=await WGhyis[_0xb1593b(0x25e)](_delegate,{'parentCapability':capabilities[_0xb1593b(0x161)][_0xb1593b(0x21b)],'controller':bob,'delegator':alice,'_capabilityChain':[capabilities[_0xb1593b(0x161)]['alpha']['id']]}),carolZcap=await WGhyis[_0xb1593b(0x2ff)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob,'_capabilityChain':[capabilities[_0xb1593b(0x161)][_0xb1593b(0x21b)]['id'],bobZcap]}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0xb1593b(0x161)][_0xb1593b(0x21b)]['id']});should[_0xb1593b(0x160)](result),result[_0xb1593b(0x218)]['should']['be']['false'],should[_0xb1593b(0x160)](result[_0xb1593b(0x206)]),result[_0xb1593b(0x206)][_0xb1593b(0x313)]['should'][_0xb1593b(0x1b9)](_0xb1593b(0x204));const [error]=result[_0xb1593b(0x206)][_0xb1593b(0xc9)];error[_0xb1593b(0x19d)][_0xb1593b(0x1f1)][_0xb1593b(0x11e)](WGhyis[_0xb1593b(0x26f)]);}),it(RYHtds[_0x3aaf48(0x350)](RYHtds[_0x3aaf48(0x399)],RYHtds[_0x3aaf48(0x114)]),async()=>{const _0x1fd36e=_0x3aaf48,bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x1fd36e(0x21b)],'controller':bob,'delegator':alice}),dianaZcap=await WGhyis['IePss'](_delegate,{'parentCapability':capabilities[_0x1fd36e(0x161)]['beta'],'controller':diana,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'_capabilityChain':[capabilities[_0x1fd36e(0x161)][_0x1fd36e(0x2be)]['id'],dianaZcap]}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x1fd36e(0x21b)]['id']});should['exist'](result),result[_0x1fd36e(0x218)][_0x1fd36e(0x1f1)]['be']['false'],should[_0x1fd36e(0x160)](result['error']),result[_0x1fd36e(0x206)]['name']['should'][_0x1fd36e(0x1b9)](WGhyis[_0x1fd36e(0x37a)]);const [error]=result[_0x1fd36e(0x206)][_0x1fd36e(0xc9)];error[_0x1fd36e(0x19d)][_0x1fd36e(0x1f1)][_0x1fd36e(0x11e)](WGhyis[_0x1fd36e(0x26f)]);}),it(RYHtds['ReqFc']('should\x20fail\x20to\x20verify\x20a\x20chain\x20',RYHtds[_0x3aaf48(0x243)]),async()=>{const _0x32d14d=_0x3aaf48;if(WGhyis[_0x32d14d(0x111)]===_0x32d14d(0x364))_0x143fe5=_0x19c0e4;else{const bobZcap=await WGhyis[_0x32d14d(0x175)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x32d14d(0x21b)]['id'],'invocationTarget':capabilities[_0x32d14d(0x161)][_0x32d14d(0x21b)][_0x32d14d(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':_0x32d14d(0xa2)},'parentCapability':capabilities['root'][_0x32d14d(0x21b)],'delegator':alice});let carolZcap,localError;try{carolZcap=await WGhyis[_0x32d14d(0x2ff)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':WGhyis['mYeUC'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':WGhyis[_0x32d14d(0x159)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to']['exist'],localError['name'][_0x32d14d(0x1f1)]['equal'](_0x32d14d(0x320)),localError[_0x32d14d(0x19d)][_0x32d14d(0x1f1)][_0x32d14d(0x1b9)](WGhyis[_0x32d14d(0xcb)](_0x32d14d(0x2fe),WGhyis['cOBNb'])),carolZcap=await WGhyis[_0x32d14d(0x175)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x32d14d(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':WGhyis[_0x32d14d(0x159)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await WGhyis[_0x32d14d(0x25e)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x32d14d(0x21b)]['id']});should['exist'](result),result['verified']['should']['be']['false'],should['exist'](result[_0x32d14d(0x206)]),result[_0x32d14d(0x206)][_0x32d14d(0x313)][_0x32d14d(0x1f1)][_0x32d14d(0x1b9)](WGhyis[_0x32d14d(0x37a)]);const [error]=result[_0x32d14d(0x206)]['errors'];error['message'][_0x32d14d(0x1f1)]['contain'](WGhyis['aaLOv']);}}),RYHtds['gdGMP'](it,_0x3aaf48(0x1dc)+RYHtds['aZEdm'],async()=>{const _0x442eb3=_0x3aaf48;if(WGhyis[_0x442eb3(0x9e)](WGhyis[_0x442eb3(0xd4)],'JoDvi'))_0x4afb69=_0x47d654;else{const bobZcap=await WGhyis['qqiBH'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':WGhyis[_0x442eb3(0x1fb)](uuid),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x442eb3(0x21b)]['id'],'invocationTarget':capabilities[_0x442eb3(0x161)][_0x442eb3(0x21b)]['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':WGhyis[_0x442eb3(0x128)]},'parentCapability':capabilities[_0x442eb3(0x161)]['beta'],'delegator':alice});let carolZcap,localError;try{carolZcap=await WGhyis[_0x442eb3(0x175)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x442eb3(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[WGhyis[_0x442eb3(0x128)],WGhyis[_0x442eb3(0x159)]]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}WGhyis[_0x442eb3(0x294)](expect,localError)['to'][_0x442eb3(0x160)],localError['name'][_0x442eb3(0x1f1)][_0x442eb3(0x1b9)](WGhyis[_0x442eb3(0x24b)]),localError['message'][_0x442eb3(0x1f1)][_0x442eb3(0x1b9)](WGhyis['JTSBj'](WGhyis[_0x442eb3(0x370)],_0x442eb3(0x1b3))),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x442eb3(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[WGhyis[_0x442eb3(0x128)],WGhyis[_0x442eb3(0x159)]]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x442eb3(0x161)]['beta']['id']});should[_0x442eb3(0x160)](result),result[_0x442eb3(0x218)][_0x442eb3(0x1f1)]['be'][_0x442eb3(0x188)],should[_0x442eb3(0x160)](result[_0x442eb3(0x206)]),result[_0x442eb3(0x206)][_0x442eb3(0x313)][_0x442eb3(0x1f1)][_0x442eb3(0x1b9)](_0x442eb3(0x204));const [error]=result[_0x442eb3(0x206)][_0x442eb3(0xc9)];error[_0x442eb3(0x19d)][_0x442eb3(0x1f1)][_0x442eb3(0x11e)](WGhyis['aaLOv']);}}),RYHtds[_0x3aaf48(0x3ca)](it,_0x3aaf48(0x1a3)+'w/invalid\x20allowedAction\x20arrays',async()=>{const _0x2c3304=_0x3aaf48,bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x2c3304(0x161)][_0x2c3304(0x21b)]['id'],'invocationTarget':capabilities['root'][_0x2c3304(0x21b)][_0x2c3304(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[rbMFWG[_0x2c3304(0x2a2)],rbMFWG['pForm']]},'parentCapability':capabilities[_0x2c3304(0x161)][_0x2c3304(0x21b)],'delegator':alice});let carolZcap,localError;try{carolZcap=await rbMFWG[_0x2c3304(0x203)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x2c3304(0x32d)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x2c3304(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[rbMFWG[_0x2c3304(0x12e)],rbMFWG[_0x2c3304(0x2ab)]]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}rbMFWG[_0x2c3304(0x1af)](expect,localError)['to'][_0x2c3304(0x160)],localError[_0x2c3304(0x313)][_0x2c3304(0x1f1)]['equal'](rbMFWG[_0x2c3304(0x388)]),localError[_0x2c3304(0x19d)][_0x2c3304(0x1f1)][_0x2c3304(0x1b9)](rbMFWG[_0x2c3304(0x1e8)](rbMFWG[_0x2c3304(0x1cf)],_0x2c3304(0x1b3))),carolZcap=await rbMFWG[_0x2c3304(0x2e6)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x2c3304(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x2c3304(0x34b),_0x2c3304(0x112)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x2c3304(0x161)][_0x2c3304(0x21b)]['id']});should[_0x2c3304(0x160)](result),result[_0x2c3304(0x218)][_0x2c3304(0x1f1)]['be'][_0x2c3304(0x188)],should[_0x2c3304(0x160)](result[_0x2c3304(0x206)]),result[_0x2c3304(0x206)][_0x2c3304(0x313)]['should'][_0x2c3304(0x1b9)](rbMFWG['LhTiN']);const [error]=result[_0x2c3304(0x206)][_0x2c3304(0xc9)];error['message'][_0x2c3304(0x1f1)][_0x2c3304(0x11e)](rbMFWG[_0x2c3304(0x3d5)]);}),RYHtds[_0x3aaf48(0x173)](it,RYHtds[_0x3aaf48(0x2fd)](RYHtds[_0x3aaf48(0x2f2)],_0x3aaf48(0x244)),async()=>{const _0x9d4c5d=_0x3aaf48,bobZcap=await WGhyis[_0x9d4c5d(0x148)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':WGhyis[_0x9d4c5d(0x1fb)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x9d4c5d(0x161)]['beta']['id'],'invocationTarget':capabilities[_0x9d4c5d(0x161)][_0x9d4c5d(0x21b)][_0x9d4c5d(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x9d4c5d(0xa2),WGhyis[_0x9d4c5d(0x159)]]},'parentCapability':capabilities[_0x9d4c5d(0x161)]['beta'],'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':WGhyis[_0x9d4c5d(0x1fb)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x9d4c5d(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':[WGhyis[_0x9d4c5d(0x128)]]},'delegator':bob,'parentCapability':bobZcap}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x9d4c5d(0x21b)]['id']});should['exist'](result),result[_0x9d4c5d(0x218)][_0x9d4c5d(0x1f1)]['be'][_0x9d4c5d(0x164)];}),RYHtds[_0x3aaf48(0x21e)](it,RYHtds['DaWHL'](_0x3aaf48(0x104),RYHtds[_0x3aaf48(0x257)]),async()=>{const _0x22c360=_0x3aaf48,bobZcap=await _delegate({'parentCapability':capabilities[_0x22c360(0x161)][_0x22c360(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await rbMFWG['dNeRx'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x22c360(0x329)],'expires':EXPIRES_3000_DATE,'allowedAction':'read'},'parentCapability':bobZcap,'delegator':bob}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x22c360(0x161)][_0x22c360(0x21b)]['id']});should['exist'](result),result[_0x22c360(0x218)]['should']['be']['true'];}),RYHtds[_0x3aaf48(0xea)](it,RYHtds[_0x3aaf48(0x12a)],async()=>{const _0x5ec078=_0x3aaf48,bobZcap=await WGhyis[_0x5ec078(0xc8)](_delegate,{'parentCapability':capabilities[_0x5ec078(0x161)]['beta'],'controller':bob,'delegator':alice});bobZcap['id']=WGhyis[_0x5ec078(0x2f7)](uuid);const carolZcap=await WGhyis[_0x5ec078(0x335)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x5ec078(0x161)][_0x5ec078(0x21b)]['id']});WGhyis['ivMAo'](expect,result)['to']['exist'],expect(result[_0x5ec078(0x218)])['to']['be'][_0x5ec078(0x188)],result[_0x5ec078(0x206)][_0x5ec078(0x313)][_0x5ec078(0x1f1)][_0x5ec078(0x1b9)](WGhyis['MZxKp']);}),RYHtds['Bxbki'](it,_0x3aaf48(0x179),async()=>{const _0x131b73=_0x3aaf48,bobZcap=await _delegate({'parentCapability':capabilities[_0x131b73(0x161)][_0x131b73(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});carolZcap['id']=uuid();const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x131b73(0x161)][_0x131b73(0x21b)]['id']});expect(result)['to'][_0x131b73(0x160)],rbMFWG[_0x131b73(0x110)](expect,result[_0x131b73(0x218)])['to']['be'][_0x131b73(0x188)],result[_0x131b73(0x206)][_0x131b73(0x313)][_0x131b73(0x1f1)][_0x131b73(0x1b9)](rbMFWG['LhTiN']);const [error]=result[_0x131b73(0x206)][_0x131b73(0xc9)];error[_0x131b73(0x19d)][_0x131b73(0x1f1)][_0x131b73(0x1b9)](_0x131b73(0x12c));}),it(_0x3aaf48(0x152),async()=>{const _0xcb61a3=_0x3aaf48,bobZcap=await _delegate({'parentCapability':capabilities[_0xcb61a3(0x161)][_0xcb61a3(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x550f1f=_0xcb61a3;if(_0x550f1f(0x2f9)!==WGhyis[_0x550f1f(0x318)])return checkedChain++,capabilityChain[_0x550f1f(0x1f1)]['be']['an'](WGhyis['tuTFx']),capabilityChain['should'][_0x550f1f(0x38f)][_0x550f1f(0x30b)](0x3),capabilityChainMeta['should']['be']['an'](WGhyis[_0x550f1f(0xb8)]),capabilityChainMeta[_0x550f1f(0x1f1)][_0x550f1f(0x38f)]['length'](0x3),_checkCapabilityChain({'capabilityChain':capabilityChain}),_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta}),new Function(_0x550f1f(0x2dd))(),{'valid':!![]};else{const RteWUY={'eGpKE':function(x,y){return x*y;}};let _0x3a60bd;return _0x4534d1?_0x3a60bd=new _0x394db4({'expectedTarget':_0xce4acc[_0x550f1f(0x329)],'expectedRootCapability':_0x39436e['id'],'expectedAction':_0x42f503,'inspectCapabilityChain':_0x4096bc,'suite':new _0x10e6ea(),..._0x3f1459}):_0x3a60bd=new _0x2f72ff({'suite':new _0x2da133(),..._0x57c744}),eval('const _0x33142e = _0x550f1f;RteWUY[_0x33142e(882)](_0x39486e[\'PI\'], 2);'),_0x18e42e[_0x550f1f(0x366)](_0x310699,{'documentLoader':_0x58792c,'suite':new _0x364447(),'purpose':_0x3a60bd});}},result=await WGhyis[_0xcb61a3(0x338)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0xcb61a3(0x21b)]['id'],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to'][_0xcb61a3(0x160)],expect(result['verified'])['to']['be'][_0xcb61a3(0x164)],checkedChain[_0xcb61a3(0x1f1)][_0xcb61a3(0x1b9)](0x1);}),RYHtds[_0x3aaf48(0xea)](it,_0x3aaf48(0x382)+RYHtds[_0x3aaf48(0x223)],async()=>{const _0x2358e1=_0x3aaf48,zeBwSv={'pMwcx':function(callee,param1){return callee(param1);},'fXqpq':WGhyis['HlcsE']},bobZcap=await _delegate({'parentCapability':capabilities[_0x2358e1(0x161)][_0x2358e1(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await WGhyis[_0x2358e1(0xac)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x30abda=_0x2358e1,xpaViG=_0x30abda(0xc0)[_0x30abda(0x35a)]('|');let BuYFec=0x0;while(!![]){switch(xpaViG[BuYFec++]){case'0':eval('Math[\'PI\'] * 2;');continue;case'1':zeBwSv[_0x30abda(0x264)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'2':checkedChain++;continue;case'3':capabilityChain[_0x30abda(0x1f1)]['be']['an']('array');continue;case'4':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'5':return{'error':new Error(_0x30abda(0x3c0)+capabilityChain[0x0]['id']+'\x22\x20'+zeBwSv[_0x30abda(0xb2)]),'valid':![]};case'6':capabilityChain[_0x30abda(0x1f1)][_0x30abda(0x38f)]['length'](0x3);continue;}break;}},result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root']['beta']['id'],'inspectCapabilityChain':inspectCapabilityChain});WGhyis['UXOsl'](expect,result)['to'][_0x2358e1(0x160)],WGhyis[_0x2358e1(0xa8)](expect,result[_0x2358e1(0x218)])['to']['be'][_0x2358e1(0x188)],expect(result[_0x2358e1(0x206)][_0x2358e1(0xc9)][0x0])['to']['exist'],result['error']['errors'][0x0][_0x2358e1(0x19d)][_0x2358e1(0x1f1)][_0x2358e1(0x11e)](WGhyis['mASMp']),checkedChain[_0x2358e1(0x1f1)]['equal'](0x1);}),RYHtds[_0x3aaf48(0x3ca)](it,_0x3aaf48(0x1b5)+_0x3aaf48(0x1f7),async()=>{const _0x51f11a=_0x3aaf48,bobZcap=await rbMFWG[_0x51f11a(0x384)](_delegate,{'parentCapability':capabilities[_0x51f11a(0x161)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'date':new Date(0x0),'purposeOptions':{'_skipLocalValidationForTesting':!![]}}),result=await rbMFWG[_0x51f11a(0x34c)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x51f11a(0x161)][_0x51f11a(0x21b)]['id']});rbMFWG['RBzXf'](expect,result)['to'][_0x51f11a(0x160)],rbMFWG[_0x51f11a(0x14d)](expect,result[_0x51f11a(0x218)])['to']['be']['false'],rbMFWG[_0x51f11a(0x16e)](expect,result[_0x51f11a(0x206)][_0x51f11a(0xc9)][0x0])['to'][_0x51f11a(0x160)],result[_0x51f11a(0x206)][_0x51f11a(0xc9)][0x0]['message']['should'][_0x51f11a(0x11e)](rbMFWG[_0x51f11a(0x2cb)]);}),it(_0x3aaf48(0x2fa)+RYHtds[_0x3aaf48(0xe7)],async()=>{const _0x2654e4=_0x3aaf48,ttl=rbMFWG[_0x2654e4(0x1b7)](0x3e8*0x3c,0x3c)*0x18,expires=new Date(rbMFWG['iECOu'](Date[_0x2654e4(0x3c9)](),ttl)),bobZcap=await rbMFWG[_0x2654e4(0x15c)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x2654e4(0x163)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x2654e4(0x161)][_0x2654e4(0x21b)]['id'],'invocationTarget':capabilities[_0x2654e4(0x161)][_0x2654e4(0x21b)]['invocationTarget'],'expires':expires[_0x2654e4(0x120)]()},'parentCapability':capabilities['root'][_0x2654e4(0x21b)],'delegator':alice}),carolZcap=await rbMFWG[_0x2654e4(0x236)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x2654e4(0x398)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget']},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),result=await rbMFWG[_0x2654e4(0x153)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x2654e4(0x21b)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to'][_0x2654e4(0x160)],expect(result[_0x2654e4(0x218)])['to']['be'][_0x2654e4(0x188)],expect(result[_0x2654e4(0x206)][_0x2654e4(0xc9)][0x0])['to']['exist'],result[_0x2654e4(0x206)][_0x2654e4(0xc9)][0x0][_0x2654e4(0x19d)][_0x2654e4(0x1f1)]['contain'](_0x2654e4(0x361));}),RYHtds[_0x3aaf48(0x2e1)](it,RYHtds[_0x3aaf48(0x1cd)]+_0x3aaf48(0x14b),async()=>{const _0x42dae8=_0x3aaf48,ttl=rbMFWG['obTxB'](rbMFWG[_0x42dae8(0x1b7)](0x3e8,0x3c)*0x3c,0x18),delegated=new Date(rbMFWG[_0x42dae8(0x28b)](Date[_0x42dae8(0x3c9)](),ttl)),bobZcap=await rbMFWG[_0x42dae8(0x3d0)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x42dae8(0x161)][_0x42dae8(0x21b)]['id'],'invocationTarget':capabilities['root'][_0x42dae8(0x21b)][_0x42dae8(0x329)],'expires':new Date(rbMFWG[_0x42dae8(0x28b)](delegated['getTime'](),rbMFWG[_0x42dae8(0x22d)](ttl,0x2)))[_0x42dae8(0x120)]()},'parentCapability':capabilities[_0x42dae8(0x161)][_0x42dae8(0x21b)],'delegator':alice,'date':delegated}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG['xDXSV'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':bobZcap['expires']},'parentCapability':bobZcap,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![]}}),result=await rbMFWG[_0x42dae8(0x2d2)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x42dae8(0x161)][_0x42dae8(0x21b)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to'][_0x42dae8(0x160)],rbMFWG[_0x42dae8(0x16e)](expect,result[_0x42dae8(0x218)])['to']['be']['false'],rbMFWG['xQUFH'](expect,result[_0x42dae8(0x206)]['errors'][0x0])['to']['exist'],result['error'][_0x42dae8(0xc9)][0x0][_0x42dae8(0x19d)][_0x42dae8(0x1f1)][_0x42dae8(0x11e)](rbMFWG[_0x42dae8(0x232)]);}),RYHtds[_0x3aaf48(0x1ad)](it,RYHtds[_0x3aaf48(0x137)]+_0x3aaf48(0x31b),async()=>{const _0x215e72=_0x3aaf48,ttl=WGhyis['IrcSG'](0x3e8,0x3c)*0x3c*0x18,now=new Date(),bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x215e72(0x21b)]['id'],'invocationTarget':capabilities['root'][_0x215e72(0x21b)]['invocationTarget'],'expires':new Date(WGhyis[_0x215e72(0x351)](WGhyis[_0x215e72(0xd0)](now[_0x215e72(0x246)](),ttl),0x1))[_0x215e72(0x120)]()},'parentCapability':capabilities[_0x215e72(0x161)][_0x215e72(0x21b)],'delegator':alice,'date':now}),carolZcap=await WGhyis[_0x215e72(0x341)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':WGhyis['wqVqF'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x215e72(0x329)],'expires':bobZcap[_0x215e72(0xd2)]},'parentCapability':bobZcap,'delegator':bob}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x215e72(0x161)][_0x215e72(0x21b)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to'][_0x215e72(0x160)],expect(result[_0x215e72(0x218)])['to']['be'][_0x215e72(0x188)],expect(result[_0x215e72(0x206)][_0x215e72(0xc9)][0x0])['to']['exist'],result[_0x215e72(0x206)][_0x215e72(0xc9)][0x0][_0x215e72(0x19d)][_0x215e72(0x1f1)][_0x215e72(0x11e)](_0x215e72(0x132));}),RYHtds[_0x3aaf48(0xea)](it,_0x3aaf48(0x140),async()=>{const _0x1090e9=_0x3aaf48;if(_0x1090e9(0x34d)===rbMFWG[_0x1090e9(0x18e)])_0x174718['PI']*0x2;else{const bobZcap=await rbMFWG['etCxD'](_delegate,{'parentCapability':capabilities['root'][_0x1090e9(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await rbMFWG[_0x1090e9(0x272)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=rbMFWG[_0x1090e9(0x272)](clone,mock[_0x1090e9(0x349)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG['mEXIf']}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x1090e9(0x161)][_0x1090e9(0x21b)],'expectedAction':_0x1090e9(0xa2)});rbMFWG[_0x1090e9(0xf7)](expect,result)['to'][_0x1090e9(0x160)],rbMFWG['XlNDV'](expect,result[_0x1090e9(0x218)])['to']['be'][_0x1090e9(0x164)];}}),RYHtds[_0x3aaf48(0x1ad)](it,'should\x20verify\x20chain\x20w/\x20multiple\x20controllers',async()=>{const _0x5e9376=_0x3aaf48,bobZcap=await rbMFWG['obINJ'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG['gdMyI'](uuid),'parentCapability':capabilities[_0x5e9376(0x161)][_0x5e9376(0x21b)]['id'],'invocationTarget':capabilities['root'][_0x5e9376(0x21b)][_0x5e9376(0x329)],'expires':EXPIRES_3000_DATE,'controller':['urn:other',bob['id']()]},'parentCapability':capabilities['root'][_0x5e9376(0x21b)],'delegator':alice}),carolZcap=await rbMFWG[_0x5e9376(0x314)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=clone(mock[_0x5e9376(0x349)]),invocation=await rbMFWG[_0x5e9376(0x236)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG[_0x5e9376(0x2a2)]}),result=await rbMFWG[_0x5e9376(0x302)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x5e9376(0x161)][_0x5e9376(0x21b)],'expectedAction':'read'});expect(result)['to'][_0x5e9376(0x160)],expect(result[_0x5e9376(0x218)])['to']['be'][_0x5e9376(0x164)];}),RYHtds[_0x3aaf48(0x108)](it,_0x3aaf48(0x1d5),async()=>{const _0x2fae2d=_0x3aaf48,QLSguK={'FNQkG':WGhyis[_0x2fae2d(0x157)],'qefgu':WGhyis[_0x2fae2d(0x12f)],'lcomF':_0x2fae2d(0x154),'lAMQI':_0x2fae2d(0x277),'onukc':'return\x20await\x20Promise.resolve(42);','iUdwN':function(callee,param1){return WGhyis['xMKyF'](callee,param1);}},bobZcap=await _delegate({'parentCapability':capabilities[_0x2fae2d(0x161)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=WGhyis[_0x2fae2d(0xac)](clone,mock[_0x2fae2d(0x349)]),invocation=await WGhyis[_0x2fae2d(0x3cf)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x351e97=_0x2fae2d,tGRUEL={'NkKqp':QLSguK[_0x351e97(0x1e6)],'ptoNN':function(callee,param1,param2){return callee(param1,param2);}};if(QLSguK[_0x351e97(0x2d0)]!==QLSguK['qefgu']){const YcCeOU={'fcvNA':tGRUEL[_0x351e97(0x22c)]};return tGRUEL[_0x351e97(0x25c)](_0x2b802b,function(){const _0x859c8e=_0x351e97;_0x548037['log'](YcCeOU[_0x859c8e(0x18c)]);},0x64),_0x5683a1[_0x351e97(0x316)](_0x5d6ee6[_0x351e97(0x224)](_0x58364a));}else{const MWYzsO=QLSguK[_0x351e97(0x13c)][_0x351e97(0x35a)]('|');let Fdeqvb=0x0;while(!![]){switch(MWYzsO[Fdeqvb++]){case'0':return{'valid':!![]};case'1':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'2':checkedChain++;continue;case'3':capabilityChain[_0x351e97(0x1f1)][_0x351e97(0x38f)]['length'](0x3);continue;case'4':capabilityChain[_0x351e97(0x1f1)]['be']['an'](QLSguK[_0x351e97(0x27c)]);continue;case'5':new AsyncFunction(QLSguK[_0x351e97(0x1ec)])();continue;case'6':QLSguK['iUdwN'](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;}break;}}},result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x2fae2d(0x161)][_0x2fae2d(0x21b)],'expectedAction':WGhyis[_0x2fae2d(0x128)],'inspectCapabilityChain':inspectCapabilityChain});WGhyis[_0x2fae2d(0x25e)](expect,result)['to']['exist'],WGhyis[_0x2fae2d(0x2ff)](expect,result[_0x2fae2d(0x218)])['to']['be'][_0x2fae2d(0x164)],checkedChain[_0x2fae2d(0x1f1)][_0x2fae2d(0x1b9)](0x1);}),it(RYHtds[_0x3aaf48(0xec)]+_0x3aaf48(0x100),async()=>{const _0xecaaf3=_0x3aaf48,ttl=rbMFWG['cFIuR'](0x3e8,0x3c)*0x3c*0x18,bobZcap=await rbMFWG[_0xecaaf3(0x171)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0xecaaf3(0x161)][_0xecaaf3(0x21b)]['id'],'invocationTarget':capabilities[_0xecaaf3(0x161)]['beta'][_0xecaaf3(0x329)],'expires':new Date(Date[_0xecaaf3(0x3c9)]()+rbMFWG[_0xecaaf3(0x22d)](ttl,0x2))[_0xecaaf3(0x120)]()},'parentCapability':capabilities[_0xecaaf3(0x161)][_0xecaaf3(0x21b)],'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0xecaaf3(0x329)],'expires':bobZcap[_0xecaaf3(0xd2)]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0xecaaf3(0x349)]),invocation=await rbMFWG['CKteT'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG[_0xecaaf3(0x2a2)]});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x26f34f=_0xecaaf3,eIDroR={'nWRri':function(x,y){return WGhyis['PljoV'](x,y);},'tUSpX':_0x26f34f(0x3b7),'YGAlL':_0x26f34f(0x121)};return checkedChain++,capabilityChain['should']['be']['an'](WGhyis[_0x26f34f(0xb8)]),capabilityChain[_0x26f34f(0x1f1)][_0x26f34f(0x38f)][_0x26f34f(0x30b)](0x3),WGhyis[_0x26f34f(0x3cf)](_checkCapabilityChain,{'capabilityChain':capabilityChain}),WGhyis[_0x26f34f(0x294)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),setTimeout(function(){const _0x44e1ef=_0x26f34f;eIDroR['nWRri'](eIDroR[_0x44e1ef(0x308)],_0x44e1ef(0x184))?_0x478227=_0x36106e:console[_0x44e1ef(0x233)](eIDroR[_0x44e1ef(0x230)]);},0x64),{'valid':!![]};},result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':rbMFWG[_0xecaaf3(0x2a2)],'expectedRootCapability':capabilities[_0xecaaf3(0x161)][_0xecaaf3(0x21b)]['id'],'expectedTarget':capabilities[_0xecaaf3(0x161)]['beta']['invocationTarget'],'inspectCapabilityChain':inspectCapabilityChain,'maxDelegationTtl':ttl}});expect(result)['to']['exist'],rbMFWG[_0xecaaf3(0x2bf)](expect,result[_0xecaaf3(0x218)])['to']['be']['true'],checkedChain[_0xecaaf3(0x1f1)]['equal'](0x1);}),RYHtds[_0x3aaf48(0x381)](it,RYHtds[_0x3aaf48(0x2f4)](_0x3aaf48(0x19e),_0x3aaf48(0x2c5)),async()=>{const _0x297330=_0x3aaf48,bobZcap=await _delegate({'parentCapability':capabilities[_0x297330(0x161)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await WGhyis['sapUW'](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=WGhyis[_0x297330(0x2ff)](clone,mock[_0x297330(0x349)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':WGhyis[_0x297330(0x128)]});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x36a9dc=_0x297330,YpFrkl=_0x36a9dc(0x176)[_0x36a9dc(0x35a)]('|');let psQjFb=0x0;while(!![]){switch(YpFrkl[psQjFb++]){case'0':checkedChain++;continue;case'1':capabilityChain[_0x36a9dc(0x1f1)]['be']['an'](WGhyis[_0x36a9dc(0xb8)]);continue;case'2':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'3':should[_0x36a9dc(0x160)](capabilityChain);continue;case'4':_checkCapabilityChain({'capabilityChain':capabilityChain});continue;case'5':capabilityChain[_0x36a9dc(0x1f1)][_0x36a9dc(0x38f)]['length'](0x3);continue;case'6':Function(WGhyis[_0x36a9dc(0x109)])();continue;case'7':return{'error':new Error(_0x36a9dc(0x3c0)+capabilityChain[0x0]['id']+_0x36a9dc(0xa0)),'valid':![]};}break;}},result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities['root']['beta'],'expectedAction':_0x297330(0xa2),'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to']['exist'],expect(result[_0x297330(0x218)])['to']['be'][_0x297330(0x188)],expect(result[_0x297330(0x206)][_0x297330(0xc9)][0x0])['to'][_0x297330(0x160)],result[_0x297330(0x206)]['errors'][0x0][_0x297330(0x19d)][_0x297330(0x1f1)][_0x297330(0x11e)](WGhyis['kIFUQ']),checkedChain['should']['equal'](0x1);});}),describe(_0x429b80(0x2c0),()=>{const _0x54c4f8=_0x429b80,wBCTUB={'gWLVu':function(callee,param1){return callee(param1);},'ghBPg':rbMFWG[_0x54c4f8(0x29b)],'qUhav':rbMFWG['nmYOs'],'SDeCj':rbMFWG[_0x54c4f8(0x2d7)],'AQxIY':'urn:zcap:d3e905ba-6430-11ec-beae-10bf48838a41','OeVql':rbMFWG[_0x54c4f8(0x2a2)],'nDMxS':_0x54c4f8(0x204),'PGamJ':_0x54c4f8(0x170),'zlztw':function(callee){return callee();},'wiDvj':function(callee,param1){return callee(param1);},'GGige':function(callee,param1){const _0x5a677a=_0x54c4f8;return rbMFWG[_0x5a677a(0x29d)](callee,param1);},'lpHZS':'Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date.','WhDzH':function(x,y){return rbMFWG['HuSIq'](x,y);},'wvBIi':function(callee,param1){const _0x1333fe=_0x54c4f8;return rbMFWG[_0x1333fe(0x1d3)](callee,param1);},'jdVlv':function(callee,param1){return callee(param1);},'PcCmV':rbMFWG[_0x54c4f8(0x292)],'poUUJ':function(callee,param1){return callee(param1);},'kYFEA':function(x,y){return x+y;},'yYrgR':function(callee,param1){return callee(param1);},'GHJkl':function(callee,param1){const _0x371f08=_0x54c4f8;return rbMFWG[_0x371f08(0x3a0)](callee,param1);},'svjFu':function(callee){const _0x36b607=_0x54c4f8;return rbMFWG[_0x36b607(0xe9)](callee);},'KkWHy':function(x,y){const _0x3c7414=_0x54c4f8;return rbMFWG[_0x3c7414(0x368)](x,y);},'EzyTT':function(callee){return callee();},'OwOJW':_0x54c4f8(0x361),'mpRST':function(callee){return callee();},'zEtTE':function(callee,param1){const _0x565807=_0x54c4f8;return rbMFWG[_0x565807(0xe4)](callee,param1);},'LRSHa':function(callee,param1){return callee(param1);},'QKYXS':'sYbRT','hMRPQ':function(callee){return callee();},'VuCdC':function(x,y){return x*y;},'cQurA':function(callee,param1){const _0x234bc8=_0x54c4f8;return rbMFWG[_0x234bc8(0x3a2)](callee,param1);},'sWgjE':_0x54c4f8(0x136),'UHieo':function(callee,param1){const _0xd9ee8=_0x54c4f8;return rbMFWG[_0xd9ee8(0x1af)](callee,param1);},'uAzEO':rbMFWG['qYyuI'],'pCJic':_0x54c4f8(0x360),'JMNEu':function(callee){return callee();},'gtTRU':function(callee,param1){return callee(param1);},'Zfmpv':function(callee,param1){return rbMFWG['eQNAt'](callee,param1);},'jJxWd':function(callee,param1){return callee(param1);},'AjWTZ':function(callee,param1){return callee(param1);},'LjyqW':function(callee,param1){return rbMFWG['PbwTR'](callee,param1);},'pbryi':function(callee,param1){return rbMFWG['CreNS'](callee,param1);},'ZtZAE':function(callee,param1){return rbMFWG['eQNAt'](callee,param1);},'biuWN':rbMFWG[_0x54c4f8(0x18d)],'sWKOb':rbMFWG[_0x54c4f8(0xdc)],'QuEsB':function(callee,param1){return callee(param1);},'uXTtG':function(callee){return callee();},'bBsOI':function(x,y){return x+y;},'fawJg':_0x54c4f8(0x1c9),'tWkXt':function(callee,param1){return rbMFWG['XzZqs'](callee,param1);},'Vcfbz':function(callee,param1){const _0x154469=_0x54c4f8;return rbMFWG[_0x154469(0x191)](callee,param1);},'ZFVZy':function(callee,param1){return callee(param1);},'MrdxU':_0x54c4f8(0x10f),'sofNX':function(x,y){const _0x3435bb=_0x54c4f8;return rbMFWG[_0x3435bb(0x271)](x,y);},'JYKDw':'iXjIv','zLnCw':'urn:zcap:a0d0360b-7e93-4c9c-8804-69ca426c60c3','EFhvI':function(callee,param1){return callee(param1);},'BWiTC':function(callee,param1){const _0x2256ec=_0x54c4f8;return rbMFWG[_0x2256ec(0x302)](callee,param1);}};if(rbMFWG['LnZbJ']===rbMFWG[_0x54c4f8(0x37c)])return _0x3dd833++,_0x4cf5c6['should']['be']['an'](_0x54c4f8(0x277)),_0x5b01e9[_0x54c4f8(0x1f1)]['have']['length'](0x3),wBCTUB['gWLVu'](_0x58fa78,{'capabilityChain':_0x57f380}),_0x3b8c98({'capabilityChainMeta':_0x39baec}),new _0x466325(wBCTUB[_0x54c4f8(0x2e5)])(),{'valid':!![]};else rbMFWG[_0x54c4f8(0x242)](it,rbMFWG[_0x54c4f8(0x212)],async()=>{const _0xd33375=_0x54c4f8;let result,err;try{result=new CapabilityInvocation({'expectedTarget':'urn:uuid:1aaec12f-bcf2-40d8-8192-cc4dde9bca96','suite':new Ed25519Signature2020(),'date':'invalid\x20date'});}catch(e){err=e;}should[_0xd33375(0x160)](err),should[_0xd33375(0x376)][_0xd33375(0x160)](result),err[_0xd33375(0x1f1)]['be']['instanceof'](TypeError),err['message']['should'][_0xd33375(0x11e)]('is\x20not\x20a\x20valid\x20date.');}),rbMFWG[_0x54c4f8(0x242)](it,rbMFWG[_0x54c4f8(0x245)],async()=>{const _0x55e67f=_0x54c4f8;let result,err;try{result=new CapabilityDelegation({'expectedRootCapability':wBCTUB[_0x55e67f(0x3b4)],'date':wBCTUB[_0x55e67f(0x331)]});}catch(e){err=e;}should['exist'](err),should[_0x55e67f(0x376)]['exist'](result),err[_0x55e67f(0x1f1)]['be']['instanceof'](TypeError),err[_0x55e67f(0x19d)][_0x55e67f(0x1f1)][_0x55e67f(0x11e)](_0x55e67f(0x287));}),it(rbMFWG['PKdus'],async()=>{const _0x56ebdd=_0x54c4f8,rootCapability={...capabilities['root'][_0x56ebdd(0x21b)]};rootCapability['id']=wBCTUB[_0x56ebdd(0x142)],rootCapability[_0x56ebdd(0xd2)]=new Date()[_0x56ebdd(0x120)](),addToLoader({'doc':rootCapability});const doc=wBCTUB[_0x56ebdd(0x23e)](clone,mock[_0x56ebdd(0x349)]),invocation=await wBCTUB['gWLVu'](_invoke,{'doc':doc,'invoker':alice,'capability':rootCapability,'capabilityAction':wBCTUB[_0x56ebdd(0xab)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':wBCTUB['OeVql']});expect(result)['to']['exist'],expect(result[_0x56ebdd(0x218)])['to']['be']['false'],should[_0x56ebdd(0x160)](result[_0x56ebdd(0x206)]),result[_0x56ebdd(0x206)]['name'][_0x56ebdd(0x1f1)][_0x56ebdd(0x1b9)](wBCTUB[_0x56ebdd(0x1bc)]);const [error]=result[_0x56ebdd(0x206)]['errors'];error['message'][_0x56ebdd(0x1f1)]['contain']('Root\x20capability\x20must\x20not\x20have\x20an\x20\x22expires\x22\x20field.');}),rbMFWG[_0x54c4f8(0x345)](it,'should\x20verify\x20invoking\x20a\x20capability\x20with\x20`expires`',async()=>{const _0x1fbb3b=_0x54c4f8,rootCapability={...capabilities[_0x1fbb3b(0x161)][_0x1fbb3b(0x21b)]};rootCapability['id']=_0x1fbb3b(0x3b9),rbMFWG['etCxD'](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x1fbb3b(0x21a)](rbMFWG['iECOu'](expires['getHours'](),0x1)),expires=expires['toISOString']();const bobZcap=await rbMFWG[_0x1fbb3b(0x332)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability['invocationTarget'],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x1fbb3b(0xe1)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=rbMFWG['yyUxu'](clone,mock[_0x1fbb3b(0x349)]),invocation=await rbMFWG['dCvCT'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG['mEXIf']}),result=await rbMFWG[_0x1fbb3b(0x1ef)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':rbMFWG[_0x1fbb3b(0x2a2)]});rbMFWG[_0x1fbb3b(0x3a2)](expect,result)['to'][_0x1fbb3b(0x160)],expect(result[_0x1fbb3b(0x218)])['to']['be']['true'];}),rbMFWG[_0x54c4f8(0x339)](it,rbMFWG[_0x54c4f8(0x1d7)],async()=>{const _0x1350ec=_0x54c4f8,rootCapability={...capabilities[_0x1350ec(0x161)][_0x1350ec(0x21b)]};rootCapability['id']=rbMFWG['QVuqb'],addToLoader({'doc':rootCapability});let bobZcap,localError;try{bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x1350ec(0xca)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability['invocationTarget'],'expires':_0x1350ec(0x289)},'parentCapability':rootCapability,'delegator':alice});}catch(e){localError=e;}rbMFWG[_0x1350ec(0x31a)](expect,bobZcap)['to'][_0x1350ec(0x376)][_0x1350ec(0x160)],rbMFWG[_0x1350ec(0x131)](expect,localError)['to'][_0x1350ec(0x160)],localError[_0x1350ec(0x19d)]['should'][_0x1350ec(0x11e)](rbMFWG['sQztP']);}),it(rbMFWG['jfUkx'],async()=>{const _0x1ee4ca=_0x54c4f8,rootCapability={...capabilities[_0x1ee4ca(0x161)][_0x1ee4ca(0x21b)]};rootCapability['id']=wBCTUB[_0x1ee4ca(0x151)],addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x1ee4ca(0x146)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x1ee4ca(0x329)],'expires':_0x1ee4ca(0x289)},'purposeOptions':{'parentCapability':rootCapability,'_skipLocalValidationForTesting':!![]},'delegator':alice}),doc=wBCTUB[_0x1ee4ca(0x2f1)](clone,mock['exampleDoc']),invocation=await wBCTUB['GGige'](_invoke,{'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':wBCTUB[_0x1ee4ca(0xab)]}),result=await wBCTUB[_0x1ee4ca(0x23e)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':wBCTUB[_0x1ee4ca(0xab)]});wBCTUB[_0x1ee4ca(0x2f1)](expect,result)['to'][_0x1ee4ca(0x160)],wBCTUB[_0x1ee4ca(0x2f1)](expect,result[_0x1ee4ca(0x218)])['to']['be'][_0x1ee4ca(0x188)],should[_0x1ee4ca(0x160)](result['error']),result[_0x1ee4ca(0x206)][_0x1ee4ca(0x313)][_0x1ee4ca(0x1f1)][_0x1ee4ca(0x1b9)]('VerificationError');const [error]=result[_0x1ee4ca(0x206)][_0x1ee4ca(0xc9)];error[_0x1ee4ca(0x19d)][_0x1ee4ca(0x1f1)][_0x1ee4ca(0x1b9)](wBCTUB['lpHZS']);}),rbMFWG[_0x54c4f8(0x357)](it,rbMFWG['jZptC'](_0x54c4f8(0xc6),rbMFWG['xTTnK']),async()=>{const _0x46ee06=_0x54c4f8,rootCapability={...capabilities[_0x46ee06(0x161)]['beta']};rootCapability['id']=rbMFWG['sTzOe'],addToLoader({'doc':rootCapability});const date=new Date();date[_0x46ee06(0x21a)](date[_0x46ee06(0x2a5)]()-0x14);let expires=new Date();expires[_0x46ee06(0x21a)](expires[_0x46ee06(0x2a5)]()-0xa),expires=expires[_0x46ee06(0x120)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x46ee06(0x398)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x46ee06(0x329)],'expires':expires},'date':date,'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG['Rabyb'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x46ee06(0x329)],'expires':expires},'date':date,'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x46ee06(0x349)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x46ee06(0xa2)}),result=await rbMFWG[_0x46ee06(0x21c)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':'read','expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x46ee06(0x329)],'date':date}});expect(result)['to'][_0x46ee06(0x160)],expect(result['verified'])['to']['be'][_0x46ee06(0x164)];}),it(rbMFWG[_0x54c4f8(0xc4)](_0x54c4f8(0x3ab),rbMFWG[_0x54c4f8(0x3af)]),async()=>{const _0x16490f=_0x54c4f8,rootCapability={...capabilities[_0x16490f(0x161)][_0x16490f(0x21b)]};rootCapability['id']=_0x16490f(0x35e),wBCTUB['wiDvj'](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x16490f(0x21a)](wBCTUB[_0x16490f(0x31e)](expires['getHours'](),0x32)),expires=expires[_0x16490f(0x120)]();const bobZcap=await wBCTUB[_0x16490f(0x2f1)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x16490f(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x16490f(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await wBCTUB[_0x16490f(0x167)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'}),date=new Date();date[_0x16490f(0x21a)](wBCTUB['WhDzH'](date[_0x16490f(0x2a5)](),0x14));const result=await wBCTUB[_0x16490f(0xe3)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':wBCTUB['OeVql'],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x16490f(0x329)],'date':date}});expect(result)['to']['exist'],expect(result[_0x16490f(0x218)])['to']['be'][_0x16490f(0x188)],should[_0x16490f(0x160)](result[_0x16490f(0x206)]),result[_0x16490f(0x206)][_0x16490f(0x313)][_0x16490f(0x1f1)][_0x16490f(0x1b9)](wBCTUB[_0x16490f(0x1bc)]);const [error]=result[_0x16490f(0x206)][_0x16490f(0xc9)];error[_0x16490f(0x19d)]['should'][_0x16490f(0x1b9)]('A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.');}),rbMFWG['igDkN'](it,_0x54c4f8(0x3ab)+_0x54c4f8(0xf9),async()=>{const _0x3d26d5=_0x54c4f8,rootCapability={...capabilities[_0x3d26d5(0x161)][_0x3d26d5(0x21b)]};rootCapability['id']=wBCTUB[_0x3d26d5(0x280)],wBCTUB['poUUJ'](addToLoader,{'doc':rootCapability});let expires=new Date();expires['setHours'](wBCTUB[_0x3d26d5(0x2d8)](expires['getHours'](),0x32)),expires=expires[_0x3d26d5(0x120)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x3d26d5(0x329)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await wBCTUB['yYrgR'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x3d26d5(0x146)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x3d26d5(0x349)]),invocation=await wBCTUB[_0x3d26d5(0xe3)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':wBCTUB['OeVql']}),date=new Date();date[_0x3d26d5(0x21a)](date[_0x3d26d5(0x2a5)]()+0x64);const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':wBCTUB[_0x3d26d5(0xab)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x3d26d5(0x329)],'suite':new Ed25519Signature2020(),'date':date}});expect(result)['to'][_0x3d26d5(0x160)],wBCTUB[_0x3d26d5(0x394)](expect,result[_0x3d26d5(0x218)])['to']['be']['false'],should['exist'](result[_0x3d26d5(0x206)]),result[_0x3d26d5(0x206)][_0x3d26d5(0x313)]['should']['equal'](wBCTUB[_0x3d26d5(0x1bc)]);const [error]=result['error'][_0x3d26d5(0xc9)];error[_0x3d26d5(0x19d)][_0x3d26d5(0x1f1)][_0x3d26d5(0x1b9)](_0x3d26d5(0x1b4));}),rbMFWG[_0x54c4f8(0x339)](it,_0x54c4f8(0x1c0)+'the\x20second\x20capability\x20delegation',async()=>{const _0x55caca=_0x54c4f8,rootCapability={...capabilities[_0x55caca(0x161)][_0x55caca(0x21b)]};rootCapability['id']='urn:zcap:ae96f88e-6b8a-4445-9b4f-03f45c3d1685',addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x55caca(0x21a)](wBCTUB[_0x55caca(0x2d8)](expires[_0x55caca(0x2a5)](),0x1)),expires=expires['toISOString']();const bobZcap=await wBCTUB[_0x55caca(0x23e)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x55caca(0x1c2)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability['invocationTarget'],'expires':expires},'parentCapability':rootCapability,'delegator':alice});let carolZcap,localError;try{wBCTUB[_0x55caca(0x38e)](_0x55caca(0x1d0),'LHEKa')?_0x3c9dcc=new _0x287161({'capability':_0x460025['parentCapability']?_0x4e5069:_0x1c8e6c['id'],'capabilityAction':_0x12d619,'invocationTarget':_0x2181c9[_0x55caca(0x329)]}):carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB['EzyTT'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x55caca(0x329)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to'][_0x55caca(0x160)],localError[_0x55caca(0x313)][_0x55caca(0x1f1)][_0x55caca(0x1b9)](_0x55caca(0x320)),localError['message'][_0x55caca(0x1f1)]['contain'](wBCTUB[_0x55caca(0x36c)]),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x55caca(0x38a)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget']},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=wBCTUB[_0x55caca(0x1fe)](clone,mock[_0x55caca(0x349)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':wBCTUB['OeVql']}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read'});expect(result)['to'][_0x55caca(0x160)],wBCTUB[_0x55caca(0x3c3)](expect,result['verified'])['to']['be']['false'],should[_0x55caca(0x160)](result[_0x55caca(0x206)]),result[_0x55caca(0x206)][_0x55caca(0x313)][_0x55caca(0x1f1)][_0x55caca(0x1b9)](_0x55caca(0x204));const [error]=result['error'][_0x55caca(0xc9)];error[_0x55caca(0x19d)][_0x55caca(0x1f1)]['include'](wBCTUB[_0x55caca(0x36c)]);}),rbMFWG['BfwZN'](it,_0x54c4f8(0x15a)+_0x54c4f8(0xa4),async()=>{const _0xc34dd4=_0x54c4f8,rootCapability={...capabilities['root']['beta']};rootCapability['id']=rbMFWG['mmQsr'],rbMFWG['vzPIm'](addToLoader,{'doc':rootCapability});const date=new Date();let expires=new Date();expires[_0xc34dd4(0x21a)](expires[_0xc34dd4(0x2a5)]()+0x1),expires=expires[_0xc34dd4(0x120)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0xc34dd4(0x106)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0xc34dd4(0x329)],'expires':expires},'date':date,'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0xc34dd4(0x329)],'expires':expires},'date':date,'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});{const beforeDelegation=new Date(date['getTime']()-0x3e8),doc=rbMFWG[_0xc34dd4(0xa3)](clone,mock[_0xc34dd4(0x349)]),invocation=await rbMFWG[_0xc34dd4(0xe4)](_invoke,{'doc':doc,'date':beforeDelegation,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG[_0xc34dd4(0x2a2)]}),result=await rbMFWG[_0xc34dd4(0x336)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':rbMFWG[_0xc34dd4(0x2a2)]});expect(result)['to'][_0xc34dd4(0x160)],rbMFWG['ujiBX'](expect,result[_0xc34dd4(0x218)])['to']['be'][_0xc34dd4(0x164)];}const beforeDelegation=new Date(date['getTime']()-0x12d*0x3e8),doc=clone(mock['exampleDoc']),invocation=await rbMFWG[_0xc34dd4(0x2d2)](_invoke,{'doc':doc,'date':beforeDelegation,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':rbMFWG[_0xc34dd4(0x2a2)]});expect(result)['to'][_0xc34dd4(0x160)],rbMFWG[_0xc34dd4(0x1ef)](expect,result[_0xc34dd4(0x218)])['to']['be']['false'],should[_0xc34dd4(0x160)](result[_0xc34dd4(0x206)]),result['error'][_0xc34dd4(0x313)][_0xc34dd4(0x1f1)]['equal'](rbMFWG[_0xc34dd4(0x172)]);const [error]=result[_0xc34dd4(0x206)][_0xc34dd4(0xc9)];error['message'][_0xc34dd4(0x1f1)][_0xc34dd4(0x1b9)](_0xc34dd4(0x337)+rbMFWG[_0xc34dd4(0x11c)]);}),rbMFWG[_0x54c4f8(0x339)](it,rbMFWG[_0x54c4f8(0x2ca)],async()=>{const _0x20b9e0=_0x54c4f8;if(wBCTUB[_0x20b9e0(0x1a2)]==='liapL')_0x5a98d9[_0x20b9e0(0x233)](_0x20b9e0(0x121));else{const rootCapability={...capabilities[_0x20b9e0(0x161)][_0x20b9e0(0x21b)]};rootCapability['id']=_0x20b9e0(0xd3),wBCTUB[_0x20b9e0(0x3a4)](addToLoader,{'doc':rootCapability});let expires=new Date();expires['setHours'](wBCTUB[_0x20b9e0(0x2d8)](expires[_0x20b9e0(0x2a5)](),0x1)),expires=expires['toISOString']();const bobZcap=await wBCTUB[_0x20b9e0(0x3c3)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x20b9e0(0x356)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x20b9e0(0x329)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),afterExpired=new Date(Date[_0x20b9e0(0x316)](expires)+wBCTUB[_0x20b9e0(0xaa)](0x12d,0x3e8));let carolZcap,localError;try{carolZcap=await wBCTUB[_0x20b9e0(0x33f)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x20b9e0(0x329)],'expires':expires},'date':afterExpired,'parentCapability':bobZcap,'delegator':bob});}catch(e){_0x20b9e0(0x21d)===wBCTUB[_0x20b9e0(0x22f)]?_0x273fc8=_0x253f46:localError=e;}wBCTUB[_0x20b9e0(0x1d9)](expect,localError)['to'][_0x20b9e0(0x160)],localError[_0x20b9e0(0x313)][_0x20b9e0(0x1f1)][_0x20b9e0(0x1b9)](wBCTUB[_0x20b9e0(0xbf)]),localError[_0x20b9e0(0x19d)][_0x20b9e0(0x1f1)][_0x20b9e0(0x11e)](wBCTUB['pCJic']),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x20b9e0(0x329)],'expires':expires},'date':afterExpired,'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=wBCTUB['gWLVu'](clone,mock[_0x20b9e0(0x349)]),invocation=await _invoke({'doc':doc,'date':afterExpired,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x20b9e0(0xa2)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read','purposeOptions':{'date':afterExpired}});wBCTUB[_0x20b9e0(0x2f1)](expect,result)['to'][_0x20b9e0(0x160)],expect(result[_0x20b9e0(0x218)])['to']['be']['false'],should['exist'](result[_0x20b9e0(0x206)]),result[_0x20b9e0(0x206)][_0x20b9e0(0x313)]['should'][_0x20b9e0(0x1b9)]('VerificationError');const [error]=result[_0x20b9e0(0x206)]['errors'];error[_0x20b9e0(0x19d)]['should'][_0x20b9e0(0x1b9)](_0x20b9e0(0x1b4));}}),rbMFWG[_0x54c4f8(0x178)](it,_0x54c4f8(0xfd)+'capability\x20that\x20expires\x20on\x20the\x20Unix\x20epoch',async()=>{const _0x43bf3e=_0x54c4f8,rootCapability={...capabilities['root']['beta']};rootCapability['id']=_0x43bf3e(0x2ae),wBCTUB[_0x43bf3e(0x2f1)](addToLoader,{'doc':rootCapability});let expires=new Date(0x0);expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x43bf3e(0x39b)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x43bf3e(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await wBCTUB[_0x43bf3e(0x33f)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x43bf3e(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x43bf3e(0x349)]),invocation=await wBCTUB[_0x43bf3e(0x248)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':wBCTUB[_0x43bf3e(0xab)]}),result=await wBCTUB[_0x43bf3e(0x248)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x43bf3e(0xa2)});expect(result)['to'][_0x43bf3e(0x160)],expect(result[_0x43bf3e(0x218)])['to']['be']['false'],should['exist'](result['error']),result[_0x43bf3e(0x206)]['errors'][_0x43bf3e(0x1f1)][_0x43bf3e(0x38f)][_0x43bf3e(0x30b)](0x1);const [error]=result[_0x43bf3e(0x206)][_0x43bf3e(0xc9)];error[_0x43bf3e(0x19d)][_0x43bf3e(0x1f1)][_0x43bf3e(0x1b9)](_0x43bf3e(0x1b4));}),rbMFWG[_0x54c4f8(0x186)](it,rbMFWG[_0x54c4f8(0xc4)](_0x54c4f8(0x1db),rbMFWG[_0x54c4f8(0x27a)]),async()=>{const _0x15b3e6=_0x54c4f8,rootCapability={...capabilities['root'][_0x15b3e6(0x21b)]};rootCapability['id']=_0x15b3e6(0xb7),wBCTUB['yYrgR'](addToLoader,{'doc':rootCapability});let expires=new Date();expires['setHours'](expires[_0x15b3e6(0x2a5)]()+0xa),expires=expires[_0x15b3e6(0x120)]();const bobZcap=await wBCTUB[_0x15b3e6(0x258)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x15b3e6(0x329)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x15b3e6(0x21a)](expires[_0x15b3e6(0x2a5)]()-0xa),expires=expires[_0x15b3e6(0x120)]();const carolZcap=await wBCTUB[_0x15b3e6(0x1e5)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x15b3e6(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=wBCTUB[_0x15b3e6(0x28a)](clone,mock[_0x15b3e6(0x349)]),invocation=await wBCTUB['LjyqW'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':wBCTUB[_0x15b3e6(0xab)]}),result=await wBCTUB[_0x15b3e6(0x1d1)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':wBCTUB['OeVql']});wBCTUB[_0x15b3e6(0x286)](expect,result)['to'][_0x15b3e6(0x160)],expect(result[_0x15b3e6(0x218)])['to']['be'][_0x15b3e6(0x188)],should[_0x15b3e6(0x160)](result[_0x15b3e6(0x206)]),result[_0x15b3e6(0x206)][_0x15b3e6(0x313)][_0x15b3e6(0x1f1)][_0x15b3e6(0x1b9)](wBCTUB[_0x15b3e6(0x1bc)]);const [error]=result[_0x15b3e6(0x206)][_0x15b3e6(0xc9)];error[_0x15b3e6(0x19d)]['should'][_0x15b3e6(0x1b9)](wBCTUB[_0x15b3e6(0xb5)]);}),it(rbMFWG[_0x54c4f8(0x2b2)]+rbMFWG['ZEtCz'],async()=>{const _0x301535=_0x54c4f8,rootCapability={...capabilities[_0x301535(0x161)][_0x301535(0x21b)]};rootCapability['id']=rbMFWG[_0x301535(0x17f)],rbMFWG[_0x301535(0x29d)](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x301535(0x21a)](rbMFWG[_0x301535(0x28b)](expires['getHours'](),0xa)),expires=expires[_0x301535(0x120)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x301535(0xa9)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x301535(0x329)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(0x0),expires=expires[_0x301535(0x120)]();const carolZcap=await rbMFWG[_0x301535(0x3c4)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x301535(0xe1)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x301535(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=rbMFWG[_0x301535(0x3c4)](clone,mock[_0x301535(0x349)]),invocation=await rbMFWG[_0x301535(0x1d3)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG[_0x301535(0x2a2)]}),result=await rbMFWG[_0x301535(0x276)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':rbMFWG[_0x301535(0x2a2)]});rbMFWG['ggvYh'](expect,result)['to'][_0x301535(0x160)],expect(result[_0x301535(0x218)])['to']['be'][_0x301535(0x188)],should[_0x301535(0x160)](result[_0x301535(0x206)]),result[_0x301535(0x206)][_0x301535(0xc9)][_0x301535(0x1f1)][_0x301535(0x38f)][_0x301535(0x30b)](0x1);const [error]=result[_0x301535(0x206)][_0x301535(0xc9)];error['message'][_0x301535(0x1f1)][_0x301535(0x11e)](_0x301535(0x174));}),it(_0x54c4f8(0xfd)+rbMFWG[_0x54c4f8(0x3d2)],async()=>{const _0x527d3c=_0x54c4f8,rootCapability={...capabilities[_0x527d3c(0x161)][_0x527d3c(0x21b)]};rootCapability['id']=wBCTUB['sWKOb'],addToLoader({'doc':rootCapability});let expires=new Date();expires['setHours'](expires[_0x527d3c(0x2a5)]()+0xa),expires=expires['toISOString']();const bobZcap=await wBCTUB[_0x527d3c(0xdb)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB['uXTtG'](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability['invocationTarget'],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x527d3c(0x21a)](expires[_0x527d3c(0x2a5)]()+0x64),expires=expires[_0x527d3c(0x120)]();let carolZcap,localError;try{carolZcap=await wBCTUB[_0x527d3c(0x248)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x527d3c(0x329)],'expires':expires},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to'][_0x527d3c(0x160)],localError[_0x527d3c(0x313)][_0x527d3c(0x1f1)][_0x527d3c(0x1b9)](_0x527d3c(0x320)),localError['message'][_0x527d3c(0x1f1)][_0x527d3c(0x1b9)](wBCTUB['bBsOI'](_0x527d3c(0x250)+wBCTUB['fawJg'],_0x527d3c(0xef))),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x527d3c(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=wBCTUB[_0x527d3c(0xcd)](clone,mock[_0x527d3c(0x349)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x527d3c(0xa2)}),result=await wBCTUB[_0x527d3c(0x122)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x527d3c(0xa2)});wBCTUB[_0x527d3c(0xe3)](expect,result)['to']['exist'],wBCTUB[_0x527d3c(0xfa)](expect,result['verified'])['to']['be'][_0x527d3c(0x188)],should[_0x527d3c(0x160)](result[_0x527d3c(0x206)]),result[_0x527d3c(0x206)][_0x527d3c(0x313)][_0x527d3c(0x1f1)][_0x527d3c(0x1b9)](_0x527d3c(0x204));const [error]=result[_0x527d3c(0x206)][_0x527d3c(0xc9)];error[_0x527d3c(0x19d)][_0x527d3c(0x1f1)][_0x527d3c(0x11e)](wBCTUB[_0x527d3c(0x362)]);}),it(rbMFWG[_0x54c4f8(0x168)](rbMFWG[_0x54c4f8(0x355)],_0x54c4f8(0x27f)),async()=>{const _0x4ea442=_0x54c4f8;if(wBCTUB[_0x4ea442(0x1ca)](wBCTUB[_0x4ea442(0x133)],_0x4ea442(0x209)))_0x4a8fa8[_0x4ea442(0x224)]({'safe':!![]});else{const rootCapability={...capabilities['root']['beta']};rootCapability['id']=wBCTUB[_0x4ea442(0x348)],addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice});let expires=new Date();expires[_0x4ea442(0x21a)](expires[_0x4ea442(0x2a5)]()+0xa),expires=expires[_0x4ea442(0x120)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':wBCTUB[_0x4ea442(0x146)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x4ea442(0x329)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await wBCTUB['wiDvj'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':wBCTUB[_0x4ea442(0xab)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read'});wBCTUB['EFhvI'](expect,result)['to'][_0x4ea442(0x160)],wBCTUB[_0x4ea442(0x1c3)](expect,result[_0x4ea442(0x218)])['to']['be'][_0x4ea442(0x164)];}}),it(_0x54c4f8(0x195)+_0x54c4f8(0x27f),async()=>{const _0x511919=_0x54c4f8,rootCapability={...capabilities[_0x511919(0x161)][_0x511919(0x21b)]};rootCapability['id']=rbMFWG['jHSzp'],addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice});let expires=new Date();expires[_0x511919(0x21a)](rbMFWG[_0x511919(0x18f)](expires[_0x511919(0x2a5)](),0xa)),expires=expires[_0x511919(0x120)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x511919(0x398)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x511919(0x329)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x511919(0x349)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG[_0x511919(0x2a2)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':rbMFWG[_0x511919(0x2a2)]});rbMFWG[_0x511919(0x222)](expect,result)['to'][_0x511919(0x160)],expect(result[_0x511919(0x218)])['to']['be'][_0x511919(0x188)],should[_0x511919(0x160)](result[_0x511919(0x206)]),result[_0x511919(0x206)][_0x511919(0x313)]['should'][_0x511919(0x1b9)](rbMFWG[_0x511919(0x172)]);const [error]=result[_0x511919(0x206)][_0x511919(0xc9)];error[_0x511919(0x19d)][_0x511919(0x1f1)][_0x511919(0x1b9)](rbMFWG[_0x511919(0x18d)]);});}),describe(_0x429b80(0xee),()=>{const _0x2cf852=_0x429b80,rAUDcF={'STJNl':function(callee,param1){const _0x2b7aa6=_0x5e06;return rbMFWG[_0x2b7aa6(0x1c8)](callee,param1);}};rbMFWG[_0x2cf852(0x2e4)](it,'should\x20verify\x20chain',async()=>{const _0xac8d4e=_0x2cf852,bobZcap=await _delegate({'parentCapability':capabilities[_0xac8d4e(0x161)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await rAUDcF[_0xac8d4e(0x182)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await _delegate({'parentCapability':carolZcap,'controller':diana,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':capabilities['root']['beta']['id']});rAUDcF[_0xac8d4e(0x182)](expect,result)['to'][_0xac8d4e(0x160)],rAUDcF[_0xac8d4e(0x182)](expect,result['verified'])['to']['be'][_0xac8d4e(0x164)];}),rbMFWG[_0x2cf852(0x2d9)](it,'should\x20verify\x20chain\x20w/inspectCapabilityChain',async()=>{const _0x543aa3=_0x2cf852,FIgakq={'AaKRX':_0x543aa3(0x277),'shiWQ':function(callee,param1,param2){return callee(param1,param2);},'CAPjI':_0x543aa3(0x2ce)},bobZcap=await rbMFWG[_0x543aa3(0x1a7)](_delegate,{'parentCapability':capabilities[_0x543aa3(0x161)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await rbMFWG['oBKDh'](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x139da3=_0x543aa3;return checkedChain++,capabilityChain[_0x139da3(0x1f1)]['be']['an'](_0x139da3(0x277)),capabilityChain[_0x139da3(0x1f1)][_0x139da3(0x38f)][_0x139da3(0x30b)](0x4),capabilityChainMeta[_0x139da3(0x1f1)]['be']['an'](FIgakq[_0x139da3(0x1f0)]),capabilityChainMeta[_0x139da3(0x1f1)][_0x139da3(0x38f)]['length'](0x4),_checkCapabilityChain({'capabilityChain':capabilityChain}),_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta}),FIgakq['shiWQ'](setTimeout,FIgakq[_0x139da3(0x3aa)],0x3e8),{'valid':!![]};},result=await rbMFWG[_0x543aa3(0x3a0)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x543aa3(0x161)][_0x543aa3(0x21b)]['id'],'inspectCapabilityChain':inspectCapabilityChain});rbMFWG[_0x543aa3(0xe8)](expect,result)['to'][_0x543aa3(0x160)],rbMFWG[_0x543aa3(0xdd)](expect,result['verified'])['to']['be']['true'],checkedChain['should'][_0x543aa3(0x1b9)](0x1);}),it(rbMFWG[_0x2cf852(0x367)],async()=>{const _0x283d4e=_0x2cf852,bobZcap=await rbMFWG[_0x283d4e(0x2d3)](_delegate,{'parentCapability':capabilities[_0x283d4e(0x161)][_0x283d4e(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await rbMFWG[_0x283d4e(0x240)](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol,'purposeOptions':{'_skipLocalValidationForTesting':!![],'_capabilityChain':[capabilities[_0x283d4e(0x161)][_0x283d4e(0x21b)]['id'],bobZcap,carolZcap]}}),result=await rbMFWG[_0x283d4e(0x21c)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x283d4e(0x161)]['beta']['id']});rbMFWG[_0x283d4e(0x2b0)](expect,result)['to']['exist'],rbMFWG[_0x283d4e(0x311)](expect,result[_0x283d4e(0x218)])['to']['be']['false'],should['exist'](result[_0x283d4e(0x206)]),result[_0x283d4e(0x206)]['name'][_0x283d4e(0x1f1)][_0x283d4e(0x1b9)](_0x283d4e(0x204)),should[_0x283d4e(0x160)](result[_0x283d4e(0x206)][_0x283d4e(0xc9)]);const [error]=result[_0x283d4e(0x206)][_0x283d4e(0xc9)];error[_0x283d4e(0x19d)][_0x283d4e(0x1f1)][_0x283d4e(0x11e)]('consist\x20of\x20strings\x20of\x20capability\x20IDs');}),it(rbMFWG[_0x2cf852(0xf0)],async()=>{const _0x4fd342=_0x2cf852,yeaRXA={'tqOrH':_0x4fd342(0x277),'vPClv':function(callee,param1){const _0x2d36c8=_0x4fd342;return rbMFWG[_0x2d36c8(0x363)](callee,param1);},'YNPCM':function(callee,param1){return callee(param1);}};if(_0x4fd342(0xb1)!==_0x4fd342(0xb1))_0x3c909c=new _0x2caf1f(_0x2be147);else{const bobZcap=await _delegate({'parentCapability':capabilities[_0x4fd342(0x161)][_0x4fd342(0x21b)],'controller':bob,'delegator':alice}),carolZcap=await rbMFWG[_0x4fd342(0x332)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await _delegate({'parentCapability':carolZcap,'controller':diana,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x130528=_0x4fd342,zewjTN=_0x130528(0x3c8)['split']('|');let GvRhUe=0x0;while(!![]){switch(zewjTN[GvRhUe++]){case'0':capabilityChain[_0x130528(0x1f1)]['be']['an'](yeaRXA[_0x130528(0x3bf)]);continue;case'1':capabilityChainMeta[_0x130528(0x1f1)]['be']['an']('array');continue;case'2':yeaRXA[_0x130528(0x3a7)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'3':setInterval(_0x130528(0x17b),0x3e8);continue;case'4':return{'valid':!![]};case'5':yeaRXA['YNPCM'](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta});continue;case'6':checkedChain++;continue;case'7':capabilityChainMeta[_0x130528(0x1f1)]['have'][_0x130528(0x30b)](0x4);continue;case'8':capabilityChain['should'][_0x130528(0x38f)][_0x130528(0x30b)](0x4);continue;}break;}},result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x4fd342(0x161)][_0x4fd342(0x21b)]['id'],'purposeOptions':{'inspectCapabilityChain':inspectCapabilityChain,'maxChainLength':0x2}});rbMFWG['ujiBX'](expect,result)['to']['exist'],rbMFWG['ZETps'](expect,result[_0x4fd342(0x218)])['to']['be'][_0x4fd342(0x188)],should[_0x4fd342(0x160)](result[_0x4fd342(0x206)]),should[_0x4fd342(0x160)](result[_0x4fd342(0x206)][_0x4fd342(0xc9)]),result[_0x4fd342(0x206)]['errors']['should'][_0x4fd342(0x38f)][_0x4fd342(0x30b)](0x1),result[_0x4fd342(0x206)][_0x4fd342(0xc9)][0x0]['message'][_0x4fd342(0x1f1)][_0x4fd342(0x1b9)]('The\x20capability\x20chain\x20exceeds\x20the\x20maximum\x20allowed\x20length\x20of\x202.'),checkedChain[_0x4fd342(0x1f1)][_0x4fd342(0x1b9)](0x0);}});}),RYHtds['NqsIr'](describe,RYHtds[_0x429b80(0x358)],()=>{const _0x4ab49a=_0x429b80,UlWvYX={'xSStv':rbMFWG[_0x4ab49a(0x1f2)],'dJqHE':function(callee,param1){const _0x3d8070=_0x4ab49a;return rbMFWG[_0x3d8070(0x12d)](callee,param1);},'bUzun':function(callee,param1){const _0x413b81=_0x4ab49a;return rbMFWG[_0x413b81(0x2d3)](callee,param1);},'PWZmn':function(callee,param1){return callee(param1);},'PhfWY':function(x,y){return x!==y;},'FNjQk':rbMFWG[_0x4ab49a(0x1b6)],'AlryT':rbMFWG[_0x4ab49a(0xc3)],'aSffU':function(callee,param1){return callee(param1);},'DkWJO':function(callee,param1){const _0x528e91=_0x4ab49a;return rbMFWG[_0x528e91(0x3c5)](callee,param1);},'EkVFs':function(callee,param1){return callee(param1);},'ZkjIA':function(callee,param1){const _0x57979c=_0x4ab49a;return rbMFWG[_0x57979c(0x222)](callee,param1);},'ZPPDN':function(callee,param1){return rbMFWG['nOfLl'](callee,param1);},'eFfHj':function(callee){return callee();},'rgIYJ':function(callee,param1){const _0x41d985=_0x4ab49a;return rbMFWG[_0x41d985(0x162)](callee,param1);},'UEFnu':function(callee,param1){return rbMFWG['mDMIq'](callee,param1);},'RISkw':rbMFWG[_0x4ab49a(0x216)],'uzZWJ':function(callee,param1){const _0x1f2e5a=_0x4ab49a;return rbMFWG[_0x1f2e5a(0x199)](callee,param1);},'bDMVW':function(callee,param1){return callee(param1);},'XBBSs':function(callee,param1){return callee(param1);},'qalXQ':rbMFWG[_0x4ab49a(0x2a2)],'YNiWF':function(callee,param1){return rbMFWG['vxhoY'](callee,param1);},'aKXrY':function(callee,param1){const _0x45b740=_0x4ab49a;return rbMFWG[_0x45b740(0x237)](callee,param1);},'SfiCn':function(callee,param1){return rbMFWG['yyUxu'](callee,param1);},'hVZNG':function(callee,param1){return callee(param1);},'fMFmr':function(callee){return callee();},'OyzGO':function(callee,param1){return callee(param1);},'SMGhu':function(callee){return rbMFWG['YPSlH'](callee);},'YLVPo':function(callee,param1){return callee(param1);},'dBoSZ':function(callee,param1){return callee(param1);},'JOiED':function(callee,param1){return callee(param1);},'otGmo':function(callee,param1){const _0x2ce8eb=_0x4ab49a;return rbMFWG[_0x2ce8eb(0x116)](callee,param1);},'tWPmm':function(callee,param1){const _0x24ed32=_0x4ab49a;return rbMFWG[_0x24ed32(0x1a7)](callee,param1);},'TpiCA':function(x,y){return x+y;},'icefI':_0x4ab49a(0x270),'suphQ':function(callee,param1,param2){return callee(param1,param2);}};it(rbMFWG[_0x4ab49a(0x22b)],async()=>{const _0x381802=_0x4ab49a,rootTarget=_0x381802(0x3be),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await rbMFWG[_0x381802(0x29d)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x381802(0x329)]+_0x381802(0x2aa),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x381802(0x398)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await rbMFWG['rUcNI'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});rbMFWG[_0x381802(0xad)](expect,result)['to'][_0x381802(0x160)],expect(result[_0x381802(0x218)])['to']['be'][_0x381802(0x164)];}),it(rbMFWG[_0x4ab49a(0x303)],async()=>{const _0x14d8f9=_0x4ab49a,rootTarget=UlWvYX['xSStv'],rootCapability=UlWvYX[_0x14d8f9(0x1f9)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});UlWvYX[_0x14d8f9(0xbd)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await UlWvYX['PWZmn'](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap['invocationTarget']+_0x14d8f9(0x228),dianaZcap=await UlWvYX[_0x14d8f9(0x2c8)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});UlWvYX[_0x14d8f9(0x1f9)](expect,result)['to'][_0x14d8f9(0x160)],expect(result[_0x14d8f9(0x218)])['to']['be'][_0x14d8f9(0x164)];}),it(rbMFWG['gAoHq'],async()=>{const _0x18479e=_0x4ab49a;if(UlWvYX['PhfWY'](UlWvYX[_0x18479e(0xb9)],UlWvYX[_0x18479e(0x2d4)])){const rootTarget=_0x18479e(0x16c),rootCapability=UlWvYX[_0x18479e(0x1ab)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});UlWvYX['DkWJO'](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap['invocationTarget']+'/a-specific-document?foo=bar',dianaZcap=await UlWvYX[_0x18479e(0x226)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});UlWvYX['ZkjIA'](expect,result)['to'][_0x18479e(0x160)],expect(result[_0x18479e(0x218)])['to']['be']['true'];}else _0x72cdc8=new _0x39d9d5({'suite':new _0x2ad6a5(),..._0x31bd07});}),rbMFWG[_0x4ab49a(0x165)](it,rbMFWG[_0x4ab49a(0xaf)](rbMFWG['wBAxp'],_0x4ab49a(0x2af)),async()=>{const _0x4f4a11=_0x4ab49a,rootTarget=_0x4f4a11(0x30e),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});UlWvYX[_0x4f4a11(0x1ab)](addToLoader,{'doc':rootCapability});const bobZcap=await UlWvYX[_0x4f4a11(0xbd)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+'/a-specific-document',carolZcap=await UlWvYX[_0x4f4a11(0x22e)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':UlWvYX[_0x4f4a11(0x13e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await UlWvYX[_0x4f4a11(0x23b)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});UlWvYX[_0x4f4a11(0x17c)](expect,result)['to'][_0x4f4a11(0x160)],UlWvYX[_0x4f4a11(0x169)](expect,result[_0x4f4a11(0x218)])['to']['be'][_0x4f4a11(0x188)],result[_0x4f4a11(0x206)][_0x4f4a11(0xc9)][_0x4f4a11(0x1f1)]['have'][_0x4f4a11(0x30b)](0x1);const [error]=result[_0x4f4a11(0x206)][_0x4f4a11(0xc9)];error[_0x4f4a11(0x19d)][_0x4f4a11(0x1f1)][_0x4f4a11(0x158)](_0x4f4a11(0x10f));}),rbMFWG[_0x4ab49a(0x339)](it,rbMFWG['qhQqJ'](_0x4ab49a(0x2e2),'permissive\x20than\x20the\x20parent\x20capability\x20w/query'),async()=>{const _0x4554f5=_0x4ab49a;if(rbMFWG[_0x4554f5(0x368)](_0x4554f5(0x2c6),'kQLjW')){let _0x1ef0ea,_0x143b3b;try{_0x1ef0ea=new _0x59cae8({'expectedTarget':_0x4554f5(0x347),'suite':new _0x5d5f2c(),'date':_0x4554f5(0x2b8)});}catch(_0x466257){_0x143b3b=_0x466257;}_0x2afa40[_0x4554f5(0x160)](_0x143b3b),_0x5347a9[_0x4554f5(0x376)]['exist'](_0x1ef0ea),_0x143b3b[_0x4554f5(0x1f1)]['be']['instanceof'](_0x4fe382),_0x143b3b[_0x4554f5(0x19d)][_0x4554f5(0x1f1)][_0x4554f5(0x11e)](UlWvYX[_0x4554f5(0x2df)]);}else{const rootTarget=_0x4554f5(0xd5),rootCapability=rbMFWG['hWGov'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x4554f5(0x329)]+'?foo=bar',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x4554f5(0x30f)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap[_0x4554f5(0x329)],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x4554f5(0x160)],rbMFWG[_0x4554f5(0x31f)](expect,result[_0x4554f5(0x218)])['to']['be'][_0x4554f5(0x188)],result[_0x4554f5(0x206)]['errors'][_0x4554f5(0x1f1)]['have']['length'](0x1);const [error]=result[_0x4554f5(0x206)][_0x4554f5(0xc9)];error[_0x4554f5(0x19d)][_0x4554f5(0x1f1)][_0x4554f5(0x158)](rbMFWG['YMTPh']);}}),rbMFWG[_0x4ab49a(0x345)](it,_0x4ab49a(0x24a)+'w/path',async()=>{const _0x564776=_0x4ab49a,rootTarget=_0x564776(0x30a)+rbMFWG[_0x564776(0x39c)](uuid),rootCapability=rbMFWG[_0x564776(0x3a6)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});rbMFWG[_0x564776(0x1c8)](addToLoader,{'doc':rootCapability});const bobZcap=await rbMFWG['XzZqs'](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+'/a-specific-document',carolZcap=await rbMFWG[_0x564776(0x171)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=rbMFWG[_0x564776(0x255)](clone,mock[_0x564776(0x349)]),invocation=await rbMFWG[_0x564776(0x103)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':rbMFWG[_0x564776(0x2a2)]}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':rbMFWG[_0x564776(0x2a2)],'expectedTarget':[rootTarget,invocationTarget],'expectedRootCapability':rootCapability['id']}});rbMFWG[_0x564776(0x1c8)](expect,result)['to'][_0x564776(0x160)],rbMFWG[_0x564776(0x171)](expect,result['verified'])['to']['be'][_0x564776(0x164)];}),rbMFWG['Epxuy'](it,rbMFWG[_0x4ab49a(0x283)](_0x4ab49a(0x24a),'w/query'),async()=>{const _0x177253=_0x4ab49a,rootTarget=_0x177253(0x30a)+uuid(),rootCapability=UlWvYX['uzZWJ'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x177253(0x329)]+_0x177253(0x228),carolZcap=await UlWvYX[_0x177253(0x2b4)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x177253(0x349)]),invocation=await UlWvYX['XBBSs'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x177253(0xa2)}),result=await UlWvYX[_0x177253(0x1e3)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':UlWvYX[_0x177253(0x2eb)],'expectedTarget':[rootTarget,invocationTarget],'expectedRootCapability':rootCapability['id']}});UlWvYX[_0x177253(0x16d)](expect,result)['to'][_0x177253(0x160)],UlWvYX[_0x177253(0x3ae)](expect,result['verified'])['to']['be']['true'];}),rbMFWG[_0x4ab49a(0x345)](it,rbMFWG['AvJCl']+_0x4ab49a(0x282),async()=>{const _0x4f3f7a=_0x4ab49a,rootTarget=_0x4f3f7a(0x30a)+uuid(),rootCapability=rbMFWG[_0x4f3f7a(0x180)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await rbMFWG[_0x4f3f7a(0x254)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x4f3f7a(0x329)]+_0x4f3f7a(0x2aa),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=rbMFWG[_0x4f3f7a(0x16a)](clone,mock['exampleDoc']),invalidTarget=rootTarget+_0x4f3f7a(0xbb),invocation=await rbMFWG[_0x4f3f7a(0x321)](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':'read','invocationTarget':invalidTarget}}),expectedTarget=[rootTarget,invocationTarget],purpose=new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':_0x4f3f7a(0xa2),'expectedTarget':expectedTarget,'expectedRootCapability':rootCapability['id'],'suite':new Ed25519Signature2020()});purpose[_0x4f3f7a(0x301)]=()=>!![];const result=await jsigs[_0x4f3f7a(0x366)](invocation,{'suite':new Ed25519Signature2020(),'purpose':purpose,'documentLoader':testLoader});expect(result)['to'][_0x4f3f7a(0x160)],expect(result[_0x4f3f7a(0x218)])['to']['be'][_0x4f3f7a(0x188)],result[_0x4f3f7a(0x206)]['errors'][_0x4f3f7a(0x1f1)][_0x4f3f7a(0x38f)][_0x4f3f7a(0x30b)](0x1);const [error]=result[_0x4f3f7a(0x206)][_0x4f3f7a(0xc9)];error['message'][_0x4f3f7a(0x1f1)][_0x4f3f7a(0x158)](rbMFWG[_0x4f3f7a(0x9f)](_0x4f3f7a(0x143)+invalidTarget+_0x4f3f7a(0x11f),'target\x20('+carolZcap['invocationTarget']+').'));}),rbMFWG[_0x4ab49a(0x357)](it,rbMFWG[_0x4ab49a(0x283)](_0x4ab49a(0x14f),_0x4ab49a(0x34a)),async()=>{const _0x2fac69=_0x4ab49a,rootTarget=_0x2fac69(0x30a)+uuid(),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});UlWvYX['bDMVW'](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x2fac69(0x329)]+_0x2fac69(0x228),carolZcap=await UlWvYX['SfiCn'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':UlWvYX[_0x2fac69(0x13e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=UlWvYX[_0x2fac69(0x31d)](clone,mock[_0x2fac69(0x349)]),invalidTarget=rootTarget+_0x2fac69(0xde),invocation=await UlWvYX[_0x2fac69(0x1f9)](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x2fac69(0xa2),'invocationTarget':invalidTarget}}),expectedTarget=[rootTarget,invocationTarget],purpose=new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':UlWvYX['qalXQ'],'expectedTarget':expectedTarget,'expectedRootCapability':rootCapability['id'],'suite':new Ed25519Signature2020()});purpose[_0x2fac69(0x301)]=()=>!![];const result=await jsigs[_0x2fac69(0x366)](invocation,{'suite':new Ed25519Signature2020(),'purpose':purpose,'documentLoader':testLoader});UlWvYX[_0x2fac69(0x23b)](expect,result)['to'][_0x2fac69(0x160)],UlWvYX[_0x2fac69(0x3ae)](expect,result['verified'])['to']['be'][_0x2fac69(0x188)],result['error'][_0x2fac69(0xc9)][_0x2fac69(0x1f1)][_0x2fac69(0x38f)]['length'](0x1);const [error]=result['error'][_0x2fac69(0xc9)];error[_0x2fac69(0x19d)][_0x2fac69(0x1f1)]['include'](_0x2fac69(0x143)+invalidTarget+')\x20does\x20not\x20match\x20capability\x20'+(_0x2fac69(0x3bd)+carolZcap[_0x2fac69(0x329)]+').'));}),rbMFWG[_0x4ab49a(0x107)](it,_0x4ab49a(0xba)+'w/path',async()=>{const _0x404e22=_0x4ab49a,rootTarget=_0x404e22(0x30a)+uuid(),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+'/a-specific-document',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':UlWvYX[_0x404e22(0x3a8)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),validSubTarget=carolZcap[_0x404e22(0x329)]+'/sub-path',invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':UlWvYX[_0x404e22(0x2eb)],'invocationTarget':validSubTarget}}),result=await UlWvYX[_0x404e22(0x346)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':UlWvYX['qalXQ'],'expectedTarget':[rootTarget,validSubTarget],'expectedRootCapability':rootCapability['id']}});UlWvYX['OyzGO'](expect,result)['to']['exist'],UlWvYX[_0x404e22(0x23b)](expect,result[_0x404e22(0x218)])['to']['be']['true'];}),rbMFWG['gngBh'](it,rbMFWG[_0x4ab49a(0x2c9)]+_0x4ab49a(0x208),async()=>{const _0x35b3c4=_0x4ab49a;if(rbMFWG[_0x35b3c4(0x24d)]===_0x35b3c4(0x2f3))_0x5b3d6b=_0x280530;else{const rootTarget=_0x35b3c4(0x30a)+uuid(),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await rbMFWG[_0x35b3c4(0x2e7)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x35b3c4(0x329)]+_0x35b3c4(0x228),carolZcap=await rbMFWG[_0x35b3c4(0x203)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=rbMFWG['eQNAt'](clone,mock[_0x35b3c4(0x349)]),validSubTarget=carolZcap[_0x35b3c4(0x329)]+'&baz=fuzz',invocation=await rbMFWG[_0x35b3c4(0x3c5)](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':rbMFWG[_0x35b3c4(0x2a2)],'invocationTarget':validSubTarget}}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':rbMFWG[_0x35b3c4(0x2a2)],'expectedTarget':[rootTarget,validSubTarget],'expectedRootCapability':rootCapability['id']}});rbMFWG[_0x35b3c4(0x35c)](expect,result)['to']['exist'],expect(result[_0x35b3c4(0x218)])['to']['be'][_0x35b3c4(0x164)];}}),rbMFWG[_0x4ab49a(0x36d)](it,rbMFWG[_0x4ab49a(0x118)](rbMFWG[_0x4ab49a(0x3d3)],rbMFWG['DUCDK']),async()=>{const _0x36defe=_0x4ab49a,rootTarget='https://example.com/edvs/'+uuid(),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await rbMFWG['vzPIm'](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+_0x36defe(0x2aa),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=rbMFWG[_0x36defe(0x207)](clone,mock[_0x36defe(0x349)]),invalidTarget=rootTarget+_0x36defe(0xbb),invocation=await rbMFWG['pjNMw'](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':'read','invocationTarget':invalidTarget}}),result=await rbMFWG[_0x36defe(0x11d)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':_0x36defe(0xa2),'expectedTarget':[rootTarget,invalidTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to']['exist'],expect(result[_0x36defe(0x218)])['to']['be'][_0x36defe(0x188)],result['error'][_0x36defe(0xc9)]['should'][_0x36defe(0x38f)][_0x36defe(0x30b)](0x1);const [error]=result[_0x36defe(0x206)]['errors'];error['message'][_0x36defe(0x1f1)][_0x36defe(0x158)](rbMFWG['rTVEh']('Invocation\x20target\x20('+invalidTarget+_0x36defe(0x11f),'target\x20('+carolZcap[_0x36defe(0x329)]+')'));}),rbMFWG[_0x4ab49a(0xe0)](it,rbMFWG[_0x4ab49a(0xeb)](_0x4ab49a(0x145),'target\x20w/query'),async()=>{const _0x318afb=_0x4ab49a,rootTarget=_0x318afb(0x30a)+UlWvYX[_0x318afb(0x36e)](uuid),rootCapability=UlWvYX['YLVPo'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});UlWvYX[_0x318afb(0x15e)](addToLoader,{'doc':rootCapability});const bobZcap=await UlWvYX[_0x318afb(0x2ea)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x318afb(0x329)]+_0x318afb(0x228),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':UlWvYX[_0x318afb(0x36e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=UlWvYX[_0x318afb(0xc7)](clone,mock[_0x318afb(0x349)]),invalidTarget=rootTarget+_0x318afb(0xde),invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':'read','invocationTarget':invalidTarget}}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':UlWvYX[_0x318afb(0x2eb)],'expectedTarget':[rootTarget,invalidTarget],'expectedRootCapability':rootCapability['id']}});UlWvYX['tWPmm'](expect,result)['to'][_0x318afb(0x160)],UlWvYX[_0x318afb(0x31d)](expect,result[_0x318afb(0x218)])['to']['be'][_0x318afb(0x188)],result[_0x318afb(0x206)]['errors'][_0x318afb(0x1f1)][_0x318afb(0x38f)]['length'](0x1);const [error]=result[_0x318afb(0x206)][_0x318afb(0xc9)];error[_0x318afb(0x19d)][_0x318afb(0x1f1)]['include'](UlWvYX[_0x318afb(0x26c)](_0x318afb(0x143)+invalidTarget+_0x318afb(0x11f),_0x318afb(0x3bd)+carolZcap[_0x318afb(0x329)]+')'));}),it(_0x4ab49a(0x231)+rbMFWG[_0x4ab49a(0x238)],async()=>{const _0x55a174=_0x4ab49a,rootTarget=rbMFWG['WeQiX'],rootCapability=rbMFWG[_0x55a174(0x3a6)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x55a174(0x329)]+_0x55a174(0x2aa),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id']});rbMFWG[_0x55a174(0x2b3)](expect,result)['to']['exist'],expect(result[_0x55a174(0x218)])['to']['be']['false'],result[_0x55a174(0x206)][_0x55a174(0xc9)]['should']['have'][_0x55a174(0x30b)](0x1);const [error]=result[_0x55a174(0x206)]['errors'];error[_0x55a174(0x19d)][_0x55a174(0x1f1)]['contain'](_0x55a174(0x39e));}),rbMFWG['Zobwe'](it,rbMFWG['CHJaJ'],async()=>{const _0x45a855=_0x4ab49a,oTVJry={'ayAXo':rbMFWG[_0x45a855(0x193)],'rQoJl':function(callee,param1){const _0x4e86f7=_0x45a855;return rbMFWG[_0x4e86f7(0x26d)](callee,param1);}},rootTarget=_0x45a855(0x2c3),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});rbMFWG[_0x45a855(0x34c)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await rbMFWG[_0x45a855(0x187)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap['invocationTarget']+_0x45a855(0x2aa),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x4771aa=_0x45a855;return checkedChain++,capabilityChain[_0x4771aa(0x1f1)]['be']['an'](oTVJry['ayAXo']),capabilityChain[_0x4771aa(0x1f1)]['have'][_0x4771aa(0x30b)](0x4),capabilityChainMeta[_0x4771aa(0x1f1)]['be']['an'](_0x4771aa(0x277)),capabilityChainMeta[_0x4771aa(0x1f1)]['have'][_0x4771aa(0x30b)](0x4),oTVJry[_0x4771aa(0x2c2)](_checkCapabilityChain,{'capabilityChain':capabilityChain}),oTVJry['rQoJl'](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),eval('const _0x132f8c = _0x4771aa;JSON[_0x132f8c(548)]({ \'safe\': !![] });'),{'valid':!![]};},result=await rbMFWG[_0x45a855(0x2e6)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'inspectCapabilityChain':inspectCapabilityChain,'purposeOptions':{'allowTargetAttenuation':!![]}});rbMFWG[_0x45a855(0x3a2)](expect,result)['to']['exist'],expect(result[_0x45a855(0x218)])['to']['be'][_0x45a855(0x164)],checkedChain[_0x45a855(0x1f1)][_0x45a855(0x1b9)](0x1);}),it(rbMFWG['enCKu']+_0x4ab49a(0x2bb),async()=>{const _0x1737e7=_0x4ab49a,rootTarget=rbMFWG[_0x1737e7(0x2e9)],rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});rbMFWG[_0x1737e7(0x39d)](addToLoader,{'doc':rootCapability});const bobZcap=await rbMFWG[_0x1737e7(0x3a6)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+_0x1737e7(0x2aa),carolZcap=await rbMFWG[_0x1737e7(0x16a)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x1737e7(0x32d)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await rbMFWG[_0x1737e7(0x26e)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':rbMFWG[_0x1737e7(0x30f)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap[_0x1737e7(0x329)],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x1a0136=_0x1737e7,ROfMIi=UlWvYX[_0x1a0136(0x239)]['split']('|');let ReHmfJ=0x0;while(!![]){switch(ROfMIi[ReHmfJ++]){case'0':capabilityChain[_0x1a0136(0x1f1)]['be']['an'](_0x1a0136(0x277));continue;case'1':capabilityChain[_0x1a0136(0x1f1)][_0x1a0136(0x38f)]['length'](0x4);continue;case'2':return{'valid':!![]};case'3':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'4':capabilityChainMeta['should'][_0x1a0136(0x38f)][_0x1a0136(0x30b)](0x4);continue;case'5':checkedChain++;continue;case'6':_checkCapabilityChain({'capabilityChain':capabilityChain});continue;case'7':UlWvYX[_0x1a0136(0x16f)](setTimeout,function(){const _0x1df623=_0x1a0136;console['log'](_0x1df623(0x121));},0x64);continue;case'8':capabilityChainMeta['should']['be']['an'](_0x1a0136(0x277));continue;}break;}},result=await rbMFWG['SqIfu'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'inspectCapabilityChain':inspectCapabilityChain,'purposeOptions':{'allowTargetAttenuation':!![]}});rbMFWG['LVGcp'](expect,result)['to'][_0x1737e7(0x160)],rbMFWG['aFxlu'](expect,result[_0x1737e7(0x218)])['to']['be'][_0x1737e7(0x188)],result[_0x1737e7(0x206)][_0x1737e7(0xc9)]['should'][_0x1737e7(0x38f)][_0x1737e7(0x30b)](0x1);const [error]=result['error']['errors'];error[_0x1737e7(0x19d)][_0x1737e7(0x1f1)][_0x1737e7(0x158)]('delegated\x20capability\x20must\x20not\x20be\x20less\x20restrictive'),checkedChain[_0x1737e7(0x1f1)][_0x1737e7(0x1b9)](0x0);});});});});function _checkCapabilityChain({capabilityChain:capabilityChain}){const _0x2fc517=_0x2edf6e;if(_0x2fc517(0x33e)===_0x2fc517(0x144))_0x27cba4=new _0x26db6f({'expectedTarget':_0x540d5c[_0x2fc517(0x329)],'expectedRootCapability':_0x5a960b['id'],'expectedAction':_0x117f52,'inspectCapabilityChain':_0x27c4c5,'suite':new _0x4a9d2e(),..._0x57945c});else for(const c of capabilityChain){c[_0x2fc517(0x1f1)]['be']['an'](_0x2fc517(0x19c)),c['should'][_0x2fc517(0x38f)]['property']('id'),c[_0x2fc517(0x1f1)][_0x2fc517(0x38f)][_0x2fc517(0x28e)](yiiFMi['usstz']),c[_0x2fc517(0x1f1)][_0x2fc517(0x38f)][_0x2fc517(0x28e)](_0x2fc517(0x329));}}function _checkCapabilityChainMeta({capabilityChainMeta:capabilityChainMeta}){const _0xd1d142=_0x2edf6e;for(const [i,m]of capabilityChainMeta[_0xd1d142(0x2f6)]()){m[_0xd1d142(0x1f1)]['be']['an'](yiiFMi['gaCJO']),m['should'][_0xd1d142(0x38f)][_0xd1d142(0x28e)](_0xd1d142(0x297));if(yiiFMi[_0xd1d142(0x1be)](i,0x0)){yiiFMi[_0xd1d142(0x377)](expect,m['verifyResult'])['to']['be']['null'];continue;}m[_0xd1d142(0x297)][_0xd1d142(0x1f1)][_0xd1d142(0x38f)]['property'](yiiFMi['cSpic']),m[_0xd1d142(0x297)][_0xd1d142(0x218)][_0xd1d142(0x1f1)]['be'][_0xd1d142(0x164)],m[_0xd1d142(0x297)]['should'][_0xd1d142(0x38f)][_0xd1d142(0x28e)](_0xd1d142(0x267)),m[_0xd1d142(0x297)][_0xd1d142(0x267)][_0xd1d142(0x30b)][_0xd1d142(0x1f1)][_0xd1d142(0x1b9)](0x1),m[_0xd1d142(0x297)]['results'][0x0][_0xd1d142(0x1f1)]['be']['an'](yiiFMi[_0xd1d142(0xb6)]),m[_0xd1d142(0x297)][_0xd1d142(0x267)][0x0][_0xd1d142(0x1f1)][_0xd1d142(0x38f)][_0xd1d142(0x28e)]('purposeResult'),m[_0xd1d142(0x297)][_0xd1d142(0x267)][0x0][_0xd1d142(0x379)]['should']['be']['an'](yiiFMi[_0xd1d142(0xb6)]),m[_0xd1d142(0x297)][_0xd1d142(0x267)][0x0][_0xd1d142(0x379)][_0xd1d142(0x1f1)][_0xd1d142(0x38f)][_0xd1d142(0x28e)](yiiFMi['MVLHx']);}}async function _invoke({doc:doc,key:key,invoker:invoker,date:date,capability:capability,capabilityAction:capabilityAction,purposeOptions:purposeOptions}){const _0x22876f=_0x2edf6e,mvaoiR={'QqsCY':yiiFMi['umDZl'],'CJfJd':'array'};invoker&&(key=invoker['get'](yiiFMi[_0x22876f(0x33b)],0x0));let purpose;if(capability)purpose=new CapabilityInvocation({'capability':capability['parentCapability']?capability:capability['id'],'capabilityAction':capabilityAction,'invocationTarget':capability[_0x22876f(0x329)]});else{if(yiiFMi[_0x22876f(0x259)](_0x22876f(0x12b),_0x22876f(0x12b))){const leJIob=mvaoiR[_0x22876f(0x155)][_0x22876f(0x35a)]('|');let MHHgqo=0x0;while(!![]){switch(leJIob[MHHgqo++]){case'0':_0x1d80a6[_0x22876f(0x1f1)]['be']['an'](mvaoiR[_0x22876f(0x296)]);continue;case'1':_0x467b23[_0x22876f(0x1f1)][_0x22876f(0x38f)][_0x22876f(0x30b)](0x4);continue;case'2':_0x1c0cb9[_0x22876f(0x1f1)]['be']['an'](_0x22876f(0x277));continue;case'3':_0xf2e45f({'capabilityChainMeta':_0x29ca5a});continue;case'4':_0x54e61d['should'][_0x22876f(0x38f)][_0x22876f(0x30b)](0x4);continue;case'5':_0x4a6c57(_0x22876f(0x17b),0x3e8);continue;case'6':_0xff8c9c({'capabilityChain':_0x4f916a});continue;case'7':return{'valid':!![]};case'8':_0x3df41c++;continue;}break;}}else purpose=new CapabilityInvocation(purposeOptions);}return new AsyncFunction(_0x22876f(0x17e))(),jsigs[_0x22876f(0xa1)](doc,{'documentLoader':testLoader,'suite':new Ed25519Signature2020({'key':new Ed25519VerificationKey2020(key),'date':date}),'purpose':purpose});}async function _verifyInvocation({invocation:invocation,rootCapability:rootCapability,expectedAction:expectedAction,inspectCapabilityChain:inspectCapabilityChain,purposeOptions:purposeOptions}){const _0x196449=_0x2edf6e;let purpose;return rootCapability?purpose=new CapabilityInvocation({'expectedTarget':rootCapability['invocationTarget'],'expectedRootCapability':rootCapability['id'],'expectedAction':expectedAction,'inspectCapabilityChain':inspectCapabilityChain,'suite':new Ed25519Signature2020(),...purposeOptions}):purpose=new CapabilityInvocation({'suite':new Ed25519Signature2020(),...purposeOptions}),eval('Math[\'PI\'] * 2;'),jsigs[_0x196449(0x366)](invocation,{'documentLoader':testLoader,'suite':new Ed25519Signature2020(),'purpose':purpose});}async function _delegate({newCapability:newCapability,parentCapability:parentCapability,controller:controller,key:key,delegator:delegator,date:date,_capabilityChain:_capabilityChain,purposeOptions:purposeOptions}){const _0x13a523=_0x2edf6e,SeMOOk={'XdFax':function(x,y){return x+y;}};delegator&&(key=delegator['get'](yiiFMi[_0x13a523(0x20b)],0x0));let purpose;return purposeOptions?purpose=new CapabilityDelegation({'parentCapability':parentCapability,'_capabilityChain':_capabilityChain,...purposeOptions}):purpose=new CapabilityDelegation({'parentCapability':parentCapability,'_capabilityChain':_capabilityChain}),!newCapability&&(newCapability={'@context':ZCAP_CONTEXT_URL,'id':yiiFMi[_0x13a523(0x22a)](uuid),'controller':yiiFMi[_0x13a523(0x365)](typeof controller,'string')?controller:controller['id'](),'parentCapability':parentCapability['id'],'invocationTarget':parentCapability['invocationTarget'],'expires':EXPIRES_3000_DATE}),eval('const _0x48ea10 = _0x13a523;SeMOOk[_0x48ea10(217)](1, 1);'),jsigs[_0x13a523(0xa1)](newCapability,{'documentLoader':testLoader,'suite':new Ed25519Signature2020({'key':new Ed25519VerificationKey2020(key),'date':date}),'purpose':purpose});}async function _verifyDelegation({delegation:delegation,expectedRootCapability:expectedRootCapability,inspectCapabilityChain:inspectCapabilityChain,purposeOptions:purposeOptions={}}){const _0x2d3d31=_0x2edf6e;return yiiFMi[_0x2d3d31(0x383)](setInterval,_0x2d3d31(0x17b),0x3e8),jsigs['verify'](delegation,{'documentLoader':testLoader,'suite':new Ed25519Signature2020(),'purpose':new CapabilityDelegation({'suite':new Ed25519Signature2020(),'expectedRootCapability':expectedRootCapability,'inspectCapabilityChain':inspectCapabilityChain,...purposeOptions})});}}