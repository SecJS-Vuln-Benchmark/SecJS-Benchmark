const _0x1359b9=_0x3b69;(function(_0x21c40b,_0x3d0b46){const _0x8f1f31=_0x3b69,_0x3d60b5=_0x21c40b();while(!![]){try{const _0xa3077b=-parseInt(_0x8f1f31(0x215))/0x1+parseInt(_0x8f1f31(0x152))/0x2*(-parseInt(_0x8f1f31(0x198))/0x3)+parseInt(_0x8f1f31(0x418))/0x4+parseInt(_0x8f1f31(0x244))/0x5*(parseInt(_0x8f1f31(0x125))/0x6)+-parseInt(_0x8f1f31(0x2a7))/0x7*(-parseInt(_0x8f1f31(0x144))/0x8)+parseInt(_0x8f1f31(0x433))/0x9*(-parseInt(_0x8f1f31(0x166))/0xa)+-parseInt(_0x8f1f31(0x251))/0xb;if(_0xa3077b===_0x3d0b46)break;else _0x3d60b5['push'](_0x3d60b5['shift']());}catch(_0x840eaf){_0x3d60b5['push'](_0x3d60b5['shift']());}}}(_0x5a25,0x48068));import _0xed6b2e from'chai';import{Ed25519Signature2020}from'@digitalbazaar/ed25519-signature-2020';import{Ed25519VerificationKey2020}from'@digitalbazaar/ed25519-verification-key-2020';const should=_0xed6b2e[_0x1359b9(0x373)]();function _0x5a25(){const _0x57dd73=['cPpQV','JfJir','EYiCg','MHvPk','QdxFw','OPPPO','vtklr','vbdBz','GDMfc','should\x20fail\x20to\x20verify\x20chain\x20w/bad\x20middle\x20capability','hdtFg','NNxpN','afpgA','NeKXS','gPooG','jXsih','should\x20verify\x20a\x20invoking\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','lDeFT','must\x20be\x20equivalent\x20to\x20its\x20parent','EeIKD','https://example.com/edvs/2c2fe4ab-ff54-4a82-b103-f806f50d364e','gxqtB','date','xTPPn','DUEDW','hIgkD','date\x20in\x20its\x20delegation\x20proof.','exampleDoc','Ufoql','kLfKO','VoPog','ysYCQ','ZNHCy','OdFYO','WjUKk','aAoaE','Chain\x20depth\x20of\x203','log','invalid\x20date','qCuaC','zuQDL','QiIQk','LExmw','Invalid\x20signature.','DYYSb','WTPmz','NIQCj','eipXy','bDwAF','vNzad','Root\x20capability\x20must\x20not\x20have\x20an\x20\x22expires\x22\x20field.','mHhWw','JPTnj','quYnb','qaOrw','should','jQJrh','RFbTI','urn:uuid:055f47a4-61d3-11ec-9144-10bf48838a41','consist\x20of\x20strings\x20of\x20capability\x20IDs','gbMnu','https://example.com/edvs/d9dd2093-0908-47ba-8db7-954ff1cd81ee','0|2|1|3|5|4|6','ydXPF','fmdoi','uAqXk','dHplb','wfHvj','OFrBx','TvNNM','HyAKx','Oncwp','Capability\x20controller\x20uses\x20verification\x20method','iaGLf','XweVf','second\x20delegated\x20capability\x20that\x20expires\x20after\x20first','lDqIn','NWoKI','XxKQd','mxOTe','carol','\x22capabilityAction\x22\x20is\x20not\x20in\x20\x22allowedAction\x22','ybAPw','ExrOT','/a-specific-document','The\x20`expires`\x20property\x20in\x20a\x20delegated\x20','SHTMD','BwQfH','7|1|4|8|5|6|2|0|3','and\x20`date`\x20parameter\x20in\x20the\x20past','ngFNe','DptPl','The\x20invoked\x20capability\x20has\x20expired.','utlnp','KhhmB','target\x20w/query','deep','cwEYT','XQXwV','and\x20`date`\x20parameter\x20in\x20the\x20future','ukMRo','Sign\x20with\x20capabilityDelegation\x20proof\x20purpose','urn:uuid:1aaec12f-bcf2-40d8-8192-cc4dde9bca96','ppiVO','should\x20fail\x20if\x20expectedRootCapability\x20does\x20not\x20match','beta','and\x20`date`\x20parameter\x20in\x20the\x20chain\x20in\x20the\x20future','not','should\x20fail\x20when\x20missing\x20\x22invocationTarget\x22','MGUgs','IQVnt','rHNXg','ZOyNb','fpYza','tkqSf','GlkEg','?foo=bar','bZDiB','vzhjW','FUYBE','bBWsS','verify','should\x20verify\x20two\x20invocation\x20proofs\x20on\x20the\x20same\x20doc','should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20as\x20delegated','\x22capabilityAction\x22\x20must\x20be\x20a\x20string.','should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20unexpected\x20','permissive\x20than\x20the\x20parent\x20capability\x20w/path','UXwEc','capability\x20must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20','fxRKN','bHDPN','oryue','krHJi','JQevn','LywyJ','RVtiG','xtCrk','HwPDG','BzSeJ','and\x20`date`\x20parameter\x20in\x20the\x20chain\x20in\x20the\x20past','read','should\x20fail\x20to\x20verify\x20root\x20capability\x20with\x20`expires`','WtIOc','wLCDk','Invocation\x20target\x20(','sCnBY','GTaNf','capabilityAction','UEpgW','urn:other','lrvCz','PwIGE','JnifD','urn:zcap:0aee1dd6-646b-11ec-b975-10bf48838a41','wJmUT','oqdVx','Chain\x20depth\x20of\x204','it\x20must\x20consist\x20of\x20strings',')\x20does\x20not\x20match\x20capability\x20','kGXzO','w/inspectCapabilityChain','qlkcu','FvSGc','jrsng','deiHC','EaStC','urn:zcap:80a8de39-df68-4fd8-ba78-4d65a27b2009','https://example.com/edvs/','should\x20fail\x20to\x20verify\x20chain\x20with\x20misreferenced\x20parent\x20','NZEaC','knGyF','LMSLv','zcap\x20at\x20end\x20of\x20chain','fHIVP','RlOKr','MJVfH','Cannot\x20delegate\x20an\x20expired\x20capability.','should\x20fail\x20invoking\x20a\x20capability\x20with\x20missing\x20`expires`\x20in\x20','tsKtJ','hoymc','XzidD','capabilityDelegation','MCbke','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20','The\x20capability\x20\x22','Qddet','NeiDb','NydyX','4|2|5|1|6|3|0','ufEFt','contain','JpZRj','jgiNU','wSAtN','vLLds','tYHqM','should\x20verify\x20chain\x20w/path\x20and\x20query\x20attenuation','DKhec','iYdbG','NDkIy','wIjao','jgmtG','fRYLr','wByHj','matching\x20\x22capabilityAction\x22\x20not\x20found','zCbXH','ttIdc','inVxx','does\x20not\x20match\x20the\x20parent','YMsST','LQUuL','lumFq','WTYVa','NDpdi','pRmCO','hHFoM','oNCpj','eDKuh','cjoOK','MIfVe','1810644KmhiRN','bghNK','TjOsL','juzIh','EQERs','pDAlg','KDeLk','ckvDE','OjBCC','VerificationError','okdly','instanceof','hNlPC','ppDQk','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20an\x20','mERcm','urn:zcap:1d0cd622-2e0a-4686-b0d7-bd71cc27db04','hVJsp','foo','CPgkh','should\x20fail\x20to\x20delegate\x20a\x20capability\x20with\x20bad\x20`expires`\x20field','Iukky','have','xHQcf','OILjM','PYhAk','exampleDocWithInvocation','13329BzdfbU','HuzjF','nXoGa','rNYtM','OuxQX','okltd','grSya','WOgEz','QTqsC','BZvde','/a-specific-document?foo=bar','zFxYT','8|5|2|0|7|1|3|4|6','VLOsQ','bRUoj','does\x20not\x20match\x20expected\x20root\x20capability','`expectedRootCapability`\x20is\x20not\x20a\x20URI','mwCyy','xgMqR','XJeeK','is\x20not\x20a\x20valid\x20date.','zJMZp','invocationTarget','siQWO','dnYDu','lCELY','the\x20second\x20capability\x20delegation','MfnjM','capability\x20or\x20an\x20object\x20expressing\x20the\x20full\x20parent\x20capability.','explicitly\x20allowed','FyFpP','urn:zcap:ef98a880-6b36-11ec-940f-10bf48838a41','xkRnH','VViZr','DitCJ','npHHz','urn:this-should-matter','TZFGI','OVSxT','gGyui','MXwEH','yEeNI','PvFPm','Error','MuEUI','ztLqT','The\x20capability\x20chain\x20exceeds\x20the\x20maximum\x20allowed\x20length\x20of\x202.','Capability\x20controller\x20is\x20itself\x20a\x20verification\x20method','FKdfK','should\x20fail\x20to\x20verify\x20w/delegated\x20zcap\x20with\x20no\x20expiration\x20','jQnqn','Expiration\x20date','ZDZbg','UDtRG','hbaFx','should\x20fail\x20to\x20verify\x20chain\x20w/invalid\x20allowedAction\x20string\x20','a\x20valid\x20subset\x20of\x20the\x20parent\x20allowedAction\x20array','hUxhz','6NLaLxW','NaEdh','DKOUf','OBowz','capability\x20that\x20expires\x20on\x20the\x20Unix\x20epoch','yEhDv','vbdop','SZPAm','NiAQn','psgSP','aCCsl','cBuns','ZwHoc','KBWiu','ZZCWR','OTlUQ','should\x20succeed','uNIvC','oqedG','KkslX','urn:zcap:a0d0360b-7e93-4c9c-8804-69ca426c60c3','TypeError','qZUjj','urn:zcap:59bcb98b-a7ee-4ba7-8629-8b52329bc506','ndZSv','ZNzjP','should\x20fail\x20to\x20verify\x20w/inspectCapabilityChain\x20','dlHTh','https://example.com/edvs/1d7ab048-719c-11ec-b07a-10bf48838a41','xWacn','IoMgy','72lqkwZV','EHsVM','kYaOb','KMkWR','oCdLl','zjfEC','NBBzs','fgabE','dZXhb','goMSb','eQkzm','ObCrW','gyJei','WOfmz','489052zcxwKf','AcqJS','UxlkV','xcnJr','dtcyc','nJcQM','replace','npjyx','JFiqG','YcZLo','should\x20fail\x20to\x20verify\x20w/embedded\x20middle\x20zcap','dGkZT','kDzpi','YfDjA','delegation\x20proof\x20\x22created\x22\x20date','not\x20a\x20valid\x20date','NMefM','eZfIi','HgLgi','fERCo','1320XcQAon','JWvDd','IECXn','vIwAA','TvINE','IqOwX','IlkWz','mboiW','gqHwr','mIcJz','HeZYK','KCoQr','qxWom','CgttN','allowed\x20action\x20on\x20one\x20capability','EFroP','rdYHf','JPuUm','TtDJQ','IUIbS','XoEIw','UUiiN','jWFlk','MwOqQ','error','ueBli','qFWiI','LkBRh','rKsqj','BjHho','LkdYM','YxiFj','JFKPH','pfrfR','eUNbj','XoVHe','oSHQG','XLlDp','get','delegated\x20in\x20the\x20future','Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date.','smbSG','future','should\x20verify\x20invoking\x20a\x20capability\x20with\x20`expires`\x20','NhnOh','sign','SHGQu','xBgqN','CsPcO','urn:zcap:142b0b4a-c664-4288-84e6-be0a59b6efa4','3dsdJvi','true','cjxNv','zwICO','/a-different-specific-document','wkZYf','match','sWoiF','AyWxk','EfDVM','KliSg','results','WwpmC','GHLHg','NYKqH','bZUHB','VDcUk','AnarQ','pSYOX','daoXe','https://zcap.example/target1','invalid','oHRqq','EVVqh','kkdpT','tNZxN','pquHx','qIITR','DFCxB','IGQQD','iiPJh','YsJYe','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20','QRMzd','should\x20verify\x20a\x20root\x20zcap\x20w/\x20multiple\x20controllers','equal','should\x20verify\x20chain\x20w/inspectCapabilityChain','KVBJe','jiHhv','CdjvC','hWEQW','has\x20been\x20revoked','should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20an\x20','split','BEMON','fBNUY','RSQTU','iSXAT','a\x20matching\x20`expectedRootCapability`\x20is\x20given','should\x20verify\x20an\x20invoked\x20root\x20capability','https://example.com/edvs/0d3bd43c-719c-11ec-acdd-10bf48838a41','rzgUP','LJaKE','evaZq','fXYNR','JvjrU','RVRTv','TQxdz','aghRM','KuJEJ','should\x20fail\x20when\x20missing\x20\x22capabilityAction\x22','zEHoY','SHKkW','QffVQ','root','RfiwR','Qmsep','tXJQk','should\x20fail\x20to\x20verify\x20chain\x20','property','IkfPo','jJuPb','expires','1|6|3|2|0|5|4','TJnnF','should\x20fail\x20to\x20verify\x20chain\x20exceeding\x20maxChainLength','verifyResult','rkrdA','Atcfk','ikIHm','jkgVn','\x22write\x22\x20expected\x20action','ONgYJ','TTBML','now','lOhDC','should\x20fail\x20invoking\x20a\x20capability\x20with\x20only\x20an\x20expired\x20','HwNkc','mNQzw','zcap\x20in\x20chain','CtuKt','controller','should\x20fail\x20to\x20verify\x20when\x20allowTargetAttenuation\x20is\x20not\x20','GXBzN','should\x20fail\x20invoking\x20a\x20chain\x20depth\x203\x20capability\x20with\x20`expires`\x20','delegated','TpUWf','uonJB','rnWWb','FVUSh','jdFkL','BtDPX','vtCEP','KiwnI','\x22expectedRootCapability\x22\x20must\x20be\x20a\x20string\x20or\x20array.','pDNGp','JQKVh','FmEwp','target\x20(','UiDGQ','xuSgz','SqEdf','should\x20fail\x20invoking\x20a\x20capability\x20with\x20expired\x20','should\x20fail\x20to\x20verify\x20chain\x20with\x20embedded\x20root\x20','rUhhS','SwJTh','UHjgm','MYfzT','cAAmZ','zHPOD','nFFgl','LfIWY','should\x20fail\x20to\x20verify\x20an\x20increasingly\x20permissive\x20chain\x20','NFZae','should\x20fail\x20when\x20missing\x20\x22capability\x22','347221VdSlFY','blGMP','setHours','has\x20been\x20revoked.','w/query','capabilityInvocation','cExHh','wbRpY','write','wbOcL','WObKa','errors','8|7|5|0|1|2|4|3|6','\x22\x20has\x20been\x20revoked.','MFTmN','ThQki','XJUOk','include','toISOString','Capability\x20controller\x20not\x20found','delegated\x20before\x20its\x20parent','Loefh','cxhfy','w/invalid\x20allowedAction\x20strings','IqHcq','mWBIn','hRlZj','comyl','should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20a\x20','VMCQg','SwOTq','CAHSo','OHDsv','TALhw','iopVP','UcLKD','VDRBd','sSvvy','syjfC','FuCdb','RFlAC','VAeVF','parentCapability','bob','bJtkz','uxuJe','vyJqG','793215ZdbxHI','pfzLU','bramO','second\x20delegated\x20capability','OaAUa','yrlSp','rghFL','getTime','should\x20verify\x20chain\x20w/path\x20attenuation','SuQVp','\x22parentCapability\x22\x20must\x20be\x20a\x20string\x20expressing\x20the\x20ID\x20of\x20a\x20root\x20','arxts','kVqGt','192962uuYaUH','NIShA','voZeU','jnyxA','should\x20fail\x20invoking\x20a\x20delegated\x20capability\x20before\x20its\x20','gRcdy','A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.','lTRqw','KoHpP','should\x20succeed\x20w/key\x20invoker','QmTHV','should\x20verify\x20chain\x20w/\x20multiple\x20controllers','VnThO','6|5|3|4|0|2|1','urn:uuid:','vuuIM','MJNiX','WPHTU','string','FFSQw','Jusvq','lWuKB','qxscz','ABaYG','yULqd','should\x20fail\x20invoking\x20a\x20chain\x20depth\x202\x20capability\x20with\x20`expires`\x20','jvfDt','onfpi','parent','kUmUs','oNAVJ','hwhkM','InOYh','xTPFk','wBaxt','cMhOJ','XweYH','var\x20x\x20=\x2042;\x20return\x20x;','The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','irClM','uNRww','CxoBi','Kzejf','pdSPl','lwvOY','should\x20succeed\x20when\x20passing\x20only\x20\x22parentCapability\x22','CuXwT','SqHxi','should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20invalid\x20','urn:zcap:2c41869c-95bb-4e23-9bcd-2fbb320bb440','bxZRw','uAEjb','PlwVJ','should\x20verify\x20chain','GXpbR','NskrL','urn:zcap:ae96f88e-6b8a-4445-9b4f-03f45c3d1685','should\x20fail\x20to\x20verify\x20chain\x20w/delegated\x20zcap\x20in\x20the\x20','cgIeq','XzXat','should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202','ZavMu','gPpKi','exist','urn:zcap:b4840a74-6cc0-11ec-819f-10bf48838a41','MXAhZ','Sign\x20with\x20capabilityInvocation\x20proof\x20purpose','eRdLO','PTgDF','should\x20fail\x20to\x20verify\x20w/delegated\x20zcap\x20created\x20before\x20','RimoQ','VCdCj','zYfsV','EwEYr','luRQY','expected\x20\x22capabilityAction\x22\x20does\x20not\x20match','\x22expectedRootCapability\x22\x20values\x20must\x20be\x20absolute\x20URI\x20strings.','should\x20verify\x20invocation','delegated\x20capability\x20must\x20not\x20be\x20less\x20restrictive','YEuaZ','IcvSA','getHours','rElOO','vKTij','BtFvt','PawFV','379939HCMrTP','length','rRznm','EyAUe','EajXM','iZNbg','should\x20verify\x20invoking\x20w/inspectCapabilityChain','WAGoy','urn:zcap:3c034da3-8b5e-4fdc-b75d-8c37d73cd21e','TukHI','VWeAF','should\x20verify\x20when\x20invoking\x20at\x20a\x20valid\x20sub\x20target\x20','RFWzM','NtZYt','LfhxT','AnFUM','CnSAG','IRgTI','https://example.com/edvs/357570f6-8df2-4e78-97dc-42260d64e78e','feBqP','nYTWw','bmvsp','should\x20succeed\x20w/verification\x20method\x20as\x20controller','GLhZt','VXDRw','JyCNo','xrxeR','AafeM','OXVrL','urn:zcap:6286a906-619b-4f5b-a8ae-af9fb774b070','qrjLE','nARVx','parent.','NLwIW','alpha','lsgZK','restful','rQybj','BFchc','message','HYVhC','fXpZo','verified','purposeResult','should\x20verify\x20an\x20invoked\x20root\x20capability\x20w/\x20multiple\x20controllers','should\x20fail\x20to\x20verify\x20chain\x20w/bad\x20last\x20capability','name','TlWWQ','Lkxiu','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20a\x20','VdEkM','must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.','wZyAI','ZcpOY','xWPjS','should\x20verify\x20chain\x20when\x20child\x20allowedAction\x20is\x20','VNBLL','delegator','ZVytv','tWObS','YhexL','wIikg','w/path','qPAMC','urn:some:root:id','TqklN','WizAV','array','dveOY','NQBqK','STVGG','iqKti','should\x20verify\x20invoking\x20','ZCMvU','XQYVR','DcuFe','ByXuc','should\x20fail\x20invoking\x20','sDGwg','Dftnj','TpEju','wSAKi','false','XBcyA','ZWzJB','HJbvv','rtfAa','KljHo','VoakD','should\x20verify\x20invoking\x20a\x20capability\x20with\x20`expires`','A\x20delegated\x20capability\x20must\x20not\x20be\x20invoked\x20before\x20the\x20\x22created\x22\x20','heAjV','NgeLy','console.log(\x22timer\x22);','VyKTN','bar','vhjRB','KQqOV','JEEIc','https://example.com/edvs/3e209556-719c-11ec-9a7b-10bf48838a41','mJoJU','AWFVE','tbQSi','DbWVR','lqFIV','stringify','Svlrp','NotFoundError','parse','nlDyU','NvWMI','wbXJz','jiJXG','uDeVj','urn:uuid:fake','tDYwx','urn:zcap:1c919b19-baab-45ee-b0ef-24309dfb355d','JXQpI','oGLdo','FYtMs','YvJZW','PTpiN','invocationTarget\x20attenuation','https://example.com/edvs/83d7e997-d742-4b1a-9033-968f222b9144','lKCzS','object','KjXxp','fqDDG','urn:foo','oSfTr','DlIkf','bMRCY','when\x20the\x20expectedRootCapability\x20does\x20not\x20match','TZKDD','zcap\x20in\x20middle\x20of\x20chain','gmUii','SzHWo','KzifW','cUIUj','qGkTB','should\x20fail\x20to\x20verify\x20chain\x20with\x20attenuation\x20that\x20is\x20more\x20','safe','return\x20await\x20Promise.resolve(42);','suUgL','kLyoO','should\x20succeed\x20w/controller\x20invoker','lRMsY','NceiY','pkTQb'];_0x5a25=function(){return _0x57dd73;};return _0x5a25();}function _0x3b69(_0x46468,_0x55042e){const _0x5a2526=_0x5a25();return _0x3b69=function(_0x3b69d8,_0x33101f){_0x3b69d8=_0x3b69d8-0x123;let _0x3ceb08=_0x5a2526[_0x3b69d8];return _0x3ceb08;},_0x3b69(_0x46468,_0x55042e);}export default async function (options){const _0xc4aeb7=_0x1359b9,NhqeRF={'woLXt':_0xc4aeb7(0x327),'cgIeq':_0xc4aeb7(0x362),'TvNNM':'SnSxG','iiPJh':function(callee,param1){return callee(param1);},'cqhhg':_0xc4aeb7(0x173),'dNJAl':function(x,y){return x!==y;},'cExHh':_0xc4aeb7(0x438),'KQqOV':function(callee,param1,param2){return callee(param1,param2);},'lKCzS':function(callee,param1,param2){return callee(param1,param2);},'FyFpP':_0xc4aeb7(0x3c8),'wIjao':_0xc4aeb7(0x338),'ukMRo':_0xc4aeb7(0x1d4),'XJUOk':_0xc4aeb7(0x21a),'ZNzjP':'urn:uuid:710910c8-61e4-11ec-8739-10bf48838a41','hoymc':_0xc4aeb7(0x2bd),'VdEkM':_0xc4aeb7(0x135),'luRQY':'should\x20fail\x20when\x20missing\x20\x22parentCapability\x22','SHGQu':_0xc4aeb7(0x27e),'DUEDW':function(x,y){return x!==y;},'Zaeux':function(x,y){return x===y;},'iZNbg':function(callee){return callee();},'CnSAG':function(callee,param1){return callee(param1);},'AnarQ':'write','yXayF':_0xc4aeb7(0x19a),'sWoiF':function(callee,param1){return callee(param1);},'BEMON':_0xc4aeb7(0x421),'LJaKE':function(x,y){return x===y;},'xHFEk':function(x,y){return x+y;},'GXpbR':_0xc4aeb7(0x263),'OVSxT':function(callee,param1,param2){return callee(param1,param2);},'uonJB':_0xc4aeb7(0x286),'bramO':_0xc4aeb7(0x209),'TjOsL':function(x,y){return x+y;},'lqFIV':_0xc4aeb7(0x46a),'grSya':'vs\x20array','eUNbj':_0xc4aeb7(0x2de),'oMHXp':_0xc4aeb7(0x2d4),'WtIOc':'w/revoked\x20capability','xwIPj':_0xc4aeb7(0x296),'lWuKB':_0xc4aeb7(0x26d),'BjHho':'w/delegated\x20zcap\x20with\x20a\x20TTL\x20that\x20is\x20too\x20long','lrvCz':function(x,y){return x+y;},'SmXYK':'w/inspectCapabilityChain\x20and\x20a\x20revoked\x20capability','quYnb':_0xc4aeb7(0x334),'MXAhZ':'urn:zcap:9ff561b8-0b3f-4bbc-af00-03ba785a7fc6','siQWO':_0xc4aeb7(0x301),'mwVBT':_0xc4aeb7(0x2c4),'wbXJz':function(callee,param1,param2){return callee(param1,param2);},'TpEju':_0xc4aeb7(0x26a),'gxqtB':'and\x20`date`\x20parameter\x20in\x20the\x20past','npjyx':_0xc4aeb7(0x208),'RzPkP':'second\x20delegated\x20capability','ZCMvU':function(callee,param1){return callee(param1);},'kOUTo':_0xc4aeb7(0x400),'lumFq':'permissive\x20than\x20the\x20parent\x20capability\x20w/query','VDcUk':'w/path','ZOyNb':function(x,y){return x+y;},'GwBfh':_0xc4aeb7(0x29d),'AafeM':function(x,y){return x===y;},'rKsqj':_0xc4aeb7(0x13a),'htZmK':function(x,y){return x*y;},'sAuqy':function(callee,param1){return callee(param1);},'rdClW':_0xc4aeb7(0x18e),'aAoaE':function(x,y){return x-y;},'IRgTI':function(callee){return callee();},'mboiW':_0xc4aeb7(0x452),'iaGLf':_0xc4aeb7(0x391),'rRznm':'sbmdX','gPooG':_0xc4aeb7(0x15c),'MDceK':function(callee){return callee();},'WOgEz':_0xc4aeb7(0x350),'jiHhv':function(callee,param1,param2){return callee(param1,param2);},'EwEYr':function(x,y){return x+y;},'tkqSf':'should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','QPNKo':_0xc4aeb7(0x3b6),'BzSeJ':_0xc4aeb7(0x1ba),'oryue':_0xc4aeb7(0x28d),'Qddet':function(x,y){return x+y;},'zFxYT':_0xc4aeb7(0x174),'sMfBH':function(callee,param1,param2){return callee(param1,param2);},'hRlZj':_0xc4aeb7(0x3a1),'KljHo':_0xc4aeb7(0x462),'NFZae':_0xc4aeb7(0x1f3),'ZwHoc':'invocationTarget','uNRww':'object','wBaxt':function(x,y){return x===y;},'hVpJP':_0xc4aeb7(0x28e),'ZWzJB':_0xc4aeb7(0x1fb),'KliSg':function(x,y){return x!==y;},'CxoBi':_0xc4aeb7(0x31d)},{expect,helpers,jsigs,mock,zcap}=options,{CapabilityInvocation,CapabilityDelegation,createRootCapability,constants:{ZCAP_CONTEXT_URL}}=zcap,{controllers,privateDidDocs,capabilities,addToLoader,testLoader}=mock,{Controller,uuid}=helpers;function clone(obj){const _0x43360b=_0xc4aeb7,kaVyhr={'oSfTr':NhqeRF['woLXt'],'TtDJQ':NhqeRF[_0x43360b(0x28b)],'UHjgm':function(x,y){return x===y;},'LkBRh':_0x43360b(0x2b3)};if(NhqeRF[_0x43360b(0x381)]===_0x43360b(0x3bd))_0x38ee34=new _0x58ee72({'capability':_0x1592a7[_0x43360b(0x23f)]?_0x36b139:_0x56dc3c['id'],'capabilityAction':_0x1d1b24,'invocationTarget':_0x1a29a6[_0x43360b(0x449)]});else return setTimeout(function(){const _0x503405=_0x43360b;if(kaVyhr[_0x503405(0x20c)](kaVyhr[_0x503405(0x181)],kaVyhr['LkBRh']))console[_0x503405(0x361)](_0x503405(0x334));else{let _0x419519,_0x2f372d;try{_0x419519=new _0x30c06f({'expectedRootCapability':kaVyhr[_0x503405(0x328)],'date':kaVyhr[_0x503405(0x178)]});}catch(_0x199e07){_0x2f372d=_0x199e07;}_0xf1a42b[_0x503405(0x290)](_0x2f372d),_0x3c6a83[_0x503405(0x3a7)][_0x503405(0x290)](_0x419519),_0x2f372d[_0x503405(0x373)]['be']['instanceof'](_0x20545a),_0x2f372d[_0x503405(0x2ce)][_0x503405(0x373)][_0x503405(0x3fa)](_0x503405(0x447));}},0x64),JSON['parse'](JSON[_0x43360b(0x310)](obj));}const alice=new Controller(controllers['alice']),bob=new Controller(controllers[_0xc4aeb7(0x240)]),carol=new Controller(controllers[_0xc4aeb7(0x38c)]),diana=new Controller(controllers['diana']),alpha=new Controller(privateDidDocs[_0xc4aeb7(0x2c9)]),CONSTANT_DATE='2018-02-13T21:26:08Z',EXPIRES_3000_DATE='3000-01-01T00:01Z';describe('zcap',()=>{const _0x335ca1=_0xc4aeb7,GcDKxy={'MXwEH':function(callee,param1){const _0x5e8bce=_0x3b69;return NhqeRF[_0x5e8bce(0x1b6)](callee,param1);},'YMsST':function(callee,param1){return callee(param1);},'JQKVh':NhqeRF[_0x335ca1(0x451)],'GHLHg':function(callee,param1){return callee(param1);},'EFroP':_0x335ca1(0x3b8),'xuSgz':function(callee,param1){return callee(param1);},'sDGwg':_0x335ca1(0x327),'TlWWQ':function(callee,param1){return NhqeRF['iiPJh'](callee,param1);},'jWFlk':_0x335ca1(0x25a),'daoXe':NhqeRF[_0x335ca1(0x404)],'XoEIw':NhqeRF[_0x335ca1(0x3a0)],'oqedG':function(callee,param1,param2){return callee(param1,param2);},'cjoOK':NhqeRF[_0x335ca1(0x225)],'UDtRG':_0x335ca1(0x1db),'SHKkW':NhqeRF[_0x335ca1(0x13e)],'knGyF':NhqeRF[_0x335ca1(0x3ef)],'vtklr':NhqeRF[_0x335ca1(0x2d9)],'vNzad':function(callee,param1,param2){return callee(param1,param2);},'onfpi':NhqeRF[_0x335ca1(0x29b)],'FKUdJ':NhqeRF[_0x335ca1(0x194)],'fERCo':function(callee,param1){return callee(param1);},'FUYBE':function(x,y){const _0x2f04a8=_0x335ca1;return NhqeRF[_0x2f04a8(0x354)](x,y);},'NhnOh':function(callee,param1){return callee(param1);},'NQBqK':'does\x20not\x20match\x20expected\x20root\x20capability','vyJqG':function(x,y){return NhqeRF['Zaeux'](x,y);},'ysYCQ':_0x335ca1(0x124),'xWPjS':function(callee,param1){return NhqeRF['iiPJh'](callee,param1);},'ufEFt':function(callee){const _0x10c767=_0x335ca1;return NhqeRF[_0x10c767(0x2ac)](callee);},'SqHxi':_0x335ca1(0x228),'mxOTe':function(callee){return callee();},'CdjvC':function(callee,param1){return callee(param1);},'vhjRB':function(callee,param1){const _0x4f3b8d=_0x335ca1;return NhqeRF[_0x4f3b8d(0x1b6)](callee,param1);},'pfzLU':_0x335ca1(0x3d1),'cxQGP':function(callee,param1){return callee(param1);},'cUIUj':function(callee){return callee();},'SwOTq':function(callee,param1){const _0x222d90=_0x335ca1;return NhqeRF[_0x222d90(0x1b6)](callee,param1);},'RimoQ':function(callee,param1){const _0x1652c7=_0x335ca1;return NhqeRF[_0x1652c7(0x1b6)](callee,param1);},'dGkZT':function(callee,param1){return callee(param1);},'BwQfH':function(callee,param1){const _0x1013b5=_0x335ca1;return NhqeRF[_0x1013b5(0x2b7)](callee,param1);},'vuuIM':function(callee,param1){return callee(param1);},'HeZYK':NhqeRF[_0x335ca1(0x1a9)],'jrsng':function(callee,param1){return callee(param1);},'PlwVJ':NhqeRF['yXayF'],'LkdYM':function(callee,param1){return NhqeRF['sWoiF'](callee,param1);},'uAqXk':function(callee,param1){return callee(param1);},'TukHI':function(callee,param1){return callee(param1);},'zjfEC':function(callee,param1){return callee(param1);},'ExrOT':function(callee,param1){return NhqeRF['iiPJh'](callee,param1);},'JQevn':NhqeRF[_0x335ca1(0x1c4)],'MCbke':_0x335ca1(0x312),'goMSb':function(callee,param1){return callee(param1);},'dlHTh':function(callee,param1){const _0xa555fd=_0x335ca1;return NhqeRF[_0xa555fd(0x1b6)](callee,param1);},'jgmtG':function(callee,param1){return callee(param1);},'PTgDF':_0x335ca1(0x2ea),'yEeNI':function(callee,param1){return callee(param1);},'gPpKi':function(x,y){const _0x4a1bec=_0x335ca1;return NhqeRF[_0x4a1bec(0x1cc)](x,y);},'BFchc':function(x,y){return x*y;},'wByHj':function(x,y){return NhqeRF['xHFEk'](x,y);},'RfiwR':function(x,y){return x/y;},'eaQkE':function(callee,param1){return callee(param1);},'GDMfc':_0x335ca1(0x148),'iqKti':function(callee){return callee();},'GlkEg':function(callee,param1){const _0x2bb029=_0x335ca1;return NhqeRF[_0x2bb029(0x19f)](callee,param1);},'gArri':function(callee){const _0x467fd1=_0x335ca1;return NhqeRF[_0x467fd1(0x2ac)](callee);},'WPHTU':NhqeRF[_0x335ca1(0x287)],'mwCyy':function(callee,param1,param2){const _0x4e2db7=_0x335ca1;return NhqeRF[_0x4e2db7(0x459)](callee,param1,param2);},'RlOKr':NhqeRF[_0x335ca1(0x1f9)],'ZEJDO':NhqeRF[_0x335ca1(0x246)],'wbRpY':function(x,y){return x+y;},'qCuaC':_0x335ca1(0x3e4),'BtFvt':_0x335ca1(0x32d),'Kzejf':function(x,y){const _0x3b49c0=_0x335ca1;return NhqeRF[_0x3b49c0(0x41a)](x,y);},'bghNK':_0x335ca1(0x22c),'gbMnu':NhqeRF[_0x335ca1(0x30f)],'QmTHV':NhqeRF[_0x335ca1(0x439)],'nJcQM':function(callee,param1,param2){return callee(param1,param2);},'Iukky':function(x,y){return x+y;},'XzXat':NhqeRF[_0x335ca1(0x188)],'OXVrL':_0x335ca1(0x123),'ikIHm':NhqeRF['oMHXp'],'syjfC':NhqeRF[_0x335ca1(0x3ca)],'vbdop':NhqeRF['xwIPj'],'MJtvv':NhqeRF[_0x335ca1(0x266)],'ydXPF':function(callee,param1,param2){return callee(param1,param2);},'WObKa':_0x335ca1(0x28a),'jQJrh':NhqeRF[_0x335ca1(0x183)],'ZNHCy':_0x335ca1(0x25c),'WjUKk':function(x,y){return NhqeRF['lrvCz'](x,y);},'rMoGw':'w/TTL\x20and\x20delegation\x20date\x20monotonicity\x20checks','KjXxp':NhqeRF['SmXYK'],'JRXbm':NhqeRF[_0x335ca1(0x371)],'bxnse':function(x,y){return x!==y;},'wkZYf':function(callee,param1){return callee(param1);},'jTWlt':NhqeRF[_0x335ca1(0x292)],'TZFGI':_0x335ca1(0x31b),'deiHC':function(callee,param1){const _0x24f418=_0x335ca1;return NhqeRF[_0x24f418(0x19f)](callee,param1);},'kUmUs':function(callee,param1){return callee(param1);},'comyl':function(callee,param1){return callee(param1);},'yrlSp':function(callee,param1){const _0x4a48d8=_0x335ca1;return NhqeRF[_0x4a48d8(0x1b6)](callee,param1);},'ztLqT':NhqeRF[_0x335ca1(0x44a)],'feBqP':function(callee,param1){const _0x3bf095=_0x335ca1;return NhqeRF[_0x3bf095(0x2b7)](callee,param1);},'kLyoO':NhqeRF['mwVBT'],'ZcpOY':function(callee,param1){return callee(param1);},'IpBYA':function(callee,param1,param2){const _0x3124c7=_0x335ca1;return NhqeRF[_0x3124c7(0x316)](callee,param1,param2);},'VfbTu':function(callee,param1,param2){return NhqeRF['lKCzS'](callee,param1,param2);},'suUgL':function(callee,param1,param2){return NhqeRF['KQqOV'](callee,param1,param2);},'pquHx':'should\x20fail\x20to\x20verify\x20a\x20capability\x20with\x20bad\x20`expires`\x20field','VAeVF':function(callee,param1,param2){return callee(param1,param2);},'TTBML':function(callee,param1,param2){return callee(param1,param2);},'smbSG':NhqeRF[_0x335ca1(0x2f7)],'MfnjM':function(x,y){return x+y;},'WkUXv':function(x,y){const _0x1dbd56=_0x335ca1;return NhqeRF[_0x1dbd56(0x3d2)](x,y);},'XuHOy':NhqeRF[_0x335ca1(0x351)],'plHdu':_0x335ca1(0x39f),'LRlht':_0x335ca1(0x3c7),'sCnBY':_0x335ca1(0x1f6),'SwJTh':_0x335ca1(0x255),'xTPPn':'should\x20fail\x20invoking\x20a\x20capability\x20with\x20','NYKqH':_0x335ca1(0x129),'rkrdA':function(callee,param1,param2){return NhqeRF['KQqOV'](callee,param1,param2);},'JpZRj':NhqeRF[_0x335ca1(0x159)],'MGUgs':NhqeRF['RzPkP'],'inVxx':_0x335ca1(0x387),'Oncwp':function(callee,param1,param2){return callee(param1,param2);},'Svlrp':function(callee){return callee();},'jXsih':function(callee,param1){const _0x1568d9=_0x335ca1;return NhqeRF[_0x1568d9(0x2f0)](callee,param1);},'oNCpj':function(callee,param1){return callee(param1);},'XJeeK':function(callee,param1){return callee(param1);},'EVVqh':function(callee,param1){return callee(param1);},'fBNUY':function(callee,param1){return callee(param1);},'UiDGQ':function(callee,param1){const _0x1acd01=_0x335ca1;return NhqeRF[_0x1acd01(0x19f)](callee,param1);},'rNYtM':function(x,y){return x===y;},'eipXy':function(callee,param1,param2){return callee(param1,param2);},'ObCrW':_0x335ca1(0x24c),'FYtMs':function(callee,param1,param2){const _0x269eb5=_0x335ca1;return NhqeRF[_0x269eb5(0x308)](callee,param1,param2);},'hIgkD':function(callee,param1,param2){return callee(param1,param2);},'mERcm':NhqeRF['kOUTo'],'nYTWw':_0x335ca1(0x333),'GXkOX':NhqeRF[_0x335ca1(0x40f)],'oprHp':'should\x20verify\x20when\x20invoking\x20at\x20an\x20exact-match\x20target\x20','THndI':function(x,y){return x+y;},'HwNkc':'target\x20w/path','KuJEJ':function(callee,param1,param2){return callee(param1,param2);},'NWoKI':_0x335ca1(0x39b),'NiAQn':NhqeRF[_0x335ca1(0x1a8)],'TALhw':function(callee,param1,param2){return callee(param1,param2);},'iSXAT':_0x335ca1(0x281),'wOABn':function(x,y){const _0x5e4c50=_0x335ca1;return NhqeRF[_0x5e4c50(0x3ac)](x,y);},'OdFYO':_0x335ca1(0x1f4),'CsPcO':_0x335ca1(0x450),'ZPEtp':_0x335ca1(0x1bc),'IQVnt':_0x335ca1(0x212),'iFoMF':_0x335ca1(0x3dc),'rghFL':function(callee,param1){return callee(param1);},'nlDyU':function(callee,param1){return callee(param1);},'EQERs':NhqeRF['GwBfh'],'OTlUQ':'PbPwp','xtCrk':function(callee,param1){const _0x3b309c=_0x335ca1;return NhqeRF[_0x3b309c(0x19f)](callee,param1);},'CAHSo':function(callee){return callee();},'tsKtJ':function(x,y){const _0x4add68=_0x335ca1;return NhqeRF[_0x4add68(0x2c2)](x,y);},'yTIZt':NhqeRF[_0x335ca1(0x182)],'YhexL':_0x335ca1(0x306),'bZUHB':_0x335ca1(0x29f),'uDeVj':function(callee,param1){return callee(param1);},'uXdgf':function(callee,param1){return callee(param1);},'ubIQp':function(x,y){return NhqeRF['htZmK'](x,y);},'qVtjS':function(callee,param1){return NhqeRF['sAuqy'](callee,param1);},'CuXwT':function(callee,param1){return callee(param1);},'HuzjF':_0x335ca1(0x288),'mwLep':function(callee,param1){return NhqeRF['CnSAG'](callee,param1);},'GbFXk':NhqeRF['rdClW'],'qlkcu':function(x,y){return x+y;},'iJiTC':function(callee,param1){const _0x5550cf=_0x335ca1;return NhqeRF[_0x5550cf(0x1b6)](callee,param1);},'cbyOH':function(x,y){const _0x2d9943=_0x335ca1;return NhqeRF[_0x2d9943(0x35f)](x,y);},'KBWiu':_0x335ca1(0x365),'zCbXH':function(callee,param1){const _0x44f483=_0x335ca1;return NhqeRF[_0x44f483(0x2b7)](callee,param1);},'HyTwL':function(callee,param1){return callee(param1);},'DKOUf':function(callee){return callee();},'PTpiN':_0x335ca1(0x145),'tNZxN':_0x335ca1(0x45e),'ROxfF':function(callee){const _0x10ce32=_0x335ca1;return NhqeRF[_0x10ce32(0x2b8)](callee);},'cvCji':NhqeRF[_0x335ca1(0x16d)],'cAAmZ':function(callee){return callee();},'LywyJ':_0x335ca1(0x3ec),'mHhWw':function(callee,param1){const _0xe54bc9=_0x335ca1;return NhqeRF[_0xe54bc9(0x1b6)](callee,param1);},'vKTij':function(callee,param1){const _0x295015=_0x335ca1;return NhqeRF[_0x295015(0x2f0)](callee,param1);},'NIShA':NhqeRF[_0x335ca1(0x385)],'lsgZK':_0x335ca1(0x3bc),'KhhmB':_0x335ca1(0x282),'dAaJD':function(callee,param1){const _0x5b06c9=_0x335ca1;return NhqeRF[_0x5b06c9(0x1b6)](callee,param1);},'vbdBz':NhqeRF[_0x335ca1(0x2a9)],'qPAMC':function(callee,param1){return callee(param1);},'SHTMD':_0x335ca1(0x377),'wbOcL':function(callee,param1,param2){const _0x109715=_0x335ca1;return NhqeRF[_0x109715(0x323)](callee,param1,param2);},'ivjXa':NhqeRF[_0x335ca1(0x34a)],'qFWiI':function(callee,param1){return callee(param1);},'NDpdi':function(callee){return NhqeRF['MDceK'](callee);},'OuxQX':function(callee,param1){return callee(param1);},'JdODy':function(x,y){return x+y;},'FFSQw':NhqeRF[_0x335ca1(0x43a)],'bDwAF':function(callee,param1){return callee(param1);},'kkdpT':function(callee,param1,param2){const _0x3a5377=_0x335ca1;return NhqeRF[_0x3a5377(0x1be)](callee,param1,param2);},'UXwEc':_0x335ca1(0x1c9),'JXQpI':function(callee,param1,param2){return callee(param1,param2);},'vqvDE':function(x,y){const _0x299d9d=_0x335ca1;return NhqeRF[_0x299d9d(0x29a)](x,y);},'afpgA':'should\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','bmvsp':function(callee,param1,param2){return NhqeRF['OVSxT'](callee,param1,param2);},'blGMP':function(x,y){return x+y;},'mNQzw':NhqeRF[_0x335ca1(0x3ae)],'CDSht':_0x335ca1(0x443),'XQYVR':'no\x20`expectedRootCapability`\x20is\x20given','rtfAa':NhqeRF['QPNKo'],'NNxpN':NhqeRF[_0x335ca1(0x3c6)],'Qmsep':NhqeRF[_0x335ca1(0x3bf)],'VWeAF':_0x335ca1(0x231),'IqOwX':'\x22read\x22\x20expected\x20action','GLhZt':function(x,y){const _0x2f83c3=_0x335ca1;return NhqeRF[_0x2f83c3(0x3f5)](x,y);},'HyAKx':_0x335ca1(0x1c2),'tWObS':NhqeRF[_0x335ca1(0x43e)],'pdSPl':function(callee,param1,param2){return callee(param1,param2);},'rdYHf':function(x,y){const _0x136998=_0x335ca1;return NhqeRF[_0x136998(0x3d2)](x,y);},'TJnnF':_0x335ca1(0x3f3),'ndZSv':_0x335ca1(0x29c),'zuQDL':function(callee,param1,param2){return NhqeRF['sMfBH'](callee,param1,param2);},'uAEjb':_0x335ca1(0x321)};NhqeRF[_0x335ca1(0x459)](describe,_0x335ca1(0x293),()=>{const _0x2ec090=_0x335ca1,PojhDZ={'MFTmN':function(callee,param1){return callee(param1);},'DcuFe':function(callee,param1){const _0xa3e683=_0x3b69;return GcDKxy[_0xa3e683(0x206)](callee,param1);}};it(GcDKxy[_0x2ec090(0x17c)],async()=>{const _0x2cf707=_0x2ec090,doc=GcDKxy[_0x2cf707(0x45b)](clone,mock[_0x2cf707(0x357)]),signed=await GcDKxy[_0x2cf707(0x40d)](_invoke,{'doc':doc,'invoker':alice,'date':CONSTANT_DATE,'capability':capabilities[_0x2cf707(0x1d8)][_0x2cf707(0x2c9)],'capabilityAction':GcDKxy['JQKVh']});expect(signed)['to'][_0x2cf707(0x39c)][_0x2cf707(0x1bb)](mock[_0x2cf707(0x432)][_0x2cf707(0x2c9)]);}),it(GcDKxy[_0x2ec090(0x1ab)],async()=>{const _0x118555=_0x2ec090,doc=clone(mock[_0x118555(0x357)]),signed=await _invoke({'doc':doc,'invoker':alice,'date':CONSTANT_DATE,'capability':capabilities[_0x118555(0x1d8)]['beta'],'capabilityAction':_0x118555(0x3c8)});GcDKxy[_0x118555(0x1a5)](expect,signed)['to']['deep'][_0x118555(0x1bb)](mock[_0x118555(0x432)][_0x118555(0x3a5)]);}),it(_0x2ec090(0x214),async()=>{const _0x61f5f5=_0x2ec090;let err;try{const doc=clone(mock[_0x61f5f5(0x357)]);await PojhDZ[_0x61f5f5(0x223)](_invoke,{'doc':doc,'invoker':alice,'purposeOptions':{}});}catch(e){err=e;}PojhDZ[_0x61f5f5(0x2f2)](expect,err)['to'][_0x61f5f5(0x290)],expect(err['message'])['to'][_0x61f5f5(0x1bb)]('\x22capability\x22\x20must\x20be\x20a\x20string\x20or\x20object.');}),it(GcDKxy[_0x2ec090(0x17a)],async()=>{const _0x579ce1=_0x2ec090;let err;try{const doc=GcDKxy[_0x579ce1(0x40d)](clone,mock[_0x579ce1(0x357)]);await _invoke({'doc':doc,'invoker':alice,'purposeOptions':{'capability':_0x579ce1(0x327)}});}catch(e){err=e;}expect(err)['to'][_0x579ce1(0x290)],expect(err[_0x579ce1(0x2ce)])['to'][_0x579ce1(0x1bb)](GcDKxy[_0x579ce1(0x175)]);}),GcDKxy[_0x2ec090(0x137)](it,_0x2ec090(0x3a8),async()=>{const _0x46e106=_0x2ec090;let err;try{const doc=GcDKxy['YMsST'](clone,mock['exampleDoc']);await GcDKxy['xuSgz'](_invoke,{'doc':doc,'invoker':alice,'purposeOptions':{'capability':GcDKxy[_0x46e106(0x2f5)],'capabilityAction':_0x46e106(0x3c8)}});}catch(e){err=e;}GcDKxy[_0x46e106(0x40d)](expect,err)['to'][_0x46e106(0x290)],GcDKxy['TlWWQ'](expect,err[_0x46e106(0x2ce)])['to'][_0x46e106(0x1bb)]('\x22invocationTarget\x22\x20must\x20be\x20a\x20string\x20that\x20expresses\x20an\x20absolute\x20URI.');});}),NhqeRF[_0x335ca1(0x308)](describe,NhqeRF[_0x335ca1(0x22f)],()=>{const _0x16831a=_0x335ca1,iJZtvX={'psgSP':_0x16831a(0x43f),'JFKPH':_0x16831a(0x2b4),'NLwIW':GcDKxy[_0x16831a(0x1d6)],'WizAV':function(callee,param1){return GcDKxy['GHLHg'](callee,param1);}};GcDKxy[_0x16831a(0x137)](it,GcDKxy[_0x16831a(0x3e6)],async()=>{const _0x3d385e=_0x16831a,newCapability={'@context':ZCAP_CONTEXT_URL,'id':_0x3d385e(0x376),'controller':bob[_0x3d385e(0x18c)](GcDKxy[_0x3d385e(0x416)],0x0)['id'],'parentCapability':capabilities['root']['alpha']['id'],'invocationTarget':capabilities[_0x3d385e(0x1d8)][_0x3d385e(0x2c9)][_0x3d385e(0x449)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'parentCapability':capabilities[_0x3d385e(0x1d8)][_0x3d385e(0x2c9)],'delegator':alice,'date':CONSTANT_DATE});expect(delegatedCapability)['to'][_0x3d385e(0x39c)][_0x3d385e(0x1bb)](capabilities[_0x3d385e(0x1f7)][_0x3d385e(0x2c9)]);}),GcDKxy['oqedG'](it,GcDKxy[_0x16831a(0x342)],async()=>{const _0x2aef35=_0x16831a;if(iJZtvX[_0x2aef35(0x186)]===iJZtvX[_0x2aef35(0x186)]){const newCapability={'@context':ZCAP_CONTEXT_URL,'id':iJZtvX[_0x2aef35(0x2c8)],'controller':bob['id'](),'parentCapability':capabilities[_0x2aef35(0x1d8)][_0x2aef35(0x3a5)]['id'],'invocationTarget':capabilities['root'][_0x2aef35(0x3a5)][_0x2aef35(0x449)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'parentCapability':capabilities[_0x2aef35(0x1d8)][_0x2aef35(0x3a5)],'delegator':alice,'date':CONSTANT_DATE});expect(delegatedCapability)['to'][_0x2aef35(0x39c)][_0x2aef35(0x1bb)](capabilities[_0x2aef35(0x1f7)][_0x2aef35(0x3a5)]);}else{const USGGOi=iJZtvX[_0x2aef35(0x12e)]['split']('|');let uAXbIc=0x0;while(!![]){switch(USGGOi[uAXbIc++]){case'0':_0x423fa0[_0x2aef35(0x373)]['be']['an'](_0x2aef35(0x2ea));continue;case'1':_0x151e26({'capabilityChain':_0xf1a72d});continue;case'2':_0x414476['should'][_0x2aef35(0x42e)][_0x2aef35(0x2a8)](0x4);continue;case'3':_0x108c5b({'capabilityChainMeta':_0x2f6610});continue;case'4':new _0x3e8936('var\x20x\x20=\x2042;\x20return\x20x;')();continue;case'5':_0x1c3229[_0x2aef35(0x373)]['be']['an'](_0x2aef35(0x2ea));continue;case'6':return{'valid':!![]};case'7':_0xfdf720[_0x2aef35(0x373)]['have'][_0x2aef35(0x2a8)](0x4);continue;case'8':_0x1cb147++;continue;}break;}}}),GcDKxy[_0x16831a(0x36d)](it,GcDKxy[_0x16831a(0x26c)],async()=>{const _0x3197e7=_0x16831a;let err;try{const doc=iJZtvX[_0x3197e7(0x2e9)](clone,mock[_0x3197e7(0x357)]);await iJZtvX[_0x3197e7(0x2e9)](_delegate,{'newCapability':doc,'delegator':alice,'purposeOptions':{}});}catch(e){err=e;}expect(err)['to'][_0x3197e7(0x290)],expect(err['message'])['to'][_0x3197e7(0x1bb)](_0x3197e7(0x24e)+_0x3197e7(0x44f));}),it(GcDKxy['FKUdJ'],async()=>{const _0x42dc02=_0x16831a,HLwdkT={'MHvPk':'array'};if(GcDKxy[_0x42dc02(0x468)]===GcDKxy[_0x42dc02(0x468)]){const newCapability={'@context':ZCAP_CONTEXT_URL,'id':'urn:uuid:710910c8-61e4-11ec-8739-10bf48838a41','controller':bob['id'](),'parentCapability':capabilities[_0x42dc02(0x1d8)]['beta']['id'],'invocationTarget':capabilities[_0x42dc02(0x1d8)][_0x42dc02(0x3a5)][_0x42dc02(0x449)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'delegator':alice,'date':CONSTANT_DATE,'purposeOptions':{'parentCapability':capabilities[_0x42dc02(0x1d8)][_0x42dc02(0x3a5)]}});GcDKxy['TlWWQ'](expect,delegatedCapability)['to'][_0x42dc02(0x39c)][_0x42dc02(0x1bb)](capabilities[_0x42dc02(0x1f7)][_0x42dc02(0x3a5)]);}else{const ZjxpIK={'lDeFT':function(x,y){return x+y;}};return _0x499416++,_0x21fc61[_0x42dc02(0x373)]['be']['an'](HLwdkT[_0x42dc02(0x33f)]),_0x405ae8[_0x42dc02(0x373)][_0x42dc02(0x42e)][_0x42dc02(0x2a8)](0x3),_0x25291d({'capabilityChain':_0x41c7cd}),_0xe76672({'capabilityChainMeta':_0x4da92c}),eval('const _0x388190 = _0x42dc02;ZjxpIK[_0x388190(845)](1, 1);'),{'error':new _0x2f09eb(_0x42dc02(0x3f4)+_0x304dbf[0x0]['id']+'\x22\x20'+'has\x20been\x20revoked.'),'valid':![]};}});}),NhqeRF['OVSxT'](context,NhqeRF[_0x335ca1(0x2fe)],()=>{const _0x4a4731=_0x335ca1,ahGIai={'ppiVO':function(callee,param1){const _0x214cc5=_0x3b69;return NhqeRF[_0x214cc5(0x1b6)](callee,param1);},'QffVQ':'capabilityInvocation','UcLKD':function(x,y){return x===y;},'HJbvv':NhqeRF['cqhhg'],'LExmw':function(callee,param1){return callee(param1);}};NhqeRF['dNJAl'](NhqeRF[_0x4a4731(0x21b)],'okltd')?_0x365b73[_0x4a4731(0x310)]({'safe':!![]}):(NhqeRF['KQqOV'](it,'should\x20verify\x20an\x20invoked\x20root\x20capability',async()=>{const _0x468253=_0x4a4731,result=await GcDKxy[_0x468253(0x165)](_verifyInvocation,{'invocation':mock[_0x468253(0x432)][_0x468253(0x2c9)],'rootCapability':capabilities['root']['alpha'],'expectedAction':GcDKxy[_0x468253(0x202)]});expect(result)['to']['exist'],expect(result[_0x468253(0x2d1)])['to']['be'][_0x468253(0x199)];}),NhqeRF['lKCzS'](it,'should\x20verify\x20w/array\x20expected\x20target',async()=>{const _0x6a6eb5=_0x4a4731,result=await GcDKxy['YMsST'](_verifyInvocation,{'invocation':mock[_0x6a6eb5(0x432)][_0x6a6eb5(0x2c9)],'purposeOptions':{'expectedAction':'read','expectedRootCapability':capabilities[_0x6a6eb5(0x1d8)][_0x6a6eb5(0x2c9)]['id'],'expectedTarget':[capabilities[_0x6a6eb5(0x1d8)][_0x6a6eb5(0x2c9)][_0x6a6eb5(0x449)]]}});expect(result)['to']['exist'],expect(result[_0x6a6eb5(0x2d1)])['to']['be'][_0x6a6eb5(0x199)];}),it(_0x4a4731(0x28d),async()=>{const _0x402420=_0x4a4731,delegatedCapability=await ahGIai[_0x402420(0x3a3)](_delegate,{'parentCapability':capabilities['root'][_0x402420(0x2c9)],'controller':bob['get'](ahGIai['QffVQ'],0x0)['id'],'delegator':alice}),result=await ahGIai['ppiVO'](_verifyDelegation,{'delegation':delegatedCapability,'expectedRootCapability':capabilities[_0x402420(0x1d8)]['alpha']['id']});expect(result)['to'][_0x402420(0x290)],expect(result[_0x402420(0x2d1)])['to']['be'][_0x402420(0x199)];}),NhqeRF['lKCzS'](it,_0x4a4731(0x1b8)+_0x4a4731(0x32b),async()=>{const _0x3daca8=_0x4a4731;if(GcDKxy[_0x3daca8(0x3b3)](_0x3daca8(0x315),_0x3daca8(0x315)))_0x47c934=_0x4569c2;else{const delegatedCapability=await _delegate({'parentCapability':capabilities[_0x3daca8(0x1d8)][_0x3daca8(0x2c9)],'controller':bob[_0x3daca8(0x18c)](_0x3daca8(0x21a),0x0)['id'],'delegator':alice}),result=await GcDKxy['NhnOh'](_verifyDelegation,{'delegation':delegatedCapability,'expectedRootCapability':_0x3daca8(0x319)});GcDKxy[_0x3daca8(0x206)](expect,result)['to']['exist'],expect(result['verified'])['to']['be'][_0x3daca8(0x2f9)],result['error'][_0x3daca8(0x2d5)][_0x3daca8(0x373)][_0x3daca8(0x1bb)]('VerificationError');const [error]=result['error'][_0x3daca8(0x220)];error[_0x3daca8(0x2ce)][_0x3daca8(0x373)][_0x3daca8(0x3fa)](GcDKxy[_0x3daca8(0x2ec)]);}}),NhqeRF[_0x4a4731(0x323)](it,'should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202',async()=>{const _0x5d0e3f=_0x4a4731;if(ahGIai[_0x5d0e3f(0x238)](ahGIai[_0x5d0e3f(0x2fc)],_0x5d0e3f(0x173))){const delegatedCapability=await _delegate({'parentCapability':capabilities[_0x5d0e3f(0x1d8)][_0x5d0e3f(0x2c9)],'controller':bob[_0x5d0e3f(0x18c)](ahGIai[_0x5d0e3f(0x1d7)],0x0)['id'],'delegator':alice}),doc=clone(mock[_0x5d0e3f(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x5d0e3f(0x3c8)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x5d0e3f(0x1d8)][_0x5d0e3f(0x2c9)],'expectedAction':_0x5d0e3f(0x3c8)});expect(result)['to'][_0x5d0e3f(0x290)],ahGIai[_0x5d0e3f(0x366)](expect,result[_0x5d0e3f(0x2d1)])['to']['be']['true'];}else _0x4cdc93=_0x3f148c;}));}),context(_0x335ca1(0x384),()=>{const _0xae883a=_0x335ca1,FXcoRt={'Loefh':function(callee,param1){const _0x566000=_0x3b69;return GcDKxy[_0x566000(0x24a)](callee,param1);},'rQybj':function(callee){return callee();},'VoakD':GcDKxy['JQKVh'],'JPuUm':function(callee,param1){const _0x1c8f3c=_0x3b69;return GcDKxy[_0x1c8f3c(0x314)](callee,param1);},'UxlkV':function(callee,param1){return callee(param1);},'QRdYV':_0xae883a(0x25f),'bRUoj':function(x,y){return x!==y;},'AWPBl':'Ptkia','TpUWf':GcDKxy[_0xae883a(0x41c)],'ABaYG':GcDKxy[_0xae883a(0x134)],'RFbTI':'https://zcap.example/target2','AnFUM':function(callee,param1){const _0x3064f8=_0xae883a;return GcDKxy[_0x3064f8(0x3c4)](callee,param1);},'zKWwD':'array','yPHLo':function(x,y){return x===y;},'wJmUT':_0xae883a(0x369),'wSAtN':function(callee,param1){return callee(param1);},'pDNGp':function(callee,param1){return callee(param1);},'yEhDv':function(callee,param1){return callee(param1);},'DitCJ':_0xae883a(0x421),'tuIaN':_0xae883a(0x442),'jnyxA':function(callee,param1){return callee(param1);},'MYfzT':function(callee,param1){return callee(param1);},'hWEQW':function(callee,param1){return callee(param1);},'zwICO':function(callee){const _0x1ab974=_0xae883a;return GcDKxy[_0x1ab974(0x234)](callee);},'SzHWo':GcDKxy[_0xae883a(0x170)],'NrqAc':_0xae883a(0x312),'JPTnj':function(callee){const _0x3b14a9=_0xae883a;return GcDKxy[_0x3b14a9(0x311)](callee);},'NZEaC':function(callee,param1){const _0x5be181=_0xae883a;return GcDKxy[_0x5be181(0x45b)](callee,param1);},'xHQcf':_0xae883a(0x1ad),'DYYSb':function(x,y){const _0x2c6bad=_0xae883a;return GcDKxy[_0x2c6bad(0x3ee)](x,y);},'InOYh':_0xae883a(0x256),'evaZq':GcDKxy['yTIZt'],'fXpZo':function(x,y){return x===y;},'bMRCY':_0xae883a(0x163),'eDKuh':function(callee,param1){const _0x454a2a=_0xae883a;return GcDKxy[_0x454a2a(0x405)](callee,param1);},'aghRM':function(callee,param1){return callee(param1);},'ZDZbg':function(callee){return callee();},'cMhOJ':_0xae883a(0x42a),'cBuns':GcDKxy[_0xae883a(0x2e3)],'nFFgl':function(x,y){return x+y;},'fqDDG':'The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','XweYH':GcDKxy[_0xae883a(0x1a7)],'ALNde':function(callee,param1){return callee(param1);},'oNAVJ':function(callee,param1){const _0x1074ca=_0xae883a;return GcDKxy[_0x1074ca(0x34b)](callee,param1);},'RMDpQ':function(callee,param1){return callee(param1);},'qTCHZ':function(callee,param1){const _0x5cb5aa=_0xae883a;return GcDKxy[_0x5cb5aa(0x38f)](callee,param1);},'heAjV':function(callee,param1){const _0x836ba1=_0xae883a;return GcDKxy[_0x836ba1(0x318)](callee,param1);},'wUWqf':function(callee,param1){return GcDKxy['uXdgf'](callee,param1);},'OHDsv':function(x,y){const _0x400d7b=_0xae883a;return GcDKxy[_0x400d7b(0x2cd)](x,y);},'Lkxiu':function(x,y){return x*y;},'AWFVE':function(x,y){return GcDKxy['ubIQp'](x,y);},'ByXuc':function(x,y){return x+y;},'JvjrU':function(callee,param1){return callee(param1);},'AyWxk':function(callee,param1){return GcDKxy['qVtjS'](callee,param1);},'tDYwx':function(callee){return callee();},'qaOrw':function(callee,param1){const _0x306c00=_0xae883a;return GcDKxy[_0x306c00(0x27f)](callee,param1);},'TwDwU':function(callee,param1){const _0x571be2=_0xae883a;return GcDKxy[_0x571be2(0x230)](callee,param1);},'DFCxB':'Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date','gqHwr':function(callee){return GcDKxy['iqKti'](callee);},'wZyAI':function(callee,param1){const _0x4a4e6b=_0xae883a;return GcDKxy[_0x4a4e6b(0x149)](callee,param1);},'RSQTU':'time\x20to\x20live\x20that\x20is\x20too\x20long','lOhDC':GcDKxy[_0xae883a(0x434)],'XzidD':_0xae883a(0x425),'qZUjj':function(callee){return callee();},'XQXwV':GcDKxy[_0xae883a(0x245)],'npHHz':_0xae883a(0x362),'iopVP':_0xae883a(0x447),'dtcyc':function(callee,param1){return GcDKxy['mwLep'](callee,param1);},'ONgYJ':_0xae883a(0x161),'OPPPO':function(callee,param1){return callee(param1);},'otUYc':GcDKxy['GbFXk'],'nARVx':_0xae883a(0x13c),'KMkWR':function(callee,param1){return callee(param1);},'NDkIy':function(x,y){const _0x436472=_0xae883a;return GcDKxy[_0x436472(0x3dd)](x,y);},'NgeLy':function(callee,param1){return GcDKxy['iJiTC'](callee,param1);},'TZKDD':function(x,y){return GcDKxy['cbyOH'](x,y);},'rzgUP':function(callee,param1){return GcDKxy['TukHI'](callee,param1);},'bHDPN':function(callee,param1){return callee(param1);},'Dftnj':'zQPoG','EajXM':GcDKxy[_0xae883a(0x132)],'lDqIn':_0xae883a(0x197),'jdFkL':function(callee,param1){const _0x4eda17=_0xae883a;return GcDKxy[_0x4eda17(0x409)](callee,param1);},'wLCDk':function(callee,param1){const _0x865bef=_0xae883a;return GcDKxy[_0x865bef(0x3e0)](callee,param1);},'xkRnH':function(callee,param1){return GcDKxy['HyTwL'](callee,param1);},'BtDPX':_0xae883a(0x340),'SqEdf':function(callee){const _0x1c5463=_0xae883a;return GcDKxy[_0x1c5463(0x38b)](callee);},'hVJsp':_0xae883a(0x257),'rHNXg':_0xae883a(0x449),'qrjLE':function(callee){return GcDKxy['DKOUf'](callee);},'zYfsV':GcDKxy[_0xae883a(0x320)],'dHplb':'BccKE','YxiFj':GcDKxy[_0xae883a(0x1b1)],'IVPCq':function(callee){return GcDKxy['ROxfF'](callee);},'DptPl':_0xae883a(0x410),'LAzsb':GcDKxy['cvCji'],'TZKKP':function(x,y){return x+y;},'VViZr':function(x,y){return x*y;},'pkTQb':function(callee){const _0x50b435=_0xae883a;return GcDKxy[_0x50b435(0x20e)](callee);},'MJNiX':GcDKxy[_0xae883a(0x3c2)],'xgMqR':function(callee,param1){return GcDKxy['uDeVj'](callee,param1);},'vnSeL':function(callee,param1){return callee(param1);},'IUIbS':'urn:zcap:cbddee5a-09fb-44db-a921-70c36436c253','dnYDu':function(callee,param1){const _0x50514c=_0xae883a;return GcDKxy[_0x50514c(0x36f)](callee,param1);},'QTqsC':function(callee,param1){return callee(param1);},'YfDjA':'urn:zcap:1e7dfae9-85a3-40d7-97ea-20105f0b9d99','krHJi':function(x,y){return x+y;},'RMSRm':function(callee,param1){const _0xe028aa=_0xae883a;return GcDKxy[_0xe028aa(0x2a4)](callee,param1);},'WwpmC':GcDKxy[_0xae883a(0x252)],'jQnqn':GcDKxy[_0xae883a(0x2ca)],'EeIKD':_0xae883a(0x2c7),'MuEUI':function(callee,param1){return callee(param1);},'JBIfK':_0xae883a(0x1ff),'oHRqq':function(callee,param1){const _0x1ab8fa=_0xae883a;return GcDKxy[_0x1ab8fa(0x233)](callee,param1);},'ngFNe':function(callee,param1){return callee(param1);},'RFlAC':GcDKxy[_0xae883a(0x39a)],'dcrWi':function(x,y){return x-y;},'poNyW':function(callee){const _0x577c91=_0xae883a;return GcDKxy[_0x577c91(0x3f9)](callee);},'IGQQD':function(callee,param1){return GcDKxy['dAaJD'](callee,param1);},'ckvDE':function(callee,param1){return callee(param1);},'STVGG':_0xae883a(0x324),'KVBJe':function(callee,param1){const _0x4954dc=_0xae883a;return GcDKxy[_0x4954dc(0x414)](callee,param1);},'FuCdb':GcDKxy[_0xae883a(0x343)],'FUtLJ':function(callee,param1){const _0x5c76a1=_0xae883a;return GcDKxy[_0x5c76a1(0x2e6)](callee,param1);},'NeKXS':function(callee,param1){return callee(param1);},'LWaPT':GcDKxy[_0xae883a(0x392)],'pSYOX':function(callee,param1,param2){const _0x2a4c42=_0xae883a;return GcDKxy[_0x2a4c42(0x21e)](callee,param1,param2);},'NBBzs':GcDKxy[_0xae883a(0x3ea)],'cxhfy':function(callee,param1,param2){return callee(param1,param2);},'PawFV':GcDKxy['ivjXa'],'iYdbG':function(callee,param1,param2){return callee(param1,param2);},'XoVHe':'https://example.com/edvs/cc8b09fd-76e2-4fae-9bdd-2522b83a2971','gGyui':function(callee,param1){return callee(param1);},'qxWom':function(callee,param1){return callee(param1);},'JWvDd':function(callee,param1){const _0x2535ab=_0xae883a;return GcDKxy[_0x2535ab(0x409)](callee,param1);},'VCdCj':_0xae883a(0x141),'SfFfl':function(callee,param1){return callee(param1);},'cwEYT':function(callee,param1){const _0x30d04f=_0xae883a;return GcDKxy[_0x30d04f(0x180)](callee,param1);},'RVtiG':function(callee,param1){const _0x1766d6=_0xae883a;return GcDKxy[_0x1766d6(0x249)](callee,param1);},'HyIzm':function(callee){const _0x307d27=_0xae883a;return GcDKxy[_0x307d27(0x411)](callee);},'ThQki':function(callee,param1){return callee(param1);},'qxscz':function(callee,param1){return GcDKxy['oNCpj'](callee,param1);},'WOfmz':function(callee){const _0x597f4e=_0xae883a;return GcDKxy[_0x597f4e(0x127)](callee);},'HGKOO':function(callee,param1){return callee(param1);},'ZVytv':function(callee){return callee();},'DKhec':function(callee,param1){const _0x148d00=_0xae883a;return GcDKxy[_0x148d00(0x15d)](callee,param1);},'hHFoM':function(callee,param1){return callee(param1);},'EaStC':function(callee,param1){return callee(param1);},'xTPFk':function(callee,param1){return callee(param1);},'OaAUa':function(callee,param1){const _0x2877d9=_0xae883a;return GcDKxy[_0x2877d9(0x2e6)](callee,param1);},'NceiY':function(callee,param1){return callee(param1);},'fgabE':function(callee,param1){const _0x274372=_0xae883a;return GcDKxy[_0x274372(0x437)](callee,param1);},'mIcJz':function(x,y){return GcDKxy['JdODy'](x,y);},'NIQCj':GcDKxy[_0xae883a(0x264)],'jJuPb':function(callee,param1){const _0x122acb=_0xae883a;return GcDKxy[_0x122acb(0x36c)](callee,param1);},'NeiDb':function(callee,param1){return callee(param1);},'MCUjg':_0xae883a(0x34e),'kGXzO':function(callee,param1){return callee(param1);},'JEEIc':function(callee,param1){return callee(param1);},'VXDRw':function(callee,param1){return callee(param1);}};GcDKxy[_0xae883a(0x1b0)](it,GcDKxy[_0xae883a(0x3bb)],async()=>{const _0x3a821a=_0xae883a;if(GcDKxy[_0x3a821a(0x243)](GcDKxy[_0x3a821a(0x35b)],'hUxhz')){const result=await GcDKxy['xWPjS'](_verifyInvocation,{'invocation':mock[_0x3a821a(0x432)][_0x3a821a(0x3a5)],'rootCapability':capabilities['root']['beta'],'expectedAction':GcDKxy['JQKVh']});expect(result)['to'][_0x3a821a(0x290)],expect(result[_0x3a821a(0x2d1)])['to']['be']['true'];}else _0x43dce4=new _0x2872c7({'parentCapability':_0x4b2454,'_capabilityChain':_0x3eebc4});}),GcDKxy[_0xae883a(0x36b)](it,_0xae883a(0x3b7),async()=>{const _0x4bcf83=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':_0x4bcf83(0x2e7),'invocationTarget':'urn:some:invocation:target'};addToLoader({'doc':root});const result=await FXcoRt['Loefh'](_verifyDelegation,{'delegation':root,'expectedRootCapability':root['id']});expect(result)['to']['exist'],expect(result[_0x4bcf83(0x2d1)])['to']['be'][_0x4bcf83(0x2f9)];}),GcDKxy[_0xae883a(0x36d)](it,'should\x20fail\x20to\x20invoke\x20a\x20root\x20zcap\x20with\x20no\x20controller',async()=>{const _0x32f97c=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'invocationTarget':uuid()};addToLoader({'doc':root});const doc={'@context':ZCAP_CONTEXT_URL,'example:foo':GcDKxy[_0x32f97c(0x3f9)](uuid)},invocation=await _invoke({'doc':doc,'invoker':alpha,'capability':root,'capabilityAction':_0x32f97c(0x3c8)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':_0x32f97c(0x3c8)});GcDKxy[_0x32f97c(0x40d)](expect,result)['to'][_0x32f97c(0x290)],expect(result['verified'])['to']['be'][_0x32f97c(0x2f9)],result[_0x32f97c(0x17e)][_0x32f97c(0x2d5)]['should'][_0x32f97c(0x1bb)](_0x32f97c(0x421));const [error]=result[_0x32f97c(0x17e)]['errors'];error[_0x32f97c(0x2ce)][_0x32f97c(0x373)][_0x32f97c(0x3fa)](GcDKxy[_0x32f97c(0x280)]);}),GcDKxy[_0xae883a(0x31c)](it,_0xae883a(0x34c)+_0xae883a(0x1c8),async()=>{const _0xb3f403=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':GcDKxy[_0xb3f403(0x38b)](uuid),'controller':bob['id'](),'invocationTarget':GcDKxy[_0xb3f403(0x38b)](uuid)};GcDKxy[_0xb3f403(0x1a5)](addToLoader,{'doc':root});const doc=clone(mock[_0xb3f403(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':_0xb3f403(0x3c8)}),result=await GcDKxy[_0xb3f403(0x1a5)](_verifyInvocation,{'invocation':invocation,'rootCapability':root,'expectedAction':GcDKxy[_0xb3f403(0x202)]});GcDKxy[_0xb3f403(0x1bf)](expect,result)['to'][_0xb3f403(0x290)],expect(result['verified'])['to']['be'][_0xb3f403(0x199)];}),GcDKxy['mwCyy'](it,GcDKxy['vqvDE'](GcDKxy[_0xae883a(0x348)],'a\x20matching\x20`expectedRootCapability`\x20array\x20is\x20given'),async()=>{const _0x33769b=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'invocationTarget':FXcoRt[_0x33769b(0x2cc)](uuid),'controller':bob['id']()};addToLoader({'doc':root});const doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':FXcoRt[_0x33769b(0x2ff)]}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':FXcoRt[_0x33769b(0x2ff)],'expectedRootCapability':[root['id']],'expectedTarget':root[_0x33769b(0x449)]}});FXcoRt[_0x33769b(0x177)](expect,result)['to']['exist'],expect(result[_0x33769b(0x2d1)])['to']['be'][_0x33769b(0x199)];}),GcDKxy['bmvsp'](it,GcDKxy[_0xae883a(0x216)](GcDKxy['mNQzw'],GcDKxy['CDSht']),async()=>{const _0x3e918b=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'invocationTarget':uuid()};FXcoRt[_0x3e918b(0x154)](addToLoader,{'doc':root});const doc=FXcoRt[_0x3e918b(0x22a)](clone,mock[_0x3e918b(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':FXcoRt['VoakD']}),expectedRootCapability=[root['id'][_0x3e918b(0x158)](FXcoRt['QRdYV'],'')];let result,error;try{FXcoRt[_0x3e918b(0x441)](FXcoRt['AWPBl'],_0x3e918b(0x2b5))?result=await FXcoRt[_0x3e918b(0x177)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x3e918b(0x3c8),'expectedRootCapability':expectedRootCapability,'expectedTarget':root[_0x3e918b(0x449)]}}):_0x4eea0a=_0x5924c2;}catch(e){error=e;}expect(result)['to'][_0x3e918b(0x3a7)][_0x3e918b(0x290)],expect(error)['to']['exist'],error['message'][_0x3e918b(0x373)][_0x3e918b(0x3fa)](FXcoRt[_0x3e918b(0x1f8)]);}),GcDKxy[_0xae883a(0x157)](it,GcDKxy[_0xae883a(0x1f0)]+GcDKxy[_0xae883a(0x2f1)],async()=>{const _0x4da0c0=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':GcDKxy['ufEFt'](uuid),'controller':bob['id'](),'invocationTarget':GcDKxy[_0x4da0c0(0x38b)](uuid)};GcDKxy[_0x4da0c0(0x307)](addToLoader,{'doc':root});const doc=clone(mock[_0x4da0c0(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':_0x4da0c0(0x3c8)});let error,result;try{result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':GcDKxy[_0x4da0c0(0x202)],'expectedTarget':root[_0x4da0c0(0x449)]}});}catch(e){error=e;}expect(result)['to']['not']['exist'],expect(error)['to'][_0x4da0c0(0x290)],error['name'][_0x4da0c0(0x373)][_0x4da0c0(0x1bb)]('TypeError'),error[_0x4da0c0(0x2ce)][_0x4da0c0(0x373)][_0x4da0c0(0x3fa)](_0x4da0c0(0x200));}),it(GcDKxy[_0xae883a(0x2fd)],async()=>{const _0x39d2df=_0xae883a;if(FXcoRt[_0x39d2df(0x441)](FXcoRt[_0x39d2df(0x268)],_0x39d2df(0x358))){const doc={'@context':ZCAP_CONTEXT_URL,'example:foo':uuid()},target1=_0x39d2df(0x1ac),target2=FXcoRt[_0x39d2df(0x375)],invocation1=await FXcoRt[_0x39d2df(0x2b6)](_invoke,{'doc':doc,'invoker':alice,'purposeOptions':{'capability':capabilities[_0x39d2df(0x1d8)][_0x39d2df(0x2cb)]['id'],'capabilityAction':FXcoRt[_0x39d2df(0x2ff)],'invocationTarget':target1}}),invocation2=await _invoke({'doc':invocation1,'invoker':alice,'purposeOptions':{'capability':capabilities['root'][_0x39d2df(0x2cb)]['id'],'capabilityAction':'read','invocationTarget':target2}}),result=await jsigs['verify'](invocation2,{'suite':new Ed25519Signature2020(),'purpose':[new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':_0x39d2df(0x3c8),'expectedRootCapability':capabilities['root']['restful']['id'],'expectedTarget':[capabilities[_0x39d2df(0x1d8)]['restful'][_0x39d2df(0x449)],target1]}),new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':_0x39d2df(0x3c8),'expectedRootCapability':capabilities[_0x39d2df(0x1d8)]['restful']['id'],'expectedTarget':[capabilities['root'][_0x39d2df(0x2cb)][_0x39d2df(0x449)],target2]})],'documentLoader':testLoader});expect(result)['to'][_0x39d2df(0x290)],FXcoRt[_0x39d2df(0x2b6)](expect,result['verified'])['to']['be']['true'];}else _0x3a5290=new _0x37c6bc({'expectedTarget':_0x2f10bc[_0x39d2df(0x449)],'expectedRootCapability':_0x5b8e70['id'],'expectedAction':_0x52d19f,'inspectCapabilityChain':_0x12eba1,'suite':new _0x1e8a31(),..._0x4fee28});}),GcDKxy['hIgkD'](it,_0xae883a(0x2d3),async()=>{const _0x5f36a1=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':[GcDKxy[_0x5f36a1(0x245)],bob['id']()],'invocationTarget':GcDKxy[_0x5f36a1(0x3f9)](uuid)};GcDKxy['cxQGP'](addToLoader,{'doc':root});const doc=clone(mock[_0x5f36a1(0x357)]),invocation=await GcDKxy[_0x5f36a1(0x2d6)](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':GcDKxy[_0x5f36a1(0x202)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':_0x5f36a1(0x3c8)});expect(result)['to'][_0x5f36a1(0x290)],expect(result['verified'])['to']['be'][_0x5f36a1(0x199)];}),it(GcDKxy[_0xae883a(0x347)],async()=>{const _0x138a2c=_0xae883a,root={'@context':ZCAP_CONTEXT_URL,'id':GcDKxy[_0x138a2c(0x331)](uuid),'controller':[GcDKxy['pfzLU'],bob['id']()],'invocationTarget':uuid()};GcDKxy['SwOTq'](addToLoader,{'doc':root});const doc=GcDKxy[_0x138a2c(0x297)](clone,mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':GcDKxy[_0x138a2c(0x202)]}),result=await GcDKxy[_0x138a2c(0x15d)](_verifyInvocation,{'invocation':invocation,'rootCapability':root,'expectedAction':GcDKxy[_0x138a2c(0x202)]});GcDKxy[_0x138a2c(0x393)](expect,result)['to']['exist'],expect(result[_0x138a2c(0x2d1)])['to']['be'][_0x138a2c(0x199)];}),it(_0xae883a(0x3a4),async()=>{const _0x45be77=_0xae883a;if(FXcoRt['yPHLo'](_0x45be77(0x369),FXcoRt[_0x45be77(0x3d6)])){const delegatedCapability=await FXcoRt['Loefh'](_delegate,{'parentCapability':capabilities[_0x45be77(0x1d8)][_0x45be77(0x3a5)],'controller':bob,'delegator':alice}),doc=FXcoRt['wSAtN'](clone,mock[_0x45be77(0x357)]),invocation=await FXcoRt[_0x45be77(0x201)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x45be77(0x3c8)}),result=await FXcoRt['wSAtN'](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x45be77(0x3c8),'expectedRootCapability':_0x45be77(0x457),'expectedTarget':capabilities[_0x45be77(0x1d8)][_0x45be77(0x3a5)]['invocationTarget']}});expect(result)['to'][_0x45be77(0x290)],FXcoRt[_0x45be77(0x12a)](expect,result[_0x45be77(0x2d1)])['to']['be'][_0x45be77(0x2f9)],result[_0x45be77(0x17e)][_0x45be77(0x2d5)][_0x45be77(0x373)][_0x45be77(0x1bb)](FXcoRt['DitCJ']);const [error]=result[_0x45be77(0x17e)]['errors'];error['message']['should']['contain'](FXcoRt['tuIaN']);}else{const MxQLqS={'mWBIn':function(x,y){return x+y;}};return _0x491293++,_0x5cb87b[_0x45be77(0x373)]['be']['an'](_0x45be77(0x2ea)),_0x13d881[_0x45be77(0x373)][_0x45be77(0x42e)][_0x45be77(0x2a8)](0x4),_0x4bf74d[_0x45be77(0x373)]['be']['an'](FXcoRt['zKWwD']),_0x46567b[_0x45be77(0x373)][_0x45be77(0x42e)][_0x45be77(0x2a8)](0x4),FXcoRt[_0x45be77(0x154)](_0x4e84a8,{'capabilityChain':_0x3a50d1}),_0x36e13a({'capabilityChainMeta':_0x223c03}),eval('const _0x1019eb = _0x45be77;MxQLqS[_0x1019eb(558)](1, 1);'),{'valid':!![]};}}),it(GcDKxy[_0xae883a(0x1da)],async()=>{const _0x38c845=_0xae883a;if(_0x38c845(0x1b9)===_0x38c845(0x422))_0x5ef040=new _0x1e92ff({'expectedTarget':'urn:uuid:1aaec12f-bcf2-40d8-8192-cc4dde9bca96','suite':new _0x2bc9d3(),'date':_0x38c845(0x362)});else{const delegatedCapability=await _delegate({'parentCapability':capabilities[_0x38c845(0x1d8)][_0x38c845(0x3a5)],'controller':bob,'delegator':alice}),result=await FXcoRt[_0x38c845(0x254)](_verifyDelegation,{'delegation':delegatedCapability,'expectedRootCapability':capabilities[_0x38c845(0x1d8)][_0x38c845(0x3a5)]['id']});FXcoRt[_0x38c845(0x20d)](expect,result)['to'][_0x38c845(0x290)],FXcoRt[_0x38c845(0x1c0)](expect,result[_0x38c845(0x2d1)])['to']['be'][_0x38c845(0x199)];}}),it(GcDKxy[_0xae883a(0x2b1)]+GcDKxy[_0xae883a(0x16b)],async()=>{const _0x5c5f66=_0xae883a,delegatedCapability=await FXcoRt[_0x5c5f66(0x2b6)](_delegate,{'parentCapability':capabilities[_0x5c5f66(0x1d8)]['beta'],'controller':bob,'delegator':alice}),doc=clone(mock[_0x5c5f66(0x357)]),invocation=await FXcoRt[_0x5c5f66(0x3fd)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x5c5f66(0x3c8)}),result=await FXcoRt['hWEQW'](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x5c5f66(0x1d8)][_0x5c5f66(0x3a5)],'expectedAction':_0x5c5f66(0x3c8)});expect(result)['to'][_0x5c5f66(0x290)],expect(result[_0x5c5f66(0x2d1)])['to']['be'][_0x5c5f66(0x199)];}),GcDKxy[_0xae883a(0x1e5)](it,GcDKxy[_0xae883a(0x2be)](GcDKxy[_0xae883a(0x2b1)],_0xae883a(0x1e9)),async()=>{const _0x9ba5fa=_0xae883a,delegatedCapability=await _delegate({'parentCapability':capabilities[_0x9ba5fa(0x1d8)][_0x9ba5fa(0x3a5)],'controller':bob,'delegator':alice}),doc=GcDKxy[_0x9ba5fa(0x260)](clone,mock[_0x9ba5fa(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':GcDKxy[_0x9ba5fa(0x170)]}),result=await GcDKxy[_0x9ba5fa(0x3df)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x9ba5fa(0x1d8)]['beta'],'expectedAction':'write'});expect(result)['to'][_0x9ba5fa(0x290)],expect(result[_0x9ba5fa(0x2d1)])['to']['be']['true'];}),GcDKxy[_0xae883a(0x236)](it,GcDKxy[_0xae883a(0x382)]+GcDKxy[_0xae883a(0x2e2)],async()=>{const _0x1267e2=_0xae883a;if(GcDKxy[_0x1267e2(0x285)]===GcDKxy[_0x1267e2(0x285)]){const delegatedCapability=await GcDKxy[_0x1267e2(0x184)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x1267e2(0x3a5)]['id'],'invocationTarget':capabilities[_0x1267e2(0x1d8)][_0x1267e2(0x3a5)][_0x1267e2(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':_0x1267e2(0x21d)},'parentCapability':capabilities[_0x1267e2(0x1d8)][_0x1267e2(0x3a5)],'delegator':alice}),doc=GcDKxy[_0x1267e2(0x37d)](clone,mock['exampleDoc']),invocation=await GcDKxy[_0x1267e2(0x3df)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x1267e2(0x21d)}),result=await GcDKxy[_0x1267e2(0x184)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x1267e2(0x1d8)][_0x1267e2(0x3a5)],'expectedAction':_0x1267e2(0x21d)});GcDKxy[_0x1267e2(0x2b0)](expect,result)['to'][_0x1267e2(0x290)],expect(result[_0x1267e2(0x2d1)])['to']['be'][_0x1267e2(0x199)];}else _0x48dcdc=_0x52e285;}),it(_0xae883a(0x3f3)+_0xae883a(0x408),async()=>{const _0xae1742=_0xae883a,delegatedCapability=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0xae1742(0x19b)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0xae1742(0x1d8)][_0xae1742(0x3a5)]['id'],'invocationTarget':capabilities[_0xae1742(0x1d8)]['beta']['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':FXcoRt[_0xae1742(0x32f)]},'parentCapability':capabilities[_0xae1742(0x1d8)][_0xae1742(0x3a5)],'delegator':alice}),doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':''});delete invocation['proof'][_0xae1742(0x3cf)];const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':FXcoRt['SzHWo'],'expectedRootCapability':capabilities[_0xae1742(0x1d8)][_0xae1742(0x3a5)]['id'],'expectedTarget':capabilities[_0xae1742(0x1d8)][_0xae1742(0x3a5)][_0xae1742(0x449)]}});expect(result)['to'][_0xae1742(0x290)],expect(result[_0xae1742(0x2d1)])['to']['be'][_0xae1742(0x2f9)],result['error']['name'][_0xae1742(0x373)]['equal'](FXcoRt['DitCJ']);const [error]=result[_0xae1742(0x17e)][_0xae1742(0x220)];error[_0xae1742(0x2d5)][_0xae1742(0x373)][_0xae1742(0x1bb)](FXcoRt['NrqAc']);}),GcDKxy[_0xae883a(0x27c)](it,GcDKxy[_0xae883a(0x176)](_0xae883a(0x2d8),_0xae883a(0x38d)),async()=>{const _0x48151a=_0xae883a,delegatedCapability=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt['JPTnj'](uuid),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x48151a(0x3a5)]['id'],'invocationTarget':capabilities[_0x48151a(0x1d8)]['beta'][_0x48151a(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':_0x48151a(0x21d)},'parentCapability':capabilities[_0x48151a(0x1d8)][_0x48151a(0x3a5)],'delegator':alice}),doc=FXcoRt[_0x48151a(0x3e5)](clone,mock[_0x48151a(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':FXcoRt[_0x48151a(0x42f)]}),result=await FXcoRt[_0x48151a(0x12a)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities['root'][_0x48151a(0x3a5)],'expectedAction':FXcoRt[_0x48151a(0x32f)]});expect(result)['to'][_0x48151a(0x290)],expect(result['verified'])['to']['be'][_0x48151a(0x2f9)],result[_0x48151a(0x17e)][_0x48151a(0x2d5)][_0x48151a(0x373)][_0x48151a(0x1bb)](_0x48151a(0x421));const [error]=result[_0x48151a(0x17e)][_0x48151a(0x220)];error[_0x48151a(0x2d5)][_0x48151a(0x373)]['equal'](_0x48151a(0x312));}),GcDKxy[_0xae883a(0x2bc)](it,GcDKxy[_0xae883a(0x2be)](GcDKxy[_0xae883a(0x1e2)],'required\x20\x22capabilityAction\x22\x20is\x20missing'),async()=>{const _0x3fc256=_0xae883a,delegatedCapability=await _delegate({'parentCapability':capabilities[_0x3fc256(0x1d8)][_0x3fc256(0x3a5)],'controller':bob,'delegator':alice}),doc=clone(mock[_0x3fc256(0x357)]),invocation=await GcDKxy[_0x3fc256(0x149)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':''});delete invocation['proof'][_0x3fc256(0x3cf)];const result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x3fc256(0x1d8)][_0x3fc256(0x3a5)],'expectedAction':GcDKxy['HeZYK']});GcDKxy['TlWWQ'](expect,result)['to']['exist'],expect(result[_0x3fc256(0x2d1)])['to']['be'][_0x3fc256(0x2f9)],result['error'][_0x3fc256(0x2d5)][_0x3fc256(0x373)][_0x3fc256(0x1bb)](_0x3fc256(0x421));const [error]=result['error']['errors'];error[_0x3fc256(0x2d5)][_0x3fc256(0x373)][_0x3fc256(0x1bb)]('NotFoundError');}),GcDKxy[_0xae883a(0x31e)](it,_0xae883a(0x426)+GcDKxy[_0xae883a(0x13d)],async()=>{const _0x3d783e=_0xae883a,delegatedCapability=await _delegate({'parentCapability':capabilities[_0x3d783e(0x1d8)][_0x3d783e(0x3a5)],'controller':bob,'delegator':alice}),doc=GcDKxy[_0x3d783e(0x192)](clone,mock[_0x3d783e(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':GcDKxy['HeZYK']}),result=await GcDKxy['dGkZT'](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x3d783e(0x1d8)][_0x3d783e(0x3a5)],'expectedAction':_0x3d783e(0x3c8)});GcDKxy[_0x3d783e(0x2dd)](expect,result)['to'][_0x3d783e(0x290)],GcDKxy[_0x3d783e(0x38f)](expect,result[_0x3d783e(0x2d1)])['to']['be'][_0x3d783e(0x2f9)],result[_0x3d783e(0x17e)][_0x3d783e(0x2d5)][_0x3d783e(0x373)][_0x3d783e(0x1bb)](GcDKxy[_0x3d783e(0x3c1)]);const [error]=result['error'][_0x3d783e(0x220)];error[_0x3d783e(0x2d5)][_0x3d783e(0x373)][_0x3d783e(0x1bb)](GcDKxy[_0x3d783e(0x3f2)]);}),describe(_0xae883a(0x360),()=>{const _0x144ab1=_0xae883a,bCIoDK={'VyKTN':function(callee,param1){const _0x3e1e41=_0x3b69;return GcDKxy[_0x3e1e41(0x14d)](callee,param1);},'SuQVp':function(callee,param1){const _0x768ab2=_0x3b69;return GcDKxy[_0x768ab2(0x1a5)](callee,param1);},'jgiNU':_0x144ab1(0x3d9),'OILjM':'VerificationError','Atcfk':_0x144ab1(0x40c),'IlkWz':function(x,y){return x!==y;},'GXBzN':_0x144ab1(0x2c0),'WAGoy':function(callee){return callee();},'XLlDp':GcDKxy[_0x144ab1(0x170)],'VNBLL':function(callee,param1){const _0x3423df=_0x144ab1;return GcDKxy[_0x3423df(0x233)](callee,param1);},'RutGY':_0x144ab1(0x2da),'PwIGE':GcDKxy[_0x144ab1(0x202)],'lTRqw':_0x144ab1(0x45e),'VXGtm':'The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','ptRpM':'delegated\x20capability\x20must\x20not\x20be\x20less\x20restrictive','UEpgW':function(callee,param1){const _0x5a2534=_0x144ab1;return GcDKxy[_0x5a2534(0x3df)](callee,param1);},'BZvde':function(callee,param1){const _0x38c301=_0x144ab1;return GcDKxy[_0x38c301(0x140)](callee,param1);},'OBowz':function(x,y){return x===y;},'UUiiN':function(callee,param1){const _0x4e185d=_0x144ab1;return GcDKxy[_0x4e185d(0x297)](callee,param1);},'XBcyA':function(callee,param1){return GcDKxy['jgmtG'](callee,param1);},'OFrBx':GcDKxy[_0x144ab1(0x295)],'uxuJe':function(callee,param1){const _0x41d647=_0x144ab1;return GcDKxy[_0x41d647(0x45c)](callee,param1);},'KoHpP':function(callee,param1){return callee(param1);},'FmEwp':function(x,y){const _0x51a591=_0x144ab1;return GcDKxy[_0x51a591(0x28f)](x,y);},'ZZCWR':'vojqN','lCELY':function(x,y){const _0x323ab5=_0x144ab1;return GcDKxy[_0x323ab5(0x2cd)](x,y);},'zEHoY':function(callee){return callee();},'hdtFg':function(x,y){const _0x4460f0=_0x144ab1;return GcDKxy[_0x4460f0(0x407)](x,y);},'IfnMh':function(x,y){const _0x3c7447=_0x144ab1;return GcDKxy[_0x3c7447(0x1d9)](x,y);},'lJUhg':function(callee,param1){return callee(param1);},'qGkTB':function(callee,param1){return callee(param1);},'YEuaZ':function(callee,param1){return GcDKxy['RimoQ'](callee,param1);},'PvFPm':function(callee,param1){return callee(param1);},'TqklN':function(callee,param1){return callee(param1);},'bxZRw':function(callee,param1){return GcDKxy['eaQkE'](callee,param1);},'CoiHL':function(callee,param1){return callee(param1);},'dveOY':_0x144ab1(0x334),'MIfVe':GcDKxy[_0x144ab1(0x344)],'HwPDG':function(callee){const _0x3916f2=_0x144ab1;return GcDKxy[_0x3916f2(0x2ee)](callee);},'CtuKt':function(callee,param1){const _0x1621e8=_0x144ab1;return GcDKxy[_0x1621e8(0x3af)](callee,param1);},'CHwhA':function(callee){return GcDKxy['gArri'](callee);},'cPpQV':GcDKxy[_0x144ab1(0x262)],'IECXn':function(x,y){const _0x48f1be=_0x144ab1;return GcDKxy[_0x48f1be(0x28f)](x,y);},'gmUii':_0x144ab1(0x431),'utlnp':function(callee,param1){return GcDKxy['LkdYM'](callee,param1);},'eRdLO':_0x144ab1(0x1c1)};GcDKxy[_0x144ab1(0x444)](it,GcDKxy['RlOKr'],async()=>{const _0x250d24=_0x144ab1,bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x250d24(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await bCIoDK[_0x250d24(0x305)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x250d24(0x1d8)]['beta']['id']});expect(result)['to'][_0x250d24(0x290)],bCIoDK[_0x250d24(0x305)](expect,result[_0x250d24(0x2d1)])['to']['be'][_0x250d24(0x199)];}),it(GcDKxy[_0x144ab1(0x407)](GcDKxy['ZEJDO'],_0x144ab1(0x1f1)),async()=>{const _0x2c014c=_0x144ab1,bobZcap=await _delegate({'parentCapability':capabilities[_0x2c014c(0x1d8)][_0x2c014c(0x3a5)],'controller':bob,'delegator':alice,'_capabilityChain':[capabilities['root']['beta']]});let carolZcap,localError;try{FXcoRt['DYYSb'](FXcoRt[_0x2c014c(0x271)],_0x2c014c(0x269))?_0xf10289[_0x2c014c(0x310)]({'safe':!![]}):carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});}catch(e){localError=e;}FXcoRt[_0x2c014c(0x1c0)](expect,localError)['to'][_0x2c014c(0x290)],localError['name'][_0x2c014c(0x373)][_0x2c014c(0x1bb)](FXcoRt[_0x2c014c(0x1cd)]),localError[_0x2c014c(0x2ce)][_0x2c014c(0x373)][_0x2c014c(0x3fa)](_0x2c014c(0x377)),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![]}});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x2c014c(0x1d8)]['beta']['id']});should[_0x2c014c(0x290)](result),result[_0x2c014c(0x2d1)][_0x2c014c(0x373)]['be'][_0x2c014c(0x2f9)],should[_0x2c014c(0x290)](result['error']),result[_0x2c014c(0x17e)][_0x2c014c(0x2d5)][_0x2c014c(0x373)][_0x2c014c(0x1bb)]('VerificationError');const [error]=result[_0x2c014c(0x17e)][_0x2c014c(0x220)];error['message'][_0x2c014c(0x373)][_0x2c014c(0x3fa)]('it\x20must\x20consist\x20of\x20strings');}),it(GcDKxy[_0x144ab1(0x21c)]('should\x20fail\x20to\x20verify\x20chain\x20with\x20non-embedded\x20last\x20','delegated\x20zcap'),async()=>{const _0x1a37d8=_0x144ab1,bobZcap=await bCIoDK[_0x1a37d8(0x305)](_delegate,{'parentCapability':capabilities[_0x1a37d8(0x1d8)][_0x1a37d8(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await bCIoDK[_0x1a37d8(0x305)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![],'_capabilityChain':[capabilities[_0x1a37d8(0x1d8)][_0x1a37d8(0x3a5)]['id'],bobZcap['id']]}}),result=await bCIoDK['SuQVp'](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x1a37d8(0x1d8)][_0x1a37d8(0x3a5)]['id']});should['exist'](result),result['verified']['should']['be'][_0x1a37d8(0x2f9)],should[_0x1a37d8(0x290)](result[_0x1a37d8(0x17e)]),result['error'][_0x1a37d8(0x2d5)]['should'][_0x1a37d8(0x1bb)](_0x1a37d8(0x421));const [error]=result[_0x1a37d8(0x17e)][_0x1a37d8(0x220)];error[_0x1a37d8(0x2ce)][_0x1a37d8(0x373)][_0x1a37d8(0x3fa)](bCIoDK[_0x1a37d8(0x3fc)]);}),GcDKxy[_0x144ab1(0x444)](it,GcDKxy[_0x144ab1(0x363)]+GcDKxy[_0x144ab1(0x2a5)],async()=>{const _0x2136a1=_0x144ab1,bobZcap=await bCIoDK[_0x2136a1(0x305)](_delegate,{'parentCapability':capabilities[_0x2136a1(0x1d8)]['beta'],'controller':bob,'delegator':alice,'_capabilityChain':[capabilities[_0x2136a1(0x1d8)]['alpha']['id']]}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'_capabilityChain':[capabilities[_0x2136a1(0x1d8)][_0x2136a1(0x3a5)]['id'],bobZcap]}),result=await bCIoDK['VyKTN'](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x2136a1(0x1d8)][_0x2136a1(0x3a5)]['id']});should[_0x2136a1(0x290)](result),result[_0x2136a1(0x2d1)][_0x2136a1(0x373)]['be'][_0x2136a1(0x2f9)],should[_0x2136a1(0x290)](result[_0x2136a1(0x17e)]),result[_0x2136a1(0x17e)]['name'][_0x2136a1(0x373)][_0x2136a1(0x1bb)](bCIoDK[_0x2136a1(0x430)]);const [error]=result[_0x2136a1(0x17e)]['errors'];error['message'][_0x2136a1(0x373)][_0x2136a1(0x3fa)](bCIoDK[_0x2136a1(0x1e6)]);}),it(GcDKxy[_0x144ab1(0x27b)](GcDKxy[_0x144ab1(0x363)],_0x144ab1(0x3e8)),async()=>{const _0xc72026=_0x144ab1;if(FXcoRt[_0xc72026(0x2d0)](FXcoRt[_0xc72026(0x32a)],_0xc72026(0x3eb)))_0x20a217=_0x4845ad;else{const bobZcap=await FXcoRt[_0xc72026(0x415)](_delegate,{'parentCapability':capabilities[_0xc72026(0x1d8)][_0xc72026(0x3a5)],'controller':bob,'delegator':alice}),dianaZcap=await _delegate({'parentCapability':capabilities['root']['beta'],'controller':diana,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'_capabilityChain':[capabilities[_0xc72026(0x1d8)][_0xc72026(0x2c9)]['id'],dianaZcap]}),result=await FXcoRt[_0xc72026(0x1d2)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0xc72026(0x1d8)][_0xc72026(0x3a5)]['id']});should[_0xc72026(0x290)](result),result['verified']['should']['be'][_0xc72026(0x2f9)],should[_0xc72026(0x290)](result[_0xc72026(0x17e)]),result['error']['name']['should'][_0xc72026(0x1bb)](_0xc72026(0x421));const [error]=result[_0xc72026(0x17e)]['errors'];error[_0xc72026(0x2ce)]['should']['contain'](_0xc72026(0x40c));}}),GcDKxy[_0x144ab1(0x36d)](it,'should\x20fail\x20to\x20verify\x20a\x20chain\x20'+GcDKxy[_0x144ab1(0x419)],async()=>{const _0x2a5199=_0x144ab1,LIgLfb={'wwenG':function(callee,param1,param2){return callee(param1,param2);}};if(bCIoDK[_0x2a5199(0x16c)](bCIoDK[_0x2a5199(0x1f5)],_0x2a5199(0x18a))){const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x2a5199(0x1d8)][_0x2a5199(0x3a5)]['id'],'invocationTarget':capabilities[_0x2a5199(0x1d8)]['beta'][_0x2a5199(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':'read'},'parentCapability':capabilities[_0x2a5199(0x1d8)][_0x2a5199(0x3a5)],'delegator':alice});let carolZcap,localError;try{carolZcap=await bCIoDK['VyKTN'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':bCIoDK['WAGoy'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x2a5199(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':bCIoDK[_0x2a5199(0x18b)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}bCIoDK['VNBLL'](expect,localError)['to'][_0x2a5199(0x290)],localError[_0x2a5199(0x2d5)][_0x2a5199(0x373)][_0x2a5199(0x1bb)](_0x2a5199(0x45e)),localError[_0x2a5199(0x2ce)][_0x2a5199(0x373)][_0x2a5199(0x1bb)](_0x2a5199(0x277)+bCIoDK['RutGY']),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x2a5199(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':_0x2a5199(0x21d)},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x2a5199(0x3a5)]['id']});should[_0x2a5199(0x290)](result),result[_0x2a5199(0x2d1)][_0x2a5199(0x373)]['be'][_0x2a5199(0x2f9)],should[_0x2a5199(0x290)](result[_0x2a5199(0x17e)]),result[_0x2a5199(0x17e)]['name'][_0x2a5199(0x373)]['equal'](bCIoDK[_0x2a5199(0x430)]);const [error]=result[_0x2a5199(0x17e)]['errors'];error[_0x2a5199(0x2ce)]['should'][_0x2a5199(0x3fa)](_0x2a5199(0x29f));}else return LIgLfb['wwenG'](_0x550b35,function(){const _0x572acc=_0x2a5199;_0x3694bc['log'](_0x572acc(0x334));},0x64),_0x3985d1[_0x2a5199(0x313)](_0x33557c[_0x2a5199(0x310)](_0x5bd0d5));}),GcDKxy['mwCyy'](it,GcDKxy[_0x144ab1(0x27b)](GcDKxy[_0x144ab1(0x378)],GcDKxy[_0x144ab1(0x25b)]),async()=>{const _0x3d5c0b=_0x144ab1,bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x3d5c0b(0x1d8)][_0x3d5c0b(0x3a5)]['id'],'invocationTarget':capabilities[_0x3d5c0b(0x1d8)]['beta']['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':bCIoDK['PwIGE']},'parentCapability':capabilities['root'][_0x3d5c0b(0x3a5)],'delegator':alice});let carolZcap,localError;try{carolZcap=await bCIoDK[_0x3d5c0b(0x24d)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':bCIoDK['WAGoy'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x3d5c0b(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':[bCIoDK[_0x3d5c0b(0x3d3)],_0x3d5c0b(0x21d)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}bCIoDK[_0x3d5c0b(0x24d)](expect,localError)['to'][_0x3d5c0b(0x290)],localError[_0x3d5c0b(0x2d5)][_0x3d5c0b(0x373)][_0x3d5c0b(0x1bb)](bCIoDK[_0x3d5c0b(0x258)]),localError['message'][_0x3d5c0b(0x373)]['equal'](bCIoDK['VXGtm']+'must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.'),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x3d5c0b(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':[bCIoDK['PwIGE'],_0x3d5c0b(0x21d)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x3d5c0b(0x1d8)][_0x3d5c0b(0x3a5)]['id']});should[_0x3d5c0b(0x290)](result),result['verified'][_0x3d5c0b(0x373)]['be'][_0x3d5c0b(0x2f9)],should[_0x3d5c0b(0x290)](result[_0x3d5c0b(0x17e)]),result['error'][_0x3d5c0b(0x2d5)][_0x3d5c0b(0x373)][_0x3d5c0b(0x1bb)](_0x3d5c0b(0x421));const [error]=result[_0x3d5c0b(0x17e)][_0x3d5c0b(0x220)];error[_0x3d5c0b(0x2ce)][_0x3d5c0b(0x373)][_0x3d5c0b(0x3fa)](bCIoDK['ptRpM']);}),GcDKxy[_0x144ab1(0x157)](it,_0x144ab1(0x1dc)+'w/invalid\x20allowedAction\x20arrays',async()=>{const _0x4b6e55=_0x144ab1,bobZcap=await FXcoRt[_0x4b6e55(0x254)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x4b6e55(0x370)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x4b6e55(0x1d8)][_0x4b6e55(0x3a5)]['id'],'invocationTarget':capabilities[_0x4b6e55(0x1d8)][_0x4b6e55(0x3a5)][_0x4b6e55(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x4b6e55(0x3c8),_0x4b6e55(0x21d)]},'parentCapability':capabilities[_0x4b6e55(0x1d8)][_0x4b6e55(0x3a5)],'delegator':alice});let carolZcap,localError;try{carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x4b6e55(0x467)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':[FXcoRt[_0x4b6e55(0x274)],FXcoRt[_0x4b6e55(0x130)]]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to'][_0x4b6e55(0x290)],localError[_0x4b6e55(0x2d5)][_0x4b6e55(0x373)][_0x4b6e55(0x1bb)](_0x4b6e55(0x45e)),localError['message'][_0x4b6e55(0x373)]['equal'](FXcoRt[_0x4b6e55(0x210)](FXcoRt[_0x4b6e55(0x326)],_0x4b6e55(0x2da))),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x4b6e55(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':['foo',_0x4b6e55(0x306)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await FXcoRt[_0x4b6e55(0x12a)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x4b6e55(0x1d8)][_0x4b6e55(0x3a5)]['id']});should[_0x4b6e55(0x290)](result),result[_0x4b6e55(0x2d1)][_0x4b6e55(0x373)]['be']['false'],should[_0x4b6e55(0x290)](result[_0x4b6e55(0x17e)]),result['error'][_0x4b6e55(0x2d5)][_0x4b6e55(0x373)]['equal'](_0x4b6e55(0x421));const [error]=result[_0x4b6e55(0x17e)]['errors'];error['message']['should'][_0x4b6e55(0x3fa)](FXcoRt[_0x4b6e55(0x275)]);}),GcDKxy[_0x144ab1(0x444)](it,GcDKxy[_0x144ab1(0x42d)](GcDKxy[_0x144ab1(0x28c)],GcDKxy[_0x144ab1(0x2c3)]),async()=>{const _0x52eef2=_0x144ab1,bobZcap=await bCIoDK['UEpgW'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x52eef2(0x1d8)][_0x52eef2(0x3a5)]['id'],'invocationTarget':capabilities[_0x52eef2(0x1d8)][_0x52eef2(0x3a5)][_0x52eef2(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':['read',bCIoDK[_0x52eef2(0x18b)]]},'parentCapability':capabilities[_0x52eef2(0x1d8)][_0x52eef2(0x3a5)],'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x52eef2(0x449)],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x52eef2(0x3c8)]},'delegator':bob,'parentCapability':bobZcap}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x52eef2(0x1d8)][_0x52eef2(0x3a5)]['id']});should['exist'](result),result['verified'][_0x52eef2(0x373)]['be'][_0x52eef2(0x199)];}),it(GcDKxy[_0x144ab1(0x27b)](GcDKxy[_0x144ab1(0x28c)],'a\x20valid\x20subset\x20of\x20the\x20undefined\x20parent\x20allowedAction'),async()=>{const _0x4a3305=_0x144ab1,bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x4a3305(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await FXcoRt['ALNde'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':FXcoRt[_0x4a3305(0x2ff)]},'parentCapability':bobZcap,'delegator':bob}),result=await FXcoRt[_0x4a3305(0x26f)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root']['beta']['id']});should[_0x4a3305(0x290)](result),result['verified'][_0x4a3305(0x373)]['be'][_0x4a3305(0x199)];}),it(_0x144ab1(0x345),async()=>{const _0xaafd7b=_0x144ab1,bobZcap=await bCIoDK[_0xaafd7b(0x3d0)](_delegate,{'parentCapability':capabilities['root'][_0xaafd7b(0x3a5)],'controller':bob,'delegator':alice});bobZcap['id']=uuid();const carolZcap=await bCIoDK[_0xaafd7b(0x305)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),result=await bCIoDK[_0xaafd7b(0x43c)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0xaafd7b(0x1d8)]['beta']['id']});expect(result)['to'][_0xaafd7b(0x290)],bCIoDK[_0xaafd7b(0x24d)](expect,result[_0xaafd7b(0x2d1)])['to']['be'][_0xaafd7b(0x2f9)],result[_0xaafd7b(0x17e)][_0xaafd7b(0x2d5)][_0xaafd7b(0x373)][_0xaafd7b(0x1bb)](bCIoDK[_0xaafd7b(0x430)]);}),it(GcDKxy[_0x144ab1(0x1e7)],async()=>{const _0x3c7640=_0x144ab1;if(bCIoDK[_0x3c7640(0x128)](_0x3c7640(0x3ad),_0x3c7640(0x3ad))){const bobZcap=await _delegate({'parentCapability':capabilities[_0x3c7640(0x1d8)][_0x3c7640(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await bCIoDK[_0x3c7640(0x17b)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob});carolZcap['id']=bCIoDK[_0x3c7640(0x2ae)](uuid);const result=await bCIoDK[_0x3c7640(0x2fa)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x3c7640(0x1d8)][_0x3c7640(0x3a5)]['id']});bCIoDK[_0x3c7640(0x3d0)](expect,result)['to'][_0x3c7640(0x290)],bCIoDK['VyKTN'](expect,result[_0x3c7640(0x2d1)])['to']['be'][_0x3c7640(0x2f9)],result[_0x3c7640(0x17e)][_0x3c7640(0x2d5)][_0x3c7640(0x373)][_0x3c7640(0x1bb)](bCIoDK[_0x3c7640(0x430)]);const [error]=result[_0x3c7640(0x17e)]['errors'];error[_0x3c7640(0x2ce)][_0x3c7640(0x373)][_0x3c7640(0x1bb)](_0x3c7640(0x367));}else _0x5da54e=_0x4e5b98;}),it(_0x144ab1(0x1bc),async()=>{const _0x5186ca=_0x144ab1,IlasVC={'IkfPo':function(x,y){return x+y;}},bobZcap=await bCIoDK[_0x5186ca(0x242)](_delegate,{'parentCapability':capabilities['root'][_0x5186ca(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await bCIoDK[_0x5186ca(0x259)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x26d9af=_0x5186ca;return checkedChain++,capabilityChain[_0x26d9af(0x373)]['be']['an'](bCIoDK[_0x26d9af(0x380)]),capabilityChain[_0x26d9af(0x373)]['have'][_0x26d9af(0x2a8)](0x3),capabilityChainMeta[_0x26d9af(0x373)]['be']['an'](bCIoDK[_0x26d9af(0x380)]),capabilityChainMeta['should'][_0x26d9af(0x42e)][_0x26d9af(0x2a8)](0x3),_checkCapabilityChain({'capabilityChain':capabilityChain}),bCIoDK['UUiiN'](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),eval('const _0x23322f = _0x26d9af;IlasVC[_0x23322f(478)](1, 1);'),{'valid':!![]};},result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x5186ca(0x3a5)]['id'],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to']['exist'],expect(result[_0x5186ca(0x2d1)])['to']['be']['true'],checkedChain[_0x5186ca(0x373)][_0x5186ca(0x1bb)](0x1);}),it(_0x144ab1(0x13f)+GcDKxy[_0x144ab1(0x23b)],async()=>{const _0x29d3a2=_0x144ab1,bobZcap=await _delegate({'parentCapability':capabilities[_0x29d3a2(0x1d8)][_0x29d3a2(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x2fe399=_0x29d3a2;if(bCIoDK[_0x2fe399(0x203)](bCIoDK[_0x2fe399(0x133)],_0x2fe399(0x2e4))){let _0x2926c4;return _0x5e939d?_0x2926c4=new _0x5b3cd3({'expectedTarget':_0x518ce5[_0x2fe399(0x449)],'expectedRootCapability':_0x1ab0cc['id'],'expectedAction':_0x26975d,'inspectCapabilityChain':_0x160491,'suite':new _0x3e39b3(),..._0x1e93c7}):_0x2926c4=new _0x5b5f37({'suite':new _0x52d7ff(),..._0x9804c9}),new _0x2fb42a(_0x2fe399(0x335))(),_0x29c4e8[_0x2fe399(0x3b5)](_0x19a222,{'documentLoader':_0x289e05,'suite':new _0x21b2de(),'purpose':_0x2926c4});}else return checkedChain++,capabilityChain['should']['be']['an']('array'),capabilityChain[_0x2fe399(0x373)][_0x2fe399(0x42e)][_0x2fe399(0x2a8)](0x3),_checkCapabilityChain({'capabilityChain':capabilityChain}),bCIoDK[_0x2fe399(0x24d)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),eval('1 + 1;'),{'error':new Error(_0x2fe399(0x3f4)+capabilityChain[0x0]['id']+'\x22\x20'+_0x2fe399(0x218)),'valid':![]};},result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x29d3a2(0x1d8)][_0x29d3a2(0x3a5)]['id'],'inspectCapabilityChain':inspectCapabilityChain});bCIoDK[_0x29d3a2(0x43c)](expect,result)['to'][_0x29d3a2(0x290)],expect(result[_0x29d3a2(0x2d1)])['to']['be'][_0x29d3a2(0x2f9)],expect(result[_0x29d3a2(0x17e)][_0x29d3a2(0x220)][0x0])['to'][_0x29d3a2(0x290)],result[_0x29d3a2(0x17e)][_0x29d3a2(0x220)][0x0][_0x29d3a2(0x2ce)]['should'][_0x29d3a2(0x3fa)]('revoked'),checkedChain[_0x29d3a2(0x373)]['equal'](0x1);}),it(GcDKxy[_0x144ab1(0x12b)]+GcDKxy['MJtvv'],async()=>{const _0x212014=_0x144ab1,bobZcap=await FXcoRt['RMDpQ'](_delegate,{'parentCapability':capabilities[_0x212014(0x1d8)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await FXcoRt['qTCHZ'](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob,'date':new Date(0x0),'purposeOptions':{'_skipLocalValidationForTesting':!![]}}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x212014(0x1d8)][_0x212014(0x3a5)]['id']});expect(result)['to'][_0x212014(0x290)],FXcoRt['heAjV'](expect,result[_0x212014(0x2d1)])['to']['be'][_0x212014(0x2f9)],FXcoRt['wUWqf'](expect,result['error'][_0x212014(0x220)][0x0])['to']['exist'],result[_0x212014(0x17e)][_0x212014(0x220)][0x0][_0x212014(0x2ce)][_0x212014(0x373)]['contain'](_0x212014(0x229));}),GcDKxy[_0x144ab1(0x37b)](it,GcDKxy['Kzejf'](_0x144ab1(0x464),_0x144ab1(0x352)),async()=>{const _0x2931b7=_0x144ab1,ttl=FXcoRt[_0x2931b7(0x235)](FXcoRt[_0x2931b7(0x2d7)](FXcoRt[_0x2931b7(0x30c)](0x3e8,0x3c),0x3c),0x18),expires=new Date(FXcoRt['ByXuc'](Date[_0x2931b7(0x1ec)](),ttl)),bobZcap=await FXcoRt[_0x2931b7(0x1cf)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x2931b7(0x3a5)]['id'],'invocationTarget':capabilities[_0x2931b7(0x1d8)][_0x2931b7(0x3a5)]['invocationTarget'],'expires':expires['toISOString']()},'parentCapability':capabilities[_0x2931b7(0x1d8)][_0x2931b7(0x3a5)],'delegator':alice}),carolZcap=await FXcoRt[_0x2931b7(0x1a0)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x2931b7(0x31a)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x2931b7(0x449)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),result=await FXcoRt[_0x2931b7(0x372)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x2931b7(0x3a5)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to'][_0x2931b7(0x290)],FXcoRt['TwDwU'](expect,result['verified'])['to']['be']['false'],FXcoRt[_0x2931b7(0x201)](expect,result['error']['errors'][0x0])['to'][_0x2931b7(0x290)],result[_0x2931b7(0x17e)][_0x2931b7(0x220)][0x0][_0x2931b7(0x2ce)][_0x2931b7(0x373)][_0x2931b7(0x3fa)](FXcoRt[_0x2931b7(0x1b4)]);}),it(GcDKxy[_0x144ab1(0x21f)]+_0x144ab1(0x190),async()=>{const _0x71f959=_0x144ab1,ttl=bCIoDK[_0x71f959(0x44c)](0x3e8,0x3c)*0x3c*0x18,delegated=new Date(Date[_0x71f959(0x1ec)]()+ttl),bobZcap=await bCIoDK[_0x71f959(0x3d0)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':bCIoDK[_0x71f959(0x1d5)](uuid),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x71f959(0x3a5)]['id'],'invocationTarget':capabilities[_0x71f959(0x1d8)]['beta']['invocationTarget'],'expires':new Date(bCIoDK[_0x71f959(0x346)](delegated[_0x71f959(0x24b)](),bCIoDK['IfnMh'](ttl,0x2)))[_0x71f959(0x227)]()},'parentCapability':capabilities[_0x71f959(0x1d8)][_0x71f959(0x3a5)],'delegator':alice,'date':delegated}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x71f959(0x449)],'expires':bobZcap[_0x71f959(0x1e0)]},'parentCapability':bobZcap,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![]}}),result=await bCIoDK[_0x71f959(0x259)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root']['beta']['id'],'purposeOptions':{'maxDelegationTtl':ttl}});bCIoDK['lJUhg'](expect,result)['to'][_0x71f959(0x290)],bCIoDK[_0x71f959(0x332)](expect,result[_0x71f959(0x2d1)])['to']['be']['false'],expect(result[_0x71f959(0x17e)][_0x71f959(0x220)][0x0])['to'][_0x71f959(0x290)],result[_0x71f959(0x17e)][_0x71f959(0x220)][0x0][_0x71f959(0x2ce)][_0x71f959(0x373)][_0x71f959(0x3fa)](_0x71f959(0x18d));}),it(_0x144ab1(0x1dc)+GcDKxy[_0x144ab1(0x374)],async()=>{const _0x665e4a=_0x144ab1,ttl=FXcoRt[_0x665e4a(0x2d7)](0x3e8*0x3c*0x3c,0x18),now=new Date(),bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x665e4a(0x16e)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x665e4a(0x1d8)]['beta']['id'],'invocationTarget':capabilities[_0x665e4a(0x1d8)][_0x665e4a(0x3a5)][_0x665e4a(0x449)],'expires':new Date(FXcoRt[_0x665e4a(0x2f3)](now[_0x665e4a(0x24b)](),ttl)+0x1)['toISOString']()},'parentCapability':capabilities[_0x665e4a(0x1d8)]['beta'],'delegator':alice,'date':now}),carolZcap=await FXcoRt[_0x665e4a(0x415)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x665e4a(0x449)],'expires':bobZcap['expires']},'parentCapability':bobZcap,'delegator':bob}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x665e4a(0x1d8)][_0x665e4a(0x3a5)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to'][_0x665e4a(0x290)],FXcoRt[_0x665e4a(0x2db)](expect,result[_0x665e4a(0x2d1)])['to']['be']['false'],expect(result[_0x665e4a(0x17e)]['errors'][0x0])['to'][_0x665e4a(0x290)],result[_0x665e4a(0x17e)][_0x665e4a(0x220)][0x0][_0x665e4a(0x2ce)][_0x665e4a(0x373)][_0x665e4a(0x3fa)](FXcoRt[_0x665e4a(0x1c6)]);}),GcDKxy['mwCyy'](it,_0x144ab1(0x29e),async()=>{const _0x1f3698=_0x144ab1,bobZcap=await bCIoDK[_0x1f3698(0x2a0)](_delegate,{'parentCapability':capabilities[_0x1f3698(0x1d8)][_0x1f3698(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await bCIoDK[_0x1f3698(0x45d)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=bCIoDK[_0x1f3698(0x2e8)](clone,mock['exampleDoc']),invocation=await bCIoDK[_0x1f3698(0x43c)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x1f3698(0x3c8)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities['root'][_0x1f3698(0x3a5)],'expectedAction':bCIoDK[_0x1f3698(0x3d3)]});expect(result)['to'][_0x1f3698(0x290)],expect(result[_0x1f3698(0x2d1)])['to']['be'][_0x1f3698(0x199)];}),it(GcDKxy[_0x144ab1(0x35c)],async()=>{const _0x1dd34b=_0x144ab1;if(FXcoRt[_0x1dd34b(0x1ed)]!==FXcoRt[_0x1dd34b(0x3f0)]){const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt['qZUjj'](uuid),'parentCapability':capabilities['root']['beta']['id'],'invocationTarget':capabilities['root'][_0x1dd34b(0x3a5)]['invocationTarget'],'expires':EXPIRES_3000_DATE,'controller':[FXcoRt[_0x1dd34b(0x39e)],bob['id']()]},'parentCapability':capabilities[_0x1dd34b(0x1d8)][_0x1dd34b(0x3a5)],'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=FXcoRt[_0x1dd34b(0x2db)](clone,mock[_0x1dd34b(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x1dd34b(0x3c8)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x1dd34b(0x1d8)][_0x1dd34b(0x3a5)],'expectedAction':FXcoRt['VoakD']});expect(result)['to'][_0x1dd34b(0x290)],expect(result[_0x1dd34b(0x2d1)])['to']['be']['true'];}else _0xb90b05=_0xdb36e5;}),it(_0x144ab1(0x2ad),async()=>{const _0x15017f=_0x144ab1,qZiaQb={'kVqGt':_0x15017f(0x304),'DlIkf':function(callee,param1){const _0x49d97=_0x15017f;return bCIoDK[_0x49d97(0x24d)](callee,param1);}},bobZcap=await bCIoDK[_0x15017f(0x283)](_delegate,{'parentCapability':capabilities['root'][_0x15017f(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=bCIoDK['VyKTN'](clone,mock[_0x15017f(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':bCIoDK[_0x15017f(0x3d3)]});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x1ed7d1=_0x15017f,MtWDJJ=_0x1ed7d1(0x25e)[_0x1ed7d1(0x1c3)]('|');let YrzuHD=0x0;while(!![]){switch(MtWDJJ[YrzuHD++]){case'0':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'1':return{'valid':!![]};case'2':setTimeout(qZiaQb[_0x1ed7d1(0x250)],0x3e8);continue;case'3':capabilityChain['should'][_0x1ed7d1(0x42e)][_0x1ed7d1(0x2a8)](0x3);continue;case'4':qZiaQb[_0x1ed7d1(0x329)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'5':capabilityChain['should']['be']['an'](_0x1ed7d1(0x2ea));continue;case'6':checkedChain++;continue;}break;}},result=await bCIoDK[_0x15017f(0x332)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x15017f(0x1d8)][_0x15017f(0x3a5)],'expectedAction':_0x15017f(0x3c8),'inspectCapabilityChain':inspectCapabilityChain});bCIoDK['UEpgW'](expect,result)['to'][_0x15017f(0x290)],bCIoDK['CoiHL'](expect,result[_0x15017f(0x2d1)])['to']['be']['true'],checkedChain[_0x15017f(0x373)][_0x15017f(0x1bb)](0x1);}),GcDKxy['nJcQM'](it,GcDKxy[_0x144ab1(0x35e)](_0x144ab1(0x2ef),GcDKxy['rMoGw']),async()=>{const _0x51fb8e=_0x144ab1,ksFvtV={'lwvOY':bCIoDK[_0x51fb8e(0x2eb)],'Jusvq':_0x51fb8e(0x1e1),'YsJYe':function(callee,param1){return callee(param1);},'DbWVR':bCIoDK[_0x51fb8e(0x380)]};if(_0x51fb8e(0x1a1)===bCIoDK[_0x51fb8e(0x417)])_0x2528b0['log'](ksFvtV[_0x51fb8e(0x27d)]);else{const ttl=bCIoDK[_0x51fb8e(0x44c)](bCIoDK['lCELY'](0x3e8,0x3c),0x3c)*0x18,bobZcap=await bCIoDK[_0x51fb8e(0x24d)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':bCIoDK[_0x51fb8e(0x3c5)](uuid),'controller':bob['id'](),'parentCapability':capabilities['root']['beta']['id'],'invocationTarget':capabilities[_0x51fb8e(0x1d8)][_0x51fb8e(0x3a5)]['invocationTarget'],'expires':new Date(bCIoDK[_0x51fb8e(0x346)](Date['now'](),ttl/0x2))[_0x51fb8e(0x227)]()},'parentCapability':capabilities[_0x51fb8e(0x1d8)][_0x51fb8e(0x3a5)],'delegator':alice}),carolZcap=await bCIoDK[_0x51fb8e(0x2df)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x51fb8e(0x449)],'expires':bobZcap[_0x51fb8e(0x1e0)]},'parentCapability':bobZcap,'delegator':bob}),doc=bCIoDK['BZvde'](clone,mock[_0x51fb8e(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x51fb8e(0x3c8)});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x35d4ff=_0x51fb8e,EnaNBt=ksFvtV[_0x35d4ff(0x265)][_0x35d4ff(0x1c3)]('|');let eWOEyZ=0x0;while(!![]){switch(EnaNBt[eWOEyZ++]){case'0':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'1':checkedChain++;continue;case'2':ksFvtV[_0x35d4ff(0x1b7)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'3':capabilityChain['should'][_0x35d4ff(0x42e)][_0x35d4ff(0x2a8)](0x3);continue;case'4':return{'valid':!![]};case'5':new Function('var\x20x\x20=\x2042;\x20return\x20x;')();continue;case'6':capabilityChain[_0x35d4ff(0x373)]['be']['an'](ksFvtV[_0x35d4ff(0x30e)]);continue;}break;}},result=await bCIoDK[_0x51fb8e(0x1f2)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x51fb8e(0x3c8),'expectedRootCapability':capabilities[_0x51fb8e(0x1d8)][_0x51fb8e(0x3a5)]['id'],'expectedTarget':capabilities['root']['beta']['invocationTarget'],'inspectCapabilityChain':inspectCapabilityChain,'maxDelegationTtl':ttl}});expect(result)['to'][_0x51fb8e(0x290)],bCIoDK[_0x51fb8e(0x2df)](expect,result['verified'])['to']['be']['true'],checkedChain[_0x51fb8e(0x373)]['equal'](0x1);}}),it(GcDKxy['Kzejf'](_0x144ab1(0x2f4),GcDKxy[_0x144ab1(0x325)]),async()=>{const _0x4e78ba=_0x144ab1;if(bCIoDK[_0x4e78ba(0x168)](bCIoDK[_0x4e78ba(0x32e)],'DIXAj'))_0x3dc4df={'@context':_0x2b5d7d,'id':bCIoDK['CHwhA'](_0x5e5298),'controller':typeof _0x4ec49c===bCIoDK[_0x4e78ba(0x33c)]?_0x2e43f7:_0x16ad6c['id'](),'parentCapability':_0x259d24['id'],'invocationTarget':_0x31a15a[_0x4e78ba(0x449)],'expires':_0x32df77};else{const bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x4e78ba(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await bCIoDK[_0x4e78ba(0x399)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x4e78ba(0x3c8)});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x279c31=_0x4e78ba;return checkedChain++,should[_0x279c31(0x290)](capabilityChain),capabilityChain[_0x279c31(0x373)]['be']['an'](bCIoDK[_0x279c31(0x380)]),capabilityChain[_0x279c31(0x373)][_0x279c31(0x42e)][_0x279c31(0x2a8)](0x3),_checkCapabilityChain({'capabilityChain':capabilityChain}),_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta}),eval('const _0x4c2164 = _0x279c31;JSON[_0x4c2164(784)]({ \'safe\': !![] });'),{'error':new Error(_0x279c31(0x3f4)+capabilityChain[0x0]['id']+_0x279c31(0x222)),'valid':![]};},result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities['root'][_0x4e78ba(0x3a5)],'expectedAction':bCIoDK[_0x4e78ba(0x3d3)],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to'][_0x4e78ba(0x290)],bCIoDK[_0x4e78ba(0x45d)](expect,result[_0x4e78ba(0x2d1)])['to']['be']['false'],expect(result[_0x4e78ba(0x17e)]['errors'][0x0])['to'][_0x4e78ba(0x290)],result[_0x4e78ba(0x17e)][_0x4e78ba(0x220)][0x0][_0x4e78ba(0x2ce)]['should'][_0x4e78ba(0x3fa)](bCIoDK[_0x4e78ba(0x294)]),checkedChain[_0x4e78ba(0x373)][_0x4e78ba(0x1bb)](0x1);}});}),GcDKxy['ydXPF'](describe,_0xae883a(0x466),()=>{const _0x613983=_0xae883a,kDOayV={'JdmHr':GcDKxy['JRXbm'],'gyJei':function(x,y){return GcDKxy['bxnse'](x,y);},'mJoJU':_0x613983(0x339),'vtCEP':function(callee,param1){const _0x4682f5=_0x613983;return GcDKxy[_0x4682f5(0x19d)](callee,param1);},'tbQSi':function(callee,param1){return callee(param1);},'XweVf':_0x613983(0x3c8),'rElOO':function(callee,param1){return callee(param1);},'jvfDt':_0x613983(0x421),'dZXhb':GcDKxy['jTWlt'],'kDzpi':function(x,y){return x+y;},'NMefM':function(callee,param1){return callee(param1);},'LMSLv':function(callee){return callee();},'FvSGc':function(callee,param1){const _0x19ceef=_0x613983;return GcDKxy[_0x19ceef(0x233)](callee,param1);},'kLfKO':'urn:zcap:e843f3c4-6b2b-11ec-b87f-10bf48838a41','TvINE':_0x613983(0x161),'FKdfK':function(callee,param1){return callee(param1);},'tYHqM':GcDKxy[_0x613983(0x458)],'sSvvy':function(callee,param1){return GcDKxy['deiHC'](callee,param1);},'wSAKi':function(x,y){return x-y;},'YcZLo':function(callee,param1){const _0x404a74=_0x613983;return GcDKxy[_0x404a74(0x297)](callee,param1);},'JfJir':function(callee){return callee();},'zJMZp':_0x613983(0x153),'ttIdc':'urn:uuid:dada0e4d-bc52-4530-ac7f-4973eb8013e9','bJtkz':function(callee,param1){return callee(param1);},'UMuWc':function(callee,param1){const _0x595539=_0x613983;return GcDKxy[_0x595539(0x26e)](callee,param1);},'HgLgi':function(callee){return callee();},'VnThO':function(callee,param1){const _0x59a3e4=_0x613983;return GcDKxy[_0x59a3e4(0x405)](callee,param1);},'LskCY':function(callee,param1){return callee(param1);},'SZPAm':function(callee,param1){return callee(param1);},'qIITR':_0x613983(0x398),'YvJZW':function(callee,param1){return callee(param1);},'LfIWY':function(callee,param1){const _0x4de09c=_0x613983;return GcDKxy[_0x4de09c(0x230)](callee,param1);},'MkOHF':_0x613983(0x3e2),'pDAlg':function(callee,param1){return callee(param1);},'JFiqG':function(callee,param1){return callee(param1);},'xcnJr':function(x,y){return x*y;},'irClM':function(callee,param1){const _0x30e98d=_0x613983;return GcDKxy[_0x30e98d(0x249)](callee,param1);},'IqHcq':function(callee,param1){const _0x450e63=_0x613983;return GcDKxy[_0x450e63(0x260)](callee,param1);},'HnRWA':function(callee,param1){const _0x59e6ef=_0x613983;return GcDKxy[_0x59e6ef(0x165)](callee,param1);},'VDRBd':GcDKxy[_0x613983(0x460)],'fRYLr':_0x613983(0x356),'oqdVx':'array','vIwAA':function(callee,param1){return callee(param1);},'MwOqQ':function(callee,param1){return GcDKxy['feBqP'](callee,param1);},'LQUuL':function(callee,param1){const _0x15d095=_0x613983;return GcDKxy[_0x15d095(0x2d6)](callee,param1);},'rUhhS':GcDKxy[_0x613983(0x337)],'juzIh':function(callee,param1){const _0x3fc14b=_0x613983;return GcDKxy[_0x3fc14b(0x2dc)](callee,param1);}};it('CapabilityInvocation\x20throws\x20TypeError\x20on\x20invalid\x20date',async()=>{const _0xd3369c=_0x613983;let result,err;try{result=new CapabilityInvocation({'expectedTarget':_0xd3369c(0x3a2),'suite':new Ed25519Signature2020(),'date':FXcoRt[_0xd3369c(0x456)]});}catch(e){err=e;}should[_0xd3369c(0x290)](err),should['not'][_0xd3369c(0x290)](result),err[_0xd3369c(0x373)]['be'][_0xd3369c(0x423)](TypeError),err[_0xd3369c(0x2ce)][_0xd3369c(0x373)][_0xd3369c(0x3fa)](_0xd3369c(0x447));}),it('CapabilityDelegation\x20throws\x20TypeError\x20on\x20invalid\x20date',async()=>{const _0x446429=_0x613983;let result,err;try{result=new CapabilityDelegation({'expectedRootCapability':_0x446429(0x327),'date':_0x446429(0x362)});}catch(e){err=e;}should[_0x446429(0x290)](err),should[_0x446429(0x3a7)][_0x446429(0x290)](result),err['should']['be'][_0x446429(0x423)](TypeError),err[_0x446429(0x2ce)][_0x446429(0x373)][_0x446429(0x3fa)](FXcoRt[_0x446429(0x237)]);}),GcDKxy['IpBYA'](it,_0x613983(0x3c9),async()=>{const _0x3c57c9=_0x613983,OHyLBM={'pHOdr':kDOayV['JdmHr']};if(kDOayV[_0x3c57c9(0x150)]('lRMsY',kDOayV[_0x3c57c9(0x30b)]))_0x24d147[_0x3c57c9(0x361)](OHyLBM['pHOdr']);else{const rootCapability={...capabilities[_0x3c57c9(0x1d8)][_0x3c57c9(0x3a5)]};rootCapability['id']='urn:zcap:d3e905ba-6430-11ec-beae-10bf48838a41',rootCapability[_0x3c57c9(0x1e0)]=new Date()[_0x3c57c9(0x227)](),kDOayV[_0x3c57c9(0x1fe)](addToLoader,{'doc':rootCapability});const doc=kDOayV['vtCEP'](clone,mock['exampleDoc']),invocation=await kDOayV[_0x3c57c9(0x30d)](_invoke,{'doc':doc,'invoker':alice,'capability':rootCapability,'capabilityAction':kDOayV[_0x3c57c9(0x386)]}),result=await kDOayV[_0x3c57c9(0x30d)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read'});kDOayV[_0x3c57c9(0x2a3)](expect,result)['to']['exist'],kDOayV[_0x3c57c9(0x30d)](expect,result[_0x3c57c9(0x2d1)])['to']['be'][_0x3c57c9(0x2f9)],should[_0x3c57c9(0x290)](result[_0x3c57c9(0x17e)]),result[_0x3c57c9(0x17e)][_0x3c57c9(0x2d5)]['should'][_0x3c57c9(0x1bb)](kDOayV[_0x3c57c9(0x26b)]);const [error]=result['error'][_0x3c57c9(0x220)];error[_0x3c57c9(0x2ce)][_0x3c57c9(0x373)][_0x3c57c9(0x3fa)](_0x3c57c9(0x36e));}}),GcDKxy['VfbTu'](it,_0x613983(0x300),async()=>{const _0x418b09=_0x613983;if(kDOayV[_0x418b09(0x150)](_0x418b09(0x2a1),_0x418b09(0x2a1)))_0x57e8aa=new _0x244caa(_0x31bd3d);else{const rootCapability={...capabilities['root'][_0x418b09(0x3a5)]};rootCapability['id']=kDOayV[_0x418b09(0x14c)],kDOayV[_0x418b09(0x2a3)](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x418b09(0x217)](kDOayV[_0x418b09(0x15e)](expires['getHours'](),0x1)),expires=expires[_0x418b09(0x227)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability['invocationTarget'],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await kDOayV['NMefM'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x418b09(0x3e7)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x418b09(0x449)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x418b09(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x418b09(0x3c8)}),result=await kDOayV[_0x418b09(0x3de)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x418b09(0x3c8)});kDOayV['vtCEP'](expect,result)['to'][_0x418b09(0x290)],expect(result[_0x418b09(0x2d1)])['to']['be'][_0x418b09(0x199)];}}),it(_0x613983(0x42c),async()=>{const _0x89428b=_0x613983,rootCapability={...capabilities[_0x89428b(0x1d8)][_0x89428b(0x3a5)]};rootCapability['id']=kDOayV[_0x89428b(0x359)],addToLoader({'doc':rootCapability});let bobZcap,localError;try{bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x89428b(0x449)],'expires':kDOayV[_0x89428b(0x16a)]},'parentCapability':rootCapability,'delegator':alice});}catch(e){localError=e;}kDOayV[_0x89428b(0x30d)](expect,bobZcap)['to'][_0x89428b(0x3a7)][_0x89428b(0x290)],kDOayV['FKdfK'](expect,localError)['to'][_0x89428b(0x290)],localError['message'][_0x89428b(0x373)][_0x89428b(0x3fa)](_0x89428b(0x18e));}),GcDKxy['suUgL'](it,GcDKxy[_0x613983(0x1b2)],async()=>{const _0x24c5df=_0x613983,rootCapability={...capabilities[_0x24c5df(0x1d8)][_0x24c5df(0x3a5)]};rootCapability['id']=_0x24c5df(0x3d5),addToLoader({'doc':rootCapability});const bobZcap=await FXcoRt[_0x24c5df(0x156)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x24c5df(0x449)],'expires':FXcoRt[_0x24c5df(0x1ea)]},'purposeOptions':{'parentCapability':rootCapability,'_skipLocalValidationForTesting':!![]},'delegator':alice}),doc=clone(mock[_0x24c5df(0x357)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':FXcoRt[_0x24c5df(0x2ff)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read'});expect(result)['to']['exist'],FXcoRt[_0x24c5df(0x341)](expect,result[_0x24c5df(0x2d1)])['to']['be']['false'],should[_0x24c5df(0x290)](result[_0x24c5df(0x17e)]),result['error'][_0x24c5df(0x2d5)][_0x24c5df(0x373)][_0x24c5df(0x1bb)](_0x24c5df(0x421));const [error]=result[_0x24c5df(0x17e)][_0x24c5df(0x220)];error['message'][_0x24c5df(0x373)][_0x24c5df(0x1bb)](FXcoRt['otUYc']);}),GcDKxy[_0x613983(0x23e)](it,_0x613983(0x191)+_0x613983(0x395),async()=>{const _0x29823d=_0x613983,rootCapability={...capabilities['root'][_0x29823d(0x3a5)]};rootCapability['id']=kDOayV[_0x29823d(0x3ff)],kDOayV[_0x29823d(0x23a)](addToLoader,{'doc':rootCapability});const date=new Date();date['setHours'](kDOayV[_0x29823d(0x2f8)](date[_0x29823d(0x2a2)](),0x14));let expires=new Date();expires[_0x29823d(0x217)](expires['getHours']()-0xa),expires=expires[_0x29823d(0x227)]();const bobZcap=await kDOayV[_0x29823d(0x15b)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x29823d(0x3e7)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x29823d(0x449)],'expires':expires},'date':date,'parentCapability':rootCapability,'delegator':alice}),carolZcap=await kDOayV[_0x29823d(0x30d)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x29823d(0x33d)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x29823d(0x449)],'expires':expires},'date':date,'parentCapability':bobZcap,'delegator':bob}),doc=kDOayV[_0x29823d(0x23a)](clone,mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':kDOayV[_0x29823d(0x386)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x29823d(0x449)],'date':date}});kDOayV['sSvvy'](expect,result)['to'][_0x29823d(0x290)],kDOayV['FKdfK'](expect,result['verified'])['to']['be'][_0x29823d(0x199)];}),GcDKxy[_0x613983(0x1eb)](it,GcDKxy['Iukky'](GcDKxy[_0x613983(0x18f)],_0x613983(0x395)),async()=>{const _0x520202=_0x613983;if(_0x520202(0x153)!==kDOayV[_0x520202(0x448)])_0x15668a=_0x5e54aa[_0x520202(0x18c)](_0x520202(0x3f1),0x0);else{const rootCapability={...capabilities[_0x520202(0x1d8)][_0x520202(0x3a5)]};rootCapability['id']=kDOayV[_0x520202(0x40a)],kDOayV['bJtkz'](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x520202(0x217)](kDOayV[_0x520202(0x2f8)](expires['getHours'](),0x32)),expires=expires[_0x520202(0x227)]();const bobZcap=await kDOayV['UMuWc'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV['HgLgi'](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x520202(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),doc=kDOayV[_0x520202(0x25d)](clone,mock[_0x520202(0x357)]),invocation=await kDOayV['LskCY'](_invoke,{'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':_0x520202(0x3c8)}),date=new Date();date['setHours'](date['getHours']()-0x14);const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':kDOayV[_0x520202(0x386)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x520202(0x449)],'date':date}});kDOayV[_0x520202(0x12c)](expect,result)['to'][_0x520202(0x290)],expect(result[_0x520202(0x2d1)])['to']['be'][_0x520202(0x2f9)],should[_0x520202(0x290)](result[_0x520202(0x17e)]),result[_0x520202(0x17e)]['name'][_0x520202(0x373)]['equal'](kDOayV[_0x520202(0x26b)]);const [error]=result[_0x520202(0x17e)][_0x520202(0x220)];error[_0x520202(0x2ce)][_0x520202(0x373)][_0x520202(0x1bb)](kDOayV[_0x520202(0x1b3)]);}}),it(GcDKxy[_0x613983(0x44e)](_0x613983(0x26a),'and\x20`date`\x20parameter\x20in\x20the\x20future'),async()=>{const _0x57ce82=_0x613983,rootCapability={...capabilities[_0x57ce82(0x1d8)][_0x57ce82(0x3a5)]};rootCapability['id']=_0x57ce82(0x428),kDOayV[_0x57ce82(0x31f)](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x57ce82(0x217)](kDOayV[_0x57ce82(0x15e)](expires[_0x57ce82(0x2a2)](),0x32)),expires=expires[_0x57ce82(0x227)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x57ce82(0x33d)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x57ce82(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),doc=kDOayV[_0x57ce82(0x30d)](clone,mock['exampleDoc']),invocation=await kDOayV[_0x57ce82(0x2a3)](_invoke,{'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':kDOayV[_0x57ce82(0x386)]}),date=new Date();date['setHours'](date[_0x57ce82(0x2a2)]()+0x64);const result=await kDOayV[_0x57ce82(0x3de)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':kDOayV[_0x57ce82(0x386)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability['invocationTarget'],'suite':new Ed25519Signature2020(),'date':date}});kDOayV[_0x57ce82(0x463)](expect,result)['to'][_0x57ce82(0x290)],kDOayV[_0x57ce82(0x211)](expect,result[_0x57ce82(0x2d1)])['to']['be'][_0x57ce82(0x2f9)],should[_0x57ce82(0x290)](result[_0x57ce82(0x17e)]),result[_0x57ce82(0x17e)][_0x57ce82(0x2d5)][_0x57ce82(0x373)][_0x57ce82(0x1bb)](_0x57ce82(0x421));const [error]=result[_0x57ce82(0x17e)][_0x57ce82(0x220)];error[_0x57ce82(0x2ce)][_0x57ce82(0x373)][_0x57ce82(0x1bb)](kDOayV[_0x57ce82(0x1b3)]);}),GcDKxy[_0x613983(0x137)](it,GcDKxy['WkUXv'](_0x613983(0x1f6),GcDKxy['XuHOy']),async()=>{const _0x5044aa=_0x613983,rootCapability={...capabilities[_0x5044aa(0x1d8)]['beta']};rootCapability['id']=FXcoRt[_0x5044aa(0x2c6)],FXcoRt['KMkWR'](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x5044aa(0x217)](FXcoRt[_0x5044aa(0x403)](expires[_0x5044aa(0x2a2)](),0x32)),expires=expires[_0x5044aa(0x227)]();const bobZcap=await FXcoRt[_0x5044aa(0x303)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x5044aa(0x467)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x5044aa(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x5044aa(0x217)](FXcoRt[_0x5044aa(0x32c)](expires[_0x5044aa(0x2a2)](),0x32)),expires=expires[_0x5044aa(0x227)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x5044aa(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=FXcoRt[_0x5044aa(0x154)](clone,mock[_0x5044aa(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':FXcoRt[_0x5044aa(0x2ff)]}),date=new Date();date[_0x5044aa(0x217)](FXcoRt[_0x5044aa(0x32c)](date[_0x5044aa(0x2a2)](),0x14));const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':FXcoRt[_0x5044aa(0x2ff)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x5044aa(0x449)],'date':date}});FXcoRt[_0x5044aa(0x1cb)](expect,result)['to']['exist'],FXcoRt[_0x5044aa(0x3be)](expect,result['verified'])['to']['be'][_0x5044aa(0x2f9)],should[_0x5044aa(0x290)](result['error']),result[_0x5044aa(0x17e)][_0x5044aa(0x2d5)][_0x5044aa(0x373)][_0x5044aa(0x1bb)]('VerificationError');const [error]=result[_0x5044aa(0x17e)][_0x5044aa(0x220)];error['message'][_0x5044aa(0x373)][_0x5044aa(0x1bb)](_0x5044aa(0x398));}),it(_0x613983(0x1f6)+GcDKxy['plHdu'],async()=>{const _0x26b63b=_0x613983,rootCapability={...capabilities[_0x26b63b(0x1d8)][_0x26b63b(0x3a5)]};rootCapability['id']=kDOayV['MkOHF'],addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x26b63b(0x217)](expires[_0x26b63b(0x2a2)]()+0x32),expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x26b63b(0x164)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x26b63b(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x26b63b(0x217)](kDOayV[_0x26b63b(0x15e)](expires['getHours'](),0x19)),expires=expires[_0x26b63b(0x227)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x26b63b(0x449)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=kDOayV[_0x26b63b(0x41d)](clone,mock[_0x26b63b(0x357)]),invocation=await kDOayV['vtCEP'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':kDOayV[_0x26b63b(0x386)]}),date=new Date();date['setHours'](date[_0x26b63b(0x2a2)]()+0x1e);const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':kDOayV[_0x26b63b(0x386)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability['invocationTarget'],'suite':new Ed25519Signature2020(),'date':date}});expect(result)['to'][_0x26b63b(0x290)],kDOayV[_0x26b63b(0x15b)](expect,result[_0x26b63b(0x2d1)])['to']['be'][_0x26b63b(0x2f9)],should[_0x26b63b(0x290)](result[_0x26b63b(0x17e)]),result[_0x26b63b(0x17e)][_0x26b63b(0x2d5)][_0x26b63b(0x373)][_0x26b63b(0x1bb)]('VerificationError');const [error]=result['error'][_0x26b63b(0x220)];error['message'][_0x26b63b(0x373)][_0x26b63b(0x1bb)](kDOayV[_0x26b63b(0x1b3)]);}),it(_0x613983(0x1f6)+GcDKxy['LRlht'],async()=>{const _0x2ef546=_0x613983;if(FXcoRt[_0x2ef546(0x368)](FXcoRt[_0x2ef546(0x2f6)],FXcoRt[_0x2ef546(0x2ab)]))_0x51536f=_0x58908f;else{const rootCapability={...capabilities[_0x2ef546(0x1d8)][_0x2ef546(0x3a5)]};rootCapability['id']=FXcoRt[_0x2ef546(0x388)],FXcoRt[_0x2ef546(0x1fc)](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x2ef546(0x217)](FXcoRt[_0x2ef546(0x32c)](expires[_0x2ef546(0x2a2)](),0x32)),expires=expires[_0x2ef546(0x227)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x2ef546(0x13b)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x2ef546(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x2ef546(0x2cc)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=FXcoRt[_0x2ef546(0x3cb)](clone,mock[_0x2ef546(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':FXcoRt[_0x2ef546(0x2ff)]}),date=new Date();date[_0x2ef546(0x217)](date[_0x2ef546(0x2a2)]()-0x14);const result=await FXcoRt[_0x2ef546(0x453)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':FXcoRt[_0x2ef546(0x2ff)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x2ef546(0x449)],'date':date}});expect(result)['to'][_0x2ef546(0x290)],expect(result[_0x2ef546(0x2d1)])['to']['be']['false'],should['exist'](result[_0x2ef546(0x17e)]),result[_0x2ef546(0x17e)][_0x2ef546(0x2d5)][_0x2ef546(0x373)][_0x2ef546(0x1bb)](_0x2ef546(0x421));const [error]=result[_0x2ef546(0x17e)][_0x2ef546(0x220)];error[_0x2ef546(0x2ce)][_0x2ef546(0x373)]['equal'](_0x2ef546(0x257));}}),it(GcDKxy[_0x613983(0x3cd)]+_0x613983(0x3a6),async()=>{const _0x262056=_0x613983;if(FXcoRt[_0x262056(0x1fd)]===FXcoRt['BtDPX']){const rootCapability={...capabilities[_0x262056(0x1d8)][_0x262056(0x3a5)]};rootCapability['id']='urn:zcap:bcbcde5e-d64a-4f46-a76e-daf52f63f702',addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x262056(0x217)](expires[_0x262056(0x2a2)]()+0x32),expires=expires[_0x262056(0x227)]();const bobZcap=await FXcoRt['TwDwU'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x262056(0x19b)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x262056(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await FXcoRt['AnFUM'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x262056(0x207)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x262056(0x449)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=FXcoRt[_0x262056(0x303)](clone,mock[_0x262056(0x357)]),invocation=await FXcoRt['wZyAI'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x262056(0x3c8)}),date=new Date();date[_0x262056(0x217)](FXcoRt[_0x262056(0x403)](date['getHours'](),0x64));const result=await FXcoRt[_0x262056(0x147)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x262056(0x3c8),'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x262056(0x449)],'suite':new Ed25519Signature2020(),'date':date}});expect(result)['to'][_0x262056(0x290)],expect(result[_0x262056(0x2d1)])['to']['be'][_0x262056(0x2f9)],should[_0x262056(0x290)](result[_0x262056(0x17e)]),result['error'][_0x262056(0x2d5)][_0x262056(0x373)]['equal'](_0x262056(0x421));const [error]=result[_0x262056(0x17e)][_0x262056(0x220)];error['message']['should']['equal'](FXcoRt['hVJsp']);}else _0x2202d5=new _0x4126e4({'expectedRootCapability':'urn:foo','date':_0x262056(0x362)});}),it(_0x613983(0x3ed)+_0x613983(0x44d),async()=>{const _0x323823=_0x613983,uhMCFx={'VoPog':FXcoRt[_0x323823(0x3ab)]},rootCapability={...capabilities[_0x323823(0x1d8)][_0x323823(0x3a5)]};rootCapability['id']=_0x323823(0x289),addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x323823(0x217)](expires[_0x323823(0x2a2)]()+0x1),expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x323823(0x2c5)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x323823(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});let carolZcap,localError;try{carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x323823(0x449)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){FXcoRt[_0x323823(0x299)]!==FXcoRt[_0x323823(0x37e)]?localError=e:(_0x2b893a[_0x323823(0x373)]['be']['an']('object'),_0x319b3c['should'][_0x323823(0x42e)][_0x323823(0x1dd)]('id'),_0x3d8c56['should'][_0x323823(0x42e)][_0x323823(0x1dd)]('controller'),_0x327d7e[_0x323823(0x373)][_0x323823(0x42e)][_0x323823(0x1dd)](uhMCFx[_0x323823(0x35a)]));}FXcoRt[_0x323823(0x453)](expect,localError)['to'][_0x323823(0x290)],localError[_0x323823(0x2d5)][_0x323823(0x373)]['equal'](FXcoRt[_0x323823(0x185)]),localError[_0x323823(0x2ce)][_0x323823(0x373)][_0x323823(0x3fa)]('Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date'),carolZcap=await FXcoRt[_0x323823(0x2db)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt['IVPCq'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x323823(0x449)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=FXcoRt[_0x323823(0x177)](clone,mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':FXcoRt[_0x323823(0x2ff)]}),result=await FXcoRt['NgeLy'](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x323823(0x3c8)});FXcoRt['ALNde'](expect,result)['to'][_0x323823(0x290)],expect(result[_0x323823(0x2d1)])['to']['be'][_0x323823(0x2f9)],should['exist'](result[_0x323823(0x17e)]),result['error']['name'][_0x323823(0x373)][_0x323823(0x1bb)](FXcoRt[_0x323823(0x455)]);const [error]=result[_0x323823(0x17e)]['errors'];error[_0x323823(0x2ce)][_0x323823(0x373)][_0x323823(0x226)](FXcoRt[_0x323823(0x1b4)]);}),it(GcDKxy[_0x613983(0x20b)]+_0x613983(0x160),async()=>{const _0x5c8375=_0x613983,rootCapability={...capabilities[_0x5c8375(0x1d8)]['beta']};rootCapability['id']=_0x5c8375(0x291),addToLoader({'doc':rootCapability});const date=new Date();let expires=new Date();expires[_0x5c8375(0x217)](expires[_0x5c8375(0x2a2)]()+0x1),expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x5c8375(0x449)],'expires':expires},'date':date,'parentCapability':rootCapability,'delegator':alice}),carolZcap=await kDOayV['YcZLo'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x5c8375(0x3e7)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x5c8375(0x449)],'expires':expires},'date':date,'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});{const beforeDelegation=new Date(date[_0x5c8375(0x24b)]()-0x3e8),doc=kDOayV[_0x5c8375(0x241)](clone,mock['exampleDoc']),invocation=await _invoke({'doc':doc,'date':beforeDelegation,'invoker':carol,'capability':carolZcap,'capabilityAction':kDOayV[_0x5c8375(0x386)]}),result=await kDOayV[_0x5c8375(0x3de)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':kDOayV[_0x5c8375(0x386)]});expect(result)['to']['exist'],kDOayV['JFiqG'](expect,result[_0x5c8375(0x2d1)])['to']['be'][_0x5c8375(0x199)];}const beforeDelegation=new Date(date[_0x5c8375(0x24b)]()-kDOayV[_0x5c8375(0x155)](0x12d,0x3e8)),doc=kDOayV[_0x5c8375(0x278)](clone,mock[_0x5c8375(0x357)]),invocation=await kDOayV[_0x5c8375(0x22d)](_invoke,{'doc':doc,'date':beforeDelegation,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x5c8375(0x3c8)}),result=await kDOayV[_0x5c8375(0x162)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':kDOayV['XweVf']});kDOayV['HnRWA'](expect,result)['to'][_0x5c8375(0x290)],expect(result['verified'])['to']['be']['false'],should[_0x5c8375(0x290)](result['error']),result[_0x5c8375(0x17e)][_0x5c8375(0x2d5)][_0x5c8375(0x373)][_0x5c8375(0x1bb)](_0x5c8375(0x421));const [error]=result[_0x5c8375(0x17e)][_0x5c8375(0x220)];error['message']['should'][_0x5c8375(0x1bb)](kDOayV[_0x5c8375(0x239)]+kDOayV[_0x5c8375(0x406)]);}),it('should\x20fail\x20delegating\x20an\x20expired\x20capability',async()=>{const _0x55f77d=_0x613983;if(_0x55f77d(0x410)!==FXcoRt[_0x55f77d(0x397)])return _0x5c1aba++,_0x4c0c51[_0x55f77d(0x373)]['be']['an'](_0x55f77d(0x2ea)),_0x3ca3b1[_0x55f77d(0x373)][_0x55f77d(0x42e)]['length'](0x4),_0x3b5065[_0x55f77d(0x373)]['be']['an'](kDOayV[_0x55f77d(0x3d7)]),_0x670fb8['should'][_0x55f77d(0x42e)]['length'](0x4),_0x5763f9({'capabilityChain':_0x51af86}),_0x28d366({'capabilityChainMeta':_0x1e1a4b}),eval('_0x220a18[\'stringify\']({ \'safe\': !![] });'),{'valid':!![]};else{const rootCapability={...capabilities[_0x55f77d(0x1d8)][_0x55f77d(0x3a5)]};rootCapability['id']=FXcoRt['LAzsb'],addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x55f77d(0x217)](FXcoRt['TZKKP'](expires['getHours'](),0x1)),expires=expires[_0x55f77d(0x227)]();const bobZcap=await FXcoRt['yEhDv'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x55f77d(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),afterExpired=new Date(Date[_0x55f77d(0x313)](expires)+FXcoRt[_0x55f77d(0x454)](0x12d,0x3e8));let carolZcap,localError;try{carolZcap=await FXcoRt[_0x55f77d(0x147)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x55f77d(0x33b)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x55f77d(0x449)],'expires':expires},'date':afterExpired,'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to'][_0x55f77d(0x290)],localError[_0x55f77d(0x2d5)][_0x55f77d(0x373)]['equal'](_0x55f77d(0x45e)),localError[_0x55f77d(0x2ce)]['should'][_0x55f77d(0x3fa)](FXcoRt[_0x55f77d(0x261)]),carolZcap=await FXcoRt[_0x55f77d(0x445)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x55f77d(0x449)],'expires':expires},'date':afterExpired,'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=clone(mock[_0x55f77d(0x357)]),invocation=await FXcoRt['vnSeL'](_invoke,{'doc':doc,'date':afterExpired,'invoker':carol,'capability':carolZcap,'capabilityAction':FXcoRt[_0x55f77d(0x2ff)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read','purposeOptions':{'date':afterExpired}});expect(result)['to'][_0x55f77d(0x290)],FXcoRt[_0x55f77d(0x2b6)](expect,result[_0x55f77d(0x2d1)])['to']['be']['false'],should[_0x55f77d(0x290)](result[_0x55f77d(0x17e)]),result['error'][_0x55f77d(0x2d5)][_0x55f77d(0x373)]['equal'](FXcoRt['DitCJ']);const [error]=result[_0x55f77d(0x17e)][_0x55f77d(0x220)];error['message'][_0x55f77d(0x373)]['equal'](FXcoRt[_0x55f77d(0x429)]);}}),GcDKxy[_0x613983(0x36d)](it,GcDKxy[_0x613983(0x353)]+GcDKxy['NYKqH'],async()=>{const _0x53aeb3=_0x613983,rootCapability={...capabilities[_0x53aeb3(0x1d8)]['beta']};rootCapability['id']=FXcoRt[_0x53aeb3(0x179)],FXcoRt[_0x53aeb3(0x44b)](addToLoader,{'doc':rootCapability});let expires=new Date(0x0);expires=expires[_0x53aeb3(0x227)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x53aeb3(0x467)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x53aeb3(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x53aeb3(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':FXcoRt[_0x53aeb3(0x2ff)]});FXcoRt[_0x53aeb3(0x43b)](expect,result)['to']['exist'],expect(result[_0x53aeb3(0x2d1)])['to']['be'][_0x53aeb3(0x2f9)],should[_0x53aeb3(0x290)](result['error']),result[_0x53aeb3(0x17e)][_0x53aeb3(0x220)][_0x53aeb3(0x373)]['have'][_0x53aeb3(0x2a8)](0x1);const [error]=result['error'][_0x53aeb3(0x220)];error[_0x53aeb3(0x2ce)][_0x53aeb3(0x373)][_0x53aeb3(0x1bb)](FXcoRt[_0x53aeb3(0x429)]);}),GcDKxy[_0x613983(0x1e5)](it,GcDKxy[_0x613983(0x27b)](GcDKxy[_0x613983(0x3fb)],GcDKxy[_0x613983(0x3a9)]),async()=>{const _0x4b1896=_0x613983,rootCapability={...capabilities[_0x4b1896(0x1d8)][_0x4b1896(0x3a5)]};rootCapability['id']=_0x4b1896(0x2af),addToLoader({'doc':rootCapability});let expires=new Date();expires['setHours'](expires[_0x4b1896(0x2a2)]()+0xa),expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x4b1896(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x4b1896(0x217)](expires[_0x4b1896(0x2a2)]()-0xa),expires=expires['toISOString']();const carolZcap=await kDOayV['NMefM'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x4b1896(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=kDOayV[_0x4b1896(0x15a)](clone,mock[_0x4b1896(0x357)]),invocation=await kDOayV[_0x4b1896(0x169)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':kDOayV['XweVf']}),result=await kDOayV[_0x4b1896(0x17d)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':kDOayV[_0x4b1896(0x386)]});kDOayV[_0x4b1896(0x40e)](expect,result)['to'][_0x4b1896(0x290)],expect(result['verified'])['to']['be']['false'],should[_0x4b1896(0x290)](result[_0x4b1896(0x17e)]),result['error'][_0x4b1896(0x2d5)][_0x4b1896(0x373)][_0x4b1896(0x1bb)](kDOayV[_0x4b1896(0x26b)]);const [error]=result[_0x4b1896(0x17e)]['errors'];error[_0x4b1896(0x2ce)][_0x4b1896(0x373)]['equal'](kDOayV['qIITR']);}),it('should\x20fail\x20invoking\x20a\x20capability\x20with\x20second\x20delegated\x20'+GcDKxy[_0x613983(0x1a6)],async()=>{const _0x1e2edc=_0x613983,rootCapability={...capabilities[_0x1e2edc(0x1d8)][_0x1e2edc(0x3a5)]};rootCapability['id']=kDOayV[_0x1e2edc(0x20a)],kDOayV[_0x1e2edc(0x211)](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x1e2edc(0x217)](kDOayV[_0x1e2edc(0x15e)](expires[_0x1e2edc(0x2a2)](),0xa)),expires=expires[_0x1e2edc(0x227)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':kDOayV[_0x1e2edc(0x3e7)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x1e2edc(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(0x0),expires=expires['toISOString']();const carolZcap=await kDOayV[_0x1e2edc(0x41b)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x1e2edc(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x1e2edc(0x357)]),invocation=await kDOayV[_0x1e2edc(0x211)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x1e2edc(0x3c8)});kDOayV[_0x1e2edc(0x22d)](expect,result)['to'][_0x1e2edc(0x290)],expect(result[_0x1e2edc(0x2d1)])['to']['be'][_0x1e2edc(0x2f9)],should[_0x1e2edc(0x290)](result[_0x1e2edc(0x17e)]),result['error'][_0x1e2edc(0x220)][_0x1e2edc(0x373)]['have']['length'](0x1);const [error]=result[_0x1e2edc(0x17e)][_0x1e2edc(0x220)];error[_0x1e2edc(0x2ce)][_0x1e2edc(0x373)][_0x1e2edc(0x1bb)](kDOayV[_0x1e2edc(0x1b3)]);}),it(GcDKxy['wbRpY'](GcDKxy[_0x613983(0x353)],GcDKxy[_0x613983(0x40b)]),async()=>{const _0x19cc73=_0x613983,rootCapability={...capabilities['root'][_0x19cc73(0x3a5)]};rootCapability['id']=FXcoRt[_0x19cc73(0x15f)],addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x19cc73(0x217)](FXcoRt['NDkIy'](expires['getHours'](),0xa)),expires=expires[_0x19cc73(0x227)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x19cc73(0x449)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x19cc73(0x217)](FXcoRt[_0x19cc73(0x3c0)](expires['getHours'](),0x64)),expires=expires[_0x19cc73(0x227)]();let carolZcap,localError;try{carolZcap=await FXcoRt[_0x19cc73(0x22a)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x19cc73(0x449)],'expires':expires},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}FXcoRt['RMSRm'](expect,localError)['to']['exist'],localError[_0x19cc73(0x2d5)]['should'][_0x19cc73(0x1bb)]('Error'),localError['message'][_0x19cc73(0x373)]['equal'](FXcoRt[_0x19cc73(0x1a4)]+FXcoRt[_0x19cc73(0x465)]+FXcoRt[_0x19cc73(0x34f)]),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=FXcoRt[_0x19cc73(0x45f)](clone,mock['exampleDoc']),invocation=await FXcoRt[_0x19cc73(0x1c0)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x19cc73(0x3c8)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':FXcoRt[_0x19cc73(0x2ff)]});expect(result)['to'][_0x19cc73(0x290)],expect(result[_0x19cc73(0x2d1)])['to']['be'][_0x19cc73(0x2f9)],should[_0x19cc73(0x290)](result[_0x19cc73(0x17e)]),result[_0x19cc73(0x17e)][_0x19cc73(0x2d5)]['should'][_0x19cc73(0x1bb)](_0x19cc73(0x421));const [error]=result['error'][_0x19cc73(0x220)];error['message']['should'][_0x19cc73(0x3fa)](FXcoRt[_0x19cc73(0x275)]);}),GcDKxy[_0x613983(0x383)](it,'should\x20verify\x20invoking\x20a\x20capability\x20with\x20only\x20expires\x20on\x20'+GcDKxy[_0x613983(0x3a9)],async()=>{const _0x4b92c2=_0x613983;if(FXcoRt[_0x4b92c2(0x368)](_0x4b92c2(0x1d1),FXcoRt['JBIfK']))_0x59298f=_0x28b6a7;else{const rootCapability={...capabilities[_0x4b92c2(0x1d8)][_0x4b92c2(0x3a5)]};rootCapability['id']=_0x4b92c2(0x139),FXcoRt[_0x4b92c2(0x1ae)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice});let expires=new Date();expires[_0x4b92c2(0x217)](expires['getHours']()+0xa),expires=expires[_0x4b92c2(0x227)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt['zwICO'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x4b92c2(0x449)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=FXcoRt[_0x4b92c2(0x396)](clone,mock[_0x4b92c2(0x357)]),invocation=await FXcoRt['yEhDv'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':FXcoRt[_0x4b92c2(0x2ff)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x4b92c2(0x3c8)});FXcoRt['hWEQW'](expect,result)['to']['exist'],expect(result[_0x4b92c2(0x2d1)])['to']['be'][_0x4b92c2(0x199)];}}),GcDKxy[_0x613983(0x336)](it,_0x613983(0x1ee)+_0x613983(0x247),async()=>{const _0x28f003=_0x613983,rootCapability={...capabilities[_0x28f003(0x1d8)]['beta']};rootCapability['id']=FXcoRt[_0x28f003(0x23d)],addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice});let expires=new Date();expires[_0x28f003(0x217)](FXcoRt['dcrWi'](expires[_0x28f003(0x2a2)](),0xa)),expires=expires[_0x28f003(0x227)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt['poNyW'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x28f003(0x449)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x28f003(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':FXcoRt[_0x28f003(0x2ff)]}),result=await FXcoRt[_0x28f003(0x1d2)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x28f003(0x3c8)});FXcoRt[_0x28f003(0x1b5)](expect,result)['to'][_0x28f003(0x290)],FXcoRt[_0x28f003(0x41f)](expect,result[_0x28f003(0x2d1)])['to']['be'][_0x28f003(0x2f9)],should[_0x28f003(0x290)](result[_0x28f003(0x17e)]),result['error'][_0x28f003(0x2d5)][_0x28f003(0x373)]['equal'](_0x28f003(0x421));const [error]=result[_0x28f003(0x17e)][_0x28f003(0x220)];error[_0x28f003(0x2ce)][_0x28f003(0x373)][_0x28f003(0x1bb)](_0x28f003(0x398));});}),describe(_0xae883a(0x3d8),()=>{const _0x57357c=_0xae883a,tGSsLV={'bZDiB':function(callee,param1){return callee(param1);},'hidWr':function(callee,param1){return callee(param1);},'VLOsQ':function(callee,param1){return callee(param1);},'voZeU':function(callee,param1){return callee(param1);},'arxts':function(callee,param1){return callee(param1);}};FXcoRt[_0x57357c(0x1aa)](it,FXcoRt[_0x57357c(0x14a)],async()=>{const _0x18e8ce=_0x57357c,bobZcap=await tGSsLV[_0x18e8ce(0x3b1)](_delegate,{'parentCapability':capabilities[_0x18e8ce(0x1d8)][_0x18e8ce(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await tGSsLV[_0x18e8ce(0x3b1)](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol}),result=await tGSsLV[_0x18e8ce(0x3b1)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x18e8ce(0x1d8)][_0x18e8ce(0x3a5)]['id']});expect(result)['to'][_0x18e8ce(0x290)],tGSsLV['hidWr'](expect,result[_0x18e8ce(0x2d1)])['to']['be'][_0x18e8ce(0x199)];}),FXcoRt[_0x57357c(0x22b)](it,_0x57357c(0x1bc),async()=>{const _0x5e7694=_0x57357c,hqgdyC={'nWeiU':FXcoRt[_0x5e7694(0x2ed)],'yozIj':FXcoRt[_0x5e7694(0x3ab)],'PVyxK':function(x,y){const _0x5acd19=_0x5e7694;return FXcoRt[_0x5acd19(0x2d0)](x,y);},'zHPOD':_0x5e7694(0x330),'eVDqn':function(callee,param1){const _0x3a37d6=_0x5e7694;return FXcoRt[_0x3a37d6(0x1bd)](callee,param1);},'NydyX':FXcoRt['zKWwD']},bobZcap=await _delegate({'parentCapability':capabilities[_0x5e7694(0x1d8)][_0x5e7694(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await _delegate({'parentCapability':carolZcap,'controller':diana,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x106005=_0x5e7694;if(hqgdyC['PVyxK'](_0x106005(0x330),hqgdyC[_0x106005(0x20f)])){const fHLrdD='4|5|2|8|7|1|0|6|3'[_0x106005(0x1c3)]('|');let rBTOWC=0x0;while(!![]){switch(fHLrdD[rBTOWC++]){case'0':hqgdyC['eVDqn'](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta});continue;case'1':_checkCapabilityChain({'capabilityChain':capabilityChain});continue;case'2':capabilityChain[_0x106005(0x373)]['have'][_0x106005(0x2a8)](0x4);continue;case'3':return{'valid':!![]};case'4':checkedChain++;continue;case'5':capabilityChain[_0x106005(0x373)]['be']['an'](hqgdyC[_0x106005(0x3f7)]);continue;case'6':new Function(_0x106005(0x276))();continue;case'7':capabilityChainMeta['should']['have'][_0x106005(0x2a8)](0x4);continue;case'8':capabilityChainMeta[_0x106005(0x373)]['be']['an'](hqgdyC[_0x106005(0x3f7)]);continue;}break;}}else for(const _0x298465 of _0x3751e3){_0x298465[_0x106005(0x373)]['be']['an'](hqgdyC['nWeiU']),_0x298465[_0x106005(0x373)][_0x106005(0x42e)][_0x106005(0x1dd)]('id'),_0x298465[_0x106005(0x373)]['have']['property']('controller'),_0x298465[_0x106005(0x373)][_0x106005(0x42e)][_0x106005(0x1dd)](hqgdyC['yozIj']);}},result=await FXcoRt[_0x5e7694(0x445)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x5e7694(0x1d8)]['beta']['id'],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to'][_0x5e7694(0x290)],expect(result['verified'])['to']['be'][_0x5e7694(0x199)],checkedChain[_0x5e7694(0x373)][_0x5e7694(0x1bb)](0x1);}),it(FXcoRt[_0x57357c(0x2a6)],async()=>{const _0x17d552=_0x57357c;if(_0x17d552(0x17f)===FXcoRt[_0x17d552(0x23c)])_0xa448cd=new _0x5cbfc7({'suite':new _0x5ab492(),..._0x387c26});else{const bobZcap=await FXcoRt[_0x17d552(0x2db)](_delegate,{'parentCapability':capabilities['root'][_0x17d552(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await FXcoRt[_0x17d552(0x302)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await FXcoRt['FUtLJ'](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol,'purposeOptions':{'_skipLocalValidationForTesting':!![],'_capabilityChain':[capabilities[_0x17d552(0x1d8)][_0x17d552(0x3a5)]['id'],bobZcap,carolZcap]}}),result=await FXcoRt['NeKXS'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities['root']['beta']['id']});expect(result)['to'][_0x17d552(0x290)],expect(result[_0x17d552(0x2d1)])['to']['be'][_0x17d552(0x2f9)],should[_0x17d552(0x290)](result[_0x17d552(0x17e)]),result['error'][_0x17d552(0x2d5)][_0x17d552(0x373)][_0x17d552(0x1bb)](_0x17d552(0x421)),should[_0x17d552(0x290)](result[_0x17d552(0x17e)][_0x17d552(0x220)]);const [error]=result[_0x17d552(0x17e)][_0x17d552(0x220)];error[_0x17d552(0x2ce)]['should'][_0x17d552(0x3fa)](FXcoRt['LWaPT']);}}),FXcoRt[_0x57357c(0x402)](it,_0x57357c(0x1e3),async()=>{const _0x4eef47=_0x57357c,AqaRCq={'RuRAa':function(callee,param1){return tGSsLV['VLOsQ'](callee,param1);},'rnWWb':function(callee,param1){const _0x103dd0=_0x3b69;return tGSsLV[_0x103dd0(0x3b1)](callee,param1);}},bobZcap=await tGSsLV[_0x4eef47(0x440)](_delegate,{'parentCapability':capabilities[_0x4eef47(0x1d8)][_0x4eef47(0x3a5)],'controller':bob,'delegator':alice}),carolZcap=await tGSsLV['bZDiB'](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await tGSsLV[_0x4eef47(0x253)](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x28e59c=_0x4eef47;return checkedChain++,capabilityChain['should']['be']['an'](_0x28e59c(0x2ea)),capabilityChain[_0x28e59c(0x373)]['have'][_0x28e59c(0x2a8)](0x4),capabilityChainMeta[_0x28e59c(0x373)]['be']['an'](_0x28e59c(0x2ea)),capabilityChainMeta[_0x28e59c(0x373)][_0x28e59c(0x42e)]['length'](0x4),AqaRCq['RuRAa'](_checkCapabilityChain,{'capabilityChain':capabilityChain}),AqaRCq[_0x28e59c(0x1fa)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),eval('const _0x410db7 = _0x28e59c;JSON[_0x410db7(784)]({ \'safe\': !![] });'),{'valid':!![]};},result=await tGSsLV[_0x4eef47(0x440)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x4eef47(0x1d8)]['beta']['id'],'purposeOptions':{'inspectCapabilityChain':inspectCapabilityChain,'maxChainLength':0x2}});tGSsLV[_0x4eef47(0x24f)](expect,result)['to'][_0x4eef47(0x290)],tGSsLV['bZDiB'](expect,result[_0x4eef47(0x2d1)])['to']['be'][_0x4eef47(0x2f9)],should[_0x4eef47(0x290)](result[_0x4eef47(0x17e)]),should[_0x4eef47(0x290)](result['error'][_0x4eef47(0x220)]),result[_0x4eef47(0x17e)][_0x4eef47(0x220)][_0x4eef47(0x373)][_0x4eef47(0x42e)][_0x4eef47(0x2a8)](0x1),result[_0x4eef47(0x17e)][_0x4eef47(0x220)][0x0][_0x4eef47(0x2ce)][_0x4eef47(0x373)][_0x4eef47(0x1bb)](_0x4eef47(0x461)),checkedChain[_0x4eef47(0x373)][_0x4eef47(0x1bb)](0x0);});}),GcDKxy[_0xae883a(0x364)](describe,GcDKxy[_0xae883a(0x284)],()=>{const _0x4d4f6d=_0xae883a,pNBLjX={'EYiCg':function(callee,param1){return callee(param1);},'fHIVP':function(callee){const _0x5c701f=_0x3b69;return GcDKxy[_0x5c701f(0x311)](callee);},'nXoGa':_0x4d4f6d(0x30a),'fmdoi':function(callee,param1){return callee(param1);},'ZxSWz':function(callee){return callee();},'jkgVn':function(callee,param1){const _0x571a79=_0x4d4f6d;return GcDKxy[_0x571a79(0x37d)](callee,param1);},'wfHvj':function(callee,param1){const _0xf530e2=_0x4d4f6d;return GcDKxy[_0xf530e2(0x192)](callee,param1);},'pfrfR':function(callee,param1){const _0x4422e1=_0x4d4f6d;return GcDKxy[_0x4422e1(0x34b)](callee,param1);},'fXYNR':GcDKxy[_0x4d4f6d(0x202)],'jiJXG':function(callee,param1){return callee(param1);},'JnifD':function(callee,param1){const _0x1e27d2=_0x4d4f6d;return GcDKxy[_0x1e27d2(0x414)](callee,param1);},'CPgkh':function(callee,param1){return callee(param1);},'aCCsl':function(callee){return callee();},'hwhkM':function(x,y){const _0x2ca604=_0x4d4f6d;return GcDKxy[_0x2ca604(0x44e)](x,y);},'pRmCO':function(callee,param1){return GcDKxy['XJeeK'](callee,param1);},'EBBVr':function(callee){return GcDKxy['cUIUj'](callee);},'kYaOb':function(callee,param1){return GcDKxy['EVVqh'](callee,param1);},'OZEiZ':function(callee,param1){return callee(param1);},'bBWsS':function(callee,param1){const _0x8c49=_0x4d4f6d;return GcDKxy[_0x8c49(0x1af)](callee,param1);},'vzhjW':function(callee){const _0x351fde=_0x4d4f6d;return GcDKxy[_0x351fde(0x38b)](callee);},'ybAPw':function(callee,param1){const _0x381e1c=_0x4d4f6d;return GcDKxy[_0x381e1c(0x1c5)](callee,param1);},'tmnvu':function(callee,param1){const _0x579d97=_0x4d4f6d;return GcDKxy[_0x579d97(0x2ba)](callee,param1);},'hNlPC':function(callee){const _0x3ffae0=_0x4d4f6d;return GcDKxy[_0x3ffae0(0x311)](callee);},'HYVhC':function(callee,param1){const _0x253958=_0x4d4f6d;return GcDKxy[_0x253958(0x446)](callee,param1);},'eQkzm':function(callee){return callee();},'KCoQr':_0x4d4f6d(0x322),'XxKQd':function(callee,param1){const _0x597de7=_0x4d4f6d;return GcDKxy[_0x597de7(0x205)](callee,param1);},'Syeme':function(callee,param1){return callee(param1);},'NaEdh':function(callee){return GcDKxy['cUIUj'](callee);},'xBgqN':function(callee,param1){const _0x1bdbe6=_0x4d4f6d;return GcDKxy[_0x1bdbe6(0x26e)](callee,param1);},'EyAUe':function(x,y){const _0x59fe2f=_0x4d4f6d;return GcDKxy[_0x59fe2f(0x436)](x,y);},'EImKe':_0x4d4f6d(0x394),'hbaFx':_0x4d4f6d(0x2ea)};GcDKxy[_0x4d4f6d(0x36b)](it,GcDKxy[_0x4d4f6d(0x14f)],async()=>{const _0x264365=_0x4d4f6d,rootTarget=FXcoRt[_0x264365(0x189)],rootCapability=FXcoRt[_0x264365(0x396)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});FXcoRt[_0x264365(0x45a)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await FXcoRt[_0x264365(0x172)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x264365(0x449)]+_0x264365(0x390),dianaZcap=await FXcoRt[_0x264365(0x167)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x264365(0x13b)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x264365(0x290)],expect(result[_0x264365(0x2d1)])['to']['be']['true'];}),GcDKxy[_0x4d4f6d(0x31e)](it,'should\x20verify\x20chain\x20w/query\x20attenuation',async()=>{const _0x4760a3=_0x4d4f6d,rootTarget=_0x4760a3(0x1ca),rootCapability=pNBLjX[_0x4760a3(0x33e)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await pNBLjX[_0x4760a3(0x33e)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x4760a3(0x449)]+_0x4760a3(0x3b0),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX[_0x4760a3(0x3e9)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await pNBLjX['EYiCg'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x4760a3(0x290)],expect(result[_0x4760a3(0x2d1)])['to']['be'][_0x4760a3(0x199)];}),GcDKxy[_0x4d4f6d(0x355)](it,GcDKxy[_0x4d4f6d(0x427)],async()=>{const _0x4c3930=_0x4d4f6d,rootTarget=FXcoRt[_0x4c3930(0x298)],rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});FXcoRt['SfFfl'](addToLoader,{'doc':rootCapability});const bobZcap=await FXcoRt[_0x4c3930(0x39d)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x4c3930(0x449)]+_0x4c3930(0x43d),dianaZcap=await FXcoRt[_0x4c3930(0x3c3)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt['HyIzm'](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await FXcoRt['dtcyc'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});FXcoRt[_0x4c3930(0x224)](expect,result)['to']['exist'],FXcoRt[_0x4c3930(0x349)](expect,result[_0x4c3930(0x2d1)])['to']['be']['true'];}),it(GcDKxy[_0x4d4f6d(0x35e)](_0x4d4f6d(0x333),_0x4d4f6d(0x3ba)),async()=>{const _0x1a76bb=_0x4d4f6d,rootTarget=_0x1a76bb(0x2b9),rootCapability=FXcoRt[_0x1a76bb(0x267)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await FXcoRt[_0x1a76bb(0x43b)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+_0x1a76bb(0x390),carolZcap=await FXcoRt[_0x1a76bb(0x1cb)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':FXcoRt[_0x1a76bb(0x151)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await FXcoRt['HGKOO'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});FXcoRt[_0x1a76bb(0x3be)](expect,result)['to']['exist'],expect(result[_0x1a76bb(0x2d1)])['to']['be'][_0x1a76bb(0x2f9)],result[_0x1a76bb(0x17e)][_0x1a76bb(0x220)][_0x1a76bb(0x373)][_0x1a76bb(0x42e)][_0x1a76bb(0x2a8)](0x1);const [error]=result[_0x1a76bb(0x17e)][_0x1a76bb(0x220)];error[_0x1a76bb(0x2ce)][_0x1a76bb(0x373)][_0x1a76bb(0x226)](FXcoRt['XweYH']);}),GcDKxy[_0x4d4f6d(0x1e5)](it,GcDKxy[_0x4d4f6d(0x2bb)]+GcDKxy['GXkOX'],async()=>{const _0x3fdcc3=_0x4d4f6d,rootTarget=pNBLjX[_0x3fdcc3(0x435)],rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});pNBLjX['EYiCg'](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+_0x3fdcc3(0x3b0),carolZcap=await pNBLjX[_0x3fdcc3(0x37c)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX['ZxSWz'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await pNBLjX[_0x3fdcc3(0x33e)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await pNBLjX[_0x3fdcc3(0x1e8)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});pNBLjX[_0x3fdcc3(0x33e)](expect,result)['to'][_0x3fdcc3(0x290)],pNBLjX[_0x3fdcc3(0x37f)](expect,result[_0x3fdcc3(0x2d1)])['to']['be'][_0x3fdcc3(0x2f9)],result[_0x3fdcc3(0x17e)][_0x3fdcc3(0x220)]['should']['have'][_0x3fdcc3(0x2a8)](0x1);const [error]=result['error']['errors'];error[_0x3fdcc3(0x2ce)][_0x3fdcc3(0x373)][_0x3fdcc3(0x226)](_0x3fdcc3(0x29f));}),it(GcDKxy['oprHp']+_0x4d4f6d(0x2e5),async()=>{const _0x59d7fd=_0x4d4f6d,rootTarget=_0x59d7fd(0x3e3)+uuid(),rootCapability=pNBLjX[_0x59d7fd(0x37f)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});pNBLjX[_0x59d7fd(0x37c)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x59d7fd(0x449)]+'/a-specific-document',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x59d7fd(0x357)]),invocation=await pNBLjX['pfrfR'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':pNBLjX['fXYNR']}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':'read','expectedTarget':[rootTarget,invocationTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to'][_0x59d7fd(0x290)],expect(result[_0x59d7fd(0x2d1)])['to']['be']['true'];}),it(GcDKxy['THndI']('should\x20verify\x20when\x20invoking\x20at\x20an\x20exact-match\x20target\x20',_0x4d4f6d(0x219)),async()=>{const _0x1ae671=_0x4d4f6d,rootTarget='https://example.com/edvs/'+uuid(),rootCapability=pNBLjX[_0x1ae671(0x317)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});pNBLjX[_0x1ae671(0x3d4)](addToLoader,{'doc':rootCapability});const bobZcap=await pNBLjX[_0x1ae671(0x42b)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x1ae671(0x449)]+'?foo=bar',carolZcap=await pNBLjX['fmdoi'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x1ae671(0x357)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':pNBLjX[_0x1ae671(0x1ce)]}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':'read','expectedTarget':[rootTarget,invocationTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to']['exist'],expect(result[_0x1ae671(0x2d1)])['to']['be'][_0x1ae671(0x199)];}),it(_0x4d4f6d(0x3b9)+GcDKxy[_0x4d4f6d(0x1ef)],async()=>{const _0x5583a1=_0x4d4f6d,rootTarget=_0x5583a1(0x3e3)+pNBLjX[_0x5583a1(0x12f)](uuid),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});pNBLjX[_0x5583a1(0x3d4)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x5583a1(0x449)]+_0x5583a1(0x390),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX['ZxSWz'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invalidTarget=rootTarget+_0x5583a1(0x19c),invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x5583a1(0x3c8),'invocationTarget':invalidTarget}}),expectedTarget=[rootTarget,invocationTarget],purpose=new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':pNBLjX[_0x5583a1(0x1ce)],'expectedTarget':expectedTarget,'expectedRootCapability':rootCapability['id'],'suite':new Ed25519Signature2020()});purpose[_0x5583a1(0x19e)]=()=>!![];const result=await jsigs[_0x5583a1(0x3b5)](invocation,{'suite':new Ed25519Signature2020(),'purpose':purpose,'documentLoader':testLoader});pNBLjX[_0x5583a1(0x37f)](expect,result)['to'][_0x5583a1(0x290)],expect(result[_0x5583a1(0x2d1)])['to']['be'][_0x5583a1(0x2f9)],result['error']['errors']['should'][_0x5583a1(0x42e)]['length'](0x1);const [error]=result['error'][_0x5583a1(0x220)];error[_0x5583a1(0x2ce)][_0x5583a1(0x373)]['include'](pNBLjX[_0x5583a1(0x270)]('Invocation\x20target\x20('+invalidTarget+_0x5583a1(0x3da),_0x5583a1(0x204)+carolZcap[_0x5583a1(0x449)]+').'));}),GcDKxy[_0x4d4f6d(0x1d3)](it,GcDKxy[_0x4d4f6d(0x35e)](_0x4d4f6d(0x3b9),GcDKxy[_0x4d4f6d(0x389)]),async()=>{const _0x33e01f=_0x4d4f6d,rootTarget=_0x33e01f(0x3e3)+FXcoRt[_0x33e01f(0x2e1)](uuid),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});FXcoRt[_0x33e01f(0x401)](addToLoader,{'doc':rootCapability});const bobZcap=await FXcoRt[_0x33e01f(0x413)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x33e01f(0x449)]+'?foo=bar',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x33e01f(0x357)]),invalidTarget=rootTarget+'/a-different-specific-document?foo=bar',invocation=await FXcoRt['xkRnH'](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':FXcoRt[_0x33e01f(0x2ff)],'invocationTarget':invalidTarget}}),expectedTarget=[rootTarget,invocationTarget],purpose=new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':_0x33e01f(0x3c8),'expectedTarget':expectedTarget,'expectedRootCapability':rootCapability['id'],'suite':new Ed25519Signature2020()});purpose[_0x33e01f(0x19e)]=()=>!![];const result=await jsigs['verify'](invocation,{'suite':new Ed25519Signature2020(),'purpose':purpose,'documentLoader':testLoader});FXcoRt[_0x33e01f(0x3e1)](expect,result)['to'][_0x33e01f(0x290)],FXcoRt[_0x33e01f(0x272)](expect,result['verified'])['to']['be'][_0x33e01f(0x2f9)],result[_0x33e01f(0x17e)][_0x33e01f(0x220)][_0x33e01f(0x373)]['have'][_0x33e01f(0x2a8)](0x1);const [error]=result[_0x33e01f(0x17e)][_0x33e01f(0x220)];error[_0x33e01f(0x2ce)][_0x33e01f(0x373)]['include'](_0x33e01f(0x3cc)+invalidTarget+_0x33e01f(0x3da)+(_0x33e01f(0x204)+carolZcap[_0x33e01f(0x449)]+').'));}),it(_0x4d4f6d(0x2b2)+GcDKxy[_0x4d4f6d(0x12d)],async()=>{const _0x1a5d35=_0x4d4f6d,rootTarget=_0x1a5d35(0x3e3)+uuid(),rootCapability=pNBLjX[_0x1a5d35(0x42b)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});pNBLjX[_0x1a5d35(0x1e8)](addToLoader,{'doc':rootCapability});const bobZcap=await pNBLjX[_0x1a5d35(0x412)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x1a5d35(0x449)]+'/a-specific-document',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX['EBBVr'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x1a5d35(0x357)]),validSubTarget=carolZcap['invocationTarget']+'/sub-path',invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x1a5d35(0x3c8),'invocationTarget':validSubTarget}}),result=await pNBLjX[_0x1a5d35(0x146)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':_0x1a5d35(0x3c8),'expectedTarget':[rootTarget,validSubTarget],'expectedRootCapability':rootCapability['id']}});pNBLjX['OZEiZ'](expect,result)['to'][_0x1a5d35(0x290)],expect(result[_0x1a5d35(0x2d1)])['to']['be'][_0x1a5d35(0x199)];}),it(_0x4d4f6d(0x2b2)+_0x4d4f6d(0x219),async()=>{const _0x213680=_0x4d4f6d,rootTarget=_0x213680(0x3e3)+uuid(),rootCapability=pNBLjX[_0x213680(0x3b4)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x213680(0x449)]+_0x213680(0x3b0),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX[_0x213680(0x3b2)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=pNBLjX[_0x213680(0x38e)](clone,mock[_0x213680(0x357)]),validSubTarget=carolZcap['invocationTarget']+'&baz=fuzz',invocation=await pNBLjX['tmnvu'](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x213680(0x3c8),'invocationTarget':validSubTarget}}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':pNBLjX[_0x213680(0x1ce)],'expectedTarget':[rootTarget,validSubTarget],'expectedRootCapability':rootCapability['id']}});pNBLjX[_0x213680(0x3d4)](expect,result)['to'][_0x213680(0x290)],pNBLjX[_0x213680(0x187)](expect,result['verified'])['to']['be'][_0x213680(0x199)];}),GcDKxy['TALhw'](it,_0x4d4f6d(0x281)+GcDKxy[_0x4d4f6d(0x1ef)],async()=>{const _0xfdbe4d=_0x4d4f6d,rootTarget=_0xfdbe4d(0x3e3)+pNBLjX[_0xfdbe4d(0x424)](uuid),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0xfdbe4d(0x449)]+_0xfdbe4d(0x390),carolZcap=await pNBLjX[_0xfdbe4d(0x2cf)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX[_0xfdbe4d(0x14e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0xfdbe4d(0x357)]),invalidTarget=rootTarget+_0xfdbe4d(0x19c),invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0xfdbe4d(0x3c8),'invocationTarget':invalidTarget}}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':'read','expectedTarget':[rootTarget,invalidTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to'][_0xfdbe4d(0x290)],pNBLjX['CPgkh'](expect,result[_0xfdbe4d(0x2d1)])['to']['be'][_0xfdbe4d(0x2f9)],result['error']['errors'][_0xfdbe4d(0x373)][_0xfdbe4d(0x42e)][_0xfdbe4d(0x2a8)](0x1);const [error]=result[_0xfdbe4d(0x17e)][_0xfdbe4d(0x220)];error[_0xfdbe4d(0x2ce)][_0xfdbe4d(0x373)]['include'](pNBLjX[_0xfdbe4d(0x270)](_0xfdbe4d(0x3cc)+invalidTarget+_0xfdbe4d(0x3da),'target\x20('+carolZcap[_0xfdbe4d(0x449)]+')'));}),it(GcDKxy[_0x4d4f6d(0x42d)](GcDKxy[_0x4d4f6d(0x1c7)],_0x4d4f6d(0x39b)),async()=>{const _0x51ad89=_0x4d4f6d,rootTarget=_0x51ad89(0x3e3)+uuid(),rootCapability=FXcoRt[_0x51ad89(0x248)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});FXcoRt[_0x51ad89(0x33a)](addToLoader,{'doc':rootCapability});const bobZcap=await FXcoRt[_0x51ad89(0x14b)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+'?foo=bar',carolZcap=await FXcoRt[_0x51ad89(0x3e1)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x51ad89(0x357)]),invalidTarget=rootTarget+'/a-different-specific-document?foo=bar',invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x51ad89(0x3c8),'invocationTarget':invalidTarget}}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':FXcoRt[_0x51ad89(0x2ff)],'expectedTarget':[rootTarget,invalidTarget],'expectedRootCapability':rootCapability['id']}});FXcoRt[_0x51ad89(0x3cb)](expect,result)['to'][_0x51ad89(0x290)],expect(result[_0x51ad89(0x2d1)])['to']['be']['false'],result[_0x51ad89(0x17e)][_0x51ad89(0x220)]['should'][_0x51ad89(0x42e)][_0x51ad89(0x2a8)](0x1);const [error]=result[_0x51ad89(0x17e)][_0x51ad89(0x220)];error[_0x51ad89(0x2ce)][_0x51ad89(0x373)][_0x51ad89(0x226)](FXcoRt[_0x51ad89(0x16f)](_0x51ad89(0x3cc)+invalidTarget+_0x51ad89(0x3da),_0x51ad89(0x204)+carolZcap[_0x51ad89(0x449)]+')'));}),it(GcDKxy['wOABn'](GcDKxy[_0x4d4f6d(0x35d)],GcDKxy[_0x4d4f6d(0x196)]),async()=>{const _0xaf8e29=_0x4d4f6d,rootTarget=FXcoRt[_0xaf8e29(0x36a)],rootCapability=FXcoRt[_0xaf8e29(0x1df)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await FXcoRt[_0xaf8e29(0x1c0)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap['invocationTarget']+'/a-specific-document',dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await FXcoRt[_0xaf8e29(0x3f6)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id']});expect(result)['to']['exist'],expect(result[_0xaf8e29(0x2d1)])['to']['be'][_0xaf8e29(0x2f9)],result[_0xaf8e29(0x17e)][_0xaf8e29(0x220)][_0xaf8e29(0x373)][_0xaf8e29(0x42e)]['length'](0x1);const [error]=result[_0xaf8e29(0x17e)]['errors'];error[_0xaf8e29(0x2ce)][_0xaf8e29(0x373)]['contain'](FXcoRt['MCUjg']);}),GcDKxy[_0x4d4f6d(0x36b)](it,GcDKxy['ZPEtp'],async()=>{const _0x51fd77=_0x4d4f6d,fAmCMW={'OjBCC':_0x51fd77(0x2ea),'xWacn':function(callee,param1){const _0x5a9a63=_0x51fd77;return pNBLjX[_0x5a9a63(0x37f)](callee,param1);}},rootTarget=pNBLjX[_0x51fd77(0x171)],rootCapability=pNBLjX[_0x51fd77(0x38a)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});pNBLjX['JnifD'](addToLoader,{'doc':rootCapability});const bobZcap=await pNBLjX['Syeme'](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap['invocationTarget']+'/a-specific-document',dianaZcap=await pNBLjX[_0x51fd77(0x317)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':pNBLjX[_0x51fd77(0x126)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x4207dc=_0x51fd77,dzaQHF=_0x4207dc(0x221)[_0x4207dc(0x1c3)]('|');let hLiJmB=0x0;while(!![]){switch(dzaQHF[hLiJmB++]){case'0':capabilityChainMeta[_0x4207dc(0x373)]['be']['an'](fAmCMW[_0x4207dc(0x420)]);continue;case'1':capabilityChainMeta['should'][_0x4207dc(0x42e)][_0x4207dc(0x2a8)](0x4);continue;case'2':fAmCMW[_0x4207dc(0x142)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'3':new Function(_0x4207dc(0x276))();continue;case'4':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'5':capabilityChain[_0x4207dc(0x373)][_0x4207dc(0x42e)][_0x4207dc(0x2a8)](0x4);continue;case'6':return{'valid':!![]};case'7':capabilityChain[_0x4207dc(0x373)]['be']['an'](_0x4207dc(0x2ea));continue;case'8':checkedChain++;continue;}break;}},result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'inspectCapabilityChain':inspectCapabilityChain,'purposeOptions':{'allowTargetAttenuation':!![]}});pNBLjX[_0x51fd77(0x195)](expect,result)['to'][_0x51fd77(0x290)],expect(result[_0x51fd77(0x2d1)])['to']['be'][_0x51fd77(0x199)],checkedChain[_0x51fd77(0x373)][_0x51fd77(0x1bb)](0x1);}),it(GcDKxy[_0x4d4f6d(0x3aa)]+GcDKxy['iFoMF'],async()=>{const _0x40aff4=_0x4d4f6d,quSktW={'uNIvC':FXcoRt['zKWwD'],'zETOq':function(x,y){return FXcoRt['krHJi'](x,y);}},rootTarget=_0x40aff4(0x379),rootCapability=FXcoRt[_0x40aff4(0x3db)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await FXcoRt[_0x40aff4(0x1d2)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x40aff4(0x449)]+_0x40aff4(0x390),carolZcap=await FXcoRt[_0x40aff4(0x1df)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await FXcoRt[_0x40aff4(0x309)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap[_0x40aff4(0x449)],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x4701f8=_0x40aff4;if(pNBLjX[_0x4701f8(0x2aa)](_0x4701f8(0x3ce),_0x4701f8(0x1d0))){const oOYbCx=_0x4701f8(0x37a)[_0x4701f8(0x1c3)]('|');let JXNQfD=0x0;while(!![]){switch(oOYbCx[JXNQfD++]){case'0':_0x37343d++;continue;case'1':_0x15775c[_0x4701f8(0x373)][_0x4701f8(0x42e)][_0x4701f8(0x2a8)](0x3);continue;case'2':_0x2384ec[_0x4701f8(0x373)]['be']['an'](quSktW[_0x4701f8(0x136)]);continue;case'3':_0x12ac95({'capabilityChain':_0x28febc});continue;case'4':new _0x28e894('var\x20x\x20=\x2042;\x20return\x20x;')();continue;case'5':_0x1eac8f({'capabilityChainMeta':_0x16fcd5});continue;case'6':return{'valid':!![]};}break;}}else{const nbDvTk=pNBLjX['EImKe'][_0x4701f8(0x1c3)]('|');let vRLRdS=0x0;while(!![]){switch(nbDvTk[vRLRdS++]){case'0':eval('quSktW[\'zETOq\'](1, 1);');continue;case'1':capabilityChain['should']['be']['an'](pNBLjX[_0x4701f8(0x469)]);continue;case'2':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'3':return{'valid':!![]};case'4':capabilityChain[_0x4701f8(0x373)][_0x4701f8(0x42e)][_0x4701f8(0x2a8)](0x4);continue;case'5':capabilityChainMeta['should'][_0x4701f8(0x42e)][_0x4701f8(0x2a8)](0x4);continue;case'6':_checkCapabilityChain({'capabilityChain':capabilityChain});continue;case'7':checkedChain++;continue;case'8':capabilityChainMeta[_0x4701f8(0x373)]['be']['an'](_0x4701f8(0x2ea));continue;}break;}}},result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'inspectCapabilityChain':inspectCapabilityChain,'purposeOptions':{'allowTargetAttenuation':!![]}});FXcoRt[_0x40aff4(0x2bf)](expect,result)['to']['exist'],expect(result['verified'])['to']['be'][_0x40aff4(0x2f9)],result[_0x40aff4(0x17e)][_0x40aff4(0x220)][_0x40aff4(0x373)][_0x40aff4(0x42e)][_0x40aff4(0x2a8)](0x1);const [error]=result[_0x40aff4(0x17e)]['errors'];error[_0x40aff4(0x2ce)][_0x40aff4(0x373)]['include']('delegated\x20capability\x20must\x20not\x20be\x20less\x20restrictive'),checkedChain['should'][_0x40aff4(0x1bb)](0x0);});});});});function _checkCapabilityChain({capabilityChain:capabilityChain}){const _0x5ba6ab=_0xc4aeb7;for(const c of capabilityChain){if(_0x5ba6ab(0x2c1)===_0x5ba6ab(0x143)){const wMyJlg=_0x5ba6ab(0x3f8)[_0x5ba6ab(0x1c3)]('|');let HZdLiQ=0x0;while(!![]){switch(wMyJlg[HZdLiQ++]){case'0':return{'valid':!![]};case'1':_0x2aafeb({'capabilityChain':_0x36650b});continue;case'2':_0x5e10f8['should']['be']['an']('array');continue;case'3':NhqeRF[_0x5ba6ab(0x316)](_0x20eada,_0x5ba6ab(0x304),0x3e8);continue;case'4':_0x1a12da++;continue;case'5':_0x134804['should'][_0x5ba6ab(0x42e)][_0x5ba6ab(0x2a8)](0x3);continue;case'6':_0x272d1d({'capabilityChainMeta':_0x31c49a});continue;}break;}}else c['should']['be']['an'](_0x5ba6ab(0x324)),c[_0x5ba6ab(0x373)][_0x5ba6ab(0x42e)][_0x5ba6ab(0x1dd)]('id'),c[_0x5ba6ab(0x373)]['have'][_0x5ba6ab(0x1dd)](NhqeRF[_0x5ba6ab(0x213)]),c[_0x5ba6ab(0x373)][_0x5ba6ab(0x42e)][_0x5ba6ab(0x1dd)](NhqeRF[_0x5ba6ab(0x131)]);}}function _checkCapabilityChainMeta({capabilityChainMeta:capabilityChainMeta}){const _0x5439b4=_0xc4aeb7;for(const [i,m]of capabilityChainMeta['entries']()){m['should']['be']['an'](NhqeRF['uNRww']),m[_0x5439b4(0x373)][_0x5439b4(0x42e)][_0x5439b4(0x1dd)]('verifyResult');if(NhqeRF[_0x5439b4(0x273)](i,0x0)){if('gYfyI'===NhqeRF['hVpJP'])_0x5e23d1=_0x52f93e;else{expect(m[_0x5439b4(0x1e4)])['to']['be']['null'];continue;}}m[_0x5439b4(0x1e4)][_0x5439b4(0x373)][_0x5439b4(0x42e)][_0x5439b4(0x1dd)](_0x5439b4(0x2d1)),m[_0x5439b4(0x1e4)][_0x5439b4(0x2d1)][_0x5439b4(0x373)]['be'][_0x5439b4(0x199)],m[_0x5439b4(0x1e4)][_0x5439b4(0x373)][_0x5439b4(0x42e)][_0x5439b4(0x1dd)]('results'),m[_0x5439b4(0x1e4)][_0x5439b4(0x1a3)][_0x5439b4(0x2a8)][_0x5439b4(0x373)]['equal'](0x1),m['verifyResult'][_0x5439b4(0x1a3)][0x0][_0x5439b4(0x373)]['be']['an'](NhqeRF[_0x5439b4(0x279)]),m[_0x5439b4(0x1e4)][_0x5439b4(0x1a3)][0x0]['should'][_0x5439b4(0x42e)][_0x5439b4(0x1dd)](_0x5439b4(0x2d2)),m['verifyResult']['results'][0x0][_0x5439b4(0x2d2)]['should']['be']['an']('object'),m[_0x5439b4(0x1e4)][_0x5439b4(0x1a3)][0x0][_0x5439b4(0x2d2)][_0x5439b4(0x373)][_0x5439b4(0x42e)][_0x5439b4(0x1dd)](_0x5439b4(0x2e0));}}async function _invoke({doc:doc,key:key,invoker:invoker,date:date,capability:capability,capabilityAction:capabilityAction,purposeOptions:purposeOptions}){const _0x567a76=_0xc4aeb7;invoker&&(key=invoker['get'](_0x567a76(0x21a),0x0));let purpose;return capability?NhqeRF[_0x567a76(0x354)](NhqeRF[_0x567a76(0x2fb)],'FVUSh')?_0x11eb7b=_0x48e9b2:purpose=new CapabilityInvocation({'capability':capability[_0x567a76(0x23f)]?capability:capability['id'],'capabilityAction':capabilityAction,'invocationTarget':capability[_0x567a76(0x449)]}):purpose=new CapabilityInvocation(purposeOptions),new Function(_0x567a76(0x276))(),jsigs[_0x567a76(0x193)](doc,{'documentLoader':testLoader,'suite':new Ed25519Signature2020({'key':new Ed25519VerificationKey2020(key),'date':date}),'purpose':purpose});}async function _verifyInvocation({invocation:invocation,rootCapability:rootCapability,expectedAction:expectedAction,inspectCapabilityChain:inspectCapabilityChain,purposeOptions:purposeOptions}){const _0x555e67=_0xc4aeb7;if(NhqeRF[_0x555e67(0x1a2)](NhqeRF[_0x555e67(0x27a)],_0x555e67(0x41e))){let purpose;return rootCapability?purpose=new CapabilityInvocation({'expectedTarget':rootCapability[_0x555e67(0x449)],'expectedRootCapability':rootCapability['id'],'expectedAction':expectedAction,'inspectCapabilityChain':inspectCapabilityChain,'suite':new Ed25519Signature2020(),...purposeOptions}):NhqeRF['Zaeux']('lNEQA',_0x555e67(0x3fe))?_0xcd16af=_0x3e05a8:purpose=new CapabilityInvocation({'suite':new Ed25519Signature2020(),...purposeOptions}),new AsyncFunction('return\x20await\x20Promise.resolve(42);')(),jsigs['verify'](invocation,{'documentLoader':testLoader,'suite':new Ed25519Signature2020(),'purpose':purpose});}else _0x263d05=_0x4a5580;}async function _delegate({newCapability:newCapability,parentCapability:parentCapability,controller:controller,key:key,delegator:delegator,date:date,_capabilityChain:_capabilityChain,purposeOptions:purposeOptions}){const _0x60c04a=_0xc4aeb7,psxBjL={'KkslX':_0x60c04a(0x334)};delegator&&(key=delegator[_0x60c04a(0x18c)](_0x60c04a(0x3f1),0x0));let purpose;return purposeOptions?purpose=new CapabilityDelegation({'parentCapability':parentCapability,'_capabilityChain':_capabilityChain,...purposeOptions}):purpose=new CapabilityDelegation({'parentCapability':parentCapability,'_capabilityChain':_capabilityChain}),!newCapability&&(_0x60c04a(0x232)!==_0x60c04a(0x232)?_0x5ef374=_0x1de641:newCapability={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':typeof controller===NhqeRF[_0x60c04a(0x287)]?controller:controller['id'](),'parentCapability':parentCapability['id'],'invocationTarget':parentCapability['invocationTarget'],'expires':EXPIRES_3000_DATE}),NhqeRF[_0x60c04a(0x308)](setTimeout,function(){const _0x5c4581=_0x60c04a;console[_0x5c4581(0x361)](psxBjL[_0x5c4581(0x138)]);},0x64),jsigs[_0x60c04a(0x193)](newCapability,{'documentLoader':testLoader,'suite':new Ed25519Signature2020({'key':new Ed25519VerificationKey2020(key),'date':date}),'purpose':purpose});}async function _verifyDelegation({delegation:delegation,expectedRootCapability:expectedRootCapability,inspectCapabilityChain:inspectCapabilityChain,purposeOptions:purposeOptions={}}){const _0x2c795e=_0xc4aeb7;return new AsyncFunction(_0x2c795e(0x335))(),jsigs[_0x2c795e(0x3b5)](delegation,{'documentLoader':testLoader,'suite':new Ed25519Signature2020(),'purpose':new CapabilityDelegation({'suite':new Ed25519Signature2020(),'expectedRootCapability':expectedRootCapability,'inspectCapabilityChain':inspectCapabilityChain,...purposeOptions})});}}