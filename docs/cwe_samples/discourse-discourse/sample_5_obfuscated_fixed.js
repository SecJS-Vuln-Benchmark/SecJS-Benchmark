const _0x387424=_0x14fb;function _0x195d(){const _0x56e977=['forcePrompt','assign','apiKey','callbacks','body','api-key','261740CQdRNL','~/server/utils','~/utils','KbrzI','stringify','ixdug','\x20API\x20Key\x20not\x20provided.','~/server/services/Endpoints/openAI/llm','titleConvo','groupMap','zsbke','titleMethod','group','librechat-data-provider','headers','summarize','app','reverseProxyUrl','azureOpenAIApiKey','locals','includes','VDipr','azureOpenAIApiVersion','21mZomXv','329jdTgTj','56622SVJQlJ','addParams','llmConfig','9124IsPXAh','endpoint','14431122IKjdxL','dropParams','520977sHTqjb','2306784oeDpRN','sYOtp','titleModel','parse','openAI','ngcVO','YXygH','NO_USER_KEY','model_parameters','~/app','VGKWf','qELEP','hCFCq','2411260Psgzsk','azure','exports','streamRate','mPrJe','cTaQg','azureOpenAI'];_0x195d=function(){return _0x56e977;};return _0x195d();}(function(_0xbf1d25,_0x5e91c4){const _0x61cecb=_0x14fb,_0x17740d=_0xbf1d25();while(!![]){try{const _0xec6f46=-parseInt(_0x61cecb(0x144))/0x1+-parseInt(_0x61cecb(0x15f))/0x2+-parseInt(_0x61cecb(0x13b))/0x3*(parseInt(_0x61cecb(0x140))/0x4)+-parseInt(_0x61cecb(0x152))/0x5+parseInt(_0x61cecb(0x13d))/0x6*(-parseInt(_0x61cecb(0x13c))/0x7)+parseInt(_0x61cecb(0x145))/0x8+parseInt(_0x61cecb(0x142))/0x9;if(_0xec6f46===_0x5e91c4)break;else _0x17740d['push'](_0x17740d['shift']());}catch(_0x7b9d78){_0x17740d['push'](_0x17740d['shift']());}}}(_0x195d,0x48cd9));const {ErrorTypes,EModelEndpoint,resolveHeaders,mapModelToAzureConfig}=require(_0x387424(0x16c)),{getUserKeyValues,checkUserKeyExpiry}=require('~/server/services/UserService'),{getLLMConfig}=require(_0x387424(0x166)),{isEnabled,isUserProvided,sleep}=require(_0x387424(0x160)),{getAzureCredentials}=require(_0x387424(0x161)),{OpenAIClient}=require(_0x387424(0x14e)),initializeClient=async({req:_0x2ca7b4,res:_0x19d471,endpointOption:_0xb79db8,optionsOnly:_0x2bc880,overrideEndpoint:_0x1a2a5e,overrideModel:_0x56a744})=>{const _0x282874=_0x387424,_0x53f55e={'EFWgr':'AIWZe','hCFCq':function(_0x549f98,_0x10d6a2){return _0x549f98(_0x10d6a2);},'KbrzI':function(_0x279b68,_0x220b43){return _0x279b68(_0x220b43);},'cTaQg':function(_0x262188,_0x6f1ed3){return _0x262188||_0x6f1ed3;},'ixdug':function(_0xabe9ce,_0xd162aa){return _0xabe9ce??_0xd162aa;},'VDipr':function(_0x51d6d5,_0x45697d){return _0x51d6d5&&_0x45697d;},'VGKWf':'completion','mPrJe':_0x282874(0x169),'ngcVO':function(_0x3a560c,_0x5d4fd3){return _0x3a560c===_0x5d4fd3;},'sYOtp':function(_0x473c06,_0x4c8f23){return _0x473c06&_0x4c8f23;},'UfryW':function(_0x7bae15,_0x29a148,_0x54809a){return _0x7bae15(_0x29a148,_0x54809a);}},{PROXY:_0x3a9a31,OPENAI_API_KEY:_0x112224,AZURE_API_KEY:_0x51af15,OPENAI_REVERSE_PROXY:_0x43f796,AZURE_OPENAI_BASEURL:_0x32819f,OPENAI_SUMMARIZE:_0x43f36c,DEBUG_OPENAI:_0x2ca709}=process['env'],{key:_0x421a83}=_0x2ca7b4[_0x282874(0x15d)],_0x501590=_0x56a744??_0x2ca7b4['body']['model'],_0x416ca5=_0x1a2a5e??_0x2ca7b4[_0x282874(0x15d)][_0x282874(0x141)],_0x24cb55=isEnabled(_0x43f36c)?_0x282874(0x16e):null,_0x50f73e={[EModelEndpoint[_0x282874(0x149)]]:_0x112224,[EModelEndpoint[_0x282874(0x158)]]:_0x51af15},_0x2e10b1={[EModelEndpoint[_0x282874(0x149)]]:_0x43f796,[EModelEndpoint[_0x282874(0x158)]]:_0x32819f},_0x3e0c08=isUserProvided(_0x50f73e[_0x416ca5]),_0x3d44d4=_0x53f55e[_0x282874(0x162)](isUserProvided,_0x2e10b1[_0x416ca5]);let _0x5aaed3=null;_0x421a83&&_0x53f55e[_0x282874(0x157)](_0x3e0c08,_0x3d44d4)&&(checkUserKeyExpiry(_0x421a83,_0x416ca5),_0x5aaed3=await _0x53f55e[_0x282874(0x151)](getUserKeyValues,{'userId':_0x2ca7b4['user']['id'],'name':_0x416ca5}));let _0x283165=_0x3e0c08?_0x5aaed3?.['apiKey']:_0x50f73e[_0x416ca5],_0x3836aa=_0x3d44d4?_0x5aaed3?.['baseURL']:_0x2e10b1[_0x416ca5];const _0x2d6f3c={'contextStrategy':_0x24cb55,'proxy':_0x53f55e[_0x282874(0x164)](_0x3a9a31,null),'debug':isEnabled(_0x2ca709),'reverseProxyUrl':_0x3836aa?_0x3836aa:null,..._0xb79db8},_0x41d198=_0x416ca5===EModelEndpoint[_0x282874(0x158)],_0x207775=_0x41d198&&_0x2ca7b4[_0x282874(0x16f)][_0x282874(0x137)][EModelEndpoint['azureOpenAI']];if(_0x53f55e[_0x282874(0x139)](_0x41d198,_0x207775)){const {modelGroupMap:_0x22ca01,groupMap:_0x4c19c3}=_0x207775,{azureOptions:_0xba6679,baseURL:_0x2616d1,headers:headers={},serverless:_0x41d2cb}=mapModelToAzureConfig({'modelName':_0x501590,'modelGroupMap':_0x22ca01,'groupMap':_0x4c19c3});_0x2d6f3c['reverseProxyUrl']=_0x2616d1??_0x2d6f3c[_0x282874(0x170)],_0x2d6f3c[_0x282874(0x16d)]=_0x53f55e[_0x282874(0x151)](resolveHeaders,{...headers,..._0x2d6f3c['headers']??{}}),_0x2d6f3c[_0x282874(0x167)]=_0x207775[_0x282874(0x167)],_0x2d6f3c[_0x282874(0x147)]=_0x207775[_0x282874(0x147)];const _0x14cf08=_0x501590[_0x282874(0x138)]('gpt-4')?0x1e:0x11;_0x2d6f3c['streamRate']=_0x207775[_0x282874(0x155)]??_0x14cf08,_0x2d6f3c['titleMethod']=_0x207775[_0x282874(0x16a)]??_0x53f55e[_0x282874(0x14f)];const _0x18cc1a=_0x22ca01[_0x501590][_0x282874(0x16b)];_0x2d6f3c['addParams']=_0x207775[_0x282874(0x168)][_0x18cc1a][_0x282874(0x13e)],_0x2d6f3c[_0x282874(0x143)]=_0x207775[_0x282874(0x168)][_0x18cc1a][_0x282874(0x143)],_0x2d6f3c[_0x282874(0x159)]=_0x207775[_0x282874(0x168)][_0x18cc1a][_0x282874(0x159)],_0x283165=_0xba6679[_0x282874(0x136)],_0x2d6f3c['azure']=!_0x41d2cb&&_0xba6679,_0x41d2cb===!![]&&(_0x2d6f3c['defaultQuery']=_0xba6679[_0x282874(0x13a)]?{'api-version':_0xba6679['azureOpenAIApiVersion']}:undefined,_0x2d6f3c[_0x282874(0x16d)][_0x282874(0x15e)]=_0x283165);}else _0x41d198&&(_0x53f55e[_0x282874(0x156)]===_0x282874(0x169)?(_0x2d6f3c[_0x282874(0x153)]=_0x3e0c08?JSON[_0x282874(0x148)](_0x5aaed3[_0x282874(0x15b)]):getAzureCredentials(),_0x283165=_0x2d6f3c[_0x282874(0x153)][_0x282874(0x136)]):(_0x179cf4[_0x282874(0x153)]=_0x5ba108?_0x398f91['parse'](_0x49d698[_0x282874(0x15b)]):_0x51713d(),_0x318479=_0x3a0cfa[_0x282874(0x153)][_0x282874(0x136)]));const _0x559c8b=_0x2ca7b4[_0x282874(0x16f)][_0x282874(0x137)][EModelEndpoint[_0x282874(0x149)]];_0x53f55e['VDipr'](!_0x41d198,_0x559c8b)&&(_0x53f55e[_0x282874(0x14a)](_0x282874(0x150),_0x282874(0x14b))?_0xb01fc0[_0x282874(0x155)]=_0x3dbb92[_0x282874(0x155)]:_0x2d6f3c[_0x282874(0x155)]=_0x559c8b[_0x282874(0x155)]);const _0x2aaeb2=_0x2ca7b4['app'][_0x282874(0x137)]['all'];_0x2aaeb2&&(_0x2d6f3c['streamRate']=_0x2aaeb2[_0x282874(0x155)]);if(_0x53f55e[_0x282874(0x146)](_0x3e0c08,!_0x283165))throw new Error(JSON[_0x282874(0x163)]({'type':ErrorTypes[_0x282874(0x14c)]}));if(!_0x283165)throw new Error(_0x416ca5+_0x282874(0x165));if(_0x2bc880){const _0x54f374=Object[_0x282874(0x15a)]({'modelOptions':_0xb79db8[_0x282874(0x14d)]},_0x2d6f3c),_0x3de9ab=_0x53f55e['UfryW'](getLLMConfig,_0x283165,_0x54f374);if(!_0x2d6f3c[_0x282874(0x155)])return _0x3de9ab;return _0x3de9ab[_0x282874(0x13f)][_0x282874(0x15c)]=[{'handleLLMNewToken':async()=>{const _0x50f0ec=_0x282874;if(_0x53f55e['EFWgr']==='AIWZe')await _0x53f55e[_0x50f0ec(0x151)](sleep,_0x2d6f3c[_0x50f0ec(0x155)]);else throw new _0x2d13e7(_0x2709ac+_0x50f0ec(0x165));}}],_0x3de9ab;}const _0x151431=new OpenAIClient(_0x283165,Object[_0x282874(0x15a)]({'req':_0x2ca7b4,'res':_0x19d471},_0x2d6f3c));return{'client':_0x151431,'openAIApiKey':_0x283165};};function _0x14fb(_0x3bc96a,_0x552c37){const _0x195d60=_0x195d();return _0x14fb=function(_0x14fb84,_0xa12fa8){_0x14fb84=_0x14fb84-0x136;let _0x3893d8=_0x195d60[_0x14fb84];return _0x3893d8;},_0x14fb(_0x3bc96a,_0x552c37);}module[_0x387424(0x154)]=initializeClient;