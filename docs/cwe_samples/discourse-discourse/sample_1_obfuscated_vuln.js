function _0x1bfc(_0x603842,_0xe994fa){const _0xbb73c5=_0xbb73();return _0x1bfc=function(_0x1bfcd5,_0x2e4f59){_0x1bfcd5=_0x1bfcd5-0x7d;let _0x367c34=_0xbb73c5[_0x1bfcd5];return _0x367c34;},_0x1bfc(_0x603842,_0xe994fa);}const _0x3357bb=_0x1bfc;(function(_0x1e0e97,_0x52a2ec){const _0x210212=_0x1bfc,_0x531392=_0x1e0e97();while(!![]){try{const _0x12948b=parseInt(_0x210212(0x9e))/0x1*(parseInt(_0x210212(0x80))/0x2)+-parseInt(_0x210212(0xd3))/0x3+parseInt(_0x210212(0x9c))/0x4*(-parseInt(_0x210212(0x8c))/0x5)+parseInt(_0x210212(0xa0))/0x6*(parseInt(_0x210212(0xca))/0x7)+parseInt(_0x210212(0xaf))/0x8+-parseInt(_0x210212(0xc4))/0x9+-parseInt(_0x210212(0xc0))/0xa;if(_0x12948b===_0x52a2ec)break;else _0x531392['push'](_0x531392['shift']());}catch(_0x190142){_0x531392['push'](_0x531392['shift']());}}}(_0xbb73,0x32a2d));const {FileContext}=require(_0x3357bb(0xaa)),validateAuthor=require(_0x3357bb(0xb3)),{getStrategyFunctions}=require(_0x3357bb(0xbc)),{deleteAssistantActions}=require(_0x3357bb(0xac)),{updateAssistantDoc,getAssistants}=require(_0x3357bb(0xa8)),{uploadImageBuffer}=require(_0x3357bb(0xd7)),{getOpenAIClient,fetchAssistants}=require(_0x3357bb(0x8a)),{deleteFileByFilter}=require(_0x3357bb(0xb5)),{logger}=require('~/config'),createAssistant=async(_0x45b1ca,_0x12d61b)=>{const _0x366ad4=_0x3357bb,_0x4ddb88={'zKfkr':function(_0x118749,_0x2cd7d7){return _0x118749!==_0x2cd7d7;},'Pzibw':function(_0x3cd835,_0x185f17,_0x6dcfcf){return _0x3cd835(_0x185f17,_0x6dcfcf);},'cmKfT':_0x366ad4(0x82)};try{const {openai:_0x54cdc5}=await getOpenAIClient({'req':_0x45b1ca,'res':_0x12d61b}),{tools:tools=[],endpoint:_0x5a7dd3,conversation_starters:_0x31c12b,..._0x5c45cf}=_0x45b1ca[_0x366ad4(0xa6)];delete _0x5c45cf['conversation_starters'],_0x5c45cf[_0x366ad4(0xb1)]=tools['map'](_0x130a35=>{const _0x5aacb3=_0x366ad4;if(_0x4ddb88[_0x5aacb3(0xb2)](typeof _0x130a35,_0x5aacb3(0x81)))return _0x130a35;return _0x45b1ca[_0x5aacb3(0x7e)][_0x5aacb3(0xcb)][_0x5aacb3(0xd2)][_0x130a35];})['filter'](_0x52bcfb=>_0x52bcfb);let _0x4a0ef5=null;_0x54cdc5[_0x366ad4(0xcb)]?.[_0x366ad4(0xcc)]&&(_0x4a0ef5=_0x5c45cf['model'],_0x5c45cf[_0x366ad4(0xba)]=_0x54cdc5['locals'][_0x366ad4(0xcc)][_0x366ad4(0xd6)]);_0x5c45cf[_0x366ad4(0xc8)]={'author':_0x45b1ca[_0x366ad4(0x93)]['id'],'endpoint':_0x5a7dd3};const _0x21f176=await _0x54cdc5[_0x366ad4(0x8d)][_0x366ad4(0x91)][_0x366ad4(0x92)](_0x5c45cf),_0x60b595={'user':_0x45b1ca[_0x366ad4(0x93)]['id']};_0x31c12b&&(_0x60b595['conversation_starters']=_0x31c12b);const _0x8cd71=await _0x4ddb88[_0x366ad4(0xa2)](updateAssistantDoc,{'assistant_id':_0x21f176['id']},_0x60b595);_0x4a0ef5&&(_0x21f176[_0x366ad4(0xba)]=_0x4a0ef5),_0x8cd71[_0x366ad4(0xcf)]&&(_0x4ddb88['zKfkr']('spKlZ',_0x4ddb88[_0x366ad4(0xa9)])?(_0x223971=_0x17e814['model'],_0x3ddbaf[_0x366ad4(0xba)]=_0x39abc9[_0x366ad4(0xcb)][_0x366ad4(0xcc)][_0x366ad4(0xd6)]):_0x21f176[_0x366ad4(0xcf)]=_0x8cd71[_0x366ad4(0xcf)]),logger['debug'](_0x366ad4(0x87),_0x21f176),_0x12d61b[_0x366ad4(0x9b)](0xc9)[_0x366ad4(0xa4)](_0x21f176);}catch(_0x2e0027){logger['error'](_0x366ad4(0xb7),_0x2e0027),_0x12d61b[_0x366ad4(0x9b)](0x1f4)[_0x366ad4(0xa4)]({'error':_0x2e0027['message']});}},retrieveAssistant=async(_0x48f4a3,_0x56edc2)=>{const _0xff045d=_0x3357bb;try{const {openai:_0x1257b7}=await getOpenAIClient({'req':_0x48f4a3,'res':_0x56edc2}),_0x222072=_0x48f4a3[_0xff045d(0x8e)]['id'],_0x4843c4=await _0x1257b7['beta']['assistants']['retrieve'](_0x222072);_0x56edc2[_0xff045d(0xa4)](_0x4843c4);}catch(_0x3868f9){logger['error'](_0xff045d(0xb8),_0x3868f9),_0x56edc2[_0xff045d(0x9b)](0x1f4)[_0xff045d(0xa4)]({'error':_0x3868f9[_0xff045d(0x98)]});}},patchAssistant=async(_0x29448b,_0xd16710)=>{const _0xa2568e=_0x3357bb,_0x39d1f8={'zyTKR':_0xa2568e(0xbd),'uqRbj':function(_0x2f57e2,_0xf70200){return _0x2f57e2(_0xf70200);},'lKXUe':function(_0x265267,_0x1a6212,_0x281ae1){return _0x265267(_0x1a6212,_0x281ae1);}};try{if(_0x39d1f8[_0xa2568e(0xd1)]!==_0x39d1f8[_0xa2568e(0xd1)])return _0x255b9d;else{const {openai:_0x330302}=await _0x39d1f8['uqRbj'](getOpenAIClient,{'req':_0x29448b,'res':_0xd16710});await _0x39d1f8[_0xa2568e(0xd9)](validateAuthor,{'req':_0x29448b,'openai':_0x330302});const _0x14f415=_0x29448b[_0xa2568e(0x8e)]['id'],{endpoint:_0x501121,conversation_starters:_0x2f23c5,..._0x36dc2f}=_0x29448b[_0xa2568e(0xa6)];_0x36dc2f[_0xa2568e(0xb1)]=(_0x36dc2f[_0xa2568e(0xb1)]??[])[_0xa2568e(0x8f)](_0x52ccf5=>{const _0x571445=_0xa2568e;if(typeof _0x52ccf5!==_0x571445(0x81))return _0x52ccf5;return _0x29448b['app']['locals'][_0x571445(0xd2)][_0x52ccf5];})[_0xa2568e(0xbe)](_0x2f8738=>_0x2f8738);_0x330302[_0xa2568e(0xcb)]?.[_0xa2568e(0xcc)]&&_0x36dc2f[_0xa2568e(0xba)]&&(_0x36dc2f[_0xa2568e(0xba)]=_0x330302[_0xa2568e(0xcb)]['azureOptions'][_0xa2568e(0xd6)]);const _0x2cb730=await _0x330302[_0xa2568e(0x8d)]['assistants'][_0xa2568e(0xd5)](_0x14f415,_0x36dc2f);if(_0x2f23c5!==undefined){const _0xbd237c=await _0x39d1f8[_0xa2568e(0xc3)](updateAssistantDoc,{'assistant_id':_0x14f415},{'conversation_starters':_0x2f23c5});_0x2cb730[_0xa2568e(0xcf)]=_0xbd237c[_0xa2568e(0xcf)];}_0xd16710[_0xa2568e(0xa4)](_0x2cb730);}}catch(_0x2a927e){logger['error'](_0xa2568e(0xcd),_0x2a927e),_0xd16710['status'](0x1f4)[_0xa2568e(0xa4)]({'error':_0x2a927e['message']});}},deleteAssistant=async(_0xa60507,_0x472bdb)=>{const _0x502b04=_0x3357bb,_0x153bd0={'ypxrQ':function(_0x1e195d,_0x5a8ae1){return _0x1e195d(_0x5a8ae1);},'RyrTl':function(_0xe51436,_0x2e11d1){return _0xe51436(_0x2e11d1);},'npDAN':_0x502b04(0x84),'WWAkV':_0x502b04(0xb9)};try{const {openai:_0x2e9f9b}=await _0x153bd0[_0x502b04(0xa5)](getOpenAIClient,{'req':_0xa60507,'res':_0x472bdb});await validateAuthor({'req':_0xa60507,'openai':_0x2e9f9b});const _0x5096bd=_0xa60507[_0x502b04(0x8e)]['id'],_0x597a93=await _0x2e9f9b[_0x502b04(0x8d)][_0x502b04(0x91)]['del'](_0x5096bd);_0x597a93?.[_0x502b04(0x96)]&&await _0x153bd0[_0x502b04(0x85)](deleteAssistantActions,{'req':_0xa60507,'assistant_id':_0x5096bd}),_0x472bdb[_0x502b04(0xa4)](_0x597a93);}catch(_0xb55c4f){logger[_0x502b04(0x88)](_0x153bd0[_0x502b04(0x94)],_0xb55c4f),_0x472bdb[_0x502b04(0x9b)](0x1f4)['json']({'error':_0x153bd0['WWAkV']});}},listAssistants=async(_0x20feb6,_0xe1db48)=>{const _0x23ff7a=_0x3357bb,_0x3bf182={'JzJgS':function(_0x2000fc,_0x4e238a){return _0x2000fc(_0x4e238a);},'ISheT':function(_0x5f372f,_0x2fa285){return _0x5f372f!==_0x2fa285;},'txvyN':_0x23ff7a(0x99)};try{const _0x595397=await _0x3bf182[_0x23ff7a(0xc7)](fetchAssistants,{'req':_0x20feb6,'res':_0xe1db48});_0xe1db48['json'](_0x595397);}catch(_0x39b61e){_0x3bf182['ISheT'](_0x3bf182[_0x23ff7a(0x95)],'kItBc')?(logger['error'](_0x23ff7a(0x7f),_0x39b61e),_0xe1db48[_0x23ff7a(0x9b)](0x1f4)[_0x23ff7a(0xa4)]({'message':_0x23ff7a(0xc5)})):_0x454880[_0x23ff7a(0xba)]=_0xe2ec41['locals'][_0x23ff7a(0xcc)][_0x23ff7a(0xd6)];}};function filterAssistantDocs({documents:_0x25750c,userId:_0x598b85,assistantsConfig:assistantsConfig={}}){const _0x6f2079=_0x3357bb,{supportedIds:_0x3b856a,excludedIds:_0x32efd7,privateAssistants:_0x3282b3}=assistantsConfig,_0x4a9ec5=_0x5b49a6=>{const {user:_0x3f7e79,..._0x484173}=_0x5b49a6;return _0x484173;};if(_0x3282b3)return _0x25750c[_0x6f2079(0xbe)](_0x3525c6=>_0x598b85===_0x3525c6[_0x6f2079(0x93)][_0x6f2079(0xc1)]())[_0x6f2079(0x8f)](_0x4a9ec5);else{if(_0x3b856a?.['length'])return _0x25750c[_0x6f2079(0xbe)](_0x3c23ad=>_0x3b856a[_0x6f2079(0xb6)](_0x3c23ad['assistant_id']))[_0x6f2079(0x8f)](_0x4a9ec5);else{if(_0x32efd7?.['length'])return _0x25750c[_0x6f2079(0xbe)](_0xe4c49c=>!_0x32efd7['includes'](_0xe4c49c[_0x6f2079(0xce)]))[_0x6f2079(0x8f)](_0x4a9ec5);}}return _0x25750c[_0x6f2079(0x8f)](_0x4a9ec5);}function _0xbb73(){const _0x4e2395=['beta','params','map','Assistant\x20ID\x20is\x20required','assistants','create','user','npDAN','txvyN','deleted','aYxyg','message','Wibea','TMeFX','status','1381712TkzpFH','QSlsk','94873UJgYwK','NKSbU','1089372naBiRD','KMTSM','Pzibw','[/avatar/:assistant_id]\x20Error\x20fetching\x20assistant','json','ypxrQ','body','cBIeT','~/models/Assistant','cmKfT','librechat-data-provider','fhxxx','~/server/services/ActionService','XbdGg','MURCp','2965008qKfyls','ffryR','tools','zKfkr','~/server/middleware/assistants/validateAuthor','filepath','~/models/File','includes','[/assistants]\x20Error\x20creating\x20assistant','[/assistants/:id]\x20Error\x20retrieving\x20assistant','Error\x20deleting\x20assistant','model','all','~/server/services/Files/strategies','cghRe','filter','avatar_source','913420sgkYmz','toString','[/avatar/:assistant_id]\x20Error\x20deleting\x20old\x20avatar','lKXUe','805068IlPJEX','Error\x20listing\x20assistants','file','JzJgS','metadata','exports','14aKJHud','locals','azureOptions','[/assistants/:id]\x20Error\x20updating\x20assistant','assistant_id','conversation_starters','YmbHy','zyTKR','availableTools','284988qIDtID','yvQdC','update','azureOpenAIApiDeploymentName','~/server/services/Files/process','An\x20error\x20occurred\x20while\x20updating\x20the\x20Assistant\x20Avatar','uqRbj','retrieve','app','[/assistants]\x20Error\x20listing\x20assistants','2IFWHeI','string','spKlZ','push','[/assistants/:id]\x20Error\x20deleting\x20assistant','RyrTl','avatar','/assistants/','error','fileStrategy','./helpers','MNdMI','5epPWqJ'];_0xbb73=function(){return _0x4e2395;};return _0xbb73();}const getAssistantDocuments=async(_0x3fc702,_0x36025e)=>{const _0x2b2d5e=_0x3357bb,_0x2155a9={'ffryR':function(_0x200aef,_0x288014){return _0x200aef(_0x288014);},'MNdMI':'[/assistants/documents]\x20Error\x20listing\x20assistant\x20documents'};try{const _0x131180=_0x3fc702['query'],_0x45d2fe=_0x3fc702[_0x2b2d5e(0x7e)][_0x2b2d5e(0xcb)][_0x131180],_0x5ab2f1=await getAssistants({},{'user':0x1,'assistant_id':0x1,'conversation_starters':0x1,'createdAt':0x1,'updatedAt':0x1}),_0x402346=_0x2155a9[_0x2b2d5e(0xb0)](filterAssistantDocs,{'documents':_0x5ab2f1,'userId':_0x3fc702[_0x2b2d5e(0x93)]['id'],'assistantsConfig':_0x45d2fe});_0x36025e['json'](_0x402346);}catch(_0x25cee7){logger['error'](_0x2155a9[_0x2b2d5e(0x8b)],_0x25cee7),_0x36025e[_0x2b2d5e(0x9b)](0x1f4)[_0x2b2d5e(0xa4)]({'error':_0x25cee7[_0x2b2d5e(0x98)]});}},uploadAssistantAvatar=async(_0x2ad76d,_0x35e619)=>{const _0x5e02d5=_0x3357bb,_0x237847={'yvQdC':_0x5e02d5(0x90),'MURCp':function(_0x45fa9e,_0x529faa){return _0x45fa9e(_0x529faa);},'cCaOm':function(_0xf19d7,_0x124c6b){return _0xf19d7===_0x124c6b;},'fhxxx':_0x5e02d5(0x9d),'aYxyg':'[/avatar/:assistant_id]\x20Error\x20fetching\x20assistant','TMeFX':function(_0x32c9b3,_0x363691){return _0x32c9b3===_0x363691;},'EkbsY':function(_0x1a6196,_0x17d948,_0x29daa6){return _0x1a6196(_0x17d948,_0x29daa6);},'KMTSM':function(_0xd26a79,_0x530fcf){return _0xd26a79(_0x530fcf);},'HaJNA':'cBIeT','itVvL':_0x5e02d5(0xc2)};try{const {assistant_id:_0x5e32dd}=_0x2ad76d[_0x5e02d5(0x8e)];if(!_0x5e32dd){if(_0x5e02d5(0xad)==='XbdGg')return _0x35e619[_0x5e02d5(0x9b)](0x190)[_0x5e02d5(0xa4)]({'message':_0x237847[_0x5e02d5(0xd4)]});else _0x4b1c20[_0x5e02d5(0x88)](_0x5e02d5(0xa3),_0x146457),_0x39bc8e={};}const {openai:_0x2e107d}=await getOpenAIClient({'req':_0x2ad76d,'res':_0x35e619});await _0x237847[_0x5e02d5(0xae)](validateAuthor,{'req':_0x2ad76d,'openai':_0x2e107d});const _0x5d4460=await uploadImageBuffer({'req':_0x2ad76d,'context':FileContext[_0x5e02d5(0x86)],'metadata':{'buffer':_0x2ad76d[_0x5e02d5(0xc6)]['buffer']}});let _0x2996e4;try{const _0x58e826=await _0x2e107d[_0x5e02d5(0x8d)][_0x5e02d5(0x91)][_0x5e02d5(0x7d)](_0x5e32dd);_0x58e826&&(_0x237847['cCaOm'](_0x5e02d5(0x9d),_0x237847[_0x5e02d5(0xab)])?_0x2996e4=_0x58e826[_0x5e02d5(0xc8)]:(_0x27727b['error']('[/assistants/:id]\x20Error\x20updating\x20assistant',_0x219c9d),_0x4bed5e['status'](0x1f4)['json']({'error':_0x2309c2[_0x5e02d5(0x98)]})));}catch(_0x10d2ce){logger[_0x5e02d5(0x88)](_0x237847[_0x5e02d5(0x97)],_0x10d2ce),_0x2996e4={};}if(_0x2996e4[_0x5e02d5(0x86)]&&_0x2996e4[_0x5e02d5(0xbf)]){const {deleteFile:_0x305e94}=getStrategyFunctions(_0x2996e4[_0x5e02d5(0xbf)]);try{if(_0x237847[_0x5e02d5(0x9a)](_0x5e02d5(0xd0),_0x5e02d5(0x9f)))return _0x4edf84['filter'](_0x4d6300=>_0x3ff19e===_0x4d6300[_0x5e02d5(0x93)][_0x5e02d5(0xc1)]())['map'](_0x22ff5a);else await _0x237847['EkbsY'](_0x305e94,_0x2ad76d,{'filepath':_0x2996e4[_0x5e02d5(0x86)]}),await _0x237847[_0x5e02d5(0xa1)](deleteFileByFilter,{'user':_0x2ad76d[_0x5e02d5(0x93)]['id'],'filepath':_0x2996e4[_0x5e02d5(0x86)]});}catch(_0x4e980b){if(_0x237847['HaJNA']!==_0x5e02d5(0xa7))return _0x22bc84['status'](0x190)[_0x5e02d5(0xa4)]({'message':_0x5e02d5(0x90)});else logger['error'](_0x237847['itVvL'],_0x4e980b);}}const _0x8d3deb={..._0x2996e4,'avatar':_0x5d4460['filepath'],'avatar_source':_0x2ad76d[_0x5e02d5(0x7e)][_0x5e02d5(0xcb)][_0x5e02d5(0x89)]},_0x4f4c2e=[];_0x4f4c2e[_0x5e02d5(0x83)](updateAssistantDoc({'assistant_id':_0x5e32dd},{'avatar':{'filepath':_0x5d4460[_0x5e02d5(0xb4)],'source':_0x2ad76d[_0x5e02d5(0x7e)]['locals'][_0x5e02d5(0x89)]},'user':_0x2ad76d[_0x5e02d5(0x93)]['id']})),_0x4f4c2e[_0x5e02d5(0x83)](_0x2e107d[_0x5e02d5(0x8d)][_0x5e02d5(0x91)][_0x5e02d5(0xd5)](_0x5e32dd,{'metadata':_0x8d3deb}));const _0x56a1b9=await Promise[_0x5e02d5(0xbb)](_0x4f4c2e);_0x35e619[_0x5e02d5(0x9b)](0xc9)['json'](_0x56a1b9[0x1]);}catch(_0x34d232){const _0xbfb3e9=_0x5e02d5(0xd8);logger[_0x5e02d5(0x88)](_0xbfb3e9,_0x34d232),_0x35e619[_0x5e02d5(0x9b)](0x1f4)[_0x5e02d5(0xa4)]({'message':_0xbfb3e9});}};module[_0x3357bb(0xc9)]={'createAssistant':createAssistant,'retrieveAssistant':retrieveAssistant,'patchAssistant':patchAssistant,'deleteAssistant':deleteAssistant,'listAssistants':listAssistants,'getAssistantDocuments':getAssistantDocuments,'uploadAssistantAvatar':uploadAssistantAvatar};