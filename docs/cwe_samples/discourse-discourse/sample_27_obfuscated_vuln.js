function _0x11ac(){const _0x457f36=['signal','image_urls','aborted','files','iuMRh','2547490XPRdzP','file_id','EhyOk','9AlcXMM','attachments','AtLXl','3248502KkUzbD','13nQvRRw','ccqCA','[AgentController]\x20Request\x20aborted\x20on\x20close','gJhkW','KeMPt','bZrbr','[AgentController]\x20Request\x20closed','OoZjt','VjsVQ','push','WeSOh','savedMessageIds','sender','messageId','KGtUv','userMessage','141802SzOwdG','4241072drYyvJ','promptTokens','GPnSr','DRyZC','requestCompleted','body','775722xfOfYI','WruhY','NO_PARENT','getContentParts','endpoint','api/server/controllers/agents/request.js\x20-\x20response\x20end','ARnxe','7LjhqNW','ynieV','quVbJ','4hbnPvU','options','responseMessageId','iHfqV','has','map','abort','title','bpvfS','user','exports','3083440KIavZR','sendMessage','VCwkV','~/config','1039224rHCLGH','~/server/middleware','myYeu','debug'];_0x11ac=function(){return _0x457f36;};return _0x11ac();}const _0x45597c=_0x44b2;(function(_0x89323b,_0x45a6fc){const _0x28b25e=_0x44b2,_0x19b175=_0x89323b();while(!![]){try{const _0x321aa9=-parseInt(_0x28b25e(0x1cb))/0x1*(-parseInt(_0x28b25e(0x1db))/0x2)+parseInt(_0x28b25e(0x1e2))/0x3+parseInt(_0x28b25e(0x1ec))/0x4*(-parseInt(_0x28b25e(0x1b7))/0x5)+parseInt(_0x28b25e(0x1ca))/0x6*(parseInt(_0x28b25e(0x1e9))/0x7)+-parseInt(_0x28b25e(0x1bb))/0x8*(-parseInt(_0x28b25e(0x1c7))/0x9)+-parseInt(_0x28b25e(0x1c4))/0xa+-parseInt(_0x28b25e(0x1dc))/0xb;if(_0x321aa9===_0x45a6fc)break;else _0x19b175['push'](_0x19b175['shift']());}catch(_0x31b398){_0x19b175['push'](_0x19b175['shift']());}}}(_0x11ac,0x912ba));function _0x44b2(_0x45fc8f,_0x210442){const _0x11acec=_0x11ac();return _0x44b2=function(_0x44b2f5,_0xad7503){_0x44b2f5=_0x44b2f5-0x1b6;let _0x1cc804=_0x11acec[_0x44b2f5];return _0x1cc804;},_0x44b2(_0x45fc8f,_0x210442);}const {Constants}=require('librechat-data-provider'),{createAbortController,handleAbortError}=require(_0x45597c(0x1bc)),{sendMessage}=require('~/server/utils'),{saveMessage}=require('~/models'),{logger}=require(_0x45597c(0x1ba)),AgentController=async(_0x1a055e,_0x31a377,_0x532137,_0x510545,_0x26d8d0)=>{const _0x490870=_0x45597c,_0x5714b5={'dGIMd':_0x490870(0x1da),'jdhlv':function(_0x2b4f39,_0x175878){return _0x2b4f39===_0x175878;},'jnwMU':'userMessagePromise','ARnxe':function(_0x221f81,_0x582420){return _0x221f81===_0x582420;},'quVbJ':_0x490870(0x1dd),'EhyOk':function(_0x3123f1,_0x37a0ac){return _0x3123f1!==_0x37a0ac;},'VjsVQ':_0x490870(0x1ef),'KeMPt':function(_0x57b8f8,_0x4c56ec){return _0x57b8f8===_0x4c56ec;},'OoZjt':_0x490870(0x1d7),'rUneA':_0x490870(0x1d0),'WruhY':'conversationId','gJhkW':_0x490870(0x1d1),'ccqCA':'[AgentController]\x20Request\x20aborted\x20on\x20close','ynieV':_0x490870(0x1bd),'GPnSr':function(_0x5ba419,_0x12c5fe,_0x295000,_0xf91043,_0x258111){return _0x5ba419(_0x12c5fe,_0x295000,_0xf91043,_0x258111);},'DNRoz':'close','dlVsZ':function(_0x2b8329,_0x52b55e,_0x1e56d7){return _0x2b8329(_0x52b55e,_0x1e56d7);},'VCwkV':_0x490870(0x1f4),'KGtUv':function(_0x494285,_0x5c65ea,_0x452960,_0x154b06){return _0x494285(_0x5c65ea,_0x452960,_0x154b06);},'QHAXS':'api/server/controllers/agents/request.js\x20-\x20don\x27t\x20skip\x20saving\x20user\x20message','PWWfI':function(_0x4c2333,_0x2193a6){return _0x4c2333===_0x2193a6;},'WeSOh':function(_0x5ecbc2,_0x19f1b9){return _0x5ecbc2??_0x19f1b9;}};let {text:_0x5d2750,endpointOption:_0x81a78e,conversationId:_0x1ce982,parentMessageId:parentMessageId=null,overrideParentMessageId:overrideParentMessageId=null}=_0x1a055e['body'],_0x5e4aa1,_0x24b3ee,_0x50d4d1,_0x1ec4e1,_0x783727,_0x5eae4a;const _0x52a6bf=!_0x1ce982,_0x15747a=_0x1a055e[_0x490870(0x1f5)]['id'],_0x1e62bc=(_0x31e1d2={})=>{const _0x4e07b5=_0x490870;for(let _0x71e360 in _0x31e1d2){if(_0x71e360===_0x5714b5['dGIMd'])_0x24b3ee=_0x31e1d2[_0x71e360],_0x1ec4e1=_0x31e1d2[_0x71e360][_0x4e07b5(0x1d8)];else{if(_0x5714b5['jdhlv'](_0x71e360,_0x5714b5['jnwMU']))_0x5eae4a=_0x31e1d2[_0x71e360];else{if(_0x5714b5[_0x4e07b5(0x1e8)](_0x71e360,_0x4e07b5(0x1ee)))_0x783727=_0x31e1d2[_0x71e360];else{if(_0x71e360===_0x5714b5[_0x4e07b5(0x1eb)])_0x5714b5[_0x4e07b5(0x1c6)](_0x4e07b5(0x1df),_0x5714b5[_0x4e07b5(0x1d3)])?_0x50d4d1=_0x31e1d2[_0x71e360]:_0x3a28cf=_0x3cf86d[_0x144d56];else{if(_0x5714b5[_0x4e07b5(0x1cf)](_0x71e360,_0x5714b5[_0x4e07b5(0x1d2)]))_0x5714b5[_0x4e07b5(0x1c6)](_0x4e07b5(0x1d0),_0x5714b5['rUneA'])?_0xda64e6=_0x2c8dc9[_0x1f1557]:_0x5e4aa1=_0x31e1d2[_0x71e360];else!_0x1ce982&&_0x5714b5['ARnxe'](_0x71e360,_0x5714b5[_0x4e07b5(0x1e3)])&&(_0x1ce982=_0x31e1d2[_0x71e360]);}}}}}};try{const {client:_0x4314fc}=await _0x510545({'req':_0x1a055e,'res':_0x31a377,'endpointOption':_0x81a78e}),_0x387161=()=>({'sender':_0x5e4aa1,'userMessage':_0x24b3ee,'promptTokens':_0x50d4d1,'conversationId':_0x1ce982,'userMessagePromise':_0x5eae4a,'messageId':_0x783727,'content':_0x4314fc[_0x490870(0x1e5)](),'parentMessageId':overrideParentMessageId??_0x1ec4e1}),{abortController:_0x91ea28,onStart:_0x2d05e2}=_0x5714b5[_0x490870(0x1de)](createAbortController,_0x1a055e,_0x31a377,_0x387161,_0x1e62bc);_0x31a377['on'](_0x5714b5['DNRoz'],()=>{const _0x3be16e=_0x490870;if(_0x5714b5[_0x3be16e(0x1c6)](_0x5714b5[_0x3be16e(0x1ea)],_0x3be16e(0x1bd))){_0x176b8e[_0x3be16e(0x1be)](_0x5714b5[_0x3be16e(0x1ce)]);if(!_0x3c6d19)return;else{if(_0x4f53e7[_0x3be16e(0x1bf)][_0x3be16e(0x1c1)])return;else{if(_0x26d83c[_0x3be16e(0x1e0)])return;}}_0x13889a[_0x3be16e(0x1f2)](),_0x5b9994[_0x3be16e(0x1be)](_0x5714b5[_0x3be16e(0x1cc)]);}else{logger[_0x3be16e(0x1be)](_0x5714b5[_0x3be16e(0x1ce)]);if(!_0x91ea28)return;else{if(_0x91ea28[_0x3be16e(0x1bf)][_0x3be16e(0x1c1)])return;else{if(_0x91ea28[_0x3be16e(0x1e0)])return;}}_0x91ea28[_0x3be16e(0x1f2)](),logger[_0x3be16e(0x1be)](_0x3be16e(0x1cd));}});const _0x30ab3c={'user':_0x15747a,'onStart':_0x2d05e2,'getReqData':_0x1e62bc,'conversationId':_0x1ce982,'parentMessageId':parentMessageId,'abortController':_0x91ea28,'overrideParentMessageId':overrideParentMessageId,'progressOptions':{'res':_0x31a377}};let _0x2ba6a4=await _0x4314fc[_0x490870(0x1b8)](_0x5d2750,_0x30ab3c);_0x2ba6a4[_0x490870(0x1e6)]=_0x81a78e[_0x490870(0x1e6)];const {conversation:conversation={}}=await _0x4314fc['responsePromise'];conversation[_0x490870(0x1f3)]=conversation&&!conversation[_0x490870(0x1f3)]?null:conversation?.[_0x490870(0x1f3)]||'New\x20Chat';if(_0x1a055e[_0x490870(0x1e1)]['files']&&_0x4314fc[_0x490870(0x1ed)]['attachments']){if('bteLX'!==_0x490870(0x1c3)){_0x24b3ee['files']=[];const _0x251239=new Set(_0x1a055e['body'][_0x490870(0x1c2)][_0x490870(0x1f1)](_0x3d454b=>_0x3d454b[_0x490870(0x1c5)]));for(let _0x2eb1fe of _0x4314fc[_0x490870(0x1ed)][_0x490870(0x1c8)]){_0x251239[_0x490870(0x1f0)](_0x2eb1fe[_0x490870(0x1c5)])&&_0x24b3ee[_0x490870(0x1c2)][_0x490870(0x1d4)](_0x2eb1fe);}delete _0x24b3ee[_0x490870(0x1c0)];}else _0x4580f5=_0x26d409[_0x26703e];}!_0x91ea28['signal']['aborted']&&(_0x5714b5['dlVsZ'](sendMessage,_0x31a377,{'final':!![],'conversation':conversation,'title':conversation[_0x490870(0x1f3)],'requestMessage':_0x24b3ee,'responseMessage':_0x2ba6a4}),_0x31a377['end'](),!_0x4314fc[_0x490870(0x1d6)][_0x490870(0x1f0)](_0x2ba6a4[_0x490870(0x1d8)])&&await saveMessage(_0x1a055e,{..._0x2ba6a4,'user':_0x15747a},{'context':_0x490870(0x1e7)})),!_0x4314fc['skipSaveUserMessage']&&(_0x5714b5['EhyOk'](_0x5714b5[_0x490870(0x1b9)],_0x490870(0x1c9))?await _0x5714b5[_0x490870(0x1d9)](saveMessage,_0x1a055e,_0x24b3ee,{'context':_0x5714b5['QHAXS']}):_0x501caf['files']['push'](_0x1d0295)),_0x26d8d0&&_0x5714b5['PWWfI'](parentMessageId,Constants[_0x490870(0x1e4)])&&_0x52a6bf&&_0x26d8d0(_0x1a055e,{'text':_0x5d2750,'response':_0x2ba6a4,'client':_0x4314fc});}catch(_0x142a40){handleAbortError(_0x31a377,_0x1a055e,_0x142a40,{'conversationId':_0x1ce982,'sender':_0x5e4aa1,'messageId':_0x783727,'parentMessageId':_0x5714b5[_0x490870(0x1d5)](_0x1ec4e1,parentMessageId)});}};module[_0x45597c(0x1b6)]=AgentController;