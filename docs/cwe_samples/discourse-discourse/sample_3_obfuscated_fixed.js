const _0x4d5785=_0x3b8a;function _0x35c0(){const _0x5820cb=['784EpIOMh','post','temp_file_id','file','json','librechat-data-provider','app','Hxmzk','split','[/files/images]\x20Temp.\x20image\x20upload\x20file\x20already\x20deleted','133101ysltRl','22130184hQvkXb','~/config','file_id','1540KWvIEF','AjwVZ','dfvpF','exports','~/server/services/Files/process','error','1315386zIUXZE','promises','Error\x20processing\x20file','tool_resource','user','debug','20053BAVBew','7860xggOZL','express','8588SeNPJt','filename','unlink','[/files/images]\x20Error\x20processing\x20file:','paths','nDFQL','155whFNbJ','Router','basename','4989BaXlMM','[/files/images]\x20Error\x20deleting\x20file:','status','hkJBs','path','join','278tLzWtR','21270yoawfg'];_0x35c0=function(){return _0x5820cb;};return _0x35c0();}(function(_0x1a13a8,_0x175866){const _0x23b323=_0x3b8a,_0x2e656c=_0x1a13a8();while(!![]){try{const _0x1f410a=parseInt(_0x23b323(0x160))/0x1*(-parseInt(_0x23b323(0x166))/0x2)+-parseInt(_0x23b323(0x14e))/0x3+-parseInt(_0x23b323(0x157))/0x4*(-parseInt(_0x23b323(0x15d))/0x5)+parseInt(_0x23b323(0x167))/0x6*(parseInt(_0x23b323(0x148))/0x7)+parseInt(_0x23b323(0x168))/0x8*(parseInt(_0x23b323(0x144))/0x9)+-parseInt(_0x23b323(0x155))/0xa*(-parseInt(_0x23b323(0x154))/0xb)+-parseInt(_0x23b323(0x145))/0xc;if(_0x1f410a===_0x175866)break;else _0x2e656c['push'](_0x2e656c['shift']());}catch(_0x27566f){_0x2e656c['push'](_0x2e656c['shift']());}}}(_0x35c0,0xb7b9e));const path=require('path'),fs=require('fs')[_0x4d5785(0x14f)],express=require(_0x4d5785(0x156)),{isAgentsEndpoint}=require(_0x4d5785(0x13f)),{filterFile,processImageFile,processAgentFileUpload}=require(_0x4d5785(0x14c)),{logger}=require(_0x4d5785(0x146)),router=express[_0x4d5785(0x15e)]();function _0x3b8a(_0x3caa21,_0x56b1e2){const _0x35c0fd=_0x35c0();return _0x3b8a=function(_0x3b8a8c,_0x32370e){_0x3b8a8c=_0x3b8a8c-0x13b;let _0x19e19b=_0x35c0fd[_0x3b8a8c];return _0x19e19b;},_0x3b8a(_0x3caa21,_0x56b1e2);}router[_0x4d5785(0x13b)]('/',async(_0x2ac420,_0x3e9738)=>{const _0x37b41b=_0x4d5785,_0x31abf4={'AjwVZ':'4|0|1|3|2','nDFQL':function(_0x2a1961,_0x320ef0){return _0x2a1961(_0x320ef0);},'hkJBs':_0x37b41b(0x161),'dfvpF':_0x37b41b(0x150),'ONLZK':'[/files/images]\x20Temp.\x20image\x20upload\x20file\x20deleted','Hxmzk':_0x37b41b(0x143)},_0xb50a63=_0x2ac420['body'];try{const _0x271250=_0x31abf4[_0x37b41b(0x149)][_0x37b41b(0x142)]('|');let _0x2e75dd=0x0;while(!![]){switch(_0x271250[_0x2e75dd++]){case'0':_0xb50a63[_0x37b41b(0x13c)]=_0xb50a63['file_id'];continue;case'1':_0xb50a63[_0x37b41b(0x147)]=_0x2ac420[_0x37b41b(0x147)];continue;case'2':await _0x31abf4[_0x37b41b(0x15c)](processImageFile,{'req':_0x2ac420,'res':_0x3e9738,'metadata':_0xb50a63});continue;case'3':if(_0x31abf4[_0x37b41b(0x15c)](isAgentsEndpoint,_0xb50a63['endpoint'])&&_0xb50a63[_0x37b41b(0x151)]!=null)return await _0x31abf4[_0x37b41b(0x15c)](processAgentFileUpload,{'req':_0x2ac420,'res':_0x3e9738,'metadata':_0xb50a63});continue;case'4':_0x31abf4['nDFQL'](filterFile,{'req':_0x2ac420,'image':!![]});continue;}break;}}catch(_0x49d08f){logger[_0x37b41b(0x14d)](_0x37b41b(0x15a),_0x49d08f);try{const _0xc85eaa=path[_0x37b41b(0x165)](_0x2ac420[_0x37b41b(0x140)]['locals'][_0x37b41b(0x15b)]['imageOutput'],_0x2ac420[_0x37b41b(0x152)]['id'],path[_0x37b41b(0x15f)](_0x2ac420[_0x37b41b(0x13d)][_0x37b41b(0x158)]));await fs['unlink'](_0xc85eaa);}catch(_0x12503d){logger['error'](_0x31abf4[_0x37b41b(0x163)],_0x12503d);}_0x3e9738[_0x37b41b(0x162)](0x1f4)[_0x37b41b(0x13e)]({'message':_0x31abf4[_0x37b41b(0x14a)]});}finally{try{await fs[_0x37b41b(0x159)](_0x2ac420[_0x37b41b(0x13d)][_0x37b41b(0x164)]),logger[_0x37b41b(0x153)](_0x31abf4['ONLZK']);}catch(_0xb6c3c6){logger[_0x37b41b(0x153)](_0x31abf4[_0x37b41b(0x141)]);}}}),module[_0x4d5785(0x14b)]=router;