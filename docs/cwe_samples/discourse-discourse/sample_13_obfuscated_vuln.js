const _0x39b699=_0x214d;(function(_0x124e1e,_0x4df595){const _0x3ec894=_0x214d,_0x291da3=_0x124e1e();while(!![]){try{const _0x2a7c6a=parseInt(_0x3ec894(0xc9))/0x1+parseInt(_0x3ec894(0xf7))/0x2+parseInt(_0x3ec894(0xe6))/0x3*(parseInt(_0x3ec894(0xf5))/0x4)+parseInt(_0x3ec894(0xe4))/0x5+-parseInt(_0x3ec894(0xfb))/0x6*(parseInt(_0x3ec894(0xe8))/0x7)+parseInt(_0x3ec894(0xf1))/0x8+parseInt(_0x3ec894(0xf4))/0x9*(-parseInt(_0x3ec894(0xc7))/0xa);if(_0x2a7c6a===_0x4df595)break;else _0x291da3['push'](_0x291da3['shift']());}catch(_0x52cdd3){_0x291da3['push'](_0x291da3['shift']());}}}(_0x9dda,0x50e6d));function _0x9dda(){const _0x511dfb=['~/cache/keyvMongo','status','tqbLf','name','error','vYwzI','yUyLi','/api/edit','1172305NbtklG','gdntu','958755npDXIC','user-agent','3937430aJbyBK','RSNiM','exports','ttl','delete','env','./denyRequest','YMKvd','banned','3458288FOJKbi','MfTDd','opts','155889lPRqvz','4TJMrCZ','~/server/utils','998980NsYDwD','ZxVMy','tAORw','toString','6FMCaMU','_id','~/models','ehsqW','jfBrq','get','ScfyO','afJZk','JBSgK','Error\x20in\x20checkBan\x20middleware:','590UyVVWf','Your\x20account\x20has\x20been\x20temporarily\x20banned\x20due\x20to\x20violations\x20of\x20our\x20service.','429980FWobDA','set','now','~/config','gTvur','ban_cache:user:','expiresAt','json','email','USE_REDIS','BAN','user','keyv','kOciS','Svbzr','ReVwL','librechat-data-provider','VqfDC','/api/ask'];_0x9dda=function(){return _0x511dfb;};return _0x9dda();}const Keyv=require(_0x39b699(0xd5)),uap=require('ua-parser-js'),{ViolationTypes}=require(_0x39b699(0xd9)),{isEnabled,removePorts}=require(_0x39b699(0xf6)),keyvMongo=require(_0x39b699(0xdc)),denyRequest=require(_0x39b699(0xee)),{getLogStores}=require('~/cache'),{findUser}=require(_0x39b699(0xfd)),{logger}=require(_0x39b699(0xcc)),banCache=new Keyv({'store':keyvMongo,'namespace':ViolationTypes[_0x39b699(0xd3)],'ttl':0x0}),message=_0x39b699(0xc8),banResponse=async(_0x1567be,_0x4bd805)=>{const _0x353e56=_0x39b699,_0x3b051c={'MfTDd':function(_0x384498,_0x4c0e3d){return _0x384498(_0x4c0e3d);},'JBSgK':'FxVXt','ScfyO':_0x353e56(0xe3),'afJZk':function(_0x394499,_0x201e36,_0x5efe5b,_0x23bcd7){return _0x394499(_0x201e36,_0x5efe5b,_0x23bcd7);}},_0x34974a=_0x3b051c[_0x353e56(0xf2)](uap,_0x1567be['headers'][_0x353e56(0xe7)]),{baseUrl:_0xf0f59b}=_0x1567be;if(!_0x34974a['browser'][_0x353e56(0xdf)]){if(_0x353e56(0xc1)!==_0x3b051c[_0x353e56(0xc5)])return _0x4bd805['status'](0x193)[_0x353e56(0xd0)]({'message':message});else _0x2fc3e1['set'](_0x14edee,_0x432b11,_0x2d00bf);}else{if(_0xf0f59b===_0x353e56(0xdb)||_0xf0f59b===_0x3b051c[_0x353e56(0xc3)])return await _0x3b051c[_0x353e56(0xc4)](denyRequest,_0x1567be,_0x4bd805,{'type':ViolationTypes[_0x353e56(0xd3)]});}return _0x4bd805[_0x353e56(0xdd)](0x193)[_0x353e56(0xd0)]({'message':message});},checkBan=async(_0x4d11cc,_0x4422ad,_0x35a745=()=>{})=>{const _0x3b4c75=_0x39b699,_0x2762bc={'vYwzI':function(_0x583cd0){return _0x583cd0();},'YMKvd':_0x3b4c75(0xc6),'MiVvD':function(_0x42eccb,_0x227aee){return _0x42eccb(_0x227aee);},'Svbzr':function(_0x1dcbeb,_0x9e8c8){return _0x1dcbeb(_0x9e8c8);},'gdntu':function(_0x2bea2a,_0x4db852,_0x41f755){return _0x2bea2a(_0x4db852,_0x41f755);},'RSNiM':_0x3b4c75(0xfc),'gTvur':function(_0x116643,_0x27214a){return _0x116643===_0x27214a;},'ReVwL':_0x3b4c75(0xda),'DzWkT':function(_0x5ef4a3,_0x4229da,_0x5c8363){return _0x5ef4a3(_0x4229da,_0x5c8363);},'yUyLi':function(_0x4bd4e7,_0x203855){return _0x4bd4e7<=_0x203855;},'ehsqW':function(_0x506cfb,_0x5988d1){return _0x506cfb!==_0x5988d1;},'tqbLf':'WVsBt','kOciS':function(_0x8750eb){return _0x8750eb();},'tAORw':function(_0x30180d,_0x486c72){return _0x30180d-_0x486c72;},'mILTr':function(_0x19e6a0){return _0x19e6a0();}};try{const {BAN_VIOLATIONS:_0x44b81d}=process[_0x3b4c75(0xed)]??{};if(!_0x2762bc['MiVvD'](isEnabled,_0x44b81d))return _0x2762bc[_0x3b4c75(0xe1)](_0x35a745);_0x4d11cc['ip']=_0x2762bc[_0x3b4c75(0xd7)](removePorts,_0x4d11cc);let _0xf6e960=_0x4d11cc[_0x3b4c75(0xd4)]?.['id']??_0x4d11cc[_0x3b4c75(0xd4)]?.[_0x3b4c75(0xfc)]??null;if(!_0xf6e960&&_0x4d11cc?.['body']?.[_0x3b4c75(0xd1)]){const _0x6718fe=await _0x2762bc[_0x3b4c75(0xe5)](findUser,{'email':_0x4d11cc['body'][_0x3b4c75(0xd1)]},_0x2762bc[_0x3b4c75(0xe9)]);_0xf6e960=_0x6718fe?.['_id']?_0x6718fe[_0x3b4c75(0xfc)][_0x3b4c75(0xfa)]():_0xf6e960;}if(!_0xf6e960&&!_0x4d11cc['ip'])return _0x35a745();let _0x59dd9b,_0x211d2c,_0x3af05f='',_0xf4612a='';if(_0x4d11cc['ip']){if(_0x2762bc[_0x3b4c75(0xcd)](_0x3b4c75(0xda),_0x2762bc[_0x3b4c75(0xd8)]))_0x3af05f=isEnabled(process[_0x3b4c75(0xed)][_0x3b4c75(0xd2)])?'ban_cache:ip:'+_0x4d11cc['ip']:_0x4d11cc['ip'],_0x59dd9b=await banCache[_0x3b4c75(0xc2)](_0x3af05f);else return _0x2762bc['vYwzI'](_0x15324b);}_0xf6e960&&(_0xf4612a=isEnabled(process['env'][_0x3b4c75(0xd2)])?_0x3b4c75(0xce)+_0xf6e960:_0xf6e960,_0x211d2c=await banCache['get'](_0xf4612a));const _0x3596ae=_0x59dd9b||_0x211d2c;if(_0x3596ae)return _0x4d11cc[_0x3b4c75(0xf0)]=!![],await _0x2762bc['DzWkT'](banResponse,_0x4d11cc,_0x4422ad);const _0x1f9158=_0x2762bc[_0x3b4c75(0xd7)](getLogStores,ViolationTypes[_0x3b4c75(0xd3)]),_0xcc1cc2=_0x1f9158[_0x3b4c75(0xf3)][_0x3b4c75(0xeb)];if(_0x2762bc[_0x3b4c75(0xe2)](_0xcc1cc2,0x0)){if(_0x2762bc[_0x3b4c75(0xfe)](_0x2762bc[_0x3b4c75(0xde)],'WVsBt'))_0x43d395['error'](_0x2762bc[_0x3b4c75(0xef)],_0x240099);else return _0x2762bc[_0x3b4c75(0xd6)](_0x35a745);}let _0x5d82eb,_0x20311f;_0x4d11cc['ip']&&(_0x5d82eb=await _0x1f9158['get'](_0x4d11cc['ip']));_0xf6e960&&(_0x20311f=await _0x1f9158['get'](_0xf6e960));const _0x4025c2=!!(_0x5d82eb||_0x20311f);if(!_0x4025c2)return _0x35a745();const _0x3030ad=_0x2762bc[_0x3b4c75(0xf9)](_0x2762bc['Svbzr'](Number,_0x4025c2[_0x3b4c75(0xcf)]),Date[_0x3b4c75(0xcb)]());_0x3030ad<=0x0&&_0x3af05f&&await _0x1f9158[_0x3b4c75(0xec)](_0x3af05f);if(_0x2762bc[_0x3b4c75(0xe2)](_0x3030ad,0x0)&&_0xf4612a)return await _0x1f9158[_0x3b4c75(0xec)](_0xf4612a),_0x2762bc['mILTr'](_0x35a745);return _0x3af05f&&banCache['set'](_0x3af05f,_0x4025c2,_0x3030ad),_0xf4612a&&banCache[_0x3b4c75(0xca)](_0xf4612a,_0x4025c2,_0x3030ad),_0x4d11cc[_0x3b4c75(0xf0)]=!![],await banResponse(_0x4d11cc,_0x4422ad);}catch(_0x19573d){if(_0x3b4c75(0xf8)==='PklYk')return _0x27b166();else logger[_0x3b4c75(0xe0)]('Error\x20in\x20checkBan\x20middleware:',_0x19573d);}};function _0x214d(_0x41c5b1,_0x538f5b){const _0x9dda1f=_0x9dda();return _0x214d=function(_0x214d0a,_0x2c7fa6){_0x214d0a=_0x214d0a-0xc1;let _0x3d30d3=_0x9dda1f[_0x214d0a];return _0x3d30d3;},_0x214d(_0x41c5b1,_0x538f5b);}module[_0x39b699(0xea)]=checkBan;