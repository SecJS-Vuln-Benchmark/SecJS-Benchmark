function _0x3b5e(){const _0xa83e7d=['yDlbO','GFxeb','values','lLuLB','eRrOO','onStart','summaryTokenCount','XzHEp','slice','getMessagesForConversation','addInstructions','15|3|5|10|4|1|2|14|12|0|13|8|11|7|6|9','name','conversationId','~/config','HpDJt','DrSPh','Yxidn','Iwnfd','shouldSummarize','etpTY','addPreviousAttachments','huBco','ciPsd','KxnUN','Uibeo','cMDqQ','messageId','checkVisionRequest','17726797kGvpeL','generateTextStream','nAFTX','TKmvB','system','[BaseClient]\x20Difference\x20between\x20original\x20payload\x20(','`[BaseClient]\x20recordTokenUsage`\x20not\x20implemented.','fqhnk','map','QDSOM','cMVct','artifactPromises','overrideParentMessageId','):\x20','jAXdz','unshift','reverseProxyUrl','randomUUID','mKiud','PCIPk','OkIat','VGJbC','[BaseClient]\x20instructions\x20tokenCount:\x20','toLocaleDateString','vSNBN','oinND','join','[BaseClient]\x20userMessage','UvqSK','role','previous_summary','BEElr','ROHCr','ipEEg','reverse','hcgHE','FIVE_MINUTES','okwxD','fLLnS','loadHistory','\x22\x20}','progressOptions','skipSaveConvo','node-fetch','currentDateString','beBdn','getTokenCountForResponse','Prompt\x20token\x20count\x20exceeds\x20max\x20token\x20count\x20(','responseMessageId','xDebE','vuBBZ','qtwGv','6964767kWrHGd','WlRFo','bMotA','summaryMessage','completion_tokens','\x22,\x20\x22info\x22:\x20\x22','requestCompleted','promptPrefix','handleTokenCountMap','sendCompletion','constructor','setMessageOptions','reduce','metadata','RZzqL','Method\x20\x27sendCompletion\x27\x20must\x20be\x20implemented.','files','getSaveOptions','{\x20\x22type\x22:\x20\x22','file_id','yYder','kHwLY','IlGPx','user','getTokenCount','prompt','xgcwy','COMMON_DIVIDER','agent','string','tokenCount','Subclasses\x20must\x20implement\x20getBuildMessagesOptions','5OSutIk','\x20/\x20','savedMessageIds','EURHG','attachments','options','processOverideIds','1461444dsPzZn','KbAyM','saveMessageToDatabase','QWLCs','resendFiles','~/server/utils','image_url','onProgress','userMessagePromise','Making\x20request\x20to\x20','[BaseClient]\x20Previous\x20summary:','sykjZ','setOptions','apiKey','600530eoJESC','1TvFPjZ','vHsHk','GZCAQ','kftEI','exports','endpoint','sqNeg','MESSAGES','CQWiB','Paxce','all','librechat-data-provider','createUserMessage','QPfLs','length','yZReE','2540544qWQfEV','buildMessages','~/cache','summarizeMessages','isEdited','HwgsF','xayHw','[BaseClient]\x20tokenCountMap','uFjpg','push','getReqData','debug','filter','RAkev','en-us','Lhlbs','recordTokenUsage','env','getStreamUsage','Vflmy','modelOptions','lewPF','hozze','sender','./TextStream','has','~/models/File','getBuildMessagesOptions','QoBJS','8jjwwND','keAHP','YXPha','[BaseClient]\x20Error\x20mapping\x20attachments\x20for\x20conversation','inputTokensKey','body','prompt_tokens','numeric','dlrWf','endpointType','NO_PARENT','updateMessageInDatabase','bFzLS','abortController','fetch','split','ydyHE','getMessageMapMethod','processTextStream','VQOsW','res','model','rfbiL','mvHuO','TYxRD','warn','XpyAU','User\x20mismatch.','currentMessages','Method\x20\x27setOptions\x27\x20must\x20be\x20implemented.','maxContextTokens','923312cOziIX','concatenateMessages','skipSaveUserMessage','uGODD','toString','type','AzVuY','gLxuL','req','addImageURLs','zOwBk','add','sEgZn','message_file_map','LZpTU','parentMessageId','find','5269990LKkPGx','directEndpoint','shzYn','GQedA','gDuhP','NlWqK','RAqrH','ANQQe','KYjUB','[BaseClient]\x20Adding\x20summary\x20props\x20to\x20','handleStartMethods','boolean','AjzTA','sendPayload','flat','eyLVC','calculateCurrentTokenCount','CHECK_BALANCE','Subclasses\x20must\x20implement\x20buildMessages','outputTokensKey','iconURL','Wfrhq','~/models/checkBalance','error','isArray','eCxKJ','getMessagesWithinTokenLimit','summary','long','Method\x20\x27getCompletion\x27\x20must\x20be\x20implemented.',')\x20and\x20context\x20(','call','User','tbUSf','set','contextStrategy','updateUserMessageTokenCount','crypto','gBBem','[BaseClient]','6HTACTv','content','progressCallback','responsePromise','entries','function','INPUT_LENGTH','JMMXx','TSTBn','QnzXZ','text','WrCJn','replaceOptions'];_0x3b5e=function(){return _0xa83e7d;};return _0x3b5e();}const _0x1da5da=_0x331f;(function(_0x4aed4a,_0x11380e){const _0x3f426a=_0x331f,_0x5a0dd1=_0x4aed4a();while(!![]){try{const _0x2ed1d2=-parseInt(_0x3f426a(0x29a))/0x1*(-parseInt(_0x3f426a(0x2e6))/0x2)+parseInt(_0x3f426a(0x2aa))/0x3+-parseInt(_0x3f426a(0x28b))/0x4*(parseInt(_0x3f426a(0x284))/0x5)+parseInt(_0x3f426a(0x206))/0x6*(-parseInt(_0x3f426a(0x299))/0x7)+-parseInt(_0x3f426a(0x2c7))/0x8*(-parseInt(_0x3f426a(0x264))/0x9)+parseInt(_0x3f426a(0x2f7))/0xa+-parseInt(_0x3f426a(0x230))/0xb;if(_0x2ed1d2===_0x11380e)break;else _0x5a0dd1['push'](_0x5a0dd1['shift']());}catch(_0x33b3eb){_0x5a0dd1['push'](_0x5a0dd1['shift']());}}}(_0x3b5e,0x85780));function _0x331f(_0x5a1b39,_0x4d5af5){const _0x3b5e32=_0x3b5e();return _0x331f=function(_0x331f8e,_0x381306){_0x331f8e=_0x331f8e-0x1e3;let _0x119fc6=_0x3b5e32[_0x331f8e];return _0x119fc6;},_0x331f(_0x5a1b39,_0x4d5af5);}const crypto=require(_0x1da5da(0x203)),fetch=require(_0x1da5da(0x25b)),{supportsBalanceCheck,isAgentsEndpoint,isParamEndpoint,ErrorTypes,Constants,CacheKeys,Time}=require(_0x1da5da(0x2a5)),{getMessages,saveMessage,updateMessage,saveConvo}=require('~/models'),{addSpaceIfNeeded,isEnabled}=require(_0x1da5da(0x290)),checkBalance=require(_0x1da5da(0x1f4)),{getFiles}=require(_0x1da5da(0x2c4)),{getLogStores}=require(_0x1da5da(0x2ac)),TextStream=require(_0x1da5da(0x2c2)),{logger}=require(_0x1da5da(0x221));class BaseClient{constructor(_0x910fc3,_0x2ce2b0={}){const _0x5f0a59=_0x1da5da,_0x55f010={'QnzXZ':_0x5f0a59(0x21e),'yDlbO':_0x5f0a59(0x268)},_0x5951c8=_0x55f010[_0x5f0a59(0x20f)][_0x5f0a59(0x2d6)]('|');let _0x27e2b0=0x0;while(!![]){switch(_0x5951c8[_0x27e2b0++]){case'0':this[_0x5f0a59(0x27b)];continue;case'1':this[_0x5f0a59(0x25a)]=![];continue;case'2':this[_0x5f0a59(0x2e8)]=![];continue;case'3':this[_0x5f0a59(0x2c1)]=_0x2ce2b0[_0x5f0a59(0x2c1)]??'AI';continue;case'4':this[_0x5f0a59(0x2d5)]=this[_0x5f0a59(0x2d5)]['bind'](this);continue;case'5':this[_0x5f0a59(0x201)]=null;continue;case'6':this['outputTokensKey']=_0x55f010[_0x5f0a59(0x213)];continue;case'7':this[_0x5f0a59(0x2cb)]=_0x5f0a59(0x2cd);continue;case'8':this['responseMessageId'];continue;case'9':this[_0x5f0a59(0x286)]=new Set();continue;case'10':this[_0x5f0a59(0x25c)]=new Date()[_0x5f0a59(0x247)](_0x5f0a59(0x2b8),{'year':_0x5f0a59(0x2ce),'month':_0x5f0a59(0x1fa),'day':_0x5f0a59(0x2ce)});continue;case'11':this[_0x5f0a59(0x288)];continue;case'12':this[_0x5f0a59(0x209)];continue;case'13':this[_0x5f0a59(0x220)];continue;case'14':this[_0x5f0a59(0x293)];continue;case'15':this[_0x5f0a59(0x298)]=_0x910fc3;continue;}break;}}[_0x1da5da(0x297)](){const _0x4fbe47=_0x1da5da,_0xe4e290={'WlRFo':_0x4fbe47(0x2e4)};throw new Error(_0xe4e290[_0x4fbe47(0x265)]);}async['getCompletion'](){const _0x5b3eb5=_0x1da5da,_0x504939={'IlGPx':_0x5b3eb5(0x1fb)};throw new Error(_0x504939[_0x5b3eb5(0x27a)]);}async[_0x1da5da(0x26d)](){const _0x474fe2=_0x1da5da;throw new Error(_0x474fe2(0x273));}[_0x1da5da(0x275)](){const _0x4056b2=_0x1da5da,_0x5b01f3={'KbAyM':'Subclasses\x20must\x20implement\x20getSaveOptions'};throw new Error(_0x5b01f3[_0x4056b2(0x28c)]);}async[_0x1da5da(0x2ab)](){const _0x19d7a2=_0x1da5da;throw new Error(_0x19d7a2(0x1f0));}async[_0x1da5da(0x2ad)](){throw new Error('Subclasses\x20attempted\x20to\x20call\x20summarizeMessages\x20without\x20implementing\x20it');}['getResponseModel'](){const _0x4d4a66=_0x1da5da;if(isAgentsEndpoint(this[_0x4d4a66(0x289)][_0x4d4a66(0x29f)])&&this[_0x4d4a66(0x289)][_0x4d4a66(0x280)]&&this[_0x4d4a66(0x289)][_0x4d4a66(0x280)]['id'])return this['options'][_0x4d4a66(0x280)]['id'];return this['modelOptions'][_0x4d4a66(0x2dc)];}[_0x1da5da(0x25e)](_0x1c0ae8){const _0x403a94=_0x1da5da,_0x3c1456={'cMVct':_0x403a94(0x236)};logger[_0x403a94(0x2b5)](_0x3c1456[_0x403a94(0x23a)],_0x1c0ae8);}async[_0x1da5da(0x2ba)]({promptTokens:_0x15bb79,completionTokens:_0xf8ce25}){const _0x1b8212=_0x1da5da,_0x5bb09={'Phrbz':_0x1b8212(0x236)};logger[_0x1b8212(0x2b5)](_0x5bb09['Phrbz'],{'promptTokens':_0x15bb79,'completionTokens':_0xf8ce25});}async[_0x1da5da(0x2d5)](_0xe0533f,_0x311d8d){const _0x409655=_0x1da5da,_0x4b6fec={'djqtu':'undefined','ECqyS':function(_0x56a2af,_0x342f74,_0x23252e){return _0x56a2af(_0x342f74,_0x23252e);}};let _0x12ac9a=_0xe0533f;this['options'][_0x409655(0x2f8)]&&(_0x12ac9a=this[_0x409655(0x289)][_0x409655(0x240)]);logger[_0x409655(0x2b5)](_0x409655(0x294)+_0x12ac9a);if(typeof Bun!==_0x4b6fec['djqtu'])return await _0x4b6fec['ECqyS'](fetch,_0x12ac9a,_0x311d8d);return await fetch(_0x12ac9a,_0x311d8d);}[_0x1da5da(0x2c5)](){const _0x4023e1=_0x1da5da,_0x431042={'xDebE':_0x4023e1(0x283)};throw new Error(_0x431042[_0x4023e1(0x261)]);}async[_0x1da5da(0x231)](_0x3cda88,_0x189c4e,_0x123146={}){const _0x329284=_0x1da5da,_0x17ecd1=new TextStream(_0x3cda88,_0x123146);await _0x17ecd1[_0x329284(0x2d9)](_0x189c4e);}['processOverideIds'](){const _0x2cd6ce=_0x1da5da,_0x3ad38c={'XpyAU':'dlrNv'};let {overrideConvoId:_0x3be04e,overrideUserMessageId:_0x5bb647}=this['options']?.[_0x2cd6ce(0x2ee)]?.[_0x2cd6ce(0x2cc)]??{};if(_0x3be04e){const [_0x3673b6,_0x579e2a]=_0x3be04e[_0x2cd6ce(0x2d6)](Constants[_0x2cd6ce(0x27f)]);_0x3be04e=_0x3673b6,_0x579e2a!=='0'&&(this[_0x2cd6ce(0x25a)]=!![]);}if(_0x5bb647){if(_0x2cd6ce(0x245)!==_0x2cd6ce(0x245))_0x29cd96[_0x2cd6ce(0x292)]=_0x1f787f[_0x2cd6ce(0x208)]['call'](null,{..._0x48b2d7['progressOptions']??{},'parentMessageId':_0x238009['messageId'],'messageId':_0x27ed36});else{const [_0x10574b,_0x58205d]=_0x5bb647[_0x2cd6ce(0x2d6)](Constants[_0x2cd6ce(0x27f)]);_0x5bb647=_0x10574b,_0x58205d!=='0'&&('DOxmx'!==_0x3ad38c[_0x2cd6ce(0x2e1)]?this['skipSaveUserMessage']=!![]:(_0x2f7039=_0x451d62[_0x2cd6ce(0x21b)](_0x3c0d2f),_0x16bb67[_0x2cd6ce(0x2b5)](_0x2cd6ce(0x235)+_0x2239ce+_0x2cd6ce(0x1fc)+_0xcefd62[_0x2cd6ce(0x2a8)]+_0x2cd6ce(0x23d)+_0x237141)));}}return[_0x3be04e,_0x5bb647];}async[_0x1da5da(0x26f)](_0x2ae837={}){const _0x266f50=_0x1da5da,_0x3f846d={'cMDqQ':function(_0x5a5c3,_0x53d8d6){return _0x5a5c3-_0x53d8d6;}};_0x2ae837&&_0x2ae837[_0x266f50(0x212)]&&this[_0x266f50(0x297)](_0x2ae837);const [_0x155f30,_0x21bd3b]=this[_0x266f50(0x28a)](),{isEdited:_0x344c3a,isContinued:_0x3d4895}=_0x2ae837,_0x5b1bc5=_0x2ae837['user']??null;this[_0x266f50(0x27b)]=_0x5b1bc5;const _0x293971=this['getSaveOptions']();this[_0x266f50(0x2d4)]=_0x2ae837['abortController']??new AbortController();const _0x5525b9=_0x155f30??_0x2ae837[_0x266f50(0x220)]??crypto[_0x266f50(0x241)](),_0x4dbf3d=_0x2ae837[_0x266f50(0x2f5)]??Constants[_0x266f50(0x2d1)],_0x833d53=_0x21bd3b??_0x2ae837[_0x266f50(0x23c)]??crypto[_0x266f50(0x241)]();let _0x4058a0=_0x2ae837['responseMessageId']??crypto[_0x266f50(0x241)](),_0x5b6adc=_0x344c3a?_0x4058a0:_0x4dbf3d;return this[_0x266f50(0x2e3)]=await this[_0x266f50(0x257)](_0x5525b9,_0x5b6adc)??[],this['conversationId']=_0x5525b9,_0x344c3a&&!_0x3d4895&&(_0x4058a0=crypto['randomUUID'](),_0x5b6adc=_0x4058a0,this[_0x266f50(0x2e3)][_0x3f846d[_0x266f50(0x22d)](this[_0x266f50(0x2e3)][_0x266f50(0x2a8)],0x1)][_0x266f50(0x22e)]=_0x5b6adc),this[_0x266f50(0x260)]=_0x4058a0,{..._0x2ae837,'user':_0x5b1bc5,'head':_0x5b6adc,'conversationId':_0x5525b9,'parentMessageId':_0x4dbf3d,'userMessageId':_0x833d53,'responseMessageId':_0x4058a0,'saveOptions':_0x293971};}[_0x1da5da(0x2a6)]({messageId:_0x29004f,parentMessageId:_0x541a14,conversationId:_0x529fd8,text:_0x1df0d1}){const _0x33baf8=_0x1da5da;return{'messageId':_0x29004f,'parentMessageId':_0x541a14,'conversationId':_0x529fd8,'sender':_0x33baf8(0x1fe),'text':_0x1df0d1,'isCreatedByUser':!![]};}async['handleStartMethods'](_0x4cc606,_0x161d46){const _0x5e1fa5=_0x1da5da,_0x5a4708={'eCxKJ':function(_0x3910e2,_0x608184){return _0x3910e2-_0x608184;},'RAqrH':function(_0x5f149b,_0x86d3d6){return _0x5f149b===_0x86d3d6;}},{user:_0x184f35,head:_0x338539,conversationId:_0x1d3025,parentMessageId:_0x2e1f9e,userMessageId:_0x4125ed,responseMessageId:_0x26d394,saveOptions:_0x23aa64}=await this[_0x5e1fa5(0x26f)](_0x161d46),_0x4779fe=_0x161d46[_0x5e1fa5(0x2ae)]?this[_0x5e1fa5(0x2e3)][_0x5a4708[_0x5e1fa5(0x1f7)](this[_0x5e1fa5(0x2e3)][_0x5e1fa5(0x2a8)],0x2)]:this[_0x5e1fa5(0x2a6)]({'messageId':_0x4125ed,'parentMessageId':_0x2e1f9e,'conversationId':_0x1d3025,'text':_0x4cc606});return typeof _0x161d46?.[_0x5e1fa5(0x2b4)]==='function'&&_0x161d46['getReqData']({'userMessage':_0x4779fe,'conversationId':_0x1d3025,'responseMessageId':_0x26d394,'sender':this[_0x5e1fa5(0x2c1)]}),_0x5a4708[_0x5e1fa5(0x1e4)](typeof _0x161d46?.[_0x5e1fa5(0x218)],_0x5e1fa5(0x20b))&&_0x161d46[_0x5e1fa5(0x218)](_0x4779fe,_0x26d394),{..._0x161d46,'user':_0x184f35,'head':_0x338539,'conversationId':_0x1d3025,'responseMessageId':_0x26d394,'saveOptions':_0x23aa64,'userMessage':_0x4779fe};}[_0x1da5da(0x21d)](_0x279a3f,_0x18bc75){const _0x56b986=_0x1da5da,_0x334a5d={'ipEEg':function(_0x14314d,_0x178592){return _0x14314d!==_0x178592;},'xgcwy':_0x56b986(0x211),'LZpTU':function(_0x3dd99c,_0x3da5dc){return _0x3dd99c>_0x3da5dc;},'qUgch':function(_0x1ca751,_0x38dd2b){return _0x1ca751-_0x38dd2b;}},_0x2498b1=[];if(!_0x18bc75||Object['keys'](_0x18bc75)['length']===0x0)return _0x334a5d[_0x56b986(0x251)](_0x334a5d[_0x56b986(0x27e)],_0x56b986(0x272))?_0x279a3f:_0x43ea89;return _0x279a3f[_0x56b986(0x2a8)]>0x1&&_0x2498b1[_0x56b986(0x2b3)](..._0x279a3f['slice'](0x0,-0x1)),_0x2498b1['push'](_0x18bc75),_0x334a5d[_0x56b986(0x2f4)](_0x279a3f[_0x56b986(0x2a8)],0x0)&&_0x2498b1[_0x56b986(0x2b3)](_0x279a3f[_0x334a5d['qUgch'](_0x279a3f[_0x56b986(0x2a8)],0x1)]),_0x2498b1;}async[_0x1da5da(0x26c)](_0xf2e799){const _0x571f06=_0x1da5da,_0x35ef32={'shzYn':function(_0x4c04be,_0x4462cf){return _0x4c04be===_0x4462cf;},'zOwBk':function(_0x429e2d,_0x1b253f){return _0x429e2d<_0x1b253f;},'tYFLh':_0x571f06(0x2da),'mJCxz':function(_0x4812a1,_0x295ec7){return _0x4812a1===_0x295ec7;},'SJWxN':_0x571f06(0x239)};if(_0x35ef32[_0x571f06(0x2f9)](this[_0x571f06(0x2e3)][_0x571f06(0x2a8)],0x0))return;for(let _0xf82166=0x0;_0x35ef32[_0x571f06(0x2f0)](_0xf82166,this[_0x571f06(0x2e3)][_0x571f06(0x2a8)]);_0xf82166++){if(_0x571f06(0x2da)!==_0x35ef32['tYFLh'])return _0xb1bb86;else{if(_0x35ef32['mJCxz'](_0xf82166,this[_0x571f06(0x2e3)]['length']-0x1)){if(_0x35ef32['SJWxN']!==_0x571f06(0x24f))break;else _0x76f70['tokenCount']=this[_0x571f06(0x25e)](_0x150c70),_0x1edf7c=this['getTokenCount'](_0x3eb2e8);}const _0x2f74db=this[_0x571f06(0x2e3)][_0xf82166],{messageId:_0x55c608}=_0x2f74db,_0x6b50be={};_0x55c608===_0xf2e799[_0x571f06(0x267)]?.[_0x571f06(0x22e)]&&(logger[_0x571f06(0x2b5)](_0x571f06(0x1e7)+_0x55c608+'.'),_0x6b50be[_0x571f06(0x1f9)]=_0xf2e799[_0x571f06(0x267)]['content'],_0x6b50be[_0x571f06(0x219)]=_0xf2e799[_0x571f06(0x267)][_0x571f06(0x282)]);if(_0x2f74db[_0x571f06(0x282)]&&!_0x6b50be[_0x571f06(0x219)]){logger[_0x571f06(0x2b5)]('[BaseClient]\x20Skipping\x20'+_0x55c608+':\x20already\x20had\x20a\x20token\x20count.');continue;}const _0x21f3b6=_0xf2e799[_0x55c608];_0x21f3b6&&(_0x2f74db[_0x571f06(0x282)]=_0x21f3b6,_0x6b50be[_0x571f06(0x282)]=_0x21f3b6,await this[_0x571f06(0x2d2)]({'messageId':_0x55c608,..._0x6b50be}));}}}[_0x1da5da(0x2e7)](_0x3694f4){const _0x8df38f=_0x1da5da,_0x2471ba={'Yxidn':function(_0x121405,_0xfc7f61){return _0x121405+_0xfc7f61;}};return _0x3694f4[_0x8df38f(0x270)]((_0x2dfd3f,_0x4dd0ad)=>{const _0x314767=_0x8df38f;if('mKiud'!==_0x314767(0x242))_0x5be0bf[_0x314767(0x210)]=_0x8c8627;else{const _0x119bcd=_0x4dd0ad[_0x314767(0x21f)]??_0x4dd0ad['role'];return _0x2471ba[_0x314767(0x224)](_0x2dfd3f,_0x119bcd+':\x0a'+_0x4dd0ad[_0x314767(0x207)]+'\x0a\x0a');}},'');}async[_0x1da5da(0x1f8)](_0x1977eb,_0x25cbc3){const _0xde2db8=_0x1da5da,_0x378b19={'CZDaj':function(_0x18a0fa,_0x1f114b){return _0x18a0fa<=_0x1f114b;}};let _0xa5e2af=0x3,_0x57f8e2=-0x1,_0x4aa415=_0x25cbc3??this[_0xde2db8(0x2e5)];const _0x1ffdc4=[..._0x1977eb],_0xd64b0=[];if(_0xa5e2af<_0x4aa415)while(_0x1ffdc4[_0xde2db8(0x2a8)]>0x0&&_0xa5e2af<_0x4aa415){const _0x1b62b2=_0x1ffdc4['pop'](),{tokenCount:_0x41fde5}=_0x1b62b2;if(_0x1b62b2&&_0x378b19['CZDaj'](_0xa5e2af+_0x41fde5,_0x4aa415))_0xd64b0[_0xde2db8(0x2b3)](_0x1b62b2),_0xa5e2af+=_0x41fde5;else{_0x1ffdc4[_0xde2db8(0x2b3)](_0x1b62b2);break;}}const _0x521ee6=_0x1ffdc4;return _0x57f8e2=_0x521ee6['length']-0x1,_0x4aa415-=_0xa5e2af,{'context':_0xd64b0[_0xde2db8(0x252)](),'remainingContextTokens':_0x4aa415,'messagesToRefine':_0x521ee6,'summaryIndex':_0x57f8e2};}async['handleContextStrategy']({instructions:_0x17fd52,orderedMessages:_0x1a0558,formattedMessages:_0x514c99,buildTokenMap:buildTokenMap=!![]}){const _0x4c8b22=_0x1da5da,_0x288fbf={'dlrWf':function(_0x5a8df0,_0x329f31){return _0x5a8df0===_0x329f31;},'JMMXx':function(_0x44142c,_0x4a2d4f){return _0x44142c+_0x4a2d4f;},'jAXdz':_0x4c8b22(0x246),'pwKmN':'[BaseClient]\x20Context\x20Count\x20(1/2)','EURHG':function(_0x45ccfe,_0x2764b5){return _0x45ccfe-_0x2764b5;},'UvqSK':'[BaseClient]\x20tokenCountMap:'};let _0x4097b6,_0x2498b8;_0x17fd52&&({tokenCount:_0x2498b8,..._0x4097b6}=_0x17fd52);_0x4097b6&&logger[_0x4c8b22(0x2b5)](_0x288fbf[_0x4c8b22(0x20d)](_0x288fbf[_0x4c8b22(0x23e)],_0x2498b8));let _0x1403e6=this[_0x4c8b22(0x21d)](_0x514c99,_0x4097b6),_0x416d5c=this[_0x4c8b22(0x21d)](_0x1a0558,_0x17fd52),{context:_0x5663d3,remainingContextTokens:_0x14edef,messagesToRefine:_0x297e40,summaryIndex:_0x10c895}=await this['getMessagesWithinTokenLimit'](_0x416d5c);logger['debug'](_0x288fbf['pwKmN'],{'remainingContextTokens':_0x14edef,'maxContextTokens':this[_0x4c8b22(0x2e5)]});let _0x5dc9f5,_0x4f318d,{shouldSummarize:_0x42ca5e}=this;const {length:_0x6e1606}=_0x1403e6,_0x5808ed=_0x6e1606-_0x5663d3[_0x4c8b22(0x2a8)],_0x4a3194=_0x416d5c[0x0],_0x3eba11=_0x42ca5e&&_0x5808ed===0x1&&_0x4a3194?.[_0x4c8b22(0x1f9)]&&this[_0x4c8b22(0x24e)]['messageId']===_0x4a3194[_0x4c8b22(0x22e)];_0x5808ed>0x0&&(_0x1403e6=_0x1403e6[_0x4c8b22(0x21b)](_0x5808ed),logger[_0x4c8b22(0x2b5)](_0x4c8b22(0x235)+_0x6e1606+_0x4c8b22(0x1fc)+_0x5663d3[_0x4c8b22(0x2a8)]+_0x4c8b22(0x23d)+_0x5808ed));const _0xba7a23=_0x416d5c[_0x288fbf[_0x4c8b22(0x287)](_0x416d5c[_0x4c8b22(0x2a8)],0x1)];if(_0x288fbf[_0x4c8b22(0x2cf)](_0x1403e6[_0x4c8b22(0x2a8)],0x0)&&!_0x42ca5e&&_0xba7a23){const _0x4d841d=_0xba7a23['tokenCount']+_0x4c8b22(0x285)+this[_0x4c8b22(0x2e5)],_0x4ed12a=_0x4c8b22(0x276)+ErrorTypes[_0x4c8b22(0x20c)]+_0x4c8b22(0x269)+_0x4d841d+'\x22\x20}';logger[_0x4c8b22(0x2e0)](_0x4c8b22(0x25f)+_0x4d841d+').');throw new Error(_0x4ed12a);}if(_0x3eba11)_0x5dc9f5={'role':_0x4c8b22(0x234),'content':_0x4a3194[_0x4c8b22(0x1f9)]},_0x4f318d=_0x4a3194[_0x4c8b22(0x219)],_0x1403e6[_0x4c8b22(0x23f)](_0x5dc9f5),_0x14edef-=_0x4f318d;else _0x42ca5e&&_0x297e40[_0x4c8b22(0x2a8)]>0x0&&({summaryMessage:_0x5dc9f5,summaryTokenCount:_0x4f318d}=await this['summarizeMessages']({'messagesToRefine':_0x297e40,'remainingContextTokens':_0x14edef}),_0x5dc9f5&&_0x1403e6[_0x4c8b22(0x23f)](_0x5dc9f5),_0x14edef-=_0x4f318d);_0x42ca5e=_0x5dc9f5&&_0x42ca5e,logger['debug']('[BaseClient]\x20Context\x20Count\x20(2/2)',{'remainingContextTokens':_0x14edef,'maxContextTokens':this[_0x4c8b22(0x2e5)]});let _0x40387c;buildTokenMap&&(_0x40387c=_0x416d5c['reduce']((_0x54c225,_0x3ddd27,_0x537103)=>{const _0x279d61=_0x4c8b22,{messageId:_0x59189b}=_0x3ddd27;if(!_0x59189b)return _0x54c225;return _0x42ca5e&&_0x288fbf[_0x279d61(0x2cf)](_0x537103,_0x10c895)&&!_0x3eba11&&(_0x54c225['summaryMessage']={..._0x5dc9f5,'messageId':_0x59189b,'tokenCount':_0x4f318d}),_0x54c225[_0x59189b]=_0x416d5c[_0x537103][_0x279d61(0x282)],_0x54c225;},{}));const _0x1ed5cb=this[_0x4c8b22(0x2e5)]-_0x14edef;return logger[_0x4c8b22(0x2b5)](_0x288fbf[_0x4c8b22(0x24c)],_0x40387c),logger[_0x4c8b22(0x2b5)](_0x4c8b22(0x205),{'promptTokens':_0x1ed5cb,'remainingContextTokens':_0x14edef,'payloadSize':_0x1403e6[_0x4c8b22(0x2a8)],'maxContextTokens':this[_0x4c8b22(0x2e5)]}),{'payload':_0x1403e6,'tokenCountMap':_0x40387c,'promptTokens':_0x1ed5cb,'messages':_0x416d5c};}async['sendMessage'](_0x5db15e,_0x4eab39={}){const _0x33d403=_0x1da5da,_0x378f85={'Lhlbs':function(_0x27217c,_0x22806b){return _0x27217c===_0x22806b;},'lLuLB':function(_0x57059b,_0x4bba0d){return _0x57059b-_0x4bba0d;},'GQedA':_0x33d403(0x2a3),'oinND':_0x33d403(0x2b1),'HwgsF':'[BaseClient]\x20userMessage','hcgHE':function(_0x1ee618,_0x5f329b){return _0x1ee618!==_0x5f329b;},'tbUSf':_0x33d403(0x2b2),'rfbiL':function(_0x392566,_0x21e4af){return _0x392566===_0x21e4af;},'KxnUN':_0x33d403(0x262),'kHwLY':_0x33d403(0x2bf),'PCIPk':_0x33d403(0x263),'keAHP':_0x33d403(0x27d),'ydyHE':_0x33d403(0x281),'sqNeg':function(_0x44efc7,_0x4e458e){return _0x44efc7(_0x4e458e);},'Iwnfd':function(_0x2ac51e,_0x20ff46,_0x31e45a){return _0x2ac51e(_0x20ff46,_0x31e45a);},'etpTY':function(_0x17898b,_0x494311){return _0x17898b!=_0x494311;}},{user:_0x235e89,head:_0x40ed16,isEdited:_0x59083f,conversationId:_0x264818,responseMessageId:_0x17deb1,saveOptions:_0x434871,userMessage:_0x26cc53}=await this[_0x33d403(0x1e8)](_0x5db15e,_0x4eab39);_0x4eab39[_0x33d403(0x208)]&&(_0x4eab39[_0x33d403(0x292)]=_0x4eab39['progressCallback'][_0x33d403(0x1fd)](null,{..._0x4eab39[_0x33d403(0x259)]??{},'parentMessageId':_0x26cc53['messageId'],'messageId':_0x17deb1}));const {generation:generation=''}=_0x4eab39;if(_0x59083f){let _0x36b2bd=this['currentMessages'][_0x378f85[_0x33d403(0x216)](this[_0x33d403(0x2e3)]['length'],0x1)];!_0x36b2bd?(_0x36b2bd={'messageId':_0x17deb1,'conversationId':_0x264818,'parentMessageId':_0x26cc53[_0x33d403(0x22e)],'isCreatedByUser':![],'model':this[_0x33d403(0x2be)][_0x33d403(0x2dc)],'sender':this[_0x33d403(0x2c1)],'text':generation},this[_0x33d403(0x2e3)]['push'](_0x26cc53,_0x36b2bd)):_0x378f85[_0x33d403(0x2fa)]==='dTCSV'?this['setOptions'](_0x4d9ed1):_0x36b2bd[_0x33d403(0x210)]=generation;}else this[_0x33d403(0x2e3)][_0x33d403(0x2b3)](_0x26cc53);let {prompt:_0x47a46f,tokenCountMap:_0x25122f,promptTokens:_0x38535c}=await this[_0x33d403(0x2ab)](this['currentMessages'],_0x59083f?_0x40ed16:_0x26cc53[_0x33d403(0x22e)],this[_0x33d403(0x2c5)](_0x4eab39),_0x4eab39);_0x25122f&&(logger[_0x33d403(0x2b5)](_0x378f85[_0x33d403(0x249)],_0x25122f),_0x25122f[_0x26cc53[_0x33d403(0x22e)]]&&(_0x26cc53['tokenCount']=_0x25122f[_0x26cc53[_0x33d403(0x22e)]],logger['debug'](_0x378f85[_0x33d403(0x2af)],_0x26cc53)),this[_0x33d403(0x26c)](_0x25122f));!_0x59083f&&!this[_0x33d403(0x2e8)]&&(_0x378f85[_0x33d403(0x253)](_0x378f85[_0x33d403(0x1ff)],_0x378f85['tbUSf'])?_0xc405fd[_0x33d403(0x2b4)]({'userMessagePromise':this[_0x33d403(0x293)]}):(this[_0x33d403(0x293)]=this[_0x33d403(0x28d)](_0x26cc53,_0x434871,_0x235e89),this['savedMessageIds'][_0x33d403(0x2f1)](_0x26cc53[_0x33d403(0x22e)]),_0x378f85[_0x33d403(0x2dd)](typeof _0x4eab39?.[_0x33d403(0x2b4)],_0x33d403(0x20b))&&(_0x378f85[_0x33d403(0x22b)]===_0x378f85[_0x33d403(0x279)]?_0x36d7fd=this[_0x33d403(0x289)][_0x33d403(0x240)]:_0x4eab39[_0x33d403(0x2b4)]({'userMessagePromise':this[_0x33d403(0x293)]}))));if(isEnabled(process[_0x33d403(0x2bb)][_0x33d403(0x1ef)])&&supportsBalanceCheck[this['options']['endpointType']??this['options']['endpoint']]){if(_0x378f85[_0x33d403(0x243)]===_0x378f85[_0x33d403(0x243)])await checkBalance({'req':this[_0x33d403(0x289)][_0x33d403(0x2ee)],'res':this[_0x33d403(0x289)][_0x33d403(0x2db)],'txData':{'user':this[_0x33d403(0x27b)],'tokenType':_0x378f85[_0x33d403(0x2c8)],'amount':_0x38535c,'model':this['modelOptions'][_0x33d403(0x2dc)],'endpoint':this['options'][_0x33d403(0x29f)],'endpointTokenConfig':this[_0x33d403(0x289)]['endpointTokenConfig']}});else{const {messageId:_0x24df0c}=_0xc9b33c;if(!_0x24df0c)return _0x512729;return _0x2e4e1e&&_0x378f85[_0x33d403(0x2b9)](_0x5065ba,_0x1fb215)&&!_0x2e2f0a&&(_0x5a9b29['summaryMessage']={..._0x28a68f,'messageId':_0x24df0c,'tokenCount':_0x31f33c}),_0x217d6b[_0x24df0c]=_0x2fc4c1[_0x17d6e4][_0x33d403(0x282)],_0x2d7d6a;}}const _0x23efc7=await this[_0x33d403(0x26d)](_0x47a46f,_0x4eab39);this[_0x33d403(0x2d4)][_0x33d403(0x26a)]=!![];const _0x5708da={'messageId':_0x17deb1,'conversationId':_0x264818,'parentMessageId':_0x26cc53['messageId'],'isCreatedByUser':![],'isEdited':_0x59083f,'model':this['getResponseModel'](),'sender':this[_0x33d403(0x2c1)],'promptTokens':_0x38535c,'iconURL':this[_0x33d403(0x289)][_0x33d403(0x1f2)],'endpoint':this[_0x33d403(0x289)]['endpoint'],...this[_0x33d403(0x271)]??{}};if(typeof _0x23efc7===_0x378f85[_0x33d403(0x2d7)])_0x5708da[_0x33d403(0x210)]=_0x378f85[_0x33d403(0x2a0)](addSpaceIfNeeded,generation)+_0x23efc7;else{if(Array['isArray'](_0x23efc7)&&_0x378f85[_0x33d403(0x225)](isParamEndpoint,this[_0x33d403(0x289)][_0x33d403(0x29f)],this[_0x33d403(0x289)][_0x33d403(0x2d0)]))_0x5708da['text']='',_0x5708da['content']=_0x23efc7;else Array[_0x33d403(0x1f6)](_0x23efc7)&&(_0x5708da['text']=_0x378f85[_0x33d403(0x2a0)](addSpaceIfNeeded,generation)+_0x23efc7[_0x33d403(0x24a)](''));}if(_0x25122f&&this[_0x33d403(0x2ba)]&&this[_0x33d403(0x25e)]&&this[_0x33d403(0x27c)]){let _0x333280;const _0x35374f=this[_0x33d403(0x2bc)]!=null?this['getStreamUsage']():null;_0x378f85[_0x33d403(0x227)](_0x35374f,null)&&Number(_0x35374f[this[_0x33d403(0x1f1)]])>0x0?(_0x5708da[_0x33d403(0x282)]=_0x35374f[this[_0x33d403(0x1f1)]],_0x333280=_0x5708da[_0x33d403(0x282)],await this[_0x33d403(0x202)]({'usage':_0x35374f,'tokenCountMap':_0x25122f,'userMessage':_0x26cc53,'opts':_0x4eab39})):(_0x5708da[_0x33d403(0x282)]=this[_0x33d403(0x25e)](_0x5708da),_0x333280=this['getTokenCount'](_0x23efc7)),await this[_0x33d403(0x2ba)]({'promptTokens':_0x38535c,'completionTokens':_0x333280,'usage':_0x35374f});}this['userMessagePromise']&&await this[_0x33d403(0x293)];this[_0x33d403(0x23b)]&&(_0x5708da[_0x33d403(0x288)]=(await Promise[_0x33d403(0x2a4)](this[_0x33d403(0x23b)]))[_0x33d403(0x2b6)](_0x4da492=>_0x4da492));if(this[_0x33d403(0x289)][_0x33d403(0x288)])try{_0x434871['files']=this['options'][_0x33d403(0x288)][_0x33d403(0x238)](_0x5d7042=>_0x5d7042[_0x33d403(0x277)]);}catch(_0x5f2aac){logger[_0x33d403(0x1f5)](_0x33d403(0x2ca),_0x5f2aac);}this['responsePromise']=this[_0x33d403(0x28d)](_0x5708da,_0x434871,_0x235e89),this[_0x33d403(0x286)][_0x33d403(0x2f1)](_0x5708da[_0x33d403(0x22e)]);const _0x2b5f29=getLogStores(CacheKeys[_0x33d403(0x2a1)]);return _0x2b5f29[_0x33d403(0x200)](_0x17deb1,{'text':_0x5708da[_0x33d403(0x210)],'complete':!![]},Time[_0x33d403(0x254)]),delete _0x5708da[_0x33d403(0x282)],_0x5708da;}async[_0x1da5da(0x202)]({usage:_0x9679cb,tokenCountMap:_0x526268,userMessage:_0x1db792,opts:_0x481523}){const _0x42ce57=_0x1da5da,_0x29e0f7={'jPbti':function(_0x3ec020,_0x3e2c08){return _0x3ec020(_0x3e2c08);},'nAZYM':function(_0x4c1cc0,_0x1a697b){return _0x4c1cc0===_0x1a697b;},'eyLVC':'function','PgGsL':function(_0x527036,_0x62f78f){return _0x527036!==_0x62f78f;}},_0x46a0df=this['calculateCurrentTokenCount']!=null&&_0x29e0f7['jPbti'](Number,_0x9679cb[this[_0x42ce57(0x2cb)]])>0x0&&(this[_0x42ce57(0x289)][_0x42ce57(0x28f)]||!this[_0x42ce57(0x289)]['resendFiles']&&!this[_0x42ce57(0x289)][_0x42ce57(0x288)]?.['length'])&&!this['options'][_0x42ce57(0x26b)];if(!_0x46a0df)return;const _0x2285a1=this[_0x42ce57(0x1ee)]({'currentMessageId':_0x1db792[_0x42ce57(0x22e)],'tokenCountMap':_0x526268,'usage':_0x9679cb});if(_0x2285a1===_0x1db792[_0x42ce57(0x282)])return;_0x1db792['tokenCount']=_0x2285a1,_0x29e0f7['nAZYM'](typeof _0x481523?.[_0x42ce57(0x2b4)],_0x29e0f7[_0x42ce57(0x1ed)])&&(_0x29e0f7['PgGsL'](_0x42ce57(0x29b),_0x42ce57(0x2e9))?_0x481523[_0x42ce57(0x2b4)]({'userMessage':_0x1db792}):(_0x4dd993={'messageId':_0x1b7ede,'conversationId':_0x533417,'parentMessageId':_0x23846b[_0x42ce57(0x22e)],'isCreatedByUser':![],'model':this['modelOptions']['model'],'sender':this[_0x42ce57(0x2c1)],'text':_0x4716c8},this[_0x42ce57(0x2e3)][_0x42ce57(0x2b3)](_0x289c79,_0x124f7a))),await this['userMessagePromise'],await this['updateMessageInDatabase']({'messageId':_0x1db792['messageId'],'tokenCount':_0x2285a1});}async[_0x1da5da(0x257)](_0x54a4e3,_0x38bdb5=null){const _0x4ec62c=_0x1da5da,_0x4c6da4={'sEgZn':_0x4ec62c(0x2b8),'WLwyz':_0x4ec62c(0x1fa),'GZCAQ':function(_0x41c578,_0x270df3){return _0x41c578(_0x270df3);},'nBbtv':function(_0x3cdf7e,_0x5691af){return _0x3cdf7e-_0x5691af;},'XzHEp':function(_0x23e598,_0x34b506){return _0x23e598>=_0x34b506;},'fLLnS':function(_0x163e3e,_0x46b4d1){return _0x163e3e===_0x46b4d1;},'Hssng':_0x4ec62c(0x295)};logger[_0x4ec62c(0x2b5)]('[BaseClient]\x20Loading\x20history:',{'conversationId':_0x54a4e3,'parentMessageId':_0x38bdb5});const _0x346523=await _0x4c6da4[_0x4ec62c(0x29c)](getMessages,{'conversationId':_0x54a4e3})??[];if(_0x346523['length']===0x0)return[];let _0x723376=null;this[_0x4ec62c(0x2d8)]&&(_0x723376=this[_0x4ec62c(0x2d8)]());let _0x2b6899=this[_0x4ec62c(0x26e)]['getMessagesForConversation']({'messages':_0x346523,'parentMessageId':_0x38bdb5,'mapMethod':_0x723376});_0x2b6899=await this[_0x4ec62c(0x228)](_0x2b6899);if(!this[_0x4ec62c(0x226)])return _0x2b6899;for(let _0x5083a2=_0x4c6da4['nBbtv'](_0x2b6899['length'],0x1);_0x4c6da4[_0x4ec62c(0x21a)](_0x5083a2,0x0);_0x5083a2--){if(_0x4c6da4[_0x4ec62c(0x256)](_0x4ec62c(0x222),_0x4ec62c(0x222))){if(_0x2b6899[_0x5083a2]?.['summary']){this['previous_summary']=_0x2b6899[_0x5083a2];break;}}else this[_0x4ec62c(0x298)]=_0x5a30ed,this['sender']=_0x2112cc[_0x4ec62c(0x2c1)]??'AI',this[_0x4ec62c(0x201)]=null,this[_0x4ec62c(0x25c)]=new _0x157631()['toLocaleDateString'](_0x4c6da4[_0x4ec62c(0x2f2)],{'year':'numeric','month':_0x4c6da4['WLwyz'],'day':_0x4ec62c(0x2ce)}),this[_0x4ec62c(0x2d5)]=this[_0x4ec62c(0x2d5)]['bind'](this),this[_0x4ec62c(0x25a)]=![],this[_0x4ec62c(0x2e8)]=![],this['userMessagePromise'],this[_0x4ec62c(0x209)],this[_0x4ec62c(0x27b)],this[_0x4ec62c(0x220)],this[_0x4ec62c(0x260)],this[_0x4ec62c(0x288)],this[_0x4ec62c(0x2cb)]=_0x4ec62c(0x2cd),this[_0x4ec62c(0x1f1)]=_0x4ec62c(0x268),this['savedMessageIds']=new _0x34a5b2();}if(this['previous_summary']){const {messageId:_0x2ef7cd,summary:_0x20d57a,tokenCount:_0x15d23d,summaryTokenCount:_0x1a700e}=this[_0x4ec62c(0x24e)];logger[_0x4ec62c(0x2b5)](_0x4c6da4['Hssng'],{'messageId':_0x2ef7cd,'summary':_0x20d57a,'tokenCount':_0x15d23d,'summaryTokenCount':_0x1a700e});}return _0x2b6899;}async[_0x1da5da(0x28d)](_0xd09add,_0x188fcd,_0x5603f4=null){const _0x41fb95=_0x1da5da,_0x2e8998={'TYxRD':'[BaseClient]\x20userMessage','ciPsd':_0x41fb95(0x1ea),'yYder':_0x41fb95(0x2e2),'ANQQe':function(_0x3bf091,_0x4f459e,_0x2d586a,_0x3614e3){return _0x3bf091(_0x4f459e,_0x2d586a,_0x3614e3);},'Uibeo':function(_0x40bd02,_0xc9d27c){return _0x40bd02!==_0xc9d27c;},'gDuhP':_0x41fb95(0x1f3)};if(this[_0x41fb95(0x27b)]&&_0x5603f4!==this[_0x41fb95(0x27b)]){if(_0x2e8998[_0x41fb95(0x22a)]!==_0x41fb95(0x232))throw new Error(_0x2e8998[_0x41fb95(0x278)]);else _0x46487b[_0x41fb95(0x2b5)](_0x41fb95(0x2b1),_0x324762),_0x204fab[_0x23f542[_0x41fb95(0x22e)]]&&(_0xa25ba5['tokenCount']=_0x5963bb[_0x28bb51[_0x41fb95(0x22e)]],_0x25c25f[_0x41fb95(0x2b5)](_0x2e8998[_0x41fb95(0x2df)],_0x3eb12f)),this[_0x41fb95(0x26c)](_0x1304da);}const _0x1aeb38=await _0x2e8998[_0x41fb95(0x1e5)](saveMessage,this[_0x41fb95(0x289)][_0x41fb95(0x2ee)],{..._0xd09add,'endpoint':this[_0x41fb95(0x289)][_0x41fb95(0x29f)],'unfinished':![],'user':_0x5603f4},{'context':'api/app/clients/BaseClient.js\x20-\x20saveMessageToDatabase\x20#saveMessage'});if(this['skipSaveConvo']){if(_0x2e8998[_0x41fb95(0x22c)](_0x2e8998[_0x41fb95(0x2fb)],_0x41fb95(0x1f3)))_0x6e2552+=this[_0x41fb95(0x27c)](_0xf731ce);else return{'message':_0x1aeb38};}const _0x1d2dd1=await saveConvo(this[_0x41fb95(0x289)][_0x41fb95(0x2ee)],{'conversationId':_0xd09add[_0x41fb95(0x220)],'endpoint':this[_0x41fb95(0x289)][_0x41fb95(0x29f)],'endpointType':this[_0x41fb95(0x289)][_0x41fb95(0x2d0)],..._0x188fcd},{'context':'api/app/clients/BaseClient.js\x20-\x20saveMessageToDatabase\x20#saveConvo'});return{'message':_0x1aeb38,'conversation':_0x1d2dd1};}async[_0x1da5da(0x2d2)](_0x10beab){const _0x460b52=_0x1da5da;await updateMessage(this['options'][_0x460b52(0x2ee)],_0x10beab);}static[_0x1da5da(0x21c)]({messages:_0x492f78,parentMessageId:_0x5d5cf7,mapMethod:mapMethod=null,summary:summary=![]}){const _0x83b7c0=_0x1da5da,_0xc0e5cf={'ROHCr':function(_0x372605,_0x1a0961){return _0x372605===_0x1a0961;},'AzVuY':'sykjZ','OkIat':function(_0x16affd,_0x18ee33){return _0x16affd===_0x18ee33;},'RIrNN':_0x83b7c0(0x2bd),'KjEfY':_0x83b7c0(0x2c6),'mvHuO':function(_0x131f05,_0x4ff79b){return _0x131f05===_0x4ff79b;}};if(!_0x492f78||_0x492f78[_0x83b7c0(0x2a8)]===0x0)return[];const _0x17801a=[];let _0x1c4810=_0x5d5cf7;const _0x581b48=new Set();while(_0x1c4810){if(_0xc0e5cf[_0x83b7c0(0x250)](_0x83b7c0(0x296),_0xc0e5cf[_0x83b7c0(0x2ec)])){if(_0x581b48['has'](_0x1c4810))break;const _0x180345=_0x492f78[_0x83b7c0(0x2f6)](_0x3320c6=>{const _0x1b90ab=_0x83b7c0,_0x5dde5e=_0x3320c6[_0x1b90ab(0x22e)]??_0x3320c6['id'];return _0x5dde5e===_0x1c4810;});_0x581b48['add'](_0x1c4810);if(!_0x180345){if(_0xc0e5cf[_0x83b7c0(0x244)](_0xc0e5cf['RIrNN'],'Vflmy'))break;else _0x29a64c[_0x83b7c0(0x282)]=_0x40f5d8[_0x733371[_0x83b7c0(0x22e)]],_0x31ef52[_0x83b7c0(0x2b5)](_0x83b7c0(0x24b),_0x5a149c);}summary&&_0x180345[_0x83b7c0(0x1f9)]&&(_0x180345[_0x83b7c0(0x24d)]=_0x83b7c0(0x234),_0x180345[_0x83b7c0(0x210)]=_0x180345[_0x83b7c0(0x1f9)]);summary&&_0x180345[_0x83b7c0(0x219)]&&(_0x180345[_0x83b7c0(0x282)]=_0x180345[_0x83b7c0(0x219)]);_0x17801a['push'](_0x180345);if(summary&&_0x180345[_0x83b7c0(0x1f9)]){if(_0xc0e5cf['KjEfY']==='QoBJS')break;else{const _0x8d5184=_0x38ad80[_0x83b7c0(0x282)]+_0x83b7c0(0x285)+this[_0x83b7c0(0x2e5)],_0x1267f8=_0x83b7c0(0x276)+_0x485d94[_0x83b7c0(0x20c)]+_0x83b7c0(0x269)+_0x8d5184+_0x83b7c0(0x258);_0x2827a5[_0x83b7c0(0x2e0)]('Prompt\x20token\x20count\x20exceeds\x20max\x20token\x20count\x20('+_0x8d5184+').');throw new _0x25701a(_0x1267f8);}}_0x1c4810=_0xc0e5cf[_0x83b7c0(0x2de)](_0x180345[_0x83b7c0(0x2f5)],Constants[_0x83b7c0(0x2d1)])?null:_0x180345[_0x83b7c0(0x2f5)];}else _0x23e1da=0x4,_0x191194=-0x1;}_0x17801a[_0x83b7c0(0x252)]();if(mapMethod)return _0x17801a['map'](mapMethod);return _0x17801a;}['getTokenCountForMessage'](_0x2ffae2){const _0x4ec902=_0x1da5da,_0x26c365={'QWLCs':function(_0xfde9c4,_0x44d1b5){return _0xfde9c4===_0x44d1b5;},'vSNBN':_0x4ec902(0x217),'QPfLs':function(_0x4bfd37,_0x2e8c71){return _0x4bfd37===_0x2e8c71;},'CQWiB':_0x4ec902(0x291),'okwxD':_0x4ec902(0x281),'xayHw':function(_0x316a10,_0xea2a99){return _0x316a10===_0xea2a99;},'bFzLS':function(_0x3205ca,_0x4f7804){return _0x3205ca===_0x4f7804;},'YXPha':_0x4ec902(0x1fb),'jOHFx':function(_0x3539c2,_0x12cca0){return _0x3539c2(_0x12cca0);},'gLxuL':function(_0x43b301,_0x16e1a4){return _0x43b301===_0x16e1a4;},'ebCbB':_0x4ec902(0x21f),'DrSPh':function(_0x244919,_0x334824){return _0x244919!==_0x334824;},'yZReE':_0x4ec902(0x25d)};let _0x492360=0x3,_0x265c30=0x1;this['modelOptions']['model']==='gpt-3.5-turbo-0301'&&(_0x492360=0x4,_0x265c30=-0x1);const _0x1eb9b9=_0x140d80=>{const _0x3cd78d=_0x4ec902;if(Array[_0x3cd78d(0x1f6)](_0x140d80)){if(_0x26c365[_0x3cd78d(0x28e)](_0x26c365[_0x3cd78d(0x248)],_0x3cd78d(0x1e3)))_0x3c7f5b=this['getMessageMapMethod']();else for(let _0x2500a5 of _0x140d80){if(!_0x2500a5||!_0x2500a5[_0x3cd78d(0x2eb)]||_0x26c365[_0x3cd78d(0x2a7)](_0x2500a5[_0x3cd78d(0x2eb)],_0x26c365[_0x3cd78d(0x2a2)]))continue;const _0x24f92f=_0x2500a5[_0x2500a5['type']];if(!_0x24f92f)continue;_0x1eb9b9(_0x24f92f);}}else{if(typeof _0x140d80===_0x26c365[_0x3cd78d(0x255)]){if(_0x3cd78d(0x233)!==_0x3cd78d(0x233)){if(_0xf32fe6(this[_0x3cd78d(0x289)][_0x3cd78d(0x29f)])&&this[_0x3cd78d(0x289)][_0x3cd78d(0x280)]&&this[_0x3cd78d(0x289)][_0x3cd78d(0x280)]['id'])return this[_0x3cd78d(0x289)][_0x3cd78d(0x280)]['id'];return this[_0x3cd78d(0x2be)][_0x3cd78d(0x2dc)];}else _0x1a70d8+=this[_0x3cd78d(0x27c)](_0x140d80);}else{if(_0x26c365[_0x3cd78d(0x2b0)](typeof _0x140d80,'number'))_0x1a70d8+=this[_0x3cd78d(0x27c)](_0x140d80[_0x3cd78d(0x2ea)]());else _0x26c365[_0x3cd78d(0x2d3)](typeof _0x140d80,_0x3cd78d(0x1e9))&&(_0x1a70d8+=this[_0x3cd78d(0x27c)](_0x140d80[_0x3cd78d(0x2ea)]()));}}};let _0x1a70d8=_0x492360;for(let [_0x190ebd,_0x1611cc]of Object[_0x4ec902(0x20a)](_0x2ffae2)){_0x26c365['jOHFx'](_0x1eb9b9,_0x1611cc);if(_0x26c365[_0x4ec902(0x2ed)](_0x190ebd,_0x26c365['ebCbB'])){if(_0x26c365[_0x4ec902(0x223)]('OiYLD',_0x26c365[_0x4ec902(0x2a9)]))_0x1a70d8+=_0x265c30;else throw new _0x16053c(_0x26c365[_0x4ec902(0x2c9)]);}}return _0x1a70d8;}async[_0x1da5da(0x1eb)](_0x607be,_0x141320={}){const _0x509ab8=_0x1da5da,_0x3e54c4={'TSTBn':function(_0x17e799,_0xdd082){return _0x17e799===_0xdd082;},'RAkev':'object'};return _0x141320&&_0x3e54c4[_0x509ab8(0x20e)](typeof _0x141320,_0x3e54c4[_0x509ab8(0x2b7)])&&this[_0x509ab8(0x297)](_0x141320),await this[_0x509ab8(0x26d)](_0x607be,_0x141320);}async[_0x1da5da(0x228)](_0x5ee423){const _0x29c36a=_0x1da5da,_0x62f49f={'GFxeb':function(_0x4a359a,_0x6183fa){return _0x4a359a===_0x6183fa;},'KYjUB':function(_0x1c22c6,_0x53071b){return _0x1c22c6(_0x53071b);},'bMotA':_0x29c36a(0x1fe),'fqhnk':function(_0x36aede,_0xb12193){return _0x36aede===_0xb12193;},'gBBem':_0x29c36a(0x29d),'huBco':function(_0x39bcbc,_0xbb8385){return _0x39bcbc!==_0xbb8385;},'LvuOf':_0x29c36a(0x2c0)};if(!this['options'][_0x29c36a(0x28f)])return _0x5ee423;const _0x131010=new Set(),_0x34c34a=this[_0x29c36a(0x289)][_0x29c36a(0x288)]&&!(this['options'][_0x29c36a(0x288)]instanceof Promise);if(_0x34c34a)for(const _0x1c95ff of this[_0x29c36a(0x289)][_0x29c36a(0x288)]){_0x131010[_0x29c36a(0x2f1)](_0x1c95ff[_0x29c36a(0x277)]);}const _0x55bc66=async _0x1120e5=>{const _0x2e5e90=_0x29c36a;!this[_0x2e5e90(0x2f3)]&&(this['message_file_map']={});const _0x46027b=[];for(const _0x550207 of _0x1120e5['files']){if(_0x131010[_0x2e5e90(0x2c3)](_0x550207[_0x2e5e90(0x277)]))continue;_0x46027b[_0x2e5e90(0x2b3)](_0x550207['file_id']),_0x131010[_0x2e5e90(0x2f1)](_0x550207['file_id']);}if(_0x62f49f[_0x2e5e90(0x214)](_0x46027b['length'],0x0))return _0x1120e5;const _0x1c7838=await _0x62f49f[_0x2e5e90(0x1e6)](getFiles,{'file_id':{'$in':_0x46027b}});return await this[_0x2e5e90(0x2ef)](_0x1120e5,_0x1c7838),this['message_file_map'][_0x1120e5[_0x2e5e90(0x22e)]]=_0x1c7838,_0x1120e5;},_0x43ac20=[];for(const _0x4b9cf5 of _0x5ee423){if(_0x62f49f[_0x29c36a(0x237)](_0x62f49f[_0x29c36a(0x204)],_0x29c36a(0x29d))){if(!_0x4b9cf5[_0x29c36a(0x274)]){if(_0x62f49f[_0x29c36a(0x229)]('NlbEv',_0x62f49f['LvuOf'])){_0x43ac20[_0x29c36a(0x2b3)](_0x4b9cf5);continue;}else return;}_0x43ac20[_0x29c36a(0x2b3)](_0x55bc66(_0x4b9cf5));}else return{'messageId':_0x46d5cb,'parentMessageId':_0x158582,'conversationId':_0x21bf4d,'sender':_0x62f49f[_0x29c36a(0x266)],'text':_0xf474b7,'isCreatedByUser':!![]};}const _0x55c04a=await Promise['all'](_0x43ac20);return this[_0x29c36a(0x22f)](Object[_0x29c36a(0x215)](this['message_file_map']??{})[_0x29c36a(0x1ec)]()),_0x55c04a;}}module[_0x1da5da(0x29e)]=BaseClient;