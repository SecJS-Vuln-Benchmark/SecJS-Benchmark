const _0x5c33c8=_0x2dae;function _0x2dae(_0x7326ee,_0x4b5d79){const _0x2c58f8=_0x2c58();return _0x2dae=function(_0x2dae96,_0x415481){_0x2dae96=_0x2dae96-0xdc;let _0x3468f0=_0x2c58f8[_0x2dae96];return _0x3468f0;},_0x2dae(_0x7326ee,_0x4b5d79);}(function(_0x3f692a,_0x3389a4){const _0x5f04bb=_0x2dae,_0x98692c=_0x3f692a();while(!![]){try{const _0x250b7a=parseInt(_0x5f04bb(0xf1))/0x1+parseInt(_0x5f04bb(0x173))/0x2*(parseInt(_0x5f04bb(0x147))/0x3)+parseInt(_0x5f04bb(0x122))/0x4+-parseInt(_0x5f04bb(0x135))/0x5*(parseInt(_0x5f04bb(0x175))/0x6)+-parseInt(_0x5f04bb(0x101))/0x7*(-parseInt(_0x5f04bb(0x137))/0x8)+-parseInt(_0x5f04bb(0xe5))/0x9+-parseInt(_0x5f04bb(0x13b))/0xa;if(_0x250b7a===_0x3389a4)break;else _0x98692c['push'](_0x98692c['shift']());}catch(_0x5175b0){_0x98692c['push'](_0x98692c['shift']());}}}(_0x2c58,0xb274e));const {ObjectId}=require(_0x5c33c8(0x132)),{SystemRoles,SystemCategories,Constants}=require(_0x5c33c8(0x155)),{getProjectByName,addGroupIdsToProject,removeGroupIdsFromProject,removeGroupFromAllProjects}=require('./Project'),{Prompt,PromptGroup}=require(_0x5c33c8(0xe6)),{escapeRegExp}=require(_0x5c33c8(0x138)),{logger}=require('~/config'),createGroupPipeline=(_0x528ee9,_0x1cd6de,_0xb58bb9)=>{const _0x3c7d96=_0x5c33c8,_0x13407d={'wVhHP':_0x3c7d96(0x151)};return[{'$match':_0x528ee9},{'$sort':{'createdAt':-0x1}},{'$skip':_0x1cd6de},{'$limit':_0xb58bb9},{'$lookup':{'from':_0x3c7d96(0x177),'localField':'productionId','foreignField':_0x3c7d96(0x129),'as':_0x3c7d96(0x176)}},{'$unwind':{'path':_0x13407d[_0x3c7d96(0x117)],'preserveNullAndEmptyArrays':!![]}},{'$project':{'name':0x1,'numberOfGenerations':0x1,'oneliner':0x1,'category':0x1,'projectIds':0x1,'productionId':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'productionPrompt.prompt':0x1}}];},createAllGroupsPipeline=(_0x27f228,_0x372d72={'name':0x1,'oneliner':0x1,'category':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'command':0x1,'productionPrompt.prompt':0x1})=>{const _0x261ec3=_0x5c33c8,_0x2cc7ce={'xPlBI':_0x261ec3(0x113),'BpxBD':_0x261ec3(0x176),'SxMPl':_0x261ec3(0x151)};return[{'$match':_0x27f228},{'$sort':{'createdAt':-0x1}},{'$lookup':{'from':'prompts','localField':_0x2cc7ce[_0x261ec3(0x16a)],'foreignField':_0x261ec3(0x129),'as':_0x2cc7ce[_0x261ec3(0x104)]}},{'$unwind':{'path':_0x2cc7ce[_0x261ec3(0xdf)],'preserveNullAndEmptyArrays':!![]}},{'$project':_0x372d72}];},getAllPromptGroups=async(_0x2e6f53,_0x3cb7c9)=>{const _0x48e69c=_0x5c33c8,_0xe293da={'eDxdW':function(_0x511405,_0x457ed3){return _0x511405!==_0x457ed3;},'BDAKC':_0x48e69c(0x12a),'SNfIs':_0x48e69c(0x12d),'uTcxx':function(_0x19914b,_0x15e09f){return _0x19914b!==_0x15e09f;},'ZNoEH':_0x48e69c(0x164),'rWeBq':_0x48e69c(0xfe),'GyrrG':function(_0x213c97,_0x1e5b19){return _0x213c97===_0x1e5b19;},'LZGtF':'mwifk','ARNhk':function(_0x186bbf,_0x42273c){return _0x186bbf(_0x42273c);},'eDMov':function(_0x4cd3bc,_0x384214){return _0x4cd3bc===_0x384214;},'iRcLS':function(_0x563a06,_0x259058){return _0x563a06===_0x259058;},'wXoHi':'bKXZl','mwaqD':'promptGroupIds','ZYZWd':_0x48e69c(0xe1)};try{if(_0xe293da[_0x48e69c(0x167)](_0xe293da[_0x48e69c(0x130)],_0xe293da[_0x48e69c(0x15e)])){const {name:_0x2c19d0,..._0x142bd2}=_0x3cb7c9;if(!_0x142bd2[_0x48e69c(0x120)]){if(_0xe293da[_0x48e69c(0x13d)](_0xe293da[_0x48e69c(0x15a)],_0xe293da[_0x48e69c(0x15a)]))_0x108eba[_0x48e69c(0x136)]=new _0x1f201f(_0x5c1be4['groupId']);else throw new Error(_0xe293da['rWeBq']);}let _0x519996=!![],_0x3c3e26=![];_0x2c19d0&&(_0xe293da['GyrrG'](_0x48e69c(0x10b),_0xe293da['LZGtF'])?_0x142bd2[_0x48e69c(0x119)]=new RegExp(_0xe293da[_0x48e69c(0x131)](escapeRegExp,_0x2c19d0),'i'):_0x582670[_0x48e69c(0x13c)]='');if(!_0x142bd2[_0x48e69c(0x13c)])delete _0x142bd2['category'];else{if(_0xe293da[_0x48e69c(0x12b)](_0x142bd2[_0x48e69c(0x13c)],SystemCategories[_0x48e69c(0x14d)]))_0x519996=![],delete _0x142bd2[_0x48e69c(0x13c)];else{if(_0xe293da[_0x48e69c(0x13a)](_0x142bd2[_0x48e69c(0x13c)],SystemCategories[_0x48e69c(0x115)]))_0x142bd2[_0x48e69c(0x13c)]='';else _0x142bd2[_0x48e69c(0x13c)]===SystemCategories['SHARED_PROMPTS']&&(_0x3c3e26=!![],delete _0x142bd2['category']);}}let _0x39b789=_0x142bd2;if(_0x519996){if(_0xe293da[_0x48e69c(0x13a)](_0x48e69c(0x142),_0xe293da[_0x48e69c(0x168)])){const _0x41fb7f=await getProjectByName(Constants['GLOBAL_PROJECT_NAME'],_0xe293da[_0x48e69c(0x102)]);if(_0x41fb7f&&_0x41fb7f[_0x48e69c(0xfd)][_0x48e69c(0x162)]>0x0){const _0x48746e={'_id':{'$in':_0x41fb7f[_0x48e69c(0xfd)]},..._0x142bd2};delete _0x48746e[_0x48e69c(0x120)],_0x39b789=_0x3c3e26?_0x48746e:{'$or':[_0x48746e,_0x142bd2]};}}else throw new _0x4f773d('Failed\x20to\x20delete\x20the\x20prompt');}const _0x5a762a=createAllGroupsPipeline(_0x39b789);return await PromptGroup[_0x48e69c(0x125)](_0x5a762a)['exec']();}else delete _0x566c1e[_0x48e69c(0x13c)];}catch(_0x4cd331){return console[_0x48e69c(0x15f)]('Error\x20getting\x20all\x20prompt\x20groups',_0x4cd331),{'message':_0xe293da['ZYZWd']};}},getPromptGroups=async(_0x24d035,_0xd12fdc)=>{const _0x143479=_0x5c33c8,_0x49bb42={'aaNFF':'Error\x20saving\x20prompt\x20group','hSDnn':'hyecy','sXZfi':function(_0x4ed540,_0x5e3fb6,_0x21a974){return _0x4ed540(_0x5e3fb6,_0x21a974);},'SaJfy':function(_0x2f63ab,_0x55653d){return _0x2f63ab(_0x55653d);},'tLNBv':'AyojD','rvEKH':_0x143479(0xf0),'HTYJy':function(_0x925beb,_0x5d35df){return _0x925beb===_0x5d35df;},'ttNJq':function(_0x307ceb,_0x1c87bb){return _0x307ceb>_0x1c87bb;},'tHiao':function(_0x22dcf5,_0x6b70df){return _0x22dcf5-_0x6b70df;},'BguCq':function(_0x34609b,_0x2dc3c6){return _0x34609b>_0x2dc3c6;}};try{if(_0x49bb42[_0x143479(0x13e)]!==_0x143479(0x16d)){_0x3fc662[_0x143479(0x15f)](_0x49bb42['aaNFF'],_0x1976e1);throw new _0x19fc39(_0x49bb42['aaNFF']);}else{const {pageNumber:pageNumber=0x1,pageSize:pageSize=0xa,name:_0x76be40,..._0x56bff3}=_0xd12fdc,_0x4f45ef=Math[_0x143479(0x11a)](parseInt(pageNumber,0xa),0x1),_0x49c209=Math[_0x143479(0x11a)](_0x49bb42[_0x143479(0x157)](parseInt,pageSize,0xa),0x1);if(!_0x56bff3[_0x143479(0x120)])throw new Error(_0x143479(0xfe));let _0x1bc67b=!![],_0xf0d146=![];_0x76be40&&(_0x56bff3['name']=new RegExp(_0x49bb42[_0x143479(0x116)](escapeRegExp,_0x76be40),'i'));if(!_0x56bff3[_0x143479(0x13c)])delete _0x56bff3[_0x143479(0x13c)];else{if(_0x56bff3[_0x143479(0x13c)]===SystemCategories[_0x143479(0x14d)])_0x1bc67b=![],delete _0x56bff3[_0x143479(0x13c)];else{if(_0x56bff3[_0x143479(0x13c)]===SystemCategories['NO_CATEGORY']){if(_0x49bb42['tLNBv']!==_0x49bb42['rvEKH'])_0x56bff3[_0x143479(0x13c)]='';else throw new _0x30f89d(_0x143479(0x14e));}else _0x49bb42['HTYJy'](_0x56bff3[_0x143479(0x13c)],SystemCategories[_0x143479(0x145)])&&(_0xf0d146=!![],delete _0x56bff3['category']);}}let _0x2fbb65=_0x56bff3;if(_0x1bc67b){const _0x5bafd0=await getProjectByName(Constants[_0x143479(0xf2)],_0x143479(0xfd));if(_0x5bafd0&&_0x49bb42[_0x143479(0x12c)](_0x5bafd0[_0x143479(0xfd)][_0x143479(0x162)],0x0)){const _0x7df2b7={'_id':{'$in':_0x5bafd0[_0x143479(0xfd)]},..._0x56bff3};delete _0x7df2b7[_0x143479(0x120)],_0x2fbb65=_0xf0d146?_0x7df2b7:{'$or':[_0x7df2b7,_0x56bff3]};}}const _0x372427=_0x49bb42['tHiao'](_0x4f45ef,0x1)*_0x49c209,_0x5e362e=_0x49c209,_0x1d3d51=createGroupPipeline(_0x2fbb65,_0x372427,_0x5e362e),_0x387de3=[{'$match':_0x2fbb65},{'$count':_0x143479(0x121)}],[_0x15f743,_0x58793a]=await Promise[_0x143479(0x14a)]([PromptGroup[_0x143479(0x125)](_0x1d3d51)['exec'](),PromptGroup[_0x143479(0x125)](_0x387de3)['exec']()]),_0x3f6c07=_0x15f743,_0x48c814=_0x49bb42[_0x143479(0x10f)](_0x58793a['length'],0x0)?_0x58793a[0x0][_0x143479(0x121)]:0x0;return{'promptGroups':_0x3f6c07,'pageNumber':_0x4f45ef[_0x143479(0xe9)](),'pageSize':_0x49c209[_0x143479(0xe9)](),'pages':Math[_0x143479(0x105)](_0x48c814/_0x49c209)[_0x143479(0xe9)]()};}}catch(_0x2c3d98){return console[_0x143479(0x15f)](_0x143479(0xef),_0x2c3d98),{'message':_0x143479(0xef)};}},deletePromptGroup=async({_id:_0x3be3b1,author:_0x1a9e0f,role:_0x4ad4ff})=>{const _0x51fee0=_0x5c33c8,_0x9bd1cc={'EiCur':_0x51fee0(0xea),'eCrDm':function(_0x21b740,_0x4ff6a7){return _0x21b740===_0x4ff6a7;},'pvSzU':_0x51fee0(0x14b),'mXzPx':'Prompt\x20group\x20deleted\x20successfully'},_0x287fe0={'_id':_0x3be3b1,'author':_0x1a9e0f},_0x36a960={'groupId':new ObjectId(_0x3be3b1),'author':_0x1a9e0f};if(_0x9bd1cc[_0x51fee0(0x14c)](_0x4ad4ff,SystemRoles['ADMIN'])){if(_0x9bd1cc[_0x51fee0(0x140)]!==_0x51fee0(0x160))delete _0x287fe0[_0x51fee0(0x120)],delete _0x36a960[_0x51fee0(0x120)];else return{'message':_0x9bd1cc[_0x51fee0(0xdc)]};}const _0x4a4389=await PromptGroup[_0x51fee0(0xf9)](_0x287fe0);if(!_0x4a4389||_0x9bd1cc[_0x51fee0(0x14c)](_0x4a4389['deletedCount'],0x0))throw new Error(_0x51fee0(0x14e));return await Prompt['deleteMany'](_0x36a960),await removeGroupFromAllProjects(_0x3be3b1),{'message':_0x9bd1cc[_0x51fee0(0xee)]};};function _0x2c58(){const _0x1ee3e5=['matchedCount','Prompt\x20group\x20deleted\x20successfully','411890hCEfvW','Failed\x20to\x20delete\x20the\x20prompt','2586iyOxEW','productionPrompt','prompts','UQJXZ','amXKG','EiCur','WOJwd','fsZTu','SxMPl','Error\x20making\x20prompt\x20production','Error\x20getting\x20all\x20prompt\x20groups','findOne','hSIJI','GzcNt','6527556fVltVc','./schema/promptSchema','groupId_1_version_1','-__v','toString','Prompt\x20not\x20found','populate','CSwaP','ADMIN','mXzPx','Error\x20getting\x20prompt\x20groups','xERRc','1203463ktHLmC','GLOBAL_PROJECT_NAME','PKMgV','yMzWN','cZyWD','exec','JazYL','Error\x20getting\x20prompt','deleteOne','qNFHi','create','AyEaF','promptGroupIds','Author\x20is\x20required','findOneAndUpdate','Error\x20getting\x20prompts','7kaJyWh','mwaqD','iAchJ','BpxBD','ceil','$$ROOT','SfjQZ','mvGrV','QaOQJ','removeProjectIds','mwifk','ChyiG','iZqXR','findByIdAndUpdate','BguCq','Prompt\x20deleted\x20successfully','PJNCY','Error\x20updating\x20prompt\x20labels','productionId','find','NO_CATEGORY','SaJfy','wVhHP','MfjFJ','name','max','MLjxj','ZPoNY','findById','KFHnC','slWOW','author','total','4812608sZisub','collection','PLSSo','aggregate','limit','$category','qeecP','_id','xpACX','eDMov','ttNJq','nBEef','exports','OnxFH','BDAKC','ARNhk','mongodb','jVNdR','includes','11330GvXztX','groupId','8749704QGTyMv','~/server/utils','Prompt\x20production\x20made\x20successfully','iRcLS','18912200ffpzJu','category','uTcxx','hSDnn','EUArb','pvSzU','ANIQO','bKXZl','$pull','UYbWN','SHARED_PROMPTS','dTTzD','12SKZVaI','prompt','knojR','all','maEhD','eCrDm','MY_PROMPTS','Prompt\x20group\x20not\x20found','Error\x20saving\x20prompt\x20group','$addToSet','$productionPrompt','zArsT','Prompt\x20labels\x20updated\x20successfully','ddHaS','librechat-data-provider','$promptGroup','sXZfi','Uxzdn','lean','ZNoEH','fLouV','sULka','select','SNfIs','error','oTzXA','ClNyD','length','iTozs','nOOJn','DdRql','Error\x20updating\x20prompt\x20group','eDxdW','wXoHi','zvfEy','xPlBI','projectIds','Error\x20saving\x20prompt','hyecy','XMWie','Error\x20getting\x20prompt\x20group','updateOne'];_0x2c58=function(){return _0x1ee3e5;};return _0x2c58();}module[_0x5c33c8(0x12e)]={'getPromptGroups':getPromptGroups,'deletePromptGroup':deletePromptGroup,'getAllPromptGroups':getAllPromptGroups,'createPromptGroup':async _0x790252=>{const _0x11c7e4=_0x5c33c8,_0x4b6691={'wNnbZ':_0x11c7e4(0xe8),'Uxzdn':_0x11c7e4(0x14f)};try{const {prompt:_0x336ce3,group:_0x101b35,author:_0x2d80d9,authorName:_0x38b9a9}=_0x790252;let _0x101895=await PromptGroup['findOneAndUpdate']({..._0x101b35,'author':_0x2d80d9,'authorName':_0x38b9a9,'productionId':null},{'$setOnInsert':{..._0x101b35,'author':_0x2d80d9,'authorName':_0x38b9a9,'productionId':null}},{'new':!![],'upsert':!![]})[_0x11c7e4(0x159)]()[_0x11c7e4(0x15d)]('-__v')['exec']();const _0x34eb77=await Prompt[_0x11c7e4(0xff)]({..._0x336ce3,'author':_0x2d80d9,'groupId':_0x101895['_id']},{'$setOnInsert':{..._0x336ce3,'author':_0x2d80d9,'groupId':_0x101895[_0x11c7e4(0x129)]}},{'new':!![],'upsert':!![]})[_0x11c7e4(0x159)]()[_0x11c7e4(0x15d)](_0x11c7e4(0xe8))['exec']();return _0x101895=await PromptGroup['findByIdAndUpdate'](_0x101895['_id'],{'productionId':_0x34eb77[_0x11c7e4(0x129)]},{'new':!![]})[_0x11c7e4(0x159)]()[_0x11c7e4(0x15d)](_0x4b6691['wNnbZ'])['exec'](),{'prompt':_0x34eb77,'group':{..._0x101895,'productionPrompt':{'prompt':_0x34eb77[_0x11c7e4(0x148)]}}};}catch(_0x4c4591){if(_0x11c7e4(0xde)===_0x11c7e4(0xde)){logger[_0x11c7e4(0x15f)](_0x4b6691[_0x11c7e4(0x158)],_0x4c4591);throw new Error(_0x11c7e4(0x14f));}else{const _0x1a3025={'_id':{'$in':_0x269761[_0x11c7e4(0xfd)]},..._0x2d7bf6};delete _0x1a3025[_0x11c7e4(0x120)],_0x1da4f3=_0x403c6d?_0x1a3025:{'$or':[_0x1a3025,_0x506f5a]};}}},'savePrompt':async _0x5d681a=>{const _0x195212=_0x5c33c8,_0x43821d={'MLjxj':_0x195212(0x166),'SfjQZ':'GzcNt','fLouV':'Error\x20saving\x20prompt'};try{const {prompt:_0x231478,author:_0x434b6b}=_0x5d681a,_0x6e682c={..._0x231478,'author':_0x434b6b};let _0x516cc4;try{if(_0x195212(0xe4)===_0x43821d[_0x195212(0x107)])_0x516cc4=await Prompt[_0x195212(0xfb)](_0x6e682c);else return _0x131cf8['error']('Error\x20updating\x20prompt\x20group',_0x301d4e),{'message':_0x43821d[_0x195212(0x11b)]};}catch(_0x2e019e){if(_0x2e019e?.['message']?.[_0x195212(0x134)](_0x195212(0xe7)))await Prompt['db'][_0x195212(0x123)](_0x195212(0x177))['dropIndex']('groupId_1_version_1');else throw _0x2e019e;_0x516cc4=await Prompt[_0x195212(0xfb)](_0x6e682c);}return{'prompt':_0x516cc4};}catch(_0xf27770){return logger[_0x195212(0x15f)](_0x195212(0x16c),_0xf27770),{'message':_0x43821d[_0x195212(0x15b)]};}},'getPrompts':async _0x131b86=>{const _0xd65b73=_0x5c33c8,_0xfbe249={'dyHEL':'Error\x20getting\x20prompts'};try{return await Prompt[_0xd65b73(0x114)](_0x131b86)['sort']({'createdAt':-0x1})[_0xd65b73(0x159)]();}catch(_0x5cf479){return logger['error'](_0xd65b73(0x100),_0x5cf479),{'message':_0xfbe249['dyHEL']};}},'getPrompt':async _0x495350=>{const _0x1b37f6=_0x5c33c8,_0x1d41a4={'UYbWN':_0x1b37f6(0xf8)};try{return _0x495350['groupId']&&(_0x495350[_0x1b37f6(0x136)]=new ObjectId(_0x495350[_0x1b37f6(0x136)])),await Prompt[_0x1b37f6(0xe2)](_0x495350)[_0x1b37f6(0x159)]();}catch(_0x5218af){return logger[_0x1b37f6(0x15f)](_0x1d41a4[_0x1b37f6(0x144)],_0x5218af),{'message':_0x1b37f6(0xf8)};}},'getRandomPromptGroups':async _0x195b21=>{const _0x2a902f=_0x5c33c8,_0x10047c={'cZyWD':_0x2a902f(0x127),'AmHxx':_0x2a902f(0x106)};try{const _0x7f128d=await PromptGroup['aggregate']([{'$match':{'category':{'$ne':''}}},{'$group':{'_id':_0x10047c[_0x2a902f(0xf5)],'promptGroup':{'$first':_0x10047c['AmHxx']}}},{'$replaceRoot':{'newRoot':_0x2a902f(0x156)}},{'$sample':{'size':+_0x195b21['limit']+ +_0x195b21['skip']}},{'$skip':+_0x195b21['skip']},{'$limit':+_0x195b21[_0x2a902f(0x126)]}]);return{'prompts':_0x7f128d};}catch(_0x58832b){return logger[_0x2a902f(0x15f)]('Error\x20getting\x20prompt\x20groups',_0x58832b),{'message':_0x2a902f(0xef)};}},'getPromptGroupsWithPrompts':async _0x3c33ad=>{const _0x366ea8=_0x5c33c8,_0x116d8a={'sULka':'Error\x20getting\x20prompt\x20group','zvfEy':_0x366ea8(0xfa),'amXKG':_0x366ea8(0xf4),'PJNCY':_0x366ea8(0x177),'jVpdk':'-_id\x20-__v\x20-user'};try{return _0x116d8a[_0x366ea8(0x169)]===_0x116d8a[_0x366ea8(0x179)]?(_0x312104[_0x366ea8(0x15f)](_0x366ea8(0x16f),_0x5b96c4),{'message':_0x116d8a[_0x366ea8(0x15c)]}):await PromptGroup[_0x366ea8(0xe2)](_0x3c33ad)[_0x366ea8(0xeb)]({'path':_0x116d8a[_0x366ea8(0x111)],'select':_0x116d8a['jVpdk']})[_0x366ea8(0x15d)](_0x116d8a['jVpdk'])['lean']();}catch(_0x19cea5){return logger[_0x366ea8(0x15f)]('Error\x20getting\x20prompt\x20groups',_0x19cea5),{'message':_0x366ea8(0xef)};}},'getPromptGroup':async _0x4e9367=>{const _0x10222d=_0x5c33c8,_0x51978d={'PLSSo':function(_0xb3e83c,_0x75debb){return _0xb3e83c===_0x75debb;},'ZPoNY':_0x10222d(0x11e),'QaOQJ':_0x10222d(0x16f)};try{return await PromptGroup[_0x10222d(0xe2)](_0x4e9367)[_0x10222d(0x159)]();}catch(_0xa3de72){if(_0x51978d[_0x10222d(0x124)](_0x51978d[_0x10222d(0x11c)],_0x10222d(0x12f)))_0xc38af9=![],delete _0x2a6beb[_0x10222d(0x13c)];else return logger['error'](_0x51978d[_0x10222d(0x109)],_0xa3de72),{'message':_0x10222d(0x16f)};}},'deletePrompt':async({promptId:_0xc33c8b,groupId:_0x431142,author:_0x2d2c18,role:_0x29e500})=>{const _0x189cc5=_0x5c33c8,_0x172927={'hSIJI':function(_0xeadbb9,_0xeae1d3){return _0xeadbb9===_0xeae1d3;},'MfjFJ':_0x189cc5(0x174),'WOJwd':'_id','iAchJ':function(_0x25948d,_0x1d39d0){return _0x25948d(_0x1d39d0);},'qeecP':_0x189cc5(0x110),'iTozs':_0x189cc5(0x172),'PKMgV':function(_0x19501f,_0x4ee96f){return _0x19501f===_0x4ee96f;}},_0x3380ab={'_id':_0xc33c8b,'groupId':_0x431142,'author':_0x2d2c18};_0x172927[_0x189cc5(0xe3)](_0x29e500,SystemRoles[_0x189cc5(0xed)])&&delete _0x3380ab[_0x189cc5(0x120)];const {deletedCount:_0x516dcd}=await Prompt[_0x189cc5(0xf9)](_0x3380ab);if(_0x516dcd===0x0)throw new Error(_0x172927[_0x189cc5(0x118)]);const _0x5094dc=await Prompt[_0x189cc5(0x114)]({'groupId':_0x431142})[_0x189cc5(0x15d)](_0x172927[_0x189cc5(0xdd)])['sort']({'createdAt':0x1})[_0x189cc5(0x159)]();if(_0x172927[_0x189cc5(0xe3)](_0x5094dc[_0x189cc5(0x162)],0x0))return await PromptGroup['deleteOne']({'_id':_0x431142}),await _0x172927[_0x189cc5(0x103)](removeGroupFromAllProjects,_0x431142),{'prompt':_0x172927['qeecP'],'promptGroup':{'message':_0x172927[_0x189cc5(0x163)],'id':_0x431142}};else{const _0xfcefd8=await PromptGroup['findById'](_0x431142)[_0x189cc5(0x159)]();return _0x172927[_0x189cc5(0xf3)](_0xfcefd8[_0x189cc5(0x113)]['toString'](),_0xc33c8b[_0x189cc5(0xe9)]())&&await PromptGroup[_0x189cc5(0x170)]({'_id':_0x431142},{'productionId':_0x5094dc[_0x5094dc[_0x189cc5(0x162)]-0x1][_0x189cc5(0x129)]}),{'prompt':_0x172927[_0x189cc5(0x128)]};}},'updatePromptGroup':async(_0x3f75b5,_0x5a11f4)=>{const _0x3a39f4=_0x5c33c8,_0x315676={'KztWp':'Error\x20making\x20prompt\x20production','slWOW':_0x3a39f4(0x108),'dTTzD':_0x3a39f4(0x165),'ANIQO':_0x3a39f4(0x14e)};try{const _0x4792c7={};if(_0x5a11f4[_0x3a39f4(0x10a)]){for(const _0x1d6666 of _0x5a11f4['removeProjectIds']){if(_0x3a39f4(0x108)===_0x315676[_0x3a39f4(0x11f)])await removeGroupIdsFromProject(_0x1d6666,[_0x3f75b5[_0x3a39f4(0x129)]]);else return _0x14099b[_0x3a39f4(0x15f)](_0x315676['KztWp'],_0xb9570e),{'message':_0x3a39f4(0xe0)};}_0x4792c7[_0x3a39f4(0x143)]={'projectIds':{'$in':_0x5a11f4[_0x3a39f4(0x10a)]}},delete _0x5a11f4['removeProjectIds'];}if(_0x5a11f4[_0x3a39f4(0x16b)]){for(const _0x450232 of _0x5a11f4[_0x3a39f4(0x16b)]){await addGroupIdsToProject(_0x450232,[_0x3f75b5[_0x3a39f4(0x129)]]);}_0x4792c7[_0x3a39f4(0x150)]={'projectIds':{'$each':_0x5a11f4['projectIds']}},delete _0x5a11f4[_0x3a39f4(0x16b)];}const _0x3f7b43={..._0x5a11f4,..._0x4792c7},_0x5f357a=await PromptGroup[_0x3a39f4(0xff)](_0x3f75b5,_0x3f7b43,{'new':!![],'upsert':![]});if(!_0x5f357a){if(_0x315676[_0x3a39f4(0x146)]==='DdRql')throw new Error(_0x315676[_0x3a39f4(0x141)]);else _0x546982[_0x3a39f4(0x13c)]='';}return _0x5f357a;}catch(_0xe05281){return logger[_0x3a39f4(0x15f)](_0x3a39f4(0x166),_0xe05281),{'message':'Error\x20updating\x20prompt\x20group'};}},'makePromptProduction':async _0x567444=>{const _0x20b055=_0x5c33c8,_0xe65237={'UQJXZ':_0x20b055(0xef),'CSwaP':_0x20b055(0xfe),'ChyiG':'IYNTQ','SLfIu':_0x20b055(0x10d),'JazYL':_0x20b055(0xe0)};try{if(_0xe65237[_0x20b055(0x10c)]===_0xe65237[_0x20b055(0x10c)]){const _0x2c947e=await Prompt[_0x20b055(0x11d)](_0x567444)[_0x20b055(0x159)]();if(!_0x2c947e)throw new Error(_0x20b055(0xea));return await PromptGroup[_0x20b055(0x10e)](_0x2c947e[_0x20b055(0x136)],{'productionId':_0x2c947e[_0x20b055(0x129)]},{'new':!![]})['lean']()[_0x20b055(0xf6)](),{'message':_0x20b055(0x139)};}else return _0x18e8f9[_0x20b055(0x15f)](_0xe65237[_0x20b055(0x178)],_0x1e6c2b),{'message':_0xe65237[_0x20b055(0x178)]};}catch(_0x436909){if(_0x20b055(0x152)!==_0xe65237['SLfIu'])return logger[_0x20b055(0x15f)](_0xe65237[_0x20b055(0xf7)],_0x436909),{'message':_0xe65237['JazYL']};else throw new _0x11faa3(_0xe65237[_0x20b055(0xec)]);}},'updatePromptLabels':async(_0x1d0d49,_0xeb6968)=>{const _0x5bf7e3=_0x5c33c8,_0x108c8b={'XMWie':_0x5bf7e3(0x154),'jVNdR':_0x5bf7e3(0x149),'AyEaF':function(_0x33b14e,_0x5056a6){return _0x33b14e===_0x5056a6;},'Dunta':_0x5bf7e3(0xea),'EUArb':_0x5bf7e3(0x153),'ClNyD':'Error\x20updating\x20prompt\x20labels'};try{if(_0x108c8b[_0x5bf7e3(0x16e)]!==_0x108c8b[_0x5bf7e3(0x133)]){const _0x32b8fe=await Prompt['updateOne']({'_id':_0x1d0d49},{'$set':{'labels':_0xeb6968}});if(_0x108c8b[_0x5bf7e3(0xfc)](_0x32b8fe[_0x5bf7e3(0x171)],0x0))return{'message':_0x108c8b['Dunta']};return{'message':_0x108c8b[_0x5bf7e3(0x13f)]};}else return _0x346b10[_0x5bf7e3(0x15f)](_0x5bf7e3(0xef),_0xf2770e),{'message':_0x5bf7e3(0xef)};}catch(_0x3a353d){return logger[_0x5bf7e3(0x15f)](_0x108c8b[_0x5bf7e3(0x161)],_0x3a353d),{'message':_0x5bf7e3(0x112)};}}};