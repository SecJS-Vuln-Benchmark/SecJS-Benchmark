const _0x3cf0c6=_0x87ef;(function(_0x42e2ec,_0x52c1b3){const _0x1fd3bf=_0x87ef,_0x1a2d30=_0x42e2ec();while(!![]){try{const _0x36ee9d=-parseInt(_0x1fd3bf(0x164))/0x1+parseInt(_0x1fd3bf(0x15d))/0x2+-parseInt(_0x1fd3bf(0x149))/0x3+-parseInt(_0x1fd3bf(0x162))/0x4*(-parseInt(_0x1fd3bf(0x155))/0x5)+parseInt(_0x1fd3bf(0x132))/0x6+parseInt(_0x1fd3bf(0x158))/0x7+parseInt(_0x1fd3bf(0x160))/0x8*(-parseInt(_0x1fd3bf(0x14f))/0x9);if(_0x36ee9d===_0x52c1b3)break;else _0x1a2d30['push'](_0x1a2d30['shift']());}catch(_0x50bb5e){_0x1a2d30['push'](_0x1a2d30['shift']());}}}(_0x532b,0x4e824));function _0x532b(){const _0x1ea154=['imnwg','Model\x20spec\x20mismatch','files','attachments','find','sWjGr','modelSpecs','assistants','agents','enforce','3068052RyYWJR','XIokU','~/server/services/Files/process','kOqFt','openAI','endpointOption','sORxl','tools','Error\x20building\x20endpoint\x20option','endpoint','length','bedrock','aeHmo','\x22\x20endpoint\x20can\x20have\x20tools\x20defined\x20in\x20the\x20preset','anthropic','Only\x20the\x20\x22','gdHkB','tYfhg','JkfVq','list','Error\x20parsing\x20conversation','ArqVw','mxWhC','260694REDYGi','buildOptions','No\x20model\x20spec\x20selected','yXYUI','MaSpj','exports','1447578bZosRk','ZDVkp','~/server/services/Endpoints/assistants','app','locals','FKJGS','165tUWNDz','~/server/services/Endpoints/anthropic','preset','3367518OFpNaB','~/server/services/Endpoints/agents','~/server/services/Endpoints/openAI','librechat-data-provider','CevoH','591124BkBtVq','body','~/server/services/Endpoints/gptPlugins','32NkeIpW','conversationId','17656KBBCdL','modelsConfig','381802titDqW','qHkZj','~/server/services/Endpoints/custom','azureOpenAI','RztEC','gptPlugins'];_0x532b=function(){return _0x1ea154;};return _0x532b();}const {parseCompactConvo,EModelEndpoint,isAgentsEndpoint}=require(_0x3cf0c6(0x15b)),{getModelsConfig}=require('~/server/controllers/ModelController'),azureAssistants=require('~/server/services/Endpoints/azureAssistants'),assistants=require(_0x3cf0c6(0x151)),gptPlugins=require(_0x3cf0c6(0x15f)),{processFiles}=require(_0x3cf0c6(0x134)),anthropic=require(_0x3cf0c6(0x156)),bedrock=require('~/server/services/Endpoints/bedrock'),openAI=require(_0x3cf0c6(0x15a)),agents=require(_0x3cf0c6(0x159)),custom=require(_0x3cf0c6(0x124)),google=require('~/server/services/Endpoints/google'),{getConvoFiles}=require('~/models/Conversation'),{handleError}=require('~/server/utils'),buildFunction={[EModelEndpoint[_0x3cf0c6(0x136)]]:openAI[_0x3cf0c6(0x14a)],[EModelEndpoint['google']]:google['buildOptions'],[EModelEndpoint['custom']]:custom[_0x3cf0c6(0x14a)],[EModelEndpoint[_0x3cf0c6(0x130)]]:agents['buildOptions'],[EModelEndpoint[_0x3cf0c6(0x13d)]]:bedrock[_0x3cf0c6(0x14a)],[EModelEndpoint[_0x3cf0c6(0x125)]]:openAI['buildOptions'],[EModelEndpoint[_0x3cf0c6(0x140)]]:anthropic['buildOptions'],[EModelEndpoint[_0x3cf0c6(0x127)]]:gptPlugins['buildOptions'],[EModelEndpoint[_0x3cf0c6(0x12f)]]:assistants['buildOptions'],[EModelEndpoint['azureAssistants']]:azureAssistants[_0x3cf0c6(0x14a)]};function _0x87ef(_0x5e717a,_0x229624){const _0x532bce=_0x532b();return _0x87ef=function(_0x87efbe,_0x5bae07){_0x87efbe=_0x87efbe-0x124;let _0x4f0d09=_0x532bce[_0x87efbe];return _0x4f0d09;},_0x87ef(_0x5e717a,_0x229624);}async function buildEndpointOption(_0x392c75,_0xea6714,_0x3e7832){const _0x5bb127=_0x3cf0c6,_0x125d01={'FKJGS':function(_0x485c85,_0x586918,_0x2c116f){return _0x485c85(_0x586918,_0x2c116f);},'yXYUI':'Invalid\x20model\x20spec','gdHkB':function(_0x2ce48c,_0x1d6587,_0x577fce){return _0x2ce48c(_0x1d6587,_0x577fce);},'MaSpj':_0x5bb127(0x146),'sORxl':_0x5bb127(0x126),'aeHmo':_0x5bb127(0x14b),'rwQUz':function(_0x10c3ce,_0x2a43cc,_0x512c2e){return _0x10c3ce(_0x2a43cc,_0x512c2e);},'ArqVw':function(_0x4a53ec,_0x17b469,_0x338205){return _0x4a53ec(_0x17b469,_0x338205);},'VNfXL':function(_0x5e162e,_0xf9f9f3){return _0x5e162e!==_0xf9f9f3;},'mxWhC':function(_0x388c99,_0xa532ea){return _0x388c99===_0xa532ea;},'imnwg':function(_0x4cf27b,_0x3cf7b5,_0x3886d2){return _0x4cf27b(_0x3cf7b5,_0x3886d2);},'efmOd':function(_0x5389ab,_0x464278){return _0x5389ab&&_0x464278;},'tYfhg':function(_0x5704d2,_0x290115,_0x51bcaa){return _0x5704d2(_0x290115,_0x51bcaa);},'BHMou':function(_0x5427ee){return _0x5427ee();},'XIokU':function(_0x1b281b,_0x321cbc){return _0x1b281b===_0x321cbc;},'ZDVkp':_0x5bb127(0x165)},{endpoint:_0x3f6948,endpointType:_0xf347c9}=_0x392c75[_0x5bb127(0x15e)];let _0x40bb86;try{_0x40bb86=parseCompactConvo({'endpoint':_0x3f6948,'endpointType':_0xf347c9,'conversation':_0x392c75[_0x5bb127(0x15e)]});}catch(_0x241f31){return _0x125d01[_0x5bb127(0x142)](handleError,_0xea6714,{'text':_0x125d01[_0x5bb127(0x14d)]});}if(_0x392c75[_0x5bb127(0x152)]['locals'][_0x5bb127(0x12e)]?.[_0x5bb127(0x145)]&&_0x392c75[_0x5bb127(0x152)][_0x5bb127(0x153)][_0x5bb127(0x12e)]?.[_0x5bb127(0x131)]){const {list:_0xe45bd7}=_0x392c75['app'][_0x5bb127(0x153)][_0x5bb127(0x12e)],{spec:_0x480635}=_0x40bb86;if(!_0x480635)return _0x125d01[_0x5bb127(0x138)]!==_0x5bb127(0x12d)?_0x125d01['FKJGS'](handleError,_0xea6714,{'text':_0x125d01[_0x5bb127(0x13e)]}):_0x55bc52(_0x4a0441,{'text':_0x5bb127(0x141)+_0x434270['gptPlugins']+_0x5bb127(0x13f)});const _0x53b1dd=_0xe45bd7[_0x5bb127(0x12c)](_0x4a47a3=>_0x4a47a3['name']===_0x480635);if(!_0x53b1dd)return _0x125d01['rwQUz'](handleError,_0xea6714,{'text':_0x125d01[_0x5bb127(0x14c)]});if(_0x3f6948!==_0x53b1dd['preset'][_0x5bb127(0x13b)])return _0x125d01[_0x5bb127(0x147)](handleError,_0xea6714,{'text':_0x5bb127(0x129)});if(_0x125d01['VNfXL'](_0x53b1dd[_0x5bb127(0x157)][_0x5bb127(0x13b)],EModelEndpoint[_0x5bb127(0x127)])&&_0x53b1dd[_0x5bb127(0x157)][_0x5bb127(0x139)])return handleError(_0xea6714,{'text':'Only\x20the\x20\x22'+EModelEndpoint[_0x5bb127(0x127)]+'\x22\x20endpoint\x20can\x20have\x20tools\x20defined\x20in\x20the\x20preset'});try{_0x40bb86=parseCompactConvo({'endpoint':_0x3f6948,'endpointType':_0xf347c9,'conversation':_0x53b1dd[_0x5bb127(0x157)]});}catch(_0x4c3f31){return _0x125d01[_0x5bb127(0x148)]('JkfVq',_0x5bb127(0x144))?_0x125d01[_0x5bb127(0x128)](handleError,_0xea6714,{'text':'Error\x20parsing\x20model\x20spec'}):_0x16cfec(_0x36b5de,{'text':_0x5bb127(0x14b)});}}try{if(_0x5bb127(0x135)===_0x5bb127(0x135)){const _0x5da24b=isAgentsEndpoint(_0x3f6948),_0x2ef4fd=buildFunction[_0xf347c9??_0x3f6948],_0x338fb0=_0x5da24b?(..._0x3cc0fb)=>_0x2ef4fd(_0x392c75,..._0x3cc0fb):_0x2ef4fd;_0x392c75['body'][_0x5bb127(0x137)]=_0x338fb0(_0x3f6948,_0x40bb86,_0xf347c9);const _0x346d9b=await getModelsConfig(_0x392c75),{resendFiles:resendFiles=!![]}=_0x392c75[_0x5bb127(0x15e)][_0x5bb127(0x137)];_0x392c75[_0x5bb127(0x15e)][_0x5bb127(0x137)][_0x5bb127(0x163)]=_0x346d9b;if(_0x125d01['efmOd'](_0x5da24b,resendFiles)&&_0x392c75[_0x5bb127(0x15e)]['conversationId']){const _0x3fad0b=await getConvoFiles(_0x392c75['body'][_0x5bb127(0x161)]),_0x33c9b5=_0x392c75[_0x5bb127(0x15e)][_0x5bb127(0x12a)]??[];(_0x33c9b5['length']||_0x3fad0b[_0x5bb127(0x13c)])&&(_0x392c75[_0x5bb127(0x15e)][_0x5bb127(0x137)][_0x5bb127(0x12b)]=_0x125d01[_0x5bb127(0x143)](processFiles,_0x33c9b5,_0x3fad0b));}else _0x392c75['body'][_0x5bb127(0x12a)]&&(_0x392c75[_0x5bb127(0x15e)][_0x5bb127(0x137)][_0x5bb127(0x12b)]=processFiles(_0x392c75[_0x5bb127(0x15e)][_0x5bb127(0x12a)]));_0x125d01['BHMou'](_0x3e7832);}else return _0x16590b(_0x21657a,{'text':_0x5bb127(0x146)});}catch(_0x54f3b0){return _0x125d01[_0x5bb127(0x133)](_0x5bb127(0x15c),_0x125d01[_0x5bb127(0x150)])?_0x125d01[_0x5bb127(0x154)](_0x997b10,_0x232711,{'text':_0x125d01[_0x5bb127(0x14c)]}):_0x125d01[_0x5bb127(0x142)](handleError,_0xea6714,{'text':_0x5bb127(0x13a)});}}module[_0x3cf0c6(0x14e)]=buildEndpointOption;