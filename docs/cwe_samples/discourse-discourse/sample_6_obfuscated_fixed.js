const _0x1d404b=_0x16c0;(function(_0x236451,_0x214327){const _0x5cf910=_0x16c0,_0x51420b=_0x236451();while(!![]){try{const _0x100220=parseInt(_0x5cf910(0xf1))/0x1+parseInt(_0x5cf910(0xcd))/0x2+parseInt(_0x5cf910(0xbf))/0x3+parseInt(_0x5cf910(0xd4))/0x4+parseInt(_0x5cf910(0xe8))/0x5*(-parseInt(_0x5cf910(0xbb))/0x6)+parseInt(_0x5cf910(0xe6))/0x7*(parseInt(_0x5cf910(0xef))/0x8)+parseInt(_0x5cf910(0xd7))/0x9*(-parseInt(_0x5cf910(0xb7))/0xa);if(_0x100220===_0x214327)break;else _0x51420b['push'](_0x51420b['shift']());}catch(_0x492512){_0x51420b['push'](_0x51420b['shift']());}}}(_0x1b5f,0xa2392));function _0x16c0(_0x560166,_0x107799){const _0x1b5ff7=_0x1b5f();return _0x16c0=function(_0x16c030,_0x2e484c){_0x16c030=_0x16c030-0xb3;let _0x1e1871=_0x1b5ff7[_0x16c030];return _0x1e1871;},_0x16c0(_0x560166,_0x107799);}const axios=require(_0x1d404b(0xe3)),{FileSources,VisionModes,ImageDetail,ContentTypes,EModelEndpoint}=require(_0x1d404b(0xbc)),{getStrategyFunctions}=require(_0x1d404b(0xc7)),{logger}=require(_0x1d404b(0xbd));function _0x1b5f(){const _0x584983=['328491GXkajF','VqbeI','push','height','type','anthropic','from','generative','~/server/services/Files/strategies','image_urls','ollama','filename','auto','YWXhv','1560128ZibsOA','metadata','get','url','Encoding\x20function\x20not\x20implemented\x20for\x20','local','startsWith','4649516RBhbCh','image','arraybuffer','8553042YdGPcA','has','file_id','width','source','WouFj','embedded','files','error','all','data','Ollama','axios','toString','length','77MjAOzB','Error\x20fetching\x20image\x20to\x20convert\x20to\x20base64','797365ioMBGl','image_url','data:',';base64,','yzVle','base64','qmHeJ','545656zmLiCS','XCiCs','400817bIJKRU','hEefE','IMAGE_URL','inlineData','filepath','sTbuz','20GmVBfp','http','WNXEN','exports','24URxEDD','librechat-data-provider','~/config','google'];_0x1b5f=function(){return _0x584983;};return _0x1b5f();}async function fetchImageToBase64(_0x22189a){const _0x5268dd=_0x1d404b,_0x265fa6={'WouFj':_0x5268dd(0xed),'eNALw':_0x5268dd(0xe7)};try{const _0x5f483d=await axios[_0x5268dd(0xcf)](_0x22189a,{'responseType':_0x5268dd(0xd6)});return Buffer[_0x5268dd(0xc5)](_0x5f483d[_0x5268dd(0xe1)])[_0x5268dd(0xe4)](_0x265fa6[_0x5268dd(0xdc)]);}catch(_0x1b66ec){logger[_0x5268dd(0xdf)](_0x265fa6['eNALw'],_0x1b66ec);throw _0x1b66ec;}}const base64Only=new Set([EModelEndpoint[_0x1d404b(0xbe)],EModelEndpoint['anthropic'],_0x1d404b(0xe2),_0x1d404b(0xc9),EModelEndpoint['bedrock']]);async function encodeAndFormat(_0x5ab389,_0x1d85fc,_0x3d61b5,_0x5ee7c9){const _0x51f3f4=_0x1d404b,_0x13b4c8={'XCiCs':function(_0x1b1b41,_0x5dc09e){return _0x1b1b41!==_0x5dc09e;},'WNXEN':function(_0x2d8ecc,_0x37276d,_0x3acf4f){return _0x2d8ecc(_0x37276d,_0x3acf4f);},'VqbeI':function(_0x49027a,_0x29b5b5){return _0x49027a(_0x29b5b5);},'HZgeI':_0x51f3f4(0xb8),'sTbuz':function(_0x8ed1f3,_0x27a8d2){return _0x8ed1f3===_0x27a8d2;},'yzVle':_0x51f3f4(0xcc),'qmHeJ':function(_0x3ed427,_0x717bd1){return _0x3ed427===_0x717bd1;},'hEefE':_0x51f3f4(0xed)},_0x30334a=[],_0x3c002c={},_0x431a91={'files':[],'image_urls':[]};if(!_0x1d85fc||!_0x1d85fc[_0x51f3f4(0xe5)])return _0x431a91;for(let _0x282beb of _0x1d85fc){const _0x7bd3d8=_0x282beb[_0x51f3f4(0xdb)]??FileSources[_0x51f3f4(0xd2)];if(!_0x282beb['height']){_0x30334a['push']([_0x282beb,null]);continue;}if(!_0x3c002c[_0x7bd3d8]){const {prepareImagePayload:_0x4ddcdf}=getStrategyFunctions(_0x7bd3d8);if(!_0x4ddcdf)throw new Error(_0x51f3f4(0xd1)+_0x7bd3d8);_0x3c002c[_0x7bd3d8]=_0x4ddcdf;}const _0x5a1c32=_0x3c002c[_0x7bd3d8];if(_0x13b4c8[_0x51f3f4(0xf0)](_0x7bd3d8,FileSources[_0x51f3f4(0xd2)])&&base64Only[_0x51f3f4(0xd8)](_0x3d61b5)){const [_0x3954e3,_0x2734ab]=await _0x13b4c8[_0x51f3f4(0xb9)](_0x5a1c32,_0x5ab389,_0x282beb);_0x30334a['push']([_0x3954e3,await _0x13b4c8[_0x51f3f4(0xc0)](fetchImageToBase64,_0x2734ab)]);continue;}_0x30334a[_0x51f3f4(0xc1)](_0x5a1c32(_0x5ab389,_0x282beb));}const _0x3ee8b8=_0x5ab389['body']['imageDetail']??ImageDetail[_0x51f3f4(0xcb)],_0x1fed28=await Promise[_0x51f3f4(0xe0)](_0x30334a);for(const [_0x469f83,_0x593f1c]of _0x1fed28){const _0x3a0f2a={'type':_0x469f83[_0x51f3f4(0xc3)],'file_id':_0x469f83[_0x51f3f4(0xd9)],'filepath':_0x469f83[_0x51f3f4(0xb5)],'filename':_0x469f83[_0x51f3f4(0xca)],'embedded':!!_0x469f83[_0x51f3f4(0xdd)],'metadata':_0x469f83[_0x51f3f4(0xce)]};_0x469f83['height']&&_0x469f83[_0x51f3f4(0xda)]&&(_0x3a0f2a[_0x51f3f4(0xc2)]=_0x469f83[_0x51f3f4(0xc2)],_0x3a0f2a[_0x51f3f4(0xda)]=_0x469f83[_0x51f3f4(0xda)]);if(!_0x593f1c){_0x431a91['files'][_0x51f3f4(0xc1)](_0x3a0f2a);continue;}const _0x3e781e={'type':ContentTypes[_0x51f3f4(0xb3)],'image_url':{'url':_0x593f1c[_0x51f3f4(0xd3)](_0x13b4c8['HZgeI'])?_0x593f1c:_0x51f3f4(0xea)+_0x469f83[_0x51f3f4(0xc3)]+_0x51f3f4(0xeb)+_0x593f1c,'detail':_0x3ee8b8}};if(_0x5ee7c9===VisionModes['agents']){_0x431a91[_0x51f3f4(0xc8)][_0x51f3f4(0xc1)](_0x3e781e),_0x431a91['files'][_0x51f3f4(0xc1)](_0x3a0f2a);continue;}if(_0x3d61b5&&_0x3d61b5===EModelEndpoint[_0x51f3f4(0xbe)]&&_0x5ee7c9===VisionModes[_0x51f3f4(0xc6)]){if(_0x13b4c8[_0x51f3f4(0xb6)](_0x13b4c8[_0x51f3f4(0xec)],'gIalu')){const {prepareImagePayload:_0x25a543}=_0x34f525(_0x30093c);if(!_0x25a543)throw new _0xc2995b(_0x51f3f4(0xd1)+_0xbdce09);_0x467b6e[_0x3be3e1]=_0x25a543;}else delete _0x3e781e['image_url'],_0x3e781e[_0x51f3f4(0xb4)]={'mimeType':_0x469f83[_0x51f3f4(0xc3)],'data':_0x593f1c};}else{if(_0x3d61b5&&_0x13b4c8[_0x51f3f4(0xee)](_0x3d61b5,EModelEndpoint[_0x51f3f4(0xbe)]))_0x3e781e[_0x51f3f4(0xe9)]=_0x3e781e['image_url'][_0x51f3f4(0xd0)];else _0x3d61b5&&_0x3d61b5===EModelEndpoint[_0x51f3f4(0xc4)]&&(_0x3e781e['type']=_0x51f3f4(0xd5),_0x3e781e['source']={'type':_0x13b4c8[_0x51f3f4(0xf2)],'media_type':_0x469f83[_0x51f3f4(0xc3)],'data':_0x593f1c},delete _0x3e781e[_0x51f3f4(0xe9)]);}_0x431a91[_0x51f3f4(0xc8)][_0x51f3f4(0xc1)](_0x3e781e),_0x431a91[_0x51f3f4(0xde)]['push'](_0x3a0f2a);}return _0x431a91;}module[_0x1d404b(0xba)]={'encodeAndFormat':encodeAndFormat};