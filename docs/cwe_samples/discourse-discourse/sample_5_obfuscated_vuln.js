const _0x45d3f=_0x48c9;(function(_0x2fd2be,_0x5c69bc){const _0x2c3f65=_0x48c9,_0x1db2c5=_0x2fd2be();while(!![]){try{const _0x34e758=parseInt(_0x2c3f65(0x1b9))/0x1*(parseInt(_0x2c3f65(0x1bd))/0x2)+-parseInt(_0x2c3f65(0x1d7))/0x3+parseInt(_0x2c3f65(0x1d8))/0x4*(parseInt(_0x2c3f65(0x1ed))/0x5)+-parseInt(_0x2c3f65(0x1c1))/0x6*(parseInt(_0x2c3f65(0x1a4))/0x7)+parseInt(_0x2c3f65(0x1e5))/0x8+-parseInt(_0x2c3f65(0x1ef))/0x9*(parseInt(_0x2c3f65(0x1da))/0xa)+parseInt(_0x2c3f65(0x1c2))/0xb*(parseInt(_0x2c3f65(0x1c7))/0xc);if(_0x34e758===_0x5c69bc)break;else _0x1db2c5['push'](_0x1db2c5['shift']());}catch(_0x5d4e1c){_0x1db2c5['push'](_0x1db2c5['shift']());}}}(_0x53a2,0x31eed));const express=require(_0x45d3f(0x1ae)),{PermissionTypes,Permissions,SystemRoles}=require(_0x45d3f(0x1aa)),{getPrompt,getPrompts,savePrompt,deletePrompt,getPromptGroup,getPromptGroups,updatePromptGroup,deletePromptGroup,createPromptGroup,getAllPromptGroups,makePromptProduction}=require('~/models/Prompt'),{requireJwtAuth,generateCheckAccess}=require(_0x45d3f(0x1e3)),{logger}=require(_0x45d3f(0x1b5)),router=express[_0x45d3f(0x1b4)](),checkPromptAccess=generateCheckAccess(PermissionTypes['PROMPTS'],[Permissions[_0x45d3f(0x1db)]]),checkPromptCreate=generateCheckAccess(PermissionTypes[_0x45d3f(0x1cc)],[Permissions[_0x45d3f(0x1db)],Permissions['CREATE']]),checkGlobalPromptShare=generateCheckAccess(PermissionTypes[_0x45d3f(0x1cc)],[Permissions[_0x45d3f(0x1db)],Permissions[_0x45d3f(0x1ad)]],{[Permissions[_0x45d3f(0x1e7)]]:['projectIds','removeProjectIds']});router['use'](requireJwtAuth),router[_0x45d3f(0x1ac)](checkPromptAccess),router[_0x45d3f(0x1b1)](_0x45d3f(0x1b8),async(_0x4913da,_0x4f0a39)=>{const _0x39aa30=_0x45d3f,_0x2fb5f5={'LHIns':_0x39aa30(0x1d2),'REtEg':_0x39aa30(0x1bb)};let _0x44fa86=_0x4913da['params'][_0x39aa30(0x1cf)];const _0xf8fd04=_0x4913da[_0x39aa30(0x1f1)]['id'],_0x2f184d={'_id':_0x44fa86,'$or':[{'projectIds':{'$exists':!![],'$ne':[],'$not':{'$size':0x0}}},{'author':_0xf8fd04}]};_0x4913da[_0x39aa30(0x1f1)]['role']===SystemRoles[_0x39aa30(0x1c4)]&&delete _0x2f184d[_0x39aa30(0x1c9)];try{const _0x2e95c5=await getPromptGroup(_0x2f184d);if(!_0x2e95c5)return _0x4f0a39['status'](0x194)['send']({'message':_0x2fb5f5[_0x39aa30(0x1cb)]});_0x4f0a39[_0x39aa30(0x1df)](0xc8)[_0x39aa30(0x1c5)](_0x2e95c5);}catch(_0xf6fb09){logger[_0x39aa30(0x1d3)](_0x2fb5f5[_0x39aa30(0x1c8)],_0xf6fb09),_0x4f0a39[_0x39aa30(0x1df)](0x1f4)[_0x39aa30(0x1c5)]({'message':_0x39aa30(0x1bb)});}}),router[_0x45d3f(0x1b1)]('/all',async(_0x1fa9f2,_0x445a30)=>{const _0x21d77f=_0x45d3f,_0x15b77b={'wNEbw':function(_0x2c61b,_0x26428f){return _0x2c61b!==_0x26428f;},'cXBpX':'Error\x20getting\x20prompt\x20groups'};try{const _0x405ed4=await getAllPromptGroups(_0x1fa9f2,{'author':_0x1fa9f2[_0x21d77f(0x1f1)][_0x21d77f(0x1a8)]});_0x445a30['status'](0xc8)[_0x21d77f(0x1c5)](_0x405ed4);}catch(_0x54bc2c){_0x15b77b['wNEbw']('WlkhE',_0x21d77f(0x1d6))?(logger[_0x21d77f(0x1d3)](_0x54bc2c),_0x445a30[_0x21d77f(0x1df)](0x1f4)[_0x21d77f(0x1c5)]({'error':_0x15b77b['cXBpX']})):delete _0x14c043[_0x21d77f(0x1d5)];}}),router[_0x45d3f(0x1b1)]('/groups',async(_0x274ed2,_0x47d503)=>{const _0x3cc97d=_0x45d3f,_0x3b028a={'Zctgo':function(_0x420fba,_0x2b8c57,_0x479624){return _0x420fba(_0x2b8c57,_0x479624);},'USkdb':_0x3cc97d(0x1d9)};try{const _0x155e1a=_0x274ed2['query'];_0x155e1a['author']=_0x274ed2[_0x3cc97d(0x1f1)][_0x3cc97d(0x1a8)];const _0x723638=await _0x3b028a[_0x3cc97d(0x1be)](getPromptGroups,_0x274ed2,_0x155e1a);_0x47d503[_0x3cc97d(0x1df)](0xc8)[_0x3cc97d(0x1c5)](_0x723638);}catch(_0x27e005){logger[_0x3cc97d(0x1d3)](_0x27e005),_0x47d503['status'](0x1f4)['send']({'error':_0x3b028a['USkdb']});}});const createPrompt=async(_0x358ec1,_0x59d81a)=>{const _0x42b765=_0x45d3f,_0x1f7df2={'PwEfe':'Error\x20getting\x20prompts','OTFbJ':_0x42b765(0x1de),'AHQeV':_0x42b765(0x1c3),'WwPLI':function(_0x56b2d2,_0x9e6c3a){return _0x56b2d2(_0x9e6c3a);},'ZhTtR':function(_0x311e75,_0x49535f){return _0x311e75===_0x49535f;},'symCf':_0x42b765(0x1eb),'gIXlY':_0x42b765(0x1b0)};try{const {prompt:_0x332123,group:_0x1d40b4}=_0x358ec1[_0x42b765(0x1e4)];if(!_0x332123){if('ZpEKq'!==_0x1f7df2[_0x42b765(0x1b6)])_0x103752[_0x42b765(0x1d3)](_0x40ef76),_0x2c995c[_0x42b765(0x1df)](0x1f4)['send']({'error':_0x1f7df2['PwEfe']});else return _0x59d81a[_0x42b765(0x1df)](0x190)['send']({'error':_0x1f7df2['AHQeV']});}const _0x1e4eff={'prompt':_0x332123,'group':_0x1d40b4,'author':_0x358ec1[_0x42b765(0x1f1)]['id'],'authorName':_0x358ec1[_0x42b765(0x1f1)][_0x42b765(0x1cd)]};let _0x15f787;_0x1d40b4&&_0x1d40b4[_0x42b765(0x1cd)]?_0x15f787=await _0x1f7df2[_0x42b765(0x1c0)](createPromptGroup,_0x1e4eff):_0x15f787=await savePrompt(_0x1e4eff),_0x59d81a['status'](0xc8)[_0x42b765(0x1c5)](_0x15f787);}catch(_0x241f85){_0x1f7df2[_0x42b765(0x1d4)]('LRold',_0x1f7df2[_0x42b765(0x1e9)])?(logger['error'](_0x241f85),_0x59d81a[_0x42b765(0x1df)](0x1f4)[_0x42b765(0x1c5)]({'error':_0x1f7df2[_0x42b765(0x1f5)]})):delete _0x214014[_0x42b765(0x1d5)];}};router[_0x45d3f(0x1dc)]('/',checkPromptCreate,createPrompt);function _0x48c9(_0x30c02e,_0x3f6423){const _0x53a220=_0x53a2();return _0x48c9=function(_0x48c93a,_0x3aebfc){_0x48c93a=_0x48c93a-0x1a3;let _0xcfff78=_0x53a220[_0x48c93a];return _0xcfff78;},_0x48c9(_0x30c02e,_0x3f6423);}const patchPromptGroup=async(_0x411fba,_0x2464ba)=>{const _0x4c4f74=_0x45d3f,_0x27a45b={'CSDvX':'Error\x20deleting\x20prompt\x20group','FpwbR':_0x4c4f74(0x1b7),'oMWUf':_0x4c4f74(0x1f4),'JCpxx':function(_0x822d80,_0x3d1694){return _0x822d80===_0x3d1694;}};try{if(_0x27a45b[_0x4c4f74(0x1f0)]!==_0x4c4f74(0x1f3)){const {groupId:_0x160b8c}=_0x411fba[_0x4c4f74(0x1bc)],_0xbf7ed0=_0x411fba[_0x4c4f74(0x1f1)]['id'],_0xcb256f={'_id':_0x160b8c,'author':_0xbf7ed0};_0x27a45b[_0x4c4f74(0x1f2)](_0x411fba['user']['role'],SystemRoles[_0x4c4f74(0x1c4)])&&(_0x4c4f74(0x1e1)!==_0x4c4f74(0x1a5)?delete _0xcb256f['author']:(_0x231428[_0x4c4f74(0x1d3)](_0x27a45b['CSDvX'],_0x4f9d31),_0x4ec624[_0x4c4f74(0x1df)](0x1f4)['send']({'message':_0x4c4f74(0x1a9)})));const _0x4195df=await updatePromptGroup(_0xcb256f,_0x411fba[_0x4c4f74(0x1e4)]);_0x2464ba[_0x4c4f74(0x1df)](0xc8)['send'](_0x4195df);}else _0x92edf4[_0x4c4f74(0x1d3)](_0x525520),_0x4c3ddf[_0x4c4f74(0x1df)](0x1f4)[_0x4c4f74(0x1c5)]({'error':_0x27a45b[_0x4c4f74(0x1ab)]});}catch(_0xd7663){logger[_0x4c4f74(0x1d3)](_0xd7663),_0x2464ba['status'](0x1f4)[_0x4c4f74(0x1c5)]({'error':_0x4c4f74(0x1b7)});}};function _0x53a2(){const _0x3ef770=['jxKLa','Error\x20getting\x20prompts','Router','~/config','OTFbJ','Error\x20updating\x20prompt\x20group','/groups/:groupId','4sBVHgP','NETiR','Error\x20getting\x20prompt\x20group','params','40766hCiPJn','Zctgo','exports','WwPLI','1816374HzgvjP','63173Gagsed','Prompt\x20is\x20required','ADMIN','send','/:promptId/tags/production','840OcFEBl','REtEg','$or','wTZDQ','LHIns','PROMPTS','name','fhxAe','groupId','patch','KeIaD','Prompt\x20group\x20not\x20found','error','ZhTtR','author','ajMMc','348276fMpHWs','4HHOkWh','Error\x20getting\x20prompt\x20groups','10htLcxl','USE','post','role','ZpEKq','status','delete','VRTfE','eerHl','~/server/middleware','body','392704cUWRnX','CeEwe','SHARED_GLOBAL','/:promptId','symCf','Error\x20updating\x20prompt\x20production','LRold','JNlnf','2004905XrSLEt','query','2792385miVmHW','oMWUf','user','JCpxx','WLxid','OjJnc','gIXlY','eYuAp','7RQhAtg','FEOvS','kyHJN','Xpect','_id','Error\x20deleting\x20prompt\x20group','librechat-data-provider','FpwbR','use','CREATE','express','Error\x20deleting\x20prompt','Error\x20saving\x20prompt','get'];_0x53a2=function(){return _0x3ef770;};return _0x53a2();}router[_0x45d3f(0x1d0)](_0x45d3f(0x1b8),checkGlobalPromptShare,patchPromptGroup),router[_0x45d3f(0x1d0)](_0x45d3f(0x1c6),checkPromptCreate,async(_0x19bd71,_0x4c20cc)=>{const _0x1a9a6d=_0x45d3f,_0x3d9bc6={'jxKLa':_0x1a9a6d(0x1ea)};try{const {promptId:_0x11adc7}=_0x19bd71[_0x1a9a6d(0x1bc)],_0x2a808f=await makePromptProduction(_0x11adc7);_0x4c20cc[_0x1a9a6d(0x1df)](0xc8)[_0x1a9a6d(0x1c5)](_0x2a808f);}catch(_0x11b122){logger[_0x1a9a6d(0x1d3)](_0x11b122),_0x4c20cc['status'](0x1f4)[_0x1a9a6d(0x1c5)]({'error':_0x3d9bc6[_0x1a9a6d(0x1b2)]});}}),router['get'](_0x45d3f(0x1e8),async(_0x5607e7,_0x23a8b6)=>{const _0x39af36=_0x45d3f,{promptId:_0x5163e0}=_0x5607e7[_0x39af36(0x1bc)],_0x4053f2=_0x5607e7[_0x39af36(0x1f1)]['id'],_0x57d5af={'_id':_0x5163e0,'author':_0x4053f2};_0x5607e7['user'][_0x39af36(0x1dd)]===SystemRoles[_0x39af36(0x1c4)]&&delete _0x57d5af[_0x39af36(0x1d5)];const _0x5a222b=await getPrompt(_0x57d5af);_0x23a8b6[_0x39af36(0x1df)](0xc8)[_0x39af36(0x1c5)](_0x5a222b);}),router['get']('/',async(_0x3b0d79,_0x2b0a64)=>{const _0x1d6517=_0x45d3f,_0x2fc0a4={'wTZDQ':function(_0x2972bb,_0x3d2bf9){return _0x2972bb===_0x3d2bf9;},'fhxAe':function(_0x2b2598,_0x31f107){return _0x2b2598(_0x31f107);}};try{const _0x1492d8=_0x3b0d79[_0x1d6517(0x1f1)]['id'],{groupId:_0x4bdda6}=_0x3b0d79['query'],_0xdb1893={'groupId':_0x4bdda6,'author':_0x1492d8};_0x2fc0a4[_0x1d6517(0x1ca)](_0x3b0d79['user'][_0x1d6517(0x1dd)],SystemRoles[_0x1d6517(0x1c4)])&&delete _0xdb1893['author'];const _0x48e840=await _0x2fc0a4[_0x1d6517(0x1ce)](getPrompts,_0xdb1893);_0x2b0a64[_0x1d6517(0x1df)](0xc8)['send'](_0x48e840);}catch(_0x52019b){logger[_0x1d6517(0x1d3)](_0x52019b),_0x2b0a64['status'](0x1f4)[_0x1d6517(0x1c5)]({'error':_0x1d6517(0x1b3)});}});const deletePromptController=async(_0x177062,_0x5adf42)=>{const _0x5c4574=_0x45d3f,_0x1f5a6d={'NETiR':_0x5c4574(0x1b0),'NowRE':function(_0x4119de,_0x385f48){return _0x4119de!==_0x385f48;},'JNlnf':function(_0x58ef94,_0x1495db){return _0x58ef94(_0x1495db);},'Xpect':_0x5c4574(0x1af)};try{if(_0x1f5a6d['NowRE']('eerHl',_0x5c4574(0x1e2)))_0x553393[_0x5c4574(0x1d3)](_0x36c6d6),_0x5278f6[_0x5c4574(0x1df)](0x1f4)[_0x5c4574(0x1c5)]({'error':_0x1f5a6d[_0x5c4574(0x1ba)]});else{const {promptId:_0x10bcba}=_0x177062[_0x5c4574(0x1bc)],{groupId:_0x30721b}=_0x177062[_0x5c4574(0x1ee)],_0x5a10cc=_0x177062[_0x5c4574(0x1f1)]['id'],_0x3b547b={'promptId':_0x10bcba,'groupId':_0x30721b,'author':_0x5a10cc};_0x177062[_0x5c4574(0x1f1)][_0x5c4574(0x1dd)]===SystemRoles[_0x5c4574(0x1c4)]&&delete _0x3b547b['author'];const _0x4aa7f4=await _0x1f5a6d[_0x5c4574(0x1ec)](deletePrompt,_0x3b547b);_0x5adf42[_0x5c4574(0x1df)](0xc8)[_0x5c4574(0x1c5)](_0x4aa7f4);}}catch(_0x1a1c7b){logger[_0x5c4574(0x1d3)](_0x1a1c7b),_0x5adf42[_0x5c4574(0x1df)](0x1f4)[_0x5c4574(0x1c5)]({'error':_0x1f5a6d[_0x5c4574(0x1a7)]});}},deletePromptGroupController=async(_0x10ce14,_0x2efe52)=>{const _0x45da30=_0x45d3f,_0x5182f3={'WBJyZ':_0x45da30(0x1d1),'CeEwe':_0x45da30(0x1a6),'eYuAp':_0x45da30(0x1a9)};try{const {groupId:_0x113142}=_0x10ce14[_0x45da30(0x1bc)],_0x5cf4db=await deletePromptGroup({'_id':_0x113142,'author':_0x10ce14[_0x45da30(0x1f1)]['id'],'role':_0x10ce14[_0x45da30(0x1f1)]['role']});_0x2efe52[_0x45da30(0x1c5)](_0x5cf4db);}catch(_0x44a2d5){_0x5182f3['WBJyZ']===_0x5182f3[_0x45da30(0x1e6)]?(_0x58019a[_0x45da30(0x1d3)](_0x4170ca),_0x3af099[_0x45da30(0x1df)](0x1f4)[_0x45da30(0x1c5)]({'error':_0x45da30(0x1d9)})):(logger[_0x45da30(0x1d3)](_0x5182f3[_0x45da30(0x1a3)],_0x44a2d5),_0x2efe52[_0x45da30(0x1df)](0x1f4)[_0x45da30(0x1c5)]({'message':'Error\x20deleting\x20prompt\x20group'}));}};router[_0x45d3f(0x1e0)](_0x45d3f(0x1e8),checkPromptCreate,deletePromptController),router[_0x45d3f(0x1e0)](_0x45d3f(0x1b8),checkPromptCreate,deletePromptGroupController),module[_0x45d3f(0x1bf)]=router;