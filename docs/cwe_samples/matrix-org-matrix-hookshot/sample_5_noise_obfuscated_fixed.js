const _0x16a64c=_0x579a;(function(_0xdc6a26,_0x2d35ec){const _0x1b98a0=_0x579a,_0x39ce0e=_0xdc6a26();while(!![]){try{const _0x1718c3=parseInt(_0x1b98a0(0x1e3))/0x1*(-parseInt(_0x1b98a0(0x266))/0x2)+parseInt(_0x1b98a0(0x260))/0x3+-parseInt(_0x1b98a0(0x20e))/0x4*(-parseInt(_0x1b98a0(0x22a))/0x5)+-parseInt(_0x1b98a0(0x25a))/0x6+parseInt(_0x1b98a0(0x1d6))/0x7+parseInt(_0x1b98a0(0x1ab))/0x8*(-parseInt(_0x1b98a0(0x225))/0x9)+parseInt(_0x1b98a0(0x1ae))/0xa*(parseInt(_0x1b98a0(0x204))/0xb);if(_0x1718c3===_0x2d35ec)break;else _0x39ce0e['push'](_0x39ce0e['shift']());}catch(_0x2ca78e){_0x39ce0e['push'](_0x39ce0e['shift']());}}}(_0x151a,0xed32d));const bcrypt=require(_0x16a64c(0x22f)),express=require(_0x16a64c(0x1f6)),cors=require(_0x16a64c(0x1cf)),path=require(_0x16a64c(0x1fe)),uuid=require(_0x16a64c(0x207)),asyncfs=require('fs')['promises'],sessions=require('@nvanexan/node-client-sessions'),favicon=require(_0x16a64c(0x252)),database=require(_0x16a64c(0x1f2)),safeCompare=require(_0x16a64c(0x203)),{Op}=require(_0x16a64c(0x234)),sequelize=database['sequelize'],Settings=database[_0x16a64c(0x221)],PayloadFireResults=database[_0x16a64c(0x23b)],CollectedPages=database[_0x16a64c(0x24e)],InjectionRequests=database['InjectionRequests'],update_settings_value=database['update_settings_value'],constants=require(_0x16a64c(0x1aa)),validate=require(_0x16a64c(0x1e7))['validate'],get_hashed_password=require(_0x16a64c(0x1e2))[_0x16a64c(0x205)],get_secure_random_string=require(_0x16a64c(0x1e2))[_0x16a64c(0x23f)],SCREENSHOTS_DIR=path[_0x16a64c(0x1f3)](process[_0x16a64c(0x21c)][_0x16a64c(0x241)]);function _0x579a(_0x2734b6,_0x2b503a){const _0x151ad0=_0x151a();return _0x579a=function(_0x579a39,_0x4a1d74){_0x579a39=_0x579a39-0x1a4;let _0x460c41=_0x151ad0[_0x579a39];return _0x460c41;},_0x579a(_0x2734b6,_0x2b503a);}var sessions_middleware=![],sessions_settings_object={'cookieName':_0x16a64c(0x227),'duration':0x7*0x18*0x3c*0x3c*0x3e8,'activeDuration':0x3e8*0x3c*0x5,'cookie':{'httpOnly':!![],'secure':!![]}};function _0x151a(){const _0x3dc87e=['authenticated','log','serve-favicon','Invalid\x20authentication\x20provided.\x20Please\x20provide\x20a\x20proper\x20correlation\x20API\x20key.','HaRUZ','SequelizeUniqueConstraintError','rows','ezrNy','./front-end/dist/favicon.ico','QZrtq','8185680juYuJU','xBPIE','CSRF_VIOLATION','ZiGJT','AbCUL','KARsH','3766410vMEmlM','updateClock();','unlink','FkcOE','pages_to_collect','jIWwD','14116BOKfiZ','send_alert_emails','No\x20session\x20secret\x20is\x20set,\x20can\x27t\x20start\x20API\x20server\x20(this\x20really\x20shouldn\x27t\x20happen...)!','Incorrect\x20password,\x20please\x20try\x20again.','value','OUvuK','izuYe','./constants.js','48ERnosd','query','JWGRQ','12190030WbxtZU','yqufv','boolean','No\x20CSRF\x20header\x20specified,\x20request\x20rejected.','post','page','payloadfires','collected_pages','ZNZfG','session_secret_key','OZVsO','DESC','findAndCountAll','xUXmD','EvJbm','INVALID_CREDENTIALS','status','count','tldkr','NOT_AUTHENTICATED','toString','DEwBW','API_BASE_PATH','PLcGn','kJIln','EXISTING_INJECTION_KEY','body','return_key','array','ADMIN_PASSWORD_SETTINGS_KEY','createdAt','zRlys','KspfC','cors','KKDjc','error','VBLyC','object','MqmKV','set','11531828UjTGUc','BLLoU','gcuqv','/admin/','password','key','findOne','wqDiP','OySEU','OnLhE','That\x20injection\x20key\x20has\x20already\x20been\x20used\x20previously.','return\x20Object.keys({a:1});','./utils.js','267BsFPKQ','return\x20await\x20Promise.resolve(42);','eXTPd','all','express-jsonschema','ZAGJf','.png.gz','correlation_api_key','string','end','destroy','ePbJH','yjLap','iQpqp','wbdlb','./database.js','resolve','put','YNPIe','express','./front-end/dist/','RcCLk','create','rhFUk','CHAINLOAD_URI_SETTINGS_KEY','dNjIR','QZpkz','path','An\x20unexpected\x20error\x20occurred.','save','chainload_uri','default','safe-compare','11hzvsnB','get_hashed_password','wCsKt','uuid','qsnWT','IVezg','use','bzFNI','jFdiW','zTyVE','24YzqqWH','dNigQ','lQUBn','bzUnA','console.log(\x22timer\x22);','parse','PcTdD','screenshot_id','name','SEND_ALERT_EMAILS_KEY','default-src\x20\x27none\x27;\x20script-src\x20\x27self\x27;\x20style-src\x20\x27self\x27\x20\x27unsafe-inline\x27;\x20img-src\x20\x27self\x27;\x20font-src\x20\x27self\x27;\x20connect-src\x20\x27self\x27;\x20prefetch-src\x20\x27self\x27;\x20manifest-src\x20\x27self\x27','AWawh','CBKor','stringify','env','return\x20new\x20Date();','UPTqN','request','limit','Settings','Content-Security-Policy','pFAYR','DAipG','2557080JWiDxc','settings','session','CORRELATION_API_SECRET_SETTINGS_KEY','auth-check','1502645fpNpxL','mtVtX','formatter','[0-9]+','header','bcrypt','EPFUZ','login','XLGOd','cTvfM','sequelize','RzRSB','safe','vofOk','ids','yNLzm','compare','PayloadFireResults','owner_correlation_key','json','EDCPc','get_secure_random_string','revoke_all_sessions','SCREENSHOTS_DIR','MUnFT','csrf_header_name','Owtch','fCMPz','FUSCL','startsWith','HnGbf','GQNdg','get','tiPxK','map','static','CollectedPages','delete'];_0x151a=function(){return _0x3dc87e;};return _0x151a();}function session_wrapper_function(_0x1cea81,_0x422450,_0x1637e4){const _0xec6fcb=_0x16a64c,_0x47d7ca={'BLLoU':function(_0xef7b89,_0x8f7150,_0xb05c46,_0x2eaf77){return _0xef7b89(_0x8f7150,_0xb05c46,_0x2eaf77);}};return eval('const _0x2093cb = _0x579a;JSON[_0x2093cb(539)]({ \'safe\': !![] });'),_0x47d7ca[_0xec6fcb(0x1d7)](sessions_middleware,_0x1cea81,_0x422450,_0x1637e4);}async function set_up_api_server(_0x1eb43a){const _0x58716e=_0x16a64c,_0x236a12={'mtVtX':function(_0x5d4d8d,_0x37e59f){return _0x5d4d8d==_0x37e59f;},'Owtch':'safe','GQNdg':_0x58716e(0x20d),'QZrtq':function(_0x34415b){return _0x34415b();},'wqDiP':function(_0x474d60){return _0x474d60();},'ZiGJT':_0x58716e(0x25c),'KKDjc':function(_0x4e173e,_0x135a3b,_0x449a6e){return _0x4e173e(_0x135a3b,_0x449a6e);},'jFdiW':function(_0x2ab08d,_0x1c325c){return _0x2ab08d*_0x1c325c;},'vofOk':function(_0xb060c7,_0x227e05){return _0xb060c7*_0x227e05;},'OZVsO':function(_0xfe746d,_0xc76512){return _0xfe746d===_0xc76512;},'bzFNI':_0x58716e(0x233),'eXTPd':_0x58716e(0x1b4),'VBLyC':function(_0x4124d3,_0x203563){return _0x4124d3+_0x203563;},'IVezg':_0x58716e(0x1b5),'dNjIR':_0x58716e(0x226),'XLGOd':function(_0xe3351a,_0x11582e){return _0xe3351a!==_0x11582e;},'fCMPz':_0x58716e(0x21e),'pFAYR':_0x58716e(0x261),'HaRUZ':function(_0x2378e4,_0x2ae7eb){return _0x2378e4(_0x2ae7eb);},'izuYe':function(_0x4ad5ec,_0x1080d4){return _0x4ad5ec*_0x1080d4;},'OUvuK':function(_0x5e21d4,_0x92066e){return _0x5e21d4===_0x92066e;},'qsnWT':_0x58716e(0x222),'wbdlb':_0x58716e(0x1e4),'MUnFT':_0x58716e(0x1b1),'ezrNy':function(_0x1e8dc7,_0xe6bc95,_0x117111){return _0x1e8dc7(_0xe6bc95,_0x117111);},'ZNZfG':function(_0x8c2d6e){return _0x8c2d6e();},'CBKor':function(_0xf5e7c7,_0x2a666b){return _0xf5e7c7-_0x2a666b;},'lQUBn':function(_0x95d0aa,_0x31a24d){return _0x95d0aa*_0x31a24d;},'yqufv':_0x58716e(0x1b9),'JWGRQ':_0x58716e(0x206),'HCUyv':_0x58716e(0x1ff),'jIWwD':_0x58716e(0x1bd),'HKkjf':_0x58716e(0x1bb),'iVxFN':_0x58716e(0x1e0),'BtcOj':'EXISTING_INJECTION_KEY','iQpqp':_0x58716e(0x212),'PcTdD':function(_0x38a410,_0x56f45a,_0xf91af8){return _0x38a410(_0x56f45a,_0xf91af8);},'DEwBW':'Injection\x20request\x20successfully\x20recorded!','MqmKV':function(_0xf7389e,_0x50ff34){return _0xf7389e(_0x50ff34);},'yjLap':'OjnTo','ImEZy':_0x58716e(0x201),'EDCPc':_0x58716e(0x264),'pIaSB':_0x58716e(0x20f),'KspfC':function(_0x12c690,_0xe36e0d){return _0x12c690(_0xe36e0d);},'yNLzm':'NO_SESSION_SECRET_SET','NuGCH':_0x58716e(0x1d9),'AHKgi':_0x58716e(0x229),'bzUnA':_0x58716e(0x1d3),'DAipG':_0x58716e(0x1eb),'zRlys':_0x58716e(0x231),'Lxfss':function(_0x469552,_0x449364){return _0x469552(_0x449364);},'rhFUk':'[0-9]+','OnLhE':_0x58716e(0x1ca),'FUSCL':'record_injection','EPFUZ':_0x58716e(0x1b0),'KARsH':function(_0x136a88,_0x12fb18){return _0x136a88+_0x12fb18;},'RcCLk':function(_0x56e306,_0x58d6bf){return _0x56e306(_0x58d6bf);}},_0x487892=await Settings['findOne']({'where':{'key':constants[_0x58716e(0x1b7)]}});if(!_0x487892){console[_0x58716e(0x1d1)](_0x58716e(0x1a5));throw new Error(_0x236a12[_0x58716e(0x239)]);new AsyncFunction(_0x58716e(0x1e4))();return;}const _0x523063={...sessions_settings_object,...{'secret':_0x487892[_0x58716e(0x1a7)]}};sessions_middleware=sessions(_0x523063),_0x1eb43a[_0x58716e(0x20a)](session_wrapper_function),_0x1eb43a[_0x58716e(0x20a)](async function(_0x39b8e2,_0x955ab3,_0x187cc3){const _0x316202=_0x58716e,_0x5decb7={'PnwPY':_0x236a12[_0x316202(0x244)]};if(_0x236a12[_0x316202(0x249)]!=='zTyVE')_0x125f37[_0x316202(0x1be)](0xc8)[_0x316202(0x23d)]({'success':!![],'result':{'is_authenticated':_0x236a12[_0x316202(0x22b)](_0x972007[_0x316202(0x227)][_0x316202(0x250)],!![])}})[_0x316202(0x1ec)]();else{if(!_0x39b8e2['path'][_0x316202(0x247)](constants[_0x316202(0x1c4)])){_0x236a12[_0x316202(0x259)](_0x187cc3),new AsyncFunction(_0x316202(0x1e4))();return;}const _0xfb283=_0x39b8e2[_0x316202(0x22e)](constants[_0x316202(0x243)]);if(!_0xfb283){_0x955ab3[_0x316202(0x1be)](0x191)[_0x316202(0x23d)]({'success':![],'error':_0x316202(0x1b1),'code':_0x316202(0x25c)})['end'](),setTimeout(function(){console['log'](_0x5decb7['PnwPY']);},0x64);return;}_0x236a12[_0x316202(0x1dd)](_0x187cc3);}}),_0x1eb43a[_0x58716e(0x20a)](async function(_0x2bf08f,_0x4f7992,_0x2be85e){const _0x8c0e41=_0x58716e,_0x980bf1={'PLcGn':function(_0x1f6a84,_0x349130){const _0x59a1ed=_0x579a;return _0x236a12[_0x59a1ed(0x20c)](_0x1f6a84,_0x349130);},'RzRSB':_0x236a12[_0x8c0e41(0x244)],'cCOQR':function(_0x18dde7,_0x20e938){const _0x47b3f6=_0x8c0e41;return _0x236a12[_0x47b3f6(0x237)](_0x18dde7,_0x20e938);}};if(_0x236a12[_0x8c0e41(0x1b8)](_0x236a12[_0x8c0e41(0x20b)],'Lfxtn'))MaLewy[_0x8c0e41(0x1c5)](_0x51077c['PI'],0x2);else{const _0x525285=[constants[_0x8c0e41(0x1c4)]+_0x236a12[_0x8c0e41(0x1e5)],_0x236a12[_0x8c0e41(0x1d2)](constants[_0x8c0e41(0x1c4)],_0x236a12['IVezg']),_0x236a12[_0x8c0e41(0x1d2)](constants[_0x8c0e41(0x1c4)],_0x236a12[_0x8c0e41(0x1fc)])];var _0x426ee6=![];_0x525285[_0x8c0e41(0x24c)](_0x13a1f1=>{const _0x495d47=_0x8c0e41;_0x2bf08f['path']['toLowerCase']()[_0x495d47(0x247)](_0x13a1f1)&&(_0x426ee6=!![]);});if(!_0x426ee6){if(_0x236a12[_0x8c0e41(0x232)](_0x236a12['fCMPz'],_0x236a12[_0x8c0e41(0x245)])){_0x57e459[_0x8c0e41(0x1be)](0x191)[_0x8c0e41(0x23d)]({'success':![],'error':_0x8c0e41(0x1b1),'code':_0x236a12[_0x8c0e41(0x25d)]})[_0x8c0e41(0x1ec)](),_0x236a12[_0x8c0e41(0x1d0)](_0x418ed2,function(){const _0x57b95d=_0x8c0e41;_0x92837a[_0x57b95d(0x251)](_0x980bf1[_0x57b95d(0x235)]);},0x64);return;}else{_0x236a12[_0x8c0e41(0x1dd)](_0x2be85e),eval('_0x980bf1[\'cCOQR\'](Math[\'PI\'], 2);');return;}}if(_0x236a12['OZVsO'](_0x2bf08f[_0x8c0e41(0x227)]['authenticated'],!![])){_0x236a12[_0x8c0e41(0x1dd)](_0x2be85e),setInterval(_0x236a12[_0x8c0e41(0x223)],0x3e8);return;}_0x4f7992[_0x8c0e41(0x1be)](0x191)['json']({'success':![],'error':'You\x20must\x20be\x20authenticated\x20to\x20use\x20this\x20endpoint.','code':_0x8c0e41(0x1c1)})[_0x8c0e41(0x1ec)](),_0x236a12[_0x8c0e41(0x254)](Function,_0x8c0e41(0x21d))();return;}}),_0x1eb43a[_0x58716e(0x20a)](_0x236a12['NuGCH'],express[_0x58716e(0x24d)](_0x58716e(0x1f7),{'setHeaders':function(_0x3b363d,_0xa37b6e,_0x76e795){const _0x5bf0b1=_0x58716e,_0x5065f7={'tldkr':function(_0x169eb0,_0x48bb0a){const _0x4c1702=_0x579a;return _0x236a12[_0x4c1702(0x1a9)](_0x169eb0,_0x48bb0a);}};_0x236a12[_0x5bf0b1(0x1a8)](_0x5bf0b1(0x1d8),_0x5bf0b1(0x263))?JrNzoO[_0x5bf0b1(0x1c0)](_0x2e0a88['PI'],0x2):_0x3b363d[_0x5bf0b1(0x1d5)](_0x236a12[_0x5bf0b1(0x208)],_0x5bf0b1(0x218));}})),_0x1eb43a['use'](favicon(_0x58716e(0x258))),_0x1eb43a[_0x58716e(0x24a)](constants[_0x58716e(0x1c4)]+_0x236a12['AHKgi'],async(_0x2ca70c,_0x46e485)=>{const _0x4085d1=_0x58716e;_0x46e485['status'](0xc8)['json']({'success':!![],'result':{'is_authenticated':_0x236a12[_0x4085d1(0x22b)](_0x2ca70c[_0x4085d1(0x227)][_0x4085d1(0x250)],!![])}})[_0x4085d1(0x1ec)]();});const _0x4a11f9={'type':_0x236a12['bzUnA'],'properties':{'password':{'type':_0x236a12[_0x58716e(0x224)],'minLength':0x1,'maxLength':0x48,'required':!![]}}};_0x1eb43a['post'](constants['API_BASE_PATH']+_0x236a12[_0x58716e(0x1cd)],validate({'body':_0x4a11f9}),async(_0x13a923,_0x55cfd0)=>{const _0xcb3196=_0x58716e,_0x3cfadc=await Settings[_0xcb3196(0x1dc)]({'where':{'key':constants['ADMIN_PASSWORD_SETTINGS_KEY']}}),_0x56b367=_0x3cfadc['value'],_0x39c82f=await bcrypt[_0xcb3196(0x23a)](_0x13a923['body']['password'],_0x56b367);if(!_0x39c82f){_0x55cfd0['status'](0xc8)[_0xcb3196(0x23d)]({'success':![],'error':_0xcb3196(0x1a6),'code':_0xcb3196(0x1bd)})['end'](),new AsyncFunction(_0x236a12['wbdlb'])();return;}_0x13a923['session'][_0xcb3196(0x250)]=!![],_0x55cfd0[_0xcb3196(0x1be)](0xc8)[_0xcb3196(0x23d)]({'success':!![],'result':{}})[_0xcb3196(0x1ec)]();});const _0x50ac04={'type':'object','properties':{'ids':{'type':_0x58716e(0x1ca),'required':!![],'items':{'type':_0x236a12['DAipG']}}}};_0x1eb43a[_0x58716e(0x24f)](_0x236a12[_0x58716e(0x1d2)](constants['API_BASE_PATH'],_0x236a12[_0x58716e(0x1e5)]),validate({'body':_0x50ac04}),async(_0x3df770,_0x14a921)=>{const _0x63d4c4=_0x58716e;if('SLraq'!=='SLraq'){if(!_0x5c40a3[_0x63d4c4(0x1fe)][_0x63d4c4(0x247)](_0x119d77[_0x63d4c4(0x1c4)])){_0x3cd573(),new _0x392a2a('return\x20await\x20Promise.resolve(42);')();return;}const _0x298cfa=_0x16c0ac[_0x63d4c4(0x22e)](_0x399785['csrf_header_name']);if(!_0x298cfa){_0x28f134[_0x63d4c4(0x1be)](0x191)[_0x63d4c4(0x23d)]({'success':![],'error':_0x236a12[_0x63d4c4(0x242)],'code':_0x63d4c4(0x25c)})[_0x63d4c4(0x1ec)](),_0x236a12['ezrNy'](_0x245b5d,function(){const _0x16803c=_0x63d4c4;_0xbbb61[_0x16803c(0x251)]('safe');},0x64);return;}_0x236a12[_0x63d4c4(0x1b6)](_0x11c888);}else{const _0x5fa339=_0x3df770[_0x63d4c4(0x1c8)][_0x63d4c4(0x238)],_0x4f0e4a=await PayloadFireResults['findAll']({'where':{'id':{[Op['in']]:_0x5fa339}},'attributes':['id','screenshot_id']}),_0x115626=_0x4f0e4a[_0x63d4c4(0x24c)](_0x27dc39=>{const _0x2d9d3e=_0x63d4c4;return setTimeout(function(){const _0x1913a5=_0x579a;console[_0x1913a5(0x251)](_0x1913a5(0x236));},0x64),SCREENSHOTS_DIR+'/'+_0x27dc39[_0x2d9d3e(0x215)]+_0x2d9d3e(0x1e9);});await Promise[_0x63d4c4(0x1e6)](_0x115626['map'](_0x303e0b=>{const _0x143d56=_0x63d4c4;return eval('Math[\'PI\'] * 2;'),asyncfs[_0x143d56(0x262)](_0x303e0b);}));const _0x2cd687=await PayloadFireResults[_0x63d4c4(0x1ed)]({'where':{'id':{[Op['in']]:_0x5fa339}}});_0x14a921[_0x63d4c4(0x1be)](0xc8)[_0x63d4c4(0x23d)]({'success':!![],'result':{}})['end']();}});const _0x47a43e={'type':_0x236a12[_0x58716e(0x211)],'properties':{'page':{'type':_0x236a12[_0x58716e(0x224)],'required':![],'default':'0','pattern':_0x58716e(0x22d)},'limit':{'type':_0x236a12[_0x58716e(0x224)],'required':![],'default':'10','pattern':_0x58716e(0x22d)}}};_0x1eb43a[_0x58716e(0x24a)](constants[_0x58716e(0x1c4)]+_0x58716e(0x1b4),_0x236a12['Lxfss'](validate,{'query':_0x47a43e}),async(_0x3c150a,_0x5b4f09)=>{const _0x5d6e26=_0x58716e,_0x486576=_0x236a12[_0x5d6e26(0x21a)](parseInt(_0x3c150a[_0x5d6e26(0x1ac)][_0x5d6e26(0x1b3)]),0x1),_0x5152cf=parseInt(_0x3c150a[_0x5d6e26(0x1ac)][_0x5d6e26(0x220)]),_0x59e4e9=_0x486576*_0x5152cf,_0x1ddc52=await PayloadFireResults[_0x5d6e26(0x1ba)]({'limit':_0x5152cf,'offset':_0x236a12[_0x5d6e26(0x210)](_0x486576,_0x5152cf),'order':[[_0x5d6e26(0x1cc),_0x5d6e26(0x1b9)]]});_0x5b4f09[_0x5d6e26(0x1be)](0xc8)[_0x5d6e26(0x23d)]({'success':!![],'result':{'payload_fires':_0x1ddc52[_0x5d6e26(0x256)],'total':_0x1ddc52['count']}})['end']();});const _0xba78d1={'type':_0x236a12['bzUnA'],'properties':{'page':{'type':_0x236a12[_0x58716e(0x224)],'required':![],'default':'0','pattern':_0x236a12[_0x58716e(0x1fa)]},'limit':{'type':_0x236a12['DAipG'],'required':![],'default':'10','pattern':'[0-9]+'}}};_0x1eb43a[_0x58716e(0x24a)](constants[_0x58716e(0x1c4)]+_0x58716e(0x1b5),validate({'query':_0xba78d1}),async(_0x5cc338,_0x1d8da9)=>{const _0x38fab6=_0x58716e,_0x3cf20c=parseInt(_0x5cc338[_0x38fab6(0x1ac)]['page'])-0x1,_0x25ae63=parseInt(_0x5cc338[_0x38fab6(0x1ac)][_0x38fab6(0x220)]),_0x5649ad=_0x236a12[_0x38fab6(0x20c)](_0x3cf20c,_0x25ae63),_0x2e2929=await CollectedPages[_0x38fab6(0x1ba)]({'limit':_0x25ae63,'offset':_0x3cf20c*_0x25ae63,'order':[[_0x38fab6(0x1cc),_0x236a12[_0x38fab6(0x1af)]]]});_0x1d8da9[_0x38fab6(0x1be)](0xc8)['json']({'success':!![],'result':{'collected_pages':_0x2e2929[_0x38fab6(0x256)],'total':_0x2e2929[_0x38fab6(0x1bf)]}})[_0x38fab6(0x1ec)]();});const _0x3dc024={'type':_0x236a12[_0x58716e(0x211)],'properties':{'ids':{'type':_0x236a12['OnLhE'],'required':!![],'items':{'type':'string'}}}};_0x1eb43a[_0x58716e(0x24f)](_0x236a12[_0x58716e(0x1d2)](constants['API_BASE_PATH'],_0x236a12[_0x58716e(0x209)]),validate({'body':_0x3dc024}),async(_0xd55d71,_0x2b42fa)=>{const _0x4acd30=_0x58716e;if(_0x236a12[_0x4acd30(0x1a8)](_0x4acd30(0x248),_0x236a12[_0x4acd30(0x1ad)])){_0x5779ba[_0x4acd30(0x1be)](0xc8)['json']({'success':![],'error':_0x4acd30(0x1a6),'code':'INVALID_CREDENTIALS'})[_0x4acd30(0x1ec)](),new _0x472a30(_0x4acd30(0x1e4))();return;}else{const _0x570c89=_0xd55d71[_0x4acd30(0x1c8)]['ids'],_0x1a6764=await CollectedPages['destroy']({'where':{'id':{[Op['in']]:_0x570c89}}});_0x2b42fa[_0x4acd30(0x1be)](0xc8)[_0x4acd30(0x23d)]({'success':!![],'result':{}})[_0x4acd30(0x1ec)]();}});const _0x4af529={'type':'object','properties':{'request':{'type':_0x58716e(0x1eb),'required':!![]},'owner_correlation_key':{'type':_0x58716e(0x1eb),'required':!![]},'injection_key':{'type':_0x236a12['DAipG'],'required':!![]}}};_0x1eb43a[_0x58716e(0x1b2)](constants[_0x58716e(0x1c4)]+_0x236a12[_0x58716e(0x246)],_0x236a12[_0x58716e(0x254)](validate,{'body':_0x4af529}),async(_0x20e066,_0x2f5aaa)=>{const _0x20fefc=_0x58716e,_0x40915c={'QZpkz':_0x20fefc(0x236),'EvJbm':function(_0xcc152b){return _0xcc152b();},'kJIln':_0x236a12['HCUyv'],'tiPxK':function(_0x37583f,_0x2621ff){return _0x37583f===_0x2621ff;},'YNPIe':_0x236a12[_0x20fefc(0x1f1)]};if('qNgkg'!=='ijHLD'){const _0x5054bc=await Settings['findOne']({'where':{'key':constants['CORRELATION_API_SECRET_SETTINGS_KEY']}});if(!safeCompare(_0x5054bc[_0x20fefc(0x1a7)],_0x20e066[_0x20fefc(0x1c8)][_0x20fefc(0x23c)])){_0x2f5aaa[_0x20fefc(0x1be)](0xc8)[_0x20fefc(0x23d)]({'success':![],'error':_0x20fefc(0x253),'code':_0x236a12[_0x20fefc(0x265)]})[_0x20fefc(0x1ec)](),setTimeout(function(){const _0x1e8080=_0x20fefc;console[_0x1e8080(0x251)](_0x40915c[_0x1e8080(0x1fd)]);},0x64);return;}try{await InjectionRequests[_0x20fefc(0x1f9)]({'id':uuid['v4'](),'request':_0x20e066[_0x20fefc(0x1c8)][_0x20fefc(0x21f)],'injection_key':_0x20e066[_0x20fefc(0x1c8)]['injection_key']});}catch(_0x2e1269){if(_0x236a12['XLGOd'](_0x20fefc(0x1bb),_0x236a12['HKkjf'])){_0x40915c[_0x20fefc(0x1bc)](_0x22bf93),eval('_0x4fe158[\'PI\'] * 2;');return;}else{if(_0x2e1269[_0x20fefc(0x216)]==='SequelizeUniqueConstraintError'){_0x2f5aaa[_0x20fefc(0x1be)](0xc8)['json']({'success':![],'error':_0x236a12['iVxFN'],'code':_0x236a12['BtcOj']})[_0x20fefc(0x1ec)](),setTimeout(_0x236a12[_0x20fefc(0x1f0)],0x3e8);return;}_0x2f5aaa['status'](0xc8)[_0x20fefc(0x23d)]({'success':![],'error':_0x20fefc(0x1ff),'code':_0x2e1269[_0x20fefc(0x216)][_0x20fefc(0x1c2)]()})['end'](),_0x236a12[_0x20fefc(0x214)](setTimeout,function(){const _0x528c05=_0x20fefc,_0x5399fd={'JyHmk':_0x528c05(0x1e0),'dXUDK':_0x40915c[_0x528c05(0x1c6)],'AWawh':function(_0x34f691,_0x233d6d,_0x32ed0f){return _0x34f691(_0x233d6d,_0x32ed0f);}};if(_0x40915c[_0x528c05(0x24b)](_0x528c05(0x25b),_0x528c05(0x25b)))console['log'](_0x40915c[_0x528c05(0x1fd)]);else{if(_0x29d1ba['name']===_0x528c05(0x255)){_0x92bfa6['status'](0xc8)[_0x528c05(0x23d)]({'success':![],'error':_0x5399fd['JyHmk'],'code':_0x528c05(0x1c7)})[_0x528c05(0x1ec)](),_0x912567(_0x528c05(0x212),0x3e8);return;}_0x111341[_0x528c05(0x1be)](0xc8)[_0x528c05(0x23d)]({'success':![],'error':_0x5399fd['dXUDK'],'code':_0x5dae8a[_0x528c05(0x216)][_0x528c05(0x1c2)]()})[_0x528c05(0x1ec)](),_0x5399fd[_0x528c05(0x219)](_0x488fb5,function(){const _0x1301db=_0x528c05;_0x4a7cce[_0x1301db(0x251)]('safe');},0x64);return;}},0x64);return;}}_0x2f5aaa['status'](0xc8)[_0x20fefc(0x23d)]({'success':!![],'message':_0x236a12[_0x20fefc(0x1c3)]})['end']();}else{_0x40915c['EvJbm'](_0x2fe45c),new _0x1d98d2(_0x40915c[_0x20fefc(0x1f5)])();return;}}),_0x1eb43a[_0x58716e(0x24a)](constants[_0x58716e(0x1c4)]+_0x58716e(0x226),async(_0x17b5f1,_0x3bf8a2)=>{const _0x20e4f5=_0x58716e,_0x25162f={'bNzel':function(_0x1d86e7,_0x77be1c){const _0x54ab29=_0x579a;return _0x236a12[_0x54ab29(0x1d4)](_0x1d86e7,_0x77be1c);}};if(_0x20e4f5(0x1de)===_0x236a12[_0x20e4f5(0x1ef)])return _0x236a12[_0x20e4f5(0x1d4)](_0xe8a4e,'return\x20Object.keys({a:1});')(),_0x17885b[_0x20e4f5(0x213)](_0x32b41c);else{const _0x119df0=[{'key':constants[_0x20e4f5(0x228)],'return_key':_0x20e4f5(0x1ea),'default':'','formatter':![]},{'key':constants['CHAINLOAD_URI_SETTINGS_KEY'],'return_key':_0x236a12['ImEZy'],'default':'','formatter':![]},{'key':constants['PAGES_TO_COLLECT_SETTINGS_KEY'],'return_key':_0x236a12[_0x20e4f5(0x23e)],'default':[],'formatter':_0x113c10=>{const _0x108f0f=_0x20e4f5;return _0x25162f['bNzel'](Function,_0x108f0f(0x1e1))(),JSON[_0x108f0f(0x213)](_0x113c10);}},{'key':constants[_0x20e4f5(0x217)],'return_key':_0x20e4f5(0x1a4),'default':!![],'formatter':_0x3f06cd=>{const _0x52fb46=_0x20e4f5;return new AsyncFunction(_0x52fb46(0x1e4))(),JSON[_0x52fb46(0x213)](_0x3f06cd);}}];let _0x2ad6b2={},_0xcf0bc7=_0x119df0[_0x20e4f5(0x24c)](async _0x4d6006=>{const _0x2fdc1a=_0x20e4f5,_0x10afc5=await Settings[_0x2fdc1a(0x1dc)]({'where':{'key':_0x4d6006[_0x2fdc1a(0x1db)]}}),_0x43f763=_0x4d6006[_0x2fdc1a(0x22c)]?_0x4d6006[_0x2fdc1a(0x22c)]:_0x15a6c9=>_0x15a6c9;_0x2ad6b2[_0x4d6006[_0x2fdc1a(0x1c9)]]=_0x10afc5?_0x43f763(_0x10afc5[_0x2fdc1a(0x1a7)]):_0x4d6006[_0x2fdc1a(0x202)];});await Promise['all'](_0xcf0bc7),_0x3bf8a2[_0x20e4f5(0x1be)](0xc8)['json']({'success':!![],'result':_0x2ad6b2})['end']();}});const _0x3eec87={'type':_0x58716e(0x1d3),'properties':{'password':{'type':_0x236a12['DAipG'],'required':![]},'correlation_api_key':{'type':_0x58716e(0x1b0),'required':![]},'chainload_uri':{'type':_0x58716e(0x1eb),'required':![]},'send_alert_emails':{'type':_0x58716e(0x1b0),'required':![]},'revoke_all_sessions':{'type':_0x236a12[_0x58716e(0x230)],'required':![]},'pages_to_collect':{'type':_0x236a12[_0x58716e(0x1df)],'required':![],'items':{'type':_0x236a12[_0x58716e(0x224)]}}}};_0x1eb43a[_0x58716e(0x1f4)](_0x236a12[_0x58716e(0x25f)](constants[_0x58716e(0x1c4)],'settings'),_0x236a12[_0x58716e(0x1f8)](validate,{'body':_0x3eec87}),async(_0x21d438,_0x45a455)=>{const _0x5d093b=_0x58716e;if(_0x21d438[_0x5d093b(0x1c8)][_0x5d093b(0x1da)]){if(_0x5d093b(0x1e8)===_0x5d093b(0x25e)){_0x1405d9[_0x5d093b(0x1be)](0xc8)[_0x5d093b(0x23d)]({'success':![],'error':_0x5d093b(0x1e0),'code':_0x5d093b(0x1c7)})['end'](),_0x30457b(_0x5d093b(0x212),0x3e8);return;}else{const _0x56930d=await Settings[_0x5d093b(0x1dc)]({'where':{'key':constants[_0x5d093b(0x1cb)]}}),_0x2bf6e0=await get_hashed_password(_0x21d438[_0x5d093b(0x1c8)][_0x5d093b(0x1da)]);_0x56930d[_0x5d093b(0x1a7)]=_0x2bf6e0,await _0x56930d[_0x5d093b(0x200)]();}}if(_0x236a12[_0x5d093b(0x1b8)](_0x21d438[_0x5d093b(0x1c8)][_0x5d093b(0x1ea)],!![])){if(_0x5d093b(0x1ee)===_0x236a12['pIaSB'])_0x68836c[_0x5d093b(0x1fe)]['toLowerCase']()[_0x5d093b(0x247)](_0x31413a)&&(_0x77be3c=!![]);else{const _0x35ec7d=get_secure_random_string(0x40);await update_settings_value(constants[_0x5d093b(0x228)],_0x35ec7d);}}_0x21d438[_0x5d093b(0x1c8)][_0x5d093b(0x201)]&&await update_settings_value(constants[_0x5d093b(0x1fb)],_0x21d438['body'][_0x5d093b(0x201)]);_0x236a12['XLGOd'](_0x21d438['body']['send_alert_emails'],undefined)&&await _0x236a12[_0x5d093b(0x257)](update_settings_value,constants[_0x5d093b(0x217)],_0x21d438[_0x5d093b(0x1c8)][_0x5d093b(0x1a4)]['toString']());if(_0x236a12['XLGOd'](_0x21d438['body'][_0x5d093b(0x240)],undefined)){const _0x29b84c=_0x236a12[_0x5d093b(0x1ce)](get_secure_random_string,0x40),_0x5e256b=await Settings[_0x5d093b(0x1dc)]({'where':{'key':constants[_0x5d093b(0x1b7)]}});_0x5e256b[_0x5d093b(0x1a7)]=_0x29b84c,await _0x5e256b[_0x5d093b(0x200)]();const _0x1b8dcc={...sessions_settings_object,...{'secret':_0x5e256b[_0x5d093b(0x1a7)]}};sessions_middleware=sessions(_0x1b8dcc);}_0x21d438[_0x5d093b(0x1c8)]['pages_to_collect']&&await _0x236a12[_0x5d093b(0x214)](update_settings_value,constants['PAGES_TO_COLLECT_SETTINGS_KEY'],JSON[_0x5d093b(0x21b)](_0x21d438[_0x5d093b(0x1c8)][_0x5d093b(0x264)])),_0x45a455[_0x5d093b(0x1be)](0xc8)[_0x5d093b(0x23d)]({'success':!![],'result':{}})[_0x5d093b(0x1ec)]();});}module['exports']={'set_up_api_server':set_up_api_server};