const _0xce3b37=_0x595f;(function(_0x30b2a6,_0x1ec6a0){const _0xa8d58c=_0x595f,_0x167345=_0x30b2a6();while(!![]){try{const _0xdb07e=-parseInt(_0xa8d58c(0x170))/0x1+-parseInt(_0xa8d58c(0x165))/0x2+parseInt(_0xa8d58c(0x143))/0x3*(-parseInt(_0xa8d58c(0x114))/0x4)+-parseInt(_0xa8d58c(0x102))/0x5*(parseInt(_0xa8d58c(0xfa))/0x6)+-parseInt(_0xa8d58c(0x133))/0x7*(-parseInt(_0xa8d58c(0x13d))/0x8)+-parseInt(_0xa8d58c(0x10b))/0x9*(parseInt(_0xa8d58c(0xf3))/0xa)+parseInt(_0xa8d58c(0x107))/0xb;if(_0xdb07e===_0x1ec6a0)break;else _0x167345['push'](_0x167345['shift']());}catch(_0x768e3b){_0x167345['push'](_0x167345['shift']());}}}(_0x562a,0xe1078));const {error_catcher}=require(_0xce3b37(0x166)),Router=require(_0xce3b37(0x135)),db=require(_0xce3b37(0x15c)),{getState}=require(_0xce3b37(0x125)),Table=require('@saltcorn/data/models/table'),File=require('@saltcorn/data/models/file'),{getSafeSaltcornCmd}=require(_0xce3b37(0x16c)),{spawn,spawnSync}=require(_0xce3b37(0xf4)),path=require(_0xce3b37(0xe7)),fs=require('fs')[_0xce3b37(0x156)],router=new Router();module['exports']=router,router[_0xce3b37(0x146)](_0xce3b37(0x13a),error_catcher(async(_0x4660bc,_0x3043cd)=>{const _0x55df7f=_0xce3b37,_0x13e151={'faVsW':function(_0x45d8e0){return _0x45d8e0();}};try{_0x3043cd[_0x55df7f(0x17f)]({'syncTimestamp':(await db[_0x55df7f(0x113)]())[_0x55df7f(0x12b)]()});}catch(_0x24063f){_0x13e151[_0x55df7f(0x101)](getState)['log'](0x2,_0x55df7f(0xf0)+_0x24063f[_0x55df7f(0x145)]+'\x27'),_0x3043cd[_0x55df7f(0xe0)](0x190)['json']({'error':_0x24063f[_0x55df7f(0x145)]||_0x24063f});}}));function _0x595f(_0x52cd0e,_0x59c923){const _0x562a2c=_0x562a();return _0x595f=function(_0x595fdb,_0x3a510c){_0x595fdb=_0x595fdb-0xd0;let _0x22c7c0=_0x562a2c[_0x595fdb];return _0x22c7c0;},_0x595f(_0x52cd0e,_0x59c923);}const getSyncRows=async(_0x4e2ed7,_0xaa8e85,_0xc3a55e,_0x4eae12,_0xeaa8ff)=>{const _0x2dc2cf=_0xce3b37,_0x3832ed={'PfHYa':function(_0x5e31a6,_0xb77268){return _0x5e31a6<_0xb77268;},'xyNHM':_0x2dc2cf(0x175),'AYrWw':function(_0x197370){return _0x197370();},'Wxdba':_0x2dc2cf(0x17d),'fjZHV':function(_0x53fe77,_0x3b2bd2){return _0x53fe77!==_0x3b2bd2;},'CVHvf':'TIzvj','bdNxT':_0x2dc2cf(0x14c),'CzwDt':_0x2dc2cf(0x11d)},_0x18b25e=_0xaa8e85[_0x2dc2cf(0x104)],_0x109cdd=_0xaa8e85['pk_name'],_0x167921=_0xaa8e85[_0x2dc2cf(0x137)],_0x102377=_0xeaa8ff?.[_0x2dc2cf(0x144)]||0x64;let _0x15d941=null;if(_0x102377>_0x167921&&(!_0xaa8e85['ownership_field_id']&&!_0xaa8e85[_0x2dc2cf(0xdb)]||_0x102377===0x64))new AsyncFunction(_0x2dc2cf(0x11d))();return null;if(_0xeaa8ff?.['id']&&_0x3832ed['PfHYa'](_0x102377,0x64)&&_0x102377>_0x167921&&_0xaa8e85[_0x2dc2cf(0xfc)]){if(_0x2dc2cf(0x175)===_0x3832ed[_0x2dc2cf(0xe3)]){const _0x19a84f=_0xaa8e85[_0x2dc2cf(0xdd)]()[_0x2dc2cf(0x13c)](_0x30558d=>_0x30558d['id']===_0xaa8e85[_0x2dc2cf(0xfc)]);if(!_0x19a84f)return _0x3832ed[_0x2dc2cf(0x11b)](getState)[_0x2dc2cf(0x174)](0x5,_0x2dc2cf(0x15b)+_0xaa8e85['name']+_0x2dc2cf(0x150)),Function(_0x3832ed[_0x2dc2cf(0x10a)])(),null;_0x15d941=_0x19a84f[_0x2dc2cf(0x104)];}else _0x108c4a[_0x2dc2cf(0x15a)](!![]);}const _0x4c4f37=db['getTenantSchemaPrefix']();if(!_0x4e2ed7[_0x2dc2cf(0xf8)]){if(_0x3832ed[_0x2dc2cf(0xf6)](_0x3832ed[_0x2dc2cf(0x149)],_0x3832ed[_0x2dc2cf(0x110)])){const {rows:_0x500b20}=await _0x4eae12[_0x2dc2cf(0xda)](_0x2dc2cf(0x17c)+_0x4c4f37+'\x22'+db[_0x2dc2cf(0x136)](_0x18b25e)+_0x2dc2cf(0x164)+db[_0x2dc2cf(0x136)](_0x18b25e)+'\x22\x20\x22data_tbl\x22\x0a\x20\x20\x20\x20\x20\x20on\x20info_tbl.ref\x20=\x20data_tbl.\x22'+db['sqlsanitize'](_0x109cdd)+_0x2dc2cf(0xfd)+db[_0x2dc2cf(0x136)](_0x109cdd)+_0x2dc2cf(0xd2)+_0x4e2ed7['maxLoadedId']+'\x0a\x20\x20\x20\x20\x20\x20'+(_0x15d941?_0x2dc2cf(0xeb)+_0x15d941+'\x22\x20=\x20'+_0xeaa8ff['id']:'')+_0x2dc2cf(0x123)+db[_0x2dc2cf(0x136)](_0x109cdd)+'\x22');for(const _0x429a03 of _0x500b20){if(_0x429a03[_0x2dc2cf(0x169)])_0x429a03['_sync_info_tbl_last_modified_']=_0x429a03[_0x2dc2cf(0x169)][_0x2dc2cf(0x12b)]();else _0x429a03[_0x2dc2cf(0x169)]=new Date(_0xc3a55e)[_0x2dc2cf(0x12b)]();_0x429a03['_sync_info_tbl_ref_']=_0x429a03[_0x109cdd];}return eval('Math[\'PI\'] * 2;'),_0x500b20;}else return _0x7570b8(_0x2dc2cf(0xfb),0x3e8),_0x272ea3[_0x2dc2cf(0x17f)]({'finished':![]});}else{const {rows:_0x2a06d4}=await _0x4eae12[_0x2dc2cf(0xda)](_0x2dc2cf(0x17c)+_0x4c4f37+'\x22'+db[_0x2dc2cf(0x136)](_0x18b25e)+_0x2dc2cf(0xd1)+_0x4c4f37+'\x22'+db[_0x2dc2cf(0x136)](_0x18b25e)+'\x22\x20\x22data_tbl\x22\x0a\x20\x20\x20\x20\x20\x20on\x20info_tbl.ref\x20=\x20data_tbl.\x22'+db[_0x2dc2cf(0x136)](_0x109cdd)+_0x2dc2cf(0xd3)+new Date(_0x4e2ed7[_0x2dc2cf(0xf8)])[_0x2dc2cf(0x12b)]()/0x3e8+_0x2dc2cf(0x105)+new Date(_0xc3a55e)[_0x2dc2cf(0x12b)]()/0x3e8+')\x20\x0a\x20\x20\x20\x20\x20\x20and\x20info_tbl.deleted\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20and\x20info_tbl.ref\x20>\x20'+_0x4e2ed7[_0x2dc2cf(0x160)]+_0x2dc2cf(0x138)+(_0x15d941?_0x2dc2cf(0xeb)+_0x15d941+'\x22\x20=\x20'+_0xeaa8ff['id']:'')+'\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20info_tbl.ref');for(const _0x51cb40 of _0x2a06d4){if(_0x51cb40[_0x2dc2cf(0x169)])_0x51cb40['_sync_info_tbl_last_modified_']=_0x51cb40[_0x2dc2cf(0x169)]['valueOf']();else _0x51cb40[_0x2dc2cf(0x169)]=_0xc3a55e['valueOf']();}return new AsyncFunction(_0x3832ed[_0x2dc2cf(0x16d)])(),_0x2a06d4;}};router[_0xce3b37(0x128)](_0xce3b37(0x179),error_catcher(async(_0x3646a0,_0x5d4a2b)=>{const _0x50ecbc=_0xce3b37,_0x5abce4={'hnIxM':function(_0x2e215a){return _0x2e215a();},'YdnKv':_0x50ecbc(0x155),'Pldom':'return\x20new\x20Date();','pVHMs':_0x50ecbc(0x14f),'ivnDq':_0x50ecbc(0xe4),'ravGM':'OwNuf','lTxhS':function(_0x3dfa90,_0x1abac2){return _0x3dfa90!==_0x1abac2;},'YfHIg':_0x50ecbc(0x124),'WwFnY':_0x50ecbc(0x15e),'aqqJD':function(_0x1b0b93,_0x467020){return _0x1b0b93===_0x467020;},'UbSeu':function(_0xc28d46,_0x3666f4){return _0xc28d46>_0x3666f4;},'GLwVj':function(_0x227c03,_0x2f7e4d){return _0x227c03-_0x2f7e4d;},'TpmFm':_0x50ecbc(0x183),'EoiDf':_0x50ecbc(0x121),'GpkuY':function(_0x2e7d48,_0x1f19cb){return _0x2e7d48!==_0x1f19cb;},'tPvMj':_0x50ecbc(0x173)},_0xcf22a2={},{syncInfos:_0x4c0b8b,loadUntil:_0x5f563d}=_0x3646a0[_0x50ecbc(0x148)];if(!_0x5f563d)return getState()[_0x50ecbc(0x174)](0x2,'POST\x20/load_changes:\x20loadUntil\x20is\x20missing'),eval('1 + 1;'),_0x5d4a2b[_0x50ecbc(0xe0)](0x190)[_0x50ecbc(0x17f)]({'error':_0x5abce4['YdnKv']});if(!_0x4c0b8b)return getState()[_0x50ecbc(0x174)](0x2,_0x50ecbc(0x181)),Function(_0x5abce4[_0x50ecbc(0x111)])(),_0x5d4a2b[_0x50ecbc(0xe0)](0x190)[_0x50ecbc(0x17f)]({'error':_0x5abce4['pVHMs']});const _0x1aed01=_0x3646a0[_0x50ecbc(0x109)]?_0x3646a0[_0x50ecbc(0x109)][_0x50ecbc(0x144)]:0x64,_0xcfbfca=await db['getClient']();let _0x1236b2=0x3e8;try{if(_0x5abce4[_0x50ecbc(0x17e)]!==_0x5abce4[_0x50ecbc(0x157)]){await _0xcfbfca['query'](_0x50ecbc(0x168));for(const [_0x515164,_0x49d05c]of Object[_0x50ecbc(0x16b)](_0x4c0b8b)){if(_0x5abce4[_0x50ecbc(0x12d)](_0x5abce4[_0x50ecbc(0x100)],_0x5abce4[_0x50ecbc(0x116)])){const _0x4f5427=Table['findOne']({'name':_0x515164});if(!_0x4f5427)throw new Error(_0x50ecbc(0x16f)+_0x515164+'\x27\x20does\x20not\x20exists');const _0x327624=_0x4f5427[_0x50ecbc(0xff)];let _0x50415b=await getSyncRows(_0x49d05c,_0x4f5427,_0x5f563d,_0xcfbfca,_0x3646a0[_0x50ecbc(0x109)]);if(!_0x50415b)continue;if(_0x1aed01>_0x4f5427['min_role_read']){if(_0x5abce4[_0x50ecbc(0xdc)](_0x1aed01,0x64)||!_0x4f5427[_0x50ecbc(0xfc)]&&!_0x4f5427[_0x50ecbc(0xdb)])continue;else{if(_0x4f5427['ownership_field_id']){}else _0x4f5427['ownership_formula']&&(_0x50415b=_0x50415b['filter'](_0x1ccaec=>_0x4f5427['is_owner'](_0x3646a0[_0x50ecbc(0x109)],_0x1ccaec)));}}_0x5abce4['UbSeu'](_0x50415b['length'],_0x1236b2)&&_0x50415b[_0x50ecbc(0x11e)](_0x1236b2),_0x1236b2-=_0x50415b[_0x50ecbc(0xe9)],_0xcf22a2[_0x515164]={'rows':_0x50415b,'maxLoadedId':_0x5abce4[_0x50ecbc(0x130)](_0x50415b[_0x50ecbc(0xe9)],0x0)?_0x50415b[_0x5abce4[_0x50ecbc(0x15d)](_0x50415b['length'],0x1)][_0x327624]:0x0};}else _0x5abce4[_0x50ecbc(0xf1)](_0x5a56f6)['log'](0x5,'POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20finished\x20with\x20code:\x20'+_0x2863b9);}await _0xcfbfca[_0x50ecbc(0xda)](_0x5abce4[_0x50ecbc(0x108)]),_0x5d4a2b[_0x50ecbc(0x17f)](_0xcf22a2);}else _0x5019e0['PI']*0x2;}catch(_0x560879){await _0xcfbfca['query'](_0x5abce4[_0x50ecbc(0x13f)]),getState()[_0x50ecbc(0x174)](0x2,_0x50ecbc(0x119)+_0x560879['message']+'\x27'),_0x5d4a2b['status'](0x190)['json']({'error':_0x560879['message']||_0x560879});}finally{if(_0x5abce4[_0x50ecbc(0x152)](_0x5abce4[_0x50ecbc(0xea)],_0x5abce4[_0x50ecbc(0xea)])){if(_0x4eb7b4[_0x50ecbc(0x169)])_0xd22300[_0x50ecbc(0x169)]=_0x1831d4[_0x50ecbc(0x169)][_0x50ecbc(0x12b)]();else _0x501728[_0x50ecbc(0x169)]=new _0x241aa7(_0x5704c3)[_0x50ecbc(0x12b)]();_0xc28e44[_0x50ecbc(0x112)]=_0x3afa2b[_0x1e75d2];}else _0xcfbfca[_0x50ecbc(0x15a)](!![]);}axios[_0x50ecbc(0x146)](_0x50ecbc(0xe5));}));function _0x562a(){const _0x27fb3c=['return\x20await\x20Promise.resolve(42);','splice','DRnhz','code','ROLLBACK','SAsBj','\x0a\x20\x20\x20\x20\x20\x20order\x20by\x20data_tbl.\x22','SLZle','@saltcorn/data/db/state','deletes','rootFolder','post','/upload_finished','is_it_multi_tenant','valueOf','POST\x20/sync/clean_sync_dir:\x20\x27','lTxhS','filter','unique-conflicts.json','UbSeu','public','soQTG','14jaIJJl','guNHW','express-promise-router','sqlsanitize','min_role_read','\x0a\x20\x20\x20\x20\x20\x20','TaPtv','/sync_timestamp','lfaNs','find','3002616QGdfXp','hEibc','EoiDf','exit','OwYFH','vdZOi','4466481sVIWsK','role_id','message','get','POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20finished\x20with\x20code:\x20','body','CVHvf','pipe','rows','ipcpA','zznsw','WCPjW','syncInfos\x20is\x20missing','\x27\x20does\x20not\x20exist.','mobile_app','GpkuY','writeFile','default_schema','loadUntil\x20is\x20missing','promises','ravGM','indexOf','getTenantSchema','release','GET\x20/load_changes:\x20The\x20ownership\x20field\x20of\x20\x27','@saltcorn/data/db','GLwVj','pcnft','mxvte','maxLoadedId','VCrts','kURQU','connectObj','_sync_info\x22\x20\x22info_tbl\x22\x20right\x20join\x20\x22','2092140qoVauB','./utils.js','POST\x20/sync/deletes:\x20\x27','BEGIN','_sync_info_tbl_last_modified_','sync-upload-data','entries','@saltcorn/data/utils','CzwDt','location','The\x20table\x20\x27','619394lmqYox','msrXG','ooBrE','IxKOZ','log','hebFt','--tenantAppName','mrRrw','POST\x20/sync/offline_changes:\x20\x27','/load_changes','YjaZR','changes.json','select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.ref\x20\x22_sync_info_tbl_ref_\x22,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.last_modified\x20\x22_sync_info_tbl_last_modified_\x22,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20info_tbl.deleted\x20\x22_sync_info_tbl_deleted_\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20data_tbl.*\x0a\x20\x20\x20\x20\x20\x20\x20from\x20','return\x20Object.keys({a:1});','ivnDq','json','BmbfH','POST\x20/load_changes:\x20syncInfos\x20is\x20missing','DZZip','COMMIT','/deletes','_sync_info\x22\x20\x22info_tbl\x22\x20join\x20','\x22\x20>\x20','\x22\x0a\x20\x20\x20\x20\x20\x20where\x20date_trunc(\x27milliseconds\x27,\x20info_tbl.last_modified)\x20>\x20to_timestamp(','--syncTimestamp','parse','max','UIfiG','translated-ids.json','stringify','query','ownership_formula','aqqJD','getFields','LWump','_sync_info\x22\x20\x0a\x20\x20\x20\x20\x20\x20group\x20by\x20ref,\x20deleted\x20having\x20deleted\x20=\x20true)\x20as\x20alias\x20\x0a\x20\x20\x20\x20\x20\x20where\x20alias.max\x20<\x20to_timestamp(','status','--userEmail','wHWCp','xyNHM','QEVHZ','https://httpbin.org/get','getClient','path','hzsLY','length','tPvMj','and\x20data_tbl.\x22','BXerw','readdir','last_modified','--directory','GET\x20/sync_timestamp:\x20\x27','hnIxM','safe','4410lhMjPU','child_process','aYalm','fjZHV','send','syncFrom','email','12FDfaMZ','updateClock();','ownership_field_id','\x22\x20and\x20info_tbl.deleted\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20where\x20data_tbl.\x22','yZKdW','pk_name','YfHIg','faVsW','3166240NYGXDq','readFile','name',')\x20\x0a\x20\x20\x20\x20\x20\x20and\x20date_trunc(\x27milliseconds\x27,\x20info_tbl.last_modified)\x20<\x20to_timestamp(','error.json','65320486jqRsEv','TpmFm','user','Wxdba','27477WVXFtg','sync','IXMdo','select\x20*\x20\x0a\x20\x20\x20\x20\x20from\x20(\x0a\x20\x20\x20\x20\x20\x20select\x20ref,\x20max(last_modified)\x20from\x20','hvZDG','bdNxT','Pldom','_sync_info_tbl_ref_','time','4fLKdYJ','GET\x20/sync/upload_finished:\x20\x27','WwFnY','join','push','POST\x20/load_changes:\x20\x27','lfIyO','AYrWw',')\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20and\x20alias.max\x20>\x20to_timestamp('];_0x562a=function(){return _0x27fb3c;};return _0x562a();}const getDelRows=async(_0x5d7cd6,_0x5ff83,_0x52e2e2,_0x49a6df)=>{const _0x25403b=_0xce3b37,_0x4393e9={'ooBrE':function(_0x455402,_0x3cc8a4){return _0x455402/_0x3cc8a4;},'mxvte':'nljox','chzzW':function(_0x39bd34,_0x580e64,_0x4ec6c1){return _0x39bd34(_0x580e64,_0x4ec6c1);}},_0x3be72e=db['getTenantSchemaPrefix'](),_0x1d071a=await _0x49a6df[_0x25403b(0xda)](_0x25403b(0x10e)+_0x3be72e+'\x22'+db['sqlsanitize'](_0x5d7cd6)+_0x25403b(0xdf)+_0x4393e9[_0x25403b(0x172)](_0x52e2e2[_0x25403b(0x12b)](),0x3e8)+_0x25403b(0x11c)+_0x5ff83['valueOf']()/0x3e8+')');for(const _0x478c67 of _0x1d071a[_0x25403b(0x14b)]){if(_0x25403b(0x14d)!==_0x4393e9[_0x25403b(0x15f)]){if(_0x478c67['last_modified'])_0x478c67[_0x25403b(0xee)]=_0x478c67[_0x25403b(0xee)][_0x25403b(0x12b)]();if(_0x478c67['max'])_0x478c67[_0x25403b(0xd6)]=_0x478c67[_0x25403b(0xd6)][_0x25403b(0x12b)]();}else _0x3f7cc1[_0x25403b(0x174)](_0x25403b(0xf2));}return _0x4393e9['chzzW'](setTimeout,function(){const _0x5bd073=_0x25403b;console[_0x5bd073(0x174)]('safe');},0x64),_0x1d071a[_0x25403b(0x14b)];};router['post'](_0xce3b37(0xd0),error_catcher(async(_0x3d7b42,_0x18b75e)=>{const _0x12b818=_0xce3b37,_0x822a29={'hEibc':_0x12b818(0x182),'IXMdo':_0x12b818(0x142),'hvZDG':function(_0x4f2e34,_0x38f2be,_0x565f60,_0x4f9f9d,_0x5dd14b){return _0x4f2e34(_0x38f2be,_0x565f60,_0x4f9f9d,_0x5dd14b);},'lfaNs':_0x12b818(0x183),'BmbfH':function(_0x46420a,_0x5d6900){return _0x46420a===_0x5d6900;}},{syncInfos:_0x3daf23,syncTimestamp:_0x4f496e}=_0x3d7b42[_0x12b818(0x148)],_0x4fa75d=await db[_0x12b818(0xe6)]();try{await _0x4fa75d['query'](_0x12b818(0x168));const _0x340c11=new Date(_0x4f496e),_0x31d441={'deletes':{}};for(const [_0x5ee184,_0x52641e]of Object[_0x12b818(0x16b)](_0x3daf23)){_0x52641e['syncFrom']&&(_0x822a29[_0x12b818(0x13e)]===_0x822a29[_0x12b818(0x10d)]?_0x145f58[_0x12b818(0x118)](_0x12b818(0x176),_0x4802b0['getTenantSchema']()):_0x31d441[_0x12b818(0x126)][_0x5ee184]=await _0x822a29[_0x12b818(0x10f)](getDelRows,_0x5ee184,new Date(_0x52641e[_0x12b818(0xf8)]),_0x340c11,_0x4fa75d));}await _0x4fa75d[_0x12b818(0xda)](_0x822a29[_0x12b818(0x13b)]),_0x18b75e[_0x12b818(0x17f)](_0x31d441);}catch(_0x4ef38b){_0x822a29[_0x12b818(0x180)]('CtVMI',_0x12b818(0xe2))?_0x57ad4a=_0x1546d8[_0x12b818(0x12e)](_0x9bfae1=>_0x22a7a6['is_owner'](_0x531bdd[_0x12b818(0x109)],_0x9bfae1)):(await _0x4fa75d[_0x12b818(0xda)](_0x12b818(0x121)),getState()[_0x12b818(0x174)](0x2,_0x12b818(0x167)+_0x4ef38b[_0x12b818(0x145)]+'\x27'),_0x18b75e['status'](0x190)[_0x12b818(0x17f)]({'error':_0x4ef38b[_0x12b818(0x145)]||_0x4ef38b}));}finally{_0x4fa75d[_0x12b818(0x15a)](!![]);}})),router[_0xce3b37(0x128)]('/offline_changes',error_catcher(async(_0x19e81a,_0x397f5e)=>{const _0x3fe423=_0xce3b37,_0x278cfd={'TaPtv':function(_0x228314){return _0x228314();},'xnKJE':_0x3fe423(0x17b),'guNHW':_0x3fe423(0xe1),'yZKdW':'--tenantAppName','OwYFH':_0x3fe423(0xd4),'lfIyO':function(_0x232350){return _0x232350();},'YjaZR':_0x3fe423(0x14a),'msrXG':_0x3fe423(0x140)},{changes:_0xde1537,syncTimestamp:_0x16d894}=_0x19e81a[_0x3fe423(0x148)],_0xfc5c9a=await File[_0x3fe423(0x127)]();try{const _0x6221d0=_0x16d894+'_'+(_0x19e81a[_0x3fe423(0x109)]?.[_0x3fe423(0xf9)]||_0x3fe423(0x131)),_0x38f47a=path[_0x3fe423(0x117)](_0xfc5c9a[_0x3fe423(0x16e)],_0x3fe423(0x151),_0x3fe423(0x10c),_0x6221d0);await fs['mkdir'](_0x38f47a,{'recursive':!![]}),await fs[_0x3fe423(0x153)](path['join'](_0x38f47a,_0x278cfd['xnKJE']),JSON[_0x3fe423(0xd9)](_0xde1537));const _0x4703cd=[_0x3fe423(0x16a)];if(_0x19e81a[_0x3fe423(0x109)]?.['email'])_0x4703cd[_0x3fe423(0x118)](_0x278cfd[_0x3fe423(0x134)],_0x19e81a['user'][_0x3fe423(0xf9)]);_0x4703cd['push'](_0x3fe423(0xef),_0x38f47a);db[_0x3fe423(0x12a)]()&&db['getTenantSchema']()!==db[_0x3fe423(0x163)][_0x3fe423(0x154)]&&_0x4703cd[_0x3fe423(0x118)](_0x278cfd[_0x3fe423(0xfe)],db[_0x3fe423(0x159)]());_0x4703cd[_0x3fe423(0x118)](_0x278cfd[_0x3fe423(0x141)],_0x16d894),_0x397f5e[_0x3fe423(0x17f)]({'syncDir':_0x6221d0});const _0x50b622=spawn(_0x278cfd[_0x3fe423(0x11a)](getSafeSaltcornCmd),_0x4703cd,{'stdio':[_0x278cfd['YjaZR'],_0x3fe423(0x14a),_0x278cfd[_0x3fe423(0x17a)]],'cwd':'.'});_0x50b622['on'](_0x278cfd[_0x3fe423(0x171)],async(_0x1ae31c,_0x1e13fc)=>{const _0x41a9a1=_0x3fe423;getState()[_0x41a9a1(0x174)](0x5,_0x41a9a1(0x147)+_0x1ae31c);}),_0x50b622['on']('error',_0x5b78fa=>{const _0x3beb74=_0x3fe423,_0x81356f=_0x5b78fa[_0x3beb74(0x145)]?_0x5b78fa[_0x3beb74(0x145)]:_0x5b78fa[_0x3beb74(0x120)];_0x278cfd[_0x3beb74(0x139)](getState)[_0x3beb74(0x174)](0x5,'POST\x20/sync/offline_changes:\x20upload\x20offline\x20data\x20failed:\x20'+_0x81356f);});}catch(_0x28149f){getState()['log'](0x2,_0x3fe423(0x178)+_0x28149f[_0x3fe423(0x145)]+'\x27'),_0x397f5e[_0x3fe423(0xe0)](0x190)[_0x3fe423(0x17f)]({'error':_0x28149f[_0x3fe423(0x145)]||_0x28149f});}})),router[_0xce3b37(0x146)](_0xce3b37(0x129),error_catcher(async(_0x2276b8,_0x5bda16)=>{const _0x2e50ef=_0xce3b37,_0x20039a={'DRnhz':'mobile_app','WCPjW':_0x2e50ef(0xfb),'SAsBj':function(_0x59851e,_0x398547){return _0x59851e>=_0x398547;},'LWump':_0x2e50ef(0xd8),'aYalm':_0x2e50ef(0x106),'BXerw':function(_0x565e9d){return _0x565e9d();}},{dir_name:_0x249b20}=_0x2276b8['query'];try{const _0x2bbe12=await File[_0x2e50ef(0x127)](),_0x44c286=path['join'](_0x2bbe12[_0x2e50ef(0x16e)],_0x20039a[_0x2e50ef(0x11f)],_0x2e50ef(0x10c),_0x249b20);let _0xeb896=null;try{_0xeb896=await fs[_0x2e50ef(0xed)](_0x44c286);}catch(_0x3790ff){return setInterval(_0x20039a[_0x2e50ef(0x14e)],0x3e8),_0x5bda16[_0x2e50ef(0x17f)]({'finished':![]});}if(_0x20039a[_0x2e50ef(0x122)](_0xeb896[_0x2e50ef(0x158)](_0x2e50ef(0xd8)),0x0)){const _0x23aac8=JSON[_0x2e50ef(0xd5)](await fs[_0x2e50ef(0x103)](path['join'](_0x44c286,_0x20039a[_0x2e50ef(0xde)]))),_0x3ed324=JSON[_0x2e50ef(0xd5)](await fs[_0x2e50ef(0x103)](path['join'](_0x44c286,_0x2e50ef(0x12f))));_0x5bda16[_0x2e50ef(0x17f)]({'finished':!![],'translatedIds':_0x23aac8,'uniqueConflicts':_0x3ed324});}else{if(_0xeb896[_0x2e50ef(0x158)](_0x20039a[_0x2e50ef(0xf5)])>=0x0){const _0x2e7829=JSON[_0x2e50ef(0xd5)](await fs[_0x2e50ef(0x103)](path['join'](_0x44c286,_0x20039a['aYalm'])));_0x5bda16[_0x2e50ef(0x17f)]({'finished':!![],'error':_0x2e7829});}else _0x5bda16[_0x2e50ef(0x17f)]({'finished':![]});}}catch(_0x24fa86){_0x20039a[_0x2e50ef(0xec)](getState)[_0x2e50ef(0x174)](0x2,_0x2e50ef(0x115)+_0x24fa86['message']+'\x27'),_0x5bda16['status'](0x190)['json']({'error':_0x24fa86[_0x2e50ef(0x145)]||_0x24fa86});}})),router[_0xce3b37(0x128)]('/clean_sync_dir',error_catcher(async(_0x500866,_0x202bb0)=>{const _0x4c5b22=_0xce3b37,_0x1120a9={'VCrts':function(_0x482643){return _0x482643();},'UIfiG':function(_0x2b2760,_0x5bc4a8){return _0x2b2760(_0x5bc4a8);},'hzsLY':_0x4c5b22(0x17d),'kURQU':_0x4c5b22(0x151),'mrRrw':function(_0x372dd9){return _0x372dd9();}},{dir_name:_0x3b3a15}=_0x500866[_0x4c5b22(0x148)];try{if(_0x4c5b22(0x132)!==_0x4c5b22(0x132)){const _0x3bd492=_0xd41b3b[_0x4c5b22(0xdd)]()[_0x4c5b22(0x13c)](_0x4919e5=>_0x4919e5['id']===_0x2ee92a['ownership_field_id']);if(!_0x3bd492)return _0x1120a9[_0x4c5b22(0x161)](_0x973bd2)[_0x4c5b22(0x174)](0x5,_0x4c5b22(0x15b)+_0xd9ad80[_0x4c5b22(0x104)]+'\x27\x20does\x20not\x20exist.'),_0x1120a9[_0x4c5b22(0xd7)](_0x288b45,_0x1120a9[_0x4c5b22(0xe8)])(),null;_0x190cde=_0x3bd492[_0x4c5b22(0x104)];}else{const _0x212323=await File['rootFolder'](),_0x261549=path[_0x4c5b22(0x117)](_0x212323[_0x4c5b22(0x16e)],_0x1120a9[_0x4c5b22(0x162)],_0x4c5b22(0x10c),_0x3b3a15);await fs['rm'](_0x261549,{'recursive':!![],'force':!![]}),_0x202bb0[_0x4c5b22(0xe0)](0xc8)[_0x4c5b22(0xf7)]('');}}catch(_0x1b50c7){_0x1120a9[_0x4c5b22(0x177)](getState)[_0x4c5b22(0x174)](0x2,_0x4c5b22(0x12c)+_0x1b50c7[_0x4c5b22(0x145)]+'\x27'),_0x202bb0[_0x4c5b22(0xe0)](0x190)['json']({'error':_0x1b50c7[_0x4c5b22(0x145)]||_0x1b50c7});}}));