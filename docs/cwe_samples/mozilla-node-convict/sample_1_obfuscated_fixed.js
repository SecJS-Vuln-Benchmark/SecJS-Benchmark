function _0x5e69(_0x3f1c9d,_0x2aa477){const _0x3fe363=_0x3fe3();return _0x5e69=function(_0x5e69a7,_0x1e19e2){_0x5e69a7=_0x5e69a7-0x18d;let _0x3b7c05=_0x3fe363[_0x5e69a7];return _0x3b7c05;},_0x5e69(_0x3f1c9d,_0x2aa477);}const _0x4cbfb9=_0x5e69;(function(_0x1d8736,_0x188626){const _0x2cfebb=_0x5e69,_0x336821=_0x1d8736();while(!![]){try{const _0x1b753d=-parseInt(_0x2cfebb(0x1ae))/0x1*(-parseInt(_0x2cfebb(0x229))/0x2)+parseInt(_0x2cfebb(0x19f))/0x3+-parseInt(_0x2cfebb(0x239))/0x4+-parseInt(_0x2cfebb(0x1f0))/0x5+parseInt(_0x2cfebb(0x1e4))/0x6+-parseInt(_0x2cfebb(0x21e))/0x7+parseInt(_0x2cfebb(0x205))/0x8*(parseInt(_0x2cfebb(0x1c0))/0x9);if(_0x1b753d===_0x188626)break;else _0x336821['push'](_0x336821['shift']());}catch(_0x14cc29){_0x336821['push'](_0x336821['shift']());}}}(_0x3fe3,0x83c5c));const path=require(_0x4cbfb9(0x230)),fs=require('fs'),{reqBody,multiUserMode,userFromSession,safeJsonParse}=require(_0x4cbfb9(0x1fc)),{normalizePath}=require(_0x4cbfb9(0x1da)),{Workspace}=require(_0x4cbfb9(0x215)),{Document}=require('../models/documents'),{DocumentVectors}=require(_0x4cbfb9(0x21b)),{WorkspaceChats}=require(_0x4cbfb9(0x1cd)),{getVectorDbClass}=require(_0x4cbfb9(0x1b6)),{handleFileUpload,handlePfpUpload}=require(_0x4cbfb9(0x217)),{validatedRequest}=require(_0x4cbfb9(0x18d)),{Telemetry}=require('../models/telemetry'),{flexUserRoleValid,ROLES}=require(_0x4cbfb9(0x202)),{EventLogs}=require(_0x4cbfb9(0x1c5)),{WorkspaceSuggestedMessages}=require(_0x4cbfb9(0x1bd)),{validWorkspaceSlug}=require(_0x4cbfb9(0x234)),{convertToChatHistory}=require(_0x4cbfb9(0x223)),{CollectorApi}=require('../utils/collectorApi'),{determineWorkspacePfpFilepath,fetchPfp}=require(_0x4cbfb9(0x1ab)),{getTTSProvider}=require(_0x4cbfb9(0x222));function workspaceEndpoints(_0x432bca){const _0x19f4be=_0x4cbfb9,_0x22ddd8={'SCZDi':function(_0x2c99d0,_0x5ae88a,_0x36e5ca){return _0x2c99d0(_0x5ae88a,_0x36e5ca);},'dqKZa':function(_0x1d69c6,_0x241623){return _0x1d69c6(_0x241623);},'xPUUe':'openai','qVDKH':_0x19f4be(0x232),'pDMly':_0x19f4be(0x1ef),'FJtro':function(_0x506c59,_0x3dd9cc){return _0x506c59===_0x3dd9cc;},'ynPzg':_0x19f4be(0x1a0),'HGCNl':function(_0x12af8a,_0x5e76cf){return _0x12af8a===_0x5e76cf;},'VnJPY':_0x19f4be(0x1f4),'Xucde':_0x19f4be(0x18f),'WSijz':function(_0x417934,_0x31bd2c,_0x56c180){return _0x417934(_0x31bd2c,_0x56c180);},'nxGRU':function(_0x1d5a9d,_0x9bf518){return _0x1d5a9d!==_0x9bf518;},'XRpyM':_0x19f4be(0x213),'fFhsA':'document_uploaded','Gyymx':_0x19f4be(0x20a),'ZMwNy':function(_0x3d9861,_0x169429){return _0x3d9861===_0x169429;},'FaQOh':'pfEyu','nbuKi':function(_0x2aca49,_0x244339,_0x3b39a7){return _0x2aca49(_0x244339,_0x3b39a7);},'WCMgp':function(_0x13aeda,_0x1c3d15){return _0x13aeda>_0x1c3d15;},'nxLIq':function(_0x57f7a0,_0x2d018c){return _0x57f7a0!==_0x2d018c;},'oPEhf':_0x19f4be(0x19d),'KGLAr':function(_0x322a46){return _0x322a46();},'scBmT':function(_0x29ff61,_0x4b713a){return _0x29ff61(_0x4b713a);},'nQDII':_0x19f4be(0x1af),'SyUzC':_0x19f4be(0x1bc),'ZYKCH':_0x19f4be(0x207),'IfUUi':function(_0x33ed9d,_0x44db5a){return _0x33ed9d===_0x44db5a;},'SdtJa':function(_0x535b8c,_0x13e695,_0x29e103){return _0x535b8c(_0x13e695,_0x29e103);},'KxhJo':function(_0x2a75ad,_0xeb788e){return _0x2a75ad(_0xeb788e);},'pSNgK':_0x19f4be(0x22a),'SRsTG':_0x19f4be(0x190),'YavpL':_0x19f4be(0x1e6),'Xhvlx':function(_0x474981,_0x596a1a){return _0x474981!==_0x596a1a;},'TYYha':_0x19f4be(0x1c1),'eLLtl':_0x19f4be(0x1eb),'cQFte':function(_0x1fc728,_0x28184d){return _0x1fc728!==_0x28184d;},'mpQtx':'wQDAK','fLTdF':function(_0x488db2,_0x614de9,_0x2c5801){return _0x488db2(_0x614de9,_0x2c5801);},'WlYbP':function(_0x409726,_0x5820e2){return _0x409726(_0x5820e2);},'TLRrU':function(_0x1da71a,_0x579436){return _0x1da71a(_0x579436);},'yslop':function(_0x357816,_0x5ca79c){return _0x357816(_0x5ca79c);},'NssEI':_0x19f4be(0x1b5),'NCwUr':_0x19f4be(0x1ce),'bUoDI':_0x19f4be(0x1cc),'aRdAa':function(_0xdd9274,_0x564f08){return _0xdd9274(_0x564f08);},'VUcXt':'audio/mpeg','dmgXr':function(_0x3f94e1){return _0x3f94e1();},'aZajr':'Error\x20processing\x20the\x20TTS\x20request:','dxfCz':_0x19f4be(0x200),'TtGoz':function(_0x3cd352,_0x41ff01){return _0x3cd352(_0x41ff01);},'PHfEu':function(_0x58f7ba,_0x3f8a27){return _0x58f7ba(_0x3f8a27);},'Erzoy':_0x19f4be(0x1ff),'BVWKv':_0x19f4be(0x1c7),'QqfsD':_0x19f4be(0x224),'FaHPu':_0x19f4be(0x1e2),'hMgOe':_0x19f4be(0x1e3),'fFrQH':_0x19f4be(0x1c3),'qtdwA':_0x19f4be(0x1fe),'teFzD':_0x19f4be(0x195),'qZsRu':_0x19f4be(0x209),'CaRMH':_0x19f4be(0x1d1)};if(!_0x432bca)return;const _0x3bd7d4=new Map();_0x432bca['post']('/workspace/new',[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x19a)],ROLES[_0x19f4be(0x1b4)]])],async(_0x8e7097,_0x54b4af)=>{const _0x2fedfa=_0x19f4be;try{const _0x2e3d36=await _0x22ddd8['SCZDi'](userFromSession,_0x8e7097,_0x54b4af),{name:name=null,onboardingComplete:onboardingComplete=![]}=reqBody(_0x8e7097),{workspace:_0x5a98e8,message:_0x224d11}=await Workspace['new'](name,_0x2e3d36?.['id']);await Telemetry[_0x2fedfa(0x1cf)](_0x2fedfa(0x1ef),{'multiUserMode':_0x22ddd8['dqKZa'](multiUserMode,_0x54b4af),'LLMSelection':process[_0x2fedfa(0x1ee)][_0x2fedfa(0x1be)]||_0x22ddd8[_0x2fedfa(0x218)],'Embedder':process[_0x2fedfa(0x1ee)][_0x2fedfa(0x1f9)]||_0x22ddd8[_0x2fedfa(0x1a5)],'VectorDbSelection':process[_0x2fedfa(0x1ee)]['VECTOR_DB']||_0x2fedfa(0x1fd)},_0x2e3d36?.['id']),await EventLogs[_0x2fedfa(0x191)](_0x22ddd8[_0x2fedfa(0x1b3)],{'workspaceName':_0x5a98e8?.[_0x2fedfa(0x23e)]||_0x2fedfa(0x190)},_0x2e3d36?.['id']);if(_0x22ddd8['FJtro'](onboardingComplete,!![]))await Telemetry['sendTelemetry'](_0x22ddd8['ynPzg']);_0x54b4af['status'](0xc8)[_0x2fedfa(0x1a7)]({'workspace':_0x5a98e8,'message':_0x224d11});}catch(_0x20219f){console[_0x2fedfa(0x19e)](_0x20219f[_0x2fedfa(0x211)],_0x20219f),_0x54b4af[_0x2fedfa(0x1e0)](0x1f4)[_0x2fedfa(0x233)]();}}),_0x432bca[_0x19f4be(0x1fa)](_0x19f4be(0x1f7),[validatedRequest,flexUserRoleValid([ROLES['admin'],ROLES[_0x19f4be(0x1b4)]])],async(_0xe8b3bc,_0x4c5df8)=>{const _0x1999c6=_0x19f4be;if(_0x22ddd8['HGCNl'](_0x22ddd8[_0x1999c6(0x19b)],_0x22ddd8[_0x1999c6(0x20d)]))_0x56606e[_0x1999c6(0x19e)](_0x1a6127[_0x1999c6(0x211)],_0x446029),_0x501628[_0x1999c6(0x1e0)](0x1f4)['end']();else try{const _0x43dc33=await _0x22ddd8[_0x1999c6(0x1c8)](userFromSession,_0xe8b3bc,_0x4c5df8),{slug:slug=null}=_0xe8b3bc[_0x1999c6(0x22b)],_0x127f79=_0x22ddd8[_0x1999c6(0x201)](reqBody,_0xe8b3bc),_0x25a5fc=multiUserMode(_0x4c5df8)?await Workspace[_0x1999c6(0x225)](_0x43dc33,{'slug':slug}):await Workspace[_0x1999c6(0x1ba)]({'slug':slug});if(!_0x25a5fc){_0x4c5df8['sendStatus'](0x190)[_0x1999c6(0x233)]();return;}await Workspace[_0x1999c6(0x20b)](_0x25a5fc,_0x127f79,_0x43dc33);const {workspace:_0x49554a,message:_0x7f5b5c}=await Workspace[_0x1999c6(0x1dc)](_0x25a5fc['id'],_0x127f79);_0x4c5df8[_0x1999c6(0x210)](0xc8)[_0x1999c6(0x1a7)]({'workspace':_0x49554a,'message':_0x7f5b5c});}catch(_0xe71fb1){console[_0x1999c6(0x19e)](_0xe71fb1[_0x1999c6(0x211)],_0xe71fb1),_0x4c5df8[_0x1999c6(0x1e0)](0x1f4)[_0x1999c6(0x233)]();}}),_0x432bca[_0x19f4be(0x1fa)](_0x22ddd8[_0x19f4be(0x1c6)],[validatedRequest,flexUserRoleValid([ROLES['admin'],ROLES['manager']]),handleFileUpload],async function(_0x285dc1,_0x5721bb){const _0xe14262=_0x19f4be;try{const _0x44986a=new CollectorApi(),{originalname:_0x16817d}=_0x285dc1['file'],_0x20dea9=await _0x44986a[_0xe14262(0x20c)]();if(!_0x20dea9){_0x5721bb['status'](0x1f4)[_0xe14262(0x1a7)]({'success':![],'error':'Document\x20processing\x20API\x20is\x20not\x20online.\x20Document\x20'+_0x16817d+_0xe14262(0x1d7)})[_0xe14262(0x233)]();return;}const {success:_0x337685,reason:_0x1c4c7a}=await _0x44986a['processDocument'](_0x16817d);if(!_0x337685){if(_0x22ddd8[_0xe14262(0x1a9)](_0x22ddd8[_0xe14262(0x1a8)],_0x22ddd8[_0xe14262(0x1a8)]))_0x5e80df[_0xe14262(0x19e)](_0x2bb6ea[_0xe14262(0x211)],_0x4de9d0),_0x42a42a[_0xe14262(0x1e0)](0x1f4)[_0xe14262(0x233)]();else{_0x5721bb['status'](0x1f4)[_0xe14262(0x1a7)]({'success':![],'error':_0x1c4c7a})['end']();return;}}_0x44986a[_0xe14262(0x19e)]('Document\x20'+_0x16817d+_0xe14262(0x193)),await Telemetry[_0xe14262(0x1cf)](_0x22ddd8['fFhsA']),await EventLogs['logEvent'](_0x22ddd8[_0xe14262(0x1df)],{'documentName':_0x16817d},_0x5721bb[_0xe14262(0x204)]?.[_0xe14262(0x19c)]?.['id']),_0x5721bb['status'](0xc8)[_0xe14262(0x1a7)]({'success':!![],'error':null});}catch(_0x2aa984){console[_0xe14262(0x19e)](_0x2aa984[_0xe14262(0x211)],_0x2aa984),_0x5721bb[_0xe14262(0x1e0)](0x1f4)[_0xe14262(0x233)]();}}),_0x432bca[_0x19f4be(0x1fa)](_0x22ddd8[_0x19f4be(0x1a1)],[validatedRequest,flexUserRoleValid([ROLES['admin'],ROLES[_0x19f4be(0x1b4)]])],async(_0x2ea332,_0xd7c5a9)=>{const _0x247621=_0x19f4be;try{const _0x187e62=new CollectorApi(),{link:link=''}=_0x22ddd8[_0x247621(0x201)](reqBody,_0x2ea332),_0x3cd039=await _0x187e62[_0x247621(0x20c)]();if(!_0x3cd039){_0xd7c5a9[_0x247621(0x210)](0x1f4)[_0x247621(0x1a7)]({'success':![],'error':_0x247621(0x23d)+link+_0x247621(0x1d7)})[_0x247621(0x233)]();return;}const {success:_0x4893a0,reason:_0x2ad695}=await _0x187e62[_0x247621(0x238)](link);if(!_0x4893a0){_0xd7c5a9[_0x247621(0x210)](0x1f4)['json']({'success':![],'error':_0x2ad695})[_0x247621(0x233)]();return;}_0x187e62['log'](_0x247621(0x198)+link+_0x247621(0x193)),await Telemetry['sendTelemetry'](_0x247621(0x20a)),await EventLogs[_0x247621(0x191)](_0x22ddd8['Gyymx'],{'link':link},_0xd7c5a9[_0x247621(0x204)]?.[_0x247621(0x19c)]?.['id']),_0xd7c5a9[_0x247621(0x210)](0xc8)[_0x247621(0x1a7)]({'success':!![],'error':null});}catch(_0x43775c){_0x22ddd8[_0x247621(0x1db)](_0x247621(0x208),_0x22ddd8[_0x247621(0x206)])?(console['log'](_0x43775c[_0x247621(0x211)],_0x43775c),_0xd7c5a9[_0x247621(0x1e0)](0x1f4)['end']()):(_0x1e27d3[_0x247621(0x19e)](_0x5634c8[_0x247621(0x211)],_0x1b399e),_0x2a5144[_0x247621(0x1e0)](0x1f4)[_0x247621(0x233)]());}}),_0x432bca[_0x19f4be(0x1fa)](_0x22ddd8['hMgOe'],[validatedRequest,_0x22ddd8[_0x19f4be(0x18e)](flexUserRoleValid,[ROLES[_0x19f4be(0x19a)],ROLES['manager']])],async(_0x4d7396,_0x43af13)=>{const _0x846a07=_0x19f4be;try{const _0x14a0c6=await _0x22ddd8[_0x846a07(0x20f)](userFromSession,_0x4d7396,_0x43af13),{slug:slug=null}=_0x4d7396[_0x846a07(0x22b)],{adds:adds=[],deletes:deletes=[]}=reqBody(_0x4d7396),_0x57e1ac=multiUserMode(_0x43af13)?await Workspace[_0x846a07(0x225)](_0x14a0c6,{'slug':slug}):await Workspace[_0x846a07(0x1ba)]({'slug':slug});if(!_0x57e1ac){_0x43af13[_0x846a07(0x1e0)](0x190)['end']();return;}await Document[_0x846a07(0x197)](_0x57e1ac,deletes,_0x43af13[_0x846a07(0x204)]?.['user']?.['id']);const {failedToEmbed:failedToEmbed=[],errors:errors=[]}=await Document[_0x846a07(0x1fb)](_0x57e1ac,adds,_0x43af13[_0x846a07(0x204)]?.['user']?.['id']),_0x50ecf5=await Workspace[_0x846a07(0x1ba)]({'id':_0x57e1ac['id']});_0x43af13[_0x846a07(0x210)](0xc8)['json']({'workspace':_0x50ecf5,'message':_0x22ddd8['WCMgp'](failedToEmbed[_0x846a07(0x1a3)],0x0)?failedToEmbed['length']+_0x846a07(0x20e)+errors[_0x846a07(0x1f1)](_0x55a5ee=>''+_0x55a5ee)[_0x846a07(0x1c9)]('\x0a\x0a'):null});}catch(_0x36baf7){console[_0x846a07(0x19e)](_0x36baf7[_0x846a07(0x211)],_0x36baf7),_0x43af13[_0x846a07(0x1e0)](0x1f4)[_0x846a07(0x233)]();}}),_0x432bca['delete'](_0x22ddd8[_0x19f4be(0x220)],[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x19a)],ROLES['manager']])],async(_0x192925,_0x2681c6)=>{const _0x56f6f2=_0x19f4be;if(_0x22ddd8[_0x56f6f2(0x236)](_0x22ddd8[_0x56f6f2(0x1d9)],'ykCiy'))try{const {slug:slug=''}=_0x192925['params'],_0x35b076=await userFromSession(_0x192925,_0x2681c6),_0x2e8740=_0x22ddd8[_0x56f6f2(0x1d0)](getVectorDbClass),_0x1c95e1=multiUserMode(_0x2681c6)?await Workspace[_0x56f6f2(0x225)](_0x35b076,{'slug':slug}):await Workspace[_0x56f6f2(0x1ba)]({'slug':slug});if(!_0x1c95e1){_0x2681c6[_0x56f6f2(0x1e0)](0x190)[_0x56f6f2(0x233)]();return;}await WorkspaceChats[_0x56f6f2(0x1d3)]({'workspaceId':Number(_0x1c95e1['id'])}),await DocumentVectors[_0x56f6f2(0x1f5)](_0x1c95e1['id']),await Document['delete']({'workspaceId':_0x22ddd8[_0x56f6f2(0x201)](Number,_0x1c95e1['id'])}),await Workspace['delete']({'id':_0x22ddd8[_0x56f6f2(0x18e)](Number,_0x1c95e1['id'])}),await EventLogs[_0x56f6f2(0x191)]('workspace_deleted',{'workspaceName':_0x1c95e1?.['name']||_0x56f6f2(0x190)},_0x2681c6['locals']?.[_0x56f6f2(0x19c)]?.['id']);try{await _0x2e8740[_0x22ddd8['nQDII']]({'namespace':slug});}catch(_0x49c807){console[_0x56f6f2(0x1f3)](_0x49c807[_0x56f6f2(0x211)]);}_0x2681c6[_0x56f6f2(0x1e0)](0xc8)['end']();}catch(_0x5e99f8){console[_0x56f6f2(0x19e)](_0x5e99f8[_0x56f6f2(0x211)],_0x5e99f8),_0x2681c6[_0x56f6f2(0x1e0)](0x1f4)[_0x56f6f2(0x233)]();}else{_0x49b767[_0x56f6f2(0x1e0)](0x190)[_0x56f6f2(0x233)]();return;}}),_0x432bca[_0x19f4be(0x1d3)](_0x19f4be(0x23c),[validatedRequest,_0x22ddd8['scBmT'](flexUserRoleValid,[ROLES[_0x19f4be(0x19a)],ROLES[_0x19f4be(0x1b4)]])],async(_0x2c72aa,_0x23ffb4)=>{const _0x5291ad=_0x19f4be;if(_0x22ddd8[_0x5291ad(0x22e)](_0x5291ad(0x23a),'fSfsn'))_0x3eedb6[_0x5291ad(0x1f3)](_0x22ddd8[_0x5291ad(0x1b0)],_0x3d479a),_0x5a8648[_0x5291ad(0x210)](0x1f4)['json']({'success':!![],'message':_0x22ddd8['ZYKCH']});else try{const {slug:slug=''}=_0x2c72aa[_0x5291ad(0x22b)],_0x46fd5f=await _0x22ddd8[_0x5291ad(0x192)](userFromSession,_0x2c72aa,_0x23ffb4),_0x428347=getVectorDbClass(),_0x5d32e3=multiUserMode(_0x23ffb4)?await Workspace['getWithUser'](_0x46fd5f,{'slug':slug}):await Workspace['get']({'slug':slug});if(!_0x5d32e3){_0x23ffb4['sendStatus'](0x190)[_0x5291ad(0x233)]();return;}await DocumentVectors[_0x5291ad(0x1f5)](_0x5d32e3['id']),await Document[_0x5291ad(0x1d3)]({'workspaceId':_0x22ddd8[_0x5291ad(0x1a6)](Number,_0x5d32e3['id'])}),await EventLogs[_0x5291ad(0x191)](_0x22ddd8['pSNgK'],{'workspaceName':_0x5d32e3?.[_0x5291ad(0x23e)]||_0x22ddd8[_0x5291ad(0x240)]},_0x23ffb4[_0x5291ad(0x204)]?.['user']?.['id']);try{await _0x428347[_0x22ddd8[_0x5291ad(0x1bb)]]({'namespace':slug});}catch(_0x40a628){console['error'](_0x40a628['message']);}_0x23ffb4[_0x5291ad(0x1e0)](0xc8)[_0x5291ad(0x233)]();}catch(_0x274b07){console['log'](_0x274b07[_0x5291ad(0x211)],_0x274b07),_0x23ffb4[_0x5291ad(0x1e0)](0x1f4)['end']();}}),_0x432bca[_0x19f4be(0x1ba)](_0x19f4be(0x1f8),[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x1ca)]])],async(_0x139848,_0x4ed972)=>{const _0x8ed0d1=_0x19f4be;if(_0x22ddd8['Xhvlx'](_0x8ed0d1(0x1ad),_0x22ddd8[_0x8ed0d1(0x1e5)]))try{const _0x500b35=await _0x22ddd8[_0x8ed0d1(0x1cb)](userFromSession,_0x139848,_0x4ed972),_0x4e6723=multiUserMode(_0x4ed972)?await Workspace[_0x8ed0d1(0x1d6)](_0x500b35):await Workspace[_0x8ed0d1(0x22d)]();_0x4ed972[_0x8ed0d1(0x210)](0xc8)['json']({'workspaces':_0x4e6723});}catch(_0x5820da){if(_0x22ddd8[_0x8ed0d1(0x1a4)]===_0x8ed0d1(0x1eb))console['log'](_0x5820da[_0x8ed0d1(0x211)],_0x5820da),_0x4ed972[_0x8ed0d1(0x1e0)](0x1f4)[_0x8ed0d1(0x233)]();else return _0x367b2d[_0x8ed0d1(0x210)](0x190)['json']({'message':_0x22ddd8['YavpL']});}else _0x443654[_0x8ed0d1(0x1f3)](_0x18ed16['message']);}),_0x432bca[_0x19f4be(0x1ba)](_0x19f4be(0x1c3),[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x1ca)]])],async(_0x2ca15a,_0x35cc6a)=>{const _0xa88406=_0x19f4be,_0x50e960={'EjLiB':_0xa88406(0x1ce)};if(_0x22ddd8[_0xa88406(0x1c4)](_0xa88406(0x1e1),_0x22ddd8['mpQtx']))try{const {slug:_0x1f4600}=_0x2ca15a['params'],_0x2bd41c=await _0x22ddd8[_0xa88406(0x237)](userFromSession,_0x2ca15a,_0x35cc6a),_0x38eb84=_0x22ddd8[_0xa88406(0x1a6)](multiUserMode,_0x35cc6a)?await Workspace['getWithUser'](_0x2bd41c,{'slug':_0x1f4600}):await Workspace[_0xa88406(0x1ba)]({'slug':_0x1f4600});_0x35cc6a[_0xa88406(0x210)](0xc8)[_0xa88406(0x1a7)]({'workspace':_0x38eb84});}catch(_0x356c0b){console[_0xa88406(0x19e)](_0x356c0b[_0xa88406(0x211)],_0x356c0b),_0x35cc6a[_0xa88406(0x1e0)](0x1f4)['end']();}else _0x4303e9[_0xa88406(0x1f3)]('Error\x20processing\x20the\x20profile\x20picture\x20removal:',_0x24f907),_0x3db092['status'](0x1f4)[_0xa88406(0x1a7)]({'message':_0x50e960[_0xa88406(0x1e9)]});}),_0x432bca[_0x19f4be(0x1ba)](_0x19f4be(0x231),[validatedRequest,_0x22ddd8[_0x19f4be(0x1ed)](flexUserRoleValid,[ROLES[_0x19f4be(0x1ca)]])],async(_0x2d2fbf,_0x1531b0)=>{const _0x4a147d=_0x19f4be;try{const {slug:_0x4eed3f}=_0x2d2fbf[_0x4a147d(0x22b)],_0x3eff90=await userFromSession(_0x2d2fbf,_0x1531b0),_0x377983=_0x22ddd8[_0x4a147d(0x1b1)](multiUserMode,_0x1531b0)?await Workspace[_0x4a147d(0x225)](_0x3eff90,{'slug':_0x4eed3f}):await Workspace[_0x4a147d(0x1ba)]({'slug':_0x4eed3f});if(!_0x377983){_0x1531b0['sendStatus'](0x190)[_0x4a147d(0x233)]();return;}const _0x45aa38=multiUserMode(_0x1531b0)?await WorkspaceChats[_0x4a147d(0x199)](_0x377983['id'],_0x3eff90['id']):await WorkspaceChats['forWorkspace'](_0x377983['id']);_0x1531b0[_0x4a147d(0x210)](0xc8)[_0x4a147d(0x1a7)]({'history':convertToChatHistory(_0x45aa38)});}catch(_0x59f2ce){console['log'](_0x59f2ce[_0x4a147d(0x211)],_0x59f2ce),_0x1531b0[_0x4a147d(0x1e0)](0x1f4)[_0x4a147d(0x233)]();}}),_0x432bca[_0x19f4be(0x1d3)]('/workspace/:slug/delete-chats',[validatedRequest,_0x22ddd8[_0x19f4be(0x1d4)](flexUserRoleValid,[ROLES[_0x19f4be(0x1ca)]]),validWorkspaceSlug],async(_0x4e659d,_0x44f8a3)=>{const _0xfa9c74=_0x19f4be;try{const {chatIds:chatIds=[]}=_0x22ddd8[_0xfa9c74(0x23b)](reqBody,_0x4e659d),_0x3ec2b8=await _0x22ddd8[_0xfa9c74(0x237)](userFromSession,_0x4e659d,_0x44f8a3),_0x87249c=_0x44f8a3[_0xfa9c74(0x204)][_0xfa9c74(0x1b9)];if(!_0x87249c||!Array[_0xfa9c74(0x203)](chatIds)){_0x44f8a3[_0xfa9c74(0x1e0)](0x190)['end']();return;}await WorkspaceChats[_0xfa9c74(0x1d3)]({'id':{'in':chatIds[_0xfa9c74(0x1f1)](_0x1575be=>Number(_0x1575be))},'user_id':_0x3ec2b8?.['id']??null,'workspaceId':_0x87249c['id']}),_0x44f8a3[_0xfa9c74(0x1e0)](0xc8)[_0xfa9c74(0x233)]();}catch(_0x373894){console[_0xfa9c74(0x19e)](_0x373894[_0xfa9c74(0x211)],_0x373894),_0x44f8a3['sendStatus'](0x1f4)[_0xfa9c74(0x233)]();}}),_0x432bca[_0x19f4be(0x1fa)](_0x19f4be(0x1b2),[validatedRequest,_0x22ddd8['TLRrU'](flexUserRoleValid,[ROLES[_0x19f4be(0x1ca)]]),validWorkspaceSlug],async(_0x22604e,_0x2fb4b2)=>{const _0x58db9e=_0x19f4be;try{const {chatId:_0x47919f}=_0x22604e[_0x58db9e(0x22b)],{feedback:feedback=null}=reqBody(_0x22604e),_0x2d501b=await WorkspaceChats['get']({'id':_0x22ddd8[_0x58db9e(0x1ed)](Number,_0x47919f),'workspaceId':_0x2fb4b2[_0x58db9e(0x204)][_0x58db9e(0x1b9)]['id']});if(!_0x2d501b){_0x2fb4b2[_0x58db9e(0x210)](0x194)['end']();return;}const _0x4c23c3=await WorkspaceChats[_0x58db9e(0x23f)](_0x47919f,feedback);_0x2fb4b2[_0x58db9e(0x210)](0xc8)[_0x58db9e(0x1a7)]({'success':_0x4c23c3});}catch(_0x216a9b){console[_0x58db9e(0x1f3)](_0x22ddd8['NssEI'],_0x216a9b),_0x2fb4b2[_0x58db9e(0x210)](0x1f4)[_0x58db9e(0x233)]();}}),_0x432bca[_0x19f4be(0x1ba)](_0x22ddd8[_0x19f4be(0x1bf)],[validatedRequest,flexUserRoleValid([ROLES['all']])],async function(_0x3d44a8,_0x5bf95c){const _0x45529b=_0x19f4be;try{const {slug:_0x77e2ac}=_0x3d44a8[_0x45529b(0x22b)],_0x39619e=await WorkspaceSuggestedMessages[_0x45529b(0x1b8)](_0x77e2ac);_0x5bf95c['status'](0xc8)['json']({'success':!![],'suggestedMessages':_0x39619e});}catch(_0x12d2a3){console[_0x45529b(0x1f3)](_0x45529b(0x1b7),_0x12d2a3),_0x5bf95c[_0x45529b(0x210)](0x1f4)[_0x45529b(0x1a7)]({'success':![],'message':_0x22ddd8['NCwUr']});}}),_0x432bca[_0x19f4be(0x1fa)](_0x22ddd8['qtdwA'],[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x19a)],ROLES[_0x19f4be(0x1b4)]])],async(_0x257a78,_0x1ae8e6)=>{const _0x2a13a9=_0x19f4be;try{const {messages:messages=[]}=reqBody(_0x257a78),{slug:_0x43de1c}=_0x257a78[_0x2a13a9(0x22b)];if(!Array[_0x2a13a9(0x203)](messages))return _0x1ae8e6['status'](0x190)[_0x2a13a9(0x1a7)]({'success':![],'message':_0x2a13a9(0x21d)});return await WorkspaceSuggestedMessages[_0x2a13a9(0x219)](messages,_0x43de1c),_0x1ae8e6['status'](0xc8)[_0x2a13a9(0x1a7)]({'success':!![],'message':_0x22ddd8[_0x2a13a9(0x214)]});}catch(_0x203e55){if(_0x2a13a9(0x241)===_0x2a13a9(0x241))console[_0x2a13a9(0x1f3)]('Error\x20processing\x20the\x20suggested\x20messages:',_0x203e55),_0x1ae8e6[_0x2a13a9(0x210)](0x1f4)[_0x2a13a9(0x1a7)]({'success':!![],'message':_0x2a13a9(0x207)});else{_0xa50d68['status'](0x1f4)[_0x2a13a9(0x1a7)]({'success':![],'error':_0x2a13a9(0x23d)+_0x4e5e35+_0x2a13a9(0x1d7)})[_0x2a13a9(0x233)]();return;}}}),_0x432bca[_0x19f4be(0x1fa)](_0x19f4be(0x1c2),[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x19a)],ROLES[_0x19f4be(0x1b4)]]),validWorkspaceSlug],async(_0x8b336b,_0xf12548)=>{const _0x5413eb=_0x19f4be;try{const {docPath:_0x8348c8,pinStatus:pinStatus=![]}=_0x22ddd8[_0x5413eb(0x1d4)](reqBody,_0x8b336b),_0x2f7f75=_0xf12548['locals'][_0x5413eb(0x1b9)],_0x390a77=await Document['get']({'workspaceId':_0x2f7f75['id'],'docpath':_0x8348c8});if(!_0x390a77)return _0xf12548[_0x5413eb(0x1e0)](0x194)[_0x5413eb(0x233)]();return await Document['update'](_0x390a77['id'],{'pinned':pinStatus}),_0xf12548[_0x5413eb(0x210)](0xc8)[_0x5413eb(0x233)]();}catch(_0x2d14e1){if(_0x5413eb(0x1ec)!==_0x5413eb(0x1ec))_0x12ba5c[_0x5413eb(0x19e)](_0x52e1c0[_0x5413eb(0x211)],_0x52a159),_0x45d840[_0x5413eb(0x1e0)](0x1f4)[_0x5413eb(0x233)]();else return console[_0x5413eb(0x1f3)](_0x5413eb(0x235),_0x2d14e1),_0xf12548[_0x5413eb(0x210)](0x1f4)['end']();}}),_0x432bca[_0x19f4be(0x1ba)](_0x22ddd8['teFzD'],[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x1ca)]]),validWorkspaceSlug],async function(_0x468653,_0x476c88){const _0x4cbdd1=_0x19f4be;try{const {chatId:_0x12972a}=_0x468653[_0x4cbdd1(0x22b)],_0x1845e3=_0x476c88[_0x4cbdd1(0x204)]['workspace'],_0x3734ef=_0x1845e3[_0x4cbdd1(0x1ac)]+':'+_0x12972a,_0xf5553a=await WorkspaceChats[_0x4cbdd1(0x1ba)]({'id':Number(_0x12972a),'workspaceId':_0x1845e3['id']}),_0x32dc5c=_0x3bd7d4[_0x4cbdd1(0x1ba)](_0x3734ef);if(_0x32dc5c){_0x476c88['writeHead'](0xc8,{'Content-Type':_0x32dc5c[_0x4cbdd1(0x21f)]||_0x22ddd8[_0x4cbdd1(0x226)]}),_0x476c88[_0x4cbdd1(0x233)](_0x32dc5c[_0x4cbdd1(0x194)]);return;}const _0x440bac=safeJsonParse(_0xf5553a['response'],null)?.[_0x4cbdd1(0x22c)];if(!_0x440bac)return _0x476c88[_0x4cbdd1(0x1e0)](0xcc)[_0x4cbdd1(0x233)]();const _0x33d8c1=_0x22ddd8[_0x4cbdd1(0x22f)](getTTSProvider),_0x5d7635=await _0x33d8c1[_0x4cbdd1(0x1d2)](_0x440bac);if(_0x22ddd8['HGCNl'](_0x5d7635,null))return _0x476c88['sendStatus'](0xcc)[_0x4cbdd1(0x233)]();_0x3bd7d4[_0x4cbdd1(0x1e7)](_0x3734ef,{'buffer':_0x5d7635,'mime':_0x22ddd8['VUcXt']}),_0x476c88[_0x4cbdd1(0x227)](0xc8,{'Content-Type':_0x22ddd8[_0x4cbdd1(0x226)]}),_0x476c88['end'](_0x5d7635);return;}catch(_0x54f1b3){console['error'](_0x22ddd8[_0x4cbdd1(0x1f2)],_0x54f1b3),_0x476c88[_0x4cbdd1(0x210)](0x1f4)[_0x4cbdd1(0x1a7)]({'message':_0x22ddd8[_0x4cbdd1(0x221)]});}}),_0x432bca[_0x19f4be(0x1ba)](_0x22ddd8[_0x19f4be(0x216)],[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x1ca)]])],async function(_0x1fca2e,_0xed9ca5){const _0x419b5d=_0x19f4be;try{const {slug:_0x23c0ee}=_0x1fca2e[_0x419b5d(0x22b)],_0x2f4026=_0x3bd7d4[_0x419b5d(0x1ba)](_0x23c0ee);if(_0x2f4026){_0xed9ca5['writeHead'](0xc8,{'Content-Type':_0x2f4026[_0x419b5d(0x21f)]||_0x419b5d(0x21c)}),_0xed9ca5[_0x419b5d(0x233)](_0x2f4026[_0x419b5d(0x194)]);return;}const _0x56a359=await _0x22ddd8['TtGoz'](determineWorkspacePfpFilepath,_0x23c0ee);if(!_0x56a359){_0xed9ca5['sendStatus'](0xcc)[_0x419b5d(0x233)]();return;}const {found:_0x57468c,buffer:_0x40ff60,mime:_0x41a0d0}=_0x22ddd8['KxhJo'](fetchPfp,_0x56a359);if(!_0x57468c){_0xed9ca5['sendStatus'](0xcc)[_0x419b5d(0x233)]();return;}_0x3bd7d4[_0x419b5d(0x1e7)](_0x23c0ee,{'buffer':_0x40ff60,'mime':_0x41a0d0}),_0xed9ca5[_0x419b5d(0x227)](0xc8,{'Content-Type':_0x41a0d0||'image/png'}),_0xed9ca5[_0x419b5d(0x233)](_0x40ff60);return;}catch(_0x58309d){console[_0x419b5d(0x1f3)]('Error\x20processing\x20the\x20logo\x20request:',_0x58309d),_0xed9ca5['status'](0x1f4)[_0x419b5d(0x1a7)]({'message':_0x22ddd8['NCwUr']});}}),_0x432bca[_0x19f4be(0x1fa)](_0x22ddd8[_0x19f4be(0x1f6)],[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x19a)],ROLES[_0x19f4be(0x1b4)]]),handlePfpUpload],async function(_0x2863a3,_0x4423d0){const _0x378bc1=_0x19f4be;try{const {slug:_0x5d4377}=_0x2863a3[_0x378bc1(0x22b)],_0x2153ad=_0x2863a3[_0x378bc1(0x1de)];if(!_0x2153ad)return _0x4423d0[_0x378bc1(0x210)](0x190)[_0x378bc1(0x1a7)]({'message':_0x22ddd8[_0x378bc1(0x212)]});const _0x1bd309=await Workspace[_0x378bc1(0x1ba)]({'slug':_0x5d4377}),_0x2380a2=_0x1bd309[_0x378bc1(0x228)];if(_0x2380a2){const _0x1c06fe=path['join'](__dirname,_0x378bc1(0x21a)+_0x22ddd8['PHfEu'](normalizePath,_0x1bd309[_0x378bc1(0x228)]));if(fs[_0x378bc1(0x1e8)](_0x1c06fe))fs[_0x378bc1(0x196)](_0x1c06fe);}const {workspace:_0x37ef1a,message:_0x5363af}=await Workspace[_0x378bc1(0x1ea)](_0x1bd309['id'],{'pfpFilename':_0x2153ad});return _0x4423d0[_0x378bc1(0x210)](_0x37ef1a?0xc8:0x1f4)[_0x378bc1(0x1a7)]({'message':_0x37ef1a?_0x378bc1(0x1a2):_0x5363af});}catch(_0x1e28da){console[_0x378bc1(0x1f3)](_0x22ddd8['Erzoy'],_0x1e28da),_0x4423d0[_0x378bc1(0x210)](0x1f4)[_0x378bc1(0x1a7)]({'message':_0x378bc1(0x1ce)});}}),_0x432bca[_0x19f4be(0x1d3)](_0x19f4be(0x1dd),[validatedRequest,flexUserRoleValid([ROLES[_0x19f4be(0x19a)],ROLES[_0x19f4be(0x1b4)]])],async function(_0x4786b2,_0x652972){const _0x147e34=_0x19f4be;try{const {slug:_0x3a98da}=_0x4786b2[_0x147e34(0x22b)],_0x145ece=await Workspace[_0x147e34(0x1ba)]({'slug':_0x3a98da}),_0x9f9c5c=_0x145ece[_0x147e34(0x228)];if(_0x9f9c5c){const _0x5a5b4e=path[_0x147e34(0x1c9)](__dirname,'../storage/assets/pfp/'+_0x22ddd8['dqKZa'](normalizePath,_0x9f9c5c));if(fs['existsSync'](_0x5a5b4e))fs[_0x147e34(0x196)](_0x5a5b4e);}const {workspace:_0x15d861,message:_0x8055e7}=await Workspace['_update'](_0x145ece['id'],{'pfpFilename':null});return _0x3bd7d4[_0x147e34(0x1d3)](_0x3a98da),_0x652972['status'](_0x15d861?0xc8:0x1f4)[_0x147e34(0x1a7)]({'message':_0x15d861?_0x22ddd8[_0x147e34(0x1aa)]:_0x8055e7});}catch(_0x537052){console[_0x147e34(0x1f3)](_0x147e34(0x1d5),_0x537052),_0x652972[_0x147e34(0x210)](0x1f4)[_0x147e34(0x1a7)]({'message':'Internal\x20server\x20error'});}});}function _0x3fe3(){const _0x181478=['Link\x20','forWorkspaceByUser','admin','VnJPY','user','GBkwj','log','1383318EqFoxR','onboarding_complete','FaHPu','Profile\x20picture\x20uploaded\x20successfully.','length','eLLtl','qVDKH','KxhJo','json','XRpyM','nxGRU','BVWKv','../utils/files/pfp','slug','plfkJ','11vWwOEY','delete-namespace','SyUzC','WlYbP','/workspace/:slug/chat-feedback/:chatId','pDMly','manager','Error\x20updating\x20chat\x20feedback:','../utils/helpers','Error\x20fetching\x20suggested\x20messages:','getMessages','workspace','get','nQDII','Error\x20processing\x20the\x20suggested\x20messages:','../models/workspacesSuggestedMessages','LLM_PROVIDER','qtdwA','135sBkpZA','NQUoA','/workspace/:slug/update-pin','/workspace/:slug','cQFte','../models/eventLogs','QqfsD','Profile\x20picture\x20removed\x20successfully.','WSijz','join','all','SCZDi','Suggested\x20messages\x20saved\x20successfully.','../models/workspaceChats','Internal\x20server\x20error','sendTelemetry','KGLAr','/workspace/:slug/upload-pfp','ttsBuffer','delete','aRdAa','Error\x20processing\x20the\x20profile\x20picture\x20removal:','whereWithUser','\x20will\x20not\x20be\x20processed\x20automatically.','exports','oPEhf','../utils/files','ZMwNy','update','/workspace/:slug/remove-pfp','randomFileName','fFhsA','sendStatus','ySxjG','/workspace/:slug/upload-link','/workspace/:slug/update-embeddings','2265030LGHqEU','TYYha','File\x20upload\x20failed.','set','existsSync','EjLiB','_update','CZLZV','evPMQ','yslop','env','workspace_created','1450750LGQqme','map','aZajr','error','mjHYI','deleteForWorkspace','CaRMH','/workspace/:slug/update','/workspaces','EMBEDDING_ENGINE','post','addDocuments','../utils/http','lancedb','/workspace/:slug/suggested-messages','Error\x20processing\x20the\x20profile\x20picture\x20upload:','TTS\x20could\x20not\x20be\x20completed','dqKZa','../utils/middleware/multiUserProtected','isArray','locals','164552QOFljK','FaQOh','Error\x20saving\x20the\x20suggested\x20messages.','pfEyu','/workspace/:slug/pfp','link_uploaded','trackChange','online','Xucde','\x20documents\x20failed\x20to\x20add.\x0a\x0a','nbuKi','status','message','YavpL','LWmQO','bUoDI','../models/workspace','qZsRu','../utils/files/multer','xPUUe','saveAll','../storage/assets/pfp/','../models/vectors','image/png','Invalid\x20message\x20format.\x20Expected\x20an\x20array\x20of\x20messages.','6667990lkTIdE','mime','fFrQH','dxfCz','../utils/TextToSpeech','../utils/helpers/chat/responses','/workspace/:slug/upload','getWithUser','VUcXt','writeHead','pfpFilename','152240DLHUQo','workspace_vectors_reset','params','text','where','IfUUi','dmgXr','path','/workspace/:slug/chats','inherit','end','../utils/middleware/validWorkspace','Error\x20processing\x20the\x20pin\x20status\x20update:','nxLIq','fLTdF','processLink','808024CmniYH','VjPxb','TLRrU','/workspace/:slug/reset-vector-db','Document\x20processing\x20API\x20is\x20not\x20online.\x20Link\x20','name','updateFeedbackScore','SRsTG','wikxh','../utils/middleware/validatedRequest','scBmT','Nfhkj','Unknown\x20Workspace','logEvent','SdtJa','\x20uploaded\x20processed\x20and\x20successfully.\x20It\x20is\x20now\x20available\x20in\x20documents.','buffer','/workspace/:slug/tts/:chatId','unlinkSync','removeDocuments'];_0x3fe3=function(){return _0x181478;};return _0x3fe3();}module[_0x4cbfb9(0x1d8)]={'workspaceEndpoints':workspaceEndpoints};