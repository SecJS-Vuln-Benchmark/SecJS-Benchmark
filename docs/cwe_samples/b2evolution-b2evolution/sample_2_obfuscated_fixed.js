function _0x2b3f(){const _0x20a3a7=['express','OjZow','__test_client_secret__','lltvL','http://localhost:3000','VHImo','__test_client_id__','foo','xKoUG','NHvpg','mxzLy','isEmpty','svWMU','YJTKx','listen','cgbUW','Qqxig','becomes','akidU','HLRFR','storage\x20error','post','json','fPtUq','mTwpn','chai-as-promised','WKoqd','LolOc','connect-redis','pSfaF','8056FldtCE','apple','appSession=foo','vbEuZ','deepInclude','should\x20get\x20an\x20existing\x20session','oUSom','use','bind','myGyb','writeHead','quit','appSession=__invalid_identity__','dbsize','body','should\x20not\x20throw\x20if\x20another\x20mw\x20writes\x20the\x20header','./fixture/server','5698788KdfQnu','deepEqual','getCookies','close','406635DhcZIN','createClient','should\x20not\x20populate\x20the\x20store\x20when\x20there\x20is\x20no\x20session','Osanq','should\x20not\x20create\x20a\x20session\x20when\x20there\x20are\x20no\x20cookies','asyncGet','ULExz','uses\x20custom\x20session\x20id\x20generator\x20when\x20provided','appSession\x20custom\x20store','pXoHo','appSession','3vJSyHB','172308kUtLla','asyncDbsize','get','15723PLKTQO','GdejA','__test_sub__','now','lJCXH','nextTick','oaUid','stringify','ewnpm','asyncSet','headersSent','should\x20get\x20a\x20new\x20session','message','/session','13668150ONaNvn','should\x20not\x20error\x20for\x20non\x20existent\x20sessions','lHLJu','jar','LiGhw','equal','should\x20destroy\x20an\x20existing\x20session','https://op.example.com','12ptGMob','../lib/config','vaxhR','PnBmt','SwJbw','statusCode','GjyzG','ANppQ','cibjy','session','hMBIF','flushall','tisPp','hnChV','test','7519242tvkMTR','__foo_user__','PpRvP','__test_secret__','11797730szFPwe','uIcrz'];_0x2b3f=function(){return _0x20a3a7;};return _0x2b3f();}function _0x5950(_0x40ee13,_0xf3c7af){const _0x2b3f99=_0x2b3f();return _0x5950=function(_0x595096,_0x4cccce){_0x595096=_0x595096-0x106;let _0x1b497c=_0x2b3f99[_0x595096];return _0x1b497c;},_0x5950(_0x40ee13,_0xf3c7af);}const _0x99b419=_0x5950;(function(_0x399c36,_0x1f8a41){const _0x64ec7f=_0x5950,_0x4e7a45=_0x399c36();while(!![]){try{const _0x49cc11=parseInt(_0x64ec7f(0x16f))/0x1*(-parseInt(_0x64ec7f(0x11b))/0x2)+-parseInt(_0x64ec7f(0x16e))/0x3*(parseInt(_0x64ec7f(0x15f))/0x4)+parseInt(_0x64ec7f(0x163))/0x5+parseInt(_0x64ec7f(0x12a))/0x6+parseInt(_0x64ec7f(0x12e))/0x7+parseInt(_0x64ec7f(0x14e))/0x8*(parseInt(_0x64ec7f(0x172))/0x9)+-parseInt(_0x64ec7f(0x113))/0xa;if(_0x49cc11===_0x1f8a41)break;else _0x4e7a45['push'](_0x4e7a45['shift']());}catch(_0x6aeba8){_0x4e7a45['push'](_0x4e7a45['shift']());}}}(_0x2b3f,0xe8dc1));const {promisify}=require('util'),express=require(_0x99b419(0x130)),{assert}=require('chai')['use'](require(_0x99b419(0x149))),request=require('request-promise-native')['defaults']({'simple':![],'resolveWithFullResponse':!![]}),appSession=require('../lib/appSession'),{get:getConfig}=require(_0x99b419(0x11c)),{create:createServer}=require(_0x99b419(0x15e)),redis=require('redis-mock'),RedisStore=require(_0x99b419(0x14c))({'Store':class Store{}}),defaultConfig={'clientID':_0x99b419(0x136),'clientSecret':_0x99b419(0x132),'issuerBaseURL':_0x99b419(0x11a),'baseURL':'http://example.org','secret':_0x99b419(0x12d),'errorOnRequiredAuth':!![]},sessionData=()=>{const _0x1db52f=_0x99b419,_0x53d975={'akidU':function(_0x10869b){return _0x10869b();},'hMBIF':function(_0x331d90,_0xdf5e38){return _0x331d90*_0xdf5e38;}},_0x5b81fc=()=>Date[_0x1db52f(0x108)]()/0x3e8|0x0,_0x472a75=_0x53d975[_0x1db52f(0x142)](_0x5b81fc),_0x110c02=_0x53d975['hMBIF'](_0x53d975[_0x1db52f(0x125)](0x7,0x18),0x3c)*0x3c;return JSON[_0x1db52f(0x10c)]({'header':{'uat':_0x472a75,'iat':_0x472a75,'exp':_0x472a75+_0x110c02},'data':{'sub':'__test_sub__'}});},login=async _0x28af81=>{const _0x541035=_0x99b419,_0x4632da=request['jar']();return await request['post'](_0x541035(0x112),{'baseUrl':baseUrl,'jar':_0x4632da,'json':_0x28af81}),_0x4632da;},baseUrl=_0x99b419(0x134);describe(_0x99b419(0x16b),()=>{const _0x573153=_0x99b419,_0x591ca3={'xKoUG':function(_0x487f23,_0x40684f){return _0x487f23(_0x40684f);},'NHvpg':function(_0x7d91bd,_0x46037f){return _0x7d91bd*_0x46037f;},'ANppQ':function(_0x3380a2,_0x1d0c60){return _0x3380a2+_0x1d0c60;},'lHLJu':_0x573153(0x107),'VHImo':_0x573153(0x157),'ApmXu':_0x573153(0x13c),'aVvdf':function(_0x3be7ad){return _0x3be7ad();},'oaUid':_0x573153(0x112),'HLRFR':_0x573153(0x10d),'CaXbx':_0x573153(0x15a),'ULExz':function(_0x4bd566){return _0x4bd566();},'LiGhw':'appSession','YJTKx':function(_0x1e0143){return _0x1e0143();},'Osanq':_0x573153(0x12b),'oUSom':function(_0xa68475,_0x219053){return _0xa68475!==_0x219053;},'hnChV':_0x573153(0x12c),'mxzLy':function(_0x5901f7){return _0x5901f7();},'fPtUq':_0x573153(0x14f),'lltvL':_0x573153(0x129),'SwJbw':_0x573153(0x11d),'GdejA':'storage\x20error','XrtqQ':_0x573153(0x140),'tisPp':function(_0xb98086){return _0xb98086();},'cibjy':_0x573153(0x137),'GjyzG':function(_0x255598,_0x47ce49){return _0x255598(_0x47ce49);},'cgbUW':_0x573153(0x167),'jEtAS':function(_0x5b95b7,_0x5321c5,_0x53cdd8){return _0x5b95b7(_0x5321c5,_0x53cdd8);},'uIcrz':_0x573153(0x153),'OjZow':_0x573153(0x110),'PnBmt':function(_0x2a69d5,_0x3f2219,_0x2823c6){return _0x2a69d5(_0x3f2219,_0x2823c6);},'pSfaF':'should\x20handle\x20storage\x20errors','cZUzM':_0x573153(0x15d)};let _0x23075c,_0x40a3df;const _0x504fe3=async _0x365f82=>{const _0x2b81a8=_0x573153;_0x40a3df=redis[_0x2b81a8(0x164)]();const _0x186c7b=new RedisStore({'client':_0x40a3df,'prefix':''});_0x40a3df[_0x2b81a8(0x10e)]=promisify(_0x40a3df['set'])[_0x2b81a8(0x156)](_0x40a3df),_0x40a3df[_0x2b81a8(0x168)]=_0x591ca3[_0x2b81a8(0x138)](promisify,_0x40a3df[_0x2b81a8(0x171)])[_0x2b81a8(0x156)](_0x40a3df),_0x40a3df[_0x2b81a8(0x170)]=promisify(_0x40a3df[_0x2b81a8(0x15b)])[_0x2b81a8(0x156)](_0x40a3df);const _0x40714f=getConfig({...defaultConfig,..._0x365f82,'session':{..._0x365f82&&_0x365f82[_0x2b81a8(0x124)],'store':_0x186c7b}});_0x23075c=await createServer(_0x591ca3[_0x2b81a8(0x138)](appSession,_0x40714f));};_0x591ca3[_0x573153(0x121)](afterEach,async()=>{const _0x52fd52=_0x573153;if(_0x591ca3['VHImo']!==_0x591ca3[_0x52fd52(0x135)]){const _0x1f3ce3=()=>_0x4f4189[_0x52fd52(0x108)]()/0x3e8|0x0,_0x3a6305=_0x1f3ce3(),_0x11829c=_0x591ca3[_0x52fd52(0x139)](_0x591ca3[_0x52fd52(0x139)](0x7,0x18),0x3c)*0x3c;return _0x21c843[_0x52fd52(0x10c)]({'header':{'uat':_0x3a6305,'iat':_0x3a6305,'exp':_0x591ca3[_0x52fd52(0x122)](_0x3a6305,_0x11829c)},'data':{'sub':_0x591ca3['lHLJu']}});}else _0x23075c&&(_0x591ca3['ApmXu']!=='svWMU'?_0x1fa461[_0x52fd52(0x10a)](()=>_0x10032d()):await new Promise(_0x5aae3d=>_0x23075c[_0x52fd52(0x162)](_0x5aae3d))),_0x40a3df&&(await new Promise(_0x114ff5=>_0x40a3df[_0x52fd52(0x126)](_0x114ff5)),await new Promise(_0x17c278=>_0x40a3df[_0x52fd52(0x159)](_0x17c278)));}),it(_0x591ca3[_0x573153(0x13f)],async()=>{const _0x5e957c=_0x573153;await _0x591ca3['aVvdf'](_0x504fe3);const _0x428452=await request[_0x5e957c(0x171)](_0x591ca3[_0x5e957c(0x10b)],{'baseUrl':baseUrl,'json':!![]});assert[_0x5e957c(0x13b)](_0x428452[_0x5e957c(0x15c)]);}),_0x591ca3['jEtAS'](it,_0x573153(0x114),async()=>{const _0x1ef31=_0x573153,_0x35b378={'rKcdJ':function(_0x1a951d){return _0x1a951d();}};if(_0x1ef31(0x14b)!==_0x591ca3[_0x1ef31(0x143)]){await _0x504fe3();const _0x33974f=await request[_0x1ef31(0x171)](_0x591ca3[_0x1ef31(0x10b)],{'baseUrl':baseUrl,'json':!![],'headers':{'cookie':_0x591ca3['CaXbx']}});assert[_0x1ef31(0x118)](_0x33974f[_0x1ef31(0x120)],0xc8),assert[_0x1ef31(0x13b)](_0x33974f[_0x1ef31(0x15c)]);}else!_0x4d8fc9[_0x1ef31(0x10f)]&&_0x410121[_0x1ef31(0x158)](0xc8),_0x35b378['rKcdJ'](_0x2cc831);}),it(_0x591ca3[_0x573153(0x12f)],async()=>{const _0x2016a4=_0x573153;await _0x591ca3[_0x2016a4(0x169)](_0x504fe3),await _0x40a3df[_0x2016a4(0x10e)]('foo',_0x591ca3['ULExz'](sessionData));const _0x2ad3fb=request['jar'](),_0x4edd3b=await request[_0x2016a4(0x171)](_0x2016a4(0x112),{'baseUrl':baseUrl,'jar':_0x2ad3fb,'json':!![],'headers':{'cookie':_0x2016a4(0x150)}});assert['equal'](_0x4edd3b[_0x2016a4(0x120)],0xc8),assert[_0x2016a4(0x160)](_0x4edd3b[_0x2016a4(0x15c)],{'sub':_0x591ca3[_0x2016a4(0x115)]});const [_0x269d4e]=_0x2ad3fb[_0x2016a4(0x161)](baseUrl);assert[_0x2016a4(0x152)](_0x269d4e,{'key':_0x591ca3[_0x2016a4(0x117)],'value':'foo'});}),it(_0x573153(0x165),async()=>{const _0x4848d9=_0x573153;await _0x591ca3[_0x4848d9(0x13d)](_0x504fe3),await request[_0x4848d9(0x171)](_0x4848d9(0x112),{'baseUrl':baseUrl,'json':!![]}),assert[_0x4848d9(0x118)](await _0x40a3df['asyncDbsize'](),0x0);}),_0x591ca3['jEtAS'](it,_0x591ca3[_0x573153(0x131)],async()=>{const _0xf9ba65=_0x573153;await _0x504fe3();const _0x4cf776=await login({'sub':_0x591ca3[_0xf9ba65(0x166)]}),_0x368f08=await request[_0xf9ba65(0x171)](_0xf9ba65(0x112),{'baseUrl':baseUrl,'jar':_0x4cf776,'json':!![]});assert['equal'](_0x368f08[_0xf9ba65(0x120)],0xc8),assert['deepEqual'](_0x368f08['body'],{'sub':_0xf9ba65(0x12b)}),assert[_0xf9ba65(0x118)](await _0x40a3df[_0xf9ba65(0x170)](),0x1);}),_0x591ca3[_0x573153(0x11e)](it,_0x573153(0x119),async()=>{const _0x892886=_0x573153;if(_0x591ca3[_0x892886(0x154)](_0x591ca3[_0x892886(0x128)],'PpRvP')){const _0x36c75a=_0x36a61f[_0x892886(0x13e)](0xbb8,()=>_0x3aea46(_0x36c75a));}else{await _0x591ca3[_0x892886(0x138)](_0x504fe3,{'idpLogout':![]}),await _0x40a3df[_0x892886(0x10e)](_0x892886(0x137),_0x591ca3[_0x892886(0x13a)](sessionData));const _0x4e378d=request[_0x892886(0x116)](),_0x2675d3=await request[_0x892886(0x171)](_0x591ca3['oaUid'],{'baseUrl':baseUrl,'jar':_0x4e378d,'json':!![],'headers':{'cookie':_0x892886(0x150)}});assert[_0x892886(0x160)](_0x2675d3['body'],{'sub':_0x591ca3['lHLJu']}),await request[_0x892886(0x145)](_0x591ca3['oaUid'],{'baseUrl':baseUrl,'jar':_0x4e378d,'json':{}});const _0x2cd7e4=await request['get'](_0x591ca3[_0x892886(0x10b)],{'baseUrl':baseUrl,'jar':_0x4e378d,'json':!![]});assert[_0x892886(0x13b)](_0x2cd7e4[_0x892886(0x15c)]),assert[_0x892886(0x13b)](_0x4e378d[_0x892886(0x161)](baseUrl)),assert[_0x892886(0x118)](await _0x40a3df[_0x892886(0x170)](),0x0);}}),it(_0x573153(0x16a),async()=>{const _0x18eafb=_0x573153,_0x5de0ab=_0x591ca3[_0x18eafb(0x147)];await _0x504fe3({'session':{'genid':()=>_0x5de0ab}});const _0x11c254=await login({'sub':_0x591ca3[_0x18eafb(0x166)],'role':_0x591ca3[_0x18eafb(0x133)],'userid':_0x5de0ab}),_0x496d05=await request['get']('/session',{'baseUrl':baseUrl,'jar':_0x11c254,'json':!![]});assert[_0x18eafb(0x118)](_0x496d05[_0x18eafb(0x120)],0xc8);const _0x5325e9=await _0x40a3df[_0x18eafb(0x168)](_0x5de0ab),{data:_0x4e88d5}=JSON['parse'](_0x5325e9);assert[_0x18eafb(0x160)](_0x4e88d5,{'sub':_0x591ca3[_0x18eafb(0x166)],'role':_0x591ca3[_0x18eafb(0x133)],'userid':_0x5de0ab}),assert[_0x18eafb(0x118)](await _0x40a3df[_0x18eafb(0x170)](),0x1);}),it(_0x591ca3[_0x573153(0x14d)],async()=>{const _0x6cf2fd=_0x573153,_0x353ff6={'lJCXH':_0x591ca3[_0x6cf2fd(0x11f)],'zSUZG':_0x6cf2fd(0x16c)},_0x24fe1b={'get'(_0x38b57a,_0x584f5b){const _0x11faf2=_0x6cf2fd;_0x353ff6[_0x11faf2(0x109)]!==_0x353ff6['zSUZG']?process[_0x11faf2(0x10a)](()=>_0x584f5b(null,JSON['parse'](sessionData()))):_0x276f8b[_0x11faf2(0x10a)](()=>_0x35ca18(new _0x172dd1(_0x11faf2(0x144))));},async 'set'(_0x36131f,_0x453476,_0x5a2bdf){const _0x54e5e8=_0x6cf2fd;process[_0x54e5e8(0x10a)](()=>_0x5a2bdf(new Error(_0x54e5e8(0x144))));},async 'destroy'(_0x27525f,_0x2c68b2){const _0x54e57b=_0x6cf2fd;process[_0x54e57b(0x10a)](()=>_0x2c68b2());}},_0x3613f6=getConfig({...defaultConfig,'session':{'store':_0x24fe1b}});_0x23075c=await createServer(appSession(_0x3613f6));const _0x181ecc=request['jar'](),_0x5c3053=await request[_0x6cf2fd(0x171)](_0x6cf2fd(0x112),{'baseUrl':baseUrl,'jar':_0x181ecc,'json':!![],'headers':{'cookie':_0x6cf2fd(0x150)}});assert[_0x6cf2fd(0x118)](_0x5c3053[_0x6cf2fd(0x120)],0x1f4),assert['equal'](_0x5c3053['body']['err'][_0x6cf2fd(0x111)],_0x591ca3[_0x6cf2fd(0x106)]);}),it(_0x591ca3['cZUzM'],async()=>{const _0x25dadf=_0x573153,_0x4cd1da={'mTwpn':function(_0x224bcf){return _0x224bcf();},'vbEuZ':function(_0x24c248){const _0x21e87c=_0x5950;return _0x591ca3[_0x21e87c(0x127)](_0x24c248);}},_0xe0cabb=express();_0x40a3df=redis['createClient']();const _0x4883ff=new RedisStore({'client':_0x40a3df,'prefix':''});await promisify(_0x40a3df['set'])['bind'](_0x40a3df)(_0x591ca3[_0x25dadf(0x123)],sessionData()),_0xe0cabb[_0x25dadf(0x155)](appSession(_0x591ca3[_0x25dadf(0x138)](getConfig,{...defaultConfig,'session':{'store':_0x4883ff}}))),_0xe0cabb[_0x25dadf(0x171)]('/',(_0x1f2bd4,_0x184c9e,_0x4c08de)=>{const _0x1f259d=_0x25dadf;'WKoqd'===_0x1f259d(0x14a)?(_0x184c9e[_0x1f259d(0x146)](_0x1f2bd4[_0x1f259d(0x16d)]),_0x4cd1da[_0x1f259d(0x151)](_0x4c08de)):(_0x28f65d[_0x1f259d(0x146)](_0xfd5c8e['appSession']),_0x4cd1da[_0x1f259d(0x148)](_0x2cc416));}),_0xe0cabb[_0x25dadf(0x155)]((_0x7a2584,_0x2d4e35,_0x43c5f0)=>{const _0x35f208=_0x25dadf;!_0x2d4e35[_0x35f208(0x10f)]&&_0x2d4e35[_0x35f208(0x158)](0xc8),_0x43c5f0();}),_0x23075c=await new Promise(_0x44920e=>{const _0x54d1ca=_0x25dadf;if(_0x591ca3['XrtqQ']!==_0x591ca3['XrtqQ'])_0x30e08c[_0x54d1ca(0x158)](0xc8);else{const _0x5e9454=_0xe0cabb[_0x54d1ca(0x13e)](0xbb8,()=>_0x44920e(_0x5e9454));}}),await assert[_0x25dadf(0x141)](request['get']('/',{'baseUrl':baseUrl,'json':!![],'headers':{'cookie':'appSession=foo'},'resolveWithFullResponse':![]}),{'sub':_0x591ca3[_0x25dadf(0x115)]});});});