const _0x424548=_0x27ea;(function(_0x3d7e95,_0x38fded){const _0x356bbc=_0x27ea,_0x529c9a=_0x3d7e95();while(!![]){try{const _0x8a954d=-parseInt(_0x356bbc(0x1b7))/0x1*(-parseInt(_0x356bbc(0x166))/0x2)+parseInt(_0x356bbc(0x1e8))/0x3*(-parseInt(_0x356bbc(0x1ed))/0x4)+-parseInt(_0x356bbc(0x228))/0x5*(parseInt(_0x356bbc(0x1a2))/0x6)+-parseInt(_0x356bbc(0x16a))/0x7+parseInt(_0x356bbc(0x1d0))/0x8*(-parseInt(_0x356bbc(0x239))/0x9)+-parseInt(_0x356bbc(0x21f))/0xa+parseInt(_0x356bbc(0x23a))/0xb;if(_0x8a954d===_0x38fded)break;else _0x529c9a['push'](_0x529c9a['shift']());}catch(_0xd9da23){_0x529c9a['push'](_0x529c9a['shift']());}}}(_0x112f,0x27f6e));const assert=require(_0x424548(0x1a6))[_0x424548(0x1a9)],sinon=require(_0x424548(0x1b8)),jose=require('jose'),request=require('request-promise-native')['defaults']({'simple':![],'resolveWithFullResponse':!![]}),TransientCookieHandler=require(_0x424548(0x1e3)),{encodeState}=require(_0x424548(0x174)),{auth}=require('..'),{create:createServer}=require(_0x424548(0x1e4)),{makeIdToken}=require(_0x424548(0x1ea)),clientID=_0x424548(0x15f),expectedDefaultState=encodeState({'returnTo':_0x424548(0x248)}),nock=require(_0x424548(0x19b)),MemoryStore=require(_0x424548(0x21c))(auth),baseUrl=_0x424548(0x1c1),defaultConfig={'secret':'__test_session_secret__','clientID':clientID,'baseURL':_0x424548(0x173),'issuerBaseURL':_0x424548(0x1c3),'authRequired':![]};let server;function _0x112f(){const _0x5a36b4=['skipSilentLogin=true','FkHSd','FPCDH','https://op.example.com/','getCookies','nock','should\x20resume\x20silent\x20logins\x20when\x20user\x20successfully\x20logs\x20in','jycSq','UftQU','WmSwI','XWMju','jxgMA','115008nMAsjz','emYiG','wcDFH','fetchUserInfo','chai','JEALb','deepEqual','assert','router','jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y','should\x20allow\x20thrown\x20error\x20to\x20fail\x20the\x20request','wxnJe','isAuthenticated','GqhPe','post','/tokens','cookies','then','appSession','__invalid_token__','foo','107HUFGoE','sinon','id_token','jar','/session','WEZYP','wllUk','sign','setCookie','__test_nickname__','http://localhost:3000','YsyZT','https://op.example.com','cZBIG','Ulyyg','QKxlU','BTHnl','ermod','longeLiveToken=true&force=true&grant_type=refresh_token&refresh_token=__test_refresh_token__','VSpRY','iss','xIrKN','refresh','isUndefined','useFakeTimers','995952amZkza','__test_refresh_token__','should\x20allow\x20modification\x20of\x20the\x20session','XpIMf','JWT','shoppingCartId','https://api.example.com/','bPQkD','CqyVy','should\x20preserve\x20the\x20cookie\x20session\x20when\x20a\x20new\x20user\x20is\x20logging\x20in\x20over\x20an\x20anonymous\x20session','__test_access_token__','nFlWz','nJBIm','YUkgI','stringify','wWhwe','refreshToken','find','kxBVJ','../lib/transientHandler','./fixture/server','osAUO','should\x20expose\x20the\x20id\x20token\x20when\x20id_token\x20is\x20valid','should\x20use\x20basic\x20auth\x20on\x20token\x20endpoint\x20when\x20using\x20code\x20flow','33lMHzLv','idTokenClaims','./fixture/cert','wxwud','exp','75632huRQLx','aud','body','should\x20refresh\x20an\x20access\x20token\x20and\x20pass\x20tokenEndpointParams\x20and\x20refresh\x20argument\x20params\x20to\x20the\x20request','pDUlJ','SzQDq','bFeKs','length','sub','FeczC','DOGfe','failed\x20to\x20decode\x20JWT\x20(JWTMalformed:\x20JWTs\x20must\x20have\x20three\x20components)','nswqS','access_token','Ehzxn','There\x20should\x20only\x20be\x20one\x20session\x20in\x20the\x20store','HPnYL','should\x20error\x20when\x20id_token\x20is\x20missing\x20issuer','__test_sub__','UtvoT','Bearer','when\x20afterCallack\x20is\x20configured','checks.state\x20argument\x20is\x20missing','/callback','value','include','session','nxXkW','SNKEo','callback\x20response_mode:\x20form_post','store','77QmUPtjPfzWtF2AnpK9RQ','reply','kxbvT','spy','eBmtm',';\x20Max-Age=3600;\x20Path=/;\x20HttpOnly;','oidc','sYBtE','WrJVa','cyJyk','CJDCJ','should\x20error\x20when\x20the\x20state\x20is\x20missing','assign','should\x20error\x20when\x20the\x20body\x20is\x20empty','__new_refresh_token__','__test_client_id__:__test_client_secret__','memorystore','oNsul','fuPLO','1147800PlPviS','xmJUL','should\x20handle\x20access\x20token\x20expiry','skipSilentLogin','nQmPd','QiWBT','sXAZs','nonce','expires_in','10VjiSHi','HS256','VhZMf','VFFlM','Date','jgpyS','accessTokenExpired','wRDGr','json','/oauth/token','should\x20preserve\x20session\x20when\x20the\x20same\x20user\x20is\x20logging\x20in\x20over\x20their\x20existing\x20session','fBwTd','stThH','notEqual','match','shDbi','should\x20use\x20legacy\x20samesite\x20fallback','9OnDwtC','6663063ZpfFLh','nxAje','XOxug','should\x20replace\x20the\x20cookie\x20session\x20when\x20a\x20new\x20user\x20is\x20logging\x20in\x20over\x20an\x20existing\x20different\x20user','exists','openid\x20profile\x20email\x20read:reports\x20offline_access','the\x20new\x20access\x20token\x20should\x20be\x20persisted\x20in\x20the\x20session','ZLier','__new_access_token__','fEekI','aPOtU','bar','QSBUT','code\x20id_token','https://example.org','yFtvV','openid\x20profile\x20email','Nqkbf','jxuIx','ROnjx','get','notExists','auth_org_123','yYbbx','should\x20error\x20when\x20id_token\x20has\x20invalid\x20alg','removeInterceptor','notOk','QDPlO','GecEw','__valid_state__','hBpVx','bzIyB','equal','__test_client_id__','/refresh','existingSession','should\x20fetch\x20userinfo','nxhLl','tick','/userinfo','4154cfYxgb','nUDqK','LNwlM','iIAzJ','1250760HFQVto','GxuwR','should\x20expose\x20all\x20tokens\x20when\x20id_token\x20is\x20valid\x20and\x20response_type\x20is\x20\x27code\x20id_token\x27','accessToken','from','headers','message','should\x20not\x20strip\x20claims\x20when\x20using\x20custom\x20claim\x20filtering','yJUpn','http://example.org','../lib/hooks/getLoginState','Kewri','__test_nonce__','close','replace','Lajit','EhZcI','qwPUU','should\x20error\x20when\x20legacy\x20samesite\x20fallback\x20is\x20off','should\x20error\x20when\x20state\x20doesn\x27t\x20match','PgDqf','secret','lELKH','restore','__test_client_secret__','MbhUZ','iYGMF','lnCFL','/user','req','should\x20error\x20when\x20nonce\x20is\x20missing\x20from\x20cookies','should\x20refresh\x20an\x20access\x20token','PsWiU','PvXxj','__test_state__','idToken','uhidC','iat','calledWith','Basic\x20','should\x20regenerate\x20the\x20session\x20when\x20a\x20new\x20user\x20is\x20logging\x20in\x20over\x20an\x20existing\x20different\x20user','RAoWy','WMbjr','org_id'];_0x112f=function(){return _0x5a36b4;};return _0x112f();}function _0x27ea(_0xf3eedd,_0x8468e9){const _0x112f0d=_0x112f();return _0x27ea=function(_0x27eaaf,_0x523ea9){_0x27eaaf=_0x27eaaf-0x15f;let _0x178a38=_0x112f0d[_0x27eaaf];return _0x178a38;},_0x27ea(_0xf3eedd,_0x8468e9);}const generateCookies=_0x3387aa=>({'auth_verification':JSON[_0x424548(0x1de)](_0x3387aa)}),setup=async _0x1b4008=>{const _0x559254=_0x424548,_0x1493d0={'ScItz':_0x559254(0x1d1),'GxuwR':function(_0x247e98,_0x22bb52){return _0x247e98===_0x22bb52;},'FeczC':'xEBIR','IAdXs':'/callback','UtvoT':_0x559254(0x1da),'XpIMf':function(_0x48142b,_0x144f1d){return _0x48142b(_0x144f1d);},'hBpVx':function(_0x3c2369,_0xedcba6,_0x2eb5ca){return _0x3c2369(_0xedcba6,_0x2eb5ca);},'nxAje':_0x559254(0x231),'QeCCc':_0x559254(0x186)},_0x4eeb07=Object[_0x559254(0x218)]({},defaultConfig,_0x1b4008['authOpts']||{}),_0x4c8348=_0x1b4008[_0x559254(0x1aa)]||_0x1493d0[_0x559254(0x1d3)](auth,_0x4eeb07),_0x43b69b=new TransientCookieHandler(_0x4eeb07),_0x318156=_0x1b4008[_0x559254(0x1ba)]||request[_0x559254(0x1ba)]();server=await _0x1493d0[_0x559254(0x1d3)](createServer,_0x4c8348);let _0x45d103,_0x552d54;Object['keys'](_0x1b4008['cookies'])['forEach'](function(_0x16ac60){const _0x98de4a=_0x559254;let _0x3ed891;_0x43b69b[_0x98de4a(0x20b)](_0x16ac60,{},{'cookie'(_0xb583bb,..._0x1cad85){const _0x18266f=_0x98de4a,_0x275c9b={'nQmPd':_0x1493d0['ScItz'],'cubbQ':_0x18266f(0x201)};if(_0x1493d0[_0x18266f(0x16b)](_0x18266f(0x251),_0x18266f(0x1dd)))_0x2a670e&&_0x2c1f4c[_0x18266f(0x177)]();else{if(_0xb583bb===_0x16ac60){if(_0x1493d0[_0x18266f(0x16b)]('GMIwF',_0x1493d0[_0x18266f(0x1f6)]))return _0x50b51d=this[_0x18266f(0x187)][_0x18266f(0x16f)],_0x247ed6=_0x13046e,{'access_token':_0x18266f(0x1da),'refresh_token':_0x275c9b[_0x18266f(0x223)],'id_token':_0x1c8ad4['body'][_0x18266f(0x1b9)],'token_type':_0x275c9b['cubbQ'],'expires_in':0x15180};else _0x3ed891=_0x1cad85[0x0];}}}},{'value':_0x1b4008[_0x98de4a(0x1b2)][_0x16ac60]}),_0x318156['setCookie'](_0x16ac60+'='+_0x3ed891+';\x20Max-Age=3600;\x20Path=/;\x20HttpOnly;',baseUrl+_0x1493d0['IAdXs']);});const {interceptors:[_0xce6d0]}=_0x1493d0[_0x559254(0x258)](nock,_0x559254(0x1c3),{'allowUnmocked':!![]})[_0x559254(0x1b0)](_0x1493d0[_0x559254(0x23b)])[_0x559254(0x20d)](0xc8,function(_0x1d9131,_0x2a6200){const _0x1ec6c9=_0x559254;return _0x45d103=this[_0x1ec6c9(0x187)][_0x1ec6c9(0x16f)],_0x552d54=_0x2a6200,{'access_token':_0x1493d0[_0x1ec6c9(0x200)],'refresh_token':_0x1ec6c9(0x1d1),'id_token':_0x1b4008[_0x1ec6c9(0x1ef)][_0x1ec6c9(0x1b9)],'token_type':_0x1ec6c9(0x201),'expires_in':0x15180};});let _0x5a0551;if(_0x1b4008[_0x559254(0x161)]){await request[_0x559254(0x1b0)]('/session',{'baseUrl':baseUrl,'jar':_0x318156,'json':_0x1b4008[_0x559254(0x161)]});const _0x5ca6db=_0x318156[_0x559254(0x19a)](baseUrl);_0x5a0551=_0x5ca6db['find'](({key:_0x41c23d})=>_0x41c23d===_0x559254(0x1b4));}const _0x115402=await request[_0x559254(0x1b0)](_0x559254(0x204),{'baseUrl':baseUrl,'jar':_0x318156,'json':_0x1b4008[_0x559254(0x1ef)]}),_0x487eb5=await request[_0x559254(0x24e)](_0x1493d0['QeCCc'],{'baseUrl':baseUrl,'jar':_0x318156,'json':!![]})[_0x559254(0x1b3)](_0x3d1844=>_0x3d1844[_0x559254(0x1ef)]),_0x2ed057=await request[_0x559254(0x24e)](_0x559254(0x1bb),{'baseUrl':baseUrl,'jar':_0x318156,'json':!![]})[_0x559254(0x1b3)](_0x171f30=>_0x171f30['body']),_0x1bce73=await request[_0x559254(0x24e)]('/tokens',{'baseUrl':baseUrl,'jar':_0x318156,'json':!![]})[_0x559254(0x1b3)](_0x41ccd3=>_0x41ccd3[_0x559254(0x1ef)]);return nock[_0x559254(0x253)](_0xce6d0),{'baseUrl':baseUrl,'jar':_0x318156,'response':_0x115402,'currentUser':_0x487eb5,'currentSession':_0x2ed057,'tokenReqHeader':_0x45d103,'tokenReqBody':_0x552d54,'tokens':_0x1bce73,'existingSessionCookie':_0x5a0551};};describe(_0x424548(0x20a),()=>{const _0x10f662=_0x424548,_0x3ead53={'kPcZl':_0x10f662(0x1b4),'lnCFL':function(_0x49969e,_0x537272){return _0x49969e===_0x537272;},'qwPUU':_0x10f662(0x1bc),'sXAZs':function(_0x4c015c,_0x15b816){return _0x4c015c(_0x15b816);},'XWMju':'state\x20missing\x20from\x20the\x20response','SzQDq':function(_0x19ea61,_0x31b4b8){return _0x19ea61(_0x31b4b8);},'PvXxj':_0x10f662(0x257),'PsWiU':'__invalid_state__','nswqS':function(_0x26413f,_0xe55eff){return _0x26413f(_0xe55eff);},'aPOtU':'__test_nonce__','bPQkD':_0x10f662(0x18c),'BTHnl':'__invalid_token__','emYiG':_0x10f662(0x1f8),'ermod':_0x10f662(0x1ff),'ROnjx':_0x10f662(0x17f),'jxuIx':function(_0x287f5e,_0x500d19){return _0x287f5e(_0x500d19);},'DOGfe':function(_0x40c5eb,_0xcbb3d0){return _0x40c5eb(_0xcbb3d0);},'jycSq':function(_0x4d4c2b){return _0x4d4c2b();},'iIAzJ':'/callback','GecEw':'wxwud','wxnJe':'checks.state\x20argument\x20is\x20missing','fBwTd':function(_0x2f51dd,_0x4a7659){return _0x2f51dd(_0x4a7659);},'wRDGr':function(_0x300f2f){return _0x300f2f();},'oNsul':function(_0x30bccb,_0x4b2cc6){return _0x30bccb(_0x4b2cc6);},'lELKH':_0x10f662(0x1c0),'kxbvT':_0x10f662(0x23f),'osAUO':_0x10f662(0x1ab),'wllUk':_0x10f662(0x193),'yJUpn':_0x10f662(0x22c),'Inyta':function(_0x275761,_0x44842a){return _0x275761(_0x44842a);},'uhidC':'77QmUPtjPfzWtF2AnpK9RQ','nUDqK':function(_0x3d8cab,_0x45bc0c){return _0x3d8cab*_0x45bc0c;},'UftQU':_0x10f662(0x182),'FNncr':'code','wcDFH':function(_0x458a61,_0x9992d5){return _0x458a61*_0x9992d5;},'YmQOs':'/tokens','DufUV':'sfTjK','SNKEo':function(_0x5b82c8,_0xac6efa){return _0x5b82c8(_0xac6efa);},'eBmtm':'code\x20id_token','xIrKN':'/refresh','jgpyS':_0x10f662(0x1d6),'xmJUL':function(_0x552d23,_0x328f20,_0x3e57af){return _0x552d23(_0x328f20,_0x3e57af);},'jxgMA':_0x10f662(0x231),'CJDCJ':'grant_type=refresh_token&refresh_token=__test_refresh_token__','sYBtE':_0x10f662(0x1da),'shDbi':'__test_refresh_token__','WrJVa':_0x10f662(0x242),'VRoSa':_0x10f662(0x21a),'JEALb':function(_0x33e0fe,_0x2d1abe){return _0x33e0fe(_0x2d1abe);},'nxhLl':_0x10f662(0x1c3),'hAlmq':_0x10f662(0x1c9),'fEekI':_0x10f662(0x24a),'nxXkW':function(_0x3d0d96,_0x43304e){return _0x3d0d96(_0x43304e);},'QKxlU':'/user-info','EhZcI':_0x10f662(0x165),'OmgCR':function(_0xbfa029,_0x50cc4d){return _0xbfa029(_0x50cc4d);},'MbhUZ':function(_0x3333eb,_0x2bcc04){return _0x3333eb(_0x2bcc04);},'bzIyB':_0x10f662(0x21b),'QDPlO':_0x10f662(0x196),'nFlWz':_0x10f662(0x1bb),'LdrXv':'auth_org_123','MCCTE':function(_0x103d5a,_0x1e8dd5){return _0x103d5a(_0x1e8dd5);},'bFeKs':_0x10f662(0x1ac),'FkHSd':_0x10f662(0x245),'Ulyyg':function(_0x28b31a,_0x116bb5){return _0x28b31a(_0x116bb5);},'CqyVy':function(_0x14491a,_0x1e8aa1){return _0x14491a(_0x1e8aa1);},'LNwlM':_0x10f662(0x1b6),'ZLier':function(_0x5c7ef3,_0x267fb4){return _0x5c7ef3*_0x267fb4;},'VSpRY':function(_0x47d18c,_0x300158){return _0x47d18c(_0x300158);},'kxBVJ':_0x10f662(0x1fc),'VFFlM':function(_0x2ed461,_0x2f4f9c){return _0x2ed461(_0x2f4f9c);},'DIdnn':function(_0x930a9,_0x4df07f){return _0x930a9*_0x4df07f;},'HPnYL':function(_0x391124,_0x318693){return _0x391124(_0x318693);},'XkWwt':function(_0x220835,_0x2f4edf){return _0x220835(_0x2f4edf);},'cZBIG':_0x10f662(0x17d),'GqhPe':_0x10f662(0x188),'LryVu':_0x10f662(0x17c),'nSuLp':_0x10f662(0x171),'WMbjr':_0x10f662(0x1e6),'QiWBT':function(_0x370453,_0x35c7bf,_0x4ba7ee){return _0x370453(_0x35c7bf,_0x4ba7ee);},'wzYBH':_0x10f662(0x16c),'FPCDH':function(_0x160025,_0x592002,_0x47542f){return _0x160025(_0x592002,_0x47542f);},'BXnmD':_0x10f662(0x221),'PJkTK':_0x10f662(0x189),'wWhwe':function(_0x23f881,_0x1b9983,_0x20d5ee){return _0x23f881(_0x1b9983,_0x20d5ee);},'pDUlJ':function(_0x1b84d7,_0x50070d,_0x2882fe){return _0x1b84d7(_0x50070d,_0x2882fe);},'Ehzxn':_0x10f662(0x162),'cyJyk':function(_0x3302dc,_0x1d7019,_0x8ff78){return _0x3302dc(_0x1d7019,_0x8ff78);},'dXLKD':_0x10f662(0x19c),'zmzUc':function(_0x59565a,_0x56fc49,_0x2e2755){return _0x59565a(_0x56fc49,_0x2e2755);},'nJBIm':function(_0x1326f5,_0x25bfe1,_0x56dde7){return _0x1326f5(_0x25bfe1,_0x56dde7);},'iYGMF':_0x10f662(0x1d9),'Nqkbf':'should\x20preserve\x20session\x20but\x20regenerate\x20session\x20id\x20when\x20a\x20new\x20user\x20is\x20logging\x20in\x20over\x20an\x20anonymous\x20session','PgDqf':function(_0x1aa6c3,_0x42f4ab,_0x102219){return _0x1aa6c3(_0x42f4ab,_0x102219);},'VhZMf':_0x10f662(0x232),'WmSwI':function(_0x1080d0,_0x912fea,_0x1bb589){return _0x1080d0(_0x912fea,_0x1bb589);}};_0x3ead53[_0x10f662(0x22b)](afterEach,()=>{const _0x5a9d4b=_0x10f662;_0x3ead53[_0x5a9d4b(0x185)](_0x3ead53['qwPUU'],_0x3ead53[_0x5a9d4b(0x17b)])?server&&server['close']():_0x21a35f[_0x5a9d4b(0x230)]({'session':_0x3d44e2[_0x3ead53['kPcZl']]});}),it(_0x10f662(0x219),async()=>{const _0xe0a6ab=_0x10f662,{response:{statusCode:_0x2ec05c,body:{err:_0x128754}}}=await setup({'cookies':_0x3ead53[_0xe0a6ab(0x225)](generateCookies,{'nonce':_0xe0a6ab(0x176),'state':_0xe0a6ab(0x18c)}),'body':!![]});assert[_0xe0a6ab(0x25a)](_0x2ec05c,0x190),assert[_0xe0a6ab(0x25a)](_0x128754[_0xe0a6ab(0x170)],_0x3ead53[_0xe0a6ab(0x1a0)]);}),_0x3ead53[_0x10f662(0x220)](it,_0x10f662(0x217),async()=>{const _0x1421bd=_0x10f662,{response:{statusCode:_0x4168fa,body:{err:_0x35152d}}}=await _0x3ead53['SzQDq'](setup,{'cookies':{},'body':{'state':_0x1421bd(0x18c),'id_token':_0x1421bd(0x1b5)}});assert[_0x1421bd(0x25a)](_0x4168fa,0x190),assert['equal'](_0x35152d['message'],_0x1421bd(0x203));}),it(_0x3ead53[_0x10f662(0x1c4)],async()=>{const _0x39a42d=_0x10f662,{response:{statusCode:_0x1666a3,body:{err:_0x3bb70c}}}=await _0x3ead53[_0x39a42d(0x1f2)](setup,{'cookies':_0x3ead53[_0x39a42d(0x225)](generateCookies,{'nonce':'__test_nonce__','state':_0x3ead53[_0x39a42d(0x18b)]}),'body':{'state':_0x3ead53[_0x39a42d(0x18a)]}});assert[_0x39a42d(0x25a)](_0x1666a3,0x190),assert[_0x39a42d(0x236)](_0x3bb70c[_0x39a42d(0x170)],/state mismatch/i);}),it('should\x20error\x20when\x20id_token\x20can\x27t\x20be\x20parsed',async()=>{const _0x2c355c=_0x10f662,{response:{statusCode:_0x47f037,body:{err:_0x4b4475}}}=await _0x3ead53[_0x2c355c(0x1f9)](setup,{'cookies':generateCookies({'nonce':_0x3ead53['aPOtU'],'state':_0x2c355c(0x18c)}),'body':{'state':_0x3ead53[_0x2c355c(0x1d7)],'id_token':_0x3ead53[_0x2c355c(0x1c7)]}});assert[_0x2c355c(0x25a)](_0x47f037,0x190),assert[_0x2c355c(0x25a)](_0x4b4475[_0x2c355c(0x170)],_0x3ead53[_0x2c355c(0x1a3)]);}),_0x3ead53['xmJUL'](it,_0x10f662(0x252),async()=>{const _0xe15e7d=_0x10f662,{response:{statusCode:_0x4c4121,body:{err:_0x125717}}}=await _0x3ead53[_0xe15e7d(0x1f9)](setup,{'cookies':generateCookies({'nonce':_0xe15e7d(0x176),'state':_0x3ead53[_0xe15e7d(0x1d7)]}),'body':{'state':_0xe15e7d(0x18c),'id_token':jose[_0xe15e7d(0x1d4)][_0xe15e7d(0x1be)]({'sub':_0x3ead53[_0xe15e7d(0x1c8)]},_0x3ead53[_0xe15e7d(0x24d)],{'algorithm':_0xe15e7d(0x229)})}});assert[_0xe15e7d(0x25a)](_0x4c4121,0x190),assert[_0xe15e7d(0x236)](_0x125717[_0xe15e7d(0x170)],/unexpected JWT alg received/i);}),_0x3ead53[_0x10f662(0x220)](it,_0x10f662(0x1fe),async()=>{const _0x441a50=_0x10f662,{response:{statusCode:_0x232bda,body:{err:_0x35774a}}}=await setup({'cookies':_0x3ead53['jxuIx'](generateCookies,{'nonce':_0x441a50(0x176),'state':_0x441a50(0x18c)}),'body':{'state':_0x441a50(0x18c),'id_token':makeIdToken({'iss':undefined})}});assert['equal'](_0x232bda,0x190),assert[_0x441a50(0x236)](_0x35774a[_0x441a50(0x170)],/missing required JWT property iss/i);}),it(_0x3ead53[_0x10f662(0x1af)],async()=>{const _0x4659e6=_0x10f662,{response:{statusCode:_0x4f1b43,body:{err:_0x4858e3}}}=await _0x3ead53[_0x4659e6(0x1f7)](setup,{'cookies':generateCookies({'state':'__test_state__'}),'body':{'state':_0x4659e6(0x18c),'id_token':_0x3ead53[_0x4659e6(0x19d)](makeIdToken)}});assert[_0x4659e6(0x25a)](_0x4f1b43,0x190),assert['match'](_0x4858e3[_0x4659e6(0x170)],/nonce mismatch/i);}),it(_0x3ead53['LryVu'],async()=>{const _0x298c3a=_0x10f662;if(_0x298c3a(0x1eb)!==_0x3ead53[_0x298c3a(0x256)]){let _0x75a248;_0x5562fc['store'](_0x4bb8cb,{},{'cookie'(_0x1e2290,..._0x10659d){_0x1e2290===_0xe318df&&(_0x75a248=_0x10659d[0x0]);}},{'value':_0x391145[_0x298c3a(0x1b2)][_0x556ae7]}),_0x157ca7[_0x298c3a(0x1bf)](_0x433832+'='+_0x75a248+_0x298c3a(0x211),_0x1626aa+_0x3ead53[_0x298c3a(0x169)]);}else{const {response:{statusCode:_0x454b27,body:{err:_0x263a0b}}}=await setup({'authOpts':{'legacySameSiteCookie':![]},'cookies':{'_auth_verification':JSON[_0x298c3a(0x1de)]({'state':_0x3ead53['bPQkD']})},'body':{'state':_0x3ead53['bPQkD'],'id_token':_0x298c3a(0x1b5)}});assert[_0x298c3a(0x25a)](_0x454b27,0x190),assert[_0x298c3a(0x25a)](_0x263a0b[_0x298c3a(0x170)],_0x3ead53[_0x298c3a(0x1ad)]);}}),it(_0x10f662(0x238),async()=>{const _0x43a795=_0x10f662,{currentUser:_0x2fad85}=await _0x3ead53[_0x43a795(0x233)](setup,{'authOpts':{'identityClaimFilter':[]},'cookies':{'_auth_verification':JSON['stringify']({'state':expectedDefaultState,'nonce':_0x3ead53['aPOtU']})},'body':{'state':expectedDefaultState,'id_token':makeIdToken()}});assert['exists'](_0x2fad85);}),it(_0x3ead53['nSuLp'],async()=>{const _0x392463=_0x10f662,{currentUser:_0x2a3bb1}=await _0x3ead53[_0x392463(0x1f2)](setup,{'authOpts':{'identityClaimFilter':[]},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x392463(0x176)}),'body':{'state':expectedDefaultState,'id_token':_0x3ead53[_0x392463(0x22f)](makeIdToken)}});assert[_0x392463(0x25a)](_0x2a3bb1[_0x392463(0x1cb)],_0x392463(0x199)),assert[_0x392463(0x25a)](_0x2a3bb1['aud'],clientID),assert[_0x392463(0x25a)](_0x2a3bb1[_0x392463(0x226)],_0x392463(0x176)),assert[_0x392463(0x23e)](_0x2a3bb1[_0x392463(0x18f)]),assert[_0x392463(0x23e)](_0x2a3bb1[_0x392463(0x1ec)]);}),it(_0x3ead53[_0x10f662(0x194)],async()=>{const _0x488adc=_0x10f662;if(_0x3ead53[_0x488adc(0x185)](_0x488adc(0x246),_0x488adc(0x1c2)))throw{'status':0x3e7};else{const _0xfa28e=makeIdToken(),{response:{statusCode:_0x42c1bf,headers:_0x242ff9},currentUser:_0xe4f4d,tokens:_0x153a46}=await _0x3ead53['oNsul'](setup,{'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x3ead53[_0x488adc(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0xfa28e}});assert[_0x488adc(0x25a)](_0x42c1bf,0x12e),assert[_0x488adc(0x25a)](_0x242ff9['location'],_0x488adc(0x248)),assert['ok'](_0xe4f4d),assert[_0x488adc(0x25a)](_0xe4f4d['sub'],_0x488adc(0x1ff)),assert['equal'](_0xe4f4d['nickname'],_0x3ead53[_0x488adc(0x180)]),assert['notExists'](_0xe4f4d[_0x488adc(0x18f)]),assert['notExists'](_0xe4f4d[_0x488adc(0x1cb)]),assert[_0x488adc(0x24f)](_0xe4f4d[_0x488adc(0x1ee)]),assert['notExists'](_0xe4f4d[_0x488adc(0x1ec)]),assert['notExists'](_0xe4f4d['nonce']),assert['equal'](_0x153a46[_0x488adc(0x1ae)],!![]),assert[_0x488adc(0x25a)](_0x153a46[_0x488adc(0x18d)],_0xfa28e),assert[_0x488adc(0x1ce)](_0x153a46[_0x488adc(0x1e0)]),assert[_0x488adc(0x1ce)](_0x153a46['accessToken']),assert[_0x488adc(0x206)](_0x153a46[_0x488adc(0x1e9)],{'sub':_0x3ead53['ermod']});}}),_0x3ead53[_0x10f662(0x224)](it,_0x3ead53['wzYBH'],async()=>{const _0xa130aa=_0x10f662,_0x9bf60b=_0x3ead53[_0xa130aa(0x1f7)](makeIdToken,{'c_hash':'77QmUPtjPfzWtF2AnpK9RQ'}),{tokens:_0x1a0db9}=await setup({'authOpts':{'clientSecret':'__test_client_secret__','authorizationParams':{'response_type':_0xa130aa(0x247),'audience':_0xa130aa(0x1d6),'scope':_0x3ead53['kxbvT']}},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x3ead53[_0xa130aa(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0x9bf60b,'code':_0x3ead53[_0xa130aa(0x1e5)]}});assert[_0xa130aa(0x25a)](_0x1a0db9[_0xa130aa(0x1ae)],!![]),assert['equal'](_0x1a0db9[_0xa130aa(0x18d)],_0x9bf60b),assert[_0xa130aa(0x25a)](_0x1a0db9['refreshToken'],_0xa130aa(0x1d1)),assert[_0xa130aa(0x206)](_0x1a0db9['accessToken'],{'access_token':_0xa130aa(0x1da),'token_type':'Bearer'}),assert[_0xa130aa(0x206)](_0x1a0db9['idTokenClaims'],{'sub':_0x3ead53['ermod']});}),_0x3ead53[_0x10f662(0x198)](it,_0x3ead53['BXnmD'],async()=>{const _0x1c72b3=_0x10f662;if(_0x3ead53[_0x1c72b3(0x1bd)]!==_0x1c72b3(0x193))_0x3af8c6[_0x1c72b3(0x177)]();else{const _0x11ce6e=sinon[_0x1c72b3(0x1cf)]({'toFake':[_0x3ead53[_0x1c72b3(0x172)]]}),_0xbb14e8=_0x3ead53['Inyta'](makeIdToken,{'c_hash':_0x3ead53[_0x1c72b3(0x18e)]}),_0x110959=_0x3ead53[_0x1c72b3(0x167)](0x3c,0x3c),_0x452333=_0x3ead53[_0x1c72b3(0x167)](_0x110959,0x3e8),{tokens:_0x5a5623,jar:_0x48a289}=await setup({'authOpts':{'clientSecret':_0x3ead53[_0x1c72b3(0x19e)],'authorizationParams':{'response_type':_0x3ead53['FNncr']}},'cookies':_0x3ead53[_0x1c72b3(0x24c)](generateCookies,{'state':expectedDefaultState,'nonce':_0x1c72b3(0x176)}),'body':{'state':expectedDefaultState,'id_token':_0xbb14e8,'code':_0x1c72b3(0x1ab)}});assert['equal'](_0x5a5623[_0x1c72b3(0x16d)][_0x1c72b3(0x227)],_0x3ead53[_0x1c72b3(0x167)](0x18,_0x110959)),_0x11ce6e[_0x1c72b3(0x164)](_0x3ead53[_0x1c72b3(0x1a4)](0x4,_0x452333));const _0x4286fc=await request['get'](_0x3ead53['YmQOs'],{'baseUrl':baseUrl,'jar':_0x48a289,'json':!![]})[_0x1c72b3(0x1b3)](_0x401bf9=>_0x401bf9[_0x1c72b3(0x1ef)]);assert['equal'](_0x4286fc[_0x1c72b3(0x16d)][_0x1c72b3(0x227)],_0x3ead53['nUDqK'](0x14,_0x110959)),assert['isFalse'](_0x4286fc[_0x1c72b3(0x22e)]),_0x11ce6e[_0x1c72b3(0x164)](0x15*_0x452333);const _0x2f1f46=await request[_0x1c72b3(0x24e)](_0x1c72b3(0x1b1),{'baseUrl':baseUrl,'jar':_0x48a289,'json':!![]})['then'](_0x52ca92=>_0x52ca92[_0x1c72b3(0x1ef)]);assert['isTrue'](_0x2f1f46[_0x1c72b3(0x22e)]),_0x11ce6e[_0x1c72b3(0x181)]();}}),_0x3ead53[_0x10f662(0x220)](it,_0x3ead53['PJkTK'],async()=>{const _0x31a974=_0x10f662,_0x2a4239={'yFtvV':_0x3ead53['DufUV'],'XOxug':_0x31a974(0x179)},_0x1ce207=_0x3ead53[_0x31a974(0x209)](makeIdToken,{'c_hash':'77QmUPtjPfzWtF2AnpK9RQ'}),_0x441240={...defaultConfig,'clientSecret':_0x3ead53['UftQU'],'authorizationParams':{'response_type':_0x3ead53[_0x31a974(0x210)],'audience':'https://api.example.com/','scope':_0x3ead53[_0x31a974(0x20e)]}},_0x50f515=auth(_0x441240);_0x50f515['get'](_0x3ead53[_0x31a974(0x1cc)],async(_0x2e6406,_0x4e53f9)=>{const _0x231ba0=_0x31a974;if(_0x2a4239[_0x231ba0(0x249)]===_0x2a4239[_0x231ba0(0x23c)])_0x2e5293=_0x4210fa[0x0];else{const _0x34218c=await _0x2e6406[_0x231ba0(0x212)][_0x231ba0(0x16d)][_0x231ba0(0x1cd)]();_0x4e53f9[_0x231ba0(0x230)]({'accessToken':_0x34218c,'refreshToken':_0x2e6406[_0x231ba0(0x212)][_0x231ba0(0x1e0)]});}});const {tokens:_0x314df8,jar:_0x48c098}=await setup({'router':_0x50f515,'authOpts':{'clientSecret':_0x3ead53[_0x31a974(0x19e)],'authorizationParams':{'response_type':_0x31a974(0x247),'audience':_0x3ead53[_0x31a974(0x22d)],'scope':_0x3ead53[_0x31a974(0x20e)]}},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x31a974(0x176)}),'body':{'state':expectedDefaultState,'id_token':_0x1ce207,'code':_0x31a974(0x1ab)}}),_0x38d9c7=sinon['spy'](()=>({'access_token':_0x31a974(0x242),'refresh_token':'__new_refresh_token__','id_token':_0x314df8[_0x31a974(0x18d)],'token_type':_0x31a974(0x201),'expires_in':0x15180})),{interceptors:[_0x23a2df]}=_0x3ead53['xmJUL'](nock,_0x31a974(0x1c3),{'allowUnmocked':!![]})[_0x31a974(0x1b0)](_0x3ead53['jxgMA'])[_0x31a974(0x20d)](0xc8,_0x38d9c7),_0x2a937a=await request[_0x31a974(0x24e)](_0x3ead53[_0x31a974(0x1cc)],{'baseUrl':baseUrl,'jar':_0x48c098,'json':!![]})['then'](_0x211a82=>_0x211a82[_0x31a974(0x1ef)]);nock[_0x31a974(0x253)](_0x23a2df),sinon[_0x31a974(0x1a9)][_0x31a974(0x190)](_0x38d9c7,'/oauth/token',_0x3ead53[_0x31a974(0x216)]),assert[_0x31a974(0x25a)](_0x314df8['accessToken'][_0x31a974(0x1fa)],_0x3ead53[_0x31a974(0x213)]),assert['equal'](_0x314df8[_0x31a974(0x1e0)],_0x3ead53['shDbi']),assert['equal'](_0x2a937a[_0x31a974(0x16d)][_0x31a974(0x1fa)],_0x3ead53[_0x31a974(0x214)]),assert['equal'](_0x2a937a['refreshToken'],_0x3ead53['VRoSa']);const _0x39f64f=await request[_0x31a974(0x24e)](_0x31a974(0x1b1),{'baseUrl':baseUrl,'jar':_0x48c098,'json':!![]})[_0x31a974(0x1b3)](_0x235118=>_0x235118[_0x31a974(0x1ef)]);assert[_0x31a974(0x25a)](_0x39f64f['accessToken']['access_token'],_0x3ead53[_0x31a974(0x214)],_0x31a974(0x240));}),it('should\x20refresh\x20an\x20access\x20token\x20and\x20keep\x20original\x20refresh\x20token',async()=>{const _0x1e0852=_0x10f662,_0x25bf22=_0x3ead53['fBwTd'](makeIdToken,{'c_hash':_0x3ead53[_0x1e0852(0x18e)]}),_0x241552={...defaultConfig,'clientSecret':_0x3ead53['UftQU'],'authorizationParams':{'response_type':_0x3ead53[_0x1e0852(0x210)],'audience':_0x3ead53['jgpyS'],'scope':_0x3ead53[_0x1e0852(0x20e)]}},_0x478ec9=auth(_0x241552);_0x478ec9[_0x1e0852(0x24e)]('/refresh',async(_0x58760d,_0x199f61)=>{const _0x519b76=_0x1e0852,_0x4c21dd={'stThH':function(_0x16bcaa,_0x3275c2){return _0x16bcaa===_0x3275c2;}};if(_0x519b76(0x175)!==_0x519b76(0x21e)){const _0x5cb569=await _0x58760d[_0x519b76(0x212)][_0x519b76(0x16d)]['refresh']();_0x199f61[_0x519b76(0x230)]({'accessToken':_0x5cb569,'refreshToken':_0x58760d[_0x519b76(0x212)][_0x519b76(0x1e0)]});}else _0x4c21dd[_0x519b76(0x234)](_0x5027f6,_0x417bc6)&&(_0x59ead0=_0x5d8213[0x0]);});const {tokens:_0x17955f,jar:_0x150ccf}=await setup({'router':_0x478ec9,'authOpts':{'clientSecret':'__test_client_secret__','authorizationParams':{'response_type':_0x3ead53[_0x1e0852(0x210)],'audience':_0x3ead53[_0x1e0852(0x22d)],'scope':_0x3ead53['kxbvT']}},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x3ead53[_0x1e0852(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0x25bf22,'code':'jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y'}}),_0x135a6e=sinon[_0x1e0852(0x20f)](()=>({'access_token':_0x1e0852(0x242),'id_token':_0x17955f[_0x1e0852(0x1b9)],'token_type':_0x1e0852(0x201),'expires_in':0x15180})),{interceptors:[_0x18e6bf]}=nock('https://op.example.com',{'allowUnmocked':!![]})[_0x1e0852(0x1b0)](_0x3ead53[_0x1e0852(0x1a1)])['reply'](0xc8,_0x135a6e),_0x267902=await request[_0x1e0852(0x24e)](_0x3ead53['xIrKN'],{'baseUrl':baseUrl,'jar':_0x150ccf,'json':!![]})[_0x1e0852(0x1b3)](_0x3c2000=>_0x3c2000[_0x1e0852(0x1ef)]);nock[_0x1e0852(0x253)](_0x18e6bf),sinon[_0x1e0852(0x1a9)][_0x1e0852(0x190)](_0x135a6e,_0x3ead53[_0x1e0852(0x1a1)],'grant_type=refresh_token&refresh_token=__test_refresh_token__'),assert[_0x1e0852(0x25a)](_0x17955f[_0x1e0852(0x16d)]['access_token'],_0x1e0852(0x1da)),assert[_0x1e0852(0x25a)](_0x17955f[_0x1e0852(0x1e0)],_0x3ead53[_0x1e0852(0x237)]),assert['equal'](_0x267902[_0x1e0852(0x16d)]['access_token'],_0x3ead53[_0x1e0852(0x214)]),assert[_0x1e0852(0x25a)](_0x267902['refreshToken'],_0x3ead53[_0x1e0852(0x237)]);}),_0x3ead53[_0x10f662(0x1df)](it,_0x10f662(0x1f0),async()=>{const _0x25313b=_0x10f662,_0x5cbb89=_0x3ead53[_0x25313b(0x24c)](makeIdToken,{'c_hash':_0x3ead53['uhidC']}),_0x4bedfa={...defaultConfig,'clientSecret':_0x25313b(0x182),'authorizationParams':{'response_type':_0x3ead53[_0x25313b(0x210)],'audience':_0x3ead53[_0x25313b(0x22d)],'scope':'openid\x20profile\x20email\x20read:reports\x20offline_access'},'tokenEndpointParams':{'longeLiveToken':!![]}},_0x59aa02=auth(_0x4bedfa);_0x59aa02[_0x25313b(0x24e)](_0x25313b(0x160),async(_0x47ee83,_0x1e224d)=>{const _0x737fe8=_0x25313b,_0x5f4b28=await _0x47ee83[_0x737fe8(0x212)][_0x737fe8(0x16d)]['refresh']({'tokenEndpointParams':{'force':!![]}});_0x1e224d[_0x737fe8(0x230)]({'accessToken':_0x5f4b28,'refreshToken':_0x47ee83['oidc'][_0x737fe8(0x1e0)]});});const {tokens:_0x7b4d2c,jar:_0x5a60e0,tokenReqBody:_0x1c39bb}=await setup({'router':_0x59aa02,'authOpts':{'clientSecret':_0x25313b(0x182),'authorizationParams':{'response_type':'code\x20id_token','audience':_0x3ead53[_0x25313b(0x22d)],'scope':_0x3ead53[_0x25313b(0x20e)]}},'cookies':_0x3ead53[_0x25313b(0x1a7)](generateCookies,{'state':expectedDefaultState,'nonce':_0x3ead53[_0x25313b(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0x5cbb89,'code':_0x25313b(0x1ab)}}),_0x5c1a96=sinon[_0x25313b(0x20f)](()=>({'access_token':_0x25313b(0x242),'refresh_token':_0x25313b(0x21a),'id_token':_0x7b4d2c['idToken'],'token_type':'Bearer','expires_in':0x15180})),{interceptors:[_0x3654b3]}=nock(_0x3ead53[_0x25313b(0x163)],{'allowUnmocked':!![]})['post'](_0x3ead53[_0x25313b(0x1a1)])[_0x25313b(0x20d)](0xc8,_0x5c1a96),_0x4c3d4c=await request[_0x25313b(0x24e)]('/refresh',{'baseUrl':baseUrl,'jar':_0x5a60e0,'json':!![]})[_0x25313b(0x1b3)](_0x4663f3=>_0x4663f3['body']);nock[_0x25313b(0x253)](_0x3654b3),sinon[_0x25313b(0x1a9)][_0x25313b(0x190)](_0x5c1a96,_0x25313b(0x231),_0x3ead53['hAlmq']),assert[_0x25313b(0x25a)](_0x7b4d2c[_0x25313b(0x16d)][_0x25313b(0x1fa)],_0x25313b(0x1da)),assert['equal'](_0x7b4d2c[_0x25313b(0x1e0)],_0x3ead53[_0x25313b(0x237)]),assert[_0x25313b(0x25a)](_0x4c3d4c[_0x25313b(0x16d)]['access_token'],_0x25313b(0x242)),assert[_0x25313b(0x25a)](_0x4c3d4c[_0x25313b(0x1e0)],'__new_refresh_token__'),assert[_0x25313b(0x236)](_0x1c39bb,/longeLiveToken=true/);const _0x513e79=await request[_0x25313b(0x24e)](_0x3ead53['YmQOs'],{'baseUrl':baseUrl,'jar':_0x5a60e0,'json':!![]})['then'](_0x11e50b=>_0x11e50b[_0x25313b(0x1ef)]);assert[_0x25313b(0x25a)](_0x513e79['accessToken'][_0x25313b(0x1fa)],_0x25313b(0x242),_0x25313b(0x240));}),_0x3ead53[_0x10f662(0x1f1)](it,_0x3ead53[_0x10f662(0x1fb)],async()=>{const _0x54b362=_0x10f662,_0x2824a5=makeIdToken({'c_hash':_0x3ead53[_0x54b362(0x18e)]}),_0x39e7a3={...defaultConfig,'clientSecret':'__test_client_secret__','authorizationParams':{'response_type':_0x3ead53['eBmtm'],'audience':_0x3ead53[_0x54b362(0x22d)],'scope':_0x3ead53['fEekI']}},_0x5368f2=_0x3ead53[_0x54b362(0x208)](auth,_0x39e7a3);_0x5368f2['get'](_0x3ead53['QKxlU'],async(_0x456bc0,_0x2c470c)=>{const _0x369185=_0x54b362;_0x2c470c[_0x369185(0x230)](await _0x456bc0[_0x369185(0x212)]['fetchUserInfo']());});const {jar:_0x3096e3}=await _0x3ead53[_0x54b362(0x209)](setup,{'router':_0x5368f2,'authOpts':{'clientSecret':_0x3ead53['UftQU'],'authorizationParams':{'response_type':_0x3ead53[_0x54b362(0x210)],'audience':'https://api.example.com/','scope':_0x3ead53['kxbvT']}},'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x54b362(0x176)}),'body':{'state':expectedDefaultState,'id_token':_0x2824a5,'code':'jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y'}}),{interceptors:[_0x5c9911]}=nock(_0x3ead53['nxhLl'],{'allowUnmocked':!![]})['get'](_0x3ead53[_0x54b362(0x17a)])['reply'](0xc8,()=>({'userInfo':!![],'sub':_0x54b362(0x1ff)})),_0x3b2698=await request[_0x54b362(0x24e)](_0x3ead53[_0x54b362(0x1c6)],{'baseUrl':baseUrl,'jar':_0x3096e3,'json':!![]})[_0x54b362(0x1b3)](_0x5c5d7b=>_0x5c5d7b[_0x54b362(0x1ef)]);nock[_0x54b362(0x253)](_0x5c9911),assert[_0x54b362(0x1a8)](_0x3b2698,{'userInfo':!![],'sub':_0x3ead53[_0x54b362(0x1c8)]});}),_0x3ead53[_0x10f662(0x1f1)](it,_0x10f662(0x1e7),async()=>{const _0x5702a5=_0x10f662,_0x22cd28=makeIdToken({'c_hash':'77QmUPtjPfzWtF2AnpK9RQ'}),{tokenReqBody:_0x3da740,tokenReqHeader:_0x252fa1}=await _0x3ead53['OmgCR'](setup,{'authOpts':{'clientSecret':_0x5702a5(0x182),'authorizationParams':{'response_type':_0x3ead53[_0x5702a5(0x210)],'audience':_0x5702a5(0x1d6),'scope':_0x5702a5(0x23f)}},'cookies':_0x3ead53[_0x5702a5(0x183)](generateCookies,{'state':expectedDefaultState,'nonce':_0x3ead53[_0x5702a5(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0x22cd28,'code':_0x3ead53[_0x5702a5(0x1e5)]}}),_0x3909e7=Buffer[_0x5702a5(0x16e)](_0x252fa1['authorization'][_0x5702a5(0x178)](_0x5702a5(0x191),''),'base64');assert['equal'](_0x3909e7,_0x3ead53[_0x5702a5(0x259)]),assert[_0x5702a5(0x236)](_0x3da740,/code=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y/);}),_0x3ead53[_0x10f662(0x215)](it,_0x3ead53['dXLKD'],async()=>{const _0x26ed80=_0x10f662,_0x54f6f1=makeIdToken(),_0x3f0aa6=request[_0x26ed80(0x1ba)]();_0x3f0aa6[_0x26ed80(0x1bf)](_0x3ead53[_0x26ed80(0x255)],baseUrl),await setup({'cookies':generateCookies({'state':expectedDefaultState,'nonce':'__test_nonce__','skipSilentLogin':'1'}),'body':{'state':expectedDefaultState,'id_token':_0x54f6f1},'jar':_0x3f0aa6});const _0x2541af=_0x3f0aa6[_0x26ed80(0x19a)](baseUrl);assert[_0x26ed80(0x254)](_0x2541af['find'](({key:_0x11ed68})=>_0x11ed68===_0x26ed80(0x222)));}),_0x3ead53[_0x10f662(0x215)](context,_0x10f662(0x202),async()=>{const _0x47cd0e=_0x10f662;it(_0x47cd0e(0x1d2),async()=>{const _0x4c9bf1=_0x47cd0e,_0x251c45=makeIdToken({'c_hash':_0x3ead53[_0x4c9bf1(0x18e)]}),_0x76fabc={...defaultConfig,'clientSecret':_0x3ead53['UftQU'],'authorizationParams':{'response_type':_0x4c9bf1(0x247),'audience':_0x3ead53['jgpyS'],'scope':_0x3ead53[_0x4c9bf1(0x243)]},'afterCallback':async(_0x59a1ef,_0xced277,_0x5af209)=>{const _0x42804b=_0x4c9bf1,_0x365ce8=await _0x59a1ef['oidc'][_0x42804b(0x1a5)]();return{..._0x5af209,..._0x365ce8};}},{interceptors:[_0x1a26cf]}=nock(_0x4c9bf1(0x1c3),{'allowUnmocked':!![]})['get'](_0x4c9bf1(0x165))[_0x4c9bf1(0x20d)](0xc8,()=>({'org_id':_0x4c9bf1(0x250)})),_0x3083e1=_0x3ead53[_0x4c9bf1(0x1f2)](auth,_0x76fabc);_0x3083e1['get'](_0x3ead53[_0x4c9bf1(0x1db)],async(_0x149162,_0x402a3b)=>{const _0x18e202=_0x4c9bf1;_0x402a3b[_0x18e202(0x230)]({'session':_0x149162[_0x18e202(0x1b4)]});});const {jar:_0x48ee0d}=await setup({'router':_0x3083e1,'authOpts':{'clientSecret':_0x4c9bf1(0x182),'authorizationParams':{'response_type':_0x3ead53[_0x4c9bf1(0x210)],'audience':_0x3ead53[_0x4c9bf1(0x22d)],'scope':_0x3ead53['fEekI']}},'cookies':_0x3ead53[_0x4c9bf1(0x209)](generateCookies,{'state':expectedDefaultState,'nonce':'__test_nonce__'}),'body':{'state':expectedDefaultState,'id_token':_0x251c45,'code':_0x3ead53[_0x4c9bf1(0x1e5)]}});nock[_0x4c9bf1(0x253)](_0x1a26cf);const _0x4d2d25=await request['get'](_0x4c9bf1(0x1bb),{'baseUrl':baseUrl,'jar':_0x48ee0d,'json':!![]})[_0x4c9bf1(0x1b3)](_0xaa001=>_0xaa001[_0x4c9bf1(0x1ef)]);assert[_0x4c9bf1(0x1a8)](_0x4d2d25[_0x4c9bf1(0x207)][_0x4c9bf1(0x195)],_0x3ead53['LdrXv']);}),it(_0x3ead53[_0x47cd0e(0x1f3)],async()=>{const _0x4e6848=_0x47cd0e,_0x47832c=makeIdToken({'c_hash':_0x4e6848(0x20c)}),_0x53c844={...defaultConfig,'clientSecret':_0x3ead53['UftQU'],'authorizationParams':{'response_type':_0x3ead53[_0x4e6848(0x210)],'audience':_0x4e6848(0x1d6),'scope':_0x3ead53['fEekI']},'afterCallback':async()=>{throw{'status':0x3e7};}},{response:{statusCode:_0x2bf550}}=await _0x3ead53[_0x4e6848(0x21d)](setup,{'router':auth(_0x53c844),'authOpts':_0x53c844,'cookies':_0x3ead53['MCCTE'](generateCookies,{'state':expectedDefaultState,'nonce':'__test_nonce__'}),'body':{'state':expectedDefaultState,'id_token':_0x47832c,'code':_0x3ead53[_0x4e6848(0x1e5)]}});assert['equal'](_0x2bf550,0x3e7);});}),_0x3ead53['zmzUc'](it,_0x10f662(0x23d),async()=>{const _0x480109=_0x10f662,{currentSession:_0x422307,currentUser:_0x1dd051}=await _0x3ead53['fBwTd'](setup,{'cookies':generateCookies({'state':expectedDefaultState,'nonce':_0x480109(0x176)}),'body':{'state':expectedDefaultState,'id_token':makeIdToken({'sub':_0x3ead53[_0x480109(0x197)]})},'existingSession':{'shoppingCartId':'bar','id_token':_0x3ead53[_0x480109(0x1c5)](makeIdToken,{'sub':_0x480109(0x1b6)})}});assert['equal'](_0x1dd051['sub'],_0x3ead53[_0x480109(0x197)]),assert[_0x480109(0x1ce)](_0x422307[_0x480109(0x1d5)]);}),_0x3ead53[_0x10f662(0x1dc)](it,_0x3ead53[_0x10f662(0x184)],async()=>{const _0x2e8bf6=_0x10f662,{currentSession:_0x4421b5,currentUser:_0x3dfa1a}=await _0x3ead53[_0x2e8bf6(0x1d8)](setup,{'cookies':generateCookies({'state':expectedDefaultState,'nonce':'__test_nonce__'}),'body':{'state':expectedDefaultState,'id_token':makeIdToken({'sub':'foo'})},'existingSession':{'shoppingCartId':'bar'}});assert[_0x2e8bf6(0x25a)](_0x3dfa1a[_0x2e8bf6(0x1f5)],_0x3ead53['LNwlM']),assert['equal'](_0x4421b5[_0x2e8bf6(0x1d5)],'bar');}),it(_0x3ead53[_0x10f662(0x24b)],async()=>{const _0x33b7d5=_0x10f662,_0x8c5747=new MemoryStore({'checkPeriod':_0x3ead53[_0x33b7d5(0x241)](0x18*0x3c,0x3e8)}),{currentSession:_0xc6af2f,currentUser:_0x4bac08,existingSessionCookie:_0x2ae23c,jar:_0x5d9394}=await _0x3ead53[_0x33b7d5(0x1ca)](setup,{'cookies':_0x3ead53['nxXkW'](generateCookies,{'state':expectedDefaultState,'nonce':_0x3ead53[_0x33b7d5(0x244)]}),'body':{'state':expectedDefaultState,'id_token':makeIdToken({'sub':_0x33b7d5(0x1b6)})},'existingSession':{'shoppingCartId':_0x33b7d5(0x245)},'authOpts':{'session':{'store':_0x8c5747}}}),_0x5211ee=_0x5d9394[_0x33b7d5(0x19a)](baseUrl),_0x19de52=_0x5211ee[_0x33b7d5(0x1e1)](({key:_0x234d05})=>_0x234d05==='appSession');assert[_0x33b7d5(0x25a)](_0x4bac08[_0x33b7d5(0x1f5)],_0x3ead53[_0x33b7d5(0x168)]),assert[_0x33b7d5(0x25a)](_0xc6af2f[_0x33b7d5(0x1d5)],_0x33b7d5(0x245)),assert['equal'](_0x8c5747[_0x33b7d5(0x20b)][_0x33b7d5(0x1f4)],0x1,_0x3ead53[_0x33b7d5(0x1e2)]),assert[_0x33b7d5(0x235)](_0x2ae23c[_0x33b7d5(0x205)],_0x19de52[_0x33b7d5(0x205)]);}),_0x3ead53[_0x10f662(0x17e)](it,_0x3ead53[_0x10f662(0x22a)],async()=>{const _0x2696a3=_0x10f662,_0x43633c=new MemoryStore({'checkPeriod':0x18*0x3c*0x3e8}),{currentSession:_0x863ad0,currentUser:_0x2424d3,existingSessionCookie:_0x21a1c1,jar:_0x40a7e0}=await setup({'cookies':_0x3ead53[_0x2696a3(0x22b)](generateCookies,{'state':expectedDefaultState,'nonce':_0x3ead53[_0x2696a3(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0x3ead53['Inyta'](makeIdToken,{'sub':'foo'})},'existingSession':{'shoppingCartId':_0x2696a3(0x245),'id_token':_0x3ead53[_0x2696a3(0x1c5)](makeIdToken,{'sub':_0x3ead53['LNwlM']})},'authOpts':{'session':{'store':_0x43633c}}}),_0x4fab0a=_0x40a7e0['getCookies'](baseUrl),_0x135507=_0x4fab0a[_0x2696a3(0x1e1)](({key:_0x9a352b})=>_0x9a352b===_0x2696a3(0x1b4));assert[_0x2696a3(0x25a)](_0x2424d3[_0x2696a3(0x1f5)],_0x3ead53[_0x2696a3(0x168)]),assert['equal'](_0x863ad0['shoppingCartId'],'bar'),assert[_0x2696a3(0x25a)](_0x43633c[_0x2696a3(0x20b)][_0x2696a3(0x1f4)],0x1,_0x2696a3(0x1fc)),assert['equal'](_0x21a1c1['value'],_0x135507[_0x2696a3(0x205)]);}),_0x3ead53[_0x10f662(0x19f)](it,_0x10f662(0x192),async()=>{const _0x1ca336=_0x10f662,_0x117306=new MemoryStore({'checkPeriod':_0x3ead53['DIdnn'](0x18*0x3c,0x3e8)}),{currentSession:_0x549626,currentUser:_0x127520,existingSessionCookie:_0xbd2099,jar:_0x5e8c06}=await _0x3ead53[_0x1ca336(0x208)](setup,{'cookies':_0x3ead53['JEALb'](generateCookies,{'state':expectedDefaultState,'nonce':_0x3ead53[_0x1ca336(0x244)]}),'body':{'state':expectedDefaultState,'id_token':_0x3ead53[_0x1ca336(0x1fd)](makeIdToken,{'sub':_0x3ead53[_0x1ca336(0x197)]})},'existingSession':{'shoppingCartId':_0x1ca336(0x245),'id_token':_0x3ead53['XkWwt'](makeIdToken,{'sub':_0x1ca336(0x1b6)})},'authOpts':{'session':{'store':_0x117306}}}),_0x53449a=_0x5e8c06[_0x1ca336(0x19a)](baseUrl),_0x1b22dd=_0x53449a[_0x1ca336(0x1e1)](({key:_0x4350c9})=>_0x4350c9===_0x1ca336(0x1b4));assert[_0x1ca336(0x25a)](_0x127520['sub'],_0x3ead53['FkHSd']),assert[_0x1ca336(0x1ce)](_0x549626['shoppingCartId']),assert['equal'](_0x117306[_0x1ca336(0x20b)][_0x1ca336(0x1f4)],0x1,'There\x20should\x20only\x20be\x20one\x20session\x20in\x20the\x20store'),assert['notEqual'](_0xbd2099[_0x1ca336(0x205)],_0x1b22dd[_0x1ca336(0x205)]);});});