const _0x27537b=_0x192b;function _0x387b(){const _0x95cb5e=['ZSiEt','ZpOmu','should\x20not\x20throw\x20if\x20another\x20mw\x20writes\x20the\x20header','test','asyncGet','appSession','__foo_user__','160464pWDwcN','writeHead','apple','hyBnM','deepEqual','use','jar','listen','express','CsDqz','should\x20get\x20an\x20existing\x20session','fWZSe','Asbia','sXmNC','util','chai-as-promised','22042998zReWey','VzXZW','should\x20not\x20create\x20a\x20session\x20when\x20there\x20are\x20no\x20cookies','getCookies','TkfAQ','vXNUx','JtkqE','err','5286464sPzrwe','fXKcV','http://example.org','FUgZx','../lib/appSession','5845490tRCPpm','should\x20destroy\x20an\x20existing\x20session','should\x20get\x20a\x20new\x20session','nextTick','hZrup','nosRX','ndeoM','147973ctKrAd','iJgww','get','/session','Asexv','QOEdh','asyncSet','foo','message','appSession=__invalid_identity__','FTZkN','5XNEpOw','close','108nNqoLN','appSession\x20custom\x20store','https://op.example.com','defaults','body','__test_client_id__','storage\x20error','stringify','connect-redis','JxHeJ','post','headersSent','appSession=foo','statusCode','quit','dXsHy','set','createClient','DqPYc','2304984xHCFLy','__test_sub__','PajhX','isEmpty','__test_client_secret__','becomes','equal','6789966PciTAe','mVWac','bind','parse','hJwpk','__test_secret__','../lib/config','uses\x20custom\x20session\x20id\x20generator\x20when\x20provided','session','uKBFg','SPrdF','should\x20not\x20error\x20for\x20non\x20existent\x20sessions'];_0x387b=function(){return _0x95cb5e;};return _0x387b();}function _0x192b(_0x42e6bd,_0x3ebef2){const _0x387b27=_0x387b();return _0x192b=function(_0x192b71,_0x4365c8){_0x192b71=_0x192b71-0xb2;let _0x150382=_0x387b27[_0x192b71];return _0x150382;},_0x192b(_0x42e6bd,_0x3ebef2);}(function(_0x55aa5f,_0x29af5a){const _0x31702c=_0x192b,_0x1745b5=_0x55aa5f();while(!![]){try{const _0x31dd27=parseInt(_0x31702c(0xe6))/0x1+-parseInt(_0x31702c(0x106))/0x2+-parseInt(_0x31702c(0xc2))/0x3*(parseInt(_0x31702c(0xf3))/0x4)+-parseInt(_0x31702c(0xf1))/0x5*(-parseInt(_0x31702c(0x10d))/0x6)+-parseInt(_0x31702c(0xdf))/0x7+parseInt(_0x31702c(0xda))/0x8+parseInt(_0x31702c(0xd2))/0x9;if(_0x31dd27===_0x29af5a)break;else _0x1745b5['push'](_0x1745b5['shift']());}catch(_0x3918ea){_0x1745b5['push'](_0x1745b5['shift']());}}}(_0x387b,0xe9de6));const {promisify}=require(_0x27537b(0xd0)),express=require(_0x27537b(0xca)),{assert}=require('chai')[_0x27537b(0xc7)](require(_0x27537b(0xd1))),request=require('request-promise-native')[_0x27537b(0xf6)]({'simple':![],'resolveWithFullResponse':!![]}),appSession=require(_0x27537b(0xde)),{get:getConfig}=require(_0x27537b(0xb5)),{create:createServer}=require('./fixture/server'),redis=require('redis-mock'),RedisStore=require(_0x27537b(0xfb))({'Store':class Store{}}),defaultConfig={'clientID':_0x27537b(0xf8),'clientSecret':_0x27537b(0x10a),'issuerBaseURL':_0x27537b(0xf5),'baseURL':_0x27537b(0xdc),'secret':_0x27537b(0xb4),'errorOnRequiredAuth':!![]},sessionData=()=>{const _0x223be4=_0x27537b,_0x137e24={'nosRX':function(_0x4ef9a4,_0x28e3c8){return _0x4ef9a4*_0x28e3c8;},'uKBFg':_0x223be4(0x107)},_0x301a05=()=>Date['now']()/0x3e8|0x0,_0x2ce398=_0x301a05(),_0x5d9091=_0x137e24[_0x223be4(0xe4)](0x7*0x18*0x3c,0x3c);return JSON[_0x223be4(0xfa)]({'header':{'uat':_0x2ce398,'iat':_0x2ce398,'exp':_0x2ce398+_0x5d9091},'data':{'sub':_0x137e24[_0x223be4(0xb8)]}});},login=async _0x15f6f0=>{const _0x36ff9e=_0x27537b,_0x5a127b={'Asexv':_0x36ff9e(0xe9)},_0x41752b=request['jar']();return await request['post'](_0x5a127b[_0x36ff9e(0xea)],{'baseUrl':baseUrl,'jar':_0x41752b,'json':_0x15f6f0}),_0x41752b;},baseUrl='http://localhost:3000';describe(_0x27537b(0xf4),()=>{const _0x2232fa=_0x27537b,_0x5f3c47={'iJgww':function(_0x3c3a9a,_0x52f92e){return _0x3c3a9a===_0x52f92e;},'fXKcV':'NHbZz','hZrup':_0x2232fa(0xd6),'DqPYc':'FzLHb','hJwpk':function(_0x2816e7,_0x5ccfb3){return _0x2816e7!==_0x5ccfb3;},'FUgZx':_0x2232fa(0xed),'ndeoM':'/session','ZSiEt':'appSession','PajhX':function(_0x3a64be){return _0x3a64be();},'sXmNC':function(_0x4675f1,_0x4ae168){return _0x4675f1(_0x4ae168);},'mVWac':_0x2232fa(0xc1),'ZpOmu':function(_0x2f04a3){return _0x2f04a3();},'vXNUx':_0x2232fa(0x107),'hyBnM':'FTZkN','vsxWE':function(_0x970125,_0x4608d2){return _0x970125(_0x4608d2);},'Asbia':_0x2232fa(0xf9),'vmEgK':function(_0x1f927d,_0x209518){return _0x1f927d!==_0x209518;},'dXsHy':_0x2232fa(0xcd),'UFGZb':function(_0x3940fc){return _0x3940fc();},'JtkqE':function(_0x585963,_0x9b8711,_0x509e36){return _0x585963(_0x9b8711,_0x509e36);},'GCLww':function(_0x155115,_0x2a7c58,_0x788a7d){return _0x155115(_0x2a7c58,_0x788a7d);},'AfyxV':_0x2232fa(0xba),'DCWIn':_0x2232fa(0xcc),'QOEdh':_0x2232fa(0xb6),'JxHeJ':_0x2232fa(0xbd)};let _0x301c38,_0x20634a;const _0x6c617b=async _0x258803=>{const _0x1b20c2=_0x2232fa;_0x20634a=redis[_0x1b20c2(0x104)]();const _0x5b678d=new RedisStore({'client':_0x20634a,'prefix':''});_0x20634a['asyncSet']=promisify(_0x20634a[_0x1b20c2(0x103)])['bind'](_0x20634a),_0x20634a['asyncGet']=promisify(_0x20634a[_0x1b20c2(0xe8)])['bind'](_0x20634a);const _0x54e7b2=getConfig({...defaultConfig,..._0x258803,'session':{..._0x258803&&_0x258803[_0x1b20c2(0xb7)],'store':_0x5b678d}});_0x301c38=await createServer(appSession(_0x54e7b2));};afterEach(async()=>{const _0x3f43b1=_0x2232fa,_0x2fcbf0={'SPrdF':function(_0x57f854){return _0x57f854();}};_0x5f3c47[_0x3f43b1(0xe7)](_0x5f3c47[_0x3f43b1(0xdb)],_0x5f3c47[_0x3f43b1(0xdb)])?(_0x301c38&&await new Promise(_0x4c0b0f=>_0x301c38[_0x3f43b1(0xf2)](_0x4c0b0f)),_0x20634a&&await new Promise(_0xa76b74=>_0x20634a[_0x3f43b1(0x101)](_0xa76b74))):(_0x5cbfa4['json'](_0x21c636[_0x3f43b1(0xc0)]),_0x2fcbf0[_0x3f43b1(0xb9)](_0x191829));}),_0x5f3c47[_0x2232fa(0xd8)](it,_0x2232fa(0xd4),async()=>{const _0x15e61c=_0x2232fa;if(_0x5f3c47[_0x15e61c(0xe3)]!==_0x5f3c47[_0x15e61c(0x105)]){await _0x6c617b();const _0x3c5d7b=await request[_0x15e61c(0xe8)](_0x15e61c(0xe9),{'baseUrl':baseUrl,'json':!![]});assert[_0x15e61c(0x109)](_0x3c5d7b[_0x15e61c(0xf7)]);}else _0x234d6e[_0x15e61c(0xe2)](()=>_0x452a7b(null,_0x48fd52[_0x15e61c(0xb2)](_0x509ab9())));}),_0x5f3c47['GCLww'](it,_0x5f3c47['AfyxV'],async()=>{const _0x46fde7=_0x2232fa;await _0x6c617b();const _0x1585a0=await request[_0x46fde7(0xe8)](_0x46fde7(0xe9),{'baseUrl':baseUrl,'json':!![],'headers':{'cookie':_0x46fde7(0xef)}});assert[_0x46fde7(0x10c)](_0x1585a0['statusCode'],0xc8),assert[_0x46fde7(0x109)](_0x1585a0[_0x46fde7(0xf7)]);}),it(_0x5f3c47['DCWIn'],async()=>{const _0x54b259=_0x2232fa;if(_0x5f3c47[_0x54b259(0xb3)](_0x54b259(0xd3),_0x54b259(0xcb))){await _0x6c617b(),await _0x20634a['asyncSet'](_0x5f3c47[_0x54b259(0xdd)],sessionData());const _0x462572=request['jar'](),_0x3d784d=await request['get'](_0x5f3c47['ndeoM'],{'baseUrl':baseUrl,'jar':_0x462572,'json':!![],'headers':{'cookie':_0x54b259(0xff)}});assert[_0x54b259(0x10c)](_0x3d784d[_0x54b259(0x100)],0xc8),assert[_0x54b259(0xc6)](_0x3d784d[_0x54b259(0xf7)],{'sub':'__test_sub__'});const [_0x5c5c01]=_0x462572['getCookies'](baseUrl);assert['deepInclude'](_0x5c5c01,{'key':_0x5f3c47[_0x54b259(0xbb)],'value':_0x5f3c47[_0x54b259(0xdd)]});}else _0x27f831[_0x54b259(0xc3)](0xc8);}),it(_0x2232fa(0xe1),async()=>{const _0x4d97c3=_0x2232fa;await _0x5f3c47[_0x4d97c3(0x108)](_0x6c617b);const _0x31b420=await _0x5f3c47[_0x4d97c3(0xcf)](login,{'sub':_0x5f3c47[_0x4d97c3(0x10e)]}),_0x33e349=await request[_0x4d97c3(0xe8)](_0x5f3c47['ndeoM'],{'baseUrl':baseUrl,'jar':_0x31b420,'json':!![]});assert[_0x4d97c3(0x10c)](_0x33e349['statusCode'],0xc8),assert[_0x4d97c3(0xc6)](_0x33e349[_0x4d97c3(0xf7)],{'sub':_0x5f3c47[_0x4d97c3(0x10e)]});}),it(_0x2232fa(0xe0),async()=>{const _0x433c8d=_0x2232fa;await _0x6c617b({'idpLogout':![]}),await _0x20634a[_0x433c8d(0xec)]('foo',_0x5f3c47['ZpOmu'](sessionData));const _0x5f2faf=request['jar'](),_0x97ce24=await request['get'](_0x433c8d(0xe9),{'baseUrl':baseUrl,'jar':_0x5f2faf,'json':!![],'headers':{'cookie':_0x433c8d(0xff)}});assert[_0x433c8d(0xc6)](_0x97ce24['body'],{'sub':_0x5f3c47[_0x433c8d(0xd7)]}),await request[_0x433c8d(0xfd)]('/session',{'baseUrl':baseUrl,'jar':_0x5f2faf,'json':{}});const _0x53e7b1=await request['get'](_0x5f3c47[_0x433c8d(0xe5)],{'baseUrl':baseUrl,'jar':_0x5f2faf,'json':!![]});assert['isEmpty'](_0x53e7b1['body']),assert[_0x433c8d(0x109)](_0x5f2faf[_0x433c8d(0xd5)](baseUrl));}),_0x5f3c47[_0x2232fa(0xd8)](it,_0x5f3c47[_0x2232fa(0xeb)],async()=>{const _0x299b5b=_0x2232fa,_0x5b4ec1=_0x299b5b(0xc4);await _0x5f3c47[_0x299b5b(0xcf)](_0x6c617b,{'session':{'genid':()=>_0x5b4ec1}});const _0xdf61c5=await login({'sub':_0x299b5b(0xc1),'role':_0x299b5b(0xbe),'userid':_0x5b4ec1}),_0x2a900d=await request[_0x299b5b(0xe8)]('/session',{'baseUrl':baseUrl,'jar':_0xdf61c5,'json':!![]});assert[_0x299b5b(0x10c)](_0x2a900d[_0x299b5b(0x100)],0xc8);const _0x4c0344=await _0x20634a[_0x299b5b(0xbf)](_0x5b4ec1),{data:_0x351f7e}=JSON[_0x299b5b(0xb2)](_0x4c0344);assert[_0x299b5b(0xc6)](_0x351f7e,{'sub':_0x5f3c47[_0x299b5b(0x10e)],'role':_0x299b5b(0xbe),'userid':_0x5b4ec1});}),it('should\x20handle\x20storage\x20errors',async()=>{const _0x4d831a=_0x2232fa,_0x498356={'get'(_0x3dfe27,_0x10e385){const _0x569d4e=_0x192b;process[_0x569d4e(0xe2)](()=>_0x10e385(null,JSON[_0x569d4e(0xb2)](sessionData())));},async 'set'(_0x51f129,_0x2c01e8,_0x357eb7){const _0x14e5c7=_0x192b;process[_0x14e5c7(0xe2)](()=>_0x357eb7(new Error(_0x14e5c7(0xf9))));},async 'destroy'(_0xfabbf1,_0x2381a7){const _0x549c08=_0x192b;_0x5f3c47[_0x549c08(0xb3)](_0x549c08(0xf0),_0x5f3c47[_0x549c08(0xc5)])?_0x25b6da[_0x549c08(0xe2)](()=>_0x2e423c(new _0x189197(_0x549c08(0xf9)))):process[_0x549c08(0xe2)](()=>_0x2381a7());}},_0x401c4c=_0x5f3c47['vsxWE'](getConfig,{...defaultConfig,'session':{'store':_0x498356}});_0x301c38=await createServer(appSession(_0x401c4c));const _0x5b1265=request[_0x4d831a(0xc8)](),_0xff143f=await request[_0x4d831a(0xe8)](_0x5f3c47[_0x4d831a(0xe5)],{'baseUrl':baseUrl,'jar':_0x5b1265,'json':!![],'headers':{'cookie':_0x4d831a(0xff)}});assert[_0x4d831a(0x10c)](_0xff143f[_0x4d831a(0x100)],0x1f4),assert[_0x4d831a(0x10c)](_0xff143f[_0x4d831a(0xf7)][_0x4d831a(0xd9)][_0x4d831a(0xee)],_0x5f3c47[_0x4d831a(0xce)]);}),_0x5f3c47[_0x2232fa(0xd8)](it,_0x5f3c47[_0x2232fa(0xfc)],async()=>{const _0x1cbd42=_0x2232fa,_0x680a41=express();_0x20634a=redis['createClient']();const _0x3e99dc=new RedisStore({'client':_0x20634a,'prefix':''});await promisify(_0x20634a[_0x1cbd42(0x103)])[_0x1cbd42(0x10f)](_0x20634a)(_0x5f3c47[_0x1cbd42(0xdd)],_0x5f3c47['UFGZb'](sessionData)),_0x680a41[_0x1cbd42(0xc7)](appSession(_0x5f3c47['sXmNC'](getConfig,{...defaultConfig,'session':{'store':_0x3e99dc}}))),_0x680a41[_0x1cbd42(0xe8)]('/',(_0x5933aa,_0xb44bc6,_0x10f00b)=>{const _0x3ca220=_0x1cbd42;_0xb44bc6['json'](_0x5933aa[_0x3ca220(0xc0)]),_0x5f3c47[_0x3ca220(0xbc)](_0x10f00b);}),_0x680a41[_0x1cbd42(0xc7)]((_0x249519,_0x38c961,_0x132ec8)=>{const _0x52968f=_0x1cbd42;if(_0x5f3c47['vmEgK'](_0x5f3c47[_0x52968f(0x102)],_0x52968f(0xcd))){const _0x5e20be=_0x74a98e[_0x52968f(0xc9)](0xbb8,()=>_0x5e7981(_0x5e20be));}else!_0x38c961[_0x52968f(0xfe)]&&_0x38c961[_0x52968f(0xc3)](0xc8),_0x132ec8();}),_0x301c38=await new Promise(_0x509a2d=>{const _0x119d4f=_0x1cbd42,_0x4d71b0=_0x680a41[_0x119d4f(0xc9)](0xbb8,()=>_0x509a2d(_0x4d71b0));}),await assert[_0x1cbd42(0x10b)](request[_0x1cbd42(0xe8)]('/',{'baseUrl':baseUrl,'json':!![],'headers':{'cookie':_0x1cbd42(0xff)},'resolveWithFullResponse':![]}),{'sub':_0x5f3c47[_0x1cbd42(0xd7)]});});});