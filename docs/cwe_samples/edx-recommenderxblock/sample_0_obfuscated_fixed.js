const _0x46fd3b=_0x4d24;(function(_0x59ea59,_0x152742){const _0x481a60=_0x4d24,_0x3c6c1c=_0x59ea59();while(!![]){try{const _0x54e302=parseInt(_0x481a60(0x18e))/0x1+parseInt(_0x481a60(0x19d))/0x2*(-parseInt(_0x481a60(0x196))/0x3)+parseInt(_0x481a60(0x16e))/0x4*(parseInt(_0x481a60(0x18a))/0x5)+-parseInt(_0x481a60(0x172))/0x6*(-parseInt(_0x481a60(0x189))/0x7)+parseInt(_0x481a60(0x180))/0x8+parseInt(_0x481a60(0x1a4))/0x9+-parseInt(_0x481a60(0x17f))/0xa;if(_0x54e302===_0x152742)break;else _0x3c6c1c['push'](_0x3c6c1c['shift']());}catch(_0x410c98){_0x3c6c1c['push'](_0x3c6c1c['shift']());}}}(_0xb51e,0xe0e3e));import _0x3a82aa from'jsonld-signatures';import*as _0x333737 from'./utils.js';function _0x4d24(_0x2be27b,_0x225e23){const _0xb51e1b=_0xb51e();return _0x4d24=function(_0x4d243d,_0x1d5708){_0x4d243d=_0x4d243d-0x16c;let _0x559667=_0xb51e1b[_0x4d243d];return _0x559667;},_0x4d24(_0x2be27b,_0x225e23);}const {ControllerProofPurpose}=_0x3a82aa[_0x46fd3b(0x1b6)];function _0xb51e(){const _0x39dc77=['A\x20capability\x20in\x20the\x20delegation\x20chain\x20was\x20delegated\x20before\x20','1555693FFfiBG','A\x20delegated\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20a\x20time\x20to\x20','SUSTY','jldKz','less\x20restrictive\x20than\x20its\x20parent.','fcMIJ','pcVSR','wZShG','2629023BCropN','mAsMe','capability\x20(','PsquR','maxClockSkew','expires','Not\x20implemented.','2PcbYnP','compareTime','_runChecksAfterChainVerification','fIoCG','\x22expectedRootCapability\x22\x20must\x20be\x20a\x20string\x20or\x20array.','mSRqm','dereferenceCapabilityChain','14849595rhbBSi','ypInr','SQudN','validate','rHJZs','error','_verifyCapabilityChain','in\x20the\x20future.','hasValidAllowedAction','_getCapabilityDelegationClass','getTime','WMBvU','The\x20\x22invocationTarget\x22\x20in\x20a\x20delegated\x20capability\x20must\x20not\x20be\x20','tKHeN','_getTailCapability','parse','fdoyT','must\x20be\x20equivalent\x20to\x20its\x20parent.','purposes','suite','SyjCe',')\x20does\x20not\x20match\x20expected\x20root\x20','cLBom','ZkhAm','\x22maxClockSkew\x22\x20must\x20be\x20a\x20number.','Actual\x20root\x20capability\x20(','created','_runBaseProofValidation','details','BHnel','length','eIgzH','must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.','iwRyA','shift','bfQbs','_dereferenceChain','string','_runChecksBeforeChainVerification','QhXyJ','HLdIy','checkProofContext','getTarget','bsmjp','isValidTarget','slice','verify','3633140cwcQjT','isArray','oFmiK','SgKtL','6384558pSguck','PbRhd','The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.','its\x20parent.','dereferencedChain','_shortCircuitValidate','YlcFe','The\x20\x22invocationTarget\x22\x20in\x20a\x20delegated\x20capability\x20','The\x20`expires`\x20property\x20in\x20a\x20delegated\x20capability\x20must\x20not\x20','inspectCapabilityChain','allowTargetAttenuation','number','46090730eDmpve','2562024VACacF','includes','expectedRootCapability','maxChainLength','A\x20delegated\x20capability\x20in\x20the\x20delegation\x20chain\x20was\x20delegated\x20','sZDrV','PSXOu','KmHLY','DakGH','7eTbXsW','10uIljIC','push','bciVM'];_0xb51e=function(){return _0x39dc77;};return _0xb51e();}export class CapabilityProofPurpose extends ControllerProofPurpose{constructor({allowTargetAttenuation:allowTargetAttenuation=![],controller:_0x7bd0ce,date:_0x3f80fe,expectedRootCapability:_0x54924a,inspectCapabilityChain:_0x4c44cd,maxChainLength:_0x4b4ef4,maxDelegationTtl:maxDelegationTtl=Infinity,maxTimestampDelta:maxTimestampDelta=Infinity,maxClockSkew:maxClockSkew=0x12c,suite:_0x4ec0fe,term:_0x40880d}={}){const _0xc64c8d=_0x46fd3b,_0x2bdfc1={'sZDrV':function(_0x26d521,_0x2ffc7f){return _0x26d521===_0x2ffc7f;},'PsquR':_0xc64c8d(0x1c9),'HLdIy':'\x22expectedRootCapability\x22\x20values\x20must\x20be\x20absolute\x20URI\x20strings.','bsmjp':_0xc64c8d(0x17e),'wZShG':'nrNEX'};super({'term':_0x40880d,'controller':_0x7bd0ce,'date':_0x3f80fe,'maxTimestampDelta':maxTimestampDelta});const _0x680706=_0x7bd0ce||_0x3f80fe||_0x54924a||_0x4c44cd||_0x4ec0fe;if(_0x680706){if(!(_0x2bdfc1[_0xc64c8d(0x185)](typeof _0x54924a,_0xc64c8d(0x1c9))||Array[_0xc64c8d(0x16f)](_0x54924a)))throw new TypeError(_0xc64c8d(0x1a1));const _0x120ea3=Array['isArray'](_0x54924a)?_0x54924a:[_0x54924a];for(const _0x131199 of _0x120ea3){if(!(typeof _0x131199===_0x2bdfc1[_0xc64c8d(0x199)]&&_0x131199[_0xc64c8d(0x181)](':')))throw new Error(_0x2bdfc1[_0xc64c8d(0x1cc)]);}if(typeof maxClockSkew!==_0x2bdfc1[_0xc64c8d(0x1cf)]){if(_0x2bdfc1[_0xc64c8d(0x195)]===_0x2bdfc1[_0xc64c8d(0x195)])throw new TypeError(_0xc64c8d(0x1bc));else return{'verified':!![]};}this[_0xc64c8d(0x17d)]=allowTargetAttenuation,this[_0xc64c8d(0x182)]=_0x54924a,this[_0xc64c8d(0x17c)]=_0x4c44cd,this[_0xc64c8d(0x183)]=_0x4b4ef4,this[_0xc64c8d(0x19a)]=maxClockSkew,this['maxDelegationTtl']=maxDelegationTtl,this[_0xc64c8d(0x1b7)]=_0x4ec0fe;}}async[_0x46fd3b(0x1a7)](_0x2131c0,_0x34b163){const _0x457d6c=_0x46fd3b,_0x55be0e={'DakGH':'qlkuV','lZqEh':function(_0x61ce7e,_0x202e6e){return _0x61ce7e!==_0x202e6e;},'bfQbs':_0x457d6c(0x194)};try{_0x333737[_0x457d6c(0x1cd)]({'proof':_0x2131c0});const {document:_0x5467c7,documentLoader:_0x4732ef}=_0x34b163,_0x1f4cf7=await this[_0x457d6c(0x178)]({'proof':_0x2131c0,'validateOptions':_0x34b163});if(_0x1f4cf7)return _0x1f4cf7;const {dereferencedChain:_0x4a7e62}=await this[_0x457d6c(0x1c8)]({'document':_0x5467c7,'documentLoader':_0x4732ef,'proof':_0x2131c0}),{capabilityChainMeta:_0xeb3433}=await this[_0x457d6c(0x1ca)]({'dereferencedChain':_0x4a7e62,'proof':_0x2131c0,'validateOptions':_0x34b163}),{verified:_0x520339,error:_0x2ace5a}=await this[_0x457d6c(0x1aa)]({'CapabilityDelegation':this[_0x457d6c(0x1ad)](),'capabilityChainMeta':_0xeb3433,'dereferencedChain':_0x4a7e62,'documentLoader':_0x4732ef});if(!_0x520339)throw _0x2ace5a;const _0x242aa4=await this[_0x457d6c(0x19f)]({'capabilityChainMeta':_0xeb3433,'dereferencedChain':_0x4a7e62,'proof':_0x2131c0,'validateOptions':_0x34b163}),{inspectCapabilityChain:_0x39e12d}=this;if(_0x39e12d){const {valid:_0x394971,error:_0x25d0f4}=await _0x39e12d({'capabilityChain':_0x4a7e62,'capabilityChainMeta':[{'verifyResult':null},..._0xeb3433]});if(!_0x394971){if(_0x457d6c(0x190)===_0x55be0e[_0x457d6c(0x188)]){const _0x48a1cc=new _0x3e2334('Actual\x20root\x20capability\x20('+_0x5868e4+_0x457d6c(0x1b9)+('capability\x20('+_0x46debf+').'));_0x48a1cc[_0x457d6c(0x1c0)]={'actual':_0x44bf54,'expected':_0x272b59};throw _0x48a1cc;}else throw _0x25d0f4;}}return _0x242aa4[_0x457d6c(0x177)]=_0x4a7e62,_0x242aa4;}catch(_0x202e82){if(_0x55be0e['lZqEh'](_0x457d6c(0x194),_0x55be0e[_0x457d6c(0x1c7)]))throw new _0x25fba9(_0x457d6c(0x1a1));else return{'valid':![],'error':_0x202e82};}}async[_0x46fd3b(0x1c8)]({document:_0x497da9,documentLoader:_0xca9494,proof:_0x3714ed}){const _0xd695eb=_0x46fd3b,_0x52c431={'jldKz':function(_0x57005d,_0xaba580){return _0x57005d>_0xaba580;},'QhXyJ':function(_0x270a5c,_0x5eb1b4){return _0x270a5c+_0x5eb1b4;},'oOPOh':'The\x20`expires`\x20property\x20in\x20a\x20delegated\x20capability\x20must\x20not\x20','sMwtm':'be\x20less\x20restrictive\x20than\x20its\x20parent.','oFmiK':_0xd695eb(0x175),'mSRqm':function(_0x32ec22,_0x4e27f4){return _0x32ec22===_0x4e27f4;},'BHnel':_0xd695eb(0x1c9),'fcMIJ':function(_0x33d8f4,_0x307cf6){return _0x33d8f4===_0x307cf6;},'SQudN':function(_0x29ad9b,_0x47c0dc){return _0x29ad9b+_0x47c0dc;}},{expectedRootCapability:_0x51403a,maxChainLength:_0x2c53aa}=this,{capability:_0x411167}=this[_0xd695eb(0x1b2)]({'document':_0x497da9,'proof':_0x3714ed}),{dereferencedChain:_0x49602f}=await _0x333737[_0xd695eb(0x1a3)]({'capability':_0x411167,async 'getRootCapability'({id:_0x3fe2e4}){const _0x187e3d=_0xd695eb;let _0x5d5431;_0x52c431[_0x187e3d(0x1a2)](typeof _0x51403a,_0x52c431[_0x187e3d(0x1c1)])?_0x5d5431=_0x51403a===_0x3fe2e4:_0x5d5431=_0x51403a['includes'](_0x3fe2e4);if(!_0x5d5431){if(_0x52c431[_0x187e3d(0x193)](_0x187e3d(0x1b4),_0x187e3d(0x18c))){if(_0x52c431[_0x187e3d(0x191)](_0x2f7be2,_0x830647))throw new _0x41e279(_0x52c431[_0x187e3d(0x1cb)](_0x52c431['oOPOh'],_0x52c431['sMwtm']));if(_0x3b9d6e[_0x187e3d(0x19e)]({'t1':_0x4c12f0[_0x187e3d(0x1ae)](),'t2':_0x29df8a,'maxClockSkew':_0x1f7841})>0x0)throw new _0x50017c(_0x52c431[_0x187e3d(0x170)]);}else{const _0x454446=new Error(_0x52c431[_0x187e3d(0x1a6)](_0x187e3d(0x1bd)+_0x3fe2e4+_0x187e3d(0x1b9),_0x187e3d(0x198)+_0x51403a+').'));_0x454446[_0x187e3d(0x1c0)]={'actual':_0x3fe2e4,'expected':_0x51403a};throw _0x454446;}}const {document:_0xb38c03}=await _0xca9494(_0x3fe2e4);return{'rootCapability':_0xb38c03};},'maxChainLength':_0x2c53aa});return{'dereferencedChain':_0x49602f};}[_0x46fd3b(0x1ad)](){const _0x53a799=_0x46fd3b,_0xc62107={'PbRhd':_0x53a799(0x19c)};throw new Error(_0xc62107[_0x53a799(0x173)]);}async['_getTailCapability'](){const _0x16022e=_0x46fd3b;throw new Error(_0x16022e(0x19c));}async[_0x46fd3b(0x1ca)](){}async['_runChecksAfterChainVerification'](){}async[_0x46fd3b(0x1bf)]({proof:_0x41c2f3,validateOptions:_0x4df7cd}){const _0x14f541=_0x46fd3b,_0x18fe3e={'YlcFe':function(_0x31b704,_0x5e4f72){return _0x31b704===_0x5e4f72;},'mXMfN':_0x14f541(0x1b8)},_0x414e8a=await super[_0x14f541(0x1a7)](_0x41c2f3,_0x4df7cd);if(!_0x414e8a['valid']){if(_0x18fe3e[_0x14f541(0x179)](_0x18fe3e['mXMfN'],'SyjCe'))throw _0x414e8a['error'];else throw _0x3b6625;}return _0x414e8a;}async[_0x46fd3b(0x178)](){}async[_0x46fd3b(0x1aa)]({CapabilityDelegation:_0x172e2f,capabilityChainMeta:_0xc35ea8,dereferencedChain:_0x2872d0,documentLoader:_0x51519f}){const _0x27e9bc=_0x46fd3b,_0x363daa={'iwRyA':function(_0x1f7bd5,_0x1d634e){return _0x1f7bd5===_0x1d634e;},'WMBvU':_0x27e9bc(0x1ba),'fIoCG':_0x27e9bc(0x1c4),'mAsMe':function(_0x52c700,_0x40ffe0){return _0x52c700+_0x40ffe0;},'KmHLY':_0x27e9bc(0x17b),'ZkhAm':function(_0x3d871e,_0x34ba0a){return _0x3d871e>_0x34ba0a;},'sTEHo':function(_0x369047,_0x4d5b05){return _0x369047>_0x4d5b05;},'SgKtL':function(_0xa71991,_0x41781a){return _0xa71991<_0x41781a;},'eIgzH':_0x27e9bc(0x1b1),'ypInr':function(_0x3e2537,_0x270d3a){return _0x3e2537+_0x270d3a;},'rHJZs':_0x27e9bc(0x1ab),'LwDrR':function(_0x4526d1,_0x317da6){return _0x4526d1-_0x317da6;},'PSXOu':function(_0x3314e2,_0x1a3091){return _0x3314e2>_0x1a3091;}};try{if(_0x363daa[_0x27e9bc(0x1c5)](_0x2872d0[_0x27e9bc(0x1c2)],0x1))return{'verified':!![]};let _0x1fee6b,_0x38d6ed,_0x3b6de6;const [_0x15735c]=_0x2872d0;let {invocationTarget:_0x1bb237}=_0x15735c;const _0xc4974=_0xc35ea8[_0x27e9bc(0x1c2)]>0x0,_0x20d8b0=_0x2872d0[_0x27e9bc(0x16c)](0x1),{allowTargetAttenuation:_0xe62c9,expectedRootCapability:_0x411160,date:_0x5886f1,maxClockSkew:_0x607537,maxDelegationTtl:_0xa49da,suite:_0x3879ee}=this,_0x53940c=_0x5886f1&&new Date(_0x5886f1)||new Date();for(let _0x4f5baf=0x0;_0x4f5baf<_0x20d8b0[_0x27e9bc(0x1c2)];++_0x4f5baf){const _0x467665=_0x20d8b0[_0x4f5baf],_0xc2673c=_0x20d8b0[_0x4f5baf-0x1]||_0x15735c;if(_0xc35ea8[_0x27e9bc(0x1c2)]<_0x20d8b0[_0x27e9bc(0x1c2)]){const _0x38c111=await _0x3a82aa[_0x27e9bc(0x16d)](_0x467665,{'suite':_0x3879ee,'purpose':new _0x172e2f({'allowTargetAttenuation':_0xe62c9,'date':_0x53940c,'expectedRootCapability':_0x411160,'maxDelegationTtl':_0xa49da,'_verifiedParentCapability':_0xc2673c}),'documentLoader':_0x51519f});if(!_0x38c111['verified'])throw _0x38c111[_0x27e9bc(0x1a9)];_0xc35ea8[_0x27e9bc(0x18b)]({'verifyResult':_0x38c111});}const {allowedAction:_0x29203c}=_0x467665;if(!_0x333737[_0x27e9bc(0x1ac)]({'allowedAction':_0x29203c,'parentAllowedAction':_0x1fee6b})){if(_0x363daa[_0x27e9bc(0x1af)]===_0x363daa['WMBvU'])throw new Error(_0x27e9bc(0x174)+_0x363daa[_0x27e9bc(0x1a0)]);else throw new _0x38b0fc('\x22expectedRootCapability\x22\x20values\x20must\x20be\x20absolute\x20URI\x20strings.');}const _0xe6e880=_0x333737[_0x27e9bc(0x1ce)]({'capability':_0x467665});if(!_0x333737[_0x27e9bc(0x1d0)]({'invocationTarget':_0xe6e880,'baseInvocationTarget':_0x1bb237,'allowTargetAttenuation':_0xe62c9})){if(_0xe62c9)throw new Error(_0x363daa['mAsMe'](_0x27e9bc(0x1b0),_0x27e9bc(0x192)));else throw new Error(_0x363daa['mAsMe'](_0x27e9bc(0x17a),_0x27e9bc(0x1b5)));}const _0x48a6a=Date[_0x27e9bc(0x1b3)](_0x467665[_0x27e9bc(0x19b)]);if(_0x3b6de6!==undefined){if(_0x48a6a>_0x3b6de6)throw new Error(_0x363daa[_0x27e9bc(0x197)](_0x363daa[_0x27e9bc(0x187)],'be\x20less\x20restrictive\x20than\x20its\x20parent.'));if(_0x363daa[_0x27e9bc(0x1bb)](_0x333737[_0x27e9bc(0x19e)]({'t1':_0x53940c[_0x27e9bc(0x1ae)](),'t2':_0x48a6a,'maxClockSkew':_0x607537}),0x0))throw new Error(_0x27e9bc(0x175));}const [_0x164e81]=_0x333737['getDelegationProofs']({'capability':_0x467665}),_0x32c31f=Date[_0x27e9bc(0x1b3)](_0x164e81[_0x27e9bc(0x1be)]);if(_0x38d6ed!==undefined&&_0x363daa['sTEHo'](_0x38d6ed,_0x32c31f))throw new Error(_0x363daa[_0x27e9bc(0x197)](_0x27e9bc(0x18d),_0x27e9bc(0x176)));if(_0x363daa[_0x27e9bc(0x171)](_0xa49da,Infinity)){if(_0x333737['compareTime']({'t1':_0x32c31f,'t2':_0x53940c[_0x27e9bc(0x1ae)](),'maxClockSkew':_0x607537})>0x0){if(_0x363daa[_0x27e9bc(0x1c3)]==='tKHeN')throw new Error(_0x363daa[_0x27e9bc(0x1a5)](_0x27e9bc(0x184),_0x363daa[_0x27e9bc(0x1a8)]));else throw _0x53ae8d['error'];}const _0x448889=_0x48a6a-_0x53940c['getTime'](),_0x25be48=_0x363daa['LwDrR'](_0x48a6a,_0x32c31f),_0x38c889=_0x333737[_0x27e9bc(0x19e)]({'t1':_0x448889,'t2':_0xa49da,'maxClockSkew':_0x607537});if(_0x363daa[_0x27e9bc(0x1bb)](_0x38c889,0x0)||_0x363daa[_0x27e9bc(0x186)](_0x25be48,_0xa49da))throw new Error(_0x27e9bc(0x18f)+'live\x20that\x20is\x20too\x20long.');}_0x1fee6b=_0x29203c,_0x3b6de6=_0x48a6a,_0x38d6ed=_0x32c31f,_0x1bb237=_0xe6e880;}return _0xc4974&&_0xc35ea8[_0x27e9bc(0x18b)](_0xc35ea8[_0x27e9bc(0x1c6)]()),{'verified':!![]};}catch(_0x46a220){return{'verified':![],'error':_0x46a220};}}}