'use strict';function _0x1ed0(){const _0x865d6f=['pEnke','ABCDEFGHIJKLMNOPQRSTUVWXYZ','BBEBI','nNEIw','getCall','eql','HKKml','5436984tQwoTt','MessageBuilderBase','error','spy','jDZAA','WnVoW','match','XCXGN','uhElE','pPfhk','GyzXn','copy','callCount','1340144EanYeG','should','ykNLT','eBMCU','585012DUagUa','11916247cscsUC','full_message_body','dDtom','alDTH','slice','9008538AkFOGn','BQCxR','3403165JEHHHZ','length','xLqqr','feed','alloc','should\x20assemble\x20a\x20message\x20body\x20composed\x20of\x20a\x20single\x20chunk\x20','dKcqQ','3214080PIcpXe','IPdsG','ixYJE','node-opcua-utils','PuAJy','should\x20assemble\x20a\x20message\x20body\x20composed\x20of\x20a\x20two\x20chunks\x20','MSG','xhAag','lVYTW','cslot','sinon','jSTaD','SUIFJ','etZkE','HGNvC','RcTfo','4RqgMTa','allocUnsafe','from','chunk'];_0x1ed0=function(){return _0x865d6f;};return _0x1ed0();}const _0x39bba9=_0x29c4;(function(_0x31335b,_0x13355e){const _0x2e1c15=_0x29c4,_0x867469=_0x31335b();while(!![]){try{const _0x531bf2=parseInt(_0x2e1c15(0x15e))/0x1+parseInt(_0x2e1c15(0x136))/0x2+-parseInt(_0x2e1c15(0x162))/0x3+-parseInt(_0x2e1c15(0x146))/0x4*(-parseInt(_0x2e1c15(0x12f))/0x5)+-parseInt(_0x2e1c15(0x12d))/0x6+-parseInt(_0x2e1c15(0x163))/0x7+parseInt(_0x2e1c15(0x151))/0x8;if(_0x531bf2===_0x13355e)break;else _0x867469['push'](_0x867469['shift']());}catch(_0x38e2c4){_0x867469['push'](_0x867469['shift']());}}}(_0x1ed0,0xddd94));const sinon=require(_0x39bba9(0x140)),{BinaryStream}=require('node-opcua-binary-stream'),{compare_buffers}=require(_0x39bba9(0x139)),{MessageBuilderBase,writeTCPMessageHeader}=require('..');function wrap_message_in_chunk(_0x46145f,_0x135d8c){const _0x2a3102=_0x39bba9,_0x4fa0ff={'SrwZt':function(_0x24b2bb,_0x2e4f22){return _0x24b2bb+_0x2e4f22;},'xhAag':_0x2a3102(0x13c)},_0x55a08e=_0x4fa0ff['SrwZt'](_0x46145f['length'],0xc),_0x58136e=Buffer[_0x2a3102(0x147)](_0x55a08e),_0x14a03a=new BinaryStream(_0x58136e);return writeTCPMessageHeader(_0x4fa0ff[_0x2a3102(0x13d)],_0x135d8c,_0x55a08e,_0x14a03a),_0x46145f[_0x2a3102(0x15c)](_0x58136e,0xc),_0x58136e;}function _0x29c4(_0x5aad43,_0x1ec696){const _0x1ed069=_0x1ed0();return _0x29c4=function(_0x29c4ac,_0x5420b6){_0x29c4ac=_0x29c4ac-0x12b;let _0xe9aa50=_0x1ed069[_0x29c4ac];return _0xe9aa50;},_0x29c4(_0x5aad43,_0x1ec696);}describe(_0x39bba9(0x152),function(){const _0x21f741=_0x39bba9,_0x3e4e54={'ixYJE':function(_0x5b8b62,_0x2eee99,_0x38bd4a,_0x19500f){return _0x5b8b62(_0x2eee99,_0x38bd4a,_0x19500f);},'eBMCU':function(_0x3351ad){return _0x3351ad();},'cslot':function(_0x562b27,_0x332cf2,_0x1dfbea,_0x3dd4ad){return _0x562b27(_0x332cf2,_0x1dfbea,_0x3dd4ad);},'cJEwh':_0x21f741(0x14b),'etZkE':'chunk','ykNLT':function(_0x3cfe1c,_0x5436f7){return _0x3cfe1c+_0x5436f7;},'xLqqr':function(_0x39916e,_0x47a8fc,_0x54e7d9,_0x50b2ba,_0xa077a0){return _0x39916e(_0x47a8fc,_0x54e7d9,_0x50b2ba,_0xa077a0);},'IPdsG':'full_message_body','lVYTW':_0x21f741(0x153),'alDTH':function(_0x523556,_0x15e44b){return _0x523556*_0x15e44b;},'XCXGN':function(_0x2215f9,_0x1f12b1,_0x60aea5){return _0x2215f9(_0x1f12b1,_0x60aea5);},'pPfhk':function(_0x51ce60,_0x4a0551,_0x9a6747){return _0x51ce60(_0x4a0551,_0x9a6747);},'HGNvC':function(_0xf4bfd7,_0x50bb60,_0x4b0218){return _0xf4bfd7(_0x50bb60,_0x4b0218);},'uhElE':function(_0x409c72,_0xb5feb0,_0x190a05){return _0x409c72(_0xb5feb0,_0x190a05);},'GyzXn':function(_0x56f9dd,_0x1c963f,_0x304081){return _0x56f9dd(_0x1c963f,_0x304081);},'SUIFJ':function(_0x5ae02b,_0x12c0da){return _0x5ae02b*_0x12c0da;},'BQCxR':_0x21f741(0x13a),'CReiB':function(_0x36241f,_0xb875f7){return _0x36241f*_0xb875f7;},'pEnke':function(_0x13f7f6,_0x25a593){return _0x13f7f6*_0x25a593;},'FYpYE':function(_0x4bc0cd,_0x1c2795,_0x1be474){return _0x4bc0cd(_0x1c2795,_0x1be474);},'WnVoW':function(_0x3cb3b9,_0x5b1ee3){return _0x3cb3b9*_0x5b1ee3;},'RcTfo':function(_0x2a61f6,_0x2daa0a,_0xfe310e){return _0x2a61f6(_0x2daa0a,_0xfe310e);},'dDVfn':function(_0x4782e7,_0x3201a7){return _0x4782e7*_0x3201a7;},'BBEBI':function(_0x4ebade,_0x48c7d1,_0x546e33){return _0x4ebade(_0x48c7d1,_0x546e33);},'jSTaD':function(_0x50d407,_0x5e2c7a){return _0x50d407*_0x5e2c7a;},'jDZAA':function(_0x2aab4f,_0x5221f3,_0x35bc7b){return _0x2aab4f(_0x5221f3,_0x35bc7b);}};it(_0x21f741(0x134),function(_0x75e0a9){const _0x393020=_0x21f741,_0x27e536={'NETnj':function(_0x33fd35,_0x12be56,_0x42b1e8,_0x3b043a){const _0x4270ee=_0x29c4;return _0x3e4e54[_0x4270ee(0x13f)](_0x33fd35,_0x12be56,_0x42b1e8,_0x3b043a);}},_0x472643=Buffer[_0x393020(0x148)](_0x3e4e54['cJEwh']),_0x5acff1=wrap_message_in_chunk(_0x472643,'F'),_0x5b00d6=new MessageBuilderBase();_0x5b00d6['on'](_0x393020(0x164),function(_0x43a7a4){const _0xc5a77c=_0x393020;_0x3e4e54[_0xc5a77c(0x138)](compare_buffers,_0x43a7a4,_0x472643,_0x472643[_0xc5a77c(0x130)]),_0x3e4e54[_0xc5a77c(0x161)](_0x75e0a9);}),_0x5b00d6['on'](_0x3e4e54[_0x393020(0x143)],_0x515cba=>{_0x27e536['NETnj'](compare_buffers,_0x515cba,_0x5acff1,_0x5acff1['length']);}),_0x5b00d6['feed'](_0x5acff1);}),it(_0x21f741(0x13b),function(_0x474adb){const _0xba0c62=_0x21f741,_0x4062c2={'TTSVj':function(_0x41a327,_0x163879){const _0x3a2174=_0x29c4;return _0x3e4e54[_0x3a2174(0x160)](_0x41a327,_0x163879);},'QUCMn':function(_0x38fc38,_0xe813f5,_0x5be41d,_0x50e763,_0xc2d239){const _0x47f948=_0x29c4;return _0x3e4e54[_0x47f948(0x131)](_0x38fc38,_0xe813f5,_0x5be41d,_0x50e763,_0xc2d239);},'HKKml':_0xba0c62(0x135),'nNEIw':function(_0x3800a2,_0x35b7db,_0x54383d,_0x526629){return _0x3800a2(_0x35b7db,_0x54383d,_0x526629);}},_0x39723c=Buffer[_0xba0c62(0x148)](_0xba0c62(0x14b)),_0x5d2800=wrap_message_in_chunk(_0x39723c['slice'](0x0,0xa),'C'),_0x8bba92=wrap_message_in_chunk(_0x39723c['slice'](0xa),'F'),_0x422497=new MessageBuilderBase();_0x422497['on'](_0xba0c62(0x164),function(_0xd35bd6){const _0xb2de0=_0xba0c62;if(_0x4062c2[_0xb2de0(0x150)]!==_0xb2de0(0x165))_0x4062c2[_0xb2de0(0x14d)](compare_buffers,_0xd35bd6,_0x39723c,_0x39723c[_0xb2de0(0x130)]),_0x474adb();else{const _0x327735=_0x4062c2['TTSVj'](_0x271e24[_0xb2de0(0x130)],0xc),_0x18fe29=_0x5bd2b0[_0xb2de0(0x147)](_0x327735),_0x5ac225=new _0x206e34(_0x18fe29);return _0x4062c2['QUCMn'](_0xa05e87,_0xb2de0(0x13c),_0x58fe40,_0x327735,_0x5ac225),_0x1b03fe['copy'](_0x18fe29,0xc),_0x18fe29;}});const _0x4cf911=[_0x5d2800,_0x8bba92];let _0x3665cf=0x0;_0x422497['on'](_0xba0c62(0x149),_0x1a5226=>{const _0x311e04=_0xba0c62,_0x5de638=_0x4cf911[_0x3665cf];_0x3665cf+=0x1,compare_buffers(_0x1a5226,_0x5de638,_0x5de638[_0x311e04(0x130)]);}),_0x422497['feed'](_0x5d2800),_0x422497[_0xba0c62(0x132)](_0x8bba92);}),_0x3e4e54[_0x21f741(0x155)](it,'should\x20not\x20allow\x20more\x20chunks\x20that\x20maxChunkCount\x20',function(_0x238cfb){const _0x53e850=_0x21f741,_0x4cf6ad=new MessageBuilderBase({'maxChunkCount':0x5,'maxMessageSize':0x40*0x400}),_0x265110=sinon['spy']();_0x4cf6ad['on']('chunk',_0x265110);const _0x366797=sinon[_0x53e850(0x154)]();_0x4cf6ad['on'](_0x3e4e54[_0x53e850(0x137)],_0x366797);const _0x50b675=sinon[_0x53e850(0x154)]();_0x4cf6ad['on'](_0x3e4e54[_0x53e850(0x13e)],_0x50b675);const _0x30f9bf=Buffer[_0x53e850(0x133)](_0x3e4e54[_0x53e850(0x12b)](0x10,0x400)),_0x4191ce=_0x3e4e54[_0x53e850(0x158)](wrap_message_in_chunk,_0x30f9bf[_0x53e850(0x12c)](0x0*0x400,0x1*0x400),'C'),_0x1cd4f3=wrap_message_in_chunk(_0x30f9bf['slice'](0x1*0x400,0x2*0x400),'C'),_0x53d091=_0x3e4e54[_0x53e850(0x15a)](wrap_message_in_chunk,_0x30f9bf[_0x53e850(0x12c)](0x2*0x400,_0x3e4e54[_0x53e850(0x12b)](0x3,0x400)),'C'),_0x1389cd=_0x3e4e54['HGNvC'](wrap_message_in_chunk,_0x30f9bf['slice'](0x3*0x400,_0x3e4e54[_0x53e850(0x12b)](0x4,0x400)),'C'),_0x21993e=_0x3e4e54[_0x53e850(0x144)](wrap_message_in_chunk,_0x30f9bf[_0x53e850(0x12c)](0x4*0x400,0x5*0x400),'C'),_0x429d0b=_0x3e4e54[_0x53e850(0x159)](wrap_message_in_chunk,_0x30f9bf[_0x53e850(0x12c)](_0x3e4e54[_0x53e850(0x12b)](0x5,0x400),_0x3e4e54['alDTH'](0x6,0x400)),'C'),_0x5b5579=_0x3e4e54[_0x53e850(0x15b)](wrap_message_in_chunk,_0x30f9bf['slice'](_0x3e4e54['SUIFJ'](0x6,0x400),0x7*0x400),'F');_0x4cf6ad['feed'](_0x4191ce),_0x4cf6ad[_0x53e850(0x132)](_0x1cd4f3),_0x4cf6ad[_0x53e850(0x132)](_0x53d091),_0x4cf6ad[_0x53e850(0x132)](_0x1389cd),_0x4cf6ad['feed'](_0x21993e),_0x4cf6ad['feed'](_0x429d0b),_0x4cf6ad[_0x53e850(0x132)](_0x5b5579),_0x265110['callCount'][_0x53e850(0x15f)][_0x53e850(0x14f)](0x6),_0x50b675[_0x53e850(0x15d)][_0x53e850(0x15f)]['eql'](0x1),_0x366797[_0x53e850(0x15d)][_0x53e850(0x15f)][_0x53e850(0x14f)](0x0),_0x50b675['getCall'](0x0)['args'][0x0][_0x53e850(0x15f)][_0x53e850(0x157)](/max chunk count exceeded/),_0x238cfb();}),it('should\x20not\x20allow\x20message\x20bigger\x20than\x20maxMessageSize\x20',function(_0xe07420){const _0x2f15a7=_0x21f741;if(_0x2f15a7(0x13a)!==_0x3e4e54[_0x2f15a7(0x12e)])_0x34cda6(_0xb87f84,_0x4075c4,_0x59dfe4[_0x2f15a7(0x130)]),_0x442f87();else{const _0x7c554b=new MessageBuilderBase({'maxChunkCount':0x3e8,'maxMessageSize':_0x3e4e54[_0x2f15a7(0x142)](0x4,0x400)}),_0x406166=sinon[_0x2f15a7(0x154)]();_0x7c554b['on']('chunk',_0x406166);const _0x3b9c8e=sinon[_0x2f15a7(0x154)]();_0x7c554b['on'](_0x3e4e54[_0x2f15a7(0x137)],_0x3b9c8e);const _0x19ffcb=sinon[_0x2f15a7(0x154)]();_0x7c554b['on'](_0x3e4e54['lVYTW'],_0x19ffcb);const _0xf974e2=Buffer[_0x2f15a7(0x133)](_0x3e4e54['CReiB'](0x10,0x400)),_0x131ec8=wrap_message_in_chunk(_0xf974e2[_0x2f15a7(0x12c)](_0x3e4e54[_0x2f15a7(0x14a)](0x0,0x400),0x1*0x400),'C'),_0x30ff61=_0x3e4e54['FYpYE'](wrap_message_in_chunk,_0xf974e2[_0x2f15a7(0x12c)](_0x3e4e54[_0x2f15a7(0x156)](0x1,0x400),0x2*0x400),'C'),_0x105164=_0x3e4e54[_0x2f15a7(0x159)](wrap_message_in_chunk,_0xf974e2[_0x2f15a7(0x12c)](0x2*0x400,0x3*0x400),'C'),_0x35425c=_0x3e4e54[_0x2f15a7(0x145)](wrap_message_in_chunk,_0xf974e2[_0x2f15a7(0x12c)](0x3*0x400,0x4*0x400),'C'),_0x5b0d60=wrap_message_in_chunk(_0xf974e2['slice'](_0x3e4e54['pEnke'](0x4,0x400),_0x3e4e54['dDVfn'](0x5,0x400)),'C'),_0x171304=_0x3e4e54[_0x2f15a7(0x14c)](wrap_message_in_chunk,_0xf974e2[_0x2f15a7(0x12c)](_0x3e4e54[_0x2f15a7(0x141)](0x5,0x400),_0x3e4e54['CReiB'](0x6,0x400)),'C'),_0xa2c82a=_0x3e4e54['GyzXn'](wrap_message_in_chunk,_0xf974e2[_0x2f15a7(0x12c)](0x6*0x400,0x7*0x400),'F');_0x7c554b[_0x2f15a7(0x132)](_0x131ec8),_0x7c554b[_0x2f15a7(0x132)](_0x30ff61),_0x7c554b['feed'](_0x105164),_0x7c554b[_0x2f15a7(0x132)](_0x35425c),_0x7c554b['feed'](_0x5b0d60),_0x7c554b[_0x2f15a7(0x132)](_0x171304),_0x7c554b[_0x2f15a7(0x132)](_0xa2c82a),_0x406166[_0x2f15a7(0x15d)][_0x2f15a7(0x15f)][_0x2f15a7(0x14f)](0x4),_0x19ffcb[_0x2f15a7(0x15d)][_0x2f15a7(0x15f)][_0x2f15a7(0x14f)](0x1),_0x3b9c8e[_0x2f15a7(0x15d)][_0x2f15a7(0x15f)][_0x2f15a7(0x14f)](0x0),_0x19ffcb[_0x2f15a7(0x14e)](0x0)['args'][0x0][_0x2f15a7(0x15f)][_0x2f15a7(0x157)](/maxMessageSize/),_0x3e4e54[_0x2f15a7(0x161)](_0xe07420);}});});