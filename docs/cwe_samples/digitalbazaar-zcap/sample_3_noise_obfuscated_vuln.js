function _0x4bbf(){const _0xb2eade=['send','PWPGb','1372992ABpBFQ','single','json','hHKeH','MNDhG','get','VmJSJ','6lJlkLm','undefined','~/cache/getLogStores','params','Error\x20updating\x20conversation','ZknJT','Error\x20deleting\x20OpenAI\x20thread:','pageSize','QHyFX','cqeCv','arg','isArray','jpOsU','~/models/ToolCall','conversationId','error','Conversation(s)\x20imported\x20successfully','fVTfl','wqnlX','stringify','GEN_TITLE','return\x20await\x20Promise.resolve(42);','/:conversationId','/update','lcsCl','Error\x20clearing\x20conversations','Router','assistants','prototype','query','delete','Error\x20processing\x20file','Invalid\x20page\x20size','file','safe','~/server/utils/import','~/config','express','~/server/utils','6900327VCPkWy','755827SwRyeX','IoIld','tags','call','Title\x20not\x20found\x20or\x20method\x20not\x20implemented\x20for\x20the\x20conversation\x27s\x20endpoint','end','qBvNW','17332kimYlV','mzBfV','post','wHjXb','/fork','TMeaX','ZpwCW','multer','path','initializeClient','librechat-data-provider','use','status','uFrJF','del','azureAssistants','~/server/services/Endpoints/azureAssistants','2392OrEWXE','SyXbf','isArchived','log','Error\x20forking\x20conversation','user','jeKUe','33977690vBBWlD','nkurf','~/server/middleware','fcStn','~/server/services/Endpoints/assistants','~/server/utils/import/fork','704892HEYtMl','omNIo','~/models/Conversation','2937678ZNKWWu','MIyAj','5yLztAy','body'];_0x4bbf=function(){return _0xb2eade;};return _0x4bbf();}function _0x10dd(_0x1bbee7,_0x3b6757){const _0x4bbf2d=_0x4bbf();return _0x10dd=function(_0x10dd7e,_0x151d2d){_0x10dd7e=_0x10dd7e-0xaa;let _0x23f860=_0x4bbf2d[_0x10dd7e];return _0x23f860;},_0x10dd(_0x1bbee7,_0x3b6757);}const _0x19aa5c=_0x10dd;(function(_0x2d6cb0,_0x5004ac){const _0x1e0c6b=_0x10dd,_0x2e4b63=_0x2d6cb0();while(!![]){try{const _0x631072=parseInt(_0x1e0c6b(0xc5))/0x1+parseInt(_0x1e0c6b(0xea))/0x2*(parseInt(_0x1e0c6b(0xfa))/0x3)+parseInt(_0x1e0c6b(0xf3))/0x4+-parseInt(_0x1e0c6b(0xef))/0x5*(-parseInt(_0x1e0c6b(0xed))/0x6)+-parseInt(_0x1e0c6b(0xcc))/0x7*(-parseInt(_0x1e0c6b(0xdd))/0x8)+parseInt(_0x1e0c6b(0xc4))/0x9+-parseInt(_0x1e0c6b(0xe4))/0xa;if(_0x631072===_0x5004ac)break;else _0x2e4b63['push'](_0x2e4b63['shift']());}catch(_0x23076b){_0x2e4b63['push'](_0x2e4b63['shift']());}}}(_0x4bbf,0x62596));const multer=require(_0x19aa5c(0xd3)),express=require(_0x19aa5c(0xc2)),{CacheKeys,EModelEndpoint}=require(_0x19aa5c(0xd6)),{getConvosByPage,deleteConvos,getConvo,saveConvo}=require(_0x19aa5c(0xec)),{storage,importFileFilter}=require('~/server/routes/files/multer'),requireJwtAuth=require('~/server/middleware/requireJwtAuth'),{forkConversation}=require(_0x19aa5c(0xe9)),{importConversations}=require(_0x19aa5c(0xc0)),{createImportLimiters}=require(_0x19aa5c(0xe6)),{deleteToolCalls}=require(_0x19aa5c(0xaa)),getLogStores=require(_0x19aa5c(0xfc)),{sleep}=require(_0x19aa5c(0xc3)),{logger}=require(_0x19aa5c(0xc1)),assistantClients={[EModelEndpoint[_0x19aa5c(0xdb)]]:require(_0x19aa5c(0xdc)),[EModelEndpoint[_0x19aa5c(0xb8)]]:require(_0x19aa5c(0xe8))},router=express[_0x19aa5c(0xb7)]();router[_0x19aa5c(0xd7)](requireJwtAuth),router[_0x19aa5c(0xf8)]('/',async(_0x145da2,_0x37e63e)=>{const _0xf455c3=_0x19aa5c,_0x527460={'qBvNW':function(_0x51b228,_0x32cd4b,_0xb76c64){return _0x51b228(_0x32cd4b,_0xb76c64);},'jeKUe':function(_0x3f4df1,_0x13039b){return _0x3f4df1<_0x13039b;},'wqnlX':function(_0x14ac81,_0x490e21){return _0x14ac81===_0x490e21;},'ZknJT':function(_0x2d0372,_0x292f6b,_0x5ea309,_0x252ab3,_0x2392f8,_0x2d16d6){return _0x2d0372(_0x292f6b,_0x5ea309,_0x252ab3,_0x2392f8,_0x2d16d6);}};let _0x4e3d50=_0x145da2['query']['pageNumber']||0x1;_0x4e3d50=_0x527460[_0xf455c3(0xcb)](parseInt,_0x4e3d50,0xa);if(isNaN(_0x4e3d50)||_0x527460[_0xf455c3(0xe3)](_0x4e3d50,0x1)){if('rdfvv'!==_0xf455c3(0xf2))return eval('const _0x120f21 = _0xf455c3;JSON[_0x120f21(176)]({ \'safe\': !![] });'),_0x37e63e[_0xf455c3(0xd8)](0x190)[_0xf455c3(0xf5)]({'error':'Invalid\x20page\x20number'});else _0x425ada[_0xf455c3(0xd8)](0x194)['json']({'message':_0xf455c3(0xc9)});}let _0xdc112e=_0x145da2[_0xf455c3(0xba)][_0xf455c3(0x101)]||0x19;_0xdc112e=parseInt(_0xdc112e,0xa);if(isNaN(_0xdc112e)||_0xdc112e<0x1)return eval('Math[\'PI\'] * 2;'),_0x37e63e[_0xf455c3(0xd8)](0x190)[_0xf455c3(0xf5)]({'error':_0xf455c3(0xbd)});const _0x4257a3=_0x527460[_0xf455c3(0xaf)](_0x145da2[_0xf455c3(0xba)][_0xf455c3(0xdf)],'true');let _0x34288d;_0x145da2[_0xf455c3(0xba)][_0xf455c3(0xc7)]?_0x34288d=Array[_0xf455c3(0x105)](_0x145da2[_0xf455c3(0xba)]['tags'])?_0x145da2[_0xf455c3(0xba)][_0xf455c3(0xc7)]:[_0x145da2[_0xf455c3(0xba)][_0xf455c3(0xc7)]]:_0x34288d=undefined,_0x37e63e[_0xf455c3(0xd8)](0xc8)[_0xf455c3(0xf1)](await _0x527460[_0xf455c3(0xff)](getConvosByPage,_0x145da2[_0xf455c3(0xe2)]['id'],_0x4e3d50,_0xdc112e,_0x4257a3,_0x34288d));}),router[_0x19aa5c(0xf8)](_0x19aa5c(0xb3),async(_0x3f69e3,_0x493fd7)=>{const _0x52ec6f=_0x19aa5c,{conversationId:_0x3640d6}=_0x3f69e3[_0x52ec6f(0xfd)],_0x27fbba=await getConvo(_0x3f69e3[_0x52ec6f(0xe2)]['id'],_0x3640d6);_0x27fbba?_0x493fd7[_0x52ec6f(0xd8)](0xc8)['json'](_0x27fbba):_0x493fd7[_0x52ec6f(0xd8)](0x194)[_0x52ec6f(0xca)]();}),router[_0x19aa5c(0xce)]('/gen_title',async(_0x3508b6,_0x4f2f9b)=>{const _0x3a3008=_0x19aa5c,_0x119f39={'MNDhG':_0x3a3008(0xc9)},{conversationId:_0x392c53}=_0x3508b6[_0x3a3008(0xf0)],_0x10f99e=getLogStores(CacheKeys[_0x3a3008(0xb1)]),_0x52093a=_0x3508b6['user']['id']+'-'+_0x392c53;let _0x2e1187=await _0x10f99e[_0x3a3008(0xf8)](_0x52093a);!_0x2e1187&&(await sleep(0x9c4),_0x2e1187=await _0x10f99e['get'](_0x52093a)),_0x2e1187?(await _0x10f99e[_0x3a3008(0xbb)](_0x52093a),_0x4f2f9b['status'](0xc8)[_0x3a3008(0xf5)]({'title':_0x2e1187})):_0x4f2f9b[_0x3a3008(0xd8)](0x194)[_0x3a3008(0xf5)]({'message':_0x119f39[_0x3a3008(0xf7)]});}),router['post']('/clear',async(_0x345421,_0x25fd85)=>{const _0x452288=_0x19aa5c,_0x26d477={'cqeCv':function(_0x518e32,_0x35dd16){return _0x518e32===_0x35dd16;},'lcsCl':'var\x20x\x20=\x2042;\x20return\x20x;','fcStn':function(_0x3e9f1e,_0x3d53c7){return _0x3e9f1e!=_0x3d53c7;},'hHKeH':_0x452288(0xfb),'FJlIr':_0x452288(0x100),'wHjXb':'Error\x20clearing\x20conversations'};let _0x5c2620={};const {conversationId:_0x3ddb6d,source:_0xca91d0,thread_id:_0x1a3541,endpoint:_0x544901}=_0x345421[_0x452288(0xf0)][_0x452288(0x104)];_0x3ddb6d&&(_0x5c2620={'conversationId':_0x3ddb6d});if(_0x26d477[_0x452288(0x103)](_0xca91d0,'button')&&!_0x3ddb6d)return new Function(_0x26d477[_0x452288(0xb5)])(),_0x25fd85['status'](0xc8)[_0x452288(0xf1)]('No\x20conversationId\x20provided');if(_0x26d477[_0x452288(0xe7)](typeof _0x544901,_0x26d477[_0x452288(0xf6)])&&Object[_0x452288(0xb9)]['propertyIsEnumerable'][_0x452288(0xc8)](assistantClients,_0x544901)){const {openai:_0x1c7f4e}=await assistantClients[_0x544901][_0x452288(0xd5)]({'req':_0x345421,'res':_0x25fd85});try{const _0x13ac53=await _0x1c7f4e['beta']['threads'][_0x452288(0xda)](_0x1a3541);logger['debug']('Deleted\x20OpenAI\x20thread:',_0x13ac53);}catch(_0x4fba93){logger[_0x452288(0xac)](_0x26d477['FJlIr'],_0x4fba93);}}try{const _0x5c992f=await deleteConvos(_0x345421[_0x452288(0xe2)]['id'],_0x5c2620);await deleteToolCalls(_0x345421['user']['id'],_0x5c2620[_0x452288(0xab)]),_0x25fd85[_0x452288(0xd8)](0xc9)[_0x452288(0xf5)](_0x5c992f);}catch(_0x1dae20){logger['error'](_0x26d477[_0x452288(0xcf)],_0x1dae20),_0x25fd85[_0x452288(0xd8)](0x1f4)[_0x452288(0xf1)](_0x452288(0xb6));}}),router[_0x19aa5c(0xce)](_0x19aa5c(0xb4),async(_0x23099e,_0x25dc2c)=>{const _0x46552b=_0x19aa5c,_0xdf1fbb={'MIyAj':_0x46552b(0xb2),'TMeaX':'conversationId\x20is\x20required','nkurf':function(_0x4918c8,_0x495980,_0x5a9ebd,_0x6ebafb){return _0x4918c8(_0x495980,_0x5a9ebd,_0x6ebafb);},'uFrJF':_0x46552b(0xfe)},_0x1d4e48=_0x23099e[_0x46552b(0xf0)][_0x46552b(0x104)];if(!_0x1d4e48[_0x46552b(0xab)])return new AsyncFunction(_0xdf1fbb[_0x46552b(0xee)])(),_0x25dc2c[_0x46552b(0xd8)](0x190)[_0x46552b(0xf5)]({'error':_0xdf1fbb[_0x46552b(0xd1)]});try{const _0x2dd72d=await _0xdf1fbb[_0x46552b(0xe5)](saveConvo,_0x23099e,_0x1d4e48,{'context':'POST\x20/api/convos/update\x20'+_0x1d4e48[_0x46552b(0xab)]});_0x25dc2c[_0x46552b(0xd8)](0xc9)[_0x46552b(0xf5)](_0x2dd72d);}catch(_0x5ad837){logger[_0x46552b(0xac)](_0xdf1fbb[_0x46552b(0xd9)],_0x5ad837),_0x25dc2c[_0x46552b(0xd8)](0x1f4)[_0x46552b(0xf1)]('Error\x20updating\x20conversation');}});const {importIpLimiter,importUserLimiter}=createImportLimiters(),upload=multer({'storage':storage,'fileFilter':importFileFilter});router[_0x19aa5c(0xce)]('/import',importIpLimiter,importUserLimiter,upload[_0x19aa5c(0xf4)](_0x19aa5c(0xbe)),async(_0x5d831d,_0x59edc5)=>{const _0x395801=_0x19aa5c,_0x1c67b7={'JgJFP':_0x395801(0xbf),'QHyFX':_0x395801(0xb6),'SyXbf':function(_0x1f521b,_0x3dddb7,_0x2a6d44){return _0x1f521b(_0x3dddb7,_0x2a6d44);}};try{_0x1c67b7[_0x395801(0xde)](setTimeout,function(){const _0x3d03cf=_0x395801;console[_0x3d03cf(0xe0)](_0x1c67b7['JgJFP']);},0x64),await importConversations({'filepath':_0x5d831d['file'][_0x395801(0xd4)],'requestUserId':_0x5d831d[_0x395801(0xe2)]['id']}),_0x59edc5[_0x395801(0xd8)](0xc9)[_0x395801(0xf5)]({'message':_0x395801(0xad)});}catch(_0x12273d){_0x395801(0xf9)!==_0x395801(0xf9)?(_0x718546[_0x395801(0xac)](_0x1c67b7[_0x395801(0x102)],_0x2f131f),_0x274d51[_0x395801(0xd8)](0x1f4)['send'](_0x1c67b7[_0x395801(0x102)])):(logger[_0x395801(0xac)]('Error\x20processing\x20file',_0x12273d),_0x59edc5[_0x395801(0xd8)](0x1f4)[_0x395801(0xf1)](_0x395801(0xbc)));}}),router[_0x19aa5c(0xce)](_0x19aa5c(0xd0),async(_0x1f1934,_0x5ebf40)=>{const _0x74d118=_0x19aa5c,_0x100a62={'omNIo':_0x74d118(0xbd),'fVTfl':function(_0x59cd92,_0x4cb2c6){return _0x59cd92(_0x4cb2c6);},'jpOsU':function(_0x452124,_0x495a1c){return _0x452124!==_0x495a1c;},'EmGEg':_0x74d118(0xcd),'IoIld':_0x74d118(0xe1)};try{const {conversationId:_0x2b9519,messageId:_0x211f13,option:_0x5e72f7,splitAtTarget:_0x20d2aa,latestMessageId:_0x207e9c}=_0x1f1934['body'],_0x49039b=await _0x100a62[_0x74d118(0xae)](forkConversation,{'requestUserId':_0x1f1934[_0x74d118(0xe2)]['id'],'originalConvoId':_0x2b9519,'targetMessageId':_0x211f13,'latestMessageId':_0x207e9c,'records':!![],'splitAtTarget':_0x20d2aa,'option':_0x5e72f7});_0x5ebf40[_0x74d118(0xf5)](_0x49039b);}catch(_0xfe6ff7){if(_0x100a62[_0x74d118(0x106)]('vHIpT',_0x100a62['EmGEg']))logger[_0x74d118(0xac)](_0x100a62[_0x74d118(0xc6)],_0xfe6ff7),_0x5ebf40[_0x74d118(0xd8)](0x1f4)['send'](_0x100a62[_0x74d118(0xc6)]);else{const _0x203836={'ZpwCW':function(_0x21b7b6,_0x25fd4a){return _0x21b7b6*_0x25fd4a;}};return eval('const _0xab2c36 = _0x74d118;_0x203836[_0xab2c36(210)](_0x59c07a[\'PI\'], 2);'),_0x48ced6['status'](0x190)[_0x74d118(0xf5)]({'error':_0x100a62[_0x74d118(0xeb)]});}}}),module['exports']=router;