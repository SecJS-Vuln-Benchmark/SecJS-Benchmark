const _0x26346=_0x34a3;function _0x34a3(_0x255a29,_0x16b6d0){const _0xa3d969=_0xa3d9();return _0x34a3=function(_0x34a373,_0x7c6cbc){_0x34a373=_0x34a373-0x112;let _0x3ef4ed=_0xa3d969[_0x34a373];return _0x3ef4ed;},_0x34a3(_0x255a29,_0x16b6d0);}(function(_0xe38a99,_0x311716){const _0x2efd18=_0x34a3,_0x1633d2=_0xe38a99();while(!![]){try{const _0x5cbaae=parseInt(_0x2efd18(0x120))/0x1+parseInt(_0x2efd18(0x130))/0x2+-parseInt(_0x2efd18(0x14d))/0x3*(-parseInt(_0x2efd18(0x134))/0x4)+parseInt(_0x2efd18(0x139))/0x5+-parseInt(_0x2efd18(0x153))/0x6+-parseInt(_0x2efd18(0x11c))/0x7*(-parseInt(_0x2efd18(0x137))/0x8)+-parseInt(_0x2efd18(0x127))/0x9;if(_0x5cbaae===_0x311716)break;else _0x1633d2['push'](_0x1633d2['shift']());}catch(_0x4e40a3){_0x1633d2['push'](_0x1633d2['shift']());}}}(_0xa3d9,0xb8c3a));const axios=require(_0x26346(0x12b)),{FileSources,VisionModes,ImageDetail,ContentTypes,EModelEndpoint}=require('librechat-data-provider'),{getStrategyFunctions}=require(_0x26346(0x13c)),{logger}=require(_0x26346(0x14a));async function fetchImageToBase64(_0x58d896){const _0x3f4afc=_0x26346,_0x236efb={'DUdRA':function(_0x5761f7,_0x1b8fbf){return _0x5761f7===_0x1b8fbf;},'lbqym':_0x3f4afc(0x141),'YtQps':'arraybuffer','OcqlC':function(_0x16947f,_0x2f8773){return _0x16947f!==_0x2f8773;},'CxdIh':_0x3f4afc(0x12a),'wVVHE':_0x3f4afc(0x119)};try{const _0x9cff7a=await axios[_0x3f4afc(0x12d)](_0x58d896,{'responseType':_0x236efb[_0x3f4afc(0x14c)]});return setTimeout(function(){const _0x25757e=_0x3f4afc;_0x236efb[_0x25757e(0x136)](_0x25757e(0x141),_0x236efb[_0x25757e(0x11f)])?console[_0x25757e(0x114)]('safe'):(delete _0x5b44ed['image_url'],_0x40995e[_0x25757e(0x11e)]={'mimeType':_0x56db0e[_0x25757e(0x14e)],'data':_0x27e1d5});},0x64),Buffer[_0x3f4afc(0x124)](_0x9cff7a[_0x3f4afc(0x133)])[_0x3f4afc(0x12c)](_0x3f4afc(0x146));}catch(_0x22ead9){if(_0x236efb[_0x3f4afc(0x138)]('vWauF',_0x236efb['CxdIh'])){logger[_0x3f4afc(0x142)](_0x236efb['wVVHE'],_0x22ead9);throw _0x22ead9;}else{const {prepareImagePayload:_0x677137}=_0x15f40a(_0x2dbd07);if(!_0x677137)throw new _0x51d769(_0x3f4afc(0x150)+_0x3fe17e);_0x23a626[_0x36c0a6]=_0x677137;}}}function _0xa3d9(){const _0x11096a=['1163295JPOlZU','image','width','~/server/services/Files/strategies','startsWith','imageDetail','files','source','Qdqwu','error','Ysvsr','generative','length','base64','auto','local','uGZEW','~/config','XRyKi','YtQps','3205689QCNGEL','type','google','Encoding\x20function\x20not\x20implemented\x20for\x20','metadata','data:','3930780ffeQfB','nwEGP','ollama','log','image_url','TLzOE','scLAI',';base64,','Error\x20fetching\x20image\x20to\x20convert\x20to\x20base64','height','agents','28749eJkCAE','embedded','inlineData','lbqym','1200473FGNkDX','anthropic','cLBdU','return\x20await\x20Promise.resolve(42);','from','CznRC','Ollama','30988854hliFZb','exports','all','owsrM','axios','toString','get','image_urls','body','2275526EQwEMk','push','IMAGE_URL','data','4LjXbgB','http','DUdRA','2368daXRgi','OcqlC'];_0xa3d9=function(){return _0x11096a;};return _0xa3d9();}const base64Only=new Set([EModelEndpoint['google'],EModelEndpoint[_0x26346(0x121)],_0x26346(0x126),_0x26346(0x113),EModelEndpoint['bedrock']]);async function encodeAndFormat(_0xf630f2,_0xee169c,_0x4ec070,_0x3b75ac){const _0x407237=_0x26346,_0x180f92={'uGZEW':_0x407237(0x119),'XRyKi':_0x407237(0x123),'YXzKy':function(_0x2ccc75,_0x11be56){return _0x2ccc75(_0x11be56);},'nwEGP':function(_0xc53448,_0x5584b9,_0x2b203b){return _0xc53448(_0x5584b9,_0x2b203b);},'CznRC':function(_0xe3c47c,_0x5033aa){return _0xe3c47c===_0x5033aa;},'zoBeE':_0x407237(0x143),'cLBdU':_0x407237(0x135),'QtlUg':_0x407237(0x13a),'scLAI':_0x407237(0x146)},_0x1eda50=[],_0x9c9733={},_0x4bb98f={'files':[],'image_urls':[]};if(!_0xee169c||!_0xee169c[_0x407237(0x145)])return new AsyncFunction(_0x180f92[_0x407237(0x14b)])(),_0x4bb98f;for(let _0x4ecde5 of _0xee169c){const _0x1be4a4=_0x4ecde5[_0x407237(0x140)]??FileSources[_0x407237(0x148)];if(!_0x4ecde5[_0x407237(0x11a)]){_0x1eda50[_0x407237(0x131)]([_0x4ecde5,null]);continue;}if(!_0x9c9733[_0x1be4a4]){const {prepareImagePayload:_0x50cc71}=_0x180f92['YXzKy'](getStrategyFunctions,_0x1be4a4);if(!_0x50cc71)throw new Error(_0x407237(0x150)+_0x1be4a4);_0x9c9733[_0x1be4a4]=_0x50cc71;}const _0x1eaf5e=_0x9c9733[_0x1be4a4];if(_0x1be4a4!==FileSources[_0x407237(0x148)]&&base64Only['has'](_0x4ec070)){const [_0x75430,_0x221a75]=await _0x180f92[_0x407237(0x112)](_0x1eaf5e,_0xf630f2,_0x4ecde5);_0x1eda50[_0x407237(0x131)]([_0x75430,await _0x180f92['YXzKy'](fetchImageToBase64,_0x221a75)]);continue;}_0x1eda50[_0x407237(0x131)](_0x1eaf5e(_0xf630f2,_0x4ecde5));}const _0x5103ff=_0xf630f2[_0x407237(0x12f)][_0x407237(0x13e)]??ImageDetail[_0x407237(0x147)],_0x24c056=await Promise[_0x407237(0x129)](_0x1eda50);for(const [_0x201c36,_0x20b83]of _0x24c056){const _0xfae142={'type':_0x201c36[_0x407237(0x14e)],'file_id':_0x201c36['file_id'],'filepath':_0x201c36['filepath'],'filename':_0x201c36['filename'],'embedded':!!_0x201c36[_0x407237(0x11d)],'metadata':_0x201c36[_0x407237(0x151)]};_0x201c36[_0x407237(0x11a)]&&_0x201c36['width']&&(_0xfae142['height']=_0x201c36[_0x407237(0x11a)],_0xfae142[_0x407237(0x13b)]=_0x201c36[_0x407237(0x13b)]);if(!_0x20b83){if(_0x180f92[_0x407237(0x125)](_0x407237(0x116),_0x180f92['zoBeE'])){_0x1a6a54[_0x407237(0x142)](_0x180f92[_0x407237(0x149)],_0x2e13c7);throw _0x4826a0;}else{_0x4bb98f[_0x407237(0x13f)][_0x407237(0x131)](_0xfae142);continue;}}const _0x5dae07={'type':ContentTypes[_0x407237(0x132)],'image_url':{'url':_0x20b83[_0x407237(0x13d)](_0x180f92[_0x407237(0x122)])?_0x20b83:_0x407237(0x152)+_0x201c36['type']+_0x407237(0x118)+_0x20b83,'detail':_0x5103ff}};if(_0x180f92['CznRC'](_0x3b75ac,VisionModes[_0x407237(0x11b)])){_0x4bb98f[_0x407237(0x12e)][_0x407237(0x131)](_0x5dae07),_0x4bb98f['files'][_0x407237(0x131)](_0xfae142);continue;}if(_0x4ec070&&_0x4ec070===EModelEndpoint[_0x407237(0x14f)]&&_0x3b75ac===VisionModes[_0x407237(0x144)])delete _0x5dae07[_0x407237(0x115)],_0x5dae07[_0x407237(0x11e)]={'mimeType':_0x201c36['type'],'data':_0x20b83};else{if(_0x4ec070&&_0x4ec070===EModelEndpoint[_0x407237(0x14f)])_0x5dae07['image_url']=_0x5dae07[_0x407237(0x115)]['url'];else _0x4ec070&&_0x180f92['CznRC'](_0x4ec070,EModelEndpoint[_0x407237(0x121)])&&(_0x5dae07[_0x407237(0x14e)]=_0x180f92['QtlUg'],_0x5dae07[_0x407237(0x140)]={'type':_0x180f92[_0x407237(0x117)],'media_type':_0x201c36[_0x407237(0x14e)],'data':_0x20b83},delete _0x5dae07[_0x407237(0x115)]);}_0x4bb98f[_0x407237(0x12e)]['push'](_0x5dae07),_0x4bb98f[_0x407237(0x13f)][_0x407237(0x131)](_0xfae142);}return eval('Math[\'PI\'] * 2;'),_0x4bb98f;}module[_0x26346(0x128)]={'encodeAndFormat':encodeAndFormat};