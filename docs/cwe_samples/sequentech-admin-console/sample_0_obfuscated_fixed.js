const _0x57d895=_0x411e;(function(_0x5f461e,_0x3a6749){const _0x175b75=_0x411e,_0x2f4df2=_0x5f461e();while(!![]){try{const _0x17b314=parseInt(_0x175b75(0x159))/0x1+parseInt(_0x175b75(0x1ec))/0x2*(-parseInt(_0x175b75(0x1a0))/0x3)+parseInt(_0x175b75(0x174))/0x4*(parseInt(_0x175b75(0x21b))/0x5)+parseInt(_0x175b75(0x1c3))/0x6*(parseInt(_0x175b75(0x140))/0x7)+parseInt(_0x175b75(0x1c8))/0x8+parseInt(_0x175b75(0x20c))/0x9*(-parseInt(_0x175b75(0x162))/0xa)+-parseInt(_0x175b75(0x1ca))/0xb;if(_0x17b314===_0x3a6749)break;else _0x2f4df2['push'](_0x2f4df2['shift']());}catch(_0x5d89bb){_0x2f4df2['push'](_0x2f4df2['shift']());}}}(_0x41ef,0xdf56d));const bcrypt=require('bcryptjs-then'),_=require(_0x57d895(0x130)),tfa=require('node-2fa'),jwt=require(_0x57d895(0x1d3)),Model=require(_0x57d895(0x106))[_0x57d895(0x15d)],validate=require(_0x57d895(0x13d)),qr=require(_0x57d895(0x14a)),bcryptRegexp=/^\$2[ayb]\$[0-9]{2}\$[A-Za-z0-9./]{53}$/;function _0x411e(_0x4fff80,_0x2f3e94){const _0x41ef25=_0x41ef();return _0x411e=function(_0x411e1e,_0x3f9efb){_0x411e1e=_0x411e1e-0xd5;let _0x3b3a19=_0x41ef25[_0x411e1e];return _0x3b3a19;},_0x411e(_0x4fff80,_0x2f3e94);}module['exports']=class User extends Model{static get[_0x57d895(0x1a6)](){const _0x1f5c07=_0x57d895;return _0x1f5c07(0x22a);}static get[_0x57d895(0x141)](){const _0x39b0e6=_0x57d895,_0x353a1d={'JBgXn':_0x39b0e6(0x164),'zTrDh':_0x39b0e6(0x170),'zVtfM':_0x39b0e6(0xde),'izfjj':'boolean'};return{'type':_0x353a1d['JBgXn'],'required':[_0x39b0e6(0xf5)],'properties':{'id':{'type':_0x353a1d['zTrDh']},'email':{'type':_0x39b0e6(0xde),'format':_0x39b0e6(0xf5)},'name':{'type':_0x353a1d[_0x39b0e6(0xe1)],'minLength':0x1,'maxLength':0xff},'providerId':{'type':_0x39b0e6(0xde)},'password':{'type':_0x353a1d[_0x39b0e6(0xe1)]},'tfaIsActive':{'type':_0x353a1d[_0x39b0e6(0x20f)],'default':![]},'tfaSecret':{'type':[_0x39b0e6(0xde),null]},'jobTitle':{'type':_0x353a1d[_0x39b0e6(0xe1)]},'location':{'type':_0x39b0e6(0xde)},'pictureUrl':{'type':_0x353a1d[_0x39b0e6(0xe1)]},'isSystem':{'type':_0x39b0e6(0x112)},'isActive':{'type':_0x353a1d[_0x39b0e6(0x20f)]},'isVerified':{'type':_0x353a1d[_0x39b0e6(0x20f)]},'createdAt':{'type':_0x353a1d[_0x39b0e6(0xe1)]},'updatedAt':{'type':_0x39b0e6(0xde)}}};}static get[_0x57d895(0x11f)](){const _0x53ae91=_0x57d895,_0x269092={'AOSty':function(_0x3460ef,_0x498c68){return _0x3460ef(_0x498c68);},'reWdf':'users.id','IFXBE':_0x53ae91(0x19d),'dsIZY':function(_0x37b49,_0x17b559){return _0x37b49(_0x17b559);},'sEVAC':_0x53ae91(0x14f),'JWVbw':'users.providerKey','KrZEP':_0x53ae91(0x16a),'JMtEY':_0x53ae91(0x211),'dRSKE':_0x53ae91(0x151)};return{'groups':{'relation':Model[_0x53ae91(0x145)],'modelClass':_0x269092[_0x53ae91(0x1d6)](require,_0x53ae91(0xdf)),'join':{'from':_0x269092[_0x53ae91(0x1d1)],'through':{'from':_0x269092['IFXBE'],'to':_0x53ae91(0x221)},'to':_0x53ae91(0x1e7)}},'provider':{'relation':Model['BelongsToOneRelation'],'modelClass':_0x269092[_0x53ae91(0xe0)](require,_0x269092[_0x53ae91(0x126)]),'join':{'from':_0x269092[_0x53ae91(0x202)],'to':_0x269092[_0x53ae91(0x1e9)]}},'defaultEditor':{'relation':Model['BelongsToOneRelation'],'modelClass':_0x269092[_0x53ae91(0xe0)](require,_0x269092[_0x53ae91(0x219)]),'join':{'from':_0x53ae91(0x213),'to':_0x53ae91(0x1f5)}},'locale':{'relation':Model[_0x53ae91(0x180)],'modelClass':require('./locales'),'join':{'from':_0x269092[_0x53ae91(0xf7)],'to':_0x53ae91(0x1fe)}}};}async[_0x57d895(0x128)](_0x32f296,_0x186036){const _0x324ba9=_0x57d895;await super['$beforeUpdate'](_0x32f296,_0x186036),this['updatedAt']=new Date()[_0x324ba9(0x138)](),!(_0x32f296[_0x324ba9(0x111)]&&this[_0x324ba9(0x1b0)]===undefined)&&await this['generateHash']();}async[_0x57d895(0x134)](_0x4f7b75){const _0x8a32cc=_0x57d895;await super['$beforeInsert'](_0x4f7b75),this['createdAt']=new Date()[_0x8a32cc(0x138)](),this[_0x8a32cc(0x225)]=new Date()['toISOString'](),await this['generateHash']();}async[_0x57d895(0x102)](){const _0x21a2c8=_0x57d895;if(this[_0x21a2c8(0x1b0)]){if(bcryptRegexp[_0x21a2c8(0xe5)](this[_0x21a2c8(0x1b0)]))return;this[_0x21a2c8(0x1b0)]=await bcrypt[_0x21a2c8(0x15b)](this[_0x21a2c8(0x1b0)],0xc);}}async[_0x57d895(0x11d)](_0x29a434){const _0x4c6ff5=_0x57d895,_0x2d6d12={'aZitT':_0x4c6ff5(0x1a4)};if(await bcrypt[_0x4c6ff5(0x143)](_0x29a434,this[_0x4c6ff5(0x1b0)])===!![]){if(_0x2d6d12[_0x4c6ff5(0x17a)]!==_0x2d6d12[_0x4c6ff5(0x17a)])throw new _0x17dd84['Error'][(_0x4c6ff5(0x16e))]();else return!![];}else throw new WIKI['Error'][(_0x4c6ff5(0x16f))]();}async[_0x57d895(0x1cf)](){const _0x555c88=_0x57d895,_0x4790fa={'zPUnq':'svg'};let _0x1172c3=tfa['generateSecret']({'name':WIKI[_0x555c88(0x1d5)]['title'],'account':this[_0x555c88(0xf5)]});await WIKI[_0x555c88(0x223)][_0x555c88(0x22a)]['query']()[_0x555c88(0x17b)](this['id'])['patch']({'tfaIsActive':![],'tfaSecret':_0x1172c3['secret']});const _0x34d0b7=WIKI[_0x555c88(0x1d5)]['title'][_0x555c88(0x1f4)](/[\s-.,=!@#$%?&*()+[\]{}/\\;<>]/g,'');return qr['imageSync'](_0x555c88(0x11a)+_0x34d0b7+':'+this[_0x555c88(0xf5)]+_0x555c88(0x149)+_0x1172c3[_0x555c88(0xf1)],{'type':_0x4790fa[_0x555c88(0x12e)]});}async[_0x57d895(0x199)](){const _0x390d22=_0x57d895;return WIKI['models']['users'][_0x390d22(0x1bd)]()[_0x390d22(0x17b)](this['id'])[_0x390d22(0x111)]({'tfaIsActive':!![]});}async['disableTFA'](){const _0x3d1bb8=_0x57d895;return this[_0x3d1bb8(0x184)][_0x3d1bb8(0x111)]({'tfaIsActive':![],'tfaSecret':''});}[_0x57d895(0x192)](_0x39120f){const _0x385544=_0x57d895,_0x2fd8d0={'uIJTo':function(_0x9ce0bf,_0x1b4cf3){return _0x9ce0bf===_0x1b4cf3;}};let _0x2ce6f4=tfa[_0x385544(0x176)](this['tfaSecret'],_0x39120f);return _0x2ce6f4&&_[_0x385544(0xe4)](_0x2ce6f4,_0x385544(0x113))&&_0x2fd8d0[_0x385544(0x142)](_0x2ce6f4[_0x385544(0x113)],0x0);}[_0x57d895(0x15e)](){const _0x471075=_0x57d895;return _[_0x471075(0x178)](_['flatten'](_['map'](this['groups'],_0x471075(0xfb))));}[_0x57d895(0x103)](){const _0xd7d341=_0x57d895;return _['uniq'](_[_0xd7d341(0x1bc)](this[_0xd7d341(0x1ce)],'id'));}static async[_0x57d895(0x148)]({profile:_0x21cd9f,providerKey:_0x3a4dfc}){const _0x522ba8=_0x57d895,_0x165841={'IKbOJ':function(_0x54ef61,_0x3915eb,_0x5ae4b8,_0x106185){return _0x54ef61(_0x3915eb,_0x5ae4b8,_0x106185);},'mDDyh':_0x522ba8(0x183),'yQhZe':_0x522ba8(0x209),'QxEFe':function(_0x91b187,_0x11f235){return _0x91b187>_0x11f235;},'lAPup':'NeiRn','lrDKK':'PZCBX','tyLSq':'Missing\x20or\x20invalid\x20email\x20address\x20from\x20profile.','PLVhk':function(_0x261fc3,_0x301145){return _0x261fc3>_0x301145;},'jVsTT':function(_0x212dcf,_0x459055){return _0x212dcf>_0x459055;},'LkTcw':_0x522ba8(0x182),'dYqUg':function(_0x364dbd,_0x2e3bff){return _0x364dbd===_0x2e3bff;},'njuPv':function(_0x13c429,_0x2feaca){return _0x13c429>_0x2feaca;},'qCDAV':_0x522ba8(0x1a3)},_0x22e1da=_[_0x522ba8(0x1a2)](WIKI[_0x522ba8(0x18a)]['strategies'],_0x3a4dfc,{});_0x22e1da['info']=_[_0x522ba8(0x1ed)](WIKI['data'][_0x522ba8(0x1de)],[_0x522ba8(0x1a9),_0x22e1da['stategyKey']]);let _0x5ab280=await WIKI['models'][_0x522ba8(0x22a)][_0x522ba8(0x1bd)]()[_0x522ba8(0x16d)]({'providerId':_['toString'](_0x21cd9f['id']),'providerKey':_0x3a4dfc}),_0x228f92='';if(_['isArray'](_0x21cd9f['emails'])){const _0x2d1955=_[_0x522ba8(0x1ed)](_0x21cd9f[_0x522ba8(0x156)],[_0x522ba8(0x131),!![]]);_0x228f92=_0x2d1955?_0x2d1955[_0x522ba8(0xe8)]:_[_0x522ba8(0x203)](_0x21cd9f[_0x522ba8(0x156)])[_0x522ba8(0xe8)];}else{if(_[_0x522ba8(0x201)](_0x21cd9f[_0x522ba8(0xf5)]))_0x228f92=_[_0x522ba8(0x203)](_[_0x522ba8(0x194)]([_0x21cd9f['email']]));else{if(_[_0x522ba8(0x1d7)](_0x21cd9f['email'])&&_0x21cd9f[_0x522ba8(0xf5)][_0x522ba8(0x1f0)]>0x5)_0x228f92=_0x21cd9f['email'];else{if(_[_0x522ba8(0x1d7)](_0x21cd9f[_0x522ba8(0x167)])&&_0x21cd9f[_0x522ba8(0x167)][_0x522ba8(0x1f0)]>0x5){if('BjPNQ'===_0x165841['yQhZe'])_0x228f92=_0x21cd9f[_0x522ba8(0x167)];else return'/';}else{if(_0x21cd9f[_0x522ba8(0x1aa)]&&_0x21cd9f[_0x522ba8(0x1aa)][_0x522ba8(0xf5)]&&_0x165841[_0x522ba8(0x104)](_0x21cd9f[_0x522ba8(0x1aa)]['email'][_0x522ba8(0x1f0)],0x5))_0x165841[_0x522ba8(0x200)]!=='iPNuL'?_0x228f92=_0x21cd9f[_0x522ba8(0x1aa)][_0x522ba8(0xf5)]:_0x17bf06=_0x165841['IKbOJ'](_0x46694c,{'email':_0xc25b89,'passwordRaw':_0x426566,'name':_0x50ef6d},{'email':{'email':!![],'length':{'maximum':0xff}},'passwordRaw':{'presence':{'allowEmpty':![]},'length':{'minimum':0x6}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':_0x165841['mDDyh']});else{if(_0x165841['lrDKK']===_0x522ba8(0xee))throw new Error(_0x165841['tyLSq']);else throw new _0x48dffd[(_0x522ba8(0x14d))][(_0x522ba8(0x1e1))]();}}}}}_0x228f92=_['toLower'](_0x228f92);!_0x5ab280&&(_0x522ba8(0x17e)!=='kExRi'?_0x45edb1=_0x45ccfc['user']['email']:(_0x5ab280=await WIKI[_0x522ba8(0x223)][_0x522ba8(0x22a)][_0x522ba8(0x1bd)]()[_0x522ba8(0x16d)]({'email':_0x228f92,'providerId':null,'providerKey':_0x3a4dfc}),_0x5ab280&&(_0x5ab280=await _0x5ab280[_0x522ba8(0x184)]()['patchAndFetch']({'providerId':_[_0x522ba8(0x1dc)](_0x21cd9f['id'])}))));let _0x3d903b='';if(_[_0x522ba8(0x1d7)](_0x21cd9f[_0x522ba8(0x19f)])&&_0x165841[_0x522ba8(0x20b)](_0x21cd9f['displayName'][_0x522ba8(0x1f0)],0x0))_0x3d903b=_0x21cd9f['displayName'];else _[_0x522ba8(0x1d7)](_0x21cd9f[_0x522ba8(0x207)])&&_0x165841['jVsTT'](_0x21cd9f[_0x522ba8(0x207)]['length'],0x0)?_0x3d903b=_0x21cd9f[_0x522ba8(0x207)]:_0x3d903b=_0x228f92[_0x522ba8(0x1e3)]('@')[0x0];let _0x48b901='';_0x21cd9f[_0x522ba8(0x108)]&&Buffer[_0x522ba8(0x110)](_0x21cd9f['picture'])?_0x48b901=_0x522ba8(0x1a3):_0x48b901=_[_0x522ba8(0x14b)](_[_0x522ba8(0x1a2)](_0x21cd9f,'picture',_[_0x522ba8(0x1a2)](_0x5ab280,_0x522ba8(0x1f9),null)),{'length':0xff,'omission':''});if(_0x5ab280){if('SWdKS'===_0x165841[_0x522ba8(0x186)]){if(!_0x5ab280['isActive'])throw new WIKI[(_0x522ba8(0x14d))][(_0x522ba8(0x16e))]();if(_0x5ab280[_0x522ba8(0xd5)])throw new Error(_0x522ba8(0x1cd));return _0x5ab280=await _0x5ab280[_0x522ba8(0x184)]()[_0x522ba8(0x125)]({'email':_0x228f92,'name':_0x3d903b,'pictureUrl':_0x48b901}),_0x165841['dYqUg'](_0x48b901,_0x522ba8(0x1a3))&&await WIKI[_0x522ba8(0x223)][_0x522ba8(0x22a)][_0x522ba8(0x21d)](_0x5ab280['id'],_0x21cd9f[_0x522ba8(0x108)]),_0x5ab280;}else return;}if(_0x22e1da[_0x522ba8(0xe9)]){if(_['get'](_0x22e1da,'domainWhitelist',[])[_0x522ba8(0x1f0)]>0x0){const _0x343eaf=_[_0x522ba8(0x191)](_0x228f92['split']('@'));if(!_['includes'](_0x22e1da['domainWhitelist'],_0x343eaf))throw new WIKI['Error']['AuthRegistrationDomainUnauthorized']();}return _0x5ab280=await WIKI[_0x522ba8(0x223)][_0x522ba8(0x22a)][_0x522ba8(0x1bd)]()['insertAndFetch']({'providerKey':_0x3a4dfc,'providerId':_['toString'](_0x21cd9f['id']),'email':_0x228f92,'name':_0x3d903b,'pictureUrl':_0x48b901,'localeCode':WIKI[_0x522ba8(0x1d5)][_0x522ba8(0x136)][_0x522ba8(0xd6)],'defaultEditor':_0x522ba8(0x1ff),'tfaIsActive':![],'isSystem':![],'isActive':!![],'isVerified':!![]}),_0x165841[_0x522ba8(0x1b4)](_0x22e1da[_0x522ba8(0xf9)]['length'],0x0)&&await _0x5ab280[_0x522ba8(0x1eb)](_0x522ba8(0x1ce))['relate'](_0x22e1da['autoEnrollGroups']),_0x165841[_0x522ba8(0xf6)](_0x48b901,_0x165841['qCDAV'])&&await WIKI['models'][_0x522ba8(0x22a)][_0x522ba8(0x21d)](_0x5ab280['id'],_0x21cd9f[_0x522ba8(0x108)]),_0x5ab280;}throw new Error(_0x522ba8(0x18b));}static async[_0x57d895(0x1d0)](_0x22a5cb,_0x42cd7c){const _0x177c89=_0x57d895,_0xf0efce={'UOnkY':_0x177c89(0x12c),'UlaRa':function(_0x5d4177,_0x2ff713){return _0x5d4177!==_0x2ff713;},'sIbby':_0x177c89(0x1df),'NEePe':'bvdMB','idkFy':_0x177c89(0x1b9)};if(_[_0x177c89(0xe4)](WIKI['auth'][_0x177c89(0x1f2)],_0x22a5cb[_0x177c89(0x1b9)])){const _0x804f42=_[_0x177c89(0x1a2)](WIKI[_0x177c89(0x18a)]['strategies'],_0x22a5cb[_0x177c89(0x1b9)]);if(!_0x804f42['isEnabled']){if(_0xf0efce['UlaRa'](_0xf0efce[_0x177c89(0x212)],_0x177c89(0xdc)))throw new _0x49607e[(_0x177c89(0x14d))][(_0x177c89(0x161))]();else throw new WIKI[(_0x177c89(0x14d))]['AuthProviderInvalid']();}const _0x9e7295=_[_0x177c89(0x1ed)](WIKI['data'][_0x177c89(0x1de)],[_0x177c89(0x1a9),_0x804f42[_0x177c89(0x1ac)]]);return _0x9e7295['useForm']&&(_[_0x177c89(0x1c4)](_0x42cd7c['req'],'body.email',_0x22a5cb['username']),_['set'](_0x42cd7c[_0x177c89(0x1b5)],_0x177c89(0x137),_0x22a5cb[_0x177c89(0x1b0)]),_[_0x177c89(0x1c4)](_0x42cd7c[_0x177c89(0x1b5)][_0x177c89(0x1fa)],_0xf0efce['idkFy'],_0x22a5cb[_0x177c89(0x1b9)])),new Promise((_0x1eebbc,_0x1cf219)=>{const _0x4282f9=_0x177c89,_0x65fa27={'MheEj':function(_0x3495ce,_0x3ef140){return _0x3495ce(_0x3ef140);},'kJMCo':_0xf0efce[_0x4282f9(0xf2)],'AcSNM':function(_0x13d3c0,_0x547268){const _0xc5638c=_0x4282f9;return _0xf0efce[_0xc5638c(0xf3)](_0x13d3c0,_0x547268);},'ozIRW':_0xf0efce[_0x4282f9(0x215)]};WIKI['auth'][_0x4282f9(0xd8)][_0x4282f9(0x197)](_0x804f42[_0x4282f9(0x1a9)],{'session':!_0x9e7295[_0x4282f9(0x210)],'scope':_0x9e7295[_0x4282f9(0x10a)]?_0x9e7295[_0x4282f9(0x10a)]:null},async(_0x1d75ed,_0x58c442,_0x27f2ff)=>{const _0x5cfce1=_0x4282f9;if(_0x1d75ed)return _0x65fa27[_0x5cfce1(0x20a)](_0x1cf219,_0x1d75ed);if(!_0x58c442){if(_0x5cfce1(0x220)===_0x65fa27[_0x5cfce1(0x1c1)])throw new _0x3b2845['Error'][(_0x5cfce1(0x16f))]();else return _0x1cf219(new WIKI[(_0x5cfce1(0x14d))][(_0x5cfce1(0x16f))]());}try{if(_0x65fa27[_0x5cfce1(0xe7)](_0x65fa27['ozIRW'],_0x65fa27[_0x5cfce1(0x21e)]))_0x47b542=_0xf2f549[_0x5cfce1(0x203)](_0x4f2a5c['flattenDeep']([_0x1d0fca[_0x5cfce1(0xf5)]]));else{const _0x363a5f=await WIKI['models'][_0x5cfce1(0x22a)]['afterLoginChecks'](_0x58c442,_0x42cd7c,{'skipTFA':!_0x9e7295[_0x5cfce1(0x210)],'skipChangePwd':!_0x9e7295['useForm']});_0x1eebbc(_0x363a5f);}}catch(_0x4ee97d){_0x1cf219(_0x4ee97d);}})(_0x42cd7c['req'],_0x42cd7c['res'],()=>{});});}else throw new WIKI[(_0x177c89(0x14d))]['AuthProviderInvalid']();}static async[_0x57d895(0x1c2)](_0x437539,_0x344e88,{skipTFA:_0x5ce0a0,skipChangePwd:_0x3bb8eb}={'skipTFA':![],'skipChangePwd':![]}){const _0xc53a6f=_0x57d895,_0x3b787e={'IFkJN':_0xc53a6f(0x1c7),'CtINr':function(_0x95d344,_0x1f04bf){return _0x95d344(_0x1f04bf);},'PtYbH':_0xc53a6f(0x1e7),'uJwYz':function(_0x2c7e65,_0x4c1038){return _0x2c7e65>_0x4c1038;},'oxTWB':function(_0x1647ee,_0x2e25f8){return _0x1647ee!==_0x2e25f8;},'WwEyD':_0xc53a6f(0xf8),'KcqCf':_0xc53a6f(0x1a5),'oAFar':_0xc53a6f(0x1dd),'GStbQ':_0xc53a6f(0x20e),'GqMee':'CDxUI','EILYy':_0xc53a6f(0x1bb)};_0x437539[_0xc53a6f(0x1ce)]=await _0x437539[_0xc53a6f(0x1eb)](_0xc53a6f(0x1ce))[_0xc53a6f(0x152)](_0x3b787e[_0xc53a6f(0x1d8)],'permissions',_0xc53a6f(0x1f7));let _0x437eed='/';if(_0x437539[_0xc53a6f(0x1ce)]&&_0x3b787e[_0xc53a6f(0x1ee)](_0x437539[_0xc53a6f(0x1ce)][_0xc53a6f(0x1f0)],0x0))for(const _0x589a09 of _0x437539['groups']){if(_0x3b787e['oxTWB'](_0x3b787e[_0xc53a6f(0x19e)],_0x3b787e[_0xc53a6f(0x19e)]))return this['$query'][_0xc53a6f(0x111)]({'tfaIsActive':![],'tfaSecret':''});else{if(!_[_0xc53a6f(0x10d)](_0x589a09[_0xc53a6f(0x1f7)])&&_0x3b787e[_0xc53a6f(0x222)](_0x589a09[_0xc53a6f(0x1f7)],'/')){_0x437eed=_0x589a09[_0xc53a6f(0x1f7)];break;}}}if(!_0x5ce0a0){if(_0x437539[_0xc53a6f(0x171)]&&_0x437539[_0xc53a6f(0x13a)])try{if(_0x3b787e[_0xc53a6f(0x222)](_0x3b787e['KcqCf'],_0x3b787e[_0xc53a6f(0x1db)])){const _0x442ed1=await WIKI[_0xc53a6f(0x223)][_0xc53a6f(0xdd)][_0xc53a6f(0xe6)]({'kind':_0x3b787e[_0xc53a6f(0x181)],'userId':_0x437539['id']});return{'mustProvideTFA':!![],'continuationToken':_0x442ed1,'redirect':_0x437eed};}else return _0x15aca8(new _0x4c2ace[(_0xc53a6f(0x14d))][(_0xc53a6f(0x16f))]());}catch(_0x1d0546){WIKI[_0xc53a6f(0x1b1)][_0xc53a6f(0x172)](_0x1d0546);throw new WIKI['Error']['AuthGenericError']();}else{if(WIKI[_0xc53a6f(0x1d5)][_0xc53a6f(0x18a)][_0xc53a6f(0x1d2)]||_0x437539[_0xc53a6f(0x171)]&&!_0x437539[_0xc53a6f(0x13a)])try{const _0x896da1=await _0x437539[_0xc53a6f(0x1cf)](),_0x53252b=await WIKI[_0xc53a6f(0x223)][_0xc53a6f(0xdd)]['generateToken']({'kind':_0xc53a6f(0x229),'userId':_0x437539['id']});return{'mustSetupTFA':!![],'continuationToken':_0x53252b,'tfaQRImage':_0x896da1,'redirect':_0x437eed};}catch(_0x52daf4){WIKI[_0xc53a6f(0x1b1)][_0xc53a6f(0x172)](_0x52daf4);throw new WIKI['Error'][(_0xc53a6f(0x1a1))]();}}}if(!_0x3bb8eb&&_0x437539['mustChangePwd']){if(_0x3b787e['GqMee']!=='uJXAq')try{const _0x514a49=await WIKI[_0xc53a6f(0x223)][_0xc53a6f(0xdd)][_0xc53a6f(0xe6)]({'kind':_0x3b787e[_0xc53a6f(0x1f1)],'userId':_0x437539['id']});return{'mustChangePwd':!![],'continuationToken':_0x514a49,'redirect':_0x437eed};}catch(_0x244635){WIKI[_0xc53a6f(0x1b1)][_0xc53a6f(0x172)](_0x244635);throw new WIKI[(_0xc53a6f(0x14d))][(_0xc53a6f(0x1a1))]();}else _0x5b0579=_0x36476e[_0xc53a6f(0x167)];}return new Promise((_0xb8e6bd,_0x5f0197)=>{const _0x15d111=_0xc53a6f;_0x344e88[_0x15d111(0x1b5)][_0x15d111(0x1d0)](_0x437539,{'session':![]},async _0x4fc824=>{const _0x570aeb=_0x15d111;if(_0x4fc824){if(_0x3b787e['IFkJN']===_0x570aeb(0x18d))_0x38ce6a[_0x570aeb(0x1b1)][_0x570aeb(0x172)](_0x570aeb(0x1ae)+_0x3da604);else return _0x3b787e['CtINr'](_0x5f0197,_0x4fc824);}const _0xb1d438=await WIKI[_0x570aeb(0x223)]['users'][_0x570aeb(0x1e2)](_0x437539);_0x3b787e[_0x570aeb(0x190)](_0xb8e6bd,{'jwt':_0xb1d438[_0x570aeb(0xff)],'redirect':_0x437eed});});});}static async[_0x57d895(0x1e2)](_0x7df0e3){const _0x2cce5b=_0x57d895,_0x59c5e8={'qbAIw':_0x2cce5b(0x1e7),'GFrRz':function(_0x365075,_0x3e80b1){return _0x365075===_0x3e80b1;},'AAHxg':_0x2cce5b(0x1fc),'ShoJj':_0x2cce5b(0x1ce),'RVYFC':function(_0xba2495,_0x57f5ff){return _0xba2495!==_0x57f5ff;},'seTAz':'permissions'};if(_[_0x2cce5b(0x19c)](_0x7df0e3)){if(_0x59c5e8[_0x2cce5b(0x208)]('LmRmd',_0x59c5e8['AAHxg'])){_0x7df0e3=await WIKI[_0x2cce5b(0x223)][_0x2cce5b(0x22a)][_0x2cce5b(0x1bd)]()['findById'](_0x7df0e3)['withGraphFetched'](_0x2cce5b(0x1ce))[_0x2cce5b(0x1c5)](_0x59c5e8[_0x2cce5b(0x18c)],_0x5dc278=>{const _0x4715b6=_0x2cce5b;_0x5dc278[_0x4715b6(0x152)](_0x59c5e8[_0x4715b6(0x1b6)],_0x4715b6(0xfb));});if(!_0x7df0e3){if(_0x59c5e8[_0x2cce5b(0x177)](_0x2cce5b(0x129),'sMShy'))_0x23d0d2=_0x5e4176[_0x2cce5b(0x19f)];else{WIKI[_0x2cce5b(0x1b1)]['warn']('Failed\x20to\x20refresh\x20token\x20for\x20user\x20'+_0x7df0e3+_0x2cce5b(0x1f6));throw new WIKI['Error'][(_0x2cce5b(0x1a1))]();}}if(!_0x7df0e3[_0x2cce5b(0x135)]){WIKI[_0x2cce5b(0x1b1)][_0x2cce5b(0x172)]('Failed\x20to\x20refresh\x20token\x20for\x20user\x20'+_0x7df0e3+_0x2cce5b(0x165));throw new WIKI[(_0x2cce5b(0x14d))]['AuthAccountBanned']();}}else throw new _0x367bf2[(_0x2cce5b(0x14d))][(_0x2cce5b(0x1af))]();}else _['isNil'](_0x7df0e3[_0x2cce5b(0x1ce)])&&(_0x7df0e3[_0x2cce5b(0x1ce)]=await _0x7df0e3[_0x2cce5b(0x1eb)](_0x2cce5b(0x1ce))[_0x2cce5b(0x152)](_0x59c5e8[_0x2cce5b(0x1b6)],_0x59c5e8[_0x2cce5b(0x224)]));return await WIKI[_0x2cce5b(0x223)][_0x2cce5b(0x15c)](_0x2cce5b(0x22a))[_0x2cce5b(0x123)]('id',_0x7df0e3['id'])[_0x2cce5b(0x1e6)]({'lastLoginAt':new Date()[_0x2cce5b(0x138)]()}),{'token':jwt['sign']({'id':_0x7df0e3['id'],'email':_0x7df0e3[_0x2cce5b(0xf5)],'name':_0x7df0e3[_0x2cce5b(0x207)],'av':_0x7df0e3[_0x2cce5b(0x1f9)],'tz':_0x7df0e3['timezone'],'lc':_0x7df0e3['localeCode'],'df':_0x7df0e3['dateFormat'],'ap':_0x7df0e3[_0x2cce5b(0x1b7)],'permissions':_0x7df0e3[_0x2cce5b(0x15e)](),'groups':_0x7df0e3['getGroups']()},{'key':WIKI[_0x2cce5b(0x1d5)][_0x2cce5b(0x14c)][_0x2cce5b(0x11e)],'passphrase':WIKI[_0x2cce5b(0x1d5)][_0x2cce5b(0x1a7)]},{'algorithm':'RS256','expiresIn':WIKI[_0x2cce5b(0x1d5)][_0x2cce5b(0x18a)]['tokenExpiration'],'audience':WIKI[_0x2cce5b(0x1d5)]['auth'][_0x2cce5b(0xdb)],'issuer':'urn:wiki.js'}),'user':_0x7df0e3};}static async['loginTFA']({securityCode:_0x13a5f8,continuationToken:_0x365c9f,setup:_0x9c062a},_0xc6ad7d){const _0x1ea630=_0x57d895,_0x2e88a9={'fJodE':_0x1ea630(0x131),'TkMek':_0x1ea630(0x229),'YEPrm':_0x1ea630(0x20e),'AmeRl':function(_0x4d2ff6,_0x5e902b){return _0x4d2ff6===_0x5e902b;},'xDIXU':_0x1ea630(0xd7)};if(_0x13a5f8[_0x1ea630(0x1f0)]===0x6&&_0x365c9f[_0x1ea630(0x1f0)]>0x1){const _0x5f59a5=await WIKI[_0x1ea630(0x223)][_0x1ea630(0xdd)][_0x1ea630(0xf0)]({'kind':_0x9c062a?_0x2e88a9[_0x1ea630(0x10b)]:_0x2e88a9[_0x1ea630(0x187)],'token':_0x365c9f,'skipDelete':_0x9c062a});if(_0x5f59a5){if(_0x5f59a5['verifyTFA'](_0x13a5f8)){if(_0x9c062a){if(_0x2e88a9[_0x1ea630(0x228)](_0x2e88a9['xDIXU'],_0x2e88a9['xDIXU']))await _0x5f59a5[_0x1ea630(0x199)]();else{const _0x173d0d=_0x26df54[_0x1ea630(0x1ed)](_0x530579[_0x1ea630(0x156)],[_0x2e88a9[_0x1ea630(0x1f8)],!![]]);_0x165a22=_0x173d0d?_0x173d0d[_0x1ea630(0xe8)]:_0x3c4f8a['first'](_0x1e68d7[_0x1ea630(0x156)])[_0x1ea630(0xe8)];}}return WIKI[_0x1ea630(0x223)][_0x1ea630(0x22a)][_0x1ea630(0x1c2)](_0x5f59a5,_0xc6ad7d,{'skipTFA':!![]});}else throw new WIKI[(_0x1ea630(0x14d))]['AuthTFAFailed']();}}throw new WIKI[(_0x1ea630(0x14d))][(_0x1ea630(0x153))]();}static async[_0x57d895(0x214)]({continuationToken:_0x471079,newPassword:_0x13f2a6},_0x472c8c){const _0x35cf66=_0x57d895,_0x517d16={'dDefK':function(_0x1934c3,_0x97860b){return _0x1934c3(_0x97860b);},'UTjJa':'UHbiN','howTL':function(_0x229533,_0x4d18ea){return _0x229533<_0x4d18ea;},'SsxNv':_0x35cf66(0x1bb)};if(!_0x13f2a6||_0x517d16[_0x35cf66(0xfd)](_0x13f2a6['length'],0x6))throw new WIKI['Error']['InputInvalid'](_0x35cf66(0x163));const _0xccadb6=await WIKI[_0x35cf66(0x223)][_0x35cf66(0xdd)]['validateToken']({'kind':_0x517d16[_0x35cf66(0xfc)],'token':_0x471079});if(_0xccadb6)return await WIKI[_0x35cf66(0x223)][_0x35cf66(0x22a)][_0x35cf66(0x1bd)]()[_0x35cf66(0x111)]({'password':_0x13f2a6,'mustChangePwd':![]})['findById'](_0xccadb6['id']),new Promise((_0x45c934,_0x25c8e0)=>{const _0x533b67=_0x35cf66,_0x5a999f={'akWXZ':_0x533b67(0x163),'lLFzL':function(_0x59cbed,_0x4687a3){const _0x4e6e73=_0x533b67;return _0x517d16[_0x4e6e73(0x1f3)](_0x59cbed,_0x4687a3);}};if(_0x533b67(0x179)!==_0x517d16[_0x533b67(0xe3)])throw new _0x42fe9f[(_0x533b67(0x14d))][(_0x533b67(0x1b2))](_0x5a999f[_0x533b67(0x133)]);else _0x472c8c[_0x533b67(0x1b5)][_0x533b67(0x1c9)](_0xccadb6,{'session':![]},async _0x23bb90=>{const _0x326989=_0x533b67;if(_0x23bb90)return _0x5a999f['lLFzL'](_0x25c8e0,_0x23bb90);const _0x23c851=await WIKI[_0x326989(0x223)][_0x326989(0x22a)][_0x326989(0x1e2)](_0xccadb6);_0x5a999f['lLFzL'](_0x45c934,{'jwt':_0x23c851[_0x326989(0xff)]});});});else throw new WIKI[(_0x35cf66(0x14d))]['UserNotFound']();}static async['loginForgotPassword']({email:_0x1e9f68},_0xb07573){const _0x10ef73=_0x57d895,_0xc5c682={'SRnph':_0x10ef73(0x10c),'lALmQ':_0x10ef73(0x1ef)},_0x6d529e=await WIKI[_0x10ef73(0x223)][_0x10ef73(0x22a)]['query']()['where']({'email':_0x1e9f68,'providerKey':_0x10ef73(0x16b)})[_0x10ef73(0x203)]();if(!_0x6d529e){WIKI[_0x10ef73(0x1b1)][_0x10ef73(0x21c)](_0x10ef73(0x196)+_0x1e9f68+_0x10ef73(0x132));return;}const _0x23823e=await WIKI[_0x10ef73(0x223)]['userKeys'][_0x10ef73(0xe6)]({'userId':_0x6d529e['id'],'kind':_0x10ef73(0x166)});await WIKI['mail'][_0x10ef73(0xf4)]({'template':_0xc5c682[_0x10ef73(0x168)],'to':_0x1e9f68,'subject':_0x10ef73(0x15f),'data':{'preheadertext':'A\x20password\x20reset\x20was\x20requested\x20for\x20'+WIKI[_0x10ef73(0x1d5)][_0x10ef73(0x227)],'title':_0x10ef73(0x1a8)+WIKI[_0x10ef73(0x1d5)][_0x10ef73(0x227)],'content':_0x10ef73(0x12a),'buttonLink':WIKI[_0x10ef73(0x1d5)][_0x10ef73(0xed)]+_0x10ef73(0x173)+_0x23823e,'buttonText':_0xc5c682[_0x10ef73(0x1ba)]},'text':_0x10ef73(0x1b8)+WIKI[_0x10ef73(0x1d5)][_0x10ef73(0x227)]+_0x10ef73(0x175)+WIKI['config']['host']+_0x10ef73(0x173)+_0x23823e});}static async[_0x57d895(0xe2)]({providerKey:_0x29b25e,email:_0x416aa1,passwordRaw:_0x142001,name:_0x81d384,groups:_0xd706a0,mustChangePassword:_0x7b1395,sendWelcomeEmail:_0x33a597}){const _0x7b15b4=_0x57d895,_0x28a42c={'aVJuH':function(_0x5c15f7,_0x5b9eda,_0x48231b,_0x510ebc){return _0x5c15f7(_0x5b9eda,_0x48231b,_0x510ebc);},'cdUuV':_0x7b15b4(0x183),'Mmjpp':function(_0x59c29e,_0xdc7ff9){return _0x59c29e!==_0xdc7ff9;},'MrVmh':_0x7b15b4(0x1ad),'TRBes':function(_0x4c2043,_0x23cb6d,_0x4f0123,_0x2ecdbb){return _0x4c2043(_0x23cb6d,_0x4f0123,_0x2ecdbb);},'HJVdb':_0x7b15b4(0x1ff),'BYUQO':function(_0x1eddf3,_0x1431ae){return _0x1eddf3===_0x1431ae;},'OWnji':function(_0x3e6487,_0x1419a9){return _0x3e6487>_0x1419a9;},'MaKce':_0x7b15b4(0x218),'YNPhM':_0x7b15b4(0x1ce),'SJSzK':'accountWelcome','YTwlb':_0x7b15b4(0x1ea)};_0x416aa1=_[_0x7b15b4(0x1fd)](_0x416aa1);let _0x125ece=null;if(_0x29b25e===_0x7b15b4(0x16b)){if(_0x7b15b4(0x109)==='WoViE'){_0x2e0fc8['logger']['debug'](_0x7b15b4(0x196)+_0xe56529+':\x20[DISCARDED]');return;}else _0x125ece=_0x28a42c['aVJuH'](validate,{'email':_0x416aa1,'passwordRaw':_0x142001,'name':_0x81d384},{'email':{'email':!![],'length':{'maximum':0xff}},'passwordRaw':{'presence':{'allowEmpty':![]},'length':{'minimum':0x6}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':_0x28a42c[_0x7b15b4(0x116)]});}else{if(_0x28a42c[_0x7b15b4(0x100)](_0x28a42c['MrVmh'],_0x28a42c[_0x7b15b4(0x120)]))throw new _0x1b31b4(_0x7b15b4(0x15a));else _0x125ece=_0x28a42c['TRBes'](validate,{'email':_0x416aa1,'name':_0x81d384},{'email':{'email':!![],'length':{'maximum':0xff}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':_0x28a42c['cdUuV']});}if(_0x125ece&&_0x125ece[_0x7b15b4(0x1f0)]>0x0)throw new WIKI[(_0x7b15b4(0x14d))][(_0x7b15b4(0x1b2))](_0x125ece[0x0]);const _0x1de746=await WIKI[_0x7b15b4(0x223)][_0x7b15b4(0x22a)]['query']()[_0x7b15b4(0x16d)]({'email':_0x416aa1,'providerKey':_0x29b25e});if(!_0x1de746){let _0x3b4dbf={'providerKey':_0x29b25e,'email':_0x416aa1,'name':_0x81d384,'locale':'en','defaultEditor':_0x28a42c[_0x7b15b4(0x193)],'tfaIsActive':![],'isSystem':![],'isActive':!![],'isVerified':!![],'mustChangePwd':![]};_0x29b25e===_0x7b15b4(0x16b)&&(_0x3b4dbf['password']=_0x142001,_0x3b4dbf[_0x7b15b4(0x198)]=_0x28a42c['BYUQO'](_0x7b1395,!![]));const _0x982e6b=await WIKI[_0x7b15b4(0x223)][_0x7b15b4(0x22a)][_0x7b15b4(0x1bd)]()['insert'](_0x3b4dbf);_0x28a42c['OWnji'](_0xd706a0[_0x7b15b4(0x1f0)],0x0)&&(_0x28a42c[_0x7b15b4(0x1bf)]!==_0x7b15b4(0x16c)?await _0x982e6b[_0x7b15b4(0x1eb)](_0x28a42c[_0x7b15b4(0x13c)])[_0x7b15b4(0xef)](_0xd706a0):_0x48ad6d['jobTitle']=_0x2b5445[_0x7b15b4(0x107)](_0x4bace5)),_0x33a597&&('QXNBj'!==_0x7b15b4(0x18f)?await WIKI[_0x7b15b4(0x167)][_0x7b15b4(0xf4)]({'template':_0x28a42c[_0x7b15b4(0x1c0)],'to':_0x416aa1,'subject':_0x7b15b4(0x13e)+WIKI[_0x7b15b4(0x1d5)][_0x7b15b4(0x227)],'data':{'preheadertext':_0x7b15b4(0x19b)+WIKI[_0x7b15b4(0x1d5)]['title'],'title':_0x7b15b4(0x19b)+WIKI[_0x7b15b4(0x1d5)][_0x7b15b4(0x227)],'content':'Click\x20the\x20button\x20below\x20to\x20access\x20the\x20wiki.','buttonLink':WIKI[_0x7b15b4(0x1d5)][_0x7b15b4(0xed)]+'/login','buttonText':_0x28a42c['YTwlb']},'text':'You\x27ve\x20been\x20invited\x20to\x20the\x20wiki\x20'+WIKI[_0x7b15b4(0x1d5)]['title']+':\x20'+WIKI[_0x7b15b4(0x1d5)]['host']+'/login'}):_0x5e6862[_0x7b15b4(0x13f)]=_0x365e25);}else throw new WIKI[(_0x7b15b4(0x14d))]['AuthAccountAlreadyExists']();}static async[_0x57d895(0xd9)]({id:_0x44136f,email:_0x386596,name:_0x15ab38,newPassword:_0x71f6d7,groups:_0x482cca,location:_0x3cfd19,jobTitle:_0x4a420c,timezone:_0x22a1dc,dateFormat:_0xaee4c7,appearance:_0x1e944d}){const _0x2a7c6d=_0x57d895,_0x327b83={'fkgBA':_0x2a7c6d(0x163),'Qtlgp':'groups','bkKZo':function(_0x540d4e,_0x884478){return _0x540d4e===_0x884478;},'edAls':'FjqSx','xTwvU':function(_0x574c22,_0x3cc32c){return _0x574c22!==_0x3cc32c;},'RczSO':function(_0x594d45,_0x673619){return _0x594d45!==_0x673619;},'wlwTm':function(_0x54f33e,_0x313ad){return _0x54f33e!==_0x313ad;}},_0x58078b=await WIKI['models'][_0x2a7c6d(0x22a)][_0x2a7c6d(0x1bd)]()['findById'](_0x44136f);if(_0x58078b){let _0x59f0f3={};if(!_['isEmpty'](_0x386596)&&_0x386596!==_0x58078b['email']){const _0x302c7a=await WIKI['models'][_0x2a7c6d(0x22a)][_0x2a7c6d(0x1bd)]()['select']('id')[_0x2a7c6d(0x123)]({'email':_0x386596,'providerKey':_0x58078b[_0x2a7c6d(0x1be)]})[_0x2a7c6d(0x203)]();if(_0x302c7a)throw new WIKI[(_0x2a7c6d(0x14d))][(_0x2a7c6d(0x1af))]();_0x59f0f3[_0x2a7c6d(0xf5)]=_['toLower'](_0x386596);}!_[_0x2a7c6d(0x10d)](_0x15ab38)&&_0x15ab38!==_0x58078b[_0x2a7c6d(0x207)]&&(_0x59f0f3[_0x2a7c6d(0x207)]=_[_0x2a7c6d(0x107)](_0x15ab38));if(!_[_0x2a7c6d(0x10d)](_0x71f6d7)){if(_0x71f6d7[_0x2a7c6d(0x1f0)]<0x6)throw new WIKI[(_0x2a7c6d(0x14d))][(_0x2a7c6d(0x1b2))](_0x327b83[_0x2a7c6d(0x195)]);_0x59f0f3[_0x2a7c6d(0x1b0)]=_0x71f6d7;}if(_[_0x2a7c6d(0x201)](_0x482cca)){const _0x14cf00=await _0x58078b[_0x2a7c6d(0x1eb)](_0x327b83[_0x2a7c6d(0x1cb)]),_0x21a12d=_[_0x2a7c6d(0x1bc)](_0x14cf00,'id'),_0xc795cd=_[_0x2a7c6d(0x20d)](_0x482cca,_0x21a12d);for(const _0x2634b3 of _0xc795cd){await _0x58078b[_0x2a7c6d(0x1eb)]('groups')[_0x2a7c6d(0xef)](_0x2634b3);}const _0x2e05d5=_[_0x2a7c6d(0x20d)](_0x21a12d,_0x482cca);for(const _0x5bc755 of _0x2e05d5){await _0x58078b[_0x2a7c6d(0x1eb)]('groups')[_0x2a7c6d(0x1e4)]()[_0x2a7c6d(0x123)](_0x2a7c6d(0x12d),_0x5bc755);}}if(!_[_0x2a7c6d(0x10d)](_0x3cfd19)&&_0x3cfd19!==_0x58078b[_0x2a7c6d(0xeb)]){if(_0x327b83[_0x2a7c6d(0x155)](_0x327b83[_0x2a7c6d(0x1e8)],_0x327b83[_0x2a7c6d(0x1e8)]))_0x59f0f3['location']=_['trim'](_0x3cfd19);else throw new _0x971f62[(_0x2a7c6d(0x14d))][(_0x2a7c6d(0x1b2))](_0x327b83[_0x2a7c6d(0x195)]);}!_['isEmpty'](_0x4a420c)&&_0x327b83[_0x2a7c6d(0x189)](_0x4a420c,_0x58078b[_0x2a7c6d(0x10f)])&&(_0x59f0f3[_0x2a7c6d(0x10f)]=_[_0x2a7c6d(0x107)](_0x4a420c)),!_[_0x2a7c6d(0x10d)](_0x22a1dc)&&_0x327b83[_0x2a7c6d(0x18e)](_0x22a1dc,_0x58078b[_0x2a7c6d(0x13f)])&&(_0x59f0f3[_0x2a7c6d(0x13f)]=_0x22a1dc),!_[_0x2a7c6d(0x22b)](_0xaee4c7)&&_0x327b83['wlwTm'](_0xaee4c7,_0x58078b[_0x2a7c6d(0x154)])&&(_0x59f0f3[_0x2a7c6d(0x154)]=_0xaee4c7),!_[_0x2a7c6d(0x22b)](_0x1e944d)&&_0x327b83[_0x2a7c6d(0x189)](_0x1e944d,_0x58078b['appearance'])&&(_0x59f0f3['appearance']=_0x1e944d),await WIKI[_0x2a7c6d(0x223)][_0x2a7c6d(0x22a)][_0x2a7c6d(0x1bd)]()[_0x2a7c6d(0x111)](_0x59f0f3)[_0x2a7c6d(0x17b)](_0x44136f);}else throw new WIKI[(_0x2a7c6d(0x14d))]['UserNotFound']();}static async[_0x57d895(0x21a)](_0x34c774,_0x30d59b){const _0x4ed992=_0x57d895,_0x22c956={'VXTUd':'creatorId'},_0x3912e8=await WIKI[_0x4ed992(0x223)][_0x4ed992(0x22a)][_0x4ed992(0x1bd)]()[_0x4ed992(0x17b)](_0x34c774);if(_0x3912e8)await WIKI[_0x4ed992(0x223)]['assets'][_0x4ed992(0x1bd)]()[_0x4ed992(0x111)]({'authorId':_0x30d59b})['where']('authorId',_0x34c774),await WIKI[_0x4ed992(0x223)][_0x4ed992(0x1fb)][_0x4ed992(0x1bd)]()[_0x4ed992(0x111)]({'authorId':_0x30d59b})['where'](_0x4ed992(0x121),_0x34c774),await WIKI[_0x4ed992(0x223)]['pageHistory'][_0x4ed992(0x1bd)]()[_0x4ed992(0x111)]({'authorId':_0x30d59b})['where']('authorId',_0x34c774),await WIKI['models'][_0x4ed992(0x1d4)][_0x4ed992(0x1bd)]()['patch']({'authorId':_0x30d59b})['where'](_0x4ed992(0x121),_0x34c774),await WIKI['models']['pages'][_0x4ed992(0x1bd)]()[_0x4ed992(0x111)]({'creatorId':_0x30d59b})[_0x4ed992(0x123)](_0x22c956[_0x4ed992(0xda)],_0x34c774),await WIKI[_0x4ed992(0x223)][_0x4ed992(0xdd)][_0x4ed992(0x1bd)]()[_0x4ed992(0x1e0)]()[_0x4ed992(0x123)](_0x4ed992(0x216),_0x34c774),await WIKI[_0x4ed992(0x223)][_0x4ed992(0x22a)][_0x4ed992(0x1bd)]()['deleteById'](_0x34c774);else throw new WIKI['Error'][(_0x4ed992(0x17f))]();}static async['register']({email:_0x3d15da,password:_0x2310cc,name:_0x534db7,verify:verify=![],bypassChecks:bypassChecks=![]},_0x1fd07c){const _0x1e2246=_0x57d895,_0x1e5f2b={'xOtYm':function(_0x5e5e5f,_0x5bcadb){return _0x5e5e5f>_0x5bcadb;},'zDClg':'markdown','Mixxf':_0x1e2246(0x19a),'Ydaqs':_0x1e2246(0x188),'QFOtB':_0x1e2246(0xfe),'aSPgU':'Click\x20the\x20button\x20below\x20in\x20order\x20to\x20verify\x20your\x20account\x20and\x20gain\x20access\x20to\x20the\x20wiki.','iJopU':_0x1e2246(0x12b)},_0x5f3b0b=await WIKI[_0x1e2246(0x223)][_0x1e2246(0x1de)][_0x1e2246(0x10e)]('local');if(_0x5f3b0b[_0x1e2246(0xe9)]||bypassChecks){_0x3d15da=_['toLower'](_0x3d15da);const _0x447ea4=validate({'email':_0x3d15da,'password':_0x2310cc,'name':_0x534db7},{'email':{'email':!![],'length':{'maximum':0xff}},'password':{'presence':{'allowEmpty':![]},'length':{'minimum':0x6}},'name':{'presence':{'allowEmpty':![]},'length':{'minimum':0x2,'maximum':0xff}}},{'format':'flat'});if(_0x447ea4&&_0x447ea4[_0x1e2246(0x1f0)]>0x0)throw new WIKI[(_0x1e2246(0x14d))][(_0x1e2246(0x1b2))](_0x447ea4[0x0]);if(_0x1e5f2b[_0x1e2246(0xfa)](_['get'](_0x5f3b0b,'domainWhitelist.v',[])[_0x1e2246(0x1f0)],0x0)&&!bypassChecks){const _0x3c2676=_[_0x1e2246(0x191)](_0x3d15da[_0x1e2246(0x1e3)]('@'));if(!_[_0x1e2246(0x127)](_0x5f3b0b[_0x1e2246(0x1e5)]['v'],_0x3c2676))throw new WIKI[(_0x1e2246(0x14d))][(_0x1e2246(0xec))]();}const _0x491f38=await WIKI[_0x1e2246(0x223)][_0x1e2246(0x22a)][_0x1e2246(0x1bd)]()[_0x1e2246(0x16d)]({'email':_0x3d15da,'providerKey':_0x1e2246(0x16b)});if(!_0x491f38){const _0x49b19e=await WIKI[_0x1e2246(0x223)][_0x1e2246(0x22a)][_0x1e2246(0x1bd)]()[_0x1e2246(0x217)]({'provider':_0x1e2246(0x16b),'email':_0x3d15da,'name':_0x534db7,'password':_0x2310cc,'locale':'en','defaultEditor':_0x1e5f2b[_0x1e2246(0x160)],'tfaIsActive':![],'isSystem':![],'isActive':!![],'isVerified':![]});_['get'](_0x5f3b0b,'autoEnrollGroups.v',[])['length']>0x0&&await _0x49b19e[_0x1e2246(0x1eb)](_0x1e2246(0x1ce))[_0x1e2246(0xef)](_0x5f3b0b[_0x1e2246(0xf9)]['v']);if(verify){const _0x62edb2=await WIKI[_0x1e2246(0x223)][_0x1e2246(0xdd)][_0x1e2246(0xe6)]({'kind':_0x1e5f2b[_0x1e2246(0x1b3)],'userId':_0x49b19e['id']});await WIKI['mail'][_0x1e2246(0xf4)]({'template':_0x1e5f2b[_0x1e2246(0x101)],'to':_0x3d15da,'subject':_0x1e2246(0x146),'data':{'preheadertext':_0x1e5f2b[_0x1e2246(0x13b)],'title':'Verify\x20your\x20account','content':_0x1e5f2b['aSPgU'],'buttonLink':WIKI[_0x1e2246(0x1d5)][_0x1e2246(0xed)]+_0x1e2246(0x1cc)+_0x62edb2,'buttonText':_0x1e5f2b[_0x1e2246(0x147)]},'text':_0x1e2246(0x12f)+WIKI[_0x1e2246(0x1d5)][_0x1e2246(0xed)]+_0x1e2246(0x1cc)+_0x62edb2});}return!![];}else throw new WIKI['Error']['AuthAccountAlreadyExists']();}else throw new WIKI[(_0x1e2246(0x14d))][(_0x1e2246(0x161))]();}static async[_0x57d895(0x169)](_0x5a4e5b){const _0x18f400=_0x57d895,_0x3b3233={'etHwA':_0x18f400(0x1be),'bcpYN':_0x18f400(0x1a9)};if(!_0x5a4e5b['req'][_0x18f400(0x1aa)]||_0x5a4e5b['req'][_0x18f400(0x1aa)]['id']===0x2)return'/';const _0x43321d=await WIKI[_0x18f400(0x223)]['users'][_0x18f400(0x1bd)]()['findById'](_0x5a4e5b['req'][_0x18f400(0x1aa)]['id'])['select'](_0x3b3233[_0x18f400(0x1da)]),_0x2e4fe7=_[_0x18f400(0x1ed)](WIKI[_0x18f400(0x18a)]['strategies'],[_0x3b3233[_0x18f400(0x21f)],_0x43321d[_0x18f400(0x1be)]]);return _0x2e4fe7[_0x18f400(0x169)]?_0x2e4fe7[_0x18f400(0x169)](_0x2e4fe7['config'],_0x5a4e5b):'/';}static async[_0x57d895(0x150)](){const _0x56a131=_0x57d895,_0x536b6f={'zkDAN':'groups.id','bBLwm':'permissions','XOGxo':_0x56a131(0x1ce),'FYrhi':_0x56a131(0x105),'GdTNO':'SoGQJ'},_0x28d385=await WIKI['models'][_0x56a131(0x22a)][_0x56a131(0x1bd)]()[_0x56a131(0x17b)](0x2)['withGraphJoined'](_0x536b6f[_0x56a131(0x157)])[_0x56a131(0x1c5)](_0x536b6f['XOGxo'],_0x5b8ab2=>{const _0x4cacb4=_0x56a131;_0x5b8ab2['select'](_0x536b6f[_0x4cacb4(0x11c)],_0x536b6f[_0x4cacb4(0x1d9)]);});if(!_0x28d385){if(_0x536b6f[_0x56a131(0x17d)]!==_0x536b6f[_0x56a131(0x1c6)])WIKI['logger'][_0x56a131(0x124)](_0x56a131(0x17c)),process[_0x56a131(0x119)](0x1);else throw new _0x42fe96[(_0x56a131(0x14d))][(_0x56a131(0x17f))]();}return _0x28d385[_0x56a131(0xfb)]=_0x28d385[_0x56a131(0x15e)](),_0x28d385;}static async['getRootUser'](){const _0x5930fc=_0x57d895,_0x426e23={'vSZCn':_0x5930fc(0x158),'wbqcR':_0x5930fc(0x226)};let _0x27098a=await WIKI[_0x5930fc(0x223)]['users'][_0x5930fc(0x1bd)]()[_0x5930fc(0x17b)](0x1);return!_0x27098a&&(WIKI[_0x5930fc(0x1b1)][_0x5930fc(0x124)](_0x426e23[_0x5930fc(0x11b)]),process[_0x5930fc(0x119)](0x1)),_0x27098a[_0x5930fc(0xfb)]=[_0x426e23[_0x5930fc(0x118)]],_0x27098a;}static async[_0x57d895(0x21d)](_0x169190,_0x460cbb){const _0x3a6141=_0x57d895,_0x114aca={'eRwdp':function(_0x3d42d5,_0x1504c0){return _0x3d42d5*_0x1504c0;},'KWXFg':_0x3a6141(0x185)};try{WIKI['logger'][_0x3a6141(0x21c)](_0x3a6141(0x115)+_0x169190+_0x3a6141(0x122));if(_0x460cbb[_0x3a6141(0x1f0)]>_0x114aca[_0x3a6141(0x144)](0x400,0x400))throw new Error(_0x3a6141(0x15a));const _0x25af24=await WIKI[_0x3a6141(0x223)][_0x3a6141(0x15c)](_0x114aca['KWXFg'])[_0x3a6141(0x152)]('id')[_0x3a6141(0x123)]('id',_0x169190)[_0x3a6141(0x203)]();_0x25af24?await WIKI['models'][_0x3a6141(0x15c)](_0x114aca[_0x3a6141(0x1ab)])[_0x3a6141(0x123)]({'id':_0x169190})[_0x3a6141(0x1e6)]({'data':_0x460cbb}):await WIKI[_0x3a6141(0x223)][_0x3a6141(0x15c)](_0x3a6141(0x185))[_0x3a6141(0x217)]({'id':_0x169190,'data':_0x460cbb});}catch(_0x206e2f){WIKI[_0x3a6141(0x1b1)][_0x3a6141(0x172)](_0x3a6141(0x1ae)+_0x169190+':\x20'+_0x206e2f[_0x3a6141(0x206)]);}}static async[_0x57d895(0x205)](_0x945ed8){const _0x527fc1=_0x57d895,_0x4a8bc0={'BssUE':_0x527fc1(0x114),'ndEDZ':_0x527fc1(0x185),'UaoPq':function(_0x5f3bf1,_0x13a390){return _0x5f3bf1===_0x13a390;},'bDzLL':'fAfsO'};try{const _0x3e5d67=await WIKI[_0x527fc1(0x223)][_0x527fc1(0x15c)](_0x4a8bc0[_0x527fc1(0x204)])['where']('id',_0x945ed8)[_0x527fc1(0x203)]();if(_0x3e5d67)return _0x3e5d67[_0x527fc1(0x117)];else{if(_0x4a8bc0[_0x527fc1(0x14e)](_0x527fc1(0xea),_0x4a8bc0['bDzLL']))throw new _0x3e818c(_0x4a8bc0[_0x527fc1(0x139)]);else return null;}}catch(_0x2fe463){WIKI['logger'][_0x527fc1(0x172)](_0x527fc1(0x1ae)+_0x945ed8);}}};function _0x41ef(){const _0x13d573=['984843GmXZOt','Avatar\x20image\x20filesize\x20is\x20too\x20large.\x201MB\x20max.','hash','knex','Model','getGlobalPermissions','Password\x20Reset\x20Request','zDClg','AuthRegistrationDisabled','7428950AIonXu','Password\x20must\x20be\x20at\x20least\x206\x20characters!','object',':\x20Inactive.','resetPwd','mail','SRnph','logout','authentication.key','local','wiRZK','findOne','AuthAccountBanned','AuthLoginFailed','integer','tfaIsActive','warn','/login-reset/','6905548sXYxKD','.\x20Open\x20the\x20following\x20link\x20to\x20proceed:\x20','verifyToken','RVYFC','uniq','UHbiN','aZitT','findById','CRITICAL\x20ERROR:\x20Guest\x20user\x20is\x20missing!','FYrhi','kExRi','UserNotFound','BelongsToOneRelation','GStbQ','SWdKS','flat','$query','userAvatars','LkTcw','YEPrm','accountVerify','xTwvU','auth','You\x20are\x20not\x20authorized\x20to\x20login.','ShoJj','rzmyb','RczSO','bcLhR','CtINr','last','verifyTFA','HJVdb','flattenDeep','fkgBA','Password\x20reset\x20attempt\x20on\x20nonexistant\x20local\x20account\x20','authenticate','mustChangePwd','enableTFA','verify','You\x27ve\x20been\x20invited\x20to\x20the\x20wiki\x20','isSafeInteger','userGroups.userId','WwEyD','displayName','12eWUMPG','AuthGenericError','get','internal','hHMVO','jOvxn','tableName','sessionSecret','A\x20password\x20reset\x20was\x20requested\x20for\x20','key','user','KWXFg','strategyKey','SqIoQ','Failed\x20to\x20process\x20binary\x20thumbnail\x20data\x20for\x20user\x20','AuthAccountAlreadyExists','password','logger','InputInvalid','Mixxf','njuPv','req','qbAIw','appearance','A\x20password\x20reset\x20was\x20requested\x20for\x20wiki\x20','strategy','lALmQ','changePwd','map','query','providerKey','MaKce','SJSzK','kJMCo','afterLoginChecks','1471038FEUHpy','set','modifyGraph','GdTNO','efQia','2443576VQfmJo','logIn','13885102szTnjq','Qtlgp','/verify/','This\x20is\x20a\x20system\x20reserved\x20account\x20and\x20cannot\x20be\x20used.','groups','generateTFA','login','reWdf','enforce2FA','jsonwebtoken','pages','config','AOSty','isString','PtYbH','bBLwm','etHwA','oAFar','toString','EIfHY','authentication','tHTcw','delete','AuthTFAFailed','refreshToken','split','unrelate','domainWhitelist','update','groups.id','edAls','KrZEP','Login','$relatedQuery','661284LqjgAZ','find','uJwYz','Reset\x20Password','length','EILYy','strategies','dDefK','replace','editors.key',':\x20Not\x20found.','redirectOnLogin','fJodE','pictureUrl','params','comments','LmRmd','toLower','locales.code','markdown','lAPup','isArray','JWVbw','first','ndEDZ','getUserAvatarData','message','name','GFrRz','BjPNQ','MheEj','PLVhk','9jScFpa','difference','tfa','izfjj','useForm','./editors','NEePe','users.editorKey','loginChangePassword','sIbby','userId','insert','zgxRS','JMtEY','deleteUser','5KkqCJK','debug','updateUserAvatarData','ozIRW','bcpYN','vvfGl','userGroups.groupId','oxTWB','models','seTAz','updatedAt','manage:system','title','AmeRl','tfaSetup','users','isNil','isSystem','code','OIqxG','passport','updateUser','VXTUd','audience','bvdMB','userKeys','string','./groups','dsIZY','zVtfM','createNewUser','UTjJa','has','test','generateToken','AcSNM','value','selfRegistration','HQHmL','location','AuthRegistrationDomainUnauthorized','host','PZCBX','relate','validateToken','secret','UOnkY','UlaRa','send','email','dYqUg','dRSKE','FAxBJ','autoEnrollGroups','xOtYm','permissions','SsxNv','howTL','Verify\x20your\x20account\x20in\x20order\x20to\x20gain\x20access\x20to\x20the\x20wiki.','token','Mmjpp','Ydaqs','generateHash','getGroups','QxEFe','FodxR','objection','trim','picture','AWGnO','scopes','TkMek','accountResetPwd','isEmpty','getStrategy','jobTitle','isBuffer','patch','boolean','delta','Missing\x20or\x20invalid\x20email\x20address\x20from\x20profile.','Updating\x20user\x20','cdUuV','data','wbqcR','exit','otpauth://totp/','vSZCn','zkDAN','verifyPassword','private','relationMappings','MrVmh','authorId','\x20avatar\x20data...','where','error','patchAndFetch','sEVAC','includes','$beforeUpdate','sMShy','Click\x20the\x20button\x20below\x20to\x20reset\x20your\x20password.\x20If\x20you\x20didn\x27t\x20request\x20this\x20password\x20reset,\x20simply\x20discard\x20this\x20email.','Verify','kNNXF','groupId','zPUnq','You\x20must\x20open\x20the\x20following\x20link\x20in\x20your\x20browser\x20to\x20verify\x20your\x20account\x20and\x20gain\x20access\x20to\x20the\x20wiki:\x20','lodash','primary',':\x20[DISCARDED]','akWXZ','$beforeInsert','isActive','lang','body.password','toISOString','BssUE','tfaSecret','QFOtB','YNPhM','validate.js','Welcome\x20to\x20the\x20wiki\x20','timezone','35RbqOqj','jsonSchema','uIJTo','compare','eRwdp','ManyToManyRelation','Verify\x20your\x20account','iJopU','processProfile','?secret=','qr-image','truncate','certs','Error','UaoPq','./authentication','getGuestUser','users.localeCode','select','AuthTFAInvalid','dateFormat','bkKZo','emails','XOGxo','CRITICAL\x20ERROR:\x20Root\x20Administrator\x20user\x20is\x20missing!'];_0x41ef=function(){return _0x13d573;};return _0x41ef();}