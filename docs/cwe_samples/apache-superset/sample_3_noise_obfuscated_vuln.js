const _0x321123=_0x31ee;function _0x3685(){const _0x2bb1a8=['vAtWK','Invalid\x20password','openid\x20profile\x20email','logFailedLocalAuthLoginAttempt','sso_redirect_uri','MHVFN','/logout','RMwgW','Strategy','issuer','ScziV','Hash\x20failed','ecvya','setHttpOptionsDefaults','vPipw','hleJg','setUserGroup','PNjic','&autoLaunch=0','FfDit','RaZbx','Invalid\x20userinfo,\x20no\x20sub','getUserLoginResponsePayload','uVRye','get','FpbMF','_client','authOpenIDSub','jMokf','Cvoqj','authOpenIDJwksURL','Group\x20claim\x20','TNOPK','/login','GIYUP','fmGCj','pUpEh','includes','iIbpr','?code=','/auth/openid/config','tokenSecret','PafgR','TUwOR','sign','rQNoY','AyCyl','YUOSB','No\x20session','findOrCreateUser','[Auth]\x20Error\x20in\x20openid\x20callback:\x20','token_endpoint','zWaKv','x-forwarded-proto','\x22\x20from\x20ip\x20','ziIdU','jwtAuthCheck','Invalid\x20response_type,\x20only\x20code\x20supported','XDRjE','bNviR','code_challenge_method','sendStatus','MqkbJ','ILiLb','req','toJSONForBrowser','find','tjBVy','logout','end_session_endpoint','userinfo_endpoint','openIdAuthSession','method','generateAccessToken','./libs/requestIp','1002peTFwM','iHGwP','opZPi','FQzDI','error','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.preferred_username\x20\x22','dDsSg','1666cgBqtA','email_verified','KEntP','aveCm','OxcKO','Unknown\x20error','tCiHq','ugUUG','status','TOKEN_SECRET','[Auth]\x20openid:\x20User\x20found\x20but\x20is\x20not\x20active','[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration\x20at\x20\x22','initTokenSecret','toLowerCase','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20invalid','authOpenIDAdvancedPermsClaim','rleQu','http','getUserByOpenIDSub','ServerSettings','QZAHv','State\x20parameter\x20mismatch','user','tFfaY','authOpenIDMobileRedirectURIs','DayGN','BHtCQ','[Auth]\x20Error\x20in\x20openid\x20callback\x20-\x20','fKNUo','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20email\x20\x22','authOpenIDGroupClaim','mDGpt','secure','https','/auth/openid/callback','passport-jwt','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.username\x20\x22','hyuBt','UAqeH','test','debug','wbiBP','originalUrl','Root\x20user\x20\x22','username','KOwEG','PHczW','custom','hash','getDefaultLibraryId','PzGhp','serverSettings','MWXrq','AzEZQ','User\x20has\x20no\x20password\x20set.\x20Might\x20have\x20been\x20created\x20with\x20OpenID','libraryModel','nJmfz','MimxK','eVtHl','/auth/openid','\x20not\x20found\x20in\x20userinfo','Hecmd','updateUserPermissions','[Auth]\x20openid\x20callback:\x20Updating\x20user\x20\x22','id_token','zsnBe','body','rVHAc','./Database','json','hashPass','Advanced\x20permissions\x20claim\x20','vskwn','clearCookie',':\x20Failed\x20to\x20get\x20openid\x20configuration','userModel','Root\x20user\x20has\x20no\x20password\x20set','gifiL','userId','HvCiU','cYzEE','bGUWb','query','randomBytes','jwks_uri','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20neither\x20preferred_username\x20nor\x20username\x20in\x20userinfo','local','acjxy','MCYlu','SOnLo','VOHTC','NjopP','KtbEc','cQhCS','ZNKNP','wbTpu','root','mobile_redirect_uri','QCWAI','uiSot','SwWrj','findAll','code_verifier','Error\x20in\x20callback','Error\x20during\x20login','deIMb','unuseAuthStrategy','return\x20new\x20Date();','\x22\x20is\x20not\x20verified','cDKrW','userChangePassword','wEfAQ','getUserByEmail','JIyNi','JIxjo','warn','then','1109491jcuzOU','generators','User\x20is\x20not\x20active','[Auth]\x20openid\x20callback\x20userinfo=','ygMan','fEhtj','isAuthMethodAPIBased','/auth/openid/mobile-redirect','rzvDF','pathname','state','[Auth]\x20openid:\x20User\x20found\x20by\x20sub','preferred_username','\x20not\x20found\x20or\x20empty\x20in\x20userinfo','[Auth]\x20Error\x20in\x20/auth/openid\x20route:\x20','RArMM','return\x20await\x20Promise.resolve(42);','authOpenIDAutoRegister','isAuthenticated','\x22\x20changed\x20password','xeeAr','VkdPk','logIn','[Auth]\x20User\x20\x22','/.well-known/openid-configuration','FguXw','uUtwU','Strict','XLFos','authOpenIDLogoutURL','iGyBv','token','initAuthStrategyPassword','[Auth]\x20Invalid\x20auth\x20strategy\x20','code','ZyUfR','Evnmc','sub','getUserById','cmyya','id_token_signing_alg_values_supported','roHUD','Only\x20S256\x20code_challenge_method\x20method\x20supported','bToKI','set','emailSettings','OfyPc','YfdLT','[Auth]\x20Cannot\x20init\x20openid\x20auth\x20strategy\x20-\x20invalid\x20settings','message','\x22\x20type\x20to\x20\x22','has','isActive','auth_method','fromExtractors','Client','auth_state','[Auth]\x20Invalid\x20redirect_uri=','GET','TWnuY','\x22\x20failed\x20to\x20change\x20password','bsXTo','catch','unuse','base64','vBUvu','random','wfyLe','[Auth]\x20No\x20data\x20in\x20openid\x20callback\x20-\x20','Unauthorized','mHsqp','UNKNOWN','code_challenge','KaPxe','2379900elqabS','://','OoVjl','extraData','verify','[Auth]\x20OIDC\x20redirect_uri=','authOpenIDClientID','ExtractJwt','\x22\x20cannot\x20be\x20downgraded\x20to\x20','response_type','safe','TvGmm','log','vnfrn','RouterBasePath','endSessionUrl','frWVE','fromAuthHeaderAsBearerToken','BeOqO','LrplZ','4458736xDSgQl','openid-client','OecSo','var\x20x\x20=\x2042;\x20return\x20x;','\x22\x20using\x20\x22','jtKfl','sOyBx','getUserByUsername','1789113RDetcJ','LenCX','statusCode','yumXg','kSKyu','callback','zjJEo','updatePermissionsFromExternalJSON','?setToken=','FhWcp','fpMSF','wpBjN','prDfv','No\x20callback\x20or\x20already\x20expired','\x22\x20but\x20is\x20already\x20matched\x20with\x20sub\x20\x22','parse','host','authOpenIDMatchExistingBy','[Auth]\x20openid\x20callback:\x20Updating\x20advanced\x20perms\x20for\x20user\x20\x22','rVpfC','endsWith','save','QgdJc','post','rphtz','cookie','iLasj','console.log(\x22timer\x22);','validateGroupClaim','pash','comparePassword','[Auth]\x20openid:\x20User\x20found\x20with\x20email\x20\x22','_params','S256','authOpenIDSubfolderForRedirectURLs','User\x20not\x20active\x20or\x20not\x20found','authActiveAuthMethods','Invalid\x20new\x20password\x20-\x20Only\x20root\x20can\x20have\x20an\x20empty\x20password','GnUPQ','cookies','admin','XDCqw','2PVcEEM','type','btkeJ','faJJG','guest','YUhJv','[Auth]\x20No\x20redirect\x20URI','NPzKa','Internal\x20Server\x20Error','PMDyl','[Auth]\x20Non-admin\x20user\x20\x22','VKfIL','info','express','fHQAk','DYwou','EnyWq','RIzuB','./libs/jsonwebtoken','toString','488853ikVKHp','paramsToCookies','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20email\x20\x22','SBgvz','ZpGvg','dyokl','authenticate','wYIrV','lujFw','jwt','createUserFromOpenIdUserInfo','User\x20not\x20found','ignorePatterns','fIytl','max_age','handleLoginSuccessBasedOnCookie','XXLcT','auth_cb','BCIOh','authNotNeeded','QZwfE','openid-mobile','some','[Auth]\x20OIDC\x20Invalid\x20response_type=','rEYfQ','compare','qhjCN','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20auto-register\x20is\x20disabled','Authorization:\x20REDACTED','SbMeu','slice','initAuthStrategyOpenID','HHWHM','OSUpX','PcvZT','Source','getAllLibraryIds','Invalid\x20redirect_uri','getUserByIdOrOldId','stack','DStIx','openid_id_token','lWoRQ','isAdminOrUp','fromUrlQueryParameter','zcjGw','stringify','XuWKk','replace','WibQk','response','./Logger','HaroT','session','3498200dmfcPK','OQzVu','openid','HAAaa','map','_strategy','Invalid\x20pathname','unxTd','uJgXU','_key','\x22\x20logged\x20in\x20from\x20ip\x20','IHoiG','authOpenIDClientSecret','No\x20valid\x20group\x20found\x20in\x20userinfo:\x20','KTOhc','kfYfr','useAuthStrategy','mZJZx','KpUtI','changed','codeVerifier','&state=','authOpenIDUserInfoURL','validateAccessToken','VcWAT','kxJAm','return\x20Object.keys({a:1});','[Auth]\x20openid:\x20Auto-registering\x20user\x20with\x20sub\x20\x22','XpWVB','updateClock();','bind','redirect','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20required','email','JpcaS','YAFXs','length','uTSky','asGwT','HdnPF','mpbaV','yVWVE','JFGRw','getClientIp','crypto','yDfNm','[Auth]\x20openid:\x20User\x20found\x20with\x20username\x20\x22','redirect_uri','toOldJSONForBrowser','mobile','send','authorizationUrl','AJuiE','localAuthCheckUserPw','mCNpW'];_0x3685=function(){return _0x2bb1a8;};return _0x3685();}(function(_0x17137d,_0x46f6a7){const _0x2d9b11=_0x31ee,_0x51e767=_0x17137d();while(!![]){try{const _0x1b1835=parseInt(_0x2d9b11(0xe7))/0x1*(parseInt(_0x2d9b11(0x177))/0x2)+-parseInt(_0x2d9b11(0x14d))/0x3+parseInt(_0x2d9b11(0x145))/0x4+-parseInt(_0x2d9b11(0x131))/0x5+parseInt(_0x2d9b11(0x243))/0x6*(parseInt(_0x2d9b11(0x24a))/0x7)+-parseInt(_0x2d9b11(0x1c1))/0x8+-parseInt(_0x2d9b11(0x18b))/0x9;if(_0x1b1835===_0x46f6a7)break;else _0x51e767['push'](_0x51e767['shift']());}catch(_0x294fb6){_0x51e767['push'](_0x51e767['shift']());}}}(_0x3685,0xaae4a));const axios=require('axios'),passport=require('passport'),{Request,Response,NextFunction}=require(_0x321123(0x184)),bcrypt=require('./libs/bcryptjs'),jwt=require(_0x321123(0x189)),requestIp=require(_0x321123(0x242)),LocalStrategy=require('./libs/passportLocal'),JwtStrategy=require(_0x321123(0x26d))['Strategy'],ExtractJwt=require('passport-jwt')[_0x321123(0x138)],OpenIDClient=require(_0x321123(0x146)),Database=require(_0x321123(0x28e)),Logger=require(_0x321123(0x1be));function _0x31ee(_0xc759d6,_0x101783){const _0x368514=_0x3685();return _0x31ee=function(_0x31ee82,_0x3dff35){_0x31ee82=_0x31ee82-0xe3;let _0x458be9=_0x368514[_0x31ee82];return _0x458be9;},_0x31ee(_0xc759d6,_0x101783);}class Auth{constructor(){const _0x39e2c6=_0x321123;this[_0x39e2c6(0x23f)]=new Map(),this[_0x39e2c6(0x197)]=[/\/api\/items\/[^/]+\/cover/,/\/api\/authors\/[^/]+\/image/];}[_0x321123(0x19e)](_0x45f294){const _0x22bc2f=_0x321123,_0x3dcd8b={'HdnPF':_0x22bc2f(0x1de),'kxJAm':_0x22bc2f(0x121)};return setInterval(_0x3dcd8b[_0x22bc2f(0x1e8)],0x3e8),_0x45f294[_0x22bc2f(0x240)]===_0x3dcd8b[_0x22bc2f(0x1da)]&&this[_0x22bc2f(0x197)][_0x22bc2f(0x1a1)](_0x11115e=>_0x11115e[_0x22bc2f(0x271)](_0x45f294[_0x22bc2f(0x274)]));}['ifAuthNeeded'](_0x2b040a){const _0x16ecef=_0x321123,_0x2d1ab3={'asGwT':'var\x20x\x20=\x2042;\x20return\x20x;','aGqeD':function(_0x573133){return _0x573133();},'OfyPc':function(_0xda2c6,_0x163d2d,_0x5c7e08,_0x546785){return _0xda2c6(_0x163d2d,_0x5c7e08,_0x546785);},'GyKmc':function(_0x2efba4,_0x5041ec){return _0x2efba4(_0x5041ec);}};return _0x2d1ab3['GyKmc'](Function,_0x16ecef(0x1db))(),(_0x389405,_0x4d74ea,_0x43dd15)=>{const _0x54f4af=_0x16ecef;if(this[_0x54f4af(0x19e)](_0x389405))return new Function(_0x2d1ab3[_0x54f4af(0x1e7)])(),_0x2d1ab3['aGqeD'](_0x43dd15);_0x2d1ab3[_0x54f4af(0x115)](_0x2b040a,_0x389405,_0x4d74ea,_0x43dd15);};}async['initPassportJs'](){const _0x1278f6=_0x321123,_0x1695ac={'EexAz':function(_0x5021ad,_0x213c25){return _0x5021ad===_0x213c25;},'JKycs':_0x1278f6(0x278),'mcxTF':'RjISd','ZKKhT':_0x1278f6(0xf7),'NPzKa':function(_0x179209,_0xc5ad3b,_0x309fa1){return _0x179209(_0xc5ad3b,_0x309fa1);},'HaroT':_0x1278f6(0x2a0),'rswOR':_0x1278f6(0x1c3),'sOyBx':_0x1278f6(0x173),'UBIVa':_0x1278f6(0x106)};global['ServerSettings'][_0x1278f6(0x171)][_0x1278f6(0x21d)](_0x1695ac[_0x1278f6(0x1bf)])&&this['initAuthStrategyPassword'](),global[_0x1278f6(0x25d)][_0x1278f6(0x171)][_0x1278f6(0x21d)](_0x1695ac['rswOR'])&&(_0x1695ac[_0x1278f6(0x14b)]==='wfdRy'?_0x194132[_0x1278f6(0x1c0)][_0x33f8ab]['code_verifier']=_0x34e9f2[_0x1278f6(0x29c)][_0x1278f6(0x2b0)]:this['initAuthStrategyOpenID']()),passport['use'](new JwtStrategy({'jwtFromRequest':ExtractJwt[_0x1278f6(0x11d)]([ExtractJwt[_0x1278f6(0x142)](),ExtractJwt[_0x1278f6(0x1b7)](_0x1695ac['UBIVa'])]),'secretOrKey':Database['serverSettings']['tokenSecret']},this['jwtAuthCheck'][_0x1278f6(0x1df)](this))),passport['serializeUser'](function(_0x5a617a,_0x128aa9){process['nextTick'](function(){const _0x40a9b5=_0x31ee;return setTimeout('console.log(\x22timer\x22);',0x3e8),_0x128aa9(null,JSON[_0x40a9b5(0x1b9)]({'id':_0x5a617a['id']}));});}),passport['deserializeUser'](function(_0x364446,_0x54ebaa){const _0x35aed6=_0x1278f6,_0x786973={'UpHxB':_0x35aed6(0x194)};process['nextTick'](async function(){const _0x2fc9c8=_0x35aed6;if(_0x1695ac['EexAz'](_0x1695ac['JKycs'],_0x1695ac['mcxTF']))_0xb37bc8[_0x2fc9c8(0x191)](_0x786973['UpHxB'])(_0x29d7c7,_0x5334d9,_0x5858ce);else{const _0xc6e1f8=JSON[_0x2fc9c8(0x15c)](_0x364446),_0x2ce562=await Database[_0x2fc9c8(0x295)][_0x2fc9c8(0x10d)](_0xc6e1f8['id']);return new AsyncFunction(_0x1695ac['ZKKhT'])(),_0x1695ac[_0x2fc9c8(0x17e)](_0x54ebaa,null,_0x2ce562);}}[_0x35aed6(0x1df)](this));}[_0x1278f6(0x1df)](this));}[_0x321123(0x107)](){const _0x2652ea=_0x321123;passport['use'](new LocalStrategy({'passReqToCallback':!![]},this[_0x2652ea(0x1f6)][_0x2652ea(0x1df)](this)));}[_0x321123(0x1aa)](){const _0x295f9f=_0x321123,_0x16d2cd={'OQzVu':_0x295f9f(0x11f),'AzEZQ':_0x295f9f(0x146),'SBgvz':function(_0xba0386,_0x34ada6){return _0xba0386===_0x34ada6;},'rzvDF':'openid','oSWjL':function(_0x5d8550,_0x59c026){return _0x5d8550===_0x59c026;},'rleQu':_0x295f9f(0x26b),'FpbMF':_0x295f9f(0x15d),'fmGCj':_0x295f9f(0x1b4),'KmONb':_0x295f9f(0x223),'ziIdU':function(_0x340b69,_0x5a8dc1){return _0x340b69!==_0x5a8dc1;},'VOHTC':function(_0x48d530,_0x38017e,_0x5cf4e6){return _0x48d530(_0x38017e,_0x5cf4e6);},'XLFos':function(_0x308148,_0x1efcec,_0x12be49){return _0x308148(_0x1efcec,_0x12be49);},'mCNpW':_0x295f9f(0x22c),'unxTd':_0x295f9f(0xf7),'EnyWq':function(_0x32a8da,_0x11dcd3,_0x4822a1,_0x42aa42){return _0x32a8da(_0x11dcd3,_0x4822a1,_0x42aa42);},'JpcaS':_0x295f9f(0x20b),'Evnmc':function(_0x5813e2,_0x13919c,_0x485185){return _0x5813e2(_0x13919c,_0x485185);},'YUOSB':_0x295f9f(0x1de),'GxSnG':'openid\x20profile\x20email'};if(!Database[_0x295f9f(0x27d)]['isOpenIDAuthSettingsValid']){if(_0x16d2cd['ziIdU'](_0x16d2cd[_0x295f9f(0x1e3)],'FfDit'))_0x2ae82d['cookie'](_0x16d2cd[_0x295f9f(0x1c2)],_0x494424[_0x295f9f(0x29c)]['state'],{'maxAge':_0x386fd8,'httpOnly':!![]});else{Logger['error'](_0x295f9f(0x117)),_0x16d2cd[_0x295f9f(0x10b)](setInterval,_0x16d2cd[_0x295f9f(0x227)],0x3e8);return;}}OpenIDClient[_0x295f9f(0x279)][_0x295f9f(0x205)]({'timeout':0x2710});const _0x4107de=new OpenIDClient['Issuer']({'issuer':global['ServerSettings']['authOpenIDIssuerURL'],'authorization_endpoint':global[_0x295f9f(0x25d)]['authOpenIDAuthorizationURL'],'token_endpoint':global[_0x295f9f(0x25d)]['authOpenIDTokenURL'],'userinfo_endpoint':global['ServerSettings'][_0x295f9f(0x1d7)],'jwks_uri':global['ServerSettings'][_0x295f9f(0x216)],'end_session_endpoint':global[_0x295f9f(0x25d)][_0x295f9f(0x104)]})[_0x295f9f(0x11e)],_0x56a8d9=new _0x4107de({'client_id':global[_0x295f9f(0x25d)][_0x295f9f(0x137)],'client_secret':global[_0x295f9f(0x25d)][_0x295f9f(0x1cd)],'id_token_signed_response_alg':global['ServerSettings']['authOpenIDTokenSigningAlgorithm']});passport['use']('openid-client',new OpenIDClient[(_0x295f9f(0x200))]({'client':_0x56a8d9,'params':{'redirect_uri':global[_0x295f9f(0x25d)][_0x295f9f(0x16f)]+_0x295f9f(0x26c),'scope':_0x16d2cd['GxSnG']}},async(_0x56c935,_0x543278,_0x399431)=>{const _0x251d85=_0x295f9f;if(_0x16d2cd['KmONb']!=='lSNBO')try{Logger[_0x251d85(0x272)](_0x251d85(0xea),JSON[_0x251d85(0x1b9)](_0x543278,null,0x2));if(!_0x543278[_0x251d85(0x10c)]){if(_0x16d2cd[_0x251d85(0x22f)](_0x251d85(0x263),_0x251d85(0x263)))_0x8ef988['PI']*0x2;else throw new Error(_0x251d85(0x20d));}if(!this[_0x251d85(0x169)](_0x543278))throw new Error(_0x251d85(0x217)+Database[_0x251d85(0x27d)][_0x251d85(0x268)]+_0x251d85(0xf4));let _0x34514c=await this[_0x251d85(0x229)](_0x543278);if(!_0x34514c?.[_0x251d85(0x11b)])throw new Error(_0x251d85(0x170));return await this[_0x251d85(0x208)](_0x34514c,_0x543278),await this[_0x251d85(0x288)](_0x34514c,_0x543278),_0x34514c[_0x251d85(0x1b4)]=_0x56c935[_0x251d85(0x28a)],_0x16d2cd[_0x251d85(0x2a4)](setInterval,_0x251d85(0x1de),0x3e8),_0x16d2cd[_0x251d85(0x103)](_0x399431,null,_0x34514c);}catch(_0xfeb4c8){return _0x251d85(0x22c)!==_0x16d2cd[_0x251d85(0x1f7)]?(_0xd00306['warn'](_0x251d85(0x254)),eval('const _0x1065e8 = _0x251d85;_0xbb0df3[_0x1065e8(441)]({ \'safe\': !![] });'),null):(Logger[_0x251d85(0x247)]('[Auth]\x20openid\x20callback\x20error:\x20'+_0xfeb4c8?.[_0x251d85(0x118)]+'\x0a'+_0xfeb4c8?.[_0x251d85(0x1b2)]),new AsyncFunction(_0x16d2cd[_0x251d85(0x1c8)])(),_0x16d2cd[_0x251d85(0x187)](_0x399431,null,null,_0x251d85(0x12c)));}else{const _0x4d074f=_0x15707f[_0x251d85(0x1c6)](_0x16d2cd[_0x251d85(0x27f)]),_0x30c113=_0x4d074f[_0x251d85(0x212)];if(_0x30c113[_0x251d85(0x201)]['end_session_endpoint']&&_0x30c113['issuer'][_0x251d85(0x23d)][_0x251d85(0x1e5)]>0x0){let _0x51af17=null;if(_0x16d2cd[_0x251d85(0x18e)](_0x5a3f2f,_0x16d2cd[_0x251d85(0xef)])){const _0x32cac8=_0x1f8ff1[_0x251d85(0x26a)]||_0x16d2cd['oSWjL'](_0x31b406[_0x251d85(0x210)](_0x251d85(0x22d)),_0x251d85(0x26b))?_0x16d2cd[_0x251d85(0x25a)]:_0x251d85(0x25b),_0x387157=_0x3eba9e[_0x251d85(0x210)](_0x16d2cd[_0x251d85(0x211)]);_0x51af17=_0x32cac8+_0x251d85(0x132)+_0x387157+_0x3313b6[_0x251d85(0x13f)]+_0x251d85(0x219);}_0x1a16be=_0x30c113[_0x251d85(0x140)]({'id_token_hint':_0x484d63['cookies'][_0x251d85(0x1b4)],'post_logout_redirect_uri':_0x51af17});}_0x1d67ef[_0x251d85(0x293)](_0x16d2cd[_0x251d85(0x21b)]);}}));}async[_0x321123(0x229)](_0x345d3e){const _0x2ac5f3=_0x321123,_0x136cd0={'hcjAv':function(_0x2987b4,_0x1ca014){return _0x2987b4+_0x1ca014;},'WIOPZ':function(_0x4237d1,_0x248778){return _0x4237d1(_0x248778);},'VcWAT':_0x2ac5f3(0x13b),'vBUvu':'email','SOnLo':function(_0x31b05b,_0x2fb95e){return _0x31b05b!==_0x2fb95e;},'fjedS':_0x2ac5f3(0x100),'fKNUo':'oZZuA','ILiLb':function(_0x319ed9,_0x3ceea7,_0x2e915d){return _0x319ed9(_0x3ceea7,_0x2e915d);},'YUhJv':function(_0x5b02b1,_0xa641fc){return _0x5b02b1===_0xa641fc;},'CuObs':_0x2ac5f3(0x13e),'gifiL':function(_0x5bb165,_0x1c863c){return _0x5bb165(_0x1c863c);},'gJBll':'return\x20Object.keys({a:1});','YAFXs':_0x2ac5f3(0x134)};let _0x3c3574=await Database['userModel'][_0x2ac5f3(0x25c)](_0x345d3e['sub']);if(_0x3c3574)return Logger[_0x2ac5f3(0x272)](_0x2ac5f3(0xf2)),eval('JSON[\'stringify\']({ \'safe\': !![] });'),_0x3c3574;if(Database[_0x2ac5f3(0x27d)][_0x2ac5f3(0x15e)]===_0x136cd0[_0x2ac5f3(0x128)]){if(_0x136cd0[_0x2ac5f3(0x2a3)](_0x136cd0['fjedS'],_0x2ac5f3(0x24c))){if(_0x345d3e['email']){if(_0x345d3e[_0x2ac5f3(0x24b)]===![]){if(_0x136cd0[_0x2ac5f3(0x266)]===_0x2ac5f3(0x1b8)){if(!_0xd77dee[_0x2ac5f3(0x29c)][_0x2ac5f3(0x1f0)]||!_0x136cd0['WIOPZ'](_0x363c6d,_0x23b796['query'][_0x2ac5f3(0x1f0)]))return _0xdf42bd[_0x2ac5f3(0x272)](_0x2ac5f3(0x120)+_0x3c6ee1['query'][_0x2ac5f3(0x1f0)]),eval('_0x136cd0[\'hcjAv\'](1, 1);'),_0x242652['status'](0x190)[_0x2ac5f3(0x1f3)](_0x2ac5f3(0x1b0));this['openIdAuthSession'][_0x2ac5f3(0x113)](_0x53973d,{'mobile_redirect_uri':_0x4273fc['query'][_0x2ac5f3(0x1f0)]}),_0x1ce55c=new _0x36e26a(_0x138f6b[_0x2ac5f3(0x25d)][_0x2ac5f3(0x16f)]+_0x2ac5f3(0xee),_0x3e43a4)['toString']();}else return Logger[_0x2ac5f3(0xe5)](_0x2ac5f3(0x267)+_0x345d3e[_0x2ac5f3(0x1e2)]+_0x2ac5f3(0x2b6)),new AsyncFunction(_0x2ac5f3(0xf7))(),null;}else{Logger[_0x2ac5f3(0x183)](_0x2ac5f3(0x18d)+_0x345d3e[_0x2ac5f3(0x1e2)]+'\x22'),_0x3c3574=await Database[_0x2ac5f3(0x295)][_0x2ac5f3(0x2ba)](_0x345d3e[_0x2ac5f3(0x1e2)]);if(_0x3c3574?.['authOpenIDSub'])return Logger['warn'](_0x2ac5f3(0x16c)+_0x345d3e['email']+_0x2ac5f3(0x15b)+_0x3c3574[_0x2ac5f3(0x213)]+'\x22'),_0x136cd0[_0x2ac5f3(0x237)](setTimeout,function(){const _0x41e1a8=_0x2ac5f3;console[_0x41e1a8(0x13d)](_0x136cd0[_0x41e1a8(0x1d9)]);},0x64),null;}}else return Logger[_0x2ac5f3(0xe5)]('[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20no\x20email\x20in\x20userinfo'),eval('1 + 1;'),null;}else throw new _0x350afd(_0x2ac5f3(0x217)+_0x486687['serverSettings'][_0x2ac5f3(0x268)]+_0x2ac5f3(0xf4));}else{if(_0x136cd0[_0x2ac5f3(0x17c)](Database[_0x2ac5f3(0x27d)][_0x2ac5f3(0x15e)],'username')){let _0x46ded8;if(_0x345d3e['preferred_username'])Logger['info'](_0x2ac5f3(0x248)+_0x345d3e['preferred_username']+'\x22'),_0x46ded8=_0x345d3e[_0x2ac5f3(0xf3)];else{if(_0x345d3e['username'])Logger[_0x2ac5f3(0x183)](_0x2ac5f3(0x26e)+_0x345d3e[_0x2ac5f3(0x276)]+'\x22'),_0x46ded8=_0x345d3e[_0x2ac5f3(0x276)];else{if(_0x136cd0['CuObs']!==_0x2ac5f3(0x1e9))return Logger[_0x2ac5f3(0xe5)](_0x2ac5f3(0x29f)),_0x136cd0[_0x2ac5f3(0x297)](Function,_0x136cd0['gJBll'])(),null;else _0x354881[_0x2ac5f3(0x126)](_0x467815);}}_0x3c3574=await Database['userModel'][_0x2ac5f3(0x14c)](_0x46ded8);if(_0x3c3574?.[_0x2ac5f3(0x213)])return Logger[_0x2ac5f3(0xe5)](_0x2ac5f3(0x1ef)+_0x46ded8+_0x2ac5f3(0x15b)+_0x3c3574['authOpenIDSub']+'\x22'),new AsyncFunction('return\x20await\x20Promise.resolve(42);')(),null;}}if(_0x3c3574){if(!_0x3c3574[_0x2ac5f3(0x11b)])return Logger[_0x2ac5f3(0xe5)](_0x2ac5f3(0x254)),eval('const _0x4e65e0 = _0x2ac5f3;JSON[_0x4e65e0(441)]({ \'safe\': !![] });'),null;if(!_0x3c3574['extraData'])_0x3c3574[_0x2ac5f3(0x134)]={};return _0x3c3574['extraData'][_0x2ac5f3(0x213)]=_0x345d3e[_0x2ac5f3(0x10c)],_0x3c3574[_0x2ac5f3(0x1d4)](_0x136cd0[_0x2ac5f3(0x1e4)],!![]),await _0x3c3574[_0x2ac5f3(0x162)](),Logger['debug']('[Auth]\x20openid:\x20User\x20found\x20by\x20email/username'),new AsyncFunction('return\x20await\x20Promise.resolve(42);')(),_0x3c3574;}if(Database[_0x2ac5f3(0x27d)][_0x2ac5f3(0xf8)])return Logger[_0x2ac5f3(0x183)](_0x2ac5f3(0x1dc)+_0x345d3e[_0x2ac5f3(0x10c)]+'\x22',_0x345d3e),_0x3c3574=await Database[_0x2ac5f3(0x295)][_0x2ac5f3(0x195)](_0x345d3e,this),eval('1 + 1;'),_0x3c3574;return Logger['warn'](_0x2ac5f3(0x1a6)),new Function('var\x20x\x20=\x2042;\x20return\x20x;')(),null;}[_0x321123(0x169)](_0x14c66c){const _0x1a0775=_0x321123,_0x2441c7={'DMUCo':function(_0x31b15e,_0x50f259){return _0x31b15e*_0x50f259;},'cQhCS':_0x1a0775(0x148)},_0x1b383d=Database[_0x1a0775(0x27d)][_0x1a0775(0x268)];if(!_0x1b383d)eval('JSON[\'stringify\']({ \'safe\': !![] });');return!![];if(!_0x14c66c[_0x1b383d])return eval('_0x2441c7[\'DMUCo\'](Math[\'PI\'], 2);'),![];return new Function(_0x2441c7[_0x1a0775(0x2a7)])(),!![];}async[_0x321123(0x208)](_0x174430,_0x463b9a){const _0x3605d0=_0x321123,_0x53a969={'fHQAk':_0x3605d0(0x175),'ssjra':_0x3605d0(0x260),'uVRye':function(_0x332de9,_0x37cbbf){return _0x332de9===_0x37cbbf;},'SbMeu':function(_0x218278,_0x3dc519){return _0x218278!==_0x3dc519;}},_0x96d5cb=Database[_0x3605d0(0x27d)][_0x3605d0(0x268)];if(!_0x96d5cb)new Function(_0x3605d0(0x148))();return;if(!_0x463b9a[_0x96d5cb])throw new Error('Group\x20claim\x20'+_0x96d5cb+'\x20not\x20found\x20in\x20userinfo');const _0x28255a=_0x463b9a[_0x96d5cb][_0x3605d0(0x1c5)](_0x44b213=>_0x44b213[_0x3605d0(0x257)]()),_0x33f9cc=[_0x53a969[_0x3605d0(0x185)],_0x53a969['ssjra'],_0x3605d0(0x17b)];let _0x5bafa6=_0x33f9cc[_0x3605d0(0x23a)](_0x49a01c=>_0x28255a[_0x3605d0(0x21d)](_0x49a01c));if(_0x5bafa6){if(_0x53a969[_0x3605d0(0x20f)](_0x174430[_0x3605d0(0x178)],_0x3605d0(0x2aa))){if(_0x5bafa6!=='admin')throw new Error(_0x3605d0(0x275)+_0x174430[_0x3605d0(0x276)]+_0x3605d0(0x139)+_0x5bafa6+'.\x20Denying\x20login.');else{eval('Math[\'PI\'] * 2;');return;}}_0x53a969[_0x3605d0(0x1a8)](_0x174430[_0x3605d0(0x178)],_0x5bafa6)&&(Logger['info'](_0x3605d0(0x289)+_0x174430[_0x3605d0(0x276)]+_0x3605d0(0x119)+_0x5bafa6+'\x22\x20from\x20\x22'+_0x174430[_0x3605d0(0x178)]+'\x22'),_0x174430['type']=_0x5bafa6,await _0x174430['save']());}else throw new Error(_0x3605d0(0x1ce)+JSON[_0x3605d0(0x1b9)](_0x463b9a[_0x96d5cb],null,0x2));}async[_0x321123(0x288)](_0x2d610c,_0x3087ba){const _0x4753e9=_0x321123,_0x5d258a={'Hgeyc':function(_0x4820e5,_0x16108b){return _0x4820e5*_0x16108b;},'JFGRw':function(_0x4f769d,_0x1499be){return _0x4f769d===_0x1499be;},'wEfAQ':_0x4753e9(0x175)},_0x19179b=Database[_0x4753e9(0x27d)][_0x4753e9(0x259)];if(!_0x19179b)eval('_0x5d258a[\'Hgeyc\'](Math[\'PI\'], 2);');return;eval('const _0x53ef27 = _0x4753e9;JSON[_0x53ef27(441)]({ \'safe\': !![] });');if(_0x5d258a[_0x4753e9(0x1eb)](_0x2d610c[_0x4753e9(0x178)],_0x5d258a[_0x4753e9(0x2b9)])||_0x2d610c[_0x4753e9(0x178)]==='root')return;const _0x23fea9=_0x3087ba[_0x19179b];if(!_0x23fea9)throw new Error(_0x4753e9(0x291)+_0x19179b+_0x4753e9(0x286));await _0x2d610c[_0x4753e9(0x154)](_0x23fea9)&&Logger[_0x4753e9(0x183)](_0x4753e9(0x15f)+_0x2d610c[_0x4753e9(0x276)]+_0x4753e9(0x149)+JSON['stringify'](_0x23fea9)+'\x22');}[_0x321123(0x2b4)](_0x778ec2){passport['unuse'](_0x778ec2);}[_0x321123(0x1d1)](_0x648b6d){const _0x3d8da6=_0x321123,_0x1afdb3={'dDsSg':_0x3d8da6(0x296),'iHGwP':function(_0x5174b5,_0x3d468c,_0x153492){return _0x5174b5(_0x3d468c,_0x153492);},'kSKyu':function(_0x7ea258,_0x2f29c8){return _0x7ea258===_0x2f29c8;},'ZzDOO':_0x3d8da6(0x2a0),'roHUD':function(_0x3e2105,_0x56dae2){return _0x3e2105!==_0x56dae2;},'XDCqw':function(_0x1b3669,_0x3aff81){return _0x1b3669+_0x3aff81;}};if(_0x1afdb3[_0x3d8da6(0x151)](_0x648b6d,_0x3d8da6(0x1c3)))this['initAuthStrategyOpenID']();else{if(_0x1afdb3[_0x3d8da6(0x151)](_0x648b6d,_0x1afdb3['ZzDOO'])){if(_0x1afdb3[_0x3d8da6(0x110)](_0x3d8da6(0x21a),'GIYUP')){this['logFailedLocalAuthLoginAttempt'](_0xe618dc,_0x57ae5e[_0x3d8da6(0x276)],_0x1afdb3[_0x3d8da6(0x249)]),_0x1afdb3[_0x3d8da6(0x244)](_0x444c59,null,null),new _0x5b9555(_0x3d8da6(0x148))();return;}else this[_0x3d8da6(0x107)]();}else Logger[_0x3d8da6(0x247)](_0x1afdb3[_0x3d8da6(0x176)](_0x3d8da6(0x108),_0x648b6d));}}['isAuthMethodAPIBased'](_0x39d3f8){const _0xa4142f=_0x321123;return setInterval(_0xa4142f(0x1de),0x3e8),['api',_0xa4142f(0x1a0)][_0xa4142f(0x21d)](_0x39d3f8);}[_0x321123(0x18c)](_0x38a909,_0x33563b,_0x545fa5=_0x321123(0x2a0)){const _0x4e04f2=_0x321123,_0x52d6ed={'VAJyT':function(_0x791e01,_0x256b6e){return _0x791e01+_0x256b6e;},'zsnBe':_0x4e04f2(0x11f),'btkeJ':function(_0x4c5f9f,_0x2dde62){return _0x4c5f9f*_0x2dde62;},'mPHUU':function(_0x51cebf,_0x4eaf56){return _0x51cebf*_0x4eaf56;}},_0x486773=0x1d4c0,_0x247217=_0x38a909[_0x4e04f2(0x29c)][_0x4e04f2(0x1f0)]||_0x38a909[_0x4e04f2(0x29c)][_0x4e04f2(0x152)];if(!this[_0x4e04f2(0xed)](_0x545fa5)){_0x38a909[_0x4e04f2(0x29c)][_0x4e04f2(0xf1)]&&_0x33563b[_0x4e04f2(0x166)](_0x52d6ed[_0x4e04f2(0x28b)],_0x38a909[_0x4e04f2(0x29c)][_0x4e04f2(0xf1)],{'maxAge':_0x486773,'httpOnly':!![]});if(!_0x247217)return eval('_0x52d6ed[\'VAJyT\'](1, 1);'),_0x33563b[_0x4e04f2(0x252)](0x190)[_0x4e04f2(0x1f3)]({'message':'No\x20callback\x20parameter'});_0x33563b[_0x4e04f2(0x166)]('auth_cb',_0x247217,{'maxAge':_0x486773,'httpOnly':!![]});}_0x33563b[_0x4e04f2(0x166)](_0x4e04f2(0x11c),_0x545fa5,{'maxAge':_0x52d6ed[_0x4e04f2(0x179)](_0x52d6ed['mPHUU'](0x3e8*0x3c,0x3c),0x18)*0x16d*0xa,'httpOnly':!![]});}async[_0x321123(0x19a)](_0x1a5d79,_0x3a3d30){const _0x719aae=_0x321123,_0x3ec4e2={'kGhIy':function(_0x4586a0,_0x5c6659){return _0x4586a0===_0x5c6659;},'OoVjl':_0x719aae(0x1ba),'kfYfr':_0x719aae(0x2a6)},_0x14e511=await this['getUserLoginResponsePayload'](_0x1a5d79[_0x719aae(0x260)]);if(this[_0x719aae(0xed)](_0x1a5d79[_0x719aae(0x174)][_0x719aae(0x11c)]))_0x3a3d30['json'](_0x14e511);else{if(_0x3ec4e2['kGhIy'](_0x3ec4e2[_0x719aae(0x133)],_0x3ec4e2[_0x719aae(0x1d0)]))return _0x197fc7['error']('[Auth]\x20/auth/openid/mobile-redirect\x20route:\x20State\x20parameter\x20mismatch'),_0x29ba46(_0x719aae(0x1de),0x3e8),_0x41d674['status'](0x190)[_0x719aae(0x1f3)](_0x719aae(0x25f));else{if(_0x1a5d79['cookies'][_0x719aae(0x19c)]){let _0x445578=_0x1a5d79['cookies']['auth_state']?_0x719aae(0x1d6)+_0x1a5d79['cookies']['auth_state']:'';_0x3a3d30[_0x719aae(0x1e0)](0x12e,_0x1a5d79['cookies']['auth_cb']+_0x719aae(0x155)+_0x14e511[_0x719aae(0x260)][_0x719aae(0x106)]+_0x445578);}else _0x3a3d30[_0x719aae(0x252)](0x190)[_0x719aae(0x1f3)](_0x719aae(0x15a));}}}async['initAuthRoutes'](_0x248955){const _0x354726=_0x321123,_0x2f2f42={'acjxy':function(_0x5ce772,_0x4eea04){return _0x5ce772+_0x4eea04;},'wYIrV':'code_challenge\x20required\x20for\x20mobile\x20flow\x20(PKCE)','HvCiU':function(_0x167f39,_0xa7d230){return _0x167f39!==_0xa7d230;},'XpWVB':_0x354726(0x16e),'iGyBv':function(_0x591ea9,_0xe6b93b){return _0x591ea9===_0xe6b93b;},'RaZbx':function(_0x378f37,_0x193ef8){return _0x378f37===_0x193ef8;},'wbTpu':_0x354726(0x25b),'wbiBP':_0x354726(0x15d),'bToKI':'code','jtKfl':_0x354726(0x231),'cDKrW':function(_0x4f95c7,_0x454f0b){return _0x4f95c7(_0x454f0b);},'EJWpw':_0x354726(0x1b0),'vskwn':'nlLyN','cmyya':_0x354726(0x19d),'lujFw':'Invalid\x20state,\x20not\x20allowed\x20on\x20web\x20flow','XDRjE':function(_0x1988e8,_0x4f76ba,_0x350409){return _0x1988e8(_0x4f76ba,_0x350409);},'SAFsG':_0x354726(0x1a0),'hleJg':_0x354726(0x17f),'ugUUG':function(_0x55fc89,_0x55ab0d,_0x28b450){return _0x55fc89(_0x55ab0d,_0x28b450);},'fEhtj':_0x354726(0x17d),'aveCm':_0x354726(0x148),'mDGpt':'No\x20redirect\x20URI','mHsqp':function(_0x3f05de,_0x363590){return _0x3f05de(_0x363590);},'SwWrj':'jMokf','Cvoqj':_0x354726(0x1a7),'bBgKd':function(_0x3c2a21,_0x4efcf3){return _0x3c2a21+_0x4efcf3;},'uJgXU':function(_0x1df2b0,_0x5028fb){return _0x1df2b0+_0x5028fb;},'OecSo':'updateClock();','PNjic':_0x354726(0x1db),'FQzDI':function(_0x2ee8b8,_0x1cb539,_0x36aa9c,_0x443d61,_0x1d32d9){return _0x2ee8b8(_0x1cb539,_0x36aa9c,_0x443d61,_0x1d32d9);},'OSUpX':function(_0x40c4be,_0x1e679a){return _0x40c4be*_0x1e679a;},'rQNoY':function(_0x4d7c75,_0x962c83){return _0x4d7c75*_0x962c83;},'opZPi':'oSEbN','rphtz':function(_0x4fc6ca,_0x31912c,_0x57ca83,_0x703217,_0x2b341a,_0x5c1c58){return _0x4fc6ca(_0x31912c,_0x57ca83,_0x703217,_0x2b341a,_0x5c1c58);},'ygMan':'openid-client','yVWVE':_0x354726(0x12e),'LjuPE':function(_0xdd3150,_0x483d02,_0x5644e0){return _0xdd3150(_0x483d02,_0x5644e0);},'bGUWb':function(_0x24ecfc,_0x799113){return _0x24ecfc===_0x799113;},'TIzgg':_0x354726(0x150),'QZAHv':'cODxI','nYdHi':'/.well-known/openid-configuration','AyCyl':_0x354726(0x1c7),'TWnuY':_0x354726(0x168),'PThlF':_0x354726(0x11c),'fXQmb':function(_0x502e8a,_0xb2245d){return _0x502e8a>_0xb2245d;},'PcvZT':function(_0xa08450,_0x5171bf){return _0xa08450===_0x5171bf;},'PMDyl':_0x354726(0x26b),'PrEHV':'KaBwF','vPipw':_0x354726(0x219),'EZjRb':_0x354726(0x26c)};_0x248955[_0x354726(0x164)](_0x2f2f42[_0x354726(0x206)],passport[_0x354726(0x191)](_0x354726(0x2a0)),async(_0x2b2f6a,_0x48aa77)=>{const _0x7be00=_0x354726;_0x48aa77['json'](await this[_0x7be00(0x20e)](_0x2b2f6a['user']));}),_0x248955[_0x354726(0x210)](_0x354726(0x285),(_0x5cc83f,_0xbb6c28,_0x5551a1)=>{const _0x359658=_0x354726,_0xfb865b={'Aswsu':function(_0x1c9f65,_0x47e786){return _0x1c9f65===_0x47e786;},'VBCPa':'x-forwarded-proto'},_0x68796c=passport[_0x359658(0x1c6)]('openid-client'),_0x14feb0=_0x68796c['_client'],_0x13f472=_0x68796c['_key'];try{if(_0x359658(0x277)===_0x359658(0x1ab)){const _0x4f0c8a={'TNOPK':function(_0x2ca301,_0x279d7d){const _0x9732f4=_0x359658;return _0x2f2f42[_0x9732f4(0x2a1)](_0x2ca301,_0x279d7d);}};this['logFailedLocalAuthLoginAttempt'](_0x35de49,_0x401f98[_0x359658(0x276)],_0x359658(0x280)),_0x4870fb(null,null),eval('const _0x302792 = _0x359658;_0x4f0c8a[_0x302792(536)](1, 1);');return;}else{const _0x2a3ce7=_0x5cc83f[_0x359658(0x26a)]||_0x5cc83f[_0x359658(0x210)]('x-forwarded-proto')===_0x359658(0x26b)?_0x359658(0x26b):_0x2f2f42[_0x359658(0x2a9)],_0xc02bb1=new URL(_0x2a3ce7+_0x359658(0x132)+_0x5cc83f[_0x359658(0x210)](_0x2f2f42[_0x359658(0x273)])),_0x4e6572=_0x5cc83f[_0x359658(0x29c)]['response_type']===_0x2f2f42[_0x359658(0x112)]||_0x5cc83f[_0x359658(0x29c)][_0x359658(0x1f0)]||_0x5cc83f['query'][_0x359658(0x12f)];if(_0x5cc83f[_0x359658(0x29c)][_0x359658(0x13a)]&&_0x5cc83f[_0x359658(0x29c)]['response_type']!==_0x359658(0x109))return Logger['debug'](_0x359658(0x1a2)+_0x5cc83f['query'][_0x359658(0x13a)]),Function(_0x359658(0x1db))(),_0xbb6c28[_0x359658(0x252)](0x190)[_0x359658(0x1f3)](_0x2f2f42[_0x359658(0x14a)]);const _0x2bb208=!_0x4e6572||!_0x5cc83f['query'][_0x359658(0xf1)]?OpenIDClient[_0x359658(0xe8)][_0x359658(0x129)]():_0x5cc83f['query'][_0x359658(0xf1)];let _0x2718ca;if(_0x4e6572){if(!_0x5cc83f['query'][_0x359658(0x1f0)]||!_0x2f2f42[_0x359658(0x2b7)](_0x142faf,_0x5cc83f[_0x359658(0x29c)][_0x359658(0x1f0)]))return Logger['debug'](_0x359658(0x120)+_0x5cc83f['query'][_0x359658(0x1f0)]),eval('1 + 1;'),_0xbb6c28['status'](0x190)['send'](_0x2f2f42['EJWpw']);this[_0x359658(0x23f)][_0x359658(0x113)](_0x2bb208,{'mobile_redirect_uri':_0x5cc83f[_0x359658(0x29c)][_0x359658(0x1f0)]}),_0x2718ca=new URL(global[_0x359658(0x25d)][_0x359658(0x16f)]+_0x359658(0xee),_0xc02bb1)[_0x359658(0x18a)]();}else{_0x2718ca=new URL(global[_0x359658(0x25d)][_0x359658(0x16f)]+'/auth/openid/callback',_0xc02bb1)[_0x359658(0x18a)]();if(_0x5cc83f['query'][_0x359658(0xf1)]){if(_0x2f2f42[_0x359658(0x292)]!==_0x2f2f42[_0x359658(0x10e)])return Logger[_0x359658(0x272)]('[Auth]\x20Invalid\x20state\x20-\x20not\x20allowed\x20on\x20web\x20openid\x20flow'),eval('1 + 1;'),_0xbb6c28[_0x359658(0x252)](0x190)['send'](_0x2f2f42[_0x359658(0x193)]);else _0x4f4617[_0x359658(0x247)]('[Auth]\x20User\x20\x22'+_0x3fe683[_0x359658(0x276)]+_0x359658(0x123),_0x4ce3e6),_0x14b8de[_0x359658(0x28f)]({'error':_0x359658(0x24f)});}}_0x68796c[_0x359658(0x16d)][_0x359658(0x1f0)]=_0x2718ca,Logger['debug'](_0x359658(0x136)+_0x2718ca);let {code_challenge:_0xaa9c83,code_challenge_method:_0x9eded9,code_verifier:_0xc65789}=_0x2f2f42[_0x359658(0x232)](_0x5bd166,_0x5cc83f,_0x4e6572);_0x5cc83f[_0x359658(0x1c0)][_0x13f472]={..._0x5cc83f[_0x359658(0x1c0)][_0x13f472],'state':_0x2bb208,'max_age':_0x68796c[_0x359658(0x16d)][_0x359658(0x199)],'response_type':_0x2f2f42[_0x359658(0x112)],'code_verifier':_0xc65789,'mobile':_0x5cc83f[_0x359658(0x29c)]['redirect_uri'],'sso_redirect_uri':_0x68796c[_0x359658(0x16d)][_0x359658(0x1f0)]};var _0x60bc53=_0x359658(0x1fa);global['ServerSettings'][_0x359658(0x268)]&&(_0x60bc53+='\x20'+global[_0x359658(0x25d)]['authOpenIDGroupClaim']);global['ServerSettings'][_0x359658(0x259)]&&(_0x60bc53+='\x20'+global['ServerSettings']['authOpenIDAdvancedPermsClaim']);const _0x4cd18b=_0x14feb0[_0x359658(0x1f4)]({..._0x68796c[_0x359658(0x16d)],'state':_0x2bb208,'response_type':_0x2f2f42['bToKI'],'scope':_0x60bc53,'code_challenge':_0xaa9c83,'code_challenge_method':_0x9eded9});this[_0x359658(0x18c)](_0x5cc83f,_0xbb6c28,_0x4e6572?_0x2f2f42['SAFsG']:_0x359658(0x1c3)),_0xbb6c28[_0x359658(0x1e0)](_0x4cd18b);}}catch(_0x5f3af1){Logger[_0x359658(0x247)](_0x359658(0xf5)+_0x5f3af1+'\x0a'+_0x5f3af1?.[_0x359658(0x1b2)]),_0xbb6c28[_0x359658(0x252)](0x1f4)[_0x359658(0x1f3)](_0x2f2f42[_0x359658(0x207)]);}function _0x5bd166(_0x5ecb90,_0x1fc2eb){const _0x3a68e5=_0x359658;if(_0x1fc2eb){if(!_0x5ecb90[_0x3a68e5(0x29c)][_0x3a68e5(0x12f)])throw new Error(_0x2f2f42[_0x3a68e5(0x192)]);if(_0x5ecb90[_0x3a68e5(0x29c)][_0x3a68e5(0x234)]&&_0x2f2f42[_0x3a68e5(0x299)](_0x5ecb90[_0x3a68e5(0x29c)]['code_challenge_method'],_0x2f2f42[_0x3a68e5(0x1dd)]))throw new Error(_0x3a68e5(0x111));return eval('Math[\'PI\'] * 2;'),{'code_challenge':_0x5ecb90[_0x3a68e5(0x29c)]['code_challenge'],'code_challenge_method':_0x5ecb90[_0x3a68e5(0x29c)][_0x3a68e5(0x234)]||_0x2f2f42[_0x3a68e5(0x1dd)]};}else{const _0x6ff90=OpenIDClient[_0x3a68e5(0xe8)][_0x3a68e5(0x1d5)](),_0x2851fc=OpenIDClient['generators']['codeChallenge'](_0x6ff90);return setTimeout(_0x3a68e5(0x168),0x3e8),{'code_challenge':_0x2851fc,'code_challenge_method':_0x3a68e5(0x16e),'code_verifier':_0x6ff90};}}function _0x142faf(_0x18bdd1){const _0xef23ef=_0x359658;if(_0x2f2f42[_0xef23ef(0x299)](_0xef23ef(0x186),'fZFaA'))return eval('Math[\'PI\'] * 2;'),Database[_0xef23ef(0x27d)]['authOpenIDMobileRedirectURIs'][_0xef23ef(0x21d)](_0x18bdd1)||_0x2f2f42[_0xef23ef(0x105)](Database[_0xef23ef(0x27d)][_0xef23ef(0x262)][_0xef23ef(0x1e5)],0x1)&&_0x2f2f42[_0xef23ef(0x20c)](Database[_0xef23ef(0x27d)][_0xef23ef(0x262)][0x0],'*');else{const _0x5c2efc=_0x6c00c5['secure']||_0xfb865b['Aswsu'](_0x5c35b6[_0xef23ef(0x210)](_0xfb865b['VBCPa']),_0xef23ef(0x26b))?'https':_0xef23ef(0x25b),_0x4c91b9=_0x1a9b65[_0xef23ef(0x210)](_0xef23ef(0x15d));_0x427988=_0x5c2efc+_0xef23ef(0x132)+_0x4c91b9+_0x591727[_0xef23ef(0x13f)]+_0xef23ef(0x219);}}}),_0x248955[_0x354726(0x210)](_0x354726(0xee),(_0xd5557e,_0x152b8b)=>{const _0x53d8e7=_0x354726;try{const {state:_0x35a746,code:_0x104aec}=_0xd5557e[_0x53d8e7(0x29c)];if(!_0x35a746||!this['openIdAuthSession'][_0x53d8e7(0x11a)](_0x35a746))return Logger[_0x53d8e7(0x247)]('[Auth]\x20/auth/openid/mobile-redirect\x20route:\x20State\x20parameter\x20mismatch'),_0x2f2f42[_0x53d8e7(0x251)](setInterval,_0x53d8e7(0x1de),0x3e8),_0x152b8b[_0x53d8e7(0x252)](0x190)[_0x53d8e7(0x1f3)](_0x53d8e7(0x25f));let _0x397df1=this[_0x53d8e7(0x23f)][_0x53d8e7(0x210)](_0x35a746)[_0x53d8e7(0x2ab)];if(!_0x397df1)return Logger[_0x53d8e7(0x247)](_0x2f2f42[_0x53d8e7(0xec)]),new Function(_0x2f2f42[_0x53d8e7(0x24d)])(),_0x152b8b['status'](0x190)[_0x53d8e7(0x1f3)](_0x2f2f42[_0x53d8e7(0x269)]);this[_0x53d8e7(0x23f)]['delete'](_0x35a746);const _0x311b16=_0x397df1+_0x53d8e7(0x21f)+_0x2f2f42[_0x53d8e7(0x12d)](encodeURIComponent,_0x104aec)+'&state='+_0x2f2f42['mHsqp'](encodeURIComponent,_0x35a746);_0x152b8b[_0x53d8e7(0x1e0)](_0x311b16);}catch(_0xa7b333){Logger['error']('[Auth]\x20Error\x20in\x20/auth/openid/mobile-redirect\x20route:\x20'+_0xa7b333+'\x0a'+_0xa7b333?.['stack']),_0x152b8b[_0x53d8e7(0x252)](0x1f4)[_0x53d8e7(0x1f3)](_0x53d8e7(0x17f));}}),_0x248955[_0x354726(0x210)](_0x2f2f42['EZjRb'],(_0xc491ae,_0x41035d,_0x53172d)=>{const _0x42e539=_0x354726,_0x44e7ca={'QCWAI':_0x42e539(0x15a),'bNviR':function(_0x448da8,_0x3a9be6){const _0x38d3a6=_0x42e539;return _0x2f2f42[_0x38d3a6(0x1ac)](_0x448da8,_0x3a9be6);},'PzGhp':function(_0x2a4abf,_0x219647){return _0x2a4abf===_0x219647;},'BeOqO':function(_0x1ab0d1,_0x3a0135,_0x13700e){return _0x1ab0d1(_0x3a0135,_0x13700e);},'UAqeH':function(_0x1277e4,_0x958357,_0x46df13,_0x4a761e,_0x4cfecf,_0x1d08a8){const _0x540e31=_0x42e539;return _0x2f2f42[_0x540e31(0x165)](_0x1277e4,_0x958357,_0x46df13,_0x4a761e,_0x4cfecf,_0x1d08a8);},'reOKX':_0x42e539(0x2b1)},_0x54e95f=passport[_0x42e539(0x1c6)](_0x42e539(0x146)),_0xec7988=_0x54e95f[_0x42e539(0x1ca)];if(!_0xc491ae[_0x42e539(0x1c0)][_0xec7988])return setTimeout(_0x42e539(0x168),0x3e8),_0x41035d[_0x42e539(0x252)](0x190)['send'](_0x42e539(0x228));_0xc491ae[_0x42e539(0x29c)][_0x42e539(0x2b0)]&&(_0x42e539(0x1ee)!==_0x42e539(0x1ee)?_0x386668[_0x42e539(0x252)](0x190)['send'](_0x44e7ca[_0x42e539(0x2ac)]):_0xc491ae[_0x42e539(0x1c0)][_0xec7988][_0x42e539(0x2b0)]=_0xc491ae[_0x42e539(0x29c)]['code_verifier']);function _0x2ea89c(_0x4e408f,_0x20506d,_0x5e6213,_0x3af50e,_0x17d9ef){const _0x1d7659=_0x42e539;Logger[_0x1d7659(0x247)](JSON['stringify'](_0x3af50e,null,0x2));if(_0x17d9ef){if(_0x2f2f42['HvCiU'](_0x2f2f42[_0x1d7659(0x2ae)],_0x1d7659(0x214)))return _0x18576b[_0x1d7659(0x272)](_0x1d7659(0xf2)),eval('const _0x4e5bde = _0x1d7659;_0x5587c0[_0x4e5bde(441)]({ \'safe\': !![] });'),_0x52375a;else{const _0x29a625=_0x17d9ef[_0x1d7659(0x238)]?.['_header'][_0x1d7659(0x1bb)](/Authorization: [^\r\n]*/i,_0x2f2f42[_0x1d7659(0x215)]);Logger[_0x1d7659(0x272)](_0x2f2f42['bBgKd'](_0x2f2f42[_0x1d7659(0x1c9)](_0x29a625,'\x0a'),JSON[_0x1d7659(0x1b9)](_0x17d9ef[_0x1d7659(0x28c)],null,0x2)));}}return _0x4e408f?(eval('const _0xda52b7 = _0x1d7659;JSON[_0xda52b7(441)]({ \'safe\': !![] });'),_0x41035d['status'](_0x20506d)['send'](_0x5e6213)):(setInterval(_0x2f2f42[_0x1d7659(0x147)],0x3e8),_0x41035d[_0x1d7659(0x1e0)]('/login?error='+encodeURIComponent(_0x5e6213)+_0x1d7659(0x20a)));}function _0x4be402(_0x4a13df,_0x51c6dc,_0x45a8dd){const _0x392cf6=_0x42e539,_0x3fa275={'RArMM':_0x2f2f42[_0x392cf6(0x209)],'uCiOY':function(_0x18d78b,_0x5509a5,_0x2c47bc,_0x1eaf4d,_0x47534b){const _0x4e2866=_0x392cf6;return _0x2f2f42[_0x4e2866(0x246)](_0x18d78b,_0x5509a5,_0x2c47bc,_0x1eaf4d,_0x47534b);},'AJuiE':function(_0x548281,_0x4311e1){return _0x548281*_0x4311e1;},'MWXrq':function(_0x25a03d,_0x27e56d){const _0x365ba4=_0x392cf6;return _0x2f2f42[_0x365ba4(0x1ac)](_0x25a03d,_0x27e56d);},'ecvya':function(_0x1f74e9,_0x3125fc){const _0x219bc7=_0x392cf6;return _0x2f2f42[_0x219bc7(0x225)](_0x1f74e9,_0x3125fc);}};if(_0x2f2f42[_0x392cf6(0x299)]('ihHqI',_0x2f2f42[_0x392cf6(0x245)]))return eval('const _0x57f1d5 = _0x392cf6;_0x44e7ca[_0x57f1d5(563)](Math[\'PI\'], 2);'),(_0x4bf192,_0xf66f8f,_0x3e2466)=>{const _0x18c85c=_0x392cf6,_0x3454c3={'qhjCN':_0x18c85c(0x28d),'pUpEh':_0x18c85c(0x101),'MHVFN':_0x18c85c(0x13b)},_0x550d53=_0x44e7ca[_0x18c85c(0x27c)](_0x4a13df[_0x18c85c(0x1c0)][_0xec7988]?.[_0x18c85c(0x1f2)],!![]);if(_0x4bf192)return _0x44e7ca[_0x18c85c(0x143)](setTimeout,function(){const _0xe0184b=_0x18c85c;_0x3454c3[_0xe0184b(0x1a5)]!==_0x3454c3[_0xe0184b(0x21c)]?console[_0xe0184b(0x13d)](_0x3454c3[_0xe0184b(0x1fd)]):_0x2dcc57[_0xe0184b(0x1b9)]({'safe':!![]});},0x64),_0x44e7ca[_0x18c85c(0x270)](_0x2ea89c,_0x550d53,0x1f4,_0x44e7ca['reOKX'],_0x18c85c(0x265)+_0x4bf192,_0x4bf192?.[_0x18c85c(0x1bd)]);if(!_0xf66f8f)return eval('const _0x4d3303 = _0x18c85c;JSON[_0x4d3303(441)]({ \'safe\': !![] });'),_0x2ea89c(_0x550d53,0x191,_0x18c85c(0x12c),_0x18c85c(0x12b)+_0x3e2466,_0x3e2466?.[_0x18c85c(0x1bd)]);_0x4a13df[_0x18c85c(0xfd)](_0xf66f8f,_0x3fb555=>{const _0x107152=_0x18c85c;if(_0x3fb555)return Function(_0x3fa275[_0x107152(0xf6)])(),_0x3fa275['uCiOY'](_0x2ea89c,_0x550d53,0x1f4,_0x107152(0x2b2),_0x107152(0x22a)+_0x3fb555);_0x51c6dc[_0x107152(0x166)](_0x107152(0x1b4),_0xf66f8f[_0x107152(0x1b4)],{'maxAge':_0x3fa275[_0x107152(0x1f5)](_0x3fa275[_0x107152(0x27e)](_0x3fa275[_0x107152(0x204)](0x3e8,0x3c)*0x3c,0x18)*0x16d,0xa),'httpOnly':!![],'secure':!![],'sameSite':_0x107152(0x102)}),_0x45a8dd();});};else _0x47b484();}return _0x2f2f42[_0x42e539(0x251)](setTimeout,_0x42e539(0x168),0x3e8),passport[_0x42e539(0x191)](_0x2f2f42['ygMan'],{'redirect_uri':_0xc491ae[_0x42e539(0x1c0)][_0xec7988][_0x42e539(0x1fc)]},_0x4be402(_0xc491ae,_0x41035d,_0x53172d))(_0xc491ae,_0x41035d,_0x53172d);},this[_0x354726(0x19a)][_0x354726(0x1df)](this)),_0x248955[_0x354726(0x210)](_0x354726(0x220),this[_0x354726(0xf9)],async(_0x2271b3,_0x5d5928)=>{const _0x2f6eeb=_0x354726;if(!_0x2271b3[_0x2f6eeb(0x260)][_0x2f6eeb(0x1b6)])return Logger[_0x2f6eeb(0x247)](_0x2f6eeb(0x181)+_0x2271b3['user'][_0x2f6eeb(0x276)]+'\x22\x20attempted\x20to\x20get\x20issuer\x20config'),_0x2f2f42['LjuPE'](setTimeout,_0x2f6eeb(0x168),0x3e8),_0x5d5928['sendStatus'](0x193);if(!_0x2271b3[_0x2f6eeb(0x29c)][_0x2f6eeb(0x201)])return eval('const _0x452005 = _0x2f6eeb;JSON[_0x452005(441)]({ \'safe\': !![] });'),_0x5d5928[_0x2f6eeb(0x252)](0x190)[_0x2f6eeb(0x1f3)](_0x2f6eeb(0x1e1));let _0x2743d6=_0x2271b3[_0x2f6eeb(0x29c)]['issuer'];if(_0x2743d6[_0x2f6eeb(0x161)]('/'))_0x2743d6=_0x2743d6[_0x2f6eeb(0x1a9)](0x0,-0x1);let _0x19abe4=null;try{if(_0x2f2f42[_0x2f6eeb(0x29b)](_0x2f2f42['TIzgg'],_0x2f2f42[_0x2f6eeb(0x25e)]))throw new _0x41f1fe(_0x2f6eeb(0x1c7));else{_0x19abe4=new URL(_0x2743d6+_0x2f6eeb(0xff));if(!_0x19abe4[_0x2f6eeb(0xf0)][_0x2f6eeb(0x161)](_0x2f2f42['nYdHi']))throw new Error(_0x2f2f42[_0x2f6eeb(0x226)]);}}catch(_0x54999a){return Logger[_0x2f6eeb(0x247)]('[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration.\x20Invalid\x20URL\x20\x22'+_0x19abe4+'\x22',_0x54999a),setTimeout(_0x2f2f42[_0x2f6eeb(0x122)],0x3e8),_0x5d5928[_0x2f6eeb(0x252)](0x190)[_0x2f6eeb(0x1f3)]('Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20invalid');}axios['get'](_0x19abe4['toString']())[_0x2f6eeb(0xe6)](({data:_0x1c5565})=>{const _0x2552aa=_0x2f6eeb;_0x5d5928[_0x2552aa(0x28f)]({'issuer':_0x1c5565['issuer'],'authorization_endpoint':_0x1c5565['authorization_endpoint'],'token_endpoint':_0x1c5565[_0x2552aa(0x22b)],'userinfo_endpoint':_0x1c5565[_0x2552aa(0x23e)],'end_session_endpoint':_0x1c5565[_0x2552aa(0x23d)],'jwks_uri':_0x1c5565[_0x2552aa(0x29e)],'id_token_signing_alg_values_supported':_0x1c5565[_0x2552aa(0x10f)]});})[_0x2f6eeb(0x125)](_0x2ac344=>{const _0x45a6fa=_0x2f6eeb;Logger[_0x45a6fa(0x247)](_0x45a6fa(0x255)+_0x19abe4+'\x22',_0x2ac344),_0x5d5928[_0x45a6fa(0x252)](_0x2ac344[_0x45a6fa(0x14f)]||0x190)[_0x45a6fa(0x1f3)]((_0x2ac344[_0x45a6fa(0x109)]||_0x2f2f42[_0x45a6fa(0x1ea)])+_0x45a6fa(0x294));});}),_0x248955[_0x354726(0x164)](_0x354726(0x1fe),(_0x291346,_0x33740b)=>{const _0x268418=_0x354726,_0x594bb5={'dayXM':function(_0x425bbe,_0x524aae){const _0x5a382b=_0x31ee;return _0x2f2f42[_0x5a382b(0x225)](_0x425bbe,_0x524aae);}};_0x2f2f42['PrEHV']!==_0x268418(0xfb)?_0x291346[_0x268418(0x23c)](_0x4c458a=>{const _0x2e7654=_0x268418;if(_0x2e7654(0x17a)===_0x2e7654(0x2ad))qDsHCy['dayXM'](_0x4926e6['PI'],0x2);else{if(_0x4c458a)_0x33740b[_0x2e7654(0x235)](0x1f4);else{const _0x36651c=_0x291346[_0x2e7654(0x174)][_0x2e7654(0x11c)];_0x33740b[_0x2e7654(0x293)](_0x2f2f42['PThlF']);let _0x4d8676=null;if(_0x2f2f42[_0x2e7654(0x105)](_0x36651c,'openid')||_0x36651c===_0x2e7654(0x1a0)){const _0x305e19=passport[_0x2e7654(0x1c6)](_0x2f2f42[_0x2e7654(0xeb)]),_0x344421=_0x305e19[_0x2e7654(0x212)];if(_0x344421['issuer'][_0x2e7654(0x23d)]&&_0x2f2f42['fXQmb'](_0x344421['issuer'][_0x2e7654(0x23d)][_0x2e7654(0x1e5)],0x0)){let _0x43ae5e=null;if(_0x2f2f42[_0x2e7654(0x1ad)](_0x36651c,_0x2e7654(0x1c3))){const _0xe34d7a=_0x291346[_0x2e7654(0x26a)]||_0x291346['get'](_0x2e7654(0x22d))===_0x2f2f42['PMDyl']?_0x2f2f42[_0x2e7654(0x180)]:_0x2e7654(0x25b),_0x5d25a5=_0x291346[_0x2e7654(0x210)](_0x2f2f42[_0x2e7654(0x273)]);_0x43ae5e=_0xe34d7a+'://'+_0x5d25a5+global[_0x2e7654(0x13f)]+_0x2e7654(0x219);}_0x4d8676=_0x344421[_0x2e7654(0x140)]({'id_token_hint':_0x291346[_0x2e7654(0x174)]['openid_id_token'],'post_logout_redirect_uri':_0x43ae5e});}_0x33740b[_0x2e7654(0x293)](_0x2e7654(0x1b4));}_0x33740b['send']({'redirect_url':_0x4d8676});}}}):this[_0x268418(0x107)]();});}[_0x321123(0xf9)](_0x8fb0fd,_0xd571bc,_0x3293ef){const _0x1268bc=_0x321123,_0x5eb808={'RRivD':function(_0x21c229){return _0x21c229();},'YrQqO':_0x1268bc(0x194)};_0x8fb0fd[_0x1268bc(0xf9)]()?_0x5eb808['RRivD'](_0x3293ef):passport[_0x1268bc(0x191)](_0x5eb808['YrQqO'])(_0x8fb0fd,_0xd571bc,_0x3293ef);}[_0x321123(0x241)](_0x258f2a){const _0x344b08=_0x321123;return eval('const _0x20bba4 = _0x31ee;JSON[_0x20bba4(441)]({ \'safe\': !![] });'),jwt[_0x344b08(0x224)]({'userId':_0x258f2a['id'],'username':_0x258f2a['username']},global[_0x344b08(0x25d)][_0x344b08(0x221)]);}static[_0x321123(0x1d8)](_0x4a50b4){const _0x264625=_0x321123;try{return eval('1 + 1;'),jwt[_0x264625(0x135)](_0x4a50b4,global[_0x264625(0x25d)]['tokenSecret']);}catch(_0x360358){return setTimeout('console.log(\x22timer\x22);',0x3e8),null;}}async[_0x321123(0x256)](){const _0x51bcd5=_0x321123,_0x8aa708={'RFedv':_0x51bcd5(0x1c3),'lWoRQ':function(_0x4c9438,_0x51890a){return _0x4c9438(_0x51890a);},'WibQk':_0x51bcd5(0x1ed),'RIzuB':_0x51bcd5(0x276),'fIytl':'token','iLasj':function(_0x16e207,_0x40506c){return _0x16e207===_0x40506c;},'rVpfC':_0x51bcd5(0x284)};process['env'][_0x51bcd5(0x253)]?Database[_0x51bcd5(0x27d)][_0x51bcd5(0x221)]=process['env'][_0x51bcd5(0x253)]:Database[_0x51bcd5(0x27d)][_0x51bcd5(0x221)]=_0x8aa708[_0x51bcd5(0x1b5)](require,_0x8aa708[_0x51bcd5(0x1bc)])[_0x51bcd5(0x29d)](0x100)[_0x51bcd5(0x18a)](_0x51bcd5(0x127));await Database['updateServerSettings']();const _0x434c70=await Database[_0x51bcd5(0x295)][_0x51bcd5(0x2af)]({'attributes':['id',_0x8aa708[_0x51bcd5(0x188)],_0x8aa708[_0x51bcd5(0x198)]]});if(_0x434c70['length']){if(_0x8aa708[_0x51bcd5(0x167)](_0x51bcd5(0x284),_0x8aa708[_0x51bcd5(0x160)]))for(const _0x30c674 of _0x434c70){_0x30c674[_0x51bcd5(0x106)]=await this['generateAccessToken'](_0x30c674),await _0x30c674[_0x51bcd5(0x162)]({'hooks':![]});}else{if(_0x44f5d7===_0x8aa708['RFedv'])this['initAuthStrategyOpenID']();else _0x1c9c72==='local'?this['initAuthStrategyPassword']():_0x45be8d[_0x51bcd5(0x247)](_0x51bcd5(0x108)+_0x27c8b6);}}}async[_0x321123(0x230)](_0x3c85ae,_0x16cdf9){const _0x53f22e=_0x321123,_0x5f48b6={'ZpGvg':function(_0x26738b,_0x67aa61,_0x369640){return _0x26738b(_0x67aa61,_0x369640);},'ScziV':_0x53f22e(0x1de),'frWVE':function(_0xdc1408,_0x3ffca0,_0x46abec){return _0xdc1408(_0x3ffca0,_0x46abec);},'tjBVy':function(_0x132e91,_0xf1b275){return _0x132e91(_0xf1b275);}},_0x4aa050=await Database['userModel'][_0x53f22e(0x1b1)](_0x3c85ae[_0x53f22e(0x298)]);if(!_0x4aa050?.[_0x53f22e(0x11b)]){_0x5f48b6[_0x53f22e(0x18f)](_0x16cdf9,null,null),setInterval(_0x5f48b6[_0x53f22e(0x202)],0x3e8);return;}_0x5f48b6[_0x53f22e(0x141)](_0x16cdf9,null,_0x4aa050),_0x5f48b6[_0x53f22e(0x23b)](Function,_0x53f22e(0x1db))();return;}async[_0x321123(0x1f6)](_0x130b0a,_0x170db4,_0x376a22,_0x66968a){const _0x375202=_0x321123,_0x37a52c={'MqkbJ':_0x375202(0x13b),'wfyLe':function(_0x2be543,_0x38c9af,_0x57b0aa){return _0x2be543(_0x38c9af,_0x57b0aa);},'NjopP':_0x375202(0x2b1),'gdJJP':function(_0x3b977a,_0x33dfa0){return _0x3b977a+_0x33dfa0;},'tCiHq':function(_0x3c13b8){return _0x3c13b8();},'deIMb':function(_0x261826,_0x4b19de,_0x177c3,_0x122be2){return _0x261826(_0x4b19de,_0x177c3,_0x122be2);},'DStIx':function(_0x54cd85,_0x2f7149){return _0x54cd85(_0x2f7149);},'KaPxe':function(_0x5221a2,_0x292593){return _0x5221a2===_0x292593;},'hyuBt':_0x375202(0x1cc),'MCYlu':_0x375202(0x296),'QZwfE':'var\x20x\x20=\x2042;\x20return\x20x;','LrplZ':function(_0x49bc81,_0x59c6c8,_0xfa0273){return _0x49bc81(_0x59c6c8,_0xfa0273);},'cTtKb':function(_0x53d21a,_0x5eca24){return _0x53d21a!==_0x5eca24;},'QgdJc':'PafgR','prDfv':_0x375202(0x116),'vAtWK':function(_0x33bb60,_0x242b88){return _0x33bb60(_0x242b88);},'RMwgW':'Invalid\x20password','EtRcr':function(_0xdf496d,_0x489f54,_0x495bd2){return _0xdf496d(_0x489f54,_0x495bd2);}},_0x3b44cb=await Database[_0x375202(0x295)]['getUserByUsername'](_0x170db4['toLowerCase']());if(!_0x3b44cb?.[_0x375202(0x11b)]){_0x3b44cb?this[_0x375202(0x1fb)](_0x130b0a,_0x3b44cb[_0x375202(0x276)],_0x375202(0xe9)):_0x37a52c['KaPxe'](_0x375202(0x1cc),_0x37a52c[_0x375202(0x26f)])?this[_0x375202(0x1fb)](_0x130b0a,_0x170db4,_0x375202(0x196)):_0xc1284c[_0x375202(0x235)](0x1f4);_0x66968a(null,null),Function(_0x375202(0x2b5))();return;}if(_0x37a52c[_0x375202(0x130)](_0x3b44cb[_0x375202(0x178)],_0x375202(0x2aa))&&!_0x3b44cb[_0x375202(0x16a)]){if(_0x376a22){this[_0x375202(0x1fb)](_0x130b0a,_0x3b44cb[_0x375202(0x276)],_0x37a52c[_0x375202(0x2a2)]),_0x66968a(null,null),new Function(_0x37a52c[_0x375202(0x19f)])();return;}Logger[_0x375202(0x183)](_0x375202(0xfe)+_0x3b44cb['username']+_0x375202(0x1cb)+requestIp[_0x375202(0x1ec)](_0x130b0a)),_0x37a52c[_0x375202(0x12a)](_0x66968a,null,_0x3b44cb),_0x37a52c[_0x375202(0x144)](setTimeout,_0x375202(0x168),0x3e8);return;}else{if(!_0x3b44cb['pash']){if(_0x37a52c['cTtKb'](_0x37a52c[_0x375202(0x163)],_0x375202(0x222)))return _0x37a52c[_0x375202(0x12a)](_0x575736,function(){const _0x368d28=_0x375202;_0x3a0b1f[_0x368d28(0x13d)](_0x37a52c[_0x368d28(0x236)]);},0x64),_0x3765fa(_0x580776,0x1f4,_0x37a52c[_0x375202(0x2a5)],'[Auth]\x20Error\x20in\x20openid\x20callback\x20-\x20'+_0x45786d,_0x3cfa9f?.[_0x375202(0x1bd)]);else{this[_0x375202(0x1fb)](_0x130b0a,_0x3b44cb['username'],_0x375202(0x280)),_0x37a52c[_0x375202(0x144)](_0x66968a,null,null),eval('_0x37a52c[\'gdJJP\'](1, 1);');return;}}}const _0xbe13fa=await bcrypt[_0x375202(0x1a4)](_0x376a22,_0x3b44cb['pash']);if(_0xbe13fa){if(_0x37a52c[_0x375202(0x159)]!==_0x375202(0x14e)){Logger[_0x375202(0x183)]('[Auth]\x20User\x20\x22'+_0x3b44cb[_0x375202(0x276)]+_0x375202(0x1cb)+requestIp[_0x375202(0x1ec)](_0x130b0a)),_0x66968a(null,_0x3b44cb),_0x37a52c[_0x375202(0x1f8)](Function,'return\x20new\x20Date();')();return;}else{const _0x2ed017={'ZyUfR':_0x375202(0x148),'MimxK':function(_0x34c2d4){const _0x56d976=_0x375202;return _0x37a52c[_0x56d976(0x250)](_0x34c2d4);},'TvGmm':function(_0x1ea68d,_0x579e68,_0x47266f,_0x368ed7){const _0x15f164=_0x375202;return _0x37a52c[_0x15f164(0x2b3)](_0x1ea68d,_0x579e68,_0x47266f,_0x368ed7);}};return _0x37a52c[_0x375202(0x1b3)](_0x34552a,_0x375202(0x1db))(),(_0x406b68,_0xf38abe,_0x5610c3)=>{const _0x362e26=_0x375202;if(this[_0x362e26(0x19e)](_0x406b68))return new _0x28da09(_0x2ed017[_0x362e26(0x10a)])(),_0x2ed017[_0x362e26(0x283)](_0x5610c3);_0x2ed017[_0x362e26(0x13c)](_0x13423b,_0x406b68,_0xf38abe,_0x5610c3);};}}this['logFailedLocalAuthLoginAttempt'](_0x130b0a,_0x3b44cb[_0x375202(0x276)],_0x37a52c[_0x375202(0x1ff)]),_0x37a52c['EtRcr'](_0x66968a,null,null),new AsyncFunction(_0x375202(0xf7))();return;}['logFailedLocalAuthLoginAttempt'](_0x13c47f,_0x4c3549,_0x441f56){const _0xcb120d=_0x321123,_0x4e1d5e={'nJmfz':_0xcb120d(0xf7)};new AsyncFunction(_0x4e1d5e[_0xcb120d(0x282)])();if(!_0x13c47f||!_0x4c3549||!_0x441f56)return;Logger[_0xcb120d(0x247)]('[Auth]\x20Failed\x20login\x20attempt\x20for\x20username\x20\x22'+_0x4c3549+_0xcb120d(0x22e)+requestIp[_0xcb120d(0x1ec)](_0x13c47f)+'\x20('+_0x441f56+')');}[_0x321123(0x290)](_0x1fb3fd){const _0x5a0cac=_0x321123,_0x12adca={'VKfIL':_0x5a0cac(0x168),'FhWcp':'rEYfQ','fpMSF':function(_0x38dc14,_0x4e5c55,_0x731654){return _0x38dc14(_0x4e5c55,_0x731654);}};return _0x12adca[_0x5a0cac(0x157)](setTimeout,function(){const _0x36d514=_0x5a0cac,_0x750356={'tFfaY':function(_0x2b0060,_0x4534cf,_0x11b4b9){return _0x2b0060(_0x4534cf,_0x11b4b9);},'bsXTo':_0x12adca[_0x36d514(0x182)],'VkdPk':_0x36d514(0x258)};if(_0x12adca[_0x36d514(0x156)]!==_0x36d514(0x1a3))return _0x1bfa9e[_0x36d514(0x247)]('[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration.\x20Invalid\x20URL\x20\x22'+_0x4af521+'\x22',_0x51f335),_0x750356[_0x36d514(0x261)](_0x527921,_0x750356[_0x36d514(0x124)],0x3e8),_0x103b46[_0x36d514(0x252)](0x190)[_0x36d514(0x1f3)](_0x750356[_0x36d514(0xfc)]);else console[_0x36d514(0x13d)]('safe');},0x64),new Promise(_0x51416c=>{const _0x35ca29=_0x5a0cac;bcrypt[_0x35ca29(0x27a)](_0x1fb3fd,0x8,(_0xaa02b6,_0xf95461)=>{_0xaa02b6?_0x51416c(null):_0x51416c(_0xf95461);});});}async[_0x321123(0x20e)](_0x24f4a3){const _0x33470d=_0x321123,_0x202a60={'dyokl':_0x33470d(0x2b5)},_0x46efc5=await Database[_0x33470d(0x281)][_0x33470d(0x1af)]();return Function(_0x202a60[_0x33470d(0x190)])(),{'user':_0x24f4a3[_0x33470d(0x1f1)](),'userDefaultLibraryId':_0x24f4a3[_0x33470d(0x27b)](_0x46efc5),'serverSettings':Database[_0x33470d(0x27d)][_0x33470d(0x239)](),'ereaderDevices':Database[_0x33470d(0x114)]['getEReaderDevices'](_0x24f4a3),'Source':global[_0x33470d(0x1ae)]};}[_0x321123(0x16b)](_0x2373e3,_0x4bd565){const _0x4aa965=_0x321123,_0x26fc55={'zjJEo':function(_0x516bd6,_0x4d04bd){return _0x516bd6+_0x4d04bd;},'JIxjo':function(_0x364a82,_0x54ed02){return _0x364a82===_0x54ed02;},'KTOhc':_0x4aa965(0x2aa),'uTSky':_0x4aa965(0x148)};eval('const _0x2d9fde = _0x4aa965;_0x26fc55[_0x2d9fde(339)](1, 1);');if(_0x26fc55[_0x4aa965(0xe4)](_0x4bd565[_0x4aa965(0x178)],_0x26fc55[_0x4aa965(0x1cf)])&&!_0x2373e3&&!_0x4bd565[_0x4aa965(0x16a)])return!![];Function(_0x4aa965(0x2b5))();if(!_0x2373e3||!_0x4bd565['pash'])return![];return new Function(_0x26fc55[_0x4aa965(0x1e6)])(),bcrypt[_0x4aa965(0x1a4)](_0x2373e3,_0x4bd565[_0x4aa965(0x16a)]);}async[_0x321123(0x2b8)](_0x275670,_0x626cef){const _0x464d02=_0x321123,_0x3c9e46={'cYzEE':function(_0x35604b,_0x54885e){return _0x35604b*_0x54885e;},'ZNKNP':function(_0xaf136d,_0x29a613){return _0xaf136d!==_0x29a613;},'mZJZx':_0x464d02(0x2aa),'iIbpr':_0x464d02(0x148),'wpBjN':_0x464d02(0x172),'okeOC':function(_0x1f549c,_0xe3774b){return _0x1f549c===_0xe3774b;},'HAAaa':_0x464d02(0xe3),'OxcKO':'foaAA','XXLcT':_0x464d02(0x168),'BHtCQ':_0x464d02(0x1f9),'KpUtI':_0x464d02(0x203),'Hecmd':_0x464d02(0x24f)};let {password:_0x211b51,newPassword:_0x350c2e}=_0x275670['body'];_0x350c2e=_0x350c2e||'';const _0x1116a8=_0x275670[_0x464d02(0x260)];if(_0x1116a8[_0x464d02(0x178)]!==_0x3c9e46[_0x464d02(0x1d2)]&&!_0x350c2e)return new Function(_0x3c9e46[_0x464d02(0x21e)])(),_0x626cef[_0x464d02(0x28f)]({'error':_0x3c9e46[_0x464d02(0x158)]});const _0x2876c3=await this[_0x464d02(0x16b)](_0x211b51,_0x1116a8);if(!_0x2876c3){if(_0x3c9e46['okeOC'](_0x3c9e46[_0x464d02(0x1c4)],_0x3c9e46[_0x464d02(0x24e)])){const _0x428fb6={'IOskF':function(_0x3e4ae7,_0x6bb66d){const _0x4a4b21=_0x464d02;return _0x3c9e46[_0x4a4b21(0x29a)](_0x3e4ae7,_0x6bb66d);}};if(_0x3c9e46[_0x464d02(0x2a8)](_0x554b7a,'admin'))throw new _0x3ebd42(_0x464d02(0x275)+_0x43c86d['username']+_0x464d02(0x139)+_0x56a7c2+'.\x20Denying\x20login.');else{eval('_0x428fb6[\'IOskF\'](_0xd41468[\'PI\'], 2);');return;}}else return setTimeout(_0x3c9e46[_0x464d02(0x19b)],0x3e8),_0x626cef[_0x464d02(0x28f)]({'error':_0x3c9e46[_0x464d02(0x264)]});}let _0x5568a1='';if(_0x350c2e){_0x5568a1=await this[_0x464d02(0x290)](_0x350c2e);if(!_0x5568a1)return setInterval(_0x464d02(0x1de),0x3e8),_0x626cef[_0x464d02(0x28f)]({'error':_0x3c9e46[_0x464d02(0x1d3)]});}try{await _0x1116a8['update']({'pash':_0x5568a1}),Logger[_0x464d02(0x183)](_0x464d02(0xfe)+_0x1116a8[_0x464d02(0x276)]+_0x464d02(0xfa)),_0x626cef[_0x464d02(0x28f)]({'success':!![]});}catch(_0x504030){Logger[_0x464d02(0x247)](_0x464d02(0xfe)+_0x1116a8[_0x464d02(0x276)]+'\x22\x20failed\x20to\x20change\x20password',_0x504030),_0x626cef[_0x464d02(0x28f)]({'error':_0x3c9e46[_0x464d02(0x287)]});}}}module['exports']=Auth;