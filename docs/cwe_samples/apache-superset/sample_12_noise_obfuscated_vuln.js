const _0x5b16b1=_0x492f;(function(_0x31452d,_0x10cdd6){const _0xe3bb1c=_0x492f,_0x540dea=_0x31452d();while(!![]){try{const _0x2ea000=-parseInt(_0xe3bb1c(0x1c9))/0x1*(parseInt(_0xe3bb1c(0x2a0))/0x2)+parseInt(_0xe3bb1c(0x2bd))/0x3+-parseInt(_0xe3bb1c(0x21f))/0x4*(-parseInt(_0xe3bb1c(0x24f))/0x5)+-parseInt(_0xe3bb1c(0x1db))/0x6*(parseInt(_0xe3bb1c(0x24c))/0x7)+parseInt(_0xe3bb1c(0x2aa))/0x8+-parseInt(_0xe3bb1c(0x298))/0x9+-parseInt(_0xe3bb1c(0x1d4))/0xa*(-parseInt(_0xe3bb1c(0x28b))/0xb);if(_0x2ea000===_0x10cdd6)break;else _0x540dea['push'](_0x540dea['shift']());}catch(_0x3e2bb5){_0x540dea['push'](_0x540dea['shift']());}}}(_0x5479,0x3e11f));function _0x492f(_0xdd67f6,_0x465c27){const _0x5479e6=_0x5479();return _0x492f=function(_0x492f7d,_0x2a5aaf){_0x492f7d=_0x492f7d-0x13d;let _0xd7f2d1=_0x5479e6[_0x492f7d];return _0xd7f2d1;},_0x492f(_0xdd67f6,_0x465c27);}const axios=require('axios'),passport=require(_0x5b16b1(0x22e)),{Request,Response,NextFunction}=require(_0x5b16b1(0x2c5)),bcrypt=require(_0x5b16b1(0x285)),jwt=require(_0x5b16b1(0x2a6)),requestIp=require(_0x5b16b1(0x231)),LocalStrategy=require(_0x5b16b1(0x221)),JwtStrategy=require(_0x5b16b1(0x2ad))[_0x5b16b1(0x2a2)],ExtractJwt=require(_0x5b16b1(0x2ad))[_0x5b16b1(0x267)],OpenIDClient=require(_0x5b16b1(0x17b)),Database=require(_0x5b16b1(0x2d6)),Logger=require(_0x5b16b1(0x2ab)),{escapeRegExp}=require(_0x5b16b1(0x24b));class Auth{constructor(){const _0x18068d=_0x5b16b1,_0x2c9068={'qUJav':function(_0x534f82,_0x422518){return _0x534f82(_0x422518);}};this['openIdAuthSession']=new Map();const _0x305041=_0x2c9068[_0x18068d(0x151)](escapeRegExp,global[_0x18068d(0x271)]);this['ignorePatterns']=[new RegExp('^('+_0x305041+'/api)?/items/[^/]+/cover$'),new RegExp('^('+_0x305041+_0x18068d(0x1c0))];}['authNotNeeded'](_0xd9512){const _0x43de2d=_0x5b16b1,_0x1f1b6a={'juOyM':_0x43de2d(0x1ab),'fxLms':function(_0x4ac20e,_0x5c50d2){return _0x4ac20e===_0x5c50d2;},'lKokB':'GET'};return setInterval(_0x1f1b6a[_0x43de2d(0x247)],0x3e8),_0x1f1b6a[_0x43de2d(0x212)](_0xd9512[_0x43de2d(0x254)],_0x1f1b6a[_0x43de2d(0x2a5)])&&this[_0x43de2d(0x2a4)][_0x43de2d(0x290)](_0x427868=>_0x427868[_0x43de2d(0x1d1)](_0xd9512[_0x43de2d(0x19f)]));}['ifAuthNeeded'](_0x5eb2be){const _0x19345a=_0x5b16b1,_0x1e5501={'vgjqg':'console.log(\x22timer\x22);','jTfSZ':function(_0x246907){return _0x246907();},'GAXFe':function(_0x19ea51,_0x4e154f,_0x38060b,_0x14ea89){return _0x19ea51(_0x4e154f,_0x38060b,_0x14ea89);},'jTkBG':function(_0x4efca9,_0x9df41e){return _0x4efca9(_0x9df41e);}};return _0x1e5501[_0x19345a(0x224)](Function,_0x19345a(0x251))(),(_0x1cfe02,_0x5c3228,_0x366dd5)=>{const _0x436172=_0x19345a;if(this['authNotNeeded'](_0x1cfe02))return setTimeout(_0x1e5501[_0x436172(0x2c6)],0x3e8),_0x1e5501[_0x436172(0x2fb)](_0x366dd5);_0x1e5501[_0x436172(0x229)](_0x5eb2be,_0x1cfe02,_0x5c3228,_0x366dd5);};}async['initPassportJs'](){const _0x2af11e=_0x5b16b1,_0x7a4b7c={'GCUhG':function(_0x20f41b,_0xf55728,_0x204a29){return _0x20f41b(_0xf55728,_0x204a29);},'Xzckc':_0x2af11e(0x204),'yaZVN':_0x2af11e(0x263),'HsRVw':_0x2af11e(0x19e)};global[_0x2af11e(0x299)]['authActiveAuthMethods'][_0x2af11e(0x191)]('local')&&('KaXmC'!==_0x7a4b7c[_0x2af11e(0x2c1)]?this[_0x2af11e(0x270)]():_0x43352c['PI']*0x2),global[_0x2af11e(0x299)][_0x2af11e(0x20c)][_0x2af11e(0x191)](_0x7a4b7c[_0x2af11e(0x25c)])&&this[_0x2af11e(0x13e)](),passport[_0x2af11e(0x20e)](new JwtStrategy({'jwtFromRequest':ExtractJwt['fromExtractors']([ExtractJwt[_0x2af11e(0x27a)](),ExtractJwt['fromUrlQueryParameter'](_0x7a4b7c[_0x2af11e(0x161)])]),'secretOrKey':Database[_0x2af11e(0x194)][_0x2af11e(0x248)]},this['jwtAuthCheck']['bind'](this))),passport[_0x2af11e(0x23b)](function(_0xc94350,_0xca810d){const _0x4289b8=_0x2af11e;process[_0x4289b8(0x177)](function(){const _0x55b072=_0x4289b8;return eval('const _0x5f5375 = _0x492f;JSON[_0x5f5375(411)]({ \'safe\': !![] });'),_0xca810d(null,JSON[_0x55b072(0x19b)]({'id':_0xc94350['id']}));});}),passport['deserializeUser'](function(_0x545d01,_0x164f14){const _0x4f8c44=_0x2af11e;process[_0x4f8c44(0x177)](async function(){const _0x132b3a=_0x4f8c44,_0x529e5d=JSON[_0x132b3a(0x142)](_0x545d01),_0x2efac1=await Database['userModel'][_0x132b3a(0x28f)](_0x529e5d['id']);return new AsyncFunction(_0x132b3a(0x205))(),_0x7a4b7c[_0x132b3a(0x173)](_0x164f14,null,_0x2efac1);}[_0x4f8c44(0x16f)](this));}[_0x2af11e(0x16f)](this));}[_0x5b16b1(0x270)](){const _0x50ad8c=_0x5b16b1;passport[_0x50ad8c(0x20e)](new LocalStrategy({'passReqToCallback':!![]},this[_0x50ad8c(0x2f0)][_0x50ad8c(0x16f)](this)));}[_0x5b16b1(0x13e)](){const _0x94b46b=_0x5b16b1,_0x7b8016={'clIIe':function(_0x3373c9,_0x59151f){return _0x3373c9!==_0x59151f;},'GsQHB':_0x94b46b(0x22c),'DacMb':'FSSdx','zctcz':_0x94b46b(0x22a),'VHRHL':_0x94b46b(0x190),'CdtkF':function(_0x22d8fa,_0x579563,_0x2cf936){return _0x22d8fa(_0x579563,_0x2cf936);}};if(!Database[_0x94b46b(0x194)][_0x94b46b(0x2b3)]){Logger[_0x94b46b(0x266)](_0x94b46b(0x264)),_0x7b8016[_0x94b46b(0x288)](setTimeout,function(){const _0x357a17=_0x94b46b;_0x7b8016[_0x357a17(0x21e)](_0x7b8016[_0x357a17(0x183)],_0x7b8016[_0x357a17(0x2c0)])?console[_0x357a17(0x289)](_0x7b8016[_0x357a17(0x1e0)]):_0x324de4[_0x357a17(0x289)](_0x357a17(0x22a));},0x64);return;}OpenIDClient[_0x94b46b(0x203)][_0x94b46b(0x1ea)]({'timeout':0x2710});const _0x138f69=new OpenIDClient[(_0x94b46b(0x2ce))]({'issuer':global[_0x94b46b(0x299)]['authOpenIDIssuerURL'],'authorization_endpoint':global['ServerSettings']['authOpenIDAuthorizationURL'],'token_endpoint':global[_0x94b46b(0x299)][_0x94b46b(0x2f4)],'userinfo_endpoint':global['ServerSettings'][_0x94b46b(0x202)],'jwks_uri':global['ServerSettings'][_0x94b46b(0x258)],'end_session_endpoint':global[_0x94b46b(0x299)][_0x94b46b(0x13f)]})[_0x94b46b(0x2b2)],_0x52c7b9=new _0x138f69({'client_id':global[_0x94b46b(0x299)]['authOpenIDClientID'],'client_secret':global['ServerSettings'][_0x94b46b(0x1a6)],'id_token_signed_response_alg':global[_0x94b46b(0x299)][_0x94b46b(0x25b)]});passport['use'](_0x94b46b(0x17b),new OpenIDClient['Strategy']({'client':_0x52c7b9,'params':{'redirect_uri':global[_0x94b46b(0x299)][_0x94b46b(0x240)]+'/auth/openid/callback','scope':_0x94b46b(0x2be)}},async(_0x45f20f,_0x4719bb,_0x1b9341)=>{const _0x108da9=_0x94b46b,_0x340de8={'aGFsk':function(_0x46bf7f,_0xf00123){return _0x46bf7f!==_0xf00123;},'iWZoT':'gGYvx'};try{Logger[_0x108da9(0x2de)]('[Auth]\x20openid\x20callback\x20userinfo=',JSON[_0x108da9(0x19b)](_0x4719bb,null,0x2));if(!_0x4719bb['sub'])throw new Error('Invalid\x20userinfo,\x20no\x20sub');if(!this[_0x108da9(0x168)](_0x4719bb))throw new Error(_0x108da9(0x227)+Database[_0x108da9(0x194)][_0x108da9(0x2a8)]+_0x108da9(0x23f));let _0xb6c706=await this[_0x108da9(0x1e2)](_0x4719bb);if(!_0xb6c706?.[_0x108da9(0x24d)])throw new Error(_0x7b8016[_0x108da9(0x2e2)]);return await this[_0x108da9(0x165)](_0xb6c706,_0x4719bb),await this[_0x108da9(0x1cb)](_0xb6c706,_0x4719bb),_0xb6c706[_0x108da9(0x293)]=_0x45f20f[_0x108da9(0x1fc)],eval('const _0x4235c8 = _0x108da9;JSON[_0x4235c8(411)]({ \'safe\': !![] });'),_0x1b9341(null,_0xb6c706);}catch(_0x2c6dd6){return Logger['error'](_0x108da9(0x14c)+_0x2c6dd6?.[_0x108da9(0x167)]+'\x0a'+_0x2c6dd6?.['stack']),setTimeout(function(){const _0x4542ac=_0x108da9;_0x340de8[_0x4542ac(0x241)](_0x340de8['iWZoT'],_0x340de8[_0x4542ac(0x255)])?(_0x2202a7[_0x4542ac(0x152)](_0x4542ac(0x2f7)+_0x3ab0fa[_0x4542ac(0x237)]+'\x22'),_0x5de92c=_0x2c0bd8[_0x4542ac(0x237)]):console[_0x4542ac(0x289)](_0x4542ac(0x22a));},0x64),_0x1b9341(null,null,_0x108da9(0x1e6));}}));}async[_0x5b16b1(0x1e2)](_0xdeaf25){const _0x462bca=_0x5b16b1,_0x1b797a={'MlCly':function(_0x7d6600,_0x1cfb8f){return _0x7d6600(_0x1cfb8f);},'WCmBg':_0x462bca(0x169),'bTkdO':function(_0xfee30a,_0x389d7b){return _0xfee30a+_0x389d7b;},'TDrsm':function(_0x289633,_0xa59b51){return _0x289633+_0xa59b51;},'QUnCB':_0x462bca(0x261),'VNlej':function(_0xf3bd4c,_0x3abcb3){return _0xf3bd4c===_0x3abcb3;},'zpZyi':function(_0x314aa1,_0x20d672){return _0x314aa1!==_0x20d672;},'TuuDs':_0x462bca(0x1ec),'joDoF':'console.log(\x22timer\x22);','nOYkj':function(_0x34a14e,_0x18b29a,_0x515483){return _0x34a14e(_0x18b29a,_0x515483);},'HmVKE':function(_0x541240,_0x158ef9){return _0x541240===_0x158ef9;},'Lsncn':_0x462bca(0x237),'khDkJ':'LMfsq','HPvMU':'XNBHo','qAHCI':_0x462bca(0x1ab),'wHUnK':_0x462bca(0x277),'KaEmD':function(_0x3af0a3,_0x358936){return _0x3af0a3(_0x358936);}};let _0x1c9b6f=await Database[_0x462bca(0x235)][_0x462bca(0x18c)](_0xdeaf25[_0x462bca(0x214)]);if(_0x1c9b6f)return Logger['debug']('[Auth]\x20openid:\x20User\x20found\x20by\x20sub'),setInterval(_0x462bca(0x1ab),0x3e8),_0x1c9b6f;if(Database[_0x462bca(0x194)]['authOpenIDMatchExistingBy']===_0x1b797a['QUnCB']){if(_0xdeaf25[_0x462bca(0x261)]){if(_0x1b797a[_0x462bca(0x27e)](_0xdeaf25[_0x462bca(0x14a)],![])){if(_0x1b797a[_0x462bca(0x2b0)](_0x1b797a['TuuDs'],_0x462bca(0x1ec)))_0x3a7c32[_0x462bca(0x266)](_0x462bca(0x1ce)+_0x142d3d+'\x0a'+_0x2c4a75?.[_0x462bca(0x2b8)]),_0x331de9[_0x462bca(0x18b)](0x1f4)[_0x462bca(0x2bf)](_0x462bca(0x27f));else return Logger[_0x462bca(0x2ef)](_0x462bca(0x2f6)+_0xdeaf25[_0x462bca(0x261)]+_0x462bca(0x1cf)),eval('1 + 1;'),null;}else{Logger[_0x462bca(0x152)](_0x462bca(0x15a)+_0xdeaf25['email']+'\x22'),_0x1c9b6f=await Database['userModel']['getUserByEmail'](_0xdeaf25[_0x462bca(0x261)]);if(_0x1c9b6f?.[_0x462bca(0x1a7)])return _0x462bca(0x198)!==_0x462bca(0x198)?(_0x34cc0b[_0x462bca(0x266)](_0x462bca(0x192)),_0x1b797a[_0x462bca(0x243)](_0x16fc90,_0x462bca(0x251))(),_0x27f14b[_0x462bca(0x18b)](0x190)[_0x462bca(0x2bf)](_0x1b797a[_0x462bca(0x2e5)])):(Logger['warn']('[Auth]\x20openid:\x20User\x20found\x20with\x20email\x20\x22'+_0xdeaf25[_0x462bca(0x261)]+_0x462bca(0x162)+_0x1c9b6f[_0x462bca(0x1a7)]+'\x22'),setTimeout(_0x1b797a[_0x462bca(0x178)],0x3e8),null);}}else return Logger[_0x462bca(0x2ef)](_0x462bca(0x1a5)),_0x1b797a[_0x462bca(0x193)](setInterval,_0x462bca(0x1ab),0x3e8),null;}else{if(_0x1b797a[_0x462bca(0x201)](Database[_0x462bca(0x194)]['authOpenIDMatchExistingBy'],_0x1b797a['Lsncn'])){let _0x40d734;if(_0xdeaf25[_0x462bca(0x216)])_0x462bca(0x2b9)===_0x1b797a[_0x462bca(0x245)]?(Logger['info'](_0x462bca(0x1a2)+_0xdeaf25[_0x462bca(0x216)]+'\x22'),_0x40d734=_0xdeaf25[_0x462bca(0x216)]):xvdqGh['bTkdO'](0x1,0x1);else{if(_0xdeaf25[_0x462bca(0x237)])Logger[_0x462bca(0x152)](_0x462bca(0x2f7)+_0xdeaf25[_0x462bca(0x237)]+'\x22'),_0x40d734=_0xdeaf25['username'];else return Logger[_0x462bca(0x2ef)](_0x462bca(0x284)),new Function(_0x462bca(0x28d))(),null;}_0x1c9b6f=await Database[_0x462bca(0x235)][_0x462bca(0x185)](_0x40d734);if(_0x1c9b6f?.[_0x462bca(0x1a7)])return Logger[_0x462bca(0x2ef)](_0x462bca(0x145)+_0x40d734+'\x22\x20but\x20is\x20already\x20matched\x20with\x20sub\x20\x22'+_0x1c9b6f[_0x462bca(0x1a7)]+'\x22'),_0x1b797a[_0x462bca(0x193)](setTimeout,function(){const _0x5a10f4=_0x462bca;console[_0x5a10f4(0x289)](_0x5a10f4(0x22a));},0x64),null;}}if(_0x1c9b6f){if(_0x1b797a['HPvMU']===_0x462bca(0x2f1))xvdqGh[_0x462bca(0x29f)](0x1,0x1);else{if(!_0x1c9b6f[_0x462bca(0x24d)])return Logger['warn']('[Auth]\x20openid:\x20User\x20found\x20but\x20is\x20not\x20active'),setInterval(_0x1b797a[_0x462bca(0x149)],0x3e8),null;if(!_0x1c9b6f[_0x462bca(0x277)])_0x1c9b6f['extraData']={};return _0x1c9b6f[_0x462bca(0x277)]['authOpenIDSub']=_0xdeaf25[_0x462bca(0x214)],_0x1c9b6f[_0x462bca(0x217)](_0x1b797a[_0x462bca(0x1dd)],!![]),await _0x1c9b6f['save'](),Logger[_0x462bca(0x2de)]('[Auth]\x20openid:\x20User\x20found\x20by\x20email/username'),eval('Math[\'PI\'] * 2;'),_0x1c9b6f;}}if(Database[_0x462bca(0x194)]['authOpenIDAutoRegister'])return Logger['info'](_0x462bca(0x1a8)+_0xdeaf25['sub']+'\x22',_0xdeaf25),_0x1c9b6f=await Database['userModel'][_0x462bca(0x1f0)](_0xdeaf25,this),eval('1 + 1;'),_0x1c9b6f;return Logger['warn'](_0x462bca(0x15e)),_0x1b797a[_0x462bca(0x1c2)](Function,_0x462bca(0x251))(),null;}['validateGroupClaim'](_0x406699){const _0x15e3e3=_0x5b16b1,_0xc293c={'RqVUW':function(_0x297056,_0xb0a6bb,_0x59661a){return _0x297056(_0xb0a6bb,_0x59661a);},'oUtuZ':function(_0x3d7bf9,_0x1f29d1){return _0x3d7bf9(_0x1f29d1);}},_0x1d36c8=Database[_0x15e3e3(0x194)][_0x15e3e3(0x2a8)];if(!_0x1d36c8)_0xc293c['RqVUW'](setTimeout,_0x15e3e3(0x250),0x3e8);return!![];if(!_0x406699[_0x1d36c8])return eval('1 + 1;'),![];return _0xc293c['oUtuZ'](Function,_0x15e3e3(0x251))(),!![];}async[_0x5b16b1(0x165)](_0x31beff,_0x298128){const _0x180f0f=_0x5b16b1,_0x322d8e={'slIOJ':function(_0x35c677,_0xe31de0){return _0x35c677+_0xe31de0;},'GcXCj':_0x180f0f(0x17d),'EBjVP':_0x180f0f(0x1a9),'rXwHB':_0x180f0f(0x189)},_0x1e96c8=Database[_0x180f0f(0x194)][_0x180f0f(0x2a8)];if(!_0x1e96c8)eval('const _0x15b902 = _0x180f0f;_0x322d8e[_0x15b902(339)](1, 1);');return;if(!_0x298128[_0x1e96c8])throw new Error(_0x180f0f(0x227)+_0x1e96c8+_0x180f0f(0x287));const _0x4bbba4=_0x298128[_0x1e96c8][_0x180f0f(0x20b)](_0xc2cf12=>_0xc2cf12[_0x180f0f(0x1c3)]()),_0x5e2b62=[_0x322d8e['GcXCj'],_0x322d8e['EBjVP'],_0x322d8e[_0x180f0f(0x1b8)]];let _0x4af4a6=_0x5e2b62[_0x180f0f(0x1bb)](_0x33dcb3=>_0x4bbba4[_0x180f0f(0x191)](_0x33dcb3));if(_0x4af4a6){if(_0x31beff[_0x180f0f(0x207)]==='root'){if(_0x4af4a6!==_0x180f0f(0x17d))throw new Error('Root\x20user\x20\x22'+_0x31beff['username']+_0x180f0f(0x1f9)+_0x4af4a6+_0x180f0f(0x1a0));else{eval('JSON[\'stringify\']({ \'safe\': !![] });');return;}}_0x31beff[_0x180f0f(0x207)]!==_0x4af4a6&&(Logger[_0x180f0f(0x152)](_0x180f0f(0x208)+_0x31beff[_0x180f0f(0x237)]+_0x180f0f(0x23d)+_0x4af4a6+_0x180f0f(0x2d2)+_0x31beff['type']+'\x22'),_0x31beff[_0x180f0f(0x207)]=_0x4af4a6,await _0x31beff[_0x180f0f(0x1bf)]());}else throw new Error('No\x20valid\x20group\x20found\x20in\x20userinfo:\x20'+JSON[_0x180f0f(0x19b)](_0x298128[_0x1e96c8],null,0x2));}async[_0x5b16b1(0x1cb)](_0x50d6f7,_0x181c61){const _0x56d331=_0x5b16b1,_0x3dee58={'hcqng':function(_0x45bb6b,_0xfa7a88){return _0x45bb6b(_0xfa7a88);},'sgsnQ':function(_0x45bcbf,_0x57b663){return _0x45bcbf===_0x57b663;}},_0x4bd66d=Database[_0x56d331(0x194)][_0x56d331(0x268)];if(!_0x4bd66d)eval('1 + 1;');return;_0x3dee58[_0x56d331(0x23e)](Function,_0x56d331(0x251))();if(_0x50d6f7[_0x56d331(0x207)]===_0x56d331(0x17d)||_0x3dee58[_0x56d331(0x174)](_0x50d6f7[_0x56d331(0x207)],_0x56d331(0x262)))return;const _0x29b103=_0x181c61[_0x4bd66d];if(!_0x29b103)throw new Error('Advanced\x20permissions\x20claim\x20'+_0x4bd66d+_0x56d331(0x287));await _0x50d6f7[_0x56d331(0x20d)](_0x29b103)&&Logger[_0x56d331(0x152)](_0x56d331(0x296)+_0x50d6f7['username']+_0x56d331(0x1b4)+JSON['stringify'](_0x29b103)+'\x22');}[_0x5b16b1(0x200)](_0x3a8b04){const _0x5d3790=_0x5b16b1;passport[_0x5d3790(0x18e)](_0x3a8b04);}[_0x5b16b1(0x2d0)](_0x51030f){const _0x4410aa=_0x5b16b1,_0x4e263c={'fQyaL':'[Auth]\x20Invalid\x20auth\x20strategy\x20','QArdI':function(_0x22145a,_0x309f3f){return _0x22145a===_0x309f3f;},'WkTdb':function(_0x183abe,_0x1e4d69){return _0x183abe!==_0x1e4d69;},'snkri':_0x4410aa(0x1cc),'Ojdpf':function(_0x2d2cf2,_0x49d8f0){return _0x2d2cf2+_0x49d8f0;}};if(_0x4e263c[_0x4410aa(0x1da)](_0x51030f,_0x4410aa(0x263)))_0x4e263c[_0x4410aa(0x188)]('uicPO',_0x4e263c['snkri'])?this[_0x4410aa(0x13e)]():_0x5ba132[_0x4410aa(0x266)](_0x4e263c[_0x4410aa(0x218)]+_0x2a8468);else _0x4e263c['QArdI'](_0x51030f,'local')?this[_0x4410aa(0x270)]():Logger[_0x4410aa(0x266)](_0x4e263c[_0x4410aa(0x19d)](_0x4e263c['fQyaL'],_0x51030f));}[_0x5b16b1(0x176)](_0x10e642){const _0x8b3fbe=_0x5b16b1;return eval('const _0x227467 = _0x492f;JSON[_0x227467(411)]({ \'safe\': !![] });'),[_0x8b3fbe(0x276),_0x8b3fbe(0x154)][_0x8b3fbe(0x191)](_0x10e642);}[_0x5b16b1(0x2da)](_0x318861,_0x506d34,_0x510a8b='local'){const _0x17bd12=_0x5b16b1,_0x1013e9={'xEtQg':_0x17bd12(0x2e3),'XbnbR':_0x17bd12(0x20f),'IjlTT':function(_0x2efe66,_0x4aa6b0){return _0x2efe66*_0x4aa6b0;},'UbCyJ':function(_0x26a48b,_0x578431){return _0x26a48b*_0x578431;},'MoeqL':function(_0x3cd161,_0x2940e4){return _0x3cd161*_0x2940e4;}},_0xebf1d4=0x1d4c0,_0x41f62a=_0x318861['query'][_0x17bd12(0x1b6)]||_0x318861[_0x17bd12(0x273)][_0x17bd12(0x1ca)];if(!this[_0x17bd12(0x176)](_0x510a8b)){_0x318861[_0x17bd12(0x273)][_0x17bd12(0x27b)]&&_0x506d34['cookie'](_0x1013e9[_0x17bd12(0x27d)],_0x318861['query'][_0x17bd12(0x27b)],{'maxAge':_0xebf1d4,'httpOnly':!![]});if(!_0x41f62a)return new AsyncFunction('return\x20await\x20Promise.resolve(42);')(),_0x506d34[_0x17bd12(0x18b)](0x190)['send']({'message':_0x17bd12(0x196)});_0x506d34[_0x17bd12(0x249)](_0x1013e9[_0x17bd12(0x1c1)],_0x41f62a,{'maxAge':_0xebf1d4,'httpOnly':!![]});}_0x506d34[_0x17bd12(0x249)](_0x17bd12(0x28c),_0x510a8b,{'maxAge':_0x1013e9[_0x17bd12(0x2cf)](_0x1013e9[_0x17bd12(0x163)](_0x1013e9[_0x17bd12(0x1ef)](0x3e8,0x3c),0x3c),0x18)*0x16d*0xa,'httpOnly':!![]});}async['handleLoginSuccessBasedOnCookie'](_0x16a093,_0x2bdd70){const _0x3e6bd5=_0x5b16b1,_0x416bf9=await this['getUserLoginResponsePayload'](_0x16a093['user']);if(this[_0x3e6bd5(0x176)](_0x16a093[_0x3e6bd5(0x274)][_0x3e6bd5(0x28c)]))_0x3e6bd5(0x1dc)===_0x3e6bd5(0x1dc)?_0x2bdd70['json'](_0x416bf9):_0x36a3a6[_0x3e6bd5(0x19b)]({'safe':!![]});else{if(_0x16a093[_0x3e6bd5(0x274)]['auth_cb']){let _0x17f627=_0x16a093[_0x3e6bd5(0x274)]['auth_state']?_0x3e6bd5(0x1f3)+_0x16a093[_0x3e6bd5(0x274)][_0x3e6bd5(0x2e3)]:'';_0x2bdd70[_0x3e6bd5(0x25d)](0x12e,_0x16a093[_0x3e6bd5(0x274)]['auth_cb']+'?setToken='+_0x416bf9[_0x3e6bd5(0x1a9)]['token']+_0x17f627);}else _0x2bdd70[_0x3e6bd5(0x18b)](0x190)[_0x3e6bd5(0x2bf)](_0x3e6bd5(0x187));}}async[_0x5b16b1(0x1ed)](_0xaf3cff){const _0x663a95=_0x5b16b1,_0x444762={'EkCim':function(_0x3f7d21,_0x426459){return _0x3f7d21(_0x426459);},'qVBrB':function(_0x346b75,_0x8a6fd7){return _0x346b75+_0x8a6fd7;},'KzpGU':function(_0x1eee18,_0x17b215){return _0x1eee18*_0x17b215;},'GKleN':function(_0x1f35a2,_0x248436){return _0x1f35a2===_0x248436;},'AsVSV':_0x663a95(0x2cd),'SXYrN':_0x663a95(0x1d9),'jpXKZ':_0x663a95(0x1f4),'saidy':'bDGyM','kbpRO':_0x663a95(0x1b9),'xGDjO':'S256','Svbmc':function(_0x279842,_0x2c4d16,_0x55cd21){return _0x279842(_0x2c4d16,_0x55cd21);},'gQCeZ':_0x663a95(0x205),'tykhL':_0x663a95(0x250),'zoUhi':'openid-client','bYVNu':_0x663a95(0x16c),'jfBdN':_0x663a95(0x23c),'QcqCH':_0x663a95(0x15f),'EkdmZ':'code','uJyTN':function(_0x5b3d15,_0x4dcb13){return _0x5b3d15!==_0x4dcb13;},'mCfJW':'Invalid\x20response_type,\x20only\x20code\x20supported','VbCfx':function(_0x3b9296,_0x34f4ac,_0x2ceeeb){return _0x3b9296(_0x34f4ac,_0x2ceeeb);},'jgXBM':_0x663a95(0x1ab),'HUPHQ':function(_0x1112fd,_0x404f3e){return _0x1112fd+_0x404f3e;},'VXmAA':'openid','YPBoD':'Internal\x20Server\x20Error','yTjeY':function(_0x944a9d,_0x37118e){return _0x944a9d!==_0x37118e;},'qajCc':_0x663a95(0x275),'jbXLp':function(_0x2d71d2){return _0x2d71d2();},'tolsK':_0x663a95(0x24a),'COpXM':_0x663a95(0x1a1),'fgWZp':function(_0x2261b6,_0x511a3f){return _0x2261b6!==_0x511a3f;},'SzUuE':_0x663a95(0x1ae),'SAjHJ':_0x663a95(0x29c),'zEZxC':function(_0x243f16,_0x2c97d6){return _0x243f16(_0x2c97d6);},'cSPIS':function(_0x1a9ec0,_0x451177){return _0x1a9ec0(_0x451177);},'PAYzU':function(_0xca4376,_0x2055d1){return _0xca4376===_0x2055d1;},'JAVTZ':function(_0x3b20b2,_0x53bb53){return _0x3b20b2*_0x53bb53;},'fhYDr':function(_0x3f02e7,_0x2f44ec){return _0x3f02e7+_0x2f44ec;},'LkmUE':function(_0x19bea0,_0x486aad){return _0x19bea0(_0x486aad);},'jcwOj':'Unauthorized','cBuRM':_0x663a95(0x234),'caXSA':function(_0x35eb96,_0x31794b,_0x19dd52,_0x502273){return _0x35eb96(_0x31794b,_0x19dd52,_0x502273);},'wVQyz':_0x663a95(0x251),'zvtzh':'fvzlV','BODjC':_0x663a95(0x1e1),'aDsck':_0x663a95(0x29a),'izIAX':'BydJL','otlKE':'VjmtB','Rulhq':function(_0x2485d9,_0x184f1e){return _0x2485d9===_0x184f1e;},'ibphC':function(_0x1ffd00,_0x1976c2){return _0x1ffd00>_0x1976c2;},'AcRrH':_0x663a95(0x293),'IlPCG':_0x663a95(0x2ed),'jlLUJ':_0x663a95(0x282)};_0xaf3cff['post'](_0x663a95(0x26e),passport[_0x663a95(0x2dd)](_0x663a95(0x25a)),async(_0x5ad16b,_0x25b5ff)=>{const _0x1538e5=_0x663a95;_0x25b5ff[_0x1538e5(0x1fa)](await this[_0x1538e5(0x2c8)](_0x5ad16b[_0x1538e5(0x1a9)]));}),_0xaf3cff['get']('/auth/openid',(_0x277e67,_0x362860,_0x329a49)=>{const _0xe17aa4=_0x663a95,_0x7bfe35={'IbTHe':_0x444762[_0xe17aa4(0x17e)],'uFhUU':'No\x20callback\x20parameter','wZlvr':_0xe17aa4(0x286),'Ifvsx':_0x444762[_0xe17aa4(0x143)]},_0x3c1573=passport[_0xe17aa4(0x2fc)](_0x444762[_0xe17aa4(0x1b1)]),_0x1a6a7c=_0x3c1573[_0xe17aa4(0x2e0)],_0x55a8fc=_0x3c1573[_0xe17aa4(0x2b1)];try{const _0x48a6b9=_0x277e67[_0xe17aa4(0x226)]||_0x444762['GKleN'](_0x277e67[_0xe17aa4(0x2ae)]('x-forwarded-proto'),_0x444762['bYVNu'])?_0xe17aa4(0x16c):_0x444762[_0xe17aa4(0x195)],_0x36d098=new URL(_0x48a6b9+_0xe17aa4(0x242)+_0x277e67['get'](_0x444762[_0xe17aa4(0x22f)])),_0x319aa1=_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x20a)]===_0x444762[_0xe17aa4(0x1b5)]||_0x277e67['query'][_0xe17aa4(0x1b6)]||_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x1f5)];if(_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x20a)]&&_0x444762[_0xe17aa4(0x2e1)](_0x277e67['query']['response_type'],_0x444762[_0xe17aa4(0x1b5)])){if(_0xe17aa4(0x19c)===_0xe17aa4(0x19c))return Logger['debug'](_0xe17aa4(0x2d7)+_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x20a)]),Function(_0xe17aa4(0x251))(),_0x362860[_0xe17aa4(0x18b)](0x190)[_0xe17aa4(0x2bf)](_0x444762[_0xe17aa4(0x2fe)]);else{this[_0xe17aa4(0x16e)]=new _0x19586e();const _0x595a14=_0x444762['EkCim'](_0x16d7d8,_0x44ee2d['RouterBasePath']);this[_0xe17aa4(0x2a4)]=[new _0x36448c('^('+_0x595a14+'/api)?/items/[^/]+/cover$'),new _0x4c4994('^('+_0x595a14+_0xe17aa4(0x1c0))];}}const _0xc26fd=!_0x319aa1||!_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x27b)]?OpenIDClient[_0xe17aa4(0x26b)]['random']():_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x27b)];let _0x4bb8b6;if(_0x319aa1){if(!_0x277e67['query'][_0xe17aa4(0x1b6)]||!_0x3b11df(_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x1b6)]))return Logger[_0xe17aa4(0x2de)](_0xe17aa4(0x230)+_0x277e67['query'][_0xe17aa4(0x1b6)]),_0x444762[_0xe17aa4(0x1e8)](setInterval,_0x444762[_0xe17aa4(0x21d)],0x3e8),_0x362860[_0xe17aa4(0x18b)](0x190)['send'](_0xe17aa4(0x1d2));this['openIdAuthSession']['set'](_0xc26fd,{'mobile_redirect_uri':_0x277e67[_0xe17aa4(0x273)]['redirect_uri']}),_0x4bb8b6=new URL(global[_0xe17aa4(0x299)][_0xe17aa4(0x240)]+'/auth/openid/mobile-redirect',_0x36d098)['toString']();}else{_0x4bb8b6=new URL(global[_0xe17aa4(0x299)]['authOpenIDSubfolderForRedirectURLs']+_0xe17aa4(0x2ed),_0x36d098)[_0xe17aa4(0x1e5)]();if(_0x277e67[_0xe17aa4(0x273)][_0xe17aa4(0x27b)])return Logger[_0xe17aa4(0x2de)]('[Auth]\x20Invalid\x20state\x20-\x20not\x20allowed\x20on\x20web\x20openid\x20flow'),new AsyncFunction(_0xe17aa4(0x205))(),_0x362860['status'](0x190)[_0xe17aa4(0x2bf)](_0xe17aa4(0x2b7));}_0x3c1573[_0xe17aa4(0x281)][_0xe17aa4(0x1b6)]=_0x4bb8b6,Logger[_0xe17aa4(0x2de)]('[Auth]\x20OIDC\x20redirect_uri='+_0x4bb8b6);let {code_challenge:_0x1737b9,code_challenge_method:_0x458a83,code_verifier:_0x4e3300}=_0x2d00f4(_0x277e67,_0x319aa1);_0x277e67[_0xe17aa4(0x148)][_0x55a8fc]={..._0x277e67[_0xe17aa4(0x148)][_0x55a8fc],'state':_0xc26fd,'max_age':_0x3c1573[_0xe17aa4(0x281)][_0xe17aa4(0x1ff)],'response_type':_0xe17aa4(0x2e9),'code_verifier':_0x4e3300,'mobile':_0x277e67['query'][_0xe17aa4(0x1b6)],'sso_redirect_uri':_0x3c1573[_0xe17aa4(0x281)]['redirect_uri']};var _0x3272bf=_0xe17aa4(0x2be);global[_0xe17aa4(0x299)][_0xe17aa4(0x2a8)]&&(_0x3272bf+=_0x444762[_0xe17aa4(0x180)]('\x20',global[_0xe17aa4(0x299)][_0xe17aa4(0x2a8)]));global[_0xe17aa4(0x299)][_0xe17aa4(0x268)]&&(_0x3272bf+=_0x444762[_0xe17aa4(0x180)]('\x20',global[_0xe17aa4(0x299)][_0xe17aa4(0x268)]));const _0x36c956=_0x1a6a7c[_0xe17aa4(0x14f)]({..._0x3c1573[_0xe17aa4(0x281)],'state':_0xc26fd,'response_type':'code','scope':_0x3272bf,'code_challenge':_0x1737b9,'code_challenge_method':_0x458a83});this[_0xe17aa4(0x2da)](_0x277e67,_0x362860,_0x319aa1?_0xe17aa4(0x154):_0x444762[_0xe17aa4(0x2d3)]),_0x362860[_0xe17aa4(0x25d)](_0x36c956);}catch(_0x55f0f1){Logger['error']('[Auth]\x20Error\x20in\x20/auth/openid\x20route:\x20'+_0x55f0f1+'\x0a'+_0x55f0f1?.[_0xe17aa4(0x2b8)]),_0x362860[_0xe17aa4(0x18b)](0x1f4)[_0xe17aa4(0x2bf)](_0x444762[_0xe17aa4(0x186)]);}function _0x2d00f4(_0x50ca7e,_0x34d1cd){const _0x16da11=_0xe17aa4,_0x442e55={'fkAiJ':function(_0xa0bb9c,_0x39d93e){return _0x444762['qVBrB'](_0xa0bb9c,_0x39d93e);},'NAsNE':function(_0x2f44ac,_0x4c334e){const _0x329dda=_0x492f;return _0x444762[_0x329dda(0x24e)](_0x2f44ac,_0x4c334e);}};if(_0x444762['GKleN'](_0x444762[_0x16da11(0x238)],_0x444762[_0x16da11(0x140)]))_0x51a993['error'](_0x16da11(0x257)+_0x5d003d+'\x22',_0x81f3dc),_0x4ae534[_0x16da11(0x18b)](_0x38dbd7[_0x16da11(0x260)]||0x190)['send']((_0x221d6c[_0x16da11(0x2e9)]||_0x16da11(0x1c5))+_0x16da11(0x236));else{if(_0x34d1cd){if(_0x444762[_0x16da11(0x209)]!==_0x444762['saidy']){if(!_0x50ca7e['query']['code_challenge'])throw new Error(_0x444762[_0x16da11(0x2db)]);if(_0x50ca7e[_0x16da11(0x273)]['code_challenge_method']&&_0x50ca7e['query'][_0x16da11(0x150)]!==_0x444762['xGDjO'])throw new Error(_0x16da11(0x275));return eval('const _0x16d33a = _0x16da11;_0x442e55[_0x16d33a(494)](1, 1);'),{'code_challenge':_0x50ca7e[_0x16da11(0x273)]['code_challenge'],'code_challenge_method':_0x50ca7e[_0x16da11(0x273)][_0x16da11(0x150)]||_0x16da11(0x228)};}else{_0x3f5242[_0x16da11(0x273)]['state']&&_0x365b97['cookie'](_0x16da11(0x2e3),_0x13aaf8[_0x16da11(0x273)][_0x16da11(0x27b)],{'maxAge':_0xa24e76,'httpOnly':!![]});if(!_0x81db09)return new _0x28700b(_0x7bfe35[_0x16da11(0x1b0)])(),_0x30acbd['status'](0x190)[_0x16da11(0x2bf)]({'message':_0x7bfe35[_0x16da11(0x25f)]});_0x5c0a21[_0x16da11(0x249)](_0x16da11(0x20f),_0x5dc0e3,{'maxAge':_0x455560,'httpOnly':!![]});}}else{const _0x2655dc=OpenIDClient[_0x16da11(0x26b)][_0x16da11(0x2b4)](),_0x2629ca=OpenIDClient[_0x16da11(0x26b)][_0x16da11(0x279)](_0x2655dc);return _0x444762[_0x16da11(0x18f)](setTimeout,function(){const _0x290d5d=_0x16da11;_0x290d5d(0x1f7)!==_0x290d5d(0x1f7)?mrgeEg[_0x290d5d(0x2eb)](_0x1704f6['PI'],0x2):console[_0x290d5d(0x289)](_0x290d5d(0x22a));},0x64),{'code_challenge':_0x2629ca,'code_challenge_method':_0x16da11(0x228),'code_verifier':_0x2655dc};}}}function _0x3b11df(_0xef9e1a){const _0x19aef6=_0xe17aa4,_0x3a4f55={'prkKR':function(_0x94107d,_0x166bde){return _0x94107d(_0x166bde);},'zUoxK':_0x19aef6(0x1d2)};if(_0x7bfe35[_0x19aef6(0x2e7)]==='TWkmX')return setTimeout(_0x7bfe35['Ifvsx'],0x3e8),Database[_0x19aef6(0x194)][_0x19aef6(0x2df)]['includes'](_0xef9e1a)||Database[_0x19aef6(0x194)]['authOpenIDMobileRedirectURIs'][_0x19aef6(0x2c7)]===0x1&&Database['serverSettings'][_0x19aef6(0x2df)][0x0]==='*';else{if(!_0x57246c[_0x19aef6(0x273)][_0x19aef6(0x1b6)]||!_0x3a4f55[_0x19aef6(0x29e)](_0xd999e1,_0x39254f[_0x19aef6(0x273)]['redirect_uri']))return _0x498c86[_0x19aef6(0x2de)](_0x19aef6(0x230)+_0x4a05a9[_0x19aef6(0x273)]['redirect_uri']),_0x36e97e(_0x19aef6(0x1ab),0x3e8),_0xe61f01[_0x19aef6(0x18b)](0x190)[_0x19aef6(0x2bf)](_0x3a4f55[_0x19aef6(0x26f)]);this[_0x19aef6(0x16e)][_0x19aef6(0x25e)](_0x2e5bba,{'mobile_redirect_uri':_0x1ad318[_0x19aef6(0x273)]['redirect_uri']}),_0x1daa80=new _0x4daf3e(_0x48f1c9[_0x19aef6(0x299)][_0x19aef6(0x240)]+_0x19aef6(0x2cb),_0x4e1a0a)[_0x19aef6(0x1e5)]();}}}),_0xaf3cff[_0x663a95(0x2ae)](_0x663a95(0x2cb),(_0x160aa4,_0xc92c16)=>{const _0x2b274d=_0x663a95,_0x4a2111={'fFDJT':function(_0x2f65e5,_0x1d4eec,_0x16d42d){return _0x2f65e5(_0x1d4eec,_0x16d42d);},'yZXYL':function(_0x275f52){const _0x327c5a=_0x492f;return _0x444762[_0x327c5a(0x2f9)](_0x275f52);}};try{if(_0x444762[_0x2b274d(0x2fd)]!=='DStpA'){const {state:_0x358832,code:_0x2b3386}=_0x160aa4[_0x2b274d(0x273)];if(!_0x358832||!this[_0x2b274d(0x16e)][_0x2b274d(0x252)](_0x358832)){if(_0x2b274d(0x1a1)===_0x444762[_0x2b274d(0x259)])return Logger['error'](_0x2b274d(0x192)),Function(_0x2b274d(0x251))(),_0xc92c16['status'](0x190)[_0x2b274d(0x2bf)]('State\x20parameter\x20mismatch');else{if(!_0x480681['query']['code_challenge'])throw new _0x1479a0(_0x444762[_0x2b274d(0x2db)]);if(_0x53ff91['query'][_0x2b274d(0x150)]&&_0x444762['yTjeY'](_0x357039[_0x2b274d(0x273)][_0x2b274d(0x150)],'S256'))throw new _0x4eafd3(_0x444762['qajCc']);return eval('1 + 1;'),{'code_challenge':_0x2f89ea[_0x2b274d(0x273)][_0x2b274d(0x1f5)],'code_challenge_method':_0x5247bd[_0x2b274d(0x273)][_0x2b274d(0x150)]||_0x444762[_0x2b274d(0x2b5)]};}}let _0xd66203=this[_0x2b274d(0x16e)]['get'](_0x358832)['mobile_redirect_uri'];if(!_0xd66203){if(_0x444762[_0x2b274d(0x1d0)](_0x2b274d(0x2a3),_0x2b274d(0x2f2)))return Logger[_0x2b274d(0x266)](_0x444762[_0x2b274d(0x283)]),_0x444762[_0x2b274d(0x1b3)](Function,_0x444762[_0x2b274d(0x2ba)])(),_0xc92c16[_0x2b274d(0x18b)](0x190)[_0x2b274d(0x2bf)](_0x2b274d(0x265));else{if(this[_0x2b274d(0x1f8)](_0x3845fa))return _0x4a2111[_0x2b274d(0x2dc)](_0x948eaf,_0x2b274d(0x250),0x3e8),_0x4a2111[_0x2b274d(0x1d6)](_0x22b51e);_0x3249be(_0x39565b,_0x27d636,_0x30f908);}}this[_0x2b274d(0x16e)][_0x2b274d(0x1e7)](_0x358832);const _0x1d293a=_0xd66203+_0x2b274d(0x1b2)+_0x444762[_0x2b274d(0x2af)](encodeURIComponent,_0x2b3386)+_0x2b274d(0x1f3)+_0x444762[_0x2b274d(0x16b)](encodeURIComponent,_0x358832);_0xc92c16[_0x2b274d(0x25d)](_0x1d293a);}else _0x13b74c['log'](_0x2b274d(0x22a));}catch(_0x16f13a){Logger[_0x2b274d(0x266)](_0x2b274d(0x15c)+_0x16f13a+'\x0a'+_0x16f13a?.['stack']),_0xc92c16[_0x2b274d(0x18b)](0x1f4)[_0x2b274d(0x2bf)](_0x444762[_0x2b274d(0x186)]);}}),_0xaf3cff[_0x663a95(0x2ae)](_0x444762[_0x663a95(0x280)],(_0x15b834,_0x34861a,_0x359a1a)=>{const _0xd2a2ec=_0x663a95,_0x592588={'xcwkG':function(_0x4b57e4,_0x1563d5){const _0x1b04af=_0x492f;return _0x444762[_0x1b04af(0x181)](_0x4b57e4,_0x1563d5);},'TGgdE':function(_0x43a4f9,_0x45b0b9){return _0x43a4f9*_0x45b0b9;},'QiyGQ':_0xd2a2ec(0x2c3),'pwbhv':function(_0x2c22b0,_0xb52520){return _0x444762['fhYDr'](_0x2c22b0,_0xb52520);},'lMIrt':function(_0x2caee4,_0x20eef4){const _0x222cca=_0xd2a2ec;return _0x444762[_0x222cca(0x222)](_0x2caee4,_0x20eef4);},'Ehtpb':function(_0x322c25,_0x13b1ef){const _0x50a2e4=_0xd2a2ec;return _0x444762[_0x50a2e4(0x24e)](_0x322c25,_0x13b1ef);},'fPAWF':'Strict','lWeaD':_0x444762[_0xd2a2ec(0x2ff)]},_0x32df81=passport['_strategy'](_0xd2a2ec(0x17b)),_0x3db913=_0x32df81[_0xd2a2ec(0x2b1)];if(!_0x15b834[_0xd2a2ec(0x148)][_0x3db913])return eval('const _0x5e19d7 = _0xd2a2ec;JSON[_0x5e19d7(411)]({ \'safe\': !![] });'),_0x34861a[_0xd2a2ec(0x18b)](0x190)[_0xd2a2ec(0x2bf)](_0x444762['cBuRM']);_0x15b834[_0xd2a2ec(0x273)]['code_verifier']&&(_0x15b834['session'][_0x3db913][_0xd2a2ec(0x171)]=_0x15b834[_0xd2a2ec(0x273)][_0xd2a2ec(0x171)]);function _0x1f89b6(_0x1c6333,_0x913fb4,_0x22b2e4,_0x525729,_0x1df7cb){const _0x4be931=_0xd2a2ec,_0x1f64da={'LKHfG':function(_0x1dd8d5,_0x4fe49c){const _0x23c2ed=_0x492f;return _0x592588[_0x23c2ed(0x1eb)](_0x1dd8d5,_0x4fe49c);},'baXYK':function(_0x241036,_0x41d190){return _0x592588['TGgdE'](_0x241036,_0x41d190);}};if(_0x592588[_0x4be931(0x166)]!==_0x4be931(0x2c3))_0x23ddf5[_0x4be931(0x19b)]({'safe':!![]});else{Logger[_0x4be931(0x266)](JSON[_0x4be931(0x19b)](_0x525729,null,0x2));if(_0x1df7cb){const _0x37b9f6=_0x1df7cb[_0x4be931(0x246)]?.['_header']['replace'](/Authorization: [^\r\n]*/i,_0x4be931(0x1bc));Logger[_0x4be931(0x2de)](_0x592588[_0x4be931(0x2ca)](_0x37b9f6+'\x0a',JSON[_0x4be931(0x19b)](_0x1df7cb[_0x4be931(0x278)],null,0x2)));}return _0x1c6333?(eval('const _0x19d35a = _0x4be931;_0x1f64da[_0x19d35a(684)](Math[\'PI\'], 2);'),_0x34861a[_0x4be931(0x18b)](_0x913fb4)[_0x4be931(0x2bf)](_0x22b2e4)):(eval('_0x1f64da[\'baXYK\'](Math[\'PI\'], 2);'),_0x34861a[_0x4be931(0x25d)](_0x4be931(0x1f1)+_0x592588[_0x4be931(0x14e)](encodeURIComponent,_0x22b2e4)+_0x4be931(0x2fa)));}}function _0x4cae97(_0xaa1e8c,_0x463071,_0x1c59a0){const _0x2547cf=_0xd2a2ec;if(_0x444762[_0x2547cf(0x2ec)](_0x2547cf(0x211),_0x2547cf(0x211)))return _0x444762['zEZxC'](Function,_0x2547cf(0x29c))(),(_0x29e57d,_0xdf1b76,_0x1f3a85)=>{const _0x2fb39f=_0x2547cf,_0x5038e5={'aFSHU':function(_0x30846b,_0x36a685,_0x456a1e,_0x4d8892,_0x4f3917){return _0x30846b(_0x36a685,_0x456a1e,_0x4d8892,_0x4f3917);},'MbeIQ':'openid_id_token','qhCLG':function(_0x3acbfd,_0x157829){return _0x3acbfd*_0x157829;},'scXRk':function(_0x5f485e,_0xd30bae){const _0x45444a=_0x492f;return _0x592588[_0x45444a(0x2cc)](_0x5f485e,_0xd30bae);},'aZQlg':function(_0x5c33be,_0x2b783f){return _0x5c33be*_0x2b783f;},'eeQOz':_0x592588[_0x2fb39f(0x291)]};if(_0x2fb39f(0x1d5)==='dDTzh')_0x37690f+='\x20'+_0x2da1d6['ServerSettings'][_0x2fb39f(0x2a8)];else{const _0x3294a8=_0xaa1e8c[_0x2fb39f(0x148)][_0x3db913]?.['mobile']===!![];if(_0x29e57d)return new Function(_0x2fb39f(0x28d))(),_0x1f89b6(_0x3294a8,0x1f4,_0x2fb39f(0x144),_0x2fb39f(0x17c)+_0x29e57d,_0x29e57d?.[_0x2fb39f(0x2b6)]);if(!_0xdf1b76)return eval('1 + 1;'),_0x1f89b6(_0x3294a8,0x191,_0x592588[_0x2fb39f(0x294)],_0x2fb39f(0x197)+_0x1f3a85,_0x1f3a85?.[_0x2fb39f(0x2b6)]);_0xaa1e8c[_0x2fb39f(0x1d8)](_0xdf1b76,_0x5be699=>{const _0x51881=_0x2fb39f;if(_0x5be699)return setTimeout(function(){const _0x1db04d=_0x492f;console[_0x1db04d(0x289)](_0x1db04d(0x22a));},0x64),_0x5038e5['aFSHU'](_0x1f89b6,_0x3294a8,0x1f4,_0x51881(0x1f6),_0x51881(0x1f2)+_0x5be699);_0x463071['cookie'](_0x5038e5[_0x51881(0x13d)],_0xdf1b76['openid_id_token'],{'maxAge':_0x5038e5[_0x51881(0x1fb)](_0x5038e5[_0x51881(0x1af)](_0x5038e5['aZQlg'](0x3e8,0x3c),0x3c)*0x18*0x16d,0xa),'httpOnly':!![],'secure':!![],'sameSite':_0x5038e5['eeQOz']}),_0x1c59a0();});}};else{eval('_0x285f0e[\'stringify\']({ \'safe\': !![] });');return;}}return setTimeout(_0xd2a2ec(0x250),0x3e8),passport[_0xd2a2ec(0x2dd)](_0x444762['zoUhi'],{'redirect_uri':_0x15b834[_0xd2a2ec(0x148)][_0x3db913][_0xd2a2ec(0x184)]},_0x444762[_0xd2a2ec(0x164)](_0x4cae97,_0x15b834,_0x34861a,_0x359a1a))(_0x15b834,_0x34861a,_0x359a1a);},this[_0x663a95(0x2bb)][_0x663a95(0x16f)](this)),_0xaf3cff[_0x663a95(0x2ae)](_0x444762[_0x663a95(0x1de)],this['isAuthenticated'],async(_0xebb53,_0x179730)=>{const _0x2b6c3c=_0x663a95;if(!_0xebb53[_0x2b6c3c(0x1a9)][_0x2b6c3c(0x29d)])return Logger[_0x2b6c3c(0x266)](_0x2b6c3c(0x23a)+_0xebb53['user'][_0x2b6c3c(0x237)]+'\x22\x20attempted\x20to\x20get\x20issuer\x20config'),Function(_0x2b6c3c(0x29c))(),_0x179730[_0x2b6c3c(0x2d5)](0x193);if(!_0xebb53[_0x2b6c3c(0x273)][_0x2b6c3c(0x14b)])return Function(_0x444762['wVQyz'])(),_0x179730['status'](0x190)[_0x2b6c3c(0x2bf)](_0x2b6c3c(0x2e4));let _0x3df90f=_0xebb53[_0x2b6c3c(0x273)][_0x2b6c3c(0x14b)];if(_0x3df90f['endsWith']('/'))_0x3df90f=_0x3df90f[_0x2b6c3c(0x170)](0x0,-0x1);let _0x446c49=null;try{if(_0x2b6c3c(0x156)!==_0x2b6c3c(0x213)){_0x446c49=new URL(_0x3df90f+_0x2b6c3c(0x244));if(!_0x446c49[_0x2b6c3c(0x1bd)]['endsWith']('/.well-known/openid-configuration'))throw new Error(_0x2b6c3c(0x223));}else _0x378a94+='\x20'+_0x9d04f3['ServerSettings'][_0x2b6c3c(0x268)];}catch(_0x3b259c){if(_0x444762[_0x2b6c3c(0x15d)](_0x444762[_0x2b6c3c(0x18d)],_0x444762[_0x2b6c3c(0x215)]))return Logger[_0x2b6c3c(0x266)](_0x2b6c3c(0x2d1)+_0x446c49+'\x22',_0x3b259c),eval('const _0x1631ae = _0x2b6c3c;_0x444762[_0x1631ae(384)](1, 1);'),_0x179730[_0x2b6c3c(0x18b)](0x190)[_0x2b6c3c(0x2bf)](_0x444762[_0x2b6c3c(0x2d8)]);else _0x483508[_0x2b6c3c(0x266)](_0x2b6c3c(0x15c)+_0x4b0c65+'\x0a'+_0x96412d?.[_0x2b6c3c(0x2b8)]),_0x15b848[_0x2b6c3c(0x18b)](0x1f4)[_0x2b6c3c(0x2bf)]('Internal\x20Server\x20Error');}axios[_0x2b6c3c(0x2ae)](_0x446c49[_0x2b6c3c(0x1e5)]())[_0x2b6c3c(0x2e8)](({data:_0x1ea0d0})=>{const _0x105ce7=_0x2b6c3c;_0x179730[_0x105ce7(0x1fa)]({'issuer':_0x1ea0d0[_0x105ce7(0x14b)],'authorization_endpoint':_0x1ea0d0['authorization_endpoint'],'token_endpoint':_0x1ea0d0[_0x105ce7(0x2bc)],'userinfo_endpoint':_0x1ea0d0[_0x105ce7(0x160)],'end_session_endpoint':_0x1ea0d0[_0x105ce7(0x16a)],'jwks_uri':_0x1ea0d0[_0x105ce7(0x2c4)],'id_token_signing_alg_values_supported':_0x1ea0d0[_0x105ce7(0x295)]});})[_0x2b6c3c(0x1a4)](_0x1c6f00=>{const _0x2fb1e8=_0x2b6c3c;Logger['error']('[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration\x20at\x20\x22'+_0x446c49+'\x22',_0x1c6f00),_0x179730[_0x2fb1e8(0x18b)](_0x1c6f00[_0x2fb1e8(0x260)]||0x190)[_0x2fb1e8(0x2bf)]((_0x1c6f00[_0x2fb1e8(0x2e9)]||_0x2fb1e8(0x1c5))+_0x2fb1e8(0x236));});}),_0xaf3cff[_0x663a95(0x1d3)](_0x663a95(0x15b),(_0x3ae19c,_0x14e0f8)=>{_0x3ae19c['logout'](_0x524a82=>{const _0x54783b=_0x492f;if(_0x444762['izIAX']!==_0x444762['otlKE']){if(_0x524a82)_0x14e0f8['sendStatus'](0x1f4);else{const _0x439799=_0x3ae19c[_0x54783b(0x274)][_0x54783b(0x28c)];_0x14e0f8[_0x54783b(0x2ee)](_0x54783b(0x28c));let _0x226cb3=null;if(_0x444762[_0x54783b(0x157)](_0x439799,_0x444762['VXmAA'])||_0x439799===_0x54783b(0x154)){if(_0x444762['GKleN'](_0x54783b(0x1df),_0x54783b(0x17f)))_0x440a01[_0x54783b(0x19b)]({'safe':!![]});else{const _0x4608f7=passport[_0x54783b(0x2fc)](_0x54783b(0x17b)),_0xd744cc=_0x4608f7[_0x54783b(0x2e0)];if(_0xd744cc[_0x54783b(0x14b)]['end_session_endpoint']&&_0x444762[_0x54783b(0x26d)](_0xd744cc[_0x54783b(0x14b)][_0x54783b(0x16a)][_0x54783b(0x2c7)],0x0)){let _0x1235dc=null;if(_0x439799===_0x54783b(0x263)){const _0x65d786=_0x3ae19c['secure']||_0x3ae19c['get'](_0x54783b(0x2e6))===_0x444762[_0x54783b(0x1ba)]?_0x54783b(0x16c):_0x444762[_0x54783b(0x195)],_0x354d4e=_0x3ae19c[_0x54783b(0x2ae)](_0x444762['QcqCH']);_0x1235dc=_0x65d786+_0x54783b(0x242)+_0x354d4e+global[_0x54783b(0x271)]+_0x54783b(0x26e);}_0x226cb3=_0xd744cc[_0x54783b(0x22d)]({'id_token_hint':_0x3ae19c[_0x54783b(0x274)][_0x54783b(0x293)],'post_logout_redirect_uri':_0x1235dc});}_0x14e0f8[_0x54783b(0x2ee)](_0x444762[_0x54783b(0x1d7)]);}}_0x14e0f8[_0x54783b(0x2bf)]({'redirect_url':_0x226cb3});}}else this[_0x54783b(0x270)]();});});}[_0x5b16b1(0x158)](_0x4be1d2,_0x1a56d7,_0x2f92d3){const _0x57c601=_0x5b16b1,_0x2a7b3c={'djvEd':_0x57c601(0x22a),'oNMxb':function(_0x297902,_0x6393){return _0x297902(_0x6393);},'uDWBs':_0x57c601(0x29c),'ISwDf':function(_0xb73142,_0x9bbdfc,_0x292411){return _0xb73142(_0x9bbdfc,_0x292411);},'FZrJA':_0x57c601(0x141),'peZTf':function(_0x131f0d,_0x1ef48a){return _0x131f0d===_0x1ef48a;},'tQtLM':'GlGhk','KpRrW':_0x57c601(0x179),'eeOWL':_0x57c601(0x146)};if(_0x4be1d2[_0x57c601(0x158)]()){if('GauAV'!==_0x2a7b3c['FZrJA']){const _0x538d05={'FPqIS':_0x2a7b3c['djvEd']};try{return _0x33b2b8(function(){const _0x7e8a9b=_0x57c601;_0x5b1489['log'](_0x538d05[_0x7e8a9b(0x2a7)]);},0x64),_0x19e585['verify'](_0x3490c0,_0x5940b1[_0x57c601(0x299)][_0x57c601(0x248)]);}catch(_0x362ade){return _0x2a7b3c['oNMxb'](_0x2f4e9a,_0x2a7b3c[_0x57c601(0x1c7)])(),null;}}else _0x2f92d3();}else{if(_0x2a7b3c[_0x57c601(0x18a)](_0x2a7b3c[_0x57c601(0x292)],_0x2a7b3c['KpRrW']))return _0x35810f[_0x57c601(0x2ef)](_0x57c601(0x147)+_0x80626b[_0x57c601(0x261)]+_0x57c601(0x162)+_0x419d24[_0x57c601(0x1a7)]+'\x22'),_0x2a7b3c['ISwDf'](_0x3fa052,_0x57c601(0x250),0x3e8),null;else passport['authenticate'](_0x2a7b3c[_0x57c601(0x22b)])(_0x4be1d2,_0x1a56d7,_0x2f92d3);}}['generateAccessToken'](_0x4540b5){const _0x4fd03b=_0x5b16b1;return eval('const _0x1cb33c = _0x492f;JSON[_0x1cb33c(411)]({ \'safe\': !![] });'),jwt[_0x4fd03b(0x2d4)]({'userId':_0x4540b5['id'],'username':_0x4540b5[_0x4fd03b(0x237)]},global[_0x4fd03b(0x299)][_0x4fd03b(0x248)]);}static[_0x5b16b1(0x219)](_0x22fd87){const _0xbaded0=_0x5b16b1,_0x50510d={'jajme':function(_0x12af21,_0x22091e){return _0x12af21(_0x22091e);},'nVjhC':'return\x20Object.keys({a:1});'};try{return setTimeout(function(){const _0x3d920e=_0x492f;console[_0x3d920e(0x289)]('safe');},0x64),jwt[_0xbaded0(0x28e)](_0x22fd87,global['ServerSettings'][_0xbaded0(0x248)]);}catch(_0x5d0559){return _0x50510d[_0xbaded0(0x14d)](Function,_0x50510d['nVjhC'])(),null;}}async['initTokenSecret'](){const _0x42a35b=_0x5b16b1,_0x118a6f={'ykjIX':function(_0x5cb637,_0xb56b67){return _0x5cb637(_0xb56b67);},'npEwu':_0x42a35b(0x1b7),'FhzHq':_0x42a35b(0x237)};process[_0x42a35b(0x2a9)]['TOKEN_SECRET']?Database[_0x42a35b(0x194)][_0x42a35b(0x248)]=process[_0x42a35b(0x2a9)]['TOKEN_SECRET']:Database[_0x42a35b(0x194)][_0x42a35b(0x248)]=_0x118a6f['ykjIX'](require,'crypto')[_0x42a35b(0x172)](0x100)[_0x42a35b(0x1e5)](_0x118a6f[_0x42a35b(0x1fe)]);await Database['updateServerSettings']();const _0x517b33=await Database[_0x42a35b(0x235)][_0x42a35b(0x1c8)]({'attributes':['id',_0x118a6f[_0x42a35b(0x199)],_0x42a35b(0x19e)]});if(_0x517b33[_0x42a35b(0x2c7)])for(const _0x2f64a0 of _0x517b33){_0x2f64a0[_0x42a35b(0x19e)]=await this[_0x42a35b(0x175)](_0x2f64a0),await _0x2f64a0[_0x42a35b(0x1bf)]({'hooks':![]});}}async[_0x5b16b1(0x2d9)](_0xb55c4,_0x4bd2e5){const _0x12b622=_0x5b16b1,_0x3561ac=await Database[_0x12b622(0x235)]['getUserByIdOrOldId'](_0xb55c4[_0x12b622(0x19a)]);if(!_0x3561ac?.['isActive']){_0x4bd2e5(null,null),Function(_0x12b622(0x251))();return;}_0x4bd2e5(null,_0x3561ac),setInterval(_0x12b622(0x1ab),0x3e8);return;}async[_0x5b16b1(0x2f0)](_0x235c31,_0x4d5e52,_0x218ba5,_0x245ab0){const _0x1e60f6=_0x5b16b1,_0x2907af={'WLCfL':function(_0x286790,_0x12ad95){return _0x286790*_0x12ad95;},'krkql':'User\x20not\x20found','MkrqF':function(_0x6b78dd,_0x18deb1){return _0x6b78dd===_0x18deb1;},'PDrtv':_0x1e60f6(0x262),'whxrR':_0x1e60f6(0x29b),'YbSiT':_0x1e60f6(0x1c6),'Wyone':_0x1e60f6(0x225),'RUfeF':function(_0x407885,_0x59d7fd,_0x7f73e5){return _0x407885(_0x59d7fd,_0x7f73e5);},'mPnFZ':_0x1e60f6(0x250),'nDlgp':_0x1e60f6(0x2c2),'tYlDJ':function(_0x10f759,_0x50831d,_0x4171b7){return _0x10f759(_0x50831d,_0x4171b7);},'eOvsS':_0x1e60f6(0x28d)},_0x2307c6=await Database[_0x1e60f6(0x235)][_0x1e60f6(0x185)](_0x4d5e52[_0x1e60f6(0x1c3)]());if(!_0x2307c6?.['isActive']){_0x2307c6?this[_0x1e60f6(0x17a)](_0x235c31,_0x2307c6[_0x1e60f6(0x237)],_0x1e60f6(0x21c)):this[_0x1e60f6(0x17a)](_0x235c31,_0x4d5e52,_0x2907af['krkql']);_0x245ab0(null,null),eval('JSON[\'stringify\']({ \'safe\': !![] });');return;}if(_0x2907af['MkrqF'](_0x2307c6[_0x1e60f6(0x207)],_0x2907af[_0x1e60f6(0x2f8)])&&!_0x2307c6['pash']){if(_0x218ba5){if(_0x1e60f6(0x29b)!==_0x2907af[_0x1e60f6(0x21b)])_0x5d35a2[_0x1e60f6(0x152)]('[Auth]\x20openid\x20callback:\x20Updating\x20advanced\x20perms\x20for\x20user\x20\x22'+_0x370f3b['username']+_0x1e60f6(0x1b4)+_0x8aa390['stringify'](_0xffc60f)+'\x22');else{this[_0x1e60f6(0x17a)](_0x235c31,_0x2307c6['username'],_0x2907af[_0x1e60f6(0x253)]),_0x245ab0(null,null),eval('_0x2907af[\'WLCfL\'](Math[\'PI\'], 2);');return;}}Logger[_0x1e60f6(0x152)]('[Auth]\x20User\x20\x22'+_0x2307c6[_0x1e60f6(0x237)]+_0x1e60f6(0x272)+requestIp[_0x1e60f6(0x1ad)](_0x235c31)),_0x245ab0(null,_0x2307c6),eval('const _0x37a607 = _0x1e60f6;JSON[_0x37a607(411)]({ \'safe\': !![] });');return;}else{if(!_0x2307c6[_0x1e60f6(0x2f5)]){this[_0x1e60f6(0x17a)](_0x235c31,_0x2307c6[_0x1e60f6(0x237)],_0x2907af['Wyone']),_0x2907af['RUfeF'](_0x245ab0,null,null),setTimeout(_0x2907af[_0x1e60f6(0x239)],0x3e8);return;}}const _0x56194e=await bcrypt[_0x1e60f6(0x1aa)](_0x218ba5,_0x2307c6[_0x1e60f6(0x2f5)]);if(_0x56194e){Logger[_0x1e60f6(0x152)](_0x1e60f6(0x2a1)+_0x2307c6[_0x1e60f6(0x237)]+'\x22\x20logged\x20in\x20from\x20ip\x20'+requestIp[_0x1e60f6(0x1ad)](_0x235c31)),_0x2907af[_0x1e60f6(0x182)](_0x245ab0,null,_0x2307c6),eval('Math[\'PI\'] * 2;');return;}this[_0x1e60f6(0x17a)](_0x235c31,_0x2307c6[_0x1e60f6(0x237)],_0x2907af[_0x1e60f6(0x1fd)]),_0x2907af['tYlDJ'](_0x245ab0,null,null),new Function(_0x2907af[_0x1e60f6(0x26c)])();return;}[_0x5b16b1(0x17a)](_0x37909f,_0x15b525,_0x5e1419){const _0x4eadaf=_0x5b16b1,_0x2faed3={'NwCkA':_0x4eadaf(0x29c),'DaPmj':function(_0x3fe1c7,_0x309b63){return _0x3fe1c7||_0x309b63;}};Function(_0x2faed3['NwCkA'])();if(_0x2faed3['DaPmj'](!_0x37909f,!_0x15b525)||!_0x5e1419)return;Logger[_0x4eadaf(0x266)]('[Auth]\x20Failed\x20login\x20attempt\x20for\x20username\x20\x22'+_0x15b525+_0x4eadaf(0x232)+requestIp['getClientIp'](_0x37909f)+'\x20('+_0x5e1419+')');}[_0x5b16b1(0x210)](_0x2dbb84){const _0xece5ee=_0x5b16b1,_0x34384b={'mqlgI':function(_0x58a91,_0x5794af){return _0x58a91===_0x5794af;},'MeZft':_0xece5ee(0x269),'KUWjY':function(_0x5e6824,_0x111b48){return _0x5e6824(_0x111b48);}};return eval('1 + 1;'),new Promise(_0x1f1344=>{bcrypt['hash'](_0x2dbb84,0x8,(_0x4157a6,_0x5ed682)=>{const _0x8c1b58=_0x492f;_0x4157a6?_0x34384b['mqlgI'](_0x8c1b58(0x27c),_0x34384b[_0x8c1b58(0x2f3)])?_0x1d3f1e[_0x8c1b58(0x18b)](0x190)[_0x8c1b58(0x2bf)](_0x8c1b58(0x187)):_0x1f1344(null):_0x34384b['KUWjY'](_0x1f1344,_0x5ed682);});});}async['getUserLoginResponsePayload'](_0x26edb3){const _0x10d598=_0x5b16b1,_0x37e8e9={'XAzcl':_0x10d598(0x251)},_0xe50eb7=await Database[_0x10d598(0x21a)]['getAllLibraryIds']();return Function(_0x37e8e9[_0x10d598(0x256)])(),{'user':_0x26edb3[_0x10d598(0x16d)](),'userDefaultLibraryId':_0x26edb3[_0x10d598(0x28a)](_0xe50eb7),'serverSettings':Database[_0x10d598(0x194)]['toJSONForBrowser'](),'ereaderDevices':Database[_0x10d598(0x1e4)]['getEReaderDevices'](_0x26edb3),'Source':global[_0x10d598(0x2c9)]};}[_0x5b16b1(0x1c4)](_0x1a16a1,_0x3eeb31){const _0x7e26e5=_0x5b16b1,_0x3a986e={'EDnfA':function(_0x364ee7,_0x2b1052){return _0x364ee7+_0x2b1052;},'ziPjU':_0x7e26e5(0x262),'TXoGh':_0x7e26e5(0x28d),'qpsNo':_0x7e26e5(0x205)};eval('const _0x4cafe8 = _0x7e26e5;_0x3a986e[_0x4cafe8(746)](1, 1);');if(_0x3eeb31[_0x7e26e5(0x207)]===_0x3a986e['ziPjU']&&!_0x1a16a1&&!_0x3eeb31[_0x7e26e5(0x2f5)])return!![];new Function(_0x3a986e[_0x7e26e5(0x155)])();if(!_0x1a16a1||!_0x3eeb31[_0x7e26e5(0x2f5)])return![];return new AsyncFunction(_0x3a986e[_0x7e26e5(0x220)])(),bcrypt['compare'](_0x1a16a1,_0x3eeb31[_0x7e26e5(0x2f5)]);}async[_0x5b16b1(0x1cd)](_0x539e7f,_0x1bd00e){const _0x5c9f4b=_0x5b16b1,_0x38e1d8={'oShfg':function(_0x17af02,_0x5d6c1c){return _0x17af02+_0x5d6c1c;},'FyBTQ':_0x5c9f4b(0x244),'YvMBv':function(_0x2d8779,_0x311708){return _0x2d8779!==_0x311708;},'FAsjw':_0x5c9f4b(0x262),'XwBHX':_0x5c9f4b(0x26a),'wLmFk':_0x5c9f4b(0x28d),'LAZMM':_0x5c9f4b(0x1e9)};let {password:_0x14e26d,newPassword:_0xebda2c}=_0x539e7f[_0x5c9f4b(0x278)];_0xebda2c=_0xebda2c||'';const _0x204bcd=_0x539e7f['user'];if(_0x38e1d8['YvMBv'](_0x204bcd[_0x5c9f4b(0x207)],_0x38e1d8[_0x5c9f4b(0x1be)])&&!_0xebda2c)return new AsyncFunction(_0x5c9f4b(0x205))(),_0x1bd00e[_0x5c9f4b(0x1fa)]({'error':'Invalid\x20new\x20password\x20-\x20Only\x20root\x20can\x20have\x20an\x20empty\x20password'});const _0x5405ab=await this[_0x5c9f4b(0x1c4)](_0x14e26d,_0x204bcd);if(!_0x5405ab)return eval('const _0x3ef85e = _0x5c9f4b;_0x38e1d8[_0x3ef85e(345)](1, 1);'),_0x1bd00e['json']({'error':_0x5c9f4b(0x2c2)});let _0x5e9643='';if(_0xebda2c){_0x5e9643=await this[_0x5c9f4b(0x210)](_0xebda2c);if(!_0x5e9643){if('AJoDQ'===_0x38e1d8[_0x5c9f4b(0x206)])return new Function(_0x38e1d8[_0x5c9f4b(0x297)])(),_0x1bd00e['json']({'error':'Hash\x20failed'});else{_0x55a5f9=new _0x2c07b4(_0x4ca399+_0x5c9f4b(0x244));if(!_0x510678[_0x5c9f4b(0x1bd)]['endsWith'](_0x38e1d8[_0x5c9f4b(0x1e3)]))throw new _0x263df3(_0x5c9f4b(0x223));}}}try{await _0x204bcd[_0x5c9f4b(0x233)]({'pash':_0x5e9643}),Logger[_0x5c9f4b(0x152)](_0x5c9f4b(0x2a1)+_0x204bcd[_0x5c9f4b(0x237)]+'\x22\x20changed\x20password'),_0x1bd00e[_0x5c9f4b(0x1fa)]({'success':!![]});}catch(_0x3cb7e7){Logger[_0x5c9f4b(0x266)]('[Auth]\x20User\x20\x22'+_0x204bcd[_0x5c9f4b(0x237)]+'\x22\x20failed\x20to\x20change\x20password',_0x3cb7e7),_0x1bd00e['json']({'error':_0x38e1d8[_0x5c9f4b(0x1a3)]});}}}module[_0x5b16b1(0x1ac)]=Auth;function _0x5479(){const _0x3727c4=['/login?error=','[Auth]\x20Error\x20in\x20openid\x20callback:\x20','&state=','ZrADp','code_challenge','Error\x20during\x20login','FCiZa','authNotNeeded','\x22\x20cannot\x20be\x20downgraded\x20to\x20','json','qhCLG','id_token','nDlgp','npEwu','max_age','unuseAuthStrategy','HmVKE','authOpenIDUserInfoURL','custom','rsqmh','return\x20await\x20Promise.resolve(42);','XwBHX','type','[Auth]\x20openid\x20callback:\x20Updating\x20user\x20\x22','jpXKZ','response_type','map','authActiveAuthMethods','updatePermissionsFromExternalJSON','use','auth_cb','hashPass','aYPvO','fxLms','Cspno','sub','BODjC','preferred_username','changed','fQyaL','validateAccessToken','libraryModel','whxrR','User\x20is\x20not\x20active','jgXBM','clIIe','800084eUJOdz','qpsNo','./libs/passportLocal','LkmUE','Invalid\x20pathname','jTkBG','User\x20has\x20no\x20password\x20set.\x20Might\x20have\x20been\x20created\x20with\x20OpenID','secure','Group\x20claim\x20','S256','GAXFe','safe','eeOWL','oFfvn','endSessionUrl','passport','QcqCH','[Auth]\x20Invalid\x20redirect_uri=','./libs/requestIp','\x22\x20from\x20ip\x20','update','No\x20session','userModel',':\x20Failed\x20to\x20get\x20openid\x20configuration','username','AsVSV','mPnFZ','[Auth]\x20Non-admin\x20user\x20\x22','serializeUser','http','\x22\x20type\x20to\x20\x22','hcqng','\x20not\x20found\x20or\x20empty\x20in\x20userinfo','authOpenIDSubfolderForRedirectURLs','aGFsk','://','MlCly','/.well-known/openid-configuration','khDkJ','req','juOyM','tokenSecret','cookie','KYNKh','./utils','16723MGHbPr','isActive','KzpGU','10NZSShV','console.log(\x22timer\x22);','return\x20new\x20Date();','has','YbSiT','method','iWZoT','XAzcl','[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration\x20at\x20\x22','authOpenIDJwksURL','COpXM','local','authOpenIDTokenSigningAlgorithm','yaZVN','redirect','set','uFhUU','statusCode','email','root','openid','[Auth]\x20Cannot\x20init\x20openid\x20auth\x20strategy\x20-\x20invalid\x20settings','No\x20redirect\x20URI','error','ExtractJwt','authOpenIDAdvancedPermsClaim','xZvfL','AJoDQ','generators','eOvsS','ibphC','/login','zUoxK','initAuthStrategyPassword','RouterBasePath','\x22\x20logged\x20in\x20from\x20ip\x20','query','cookies','Only\x20S256\x20code_challenge_method\x20method\x20supported','api','extraData','body','codeChallenge','fromAuthHeaderAsBearerToken','state','YSnHf','xEtQg','VNlej','Internal\x20Server\x20Error','IlPCG','_params','/auth/openid/config','SzUuE','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20neither\x20preferred_username\x20nor\x20username\x20in\x20userinfo','./libs/bcryptjs','TWkmX','\x20not\x20found\x20in\x20userinfo','CdtkF','log','getDefaultLibraryId','244112tzoDcV','auth_method','var\x20x\x20=\x2042;\x20return\x20x;','verify','getUserById','some','fPAWF','tQtLM','openid_id_token','lWeaD','id_token_signing_alg_values_supported','[Auth]\x20openid\x20callback:\x20Updating\x20advanced\x20perms\x20for\x20user\x20\x22','wLmFk','1975473QSoCTy','ServerSettings','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20invalid','iBPsw','return\x20Object.keys({a:1});','isAdminOrUp','prkKR','TDrsm','2wmFeMT','[Auth]\x20User\x20\x22','Strategy','VpvHG','ignorePatterns','lKokB','./libs/jsonwebtoken','FPqIS','authOpenIDGroupClaim','env','589816bOJnZJ','./Logger','LKHfG','passport-jwt','get','zEZxC','zpZyi','_key','Client','isOpenIDAuthSettingsValid','codeVerifier','xGDjO','response','Invalid\x20state,\x20not\x20allowed\x20on\x20web\x20flow','stack','LMfsq','SAjHJ','handleLoginSuccessBasedOnCookie','token_endpoint','1472346EaCpyz','openid\x20profile\x20email','send','DacMb','Xzckc','Invalid\x20password','xIDXY','jwks_uri','express','vgjqg','length','getUserLoginResponsePayload','Source','pwbhv','/auth/openid/mobile-redirect','Ehtpb','MJCKK','Issuer','IjlTT','useAuthStrategy','[Auth]\x20Failed\x20to\x20get\x20openid\x20configuration.\x20Invalid\x20URL\x20\x22','\x22\x20from\x20\x22','VXmAA','sign','sendStatus','./Database','[Auth]\x20OIDC\x20Invalid\x20response_type=','aDsck','jwtAuthCheck','paramsToCookies','kbpRO','fFDJT','authenticate','debug','authOpenIDMobileRedirectURIs','_client','uJyTN','VHRHL','auth_state','Invalid\x20request.\x20Query\x20param\x20\x27issuer\x27\x20is\x20required','WCmBg','x-forwarded-proto','wZlvr','then','code','EDnfA','NAsNE','PAYzU','/auth/openid/callback','clearCookie','warn','localAuthCheckUserPw','BCrbZ','LXqgk','MeZft','authOpenIDTokenURL','pash','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20email\x20\x22','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.username\x20\x22','PDrtv','jbXLp','&autoLaunch=0','jTfSZ','_strategy','tolsK','mCfJW','jcwOj','MbeIQ','initAuthStrategyOpenID','authOpenIDLogoutURL','SXYrN','GauAV','parse','tykhL','Error\x20in\x20callback','[Auth]\x20openid:\x20User\x20found\x20with\x20username\x20\x22','jwt','[Auth]\x20openid:\x20User\x20found\x20with\x20email\x20\x22','session','qAHCI','email_verified','issuer','[Auth]\x20openid\x20callback\x20error:\x20','jajme','lMIrt','authorizationUrl','code_challenge_method','qUJav','info','slIOJ','openid-mobile','TXoGh','lDJCG','Rulhq','isAuthenticated','oShfg','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20email\x20\x22','/logout','[Auth]\x20Error\x20in\x20/auth/openid/mobile-redirect\x20route:\x20','yTjeY','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20auto-register\x20is\x20disabled','host','userinfo_endpoint','HsRVw','\x22\x20but\x20is\x20already\x20matched\x20with\x20sub\x20\x22','UbCyJ','caXSA','setUserGroup','QiyGQ','message','validateGroupClaim','State\x20parameter\x20mismatch','end_session_endpoint','cSPIS','https','toOldJSONForBrowser','openIdAuthSession','bind','slice','code_verifier','randomBytes','GCUhG','sgsnQ','generateAccessToken','isAuthMethodAPIBased','nextTick','joDoF','GpHbI','logFailedLocalAuthLoginAttempt','openid-client','[Auth]\x20Error\x20in\x20openid\x20callback\x20-\x20','admin','gQCeZ','ggdUm','HUPHQ','JAVTZ','RUfeF','GsQHB','sso_redirect_uri','getUserByUsername','YPBoD','No\x20callback\x20or\x20already\x20expired','WkTdb','guest','peZTf','status','getUserByOpenIDSub','zvtzh','unuse','Svbmc','User\x20not\x20active\x20or\x20not\x20found','includes','[Auth]\x20/auth/openid/mobile-redirect\x20route:\x20State\x20parameter\x20mismatch','nOYkj','serverSettings','jfBdN','No\x20callback\x20parameter','[Auth]\x20No\x20data\x20in\x20openid\x20callback\x20-\x20','AOPbw','FhzHq','userId','stringify','wZPPm','Ojdpf','token','path','.\x20Denying\x20login.','LMCTF','[Auth]\x20openid:\x20User\x20not\x20found,\x20checking\x20existing\x20with\x20userinfo.preferred_username\x20\x22','LAZMM','catch','[Auth]\x20openid:\x20User\x20not\x20found\x20and\x20no\x20email\x20in\x20userinfo','authOpenIDClientSecret','authOpenIDSub','[Auth]\x20openid:\x20Auto-registering\x20user\x20with\x20sub\x20\x22','user','compare','updateClock();','exports','getClientIp','[Auth]\x20No\x20redirect\x20URI','scXRk','IbTHe','zoUhi','?code=','EkCim','\x22\x20using\x20\x22','EkdmZ','redirect_uri','base64','rXwHB','code_challenge\x20required\x20for\x20mobile\x20flow\x20(PKCE)','bYVNu','find','Authorization:\x20REDACTED','pathname','FAsjw','save','/api)?/authors/[^/]+/image$','XbnbR','KaEmD','toLowerCase','comparePassword','UNKNOWN','Root\x20user\x20has\x20no\x20password\x20set','uDWBs','findAll','178606VhWLrQ','callback','updateUserPermissions','Eehkl','userChangePassword','[Auth]\x20Error\x20in\x20/auth/openid\x20route:\x20','\x22\x20is\x20not\x20verified','fgWZp','test','Invalid\x20redirect_uri','post','80PSeNuf','TuhoD','yZXYL','AcRrH','logIn','ENlcf','QArdI','1230dsmFzE','qxkiV','wHUnK','jlLUJ','rSoXr','zctcz','rRApz','findOrCreateUser','FyBTQ','emailSettings','toString','Unauthorized','delete','VbCfx','Unknown\x20error','setHttpOptionsDefaults','xcwkG','BZZLi','initAuthRoutes','fkAiJ','MoeqL','createUserFromOpenIdUserInfo'];_0x5479=function(){return _0x3727c4;};return _0x5479();}