'use strict';function _0x64a8(){const _0x13eaeb=['IxMgU','make_debugLog','securityMode','chalk','UKkzu','ncPJB','6003640pmFmrw','feed','BUyYm','GOhoN','PbVSz','HGLqw','it\x20should\x20not\x20emit\x20a\x20message\x20event\x20if\x20a\x20signature\x20is\x20invalid\x20or\x20missing','securityPolicy','6CuBejo','MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(MSG)\x20','1580103DFvqAR','../dist/test_helpers/fake_message_chunk_factory','should','wXvlg','NMgcX','DtCIV','from','node-opcua-crypto','readPrivateRsaKey','Sign','_decodeMessageBody','dQAAb','full_message_body','eshjM','pushNewToken','ObAIM','\x20we\x20are\x20not\x20expecting\x20a\x20error\x20event\x20in\x20this\x20case','2148lTQJMy','should\x20not\x20emit\x20an\x20error\x20event\x20if\x20chunks\x20have\x20valid\x20signature','node-opcua-test-helpers','SignAndEncrypt','message','AeVOD','zTNnq','write','EwgpC','this\x20chunk\x20has\x20a\x20altered\x20body\x20(\x20signature\x20verification\x20failed)','929485kLTVod','iterateOnSignedAndEncryptedMessageChunks','node-opcua-debug','741572BjXKCz','731247wrVCnQ','Basic128Rsa15','####***\x20TEMPERED\x20***#####','toString','LzWpS','FHORF','24HrzaAC','chunk','should\x20process\x20a\x20signed\x20and\x20encrypted\x20message','derivedKeys','KwLtJ','node-opcua-service-secure-channel','setSecurity','SzwDE','IgCOt','emit','eql','PEfUK','iterateOnSymmetricEncryptedChunk','certs/server_key_1024.pem','ZkiNj','error','JzzmH','TEST','MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(OPN)\x20','12509HjTYUE','UgtPc','iterateOnSignedMessageChunks','JfyKT','iEZBK','KjZlK','exist','WSZrl','not','should\x20emit\x20an\x20bad_signature\x20event\x20if\x20chunk\x20has\x20been\x20tempered','xudYn','654386XlEIge','privateKey','YnKtf','qOlLE','fNtNf','nlJAM','slice','yellow','MessageBuilder\x20with\x20SIGN\x20support','should\x20reconstruct\x20a\x20full\x20message\x20made\x20of\x20many\x20signed\x20chunks','cJPRb','ndFPv'];_0x64a8=function(){return _0x13eaeb;};return _0x64a8();}const _0xf9cd32=_0x4dfb;(function(_0x3d0be3,_0x2c77b9){const _0x38ed47=_0x4dfb,_0x2d243b=_0x3d0be3();while(!![]){try{const _0x32a80f=parseInt(_0x38ed47(0x1e0))/0x1+-parseInt(_0x38ed47(0x204))/0x2*(-parseInt(_0x38ed47(0x1bf))/0x3)+-parseInt(_0x38ed47(0x1df))/0x4+-parseInt(_0x38ed47(0x1dc))/0x5+parseInt(_0x38ed47(0x1d2))/0x6*(-parseInt(_0x38ed47(0x1f9))/0x7)+-parseInt(_0x38ed47(0x1e6))/0x8*(parseInt(_0x38ed47(0x1c1))/0x9)+parseInt(_0x38ed47(0x1b7))/0xa;if(_0x32a80f===_0x2c77b9)break;else _0x2d243b['push'](_0x2d243b['shift']());}catch(_0x2c96c1){_0x2d243b['push'](_0x2d243b['shift']());}}}(_0x64a8,0x6d704));const should=require('should'),chalk=require(_0xf9cd32(0x1b4)),debugLog=require(_0xf9cd32(0x1de))[_0xf9cd32(0x1b2)](_0xf9cd32(0x1f7)),{hexDump}=require('node-opcua-debug'),{MessageSecurityMode}=require(_0xf9cd32(0x1eb)),crypto_utils=require(_0xf9cd32(0x1c8)),{make_lorem_ipsum_buffer}=require(_0xf9cd32(0x1d4)),{getFixture}=require('node-opcua-test-fixtures'),fake_message_chunk_factory=require(_0xf9cd32(0x1c2)),{MessageBuilder,SecurityPolicy}=require('..'),private_key_filename=getFixture(_0xf9cd32(0x1f3));function _0x4dfb(_0x336f5c,_0x4abecd){const _0x64a867=_0x64a8();return _0x4dfb=function(_0x4dfb59,_0x1cf5c7){_0x4dfb59=_0x4dfb59-0x1aa;let _0x44c5f6=_0x64a867[_0x4dfb59];return _0x44c5f6;},_0x4dfb(_0x336f5c,_0x4abecd);}function fake_decodeMessageBody(_0x3522a8){const _0xbc200c=_0xf9cd32,_0x290795={'LzWpS':'var\x20x\x20=\x2042;\x20return\x20x;'};return this[_0xbc200c(0x1ef)](_0xbc200c(0x1d6),_0x3522a8),new Function(_0x290795[_0xbc200c(0x1e4)])(),!![];}describe(_0xf9cd32(0x1ad),function(){const _0x2a6210=_0xf9cd32,_0x5c4a82={'PbVSz':function(_0x38c252){return _0x38c252();},'EwgpC':_0x2a6210(0x1cd),'vQYJr':function(_0x3af6ff,_0x528b43){return _0x3af6ff(_0x528b43);},'SLGxs':function(_0x46e960,_0x25b527){return _0x46e960(_0x25b527);},'NMgcX':function(_0x38f463,_0x35d10c){return _0x38f463(_0x35d10c);},'xudYn':function(_0x459794){return _0x459794();},'nlJAM':function(_0x1007c2,_0x47642b){return _0x1007c2+_0x47642b;},'fNtNf':_0x2a6210(0x1e7),'KwLtJ':_0x2a6210(0x1d6),'IgCOt':_0x2a6210(0x1f5),'iEZBK':_0x2a6210(0x1bd),'IxMgU':function(_0x560bb9,_0x2ac169){return _0x560bb9(_0x2ac169);},'ncPJB':function(_0x35c44a,_0x726dcc){return _0x35c44a(_0x726dcc);},'ZkiNj':function(_0x28fd88,_0x5e0888){return _0x28fd88(_0x5e0888);},'wXvlg':_0x2a6210(0x1e2),'FHORF':function(_0xd0be8,_0x59074a,_0x2f7a0){return _0xd0be8(_0x59074a,_0x2f7a0);},'JzzmH':_0x2a6210(0x1d3)},_0x46c9d0=_0x5c4a82[_0x2a6210(0x203)](make_lorem_ipsum_buffer),_0x2f7d83=Buffer[_0x2a6210(0x1c7)](_0x46c9d0,_0x46c9d0['length']);_0x5c4a82['FHORF'](it,_0x5c4a82[_0x2a6210(0x1f6)],function(_0x2990a5){const _0x3abe52=_0x2a6210,_0x3f3bb7={'eshjM':function(_0x1fa11c){const _0x1dfec1=_0x4dfb;return _0x5c4a82[_0x1dfec1(0x1bb)](_0x1fa11c);},'wkplN':function(_0x223af4,_0x1c2c52){return _0x223af4(_0x1c2c52);}},_0x3c050c={},_0x3eb372=new MessageBuilder(_0x3c050c);_0x3eb372['privateKey']=crypto_utils[_0x3abe52(0x1c9)](private_key_filename),_0x3eb372[_0x3abe52(0x1cb)]=fake_decodeMessageBody,_0x3eb372['on'](_0x5c4a82[_0x3abe52(0x1da)],_0x4cee21=>{const _0x1db998=_0x3abe52;_0x3f3bb7[_0x1db998(0x1ce)](_0x2990a5);})['on'](_0x3abe52(0x1d6),_0x284c69=>{})['on'](_0x3abe52(0x1f5),_0x3345ae=>{_0x3f3bb7['wkplN'](_0x2990a5,_0x3345ae);}),fake_message_chunk_factory[_0x3abe52(0x1fb)](_0x2f7d83,function(_0x3ae5e6,_0x4fd43a){const _0x17e668=_0x3abe52;should[_0x17e668(0x201)][_0x17e668(0x1ff)](_0x3ae5e6),_0x3eb372[_0x17e668(0x1b8)](_0x4fd43a['slice'](0x0,0x14)),_0x3eb372[_0x17e668(0x1b8)](_0x4fd43a[_0x17e668(0x1ab)](0x14));});}),_0x5c4a82['FHORF'](it,_0x2a6210(0x1ae),function(_0x506115){const _0x458324=_0x2a6210,_0x1bb63e={'zTNnq':function(_0x2b5ffd,_0x4d3bab){const _0x9f40b4=_0x4dfb;return _0x5c4a82[_0x9f40b4(0x1aa)](_0x2b5ffd,_0x4d3bab);}},_0x33fb31={},_0xef149b=new MessageBuilder(_0x33fb31);_0xef149b[_0x458324(0x1ec)](MessageSecurityMode[_0x458324(0x1ca)],SecurityPolicy[_0x458324(0x1e1)]),_0xef149b[_0x458324(0x1cb)]=fake_decodeMessageBody,_0xef149b['on'](_0x5c4a82[_0x458324(0x1da)],_0x5382a3=>{const _0x5bbd76=_0x458324;_0x5c4a82['vQYJr'](debugLog,_0x5382a3[_0x5bbd76(0x1e3)]()),_0x5382a3[_0x5bbd76(0x1e3)]()[_0x5bbd76(0x1c3)][_0x5bbd76(0x1f0)](_0x2f7d83[_0x5bbd76(0x1e3)]());})['on'](_0x5c4a82[_0x458324(0x208)],_0x42af9d=>{_0x5c4a82['SLGxs'](debugLog,hexDump(_0x42af9d));})['on'](_0x5c4a82[_0x458324(0x1ea)],_0x5b6fba=>{const _0x4474e4=_0x458324;debugLog(_0x5c4a82[_0x4474e4(0x1c5)](hexDump,_0x5b6fba)),_0x5c4a82[_0x4474e4(0x203)](_0x506115);})['on'](_0x5c4a82[_0x458324(0x1ee)],_0x42c30b=>{const _0x17fce2=_0x458324;_0x506115(new Error(_0x1bb63e[_0x17fce2(0x1d8)](_0x17fce2(0x1d1),_0x42c30b)));}),fake_message_chunk_factory[_0x458324(0x1fb)](_0x2f7d83,function(_0x77b8c7,_0x2459dc){const _0x1c6c2e=_0x458324;should['not'][_0x1c6c2e(0x1ff)](_0x77b8c7),_0xef149b[_0x1c6c2e(0x1b8)](_0x2459dc['slice'](0x0,0x14)),_0xef149b['feed'](_0x2459dc[_0x1c6c2e(0x1ab)](0x14));});}),_0x5c4a82[_0x2a6210(0x1e5)](it,_0x2a6210(0x202),function(_0x2d6513){const _0x248dd3=_0x2a6210,_0x4730e6={'DtCIV':_0x5c4a82[_0x248dd3(0x1c4)]},_0x1550fb={},_0x297de2=new MessageBuilder(_0x1550fb);_0x297de2[_0x248dd3(0x1cb)]=fake_decodeMessageBody,_0x297de2['on'](_0x5c4a82['EwgpC'],_0x7a8fad=>{const _0x36a4e1=_0x248dd3;_0x5c4a82['NMgcX'](_0x2d6513,new Error(_0x5c4a82[_0x36a4e1(0x1fd)]));})['on'](_0x248dd3(0x1d6),_0x164a9a=>{const _0x3d2906=_0x248dd3;_0x5c4a82[_0x3d2906(0x1b1)](_0x2d6513,new Error(_0x3d2906(0x1bd)));})['on'](_0x5c4a82[_0x248dd3(0x1ee)],_0x29ef37=>{const _0x104b92=_0x248dd3;_0x5c4a82[_0x104b92(0x1b6)](debugLog,_0x29ef37),_0x5c4a82[_0x104b92(0x1f4)](debugLog,chalk[_0x104b92(0x1ac)](_0x104b92(0x1db))),_0x2d6513();}),fake_message_chunk_factory['iterateOnSignedMessageChunks'](_0x2f7d83,function(_0x58ca16,_0x5449e7){const _0x5cc85a=_0x248dd3;should['not'][_0x5cc85a(0x1ff)](_0x58ca16),_0x5449e7[_0x5cc85a(0x1d9)](_0x4730e6[_0x5cc85a(0x1c6)],0x3a0),_0x297de2[_0x5cc85a(0x1b8)](_0x5449e7[_0x5cc85a(0x1ab)](0x0,0x14)),_0x297de2[_0x5cc85a(0x1b8)](_0x5449e7['slice'](0x14));});});}),describe(_0xf9cd32(0x1f8),function(){const _0x37eb14=_0xf9cd32,_0x4847c6={'TJEmf':function(_0x454bf1,_0x379c33){return _0x454bf1(_0x379c33);},'qOlLE':function(_0x470694,_0x3d8fc1){return _0x470694(_0x3d8fc1);},'GOhoN':_0x37eb14(0x1db),'UKkzu':function(_0x260f33){return _0x260f33();},'DXXGH':function(_0x4b0994,_0xcdd323){return _0x4b0994(_0xcdd323);},'AeVOD':_0x37eb14(0x200),'UgtPc':'full_message_body','AjGHN':_0x37eb14(0x1d6),'ObAIM':_0x37eb14(0x1f5),'YnKtf':'should\x20not\x20emit\x20an\x20error\x20event\x20with\x20valid\x20SIGN\x20&\x20ENCRYPT\x20chunks'},_0x53d910=make_lorem_ipsum_buffer();it(_0x4847c6[_0x37eb14(0x206)],function(_0x4b76d9){const _0x1bc21d=_0x37eb14,_0x117445={'JfyKT':function(_0x2b358a){return _0x4847c6['UKkzu'](_0x2b358a);},'cJPRb':function(_0x59f75e,_0x2eaf3f){const _0x31e099=_0x4dfb;return _0x4847c6[_0x31e099(0x207)](_0x59f75e,_0x2eaf3f);},'HGLqw':function(_0x1335f7,_0x381669){return _0x4847c6['qOlLE'](_0x1335f7,_0x381669);}};if(_0x4847c6[_0x1bc21d(0x1d7)]!==_0x4847c6[_0x1bc21d(0x1d7)])_0x4847c6['TJEmf'](_0x360396,_0x5c2192),_0x4847c6[_0x1bc21d(0x207)](_0x4f661a,_0x542310[_0x1bc21d(0x1ac)](_0x4847c6[_0x1bc21d(0x1ba)])),_0x4847c6[_0x1bc21d(0x1b5)](_0x111626);else{const _0xe04926={},_0x28086f=new MessageBuilder(_0xe04926);_0x28086f[_0x1bc21d(0x205)]=crypto_utils[_0x1bc21d(0x1c9)](private_key_filename),_0x28086f[_0x1bc21d(0x1cb)]=fake_decodeMessageBody,_0x28086f['on'](_0x4847c6[_0x1bc21d(0x1fa)],_0x41f124=>{const _0x10bfe1=_0x1bc21d;_0x41f124['toString']()[_0x10bfe1(0x1c3)]['eql'](_0x53d910['toString']()),_0x117445[_0x10bfe1(0x1fc)](_0x4b76d9);})['on'](_0x4847c6['AjGHN'],_0x270377=>{})['on'](_0x4847c6[_0x1bc21d(0x1d0)],_0x3da37e=>{_0x4847c6['DXXGH'](_0x4b76d9,_0x3da37e);}),fake_message_chunk_factory[_0x1bc21d(0x1dd)](_0x53d910,function(_0x4f14ad,_0x590095){const _0x585503=_0x1bc21d;_0x585503(0x1cc)!==_0x585503(0x1ed)?(should[_0x585503(0x201)]['exist'](_0x4f14ad),_0x28086f['feed'](_0x590095[_0x585503(0x1ab)](0x0,0x14)),_0x28086f[_0x585503(0x1b8)](_0x590095[_0x585503(0x1ab)](0x14))):(_0x117445[_0x585503(0x1af)](_0x24030,_0x117445[_0x585503(0x1bc)](_0x42c5ab,_0x1e6e47)),_0x21ef6e());});}});}),describe(_0xf9cd32(0x1c0),function(){const _0x39f4b7=_0xf9cd32,_0x4d30ab={'PEfUK':function(_0x2fac75,_0x22c089){return _0x2fac75(_0x22c089);},'ndFPv':_0x39f4b7(0x1d6),'iLQjD':_0x39f4b7(0x1f5),'BUyYm':function(_0x5ba012){return _0x5ba012();},'KjZlK':function(_0x731c6d,_0x68e538,_0x2bbd46){return _0x731c6d(_0x68e538,_0x2bbd46);}},_0xbed06d=_0x4d30ab[_0x39f4b7(0x1b9)](make_lorem_ipsum_buffer);_0x4d30ab[_0x39f4b7(0x1fe)](it,_0x39f4b7(0x1e8),function(_0x3f1540){const _0x5afa94=_0x39f4b7,_0x2a31b0={},_0x53d09c=new MessageBuilder(_0x2a31b0);_0x53d09c[_0x5afa94(0x1cb)]=fake_decodeMessageBody,_0x53d09c[_0x5afa94(0x1be)]=SecurityPolicy[_0x5afa94(0x1e1)],_0x53d09c[_0x5afa94(0x205)]=crypto_utils['readPrivateRsaKey'](private_key_filename),_0x53d09c[_0x5afa94(0x1b3)]=MessageSecurityMode[_0x5afa94(0x1d5)],_0x53d09c[_0x5afa94(0x1cf)]({'tokenId':0xa},fake_message_chunk_factory[_0x5afa94(0x1e9)]),_0x53d09c['on']('full_message_body',_0x15190f=>{const _0x369e6c=_0x5afa94;_0x15190f[_0x369e6c(0x1e3)]()['should'][_0x369e6c(0x1f0)](_0xbed06d[_0x369e6c(0x1e3)]()),_0x3f1540();})['on'](_0x4d30ab[_0x5afa94(0x1b0)],_0x4578c6=>{})['on'](_0x4d30ab['iLQjD'],_0x4f9cab=>{const _0x45a564=_0x5afa94;_0x4d30ab[_0x45a564(0x1f1)](_0x3f1540,_0x4f9cab);}),fake_message_chunk_factory[_0x5afa94(0x1f2)](_0xbed06d,function(_0x2772be,_0x419344){const _0xad4d8=_0x5afa94;should[_0xad4d8(0x201)]['exist'](_0x2772be),_0x53d09c[_0xad4d8(0x1b8)](_0x419344);});});});