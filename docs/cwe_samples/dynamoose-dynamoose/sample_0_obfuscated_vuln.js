const _0x1fb36d=_0x5c8f;(function(_0x45e105,_0x2dfe60){const _0x21ccad=_0x5c8f,_0x26979e=_0x45e105();while(!![]){try{const _0x43c4ef=parseInt(_0x21ccad(0x200))/0x1+-parseInt(_0x21ccad(0x1ec))/0x2*(-parseInt(_0x21ccad(0x1e8))/0x3)+-parseInt(_0x21ccad(0x1f4))/0x4+parseInt(_0x21ccad(0x1ea))/0x5+parseInt(_0x21ccad(0x209))/0x6*(parseInt(_0x21ccad(0x203))/0x7)+parseInt(_0x21ccad(0x1dc))/0x8*(parseInt(_0x21ccad(0x21a))/0x9)+-parseInt(_0x21ccad(0x217))/0xa;if(_0x43c4ef===_0x2dfe60)break;else _0x26979e['push'](_0x26979e['shift']());}catch(_0x95c23f){_0x26979e['push'](_0x26979e['shift']());}}}(_0x2dd2,0xa6538));import{tmpdir}from'os';import{dirname,join,resolve,sep}from'path';import{realpathSync}from'fs';import{emptyDir,ensureDir,readFile,remove,writeFile}from'fs-extra';import{performance}from'perf_hooks';import _0x5e4ef6 from'jszip';import _0x3e6e05 from'./handler-runner/index.js';import _0x3f2243 from'./LambdaContext.js';import _0x319c65 from'../serverlessLog.js';import _0x2fb869 from'../utils/resolveJoins.js';import{DEFAULT_LAMBDA_MEMORY_SIZE,DEFAULT_LAMBDA_RUNTIME,DEFAULT_LAMBDA_TIMEOUT,supportedRuntimes}from'../config/index.js';import{createUniqueId,splitHandlerPathAndName}from'../utils/index.js';function _0x5c8f(_0xa36d2e,_0x21b055){const _0x2dd2a5=_0x2dd2();return _0x5c8f=function(_0x5c8f14,_0x4c3ba4){_0x5c8f14=_0x5c8f14-0x1db;let _0x3fed08=_0x2dd2a5[_0x5c8f14];return _0x3fed08;},_0x5c8f(_0xa36d2e,_0x21b055);}const {keys}=Object,{ceil}=Math;function _0x2dd2(){const _0x1ae7dc=['region','setRequestId','endsWith','3558693hCFkLV','cleanup','80270TYEulZ','unixPermissions','2tKDoYW','2016/12/02/[$LATEST]f77ff5e4026c45bda9a9ebcec6bc9cad','location','_startIdleTimer','package','Warning:\x20found\x20unsupported\x20runtime\x20\x27','environment','functionName','4292032gxplai','setEvent','/var/runtime:/var/task:/var/runtime/node_modules','_getAwsEnvVars','runtime','services','oRKJW','setClientContext','IDLE','_initialize','has','\x27\x20for\x20function\x20\x27','150766ozfmBy','\x20ms\x20\x20Billed\x20Duration:\x20','/aws/lambda/','2104529LSLjTh','isDockerRunner','all','service','_getEnv','ielyg','24rcRaBm','nZwgG','artifact','XFqfQ','layers','hKtIo',')\x20RequestId:\x20','/var/runtime','_extractArtifact','BUSY','_billedExecutionTimeInMillis','files','create','memorySize','20534630kgSxql','status','loadAsync','939078rqnJIi','toFixed','/var/task','log','en_US.UTF-8','_verifySupportedRuntime','timeout','_startExecutionTimer','rEqNr','vaVhD','_stopExecutionTimer','runHandler','tEtAg','96ZTvArw','_executionTimeInMillis','\x20ms','now','rOMOL','/usr/local/lib64/node-v4.3.x/lib:/lib64:/usr/lib64:/var/runtime:/var/runtime/lib:/var/task:/var/task/lib:/opt/lib','code','RNAhb','nodebuffer'];_0x2dd2=function(){return _0x1ae7dc;};return _0x2dd2();}export default class LambdaFunction{#artifact=null;#clientContext=null;#codeDir=null;#event=null;#executionTimeEnded=null;#executionTimeStarted=null;#functionKey=null;#functionName=null;#handlerRunner=null;#idleTimeStarted=null;#initialized=![];#lambdaContext=null;#lambdaDir=null;#memorySize=null;#region=null;#runtime=null;#timeout=null;[_0x1fb36d(0x218)]=_0x1fb36d(0x1fc);constructor(_0x3398ff,_0x3a89f2,_0x32eb57,_0x5a8905){const _0x1b9141=_0x1fb36d,_0x57ec54={'HVQHk':function(_0x21cfab,_0x390679){return _0x21cfab(_0x390679);},'UITNN':function(_0x3eed5b,_0x30747d,_0x3bb3cf,_0x335ac1,_0x55da20,_0x3902bd,_0x3dccea){return _0x3eed5b(_0x30747d,_0x3bb3cf,_0x335ac1,_0x55da20,_0x3902bd,_0x3dccea);},'VRUmJ':function(_0x199d1c){return _0x199d1c();},'ielyg':'serverless-offline','oRKJW':_0x1b9141(0x1f9),'RNAhb':function(_0x15b63b){return _0x15b63b();},'hKtIo':function(_0x473f1b,_0x4603f3,_0x3864ec){return _0x473f1b(_0x4603f3,_0x3864ec);}},{service:_0xcabcb7,config:{serverlessPath:_0x1a2bf4,servicePath:_0x2881f1},service:{provider:_0x2cdaed,package:_0x302340={}}}=_0x32eb57,_0x4fd15e=resolve(_0x2881f1,_0x5a8905[_0x1b9141(0x1ee)]||''),{handler:_0x3dfa99,name:_0x439116,package:_0x3e74bf={}}=_0x3a89f2,[_0x54125e,_0xf9853c]=_0x57ec54['HVQHk'](splitHandlerPathAndName,_0x3dfa99),_0x34a4bd=_0x3a89f2[_0x1b9141(0x216)]||_0x2cdaed[_0x1b9141(0x216)]||DEFAULT_LAMBDA_MEMORY_SIZE,_0x5e55cc=_0x3a89f2[_0x1b9141(0x1f8)]||_0x2cdaed[_0x1b9141(0x1f8)]||DEFAULT_LAMBDA_RUNTIME,_0x7121ed=(_0x3a89f2['timeout']||_0x2cdaed[_0x1b9141(0x220)]||DEFAULT_LAMBDA_TIMEOUT)*0x3e8;this.#functionKey=_0x3398ff,this.#functionName=_0x439116,this.#memorySize=_0x34a4bd,this.#region=_0x2cdaed[_0x1b9141(0x1e5)],this.#runtime=_0x5e55cc,this.#timeout=_0x7121ed,this[_0x1b9141(0x21f)]();const _0x574b77=this[_0x1b9141(0x207)](_0x57ec54['HVQHk'](_0x2fb869,_0x2cdaed[_0x1b9141(0x1f2)]),_0x3a89f2[_0x1b9141(0x1f2)],_0x3dfa99);this.#artifact=_0x3a89f2['package']?.['artifact'];!this.#artifact&&(this.#artifact=_0xcabcb7[_0x1b9141(0x1f0)]?.[_0x1b9141(0x20b)]);this.#artifact&&(this.#lambdaDir=_0x57ec54['UITNN'](join,realpathSync(_0x57ec54['VRUmJ'](tmpdir)),_0x57ec54[_0x1b9141(0x208)],_0x57ec54[_0x1b9141(0x1fa)],_0xcabcb7[_0x1b9141(0x206)],_0x3398ff,_0x57ec54[_0x1b9141(0x1e3)](createUniqueId)));this.#codeDir=this.#lambdaDir?resolve(this.#lambdaDir,_0x1b9141(0x1e2)):_0x4fd15e;const _0x1cf6bf={'functionKey':_0x3398ff,'handler':_0x3dfa99,'handlerName':_0xf9853c,'codeDir':this.#codeDir,'handlerPath':resolve(this.#codeDir,_0x54125e),'runtime':_0x5e55cc,'serverlessPath':_0x1a2bf4,'servicePath':_0x4fd15e,'timeout':_0x7121ed,'layers':_0x3a89f2[_0x1b9141(0x20d)]||[],'provider':_0x2cdaed,'functionName':_0x439116,'servicePackage':_0x302340[_0x1b9141(0x20b)]?resolve(_0x4fd15e,_0x302340[_0x1b9141(0x20b)]):undefined,'functionPackage':_0x3e74bf['artifact']?_0x57ec54[_0x1b9141(0x20e)](resolve,_0x4fd15e,_0x3e74bf['artifact']):undefined};this.#handlerRunner=new _0x3e6e05(_0x1cf6bf,_0x5a8905,_0x574b77),this.#lambdaContext=new _0x3f2243(_0x439116,_0x34a4bd);}[_0x1fb36d(0x221)](){const _0x2b3dd7=_0x1fb36d;this.#executionTimeStarted=performance[_0x2b3dd7(0x1df)]();}[_0x1fb36d(0x224)](){this.#executionTimeEnded=performance['now']();}[_0x1fb36d(0x1ef)](){this.#idleTimeStarted=performance['now']();}[_0x1fb36d(0x21f)](){const _0x4ac440=_0x1fb36d;!supportedRuntimes[_0x4ac440(0x1fe)](this.#runtime)&&(console[_0x4ac440(0x21d)](''),_0x319c65(_0x4ac440(0x1f1)+this.#runtime+_0x4ac440(0x1ff)+this.#functionKey+'\x27'));}[_0x1fb36d(0x1f7)](){const _0x19040f=_0x1fb36d,_0x1ee034={'AOdtF':_0x19040f(0x210),'tEtAg':_0x19040f(0x1e1)};return{'AWS_DEFAULT_REGION':this.#region,'AWS_LAMBDA_FUNCTION_MEMORY_SIZE':this.#memorySize,'AWS_LAMBDA_FUNCTION_NAME':this.#functionName,'AWS_LAMBDA_FUNCTION_VERSION':'$LATEST','AWS_LAMBDA_LOG_GROUP_NAME':_0x19040f(0x202)+this.#functionName,'AWS_LAMBDA_LOG_STREAM_NAME':_0x19040f(0x1ed),'AWS_REGION':this.#region,'LAMBDA_RUNTIME_DIR':_0x1ee034['AOdtF'],'LAMBDA_TASK_ROOT':_0x19040f(0x21c),'LANG':_0x19040f(0x21e),'LD_LIBRARY_PATH':_0x1ee034[_0x19040f(0x1db)],'NODE_PATH':_0x19040f(0x1f6)};}[_0x1fb36d(0x207)](_0x388669,_0x3aaac1,_0x274b40){return{...this['_getAwsEnvVars'](),..._0x388669,..._0x3aaac1,'_HANDLER':_0x274b40,'IS_OFFLINE':!![]};}[_0x1fb36d(0x1fb)](_0x11feb6){this.#clientContext=_0x11feb6;}[_0x1fb36d(0x1f5)](_0x1fdd7e){this.#event=_0x1fdd7e;}async[_0x1fb36d(0x1e9)](){const _0x3b16ce=_0x1fb36d,_0x3c9eda={'vaVhD':function(_0xff2630,_0xb0e943){return _0xff2630(_0xb0e943);}};await this.#handlerRunner['cleanup'](),this.#lambdaDir&&await _0x3c9eda[_0x3b16ce(0x223)](remove,this.#lambdaDir);}[_0x1fb36d(0x1dd)](){const _0x1383ce={'RLccL':function(_0x5c2b42,_0x11665f){return _0x5c2b42-_0x11665f;}};return _0x1383ce['RLccL'](this.#executionTimeEnded,this.#executionTimeStarted);}[_0x1fb36d(0x213)](){return ceil((this.#executionTimeEnded-this.#executionTimeStarted)/0x64)*0x64;}async[_0x1fb36d(0x211)](){const _0x3ead44=_0x1fb36d,_0x54bbd6={'nZwgG':_0x3ead44(0x1e4),'rOMOL':function(_0x3598b0,_0x5918aa){return _0x3598b0(_0x5918aa);},'LAyJo':function(_0xd8b9a4,_0x2a27e7){return _0xd8b9a4(_0x2a27e7);}};if(!this.#artifact)return null;_0x54bbd6['rOMOL'](emptyDir,this.#codeDir);const _0x2474b8=await readFile(this.#artifact),_0x1c1603=await _0x5e4ef6[_0x3ead44(0x219)](_0x2474b8);return Promise[_0x3ead44(0x205)](_0x54bbd6['LAyJo'](keys,_0x1c1603[_0x3ead44(0x214)])['map'](async _0x1fbb0b=>{const _0x2841c6=_0x3ead44,_0xfb0007=await _0x1c1603['files'][_0x1fbb0b]['async'](_0x54bbd6[_0x2841c6(0x20a)]);if(_0x1fbb0b[_0x2841c6(0x1e7)](sep))return Promise['resolve']();return await _0x54bbd6[_0x2841c6(0x1e0)](ensureDir,join(this.#codeDir,dirname(_0x1fbb0b))),writeFile(join(this.#codeDir,_0x1fbb0b),_0xfb0007,{'mode':_0x1c1603['files'][_0x1fbb0b][_0x2841c6(0x1eb)]});}));}async[_0x1fb36d(0x1fd)](){await this['_extractArtifact'](),this.#initialized=!![];}get['idleTimeInMinutes'](){const _0x489105=_0x1fb36d,_0x1a5cca={'rEqNr':function(_0x3b76c3,_0x1a7fe7){return _0x3b76c3/_0x1a7fe7;},'XFqfQ':function(_0x4a9bc9,_0x39b5e7){return _0x4a9bc9-_0x39b5e7;}};return _0x1a5cca[_0x489105(0x222)](_0x1a5cca[_0x489105(0x222)](_0x1a5cca[_0x489105(0x20c)](performance[_0x489105(0x1df)](),this.#idleTimeStarted),0x3e8),0x3c);}get[_0x1fb36d(0x1f3)](){return this.#functionName;}async[_0x1fb36d(0x225)](){const _0x35d3f5=_0x1fb36d,_0x36eb4a={'UbdSJ':_0x35d3f5(0x212)};this['status']=_0x36eb4a['UbdSJ'];!this.#initialized&&await this['_initialize']();const _0x364f1c=createUniqueId();this.#lambdaContext[_0x35d3f5(0x1e6)](_0x364f1c),this.#lambdaContext['setClientContext'](this.#clientContext);const _0xb0a1d7=this.#lambdaContext[_0x35d3f5(0x215)]();this[_0x35d3f5(0x221)]();const _0x19c81f=await this.#handlerRunner['run'](this.#event,_0xb0a1d7);return this[_0x35d3f5(0x224)](),!this.#handlerRunner[_0x35d3f5(0x204)]()&&_0x319c65('(Î»:\x20'+this.#functionKey+_0x35d3f5(0x20f)+_0x364f1c+'\x20\x20Duration:\x20'+this[_0x35d3f5(0x1dd)]()[_0x35d3f5(0x21b)](0x2)+_0x35d3f5(0x201)+this[_0x35d3f5(0x213)]()+_0x35d3f5(0x1de)),this[_0x35d3f5(0x218)]=_0x35d3f5(0x1fc),this[_0x35d3f5(0x1ef)](),_0x19c81f;}}