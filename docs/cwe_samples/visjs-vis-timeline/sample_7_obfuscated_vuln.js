function _0x2bc1(_0x48fc2b,_0x5e7a74){const _0x285c91=_0x285c();return _0x2bc1=function(_0x2bc126,_0x36d4c2){_0x2bc126=_0x2bc126-0xad;let _0x38d659=_0x285c91[_0x2bc126];return _0x38d659;},_0x2bc1(_0x48fc2b,_0x5e7a74);}const _0x1dca84=_0x2bc1;(function(_0x51f560,_0x52ffea){const _0x5f2f85=_0x2bc1,_0x4b2884=_0x51f560();while(!![]){try{const _0x547ae2=parseInt(_0x5f2f85(0xad))/0x1*(-parseInt(_0x5f2f85(0xe5))/0x2)+-parseInt(_0x5f2f85(0xb2))/0x3+parseInt(_0x5f2f85(0xb4))/0x4*(parseInt(_0x5f2f85(0xb8))/0x5)+-parseInt(_0x5f2f85(0xb5))/0x6*(parseInt(_0x5f2f85(0xb6))/0x7)+parseInt(_0x5f2f85(0x103))/0x8+-parseInt(_0x5f2f85(0xda))/0x9+parseInt(_0x5f2f85(0xc7))/0xa;if(_0x547ae2===_0x52ffea)break;else _0x4b2884['push'](_0x4b2884['shift']());}catch(_0x1f4f7d){_0x4b2884['push'](_0x4b2884['shift']());}}}(_0x285c,0xc81f9));const mockOauthState=require('../mockoauthstate')(),{version}=require('../../package.json');jest[_0x1dca84(0xd7)]('tus-js-client'),jest[_0x1dca84(0xd7)](_0x1dca84(0xe9)),jest[_0x1dca84(0xd7)](_0x1dca84(0xdb),()=>({...jest[_0x1dca84(0x104)](_0x1dca84(0xdb)),...mockOauthState}));function _0x285c(){const _0x4232d0=['restore','validate\x20upload\x20data','periodically\x20pings','toBe','valid\x20upload\x20data\x20is\x20allowed\x20-\x20tus','tusInvalid','state-with-invalid-instance-url','unsupported\x20HTTP\x20METHOD\x20specified','application/json','HASLj','tVNmz','body','9405696JYzoSP','requireActual','WHCdC','set','uploadField','do\x20not\x20redirect\x20to\x20invalid\x20uppy\x20instances','/drive/get/DUMMY-FILE-ID','qZxTs','DELETE','muOsF','17KkYGcw','uppy-auth-token','http://url.myendpoint.com/files','string','invalid\x20upload\x20metadata\x20gets\x20rejected','4027635oDacfJ','unsupported\x20protocol\x20specified','412jbNoOU','30lTjwVE','108479ewTVnp','headers\x20must\x20be\x20an\x20object','6155ACeNgA','jnFLG','FLkQj','/dropbox/redirect?state=','PUT','get','value','LmIne','http://localhost:3020/connect/dropbox/callback?state=','matadata\x20value','invalid\x20upload\x20headers\x20get\x20rejected','POST','then','idbmW','Content-Type','24963740ygXGll','message','{\x22some\x22:\x20\x22value\x22}','reply','send','s3-multipart','header\x20value','env','XHjsk','Location','tus','xLPqf','supertest','invalid\x20upload\x20HTTP\x20Method\x20gets\x20rejected','nock','PSJCj','mock','uuZvm','handle\x20main\x20oauth\x20redirect','3777624ppzDtT','../../src/server/helpers/oauth-state','http://localhost/ping','/ping','rEjMy','fQXeJ','uRGBc','token\x20value','WMvcA','I\x20am\x20a\x20string\x20instead\x20of\x20object','localhost:3040','134048IxIrJe','../../src/server/helpers/jwt','fieldname\x20must\x20be\x20a\x20string','SMYqo','purest','ghwQd','ylrCJ','processId','post','OzoCF','gROWf','expect','version','ASWSy','redirect\x20to\x20a\x20valid\x20uppy\x20instance','../mockserver','http://localhost','cleanAll'];_0x285c=function(){return _0x4232d0;};return _0x285c();}const nock=require(_0x1dca84(0xd5)),request=require(_0x1dca84(0xd3)),tokenService=require(_0x1dca84(0xe6)),{getServer}=require(_0x1dca84(0xf4)),authServer=getServer(),authData={'dropbox':_0x1dca84(0xe1),'box':_0x1dca84(0xe1),'drive':_0x1dca84(0xe1)},token=tokenService['generateEncryptedToken'](authData,process[_0x1dca84(0xce)]['COMPANION_SECRET']),OAUTH_STATE='some-cool-nice-encrytpion';describe(_0x1dca84(0xf8),()=>{const _0xae9c78=_0x1dca84,_0x658a0c={'tVNmz':_0xae9c78(0xf5),'uuZvm':_0xae9c78(0xdd),'qZxTs':function(_0x31f2ee,_0x26ce76){return _0x31f2ee(_0x26ce76);},'UyfWv':_0xae9c78(0xdc),'muOsF':'{\x22some\x22:\x20\x22value\x22}','jnFLG':function(_0x8df613,_0x330e85){return _0x8df613!==_0x330e85;},'XwRBK':_0xae9c78(0xef),'fQXeJ':_0xae9c78(0xc6),'idbmW':_0xae9c78(0xaf),'rEjMy':_0xae9c78(0xfc),'HASLj':_0xae9c78(0x109),'PSJCj':_0xae9c78(0xae),'FLkQj':_0xae9c78(0xe3),'XHjsk':_0xae9c78(0xff),'ylrCJ':_0xae9c78(0x10b),'WMvcA':_0xae9c78(0xd1),'FHNej':_0xae9c78(0xc3),'ASWSy':_0xae9c78(0xc1),'qebOQ':'uploadField','KXPWo':_0xae9c78(0xcc),'OzoCF':'invalid\x20upload\x20fieldname\x20gets\x20rejected','WHCdC':function(_0x2bfc0e,_0x149584,_0x4ba2e2){return _0x2bfc0e(_0x149584,_0x4ba2e2);},'SMYqo':_0xae9c78(0xb1),'mAyUG':_0xae9c78(0xd4)};test('invalid\x20upload\x20protocol\x20gets\x20rejected',()=>{const _0x368a35=_0xae9c78;if(_0x658a0c[_0x368a35(0xb9)](_0x658a0c['XwRBK'],'gROWf'))_0x18e71e(_0x658a0c[_0x368a35(0x101)])[_0x368a35(0xed)](_0x658a0c[_0x368a35(0xd8)],_0x377f7c=>_0x377f7c['some']===_0x368a35(0xbe)&&_0x377f7c[_0x368a35(0xf1)]===_0x587b56&&typeof _0x377f7c[_0x368a35(0xec)]===_0x368a35(0xb0))[_0x368a35(0xca)](0xc8,()=>_0x4c2f2f()),_0x658a0c[_0x368a35(0x10a)](_0x10612b,{'COMPANION_PERIODIC_PING_URLS':_0x658a0c['UyfWv'],'COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x658a0c[_0x368a35(0x10c)],'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});else return request(authServer)[_0x368a35(0xed)](_0x368a35(0x109))[_0x368a35(0x106)](_0x368a35(0xae),token)[_0x368a35(0x106)](_0x658a0c[_0x368a35(0xdf)],_0x368a35(0xff))[_0x368a35(0xcb)]({'endpoint':_0x658a0c[_0x368a35(0xc5)],'protocol':_0x658a0c[_0x368a35(0xde)]})[_0x368a35(0xf0)](0x190)[_0x368a35(0xc4)](_0x3b89d8=>expect(_0x3b89d8[_0x368a35(0x102)][_0x368a35(0xc8)])[_0x368a35(0xfa)](_0x368a35(0xb3)));}),test(_0x658a0c[_0xae9c78(0xee)],()=>{const _0xc0067a=_0xae9c78;return _0x658a0c[_0xc0067a(0x10a)](request,authServer)['post'](_0x658a0c[_0xc0067a(0x100)])['set']('uppy-auth-token',token)['set']('Content-Type',_0xc0067a(0xff))[_0xc0067a(0xcb)]({'endpoint':'http://url.myendpoint.com/files','protocol':_0xc0067a(0xd1),'fieldname':0x186})[_0xc0067a(0xf0)](0x190)[_0xc0067a(0xc4)](_0x165a0f=>expect(_0x165a0f[_0xc0067a(0x102)]['message'])[_0xc0067a(0xfa)](_0xc0067a(0xe7)));}),_0x658a0c[_0xae9c78(0x105)](test,_0x658a0c[_0xae9c78(0xe8)],()=>{const _0x3a6887=_0xae9c78;return request(authServer)['post'](_0x3a6887(0x109))['set'](_0x3a6887(0xae),token)[_0x3a6887(0x106)](_0x3a6887(0xc6),'application/json')[_0x3a6887(0xcb)]({'endpoint':'http://url.myendpoint.com/files','protocol':_0x3a6887(0xd1),'metadata':_0x3a6887(0xe3)})[_0x3a6887(0xf0)](0x190)[_0x3a6887(0xc4)](_0x2a3685=>expect(_0x2a3685['body']['message'])[_0x3a6887(0xfa)]('metadata\x20must\x20be\x20an\x20object'));}),_0x658a0c[_0xae9c78(0x105)](test,_0xae9c78(0xc2),()=>{const _0x394728=_0xae9c78;return request(authServer)[_0x394728(0xed)](_0x394728(0x109))['set'](_0x658a0c['PSJCj'],token)[_0x394728(0x106)](_0x394728(0xc6),_0x394728(0xff))[_0x394728(0xcb)]({'endpoint':_0x394728(0xaf),'protocol':_0x394728(0xd1),'headers':_0x658a0c[_0x394728(0xba)]})[_0x394728(0xf0)](0x190)[_0x394728(0xc4)](_0x628410=>expect(_0x628410[_0x394728(0x102)][_0x394728(0xc8)])[_0x394728(0xfa)](_0x394728(0xb7)));}),test(_0x658a0c['mAyUG'],()=>{const _0x5ddccb=_0xae9c78;return _0x658a0c['qZxTs'](request,authServer)[_0x5ddccb(0xed)](_0x658a0c[_0x5ddccb(0x100)])['set']('uppy-auth-token',token)[_0x5ddccb(0x106)](_0x658a0c[_0x5ddccb(0xdf)],_0x658a0c[_0x5ddccb(0xcf)])[_0x5ddccb(0xcb)]({'endpoint':_0x5ddccb(0xaf),'protocol':_0x5ddccb(0xd1),'httpMethod':_0x658a0c[_0x5ddccb(0xeb)]})[_0x5ddccb(0xf0)](0x190)[_0x5ddccb(0xc4)](_0x349402=>expect(_0x349402[_0x5ddccb(0x102)][_0x5ddccb(0xc8)])[_0x5ddccb(0xfa)](_0x5ddccb(0xfe)));}),test(_0xae9c78(0xfb),()=>{const _0x250034=_0xae9c78;return request(authServer)[_0x250034(0xed)](_0x658a0c[_0x250034(0x100)])['set'](_0x658a0c[_0x250034(0xd6)],token)[_0x250034(0x106)](_0x250034(0xc6),_0x250034(0xff))['send']({'endpoint':'http://url.myendpoint.com/files','protocol':_0x658a0c[_0x250034(0xe2)],'httpMethod':_0x658a0c['FHNej'],'headers':{'customheader':_0x250034(0xcd)},'metadata':{'mymetadata':_0x658a0c[_0x250034(0xf2)]},'fieldname':_0x658a0c['qebOQ']})[_0x250034(0xf0)](0xc8);}),test('valid\x20upload\x20data\x20is\x20allowed\x20-\x20s3-multipart',()=>{const _0x22b811=_0xae9c78;return request(authServer)['post'](_0x658a0c[_0x22b811(0x100)])['set'](_0x22b811(0xae),token)[_0x22b811(0x106)](_0x658a0c[_0x22b811(0xdf)],_0x22b811(0xff))[_0x22b811(0xcb)]({'endpoint':_0x22b811(0xaf),'protocol':_0x658a0c['KXPWo'],'httpMethod':_0x22b811(0xbc),'headers':{'customheader':_0x22b811(0xcd)},'metadata':{'mymetadata':'matadata\x20value'},'fieldname':_0x22b811(0x107)})[_0x22b811(0xf0)](0xc8);});}),describe(_0x1dca84(0xd9),()=>{const _0x4d736a=_0x1dca84,_0x299dd7={'ghwQd':'uppy-auth-token','uRGBc':_0x4d736a(0xfd),'xLPqf':_0x4d736a(0xe4),'LmIne':function(_0x475e5e,_0x470f9d,_0x2b4f4d){return _0x475e5e(_0x470f9d,_0x2b4f4d);}},_0x2f2c2b=getServer({'COMPANION_OAUTH_DOMAIN':_0x299dd7[_0x4d736a(0xd2)]});test(_0x4d736a(0xf3),()=>{const _0x201f44=_0x4d736a;return request(_0x2f2c2b)[_0x201f44(0xbd)]('/dropbox/redirect?state='+OAUTH_STATE)[_0x201f44(0x106)](_0x299dd7[_0x201f44(0xea)],token)['expect'](0x12e)[_0x201f44(0xf0)](_0x201f44(0xd0),_0x201f44(0xc0)+OAUTH_STATE);}),_0x299dd7[_0x4d736a(0xbf)](test,_0x4d736a(0x108),()=>{const _0x4c0990=_0x4d736a,_0x5324d9=_0x299dd7[_0x4c0990(0xe0)];return request(_0x2f2c2b)['get'](_0x4c0990(0xbb)+_0x5324d9)[_0x4c0990(0x106)](_0x4c0990(0xae),token)['expect'](0x190);});}),it(_0x1dca84(0xf9),_0x5dafed=>{const _0x1c0c8e=_0x1dca84;nock(_0x1c0c8e(0xf5))[_0x1c0c8e(0xed)](_0x1c0c8e(0xdd),_0x14ca9a=>_0x14ca9a['some']==='value'&&_0x14ca9a['version']===version&&typeof _0x14ca9a[_0x1c0c8e(0xec)]===_0x1c0c8e(0xb0))[_0x1c0c8e(0xca)](0xc8,()=>_0x5dafed()),getServer({'COMPANION_PERIODIC_PING_URLS':_0x1c0c8e(0xdc),'COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x1c0c8e(0xc9),'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});},0x3e8),afterAll(()=>{const _0x5d9513=_0x1dca84;nock[_0x5d9513(0xf6)](),nock[_0x5d9513(0xf7)]();});