const _0x517bd0=_0x1acc;(function(_0x3261e1,_0x4c611c){const _0x3479a8=_0x1acc,_0x3aed63=_0x3261e1();while(!![]){try{const _0x6b4bc9=-parseInt(_0x3479a8(0xe2))/0x1+-parseInt(_0x3479a8(0xc5))/0x2*(-parseInt(_0x3479a8(0xc8))/0x3)+parseInt(_0x3479a8(0x121))/0x4*(parseInt(_0x3479a8(0xf9))/0x5)+parseInt(_0x3479a8(0x136))/0x6*(parseInt(_0x3479a8(0x11a))/0x7)+-parseInt(_0x3479a8(0x109))/0x8*(-parseInt(_0x3479a8(0xfb))/0x9)+-parseInt(_0x3479a8(0x131))/0xa*(-parseInt(_0x3479a8(0xd2))/0xb)+-parseInt(_0x3479a8(0x132))/0xc;if(_0x6b4bc9===_0x4c611c)break;else _0x3aed63['push'](_0x3aed63['shift']());}catch(_0x39b1be){_0x3aed63['push'](_0x3aed63['shift']());}}}(_0x2110,0xdc2ad));function _0x2110(){const _0x4ff906=['FgJlX','redirect\x20to\x20a\x20valid\x20uppy\x20instance','30cXgVge','41908152wLoxIC','EXtkA','body','fTChr','3115110sVBpJj','expect','tnqmk','message','/dropbox/redirect?state=','iqXCS','dwRZY','matadata\x20value','BRqVp','9662EYMZUs','string','toEqual','339IhuSxu','state-with-invalid-instance-url','dOwBF','set','http://localhost/','header\x20value','restore','tus-js-client','zcBdS','cleanAll','5408909TfbExS','version','GHvoM','s3-multipart','http://url.myendpoint.com/files','unsupported\x20HTTP\x20METHOD\x20specified','YcEHf','requireActual','qmCzg','HWpQb','invalid\x20upload\x20protocol\x20gets\x20rejected','/drive/get/DUMMY-FILE-ID','DELETE','mock','invalid\x20upload\x20metadata\x20gets\x20rejected','PUT','194166yBbDNj','evEYD','valid\x20upload\x20data\x20is\x20allowed\x20-\x20s3-multipart','periodically\x20pings','http://localhost/ping','/ping','dRYeK','valid\x20upload\x20data\x20is\x20allowed\x20-\x20tus','send','respects\x20allowLocalUrls','token\x20value','hujUZ','handle\x20main\x20oauth\x20redirect','Content-Type','BJcrQ','invalid\x20upload\x20fieldname\x20gets\x20rejected','http://localhost','adiHH','gJbzA','../../package.json','znpQm','ShnBY','post','1511505ttCPoK','/url/get','207rCKYxM','reply','get','/url/meta','zbKUR','LgoAk','validate\x20upload\x20data','processId','Location','uppy-auth-token','application/json','../../src/server/helpers/oauth-state','TtAIJ','toBe','186632Lwsqwq','plcib','some','gAwLC','HaBAh','POST','http://localhost:3020/connect/dropbox/callback?state=','CZdOj','invalid\x20upload\x20headers\x20get\x20rejected','pTgvX','Invalid\x20request\x20body','aMUjR','BCBNd','COMPANION_SECRET','unsupported\x20protocol\x20specified','{\x22some\x22:\x20\x22value\x22}','do\x20not\x20redirect\x20to\x20invalid\x20uppy\x20instances','7OnkzUR','generateEncryptedToken','rOPrM','purest','tBfhs','BTqfW','localhost:3040','20MsnYjQ','uJlVz','nock','tus','ESDzi','then','headers\x20must\x20be\x20an\x20object','tusInvalid','KgweI','invalid\x20upload\x20HTTP\x20Method\x20gets\x20rejected','BYhza','supertest','EIbbm','wDjtZ'];_0x2110=function(){return _0x4ff906;};return _0x2110();}const mockOauthState=require('../mockoauthstate')(),{version}=require(_0x517bd0(0xf5));jest[_0x517bd0(0xdf)](_0x517bd0(0xcf)),jest[_0x517bd0(0xdf)](_0x517bd0(0x11d)),jest['mock'](_0x517bd0(0x106),()=>({...jest[_0x517bd0(0xd9)](_0x517bd0(0x106)),...mockOauthState}));function _0x1acc(_0x4d8593,_0x5d20c2){const _0x21109b=_0x2110();return _0x1acc=function(_0x1acc3f,_0xe621de){_0x1acc3f=_0x1acc3f-0xc2;let _0x47024c=_0x21109b[_0x1acc3f];return _0x47024c;},_0x1acc(_0x4d8593,_0x5d20c2);}const nock=require(_0x517bd0(0x123)),request=require(_0x517bd0(0x12c)),tokenService=require('../../src/server/helpers/jwt'),{getServer}=require('../mockserver'),authServer=getServer(),authData={'dropbox':_0x517bd0(0xec),'box':_0x517bd0(0xec),'drive':_0x517bd0(0xec)},token=tokenService[_0x517bd0(0x11b)](authData,process['env'][_0x517bd0(0x116)]),OAUTH_STATE='some-cool-nice-encrytpion';describe(_0x517bd0(0x101),()=>{const _0x5788be=_0x517bd0,_0xe77da7={'BTqfW':'uppy-auth-token','HWpQb':_0x5788be(0xef),'pTgvX':function(_0x210dd1,_0x2dc8ba){return _0x210dd1!==_0x2dc8ba;},'BRqVp':'vwFeG','HaBAh':'/drive/get/DUMMY-FILE-ID','rOPrM':_0x5788be(0x105),'zbKUR':function(_0x5d7c6,_0x5de485){return _0x5d7c6(_0x5de485);},'iqXCS':_0x5788be(0xd6),'aMUjR':'tus','zcBdS':_0x5788be(0xde),'BJcrQ':_0x5788be(0x118),'gJbzA':_0x5788be(0x10a),'CZdOj':function(_0x14068d,_0x579a45){return _0x14068d(_0x579a45);},'qXwDu':_0x5788be(0x10e),'fTChr':_0x5788be(0xc3),'znpQm':'uploadField','FgJlX':_0x5788be(0xd5),'adiHH':_0x5788be(0xcd),'OXUfx':_0x5788be(0xdc),'qmCzg':_0x5788be(0xf1),'evEYD':function(_0x109a2b,_0x58e53b,_0x24f2b2){return _0x109a2b(_0x58e53b,_0x24f2b2);},'YKyUs':_0x5788be(0x111),'LgoAk':_0x5788be(0x12a),'dOwBF':function(_0x4aa758,_0x464fc7,_0x107946){return _0x4aa758(_0x464fc7,_0x107946);}};test(_0xe77da7['OXUfx'],()=>{const _0x2ada28=_0x5788be;return request(authServer)[_0x2ada28(0xf8)]('/drive/get/DUMMY-FILE-ID')[_0x2ada28(0xcb)](_0xe77da7[_0x2ada28(0x11f)],token)['set'](_0xe77da7[_0x2ada28(0xdb)],'application/json')[_0x2ada28(0xea)]({'endpoint':_0x2ada28(0xd6),'protocol':_0x2ada28(0x128)})['expect'](0x190)['then'](_0x3592f5=>expect(_0x3592f5[_0x2ada28(0x134)]['message'])[_0x2ada28(0x108)](_0x2ada28(0x117)));}),test(_0xe77da7[_0x5788be(0xda)],()=>{const _0x153ab9=_0x5788be;return _0xe77da7[_0x153ab9(0x112)](_0xe77da7['BRqVp'],_0xe77da7[_0x153ab9(0xc4)])?_0x445ebb(_0x2b577f)['get'](_0x153ab9(0x13a)+_0x27d104)[_0x153ab9(0xcb)](_0x153ab9(0x104),_0x507420)[_0x153ab9(0x137)](0x12e)['expect'](_0x153ab9(0x103),_0x153ab9(0x10f)+_0x1c8f0b):request(authServer)[_0x153ab9(0xf8)](_0xe77da7[_0x153ab9(0x10d)])[_0x153ab9(0xcb)](_0x153ab9(0x104),token)[_0x153ab9(0xcb)](_0x153ab9(0xef),_0xe77da7[_0x153ab9(0x11c)])[_0x153ab9(0xea)]({'endpoint':_0x153ab9(0xd6),'protocol':_0x153ab9(0x124),'fieldname':0x186})[_0x153ab9(0x137)](0x190)[_0x153ab9(0x126)](_0x3b4a1a=>expect(_0x3b4a1a[_0x153ab9(0x134)]['message'])[_0x153ab9(0x108)]('fieldname\x20must\x20be\x20a\x20string'));}),test(_0x5788be(0xe0),()=>{const _0x49965d=_0x5788be;return _0xe77da7[_0x49965d(0xff)](request,authServer)[_0x49965d(0xf8)](_0xe77da7[_0x49965d(0x10d)])[_0x49965d(0xcb)](_0xe77da7[_0x49965d(0x11f)],token)[_0x49965d(0xcb)](_0xe77da7[_0x49965d(0xdb)],_0xe77da7[_0x49965d(0x11c)])[_0x49965d(0xea)]({'endpoint':_0xe77da7['iqXCS'],'protocol':_0x49965d(0x124),'metadata':'I\x20am\x20a\x20string\x20instead\x20of\x20object'})[_0x49965d(0x137)](0x190)['then'](_0x11b207=>expect(_0x11b207['body'][_0x49965d(0x139)])[_0x49965d(0x108)]('metadata\x20must\x20be\x20an\x20object'));}),_0xe77da7['evEYD'](test,_0xe77da7['YKyUs'],()=>{const _0x318d9f=_0x5788be;return request(authServer)['post'](_0xe77da7[_0x318d9f(0x10d)])[_0x318d9f(0xcb)](_0x318d9f(0x104),token)[_0x318d9f(0xcb)](_0xe77da7['HWpQb'],_0x318d9f(0x105))[_0x318d9f(0xea)]({'endpoint':_0xe77da7[_0x318d9f(0x13b)],'protocol':_0xe77da7[_0x318d9f(0x114)],'headers':'I\x20am\x20a\x20string\x20instead\x20of\x20object'})[_0x318d9f(0x137)](0x190)[_0x318d9f(0x126)](_0x474ff2=>expect(_0x474ff2['body'][_0x318d9f(0x139)])['toBe'](_0x318d9f(0x127)));}),_0xe77da7[_0x5788be(0xe3)](test,_0xe77da7[_0x5788be(0x100)],()=>{const _0x1aaab8=_0x5788be;return request(authServer)[_0x1aaab8(0xf8)](_0x1aaab8(0xdd))['set'](_0xe77da7[_0x1aaab8(0x11f)],token)[_0x1aaab8(0xcb)](_0xe77da7['HWpQb'],_0x1aaab8(0x105))[_0x1aaab8(0xea)]({'endpoint':_0x1aaab8(0xd6),'protocol':_0xe77da7['aMUjR'],'httpMethod':_0xe77da7[_0x1aaab8(0xd0)]})['expect'](0x190)[_0x1aaab8(0x126)](_0x344f7c=>expect(_0x344f7c[_0x1aaab8(0x134)][_0x1aaab8(0x139)])[_0x1aaab8(0x108)](_0x1aaab8(0xd7)));}),_0xe77da7[_0x5788be(0xe3)](test,_0x5788be(0xe9),()=>{const _0xe2aa85=_0x5788be,_0x4bb777={'KgweI':_0xe2aa85(0xf2),'YcEHf':'/ping','EIbbm':function(_0x2266b6,_0x4733b3){const _0x1f2d04=_0xe2aa85;return _0xe77da7[_0x1f2d04(0xff)](_0x2266b6,_0x4733b3);},'BCBNd':_0xe77da7[_0xe2aa85(0xf0)]};if(_0xe77da7[_0xe2aa85(0xf4)]===_0xe2aa85(0x10a))return _0xe77da7[_0xe2aa85(0x110)](request,authServer)[_0xe2aa85(0xf8)]('/drive/get/DUMMY-FILE-ID')[_0xe2aa85(0xcb)](_0xe2aa85(0x104),token)[_0xe2aa85(0xcb)](_0xe2aa85(0xef),_0xe77da7[_0xe2aa85(0x11c)])['send']({'endpoint':'http://url.myendpoint.com/files','protocol':_0xe77da7[_0xe2aa85(0x114)],'httpMethod':_0xe77da7['qXwDu'],'headers':{'customheader':_0xe2aa85(0xcd)},'metadata':{'mymetadata':_0xe77da7[_0xe2aa85(0x135)]},'fieldname':_0xe77da7[_0xe2aa85(0xf6)]})[_0xe2aa85(0x137)](0xc8);else _0x56bbfd(_0x4bb777[_0xe2aa85(0x129)])[_0xe2aa85(0xf8)](_0x4bb777[_0xe2aa85(0xd8)],_0x18638e=>_0x18638e[_0xe2aa85(0x10b)]==='value'&&_0x18638e['version']===_0x2678ff&&typeof _0x18638e[_0xe2aa85(0x102)]===_0xe2aa85(0xc6))[_0xe2aa85(0xfc)](0xc8,()=>_0x49d4ad()),_0x4bb777[_0xe2aa85(0x12d)](_0x43cfab,{'COMPANION_PERIODIC_PING_URLS':'http://localhost/ping','COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x4bb777[_0xe2aa85(0x115)],'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});}),_0xe77da7[_0x5788be(0xca)](test,_0x5788be(0xe4),()=>{const _0x5cb240=_0x5788be;return _0xe77da7[_0x5cb240(0xff)](request,authServer)[_0x5cb240(0xf8)](_0xe77da7[_0x5cb240(0x10d)])[_0x5cb240(0xcb)](_0xe77da7[_0x5cb240(0x11f)],token)[_0x5cb240(0xcb)](_0xe77da7['HWpQb'],'application/json')[_0x5cb240(0xea)]({'endpoint':_0xe77da7[_0x5cb240(0x13b)],'protocol':_0xe77da7[_0x5cb240(0x12f)],'httpMethod':_0x5cb240(0xe1),'headers':{'customheader':_0xe77da7[_0x5cb240(0xf3)]},'metadata':{'mymetadata':_0xe77da7['fTChr']},'fieldname':'uploadField'})[_0x5cb240(0x137)](0xc8);});}),describe(_0x517bd0(0xee),()=>{const _0x1b94a2=_0x517bd0,_0x2e91a6={'TtAIJ':_0x1b94a2(0x104),'BYhza':_0x1b94a2(0xef),'uJlVz':_0x1b94a2(0x105),'RXiig':function(_0x1c71a0,_0x1fd2f9){return _0x1c71a0===_0x1fd2f9;},'GHvoM':'gAwLC','lgbYq':function(_0x201e8e,_0x2eeaf9){return _0x201e8e(_0x2eeaf9);},'hujUZ':_0x1b94a2(0x120),'wDjtZ':_0x1b94a2(0x130)},_0x1c2c4c=_0x2e91a6['lgbYq'](getServer,{'COMPANION_OAUTH_DOMAIN':_0x2e91a6[_0x1b94a2(0xed)]});test(_0x2e91a6[_0x1b94a2(0x12e)],()=>{const _0x140aac=_0x1b94a2;return request(_0x1c2c4c)[_0x140aac(0xfd)](_0x140aac(0x13a)+OAUTH_STATE)[_0x140aac(0xcb)](_0x2e91a6[_0x140aac(0x107)],token)['expect'](0x12e)[_0x140aac(0x137)]('Location',_0x140aac(0x10f)+OAUTH_STATE);}),test(_0x1b94a2(0x119),()=>{const _0x9dfc3e=_0x1b94a2,_0xa90aeb={'gpDGe':function(_0x40c11f,_0xd42966){return _0x40c11f(_0xd42966);},'fNtsZ':'uppy-auth-token','EXtkA':_0x2e91a6[_0x9dfc3e(0x12b)],'dwRZY':_0x2e91a6[_0x9dfc3e(0x122)]};if(_0x2e91a6['RXiig'](_0x9dfc3e(0x10c),_0x2e91a6[_0x9dfc3e(0xd4)])){const _0x4ab528=_0x9dfc3e(0xc9);return request(_0x1c2c4c)[_0x9dfc3e(0xfd)](_0x9dfc3e(0x13a)+_0x4ab528)[_0x9dfc3e(0xcb)](_0x2e91a6[_0x9dfc3e(0x107)],token)[_0x9dfc3e(0x137)](0x190);}else return _0xa90aeb['gpDGe'](_0x2467dc,_0x1a0106)[_0x9dfc3e(0xf8)](_0x9dfc3e(0xdd))[_0x9dfc3e(0xcb)](_0xa90aeb['fNtsZ'],_0x120d7a)[_0x9dfc3e(0xcb)](_0xa90aeb[_0x9dfc3e(0x133)],_0xa90aeb[_0x9dfc3e(0xc2)])['send']({'endpoint':_0x9dfc3e(0xd6),'protocol':_0x9dfc3e(0x124),'fieldname':0x186})[_0x9dfc3e(0x137)](0x190)[_0x9dfc3e(0x126)](_0x174071=>_0x2a6631(_0x174071['body'][_0x9dfc3e(0x139)])[_0x9dfc3e(0x108)]('fieldname\x20must\x20be\x20a\x20string'));});}),it(_0x517bd0(0xe5),_0x5c7ddd=>{const _0x115559=_0x517bd0,_0x55befc={'ESDzi':function(_0x644973,_0x55b035){return _0x644973(_0x55b035);},'ShnBY':_0x115559(0xe7)};_0x55befc[_0x115559(0x125)](nock,'http://localhost')['post'](_0x55befc[_0x115559(0xf7)],_0x489661=>_0x489661[_0x115559(0x10b)]==='value'&&_0x489661[_0x115559(0xd3)]===version&&typeof _0x489661['processId']===_0x115559(0xc6))[_0x115559(0xfc)](0xc8,()=>_0x5c7ddd()),getServer({'COMPANION_PERIODIC_PING_URLS':_0x115559(0xe6),'COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x115559(0x118),'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});},0x3e8),it(_0x517bd0(0xeb),async()=>{const _0x4ecd35=_0x517bd0,_0x221744={'tnqmk':_0x4ecd35(0xfe),'dRYeK':function(_0x4e2b29,_0x4a3785){return _0x4e2b29(_0x4a3785);},'gPgOK':_0x4ecd35(0x113),'meCVJ':'tus','tBfhs':function(_0x50b17e,_0x5e88a0){return _0x50b17e(_0x5e88a0);}},_0x319d84=getServer(),_0x172028=_0x4ecd35(0xcc);let _0x5c97fa;_0x5c97fa=await request(_0x319d84)[_0x4ecd35(0xf8)](_0x221744[_0x4ecd35(0x138)])['send']({'url':_0x172028})[_0x4ecd35(0x137)](0x190),_0x221744[_0x4ecd35(0xe8)](expect,_0x5c97fa[_0x4ecd35(0x134)])[_0x4ecd35(0xc7)]({'error':_0x221744['gPgOK']}),_0x5c97fa=await request(_0x319d84)['post'](_0x4ecd35(0xfa))['send']({'fileId':_0x172028,'metadata':{},'endpoint':_0x4ecd35(0xd6),'protocol':_0x221744['meCVJ'],'size':null,'url':_0x172028})[_0x4ecd35(0x137)](0x190),_0x221744[_0x4ecd35(0x11e)](expect,_0x5c97fa[_0x4ecd35(0x134)])[_0x4ecd35(0xc7)]({'error':'Invalid\x20request\x20body'});},0x3e8),afterAll(()=>{const _0x1d7b8d=_0x517bd0;nock[_0x1d7b8d(0xd1)](),nock[_0x1d7b8d(0xce)]();});