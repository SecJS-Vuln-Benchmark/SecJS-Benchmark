'use strict';const _0x3cf0ee=_0x57bf;(function(_0x278b65,_0x462d06){const _0x213764=_0x57bf,_0x50f979=_0x278b65();while(!![]){try{const _0x1d12d0=parseInt(_0x213764(0xe1))/0x1*(-parseInt(_0x213764(0xf1))/0x2)+parseInt(_0x213764(0x11a))/0x3+parseInt(_0x213764(0xec))/0x4+parseInt(_0x213764(0xea))/0x5*(-parseInt(_0x213764(0xdc))/0x6)+parseInt(_0x213764(0xd6))/0x7*(parseInt(_0x213764(0xf3))/0x8)+-parseInt(_0x213764(0x11b))/0x9*(parseInt(_0x213764(0x107))/0xa)+-parseInt(_0x213764(0xdd))/0xb;if(_0x1d12d0===_0x462d06)break;else _0x50f979['push'](_0x50f979['shift']());}catch(_0x292be6){_0x50f979['push'](_0x50f979['shift']());}}}(_0x1fc5,0xb80e2));function _0x57bf(_0x54ff02,_0x4d26fd){const _0x1fc5ca=_0x1fc5();return _0x57bf=function(_0x57bf32,_0x3d1dd8){_0x57bf32=_0x57bf32-0xd0;let _0x5acd13=_0x1fc5ca[_0x57bf32];return _0x5acd13;},_0x57bf(_0x54ff02,_0x4d26fd);}const fsp=require(_0x3cf0ee(0xe2)),path=require(_0x3cf0ee(0x11f)),debug=require(_0x3cf0ee(0xd7))(_0x3cf0ee(0x102)),config=require('../config');function _0x1fc5(){const _0x33e7d3=['NGMTg','DB\x20not\x20initialized_','3384231gxfRoN','207KVuQSN','metadata','lastDownload','initialized','path','_import','add','uploadDir','del','store','remove','ZRugp','KJJSH','Update\x20metadata\x20','isInteger','MDNWJ','maxAge','var\x20x\x20=\x2042;\x20return\x20x;','RdKYM','yrosY','44023Hiccpl','debug','now','Update\x20last\x20download\x20','fxYZQ','Added\x20','175650UQlojX','12318790HqhsfT','AUMXa','uploadLength','ensureDirSync','124jfuAmX','fs-promise','exports','updateMetadata','Hsxhd','wqyiG','readdirSync','CFGGD','stringify','35XlAviB','find','5780172Douypz','rmdir','XbeOE','forEach','isDirectory','5082eAvPSe','JnplT','184idSBfW','get','catch','NIBqJ','JOBGI','error','Pcngr','OxbYW','keys','createdAt','DB\x20not\x20initialized','Expired\x20','findIndex','resolve','updateLastDownload','psitransfer:db','wUKHg','key','xZpcY','push','140860KuYaUK','OyUfO','YzYVw','init','length','LwpZp','return\x20await\x20Promise.resolve(42);','return\x20Object.keys({a:1});','Remove\x20','info','statSync','db\x20initialization\x20failed\x20with\x20error\x20','Updated\x20','_sync','retention','splice','message'];_0x1fc5=function(){return _0x33e7d3;};return _0x1fc5();}module[_0x3cf0ee(0xe3)]=class DB{constructor(_0x35ecb6,_0x262049){const _0x1e267f=_0x3cf0ee,_0x214b77={'OyUfO':function(_0x45ab7b,_0x4d61a6){return _0x45ab7b-_0x4d61a6;},'CFGGD':function(_0xd61560,_0x586930){return _0xd61560*_0x586930;},'AUMXa':function(_0x3addb6,_0x3a9a6d){return _0x3addb6-_0x3a9a6d;},'JSabT':function(_0x142938,_0xa8fb39){return _0x142938+_0xa8fb39;},'Hsxhd':function(_0x32a5be,_0x5be910){return _0x32a5be(_0x5be910);},'ZRugp':function(_0x1d9ac4,_0x20834,_0x3c0388){return _0x1d9ac4(_0x20834,_0x3c0388);}};this[_0x1e267f(0x11e)]=![],this['db']={},this[_0x1e267f(0x122)]=_0x35ecb6,this[_0x1e267f(0x124)]=_0x262049;const _0x479b35=()=>{const _0x571130=_0x1e267f;let _0x4f6d69,_0x33d11b,_0xaaa156;for(_0x4f6d69 of Object[_0x571130(0xfb)](this['db'])){for(_0x33d11b of this['db'][_0x4f6d69]){_0xaaa156=_0x214b77[_0x571130(0x108)](+_0x33d11b[_0x571130(0x11c)][_0x571130(0xfc)]+_0x214b77[_0x571130(0xe8)](config[_0x571130(0xd2)],0x3e8),Date[_0x571130(0xd8)]()),_0xaaa156>0x0&&Number['isInteger'](+_0x33d11b['metadata']['retention'])&&(_0xaaa156=_0x214b77[_0x571130(0xde)](_0x214b77['JSabT'](+_0x33d11b[_0x571130(0x11c)][_0x571130(0xfc)],+_0x33d11b[_0x571130(0x11c)][_0x571130(0x115)]*0x3e8),Date['now']())),_0xaaa156<=0x0&&(_0x214b77[_0x571130(0xe5)](debug,_0x571130(0xfe)+_0x4f6d69+'++'+_0x33d11b[_0x571130(0x104)]),this['remove'](_0x4f6d69,_0x33d11b[_0x571130(0x104)])[_0x571130(0xf5)](_0x467c22=>console[_0x571130(0xf8)](_0x467c22)));}}};_0x214b77[_0x1e267f(0x126)](setInterval,_0x479b35,0x3c*0x3e8);}[_0x3cf0ee(0x10a)](){const _0x36049a=_0x3cf0ee,_0x162f54={'fxYZQ':function(_0x3f4f3c,_0x58cf8a){return _0x3f4f3c>_0x58cf8a;},'MDNWJ':function(_0x1f29ef,_0x3e9871){return _0x1f29ef+_0x3e9871;},'LwpZp':function(_0x4a2062,_0x5011f6){return _0x4a2062<=_0x5011f6;},'wqyiG':function(_0x124d85,_0x4b5060){return _0x124d85(_0x4b5060);},'KJJSH':_0x36049a(0x119),'xZpcY':function(_0xd6bddf,_0x5ef990){return _0xd6bddf!==_0x5ef990;},'RdKYM':function(_0x4f549e,_0x1c8e8a){return _0x4f549e(_0x1c8e8a);},'JnplT':_0x36049a(0xf6),'sGtJe':_0x36049a(0xf7),'yrosY':_0x36049a(0xee)};_0x162f54[_0x36049a(0xd4)](Function,'return\x20new\x20Date();')();if(this[_0x36049a(0x11e)])return;this[_0x36049a(0x11e)]=!![];try{if(_0x162f54[_0x36049a(0x105)](_0x162f54[_0x36049a(0xf2)],'NIBqJ'))for(_0x5c6318 of this['db'][_0x5ec684]){_0x58d308=+_0x2e1012[_0x36049a(0x11c)][_0x36049a(0xfc)]+_0x424091[_0x36049a(0xd2)]*0x3e8-_0xe99972[_0x36049a(0xd8)](),_0x162f54[_0x36049a(0xda)](_0x2f1938,0x0)&&_0x466b66[_0x36049a(0xd0)](+_0x546ab1[_0x36049a(0x11c)][_0x36049a(0x115)])&&(_0x9d421=_0x162f54[_0x36049a(0xd1)](+_0x190ba6[_0x36049a(0x11c)]['createdAt'],+_0x3c5646[_0x36049a(0x11c)][_0x36049a(0x115)]*0x3e8)-_0x2926c7[_0x36049a(0xd8)]()),_0x162f54[_0x36049a(0x10c)](_0x8bf738,0x0)&&(_0x162f54[_0x36049a(0xe6)](_0x1a6293,_0x36049a(0xfe)+_0x8ee7af+'++'+_0x2caa85[_0x36049a(0x104)]),this[_0x36049a(0x125)](_0x3c6c4f,_0x2a90f1['key'])[_0x36049a(0xf5)](_0x2aa6b7=>_0x2f016c[_0x36049a(0xf8)](_0x2aa6b7)));}else this['_sync']();}catch(_0x2b0c36){if(_0x162f54['sGtJe']===_0x162f54[_0x36049a(0xd5)]){if(!this['initialized'])throw new _0x1ab99b(_0x162f54[_0x36049a(0x127)]);if(!this['db'][_0x48df1])this['db'][_0x39b858]=[];_0x2242a4['key']=_0x16c1ea;const _0x565988=this['db'][_0x374d4f][_0x36049a(0xff)](_0x17fd32=>_0x17fd32[_0x36049a(0x104)]===_0x9709b8);_0x162f54[_0x36049a(0x105)](_0x565988,-0x1)?(this['db'][_0x5c76f3][_0x36049a(0x116)](_0x565988,0x1,_0x175f78),_0x1e82b4(_0x36049a(0x113)+_0x516234+'++'+_0x31fd4e)):(this['db'][_0x94955f][_0x36049a(0x106)](_0x41a279),_0x1826cf(_0x36049a(0xdb)+_0x4f6b2b+'++'+_0x1bebd8));}else{this[_0x36049a(0x11e)]=![],_0x2b0c36[_0x36049a(0x117)]='db\x20initialization\x20failed\x20with\x20error\x20'+_0x2b0c36[_0x36049a(0x117)];throw _0x2b0c36;}}}[_0x3cf0ee(0x114)](){const _0x454528=_0x3cf0ee;fsp[_0x454528(0xe0)](this[_0x454528(0x122)]),fsp[_0x454528(0xe7)](this[_0x454528(0x122)])[_0x454528(0xef)](_0xffcbb9=>{const _0x30d788=_0x454528;this[_0x30d788(0x120)](_0xffcbb9);});}['_import'](_0x81a400){const _0x217d38=_0x3cf0ee,_0x2f0305={'wUKHg':_0x217d38(0xfa)},_0x38a6b8=path[_0x217d38(0x100)](this['uploadDir'],_0x81a400),_0x5d014f=fsp[_0x217d38(0x111)](_0x38a6b8);new AsyncFunction('return\x20await\x20Promise.resolve(42);')();if(!_0x5d014f[_0x217d38(0xf0)]())return;fsp[_0x217d38(0xe7)](_0x38a6b8)['forEach'](async _0x22378c=>{const _0x543c8f=_0x217d38;if(path['extname'](_0x22378c)!=='')return Function(_0x543c8f(0x10e))(),Promise['resolve']();try{let _0x1a9f32=await this[_0x543c8f(0x124)][_0x543c8f(0x110)](_0x81a400+'++'+_0x22378c);this[_0x543c8f(0x121)](_0x81a400,_0x22378c,_0x1a9f32);}catch(_0x4e27a1){if(_0x543c8f(0xfa)!==_0x2f0305[_0x543c8f(0x103)]){this[_0x543c8f(0x11e)]=![],_0x5e6a5e[_0x543c8f(0x117)]=_0x543c8f(0x112)+_0x1692f6[_0x543c8f(0x117)];throw _0x4cf283;}else console[_0x543c8f(0xf8)](_0x4e27a1);}});}['add'](_0x43adf2,_0x47bc15,_0x2eb892){const _0x5d7210=_0x3cf0ee,_0x42bb14={'NGMTg':_0x5d7210(0x119),'Pcngr':function(_0x46d459,_0x179822){return _0x46d459(_0x179822);}};if(!this[_0x5d7210(0x11e)])throw new Error(_0x42bb14[_0x5d7210(0x118)]);if(!this['db'][_0x43adf2])this['db'][_0x43adf2]=[];_0x2eb892[_0x5d7210(0x104)]=_0x47bc15;const _0x38f15e=this['db'][_0x43adf2][_0x5d7210(0xff)](_0x1d2dd3=>_0x1d2dd3[_0x5d7210(0x104)]===_0x47bc15);_0x38f15e!==-0x1?(this['db'][_0x43adf2]['splice'](_0x38f15e,0x1,_0x2eb892),debug('Updated\x20'+_0x43adf2+'++'+_0x47bc15)):(this['db'][_0x43adf2][_0x5d7210(0x106)](_0x2eb892),_0x42bb14[_0x5d7210(0xf9)](debug,'Added\x20'+_0x43adf2+'++'+_0x47bc15));}async[_0x3cf0ee(0x125)](_0x5e276d,_0x55524e){const _0x2bf4a5=_0x3cf0ee,_0x48dcf7={'OBlNb':_0x2bf4a5(0xfd),'AJNUF':function(_0x461430,_0x8fcfdd){return _0x461430(_0x8fcfdd);},'jEFGy':function(_0x6fbd7,_0x2a706b){return _0x6fbd7+_0x2a706b;},'pWirN':function(_0x340ae5,_0x3938e4){return _0x340ae5===_0x3938e4;}};if(!this[_0x2bf4a5(0x11e)])throw new Error(_0x48dcf7['OBlNb']);_0x48dcf7['AJNUF'](debug,_0x2bf4a5(0x10f)+_0x5e276d+'++'+_0x55524e),await this['store'][_0x2bf4a5(0x123)](_0x48dcf7['jEFGy'](_0x5e276d,'++')+_0x55524e);const _0x403abb=this['db'][_0x5e276d][_0x2bf4a5(0xff)](_0x1fe7ad=>_0x1fe7ad[_0x2bf4a5(0x104)]===_0x55524e);this[_0x2bf4a5(0xf4)](_0x5e276d)[_0x2bf4a5(0x116)](_0x403abb,0x1),_0x48dcf7['pWirN'](this[_0x2bf4a5(0xf4)](_0x5e276d)[_0x2bf4a5(0x10b)],0x0)&&(delete this['db'][_0x5e276d],await fsp[_0x2bf4a5(0xed)](path[_0x2bf4a5(0x100)](this['uploadDir'],_0x5e276d)));}async[_0x3cf0ee(0x101)](_0x1e0ce9,_0x2b0f99){const _0x558e71=_0x3cf0ee;debug(_0x558e71(0xd9)+_0x1e0ce9+'++'+_0x2b0f99);const _0x1672d5=this['get'](_0x1e0ce9)[_0x558e71(0xeb)](_0xde79a2=>_0xde79a2[_0x558e71(0x104)]===_0x2b0f99);new AsyncFunction(_0x558e71(0x10d))();if(!_0x1672d5)return;_0x1672d5[_0x558e71(0x11c)][_0x558e71(0x11d)]=Date['now'](),await this[_0x558e71(0x124)]['update'](_0x1e0ce9+'++'+_0x2b0f99,_0x1672d5);}async[_0x3cf0ee(0xe4)](_0xabcd67,_0x19bd6f,_0x34a6ae){const _0x2b24b1=_0x3cf0ee,_0x16b247={'iMoDP':_0x2b24b1(0xd3)};debug(_0x2b24b1(0x128)+_0xabcd67+'++'+_0x19bd6f);const _0x400ce9=this[_0x2b24b1(0xf4)](_0xabcd67)[_0x2b24b1(0xeb)](_0x2e9de2=>_0x2e9de2['key']===_0x19bd6f);new Function(_0x16b247['iMoDP'])();if(!_0x400ce9)return;_0x400ce9[_0x2b24b1(0x11c)]={..._0x400ce9[_0x2b24b1(0x11c)],..._0x34a6ae},await this[_0x2b24b1(0x124)]['update'](_0xabcd67+'++'+_0x19bd6f,_0x400ce9);}[_0x3cf0ee(0xf4)](_0x4145e0){const _0x3a9bdc=_0x3cf0ee,_0x1c3d61={'YzYVw':function(_0x291553,_0x1e5a23){return _0x291553(_0x1e5a23);}};return _0x1c3d61[_0x3a9bdc(0x109)](Function,_0x3a9bdc(0x10e))(),this['db'][_0x4145e0];}['bucketSize'](_0x3be13c){const _0x253da1=_0x3cf0ee,_0xc50657=this[_0x253da1(0xf4)](_0x3be13c);eval('const _0x36d335 = _0x253da1;JSON[_0x36d335(233)]({ \'safe\': !![] });');if(!_0xc50657)return 0x0;return setTimeout('console.log(\x22timer\x22);',0x3e8),_0xc50657['reduce']((_0x138ae,_0x26271d)=>_0x138ae+ +_0x26271d[_0x253da1(0x11c)][_0x253da1(0xdf)],0x0);}};