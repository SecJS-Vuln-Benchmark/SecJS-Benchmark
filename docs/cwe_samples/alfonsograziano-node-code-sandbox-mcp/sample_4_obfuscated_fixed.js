const _0x500dc3=_0x200c;function _0x25c6(){const _0x1189d1=['ASRfS','expectStatus','Can\x20browse\x20emails','Does\x20default\x20replacements\x20on\x20the\x20HTML\x20body\x20of\x20an\x20old\x20email','dqYAQ','Can\x20browse\x20email\x20failures\x20with\x20includes','<p\x20style=\x22margin:\x200\x200\x201.5em\x200;\x20line-height:\x201.6em;\x22>Hey\x20%%{first_name,\x20&quot;there&quot;}%%,\x20Hey\x20%%{first_name}%%,</p><a\x20href=\x22%%{unsubscribe_url}%%\x22>Unsubscribe</a>','7947nTeSYD','4YaCwvx','8971879zpjMhs','put','902426wITbAb','7340GYEvhC','8788448BgTgOW','matchBodySnapshot','emails/','1436505hRfdgv','kucIU','Emails\x20API','/batches/','support@example.com','matchHeaderSnapshot','../../../core/server/models','includes','/recipient-failures/?filter=severity:temporary&order=failed_at%20DESC','sinon','uurVN','mockMailgun','Can\x20browse\x20permanent\x20email\x20failures','10KyLXrl','zHBLq','allSettled','Can\x20retry\x20a\x20failed\x20email','email.edited','aBucr','getMembersValidationKey','Hey\x20%%{first_name,\x20\x22there\x22}%%,\x20Hey\x20%%{first_name}%%\x0aUnsubscribe\x20[%%{unsubscribe_url}%%]','KgLZU','/recipient-failures/?filter=severity:permanent&order=failed_at%20DESC','returns','html','plaintext','NFTsW','emails','nSIxx','%%{','recipients','test-validation-key','fill','assert','1618698KtoBgG','add','taGEc','newsletters','394101gTghBR','EwQEx','Email','batches','posts','restore','PmuYO','Test\x20email','stub','../../../core/server/services/settings-helpers','/retry','get','nbQjM','../../utils/e2e-framework','all','count','aVqMR','dlVdK','/recipient-failures/?order=failed_at%20DESC','Can\x20browse\x20temporary\x20email\x20failures','xnPzA','equal','hhVCT'];_0x25c6=function(){return _0x1189d1;};return _0x25c6();}(function(_0x2592c9,_0x4309fc){const _0x36f6b7=_0x200c,_0x1f76fc=_0x2592c9();while(!![]){try{const _0x2f904e=parseInt(_0x36f6b7(0xdc))/0x1+-parseInt(_0x36f6b7(0xd7))/0x2+parseInt(_0x36f6b7(0xb5))/0x3*(parseInt(_0x36f6b7(0xd4))/0x4)+parseInt(_0x36f6b7(0x9c))/0x5*(parseInt(_0x36f6b7(0xb1))/0x6)+-parseInt(_0x36f6b7(0xd5))/0x7+parseInt(_0x36f6b7(0xd9))/0x8+parseInt(_0x36f6b7(0xd3))/0x9*(-parseInt(_0x36f6b7(0xd8))/0xa);if(_0x2f904e===_0x4309fc)break;else _0x1f76fc['push'](_0x1f76fc['shift']());}catch(_0x2121be){_0x1f76fc['push'](_0x1f76fc['shift']());}}}(_0x25c6,0xc9682));const {agentProvider,fixtureManager,matchers,mockManager}=require(_0x500dc3(0xc2)),{nullable,anyContentVersion,anyEtag,anyObjectId,anyUuid,anyISODateTime,anyString}=matchers,assert=require('assert/strict'),sinon=require(_0x500dc3(0x98)),jobManager=require('../../../core/server/services/jobs/job-service'),models=require(_0x500dc3(0xe2)),settingsHelpers=require(_0x500dc3(0xbe)),matchEmail={'id':anyObjectId,'uuid':anyUuid,'created_at':anyISODateTime,'updated_at':anyISODateTime,'submitted_at':anyISODateTime},matchEmailNewsletter={...matchEmail,'newsletter_id':anyObjectId},matchBatch={'id':anyObjectId,'provider_id':anyString,'created_at':anyISODateTime,'updated_at':anyISODateTime},matchFailure={'id':anyObjectId,'failed_at':anyISODateTime,'event_id':anyString};function _0x200c(_0x50da39,_0x2f1a1e){const _0x25c6f3=_0x25c6();return _0x200c=function(_0x200c42,_0x24bd41){_0x200c42=_0x200c42-0x96;let _0x22d097=_0x25c6f3[_0x200c42];return _0x22d097;},_0x200c(_0x50da39,_0x2f1a1e);}describe(_0x500dc3(0xde),function(){const _0x2c5eec=_0x500dc3,_0x434fe7={'hhVCT':_0x2c5eec(0xb9),'ASRfS':_0x2c5eec(0xb4),'ZUUvh':_0x2c5eec(0xae),'EwQEx':_0x2c5eec(0xaa),'aBucr':function(_0x1d15d6,_0x6de710){return _0x1d15d6(_0x6de710);},'KsxSi':_0x2c5eec(0xd2),'xnPzA':_0x2c5eec(0xc3),'DtgeR':_0x2c5eec(0xe0),'nSIxx':'lexical','taGEc':_0x2c5eec(0xce),'KgLZU':function(_0x4ccde5,_0x1a8b86,_0x582399){return _0x4ccde5(_0x1a8b86,_0x582399);},'dlVdK':_0x2c5eec(0x9f),'PmuYO':'Can\x20browse\x20email\x20batches','dqYAQ':function(_0x181711,_0x233bd4,_0x22d0dd){return _0x181711(_0x233bd4,_0x22d0dd);},'uurVN':'Can\x20browse\x20email\x20batches\x20with\x20recipient\x20count','zHBLq':'Can\x20browse\x20all\x20email\x20failures','aVqMR':function(_0x35333c,_0x2e58ae,_0x413d17){return _0x35333c(_0x2e58ae,_0x413d17);},'nbQjM':_0x2c5eec(0xc8),'kucIU':function(_0x45cfb6,_0x199903,_0x104787){return _0x45cfb6(_0x199903,_0x104787);},'NFTsW':_0x2c5eec(0xd1)};let _0x17e3d7;before(async function(){const _0x12bb8b=_0x2c5eec;_0x17e3d7=await agentProvider['getAdminAPIAgent'](),await fixtureManager['init'](_0x434fe7['hhVCT'],_0x434fe7[_0x12bb8b(0xcc)],'members','members:emails:failed'),await _0x17e3d7['loginAsOwner']();}),_0x434fe7[_0x2c5eec(0xa1)](beforeEach,function(){const _0x7d5f01=_0x2c5eec;mockManager['mockEvents'](),mockManager[_0x7d5f01(0x9a)](),sinon[_0x7d5f01(0xbd)](settingsHelpers,_0x7d5f01(0xa2))[_0x7d5f01(0xa6)](_0x434fe7['ZUUvh']);}),afterEach(function(){const _0x168e97=_0x2c5eec;mockManager[_0x168e97(0xba)](),sinon[_0x168e97(0xba)]();}),it(_0x434fe7[_0x2c5eec(0xb3)],async function(){const _0xce4829=_0x2c5eec;await _0x17e3d7['get'](_0x434fe7[_0xce4829(0xb6)])['expectStatus'](0xc8)[_0xce4829(0xda)]({'emails':new Array(0x2)[_0xce4829(0xaf)](matchEmail)})[_0xce4829(0xe1)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0x434fe7[_0x2c5eec(0xa4)](it,'Can\x20read\x20an\x20email',async function(){const _0x4c65d7=_0x2c5eec;await _0x17e3d7[_0x4c65d7(0xc0)](_0x4c65d7(0xdb)+fixtureManager['get'](_0x434fe7[_0x4c65d7(0xb6)],0x0)['id']+'/')[_0x4c65d7(0xcd)](0xc8)[_0x4c65d7(0xda)]({'emails':[matchEmail]})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x434fe7[_0x2c5eec(0xc6)],async function(){const _0x3e54b6=_0x2c5eec;await _0x17e3d7[_0x3e54b6(0xd6)](_0x3e54b6(0xdb)+fixtureManager[_0x3e54b6(0xc0)](_0x3e54b6(0xaa),0x1)['id']+_0x3e54b6(0xbf))[_0x3e54b6(0xcd)](0xc8)[_0x3e54b6(0xda)]({'emails':[matchEmail]})[_0x3e54b6(0xe1)]({'content-version':anyContentVersion,'etag':anyEtag}),await jobManager[_0x3e54b6(0x9e)](),mockManager[_0x3e54b6(0xb0)]['emittedEvent'](_0x3e54b6(0xa0));}),_0x434fe7[_0x2c5eec(0xa4)](it,_0x434fe7[_0x2c5eec(0xbb)],async function(){const _0x2bd876=_0x2c5eec;await _0x17e3d7['get'](_0x2bd876(0xdb)+fixtureManager['get'](_0x434fe7[_0x2bd876(0xb6)],0x0)['id']+_0x2bd876(0xdf))[_0x2bd876(0xcd)](0xc8)[_0x2bd876(0xda)]({'batches':[matchBatch]})[_0x2bd876(0xe1)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0x434fe7[_0x2c5eec(0xd0)](it,_0x434fe7[_0x2c5eec(0x99)],async function(){const _0x5ea5d4=_0x2c5eec,{body:_0x42e82b}=await _0x17e3d7[_0x5ea5d4(0xc0)]('emails/'+fixtureManager[_0x5ea5d4(0xc0)](_0x434fe7[_0x5ea5d4(0xb6)],0x0)['id']+'/batches/?include=count.recipients')['expectStatus'](0xc8)[_0x5ea5d4(0xda)]({'batches':[matchBatch]})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});assert['equal'](_0x42e82b[_0x5ea5d4(0xb8)][0x0][_0x5ea5d4(0xc4)][_0x5ea5d4(0xad)],0x6);}),it(_0x434fe7[_0x2c5eec(0x9d)],async function(){const _0x4e2973=_0x2c5eec;await _0x17e3d7[_0x4e2973(0xc0)](_0x4e2973(0xdb)+fixtureManager[_0x4e2973(0xc0)]('emails',0x0)['id']+_0x4e2973(0xc7))[_0x4e2973(0xcd)](0xc8)[_0x4e2973(0xda)]({'failures':new Array(0x5)[_0x4e2973(0xaf)](matchFailure)})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});}),_0x434fe7[_0x2c5eec(0xc5)](it,_0x2c5eec(0x9b),async function(){const _0x460fe6=_0x2c5eec;await _0x17e3d7[_0x460fe6(0xc0)]('emails/'+fixtureManager['get'](_0x434fe7[_0x460fe6(0xb6)],0x0)['id']+_0x460fe6(0xa5))[_0x460fe6(0xcd)](0xc8)['matchBodySnapshot']({'failures':new Array(0x1)[_0x460fe6(0xaf)](matchFailure)})[_0x460fe6(0xe1)]({'content-version':anyContentVersion,'etag':anyEtag});}),it(_0x434fe7[_0x2c5eec(0xc1)],async function(){const _0x2566ff=_0x2c5eec;await _0x17e3d7[_0x2566ff(0xc0)](_0x2566ff(0xdb)+fixtureManager[_0x2566ff(0xc0)](_0x434fe7[_0x2566ff(0xb6)],0x0)['id']+_0x2566ff(0x97))['expectStatus'](0xc8)[_0x2566ff(0xda)]({'failures':new Array(0x4)[_0x2566ff(0xaf)](matchFailure)})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});}),_0x434fe7[_0x2c5eec(0xdd)](it,_0x434fe7[_0x2c5eec(0xa9)],async function(){const _0x2d1101=_0x2c5eec;await _0x17e3d7[_0x2d1101(0xc0)](_0x2d1101(0xdb)+fixtureManager[_0x2d1101(0xc0)](_0x434fe7['EwQEx'],0x0)['id']+'/recipient-failures/?order=failed_at%20DESC&include=member,email_recipient')['expectStatus'](0xc8)[_0x2d1101(0xda)]({'failures':new Array(0x5)[_0x2d1101(0xaf)]({...matchFailure,'member':{'id':anyObjectId,'uuid':anyUuid},'email_recipient':{'id':anyObjectId,'member_uuid':anyUuid,'opened_at':_0x434fe7[_0x2d1101(0xa1)](nullable,anyISODateTime),'delivered_at':_0x434fe7['aBucr'](nullable,anyISODateTime),'failed_at':nullable(anyISODateTime),'processed_at':anyISODateTime,'batch_id':anyObjectId}})})[_0x2d1101(0xe1)]({'content-version':anyContentVersion,'etag':anyEtag});}),_0x434fe7['KgLZU'](it,_0x2c5eec(0xcf),async function(){const _0x3f179a=_0x2c5eec,_0xd3016c=_0x434fe7['KsxSi'],_0x124108=_0x3f179a(0xa3),_0x18cee8=await models[_0x3f179a(0xb7)][_0x3f179a(0xb2)]({'post_id':fixtureManager['get'](_0x434fe7[_0x3f179a(0xcb)],0x2)['id'],'newsletter_id':fixtureManager[_0x3f179a(0xc0)](_0x3f179a(0xb4),0x0)['id'],'status':'submitted','submitted_at':new Date(),'track_opens':![],'track_clicks':![],'feedback_enabled':![],'recipient_filter':_0x434fe7[_0x3f179a(0xc9)],'subject':_0x3f179a(0xbc),'from':_0x434fe7['DtgeR'],'replyTo':null,'email_count':0x1,'source':'{}','source_type':_0x434fe7[_0x3f179a(0xab)],'html':_0xd3016c,'plaintext':_0x124108}),{body:_0x43138d}=await _0x17e3d7[_0x3f179a(0xc0)]('emails/'+_0x18cee8['id']+'/')[_0x3f179a(0xcd)](0xc8)[_0x3f179a(0xda)]({'emails':[matchEmailNewsletter]})['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag});assert[_0x3f179a(0xca)](_0x43138d[_0x3f179a(0xaa)][0x0][_0x3f179a(0xa7)][_0x3f179a(0x96)](_0x3f179a(0xac)),![]),assert[_0x3f179a(0xca)](_0x43138d[_0x3f179a(0xaa)][0x0][_0x3f179a(0xa8)][_0x3f179a(0x96)](_0x3f179a(0xac)),![]);});});