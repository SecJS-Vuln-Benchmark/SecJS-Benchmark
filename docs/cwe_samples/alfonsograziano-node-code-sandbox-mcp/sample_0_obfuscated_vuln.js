const _0x2f71fd=_0xfbc2;(function(_0x374e3d,_0x4a7b38){const _0x575289=_0xfbc2,_0x5be115=_0x374e3d();while(!![]){try{const _0x1e98c6=parseInt(_0x575289(0xe1))/0x1+-parseInt(_0x575289(0x100))/0x2*(-parseInt(_0x575289(0x106))/0x3)+parseInt(_0x575289(0xd6))/0x4*(parseInt(_0x575289(0xf5))/0x5)+-parseInt(_0x575289(0xe0))/0x6+parseInt(_0x575289(0xdd))/0x7+-parseInt(_0x575289(0xe4))/0x8*(parseInt(_0x575289(0x101))/0x9)+-parseInt(_0x575289(0xd2))/0xa;if(_0x1e98c6===_0x4a7b38)break;else _0x5be115['push'](_0x5be115['shift']());}catch(_0x348597){_0x5be115['push'](_0x5be115['shift']());}}}(_0x585d,0xc4123),require('../../core/server/overrides'));const {sequence}=require(_0x2f71fd(0xd9)),debug=require('@tryghost/debug')('test:utils'),_=require(_0x2f71fd(0x109)),models=require('../../core/server/models'),e2eUtils=require(_0x2f71fd(0xeb)),APIUtils=require(_0x2f71fd(0x104)),dbUtils=require(_0x2f71fd(0xec)),fixtureUtils=require('./fixture-utils'),redirects=require(_0x2f71fd(0xdb)),cacheRules=require(_0x2f71fd(0x102)),context=require(_0x2f71fd(0xd7)),DataGenerator=require(_0x2f71fd(0xfb)),filterData=require(_0x2f71fd(0xf1));function _0x585d(){const _0x370d33=['lodash','stopGhost','fixtures','clearData','locals','4287840jMrMwu','getExistingData','Content','root','4dLHucX','./fixtures/context','transform','@tryghost/promise','createEmail','./redirects','email','2129911flFRcd','Post','Setup\x20end','5237826stPpaA','924316CePnoX','templateOptions','data','9880352MBqonE','add','JBPDV','role','roles','renderObject','teardown','./e2e-utils','./db-utils','startGhost','merge','then','exports','./fixtures/filter-param','forKnex','truncate','_locals','4113805sELUnh','initData','knex','fetchAll','getFixtureOps','toJSON','./fixtures/data-generator','user','internal','User','apply','1288556aZsCKA','9ijkBIQ','./fixtures/cache-rules','post','./api','jWjRa','6rKCDCo','post_id','setupFile'];_0x585d=function(){return _0x370d33;};return _0x585d();}function _0xfbc2(_0x4af317,_0x416df3){const _0x585dd1=_0x585d();return _0xfbc2=function(_0xfbc206,_0x241a3f){_0xfbc206=_0xfbc206-0xcf;let _0x3919c2=_0x585dd1[_0xfbc206];return _0x3919c2;},_0xfbc2(_0x4af317,_0x416df3);}require('./assertions');const initFixtures=function initFixtures(){const _0x36961c=_0x2f71fd,_0x3e694e=_[_0x36961c(0xee)]({'init':!![]},_[_0x36961c(0xd8)](arguments,function(_0x528c7c,_0x170ee2){const _0x3979db=_0x36961c;if(_0x3979db(0x105)===_0x3979db(0xe6))return _0x20b7de;else _0x528c7c[_0x170ee2]=!![];})),_0x550bf0=fixtureUtils[_0x36961c(0xf9)](_0x3e694e);return sequence(_0x550bf0);},setup=function setup(){const _0x1eba25=this,_0x20a009=arguments;return function _0x490bf4(){const _0x4569c1=_0xfbc2;return debug('Setup\x20start'),models['init'](),initFixtures[_0x4569c1(0xff)](_0x1eba25,_0x20a009)['finally'](()=>{const _0x52e65c=_0x4569c1;debug(_0x52e65c(0xdf));});};},createUser=function createUser(_0x247a20){const _0x3fac3f=_0x2f71fd,_0x334758=_0x247a20[_0x3fac3f(0xfc)],_0x5c4672=_0x247a20[_0x3fac3f(0xe7)];return models['Role'][_0x3fac3f(0xf8)](context['internal'])[_0x3fac3f(0xef)](function(_0xb5d40f){const _0x244a4e=_0x3fac3f;return _0xb5d40f=_0xb5d40f[_0x244a4e(0xfa)](),_0x334758[_0x244a4e(0xe8)]=[_['find'](_0xb5d40f,{'name':_0x5c4672})],models[_0x244a4e(0xfe)][_0x244a4e(0xe5)](_0x334758,context[_0x244a4e(0xfd)])['then'](function(){return _0x334758;});});},createPost=function createPost(_0x4c8e46){const _0x159266=_0x2f71fd,_0x4d379f=DataGenerator['forKnex']['createPost'](_0x4c8e46[_0x159266(0x103)]);return models[_0x159266(0xde)][_0x159266(0xe5)](_0x4d379f,context[_0x159266(0xfd)]);},createEmail=function createEmail(_0x2624de){const _0x3ffc8f=_0x2f71fd,_0x542bad=DataGenerator[_0x3ffc8f(0xf2)][_0x3ffc8f(0xda)](_0x2624de[_0x3ffc8f(0xdc)]);return models['Email']['add'](_0x542bad,context[_0x3ffc8f(0xfd)]);},createEmailedPost=async function createEmailedPost({postOptions:_0x557493,emailOptions:_0x17cc9e}){const _0x3094e5=_0x2f71fd,_0x2df048=await createPost(_0x557493);_0x17cc9e[_0x3094e5(0xdc)][_0x3094e5(0x107)]=_0x2df048['id'];const _0x1c710d=await createEmail(_0x17cc9e);return{'post':_0x2df048,'email':_0x1c710d};};module[_0x2f71fd(0xf0)]={'startGhost':e2eUtils[_0x2f71fd(0xed)],'stopGhost':e2eUtils[_0x2f71fd(0x10a)],'getExistingData':e2eUtils[_0x2f71fd(0xd3)],'teardownDb':dbUtils[_0x2f71fd(0xea)],'truncate':dbUtils[_0x2f71fd(0xf3)],'knex':dbUtils[_0x2f71fd(0xf7)],'setup':setup,'createUser':createUser,'createPost':createPost,'createEmailedPost':createEmailedPost,'createHbsResponse':function createHbsResponse(_0x410456){const _0x3f6cf9=_0x2f71fd,_0x12b121=_0x410456[_0x3f6cf9(0xe9)]||{},_0x4110cc=_0x410456[_0x3f6cf9(0xe2)],_0x5a386b=_0x410456[_0x3f6cf9(0xd1)]||{},_0x4496df={'data':{'site':{},'config':{},'labs':{},'root':{'_locals':{}}}};return _['merge'](_0x4496df[_0x3f6cf9(0xe3)],_0x4110cc),_[_0x3f6cf9(0xee)](_0x4496df[_0x3f6cf9(0xe3)]['root'],_0x12b121),_[_0x3f6cf9(0xee)](_0x4496df[_0x3f6cf9(0xe3)][_0x3f6cf9(0xd5)],_0x5a386b),_0x4496df['data'][_0x3f6cf9(0xd5)][_0x3f6cf9(0xf4)]=_0x5a386b,_0x4496df;},'initFixtures':initFixtures,'initData':dbUtils[_0x2f71fd(0xf6)],'clearData':dbUtils[_0x2f71fd(0xd0)],'setupRedirectsFile':redirects[_0x2f71fd(0x108)],'fixtures':fixtureUtils[_0x2f71fd(0xcf)],'DataGenerator':DataGenerator,'filterData':filterData,'API':APIUtils({'getFixtureOps':fixtureUtils[_0x2f71fd(0xf9)]}),'context':context,'permissions':{'owner':{'user':{'roles':[DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x3]]}},'admin':{'user':{'roles':[DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x0]]}},'editor':{'user':{'roles':[DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x1]]}},'author':{'user':{'roles':[DataGenerator[_0x2f71fd(0xd4)]['roles'][0x2]]}},'contributor':{'user':{'roles':[DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x4]]}}},'roles':{'ids':{'owner':DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x3]['id'],'admin':DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x0]['id'],'editor':DataGenerator['Content'][_0x2f71fd(0xe8)][0x1]['id'],'author':DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x2]['id'],'contributor':DataGenerator[_0x2f71fd(0xd4)][_0x2f71fd(0xe8)][0x4]['id']}},'cacheRules':cacheRules};