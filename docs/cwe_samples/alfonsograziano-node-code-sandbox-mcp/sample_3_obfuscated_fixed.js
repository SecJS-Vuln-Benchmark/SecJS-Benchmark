const _0x286fd3=_0xf62d;(function(_0x22a52a,_0x407374){const _0x5e125d=_0xf62d,_0x5b6c58=_0x22a52a();while(!![]){try{const _0x133abb=-parseInt(_0x5e125d(0x27c))/0x1+-parseInt(_0x5e125d(0x24d))/0x2*(parseInt(_0x5e125d(0x212))/0x3)+parseInt(_0x5e125d(0x25b))/0x4+-parseInt(_0x5e125d(0x20d))/0x5+-parseInt(_0x5e125d(0x216))/0x6+-parseInt(_0x5e125d(0x28f))/0x7+-parseInt(_0x5e125d(0x273))/0x8*(-parseInt(_0x5e125d(0x239))/0x9);if(_0x133abb===_0x407374)break;else _0x5b6c58['push'](_0x5b6c58['shift']());}catch(_0x1e11e0){_0x5b6c58['push'](_0x5b6c58['shift']());}}}(_0x1784,0xcc48a));function _0x1784(){const _0x18f14f=['not','EdIXJ','YKjKC','oCJar','XlGim','../../../core/server/services/settings-helpers','RZCXn','1898390FJEtai','forKnex','uuid','RAXNa','vWiPA','3VSiKuz','cyvEp','test-validation-key','uses\x20the\x20newsletter\x20provided\x20through\x20?newsletter=slug','2311950BPexSe','can\x20read\x20post\x20email\x20preview\x20with\x20email\x20card\x20and\x20replacements','matchSnapshot','loginAsAdmin','GWDRX','BMwFC','wkNCs','This\x20is\x20the\x20actual\x20post\x20content...','users','Xelbu','BDtCW','As\x20Owner','clpRh','guRlR','uses\x20the\x20posts\x20newsletter\x20by\x20default','HcKkg','XDBSy','init','nfnzL','Newsletter','rJbWL','draft','DGhQF','Should\x20use\x20a\x20non-default\x20newsletter\x20for\x20this\x20test','slug','ZspCU','email_previews/posts/','expectStatus','tYdLA','FWCTD','eql','Jzgdu','loginAsContributor','replace','expect','15040863LSdUAm','XxigO','lodash/escapeRegExp','loginAsEditor','getMembersValidationKey','OJmcg','WlDhp','EyTFb','uiJnG','rxVZI','requested-newsletter-uuid','error','mBlsW','newsletters','post','TIyyL','JfSJl','Ljjga','restore','PaDgc','230870IsFFtU','wzNgR','wRWxm','TwOVo','YxVdm','UqHJu','plaintext','LBPGs','@tryghost/logging','urrLs','xRnmr','bGEYS','test@ghost.org','sqouL','1829992xfLeir','As\x20Admin','GfhKu','should','email_previews','stub','getAdminAPIAgent','Read','hbRCI','add','rDpVl','kgspF','asrPK','GcyDh','mhwnl','{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[],\x22markups\x22:[[\x22a\x22,[\x22href\x22,\x22https://ghost.org\x22]]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Testing\x20\x22],[0,[0],1,\x22links\x22],[0,[],0,\x22\x20in\x20email\x20excerpt\x20and\x20apostrophes\x20\x27\x22]]]]}','default','can\x20read\x20post\x20email\x20preview\x20with\x20fields','Post','jbMxh','oakRP','match','assert/strict','toHexString','16viBqPc','name','qkCGW','jCFJc','TfMqy','DataGenerator','As\x20Contributor','OlStc','xSSJw','1182851YTYLDZ','returns','woTfO','expectEmptyBody','../../../core/server/models/index','can\x20send\x20test\x20email','html','/?newsletter=','get','bAPVJ','mockMailgun','can\x27t\x20retrieve\x20for\x20non\x20existent\x20post','vYKbC','calledOnce','posts','matchHeaderSnapshot','KBnYF','createPost','d52c42ae-2755-455c-80ec-70b2ec55c904','6299139NdgbaL','getDefaultNewsletter','../../utils','hoXbo','ROtaA','<p>This\x20is\x20the\x20actual\x20post\x20content...</p>','cMAcq','CEvgB','RRirm','Qxnkq','assert','email-only-card','YYcSR','body','yJTIp','afPak','Email\x20Preview\x20API','oKzvY','As\x20Author','matchBodySnapshot','Post\x20with\x20email-only\x20card','dALDr','{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[[\x22email\x22,{\x22html\x22:\x22<p>Hey\x20{first_name\x20\x5c\x22there\x5c\x22}\x20{unknown}</p><p><strong>Welcome\x20to\x20your\x20first\x20Ghost\x20email!</strong></p>\x22}],[\x22email\x22,{\x22html\x22:\x22<p>Another\x20email\x20card\x20with\x20a\x20similar\x20replacement,\x20{first_name,\x20\x5c\x22see?\x5c\x22}</p>\x22}]],\x22markups\x22:[],\x22sections\x22:[[10,0],[1,\x22p\x22,[[0,[],0,\x22This\x20is\x20the\x20actual\x20post\x20content...\x22]]],[10,1],[1,\x22p\x22,[]]]}','doesNotMatch'];_0x1784=function(){return _0x18f14f;};return _0x1784();}const {agentProvider,fixtureManager,matchers,mockManager}=require('../../utils/e2e-framework'),{anyEtag,anyErrorId,anyContentVersion,anyString}=matchers,assert=require(_0x286fd3(0x271)),sinon=require('sinon'),escapeRegExp=require(_0x286fd3(0x23b)),should=require(_0x286fd3(0x25e)),settingsHelpers=require(_0x286fd3(0x20b)),ObjectId=require('bson-objectid')[_0x286fd3(0x26b)],testUtils=require(_0x286fd3(0x291)),models=require(_0x286fd3(0x280)),logging=require(_0x286fd3(0x255));function _0xf62d(_0x4e6753,_0x4c1ef2){const _0x1784d8=_0x1784();return _0xf62d=function(_0xf62dfa,_0x331e5f){_0xf62dfa=_0xf62dfa-0x1f1;let _0x4ab1bc=_0x1784d8[_0xf62dfa];return _0x4ab1bc;},_0xf62d(_0x4e6753,_0x4c1ef2);}function testCleanedSnapshot(_0x30fc09,_0x1e507e){const _0x200e9a=_0x286fd3,_0x407492={'EdIXJ':function(_0x932137,_0x4e7cc1){return _0x932137(_0x4e7cc1);}};for(const [_0xe8a302,_0x472ad4]of Object['entries'](_0x1e507e)){_0x30fc09=_0x30fc09[_0x200e9a(0x237)](new RegExp(_0x407492[_0x200e9a(0x207)](escapeRegExp,_0xe8a302),'g'),_0x472ad4);}should({'html':_0x30fc09})[_0x200e9a(0x218)]();}const matchEmailPreviewBody={'email_previews':[{'html':anyString,'plaintext':anyString}]};describe(_0x286fd3(0x1fe),function(){const _0x5a77c4=_0x286fd3,_0x409464={'GfhKu':'getMembersValidationKey','afPak':_0x5a77c4(0x214),'XxigO':function(_0x38928d,_0x17adaf){return _0x38928d(_0x17adaf);},'xSSJw':function(_0x213c8e,_0x3e87df){return _0x213c8e===_0x3e87df;},'woTfO':_0x5a77c4(0x251),'tYdLA':'glnQV','BMwFC':_0x5a77c4(0x246),'Jzgdu':function(_0x1b0a74,_0xc9d149,_0xfcfaee){return _0x1b0a74(_0xc9d149,_0xfcfaee);},'OlStc':_0x5a77c4(0x28a),'sqouL':function(_0x247458,_0x5c270c){return _0x247458(_0x5c270c);},'vWiPA':_0x5a77c4(0x202),'govGt':'This\x20is\x20the\x20actual\x20post\x20content...','HcKkg':_0x5a77c4(0x28e),'OJmcg':function(_0x33b49e,_0x50400b,_0x208426){return _0x33b49e(_0x50400b,_0x208426);},'wkNCs':_0x5a77c4(0x26a),'GWDRX':_0x5a77c4(0x241),'TfMqy':_0x5a77c4(0x287),'XDBSy':function(_0xe94539,_0x15bcac,_0x481fe9){return _0xe94539(_0x15bcac,_0x481fe9);},'AgiCe':_0x5a77c4(0x217),'RZCXn':function(_0x1081dd,_0x237303,_0x102339){return _0x1081dd(_0x237303,_0x102339);},'dALDr':_0x5a77c4(0x224),'FWCTD':_0x5a77c4(0x281),'WlDhp':_0x5a77c4(0x22c),'cgwhg':_0x5a77c4(0x20f),'ApUuc':_0x5a77c4(0x256),'LBPGs':_0x5a77c4(0x244),'rJbWL':'cannot\x20send\x20test\x20email','mlyUT':_0x5a77c4(0x243),'TIyyL':function(_0x25666b,_0x640a5b,_0x4bd0d0){return _0x25666b(_0x640a5b,_0x4bd0d0);},'RXMFM':_0x5a77c4(0x262),'asrPK':function(_0x3a7295,_0x1d2c25,_0xdde0fb){return _0x3a7295(_0x1d2c25,_0xdde0fb);},'XlGim':_0x5a77c4(0x221),'bGEYS':'As\x20Editor','XpycW':function(_0x9fd609,_0x80486d,_0x2d640c){return _0x9fd609(_0x80486d,_0x2d640c);},'oQQLB':_0x5a77c4(0x279)};let _0x7b16f9;afterEach(function(){const _0x13c224=_0x5a77c4;mockManager[_0x13c224(0x24b)](),sinon[_0x13c224(0x24b)]();}),beforeEach(function(){const _0x3c10b9=_0x5a77c4;mockManager[_0x3c10b9(0x286)](),sinon[_0x3c10b9(0x260)](settingsHelpers,_0x409464[_0x3c10b9(0x25d)])[_0x3c10b9(0x27d)](_0x409464[_0x3c10b9(0x1fd)]);}),before(async function(){const _0x3c3878=_0x5a77c4;_0x409464[_0x3c3878(0x27b)](_0x409464[_0x3c3878(0x27e)],_0x409464[_0x3c3878(0x232)])?_0x1acfef=_0x57ff9f[_0x3c3878(0x237)](new _0xc44193(_0x409464[_0x3c3878(0x23a)](_0x321108,_0x1c73aa),'g'),_0x54311d):(_0x7b16f9=await agentProvider[_0x3c3878(0x261)](),await fixtureManager[_0x3c3878(0x227)](_0x3c3878(0x21e),_0x409464[_0x3c3878(0x21b)],_0x3c3878(0x28a)),await _0x7b16f9['loginAsOwner']());}),describe(_0x409464['RXMFM'],function(){const _0x49441d=_0x5a77c4,_0x3b00dc={'oCJar':'email_previews/posts/abcd1234abcd1234abcd1234/','mBlsW':function(_0xab96a7,_0x175438,_0x272d02){return _0xab96a7(_0x175438,_0x272d02);},'YYcSR':_0x49441d(0x243),'ROtaA':function(_0x5a28ae){return _0x5a28ae();},'nTsfV':_0x409464[_0x49441d(0x211)],'hbRCI':_0x49441d(0x204),'JfSJl':_0x49441d(0x1f3),'oakRP':_0x409464['govGt'],'xRnmr':_0x409464[_0x49441d(0x225)],'jCgjt':function(_0x5b7620,_0x3ca680){return _0x5b7620===_0x3ca680;},'hoXbo':_0x49441d(0x20f),'wRWxm':function(_0x43fa24,_0x32aa8d,_0x53a4bd){const _0xe1170f=_0x49441d;return _0x409464[_0xe1170f(0x23e)](_0x43fa24,_0x32aa8d,_0x53a4bd);},'rxVZI':_0x49441d(0x1f9),'YKjKC':'yiCGI','MzpYR':_0x49441d(0x265),'wzNgR':_0x49441d(0x246),'TGXNQ':'scheduled','BDtCW':_0x49441d(0x22d),'yJTIp':function(_0x49ee90){return _0x49ee90();},'CBjYQ':_0x409464[_0x49441d(0x21c)]};if('WHATK'!==_0x409464[_0x49441d(0x21a)])it(_0x409464[_0x49441d(0x277)],async function(){const _0x272bc9=_0x49441d;await _0x7b16f9[_0x272bc9(0x284)](_0x3b00dc[_0x272bc9(0x209)])[_0x272bc9(0x231)](0x194)[_0x272bc9(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x272bc9(0x201)]({'errors':[{'id':anyErrorId}]});}),it(_0x49441d(0x26c),async function(){const _0x1e143f=_0x49441d,_0x2c5afb={'nfnzL':function(_0x383b7d,_0x15918f,_0x576b5b){return _0x383b7d(_0x15918f,_0x576b5b);},'KBnYF':_0x1e143f(0x20f),'CNXlE':function(_0x1e40f2,_0x1a96e7,_0xafa5f7){const _0x392dda=_0x1e143f;return _0x409464[_0x392dda(0x235)](_0x1e40f2,_0x1a96e7,_0xafa5f7);},'RRirm':_0x1e143f(0x243)};if('cBVxf'===_0x1e143f(0x275))_0x5bc012[_0x1e143f(0x205)](_0x33f923[_0x1e143f(0x25f)][0x0][_0x1e143f(0x282)],/Testing links in email excerpt and apostrophes &apos;/),_0x44024a[_0x1e143f(0x270)](_0x2863d9[_0x1e143f(0x25f)][0x0]['html'],/Testing links in email excerpt and apostrophes &#39;/),_0x2c5afb[_0x1e143f(0x228)](_0x2e9593,_0x2503c9[_0x1e143f(0x25f)][0x0][_0x1e143f(0x282)],{[_0x3eb1a1['get'](_0x2c5afb[_0x1e143f(0x28c)])]:_0x1e143f(0x243)}),_0x211808(_0x3558bb[_0x1e143f(0x25f)][0x0]['plaintext'],{[_0x422671['get'](_0x2c5afb[_0x1e143f(0x28c)])]:'requested-newsletter-uuid'});else{const _0x1b1b74=await models['Newsletter'][_0x1e143f(0x290)]();await _0x7b16f9['get']('email_previews/posts/'+fixtureManager['get'](_0x409464[_0x1e143f(0x27a)],0x0)['id']+'/')[_0x1e143f(0x231)](0xc8)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x1e143f(0x201)](matchEmailPreviewBody)['expect'](({body:_0x4c86a6})=>{const _0x357a47=_0x1e143f;testCleanedSnapshot(_0x4c86a6[_0x357a47(0x25f)][0x0]['html'],{[_0x1b1b74['get'](_0x2c5afb[_0x357a47(0x28c)])]:_0x357a47(0x243)}),_0x2c5afb['CNXlE'](testCleanedSnapshot,_0x4c86a6[_0x357a47(0x25f)][0x0]['plaintext'],{[_0x1b1b74[_0x357a47(0x284)](_0x2c5afb[_0x357a47(0x28c)])]:_0x2c5afb[_0x357a47(0x1f6)]});});}}),_0x409464[_0x49441d(0x226)](it,_0x409464['AgiCe'],async function(){const _0x3c0175=_0x49441d,_0x3dc332=await models['Newsletter']['getDefaultNewsletter'](),_0x4bc97c=testUtils[_0x3c0175(0x278)][_0x3c0175(0x20e)]['createPost']({'id':_0x3b00dc[_0x3c0175(0x1f2)](ObjectId)[_0x3c0175(0x272)](),'title':_0x3b00dc['nTsfV'],'slug':_0x3c0175(0x1f9),'mobiledoc':_0x3b00dc[_0x3c0175(0x263)],'html':_0x3b00dc['JfSJl'],'plaintext':_0x3b00dc[_0x3c0175(0x26f)],'status':_0x3c0175(0x22b),'uuid':_0x3b00dc['xRnmr'],'published_at':new Date(0x0)});await models[_0x3c0175(0x26d)]['add'](_0x4bc97c,{'context':{'internal':!![]}}),await _0x7b16f9[_0x3c0175(0x284)](_0x3c0175(0x230)+_0x4bc97c['id']+'/')['expectStatus'](0xc8)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x3c0175(0x201)](matchEmailPreviewBody)[_0x3c0175(0x238)](({body:_0x44f9fa})=>{const _0x28ff4e=_0x3c0175;_0x3b00dc[_0x28ff4e(0x245)](testCleanedSnapshot,_0x44f9fa[_0x28ff4e(0x25f)][0x0][_0x28ff4e(0x282)],{[_0x3dc332['get'](_0x28ff4e(0x20f))]:_0x3b00dc[_0x28ff4e(0x1fa)]}),testCleanedSnapshot(_0x44f9fa[_0x28ff4e(0x25f)][0x0][_0x28ff4e(0x253)],{[_0x3dc332[_0x28ff4e(0x284)](_0x28ff4e(0x20f))]:_0x28ff4e(0x243)});});}),it('has\x20custom\x20content\x20transformations\x20for\x20email\x20compatibility',async function(){const _0x23f3e9=_0x49441d,_0x48b442={'clpRh':_0x23f3e9(0x274),'PaDgc':function(_0x365436,_0x435529,_0xb78376){return _0x365436(_0x435529,_0xb78376);},'jbMxh':_0x3b00dc[_0x23f3e9(0x1fa)]},_0x56dded=await models[_0x23f3e9(0x229)][_0x23f3e9(0x290)](),_0x3d5795=testUtils[_0x23f3e9(0x278)][_0x23f3e9(0x20e)][_0x23f3e9(0x28d)]({'id':ObjectId()['toHexString'](),'title':'Post\x20with\x20email-only\x20card','slug':_0x3b00dc[_0x23f3e9(0x242)],'mobiledoc':_0x23f3e9(0x26a),'html':_0x3b00dc[_0x23f3e9(0x249)],'plaintext':_0x3b00dc[_0x23f3e9(0x26f)],'status':'draft','uuid':_0x3b00dc[_0x23f3e9(0x257)],'published_at':new Date(0x0)});await models['Post'][_0x23f3e9(0x264)](_0x3d5795,{'context':{'internal':!![]}}),await _0x7b16f9['get'](_0x23f3e9(0x230)+_0x3d5795['id']+'/')[_0x23f3e9(0x231)](0xc8)[_0x23f3e9(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x23f3e9(0x201)](matchEmailPreviewBody)['expect'](({body:_0x237ec2})=>{const _0x201af5=_0x23f3e9;_0x3b00dc['jCgjt'](_0x201af5(0x285),_0x201af5(0x240))?(_0xea1823[_0x201af5(0x205)](_0x3b18c3[_0x201af5(0x25f)][0x0]['html'],new _0x58caae(_0x371c14[_0x201af5(0x284)](_0x48b442[_0x201af5(0x222)]))),_0x10b609[_0x201af5(0x270)](_0x4bb639[_0x201af5(0x25f)][0x0][_0x201af5(0x282)],new _0x2658b6(_0x2f3a49[_0x201af5(0x274)])),_0x3d9c1d(_0x4e2068[_0x201af5(0x25f)][0x0][_0x201af5(0x282)],{[_0x4508cb['uuid']]:_0x201af5(0x243)}),_0x48b442[_0x201af5(0x24c)](_0xcbf695,_0xb3f9de[_0x201af5(0x25f)][0x0][_0x201af5(0x253)],{[_0x211230[_0x201af5(0x20f)]]:_0x48b442[_0x201af5(0x26e)]})):(assert[_0x201af5(0x205)](_0x237ec2[_0x201af5(0x25f)][0x0][_0x201af5(0x282)],/Testing links in email excerpt and apostrophes &apos;/),assert[_0x201af5(0x270)](_0x237ec2[_0x201af5(0x25f)][0x0][_0x201af5(0x282)],/Testing links in email excerpt and apostrophes &#39;/),testCleanedSnapshot(_0x237ec2['email_previews'][0x0][_0x201af5(0x282)],{[_0x56dded['get'](_0x3b00dc['hoXbo'])]:_0x3b00dc['YYcSR']}),_0x3b00dc[_0x201af5(0x24f)](testCleanedSnapshot,_0x237ec2[_0x201af5(0x25f)][0x0][_0x201af5(0x253)],{[_0x56dded[_0x201af5(0x284)](_0x3b00dc[_0x201af5(0x1f1)])]:_0x3b00dc[_0x201af5(0x1fa)]}));});}),_0x409464['RZCXn'](it,_0x409464[_0x49441d(0x203)],async function(){const _0x2a0b17=_0x49441d,_0x487f68={'cyvEp':_0x3b00dc['hoXbo'],'mhwnl':_0x2a0b17(0x243)};if(_0x3b00dc['MzpYR']===_0x2a0b17(0x266))_0x5acec4[_0x2a0b17(0x24b)](),_0x319594[_0x2a0b17(0x24b)]();else{const _0x4e2f58=await models[_0x2a0b17(0x229)][_0x2a0b17(0x290)](),_0xf84b67=fixtureManager['get'](_0x3b00dc[_0x2a0b17(0x24e)],0x0);_0x4e2f58['id'][_0x2a0b17(0x25e)][_0x2a0b17(0x206)][_0x2a0b17(0x234)](_0xf84b67['id'],_0x2a0b17(0x22d));const _0xb30b78=testUtils['DataGenerator'][_0x2a0b17(0x20e)][_0x2a0b17(0x28d)]({'id':ObjectId()[_0x2a0b17(0x272)](),'title':'Post\x20with\x20email-only\x20card','slug':'email-only-card','mobiledoc':_0x2a0b17(0x26a),'html':_0x3b00dc[_0x2a0b17(0x249)],'plaintext':_0x2a0b17(0x21d),'status':_0x3b00dc['TGXNQ'],'uuid':_0x3b00dc[_0x2a0b17(0x257)],'newsletter_id':_0xf84b67['id'],'published_at':new Date(0x0)});await models['Post'][_0x2a0b17(0x264)](_0xb30b78,{'context':{'internal':!![]}}),await _0x7b16f9[_0x2a0b17(0x284)](_0x2a0b17(0x230)+_0xb30b78['id']+'/')[_0x2a0b17(0x231)](0xc8)[_0x2a0b17(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})['matchBodySnapshot'](matchEmailPreviewBody)[_0x2a0b17(0x238)](({body:_0x4bfdba})=>{const _0x411ae1=_0x2a0b17;_0x3b00dc[_0x411ae1(0x208)]===_0x411ae1(0x1f5)?(_0x3834ae(_0x385fdc[_0x411ae1(0x25f)][0x0]['html'],{[_0x2dc337[_0x411ae1(0x284)](_0x487f68[_0x411ae1(0x213)])]:_0x487f68[_0x411ae1(0x269)]}),_0x20bd32(_0x3e7081[_0x411ae1(0x25f)][0x0]['plaintext'],{[_0x2eee6f['get'](_0x487f68[_0x411ae1(0x213)])]:_0x487f68[_0x411ae1(0x269)]})):(assert[_0x411ae1(0x205)](_0x4bfdba[_0x411ae1(0x25f)][0x0][_0x411ae1(0x282)],new RegExp(_0x4e2f58['get'](_0x411ae1(0x274)))),assert['match'](_0x4bfdba['email_previews'][0x0][_0x411ae1(0x282)],new RegExp(_0xf84b67[_0x411ae1(0x274)])),_0x3b00dc[_0x411ae1(0x24f)](testCleanedSnapshot,_0x4bfdba[_0x411ae1(0x25f)][0x0][_0x411ae1(0x282)],{[_0xf84b67[_0x411ae1(0x20f)]]:_0x3b00dc[_0x411ae1(0x1fa)]}),testCleanedSnapshot(_0x4bfdba['email_previews'][0x0]['plaintext'],{[_0xf84b67['uuid']]:_0x3b00dc[_0x411ae1(0x1fa)]}));});}}),_0x409464[_0x49441d(0x20c)](it,_0x49441d(0x215),async function(){const _0x73d979=_0x49441d,_0xab1d08=await models[_0x73d979(0x229)][_0x73d979(0x290)](),_0x542762=fixtureManager[_0x73d979(0x284)](_0x3b00dc[_0x73d979(0x24e)],0x0);_0x542762['id'][_0x73d979(0x25e)][_0x73d979(0x206)][_0x73d979(0x234)](_0xab1d08['id'],_0x3b00dc[_0x73d979(0x220)]);const _0xaa034d=testUtils[_0x73d979(0x278)][_0x73d979(0x20e)][_0x73d979(0x28d)]({'id':_0x3b00dc[_0x73d979(0x1fc)](ObjectId)[_0x73d979(0x272)](),'title':_0x73d979(0x202),'slug':_0x3b00dc['rxVZI'],'mobiledoc':_0x3b00dc['CBjYQ'],'html':_0x3b00dc[_0x73d979(0x249)],'plaintext':'This\x20is\x20the\x20actual\x20post\x20content...','status':_0x73d979(0x22b),'uuid':_0x73d979(0x28e),'published_at':new Date(0x0)});await models[_0x73d979(0x26d)][_0x73d979(0x264)](_0xaa034d,{'context':{'internal':!![]}}),await _0x7b16f9['get'](_0x73d979(0x230)+_0xaa034d['id']+_0x73d979(0x283)+_0x542762[_0x73d979(0x22e)])['expectStatus'](0xc8)[_0x73d979(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x73d979(0x201)](matchEmailPreviewBody)[_0x73d979(0x238)](({body:_0x2b38a6})=>{const _0x3fa0f7=_0x73d979;assert[_0x3fa0f7(0x205)](_0x2b38a6['email_previews'][0x0][_0x3fa0f7(0x282)],new RegExp(_0xab1d08[_0x3fa0f7(0x284)](_0x3fa0f7(0x274)))),assert[_0x3fa0f7(0x270)](_0x2b38a6['email_previews'][0x0]['html'],new RegExp(_0x542762['name'])),testCleanedSnapshot(_0x2b38a6[_0x3fa0f7(0x25f)][0x0]['html'],{[_0x542762[_0x3fa0f7(0x20f)]]:_0x3fa0f7(0x243)}),_0x3b00dc[_0x3fa0f7(0x24f)](testCleanedSnapshot,_0x2b38a6[_0x3fa0f7(0x25f)][0x0][_0x3fa0f7(0x253)],{[_0x542762['uuid']]:_0x3b00dc[_0x3fa0f7(0x1fa)]});});});else{for(const [_0x2e621a,_0x549315]of _0x578673['entries'](_0x42d803)){_0x48024f=_0x1abde3[_0x49441d(0x237)](new _0x39ecc7(_0x1c335a(_0x2e621a),'g'),_0x549315);}_0x409464[_0x49441d(0x25a)](_0x11bc97,{'html':_0x11d50f})[_0x49441d(0x218)]();}}),_0x409464[_0x5a77c4(0x267)](describe,_0x409464[_0x5a77c4(0x20a)],function(){const _0x2ed38c=_0x5a77c4;it(_0x409464[_0x2ed38c(0x233)],async function(){const _0x5c4f1=_0x2ed38c;await _0x7b16f9[_0x5c4f1(0x247)](_0x5c4f1(0x230)+fixtureManager[_0x5c4f1(0x284)](_0x409464[_0x5c4f1(0x27a)],0x0)['id']+'/')[_0x5c4f1(0x1fb)]({'emails':[_0x5c4f1(0x259)]})[_0x5c4f1(0x231)](0xcc)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})['expectEmptyBody']();});}),describe(_0x5a77c4(0x25c),function(){const _0x197548=_0x5a77c4,_0x181303={'GcyDh':_0x409464[_0x197548(0x23f)],'Qxnkq':_0x197548(0x28a),'Xelbu':_0x197548(0x259)};_0x409464[_0x197548(0x23a)](before,async function(){const _0x53e979=_0x197548;await _0x7b16f9[_0x53e979(0x219)]();}),it(_0x197548(0x281),async function(){const _0x4e77f5=_0x197548;_0x4e77f5(0x1ff)!==_0x181303[_0x4e77f5(0x268)]?await _0x7b16f9[_0x4e77f5(0x247)]('email_previews/posts/'+fixtureManager[_0x4e77f5(0x284)](_0x181303[_0x4e77f5(0x1f7)],0x0)['id']+'/')[_0x4e77f5(0x1fb)]({'emails':[_0x181303[_0x4e77f5(0x21f)]]})[_0x4e77f5(0x231)](0xcc)[_0x4e77f5(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x4e77f5(0x27f)]():(_0x53640a['mockMailgun'](),_0x4e7744[_0x4e77f5(0x260)](_0x13cf8d,_0x4e77f5(0x23d))[_0x4e77f5(0x27d)](_0x4e77f5(0x214)));});}),describe(_0x409464[_0x5a77c4(0x258)],function(){const _0x1c1cf0=_0x5a77c4,_0x2020ef={'UqHJu':_0x409464['cgwhg'],'cMAcq':_0x1c1cf0(0x243),'TwOVo':_0x409464['ApUuc'],'Ljjga':'test@ghost.org'};before(async function(){const _0x36c6c8=_0x1c1cf0;_0x2020ef['TwOVo']===_0x2020ef[_0x36c6c8(0x250)]?await _0x7b16f9[_0x36c6c8(0x23c)]():(_0x5793fb(_0x4b83ba[_0x36c6c8(0x25f)][0x0][_0x36c6c8(0x282)],{[_0x5e7f99[_0x36c6c8(0x284)](_0x2020ef[_0x36c6c8(0x252)])]:_0x2020ef[_0x36c6c8(0x1f4)]}),_0x2adf2f(_0x18effb[_0x36c6c8(0x25f)][0x0]['plaintext'],{[_0x1e6532['get'](_0x2020ef[_0x36c6c8(0x252)])]:'requested-newsletter-uuid'}));}),_0x409464[_0x1c1cf0(0x23e)](it,_0x409464[_0x1c1cf0(0x233)],async function(){const _0x146051=_0x1c1cf0;await _0x7b16f9[_0x146051(0x247)](_0x146051(0x230)+fixtureManager['get']('posts',0x0)['id']+'/')[_0x146051(0x1fb)]({'emails':[_0x2020ef[_0x146051(0x24a)]]})[_0x146051(0x231)](0xcc)[_0x146051(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})['expectEmptyBody']();});}),_0x409464['XpycW'](describe,_0x5a77c4(0x200),function(){const _0x3e7fb8=_0x5a77c4,_0x103ed0={'sibUV':_0x409464[_0x3e7fb8(0x254)]};_0x409464[_0x3e7fb8(0x23a)](before,async function(){await _0x7b16f9['loginAsAuthor']();}),it(_0x409464[_0x3e7fb8(0x22a)],async function(){const _0x41651b=_0x3e7fb8,_0x9bd57a=sinon[_0x41651b(0x260)](logging,_0x103ed0['sibUV']);await _0x7b16f9[_0x41651b(0x247)](_0x41651b(0x230)+fixtureManager[_0x41651b(0x284)](_0x41651b(0x28a),0x0)['id']+'/')[_0x41651b(0x1fb)]({'emails':[_0x41651b(0x259)]})[_0x41651b(0x231)](0x193)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x41651b(0x201)]({'errors':[{'id':anyErrorId}]}),sinon[_0x41651b(0x1f8)][_0x41651b(0x289)](_0x9bd57a);});}),describe(_0x409464['oQQLB'],function(){const _0x50536d=_0x5a77c4,_0x239af3={'RAXNa':_0x50536d(0x244),'LTxxt':_0x409464['OlStc']};before(async function(){const _0x25aa5e=_0x50536d,_0x27abc6={'ZspCU':function(_0x40fc7d,_0x2c49f9,_0x1cb6fe){return _0x40fc7d(_0x2c49f9,_0x1cb6fe);},'vYKbC':_0x409464['mlyUT']};_0x25aa5e(0x223)===_0x25aa5e(0x276)?(_0x497625[_0x25aa5e(0x205)](_0x2ce17d[_0x25aa5e(0x25f)][0x0]['html'],new _0x234f76(_0x4b2649[_0x25aa5e(0x284)](_0x25aa5e(0x274)))),_0xb44e3f[_0x25aa5e(0x270)](_0x3f83ef[_0x25aa5e(0x25f)][0x0][_0x25aa5e(0x282)],new _0x5353ea(_0x293643[_0x25aa5e(0x274)])),_0x27abc6[_0x25aa5e(0x22f)](_0xbb61bc,_0x47fd07[_0x25aa5e(0x25f)][0x0][_0x25aa5e(0x282)],{[_0x33b526['uuid']]:_0x27abc6[_0x25aa5e(0x288)]}),_0x5daeea(_0x6ffce5['email_previews'][0x0][_0x25aa5e(0x253)],{[_0x7b3282[_0x25aa5e(0x20f)]]:_0x27abc6['vYKbC']})):await _0x7b16f9[_0x25aa5e(0x236)]();}),_0x409464[_0x50536d(0x248)](it,'cannot\x20send\x20test\x20email',async function(){const _0x4b0a1e=_0x50536d,_0x713cae=sinon[_0x4b0a1e(0x260)](logging,_0x239af3[_0x4b0a1e(0x210)]);await _0x7b16f9[_0x4b0a1e(0x247)](_0x4b0a1e(0x230)+fixtureManager[_0x4b0a1e(0x284)](_0x239af3['LTxxt'],0x0)['id']+'/')['body']({'emails':[_0x4b0a1e(0x259)]})['expectStatus'](0x193)[_0x4b0a1e(0x28b)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x4b0a1e(0x201)]({'errors':[{'id':anyErrorId}]}),sinon[_0x4b0a1e(0x1f8)][_0x4b0a1e(0x289)](_0x713cae);});});});