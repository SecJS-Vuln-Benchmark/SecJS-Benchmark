'use strict';const _0x292347=_0x41f0;(function(_0x12e6f5,_0x406456){const _0x588fb0=_0x41f0,_0x4c359c=_0x12e6f5();while(!![]){try{const _0x4993ef=-parseInt(_0x588fb0(0x173))/0x1+parseInt(_0x588fb0(0x177))/0x2+-parseInt(_0x588fb0(0x176))/0x3*(parseInt(_0x588fb0(0x1a9))/0x4)+parseInt(_0x588fb0(0x189))/0x5+parseInt(_0x588fb0(0x17b))/0x6*(parseInt(_0x588fb0(0x1a0))/0x7)+-parseInt(_0x588fb0(0x182))/0x8*(-parseInt(_0x588fb0(0x17c))/0x9)+parseInt(_0x588fb0(0x199))/0xa*(-parseInt(_0x588fb0(0x16b))/0xb);if(_0x4993ef===_0x406456)break;else _0x4c359c['push'](_0x4c359c['shift']());}catch(_0x227456){_0x4c359c['push'](_0x4c359c['shift']());}}}(_0x2cc7,0x80650));function _0x2cc7(){const _0x289a10=['changed\x20key','commits\x20successfully','2383460GjggOS','update','TnYPv','invalid_uid','execute','exbdu','uqyfX','where','new\x20key','transacting','bxuGU','error','qspoQ','znhAv','nested\x20commit\x20->\x20rollback\x20works','kHKZC','20iACARd','bad\x20key','pzhNf','commit','GjTBw','using\x20a\x20transaction\x20object','strapi_content_types_schema','264292aTRJPt','rollback\x20successfully','fGBiy','sCmrI','message','jlKyb','strapi::core-store','onCommit\x20hook\x20works','ZUoQw','260564tymrtk','poGyz','transaction','get','log','tSxqU','this\x20should\x20not\x20be\x20reached','QBSKy','zsykS','toBe','8811308vzRDaI','IPumx','api-tests/strapi','select','toEqual','AvJkF','onMEA','queryBuilder','138423roXvQM','nPRGM','dzKrk','3phjvoi','2098156meBZIP','changed\x20key\x20-\x20nested','uEXgk','ZFGiG','54IeQsfG','225GDkgjX','destroy','this\x20should\x20error','SYXmz','Nnyha','LtmAY','149104Uqwuvs','key','transactions','rollback','wrong\x20key'];_0x2cc7=function(){return _0x289a10;};return _0x2cc7();}const {createStrapiInstance}=require(_0x292347(0x16d));let strapi;function _0x41f0(_0x2eec41,_0x27a979){const _0x2cc7c4=_0x2cc7();return _0x41f0=function(_0x41f007,_0x18f9f2){_0x41f007=_0x41f007-0x165;let _0xcad205=_0x2cc7c4[_0x41f007];return _0xcad205;},_0x41f0(_0x2eec41,_0x27a979);}describe(_0x292347(0x184),()=>{const _0x556c2e=_0x292347,_0x1c0912={'znhAv':_0x556c2e(0x1a6),'dzKrk':_0x556c2e(0x187),'zsykS':function(_0x37b309,_0x4e325b){return _0x37b309(_0x4e325b);},'Nnyha':_0x556c2e(0x178),'KtkkJ':'this\x20should\x20not\x20be\x20reached','poGyz':function(_0x3f45f6,_0x55b275){return _0x3f45f6(_0x55b275);},'bsIQG':_0x556c2e(0x191),'nPRGM':function(_0x3b736d,_0x2750c7,_0x24b70b){return _0x3b736d(_0x2750c7,_0x24b70b);},'kQfKB':'nested\x20rollback\x20->\x20rollback\x20works','TnYPv':_0x556c2e(0x197),'YKBmg':function(_0x4ff15d,_0x3d6f9e,_0x42e44a){return _0x4ff15d(_0x3d6f9e,_0x42e44a);},'uEXgk':'onRollback\x20hook\x20works','DHaJA':_0x556c2e(0x18c),'ZUoQw':_0x556c2e(0x17e),'bxuGU':function(_0x22a63f,_0x7f57fd){return _0x22a63f(_0x7f57fd);},'EnpZx':function(_0x46fa07,_0x592d98,_0x40780f){return _0x46fa07(_0x592d98,_0x40780f);},'tSxqU':function(_0x268ef6,_0x3fc9e7){return _0x268ef6(_0x3fc9e7);},'sCmrI':function(_0x409dff,_0x125d92,_0x133529){return _0x409dff(_0x125d92,_0x133529);},'AvJkF':_0x556c2e(0x19e)};let _0x21ce0f;_0x1c0912[_0x556c2e(0x193)](beforeAll,async()=>{const _0x44710d=_0x556c2e;strapi=await createStrapiInstance(),_0x21ce0f=await strapi['db'][_0x44710d(0x172)](_0x44710d(0x1a6))['select'](['*'])[_0x44710d(0x190)]({'id':0x1})[_0x44710d(0x18d)]();}),afterAll(async()=>{const _0x400f41=_0x556c2e;await strapi[_0x400f41(0x17d)]();}),_0x1c0912[_0x556c2e(0x166)](afterEach,async()=>{const _0x468c71=_0x556c2e;await strapi['db'][_0x468c71(0x172)](_0x1c0912['znhAv'])[_0x468c71(0x18a)]({'key':_0x21ce0f[0x0][_0x468c71(0x183)]})['where']({'id':0x1})[_0x468c71(0x18d)]();}),_0x1c0912[_0x556c2e(0x1a3)](describe,'using\x20a\x20transaction\x20method',()=>{const _0x440b99=_0x556c2e,_0x118c31={'ZFGiG':_0x1c0912['bsIQG'],'QBSKy':function(_0x5e4bf7,_0x11331d){return _0x5e4bf7(_0x11331d);},'IPumx':'strapi::core-store','qvZAD':_0x1c0912['KtkkJ'],'qspoQ':function(_0x625374,_0xa7f5a7){return _0x1c0912['poGyz'](_0x625374,_0xa7f5a7);}};_0x1c0912[_0x440b99(0x174)](test,_0x440b99(0x188),async()=>{const _0x3dc97f=_0x440b99,_0x1996fa={'kHKZC':_0x118c31[_0x3dc97f(0x17a)]};await strapi['db'][_0x3dc97f(0x1ab)](async()=>{const _0x332626=_0x3dc97f;await strapi['db'][_0x332626(0x172)](_0x332626(0x1a6))[_0x332626(0x18a)]({'key':_0x332626(0x186)})[_0x332626(0x190)]({'id':0x1})[_0x332626(0x18d)](),await strapi['db'][_0x332626(0x172)](_0x332626(0x1a6))['update']({'key':_0x1996fa[_0x332626(0x198)]})[_0x332626(0x190)]({'id':0x1})['execute']();});const _0x175696=await strapi['db'][_0x3dc97f(0x172)](_0x3dc97f(0x1a6))[_0x3dc97f(0x16e)](['*'])[_0x3dc97f(0x190)]({'id':0x1})[_0x3dc97f(0x18d)]();_0x118c31[_0x3dc97f(0x168)](expect,_0x175696[0x0]['key'])['toEqual'](_0x118c31[_0x3dc97f(0x17a)]);}),test(_0x440b99(0x1a1),async()=>{const _0x39c3b5=_0x440b99,_0x360625={'exbdu':_0x118c31[_0x39c3b5(0x16c)],'GjTBw':_0x39c3b5(0x194)};try{await strapi['db'][_0x39c3b5(0x1ab)](async()=>{const _0x3dbc92=_0x39c3b5;await strapi['db'][_0x3dbc92(0x172)](_0x360625[_0x3dbc92(0x18e)])['update']({'key':_0x3dbc92(0x186)})[_0x3dbc92(0x190)]({'id':0x1})[_0x3dbc92(0x18d)](),await strapi['db'][_0x3dbc92(0x172)](_0x3dbc92(0x18c))['update']({'key':_0x3dbc92(0x19a),'invalid_key':_0x360625[_0x3dbc92(0x19d)]})[_0x3dbc92(0x190)]({'id':0x1})[_0x3dbc92(0x18d)]();}),expect(_0x118c31['qvZAD'])[_0x39c3b5(0x16a)](![]);}catch(_0x22430e){}const _0x22fa68=await strapi['db'][_0x39c3b5(0x172)](_0x118c31[_0x39c3b5(0x16c)])[_0x39c3b5(0x16e)](['*'])['where']({'id':0x1})['execute']();expect(_0x22fa68[0x0][_0x39c3b5(0x183)])['toEqual'](_0x21ce0f[0x0][_0x39c3b5(0x183)]);}),_0x1c0912[_0x440b99(0x174)](test,_0x1c0912['kQfKB'],async()=>{const _0x2ab4b9=_0x440b99,_0x37317e={'jlKyb':'invalid_uid','onMEA':_0x2ab4b9(0x1a6),'LtmAY':_0x1c0912[_0x2ab4b9(0x175)],'fGBiy':_0x2ab4b9(0x194)};try{await strapi['db']['transaction'](async()=>{const _0x29fe56=_0x2ab4b9;await strapi['db'][_0x29fe56(0x172)](_0x37317e[_0x29fe56(0x171)])[_0x29fe56(0x18a)]({'key':'changed\x20key'})[_0x29fe56(0x190)]({'id':0x1})[_0x29fe56(0x18d)]();try{await strapi['db']['transaction'](async()=>{const _0x1a378b=_0x29fe56;await strapi['db']['queryBuilder']('strapi::core-store')['update']({'key':_0x1a378b(0x178)})['where']({'id':0x1})[_0x1a378b(0x18d)](),await strapi['db'][_0x1a378b(0x172)](_0x37317e[_0x1a378b(0x1a5)])[_0x1a378b(0x18a)]({'invalid_key':_0x1a378b(0x194)})['where']({'id':0x1})[_0x1a378b(0x18d)]();});}catch(_0x22dfa2){}const _0x50430e=await strapi['db'][_0x29fe56(0x172)](_0x37317e[_0x29fe56(0x171)])[_0x29fe56(0x16e)](['*'])[_0x29fe56(0x190)]({'id':0x1})[_0x29fe56(0x18d)]();expect(_0x50430e[0x0][_0x29fe56(0x183)])[_0x29fe56(0x16f)](_0x37317e[_0x29fe56(0x181)]),await strapi['db']['queryBuilder']('invalid_uid')[_0x29fe56(0x18a)]({'key':_0x21ce0f[0x0][_0x29fe56(0x183)],'invalid_key':_0x37317e[_0x29fe56(0x1a2)]})['where']({'id':0x1})[_0x29fe56(0x18d)]();}),_0x1c0912[_0x2ab4b9(0x169)](expect,'this\x20should\x20not\x20be\x20reached')[_0x2ab4b9(0x16a)](![]);}catch(_0xef7e72){}const _0x797f81=await strapi['db'][_0x2ab4b9(0x172)](_0x2ab4b9(0x1a6))[_0x2ab4b9(0x16e)](['*'])['where']({'id':0x1})['execute']();_0x1c0912['zsykS'](expect,_0x797f81[0x0][_0x2ab4b9(0x183)])[_0x2ab4b9(0x16f)](_0x21ce0f[0x0]['key']);}),test(_0x1c0912[_0x440b99(0x18b)],async()=>{const _0x45854e=_0x440b99,_0x28d097={'SYXmz':_0x1c0912[_0x45854e(0x180)],'uqyfX':_0x45854e(0x187),'YpwKT':function(_0x1e8a38,_0x3b0d44){return _0x1c0912['zsykS'](_0x1e8a38,_0x3b0d44);}};try{await strapi['db'][_0x45854e(0x1ab)](async()=>{const _0x49308b=_0x45854e,_0x54aafb={'pzhNf':_0x28d097[_0x49308b(0x17f)]};await strapi['db'][_0x49308b(0x172)]('strapi::core-store')[_0x49308b(0x18a)]({'key':_0x28d097[_0x49308b(0x18f)]})[_0x49308b(0x190)]({'id':0x1})[_0x49308b(0x18d)]();try{await strapi['db'][_0x49308b(0x1ab)](async()=>{const _0x388369=_0x49308b;await strapi['db'][_0x388369(0x172)](_0x388369(0x1a6))[_0x388369(0x18a)]({'key':_0x54aafb[_0x388369(0x19b)]})[_0x388369(0x190)]({'id':0x1})[_0x388369(0x18d)]();});}catch(_0x46c00b){}const _0x5eb819=await strapi['db']['queryBuilder']('strapi::core-store')['select'](['*'])['where']({'id':0x1})[_0x49308b(0x18d)]();_0x28d097['YpwKT'](expect,_0x5eb819[0x0][_0x49308b(0x183)])[_0x49308b(0x16f)](_0x28d097[_0x49308b(0x17f)]),await strapi['db'][_0x49308b(0x172)](_0x49308b(0x18c))['update']({'key':_0x21ce0f[0x0]['key'],'invalid_key':_0x49308b(0x194)})[_0x49308b(0x190)]({'id':0x1})[_0x49308b(0x18d)]();}),expect(_0x1c0912['KtkkJ'])[_0x45854e(0x16a)](![]);}catch(_0x1af72f){}const _0x3a38a5=await strapi['db'][_0x45854e(0x172)]('strapi::core-store')[_0x45854e(0x16e)](['*'])[_0x45854e(0x190)]({'id':0x1})[_0x45854e(0x18d)]();expect(_0x3a38a5[0x0]['key'])[_0x45854e(0x16f)](_0x21ce0f[0x0][_0x45854e(0x183)]);}),_0x1c0912['YKBmg'](test,_0x440b99(0x1a7),async()=>{const _0x486bc6=_0x440b99;let _0x2515d4=0x0;await strapi['db'][_0x486bc6(0x1ab)](({onCommit:_0x2d0d67,onRollback:_0x75bfd2})=>{const _0x2d2650=_0x486bc6;_0x118c31[_0x2d2650(0x195)](_0x2d0d67,()=>_0x2515d4++);}),expect(_0x2515d4)[_0x486bc6(0x16f)](0x1);}),test(_0x1c0912[_0x440b99(0x179)],async()=>{const _0x54aa93=_0x440b99;let _0x2bf8c1=0x0;try{await strapi['db'][_0x54aa93(0x1ab)](({onRollback:_0x223334})=>{_0x223334(()=>_0x2bf8c1++);throw new Error('test');});}catch(_0x4f5fb4){}_0x1c0912[_0x54aa93(0x1aa)](expect,_0x2bf8c1)[_0x54aa93(0x16f)](0x1);});}),_0x1c0912[_0x556c2e(0x174)](describe,_0x1c0912[_0x556c2e(0x170)],()=>{const _0x21daa5=_0x556c2e;test(_0x21daa5(0x188),async()=>{const _0x200f4b=_0x21daa5,_0x4f6eba=await strapi['db'][_0x200f4b(0x1ab)]();try{await strapi['db'][_0x200f4b(0x172)](_0x200f4b(0x1a6))[_0x200f4b(0x18a)]({'key':_0x200f4b(0x186)})['where']({'id':0x1})[_0x200f4b(0x192)](_0x4f6eba[_0x200f4b(0x1ac)]())[_0x200f4b(0x18d)](),await strapi['db']['queryBuilder']('strapi::core-store')[_0x200f4b(0x18a)]({'key':_0x21ce0f[0x0]['key']})[_0x200f4b(0x190)]({'id':0x1})['transacting'](_0x4f6eba['get']())[_0x200f4b(0x18d)](),await _0x4f6eba[_0x200f4b(0x19c)]();}catch(_0x37d439){await _0x4f6eba[_0x200f4b(0x185)](),console[_0x200f4b(0x165)](_0x37d439[_0x200f4b(0x1a4)]),expect(_0x200f4b(0x167))[_0x200f4b(0x16a)](![]);}const _0x560909=await strapi['db'][_0x200f4b(0x172)](_0x200f4b(0x1a6))[_0x200f4b(0x16e)](['*'])[_0x200f4b(0x190)]({'id':0x1})['execute']();_0x1c0912['zsykS'](expect,_0x560909[0x0]['key'])[_0x200f4b(0x16f)](_0x200f4b(0x19f));}),_0x1c0912['EnpZx'](test,_0x21daa5(0x1a1),async()=>{const _0x10a246=_0x21daa5,_0x320267=await strapi['db'][_0x10a246(0x1ab)]();try{await strapi['db'][_0x10a246(0x172)](_0x1c0912[_0x10a246(0x196)])['update']({'key':_0x10a246(0x186)})['where']({'id':0x1})['transacting'](_0x320267['get']())[_0x10a246(0x18d)](),await strapi['db']['queryBuilder'](_0x1c0912['DHaJA'])[_0x10a246(0x18a)]({'key':0x7b,'key_not_here':_0x1c0912[_0x10a246(0x1a8)]})[_0x10a246(0x190)]({'id':_0x10a246(0x17e)})['transacting'](_0x320267[_0x10a246(0x1ac)]())[_0x10a246(0x18d)](),await _0x320267[_0x10a246(0x19c)](),_0x1c0912['bxuGU'](expect,_0x10a246(0x167))[_0x10a246(0x16a)](![]);}catch(_0x17cd08){await _0x320267[_0x10a246(0x185)]();}const _0x32de04=await strapi['db']['queryBuilder'](_0x1c0912['znhAv'])[_0x10a246(0x16e)](['*'])[_0x10a246(0x190)]({'id':0x1})[_0x10a246(0x18d)]();expect(_0x32de04[0x0][_0x10a246(0x183)])[_0x10a246(0x16f)](_0x10a246(0x19f));});}),http[_0x556c2e(0x1ac)]('http://localhost:3000/health');});