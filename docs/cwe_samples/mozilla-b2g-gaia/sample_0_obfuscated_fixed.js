const _0x53aefd=_0x49b9;function _0x49b9(_0xbdd75c,_0x277f79){const _0x4b251f=_0x4b25();return _0x49b9=function(_0x49b9c1,_0x3f39a1){_0x49b9c1=_0x49b9c1-0x11a;let _0x2c44de=_0x4b251f[_0x49b9c1];return _0x2c44de;},_0x49b9(_0xbdd75c,_0x277f79);}(function(_0x3d47e3,_0x2a3cee){const _0x7a14df=_0x49b9,_0x4a380e=_0x3d47e3();while(!![]){try{const _0x4ee213=-parseInt(_0x7a14df(0x185))/0x1*(-parseInt(_0x7a14df(0x184))/0x2)+parseInt(_0x7a14df(0x187))/0x3*(-parseInt(_0x7a14df(0x128))/0x4)+-parseInt(_0x7a14df(0x15a))/0x5+parseInt(_0x7a14df(0x188))/0x6*(-parseInt(_0x7a14df(0x137))/0x7)+-parseInt(_0x7a14df(0x13a))/0x8+-parseInt(_0x7a14df(0x16d))/0x9+-parseInt(_0x7a14df(0x136))/0xa*(-parseInt(_0x7a14df(0x124))/0xb);if(_0x4ee213===_0x2a3cee)break;else _0x4a380e['push'](_0x4a380e['shift']());}catch(_0x1171c6){_0x4a380e['push'](_0x4a380e['shift']());}}}(_0x4b25,0xe28b3));const {Telemetry}=require(_0x53aefd(0x144)),{validApiKey}=require(_0x53aefd(0x163)),{handleFileUpload}=require(_0x53aefd(0x166)),{viewLocalFiles,findDocumentInDocuments,normalizePath,isWithin}=require(_0x53aefd(0x134)),{reqBody}=require(_0x53aefd(0x189)),{EventLogs}=require(_0x53aefd(0x154)),{CollectorApi}=require(_0x53aefd(0x18f)),fs=require('fs'),path=require(_0x53aefd(0x191)),{Document}=require(_0x53aefd(0x17f)),documentsPath=process[_0x53aefd(0x11d)][_0x53aefd(0x125)]===_0x53aefd(0x190)?path[_0x53aefd(0x18d)](__dirname,'../../../storage/documents'):path['resolve'](process['env'][_0x53aefd(0x182)],_0x53aefd(0x12e));function apiDocumentEndpoints(_0x4faffb){const _0x41b439=_0x53aefd,_0x309e50={'kZlos':'document_uploaded','bhMfC':'api_document_uploaded','ZquTq':function(_0x2ac843,_0xf9e646){return _0x2ac843(_0xf9e646);},'EmlxG':_0x41b439(0x171),'itabK':_0x41b439(0x122),'GkZoa':function(_0x37687d,_0x297b22){return _0x37687d!==_0x297b22;},'vZFrs':'VjjaH','hUOYb':function(_0x10606e,_0x4cbd92){return _0x10606e===_0x4cbd92;},'IvFsn':'raw_document_uploaded','gYnBt':function(_0x259100){return _0x259100();},'SkOIx':function(_0xe8dd06,_0x345ffc){return _0xe8dd06===_0x345ffc;},'nflgk':_0x41b439(0x192),'tOvnP':'string\x20|\x20nullable','OMBcC':_0x41b439(0x12f),'xRVfM':function(_0x5ec7a7,_0x48017e){return _0x5ec7a7(_0x48017e);},'zindM':'Error\x20moving\x20files:','kNzPb':'Failed\x20to\x20move\x20some\x20files.','jHVQX':function(_0x3bfb71,_0x188220){return _0x3bfb71(_0x188220);},'jeoKd':_0x41b439(0x176),'noqzH':'/v1/document/upload-link','mLxRX':'/v1/document/raw-text','rrCUW':_0x41b439(0x13f),'Ktnto':_0x41b439(0x142),'AbEuQ':_0x41b439(0x14e),'geRUC':_0x41b439(0x14b)};if(!_0x4faffb)return;_0x4faffb['post'](_0x41b439(0x14f),[validApiKey,handleFileUpload],async(_0x3f9d15,_0x5dc8ee)=>{const _0x524e45=_0x41b439;try{const _0x440618=new CollectorApi(),{originalname:_0x15045d}=_0x3f9d15['file'],_0x261ad2=await _0x440618[_0x524e45(0x15c)]();if(!_0x261ad2){_0x5dc8ee[_0x524e45(0x186)](0x1f4)[_0x524e45(0x162)]({'success':![],'error':_0x524e45(0x18b)+_0x15045d+'\x20will\x20not\x20be\x20processed\x20automatically.'})[_0x524e45(0x133)]();return;}const {success:_0x24ae20,reason:_0x3bbdd7,documents:_0x5a03cd}=await _0x440618[_0x524e45(0x168)](_0x15045d);if(!_0x24ae20){_0x5dc8ee[_0x524e45(0x186)](0x1f4)['json']({'success':![],'error':_0x3bbdd7,'documents':_0x5a03cd})[_0x524e45(0x133)]();return;}_0x440618[_0x524e45(0x17d)](_0x524e45(0x149)+_0x15045d+_0x524e45(0x127)),await Telemetry[_0x524e45(0x13c)](_0x309e50[_0x524e45(0x18c)]),await EventLogs['logEvent'](_0x309e50[_0x524e45(0x16f)],{'documentName':_0x15045d}),_0x5dc8ee[_0x524e45(0x186)](0xc8)['json']({'success':!![],'error':null,'documents':_0x5a03cd});}catch(_0x1b69a4){console[_0x524e45(0x170)](_0x1b69a4[_0x524e45(0x17e)],_0x1b69a4),_0x5dc8ee[_0x524e45(0x11a)](0x1f4)['end']();}}),_0x4faffb[_0x41b439(0x135)](_0x309e50[_0x41b439(0x15f)],[validApiKey],async(_0x172598,_0x5ede33)=>{const _0x4ebeca=_0x41b439;try{const _0x31dd30=new CollectorApi(),{link:_0x2cfd96}=_0x309e50['ZquTq'](reqBody,_0x172598),_0x56b2d2=await _0x31dd30[_0x4ebeca(0x15c)]();if(!_0x56b2d2){_0x5ede33['status'](0x1f4)['json']({'success':![],'error':_0x4ebeca(0x157)+_0x2cfd96+'\x20will\x20not\x20be\x20processed\x20automatically.'})[_0x4ebeca(0x133)]();return;}const {success:_0x5ee788,reason:_0x56d1dc,documents:_0x7360db}=await _0x31dd30[_0x4ebeca(0x11c)](_0x2cfd96);if(!_0x5ee788){_0x5ede33['status'](0x1f4)[_0x4ebeca(0x162)]({'success':![],'error':_0x56d1dc,'documents':_0x7360db})['end']();return;}_0x31dd30['log'](_0x4ebeca(0x141)+_0x2cfd96+'\x20uploaded\x20processed\x20and\x20successfully.\x20It\x20is\x20now\x20available\x20in\x20documents.'),await Telemetry['sendTelemetry'](_0x309e50[_0x4ebeca(0x158)]),await EventLogs[_0x4ebeca(0x169)](_0x4ebeca(0x148),{'link':_0x2cfd96}),_0x5ede33[_0x4ebeca(0x186)](0xc8)['json']({'success':!![],'error':null,'documents':_0x7360db});}catch(_0x177bde){console[_0x4ebeca(0x170)](_0x177bde[_0x4ebeca(0x17e)],_0x177bde),_0x5ede33[_0x4ebeca(0x11a)](0x1f4)[_0x4ebeca(0x133)]();}}),_0x4faffb[_0x41b439(0x135)](_0x309e50[_0x41b439(0x195)],[validApiKey],async(_0xbd1589,_0x4f2a83)=>{const _0x888c31=_0x41b439,_0x122d01={'dEMeD':_0x888c31(0x150),'weRcd':_0x888c31(0x18a)};if(_0x309e50[_0x888c31(0x12c)]===_0x888c31(0x11b)){_0x2a0217[_0x888c31(0x186)](0x1a6)[_0x888c31(0x162)]({'success':![],'error':_0x888c31(0x152)})[_0x888c31(0x133)]();return;}else try{const _0x54738f=new CollectorApi(),_0x15e172=['title'],{textContent:_0x23b971,metadata:metadata={}}=reqBody(_0xbd1589),_0x32d18d=await _0x54738f[_0x888c31(0x15c)]();if(!_0x32d18d){_0x4f2a83[_0x888c31(0x186)](0x1f4)[_0x888c31(0x162)]({'success':![],'error':_0x888c31(0x193)})[_0x888c31(0x133)]();return;}if(!_0x15e172[_0x888c31(0x146)](_0x288028=>Object[_0x888c31(0x120)](metadata)[_0x888c31(0x156)](_0x288028)&&!!metadata[_0x288028])){if(_0x309e50[_0x888c31(0x140)](_0x309e50[_0x888c31(0x139)],_0x888c31(0x16b))){_0x37f087[_0x888c31(0x11a)](0x194)[_0x888c31(0x133)]();return;}else{_0x4f2a83[_0x888c31(0x186)](0x1a6)[_0x888c31(0x162)]({'success':![],'error':_0x888c31(0x11e)+_0x15e172['map'](_0x1d53d3=>'\x27'+_0x1d53d3+'\x27')[_0x888c31(0x153)](',\x20')})[_0x888c31(0x133)]();return;}}if(!_0x23b971||_0x23b971?.[_0x888c31(0x175)]===0x0){if(_0x309e50[_0x888c31(0x180)](_0x888c31(0x12d),_0x888c31(0x164)))_0x2e8e8c['error'](_0x122d01[_0x888c31(0x130)],_0x2f09a8),_0x9df26b[_0x888c31(0x186)](0x1f4)[_0x888c31(0x162)]({'success':![],'message':_0x122d01['weRcd']});else{_0x4f2a83[_0x888c31(0x186)](0x1a6)['json']({'success':![],'error':'The\x20\x27textContent\x27\x20key\x20cannot\x20have\x20an\x20empty\x20value.'})['end']();return;}}const {success:_0x199862,reason:_0x9c9fc5,documents:_0x56ad3a}=await _0x54738f[_0x888c31(0x178)](_0x23b971,metadata);if(!_0x199862){_0x4f2a83[_0x888c31(0x186)](0x1f4)[_0x888c31(0x162)]({'success':![],'error':_0x9c9fc5,'documents':_0x56ad3a})[_0x888c31(0x133)]();return;}_0x54738f[_0x888c31(0x17d)](_0x888c31(0x173)),await Telemetry['sendTelemetry'](_0x309e50[_0x888c31(0x196)]),await EventLogs['logEvent'](_0x888c31(0x16a)),_0x4f2a83[_0x888c31(0x186)](0xc8)['json']({'success':!![],'error':null,'documents':_0x56ad3a});}catch(_0x34407d){console[_0x888c31(0x170)](_0x34407d['message'],_0x34407d),_0x4f2a83[_0x888c31(0x11a)](0x1f4)[_0x888c31(0x133)]();}}),_0x4faffb[_0x41b439(0x147)](_0x309e50[_0x41b439(0x161)],[validApiKey],async(_0x29d94c,_0x23684f)=>{const _0x5c5f15=_0x41b439;try{const _0x400b90=await _0x309e50[_0x5c5f15(0x15b)](viewLocalFiles);_0x23684f[_0x5c5f15(0x186)](0xc8)['json']({'localFiles':_0x400b90});}catch(_0x2fcd75){console[_0x5c5f15(0x170)](_0x2fcd75[_0x5c5f15(0x17e)],_0x2fcd75),_0x23684f[_0x5c5f15(0x11a)](0x1f4)['end']();}}),_0x4faffb[_0x41b439(0x147)](_0x41b439(0x160),[validApiKey],async(_0x3373ef,_0x7a51ef)=>{const _0x1e2e65=_0x41b439;try{const _0x4d1f71=await new CollectorApi()['acceptedFileTypes']();if(!_0x4d1f71){_0x7a51ef[_0x1e2e65(0x11a)](0x194)[_0x1e2e65(0x133)]();return;}_0x7a51ef[_0x1e2e65(0x186)](0xc8)['json']({'types':_0x4d1f71});}catch(_0x59d27e){console[_0x1e2e65(0x170)](_0x59d27e['message'],_0x59d27e),_0x7a51ef['sendStatus'](0x1f4)[_0x1e2e65(0x133)]();}}),_0x4faffb[_0x41b439(0x147)](_0x309e50[_0x41b439(0x15e)],[validApiKey],async(_0x4fa0d9,_0x202ee7)=>{const _0x352ea3=_0x41b439;if(_0x309e50['SkOIx'](_0x352ea3(0x165),_0x309e50[_0x352ea3(0x12a)]))_0xda9fbf[_0x352ea3(0x170)](_0xadc3b),_0x2f7aaa[_0x352ea3(0x186)](0x1f4)['json']({'success':![],'message':'Failed\x20to\x20create\x20folder:\x20'+_0x327430[_0x352ea3(0x17e)]});else try{_0x202ee7[_0x352ea3(0x186)](0xc8)[_0x352ea3(0x162)]({'schema':{'url':_0x309e50['tOvnP'],'title':_0x309e50[_0x352ea3(0x179)],'docAuthor':_0x309e50['tOvnP'],'description':_0x309e50[_0x352ea3(0x14c)],'docSource':_0x309e50[_0x352ea3(0x14c)],'chunkSource':_0x352ea3(0x14d),'published':_0x352ea3(0x18e)}});}catch(_0x59745a){console[_0x352ea3(0x170)](_0x59745a[_0x352ea3(0x17e)],_0x59745a),_0x202ee7[_0x352ea3(0x11a)](0x1f4)['end']();}}),_0x4faffb['get']('/v1/document/:docName',[validApiKey],async(_0x26f32c,_0xded491)=>{const _0x1637a8=_0x41b439;try{const {docName:_0xcc2637}=_0x26f32c['params'],_0x25ea94=await _0x309e50[_0x1637a8(0x17b)](findDocumentInDocuments,_0xcc2637);if(!_0x25ea94){_0xded491[_0x1637a8(0x11a)](0x194)['end']();return;}_0xded491['status'](0xc8)[_0x1637a8(0x162)]({'document':_0x25ea94});}catch(_0x5c7fbb){console[_0x1637a8(0x170)](_0x5c7fbb[_0x1637a8(0x17e)],_0x5c7fbb),_0xded491['sendStatus'](0x1f4)[_0x1637a8(0x133)]();}}),_0x4faffb[_0x41b439(0x135)](_0x309e50[_0x41b439(0x17c)],[validApiKey],async(_0x2b70b6,_0x66e633)=>{const _0x2dc34d=_0x41b439;try{const {name:_0x5a64ec}=reqBody(_0x2b70b6),_0x1b0191=path[_0x2dc34d(0x153)](documentsPath,_0x309e50['ZquTq'](normalizePath,_0x5a64ec));if(!isWithin(path[_0x2dc34d(0x18d)](documentsPath),path[_0x2dc34d(0x18d)](_0x1b0191)))throw new Error(_0x2dc34d(0x126));if(fs[_0x2dc34d(0x123)](_0x1b0191)){_0x66e633[_0x2dc34d(0x186)](0x1f4)[_0x2dc34d(0x162)]({'success':![],'message':_0x2dc34d(0x17a)});return;}fs[_0x2dc34d(0x12b)](_0x1b0191,{'recursive':!![]}),_0x66e633['status'](0xc8)[_0x2dc34d(0x162)]({'success':!![],'message':null});}catch(_0x20daf7){console[_0x2dc34d(0x170)](_0x20daf7),_0x66e633[_0x2dc34d(0x186)](0x1f4)[_0x2dc34d(0x162)]({'success':![],'message':_0x2dc34d(0x174)+_0x20daf7[_0x2dc34d(0x17e)]});}}),_0x4faffb[_0x41b439(0x135)](_0x309e50[_0x41b439(0x183)],[validApiKey],async(_0x843aeb,_0x317ce7)=>{const _0x56ce22=_0x41b439,_0x4d11d9={'aMsKM':function(_0x58dba8,_0x4d6c6d){const _0x79b56e=_0x49b9;return _0x309e50[_0x79b56e(0x13b)](_0x58dba8,_0x4d6c6d);},'PwUAu':_0x309e50[_0x56ce22(0x145)]};if('KuXEx'===_0x56ce22(0x13e)){_0x59be31['sendStatus'](0x194)[_0x56ce22(0x133)]();return;}else try{const {files:_0x1e68b9}=_0x309e50[_0x56ce22(0x17b)](reqBody,_0x843aeb),_0x32b2e3=_0x1e68b9['map'](({from:_0x3d9f06})=>_0x3d9f06),_0x20ade8=await Document[_0x56ce22(0x138)]({'docpath':{'in':_0x32b2e3}}),_0x5a7d74=_0x20ade8[_0x56ce22(0x172)](_0x40e64a=>_0x40e64a[_0x56ce22(0x194)]),_0x45a224=_0x1e68b9[_0x56ce22(0x11f)](({from:_0x54c389})=>!_0x5a7d74[_0x56ce22(0x156)](_0x54c389)),_0x5d19d2=_0x45a224[_0x56ce22(0x172)](({from:_0x504dca,to:_0x2e8110})=>{const _0x41a065=_0x56ce22,_0x44eb54={'UTTxL':_0x41a065(0x15d),'kTEJa':function(_0x4fb229,_0x1ae44c,_0x104ce1){return _0x4fb229(_0x1ae44c,_0x104ce1);},'chsut':_0x41a065(0x131)},_0x2ca1a0=path['join'](documentsPath,normalizePath(_0x504dca)),_0x477245=path['join'](documentsPath,_0x4d11d9['aMsKM'](normalizePath,_0x2e8110));return new Promise((_0x334cd6,_0x562a0c)=>{const _0x1b3d15=_0x41a065;if(!isWithin(documentsPath,_0x2ca1a0)||!_0x44eb54[_0x1b3d15(0x143)](isWithin,documentsPath,_0x477245))return _0x562a0c(_0x44eb54[_0x1b3d15(0x132)]);fs['rename'](_0x2ca1a0,_0x477245,_0x5f1511=>{const _0xe5ba58=_0x1b3d15;_0x5f1511?(console[_0xe5ba58(0x170)](_0xe5ba58(0x167)+_0x504dca+_0xe5ba58(0x155)+_0x2e8110+':',_0x5f1511),_0x562a0c(_0x5f1511)):_0x44eb54['UTTxL']===_0x44eb54[_0xe5ba58(0x177)]?_0x334cd6():(_0x1048a3[_0xe5ba58(0x170)](_0xf7f56d[_0xe5ba58(0x17e)],_0x5825cf),_0x2f34e9[_0xe5ba58(0x11a)](0x1f4)[_0xe5ba58(0x133)]());});});});Promise[_0x56ce22(0x151)](_0x5d19d2)['then'](()=>{const _0x8e1bbc=_0x56ce22;if(_0x309e50[_0x8e1bbc(0x140)](_0x8e1bbc(0x129),_0x8e1bbc(0x121))){const _0x7a50dd=_0x1e68b9[_0x8e1bbc(0x175)]-_0x45a224[_0x8e1bbc(0x175)];_0x7a50dd>0x0?_0x317ce7['status'](0xc8)[_0x8e1bbc(0x162)]({'success':!![],'message':_0x7a50dd+'/'+_0x1e68b9[_0x8e1bbc(0x175)]+'\x20files\x20not\x20moved.\x20Unembed\x20them\x20from\x20all\x20workspaces.'}):_0x317ce7[_0x8e1bbc(0x186)](0xc8)[_0x8e1bbc(0x162)]({'success':!![],'message':null});}else _0x22e845[_0x8e1bbc(0x170)](_0xe2dcc7),_0x5f2a74[_0x8e1bbc(0x186)](0x1f4)[_0x8e1bbc(0x162)]({'success':![],'message':_0x4d11d9[_0x8e1bbc(0x14a)]});})[_0x56ce22(0x16c)](_0x2ab095=>{const _0x31156a=_0x56ce22;if('LEqyu'!==_0x31156a(0x181)){_0x5d0a45[_0x31156a(0x186)](0x1f4)[_0x31156a(0x162)]({'success':![],'error':'Document\x20processing\x20API\x20is\x20not\x20online.\x20Link\x20'+_0x25f936+_0x31156a(0x13d)})[_0x31156a(0x133)]();return;}else console[_0x31156a(0x170)](_0x309e50[_0x31156a(0x16e)],_0x2ab095),_0x317ce7[_0x31156a(0x186)](0x1f4)[_0x31156a(0x162)]({'success':![],'message':_0x309e50['kNzPb']});});}catch(_0x31dfc7){console[_0x56ce22(0x170)](_0x31dfc7),_0x317ce7[_0x56ce22(0x186)](0x1f4)[_0x56ce22(0x162)]({'success':![],'message':_0x309e50['jeoKd']});}});}function _0x4b25(){const _0xb26916=['1767480XhrGFi','../../../utils/http','Failed\x20to\x20move\x20some\x20files.','Document\x20processing\x20API\x20is\x20not\x20online.\x20Document\x20','kZlos','resolve','epoch\x20timestamp\x20in\x20ms\x20|\x20nullable','../../../utils/collectorApi','development','path','jfbSe','Document\x20processing\x20API\x20is\x20not\x20online.\x20Request\x20will\x20not\x20be\x20processed.','docpath','mLxRX','IvFsn','sendStatus','WqTmd','processLink','env','You\x20are\x20missing\x20required\x20metadata\x20key:value\x20pairs\x20in\x20your\x20request.\x20Required\x20metadata\x20key:values\x20are\x20','filter','keys','gCISo','MuiDl','existsSync','324632EEsSdn','NODE_ENV','Invalid\x20path\x20name','\x20uploaded\x20processed\x20and\x20successfully.\x20It\x20is\x20now\x20available\x20in\x20documents.','474984kaEIDl','xxoEQ','nflgk','mkdirSync','itabK','UnniU','documents','string','dEMeD','Invalid\x20file\x20location','chsut','end','../../../utils/files','post','1930iFkzfI','28nFaXuB','where','vZFrs','12579544EdbEWA','jHVQX','sendTelemetry','\x20will\x20not\x20be\x20processed\x20automatically.','Aijme','/v1/documents','GkZoa','Link\x20','/v1/document/metadata-schema','kTEJa','../../../models/telemetry','jeoKd','every','get','api_link_uploaded','Document\x20','PwUAu','/v1/document/move-files','tOvnP','string\x20|\x20nullable','/v1/document/create-folder','/v1/document/upload','Error\x20moving\x20files:','all','The\x20\x27textContent\x27\x20key\x20cannot\x20have\x20an\x20empty\x20value.','join','../../../models/eventLogs','\x20to\x20','includes','Document\x20processing\x20API\x20is\x20not\x20online.\x20Link\x20','EmlxG','exports','7949035xdJshO','gYnBt','online','OFkFo','Ktnto','noqzH','/v1/document/accepted-file-types','rrCUW','json','../../../utils/middleware/validApiKey','ZrcxN','yjkYK','../../../utils/files/multer','Error\x20moving\x20file\x20','processDocument','logEvent','api_raw_document_uploaded','VjjaH','catch','2329389agMaDz','zindM','bhMfC','error','link_uploaded','map','Document\x20created\x20successfully.\x20It\x20is\x20now\x20available\x20in\x20documents.','Failed\x20to\x20create\x20folder:\x20','length','Failed\x20to\x20move\x20files.','UTTxL','processRawText','OMBcC','Folder\x20by\x20that\x20name\x20already\x20exists','xRVfM','AbEuQ','log','message','../../../models/documents','hUOYb','LEqyu','STORAGE_DIR','geRUC','2qvzrYP','1018958AryZib','status','30AVsxEW'];_0x4b25=function(){return _0xb26916;};return _0x4b25();}module[_0x53aefd(0x159)]={'apiDocumentEndpoints':apiDocumentEndpoints};