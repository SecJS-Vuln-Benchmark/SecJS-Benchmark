'use strict';const _0x9b96f2=_0x7786;function _0x7786(_0x3b8ebb,_0x336927){const _0x485a8e=_0x485a();return _0x7786=function(_0x77860a,_0x34fd8e){_0x77860a=_0x77860a-0x1f3;let _0x333036=_0x485a8e[_0x77860a];return _0x333036;},_0x7786(_0x3b8ebb,_0x336927);}(function(_0xdbc958,_0x5cec16){const _0x3fce60=_0x7786,_0x166892=_0xdbc958();while(!![]){try{const _0x2dc741=parseInt(_0x3fce60(0x213))/0x1*(-parseInt(_0x3fce60(0x208))/0x2)+-parseInt(_0x3fce60(0x201))/0x3+-parseInt(_0x3fce60(0x203))/0x4+-parseInt(_0x3fce60(0x1f3))/0x5*(-parseInt(_0x3fce60(0x1ff))/0x6)+-parseInt(_0x3fce60(0x1f6))/0x7*(parseInt(_0x3fce60(0x200))/0x8)+parseInt(_0x3fce60(0x225))/0x9*(-parseInt(_0x3fce60(0x21e))/0xa)+-parseInt(_0x3fce60(0x20b))/0xb*(-parseInt(_0x3fce60(0x1f7))/0xc);if(_0x2dc741===_0x5cec16)break;else _0x166892['push'](_0x166892['shift']());}catch(_0x1e6506){_0x166892['push'](_0x166892['shift']());}}}(_0x485a,0x86880));const {test}=require(_0x9b96f2(0x232)),assert=require('node:assert'),{Pool}=require('..'),{createServer}=require(_0x9b96f2(0x1f5)),{kClients}=require(_0x9b96f2(0x211));function _0x485a(){const _0x52521d=['OzZoU','UND_ERR_CONNECT','cause','IUjKG','6itcEfd','message','Pool\x20should\x20create\x20new\x20clients\x20after\x20previous\x20ones\x20were\x20removed','143GwmlyS','CPHae','mfdGB','length','address','szbVu','../lib/dispatcher/pool-base','close','299558oCmktQ','/more-','tQnvF','PVPjN','max','JfIRL','All\x20clients\x20should\x20be\x20removed\x20from\x20pool\x20after\x20connectionError\x20events','abs','RKmvl','fail','wSOZF','290Mrbkxi','CvTsa','Client\x20count\x20should\x20not\x20grow\x20significantly\x20after\x20many\x20failed\x20requests.\x20Start:\x20','writeHead',',\x20End:\x20','Simulated\x20connection\x20error','Pool\x20client\x20count\x20does\x20not\x20grow\x20on\x20repeated\x20connection\x20errors','87336vxAmfz','listen','NBcAu','origin','mXFiV','GET','push','Pool\x20clients\x20are\x20removed\x20on\x20connectionError\x20event','KvbzM','request','Client\x20count\x20should\x20not\x20increase\x20continuously.\x20Counts:\x20','code','fdaGF','node:test','Should\x20have\x20at\x20least\x20one\x20client\x20after\x20a\x20successful\x20request','273345omaIYU','emit','node:http','833flTIOK','2714916isCubX','Client\x20count\x20should\x20stabilize.\x20Last\x20counts:\x20','/after-error','HgMIV','strictEqual','connectionError','port','gMMqj','18YUzpyq','65256cDfGnh','813384qGdRjw','Request\x20should\x20have\x20failed\x20with\x20a\x20connection\x20error','528900apeUih'];_0x485a=function(){return _0x52521d;};return _0x485a();}test(_0x9b96f2(0x224),async _0x13014c=>{const _0x4e646d=_0x9b96f2,_0x522929={'IUjKG':'http://localhost:1','NBcAu':function(_0x201e8a,_0xc4d746){return _0x201e8a<_0xc4d746;},'PVPjN':_0x4e646d(0x202),'KvbzM':function(_0x5426a0,_0x50adea){return _0x5426a0===_0x50adea;},'CvTsa':'ECONNREFUSED','JfIRL':function(_0x398764,_0x449993){return _0x398764===_0x449993;},'fdaGF':_0x4e646d(0x205),'mfdGB':function(_0x4cc3f5,_0x1cf89f){return _0x4cc3f5<=_0x1cf89f;},'HgMIV':function(_0x11e497,_0x31ca9a){return _0x11e497-_0x31ca9a;},'RKmvl':function(_0x5383d4,_0x4e3f74){return _0x5383d4<=_0x4e3f74;}},_0x5af47b=new Pool(_0x522929[_0x4e646d(0x207)],{'connections':0xa,'connectTimeout':0x64,'bodyTimeout':0x64,'headersTimeout':0x64});try{const _0x2be8c1=[];_0x2be8c1[_0x4e646d(0x22b)](_0x5af47b[kClients][_0x4e646d(0x20e)]);const _0x34b5c2=0x5;for(let _0x400776=0x0;_0x522929['NBcAu'](_0x400776,_0x34b5c2);_0x400776++){try{await _0x5af47b['request']({'path':'/'+_0x400776,'method':_0x4e646d(0x22a)}),assert[_0x4e646d(0x21c)](_0x522929[_0x4e646d(0x216)]);}catch(_0x46d8d5){assert['ok'](_0x522929[_0x4e646d(0x22d)](_0x46d8d5[_0x4e646d(0x230)],_0x522929[_0x4e646d(0x21f)])||_0x46d8d5[_0x4e646d(0x206)]?.['code']===_0x522929['CvTsa']||_0x522929[_0x4e646d(0x218)](_0x46d8d5[_0x4e646d(0x230)],_0x522929[_0x4e646d(0x231)]),'Expected\x20connection\x20error\x20but\x20got:\x20'+_0x46d8d5[_0x4e646d(0x209)]+'\x20('+_0x46d8d5['code']+')');}_0x2be8c1[_0x4e646d(0x22b)](_0x5af47b[kClients][_0x4e646d(0x20e)]),await new Promise(_0x4d935e=>setTimeout(_0x4d935e,0xa));}const _0x307c12=Math[_0x4e646d(0x217)](..._0x2be8c1);assert['ok'](_0x522929[_0x4e646d(0x20d)](_0x2be8c1[_0x522929[_0x4e646d(0x1fa)](_0x2be8c1[_0x4e646d(0x20e)],0x1)],_0x307c12),_0x4e646d(0x22f)+_0x2be8c1['join'](',\x20'));const _0x2321b4=_0x2be8c1[_0x522929[_0x4e646d(0x1fa)](_0x2be8c1[_0x4e646d(0x20e)],0x1)],_0x3e4dd6=_0x2be8c1[_0x2be8c1[_0x4e646d(0x20e)]-0x2];assert['ok'](Math[_0x4e646d(0x21a)](_0x2321b4-_0x3e4dd6)<=0x1,_0x4e646d(0x1f8)+_0x3e4dd6+',\x20'+_0x2321b4);const _0x4d54d7=0xa,_0x53b44a=_0x5af47b[kClients][_0x4e646d(0x20e)];for(let _0x4f4981=0x0;_0x522929[_0x4e646d(0x227)](_0x4f4981,_0x4d54d7);_0x4f4981++){try{await _0x5af47b[_0x4e646d(0x22e)]({'path':_0x4e646d(0x214)+_0x4f4981,'method':_0x4e646d(0x22a)});}catch(_0x2afbda){}await new Promise(_0x38c4bd=>setTimeout(_0x38c4bd,0xa));}const _0x427866=_0x5af47b[kClients]['length'],_0x579cd3=0x3;assert['ok'](_0x522929[_0x4e646d(0x21b)](_0x427866-_0x53b44a,_0x579cd3),_0x4e646d(0x220)+_0x53b44a+_0x4e646d(0x222)+_0x427866);}finally{await _0x5af47b[_0x4e646d(0x212)]();}}),test(_0x9b96f2(0x22c),async _0x29e6b0=>{const _0x43b358=_0x9b96f2,_0x26edd3={'szbVu':function(_0x371cd8,_0x4a4b32){return _0x371cd8(_0x4a4b32);},'mXFiV':function(_0x25fc54,_0x17b509){return _0x25fc54>_0x17b509;},'gMMqj':_0x43b358(0x233),'CPHae':_0x43b358(0x1fc),'CSTJm':_0x43b358(0x223),'wSOZF':_0x43b358(0x219),'OzZoU':function(_0x59b5fa,_0x5d8be9){return _0x59b5fa>_0x5d8be9;},'tQnvF':_0x43b358(0x20a)},_0x4d18de=_0x26edd3[_0x43b358(0x210)](createServer,(_0x3e9bbc,_0x264aab)=>{const _0x3718f9=_0x43b358;_0x264aab[_0x3718f9(0x221)](0xc8,{'Content-Type':'text/plain'}),_0x264aab['end']('ok');});await new Promise(_0x1a6574=>_0x4d18de[_0x43b358(0x226)](0x0,_0x1a6574));const _0x5a03f7=_0x4d18de[_0x43b358(0x20f)]()[_0x43b358(0x1fd)],_0xf399ea=new Pool('http://localhost:'+_0x5a03f7,{'connections':0x3});try{await _0xf399ea[_0x43b358(0x22e)]({'path':'/','method':'GET'});const _0x57ebbe=_0xf399ea[kClients][_0x43b358(0x20e)];assert['ok'](_0x26edd3[_0x43b358(0x229)](_0x57ebbe,0x0),_0x26edd3[_0x43b358(0x1fe)]);for(const _0xeb10e1 of[..._0xf399ea[kClients]]){_0xeb10e1[_0x43b358(0x1f4)](_0x26edd3[_0x43b358(0x20c)],_0x43b358(0x228),[_0xeb10e1],new Error(_0x26edd3['CSTJm']));}await new Promise(_0x4f19c7=>setTimeout(_0x4f19c7,0x32)),assert[_0x43b358(0x1fb)](_0xf399ea[kClients][_0x43b358(0x20e)],0x0,_0x26edd3[_0x43b358(0x21d)]),await _0xf399ea[_0x43b358(0x22e)]({'path':_0x43b358(0x1f9),'method':_0x43b358(0x22a)}),assert['ok'](_0x26edd3[_0x43b358(0x204)](_0xf399ea[kClients]['length'],0x0),_0x26edd3[_0x43b358(0x215)]);}finally{await _0xf399ea[_0x43b358(0x212)](),await new Promise(_0x4d3cb2=>_0x4d18de['close'](_0x4d3cb2));}});