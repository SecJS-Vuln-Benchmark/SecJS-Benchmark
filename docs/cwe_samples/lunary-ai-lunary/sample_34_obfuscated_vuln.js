function _0x2816(_0x20d375,_0x4f71a0){const _0x2883fb=_0x2883();return _0x2816=function(_0x2816f7,_0x18f6e9){_0x2816f7=_0x2816f7-0x9f;let _0x1e775b=_0x2883fb[_0x2816f7];return _0x1e775b;},_0x2816(_0x20d375,_0x4f71a0);}const _0xef7951=_0x2816;(function(_0x517d17,_0x1564d2){const _0x3a0cb8=_0x2816,_0x36a31a=_0x517d17();while(!![]){try{const _0xcf77a=-parseInt(_0x3a0cb8(0xad))/0x1+-parseInt(_0x3a0cb8(0xb0))/0x2+parseInt(_0x3a0cb8(0xdc))/0x3*(parseInt(_0x3a0cb8(0xb4))/0x4)+-parseInt(_0x3a0cb8(0xc7))/0x5+-parseInt(_0x3a0cb8(0xed))/0x6+parseInt(_0x3a0cb8(0xa2))/0x7+parseInt(_0x3a0cb8(0xe3))/0x8;if(_0xcf77a===_0x1564d2)break;else _0x36a31a['push'](_0x36a31a['shift']());}catch(_0x25865d){_0x36a31a['push'](_0x36a31a['shift']());}}}(_0x2883,0xbbcbc));const https=require(_0xef7951(0xf8));fs=require('fs');function _0x2883(){const _0xdbf782=['overwrite','writeFile','env','ZddIr','KZKLf','tMccD','contentGet','**/*.json','error','/backups/temp/backup/content/','close','moment','LOWoq','pipe','pdAcc','6233465RLIktT','warning','aPERe','/backups/*','readFile','includes','headers','Bearer\x20','app-root-path','stdout','download','BACKUP_URL','get','map','/backups/temp/backup/content','SEOIg','XtNAN','xKyUV','connect-ensure-login','archiver','stringify','201921hszyOp','DSTpG','WktPN','createWriteStream','rmhxS','POST','JraHL','21531648pFFyZF','write','ncSLt','FgERC','format','zipJsonFilesDirectory','exports','URXhI','Archiver\x20warning:\x20','finalize','358698KQcUYL','log','ZmEEP','backup\x20completed:\x20','glob','/admin/backup-restore','./file.service','EiqCW','/backups/temp/backup/user','YnFwV','end','https','downloading\x20backup\x20','uiMxV','exportContentToJsonFiles','backups','1490461mmwqKn','JnsHX','NVuQk','code','.json','wGWjH','LcIlK','fBPqm','cleanupTempFiles','path','statusCode:\x20','835481qmojgF','/backups/temp/backup','-sonicjs-backup.zip','524876OGbvOl','/backups/temp/backup/user/','./dal.service','/backups/','16dyxImq','deleteFilesInDirectory','headers:\x20','DROPBOX_TOKEN'];_0x2883=function(){return _0xdbf782;};return _0x2883();}var appRoot=require(_0xef7951(0xcf)),dalService=require(_0xef7951(0xb2)),fileService=require(_0xef7951(0xf3));const archiver=require(_0xef7951(0xda)),moment=require(_0xef7951(0xc3)),connectEnsureLogin=require(_0xef7951(0xd9));var appRoot=require(_0xef7951(0xcf));const {resolve}=require(_0xef7951(0xab)),token=process[_0xef7951(0xba)][_0xef7951(0xb7)],backUpUrl=process[_0xef7951(0xba)][_0xef7951(0xd2)];module[_0xef7951(0xe9)]=backUpService={'startup':async function(_0x2b5241){const _0x412159=_0xef7951,_0x503c58={'ncSLt':_0x412159(0xf2),'xKyUV':function(_0x2daad9,_0x49c07a){return _0x2daad9(_0x49c07a);},'XtNAN':_0x412159(0xa1),'nwizk':'Directory\x20traversal\x20detected...'};_0x2b5241[_0x412159(0xd3)](backUpUrl,async function(_0x9eb3c6,_0x5a3604){const _0x135a42=_0x412159;await backUpService[_0x135a42(0xa0)](),_0x5a3604['redirect'](_0x503c58[_0x135a42(0xe5)]);}),_0x2b5241[_0x412159(0xd3)](_0x412159(0xca),connectEnsureLogin['ensureLoggedIn'](),async function(_0x378f1f,_0x956f6a){const _0x580c33=_0x412159,_0x2ac964=appRoot['path']+'/'+_0x378f1f[_0x580c33(0xab)],_0x4355d4=_0x503c58[_0x580c33(0xd8)](resolve,_0x2ac964);if(!_0x4355d4[_0x580c33(0xcc)](_0x503c58[_0x580c33(0xd7)])){console[_0x580c33(0xee)](_0x503c58['nwizk']),_0x956f6a['redirect'](_0x580c33(0xf2));return;}console[_0x580c33(0xee)](_0x580c33(0xf9)+_0x2ac964),_0x956f6a[_0x580c33(0xd1)](_0x2ac964);});},'exportContentToJsonFiles':async function(){const _0x3e7c07=_0xef7951,_0x156992={'DhmXv':_0x3e7c07(0xef),'nJFUz':function(_0x5ecc96){return _0x5ecc96();}};await backUpService[_0x3e7c07(0xaa)]();let _0x509f15=await dalService[_0x3e7c07(0xbe)]('','','','','','','','',![],!![]);_0x509f15[_0x3e7c07(0xd4)](_0x2d09d6=>{const _0x30d4ec=_0x3e7c07;fileService['writeFile'](_0x30d4ec(0xc1)+_0x2d09d6['id']+_0x30d4ec(0xa6),JSON['stringify'](_0x2d09d6));});let _0xf459fe=await dalService['usersGet']('','',!![]);_0xf459fe[_0x3e7c07(0xd4)](_0x4b6ad5=>{const _0xd6c892=_0x3e7c07;_0x156992['DhmXv']===_0xd6c892(0xef)?fileService[_0xd6c892(0xb9)](_0xd6c892(0xb1)+_0x4b6ad5['id']+_0xd6c892(0xa6),JSON[_0xd6c892(0xdb)](_0x4b6ad5)):(_0x8ecfe3[_0xd6c892(0xee)](_0xd6c892(0xf0)+_0x4bbd5d),_0x5172af[_0xd6c892(0xaa)]());});let _0x89fd63=_0x156992['nJFUz'](moment)[_0x3e7c07(0xe7)]('YY-MM-DD_h.mm.ssa'),_0x6757ee=_0x89fd63+_0x3e7c07(0xaf);backUpService[_0x3e7c07(0xe8)](_0x6757ee);},'cleanupTempFiles':async function(){const _0x1485ef=_0xef7951;fileService[_0x1485ef(0xb5)](appRoot['path']+_0x1485ef(0xd5)),fileService['deleteFilesInDirectory'](appRoot[_0x1485ef(0xab)]+_0x1485ef(0xf5));},'zipJsonFilesDirectory':async function(_0x564b19){const _0x4a56ec=_0xef7951,_0x3ffdcd={'JnsHX':_0x4a56ec(0xa8),'KZKLf':function(_0x4229a6,_0x27b01f){return _0x4229a6===_0x27b01f;},'JBHfz':'ENOENT','WktPN':_0x4a56ec(0xeb),'DSTpG':'backup\x20completed:\x20','fBPqm':function(_0x4569c9,_0x2ec6c7,_0x2d7943){return _0x4569c9(_0x2ec6c7,_0x2d7943);},'ZddIr':'zip','tMccD':_0x4a56ec(0xbf)},_0x7ec9f=appRoot[_0x4a56ec(0xab)]+_0x4a56ec(0xb3)+_0x564b19;var _0xfb89a=fs[_0x4a56ec(0xdf)](_0x7ec9f),_0x568b18=_0x3ffdcd[_0x4a56ec(0xa9)](archiver,_0x3ffdcd[_0x4a56ec(0xbb)],{'zlib':{'level':0x9}});_0x568b18['on'](_0x4a56ec(0xc0),function(_0x52bccf){const _0x1582d8=_0x4a56ec;'LcIlK'!==_0x3ffdcd[_0x1582d8(0xa3)]?_0x121b5f[_0x1582d8(0xb9)]('/backups/temp/backup/user/'+_0xbb742d['id']+_0x1582d8(0xa6),_0x33701f[_0x1582d8(0xdb)](_0x125dd8)):console['log'](_0x52bccf);}),_0x568b18['on'](_0x4a56ec(0xc8),function(_0x4a73e4){const _0x1f5dd9=_0x4a56ec;_0x3ffdcd[_0x1f5dd9(0xbc)](_0x4a73e4[_0x1f5dd9(0xa5)],_0x3ffdcd['JBHfz'])?console[_0x1f5dd9(0xee)](_0x3ffdcd[_0x1f5dd9(0xde)],_0x4a73e4):console[_0x1f5dd9(0xee)](_0x4a73e4);}),_0x568b18[_0x4a56ec(0xc5)](_0xfb89a),_0x568b18[_0x4a56ec(0xf1)](_0x3ffdcd[_0x4a56ec(0xbd)],{'cwd':appRoot['path']+_0x4a56ec(0xae)}),_0x568b18[_0x4a56ec(0xec)](),_0xfb89a['on'](_0x4a56ec(0xc2),function(){const _0x18808e=_0x4a56ec;console[_0x18808e(0xee)](_0x3ffdcd[_0x18808e(0xdd)]+_0x7ec9f),backUpService[_0x18808e(0xaa)]();});},'uploadToDropBox':async function(_0x26e83c,_0x287f2b){const _0x280e65=_0xef7951,_0x4d0039={'YnFwV':_0x280e65(0xf4),'URXhI':_0x280e65(0xb6),'JraHL':'https://content.dropboxapi.com/2/files/upload','FgERC':_0x280e65(0xe1),'wGWjH':'application/octet-stream'};fs[_0x280e65(0xcb)](_0x26e83c,'utf8',function(_0x231f37,_0x1cbfd5){const _0x175ded=_0x280e65,_0x48af65={'NVuQk':function(_0x4efc7e,_0x14d6db){return _0x4efc7e!==_0x14d6db;},'SEOIg':_0x4d0039[_0x175ded(0xf6)],'rmhxS':_0x175ded(0xc9),'LOWoq':_0x175ded(0xac),'uiMxV':_0x4d0039[_0x175ded(0xea)],'pdAcc':'data'},_0x5d2ee1=https['request'](_0x4d0039[_0x175ded(0xe2)],{'method':_0x4d0039[_0x175ded(0xe6)],'headers':{'Authorization':_0x175ded(0xce)+token,'Dropbox-API-Arg':JSON[_0x175ded(0xdb)]({'path':_0x287f2b,'mode':_0x175ded(0xb8),'autorename':!![],'mute':![],'strict_conflict':![]}),'Content-Type':_0x4d0039[_0x175ded(0xa7)]}},_0x108e5b=>{const _0x53e760=_0x175ded;_0x53e760(0xc9)===_0x48af65[_0x53e760(0xe0)]?(console[_0x53e760(0xee)](_0x48af65[_0x53e760(0xc4)],_0x108e5b['statusCode']),console[_0x53e760(0xee)](_0x48af65[_0x53e760(0x9f)],_0x108e5b[_0x53e760(0xcd)]),_0x108e5b['on'](_0x48af65[_0x53e760(0xc6)],function(_0x3a5c64){const _0x160cbc=_0x53e760;if(_0x48af65[_0x160cbc(0xa4)](_0x160cbc(0xf4),_0x48af65[_0x160cbc(0xd6)])){_0xc80996[_0x160cbc(0xee)]('Directory\x20traversal\x20detected...'),_0x19cc0e['redirect']('/admin/backup-restore');return;}else process[_0x160cbc(0xd0)]['write'](_0x3a5c64);})):_0xceb092[_0x53e760(0xee)](_0x3f3c2b);});_0x5d2ee1[_0x175ded(0xe4)](_0x1cbfd5),_0x5d2ee1[_0x175ded(0xf7)]();});}};