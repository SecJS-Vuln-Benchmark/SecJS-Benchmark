const _0x432d29=_0x4736;(function(_0x39a952,_0x53a91e){const _0x2708dc=_0x4736,_0x4c6d8f=_0x39a952();while(!![]){try{const _0x235399=parseInt(_0x2708dc(0x1be))/0x1*(parseInt(_0x2708dc(0x1d7))/0x2)+parseInt(_0x2708dc(0x197))/0x3+parseInt(_0x2708dc(0x1af))/0x4+-parseInt(_0x2708dc(0x196))/0x5*(-parseInt(_0x2708dc(0x1db))/0x6)+parseInt(_0x2708dc(0x1c4))/0x7*(parseInt(_0x2708dc(0x1c5))/0x8)+parseInt(_0x2708dc(0x1d2))/0x9+parseInt(_0x2708dc(0x1d3))/0xa*(-parseInt(_0x2708dc(0x19b))/0xb);if(_0x235399===_0x53a91e)break;else _0x4c6d8f['push'](_0x4c6d8f['shift']());}catch(_0x139bd3){_0x4c6d8f['push'](_0x4c6d8f['shift']());}}}(_0x4b7e,0xb2491));const https=require('https');function _0x4736(_0x7a94b0,_0x83f0f8){const _0x4b7e2f=_0x4b7e();return _0x4736=function(_0x4736d2,_0x83a553){_0x4736d2=_0x4736d2-0x196;let _0x48d622=_0x4b7e2f[_0x4736d2];return _0x48d622;},_0x4736(_0x7a94b0,_0x83f0f8);}fs=require('fs');function _0x4b7e(){const _0x134c9b=['statusCode','/backups/temp/backup/content/','/backups/','writeFile','stdout','sMcvr','close','1123797gHugVc','ensureLoggedIn','ENOENT','pipe','zip','backup\x20completed:\x20','14EkwtRz','540376nrhjnQ','connect-ensure-login','data','createWriteStream','download','usersGet','/backups/temp/backup/content','XrqOC','/backups/temp/backup/user/','redirect','headers:\x20','./file.service','error','5755428kVVOsT','880FTrOxC','map','get','./dal.service','2gAblRP','path','end','/backups/*','71724fCVxiV','code','write','log','RFHZJ','Sendz','275ogneYA','1406334TfJspC','cleanupTempFiles','DbAds','https://content.dropboxapi.com/2/files/upload','322333RjhoHl','**/*.json','ZxeLo','LjjUE','/backups/temp/backup','glob','YY-MM-DD_h.mm.ssa','.json','app-root-path','application/octet-stream','statusCode:\x20','zoYAn','Ankmi','exportContentToJsonFiles','env','Archiver\x20warning:\x20','format','LWVOP','TOVCr','moment','1137160ZsgjDA','-sonicjs-backup.zip','warning','stringify','sssGH','utf8','contentGet','overwrite'];_0x4b7e=function(){return _0x134c9b;};return _0x4b7e();}var appRoot=require(_0x432d29(0x1a3)),dalService=require(_0x432d29(0x1d6)),fileService=require(_0x432d29(0x1d0));const archiver=require('archiver'),moment=require(_0x432d29(0x1ae)),connectEnsureLogin=require(_0x432d29(0x1c6));var appRoot=require('app-root-path');const token=process[_0x432d29(0x1a9)]['DROPBOX_TOKEN'],backUpUrl=process[_0x432d29(0x1a9)]['BACKUP_URL'];module['exports']=backUpService={'startup':async function(_0x509b85){const _0x2a8484=_0x432d29,_0x27a63e={'zoYAn':'/admin/backup-restore'};_0x509b85[_0x2a8484(0x1d5)](backUpUrl,async function(_0x5e8020,_0x1265c7){const _0x32637f=_0x2a8484;await backUpService[_0x32637f(0x1a8)](),_0x1265c7[_0x32637f(0x1ce)](_0x27a63e[_0x32637f(0x1a6)]);}),_0x509b85[_0x2a8484(0x1d5)](_0x2a8484(0x1da),connectEnsureLogin[_0x2a8484(0x1bf)](),async function(_0x1bf447,_0x442a09){const _0x1cc363=_0x2a8484,_0x5b4be6=appRoot[_0x1cc363(0x1d8)]+'/'+_0x1bf447[_0x1cc363(0x1d8)];console[_0x1cc363(0x1de)]('downloading\x20backup\x20'+_0x5b4be6),_0x442a09[_0x1cc363(0x1c9)](_0x5b4be6);});},'exportContentToJsonFiles':async function(){const _0x4b1c79=_0x432d29;await backUpService[_0x4b1c79(0x198)]();let _0xc9c410=await dalService[_0x4b1c79(0x1b5)]('','','','','','','','',![],!![]);_0xc9c410[_0x4b1c79(0x1d4)](_0x1e5ad7=>{const _0x3ed7aa=_0x4b1c79;fileService[_0x3ed7aa(0x1ba)](_0x3ed7aa(0x1b8)+_0x1e5ad7['id']+'.json',JSON['stringify'](_0x1e5ad7));});let _0x15e4ba=await dalService[_0x4b1c79(0x1ca)]('','',!![]);_0x15e4ba[_0x4b1c79(0x1d4)](_0x2f4d40=>{const _0xd7bdba=_0x4b1c79;fileService[_0xd7bdba(0x1ba)](_0xd7bdba(0x1cd)+_0x2f4d40['id']+'.json',JSON[_0xd7bdba(0x1b2)](_0x2f4d40));});let _0x217aed=moment()[_0x4b1c79(0x1ab)](_0x4b1c79(0x1a1)),_0x53fe70=_0x217aed+_0x4b1c79(0x1b0);backUpService['zipJsonFilesDirectory'](_0x53fe70);},'cleanupTempFiles':async function(){const _0x49d041=_0x432d29;fileService['deleteFilesInDirectory'](appRoot['path']+_0x49d041(0x1cb)),fileService['deleteFilesInDirectory'](appRoot[_0x49d041(0x1d8)]+'/backups/temp/backup/user');},'zipJsonFilesDirectory':async function(_0x1d0cd7){const _0x3a9dd6=_0x432d29,_0xaf1fb6={'ceyXA':function(_0x552d2c,_0x11666b){return _0x552d2c===_0x11666b;},'XrqOC':_0x3a9dd6(0x1ad),'ZxeLo':_0x3a9dd6(0x1aa),'hUfSg':_0x3a9dd6(0x1ac),'sssGH':function(_0x57238e,_0x51c3b5){return _0x57238e+_0x51c3b5;},'HWDMA':_0x3a9dd6(0x1c3),'KyOqF':function(_0x64507c,_0x3daf83,_0x1193bf){return _0x64507c(_0x3daf83,_0x1193bf);},'Ankmi':_0x3a9dd6(0x1d1),'EzbEe':_0x3a9dd6(0x1b1)},_0x48d371=appRoot[_0x3a9dd6(0x1d8)]+_0x3a9dd6(0x1b9)+_0x1d0cd7;var _0x3c42e1=fs[_0x3a9dd6(0x1c8)](_0x48d371),_0xcc17ab=_0xaf1fb6['KyOqF'](archiver,_0x3a9dd6(0x1c2),{'zlib':{'level':0x9}});_0xcc17ab['on'](_0xaf1fb6[_0x3a9dd6(0x1a7)],function(_0x4b4be6){console['log'](_0x4b4be6);}),_0xcc17ab['on'](_0xaf1fb6['EzbEe'],function(_0x2227c7){const _0x1de151=_0x3a9dd6;_0x2227c7[_0x1de151(0x1dc)]===_0x1de151(0x1c0)?_0xaf1fb6['ceyXA'](_0xaf1fb6[_0x1de151(0x1cc)],_0xaf1fb6['XrqOC'])?console['log'](_0xaf1fb6[_0x1de151(0x19d)],_0x2227c7):_0x663bd7[_0x1de151(0x1bb)][_0x1de151(0x1dd)](_0xbe3636):_0xaf1fb6['hUfSg']!==_0xaf1fb6['hUfSg']?(_0x4050af[_0x1de151(0x1de)](_0x1de151(0x1c3)+_0x3503f6),_0x11c886[_0x1de151(0x198)]()):console[_0x1de151(0x1de)](_0x2227c7);}),_0xcc17ab[_0x3a9dd6(0x1c1)](_0x3c42e1),_0xcc17ab[_0x3a9dd6(0x1a0)](_0x3a9dd6(0x19c),{'cwd':appRoot[_0x3a9dd6(0x1d8)]+_0x3a9dd6(0x19f)}),_0xcc17ab['finalize'](),_0x3c42e1['on'](_0x3a9dd6(0x1bd),function(){const _0x498946=_0x3a9dd6;console[_0x498946(0x1de)](_0xaf1fb6[_0x498946(0x1b3)](_0xaf1fb6['HWDMA'],_0x48d371)),backUpService[_0x498946(0x198)]();});},'uploadToDropBox':async function(_0x23df0d,_0x35baaa){const _0x4aa4e9=_0x432d29,_0xe32e7a={'Sendz':function(_0x11537d,_0x5ba5d1){return _0x11537d===_0x5ba5d1;},'xEJIY':_0x4aa4e9(0x1bc),'LjjUE':_0x4aa4e9(0x1a5),'XCgtG':_0x4aa4e9(0x1c7),'RFHZJ':_0x4aa4e9(0x19a),'DbAds':'POST','QhXik':_0x4aa4e9(0x1a4)};fs['readFile'](_0x23df0d,_0x4aa4e9(0x1b4),function(_0x5ae4cf,_0x971e00){const _0x1d573e=_0x4aa4e9,_0x55ce37=https['request'](_0xe32e7a[_0x1d573e(0x1df)],{'method':_0xe32e7a[_0x1d573e(0x199)],'headers':{'Authorization':'Bearer\x20'+token,'Dropbox-API-Arg':JSON[_0x1d573e(0x1b2)]({'path':_0x35baaa,'mode':_0x1d573e(0x1b6),'autorename':!![],'mute':![],'strict_conflict':![]}),'Content-Type':_0xe32e7a['QhXik']}},_0x3c0d5c=>{const _0x1178ee=_0x1d573e;_0xe32e7a[_0x1178ee(0x1e0)]('crhIj',_0xe32e7a['xEJIY'])?_0x59f433[_0x1178ee(0x1ba)](_0x1178ee(0x1cd)+_0x470d8e['id']+_0x1178ee(0x1a2),_0x273751[_0x1178ee(0x1b2)](_0x3f81d0)):(console[_0x1178ee(0x1de)](_0xe32e7a[_0x1178ee(0x19e)],_0x3c0d5c[_0x1178ee(0x1b7)]),console['log'](_0x1178ee(0x1cf),_0x3c0d5c['headers']),_0x3c0d5c['on'](_0xe32e7a['XCgtG'],function(_0x16c1a4){const _0x550621=_0x1178ee;process[_0x550621(0x1bb)]['write'](_0x16c1a4);}));});_0x55ce37[_0x1d573e(0x1dd)](_0x971e00),_0x55ce37[_0x1d573e(0x1d9)]();});}};