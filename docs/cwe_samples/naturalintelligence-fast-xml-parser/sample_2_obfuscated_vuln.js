const _0x4d8fba=_0x33c4;function _0x18e2(){const _0x10766c=['join','880563uAkqdj','returns','chai','camera\x20controller\x20test','resolves','sinon','CAMERA_URL','test','should\x20get\x20index1.ts\x20file','error','SgSsn','emit','pKaum','base64image','noCallThru','Invalid\x20filename','get\x20/api/v1/service/rtsp-camera/camera/streaming/:folder/:file','231826mOqWcc','result.txt','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/ping','path','config','csxiT','KYBCk','897434SpVZsg','lalalalala','should\x20ping\x20streaming','env','isRejected','3033780tkioCG','camera-1','index1.ts','EZWlQ','128YCgOPN','TEMP_FOLDER','zdnQf','aTtOF','startStreamingIfNotStarted','/tmp/gladys','createWriteStream','.....','post\x20/api/v1/service/rtsp-camera/camera/test','../../../../services/rtsp-camera/api/rtspCamera.controller','syRQY','my-camera','fs-extra','TlCHc','writeFile','proxyquire','calledOnce','11392250SrKKoq','heEOH','eQJlu','test-toto-content','status','PPbuA','controller','11461122BgcNoC','DLQeg','tempFolder','1eGKxnc','IHZdq','should\x20return\x20404,\x20file\x20not\x20found\x20(res.status)\x20','should\x20return\x20400,\x20bad\x20request,\x20invalid\x20filename','liveActivePing','ensureDir','1536KZlUix','FVzvP','post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/stop','27055NTCbTA','ZNkMe','index12212.ts','XGjuW','calledWith','KaVnp'];_0x18e2=function(){return _0x10766c;};return _0x18e2();}(function(_0x916b99,_0x3ecebe){const _0x3ebaf4=_0x33c4,_0x2962ac=_0x916b99();while(!![]){try{const _0x19e626=parseInt(_0x3ebaf4(0x134))/0x1*(parseInt(_0x3ebaf4(0x15c))/0x2)+parseInt(_0x3ebaf4(0x144))/0x3+parseInt(_0x3ebaf4(0x115))/0x4+-parseInt(_0x3ebaf4(0x13d))/0x5*(parseInt(_0x3ebaf4(0x13a))/0x6)+parseInt(_0x3ebaf4(0x155))/0x7*(parseInt(_0x3ebaf4(0x119))/0x8)+parseInt(_0x3ebaf4(0x131))/0x9+-parseInt(_0x3ebaf4(0x12a))/0xa;if(_0x19e626===_0x3ecebe)break;else _0x2962ac['push'](_0x2962ac['shift']());}catch(_0x561485){_0x2962ac['push'](_0x2962ac['shift']());}}}(_0x18e2,0xbe544));function _0x33c4(_0x4e1237,_0x5ff85f){const _0x18e223=_0x18e2();return _0x33c4=function(_0x33c432,_0x22630d){_0x33c432=_0x33c432-0x113;let _0x463753=_0x18e223[_0x33c432];return _0x463753;},_0x33c4(_0x4e1237,_0x5ff85f);}const {assert:chaiAssert}=require(_0x4d8fba(0x146)),{assert,fake}=require(_0x4d8fba(0x149)),proxyquire=require(_0x4d8fba(0x128))[_0x4d8fba(0x152)](),fse=require(_0x4d8fba(0x125)),path=require(_0x4d8fba(0x158)),EventEmitter=require('events'),RtspCameraController=require(_0x4d8fba(0x122)),RtspCameraControllerWithFsMocked=proxyquire('../../../../services/rtsp-camera/api/rtspCamera.controller',{'fs':{'createReadStream':()=>{const _0x4fd541=_0x4d8fba,_0x49d1a6=new EventEmitter();return _0x49d1a6['pipe']=()=>_0x49d1a6[_0x4fd541(0x14f)](_0x4fd541(0x14d)),_0x49d1a6;}}}),gladys={'config':{'tempFolder':process[_0x4d8fba(0x113)][_0x4d8fba(0x11a)]||_0x4d8fba(0x11e)}},rtspCameraService={'getImage':fake['resolves'](_0x4d8fba(0x151)),'startStreamingIfNotStarted':fake[_0x4d8fba(0x148)]({}),'stopStreaming':fake[_0x4d8fba(0x148)]({}),'liveActivePing':fake[_0x4d8fba(0x148)](null)},res={'send':fake['returns'](null)};describe(_0x4d8fba(0x147),()=>{const _0x203dac=_0x4d8fba,_0x5831e7={'heEOH':_0x203dac(0x14a),'SgSsn':'CAMERA_ROTATION','FVzvP':function(_0xa50ba2,_0x1536e8,_0x16a1db){return _0xa50ba2(_0x1536e8,_0x16a1db);},'IHZdq':_0x203dac(0x121),'SRLQH':_0x203dac(0x124),'eQJlu':function(_0x5c497b,_0x3ceab1,_0x4062fe){return _0x5c497b(_0x3ceab1,_0x4062fe);},'ZNkMe':_0x203dac(0x116),'DLQeg':_0x203dac(0x12d),'zdnQf':_0x203dac(0x117),'TlCHc':_0x203dac(0x13f),'ARgqR':_0x203dac(0x156),'KaVnp':_0x203dac(0x154),'SUzTP':'FILE_NOT_FOUND','dlyzY':_0x203dac(0x153),'PPbuA':_0x203dac(0x15d),'pKaum':'Invalid\x20session\x20id','EZWlQ':function(_0x2a7a29,_0x2f0821,_0x367bf6){return _0x2a7a29(_0x2f0821,_0x367bf6);},'XGjuW':'should\x20start\x20streaming','YgrBy':_0x203dac(0x15e),'KYBCk':_0x203dac(0x14c),'aTtOF':_0x203dac(0x136),'syRQY':'should\x20return\x20404,\x20file\x20not\x20found\x20(throw\x20error)','csxiT':function(_0x23db48,_0x3ba034,_0x603b3f){return _0x23db48(_0x3ba034,_0x603b3f);},'ZfXRr':'should\x20return\x20400,\x20bad\x20request,\x20invalid\x20session\x20id'};it('should\x20return\x20an\x20image',async()=>{const _0x1d5da8=_0x203dac,_0x3f1d85={'params':[{'name':_0x5831e7[_0x1d5da8(0x12b)],'value':_0x1d5da8(0x14b)},{'name':_0x5831e7[_0x1d5da8(0x14e)],'value':'0'}]},_0x1b9b6d=_0x5831e7[_0x1d5da8(0x13b)](RtspCameraController,gladys,rtspCameraService),_0x43d1cc={'body':_0x3f1d85};await _0x1b9b6d[_0x5831e7[_0x1d5da8(0x135)]][_0x1d5da8(0x130)](_0x43d1cc,res),assert[_0x1d5da8(0x141)](rtspCameraService['getImage'],_0x3f1d85);}),_0x5831e7[_0x203dac(0x118)](it,_0x5831e7[_0x203dac(0x140)],async()=>{const _0x480c32=_0x203dac,_0x36a6c6=RtspCameraController(gladys,rtspCameraService),_0x3e94a5={'params':{'camera_selector':_0x480c32(0x124)},'body':{'is_gladys_gateway':![],'segment_duration':0x4}};await _0x36a6c6['post\x20/api/v1/service/rtsp-camera/camera/:camera_selector/streaming/start']['controller'](_0x3e94a5,res),assert[_0x480c32(0x141)](rtspCameraService[_0x480c32(0x11d)],_0x5831e7['SRLQH'],![],0x4);}),it('should\x20stop\x20streaming',async()=>{const _0x1c6f88=_0x203dac,_0x18fd50=RtspCameraController(gladys,rtspCameraService),_0x3c3204={'params':{'camera_selector':_0x1c6f88(0x124)}};await _0x18fd50[_0x1c6f88(0x13c)]['controller'](_0x3c3204,res),assert[_0x1c6f88(0x141)](rtspCameraService['stopStreaming'],_0x5831e7['SRLQH']);}),_0x5831e7[_0x203dac(0x13b)](it,_0x5831e7['YgrBy'],async()=>{const _0x220d98=_0x203dac,_0x18f26f=_0x5831e7[_0x220d98(0x12c)](RtspCameraController,gladys,rtspCameraService),_0x3339ba={'params':{'camera_selector':_0x5831e7['SRLQH']}};await _0x18f26f[_0x220d98(0x157)][_0x220d98(0x130)](_0x3339ba,res),assert[_0x220d98(0x141)](rtspCameraService[_0x220d98(0x138)],_0x5831e7['SRLQH']);}),_0x5831e7['EZWlQ'](it,'should\x20get\x20index.m3u8\x20file',async()=>{const _0x3eaa94=_0x203dac,_0x3e6988=_0x5831e7['FVzvP'](RtspCameraController,gladys,rtspCameraService),_0x4f55f7={'params':{'folder':_0x5831e7[_0x3eaa94(0x13e)],'file':'index.m3u8'}};await fse[_0x3eaa94(0x139)](path['join'](gladys[_0x3eaa94(0x159)][_0x3eaa94(0x133)],'camera-1')),await fse[_0x3eaa94(0x127)](path[_0x3eaa94(0x143)](gladys[_0x3eaa94(0x159)]['tempFolder'],_0x5831e7[_0x3eaa94(0x13e)],'index.m3u8'),_0x5831e7[_0x3eaa94(0x132)]);const _0x2eade6=fse['createWriteStream'](path[_0x3eaa94(0x143)](gladys[_0x3eaa94(0x159)][_0x3eaa94(0x133)],_0x3eaa94(0x116),_0x3eaa94(0x156)));await _0x3e6988[_0x3eaa94(0x154)][_0x3eaa94(0x130)](_0x4f55f7,_0x2eade6);}),_0x5831e7[_0x203dac(0x12c)](it,_0x5831e7[_0x203dac(0x15b)],async()=>{const _0x37b04a=_0x203dac,_0x45e467=RtspCameraController(gladys,rtspCameraService),_0x2a7dde={'params':{'folder':_0x5831e7[_0x37b04a(0x13e)],'file':_0x37b04a(0x117)}};await fse[_0x37b04a(0x139)](path[_0x37b04a(0x143)](gladys[_0x37b04a(0x159)][_0x37b04a(0x133)],_0x37b04a(0x116))),await fse[_0x37b04a(0x127)](path[_0x37b04a(0x143)](gladys['config'][_0x37b04a(0x133)],_0x5831e7[_0x37b04a(0x13e)],_0x5831e7[_0x37b04a(0x11b)]),_0x37b04a(0x12d));const _0x419044=fse['createWriteStream'](path[_0x37b04a(0x143)](gladys['config'][_0x37b04a(0x133)],'camera-1','result.txt'));await _0x45e467['get\x20/api/v1/service/rtsp-camera/camera/streaming/:folder/:file'][_0x37b04a(0x130)](_0x2a7dde,_0x419044);}),it(_0x5831e7[_0x203dac(0x11c)],async()=>{const _0x3152ae=_0x203dac,_0x439d5d=_0x5831e7[_0x3152ae(0x13b)](RtspCameraControllerWithFsMocked,gladys,rtspCameraService),_0x2dce6c={'params':{'folder':_0x3152ae(0x116),'file':_0x5831e7[_0x3152ae(0x126)]}},_0xf0792b=fse[_0x3152ae(0x11f)](path[_0x3152ae(0x143)](gladys[_0x3152ae(0x159)]['tempFolder'],'camera-1',_0x5831e7['ARgqR'])),_0xe376ef=fake[_0x3152ae(0x145)](null);_0xf0792b[_0x3152ae(0x12e)]=fake[_0x3152ae(0x145)]({'end':_0xe376ef}),await _0x439d5d[_0x5831e7[_0x3152ae(0x142)]]['controller'](_0x2dce6c,_0xf0792b),assert[_0x3152ae(0x141)](_0xf0792b['status'],0x194),assert[_0x3152ae(0x129)](_0xe376ef);}),it(_0x5831e7[_0x203dac(0x123)],async()=>{const _0x36bb3b=_0x203dac,_0x11ed4c=RtspCameraController(gladys,rtspCameraService),_0xbf66b4={},_0x30e895={},_0x35e6e3=_0x11ed4c[_0x36bb3b(0x154)][_0x36bb3b(0x130)](_0xbf66b4,_0x30e895);await chaiAssert[_0x36bb3b(0x114)](_0x35e6e3,_0x5831e7['SUzTP']);}),_0x5831e7[_0x203dac(0x15a)](it,_0x203dac(0x137),async()=>{const _0x44f3bf=_0x203dac,_0x498039=RtspCameraController(gladys,rtspCameraService),_0x409fb8={'params':{'folder':'camera-1','file':_0x44f3bf(0x15d)}},_0x45775a={},_0x50078c=_0x498039[_0x5831e7[_0x44f3bf(0x142)]][_0x44f3bf(0x130)](_0x409fb8,_0x45775a);await chaiAssert['isRejected'](_0x50078c,_0x5831e7['dlyzY']);}),it(_0x5831e7['ZfXRr'],async()=>{const _0x1a2f03=_0x203dac,_0xdd8572=_0x5831e7['FVzvP'](RtspCameraController,gladys,rtspCameraService),_0x47df1d={'params':{'folder':_0x1a2f03(0x120),'file':_0x5831e7[_0x1a2f03(0x12f)]}},_0x3ac420={},_0x3001b9=_0xdd8572[_0x5831e7['KaVnp']][_0x1a2f03(0x130)](_0x47df1d,_0x3ac420);await chaiAssert[_0x1a2f03(0x114)](_0x3001b9,_0x5831e7[_0x1a2f03(0x150)]);});});