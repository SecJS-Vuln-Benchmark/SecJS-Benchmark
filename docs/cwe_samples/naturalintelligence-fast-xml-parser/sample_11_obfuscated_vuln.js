'use strict';const _0xdd511e=_0x5613;(function(_0xb3ecbd,_0x4ec5d4){const _0x1522fb=_0x5613,_0x37990c=_0xb3ecbd();while(!![]){try{const _0x5b2a50=-parseInt(_0x1522fb(0x204))/0x1*(parseInt(_0x1522fb(0x1fd))/0x2)+parseInt(_0x1522fb(0x218))/0x3*(parseInt(_0x1522fb(0x1d5))/0x4)+-parseInt(_0x1522fb(0x201))/0x5+parseInt(_0x1522fb(0x20f))/0x6*(-parseInt(_0x1522fb(0x1ff))/0x7)+parseInt(_0x1522fb(0x222))/0x8+-parseInt(_0x1522fb(0x1fc))/0x9+parseInt(_0x1522fb(0x212))/0xa*(parseInt(_0x1522fb(0x225))/0xb);if(_0x5b2a50===_0x4ec5d4)break;else _0x37990c['push'](_0x37990c['shift']());}catch(_0x583691){_0x37990c['push'](_0x37990c['shift']());}}}(_0xd1cc,0x9696f));const assert=require('assert'),fs=require('fs'),https=require(_0xdd511e(0x20d)),path=require('path'),url=require(_0xdd511e(0x1f0)),chromeLauncher=require(_0xdd511e(0x209)),compression=require(_0xdd511e(0x221)),express=require(_0xdd511e(0x1fe)),now=require(_0xdd511e(0x1e2)),uuidv4=require(_0xdd511e(0x215)),cache=require('./cache'),renderer=require(_0xdd511e(0x205)),app=express(),CONFIG_PATH=path[_0xdd511e(0x1e7)](__dirname,_0xdd511e(0x21c)),PROGRESS_BAR_PATH=path[_0xdd511e(0x1e7)](__dirname,'../node_modules/progress-bar-element/progress-bar.html'),PORT=process[_0xdd511e(0x1e8)]['PORT']||_0xdd511e(0x219),ENVIRONMENT=process['env'][_0xdd511e(0x22d)];let config={};fs['existsSync'](CONFIG_PATH)&&(config=JSON[_0xdd511e(0x1d7)](fs[_0xdd511e(0x20a)](CONFIG_PATH)),assert(config instanceof Object));!module[_0xdd511e(0x1f7)]&&!!config[_0xdd511e(0x22c)]&&(app[_0xdd511e(0x1eb)]('/render/:url(*)',cache[_0xdd511e(0x210)]()),app[_0xdd511e(0x1eb)](_0xdd511e(0x1dc),cache[_0xdd511e(0x210)]()),cache[_0xdd511e(0x22b)]());app[_0xdd511e(0x1f5)]=_0x2bb31d=>{const _0x36447b=_0xdd511e,_0x22564e=config;config=_0x2bb31d,config[_0x36447b(0x1d6)]=_0x22564e[_0x36447b(0x1d6)],config[_0x36447b(0x1d8)]=_0x22564e[_0x36447b(0x1d8)];},app[_0xdd511e(0x21b)](compression()),app[_0xdd511e(0x21b)]('/progress-bar.html',express[_0xdd511e(0x1ea)](PROGRESS_BAR_PATH)),app[_0xdd511e(0x1eb)]('/',(_0x445d83,_0x11c321)=>{const _0x155480=_0xdd511e,_0x2ff7f9={'iHmJr':_0x155480(0x208)};_0x11c321['sendFile'](path[_0x155480(0x1e7)](__dirname,_0x2ff7f9[_0x155480(0x216)]));});function isRestricted(_0x6842b6){const _0x45cf89=_0xdd511e,_0x1a88a6={'LoLxk':'renderOnly'},_0x32d525=url['parse'](_0x6842b6)[_0x45cf89(0x1e4)]||'';if(!_0x32d525[_0x45cf89(0x20b)](/^https?/))return!![];if(!config[_0x1a88a6[_0x45cf89(0x211)]])return![];for(let _0x662ac4=0x0;_0x662ac4<config[_0x45cf89(0x1e5)][_0x45cf89(0x20e)];_0x662ac4++){if(_0x6842b6[_0x45cf89(0x1f4)](config[_0x1a88a6[_0x45cf89(0x211)]][_0x662ac4]))return![];}return!![];}function track(_0x11b941,_0x4209f8){const _0x4ad761=_0xdd511e,_0x59888e={'KkfVO':_0x4ad761(0x22e),'kNsci':_0x4ad761(0x214),'iGbBo':_0x4ad761(0x1fb)};if(config[_0x4ad761(0x1fb)]){const _0x3c07d0={'host':_0x59888e[_0x4ad761(0x1f8)],'path':_0x59888e['kNsci'],'method':_0x4ad761(0x203)},_0x587ff8=https['request'](_0x3c07d0);_0x587ff8[_0x4ad761(0x1fa)](_0x4ad761(0x226)+_0x11b941+'&ev='+Math[_0x4ad761(0x1e6)](_0x4209f8)+_0x4ad761(0x213)+config[_0x59888e[_0x4ad761(0x1ee)]]+'&cid='+uuidv4()),_0x587ff8['end']();}}app[_0xdd511e(0x1eb)](_0xdd511e(0x230),async(_0x497775,_0x268bbb)=>{const _0x59241b=_0xdd511e,_0x279902={'gEDmt':function(_0x355507,_0x404bac){return _0x355507(_0x404bac);},'JNUXI':_0x59241b(0x207),'INURo':function(_0xa30170,_0x2c0a47,_0x17988b){return _0xa30170(_0x2c0a47,_0x17988b);},'BJimO':_0x59241b(0x22a),'VNHCd':function(_0x1cb960,_0x21668d){return _0x1cb960-_0x21668d;}};if(_0x279902[_0x59241b(0x1e9)](isRestricted,_0x497775[_0x59241b(0x227)]['url'])){_0x268bbb[_0x59241b(0x1e3)](0x193)[_0x59241b(0x224)]('Render\x20request\x20forbidden,\x20domain\x20excluded');return;}try{if(_0x279902['JNUXI']===_0x59241b(0x207)){const _0x4dcc5c=now(),_0x455037=await renderer[_0x59241b(0x1de)](_0x497775[_0x59241b(0x227)][_0x59241b(0x1f0)],_0x497775[_0x59241b(0x21e)],config);_0x268bbb[_0x59241b(0x1e3)](_0x455037[_0x59241b(0x1e3)])[_0x59241b(0x224)](_0x455037['body']),_0x279902[_0x59241b(0x1f6)](track,_0x279902[_0x59241b(0x1ed)],_0x279902['VNHCd'](now(),_0x4dcc5c));}else _0x2d87c0[_0x59241b(0x1e1)](_0x50b516[_0x59241b(0x1e7)](_0x233539,_0x59241b(0x208)));}catch(_0xaa0064){_0x268bbb[_0x59241b(0x1e3)](0x190)[_0x59241b(0x224)](_0x59241b(0x200)),console[_0x59241b(0x228)](_0xaa0064);}}),app[_0xdd511e(0x1eb)]('/screenshot/:url(*)',async(_0x4c46ec,_0x2365d6)=>{const _0x4c9ef9=_0xdd511e,_0x54966a={'GdoIK':function(_0x4335f6,_0x4a0c2f){return _0x4335f6(_0x4a0c2f);},'YEzrJ':'image/jpeg','paRmP':'screenshot','Gialw':function(_0x211de7,_0x4054b2){return _0x211de7-_0x4054b2;},'NxHuB':function(_0x3faf5c){return _0x3faf5c();},'EmJgR':_0x4c9ef9(0x200)};if(_0x54966a[_0x4c9ef9(0x22f)](isRestricted,_0x4c46ec[_0x4c9ef9(0x227)]['url'])){_0x2365d6[_0x4c9ef9(0x1e3)](0x193)[_0x4c9ef9(0x224)](_0x4c9ef9(0x206));return;}try{const _0x419cdb=now(),_0x2bc444=await renderer[_0x4c9ef9(0x1f9)](_0x4c46ec[_0x4c9ef9(0x227)][_0x4c9ef9(0x1f0)],_0x4c46ec[_0x4c9ef9(0x21e)],config)[_0x4c9ef9(0x1f1)](_0x16d5a4=>console[_0x4c9ef9(0x228)](_0x16d5a4)),_0x5b831f=new Buffer(_0x2bc444,_0x4c9ef9(0x1e0));_0x2365d6['set']({'Content-Type':_0x54966a[_0x4c9ef9(0x1df)],'Content-Length':_0x5b831f[_0x4c9ef9(0x20e)]}),_0x2365d6[_0x4c9ef9(0x1ef)](_0x5b831f),track(_0x54966a[_0x4c9ef9(0x1f2)],_0x54966a['Gialw'](_0x54966a[_0x4c9ef9(0x1dd)](now),_0x419cdb));}catch(_0x493601){_0x2365d6[_0x4c9ef9(0x1e3)](0x190)['send'](_0x54966a[_0x4c9ef9(0x21f)]),console[_0x4c9ef9(0x228)](_0x493601);}}),app['get']('/_ah/health',(_0x3fa122,_0x2ea584)=>_0x2ea584[_0xdd511e(0x224)]('OK'));ENVIRONMENT===_0xdd511e(0x1d9)&&app[_0xdd511e(0x1eb)](_0xdd511e(0x220),async(_0x4415ac,_0x57cc05)=>{const _0x4e81a0=_0xdd511e;await app[_0x4e81a0(0x20c)](),_0x57cc05[_0x4e81a0(0x224)]('OK');});app[_0xdd511e(0x20c)]=async()=>{const _0x7b2f6d=_0xdd511e;await config['chrome'][_0x7b2f6d(0x1ec)]();};const appPromise=chromeLauncher[_0xdd511e(0x1da)]({'chromeFlags':[_0xdd511e(0x202),_0xdd511e(0x21d),_0xdd511e(0x217)],'port':0x0})['then'](_0x2c1694=>{const _0x37612d=_0xdd511e,_0x5e0123={'wUfYL':'Listening\x20on\x20port'};return console[_0x37612d(0x21a)]('Chrome\x20launched\x20with\x20debugging\x20on\x20port',_0x2c1694[_0x37612d(0x1d8)]),config['chrome']=_0x2c1694,config[_0x37612d(0x1d8)]=_0x2c1694['port'],!module[_0x37612d(0x1f7)]&&app[_0x37612d(0x1d4)](PORT,function(){const _0xe90827=_0x37612d;console[_0xe90827(0x21a)](_0x5e0123[_0xe90827(0x1db)],PORT);}),app;})[_0xdd511e(0x1f1)](_0x15f1c1=>{const _0x3793d1=_0xdd511e;console[_0x3793d1(0x228)](_0x15f1c1),process[_0x3793d1(0x223)](0x1);});function _0xd1cc(){const _0x4e1cf9=['render','clearCache','cache','NODE_ENV','www.google-analytics.com','GdoIK','/render/:url(*)','listen','62968HQCrFi','chrome','parse','port','development','launch','wUfYL','/screenshot/:url(*)','NxHuB','serialize','YEzrJ','base64','sendFile','performance-now','status','protocol','renderOnly','round','resolve','env','gEDmt','static','get','kill','BJimO','iGbBo','end','url','catch','paRmP','uncaughtException','startsWith','setConfig','INURo','parent','KkfVO','captureScreenshot','write','analyticsTrackingId','4635324qAYpFV','228DCQoCn','express','792813DoXvAB','Cannot\x20render\x20requested\x20URL','6087415SAvjqi','--headless','POST','1445DTqvSG','./renderer','Render\x20request\x20forbidden,\x20domain\x20excluded','uXEHY','index.html','chrome-launcher','readFileSync','match','stop','https','length','6jDQOtb','middleware','LoLxk','180yJiYws','&tid=','/collect','uuid/v4','iHmJr','--remote-debugging-address=0.0.0.0','45XUiEld','3000','log','use','../config.json','--disable-gpu','query','EmJgR','/_ah/stop','compression','7441064gWjLPQ','exit','send','892870daBOLm','v=1&t=event&ec=render&ea=','params','error','\x20errors,\x20shutting\x20instance\x20down'];_0xd1cc=function(){return _0x4e1cf9;};return _0xd1cc();}let exceptionCount=0x0;function _0x5613(_0x582d2e,_0x416403){const _0xd1cc78=_0xd1cc();return _0x5613=function(_0x561315,_0x47c8a6){_0x561315=_0x561315-0x1d4;let _0x298ef3=_0xd1cc78[_0x561315];return _0x298ef3;},_0x5613(_0x582d2e,_0x416403);}async function logUncaughtError(_0x3710d5){const _0x4088c7=_0xdd511e;console[_0x4088c7(0x228)]('Uncaught\x20exception'),console['error'](_0x3710d5),exceptionCount++;if(exceptionCount>0x5){console[_0x4088c7(0x21a)]('Detected\x20'+exceptionCount+_0x4088c7(0x229));if(config&&config[_0x4088c7(0x1d6)])await app[_0x4088c7(0x20c)]();process[_0x4088c7(0x223)](0x1);}}!module[_0xdd511e(0x1f7)]&&(process['on'](_0xdd511e(0x1f3),logUncaughtError),process['on']('unhandledRejection',logUncaughtError));module['exports']=appPromise;