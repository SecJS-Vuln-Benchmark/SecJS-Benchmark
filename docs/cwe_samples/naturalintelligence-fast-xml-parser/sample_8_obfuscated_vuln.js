'use strict';const _0x29c8e1=_0x2357;(function(_0x5410dd,_0x40ff48){const _0x22e6bc=_0x2357,_0x5c94c9=_0x5410dd();while(!![]){try{const _0x1b2e61=parseInt(_0x22e6bc(0x1bb))/0x1*(-parseInt(_0x22e6bc(0x1ad))/0x2)+-parseInt(_0x22e6bc(0x1a2))/0x3+parseInt(_0x22e6bc(0x1e4))/0x4*(parseInt(_0x22e6bc(0x1bf))/0x5)+parseInt(_0x22e6bc(0x1c5))/0x6+-parseInt(_0x22e6bc(0x191))/0x7+-parseInt(_0x22e6bc(0x1c8))/0x8*(-parseInt(_0x22e6bc(0x1d0))/0x9)+parseInt(_0x22e6bc(0x1ab))/0xa*(parseInt(_0x22e6bc(0x19e))/0xb);if(_0x1b2e61===_0x40ff48)break;else _0x5c94c9['push'](_0x5c94c9['shift']());}catch(_0x1cb73){_0x5c94c9['push'](_0x5c94c9['shift']());}}}(_0x5c38,0x62c8d));function _0x2357(_0x291854,_0x3c1f39){const _0x5c3853=_0x5c38();return _0x2357=function(_0x235705,_0x168016){_0x235705=_0x235705-0x18c;let _0x15d412=_0x5c3853[_0x235705];return _0x15d412;},_0x2357(_0x291854,_0x3c1f39);}function _0x5c38(){const _0x430bfc=['bAVQW','fallthrough','substring','btOpb','slackbot','makeMiddleware','localhost','eSFEH','4763HMkfkH','status','excludes\x20static\x20file\x20paths\x20by\x20default','zupLK','402813YClteU','xBUZs','Nknvw','FNhNH','use','falls\x20through\x20after\x20timeout','dsiVC','NsnoP','vYuis','1730dtDJWv','end','778348gDpnub','rBWsU','listen','rlmpF','proxies\x20through\x20given\x20url','wBYKK','jJPIT','respects\x20custom\x20exclude\x20url\x20pattern','proxy\x20error','PVoCW','MYSWf','text','XmIjW','iTnqa','1IYtspM','url\x20exclusion\x20only\x20matches\x20url\x20path\x20component','false','http://example.com','5nPgFVb','adds\x20shady\x20dom\x20parameter','set','makes\x20a\x20middleware\x20function','oZRLB','truthy','3123756kcXSGf','MxiDf','/foo.png','8RWqXSo','/bar','/foo?wc-inject-shadydom','url','LjlER','hmWut','get','too\x20slow','5582349aQPKdc','throws','ylKWx','supertest','FXvcZ','RMTgN','borg','mefnI','throws\x20if\x20no\x20proxyUrl\x20given','fzdqX','proxy\x20','User-Agent','dyaqe','/foo.png?params','YrYTh','../src/middleware','ewEtQ','Chrome','proxyUrl\x20can\x20have\x20trailing\x20slash','express','1553924dlaTun','xyXjr','Ibtza','/foo','toOTJ','ava','LPrwe','oSUNU','4733477yuJEgw','dhNII','address','port','KtbkN'];_0x5c38=function(){return _0x430bfc;};return _0x5c38();}const express=require(_0x29c8e1(0x1e3)),supertest=require(_0x29c8e1(0x1d3)),test=require(_0x29c8e1(0x18e)),rendertron=require(_0x29c8e1(0x1df));async function listen(_0x5a196d){const _0x5db6a8=_0x29c8e1,_0x49b727={'tvhhi':'ojbJw','xBUZs':_0x5db6a8(0x19c)};return new Promise(_0x46fc67=>{const _0x2d6d58=_0x5db6a8;if(_0x2d6d58(0x1d7)===_0x49b727['tvhhi'])_0x69d6ad[_0x2d6d58(0x1ac)]('proxy\x20'+_0xfa8c01(_0x301e09[_0x2d6d58(0x1cb)][_0x2d6d58(0x198)](0x1)));else{const _0xa7d27=_0x5a196d[_0x2d6d58(0x1af)](0x0,_0x49b727[_0x2d6d58(0x1a3)],()=>{const _0x29ea92=_0x2d6d58;_0x46fc67('http://localhost:'+_0xa7d27[_0x29ea92(0x193)]()[_0x29ea92(0x194)]);});}});}function makeApp(_0x37542f){const _0x589e18=_0x29c8e1;return express()[_0x589e18(0x1a6)](rendertron[_0x589e18(0x19b)](_0x37542f))[_0x589e18(0x1a6)]((_0x152706,_0x3a664f)=>_0x3a664f['end'](_0x589e18(0x197)));}function makeProxy(){const _0xf31809={'VPtZh':function(_0xdbfe44,_0x5d238f){return _0xdbfe44+_0x5d238f;},'ewEtQ':function(_0x36a082,_0x3bceb2){return _0x36a082(_0x3bceb2);}};return express()['use']((_0x4c7587,_0xebf330)=>{const _0x7d9665=_0x2357;_0xebf330[_0x7d9665(0x1ac)](_0xf31809['VPtZh'](_0x7d9665(0x1da),_0xf31809[_0x7d9665(0x1e0)](decodeURIComponent,_0x4c7587[_0x7d9665(0x1cb)]['substring'](0x1))));});}const bot=_0x29c8e1(0x19a),human=_0x29c8e1(0x1e1);async function get(_0x596b18,_0x17d75c,_0x31b5d9){const _0x240523=_0x29c8e1,_0x827aea={'bAVQW':function(_0x265fd8,_0x263ae8){return _0x265fd8(_0x263ae8);}};return await _0x827aea[_0x240523(0x196)](supertest,_0x17d75c)[_0x240523(0x1ce)](_0x31b5d9)[_0x240523(0x1c1)](_0x240523(0x1db),_0x596b18);}test(_0x29c8e1(0x1c2),async _0x30f134=>{const _0x111185=_0x29c8e1,_0x49cf6e=rendertron['makeMiddleware']({'proxyUrl':_0x111185(0x1be)});_0x30f134[_0x111185(0x1c4)](_0x49cf6e);}),test(_0x29c8e1(0x1d8),async _0x37b27e=>{const _0xb6802=_0x29c8e1;_0x37b27e[_0xb6802(0x1d1)](()=>rendertron[_0xb6802(0x19b)]()),_0x37b27e[_0xb6802(0x1d1)](()=>rendertron[_0xb6802(0x19b)]({})),_0x37b27e[_0xb6802(0x1d1)](()=>rendertron[_0xb6802(0x19b)]({'proxyUrl':''}));}),test(_0x29c8e1(0x1b1),async _0x2710e7=>{const _0x20d73e=_0x29c8e1,_0x2de8ba={'zluhg':function(_0x4c67cf,_0x2e6de8){return _0x4c67cf(_0x2e6de8);},'LkVvA':function(_0x5860c5,_0x5eecdb){return _0x5860c5(_0x5eecdb);},'UQtEE':function(_0x415767,_0x19ed51,_0x28065d,_0x308b38){return _0x415767(_0x19ed51,_0x28065d,_0x308b38);},'Ibtza':_0x20d73e(0x18c),'kVyYZ':_0x20d73e(0x1da)},_0x18fa09=await listen(makeProxy()),_0x3851cc=await _0x2de8ba['zluhg'](listen,_0x2de8ba['LkVvA'](makeApp,{'proxyUrl':_0x18fa09})),_0x582d6e=await _0x2de8ba['UQtEE'](get,bot,_0x3851cc,_0x2de8ba['Ibtza']);_0x2710e7['is'](_0x582d6e['status'],0xc8),_0x2710e7['is'](_0x582d6e[_0x20d73e(0x1b8)],_0x2de8ba['kVyYZ']+_0x3851cc+_0x2de8ba[_0x20d73e(0x1e6)]);}),test(_0x29c8e1(0x1e2),async _0x18bb76=>{const _0xf9c22f=_0x29c8e1,_0x466809={'iTnqa':function(_0x94ed43){return _0x94ed43();},'rlmpF':function(_0x4a3eb6,_0x5b347a){return _0x4a3eb6(_0x5b347a);},'dsiVC':function(_0x28ff4d,_0x593290){return _0x28ff4d+_0x593290;},'FXvcZ':_0xf9c22f(0x18c),'LjlER':'proxy\x20'},_0x5f2944=await listen(_0x466809[_0xf9c22f(0x1ba)](makeProxy));_0x18bb76[_0xf9c22f(0x1bd)](_0x5f2944['endsWith']('/'));const _0x507562=await _0x466809[_0xf9c22f(0x1b0)](listen,makeApp({'proxyUrl':_0x466809[_0xf9c22f(0x1a8)](_0x5f2944,'/')})),_0x17a286=await get(bot,_0x507562,_0x466809[_0xf9c22f(0x1d4)]);_0x18bb76['is'](_0x17a286[_0xf9c22f(0x19f)],0xc8),_0x18bb76['is'](_0x17a286['text'],_0x466809[_0xf9c22f(0x1cc)]+_0x507562+_0x466809[_0xf9c22f(0x1d4)]);}),test(_0x29c8e1(0x1c0),async _0x2fd6d5=>{const _0x2005de=_0x29c8e1,_0xdac333={'YrYTh':function(_0x4c5d6e,_0x3d3792){return _0x4c5d6e(_0x3d3792);},'dGySx':function(_0x3ca782){return _0x3ca782();},'xDyzj':function(_0x53be08,_0x476b70){return _0x53be08(_0x476b70);},'fzdqX':function(_0x578681,_0x51154a){return _0x578681(_0x51154a);},'uSAbl':function(_0x1f74fb,_0x8dcfd3,_0x325c14,_0x581320){return _0x1f74fb(_0x8dcfd3,_0x325c14,_0x581320);},'dhNII':_0x2005de(0x1da)},_0x12128a=await _0xdac333[_0x2005de(0x1de)](listen,_0xdac333['dGySx'](makeProxy)),_0x9b374b=await _0xdac333['xDyzj'](listen,_0xdac333[_0x2005de(0x1d9)](makeApp,{'proxyUrl':_0x12128a,'injectShadyDom':!![]})),_0x21f692=await _0xdac333['uSAbl'](get,bot,_0x9b374b,'/foo');_0x2fd6d5['is'](_0x21f692[_0x2005de(0x19f)],0xc8),_0x2fd6d5['is'](_0x21f692[_0x2005de(0x1b8)],_0xdac333[_0x2005de(0x192)]+_0x9b374b+_0x2005de(0x1ca));}),test(_0x29c8e1(0x1a0),async _0x22fd59=>{const _0xe95f6b=_0x29c8e1,_0x4b7cf5={'HuwxP':function(_0x7a906c){return _0x7a906c();},'TiiLM':function(_0x4b8a36,_0x344613){return _0x4b8a36(_0x344613);},'btOpb':function(_0x4aec29,_0x2556dd){return _0x4aec29(_0x2556dd);},'OVaXc':_0xe95f6b(0x1c7),'tHcJv':'fallthrough'},_0x2f5721=await listen(_0x4b7cf5['HuwxP'](makeProxy)),_0x4d3ea7=await _0x4b7cf5['TiiLM'](listen,_0x4b7cf5[_0xe95f6b(0x199)](makeApp,{'proxyUrl':_0x2f5721})),_0x1852f6=await get(bot,_0x4d3ea7,_0x4b7cf5['OVaXc']);_0x22fd59['is'](_0x1852f6['text'],_0x4b7cf5['tHcJv']);}),test(_0x29c8e1(0x1bc),async _0x307949=>{const _0x26f313=_0x29c8e1,_0x419bd3={'ylKWx':function(_0x38a04c,_0x2e914c){return _0x38a04c(_0x2e914c);},'toOTJ':function(_0x5ca1b7,_0x5105df,_0x187439,_0x2c6c23){return _0x5ca1b7(_0x5105df,_0x187439,_0x2c6c23);}},_0x247437=await _0x419bd3[_0x26f313(0x1d2)](listen,makeProxy()),_0x4616a8=await listen(_0x419bd3[_0x26f313(0x1d2)](makeApp,{'proxyUrl':_0x247437})),_0x4f31d3=await _0x419bd3[_0x26f313(0x18d)](get,bot,_0x4616a8,_0x26f313(0x1dd));_0x307949['is'](_0x4f31d3[_0x26f313(0x1b8)],_0x26f313(0x197));}),test('excludes\x20non-bot\x20user\x20agents\x20by\x20default',async _0x22511c=>{const _0x132537=_0x29c8e1,_0xb44926={'Avtqw':function(_0x17c9af){return _0x17c9af();},'NWiWA':function(_0x414fda,_0x2e6cff){return _0x414fda(_0x2e6cff);},'vYuis':_0x132537(0x197)},_0x1d072f=await listen(_0xb44926['Avtqw'](makeProxy)),_0x198fff=await listen(_0xb44926['NWiWA'](makeApp,{'proxyUrl':_0x1d072f})),_0x581ac1=await get(human,_0x198fff,_0x132537(0x18c));_0x22511c['is'](_0x581ac1['text'],_0xb44926[_0x132537(0x1aa)]);}),test('respects\x20custom\x20user\x20agent\x20pattern',async _0x26d0a0=>{const _0x599af9=_0x29c8e1,_0x10bf86={'FNhNH':function(_0x305127,_0x42b4ed){return _0x305127(_0x42b4ed);},'rBWsU':function(_0x4a0d17,_0x59bf48,_0x5f1152,_0x5c2374){return _0x4a0d17(_0x59bf48,_0x5f1152,_0x5c2374);},'PVoCW':_0x599af9(0x18c),'Nknvw':function(_0x3c9b2a,_0x3c0202,_0x4c6fee,_0xdb692){return _0x3c9b2a(_0x3c0202,_0x4c6fee,_0xdb692);},'wBYKK':function(_0xe2f985,_0x528119){return _0xe2f985+_0x528119;},'SBRzW':function(_0x2424f4,_0x288949){return _0x2424f4+_0x288949;}},_0x2f6ace=await _0x10bf86['FNhNH'](listen,makeProxy()),_0x35f1a0=await _0x10bf86[_0x599af9(0x1a5)](listen,_0x10bf86[_0x599af9(0x1a5)](makeApp,{'proxyUrl':_0x2f6ace,'userAgentPattern':/borg/}));let _0x3c4035;_0x3c4035=await _0x10bf86[_0x599af9(0x1ae)](get,'humon',_0x35f1a0,_0x10bf86[_0x599af9(0x1b6)]),_0x26d0a0['is'](_0x3c4035['text'],_0x599af9(0x197)),_0x3c4035=await _0x10bf86[_0x599af9(0x1a4)](get,_0x599af9(0x1d6),_0x35f1a0,_0x10bf86[_0x599af9(0x1b6)]),_0x26d0a0['is'](_0x3c4035[_0x599af9(0x1b8)],_0x10bf86[_0x599af9(0x1b2)](_0x10bf86['SBRzW'](_0x599af9(0x1da),_0x35f1a0),_0x10bf86[_0x599af9(0x1b6)]));}),test(_0x29c8e1(0x1b4),async _0xfb0945=>{const _0x4abb1b=_0x29c8e1,_0xf8a97d={'NsnoP':function(_0x424e91){return _0x424e91();},'eSFEH':function(_0x4ed46a,_0x3f9177){return _0x4ed46a(_0x3f9177);},'hmWut':function(_0x47a533,_0x1d742f,_0x12b2db,_0x4d4847){return _0x47a533(_0x1d742f,_0x12b2db,_0x4d4847);},'Bktzd':_0x4abb1b(0x18c),'XmIjW':_0x4abb1b(0x197)},_0x5e7221=await listen(_0xf8a97d[_0x4abb1b(0x1a9)](makeProxy)),_0xed05d9=await listen(_0xf8a97d[_0x4abb1b(0x19d)](makeApp,{'proxyUrl':_0x5e7221,'excludeUrlPattern':/foo/}));let _0x59b85f;_0x59b85f=await _0xf8a97d[_0x4abb1b(0x1cd)](get,bot,_0xed05d9,_0xf8a97d['Bktzd']),_0xfb0945['is'](_0x59b85f['text'],_0xf8a97d[_0x4abb1b(0x1b9)]),_0x59b85f=await get(bot,_0xed05d9,_0x4abb1b(0x1c9)),_0xfb0945['is'](_0x59b85f[_0x4abb1b(0x1b8)],'proxy\x20'+_0xed05d9+_0x4abb1b(0x1c9));}),test('forwards\x20proxy\x20error\x20status\x20and\x20body',async _0x2aa380=>{const _0x426b02=_0x29c8e1,_0x16574d={'xyXjr':function(_0x37e569,_0x1c5df7){return _0x37e569(_0x1c5df7);},'MxiDf':function(_0x19b278){return _0x19b278();},'zupLK':function(_0x24d220,_0x78d855){return _0x24d220(_0x78d855);},'RMTgN':function(_0x591122,_0x1b104e,_0x2d06a0,_0x5e8707){return _0x591122(_0x1b104e,_0x2d06a0,_0x5e8707);},'dyaqe':_0x426b02(0x1c9),'LPrwe':'proxy\x20error'},_0x43a047=await _0x16574d[_0x426b02(0x1e5)](listen,_0x16574d[_0x426b02(0x1c6)](express)['use']((_0x6ad853,_0x912c6e)=>_0x912c6e['status'](0x1f4)[_0x426b02(0x1ac)](_0x426b02(0x1b5)))),_0x41ebb0=await listen(_0x16574d[_0x426b02(0x1a1)](makeApp,{'proxyUrl':_0x43a047})),_0x3ed8b5=await _0x16574d[_0x426b02(0x1d5)](get,bot,_0x41ebb0,_0x16574d[_0x426b02(0x1dc)]);_0x2aa380['is'](_0x3ed8b5[_0x426b02(0x19f)],0x1f4),_0x2aa380['is'](_0x3ed8b5[_0x426b02(0x1b8)],_0x16574d[_0x426b02(0x18f)]);}),test(_0x29c8e1(0x1a7),async _0x541b34=>{const _0x363637=_0x29c8e1,_0x407184={'oSUNU':function(_0x51d574,_0x44c578,_0x11c8b0){return _0x51d574(_0x44c578,_0x11c8b0);},'oZRLB':function(_0x54419b,_0x110784){return _0x54419b(_0x110784);},'MYSWf':function(_0x4da254){return _0x4da254();},'KtbkN':function(_0x2d7b37,_0x149804,_0x24dc51,_0x197245){return _0x2d7b37(_0x149804,_0x24dc51,_0x197245);},'jJPIT':_0x363637(0x197)},_0x1c25aa=await _0x407184[_0x363637(0x1c3)](listen,_0x407184[_0x363637(0x1b7)](express)['use']((_0x2751c5,_0x303b31)=>{const _0x3c6ce7=_0x363637;_0x407184[_0x3c6ce7(0x190)](setTimeout,()=>_0x303b31[_0x3c6ce7(0x1ac)](_0x3c6ce7(0x1cf)),0x14);})),_0x7c53ce=await _0x407184[_0x363637(0x1c3)](listen,makeApp({'proxyUrl':_0x1c25aa,'timeout':0xa})),_0x1b3ef9=await _0x407184[_0x363637(0x195)](get,bot,_0x7c53ce,'/foo');_0x541b34['is'](_0x1b3ef9[_0x363637(0x1b8)],_0x407184[_0x363637(0x1b3)]);});