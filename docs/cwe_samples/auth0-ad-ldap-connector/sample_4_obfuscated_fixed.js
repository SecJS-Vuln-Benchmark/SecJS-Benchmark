const _0x1c0d1f=_0x1605;(function(_0x1fc77f,_0xfaa933){const _0x3af744=_0x1605,_0x177af1=_0x1fc77f();while(!![]){try{const _0x1d31fe=-parseInt(_0x3af744(0xfa))/0x1+parseInt(_0x3af744(0xc7))/0x2*(-parseInt(_0x3af744(0x109))/0x3)+-parseInt(_0x3af744(0x10d))/0x4+-parseInt(_0x3af744(0xe3))/0x5*(parseInt(_0x3af744(0x10b))/0x6)+parseInt(_0x3af744(0x10e))/0x7+-parseInt(_0x3af744(0xee))/0x8+parseInt(_0x3af744(0xe5))/0x9;if(_0x1d31fe===_0xfaa933)break;else _0x177af1['push'](_0x177af1['shift']());}catch(_0x383255){_0x177af1['push'](_0x177af1['shift']());}}}(_0x4a1b,0x30109));const difference=require(_0x1c0d1f(0xd6)),User=require('../models/User'),Solution=require(_0x1c0d1f(0xc8)),Group=require(_0x1c0d1f(0xf5)),config=require('../config'),logger=require(_0x1c0d1f(0xeb)),{generatePwd}=require('../utils/helper'),{isAdmin,isRoot,isUndefined}=require('../utils/helper'),preload=async(_0x145505,_0x3c35cf)=>{const _0x2a059a=_0x1c0d1f,_0x2dbecb={'yOqIS':function(_0x360f38,_0xf847af){return _0x360f38==_0xf847af;},'mlZtK':function(_0x236856){return _0x236856();}},_0x563664=_0x145505[_0x2a059a(0xd5)][_0x2a059a(0xba)],_0x2040f3=await User['findOne']({'uid':_0x563664})['exec']();return _0x2dbecb[_0x2a059a(0xd3)](_0x2040f3,null)&&_0x145505['throw'](0x190,_0x2a059a(0xc0)),_0x145505[_0x2a059a(0x105)][_0x2a059a(0xe6)]=_0x2040f3,_0x2dbecb[_0x2a059a(0x108)](_0x3c35cf);},find=async _0xc4faef=>{const _0x33805f=_0x1c0d1f,_0x5504f8={'MfQjA':function(_0x23985e,_0x44a948){return _0x23985e===_0x44a948;},'abRZy':_0x33805f(0xe9),'oEubV':function(_0x3c6988,_0x314ef1){return _0x3c6988(_0x314ef1);},'WKIHp':_0x33805f(0xda)},_0x2fdab1={};!isUndefined(_0xc4faef['query'][_0x33805f(0xed)])&&_0x5504f8[_0x33805f(0xfc)](_0xc4faef['query'][_0x33805f(0xed)],_0x5504f8[_0x33805f(0xc9)])&&(_0x2fdab1[_0x33805f(0xed)]={'$in':[config[_0x33805f(0xed)][_0x33805f(0xc1)],config[_0x33805f(0xed)][_0x33805f(0xca)]]});_0x5504f8[_0x33805f(0xd8)](isAdmin,_0xc4faef[_0x33805f(0xe2)]['profile'])&&_0xc4faef['query']['type']==='uid'&&(_0x2fdab1['$expr']={'$regexMatch':{'input':{'$toString':_0x5504f8[_0x33805f(0xcb)]},'regex':new RegExp(_0xc4faef['query'][_0x33805f(0xec)],'i')}});const _0x213b24=await User[_0x33805f(0xf3)](_0x2fdab1,{'_id':0x0,'uid':0x1,'nick':0x1,'privilege':0x1})[_0x33805f(0xd4)]()[_0x33805f(0xe0)]();_0xc4faef[_0x33805f(0xc2)]={'list':_0x213b24};},findOne=async _0x47849d=>{const _0x84b068=_0x1c0d1f,_0x3c656f={'CeTDt':function(_0x374e08,_0x393a19,_0x4e86e0){return _0x374e08(_0x393a19,_0x4e86e0);}},_0x527b89=_0x47849d[_0x84b068(0xd5)][_0x84b068(0xba)],[_0x7d1a1b,_0x29080e,_0x414980]=await Promise[_0x84b068(0xe1)]([User[_0x84b068(0xe4)]({'uid':_0x527b89})[_0x84b068(0xf7)](_0x84b068(0xf6))[_0x84b068(0xd4)]()[_0x84b068(0xe0)](),Solution['find']({'uid':_0x527b89,'judge':config[_0x84b068(0xcc)][_0x84b068(0xbf)]})[_0x84b068(0xbd)]('pid')[_0x84b068(0xd4)]()[_0x84b068(0xe0)](),Solution[_0x84b068(0xf3)]({'uid':_0x527b89,'judge':{'$ne':config[_0x84b068(0xcc)][_0x84b068(0xbf)]}})['distinct'](_0x84b068(0xc4))['lean']()['exec']()]),_0x3f0775=_0x7d1a1b[_0x84b068(0xfe)][_0x84b068(0xf4)](_0x44f1a6=>Group[_0x84b068(0xe4)]({'gid':_0x44f1a6})['lean']()[_0x84b068(0xe0)]()[_0x84b068(0xcf)](_0x2d1f6e=>_0x2d1f6e[_0x84b068(0xbc)])),_0x4bcf8e=await Promise[_0x84b068(0xe1)](_0x3f0775);_0x47849d['body']={'user':_0x7d1a1b,'solved':_0x29080e,'unsolved':_0x3c656f[_0x84b068(0xf9)](difference,_0x414980,_0x29080e),'group':_0x4bcf8e};},create=async _0x22fb9c=>{const _0xf7bffa=_0x1c0d1f,_0x306ce9={'sLkjw':'No\x20such\x20a\x20user','zjBDs':function(_0x434918,_0x21d2ad){return _0x434918<=_0x21d2ad;},'Auplz':_0xf7bffa(0x101),'JEOmV':function(_0x359f52,_0x433cf8){return _0x359f52(_0x433cf8);},'MeBHz':_0xf7bffa(0xde),'Ciyns':function(_0x9fe972,_0x3bbc60){return _0x9fe972===_0x3bbc60;}};(!_0x22fb9c[_0xf7bffa(0xfb)]['body']['pwd']||_0x306ce9[_0xf7bffa(0xdb)](_0x22fb9c[_0xf7bffa(0xfb)][_0xf7bffa(0xc2)][_0xf7bffa(0xea)]['length'],0x5))&&_0x22fb9c[_0xf7bffa(0xf1)](0x190,_0x306ce9['Auplz']);const _0x29dd1a=new User({'uid':_0x22fb9c[_0xf7bffa(0xfb)][_0xf7bffa(0xc2)][_0xf7bffa(0xba)],'nick':_0x22fb9c[_0xf7bffa(0xfb)]['body']['nick'],'pwd':_0x306ce9[_0xf7bffa(0xd2)](generatePwd,_0x22fb9c['request'][_0xf7bffa(0xc2)][_0xf7bffa(0xea)])}),_0x5be6bb=await User[_0xf7bffa(0xe4)]({'uid':_0x29dd1a[_0xf7bffa(0xba)]})[_0xf7bffa(0xe0)]();_0x5be6bb&&_0x22fb9c[_0xf7bffa(0xf1)](0x190,_0x306ce9['MeBHz']);try{_0x306ce9[_0xf7bffa(0xf0)](_0xf7bffa(0xfd),_0xf7bffa(0xfd))?await _0x29dd1a[_0xf7bffa(0xf2)]():_0x383b51[_0xf7bffa(0xed)]={'$in':[_0x42b520[_0xf7bffa(0xed)][_0xf7bffa(0xc1)],_0x88aa5c[_0xf7bffa(0xed)][_0xf7bffa(0xca)]]};}catch(_0x41c46c){_0xf7bffa(0x103)!==_0xf7bffa(0xc5)?_0x22fb9c[_0xf7bffa(0xf1)](0x190,_0x41c46c[_0xf7bffa(0x10a)]):_0x6774c1[_0xf7bffa(0xf1)](0x190,_0x306ce9[_0xf7bffa(0x106)]);}_0x22fb9c[_0xf7bffa(0xc2)]={};},update=async _0x1d9440=>{const _0x4597bc=_0x1c0d1f,_0x2c0577={'Hyowe':function(_0x3b0bfa,_0x7a569f){return _0x3b0bfa(_0x7a569f);},'bNlsH':_0x4597bc(0x10f),'iNaUU':function(_0x330882,_0x68e321){return _0x330882===_0x68e321;},'ZfAcN':_0x4597bc(0xe9),'OCkmx':_0x4597bc(0x102)};!isAdmin(_0x1d9440[_0x4597bc(0xe2)]['profile'])&&_0x1d9440[_0x4597bc(0xe2)]['profile'][_0x4597bc(0xba)]!==_0x1d9440[_0x4597bc(0x105)][_0x4597bc(0xe6)][_0x4597bc(0xba)]&&_0x1d9440[_0x4597bc(0xf1)](0x190,_0x2c0577[_0x4597bc(0x112)]);_0x2c0577[_0x4597bc(0xe8)](_0x1d9440[_0x4597bc(0x105)][_0x4597bc(0xe6)]['uid'],_0x2c0577[_0x4597bc(0xdd)])&&!isRoot(_0x1d9440[_0x4597bc(0xe2)]['profile'])&&_0x1d9440[_0x4597bc(0xf1)](0x190,_0x4597bc(0xd1));const _0x2db868=_0x1d9440[_0x4597bc(0xfb)]['body'],_0x4d6bbe=_0x1d9440['state'][_0x4597bc(0xe6)],_0x4556b9=[_0x4597bc(0x111),_0x4597bc(0x110),_0x4597bc(0xdc),'mail'];_0x4556b9[_0x4597bc(0xd9)](_0x3c04f8=>{const _0x243530=_0x4597bc;!_0x2c0577[_0x243530(0xc3)](isUndefined,_0x2db868[_0x3c04f8])&&(_0x4d6bbe[_0x3c04f8]=_0x2db868[_0x3c04f8]);});!isUndefined(_0x2db868[_0x4597bc(0xed)])&&(_0x4d6bbe[_0x4597bc(0xed)]=Number[_0x4597bc(0xe7)](_0x2db868['privilege']));_0x2db868[_0x4597bc(0xff)]&&(_0x4597bc(0xd0)!==_0x2c0577[_0x4597bc(0xc6)]?_0x4d6bbe[_0x4597bc(0xea)]=generatePwd(_0x2db868['newPwd']):_0x1236d1['throw'](0x190,_0xaf36bd['message']));try{await _0x4d6bbe['save'](),logger[_0x4597bc(0x100)](_0x4597bc(0xcd)+_0x4d6bbe[_0x4597bc(0xba)]);}catch(_0x1a963a){_0x1d9440['throw'](0x190,_0x1a963a[_0x4597bc(0x10a)]);}_0x1d9440['body']={'success':!![],'uid':_0x4d6bbe[_0x4597bc(0xba)]};},del=async _0x1c3075=>{const _0x3acbff=_0x1c0d1f,_0x1be479={'NFcOd':_0x3acbff(0xd1),'bGkNg':function(_0x35e32a,_0xe50957){return _0x35e32a!==_0xe50957;},'vjBAB':_0x3acbff(0x10f),'GSpzg':function(_0x5dd8c8,_0x47b8af){return _0x5dd8c8(_0x47b8af);},'iEqXy':_0x3acbff(0xbe)};!isAdmin(_0x1c3075[_0x3acbff(0xe2)][_0x3acbff(0xce)])&&_0x1be479[_0x3acbff(0xdf)](_0x1c3075[_0x3acbff(0xe2)][_0x3acbff(0xce)]['uid'],_0x1c3075[_0x3acbff(0x105)][_0x3acbff(0xe6)][_0x3acbff(0xba)])&&_0x1c3075['throw'](0x190,_0x1be479[_0x3acbff(0xf8)]);_0x1c3075[_0x3acbff(0x105)][_0x3acbff(0xe6)]['uid']===_0x3acbff(0xe9)&&!_0x1be479[_0x3acbff(0xbb)](isRoot,_0x1c3075['session'][_0x3acbff(0xce)])&&_0x1c3075['throw'](0x190,_0x3acbff(0xd1));const {uid:_0x513b25}=_0x1c3075[_0x3acbff(0x105)][_0x3acbff(0xe6)];try{_0x1be479['bGkNg'](_0x1be479[_0x3acbff(0x107)],_0x3acbff(0xd7))?(await User['deleteOne']({'uid':_0x513b25})['exec'](),logger['info'](_0x3acbff(0x10c)+_0x513b25)):_0x3bcb7f[_0x3acbff(0xf1)](0x190,_0x1be479[_0x3acbff(0xef)]);}catch(_0x29ebb6){_0x1c3075['throw'](0x190,_0x29ebb6[_0x3acbff(0x10a)]);}_0x1c3075[_0x3acbff(0xc2)]={};};function _0x4a1b(){const _0x221508=['select','vjBAB','CeTDt','257700ftkUHZ','request','MfQjA','TByzt','gid','newPwd','info','the\x20length\x20of\x20the\x20password\x20must\x20be\x20greater\x20than\x205','rQFco','IzOYF','exports','state','sLkjw','iEqXy','mlZtK','219kzydSj','message','618CocXam','One\x20User\x20is\x20removed\x20','870808WpiZkP','772296tlmAQT','You\x20do\x20not\x20have\x20permission\x20to\x20change\x20this\x20user\x20information!','motto','nick','bNlsH','uid','GSpzg','title','distinct','aCgLB','Accepted','No\x20such\x20a\x20user','Root','body','Hyowe','pid','YUigk','OCkmx','2612NXlioj','../models/Solution','abRZy','Teacher','WKIHp','judge','One\x20user\x20is\x20updated\x22\x20','profile','then','DXNrR','You\x20do\x20not\x20have\x20permission\x20to\x20change\x20Root\x27s\x20information!','JEOmV','yOqIS','lean','params','lodash.difference','wMjrC','oEubV','forEach','$uid','zjBDs','school','ZfAcN','用户名已被占用!','bGkNg','exec','all','session','17935rdjrHL','findOne','10150398zVOKaY','user','parseInt','iNaUU','admin','pwd','../utils/logger','content','privilege','808608UldTzB','NFcOd','Ciyns','throw','save','find','map','../models/Group','-timerecord\x20-iprecord\x20-create\x20-_id\x20-pwd'];_0x4a1b=function(){return _0x221508;};return _0x4a1b();}function _0x1605(_0x14775e,_0x27f8e8){const _0x4a1bc4=_0x4a1b();return _0x1605=function(_0x160579,_0x3a3277){_0x160579=_0x160579-0xba;let _0x52308b=_0x4a1bc4[_0x160579];return _0x52308b;},_0x1605(_0x14775e,_0x27f8e8);}module[_0x1c0d1f(0x104)]={'preload':preload,'find':find,'findOne':findOne,'create':create,'update':update,'del':del};