'use strict';function _0x1077(){const _0x38a639=['9960808CiLDcd','2955711sAIMnd','110ZFvIrK','2686670uhkMic','12QeHKBf','@strapi/utils','validateYupSchema','KuLLo','9JQiZjQ','GFqrL','it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value','pNEWX','assertions','MdJPD','mockReset','6vKwZso','44DsSlrd','xMlNl','32109038XLHvkj','FvUtV','strapi','toBe','test-model','test-uid','timestamp','11116smVGPi','snwRp','rwjSj','1638140400','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','AYNSV','toHaveBeenCalledWith','3815350SDTbmE','Time\x20validator','NUJDr','attrTimestampUnique','../validators','2LDljNe','jNjgz','it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value','mWEGz','163990EtJXwn','pCyBM','nullable','mockResolvedValueOnce','dOvdm','HAmeu','OTNDf','1000000000','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','toHaveBeenCalled','KwVTh','toBeInstanceOf','cSTka'];_0x1077=function(){return _0x38a639;};return _0x1077();}function _0x194d(_0x3beef4,_0x3fdbd9){const _0x107723=_0x1077();return _0x194d=function(_0x194d69,_0x19f2a7){_0x194d69=_0x194d69-0x1e5;let _0x5ddf29=_0x107723[_0x194d69];return _0x5ddf29;},_0x194d(_0x3beef4,_0x3fdbd9);}const _0x44caf7=_0x194d;(function(_0x112f54,_0x30d644){const _0x24c993=_0x194d,_0x4d46ab=_0x112f54();while(!![]){try{const _0x19527e=-parseInt(_0x24c993(0x1fd))/0x1*(parseInt(_0x24c993(0x1f9))/0x2)+-parseInt(_0x24c993(0x20b))/0x3+-parseInt(_0x24c993(0x1ed))/0x4*(-parseInt(_0x24c993(0x20c))/0x5)+-parseInt(_0x24c993(0x219))/0x6*(parseInt(_0x24c993(0x1f4))/0x7)+-parseInt(_0x24c993(0x20a))/0x8*(parseInt(_0x24c993(0x212))/0x9)+-parseInt(_0x24c993(0x20d))/0xa*(-parseInt(_0x24c993(0x21a))/0xb)+parseInt(_0x24c993(0x20e))/0xc*(parseInt(_0x24c993(0x1e6))/0xd);if(_0x19527e===_0x30d644)break;else _0x4d46ab['push'](_0x4d46ab['shift']());}catch(_0x486a99){_0x4d46ab['push'](_0x4d46ab['shift']());}}}(_0x1077,0xa2af2));const strapiUtils=require(_0x44caf7(0x20f)),{errors:{YupValidationError}}=require(_0x44caf7(0x20f)),validators=require(_0x44caf7(0x1f8));describe(_0x44caf7(0x1f5),()=>{const _0x4dc0c2=_0x44caf7,_0x15caeb={'HAmeu':_0x4dc0c2(0x1f7),'pNEWX':_0x4dc0c2(0x1f0),'FvUtV':function(_0x3ba5a9,_0x24932d){return _0x3ba5a9(_0x24932d);},'pCyBM':_0x4dc0c2(0x1ec),'KwVTh':function(_0x5ef5cd,_0x3f3cb0){return _0x5ef5cd(_0x3f3cb0);},'uuDQm':'contentType','OTNDf':_0x4dc0c2(0x1ea),'cSTka':_0x4dc0c2(0x1eb),'MdJPD':function(_0xe96ea7,_0x3e2ee2,_0x6c86e8){return _0xe96ea7(_0x3e2ee2,_0x6c86e8);},'GFqrL':_0x4dc0c2(0x1f1),'snwRp':_0x4dc0c2(0x214),'dOvdm':'it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','jNjgz':function(_0x2c97c7,_0x4a3da9,_0x442e39){return _0x2c97c7(_0x4a3da9,_0x442e39);}};_0x15caeb[_0x4dc0c2(0x1fa)](describe,'unique',()=>{const _0x572371=_0x4dc0c2,_0x11080d={'AYNSV':'timestamp','KuLLo':_0x15caeb[_0x572371(0x202)],'mWEGz':_0x15caeb[_0x572371(0x215)],'NUJDr':function(_0x384bba,_0x16fc12){const _0x30337d=_0x572371;return _0x15caeb[_0x30337d(0x207)](_0x384bba,_0x16fc12);},'rwjSj':function(_0x2e1f0e,_0x105212){return _0x2e1f0e(_0x105212);},'xMlNl':_0x572371(0x204)},_0x43393d=jest['fn']();global[_0x572371(0x1e8)]={'db':{'query':jest['fn'](()=>({'findOne':_0x43393d}))}},_0x15caeb[_0x572371(0x207)](afterEach,()=>{const _0x3d1311=_0x572371;jest['clearAllMocks'](),_0x43393d[_0x3d1311(0x218)]();});const _0x579a0e={'kind':_0x15caeb['uuDQm'],'modelName':_0x15caeb[_0x572371(0x203)],'uid':_0x15caeb[_0x572371(0x209)],'options':{},'attributes':{'attrTimestampUnique':{'type':_0x15caeb[_0x572371(0x1fe)],'unique':!![]}}};_0x15caeb['MdJPD'](test,'it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique',async()=>{const _0x450376=_0x572371;_0x43393d[_0x450376(0x200)](null);const _0x16895e=strapiUtils['validateYupSchema'](validators['timestamp']({'attr':{'type':_0x450376(0x1ec)},'model':_0x579a0e,'updatedAttribute':{'name':_0x15caeb[_0x450376(0x202)],'value':'1638140400'},'entity':null},{'isDraft':![]}));await _0x16895e('1638140400'),expect(_0x43393d)['not'][_0x450376(0x206)]();}),_0x15caeb[_0x572371(0x217)](test,_0x15caeb[_0x572371(0x213)],async()=>{const _0x2b75d4=_0x572371;_0x43393d[_0x2b75d4(0x200)](null);const _0x3a4d6b=strapiUtils[_0x2b75d4(0x210)](validators['timestamp']({'attr':{'type':_0x11080d[_0x2b75d4(0x1f2)],'unique':!![]},'model':_0x579a0e,'updatedAttribute':{'name':'attrTimestampUnique','value':null},'entity':null},{'isDraft':![]})[_0x2b75d4(0x1ff)]());await _0x3a4d6b(null),expect(_0x43393d)['not'][_0x2b75d4(0x206)]();}),_0x15caeb[_0x572371(0x217)](test,_0x572371(0x205),async()=>{const _0x1304bc=_0x572371;_0x43393d['mockResolvedValueOnce'](null);const _0x30e5a6=strapiUtils['validateYupSchema'](validators[_0x1304bc(0x1ec)]({'attr':{'type':_0x11080d['AYNSV'],'unique':!![]},'model':_0x579a0e,'updatedAttribute':{'name':_0x11080d[_0x1304bc(0x211)],'value':'1638140400'},'entity':null},{'isDraft':![]}));expect(await _0x30e5a6(_0x11080d[_0x1304bc(0x1fc)]))['toBe']('1638140400');}),test(_0x572371(0x1fb),async()=>{const _0x25a6f1=_0x572371;expect[_0x25a6f1(0x216)](0x1),_0x43393d[_0x25a6f1(0x200)]({'attrTimestampUnique':_0x25a6f1(0x1f0)});const _0xf4cdc7=strapiUtils[_0x25a6f1(0x210)](validators['timestamp']({'attr':{'type':_0x25a6f1(0x1ec),'unique':!![]},'model':_0x579a0e,'updatedAttribute':{'name':_0x25a6f1(0x1f7),'value':_0x15caeb[_0x25a6f1(0x215)]},'entity':null},{'isDraft':![]}));try{await _0xf4cdc7(_0x25a6f1(0x1f0));}catch(_0x12ad2e){_0x15caeb[_0x25a6f1(0x1e7)](expect,_0x12ad2e)[_0x25a6f1(0x208)](YupValidationError);}}),_0x15caeb[_0x572371(0x217)](test,_0x15caeb[_0x572371(0x1ee)],async()=>{const _0x2f2878=_0x572371;_0x43393d[_0x2f2878(0x200)]({'attrTimestampUnique':_0x11080d[_0x2f2878(0x1fc)]});const _0x193ece=strapiUtils[_0x2f2878(0x210)](validators[_0x2f2878(0x1ec)]({'attr':{'type':'timestamp','unique':!![]},'model':_0x579a0e,'updatedAttribute':{'name':_0x2f2878(0x1f7),'value':'1638140400'},'entity':{'id':0x1,'attrTimestampUnique':_0x2f2878(0x1f0)}},{'isDraft':![]}));_0x11080d[_0x2f2878(0x1f6)](expect,await _0x11080d[_0x2f2878(0x1ef)](_0x193ece,_0x2f2878(0x1f0)))[_0x2f2878(0x1e9)]('1638140400');}),test('it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute',async()=>{const _0x2a3e07=_0x572371;_0x43393d['mockResolvedValueOnce'](null);const _0x3f9b0f=strapiUtils['validateYupSchema'](validators['timestamp']({'attr':{'type':_0x15caeb[_0x2a3e07(0x1fe)],'unique':!![]},'model':_0x579a0e,'updatedAttribute':{'name':_0x2a3e07(0x1f7),'value':_0x2a3e07(0x1f0)},'entity':null},{'isDraft':![]}));await _0x3f9b0f(_0x15caeb[_0x2a3e07(0x215)]),expect(_0x43393d)[_0x2a3e07(0x1f3)]({'select':['id'],'where':{'attrTimestampUnique':_0x15caeb[_0x2a3e07(0x215)]}});}),test(_0x15caeb[_0x572371(0x201)],async()=>{const _0x57a68f=_0x572371;_0x43393d[_0x57a68f(0x200)](null);const _0x49fb45=strapiUtils[_0x57a68f(0x210)](validators[_0x57a68f(0x1ec)]({'attr':{'type':_0x11080d['AYNSV'],'unique':!![]},'model':_0x579a0e,'updatedAttribute':{'name':_0x57a68f(0x1f7),'value':_0x11080d[_0x57a68f(0x1fc)]},'entity':{'id':0x1,'attrTimestampUnique':_0x11080d[_0x57a68f(0x1e5)]}},{'isDraft':![]}));await _0x11080d[_0x57a68f(0x1f6)](_0x49fb45,_0x57a68f(0x1f0)),expect(_0x43393d)['toHaveBeenCalledWith']({'select':['id'],'where':{'$and':[{'attrTimestampUnique':_0x11080d[_0x57a68f(0x1fc)]},{'$not':{'id':0x1}}]}});});});});