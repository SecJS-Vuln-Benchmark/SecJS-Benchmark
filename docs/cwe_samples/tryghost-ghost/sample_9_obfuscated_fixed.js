const _0x25b8f0=_0x361c;(function(_0x4bb79a,_0x2ce066){const _0xe9d9c6=_0x361c,_0x2981d5=_0x4bb79a();while(!![]){try{const _0x31905e=-parseInt(_0xe9d9c6(0x1a0))/0x1+-parseInt(_0xe9d9c6(0x179))/0x2*(-parseInt(_0xe9d9c6(0x1ab))/0x3)+-parseInt(_0xe9d9c6(0x19c))/0x4*(parseInt(_0xe9d9c6(0x193))/0x5)+parseInt(_0xe9d9c6(0x1a1))/0x6+-parseInt(_0xe9d9c6(0x1a3))/0x7+-parseInt(_0xe9d9c6(0x190))/0x8+-parseInt(_0xe9d9c6(0x191))/0x9*(-parseInt(_0xe9d9c6(0x16a))/0xa);if(_0x31905e===_0x2ce066)break;else _0x2981d5['push'](_0x2981d5['shift']());}catch(_0x2ad051){_0x2981d5['push'](_0x2981d5['shift']());}}}(_0x2472,0x635c2));import{Meteor}from'meteor/meteor';function _0x361c(_0x2cb9c0,_0x4a79ce){const _0x24723f=_0x2472();return _0x361c=function(_0x361c03,_0x49824e){_0x361c03=_0x361c03-0x15c;let _0x59b65f=_0x24723f[_0x361c03];return _0x59b65f;},_0x361c(_0x2cb9c0,_0x4a79ce);}function _0x2472(){const _0x1c9dd3=['error-action-not-allowed','NiKJx','eifor','aRBia','Invalid\x20user','msg','GKlRD','message_link','username','719660sxxhkc','cloneAndSaveAsHistoryById','unpinMessage','error-invalid-message','Ugyir','Message\x20you\x20are\x20pinning\x20was\x20not\x20found','Tjvlo','BMYue','methods','pinned','Not\x20Authorized','canAccessRoom','attachments','beforeSaveMessage','eKHnz','1474122TyGRgL','findOneById','Message\x20pinning\x20not\x20allowed','Message\x20you\x20are\x20unpinning\x20was\x20not\x20found','forEach','WsmRK','pinnedAt','findOneByRoomIdAndUserId','Error','push','dPdea','userId','UscuD','pinnedBy','bbmUQ','xUfjZ','_id','Qkmxt','vDTgZ','rizuU','IShjY','Message_pinning','Message_KeepHistory','188856YgsJLe','18gDVFkw','not-authorized','1030nLkSeo','pFKDq','gTBxD','YQNIC','rGJoI','Message_AllowPinning','setPinnedByIdAndUserId','LqbTC','nppEf','5756UDVTxv','MNzSm','RrVfN','run','169486agphKU','3122244pIqeRV','call','3534034KltbtP','rid','message_pinned','fctzl','setLastMessagePinned','jhBGo','tKgmo','DNdvf','3OIflbS','blreK','pinMessage','get','error-invalid-user','map','isArray'];_0x2472=function(){return _0x1c9dd3;};return _0x2472();}import{check}from'meteor/check';import{settings}from'../../settings';import{callbacks}from'../../callbacks';import{isTheLastMessage}from'../../lib';import{getUserAvatarURL}from'../../utils/lib/getUserAvatarURL';import{hasPermission}from'../../authorization';import{Subscriptions,Messages,Users,Rooms}from'../../models';const recursiveRemove=(_0x29e69a,_0x3f89dd=0x1)=>{const _0x4e5705=_0x361c,_0x12a8c3={'euPhZ':function(_0x16d730,_0x3f26f9){return _0x16d730===_0x3f26f9;},'gTBxD':'tNMBs','xUfjZ':function(_0x1b394d,_0x6cafee){return _0x1b394d>_0x6cafee;},'pFKDq':'Message_QuoteChainLimit'};if(!_0x29e69a){if(_0x12a8c3['euPhZ'](_0x12a8c3[_0x4e5705(0x195)],_0x4e5705(0x1ac)))_0x232b7e[_0x4e5705(0x16b)](_0x5cf846[_0x4e5705(0x189)],_0x5a0d59);else return;}if(_0x12a8c3[_0x4e5705(0x188)](_0x3f89dd,settings['get'](_0x12a8c3[_0x4e5705(0x194)])))return delete _0x29e69a['attachments'],_0x29e69a;return _0x29e69a[_0x4e5705(0x176)]=Array[_0x4e5705(0x160)](_0x29e69a[_0x4e5705(0x176)])?_0x29e69a[_0x4e5705(0x176)][_0x4e5705(0x15f)](_0x1cd35f=>recursiveRemove(_0x1cd35f,_0x3f89dd+0x1)):null,_0x29e69a;},shouldAdd=(_0x1c5542,_0x142e7c)=>!_0x1c5542['some'](({message_link:_0x338fb8})=>_0x338fb8&&_0x338fb8===_0x142e7c['message_link']);Meteor[_0x25b8f0(0x172)]({'pinMessage'(_0x5cbbfa,_0x1618da){const _0x2bdfba=_0x25b8f0,_0x4bb52f={'eifor':_0x2bdfba(0x16d),'MNzSm':_0x2bdfba(0x16f),'WsmRK':_0x2bdfba(0x18e),'tKgmo':function(_0x354923,_0x47e82a){return _0x354923===_0x47e82a;},'voPVa':'oMSbs','nppEf':function(_0x38b7af,_0x1d0fac,_0x324b07){return _0x38b7af(_0x1d0fac,_0x324b07);},'YQNIC':'Invalid\x20user','Qkmxt':'Message_AllowPinning','UscuD':'error-action-not-allowed','jhBGo':function(_0x1f75f3,_0x358bdc){return _0x1f75f3==_0x358bdc;},'rizuU':_0x2bdfba(0x167),'fiTmV':_0x2bdfba(0x15c),'NiKJx':'pin-message','bbmUQ':_0x2bdfba(0x192),'jMSlZ':'Message_KeepHistory','yiwpr':_0x2bdfba(0x175),'vipBD':_0x2bdfba(0x177),'Ugyir':function(_0xf6cbbf,_0x43d51d){return _0xf6cbbf(_0x43d51d);}};_0x4bb52f[_0x2bdfba(0x19b)](check,_0x5cbbfa[_0x2bdfba(0x189)],String);const _0xfd4d87=Meteor[_0x2bdfba(0x184)]();if(!_0xfd4d87)throw new Meteor[(_0x2bdfba(0x181))](_0x2bdfba(0x15e),_0x4bb52f[_0x2bdfba(0x196)],{'method':_0x2bdfba(0x15c)});if(!settings['get'](_0x4bb52f[_0x2bdfba(0x18a)]))throw new Meteor[(_0x2bdfba(0x181))](_0x4bb52f[_0x2bdfba(0x185)],_0x2bdfba(0x17b),{'method':'pinMessage','action':_0x4bb52f[_0x2bdfba(0x17e)]});let _0x54de41=Messages[_0x2bdfba(0x17a)](_0x5cbbfa[_0x2bdfba(0x189)]);if(_0x4bb52f[_0x2bdfba(0x1a8)](_0x54de41,null)||_0x4bb52f['jhBGo'](_0x54de41[_0x2bdfba(0x189)],null)){if(_0x2bdfba(0x170)===_0x4bb52f[_0x2bdfba(0x18c)])return delete _0xeb793e[_0x2bdfba(0x176)],_0x3f2a0f;else throw new Meteor[(_0x2bdfba(0x181))](_0x4bb52f[_0x2bdfba(0x163)],_0x4bb52f[_0x2bdfba(0x19d)],{'method':_0x4bb52f['fiTmV'],'action':_0x4bb52f[_0x2bdfba(0x17e)]});}const _0x25d135=Subscriptions[_0x2bdfba(0x180)](_0x54de41[_0x2bdfba(0x1a4)],Meteor['userId'](),{'fields':{'_id':0x1}});if(!_0x25d135)throw new Meteor[(_0x2bdfba(0x181))](_0x4bb52f[_0x2bdfba(0x163)],_0x4bb52f['MNzSm'],{'method':_0x2bdfba(0x15c),'action':_0x2bdfba(0x18e)});if(!hasPermission(Meteor[_0x2bdfba(0x184)](),_0x4bb52f[_0x2bdfba(0x162)],_0x54de41[_0x2bdfba(0x1a4)]))throw new Meteor[(_0x2bdfba(0x181))](_0x4bb52f[_0x2bdfba(0x187)],_0x2bdfba(0x174),{'method':'pinMessage'});const _0x1a5645=Users[_0x2bdfba(0x17a)](_0xfd4d87);settings['get'](_0x4bb52f['jMSlZ'])&&Messages[_0x2bdfba(0x16b)](_0x5cbbfa[_0x2bdfba(0x189)],_0x1a5645);const _0x366fc3=Meteor[_0x2bdfba(0x1a2)](_0x4bb52f['yiwpr'],_0x54de41[_0x2bdfba(0x1a4)],Meteor[_0x2bdfba(0x184)]());_0x54de41[_0x2bdfba(0x173)]=!![],_0x54de41[_0x2bdfba(0x17f)]=_0x1618da||Date['now'],_0x54de41[_0x2bdfba(0x186)]={'_id':_0xfd4d87,'username':_0x1a5645['username']},_0x54de41=callbacks[_0x2bdfba(0x19f)](_0x4bb52f['vipBD'],_0x54de41),Messages['setPinnedByIdAndUserId'](_0x54de41[_0x2bdfba(0x189)],_0x54de41[_0x2bdfba(0x186)],_0x54de41[_0x2bdfba(0x173)]);_0x4bb52f[_0x2bdfba(0x19b)](isTheLastMessage,_0x366fc3,_0x5cbbfa)&&Rooms[_0x2bdfba(0x1a7)](_0x366fc3[_0x2bdfba(0x189)],_0x54de41[_0x2bdfba(0x186)],_0x54de41[_0x2bdfba(0x173)]);const _0x962c90=[];return Array['isArray'](_0x54de41['attachments'])&&_0x54de41[_0x2bdfba(0x176)][_0x2bdfba(0x17d)](_0x43089a=>{const _0x4f8b02=_0x2bdfba;if(_0x4bb52f[_0x4f8b02(0x1a9)](_0x4bb52f['voPVa'],_0x4bb52f['voPVa']))(!_0x43089a[_0x4f8b02(0x168)]||shouldAdd(_0x962c90,_0x43089a))&&_0x962c90[_0x4f8b02(0x182)](_0x43089a);else throw new _0x103144[(_0x4f8b02(0x181))](_0x4bb52f[_0x4f8b02(0x163)],_0x4bb52f[_0x4f8b02(0x19d)],{'method':_0x4f8b02(0x15c),'action':_0x4bb52f['WsmRK']});}),Messages['createWithTypeRoomIdMessageAndUser'](_0x2bdfba(0x1a5),_0x54de41[_0x2bdfba(0x1a4)],'',_0x1a5645,{'attachments':[{'text':_0x54de41[_0x2bdfba(0x166)],'author_name':_0x54de41['u']['username'],'author_icon':_0x4bb52f[_0x2bdfba(0x16e)](getUserAvatarURL,_0x54de41['u'][_0x2bdfba(0x169)]),'ts':_0x54de41['ts'],'attachments':recursiveRemove(_0x962c90)}]});},'unpinMessage'(_0x18abed){const _0x2ce8da=_0x25b8f0,_0x9b7a2d={'irhEg':_0x2ce8da(0x15e),'LqbTC':_0x2ce8da(0x15c),'RrVfN':_0x2ce8da(0x165),'DNdvf':_0x2ce8da(0x174),'VZOzz':_0x2ce8da(0x18e),'vDTgZ':function(_0x559c76,_0x40241b){return _0x559c76==_0x40241b;},'gjMeK':function(_0x1cf6b3,_0x5c629c){return _0x1cf6b3===_0x5c629c;},'kJKZv':'aRBia','dPdea':_0x2ce8da(0x17c),'rGJoI':_0x2ce8da(0x171),'jhBwd':_0x2ce8da(0x16c),'ljOde':_0x2ce8da(0x1a6),'VgyUB':_0x2ce8da(0x18d),'eKHnz':_0x2ce8da(0x177)};check(_0x18abed['_id'],String);if(!Meteor[_0x2ce8da(0x184)]())throw new Meteor[(_0x2ce8da(0x181))](_0x2ce8da(0x15e),_0x9b7a2d[_0x2ce8da(0x19e)],{'method':_0x2ce8da(0x16c)});if(!settings[_0x2ce8da(0x15d)](_0x2ce8da(0x198)))throw new Meteor[(_0x2ce8da(0x181))](_0x2ce8da(0x161),_0x2ce8da(0x17b),{'method':_0x2ce8da(0x16c),'action':_0x9b7a2d['VZOzz']});let _0x1aac84=Messages['findOneById'](_0x18abed['_id']);if(_0x9b7a2d[_0x2ce8da(0x18b)](_0x1aac84,null)||_0x9b7a2d[_0x2ce8da(0x18b)](_0x1aac84['_id'],null)){if(_0x9b7a2d['gjMeK'](_0x2ce8da(0x164),_0x9b7a2d['kJKZv']))throw new Meteor['Error'](_0x2ce8da(0x16d),_0x9b7a2d[_0x2ce8da(0x183)],{'method':'unpinMessage','action':_0x2ce8da(0x18e)});else throw new _0x10b79b[(_0x2ce8da(0x181))](_0x9b7a2d['irhEg'],_0x2ce8da(0x165),{'method':_0x9b7a2d[_0x2ce8da(0x19a)]});}const _0x4de359=Subscriptions[_0x2ce8da(0x180)](_0x1aac84[_0x2ce8da(0x1a4)],Meteor[_0x2ce8da(0x184)](),{'fields':{'_id':0x1}});if(!_0x4de359){if(_0x9b7a2d[_0x2ce8da(0x197)]===_0x9b7a2d[_0x2ce8da(0x197)])throw new Meteor[(_0x2ce8da(0x181))](_0x2ce8da(0x16d),_0x2ce8da(0x17c),{'method':_0x9b7a2d['jhBwd'],'action':'Message_pinning'});else throw new _0xc28ae3[(_0x2ce8da(0x181))](_0x2ce8da(0x15e),_0x9b7a2d[_0x2ce8da(0x19e)],{'method':'unpinMessage'});}if(!hasPermission(Meteor[_0x2ce8da(0x184)](),'pin-message',_0x1aac84[_0x2ce8da(0x1a4)])){if(_0x9b7a2d['ljOde']!==_0x9b7a2d['VgyUB'])throw new Meteor[(_0x2ce8da(0x181))](_0x2ce8da(0x192),_0x2ce8da(0x174),{'method':_0x2ce8da(0x16c)});else throw new _0x17f116[(_0x2ce8da(0x181))](_0x2ce8da(0x192),_0x9b7a2d[_0x2ce8da(0x1aa)],{'method':_0x2ce8da(0x16c)});}const _0xc00ee5=Users[_0x2ce8da(0x17a)](Meteor[_0x2ce8da(0x184)]());settings[_0x2ce8da(0x15d)](_0x2ce8da(0x18f))&&Messages['cloneAndSaveAsHistoryById'](_0x1aac84[_0x2ce8da(0x189)],_0xc00ee5);_0x1aac84[_0x2ce8da(0x173)]=![],_0x1aac84['pinnedBy']={'_id':Meteor[_0x2ce8da(0x184)](),'username':_0xc00ee5[_0x2ce8da(0x169)]},_0x1aac84=callbacks['run'](_0x9b7a2d[_0x2ce8da(0x178)],_0x1aac84);const _0x1482c7=Meteor[_0x2ce8da(0x1a2)](_0x2ce8da(0x175),_0x1aac84[_0x2ce8da(0x1a4)],Meteor[_0x2ce8da(0x184)]());return isTheLastMessage(_0x1482c7,_0x18abed)&&Rooms['setLastMessagePinned'](_0x1482c7[_0x2ce8da(0x189)],_0x1aac84[_0x2ce8da(0x186)],_0x1aac84[_0x2ce8da(0x173)]),Messages[_0x2ce8da(0x199)](_0x1aac84['_id'],_0x1aac84['pinnedBy'],_0x1aac84['pinned']);}});