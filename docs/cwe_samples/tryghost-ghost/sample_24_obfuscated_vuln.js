const _0x35b5fa=_0x48d8;(function(_0x332384,_0x8263bf){const _0x60e22b=_0x48d8,_0x24af06=_0x332384();while(!![]){try{const _0x2172bd=-parseInt(_0x60e22b(0xec))/0x1*(parseInt(_0x60e22b(0xf0))/0x2)+-parseInt(_0x60e22b(0x121))/0x3+-parseInt(_0x60e22b(0xf3))/0x4+parseInt(_0x60e22b(0xee))/0x5*(-parseInt(_0x60e22b(0x123))/0x6)+-parseInt(_0x60e22b(0x122))/0x7*(-parseInt(_0x60e22b(0x11b))/0x8)+parseInt(_0x60e22b(0xf4))/0x9*(-parseInt(_0x60e22b(0x103))/0xa)+-parseInt(_0x60e22b(0xf2))/0xb*(-parseInt(_0x60e22b(0x11d))/0xc);if(_0x2172bd===_0x8263bf)break;else _0x24af06['push'](_0x24af06['shift']());}catch(_0xb36c4){_0x24af06['push'](_0x24af06['shift']());}}}(_0x2c08,0xe5901));import{Messages,AppsTokens,Users,Rooms,Settings}from'@rocket.chat/models';import{Random}from'@rocket.chat/random';import{Match,check}from'meteor/check';function _0x2c08(){const _0xe4ba3b=['bodyParams','162958pAMrxh','jTcTv','145WEVSzN','error-room-not-found','2RquYue','notFound','3069GUIhNe','2287148yDzBON','10926uKBUCP','getNotificationForMessageId','string','KaMbI','zyOLl','fMAes','error-type-param-not-valid','headers','CyFuu','findOneById','The\x20required\x20\x22value\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','addRoute','error-message-not-found','queryParams','push.get','1030SufPoS','HIzMA','JjDxD','get','ObjectIncluding','success','rid','push.info','kWmZg','AvfsO','packageValue','deletedCount','oSVxm','error-not-allowed','Push_gateway','error-user-not-found','push_test','LaSYP','error-token-param-not-valid','AlUWK','fNiEm','userId','The\x20required\x20\x22appName\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','pbtHb','5798536PZUEsG','The\x20required\x20\x22token\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','106788duqVSv','callAsync','Push\x20is\x20disabled','error-appName-param-not-valid','4919268lcENWQ','14KXdXoE','101922qQwwic','apn','tctBu','Push_enable','test-push-notifications','error-push-disabled','tpfvh','Error','PPnAO','qGsLn','username','DxSAK','Xgfgk','gcm'];_0x2c08=function(){return _0xe4ba3b;};return _0x2c08();}import{Meteor}from'meteor/meteor';import{executePushTest}from'../../../../server/lib/pushConfig';import{canAccessRoomAsync}from'../../../authorization/server/functions/canAccessRoom';import _0x5ef0cf from'../../../push-notifications/server/lib/PushNotification';import{settings}from'../../../settings/server';import{API}from'../api';function _0x48d8(_0x33d9af,_0xfaa894){const _0x2c080b=_0x2c08();return _0x48d8=function(_0x48d849,_0x30e195){_0x48d849=_0x48d849-0xe8;let _0x574245=_0x2c080b[_0x48d849];return _0x574245;},_0x48d8(_0x33d9af,_0xfaa894);}API['v1'][_0x35b5fa(0xff)]('push.token',{'authRequired':!![]},{async 'post'(){const _0x2d4b66=_0x35b5fa,_0x46edf8={'tpfvh':'error-id-param-not-valid','oSVxm':function(_0x5600e2,_0x502274){return _0x5600e2!==_0x502274;},'zyOLl':_0x2d4b66(0xfa),'LaSYP':function(_0x4299f3,_0x35b0e5){return _0x4299f3!==_0x35b0e5;},'kWmZg':_0x2d4b66(0xf6),'qGsLn':_0x2d4b66(0xfe),'AlUWK':_0x2d4b66(0x119),'jTcTv':'x-auth-token'},{id:_0x61dc68,type:_0x45e264,value:_0x396d83,appName:_0x50727c}=this[_0x2d4b66(0xeb)];if(_0x61dc68&&typeof _0x61dc68!=='string')throw new Meteor['Error'](_0x46edf8[_0x2d4b66(0x129)],'The\x20required\x20\x22id\x22\x20body\x20param\x20is\x20invalid.');const _0x3a5938=_0x61dc68||Random['id']();if(!_0x45e264||_0x46edf8[_0x2d4b66(0x10f)](_0x45e264,_0x2d4b66(0x124))&&_0x45e264!==_0x2d4b66(0xea))throw new Meteor[(_0x2d4b66(0x12a))](_0x46edf8[_0x2d4b66(0xf8)],'The\x20required\x20\x22type\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.');if(!_0x396d83||_0x46edf8[_0x2d4b66(0x114)](typeof _0x396d83,_0x46edf8[_0x2d4b66(0x10b)]))throw new Meteor[(_0x2d4b66(0x12a))]('error-token-param-not-valid',_0x46edf8[_0x2d4b66(0x12c)]);if(!_0x50727c||typeof _0x50727c!==_0x46edf8[_0x2d4b66(0x10b)])throw new Meteor['Error'](_0x2d4b66(0x120),_0x46edf8[_0x2d4b66(0x116)]);const _0x3b1444=await Meteor[_0x2d4b66(0x11e)]('raix:push-update',{'id':_0x3a5938,'token':{[_0x45e264]:_0x396d83},'authToken':this['request'][_0x2d4b66(0xfb)]['get'](_0x46edf8[_0x2d4b66(0xed)]),'appName':_0x50727c,'userId':this['userId']});return API['v1']['success']({'result':_0x3b1444});},async 'delete'(){const _0x15c9a7=_0x35b5fa,_0x408c78={'AvfsO':_0x15c9a7(0x119),'DxSAK':function(_0x2fe0b1,_0x29757a){return _0x2fe0b1!==_0x29757a;},'pbtHb':_0x15c9a7(0x11c),'PPnAO':function(_0x31be1c,_0x3170c0){return _0x31be1c===_0x3170c0;}},{token:_0x510cc4}=this[_0x15c9a7(0xeb)];if(!_0x510cc4||_0x408c78[_0x15c9a7(0xe8)](typeof _0x510cc4,'string'))throw new Meteor[(_0x15c9a7(0x12a))](_0x15c9a7(0x115),_0x408c78[_0x15c9a7(0x11a)]);const _0xa6ff5a=(await AppsTokens['deleteMany']({'$or':[{'token.apn':_0x510cc4},{'token.gcm':_0x510cc4}],'userId':this[_0x15c9a7(0x118)]}))[_0x15c9a7(0x10e)];if(_0x408c78[_0x15c9a7(0x12b)](_0xa6ff5a,0x0)){if('jrjtd'===_0x15c9a7(0x104))throw new _0x381488[(_0x15c9a7(0x12a))](_0x15c9a7(0x120),_0x408c78[_0x15c9a7(0x10c)]);else return API['v1'][_0x15c9a7(0xf1)]();}return API['v1']['success']();}}),API['v1']['addRoute'](_0x35b5fa(0x102),{'authRequired':!![]},{async 'get'(){const _0x1257bd=_0x35b5fa,_0x12ac5f={'Xgfgk':_0x1257bd(0x112),'tctBu':_0x1257bd(0x100),'bAQoV':_0x1257bd(0xef),'fMAes':function(_0x28873f,_0x1ae77b,_0x2197b6){return _0x28873f(_0x1ae77b,_0x2197b6);},'vwCQt':_0x1257bd(0x110)},_0x276d80=this[_0x1257bd(0x101)];check(_0x276d80,Match[_0x1257bd(0x107)]({'id':String}));const _0x165f40=await Users[_0x1257bd(0xfd)](this[_0x1257bd(0x118)]);if(!_0x165f40)throw new Error(_0x12ac5f[_0x1257bd(0xe9)]);const _0x4d9ae8=await Messages['findOneById'](_0x276d80['id']);if(!_0x4d9ae8)throw new Error(_0x12ac5f[_0x1257bd(0x125)]);const _0x3fada7=await Rooms[_0x1257bd(0xfd)](_0x4d9ae8[_0x1257bd(0x109)]);if(!_0x3fada7)throw new Error(_0x12ac5f['bAQoV']);if(!await _0x12ac5f[_0x1257bd(0xf9)](canAccessRoomAsync,_0x3fada7,_0x165f40))throw new Error(_0x12ac5f['vwCQt']);const _0x2f5e30=await _0x5ef0cf[_0x1257bd(0xf5)]({'receiver':_0x165f40,'room':_0x3fada7,'message':_0x4d9ae8});return API['v1']['success']({'data':_0x2f5e30});}}),API['v1'][_0x35b5fa(0xff)](_0x35b5fa(0x10a),{'authRequired':!![]},{async 'get'(){const _0x47857f=_0x35b5fa,_0x1bf0cf=(await Settings[_0x47857f(0xfd)](_0x47857f(0x111),{'projection':{'packageValue':0x1}}))?.[_0x47857f(0x10d)],_0x10ccb6=settings['get']('Push_gateway')===_0x1bf0cf;return API['v1'][_0x47857f(0x108)]({'pushGatewayEnabled':settings[_0x47857f(0x106)](_0x47857f(0x126)),'defaultPushGateway':_0x10ccb6});}}),API['v1'][_0x35b5fa(0xff)]('push.test',{'authRequired':!![],'rateLimiterOptions':{'numRequestsAllowed':0x1,'intervalTimeInMS':0x3e8},'permissionsRequired':[_0x35b5fa(0x127)]},{async 'post'(){const _0x570ee8=_0x35b5fa,_0x43fc22={'JjDxD':function(_0x508222,_0x126061){return _0x508222!==_0x126061;},'KaMbI':_0x570ee8(0x126),'xxBjw':_0x570ee8(0x11f),'fNiEm':_0x570ee8(0x113),'CyFuu':function(_0xf2a77f,_0x2a1846,_0x478a89){return _0xf2a77f(_0x2a1846,_0x478a89);}};if(_0x43fc22[_0x570ee8(0x105)](settings[_0x570ee8(0x106)](_0x43fc22[_0x570ee8(0xf7)]),!![]))throw new Meteor['Error'](_0x570ee8(0x128),_0x43fc22['xxBjw'],{'method':_0x43fc22[_0x570ee8(0x117)]});const _0x2c8453=await _0x43fc22[_0x570ee8(0xfc)](executePushTest,this[_0x570ee8(0x118)],this['user'][_0x570ee8(0x12d)]);return API['v1'][_0x570ee8(0x108)]({'tokensCount':_0x2c8453});}});