'use strict';const _0x22fdf7=_0x2837;(function(_0x64ea37,_0x36fdaa){const _0x1f913a=_0x2837,_0xbe38f2=_0x64ea37();while(!![]){try{const _0x444aa7=parseInt(_0x1f913a(0xd3))/0x1*(-parseInt(_0x1f913a(0xe8))/0x2)+-parseInt(_0x1f913a(0xe7))/0x3*(-parseInt(_0x1f913a(0xc3))/0x4)+parseInt(_0x1f913a(0xe4))/0x5*(parseInt(_0x1f913a(0xd9))/0x6)+-parseInt(_0x1f913a(0xc8))/0x7*(parseInt(_0x1f913a(0xba))/0x8)+parseInt(_0x1f913a(0xc4))/0x9+-parseInt(_0x1f913a(0xc6))/0xa*(-parseInt(_0x1f913a(0xd5))/0xb)+-parseInt(_0x1f913a(0xdf))/0xc*(parseInt(_0x1f913a(0xc5))/0xd);if(_0x444aa7===_0x36fdaa)break;else _0xbe38f2['push'](_0xbe38f2['shift']());}catch(_0x3c6085){_0xbe38f2['push'](_0xbe38f2['shift']());}}}(_0x2be1,0xba856));function _0x2837(_0xc71bc9,_0x415b6b){const _0x2be1f5=_0x2be1();return _0x2837=function(_0x283735,_0x38f5a6){_0x283735=_0x283735-0xb9;let _0xd52cf9=_0x2be1f5[_0x283735];return _0xd52cf9;},_0x2837(_0xc71bc9,_0x415b6b);}function _0x2be1(){const _0x10ecc2=['PublF','toBeInstanceOf','205488gGujgy','BBQsq','attrDateTimeUnique','it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','5bZbKpv','yOzeT','not','3DCNNjA','1263434bJCNww','mockResolvedValueOnce','@strapi/utils','toHaveBeenCalledWith','10628008DjCmMw','2021-12-25T00:00:00.000Z','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','mockReset','teymS','toBe','datetime','atnOd','unique','3467372gWvyvF','10553085JdCCDS','1092npSvRh','10DtBxig','ZlIRH','7thLZRZ','test-uid','toHaveBeenCalled','Datetime\x20validator','assertions','QbJEq','boSPS','VmEvE','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique','strapi','2TlUOzg','validateYupSchema','15179186obJqZx','2021-11-29T00:00:00.000Z','clearAllMocks','TBISH','8250042CFMGRu','ngbyS','../validators','eZNpd'];_0x2be1=function(){return _0x10ecc2;};return _0x2be1();}const strapiUtils=require('@strapi/utils'),{errors:{YupValidationError}}=require(_0x22fdf7(0xea)),validators=require(_0x22fdf7(0xdb));describe(_0x22fdf7(0xcb),()=>{const _0x35ebcb=_0x22fdf7,_0x261a8d={'atnOd':_0x35ebcb(0xe1),'utCfY':function(_0x4fbae1,_0x282c06){return _0x4fbae1(_0x282c06);},'yOzeT':'datetime','prTzK':function(_0x5c5b99,_0x72aff1){return _0x5c5b99(_0x72aff1);},'TBISH':_0x35ebcb(0xd6),'teymS':function(_0x33b184,_0x480050){return _0x33b184(_0x480050);},'QbJEq':function(_0x14f74a,_0x34021d){return _0x14f74a(_0x34021d);},'BBQsq':function(_0x178653,_0x1a8d7d){return _0x178653(_0x1a8d7d);},'boSPS':_0x35ebcb(0xc9),'BGUsK':function(_0x38d7e0,_0x49d200,_0x52e7b1){return _0x38d7e0(_0x49d200,_0x52e7b1);},'HiavV':function(_0x381728,_0x1c8746,_0x4e1851){return _0x381728(_0x1c8746,_0x4e1851);},'itrVY':function(_0x385761,_0x9b7d90,_0x7edba6){return _0x385761(_0x9b7d90,_0x7edba6);},'sVKxs':_0x35ebcb(0xbc),'eoivl':function(_0x49e53e,_0x37a33b,_0x20ee8f){return _0x49e53e(_0x37a33b,_0x20ee8f);},'TnGhJ':_0x35ebcb(0xc2)};describe(_0x261a8d['TnGhJ'],()=>{const _0x14ae53=_0x35ebcb,_0x280616={'ZlIRH':_0x261a8d[_0x14ae53(0xd8)],'PublF':function(_0x2f3024,_0xd9afc){const _0x4da065=_0x14ae53;return _0x261a8d[_0x4da065(0xcd)](_0x2f3024,_0xd9afc);},'ngbyS':_0x14ae53(0xe1),'VmEvE':function(_0x2e388b,_0x2fa3e2){const _0x49811c=_0x14ae53;return _0x261a8d[_0x49811c(0xe0)](_0x2e388b,_0x2fa3e2);},'eZNpd':'datetime'},_0x5ef6aa=jest['fn']();global[_0x14ae53(0xd2)]={'db':{'query':jest['fn'](()=>({'findOne':_0x5ef6aa}))}},_0x261a8d['utCfY'](afterEach,()=>{const _0x374320=_0x14ae53;jest[_0x374320(0xd7)](),_0x5ef6aa[_0x374320(0xbd)]();});const _0x10bab6={'kind':'contentType','modelName':'test-model','uid':_0x261a8d[_0x14ae53(0xce)],'privateAttributes':[],'options':{},'attributes':{'attrDateTimeUnique':{'type':_0x14ae53(0xc0),'unique':!![]}}};test(_0x14ae53(0xd1),async()=>{const _0x1d3263=_0x14ae53;_0x5ef6aa[_0x1d3263(0xe9)](null);const _0x4ed421=strapiUtils['validateYupSchema'](validators[_0x1d3263(0xc0)]({'attr':{'type':'datetime'},'model':_0x10bab6,'updatedAttribute':{'name':'attrDateTimeUnique','value':_0x280616[_0x1d3263(0xc7)]},'entity':{'id':0x1,'attrDateTimeUnique':_0x1d3263(0xd6)}},{'isDraft':![]}));await _0x4ed421(_0x280616[_0x1d3263(0xc7)]),_0x280616['PublF'](expect,_0x5ef6aa)[_0x1d3263(0xe6)]['toHaveBeenCalled']();}),_0x261a8d['BGUsK'](test,_0x14ae53(0xe3),async()=>{const _0x4733e2=_0x14ae53;_0x5ef6aa[_0x4733e2(0xe9)](null);const _0x3fa8af=strapiUtils['validateYupSchema'](validators[_0x4733e2(0xc0)]({'attr':{'type':_0x4733e2(0xc0),'unique':!![]},'model':_0x10bab6,'updatedAttribute':{'name':_0x261a8d[_0x4733e2(0xc1)],'value':null},'entity':null},{'isDraft':![]})['nullable']());await _0x3fa8af(null),_0x261a8d['utCfY'](expect,_0x5ef6aa)[_0x4733e2(0xe6)][_0x4733e2(0xca)]();}),_0x261a8d['HiavV'](test,_0x14ae53(0xd0),async()=>{const _0x3f4f0b=_0x14ae53;_0x5ef6aa['mockResolvedValueOnce'](null);const _0x5da4a6=strapiUtils['validateYupSchema'](validators[_0x3f4f0b(0xc0)]({'attr':{'type':_0x3f4f0b(0xc0),'unique':!![]},'model':_0x10bab6,'updatedAttribute':{'name':_0x280616[_0x3f4f0b(0xda)],'value':_0x3f4f0b(0xd6)},'entity':null},{'isDraft':![]}));_0x280616[_0x3f4f0b(0xdd)](expect,await _0x280616[_0x3f4f0b(0xcf)](_0x5da4a6,_0x3f4f0b(0xd6)))['toBe'](_0x3f4f0b(0xd6));}),test('it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x49050e=_0x14ae53;expect[_0x49050e(0xcc)](0x1),_0x5ef6aa[_0x49050e(0xe9)]({'attrDateTimeUnique':_0x49050e(0xd6)});const _0x305292=strapiUtils[_0x49050e(0xd4)](validators['datetime']({'attr':{'type':_0x261a8d[_0x49050e(0xe5)],'unique':!![]},'model':_0x10bab6,'updatedAttribute':{'name':_0x261a8d['atnOd'],'value':_0x49050e(0xd6)},'entity':null},{'isDraft':![]}));try{await _0x261a8d['prTzK'](_0x305292,_0x49050e(0xd6));}catch(_0x39ff03){expect(_0x39ff03)[_0x49050e(0xde)](YupValidationError);}}),test(_0x14ae53(0xe2),async()=>{const _0x1d401d=_0x14ae53;_0x5ef6aa[_0x1d401d(0xe9)]({'attrDateTimeUnique':_0x280616['ZlIRH']});const _0x2cc498=strapiUtils[_0x1d401d(0xd4)](validators[_0x1d401d(0xc0)]({'attr':{'type':'datetime','unique':!![]},'model':_0x10bab6,'updatedAttribute':{'name':_0x1d401d(0xe1),'value':_0x280616[_0x1d401d(0xc7)]},'entity':{'id':0x1,'attrDateTimeUnique':_0x280616['ZlIRH']}},{'isDraft':![]}));_0x280616['VmEvE'](expect,await _0x2cc498(_0x280616[_0x1d401d(0xc7)]))[_0x1d401d(0xbf)](_0x280616['ZlIRH']);}),_0x261a8d['itrVY'](test,_0x261a8d['sVKxs'],async()=>{const _0x1b1676=_0x14ae53;_0x5ef6aa[_0x1b1676(0xe9)](null);const _0x1d20fc=strapiUtils[_0x1b1676(0xd4)](validators[_0x1b1676(0xc0)]({'attr':{'type':_0x1b1676(0xc0),'unique':!![]},'model':_0x10bab6,'updatedAttribute':{'name':_0x261a8d['atnOd'],'value':_0x261a8d['TBISH']},'entity':null},{'isDraft':![]}));await _0x1d20fc(_0x1b1676(0xd6)),_0x261a8d[_0x1b1676(0xbe)](expect,_0x5ef6aa)[_0x1b1676(0xb9)]({'select':['id'],'where':{'attrDateTimeUnique':_0x261a8d[_0x1b1676(0xd8)]}});}),_0x261a8d['eoivl'](test,'it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed',async()=>{const _0x125bd2=_0x14ae53;_0x5ef6aa[_0x125bd2(0xe9)](null);const _0x264eed=strapiUtils['validateYupSchema'](validators[_0x125bd2(0xc0)]({'attr':{'type':_0x280616[_0x125bd2(0xdc)],'unique':!![]},'model':_0x10bab6,'updatedAttribute':{'name':_0x125bd2(0xe1),'value':_0x280616[_0x125bd2(0xc7)]},'entity':{'id':0x1,'attrDateTimeUnique':_0x125bd2(0xbb)}},{'isDraft':![]}));await _0x280616[_0x125bd2(0xdd)](_0x264eed,_0x125bd2(0xd6)),expect(_0x5ef6aa)['toHaveBeenCalledWith']({'select':['id'],'where':{'$and':[{'attrDateTimeUnique':'2021-11-29T00:00:00.000Z'},{'$not':{'id':0x1}}]}});});});});