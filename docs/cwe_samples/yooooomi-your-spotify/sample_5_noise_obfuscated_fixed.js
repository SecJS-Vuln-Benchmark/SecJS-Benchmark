const _0x4d91d9=_0x429e;function _0x429e(_0x52e432,_0x434238){const _0x417827=_0x4178();return _0x429e=function(_0x429e2b,_0x212b2f){_0x429e2b=_0x429e2b-0x1c7;let _0x253c2d=_0x417827[_0x429e2b];return _0x253c2d;},_0x429e(_0x52e432,_0x434238);}(function(_0x2fccc8,_0x10ff7f){const _0x5501c0=_0x429e,_0x5cddb2=_0x2fccc8();while(!![]){try{const _0x4a326b=-parseInt(_0x5501c0(0x236))/0x1*(parseInt(_0x5501c0(0x217))/0x2)+-parseInt(_0x5501c0(0x224))/0x3*(-parseInt(_0x5501c0(0x207))/0x4)+parseInt(_0x5501c0(0x210))/0x5*(-parseInt(_0x5501c0(0x203))/0x6)+parseInt(_0x5501c0(0x1c7))/0x7*(-parseInt(_0x5501c0(0x22f))/0x8)+parseInt(_0x5501c0(0x1f8))/0x9*(-parseInt(_0x5501c0(0x227))/0xa)+-parseInt(_0x5501c0(0x221))/0xb*(-parseInt(_0x5501c0(0x21c))/0xc)+parseInt(_0x5501c0(0x1cf))/0xd;if(_0x4a326b===_0x10ff7f)break;else _0x5cddb2['push'](_0x5cddb2['shift']());}catch(_0x57c5c0){_0x5cddb2['push'](_0x5cddb2['shift']());}}}(_0x4178,0xac560));const {agentProvider,fixtureManager,matchers,mockManager}=require(_0x4d91d9(0x209)),{anyEtag,anyErrorId,anyContentVersion,anyString}=matchers,assert=require(_0x4d91d9(0x1cb)),sinon=require(_0x4d91d9(0x1fc)),escapeRegExp=require(_0x4d91d9(0x205)),should=require(_0x4d91d9(0x25c)),settingsHelpers=require(_0x4d91d9(0x1f7)),ObjectId=require(_0x4d91d9(0x1f4))['default'],testUtils=require(_0x4d91d9(0x1cd)),models=require('../../../core/server/models/index'),logging=require('@tryghost/logging');function testCleanedSnapshot(_0x555700,_0x3f2b2e){const _0x5792d4=_0x4d91d9,_0x334e65={'lRGxz':function(_0x1da998,_0x38a481){return _0x1da998!==_0x38a481;},'Emfkf':_0x5792d4(0x218)};for(const [_0x55e0db,_0x3db321]of Object[_0x5792d4(0x201)](_0x3f2b2e)){_0x334e65[_0x5792d4(0x1d7)](_0x334e65[_0x5792d4(0x1fe)],'RXSUJ')?_0x555700=_0x555700[_0x5792d4(0x1f6)](new RegExp(escapeRegExp(_0x55e0db),'g'),_0x3db321):(_0x35286e['mockMailgun'](),_0x4874bf[_0x5792d4(0x246)](_0x41ace5,_0x5792d4(0x1d2))[_0x5792d4(0x1d3)](_0x5792d4(0x1c9)));}should({'html':_0x555700})[_0x5792d4(0x213)]();}const matchEmailPreviewBody={'email_previews':[{'html':anyString,'plaintext':anyString}]};function _0x4178(){const _0x4c8407=['error','BXhlU','119608OsQBCD','cannot\x20send\x20test\x20email','expectStatus','lBGkz','draft','vEtMD','URJRf','zhrcJ','LZnaS','expectEmptyBody','createPost','fUNnV','Should\x20use\x20a\x20non-default\x20newsletter\x20for\x20this\x20test','UzPVK','DPMvN','requested-newsletter-uuid','stub','DPOut','lMwJZ','This\x20is\x20the\x20actual\x20post\x20content...','PyhFS','loginAsEditor','RUhpl','GZmbW','email_previews/posts/abcd1234abcd1234abcd1234/','get','bFAZK','UiOSM','XkZdL','has\x20custom\x20content\x20transformations\x20for\x20email\x20compatibility','matchBodySnapshot','nvUZh','toHexString','fRRtG','plaintext','uGRuS','getDefaultNewsletter','VLRWj','should','Mgbwf','2840950GlFqqh','<p>This\x20is\x20the\x20actual\x20post\x20content...</p>','test-validation-key','eql','assert/strict','ZALTi','../../utils','lOFGN','18663099AaukcI','assert','Newsletter','getMembersValidationKey','returns','post','RUMyN','email-only-card','lRGxz','mockMailgun','As\x20Admin','uses\x20the\x20newsletter\x20provided\x20through\x20?newsletter=slug','test@ghost.org','TWqJd','JRndD','DataGenerator','JsWdj','oPwFI','uses\x20the\x20posts\x20newsletter\x20by\x20default','expect','OLqde','loginAsAuthor','KDYHU','Post\x20with\x20email-only\x20card','match','d52c42ae-2755-455c-80ec-70b2ec55c904','can\x27t\x20retrieve\x20for\x20non\x20existent\x20post','ElgDm','QgnMf','body','aWTtN','NMGLT','uuid','As\x20Contributor','can\x20send\x20test\x20email','BwyZT','matchHeaderSnapshot','bson-objectid','email_previews/posts/','replace','../../../core/server/services/settings-helpers','1467UdUvwM','ehKDl','newsletters','BTkdm','sinon','glRUA','Emfkf','loginAsAdmin','loginAsOwner','entries','not','889620ZbRKAo','{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[[\x22email\x22,{\x22html\x22:\x22<p>Hey\x20{first_name\x20\x5c\x22there\x5c\x22}\x20{unknown}</p><p><strong>Welcome\x20to\x20your\x20first\x20Ghost\x20email!</strong></p>\x22}],[\x22email\x22,{\x22html\x22:\x22<p>Another\x20email\x20card\x20with\x20a\x20similar\x20replacement,\x20{first_name,\x20\x5c\x22see?\x5c\x22}</p>\x22}]],\x22markups\x22:[],\x22sections\x22:[[10,0],[1,\x22p\x22,[[0,[],0,\x22This\x20is\x20the\x20actual\x20post\x20content...\x22]]],[10,1],[1,\x22p\x22,[]]]}','lodash/escapeRegExp','Pvhpx','1632ZLwcbk','rcuYj','../../utils/e2e-framework','Gjqwk','posts','add','restore','tQsGw','name','40HmQfdm','Fkddl','TsFKR','matchSnapshot','calledOnce','loginAsContributor','As\x20Owner','2QZvzwb','ueIDN','users','SuRvO','doesNotMatch','96DGgnWO','XfsZD','{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[],\x22markups\x22:[[\x22a\x22,[\x22href\x22,\x22https://ghost.org\x22]]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Testing\x20\x22],[0,[0],1,\x22links\x22],[0,[],0,\x22\x20in\x20email\x20excerpt\x20and\x20apostrophes\x20\x27\x22]]]]}','lgIzT','swrXO','1506527tZDKwe','sQOyd','gnrmV','9546HioNMr','pqtuy','DbZIl','36830FPcChG','forKnex','XsdII','mDiJy','IrExs','zBivL','Post','Pchuy','24OjdoDB','can\x20read\x20post\x20email\x20preview\x20with\x20email\x20card\x20and\x20replacements','qcTHU','email_previews','html'];_0x4178=function(){return _0x4c8407;};return _0x4178();}describe('Email\x20Preview\x20API',function(){const _0xd34af3=_0x4d91d9,_0x12eb2d={'UzPVK':function(_0x593257,_0x3bdf50){return _0x593257!==_0x3bdf50;},'JRndD':'xcNwN','AGNeq':_0xd34af3(0x1fa),'isfrP':function(_0x66c968,_0x1faef2){return _0x66c968===_0x1faef2;},'SuRvO':_0xd34af3(0x245),'QgnMf':function(_0x174364,_0x11deb1){return _0x174364===_0x11deb1;},'WdCxQ':_0xd34af3(0x21d),'TWqJd':'pnwBI','UKTDN':function(_0x6ed27e){return _0x6ed27e();},'Pchuy':_0xd34af3(0x1d6),'Pvhpx':_0xd34af3(0x21e),'zBivL':'<p>This\x20is\x20the\x20actual\x20post\x20content...</p>','oPwFI':_0xd34af3(0x20f),'Fkddl':function(_0x37cc61,_0x31b909,_0x48a594){return _0x37cc61(_0x31b909,_0x48a594);},'cGHAo':_0xd34af3(0x242),'zgeAc':function(_0x391066){return _0x391066();},'sQOyd':_0xd34af3(0x1e6),'TsFKR':_0xd34af3(0x23a),'JsWdj':_0xd34af3(0x1e8),'LiEKf':_0xd34af3(0x24e),'nvUZh':_0xd34af3(0x249),'lBGkz':function(_0x1142e4,_0x34dff7,_0x1e8feb){return _0x1142e4(_0x34dff7,_0x1e8feb);},'uGRuS':function(_0x3356ea,_0x51d7bc,_0x569ef4){return _0x3356ea(_0x51d7bc,_0x569ef4);},'jAqdj':'can\x20read\x20post\x20email\x20preview\x20with\x20fields','GZmbW':function(_0x11623c,_0x32bd42,_0x1322ae){return _0x11623c(_0x32bd42,_0x1322ae);},'lgIzT':_0xd34af3(0x1da),'lOFGN':_0xd34af3(0x1ef),'Gjqwk':function(_0x1187d2,_0x4ee321){return _0x1187d2!==_0x4ee321;},'Ozkkh':function(_0xce68aa,_0x47be75,_0x4a42dd){return _0xce68aa(_0x47be75,_0x4a42dd);},'ElgDm':'can\x20send\x20test\x20email','aWTtN':function(_0x365194,_0x50f433){return _0x365194(_0x50f433);},'PyhFS':_0xd34af3(0x20b),'KcIts':function(_0x5754d5,_0x195595,_0x1380a8){return _0x5754d5(_0x195595,_0x1380a8);},'ZALTi':_0xd34af3(0x237),'hyaMm':function(_0x2b48eb,_0x5bc547,_0x5b08dc){return _0x2b48eb(_0x5bc547,_0x5b08dc);},'NMGLT':function(_0x211b08,_0xbe5e19,_0x4bd376){return _0x211b08(_0xbe5e19,_0x4bd376);},'swrXO':function(_0x2d4e59,_0x41d388,_0x40318f){return _0x2d4e59(_0x41d388,_0x40318f);},'RUMyN':_0xd34af3(0x216),'XsdII':function(_0x4cc370,_0x40167e,_0x2c5fe3){return _0x4cc370(_0x40167e,_0x2c5fe3);},'lMwJZ':'As\x20Editor','URJRf':'As\x20Author','ykIgm':_0xd34af3(0x1f0)};let _0x59f4a9;_0x12eb2d[_0xd34af3(0x1ed)](afterEach,function(){const _0xfb674a=_0xd34af3;mockManager[_0xfb674a(0x20d)](),sinon[_0xfb674a(0x20d)]();}),_0x12eb2d['aWTtN'](beforeEach,function(){const _0x549dc9=_0xd34af3,_0x22a1df={'DPMvN':function(_0x2584e4,_0x438465){return _0x2584e4(_0x438465);}};if(_0x12eb2d[_0x549dc9(0x243)](_0x12eb2d[_0x549dc9(0x1dd)],'OwtWN'))mockManager[_0x549dc9(0x1d8)](),sinon['stub'](settingsHelpers,_0x549dc9(0x1d2))[_0x549dc9(0x1d3)]('test-validation-key');else{for(const [_0xc764ff,_0x5246cd]of _0x2c0d1a['entries'](_0x4b9807)){_0x2dba4e=_0x1dce46[_0x549dc9(0x1f6)](new _0x9ae88(_0x22a1df[_0x549dc9(0x244)](_0x14e83d,_0xc764ff),'g'),_0x5246cd);}_0x56825c({'html':_0xaef2b3})['matchSnapshot']();}}),before(async function(){const _0x4e7899=_0xd34af3;_0x59f4a9=await agentProvider['getAdminAPIAgent'](),await fixtureManager['init'](_0x4e7899(0x219),_0x12eb2d['AGNeq'],_0x4e7899(0x20b)),await _0x59f4a9[_0x4e7899(0x200)]();}),_0x12eb2d[_0xd34af3(0x1ee)](describe,'Read',function(){const _0x26c470=_0xd34af3,_0x590bcc={'pxrXa':_0x12eb2d['LiEKf'],'gnrmV':function(_0x179108,_0x30d147,_0x2fe790){return _0x179108(_0x30d147,_0x2fe790);},'Mgbwf':'uuid','RUhpl':_0x26c470(0x245),'glRUA':_0x26c470(0x1e6),'fUNnV':_0x12eb2d[_0x26c470(0x22e)],'ehKDl':_0x26c470(0x1c8),'vEtMD':_0x12eb2d[_0x26c470(0x255)],'irWOV':_0x26c470(0x1e8),'fRRtG':function(_0x2c1eac,_0x49fe53,_0x3acb44){const _0x190875=_0x26c470;return _0x12eb2d[_0x190875(0x239)](_0x2c1eac,_0x49fe53,_0x3acb44);},'OLqde':function(_0x2c5436,_0x3d7d4d,_0x3ae928){return _0x2c5436(_0x3d7d4d,_0x3ae928);}};_0x12eb2d[_0x26c470(0x239)](it,_0x26c470(0x1e9),async function(){const _0x2dd38d=_0x26c470;await _0x59f4a9['get'](_0x590bcc['pxrXa'])['expectStatus'](0x194)[_0x2dd38d(0x1f3)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x2dd38d(0x254)]({'errors':[{'id':anyErrorId}]});}),_0x12eb2d[_0x26c470(0x259)](it,_0x12eb2d['jAqdj'],async function(){const _0x2f2a09=_0x26c470,_0x1951f3=await models[_0x2f2a09(0x1d1)][_0x2f2a09(0x25a)]();await _0x59f4a9[_0x2f2a09(0x24f)](_0x2f2a09(0x1f5)+fixtureManager[_0x2f2a09(0x24f)]('posts',0x0)['id']+'/')[_0x2f2a09(0x238)](0xc8)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x2f2a09(0x254)](matchEmailPreviewBody)[_0x2f2a09(0x1e2)](({body:_0x626bdf})=>{const _0x3d931f=_0x2f2a09;_0x590bcc[_0x3d931f(0x223)](testCleanedSnapshot,_0x626bdf[_0x3d931f(0x232)][0x0][_0x3d931f(0x233)],{[_0x1951f3[_0x3d931f(0x24f)](_0x590bcc['Mgbwf'])]:_0x3d931f(0x245)}),_0x590bcc[_0x3d931f(0x223)](testCleanedSnapshot,_0x626bdf['email_previews'][0x0][_0x3d931f(0x258)],{[_0x1951f3[_0x3d931f(0x24f)](_0x3d931f(0x1ef))]:_0x590bcc[_0x3d931f(0x24c)]});});}),_0x12eb2d[_0x26c470(0x24d)](it,_0x26c470(0x230),async function(){const _0x169628=_0x26c470,_0xce046b={'pqtuy':_0x590bcc['Mgbwf'],'qcTHU':_0x590bcc['RUhpl']},_0x35a740=await models[_0x169628(0x1d1)][_0x169628(0x25a)](),_0xe10d8b=testUtils[_0x169628(0x1de)][_0x169628(0x228)]['createPost']({'id':ObjectId()[_0x169628(0x256)](),'title':_0x590bcc[_0x169628(0x1fd)],'slug':_0x590bcc[_0x169628(0x241)],'mobiledoc':_0x169628(0x204),'html':_0x590bcc['ehKDl'],'plaintext':_0x590bcc[_0x169628(0x23b)],'status':_0x169628(0x23a),'uuid':_0x590bcc['irWOV'],'published_at':new Date(0x0)});await models[_0x169628(0x22d)]['add'](_0xe10d8b,{'context':{'internal':!![]}}),await _0x59f4a9[_0x169628(0x24f)](_0x169628(0x1f5)+_0xe10d8b['id']+'/')['expectStatus'](0xc8)[_0x169628(0x1f3)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x169628(0x254)](matchEmailPreviewBody)[_0x169628(0x1e2)](({body:_0x2bb054})=>{const _0x8ecc78=_0x169628;testCleanedSnapshot(_0x2bb054[_0x8ecc78(0x232)][0x0][_0x8ecc78(0x233)],{[_0x35a740[_0x8ecc78(0x24f)]('uuid')]:'requested-newsletter-uuid'}),testCleanedSnapshot(_0x2bb054['email_previews'][0x0]['plaintext'],{[_0x35a740[_0x8ecc78(0x24f)](_0xce046b[_0x8ecc78(0x225)])]:_0xce046b[_0x8ecc78(0x231)]});});}),_0x12eb2d['Fkddl'](it,_0x26c470(0x253),async function(){const _0x25fd14=_0x26c470,_0x31fc6d={'gJfUA':function(_0x36a536,_0x2d7cff){return _0x12eb2d['isfrP'](_0x36a536,_0x2d7cff);},'LZnaS':_0x25fd14(0x1ef),'tQsGw':_0x12eb2d[_0x25fd14(0x21a)]};if(_0x12eb2d[_0x25fd14(0x1eb)](_0x12eb2d['WdCxQ'],_0x12eb2d[_0x25fd14(0x1dc)]))_0x590bcc[_0x25fd14(0x223)](_0x4281b7,_0x176794[_0x25fd14(0x232)][0x0][_0x25fd14(0x233)],{[_0x76cd9[_0x25fd14(0x24f)](_0x25fd14(0x1ef))]:_0x25fd14(0x245)}),_0x590bcc['gnrmV'](_0x43e40a,_0x223657[_0x25fd14(0x232)][0x0][_0x25fd14(0x258)],{[_0x4b55b6[_0x25fd14(0x24f)](_0x590bcc[_0x25fd14(0x25d)])]:_0x25fd14(0x245)});else{const _0x2b7aa1=await models[_0x25fd14(0x1d1)][_0x25fd14(0x25a)](),_0x2cd0cd=testUtils['DataGenerator']['forKnex'][_0x25fd14(0x240)]({'id':_0x12eb2d['UKTDN'](ObjectId)['toHexString'](),'title':_0x25fd14(0x1e6),'slug':_0x12eb2d[_0x25fd14(0x22e)],'mobiledoc':_0x12eb2d[_0x25fd14(0x206)],'html':_0x12eb2d[_0x25fd14(0x22c)],'plaintext':_0x25fd14(0x249),'status':_0x25fd14(0x23a),'uuid':'d52c42ae-2755-455c-80ec-70b2ec55c904','published_at':new Date(0x0)});await models[_0x25fd14(0x22d)][_0x25fd14(0x20c)](_0x2cd0cd,{'context':{'internal':!![]}}),await _0x59f4a9[_0x25fd14(0x24f)]('email_previews/posts/'+_0x2cd0cd['id']+'/')['expectStatus'](0xc8)[_0x25fd14(0x1f3)]({'content-version':anyContentVersion,'etag':anyEtag})['matchBodySnapshot'](matchEmailPreviewBody)[_0x25fd14(0x1e2)](({body:_0x32f91d})=>{const _0x3358d7=_0x25fd14;_0x31fc6d['gJfUA'](_0x3358d7(0x1e5),_0x3358d7(0x1e5))?(assert[_0x3358d7(0x21b)](_0x32f91d[_0x3358d7(0x232)][0x0][_0x3358d7(0x233)],/Testing links in email excerpt and apostrophes &apos;/),assert['match'](_0x32f91d[_0x3358d7(0x232)][0x0][_0x3358d7(0x233)],/Testing links in email excerpt and apostrophes &#39;/),testCleanedSnapshot(_0x32f91d[_0x3358d7(0x232)][0x0][_0x3358d7(0x233)],{[_0x2b7aa1[_0x3358d7(0x24f)](_0x31fc6d[_0x3358d7(0x23e)])]:_0x31fc6d[_0x3358d7(0x20e)]}),testCleanedSnapshot(_0x32f91d[_0x3358d7(0x232)][0x0][_0x3358d7(0x258)],{[_0x2b7aa1[_0x3358d7(0x24f)](_0x31fc6d[_0x3358d7(0x23e)])]:_0x31fc6d[_0x3358d7(0x20e)]})):(_0x5b49a7['restore'](),_0x3705f5[_0x3358d7(0x20d)]());});}}),it(_0x26c470(0x1e1),async function(){const _0x39d5b7=_0x26c470,_0x565b00=await models[_0x39d5b7(0x1d1)][_0x39d5b7(0x25a)](),_0x5053b3=fixtureManager[_0x39d5b7(0x24f)]('newsletters',0x0);_0x565b00['id'][_0x39d5b7(0x25c)][_0x39d5b7(0x202)][_0x39d5b7(0x1ca)](_0x5053b3['id'],_0x39d5b7(0x242));const _0x12df3b=testUtils[_0x39d5b7(0x1de)][_0x39d5b7(0x228)][_0x39d5b7(0x240)]({'id':ObjectId()[_0x39d5b7(0x256)](),'title':_0x39d5b7(0x1e6),'slug':_0x590bcc[_0x39d5b7(0x241)],'mobiledoc':'{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[],\x22markups\x22:[[\x22a\x22,[\x22href\x22,\x22https://ghost.org\x22]]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Testing\x20\x22],[0,[0],1,\x22links\x22],[0,[],0,\x22\x20in\x20email\x20excerpt\x20and\x20apostrophes\x20\x27\x22]]]]}','html':_0x590bcc[_0x39d5b7(0x1f9)],'plaintext':_0x590bcc[_0x39d5b7(0x23b)],'status':'scheduled','uuid':'d52c42ae-2755-455c-80ec-70b2ec55c904','newsletter_id':_0x5053b3['id'],'published_at':new Date(0x0)});await models['Post'][_0x39d5b7(0x20c)](_0x12df3b,{'context':{'internal':!![]}}),await _0x59f4a9[_0x39d5b7(0x24f)](_0x39d5b7(0x1f5)+_0x12df3b['id']+'/')[_0x39d5b7(0x238)](0xc8)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x39d5b7(0x254)](matchEmailPreviewBody)[_0x39d5b7(0x1e2)](({body:_0x406fa4})=>{const _0x5481d0=_0x39d5b7;assert[_0x5481d0(0x21b)](_0x406fa4[_0x5481d0(0x232)][0x0][_0x5481d0(0x233)],new RegExp(_0x565b00[_0x5481d0(0x24f)](_0x5481d0(0x20f)))),assert[_0x5481d0(0x1e7)](_0x406fa4[_0x5481d0(0x232)][0x0]['html'],new RegExp(_0x5053b3[_0x5481d0(0x20f)])),_0x590bcc[_0x5481d0(0x257)](testCleanedSnapshot,_0x406fa4['email_previews'][0x0][_0x5481d0(0x233)],{[_0x5053b3[_0x5481d0(0x1ef)]]:_0x5481d0(0x245)}),_0x590bcc[_0x5481d0(0x1e3)](testCleanedSnapshot,_0x406fa4[_0x5481d0(0x232)][0x0][_0x5481d0(0x258)],{[_0x5053b3[_0x5481d0(0x1ef)]]:_0x590bcc[_0x5481d0(0x24c)]});});}),_0x12eb2d[_0x26c470(0x239)](it,_0x12eb2d[_0x26c470(0x21f)],async function(){const _0x19ab14=_0x26c470,_0x2ba766={'bFAZK':_0x12eb2d[_0x19ab14(0x1e0)],'BTkdm':function(_0x573508,_0x1d2f03,_0x2157ee){const _0x5106d2=_0x19ab14;return _0x12eb2d[_0x5106d2(0x211)](_0x573508,_0x1d2f03,_0x2157ee);},'rcuYj':_0x12eb2d[_0x19ab14(0x21a)],'UiOSM':function(_0xc99361,_0x25f23a,_0x45d290){return _0xc99361(_0x25f23a,_0x45d290);}},_0x148bad=await models[_0x19ab14(0x1d1)][_0x19ab14(0x25a)](),_0x516622=fixtureManager[_0x19ab14(0x24f)](_0x19ab14(0x1fa),0x0);_0x516622['id'][_0x19ab14(0x25c)][_0x19ab14(0x202)][_0x19ab14(0x1ca)](_0x148bad['id'],_0x12eb2d['cGHAo']);const _0x4be2b1=testUtils[_0x19ab14(0x1de)][_0x19ab14(0x228)][_0x19ab14(0x240)]({'id':_0x12eb2d['zgeAc'](ObjectId)[_0x19ab14(0x256)](),'title':_0x12eb2d[_0x19ab14(0x222)],'slug':'email-only-card','mobiledoc':_0x12eb2d[_0x19ab14(0x206)],'html':_0x12eb2d[_0x19ab14(0x22c)],'plaintext':_0x19ab14(0x249),'status':_0x12eb2d[_0x19ab14(0x212)],'uuid':_0x12eb2d[_0x19ab14(0x1df)],'published_at':new Date(0x0)});await models[_0x19ab14(0x22d)][_0x19ab14(0x20c)](_0x4be2b1,{'context':{'internal':!![]}}),await _0x59f4a9[_0x19ab14(0x24f)](_0x19ab14(0x1f5)+_0x4be2b1['id']+'/?newsletter='+_0x516622['slug'])[_0x19ab14(0x238)](0xc8)[_0x19ab14(0x1f3)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x19ab14(0x254)](matchEmailPreviewBody)[_0x19ab14(0x1e2)](({body:_0x8f3aa0})=>{const _0x4d8f7b=_0x19ab14;assert[_0x4d8f7b(0x21b)](_0x8f3aa0['email_previews'][0x0][_0x4d8f7b(0x233)],new RegExp(_0x148bad['get'](_0x2ba766[_0x4d8f7b(0x250)]))),assert['match'](_0x8f3aa0[_0x4d8f7b(0x232)][0x0][_0x4d8f7b(0x233)],new RegExp(_0x516622[_0x4d8f7b(0x20f)])),_0x2ba766[_0x4d8f7b(0x1fb)](testCleanedSnapshot,_0x8f3aa0[_0x4d8f7b(0x232)][0x0][_0x4d8f7b(0x233)],{[_0x516622[_0x4d8f7b(0x1ef)]]:_0x2ba766[_0x4d8f7b(0x208)]}),_0x2ba766[_0x4d8f7b(0x251)](testCleanedSnapshot,_0x8f3aa0[_0x4d8f7b(0x232)][0x0][_0x4d8f7b(0x258)],{[_0x516622[_0x4d8f7b(0x1ef)]]:_0x4d8f7b(0x245)});});});}),_0x12eb2d[_0xd34af3(0x220)](describe,_0x12eb2d[_0xd34af3(0x1d5)],function(){const _0x8d8d48=_0xd34af3,_0x5916ec={'fgahE':_0x8d8d48(0x245),'BwyZT':_0x12eb2d[_0x8d8d48(0x1ce)],'XkZdL':function(_0x51f82b,_0x2c1d82){const _0x1eb96e=_0x8d8d48;return _0x12eb2d[_0x1eb96e(0x20a)](_0x51f82b,_0x2c1d82);},'mDiJy':_0x8d8d48(0x1db)};_0x12eb2d['Ozkkh'](it,_0x12eb2d[_0x8d8d48(0x1ea)],async function(){const _0x1f8c0a=_0x8d8d48,_0x1c4e92={'VLRWj':_0x5916ec['fgahE'],'zhrcJ':function(_0x946d4c,_0x235b61,_0x173839){return _0x946d4c(_0x235b61,_0x173839);},'DPOut':_0x5916ec[_0x1f8c0a(0x1f2)]};_0x5916ec[_0x1f8c0a(0x252)](_0x1f8c0a(0x235),_0x1f8c0a(0x226))?await _0x59f4a9['post'](_0x1f8c0a(0x1f5)+fixtureManager['get']('posts',0x0)['id']+'/')['body']({'emails':[_0x5916ec[_0x1f8c0a(0x22a)]]})['expectStatus'](0xcc)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x1f8c0a(0x23f)]():(_0x45eb25(_0x1bc773[_0x1f8c0a(0x232)][0x0]['html'],{[_0x20d6f5[_0x1f8c0a(0x24f)]('uuid')]:_0x1c4e92[_0x1f8c0a(0x25b)]}),_0x1c4e92[_0x1f8c0a(0x23d)](_0xd4309a,_0x22da35[_0x1f8c0a(0x232)][0x0]['plaintext'],{[_0x9b431f[_0x1f8c0a(0x24f)](_0x1c4e92[_0x1f8c0a(0x247)])]:_0x1c4e92[_0x1f8c0a(0x25b)]}));});}),_0x12eb2d[_0xd34af3(0x229)](describe,_0xd34af3(0x1d9),function(){const _0x34fe29=_0xd34af3;_0x12eb2d[_0x34fe29(0x1ed)](before,async function(){const _0x53c7f9=_0x34fe29;await _0x59f4a9[_0x53c7f9(0x1ff)]();}),_0x12eb2d[_0x34fe29(0x259)](it,_0x12eb2d[_0x34fe29(0x1ea)],async function(){const _0x1cefc0=_0x34fe29;await _0x59f4a9[_0x1cefc0(0x1d4)](_0x1cefc0(0x1f5)+fixtureManager[_0x1cefc0(0x24f)](_0x1cefc0(0x20b),0x0)['id']+'/')[_0x1cefc0(0x1ec)]({'emails':[_0x1cefc0(0x1db)]})['expectStatus'](0xcc)[_0x1cefc0(0x1f3)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x1cefc0(0x23f)]();});}),_0x12eb2d[_0xd34af3(0x24d)](describe,_0x12eb2d[_0xd34af3(0x248)],function(){const _0x47e0ad=_0xd34af3;before(async function(){const _0x10918f=_0x429e;await _0x59f4a9[_0x10918f(0x24b)]();}),_0x12eb2d[_0x47e0ad(0x259)](it,_0x47e0ad(0x1f1),async function(){const _0x5a2d24=_0x47e0ad;await _0x59f4a9['post'](_0x5a2d24(0x1f5)+fixtureManager['get'](_0x12eb2d[_0x5a2d24(0x24a)],0x0)['id']+'/')[_0x5a2d24(0x1ec)]({'emails':[_0x5a2d24(0x1db)]})[_0x5a2d24(0x238)](0xcc)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})['expectEmptyBody']();});}),describe(_0x12eb2d[_0xd34af3(0x23c)],function(){const _0x43ba19=_0xd34af3,_0x336ea6={'IrExs':_0x43ba19(0x20b)};before(async function(){const _0xc44c02=_0x43ba19;await _0x59f4a9[_0xc44c02(0x1e4)]();}),_0x12eb2d['KcIts'](it,_0x12eb2d[_0x43ba19(0x1cc)],async function(){const _0x3e5fdf=_0x43ba19,_0x4556d2=sinon[_0x3e5fdf(0x246)](logging,'error');await _0x59f4a9[_0x3e5fdf(0x1d4)](_0x3e5fdf(0x1f5)+fixtureManager[_0x3e5fdf(0x24f)](_0x336ea6[_0x3e5fdf(0x22b)],0x0)['id']+'/')[_0x3e5fdf(0x1ec)]({'emails':[_0x3e5fdf(0x1db)]})[_0x3e5fdf(0x238)](0x193)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x3e5fdf(0x254)]({'errors':[{'id':anyErrorId}]}),sinon[_0x3e5fdf(0x1d0)][_0x3e5fdf(0x214)](_0x4556d2);});}),describe(_0x12eb2d['ykIgm'],function(){const _0xf34c73=_0xd34af3;before(async function(){const _0x25d5c3=_0x429e;await _0x59f4a9[_0x25d5c3(0x215)]();}),_0x12eb2d['hyaMm'](it,_0x12eb2d[_0xf34c73(0x1cc)],async function(){const _0x5b0edb=_0xf34c73,_0xf25664=sinon[_0x5b0edb(0x246)](logging,_0x5b0edb(0x234));await _0x59f4a9[_0x5b0edb(0x1d4)](_0x5b0edb(0x1f5)+fixtureManager[_0x5b0edb(0x24f)](_0x12eb2d[_0x5b0edb(0x24a)],0x0)['id']+'/')['body']({'emails':[_0x5b0edb(0x1db)]})[_0x5b0edb(0x238)](0x193)[_0x5b0edb(0x1f3)]({'content-version':anyContentVersion,'etag':anyEtag})['matchBodySnapshot']({'errors':[{'id':anyErrorId}]}),sinon[_0x5b0edb(0x1d0)][_0x5b0edb(0x214)](_0xf25664);});});});