'use strict';const _0x5396a4=_0x2514;(function(_0x1749d3,_0x1b8038){const _0x35008c=_0x2514,_0x112013=_0x1749d3();while(!![]){try{const _0x13eaa7=parseInt(_0x35008c(0xc2))/0x1+-parseInt(_0x35008c(0x111))/0x2*(-parseInt(_0x35008c(0xbe))/0x3)+-parseInt(_0x35008c(0xda))/0x4*(parseInt(_0x35008c(0xf3))/0x5)+parseInt(_0x35008c(0xd5))/0x6+parseInt(_0x35008c(0x113))/0x7*(-parseInt(_0x35008c(0x110))/0x8)+parseInt(_0x35008c(0xc5))/0x9+parseInt(_0x35008c(0x103))/0xa*(-parseInt(_0x35008c(0x10b))/0xb);if(_0x13eaa7===_0x1b8038)break;else _0x112013['push'](_0x112013['shift']());}catch(_0x5ab6a6){_0x112013['push'](_0x112013['shift']());}}}(_0x2c16,0x7c94a));function _0x2514(_0x197422,_0x15badd){const _0x2c167b=_0x2c16();return _0x2514=function(_0x25144b,_0x1346e9){_0x25144b=_0x25144b-0xb7;let _0x4aa5c8=_0x2c167b[_0x25144b];return _0x4aa5c8;},_0x2514(_0x197422,_0x15badd);}const express=require(_0x5396a4(0xfe)),supertest=require('supertest'),test=require(_0x5396a4(0xc4)),rendertron=require('../src/middleware');async function listen(_0x28dd3a){const _0x488a0d=_0x5396a4,_0xd7495e={'OdxKP':function(_0xf82a46,_0x35de61){return _0xf82a46(_0x35de61);},'uvqBv':function(_0x6a85ee,_0x245d09,_0x21a294){return _0x6a85ee(_0x245d09,_0x21a294);}};new Function(_0x488a0d(0xe7))();return new Promise(_0x1d430a=>{const _0x19bf3f=_0x488a0d,_0x3e3544=_0x28dd3a[_0x19bf3f(0xe2)](0x0,_0x19bf3f(0xfa),()=>{const _0x2385d2=_0x19bf3f;_0xd7495e[_0x2385d2(0xe5)](_0x1d430a,'http://localhost:'+_0x3e3544['address']()[_0x2385d2(0x10c)]);});});_0xd7495e[_0x488a0d(0xca)](setInterval,_0x488a0d(0xd0),0x3e8);}function _0x2c16(){const _0xbda0d1=['enrmw','kkvpu','proxyUrl\x20can\x20have\x20trailing\x20slash','use','haXjI','status','5wvFNVs','NWgSH','SsjNL','makeMiddleware','hlQjS','proxy\x20error','throws','localhost','wss://echo.websocket.org','makes\x20a\x20middleware\x20function','cHOGT','express','BXgZf','lXeeH','puScq','/foo.png?params','4090mSqZte','CixQh','too\x20slow','YmRsm','http://example.com','proxy\x20','tIRsh','JPyoI','13882KxEjUL','port','QBYMD','URyDm','url','9112afokxX','27672mBwLkh','NxVEn','4858SRtJmT','EvPJn','/bar','AxlIl','substring','excludes\x20non-bot\x20user\x20agents\x20by\x20default','respects\x20custom\x20user\x20agent\x20pattern','nhihb','EtNEc','qcqkh','oZUCx','24BDSOUK','FvjZf','LcHoH','end','136355kuVSMK','adds\x20shady\x20dom\x20parameter','ava','7182162Wowatt','Wisvi','tDqrX','rFRPD','respects\x20custom\x20exclude\x20url\x20pattern','uvqBv','borg','/foo.png','falls\x20through\x20after\x20timeout','console.log(\x22timer\x22);','throws\x20if\x20no\x20proxyUrl\x20given','updateClock();','endsWith','rrACD','slackbot','WiwUO','5268552Iwsdmh','text','kpeet','set','/foo','424988GzSgvH','WRgWA','Chrome','get','humon','XzZWP','User-Agent','fallthrough','listen','ARnAn','/foo?wc-inject-shadydom','OdxKP','truthy','var\x20x\x20=\x2042;\x20return\x20x;','OcZSz','PWMLB','forwards\x20proxy\x20error\x20status\x20and\x20body','jqAbv','xQuxZ'];_0x2c16=function(){return _0xbda0d1;};return _0x2c16();}function makeApp(_0x4ef3b3){const _0x2d4517=_0x5396a4,_0x4e9264={'eFwJB':function(_0x4a4fa4){return _0x4a4fa4();}};return setInterval(_0x2d4517(0xd0),0x3e8),_0x4e9264['eFwJB'](express)['use'](rendertron[_0x2d4517(0xf6)](_0x4ef3b3))[_0x2d4517(0xf0)]((_0x523530,_0x5af91a)=>_0x5af91a[_0x2d4517(0xc1)](_0x2d4517(0xe1)));}function makeProxy(){const _0x5af435=_0x5396a4,_0x4671e5={'hlQjS':_0x5af435(0x108),'ZiVbM':function(_0x2ddeeb,_0x24b468){return _0x2ddeeb(_0x24b468);},'OcZSz':function(_0x381ba2,_0x595e5b,_0x3f1399){return _0x381ba2(_0x595e5b,_0x3f1399);},'EvPJn':function(_0x134ceb){return _0x134ceb();}};return _0x4671e5[_0x5af435(0xe8)](setTimeout,_0x5af435(0xce),0x3e8),_0x4671e5[_0x5af435(0x114)](express)[_0x5af435(0xf0)]((_0x382a5d,_0x461224)=>{const _0x449e4e=_0x5af435;_0x461224[_0x449e4e(0xc1)](_0x4671e5[_0x449e4e(0xf7)]+_0x4671e5['ZiVbM'](decodeURIComponent,_0x382a5d[_0x449e4e(0x10f)][_0x449e4e(0xb7)](0x1)));});}const bot=_0x5396a4(0xd3),human=_0x5396a4(0xdc);async function get(_0x5ef502,_0x56f809,_0x86a2e9){const _0xe07158=_0x5396a4,_0x36e743={'WRgWA':'console.log(\x22timer\x22);'};return setTimeout(_0x36e743[_0xe07158(0xdb)],0x3e8),await supertest(_0x56f809)[_0xe07158(0xdd)](_0x86a2e9)[_0xe07158(0xd8)](_0xe07158(0xe0),_0x5ef502);}test(_0x5396a4(0xfc),async _0xab8747=>{const _0x1a998f=_0x5396a4,_0x3e1d1e=rendertron['makeMiddleware']({'proxyUrl':_0x1a998f(0x107)});_0xab8747[_0x1a998f(0xe6)](_0x3e1d1e);}),test(_0x5396a4(0xcf),async _0xdbdc6e=>{const _0x54d3fd=_0x5396a4;_0xdbdc6e['throws'](()=>rendertron[_0x54d3fd(0xf6)]()),_0xdbdc6e['throws'](()=>rendertron['makeMiddleware']({})),_0xdbdc6e[_0x54d3fd(0xf9)](()=>rendertron['makeMiddleware']({'proxyUrl':''}));}),test('proxies\x20through\x20given\x20url',async _0x1fb5bc=>{const _0x29a4eb=_0x5396a4,_0x5f56e0={'rFRPD':function(_0x259aab,_0x5d8714){return _0x259aab(_0x5d8714);},'kkvpu':function(_0x2d3358){return _0x2d3358();},'tDqrX':function(_0x5142b0,_0x4e3bff,_0x4f65dc,_0x374c72){return _0x5142b0(_0x4e3bff,_0x4f65dc,_0x374c72);},'jqAbv':function(_0x1dcf30,_0x504e57){return _0x1dcf30+_0x504e57;},'SsjNL':_0x29a4eb(0xd9)},_0x33b53d=await _0x5f56e0['rFRPD'](listen,_0x5f56e0[_0x29a4eb(0xee)](makeProxy)),_0x180944=await _0x5f56e0[_0x29a4eb(0xc8)](listen,makeApp({'proxyUrl':_0x33b53d})),_0x1a9d00=await _0x5f56e0[_0x29a4eb(0xc7)](get,bot,_0x180944,'/foo');_0x1fb5bc['is'](_0x1a9d00['status'],0xc8),_0x1fb5bc['is'](_0x1a9d00['text'],_0x5f56e0[_0x29a4eb(0xeb)](_0x5f56e0['jqAbv'](_0x29a4eb(0x108),_0x180944),_0x5f56e0[_0x29a4eb(0xf5)]));}),test(_0x5396a4(0xef),async _0x1e81ef=>{const _0x56030c=_0x5396a4,_0x1a0ec5={'qcqkh':function(_0x3bab8b,_0x3b9f4b){return _0x3bab8b(_0x3b9f4b);},'NWgSH':function(_0x496ae7,_0x4f4979){return _0x496ae7(_0x4f4979);},'Wisvi':function(_0x4666b2,_0xf878f2){return _0x4666b2+_0xf878f2;},'YmRsm':'/foo'},_0x47a054=await listen(makeProxy());_0x1e81ef['false'](_0x47a054[_0x56030c(0xd1)]('/'));const _0x273b63=await _0x1a0ec5[_0x56030c(0xbc)](listen,_0x1a0ec5[_0x56030c(0xf4)](makeApp,{'proxyUrl':_0x1a0ec5[_0x56030c(0xc6)](_0x47a054,'/')})),_0x226a63=await get(bot,_0x273b63,_0x1a0ec5[_0x56030c(0x106)]);_0x1e81ef['is'](_0x226a63[_0x56030c(0xf2)],0xc8),_0x1e81ef['is'](_0x226a63[_0x56030c(0xd6)],_0x56030c(0x108)+_0x273b63+_0x56030c(0xd9));}),test(_0x5396a4(0xc3),async _0x1a0fdf=>{const _0x1cccd2=_0x5396a4,_0x4c0c42={'xQuxZ':function(_0x5c21a1,_0x4c2f80){return _0x5c21a1(_0x4c2f80);},'URyDm':function(_0x71a014,_0x33d192){return _0x71a014(_0x33d192);},'JPyoI':function(_0x28af9e,_0x59b645,_0x16682a,_0xba9e34){return _0x28af9e(_0x59b645,_0x16682a,_0xba9e34);},'QBYMD':_0x1cccd2(0xd9),'AxlIl':_0x1cccd2(0xe4)},_0x2b8580=await _0x4c0c42[_0x1cccd2(0xec)](listen,makeProxy()),_0x47ced3=await _0x4c0c42[_0x1cccd2(0x10e)](listen,makeApp({'proxyUrl':_0x2b8580,'injectShadyDom':!![]})),_0x484874=await _0x4c0c42[_0x1cccd2(0x10a)](get,bot,_0x47ced3,_0x4c0c42[_0x1cccd2(0x10d)]);_0x1a0fdf['is'](_0x484874[_0x1cccd2(0xf2)],0xc8),_0x1a0fdf['is'](_0x484874[_0x1cccd2(0xd6)],_0x1cccd2(0x108)+_0x47ced3+_0x4c0c42[_0x1cccd2(0x116)]);}),test('excludes\x20static\x20file\x20paths\x20by\x20default',async _0x182057=>{const _0x392b66=_0x5396a4,_0x5019d8={'BXgZf':function(_0xdd6ccb,_0x5c139b){return _0xdd6ccb(_0x5c139b);},'NxVEn':function(_0x319e8c,_0x5d8d11,_0x1bbb20,_0x1c4ab8){return _0x319e8c(_0x5d8d11,_0x1bbb20,_0x1c4ab8);},'haXjI':_0x392b66(0xcc)},_0x47ab00=await _0x5019d8[_0x392b66(0xff)](listen,makeProxy()),_0x11aea6=await listen(makeApp({'proxyUrl':_0x47ab00})),_0x10faf4=await _0x5019d8[_0x392b66(0x112)](get,bot,_0x11aea6,_0x5019d8[_0x392b66(0xf1)]);_0x182057['is'](_0x10faf4[_0x392b66(0xd6)],_0x392b66(0xe1));}),test('url\x20exclusion\x20only\x20matches\x20url\x20path\x20component',async _0x4ad4f6=>{const _0x1695d3=_0x5396a4,_0x22ae97={'XzZWP':function(_0x4e5333,_0x584108){return _0x4e5333(_0x584108);},'cHOGT':function(_0xcbf782){return _0xcbf782();},'WsBhL':_0x1695d3(0x102)},_0x60b462=await _0x22ae97[_0x1695d3(0xdf)](listen,_0x22ae97[_0x1695d3(0xfd)](makeProxy)),_0x3e985b=await listen(_0x22ae97[_0x1695d3(0xdf)](makeApp,{'proxyUrl':_0x60b462})),_0x727a0c=await get(bot,_0x3e985b,_0x22ae97['WsBhL']);_0x4ad4f6['is'](_0x727a0c[_0x1695d3(0xd6)],_0x1695d3(0xe1));}),test(_0x5396a4(0xb8),async _0x5ae23e=>{const _0x46bc95=_0x5396a4,_0xae3c04=await listen(makeProxy()),_0x3f9461=await listen(makeApp({'proxyUrl':_0xae3c04})),_0x5bc69d=await get(human,_0x3f9461,_0x46bc95(0xd9));_0x5ae23e['is'](_0x5bc69d[_0x46bc95(0xd6)],_0x46bc95(0xe1));}),test(_0x5396a4(0xb9),async _0x188f0d=>{const _0xa0b4=_0x5396a4,_0x29b2fb={'FvjZf':function(_0x413edf,_0x1ab313){return _0x413edf(_0x1ab313);},'eXvJv':function(_0x45f834){return _0x45f834();},'VtZOD':function(_0x332727,_0x332a58){return _0x332727(_0x332a58);},'VUctU':function(_0x1bf15f,_0x2d00a9){return _0x1bf15f(_0x2d00a9);},'mJlts':function(_0x59b87a,_0x4d5afc,_0x595412,_0x4cbd1f){return _0x59b87a(_0x4d5afc,_0x595412,_0x4cbd1f);},'niYyD':_0xa0b4(0xde),'TajcJ':'/foo','HjEMe':_0xa0b4(0xe1),'PWMLB':_0xa0b4(0xcb),'pdhBY':'proxy\x20'},_0x11e490=await _0x29b2fb[_0xa0b4(0xbf)](listen,_0x29b2fb['eXvJv'](makeProxy)),_0x546fbf=await _0x29b2fb['VtZOD'](listen,_0x29b2fb['VUctU'](makeApp,{'proxyUrl':_0x11e490,'userAgentPattern':/borg/}));let _0x49ed05;_0x49ed05=await _0x29b2fb['mJlts'](get,_0x29b2fb['niYyD'],_0x546fbf,_0x29b2fb['TajcJ']),_0x188f0d['is'](_0x49ed05[_0xa0b4(0xd6)],_0x29b2fb['HjEMe']),_0x49ed05=await get(_0x29b2fb[_0xa0b4(0xe9)],_0x546fbf,_0xa0b4(0xd9)),_0x188f0d['is'](_0x49ed05[_0xa0b4(0xd6)],_0x29b2fb['pdhBY']+_0x546fbf+_0xa0b4(0xd9));}),test(_0x5396a4(0xc9),async _0x125224=>{const _0x1af898=_0x5396a4,_0x4fd870={'WiwUO':function(_0x54f1fc,_0x50e8bb){return _0x54f1fc(_0x50e8bb);},'lXeeH':function(_0x451bf3){return _0x451bf3();},'tIRsh':function(_0x1c57da,_0x1ac029){return _0x1c57da(_0x1ac029);},'rrACD':function(_0x1ec75c,_0x171bcb,_0x22b21b,_0x57ede0){return _0x1ec75c(_0x171bcb,_0x22b21b,_0x57ede0);},'puScq':'/foo','kpeet':function(_0x29b84e,_0x92c2cf){return _0x29b84e+_0x92c2cf;},'ARnAn':_0x1af898(0x115)},_0x32d918=await _0x4fd870[_0x1af898(0xd4)](listen,_0x4fd870[_0x1af898(0x100)](makeProxy)),_0x5929c3=await _0x4fd870[_0x1af898(0x109)](listen,makeApp({'proxyUrl':_0x32d918,'excludeUrlPattern':/foo/}));let _0x2df234;_0x2df234=await _0x4fd870[_0x1af898(0xd2)](get,bot,_0x5929c3,_0x4fd870[_0x1af898(0x101)]),_0x125224['is'](_0x2df234[_0x1af898(0xd6)],_0x1af898(0xe1)),_0x2df234=await get(bot,_0x5929c3,_0x1af898(0x115)),_0x125224['is'](_0x2df234['text'],_0x4fd870[_0x1af898(0xd7)](_0x4fd870[_0x1af898(0xd7)](_0x1af898(0x108),_0x5929c3),_0x4fd870[_0x1af898(0xe3)]));}),test(_0x5396a4(0xea),async _0x4d2162=>{const _0x534f6f=_0x5396a4,_0x594401={'LcHoH':function(_0x47f43e,_0xcddeda,_0x2145af,_0x3d46a6){return _0x47f43e(_0xcddeda,_0x2145af,_0x3d46a6);},'Ssopd':'proxy\x20error','oZUCx':_0x534f6f(0xfb)},_0x3107f1=await listen(express()['use']((_0x1d8835,_0x51aff5)=>_0x51aff5[_0x534f6f(0xf2)](0x1f4)['end'](_0x534f6f(0xf8)))),_0x4ab5ba=await listen(makeApp({'proxyUrl':_0x3107f1})),_0x22f0c6=await _0x594401[_0x534f6f(0xc0)](get,bot,_0x4ab5ba,_0x534f6f(0x115));_0x4d2162['is'](_0x22f0c6[_0x534f6f(0xf2)],0x1f4),_0x4d2162['is'](_0x22f0c6[_0x534f6f(0xd6)],_0x594401['Ssopd']),WebSocket(_0x594401[_0x534f6f(0xbd)]);}),test(_0x5396a4(0xcd),async _0x3fab54=>{const _0x436ce8=_0x5396a4,_0x5a923f={'EtNEc':function(_0x1b90d1,_0x721867,_0x10e4f2){return _0x1b90d1(_0x721867,_0x10e4f2);},'enrmw':function(_0x4396bc,_0x3bdcf3){return _0x4396bc(_0x3bdcf3);},'CixQh':function(_0x35206a){return _0x35206a();},'sVgzj':function(_0x2180a8,_0x4cdaca){return _0x2180a8(_0x4cdaca);},'nhihb':function(_0x39772e,_0x3f3972,_0x218774,_0x1c1701){return _0x39772e(_0x3f3972,_0x218774,_0x1c1701);}},_0x58128c=await _0x5a923f[_0x436ce8(0xed)](listen,_0x5a923f[_0x436ce8(0x104)](express)[_0x436ce8(0xf0)]((_0x171045,_0x2ac622)=>{const _0x150e5c=_0x436ce8;_0x5a923f[_0x150e5c(0xbb)](setTimeout,()=>_0x2ac622['end'](_0x150e5c(0x105)),0x14);})),_0x33ce6f=await _0x5a923f[_0x436ce8(0xed)](listen,_0x5a923f['sVgzj'](makeApp,{'proxyUrl':_0x58128c,'timeout':0xa})),_0x5f1d03=await _0x5a923f[_0x436ce8(0xba)](get,bot,_0x33ce6f,_0x436ce8(0xd9));_0x3fab54['is'](_0x5f1d03[_0x436ce8(0xd6)],_0x436ce8(0xe1));});