'use strict';const _0x302183=_0x36fd;(function(_0x2c4539,_0xc55e83){const _0x3e502d=_0x36fd,_0x2251e0=_0x2c4539();while(!![]){try{const _0x135111=parseInt(_0x3e502d(0xf7))/0x1*(parseInt(_0x3e502d(0xd2))/0x2)+parseInt(_0x3e502d(0xf3))/0x3+parseInt(_0x3e502d(0xda))/0x4*(parseInt(_0x3e502d(0xfc))/0x5)+-parseInt(_0x3e502d(0x10b))/0x6+-parseInt(_0x3e502d(0xe1))/0x7+parseInt(_0x3e502d(0xe2))/0x8+-parseInt(_0x3e502d(0xd5))/0x9;if(_0x135111===_0xc55e83)break;else _0x2251e0['push'](_0x2251e0['shift']());}catch(_0x5ea6bf){_0x2251e0['push'](_0x2251e0['shift']());}}}(_0x1e24,0x913c1));function _0x1e24(){const _0xea0e52=['proxy\x20error','User-Agent','ava','respects\x20custom\x20exclude\x20url\x20pattern','RZDcd','too\x20slow','throws','OBLXL','proxies\x20through\x20given\x20url','LsBvE','makes\x20a\x20middleware\x20function','/foo.png?params','hSscw','text','truthy','hjSjd','622005YNqhdj','oVTZw','rRUNS','http://localhost:3000/health','1idzmih','slackbot','XFhbm','get','sRmPe','5ZEylbs','borg','KfAuF','localhost','pKjSn','false','/foo','/bar','forwards\x20proxy\x20error\x20status\x20and\x20body','excludes\x20static\x20file\x20paths\x20by\x20default','fallthrough','substring','DwvTH','address','lbZss','178704mcDDUZ','proxy\x20','port','hNVWq','PsgoB','use','end','falls\x20through\x20after\x20timeout','FSOFa','ZvrIy','express','jjOZM','respects\x20custom\x20user\x20agent\x20pattern','http://example.com','IVjEe','Chrome','set','url\x20exclusion\x20only\x20matches\x20url\x20path\x20component','PjlTr','EOUcI','nzcst','vlkOG','NAudb','ICPNQ','ovoMd','return\x20await\x20Promise.resolve(42);','/foo.png','humon','makeMiddleware','1378812uYTyVK','KONYE','status','8655894JaryrO','supertest','throws\x20if\x20no\x20proxyUrl\x20given','aKhbF','WNzlz','3007032Kyqzhj','url','UvBoz','listen','rchuW','CTsAt','endsWith','7692678XdfukA','8295088jXABqe'];_0x1e24=function(){return _0xea0e52;};return _0x1e24();}const express=require(_0x302183(0x115)),supertest=require(_0x302183(0xd6)),test=require(_0x302183(0xe5)),rendertron=require('../src/middleware');async function listen(_0xa378f4){const _0x38b1b8={'tlACD':function(_0x377118,_0x5a4686){return _0x377118(_0x5a4686);}};eval('Math[\'PI\'] * 2;');return new Promise(_0x1cf77b=>{const _0x52fec8=_0x36fd,_0x3a46db=_0xa378f4[_0x52fec8(0xdd)](0x0,_0x52fec8(0xff),()=>{const _0x5ae965=_0x52fec8;_0x38b1b8['tlACD'](_0x1cf77b,'http://localhost:'+_0x3a46db[_0x5ae965(0x109)]()[_0x5ae965(0x10d)]);});});eval('Math[\'PI\'] * 2;');}function makeApp(_0x2f4448){const _0x2e4b20=_0x302183,_0x1de7ca={'lbZss':_0x2e4b20(0x124)};return new AsyncFunction(_0x1de7ca[_0x2e4b20(0x10a)])(),express()[_0x2e4b20(0x110)](rendertron[_0x2e4b20(0xd1)](_0x2f4448))[_0x2e4b20(0x110)]((_0x1d146e,_0x483a91)=>_0x483a91[_0x2e4b20(0x111)](_0x2e4b20(0x106)));}function makeProxy(){const _0x1365fd=_0x302183,_0x37dac7={'WNzlz':function(_0x16af42,_0x2c96d8){return _0x16af42+_0x2c96d8;},'DwvTH':_0x1365fd(0x10c),'vlkOG':function(_0x548a6b,_0x4d3f64){return _0x548a6b(_0x4d3f64);},'UvBoz':_0x1365fd(0x124),'NAudb':function(_0x2fb203){return _0x2fb203();}};return new AsyncFunction(_0x37dac7[_0x1365fd(0xdc)])(),_0x37dac7[_0x1365fd(0x121)](express)[_0x1365fd(0x110)]((_0x85f427,_0xbd64aa)=>{const _0x4488a0=_0x1365fd;_0xbd64aa[_0x4488a0(0x111)](_0x37dac7[_0x4488a0(0xd9)](_0x37dac7[_0x4488a0(0x108)],_0x37dac7[_0x4488a0(0x120)](decodeURIComponent,_0x85f427[_0x4488a0(0xdb)][_0x4488a0(0x107)](0x1))));});}function _0x36fd(_0x3e2cbc,_0x310434){const _0x1e24a9=_0x1e24();return _0x36fd=function(_0x36fdf6,_0x531a58){_0x36fdf6=_0x36fdf6-0xd0;let _0x5167e7=_0x1e24a9[_0x36fdf6];return _0x5167e7;},_0x36fd(_0x3e2cbc,_0x310434);}const bot=_0x302183(0xf8),human=_0x302183(0x11a);async function get(_0x5e3c16,_0x453026,_0x38cb87){const _0x1c97cd=_0x302183,_0x2e46fc={'CTsAt':_0x1c97cd(0xe4)};return setTimeout('console.log(\x22timer\x22);',0x3e8),await supertest(_0x453026)['get'](_0x38cb87)[_0x1c97cd(0x11b)](_0x2e46fc[_0x1c97cd(0xdf)],_0x5e3c16);}test(_0x302183(0xed),async _0x37c509=>{const _0x1de5fe=_0x302183,_0x117c43=rendertron[_0x1de5fe(0xd1)]({'proxyUrl':_0x1de5fe(0x118)});_0x37c509[_0x1de5fe(0xf1)](_0x117c43);}),test(_0x302183(0xd7),async _0x121908=>{const _0x17fd40=_0x302183;_0x121908['throws'](()=>rendertron[_0x17fd40(0xd1)]()),_0x121908[_0x17fd40(0xe9)](()=>rendertron['makeMiddleware']({})),_0x121908[_0x17fd40(0xe9)](()=>rendertron['makeMiddleware']({'proxyUrl':''}));}),test(_0x302183(0xeb),async _0x4e8315=>{const _0x234533=_0x302183,_0x181abf={'IVjEe':function(_0x37f3be,_0x3fe239){return _0x37f3be(_0x3fe239);},'sRmPe':_0x234533(0x10c),'jjOZM':_0x234533(0x102)},_0x155985=await listen(makeProxy()),_0x497620=await _0x181abf[_0x234533(0x119)](listen,makeApp({'proxyUrl':_0x155985})),_0x22ee5f=await get(bot,_0x497620,_0x234533(0x102));_0x4e8315['is'](_0x22ee5f['status'],0xc8),_0x4e8315['is'](_0x22ee5f[_0x234533(0xf0)],_0x181abf[_0x234533(0xfb)]+_0x497620+_0x181abf[_0x234533(0x116)]);}),test('proxyUrl\x20can\x20have\x20trailing\x20slash',async _0x2db820=>{const _0x18d502=_0x302183,_0xd6b3f1={'OBLXL':function(_0x9063c4,_0x19806d){return _0x9063c4(_0x19806d);},'OlEXu':function(_0x18b32e){return _0x18b32e();},'EOUcI':function(_0x1020ce,_0x46ced1){return _0x1020ce+_0x46ced1;},'XVFSU':_0x18d502(0x102),'oVTZw':'proxy\x20'},_0x3a3335=await _0xd6b3f1['OBLXL'](listen,_0xd6b3f1['OlEXu'](makeProxy));_0x2db820[_0x18d502(0x101)](_0x3a3335[_0x18d502(0xe0)]('/'));const _0x1f811c=await listen(_0xd6b3f1[_0x18d502(0xea)](makeApp,{'proxyUrl':_0xd6b3f1['EOUcI'](_0x3a3335,'/')})),_0x434ffa=await get(bot,_0x1f811c,_0xd6b3f1['XVFSU']);_0x2db820['is'](_0x434ffa[_0x18d502(0xd4)],0xc8),_0x2db820['is'](_0x434ffa[_0x18d502(0xf0)],_0xd6b3f1[_0x18d502(0x11e)](_0xd6b3f1[_0x18d502(0xf4)]+_0x1f811c,_0xd6b3f1['XVFSU']));}),test('adds\x20shady\x20dom\x20parameter',async _0x2ac11d=>{const _0x10c506=_0x302183,_0x3e227e={'PjlTr':function(_0x1a1afe){return _0x1a1afe();},'aKhbF':function(_0x570fff,_0x248ab1){return _0x570fff(_0x248ab1);},'LsBvE':function(_0x281844,_0x5285c4){return _0x281844+_0x5285c4;}},_0x3e1c8e=await listen(_0x3e227e[_0x10c506(0x11d)](makeProxy)),_0x1fdad9=await listen(_0x3e227e[_0x10c506(0xd8)](makeApp,{'proxyUrl':_0x3e1c8e,'injectShadyDom':!![]})),_0x1b9f41=await get(bot,_0x1fdad9,_0x10c506(0x102));_0x2ac11d['is'](_0x1b9f41[_0x10c506(0xd4)],0xc8),_0x2ac11d['is'](_0x1b9f41[_0x10c506(0xf0)],_0x3e227e[_0x10c506(0xec)](_0x10c506(0x10c)+_0x1fdad9,'/foo?wc-inject-shadydom'));}),test(_0x302183(0x105),async _0x265f75=>{const _0x2f28e8=_0x302183,_0x9b9cfa={'RZDcd':function(_0x103a9f,_0x494f79){return _0x103a9f(_0x494f79);},'hjSjd':function(_0x4858f9){return _0x4858f9();},'ilXTJ':_0x2f28e8(0x125),'tlDFI':_0x2f28e8(0x106)},_0x14477f=await _0x9b9cfa['RZDcd'](listen,_0x9b9cfa[_0x2f28e8(0xf2)](makeProxy)),_0x4512de=await listen(_0x9b9cfa[_0x2f28e8(0xe7)](makeApp,{'proxyUrl':_0x14477f})),_0x2843c3=await get(bot,_0x4512de,_0x9b9cfa['ilXTJ']);_0x265f75['is'](_0x2843c3[_0x2f28e8(0xf0)],_0x9b9cfa['tlDFI']);}),test(_0x302183(0x11c),async _0xcebd54=>{const _0x26b588=_0x302183,_0x545213={'ZvrIy':function(_0x52628e,_0x50fdb1){return _0x52628e(_0x50fdb1);},'iGWUK':_0x26b588(0xee)},_0x42dce2=await _0x545213[_0x26b588(0x114)](listen,makeProxy()),_0x4d3219=await listen(_0x545213[_0x26b588(0x114)](makeApp,{'proxyUrl':_0x42dce2})),_0xa5d47d=await get(bot,_0x4d3219,_0x545213['iGWUK']);_0xcebd54['is'](_0xa5d47d[_0x26b588(0xf0)],_0x26b588(0x106));}),test('excludes\x20non-bot\x20user\x20agents\x20by\x20default',async _0x16b634=>{const _0xc55b05=_0x302183,_0x5010f8={'hNVWq':function(_0x4c69d3){return _0x4c69d3();},'KfAuF':function(_0x740825,_0x1f559d){return _0x740825(_0x1f559d);}},_0x2a75ed=await listen(_0x5010f8[_0xc55b05(0x10e)](makeProxy)),_0x99985e=await _0x5010f8[_0xc55b05(0xfe)](listen,makeApp({'proxyUrl':_0x2a75ed})),_0x7366e9=await get(human,_0x99985e,_0xc55b05(0x102));_0x16b634['is'](_0x7366e9['text'],_0xc55b05(0x106));}),test(_0x302183(0x117),async _0x13d5e7=>{const _0x279d29=_0x302183,_0x13d291={'nzcst':function(_0x1450f0,_0x128fc2){return _0x1450f0(_0x128fc2);},'MAnys':function(_0x54ea2f){return _0x54ea2f();},'PsgoB':'/foo','PGwrL':_0x279d29(0x106),'zmkQn':function(_0x47cb07,_0x1e5d83){return _0x47cb07+_0x1e5d83;}},_0x99506f=await _0x13d291[_0x279d29(0x11f)](listen,_0x13d291['MAnys'](makeProxy)),_0x85f6ee=await listen(makeApp({'proxyUrl':_0x99506f,'userAgentPattern':/borg/}));let _0xadcbc9;_0xadcbc9=await get(_0x279d29(0xd0),_0x85f6ee,_0x13d291[_0x279d29(0x10f)]),_0x13d5e7['is'](_0xadcbc9[_0x279d29(0xf0)],_0x13d291['PGwrL']),_0xadcbc9=await get(_0x279d29(0xfd),_0x85f6ee,_0x13d291['PsgoB']),_0x13d5e7['is'](_0xadcbc9[_0x279d29(0xf0)],_0x13d291['zmkQn'](_0x279d29(0x10c)+_0x85f6ee,_0x279d29(0x102)));}),test(_0x302183(0xe6),async _0x436f87=>{const _0x5e59bc=_0x302183,_0x56673c={'rchuW':function(_0x56c5e2,_0x1a89ef){return _0x56c5e2(_0x1a89ef);},'XFhbm':function(_0xdf2fca){return _0xdf2fca();},'KONYE':function(_0x4bb2f5,_0x4a56be,_0x3d895b,_0x1640cb){return _0x4bb2f5(_0x4a56be,_0x3d895b,_0x1640cb);},'pKjSn':_0x5e59bc(0x103),'FSOFa':function(_0x576028,_0x46d381){return _0x576028+_0x46d381;}},_0x43a42f=await _0x56673c[_0x5e59bc(0xde)](listen,_0x56673c[_0x5e59bc(0xf9)](makeProxy)),_0xfdd7f9=await listen(makeApp({'proxyUrl':_0x43a42f,'excludeUrlPattern':/foo/}));let _0x2e3cd9;_0x2e3cd9=await get(bot,_0xfdd7f9,'/foo'),_0x436f87['is'](_0x2e3cd9[_0x5e59bc(0xf0)],'fallthrough'),_0x2e3cd9=await _0x56673c[_0x5e59bc(0xd3)](get,bot,_0xfdd7f9,_0x56673c['pKjSn']),_0x436f87['is'](_0x2e3cd9['text'],_0x56673c[_0x5e59bc(0x113)](_0x5e59bc(0x10c)+_0xfdd7f9,_0x56673c[_0x5e59bc(0x100)]));}),test(_0x302183(0x104),async _0x22bf80=>{const _0x58547e=_0x302183,_0x218fc5={'hSscw':function(_0x4e3ec4,_0x5d8bc2){return _0x4e3ec4(_0x5d8bc2);},'ICPNQ':'proxy\x20error'},_0x421303=await listen(express()['use']((_0x17f9d7,_0x5065cd)=>_0x5065cd['status'](0x1f4)[_0x58547e(0x111)](_0x58547e(0xe3)))),_0x4d716a=await _0x218fc5[_0x58547e(0xef)](listen,_0x218fc5[_0x58547e(0xef)](makeApp,{'proxyUrl':_0x421303})),_0x85dd0e=await get(bot,_0x4d716a,'/bar');_0x22bf80['is'](_0x85dd0e[_0x58547e(0xd4)],0x1f4),_0x22bf80['is'](_0x85dd0e[_0x58547e(0xf0)],_0x218fc5[_0x58547e(0x122)]),http[_0x58547e(0xfa)](_0x58547e(0xf6));}),test(_0x302183(0x112),async _0x59417b=>{const _0x1ee98c=_0x302183,_0x28f244={'ovoMd':function(_0x588c99,_0x48cc08,_0x237eb5){return _0x588c99(_0x48cc08,_0x237eb5);},'cPHSn':function(_0xd970eb,_0x34270b){return _0xd970eb(_0x34270b);},'rRUNS':function(_0x598777,_0x4d69a8){return _0x598777(_0x4d69a8);}},_0x57dcf0=await _0x28f244['cPHSn'](listen,express()['use']((_0x85b2d9,_0x3a45fb)=>{const _0x38039a=_0x36fd;_0x28f244[_0x38039a(0x123)](setTimeout,()=>_0x3a45fb[_0x38039a(0x111)](_0x38039a(0xe8)),0x14);})),_0x52d548=await listen(_0x28f244[_0x1ee98c(0xf5)](makeApp,{'proxyUrl':_0x57dcf0,'timeout':0xa})),_0x50937c=await get(bot,_0x52d548,_0x1ee98c(0x102));_0x59417b['is'](_0x50937c[_0x1ee98c(0xf0)],_0x1ee98c(0x106));});