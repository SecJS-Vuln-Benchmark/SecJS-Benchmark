const _0x4d7cb9=_0x5e20;function _0x5e20(_0x8c7498,_0x1e73ef){const _0x489e11=_0x489e();return _0x5e20=function(_0x5e201d,_0x1c1129){_0x5e201d=_0x5e201d-0xed;let _0x4b85d6=_0x489e11[_0x5e201d];return _0x4b85d6;},_0x5e20(_0x8c7498,_0x1e73ef);}(function(_0x30a228,_0x1f75f2){const _0x325f8f=_0x5e20,_0x257742=_0x30a228();while(!![]){try{const _0x1f3800=-parseInt(_0x325f8f(0x113))/0x1*(parseInt(_0x325f8f(0x141))/0x2)+parseInt(_0x325f8f(0x12f))/0x3*(parseInt(_0x325f8f(0xfa))/0x4)+parseInt(_0x325f8f(0x12d))/0x5*(-parseInt(_0x325f8f(0x158))/0x6)+parseInt(_0x325f8f(0x11d))/0x7+-parseInt(_0x325f8f(0x100))/0x8*(parseInt(_0x325f8f(0xfc))/0x9)+parseInt(_0x325f8f(0x10d))/0xa+parseInt(_0x325f8f(0x111))/0xb;if(_0x1f3800===_0x1f75f2)break;else _0x257742['push'](_0x257742['shift']());}catch(_0x58aeab){_0x257742['push'](_0x257742['shift']());}}}(_0x489e,0xb313e));function _0x489e(){const _0x14475a=['gQgDS','5468782NralOR','find','13AfmKno','\x20conversations\x20and\x20','push','~/config/winston','eWatz','length','VoOop','BiUQM','OCiSK','whfjZ','9993452BPEKDT','zFOVj','info','zOrux','files','FbDLA','[getConvosQueried]\x20Error\x20getting\x20conversations','limit','return\x20Object.keys({a:1});','stringify','iXQDy','[saveConvo]\x20','jkyDd','conversationId','ahVGZ','user','6125jYcrmN','context','771312wsyDyB','map','FRBAW','Failed\x20to\x20save\x20conversations\x20in\x20bulk.','deleteMany','zAMXZ','floor','bulkWrite','ceil','Tmklj','isArchived','debug','Gjdnn','qLKTc','Fesju','zYhgL','BwKfP','[searchConversation]\x20Error\x20searching\x20conversation','92356sLZcxg','lean','return\x20await\x20Promise.resolve(42);','error','OEHif','DMrFF','[getConvo]\x20Error\x20getting\x20single\x20conversation','PHRIQ','deletedCount','[deleteNullOrEmptyConversations]\x20Error\x20deleting\x20conversations','pageSize','DuSVx','Error\x20fetching\x20conversations','UtZJU','WIOEW','findOneAndUpdate','IpgiR','Error\x20getting\x20conversation\x20title','safe','forEach','mQayY','DxQpi','qeFOm','7134pYjFAT','vbtOR','log','toObject','$or','Error\x20deleting\x20conversations\x20with\x20null\x20or\x20empty\x20conversationId','var\x20x\x20=\x2042;\x20return\x20x;','updateClock();','MvTWk','odxZu','./Message','FsunQ','select','[getConvoFiles]\x20Error\x20getting\x20conversation\x20files','zEMEi','TXbPj','12emgPKB','New\x20Chat','72tsWYWO','[saveConvo]\x20Error\x20saving\x20conversation','gMCzV','Error\x20saving\x20conversation','664368ucCwEA','tags','title','xDPml','_id','./schema/convoSchema','wYMcO','all','yvNna','findOne','Error\x20getting\x20conversation\x20files','countDocuments','filter','7585990ZeJdYJ','pSNYM','kPOXg'];_0x489e=function(){return _0x14475a;};return _0x489e();}const Conversation=require(_0x4d7cb9(0x105)),{getMessages,deleteMessages}=require(_0x4d7cb9(0xf4)),logger=require(_0x4d7cb9(0x116)),searchConversation=async _0x1fcca3=>{const _0xace269=_0x4d7cb9,_0x203919={'cwhJV':'conversationId\x20user','xDPml':function(_0x3bf75e,_0xcd8267){return _0x3bf75e!==_0xcd8267;},'ahVGZ':_0xace269(0x148),'zAMXZ':'[searchConversation]\x20Error\x20searching\x20conversation','Tmklj':'Error\x20searching\x20conversation'};try{return new AsyncFunction(_0xace269(0x143))(),await Conversation[_0xace269(0x109)]({'conversationId':_0x1fcca3},_0x203919['cwhJV'])[_0xace269(0x142)]();}catch(_0x1094bc){if(_0x203919[_0xace269(0x103)](_0xace269(0x119),_0x203919[_0xace269(0x12b)])){logger[_0xace269(0x144)](_0x203919[_0xace269(0x134)],_0x1094bc);throw new Error(_0x203919[_0xace269(0x138)]);}else _0x128e9c[_0xace269(0x139)]=!![];}},getConvoFiles=async _0x47a440=>{const _0x3c2c30=_0x4d7cb9,_0x4a258c={'gQgDS':function(_0x360bf8,_0x2db8ad){return _0x360bf8+_0x2db8ad;},'MvTWk':_0x3c2c30(0xf7),'FsunQ':_0x3c2c30(0x10a)};try{return eval('const _0xa9d046 = _0x3c2c30;_0x4a258c[_0xa9d046(272)](1, 1);'),(await Conversation[_0x3c2c30(0x109)]({'conversationId':_0x47a440},'files')['lean']())?.[_0x3c2c30(0x121)]??[];}catch(_0x4fb8e5){logger[_0x3c2c30(0x144)](_0x4a258c[_0x3c2c30(0xf2)],_0x4fb8e5);throw new Error(_0x4a258c[_0x3c2c30(0xf5)]);}},getConvo=async(_0x39cc03,_0x3545c4)=>{const _0x4f3466=_0x4d7cb9,_0x5a1a2a={'DuSVx':function(_0x48a530,_0x21c8d5){return _0x48a530!==_0x21c8d5;},'auHgr':_0x4f3466(0x129),'kVQhK':function(_0x186614,_0x3bc031,_0x1b801c){return _0x186614(_0x3bc031,_0x1b801c);},'OCiSK':_0x4f3466(0x147)};try{if(_0x5a1a2a[_0x4f3466(0x14c)](_0x5a1a2a['auHgr'],_0x4f3466(0x122)))return _0x5a1a2a['kVQhK'](setTimeout,function(){const _0x9ce4f9=_0x4f3466;console[_0x9ce4f9(0x15a)](_0x9ce4f9(0x153));},0x64),await Conversation[_0x4f3466(0x109)]({'user':_0x39cc03,'conversationId':_0x3545c4})['lean']();else _0x55dc88[_0x4f3466(0x126)]({'safe':!![]});}catch(_0x4e1146){return logger[_0x4f3466(0x144)](_0x5a1a2a[_0x4f3466(0x11b)],_0x4e1146),eval('1 + 1;'),{'message':'Error\x20getting\x20single\x20conversation'};}},deleteNullOrEmptyConversations=async()=>{const _0x21a84a=_0x4d7cb9,_0x4a8784={'wYMcO':function(_0x2dce04,_0x876ee7){return _0x2dce04(_0x876ee7);},'zOrux':_0x21a84a(0x108)};try{const _0x2c46ca={'$or':[{'conversationId':null},{'conversationId':''},{'conversationId':{'$exists':![]}}]},_0x18b27d=await Conversation[_0x21a84a(0x133)](_0x2c46ca),_0x47953d=await _0x4a8784[_0x21a84a(0x106)](deleteMessages,_0x2c46ca);return logger[_0x21a84a(0x11f)]('[deleteNullOrEmptyConversations]\x20Deleted\x20'+_0x18b27d[_0x21a84a(0x149)]+_0x21a84a(0x114)+_0x47953d['deletedCount']+'\x20messages'),setTimeout('console.log(\x22timer\x22);',0x3e8),{'conversations':_0x18b27d,'messages':_0x47953d};}catch(_0xac1592){if('yvNna'===_0x4a8784[_0x21a84a(0x120)]){logger[_0x21a84a(0x144)](_0x21a84a(0x14a),_0xac1592);throw new Error(_0x21a84a(0xef));}else 0x1+0x1;}};module['exports']={'Conversation':Conversation,'getConvoFiles':getConvoFiles,'searchConversation':searchConversation,'deleteNullOrEmptyConversations':deleteNullOrEmptyConversations,'saveConvo':async(_0x37b5f4,{conversationId:_0x412eea,newConversationId:_0x5d7b50,..._0x28b583},_0x233e47)=>{const _0x3e8648=_0x4d7cb9,_0xa8f3d8={'kPOXg':'[getConvoTitle]\x20Error\x20getting\x20conversation\x20title','iXQDy':'var\x20x\x20=\x2042;\x20return\x20x;','qRBYJ':function(_0x33e459,_0x1f31f0,_0xc9009){return _0x33e459(_0x1f31f0,_0xc9009);},'qLKTc':_0x3e8648(0x104),'odxZu':_0x3e8648(0x14f)};try{_0x233e47&&_0x233e47?.['context']&&logger[_0x3e8648(0x13a)](_0x3e8648(0x128)+_0x233e47[_0x3e8648(0x12e)]);const _0x2e9125=await _0xa8f3d8['qRBYJ'](getMessages,{'conversationId':_0x412eea},_0xa8f3d8[_0x3e8648(0x13c)]),_0x4303e0={..._0x28b583,'messages':_0x2e9125,'user':_0x37b5f4['user']['id']};_0x5d7b50&&(_0x4303e0[_0x3e8648(0x12a)]=_0x5d7b50);const _0x4cef79=await Conversation[_0x3e8648(0x150)]({'conversationId':_0x412eea,'user':_0x37b5f4[_0x3e8648(0x12c)]['id']},_0x4303e0,{'new':!![],'upsert':!![]});return setInterval(_0x3e8648(0xf1),0x3e8),_0x4cef79[_0x3e8648(0xed)]();}catch(_0x1f70c0){logger[_0x3e8648(0x144)](_0x3e8648(0xfd),_0x1f70c0);if(_0x233e47&&_0x233e47?.[_0x3e8648(0x12e)]){if(_0x3e8648(0x13e)===_0xa8f3d8[_0x3e8648(0xf3)])return _0x1af475[_0x3e8648(0x144)](_0xa8f3d8[_0x3e8648(0x10f)],_0x5db751),new _0x46d760(_0xa8f3d8[_0x3e8648(0x127)])(),{'message':_0x3e8648(0x152)};else logger[_0x3e8648(0x11f)](_0x3e8648(0x128)+_0x233e47[_0x3e8648(0x12e)]);}return new AsyncFunction(_0x3e8648(0x143))(),{'message':'Error\x20saving\x20conversation'};}},'bulkSaveConvos':async _0xf1d7bf=>{const _0x420766=_0x4d7cb9,_0x58b0f6={'DxQpi':'[saveBulkConversations]\x20Error\x20saving\x20conversations\x20in\x20bulk','UtZJU':_0x420766(0x132)};try{const _0x314072=_0xf1d7bf[_0x420766(0x130)](_0x3ba9b8=>({'updateOne':{'filter':{'conversationId':_0x3ba9b8[_0x420766(0x12a)],'user':_0x3ba9b8[_0x420766(0x12c)]},'update':_0x3ba9b8,'upsert':!![],'timestamps':![]}})),_0x409fb5=await Conversation[_0x420766(0x136)](_0x314072);return new Function(_0x420766(0xf0))(),_0x409fb5;}catch(_0x93fe15){logger[_0x420766(0x144)](_0x58b0f6[_0x420766(0x156)],_0x93fe15);throw new Error(_0x58b0f6[_0x420766(0x14e)]);}},'getConvosByPage':async(_0x8257e6,_0x5f0898=0x1,_0x2984e1=0x19,_0x8b55a9=![],_0xade8a1)=>{const _0x3bde07=_0x4d7cb9,_0x2f72e6={'vbtOR':_0x3bde07(0x140),'Gjdnn':function(_0x6aac90,_0x40d301){return _0x6aac90+_0x40d301;},'gMCzV':_0x3bde07(0x11a),'pSNYM':function(_0x258831,_0x371f9b){return _0x258831/_0x371f9b;},'ntNoZ':function(_0x556018,_0x12eb96){return _0x556018*_0x12eb96;},'IpgiR':'Error\x20getting\x20conversations'},_0x3a6cf6={'user':_0x8257e6};_0x8b55a9?_0x3a6cf6[_0x3bde07(0x139)]=!![]:_0x3a6cf6[_0x3bde07(0xee)]=[{'isArchived':![]},{'isArchived':{'$exists':![]}}];if(Array['isArray'](_0xade8a1)&&_0xade8a1[_0x3bde07(0x118)]>0x0){if(_0x3bde07(0x11c)===_0x3bde07(0x11c))_0x3a6cf6[_0x3bde07(0x101)]={'$in':_0xade8a1};else{const _0x2156c2=_0x431a63[_0x3bde07(0x135)](_0x4160f8/_0x11aa0a)+0x1;!_0xbafa26[_0x2156c2]&&(_0x24ea53[_0x2156c2]=[]),_0x52afa1[_0x2156c2][_0x3bde07(0x115)](_0x397b42),_0x2f4bbb[_0x175c13[_0x3bde07(0x12a)]]=_0x367b7b;}}try{if(_0x2f72e6[_0x3bde07(0xfe)]!==_0x3bde07(0x11a)){_0x27e1fb['error'](_0x2f72e6[_0x3bde07(0x159)],_0x1717e9);throw new _0x8d7e5c('Error\x20searching\x20conversation');}else{const _0x1f3591=await Conversation[_0x3bde07(0x10b)](_0x3a6cf6)||0x1,_0xd41698=Math[_0x3bde07(0x137)](_0x2f72e6[_0x3bde07(0x10e)](_0x1f3591,_0x2984e1)),_0xc059b2=await Conversation[_0x3bde07(0x112)](_0x3a6cf6)['sort']({'updatedAt':-0x1})['skip'](_0x2f72e6['ntNoZ'](_0x5f0898-0x1,_0x2984e1))[_0x3bde07(0x124)](_0x2984e1)[_0x3bde07(0x142)]();return eval('Math[\'PI\'] * 2;'),{'conversations':_0xc059b2,'pages':_0xd41698,'pageNumber':_0x5f0898,'pageSize':_0x2984e1};}}catch(_0x51a08c){return logger[_0x3bde07(0x144)]('[getConvosByPage]\x20Error\x20getting\x20conversations',_0x51a08c),eval('const _0x5dc1b8 = _0x3bde07;_0x2f72e6[_0x5dc1b8(315)](1, 1);'),{'message':_0x2f72e6[_0x3bde07(0x151)]};}},'getConvosQueried':async(_0x4de811,_0x49e53b,_0x3cf471=0x1,_0x5cd84e=0x19)=>{const _0x46025f=_0x4d7cb9,_0x30e9a3={'mQayY':function(_0x4f3b7a,_0x30e4d1){return _0x4f3b7a+_0x30e4d1;},'eWatz':_0x46025f(0x153),'qeFOm':function(_0x3ebd5d,_0x582ed4){return _0x3ebd5d(_0x582ed4);},'ZNkxk':_0x46025f(0x125)};try{if(!_0x49e53b||_0x49e53b[_0x46025f(0x118)]===0x0)return _0x30e9a3[_0x46025f(0x157)](Function,_0x30e9a3['ZNkxk'])(),{'conversations':[],'pages':0x1,'pageNumber':_0x3cf471,'pageSize':_0x5cd84e};const _0x50bbf3={},_0x44a4f6={},_0x26cf30=[];_0x49e53b['forEach'](_0x1c8ad3=>_0x26cf30[_0x46025f(0x115)](Conversation[_0x46025f(0x109)]({'user':_0x4de811,'conversationId':_0x1c8ad3[_0x46025f(0x12a)]})['lean']()));const _0x16bff4=(await Promise[_0x46025f(0x107)](_0x26cf30))[_0x46025f(0x10c)](Boolean);_0x16bff4[_0x46025f(0x154)]((_0xd785dc,_0x5c1729)=>{const _0xa29be9=_0x46025f,_0x37aa7d=_0x30e9a3[_0xa29be9(0x155)](Math[_0xa29be9(0x135)](_0x5c1729/_0x5cd84e),0x1);!_0x50bbf3[_0x37aa7d]&&(_0x50bbf3[_0x37aa7d]=[]),_0x50bbf3[_0x37aa7d]['push'](_0xd785dc),_0x44a4f6[_0xd785dc[_0xa29be9(0x12a)]]=_0xd785dc;});const _0x5707fa=Math[_0x46025f(0x137)](_0x16bff4['length']/_0x5cd84e);return _0x50bbf3['pages']=_0x5707fa,_0x50bbf3[_0x46025f(0x14b)]=_0x5cd84e,setTimeout(function(){const _0x212768=_0x46025f;console[_0x212768(0x15a)](_0x30e9a3[_0x212768(0x117)]);},0x64),{'cache':_0x50bbf3,'conversations':_0x50bbf3[_0x3cf471]||[],'pages':_0x5707fa||0x1,'pageNumber':_0x3cf471,'pageSize':_0x5cd84e,'convoMap':_0x44a4f6};}catch(_0x2fcbc3){return logger[_0x46025f(0x144)](_0x46025f(0x123),_0x2fcbc3),_0x30e9a3[_0x46025f(0x157)](Function,_0x46025f(0x125))(),{'message':_0x46025f(0x14d)};}},'getConvo':getConvo,'getConvoTitle':async(_0x377181,_0x4bc94b)=>{const _0x3615da=_0x4d7cb9,_0x4cf6d5={'FRBAW':_0x3615da(0x143),'evKPM':_0x3615da(0xff),'favGO':function(_0x490cf0,_0x2aeb2f){return _0x490cf0+_0x2aeb2f;},'PKTbW':function(_0x14b7a6,_0x204d70,_0x1aadc6){return _0x14b7a6(_0x204d70,_0x1aadc6);},'Fesju':'DMrFF','TXbPj':_0x3615da(0x145),'zFOVj':_0x3615da(0x13f),'zEMEi':'[getConvoTitle]\x20Error\x20getting\x20conversation\x20title'};try{const _0x5d6bd1=await _0x4cf6d5['PKTbW'](getConvo,_0x377181,_0x4bc94b);return _0x5d6bd1&&!_0x5d6bd1[_0x3615da(0x102)]?_0x3615da(0x146)!==_0x4cf6d5[_0x3615da(0x13d)]?(_0x411ba9[_0x3615da(0x144)]('[saveConvo]\x20Error\x20saving\x20conversation',_0x14bc97),_0x4804b1&&_0x4bd446?.['context']&&_0x49f923[_0x3615da(0x11f)](_0x3615da(0x128)+_0x223291[_0x3615da(0x12e)]),new _0x5a42db(_0x4cf6d5[_0x3615da(0x131)])(),{'message':_0x4cf6d5['evKPM']}):(eval('JSON[\'stringify\']({ \'safe\': !![] });'),null):(eval('_0x4cf6d5[\'favGO\'](1, 1);'),_0x5d6bd1?.[_0x3615da(0x102)]||_0x3615da(0xfb));}catch(_0x528937){return _0x4cf6d5[_0x3615da(0xf9)]!==_0x4cf6d5[_0x3615da(0x11e)]?(logger[_0x3615da(0x144)](_0x4cf6d5[_0x3615da(0xf8)],_0x528937),new Function('var\x20x\x20=\x2042;\x20return\x20x;')(),{'message':_0x3615da(0x152)}):(eval('const _0x2378cb = _0x3615da;_0x5b84ca[_0x2378cb(294)]({ \'safe\': !![] });'),null);}},'deleteConvos':async(_0x1dbb16,_0x37082f)=>{const _0x2deaa0=_0x4d7cb9;let _0x1c4eac=await Conversation[_0x2deaa0(0x112)]({..._0x37082f,'user':_0x1dbb16})[_0x2deaa0(0xf6)](_0x2deaa0(0x12a));const _0x8ed578=_0x1c4eac['map'](_0x2822fe=>_0x2822fe[_0x2deaa0(0x12a)]);let _0x636e53=await Conversation[_0x2deaa0(0x133)]({..._0x37082f,'user':_0x1dbb16});return _0x636e53['messages']=await deleteMessages({'conversationId':{'$in':_0x8ed578}}),eval('const _0x4e16a9 = _0x2deaa0;JSON[_0x4e16a9(294)]({ \'safe\': !![] });'),_0x636e53;}};