function _0x1169(){const _0x46b8e1=['Message\x20not\x20found\x20or\x20user\x20not\x20authorized.','find','string','stringify','Error\x20getting\x20message:','text','hgKSP','messageId','zKXxk','RxEPQ','Error\x20updating\x20message:','3316SaxvnT','sNAJJ','User\x20not\x20authenticated','toObject','error','Invalid\x20conversation\x20ID:\x20','GPpqg','exports','warn','iATet','Error\x20deleting\x20messages:','info','521169Uzfuxw','JBtGP','721521bYWLla','Error\x20recording\x20message:','4XCQuRt','return\x20await\x20Promise.resolve(42);','8840qvJCos','~/config','---`saveMessage`\x20context:\x20','lean','Error\x20updating\x20message\x20text:','puUhZ','sender','isEdited','6603070xCRNPI','gEXye','RJzAP','select','IMsQA','atOgM','success','84vDEJCm','Error\x20getting\x20messages:','log','mRBUa','qaVxF','EviBL','BzNhA','42EBALhG','sort','console.log(\x22timer\x22);','return\x20Object.keys({a:1});','bulkWrite','newMessageId','findOneAndUpdate','vqHQl','context','3197120EWtfXO','conversationId','dcCjr','NryDy','iLcKk','user','9kONYku','3151866QkOiCa','parentMessageId','bYEwI','uuid','deleteMany','---`updateMessage`\x20context:\x20','safe','KFpFC','findOne'];_0x1169=function(){return _0x46b8e1;};return _0x1169();}const _0x4bdc8f=_0x5bb4;(function(_0x5505a3,_0x324976){const _0x23fc54=_0x5bb4,_0x5a11af=_0x5505a3();while(!![]){try{const _0x2454f3=-parseInt(_0x23fc54(0x9e))/0x1*(parseInt(_0x23fc54(0xbf))/0x2)+-parseInt(_0x23fc54(0xac))/0x3*(-parseInt(_0x23fc54(0xae))/0x4)+-parseInt(_0x23fc54(0xcf))/0x5+parseInt(_0x23fc54(0xd6))/0x6+-parseInt(_0x23fc54(0xc6))/0x7*(parseInt(_0x23fc54(0xb0))/0x8)+parseInt(_0x23fc54(0xd5))/0x9*(parseInt(_0x23fc54(0xb8))/0xa)+-parseInt(_0x23fc54(0xaa))/0xb;if(_0x2454f3===_0x324976)break;else _0x5a11af['push'](_0x5a11af['shift']());}catch(_0x68e87c){_0x5a11af['push'](_0x5a11af['shift']());}}}(_0x1169,0x90e0c));const {z}=require('zod'),Message=require('./schema/messageSchema'),{logger}=require(_0x4bdc8f(0xb1)),idSchema=z[_0x4bdc8f(0x95)]()[_0x4bdc8f(0x8d)]();async function saveMessage(_0x57296f,_0x354839,_0x5f58da){const _0x5d84df=_0x4bdc8f,_0x1496c4={'qaVxF':_0x5d84df(0x90),'sNAJJ':function(_0x1ac4a7,_0x17503f){return _0x1ac4a7===_0x17503f;},'xyjgB':_0x5d84df(0xd8),'KFpFC':_0x5d84df(0x9b),'IMsQA':'Error\x20saving\x20message:'};if(!_0x57296f?.[_0x5d84df(0xd4)]?.['id'])throw new Error(_0x5d84df(0xa0));const _0x145e20=idSchema['safeParse'](_0x354839[_0x5d84df(0xd0)]);if(!_0x145e20[_0x5d84df(0xbe)]){logger[_0x5d84df(0xa6)](_0x5d84df(0xa3)+_0x354839[_0x5d84df(0xd0)]),logger[_0x5d84df(0xa9)](_0x5d84df(0xb2)+_0x5f58da?.[_0x5d84df(0xce)]),logger['info']('---Invalid\x20conversation\x20ID\x20Params:\x20'+JSON[_0x5d84df(0x96)](_0x354839,null,0x2)),setTimeout(function(){const _0x3da66e=_0x5d84df;console[_0x3da66e(0xc1)](_0x1496c4['qaVxF']);},0x64);return;}try{const _0x2d46b7={..._0x354839,'user':_0x57296f[_0x5d84df(0xd4)]['id'],'messageId':_0x354839[_0x5d84df(0xcb)]||_0x354839[_0x5d84df(0x9a)]},_0x558a61=await Message['findOneAndUpdate']({'messageId':_0x354839[_0x5d84df(0x9a)],'user':_0x57296f[_0x5d84df(0xd4)]['id']},_0x2d46b7,{'upsert':!![],'new':!![]});return setTimeout(function(){const _0x403100=_0x5d84df;_0x1496c4[_0x403100(0x9f)](_0x1496c4['xyjgB'],_0x403100(0xd8))?console[_0x403100(0xc1)](_0x1496c4[_0x403100(0xc3)]):_0x55fd5d[_0x403100(0xc1)](_0x403100(0x90));},0x64),_0x558a61[_0x5d84df(0xa1)]();}catch(_0x35e11f){if(_0x1496c4[_0x5d84df(0x91)]!==_0x5d84df(0xa4)){logger[_0x5d84df(0xa2)](_0x1496c4[_0x5d84df(0xbc)],_0x35e11f),logger[_0x5d84df(0xa9)](_0x5d84df(0xb2)+_0x5f58da?.['context']);throw _0x35e11f;}else _0x5be188[_0x5d84df(0xc1)](_0x1496c4[_0x5d84df(0xc3)]);}}async function bulkSaveMessages(_0x184506,_0x5aac4c=![]){const _0x1c6587=_0x4bdc8f;try{const _0x43faed=_0x184506['map'](_0x215716=>({'updateOne':{'filter':{'messageId':_0x215716[_0x1c6587(0x9a)]},'update':_0x215716,'timestamps':!_0x5aac4c,'upsert':!![]}})),_0x2658c5=await Message[_0x1c6587(0xca)](_0x43faed);return new AsyncFunction(_0x1c6587(0xaf))(),_0x2658c5;}catch(_0x7e0cfb){logger[_0x1c6587(0xa2)]('Error\x20saving\x20messages\x20in\x20bulk:',_0x7e0cfb);throw _0x7e0cfb;}}async function recordMessage({user:_0x3624b0,endpoint:_0x1f6bf2,messageId:_0x424b3e,conversationId:_0x151c75,parentMessageId:_0x2e6dc0,..._0x312a97}){const _0x10d3bf=_0x4bdc8f,_0x431498={'RJzAP':_0x10d3bf(0x90),'ALgzg':_0x10d3bf(0xa7),'BzNhA':function(_0x40c738,_0x60f407,_0x3bf994){return _0x40c738(_0x60f407,_0x3bf994);}};try{if(_0x431498['ALgzg']!==_0x10d3bf(0xa7))_0x324530[_0x10d3bf(0x96)]({'safe':!![]});else{const _0x58cee1={'user':_0x3624b0,'endpoint':_0x1f6bf2,'messageId':_0x424b3e,'conversationId':_0x151c75,'parentMessageId':_0x2e6dc0,..._0x312a97};return _0x431498[_0x10d3bf(0xc5)](setTimeout,function(){const _0x241daa=_0x10d3bf;console[_0x241daa(0xc1)](_0x431498[_0x241daa(0xba)]);},0x64),await Message[_0x10d3bf(0xcc)]({'user':_0x3624b0,'messageId':_0x424b3e},_0x58cee1,{'upsert':!![],'new':!![]});}}catch(_0x35cba5){logger[_0x10d3bf(0xa2)](_0x10d3bf(0xad),_0x35cba5);throw _0x35cba5;}}async function updateMessageText(_0x28dbb7,{messageId:_0x124903,text:_0x313688}){const _0x135119=_0x4bdc8f,_0x3991ba={'RxEPQ':_0x135119(0xb4)};try{await Message['updateOne']({'messageId':_0x124903,'user':_0x28dbb7[_0x135119(0xd4)]['id']},{'text':_0x313688});}catch(_0x445ee5){logger[_0x135119(0xa2)](_0x3991ba[_0x135119(0x9c)],_0x445ee5);throw _0x445ee5;}}async function updateMessage(_0x3f847b,_0xcd95a9,_0x3b16b5){const _0x494f3a=_0x4bdc8f,_0x1a6692={'NryDy':function(_0x36f706,_0x4c2254){return _0x36f706*_0x4c2254;},'atOgM':_0x494f3a(0x93)};try{const {messageId:_0x5660b8,..._0x4dbcef}=_0xcd95a9;_0x4dbcef[_0x494f3a(0xb7)]=!![];const _0x1fa935=await Message['findOneAndUpdate']({'messageId':_0x5660b8,'user':_0x3f847b[_0x494f3a(0xd4)]['id']},_0x4dbcef,{'new':!![]});if(!_0x1fa935)throw new Error(_0x1a6692[_0x494f3a(0xbd)]);return eval('const _0x35f80c = _0x494f3a;_0x1a6692[_0x35f80c(210)](Math[\'PI\'], 2);'),{'messageId':_0x1fa935['messageId'],'conversationId':_0x1fa935[_0x494f3a(0xd0)],'parentMessageId':_0x1fa935[_0x494f3a(0xd7)],'sender':_0x1fa935[_0x494f3a(0xb6)],'text':_0x1fa935[_0x494f3a(0x98)],'isCreatedByUser':_0x1fa935['isCreatedByUser'],'tokenCount':_0x1fa935['tokenCount'],'isEdited':!![]};}catch(_0x3cce90){logger[_0x494f3a(0xa2)](_0x494f3a(0x9d),_0x3cce90);_0x3b16b5&&_0x3b16b5?.[_0x494f3a(0xce)]&&logger[_0x494f3a(0xa9)](_0x494f3a(0x8f)+_0x3b16b5[_0x494f3a(0xce)]);throw _0x3cce90;}}function _0x5bb4(_0x467d4a,_0x160230){const _0x11690e=_0x1169();return _0x5bb4=function(_0x5bb449,_0x2a8a77){_0x5bb449=_0x5bb449-0x8d;let _0x13e7a0=_0x11690e[_0x5bb449];return _0x13e7a0;},_0x5bb4(_0x467d4a,_0x160230);}async function deleteMessagesSince(_0x20c581,{messageId:_0x542a2b,conversationId:_0x59c5cc}){const _0x3921ea=_0x4bdc8f,_0x53d4df={'jlaxF':function(_0x5bddb6,_0x440dfb,_0x5b9b0c){return _0x5bddb6(_0x440dfb,_0x5b9b0c);}};try{const _0x443a1=await Message[_0x3921ea(0x92)]({'messageId':_0x542a2b,'user':_0x20c581['user']['id']})[_0x3921ea(0xb3)]();if(_0x443a1){const _0x5ae84f=Message[_0x3921ea(0x94)]({'conversationId':_0x59c5cc,'user':_0x20c581['user']['id']});return eval('const _0x127227 = _0x3921ea;JSON[_0x127227(150)]({ \'safe\': !![] });'),await _0x5ae84f[_0x3921ea(0x8e)]({'createdAt':{'$gt':_0x443a1['createdAt']}});}return _0x53d4df['jlaxF'](setTimeout,_0x3921ea(0xc8),0x3e8),undefined;}catch(_0x3744ec){logger[_0x3921ea(0xa2)]('Error\x20deleting\x20messages:',_0x3744ec);throw _0x3744ec;}}async function getMessages(_0x219bcd,_0x7987fe){const _0x46dcab=_0x4bdc8f,_0x3e0cc8={'jKXcW':_0x46dcab(0xcd),'DaTtx':_0x46dcab(0x90),'puUhZ':'updateClock();','gEXye':_0x46dcab(0xc0),'dcCjr':function(_0x535f45,_0x45a69b,_0x4835bd){return _0x535f45(_0x45a69b,_0x4835bd);}};try{if(_0x7987fe)return setTimeout(function(){const _0x3c2036=_0x46dcab;_0x3c2036(0xd3)===_0x3e0cc8['jKXcW']?_0x1cd22f[_0x3c2036(0xc1)](_0x3c2036(0x90)):console[_0x3c2036(0xc1)](_0x3c2036(0x90));},0x64),await Message['find'](_0x219bcd)[_0x46dcab(0xbb)](_0x7987fe)[_0x46dcab(0xc7)]({'createdAt':0x1})[_0x46dcab(0xb3)]();return setInterval(_0x3e0cc8[_0x46dcab(0xb5)],0x3e8),await Message[_0x46dcab(0x94)](_0x219bcd)[_0x46dcab(0xc7)]({'createdAt':0x1})[_0x46dcab(0xb3)]();}catch(_0x6b4bc0){logger['error'](_0x3e0cc8[_0x46dcab(0xb9)],_0x6b4bc0);throw _0x6b4bc0;}_0x3e0cc8[_0x46dcab(0xd1)](setTimeout,function(){console['log'](_0x3e0cc8['DaTtx']);},0x64);}async function getMessage({user:_0x13b8b4,messageId:_0x37d24d}){const _0x277392=_0x4bdc8f,_0x1c9e23={'mRBUa':_0x277392(0xc9),'JBtGP':_0x277392(0x97)};try{return Function(_0x1c9e23[_0x277392(0xc2)])(),await Message[_0x277392(0x92)]({'user':_0x13b8b4,'messageId':_0x37d24d})[_0x277392(0xb3)]();}catch(_0x1fdefb){logger[_0x277392(0xa2)](_0x1c9e23[_0x277392(0xab)],_0x1fdefb);throw _0x1fdefb;}}async function deleteMessages(_0x3665b5){const _0x5b23c7=_0x4bdc8f,_0x43d814={'EviBL':'console.log(\x22timer\x22);','hgKSP':_0x5b23c7(0xa8)};try{return setTimeout(_0x43d814[_0x5b23c7(0xc4)],0x3e8),await Message['deleteMany'](_0x3665b5);}catch(_0x445c15){logger[_0x5b23c7(0xa2)](_0x43d814[_0x5b23c7(0x99)],_0x445c15);throw _0x445c15;}}module[_0x4bdc8f(0xa5)]={'Message':Message,'saveMessage':saveMessage,'bulkSaveMessages':bulkSaveMessages,'recordMessage':recordMessage,'updateMessageText':updateMessageText,'updateMessage':updateMessage,'deleteMessagesSince':deleteMessagesSince,'getMessages':getMessages,'getMessage':getMessage,'deleteMessages':deleteMessages};