'use strict';function _0x5514(){const _0x2dc07e=['HBljW','strapi_content_types_schema','destroy','3513872SOAueC','NAQpZ','SHChB','using\x20a\x20transaction\x20object','OsctA','493750TVHNSj','9283420PvYycj','wrong\x20key','api-tests/strapi','select','VmEBT','iAFNQ','transacting','sYLDY','7686wigKxW','fJMBx','czaBQ','cTXGK','message','rollback','RYBTq','Tbttz','JWXLt','BaCJg','onCommit\x20hook\x20works','commits\x20successfully','3502597xtFLnl','this\x20should\x20not\x20be\x20reached','key','2526036pEcFpX','ElSRM','commit','lRHXT','using\x20a\x20transaction\x20method','rollback\x20successfully','changed\x20key\x20-\x20nested','transaction','ZplCA','PCXPB','3Tavidw','strapi::core-store','5992vnUiRF','test','qDlqe','bad\x20key','where','toEqual','37066GYYigG','changed\x20key','update','vEBnX','invalid_uid','uYuuu','zonoA','this\x20should\x20error','error','queryBuilder','HPSLL','oQrLP','IwGVb','wpeFn','get','new\x20key','execute','toBe','log','3gwVOnS'];_0x5514=function(){return _0x2dc07e;};return _0x5514();}const _0x488ea4=_0x5a89;(function(_0x23780c,_0x556cbe){const _0x5e6c89=_0x5a89,_0x61278d=_0x23780c();while(!![]){try{const _0x3bf187=parseInt(_0x5e6c89(0x215))/0x1*(parseInt(_0x5e6c89(0x202))/0x2)+parseInt(_0x5e6c89(0x1fa))/0x3*(-parseInt(_0x5e6c89(0x219))/0x4)+-parseInt(_0x5e6c89(0x21e))/0x5+parseInt(_0x5e6c89(0x1f0))/0x6+-parseInt(_0x5e6c89(0x1ed))/0x7+parseInt(_0x5e6c89(0x1fc))/0x8*(parseInt(_0x5e6c89(0x227))/0x9)+parseInt(_0x5e6c89(0x21f))/0xa;if(_0x3bf187===_0x556cbe)break;else _0x61278d['push'](_0x61278d['shift']());}catch(_0x483082){_0x61278d['push'](_0x61278d['shift']());}}}(_0x5514,0x8a6dc));function _0x5a89(_0xb42c0e,_0xe4e113){const _0x551429=_0x5514();return _0x5a89=function(_0x5a89f4,_0x3a02ec){_0x5a89f4=_0x5a89f4-0x1eb;let _0x25808d=_0x551429[_0x5a89f4];return _0x25808d;},_0x5a89(_0xb42c0e,_0xe4e113);}const {createStrapiInstance}=require(_0x488ea4(0x221));let strapi;describe('transactions',()=>{const _0x3dc899=_0x488ea4,_0x44e97d={'VyGYZ':function(_0x203975){return _0x203975();},'ZplCA':_0x3dc899(0x1fb),'zonoA':_0x3dc899(0x1f6),'vEBnX':function(_0x458676,_0x2bd169){return _0x458676(_0x2bd169);},'qDlqe':_0x3dc899(0x203),'lRHXT':'this\x20should\x20not\x20be\x20reached','sYLDY':function(_0x527253,_0x11cb49){return _0x527253(_0x11cb49);},'HWPfY':_0x3dc899(0x211),'HBljW':_0x3dc899(0x1ec),'SHChB':'nested\x20rollback\x20->\x20rollback\x20works','oQrLP':'wrong\x20key','IwGVb':_0x3dc899(0x206),'HPSLL':_0x3dc899(0x209),'iAFNQ':_0x3dc899(0x1f5),'czaBQ':function(_0x50490f,_0x16759e,_0x331ade){return _0x50490f(_0x16759e,_0x331ade);}};let _0x5650e0;_0x44e97d[_0x3dc899(0x205)](beforeAll,async()=>{const _0x17f559=_0x3dc899;strapi=await _0x44e97d['VyGYZ'](createStrapiInstance),_0x5650e0=await strapi['db'][_0x17f559(0x20b)](_0x44e97d[_0x17f559(0x1f8)])[_0x17f559(0x222)](['*'])['where']({'id':0x1})[_0x17f559(0x212)]();}),afterAll(async()=>{const _0x435581=_0x3dc899;await strapi[_0x435581(0x218)]();}),afterEach(async()=>{const _0x43793f=_0x3dc899;await strapi['db'][_0x43793f(0x20b)](_0x43793f(0x1fb))[_0x43793f(0x204)]({'key':_0x5650e0[0x0]['key']})['where']({'id':0x1})[_0x43793f(0x212)]();}),_0x44e97d[_0x3dc899(0x229)](describe,_0x3dc899(0x1f4),()=>{const _0x4e4663=_0x3dc899,_0x4f6b18={'OsctA':_0x4e4663(0x1fb),'cTXGK':_0x44e97d['HWPfY'],'RYBTq':function(_0x39ea19,_0x510ed9){return _0x39ea19(_0x510ed9);},'aASJi':_0x4e4663(0x206),'JWXLt':_0x4e4663(0x1ff),'ntXjC':'changed\x20key','BaCJg':_0x4e4663(0x1f6),'ElSRM':function(_0x561eac,_0x158c04){return _0x561eac(_0x158c04);},'Tbttz':_0x4e4663(0x1ee)};test(_0x44e97d['HBljW'],async()=>{const _0x3fe1c2=_0x4e4663,_0x370082={'wpeFn':_0x4f6b18[_0x3fe1c2(0x21d)],'sfvPa':_0x4f6b18[_0x3fe1c2(0x22a)]};await strapi['db'][_0x3fe1c2(0x1f7)](async()=>{const _0x5e38e8=_0x3fe1c2;await strapi['db']['queryBuilder'](_0x370082[_0x5e38e8(0x20f)])[_0x5e38e8(0x204)]({'key':_0x5e38e8(0x220)})['where']({'id':0x1})[_0x5e38e8(0x212)](),await strapi['db'][_0x5e38e8(0x20b)](_0x370082[_0x5e38e8(0x20f)])[_0x5e38e8(0x204)]({'key':_0x370082['sfvPa']})['where']({'id':0x1})[_0x5e38e8(0x212)]();});const _0x5263ae=await strapi['db']['queryBuilder'](_0x4f6b18[_0x3fe1c2(0x21d)])[_0x3fe1c2(0x222)](['*'])[_0x3fe1c2(0x200)]({'id':0x1})[_0x3fe1c2(0x212)]();_0x4f6b18['RYBTq'](expect,_0x5263ae[0x0][_0x3fe1c2(0x1ef)])[_0x3fe1c2(0x201)](_0x3fe1c2(0x211));}),test(_0x4e4663(0x1f5),async()=>{const _0x2aab1a=_0x4e4663;try{await strapi['db']['transaction'](async()=>{const _0x41a447=_0x5a89;await strapi['db'][_0x41a447(0x20b)](_0x41a447(0x1fb))[_0x41a447(0x204)]({'key':_0x41a447(0x220)})[_0x41a447(0x200)]({'id':0x1})[_0x41a447(0x212)](),await strapi['db'][_0x41a447(0x20b)](_0x4f6b18['aASJi'])[_0x41a447(0x204)]({'key':_0x4f6b18[_0x41a447(0x22f)],'invalid_key':_0x41a447(0x20a)})[_0x41a447(0x200)]({'id':0x1})['execute']();}),expect(_0x2aab1a(0x1ee))[_0x2aab1a(0x213)](![]);}catch(_0x37b801){}const _0x5f0b94=await strapi['db'][_0x2aab1a(0x20b)](_0x4f6b18[_0x2aab1a(0x21d)])[_0x2aab1a(0x222)](['*'])['where']({'id':0x1})[_0x2aab1a(0x212)]();expect(_0x5f0b94[0x0][_0x2aab1a(0x1ef)])['toEqual'](_0x5650e0[0x0]['key']);}),test(_0x44e97d[_0x4e4663(0x21b)],async()=>{const _0x2b770c=_0x4e4663,_0x428386={'uYuuu':_0x44e97d['ZplCA'],'PCXPB':_0x44e97d[_0x2b770c(0x208)],'fJMBx':function(_0x2de14e,_0x477f51){const _0x24d2d3=_0x2b770c;return _0x44e97d[_0x24d2d3(0x205)](_0x2de14e,_0x477f51);},'jRNCM':_0x44e97d[_0x2b770c(0x1fe)],'NAQpZ':_0x2b770c(0x20a)};try{await strapi['db'][_0x2b770c(0x1f7)](async()=>{const _0x4ee6e1=_0x2b770c;await strapi['db'][_0x4ee6e1(0x20b)](_0x4ee6e1(0x1fb))[_0x4ee6e1(0x204)]({'key':_0x4ee6e1(0x203)})['where']({'id':0x1})[_0x4ee6e1(0x212)]();try{await strapi['db'][_0x4ee6e1(0x1f7)](async()=>{const _0xe2cd8c=_0x4ee6e1;await strapi['db'][_0xe2cd8c(0x20b)](_0x428386[_0xe2cd8c(0x207)])[_0xe2cd8c(0x204)]({'key':_0x428386[_0xe2cd8c(0x1f9)]})[_0xe2cd8c(0x200)]({'id':0x1})[_0xe2cd8c(0x212)](),await strapi['db'][_0xe2cd8c(0x20b)](_0xe2cd8c(0x206))['update']({'invalid_key':_0xe2cd8c(0x20a)})['where']({'id':0x1})[_0xe2cd8c(0x212)]();});}catch(_0x3f7a7b){}const _0x4878eb=await strapi['db']['queryBuilder'](_0x4ee6e1(0x1fb))[_0x4ee6e1(0x222)](['*'])['where']({'id':0x1})[_0x4ee6e1(0x212)]();_0x428386[_0x4ee6e1(0x228)](expect,_0x4878eb[0x0][_0x4ee6e1(0x1ef)])[_0x4ee6e1(0x201)](_0x428386['jRNCM']),await strapi['db'][_0x4ee6e1(0x20b)](_0x4ee6e1(0x206))[_0x4ee6e1(0x204)]({'key':_0x5650e0[0x0][_0x4ee6e1(0x1ef)],'invalid_key':_0x428386[_0x4ee6e1(0x21a)]})[_0x4ee6e1(0x200)]({'id':0x1})['execute']();}),expect(_0x44e97d[_0x2b770c(0x1f3)])[_0x2b770c(0x213)](![]);}catch(_0x3682ff){}const _0x47f179=await strapi['db']['queryBuilder'](_0x2b770c(0x1fb))[_0x2b770c(0x222)](['*'])['where']({'id':0x1})[_0x2b770c(0x212)]();_0x44e97d['sYLDY'](expect,_0x47f179[0x0][_0x2b770c(0x1ef)])[_0x2b770c(0x201)](_0x5650e0[0x0][_0x2b770c(0x1ef)]);}),test('nested\x20commit\x20->\x20rollback\x20works',async()=>{const _0x549da4=_0x4e4663;try{await strapi['db']['transaction'](async()=>{const _0x43c77a=_0x5a89;await strapi['db'][_0x43c77a(0x20b)](_0x4f6b18[_0x43c77a(0x21d)])[_0x43c77a(0x204)]({'key':_0x4f6b18['ntXjC']})['where']({'id':0x1})['execute']();try{await strapi['db']['transaction'](async()=>{const _0xeeb989=_0x43c77a;await strapi['db'][_0xeeb989(0x20b)](_0xeeb989(0x1fb))[_0xeeb989(0x204)]({'key':'changed\x20key\x20-\x20nested'})[_0xeeb989(0x200)]({'id':0x1})['execute']();});}catch(_0x4a1f50){}const _0x38b39c=await strapi['db'][_0x43c77a(0x20b)](_0x4f6b18[_0x43c77a(0x21d)])[_0x43c77a(0x222)](['*'])[_0x43c77a(0x200)]({'id':0x1})['execute']();_0x4f6b18[_0x43c77a(0x22d)](expect,_0x38b39c[0x0][_0x43c77a(0x1ef)])[_0x43c77a(0x201)](_0x4f6b18[_0x43c77a(0x230)]),await strapi['db'][_0x43c77a(0x20b)]('invalid_uid')[_0x43c77a(0x204)]({'key':_0x5650e0[0x0][_0x43c77a(0x1ef)],'invalid_key':'error'})[_0x43c77a(0x200)]({'id':0x1})[_0x43c77a(0x212)]();}),_0x4f6b18[_0x549da4(0x1f1)](expect,_0x4f6b18[_0x549da4(0x22e)])[_0x549da4(0x213)](![]);}catch(_0x11928b){}const _0x30b389=await strapi['db'][_0x549da4(0x20b)]('strapi::core-store')[_0x549da4(0x222)](['*'])[_0x549da4(0x200)]({'id':0x1})[_0x549da4(0x212)]();expect(_0x30b389[0x0][_0x549da4(0x1ef)])[_0x549da4(0x201)](_0x5650e0[0x0][_0x549da4(0x1ef)]);}),test(_0x4e4663(0x1eb),async()=>{const _0x5d9db7=_0x4e4663,_0x4a526e={'VmEBT':function(_0x3eaf8f,_0x1d1602){return _0x3eaf8f(_0x1d1602);}};let _0x351692=0x0;await strapi['db'][_0x5d9db7(0x1f7)](({onCommit:_0x33261c,onRollback:_0x3c99f5})=>{const _0x17b909=_0x5d9db7;_0x4a526e[_0x17b909(0x223)](_0x33261c,()=>_0x351692++);}),expect(_0x351692)[_0x5d9db7(0x201)](0x1);}),test('onRollback\x20hook\x20works',async()=>{const _0x1ddbb2=_0x4e4663;let _0x296ae7=0x0;try{await strapi['db'][_0x1ddbb2(0x1f7)](({onRollback:_0xa35494})=>{const _0x3b4d85=_0x1ddbb2;_0xa35494(()=>_0x296ae7++);throw new Error(_0x3b4d85(0x1fd));});}catch(_0x14a34a){}expect(_0x296ae7)[_0x1ddbb2(0x201)](0x1);});}),describe(_0x3dc899(0x21c),()=>{const _0x1b0aaa=_0x3dc899;test(_0x44e97d[_0x1b0aaa(0x216)],async()=>{const _0x29584a=_0x1b0aaa,_0x111716=await strapi['db']['transaction']();try{await strapi['db']['queryBuilder'](_0x44e97d[_0x29584a(0x1f8)])['update']({'key':'wrong\x20key'})[_0x29584a(0x200)]({'id':0x1})[_0x29584a(0x225)](_0x111716['get']())[_0x29584a(0x212)](),await strapi['db']['queryBuilder'](_0x44e97d[_0x29584a(0x1f8)])[_0x29584a(0x204)]({'key':_0x5650e0[0x0][_0x29584a(0x1ef)]})[_0x29584a(0x200)]({'id':0x1})[_0x29584a(0x225)](_0x111716[_0x29584a(0x210)]())['execute'](),await _0x111716[_0x29584a(0x1f2)]();}catch(_0x329bc3){await _0x111716[_0x29584a(0x22c)](),console[_0x29584a(0x214)](_0x329bc3[_0x29584a(0x22b)]),expect(_0x44e97d[_0x29584a(0x1f3)])['toBe'](![]);}const _0x1780db=await strapi['db'][_0x29584a(0x20b)]('strapi::core-store')[_0x29584a(0x222)](['*'])[_0x29584a(0x200)]({'id':0x1})[_0x29584a(0x212)]();expect(_0x1780db[0x0]['key'])[_0x29584a(0x201)]('strapi_content_types_schema');}),test(_0x44e97d[_0x1b0aaa(0x224)],async()=>{const _0x23eb08=_0x1b0aaa,_0x3c6540=await strapi['db']['transaction']();try{await strapi['db']['queryBuilder'](_0x44e97d[_0x23eb08(0x1f8)])[_0x23eb08(0x204)]({'key':_0x44e97d[_0x23eb08(0x20d)]})[_0x23eb08(0x200)]({'id':0x1})[_0x23eb08(0x225)](_0x3c6540[_0x23eb08(0x210)]())[_0x23eb08(0x212)](),await strapi['db'][_0x23eb08(0x20b)](_0x44e97d[_0x23eb08(0x20e)])[_0x23eb08(0x204)]({'key':0x7b,'key_not_here':_0x44e97d[_0x23eb08(0x20c)]})[_0x23eb08(0x200)]({'id':_0x44e97d[_0x23eb08(0x20c)]})[_0x23eb08(0x225)](_0x3c6540[_0x23eb08(0x210)]())[_0x23eb08(0x212)](),await _0x3c6540[_0x23eb08(0x1f2)](),expect('this\x20should\x20not\x20be\x20reached')[_0x23eb08(0x213)](![]);}catch(_0x58ee19){await _0x3c6540[_0x23eb08(0x22c)]();}const _0x36929e=await strapi['db'][_0x23eb08(0x20b)](_0x44e97d['ZplCA'])[_0x23eb08(0x222)](['*'])[_0x23eb08(0x200)]({'id':0x1})[_0x23eb08(0x212)]();_0x44e97d[_0x23eb08(0x226)](expect,_0x36929e[0x0][_0x23eb08(0x1ef)])['toEqual'](_0x23eb08(0x217));});});});