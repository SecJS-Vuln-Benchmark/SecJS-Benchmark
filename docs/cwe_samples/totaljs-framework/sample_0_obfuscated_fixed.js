'use strict';const _0x22574c=_0x469a;function _0x469a(_0x473fd9,_0x3f7e9e){const _0x58c5fb=_0x58c5();return _0x469a=function(_0x469ada,_0x3c3a3a){_0x469ada=_0x469ada-0x1d0;let _0x4b86b6=_0x58c5fb[_0x469ada];return _0x4b86b6;},_0x469a(_0x473fd9,_0x3f7e9e);}(function(_0x53a4e0,_0x529d33){const _0x4ee83d=_0x469a,_0x4300a1=_0x53a4e0();while(!![]){try{const _0x5eab92=parseInt(_0x4ee83d(0x209))/0x1+-parseInt(_0x4ee83d(0x1f0))/0x2+parseInt(_0x4ee83d(0x232))/0x3*(parseInt(_0x4ee83d(0x207))/0x4)+-parseInt(_0x4ee83d(0x1fe))/0x5*(-parseInt(_0x4ee83d(0x211))/0x6)+-parseInt(_0x4ee83d(0x203))/0x7*(parseInt(_0x4ee83d(0x1f6))/0x8)+-parseInt(_0x4ee83d(0x1ec))/0x9+parseInt(_0x4ee83d(0x1f4))/0xa*(parseInt(_0x4ee83d(0x20e))/0xb);if(_0x5eab92===_0x529d33)break;else _0x4300a1['push'](_0x4300a1['shift']());}catch(_0x3218e6){_0x4300a1['push'](_0x4300a1['shift']());}}}(_0x58c5,0xf338a));const {AbilityBuilder,Ability}=require('@casl/ability'),{pick}=require(_0x22574c(0x202)),sift=require('sift'),{buildStrapiQuery}=require(_0x22574c(0x1ea)),createPermissionsManager=require(_0x22574c(0x238)),allowedOperations=[_0x22574c(0x230),_0x22574c(0x236),'$eq',_0x22574c(0x1db),_0x22574c(0x204),'$nin','$lt','$lte',_0x22574c(0x220),_0x22574c(0x1fa),_0x22574c(0x22c),_0x22574c(0x1d1)],operations=pick(allowedOperations,sift),conditionsMatcher=_0x5d3153=>{const _0x55dd42=_0x22574c;return sift[_0x55dd42(0x239)](_0x5d3153,{'operations':operations});},defineAbility=_0x5d4f2b=>{const {can:_0x59e7e8,build:_0x5845fe}=new AbilityBuilder(Ability);return _0x5d4f2b(_0x59e7e8),_0x5845fe({'conditionsMatcher':conditionsMatcher});};describe(_0x22574c(0x1f3),()=>{const _0x426e89=_0x22574c,_0x31315a={'CJAdv':function(_0x2ba0e7,_0x740dd0){return _0x2ba0e7(_0x740dd0);},'gsNNR':'foo','btUqe':function(_0x3eb153,_0x2bb53f,_0x3d8389){return _0x3eb153(_0x2bb53f,_0x3d8389);},'LISzH':'It\x20should\x20returns\x20a\x20valid\x20query\x20from\x20the\x20ability','xQMrt':_0x426e89(0x1d7),'ZflpO':function(_0x5bf974,_0x4b85a4){return _0x5bf974!==_0x4b85a4;},'mCLBv':_0x426e89(0x1e6),'zLzTl':function(_0x4ac275,_0x3fd81a,_0x202016){return _0x4ac275(_0x3fd81a,_0x202016);},'mOmkc':_0x426e89(0x243),'DelVi':_0x426e89(0x23f),'VurKw':'It\x20should\x20transform\x20an\x20object\x20to\x20a\x20subject\x20using\x20the\x20given\x20model','gDQsm':function(_0xb90ebc,_0x4e60e0){return _0xb90ebc(_0x4e60e0);},'thJMM':_0x426e89(0x1f2),'CeEui':function(_0x1030b9,_0x39bf20){return _0x1030b9(_0x39bf20);},'GswRl':_0x426e89(0x224),'gCcMx':function(_0x5503e1,_0x435870){return _0x5503e1(_0x435870);},'QoAOP':function(_0x5eb874,_0x23c611){return _0x5eb874(_0x23c611);},'rvxFv':_0x426e89(0x244),'uzxHo':_0x426e89(0x1f8),'WZwto':function(_0x5e5436,_0x4fe58d){return _0x5e5436(_0x4fe58d);},'wsKXt':function(_0x2d0a2c,_0x4e98f9){return _0x2d0a2c(_0x4e98f9);},'veihp':_0x426e89(0x235),'BWoVw':_0x426e89(0x1f1),'hRSYU':_0x426e89(0x21a),'HRWqP':_0x426e89(0x20a),'itjdp':'get\x20isAllowed','ThQhM':function(_0x3dfc8e,_0x11505d,_0x59403f){return _0x3dfc8e(_0x11505d,_0x59403f);},'INMjd':_0x426e89(0x200),'rJJPF':function(_0x37d39b,_0x6012c1,_0x3b7f02){return _0x37d39b(_0x6012c1,_0x3b7f02);},'xHbSA':_0x426e89(0x221),'LHczH':function(_0xd45f2b,_0x4bb59f,_0x44e92d){return _0xd45f2b(_0x4bb59f,_0x44e92d);},'JbCLX':_0x426e89(0x1eb)};_0x31315a[_0x426e89(0x23e)](beforeEach,()=>{const _0x28c05b=_0x426e89;global[_0x28c05b(0x1e1)]={'getModel'(){return{};}};}),describe('get\x20Query',()=>{const _0x5c9702=_0x426e89,_0x5c8dfe={'HrOKh':function(_0x4311b3,_0x460dd7){return _0x4311b3(_0x460dd7);},'DRsca':'read','AgTZa':function(_0x3addd5,_0x335e43){return _0x3addd5(_0x335e43);},'aUcmI':function(_0x455d9e,_0x5a198e){return _0x455d9e(_0x5a198e);},'IwmVJ':_0x5c9702(0x217)};test(_0x5c9702(0x1f5),async()=>{const _0x221a41=_0x5c9702,_0x421437=defineAbility(_0x453fde=>_0x453fde(_0x221a41(0x23f),'foo')),_0x2d509f=_0x5c8dfe[_0x221a41(0x1e2)](createPermissionsManager,{'ability':_0x421437,'action':_0x5c8dfe[_0x221a41(0x219)],'model':'foo'});_0x5c8dfe[_0x221a41(0x1e2)](expect,_0x2d509f['getQuery']())[_0x221a41(0x22e)]({});}),_0x31315a[_0x5c9702(0x229)](test,_0x31315a['LISzH'],()=>{const _0x38e1c5=_0x5c9702,_0xe08596=_0x5c8dfe[_0x38e1c5(0x20b)](defineAbility,_0x3f1f5c=>_0x3f1f5c(_0x38e1c5(0x23f),_0x38e1c5(0x217),[_0x38e1c5(0x1d7)],{'kai':_0x38e1c5(0x228)})),_0x2f8d31=_0x5c8dfe[_0x38e1c5(0x21f)](createPermissionsManager,{'ability':_0xe08596,'action':_0x5c8dfe[_0x38e1c5(0x219)],'model':_0x5c8dfe[_0x38e1c5(0x1e5)]}),_0x500a79={'$or':[{'kai':'doe'}]};expect(_0x2f8d31[_0x38e1c5(0x1d6)]())[_0x38e1c5(0x22e)](_0x500a79);}),test('It\x20should\x20throw\x20if\x20no\x20action\x20is\x20defined',()=>{const _0x942af2=_0x5c9702,_0x218d24=_0x31315a[_0x942af2(0x23e)](defineAbility,_0x2b3ebb=>_0x2b3ebb(_0x942af2(0x23f),_0x942af2(0x217),[_0x942af2(0x1d7)],{'kai':'doe'})),_0x503aac=_0x31315a[_0x942af2(0x23e)](createPermissionsManager,{'ability':_0x218d24,'model':_0x31315a[_0x942af2(0x22b)]});_0x31315a[_0x942af2(0x23e)](expect,()=>_0x503aac[_0x942af2(0x1d6)]())[_0x942af2(0x1fb)]();});}),describe(_0x31315a[_0x426e89(0x1dd)],()=>{const _0x1f3b9c=_0x426e89,_0x2f8739={'GDNNp':function(_0x1c7469,_0x201e62){return _0x1c7469(_0x201e62);},'nQloh':'YpMBH','IykuS':_0x1f3b9c(0x23f),'Qpbwm':_0x1f3b9c(0x217),'fhSES':_0x31315a['xQMrt']};if(_0x31315a[_0x1f3b9c(0x1ef)](_0x1f3b9c(0x20d),'SxQda')){const _0x3f7b47={'limit':0x64,'filters':{'$and':[{'a':'b'},{'c':'d'}]}},_0x30dddd={'limit':0x64,'filters':{'$and':[_0x3f7b47[_0x1f3b9c(0x233)],_0x52d7a1]}},_0x2d794b=_0x82bb30[_0x1f3b9c(0x221)](_0x3f7b47);_0x2f8739[_0x1f3b9c(0x1e3)](_0x637575,_0x2d794b)[_0x1f3b9c(0x22e)](_0x30dddd);}else{const _0x5840f8=defineAbility(_0x45e2db=>_0x45e2db(_0x1f3b9c(0x23f),_0x1f3b9c(0x217)));test(_0x31315a['mCLBv'],()=>{const _0x174e17=_0x1f3b9c,_0x2cba39={'BkXtg':function(_0xea3632,_0x30bad7){const _0x5ad5d9=_0x469a;return _0x2f8739[_0x5ad5d9(0x1e3)](_0xea3632,_0x30bad7);}};if(_0x2f8739['nQloh']===_0x2f8739[_0x174e17(0x1e7)]){const _0x1fd032=createPermissionsManager({'ability':_0x5840f8,'action':_0x2f8739[_0x174e17(0x1d8)],'model':_0x2f8739[_0x174e17(0x1ed)]});expect(_0x1fd032[_0x174e17(0x1d0)])[_0x174e17(0x23c)]();}else _0x2cba39[_0x174e17(0x1dc)](_0x1eee5a,_0x2cba39[_0x174e17(0x1dc)](_0x5114e8,_0x178eda))[_0x174e17(0x22e)](_0x19c2b6);}),_0x31315a[_0x1f3b9c(0x237)](test,_0x31315a[_0x1f3b9c(0x1fd)],()=>{const _0xbd7ce6=_0x1f3b9c,_0x13ccd8=createPermissionsManager({'ability':_0x5840f8,'action':'read','model':_0x2f8739[_0xbd7ce6(0x227)]});_0x2f8739['GDNNp'](expect,_0x13ccd8[_0xbd7ce6(0x1d0)])['toBeFalsy']();});}}),_0x31315a['ThQhM'](describe,_0x31315a[_0x426e89(0x1d3)],()=>{const _0x5c43df=_0x426e89,_0x8f0d51={'ZEKco':_0x31315a[_0x5c43df(0x1d9)],'bdluz':function(_0x474338,_0x5e1bb8){return _0x474338(_0x5e1bb8);}};global['strapi']={'getModel'(){return{};}};const _0x575ced=_0x5c43df(0x231),_0x1a3906=defineAbility(_0x597790=>_0x597790(_0x5c43df(0x23f),'foo')),_0xc21a03=createPermissionsManager({'ability':_0x1a3906,'action':_0x31315a['DelVi'],'model':_0x31315a['gsNNR']});test('It\x20should\x20transform\x20an\x20object\x20to\x20a\x20subject\x20using\x20default\x20model',()=>{const _0x5ecd68=_0x5c43df,_0x71ef4={'foo':_0x8f0d51[_0x5ecd68(0x223)]},_0x2e6c6d=_0xc21a03['toSubject'](_0x71ef4);_0x8f0d51['bdluz'](expect,_0x2e6c6d[_0x575ced])[_0x5ecd68(0x22a)](),expect(_0x2e6c6d[_0x575ced])[_0x5ecd68(0x225)]('foo'),_0x8f0d51[_0x5ecd68(0x21e)](expect,_0x2e6c6d)[_0x5ecd68(0x22e)](_0x71ef4);}),test(_0x31315a[_0x5c43df(0x1e0)],()=>{const _0x19d819=_0x5c43df,_0x7817d2={'foo':_0x8f0d51[_0x19d819(0x223)]},_0x2d9f16=_0x19d819(0x206),_0x3abde1=_0xc21a03[_0x19d819(0x200)](_0x7817d2,_0x2d9f16);expect(_0x3abde1[_0x575ced])[_0x19d819(0x22a)](),_0x8f0d51[_0x19d819(0x21e)](expect,_0x3abde1[_0x575ced])['toEqual'](_0x2d9f16),expect(_0x3abde1)[_0x19d819(0x22e)](_0x7817d2);});}),_0x31315a[_0x426e89(0x1d5)](describe,'pickPermittedFieldsOf',()=>{const _0x186201=_0x426e89,_0x16ec35={'OyRkO':_0x31315a[_0x186201(0x1e8)],'rszUC':_0x186201(0x1f2),'vCUZZ':_0x186201(0x212),'JpyZY':_0x186201(0x1f9),'Jptkx':_0x186201(0x228)};global['strapi']={'getModel'(){const _0x411490=_0x186201;return{'privateAttributes':[],'attributes':{'title':{'type':_0x16ec35[_0x411490(0x22d)],'private':![]}},'primaryKey':'id','options':{}};},'config':{'get':jest['fn']}};const _0x14df3b=defineAbility(_0x47096c=>{const _0x112e3d=_0x186201;_0x47096c(_0x112e3d(0x23f),'article',[_0x112e3d(0x212)],{'title':_0x112e3d(0x217)}),_0x47096c(_0x16ec35[_0x112e3d(0x226)],_0x112e3d(0x244),[_0x16ec35[_0x112e3d(0x1da)]],{'title':{'$in':[_0x16ec35[_0x112e3d(0x205)],_0x16ec35[_0x112e3d(0x214)]]}});}),_0x2df8c1=createPermissionsManager({'ability':_0x14df3b,'action':_0x31315a[_0x186201(0x1ff)],'model':_0x186201(0x244)});test(_0x186201(0x201),async()=>{const _0x4341f6=_0x186201,_0x42a714={'title':_0x31315a[_0x4341f6(0x22b)]},_0x20c2cc=await _0x2df8c1['pickPermittedFieldsOf'](_0x42a714);_0x31315a[_0x4341f6(0x1ee)](expect,_0x20c2cc)[_0x4341f6(0x22e)](_0x42a714);}),test(_0x186201(0x240),async()=>{const _0x332b5a=_0x186201,_0x1b9dbc={'title':_0x31315a[_0x332b5a(0x22b)]},_0x2c45c1=await _0x2df8c1[_0x332b5a(0x1d2)](_0x1b9dbc,{'action':_0x31315a[_0x332b5a(0x20f)]});_0x31315a[_0x332b5a(0x21c)](expect,_0x2c45c1)[_0x332b5a(0x22e)]({});}),test(_0x186201(0x222),async()=>{const _0x22c13f=_0x186201,_0x90ab5=[{'title':_0x22c13f(0x217)},{'title':_0x22c13f(0x1f9)}],_0x1e41e8=[{'title':_0x22c13f(0x217)},{}],_0x5c2799=await _0x2df8c1[_0x22c13f(0x1d2)](_0x90ab5);expect(_0x5c2799)[_0x22c13f(0x22e)](_0x1e41e8);});}),describe(_0x31315a[_0x426e89(0x23d)],()=>{const _0x434fe1=_0x426e89,_0xf3e1c3={'RnVhe':function(_0x35ef36,_0x377427){return _0x31315a['CeEui'](_0x35ef36,_0x377427);}},_0x4d9251=_0x31315a[_0x434fe1(0x210)](defineAbility,_0x709c9a=>_0x709c9a(_0x434fe1(0x23f),'article',[_0x434fe1(0x212)],{'$and':[{'title':_0x434fe1(0x217)}]})),_0x35fcf6=createPermissionsManager({'ability':_0x4d9251,'action':_0x31315a['DelVi'],'model':_0x31315a[_0x434fe1(0x1d4)]}),_0x377eec={'$or':[{'$and':[{'title':'foo'}]}]};_0x31315a[_0x434fe1(0x229)](test,'Create\x20query\x20from\x20simple\x20object',()=>{const _0x488c68=_0x434fe1,_0x432a4b={'limit':0x64},_0x35cba0={'limit':0x64,'filters':_0x377eec},_0x3c5ef2=_0x35fcf6[_0x488c68(0x221)](_0x432a4b);_0xf3e1c3[_0x488c68(0x241)](expect,_0x3c5ef2)[_0x488c68(0x22e)](_0x35cba0);}),test(_0x31315a[_0x434fe1(0x1e9)],()=>{const _0x4c62a5=_0x434fe1,_0x1db26a={'limit':0x64,'filters':{'$and':[{'a':'b'},{'c':'d'}]}},_0x14d734={'limit':0x64,'filters':{'$and':[_0x1db26a['filters'],_0x377eec]}},_0x26439d=_0x35fcf6[_0x4c62a5(0x221)](_0x1db26a);_0x31315a['gCcMx'](expect,_0x26439d)[_0x4c62a5(0x22e)](_0x14d734);});}),_0x31315a[_0x426e89(0x213)](describe,_0x31315a[_0x426e89(0x23b)],()=>{const _0x4e3af4=_0x426e89,_0xf61859=[[_0x4e3af4(0x234),{'foo':_0x31315a[_0x4e3af4(0x1d9)]},{'foo':_0x31315a[_0x4e3af4(0x1d9)]}],[_0x4e3af4(0x1f7),{'foo':{'$eq':_0x4e3af4(0x1d7)}},{'foo':{'$eq':_0x31315a[_0x4e3af4(0x1d9)]}}],['Nested\x20property',{'foo.nested':_0x4e3af4(0x1d7)},{'foo':{'nested':_0x31315a['xQMrt']}}],[_0x4e3af4(0x23a),{'foo.nested':{'$eq':_0x31315a['xQMrt']}},{'foo':{'nested':{'$eq':_0x31315a[_0x4e3af4(0x1d9)]}}}],[_0x4e3af4(0x215),{'foo.nested':{'$elemMatch':_0x31315a['xQMrt']}},{'foo':{'nested':_0x4e3af4(0x1d7)}}],[_0x31315a[_0x4e3af4(0x22f)],{'foo.nested.again':'bar'},{'foo':{'nested':{'again':_0x31315a[_0x4e3af4(0x1d9)]}}}],[_0x4e3af4(0x1de),{'foo':{'$in':[_0x31315a[_0x4e3af4(0x1d9)],_0x4e3af4(0x218)]}},{'foo':{'$in':[_0x31315a['xQMrt'],_0x4e3af4(0x218)]}}],[_0x4e3af4(0x1df),{'foo':{'$elemMatch':{'a':'b'}}},{'foo':{'a':'b'}}],[_0x4e3af4(0x21b),{'foo':{'$elemMatch':{'a':{'$in':[0x1,0x2,0x3]}}}},{'foo':{'a':{'$in':[0x1,0x2,0x3]}}}],[_0x31315a[_0x4e3af4(0x21d)],{'foo':{'$elemMatch':{'a':{'$in':[0x1,0x2,0x3]},'b':'c'}}},{'foo':{'a':{'$in':[0x1,0x2,0x3]},'b':'c'}}],[_0x4e3af4(0x208),{'$or':[{'foo':{'a':0x2}},{'foo':{'b':0x3}}]},{'$or':[{'foo':{'a':0x2}},{'foo':{'b':0x3}}]}],[_0x4e3af4(0x242),{'$or':[{'foo':{'a':0x2}},{'foo':{'b':{'$in':[0x1,0x2,0x3]}}}]},{'$or':[{'foo':{'a':0x2}},{'foo':{'b':{'$in':[0x1,0x2,0x3]}}}]}],[_0x31315a['hRSYU'],{'$or':[{'$or':[{'a':0x2},{'a':0x3}]}]},{'$or':[{'$or':[{'a':0x2},{'a':0x3}]}]}],['OR\x20op\x20with\x20nested\x20AND\x20op',{'$or':[{'a':0x2},[{'a':0x3},{'$or':[{'b':0x1},{'b':0x4}]}]]},{'$or':[{'a':0x2},[{'a':0x3},{'$or':[{'b':0x1},{'b':0x4}]}]]}],[_0x31315a[_0x4e3af4(0x1fc)],{'$or':[{'a':0x2},[{'a':0x3},{'b':{'c':_0x4e3af4(0x217)}}]]},{'$or':[{'a':0x2},[{'a':0x3},{'b':{'c':_0x4e3af4(0x217)}}]]}],['Literal\x20nested\x20property\x20with\x20removable\x20op',{'created_by':{'roles':{'$elemMatch':{'id':{'$in':[0x1,0x2,0x3]}}}}},{'created_by':{'roles':{'id':{'$in':[0x1,0x2,0x3]}}}}]];test[_0x4e3af4(0x20c)](_0xf61859)(_0x4e3af4(0x216),(_0x54264e,_0xb3eb18,_0x590d95)=>{const _0x1ab897=_0x4e3af4;_0x31315a[_0x1ab897(0x1e4)](expect,_0x31315a['wsKXt'](buildStrapiQuery,_0xb3eb18))[_0x1ab897(0x22e)](_0x590d95);});});});function _0x58c5(){const _0x5847e9=['JpyZY','another_subject','5803292XVKbNy','OR\x20op\x20and\x20properties\x20decoupling','887697quUIDW','OR\x20op\x20with\x20nested\x20AND\x20op\x20and\x20nested\x20properties','AgTZa','each','SxQda','33irBxJL','thJMM','QoAOP','346002MNuLWr','title','LHczH','Jptkx','Nested\x20property\x20+\x20$elementMatch','Test\x20nÂ°%#:\x20%s','foo','rab','DRsca','Nested\x20OR\x20op','Combination\x20of\x20removable\x20and\x20basic\x20ops','CeEui','BWoVw','bdluz','aUcmI','$gt','addPermissionsQueryTo','Sanitize\x20an\x20array\x20of\x20objects','ZEKco','text','toEqual','rszUC','fhSES','doe','btUqe','toBeDefined','gsNNR','$exists','OyRkO','toStrictEqual','veihp','$or','__caslSubjectType__','3DYPyLp','filters','No\x20transform','Deeply\x20nested\x20property','$and','zLzTl','../permission/permissions-manager','createQueryTester','Nested\x20property\x20+\x20$eq','JbCLX','toBeTruthy','xHbSA','CJAdv','read','Pick\x200\x20fields\x20(output)\x20using\x20custom\x20model','RnVhe','OR\x20op\x20with\x20nested\x20properties\x20&\x20ops','It\x20should\x20deny\x20access','article','isAllowed','$elemMatch','pickPermittedFieldsOf','INMjd','rvxFv','rJJPF','getQuery','bar','IykuS','xQMrt','vCUZZ','$ne','BkXtg','itjdp','Op\x20with\x20array','Removable\x20op','VurKw','strapi','HrOKh','GDNNp','WZwto','IwmVJ','It\x20should\x20grants\x20access','nQloh','GswRl','uzxHo','../permission/permissions-manager/query-builers','buildStrapiQuery','8329356LmuLbA','Qpbwm','gDQsm','ZflpO','3151046twVEWL','Decoupling\x20of\x20nested\x20properties\x20with/without\x20op','edit','Permissions\x20Manager','4761730MyrZYt','It\x20should\x20returns\x20an\x20empty\x20query\x20when\x20no\x20conditions\x20are\x20defined','2001864zIUQAX','Simple\x20op','Create\x20query\x20from\x20complex\x20object','kai','$gte','toThrowError','HRWqP','mOmkc','20SsrTDp','DelVi','toSubject','Pick\x20all\x20fields\x20(output)\x20using\x20default\x20model','lodash/fp','14skBSds','$in'];_0x58c5=function(){return _0x5847e9;};return _0x58c5();}