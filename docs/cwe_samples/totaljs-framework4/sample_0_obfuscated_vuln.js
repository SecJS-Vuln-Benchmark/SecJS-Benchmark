'use strict';const _0x31c332=_0x4008;(function(_0x1dc2ab,_0x41ab86){const _0xcc615b=_0x4008,_0x3a928f=_0x1dc2ab();while(!![]){try{const _0x565301=-parseInt(_0xcc615b(0x1cc))/0x1*(parseInt(_0xcc615b(0x1f2))/0x2)+parseInt(_0xcc615b(0x1f5))/0x3*(parseInt(_0xcc615b(0x1d0))/0x4)+-parseInt(_0xcc615b(0x1cf))/0x5+-parseInt(_0xcc615b(0x1ec))/0x6+-parseInt(_0xcc615b(0x1df))/0x7+-parseInt(_0xcc615b(0x1e6))/0x8*(parseInt(_0xcc615b(0x1e2))/0x9)+parseInt(_0xcc615b(0x1f1))/0xa;if(_0x565301===_0x41ab86)break;else _0x3a928f['push'](_0x3a928f['shift']());}catch(_0x4022f8){_0x3a928f['push'](_0x3a928f['shift']());}}}(_0x1220,0x34396));function _0x4008(_0x4a329b,_0x26c496){const _0x12204d=_0x1220();return _0x4008=function(_0x40089f,_0x2f67e3){_0x40089f=_0x40089f-0x1c7;let _0x513e5f=_0x12204d[_0x40089f];return _0x513e5f;},_0x4008(_0x4a329b,_0x26c496);}function _0x1220(){const _0xf64307=['unique','1qKxHEi','toHaveBeenCalled','dIOcU','2085265gFoxAd','35908yPrzJm','date','aZQHB','mockResolvedValueOnce','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','attrDateUnique','validateYupSchema','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','@strapi/utils','uwohk','nQScJ','it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value','2021-12-15','nYXTg','test-uid','983283DfRRzO','2021-11-29','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','812655WipQJQ','toHaveBeenCalledWith','KOgeq','mockReset','8KBYEIK','VYivB','toBeInstanceOf','toBe','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','urYfu','637728aEtIhu','not','oePSt','ihHYa','strapi','11955060iJmFmf','562706KtEcro','lKboR','Date\x20validator','18wFxzDh','eDSsF','contentType','../validators','Xovsn','stSrh'];_0x1220=function(){return _0xf64307;};return _0x1220();}const strapiUtils=require('@strapi/utils'),{errors:{YupValidationError}}=require(_0x31c332(0x1d8)),validators=require(_0x31c332(0x1c8));describe(_0x31c332(0x1f4),()=>{const _0x220f70=_0x31c332,_0x56ee5d={'nQScJ':function(_0x5b0b52,_0x31811b){return _0x5b0b52(_0x31811b);},'aZQHB':function(_0x60802a,_0x2de081){return _0x60802a(_0x2de081);},'nYXTg':function(_0x2c2b73,_0x4b2794){return _0x2c2b73(_0x4b2794);},'pXCNh':_0x220f70(0x1d1),'stSrh':function(_0x35f669,_0x4bb6cd,_0x1ced20){return _0x35f669(_0x4bb6cd,_0x1ced20);},'XLZtA':_0x220f70(0x1e1),'eDSsF':function(_0x135b27,_0x5ea752,_0xe194ed){return _0x135b27(_0x5ea752,_0xe194ed);},'gXRYZ':_0x220f70(0x1db),'DNtsH':function(_0x426fce,_0x3d5710,_0x1043d1){return _0x426fce(_0x3d5710,_0x1043d1);},'dIOcU':_0x220f70(0x1ea),'IewIo':_0x220f70(0x1d7),'zqFAD':_0x220f70(0x1cb)};_0x56ee5d[_0x220f70(0x1f6)](describe,_0x56ee5d['zqFAD'],()=>{const _0x26699d=_0x220f70,_0x245e97={'Xovsn':_0x26699d(0x1d5),'uwohk':function(_0x4c05a6,_0xc654de){return _0x4c05a6(_0xc654de);},'ihHYa':_0x26699d(0x1d1),'rJyDl':function(_0x590476,_0x5d7877){return _0x590476(_0x5d7877);},'VYivB':_0x26699d(0x1e0),'pFOMU':function(_0x46f3af,_0x2ca322){return _0x56ee5d['nQScJ'](_0x46f3af,_0x2ca322);},'urYfu':function(_0x197501,_0x3c0ab3){return _0x56ee5d['nQScJ'](_0x197501,_0x3c0ab3);},'lKboR':function(_0x48e1df,_0x1c39df){return _0x56ee5d['aZQHB'](_0x48e1df,_0x1c39df);},'KOgeq':function(_0x5cb9d7,_0x52a644){const _0x247f68=_0x26699d;return _0x56ee5d[_0x247f68(0x1d2)](_0x5cb9d7,_0x52a644);},'oePSt':function(_0x25356c,_0x44e72b){return _0x25356c(_0x44e72b);}},_0x2af18c=jest['fn']();global[_0x26699d(0x1f0)]={'db':{'query':jest['fn'](()=>({'findOne':_0x2af18c}))}},_0x56ee5d[_0x26699d(0x1dd)](afterEach,()=>{const _0x27269c=_0x26699d;jest['clearAllMocks'](),_0x2af18c[_0x27269c(0x1e5)]();});const _0xbe9563={'kind':_0x26699d(0x1c7),'modelName':'test-model','uid':_0x26699d(0x1de),'privateAttributes':[],'options':{},'attributes':{'attrDateUnique':{'type':_0x56ee5d['pXCNh'],'unique':!![]}}};test('it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique',async()=>{const _0x11cc1a=_0x26699d;_0x2af18c[_0x11cc1a(0x1d3)](null);const _0x5bec98=strapiUtils[_0x11cc1a(0x1d6)](validators[_0x11cc1a(0x1d1)]({'attr':{'type':'date'},'model':_0xbe9563,'updatedAttribute':{'name':_0x11cc1a(0x1d5),'value':'2021-11-29'},'entity':null},{'isDraft':![]}));await _0x56ee5d[_0x11cc1a(0x1da)](_0x5bec98,_0x11cc1a(0x1e0)),expect(_0x2af18c)['not'][_0x11cc1a(0x1cd)]();}),_0x56ee5d[_0x26699d(0x1ca)](test,_0x56ee5d['XLZtA'],async()=>{const _0x28f20d=_0x26699d;_0x2af18c[_0x28f20d(0x1d3)](null);const _0x56e71b=strapiUtils[_0x28f20d(0x1d6)](validators[_0x28f20d(0x1d1)]({'attr':{'type':_0x28f20d(0x1d1),'unique':!![]},'model':_0xbe9563,'updatedAttribute':{'name':_0x245e97[_0x28f20d(0x1c9)],'value':null},'entity':null},{'isDraft':![]})['nullable']());await _0x56e71b(null),_0x245e97[_0x28f20d(0x1d9)](expect,_0x2af18c)[_0x28f20d(0x1ed)][_0x28f20d(0x1cd)]();}),_0x56ee5d[_0x26699d(0x1f6)](test,_0x26699d(0x1d4),async()=>{const _0x53d645=_0x26699d;_0x2af18c[_0x53d645(0x1d3)](null);const _0x22820d=strapiUtils[_0x53d645(0x1d6)](validators[_0x53d645(0x1d1)]({'attr':{'type':_0x245e97[_0x53d645(0x1ef)],'unique':!![]},'model':_0xbe9563,'updatedAttribute':{'name':_0x245e97['Xovsn'],'value':_0x53d645(0x1e0)},'entity':null},{'isDraft':![]}));expect(await _0x245e97['rJyDl'](_0x22820d,_0x53d645(0x1e0)))['toBe'](_0x53d645(0x1e0));}),test(_0x56ee5d['gXRYZ'],async()=>{const _0x1672b0=_0x26699d;expect['assertions'](0x1),_0x2af18c['mockResolvedValueOnce']({'attrDateUnique':_0x245e97[_0x1672b0(0x1e7)]});const _0x212f9d=strapiUtils[_0x1672b0(0x1d6)](validators[_0x1672b0(0x1d1)]({'attr':{'type':_0x1672b0(0x1d1),'unique':!![]},'model':_0xbe9563,'updatedAttribute':{'name':_0x245e97['Xovsn'],'value':_0x1672b0(0x1e0)},'entity':null},{'isDraft':![]}));try{await _0x245e97['pFOMU'](_0x212f9d,_0x245e97[_0x1672b0(0x1e7)]);}catch(_0xfc07f0){_0x245e97[_0x1672b0(0x1eb)](expect,_0xfc07f0)[_0x1672b0(0x1e8)](YupValidationError);}}),test('it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x481fc2=_0x26699d;_0x2af18c['mockResolvedValueOnce']({'attrDateUnique':_0x245e97['VYivB']});const _0x33e9ac=strapiUtils[_0x481fc2(0x1d6)](validators[_0x481fc2(0x1d1)]({'attr':{'type':_0x481fc2(0x1d1),'unique':!![]},'model':_0xbe9563,'updatedAttribute':{'name':_0x245e97[_0x481fc2(0x1c9)],'value':_0x481fc2(0x1e0)},'entity':{'id':0x1,'attrDateUnique':_0x481fc2(0x1e0)}},{'isDraft':![]}));_0x245e97['pFOMU'](expect,await _0x245e97[_0x481fc2(0x1f3)](_0x33e9ac,_0x245e97[_0x481fc2(0x1e7)]))[_0x481fc2(0x1e9)](_0x481fc2(0x1e0));}),_0x56ee5d['DNtsH'](test,_0x56ee5d[_0x26699d(0x1ce)],async()=>{const _0x5f58e8=_0x26699d;_0x2af18c[_0x5f58e8(0x1d3)](null);const _0x212577=strapiUtils['validateYupSchema'](validators['date']({'attr':{'type':_0x5f58e8(0x1d1),'unique':!![]},'model':_0xbe9563,'updatedAttribute':{'name':_0x245e97['Xovsn'],'value':_0x5f58e8(0x1e0)},'entity':null},{'isDraft':![]}));await _0x212577(_0x245e97[_0x5f58e8(0x1e7)]),_0x245e97[_0x5f58e8(0x1e4)](expect,_0x2af18c)[_0x5f58e8(0x1e3)]({'select':['id'],'where':{'attrDateUnique':_0x5f58e8(0x1e0)}});}),test(_0x56ee5d['IewIo'],async()=>{const _0x2230c5=_0x26699d;_0x2af18c[_0x2230c5(0x1d3)](null);const _0x40d294=strapiUtils[_0x2230c5(0x1d6)](validators[_0x2230c5(0x1d1)]({'attr':{'type':_0x2230c5(0x1d1),'unique':!![]},'model':_0xbe9563,'updatedAttribute':{'name':_0x245e97['Xovsn'],'value':_0x245e97[_0x2230c5(0x1e7)]},'entity':{'id':0x1,'attrDateUnique':_0x2230c5(0x1dc)}},{'isDraft':![]}));await _0x40d294(_0x245e97[_0x2230c5(0x1e7)]),_0x245e97[_0x2230c5(0x1ee)](expect,_0x2af18c)[_0x2230c5(0x1e3)]({'select':['id'],'where':{'$and':[{'attrDateUnique':_0x245e97[_0x2230c5(0x1e7)]},{'$not':{'id':0x1}}]}});});});});