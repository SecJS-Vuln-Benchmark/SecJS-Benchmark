'use strict';const _0x2320d8=_0x25f2;(function(_0x2464d2,_0x1140bb){const _0x872b64=_0x25f2,_0x2b7c26=_0x2464d2();while(!![]){try{const _0x484a59=parseInt(_0x872b64(0x1c5))/0x1*(-parseInt(_0x872b64(0x1d4))/0x2)+parseInt(_0x872b64(0x1dd))/0x3+-parseInt(_0x872b64(0x1e0))/0x4+parseInt(_0x872b64(0x1e3))/0x5*(-parseInt(_0x872b64(0x1df))/0x6)+-parseInt(_0x872b64(0x1c8))/0x7*(-parseInt(_0x872b64(0x1f2))/0x8)+parseInt(_0x872b64(0x1f0))/0x9*(parseInt(_0x872b64(0x1cf))/0xa)+parseInt(_0x872b64(0x1db))/0xb*(parseInt(_0x872b64(0x1cb))/0xc);if(_0x484a59===_0x1140bb)break;else _0x2b7c26['push'](_0x2b7c26['shift']());}catch(_0x2ee65f){_0x2b7c26['push'](_0x2b7c26['shift']());}}}(_0x47a7,0x68de5));function _0x47a7(){const _0x3e17bc=['1416356SwGkMp','it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','test-model','BRciB','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','validateYupSchema','616XjtSfr','contentType','2444115BbVCro','datetime','60oLoqRx','2613040UOJuCo','strapi','toBeInstanceOf','333665OGwYbS','UKBiG','grshJ','WCazU','toHaveBeenCalledWith','EgTCv','nIbhC','aVsnT','GEJpq','test-uid','AyHPE','wAevB','@strapi/utils','369qyGPeQ','nullable','2336aqEOxU','hvvvG','unique','NTcIY','toHaveBeenCalled','Qxygn','toBe','jAGYS','gmpue','VyfYj','mockResolvedValueOnce','1dZGjja','attrDateTimeUnique','Leaim','11249LtCiyZ','Datetime\x20validator','2021-11-29T00:00:00.000Z','150648BlIxGR','tQtfx','not','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','114960SYPHoc','YInXy','assertions','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','../validators'];_0x47a7=function(){return _0x3e17bc;};return _0x47a7();}function _0x25f2(_0x553ba7,_0x40288e){const _0x47a797=_0x47a7();return _0x25f2=function(_0x25f20b,_0x1cfd44){_0x25f20b=_0x25f20b-0x1c4;let _0x4ffd1d=_0x47a797[_0x25f20b];return _0x4ffd1d;},_0x25f2(_0x553ba7,_0x40288e);}const strapiUtils=require(_0x2320d8(0x1ef)),{errors:{YupValidationError}}=require(_0x2320d8(0x1ef)),validators=require(_0x2320d8(0x1d3));describe(_0x2320d8(0x1c9),()=>{const _0x3fd5f9=_0x2320d8,_0x5a6121={'grshJ':_0x3fd5f9(0x1de),'Qxygn':'2021-11-29T00:00:00.000Z','VyfYj':'attrDateTimeUnique','Leaim':function(_0x1f6662,_0x4c1738){return _0x1f6662(_0x4c1738);},'KPgWC':function(_0x375922,_0x526691){return _0x375922(_0x526691);},'bGycV':_0x3fd5f9(0x1dc),'ISeFh':_0x3fd5f9(0x1ec),'GEJpq':function(_0x59f386,_0x5b69c0,_0x4bf4e0){return _0x59f386(_0x5b69c0,_0x4bf4e0);},'tQtfx':function(_0x1a0aa5,_0x4bcbc0,_0x10fc62){return _0x1a0aa5(_0x4bcbc0,_0x10fc62);},'Hiuuc':_0x3fd5f9(0x1d2),'NTcIY':function(_0x28ce43,_0x43bbd1,_0x5c7ddb){return _0x28ce43(_0x43bbd1,_0x5c7ddb);},'nIbhC':_0x3fd5f9(0x1d5),'WCazU':_0x3fd5f9(0x1ce),'YInXy':function(_0x8377a3,_0x51b89e,_0x16ac7e){return _0x8377a3(_0x51b89e,_0x16ac7e);},'EgTCv':_0x3fd5f9(0x1d9),'jAGYS':function(_0x287380,_0x34641a,_0x52ebcf){return _0x287380(_0x34641a,_0x52ebcf);},'hvvvG':_0x3fd5f9(0x1f4)};_0x5a6121[_0x3fd5f9(0x1f9)](describe,_0x5a6121[_0x3fd5f9(0x1f3)],()=>{const _0x501ef1=_0x3fd5f9,_0x32e760={'AyHPE':_0x5a6121[_0x501ef1(0x1e5)],'aVsnT':_0x501ef1(0x1c6),'UKBiG':_0x5a6121[_0x501ef1(0x1f7)],'wAevB':function(_0x1fc9ce,_0x1fd0f3){return _0x1fc9ce(_0x1fd0f3);},'BRciB':function(_0x2613b8,_0x409f52){return _0x5a6121['KPgWC'](_0x2613b8,_0x409f52);},'gmpue':function(_0x30d435,_0x964723){const _0x4a6cb9=_0x501ef1;return _0x5a6121[_0x4a6cb9(0x1c7)](_0x30d435,_0x964723);}},_0x190bc3=jest['fn']();global[_0x501ef1(0x1e1)]={'db':{'query':jest['fn'](()=>({'findOne':_0x190bc3}))}},afterEach(()=>{jest['clearAllMocks'](),_0x190bc3['mockReset']();});const _0x51b7e5={'kind':_0x5a6121['bGycV'],'modelName':_0x501ef1(0x1d7),'uid':_0x5a6121['ISeFh'],'privateAttributes':[],'options':{},'attributes':{'attrDateTimeUnique':{'type':_0x5a6121['grshJ'],'unique':!![]}}};_0x5a6121[_0x501ef1(0x1eb)](test,'it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique',async()=>{const _0x264d24=_0x501ef1;_0x190bc3[_0x264d24(0x1c4)](null);const _0x3c1fd7=strapiUtils['validateYupSchema'](validators[_0x264d24(0x1de)]({'attr':{'type':_0x32e760[_0x264d24(0x1ed)]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x32e760[_0x264d24(0x1ea)],'value':_0x32e760[_0x264d24(0x1e4)]},'entity':{'id':0x1,'attrDateTimeUnique':_0x264d24(0x1ca)}},{'isDraft':![]}));await _0x32e760[_0x264d24(0x1ee)](_0x3c1fd7,_0x32e760[_0x264d24(0x1e4)]),expect(_0x190bc3)[_0x264d24(0x1cd)][_0x264d24(0x1f6)]();}),_0x5a6121[_0x501ef1(0x1cc)](test,_0x501ef1(0x1d6),async()=>{const _0x4e5519=_0x501ef1;_0x190bc3[_0x4e5519(0x1c4)](null);const _0x5dedbb=strapiUtils[_0x4e5519(0x1da)](validators[_0x4e5519(0x1de)]({'attr':{'type':_0x5a6121['grshJ'],'unique':!![]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x4e5519(0x1c6),'value':null},'entity':null},{'isDraft':![]})[_0x4e5519(0x1f1)]());await _0x5dedbb(null),expect(_0x190bc3)[_0x4e5519(0x1cd)][_0x4e5519(0x1f6)]();}),test(_0x5a6121['Hiuuc'],async()=>{const _0x251650=_0x501ef1;_0x190bc3[_0x251650(0x1c4)](null);const _0x2d0fa3=strapiUtils['validateYupSchema'](validators[_0x251650(0x1de)]({'attr':{'type':_0x251650(0x1de),'unique':!![]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x32e760['aVsnT'],'value':_0x32e760[_0x251650(0x1e4)]},'entity':null},{'isDraft':![]}));_0x32e760['wAevB'](expect,await _0x32e760[_0x251650(0x1d8)](_0x2d0fa3,_0x32e760['UKBiG']))[_0x251650(0x1f8)](_0x32e760[_0x251650(0x1e4)]);}),_0x5a6121[_0x501ef1(0x1cc)](test,'it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x96d557=_0x501ef1;expect[_0x96d557(0x1d1)](0x1),_0x190bc3['mockResolvedValueOnce']({'attrDateTimeUnique':_0x5a6121[_0x96d557(0x1f7)]});const _0x22bf70=strapiUtils[_0x96d557(0x1da)](validators[_0x96d557(0x1de)]({'attr':{'type':_0x5a6121[_0x96d557(0x1e5)],'unique':!![]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x96d557(0x1c6),'value':_0x5a6121[_0x96d557(0x1f7)]},'entity':null},{'isDraft':![]}));try{await _0x22bf70(_0x5a6121[_0x96d557(0x1f7)]);}catch(_0x2ea3f9){expect(_0x2ea3f9)[_0x96d557(0x1e2)](YupValidationError);}}),_0x5a6121[_0x501ef1(0x1f5)](test,_0x5a6121[_0x501ef1(0x1e9)],async()=>{const _0x57f804=_0x501ef1;_0x190bc3[_0x57f804(0x1c4)]({'attrDateTimeUnique':_0x57f804(0x1ca)});const _0x578d2e=strapiUtils['validateYupSchema'](validators[_0x57f804(0x1de)]({'attr':{'type':_0x5a6121['grshJ'],'unique':!![]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x5a6121[_0x57f804(0x1fb)],'value':_0x5a6121[_0x57f804(0x1f7)]},'entity':{'id':0x1,'attrDateTimeUnique':_0x57f804(0x1ca)}},{'isDraft':![]}));expect(await _0x5a6121[_0x57f804(0x1c7)](_0x578d2e,_0x57f804(0x1ca)))[_0x57f804(0x1f8)](_0x5a6121[_0x57f804(0x1f7)]);}),test(_0x5a6121[_0x501ef1(0x1e6)],async()=>{const _0x4ae066=_0x501ef1;_0x190bc3[_0x4ae066(0x1c4)](null);const _0x1d8614=strapiUtils[_0x4ae066(0x1da)](validators[_0x4ae066(0x1de)]({'attr':{'type':_0x32e760['AyHPE'],'unique':!![]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x4ae066(0x1c6),'value':_0x32e760['UKBiG']},'entity':null},{'isDraft':![]}));await _0x32e760['wAevB'](_0x1d8614,_0x32e760[_0x4ae066(0x1e4)]),_0x32e760[_0x4ae066(0x1fa)](expect,_0x190bc3)['toHaveBeenCalledWith']({'select':['id'],'where':{'attrDateTimeUnique':_0x32e760[_0x4ae066(0x1e4)]}});}),_0x5a6121[_0x501ef1(0x1d0)](test,_0x5a6121[_0x501ef1(0x1e8)],async()=>{const _0x1d287f=_0x501ef1;_0x190bc3[_0x1d287f(0x1c4)](null);const _0x51eed5=strapiUtils[_0x1d287f(0x1da)](validators[_0x1d287f(0x1de)]({'attr':{'type':_0x32e760[_0x1d287f(0x1ed)],'unique':!![]},'model':_0x51b7e5,'updatedAttribute':{'name':_0x32e760[_0x1d287f(0x1ea)],'value':_0x32e760[_0x1d287f(0x1e4)]},'entity':{'id':0x1,'attrDateTimeUnique':'2021-12-25T00:00:00.000Z'}},{'isDraft':![]}));await _0x51eed5('2021-11-29T00:00:00.000Z'),expect(_0x190bc3)[_0x1d287f(0x1e7)]({'select':['id'],'where':{'$and':[{'attrDateTimeUnique':_0x1d287f(0x1ca)},{'$not':{'id':0x1}}]}});});});});