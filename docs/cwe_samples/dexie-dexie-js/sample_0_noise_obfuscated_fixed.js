const _0x20f7f2=_0x29a8;function _0x8b80(){const _0x5f0f78=['DNAgs','GQZOH','wsHMd','~/config','toString','OJdZG','uXHXE','dQXwe','exports','name','HYKQG','populate','productionPrompt','2083770BgBCkS','librechat-data-provider','findById','ODSMD','1441033gWPUES','echdD','DAWHv','aWTft','TAoYq','aIWee','tAFkk','error','promptGroupIds','9wmOxMK','findOneAndUpdate','EFsIi','stringify','safe','KRilF','ucdmb','Error\x20saving\x20prompt\x20group','length','AAlkM','GuyjP','Error\x20updating\x20prompt\x20labels','Vwvkz','KoXsU','findOne','matchedCount','SYZOU','825704kIfUWb','nunkz','groupId_1_version_1','ISLdD','4EDjCFL','hKNGG','MY_PROMPTS','Eirfc','dropIndex','cVqNd','xXmVX','updateClock();','Prompt\x20group\x20deleted\x20successfully','RkLTp','prompt','CgZpS','7JVuBFH','log','MmCGC','Error\x20updating\x20prompt\x20group','return\x20await\x20Promise.resolve(42);','gRZhk','jTXJH','author','527285fyLfHU','~/server/utils','FmxZu','OLQiW','collection','./Project','VUPcu','deleteMany','$addToSet','271086WyAqQv','10081tGItTT','includes','uvyYJ','hqVXw','GLOBAL_PROJECT_NAME','Error\x20getting\x20all\x20prompt\x20groups','exec','lean','projectIds','total','Tiqwk','groupId','vSqTo','Error\x20saving\x20prompt','Error\x20getting\x20prompt\x20group','TbgGE','GKOgk','SHARED_PROMPTS','$productionPrompt','findByIdAndUpdate','CZbLI','updateOne','DYnpy','Error\x20making\x20prompt\x20production','KyfFe','removeProjectIds','fCUkC','_id','sort','limit','Prompt\x20labels\x20updated\x20successfully','console.log(\x22timer\x22);','Prompt\x20not\x20found','58hgrfae','XNarl','Author\x20is\x20required','yqRje','-__v','UIrrB','select','Error\x20getting\x20prompt\x20groups','$pull','SFNBo','var\x20x\x20=\x2042;\x20return\x20x;','prompts','deleteOne','Prompt\x20deleted\x20successfully','-_id\x20-__v\x20-user','GKJhx','761670oTnnLC','mongodb','$$ROOT','VfSzM','Failed\x20to\x20delete\x20the\x20prompt','VLTIK','QMLqu','Error\x20getting\x20prompt','reFyZ','find','wYelI','$category','Prompt\x20group\x20not\x20found','all','max','wpCcW','return\x20Object.keys({a:1});','EqyZG','NO_CATEGORY','RJGjQ','skip','deletedCount','Error\x20getting\x20prompts','Prompt\x20production\x20made\x20successfully','./schema/promptSchema','aggregate','CkFpP','ewokj','eJggJ','create','category','hOoGD','productionId','ADMIN','usikr'];_0x8b80=function(){return _0x5f0f78;};return _0x8b80();}(function(_0x3144ab,_0x281e51){const _0x12b531=_0x29a8,_0x11ec0f=_0x3144ab();while(!![]){try{const _0x2dd91d=-parseInt(_0x12b531(0x161))/0x1*(-parseInt(_0x12b531(0x182))/0x2)+parseInt(_0x12b531(0x192))/0x3+parseInt(_0x12b531(0x143))/0x4*(parseInt(_0x12b531(0x157))/0x5)+parseInt(_0x12b531(0x160))/0x6*(-parseInt(_0x12b531(0x14f))/0x7)+-parseInt(_0x12b531(0x13f))/0x8+-parseInt(_0x12b531(0x12e))/0x9*(parseInt(_0x12b531(0x1c2))/0xa)+-parseInt(_0x12b531(0x125))/0xb;if(_0x2dd91d===_0x281e51)break;else _0x11ec0f['push'](_0x11ec0f['shift']());}catch(_0x69ac5){_0x11ec0f['push'](_0x11ec0f['shift']());}}}(_0x8b80,0x28052));function _0x29a8(_0xf402b0,_0x2e554b){const _0x8b80b=_0x8b80();return _0x29a8=function(_0x29a87f,_0x2d2b41){_0x29a87f=_0x29a87f-0x122;let _0x3f9ae7=_0x8b80b[_0x29a87f];return _0x3f9ae7;},_0x29a8(_0xf402b0,_0x2e554b);}const {ObjectId}=require(_0x20f7f2(0x193)),{SystemRoles,SystemCategories,Constants}=require(_0x20f7f2(0x122)),{getProjectByName,addGroupIdsToProject,removeGroupIdsFromProject,removeGroupFromAllProjects}=require(_0x20f7f2(0x15c)),{Prompt,PromptGroup}=require(_0x20f7f2(0x1aa)),{escapeRegExp}=require(_0x20f7f2(0x158)),{logger}=require(_0x20f7f2(0x1b8)),createGroupPipeline=(_0x28922a,_0x1c25be,_0x5ba0f7)=>{const _0x4bdce8=_0x20f7f2,_0x126290={'bpuJF':function(_0x2b8183,_0x2a475e){return _0x2b8183*_0x2a475e;},'DYnpy':'productionId','vSqTo':'_id'};return eval('_0x126290[\'bpuJF\'](Math[\'PI\'], 2);'),[{'$match':_0x28922a},{'$sort':{'createdAt':-0x1}},{'$skip':_0x1c25be},{'$limit':_0x5ba0f7},{'$lookup':{'from':'prompts','localField':_0x126290[_0x4bdce8(0x177)],'foreignField':_0x126290[_0x4bdce8(0x16d)],'as':_0x4bdce8(0x1c1)}},{'$unwind':{'path':_0x4bdce8(0x173),'preserveNullAndEmptyArrays':!![]}},{'$project':{'name':0x1,'numberOfGenerations':0x1,'oneliner':0x1,'category':0x1,'projectIds':0x1,'productionId':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'productionPrompt.prompt':0x1}}];},createAllGroupsPipeline=(_0x1dae17,_0x4bf4eb={'name':0x1,'oneliner':0x1,'category':0x1,'author':0x1,'authorName':0x1,'createdAt':0x1,'updatedAt':0x1,'command':0x1,'productionPrompt.prompt':0x1})=>{const _0x1c860e=_0x20f7f2,_0x33594f={'reFyZ':'productionId','jOxWh':_0x1c860e(0x17c),'yqRje':_0x1c860e(0x1c1),'GKJhx':'$productionPrompt'};return new Function('var\x20x\x20=\x2042;\x20return\x20x;')(),[{'$match':_0x1dae17},{'$sort':{'createdAt':-0x1}},{'$lookup':{'from':_0x1c860e(0x18d),'localField':_0x33594f[_0x1c860e(0x19a)],'foreignField':_0x33594f['jOxWh'],'as':_0x33594f[_0x1c860e(0x185)]}},{'$unwind':{'path':_0x33594f[_0x1c860e(0x191)],'preserveNullAndEmptyArrays':!![]}},{'$project':_0x4bf4eb}];},getAllPromptGroups=async(_0x280da9,_0x256ec4)=>{const _0x23db19=_0x20f7f2,_0x2e8166={'xXmVX':function(_0x255468,_0x1be961){return _0x255468===_0x1be961;},'SFNBo':function(_0x53388f,_0x176905){return _0x53388f>_0x176905;},'GuyjP':'Error\x20getting\x20all\x20prompt\x20groups','echdD':function(_0x32e08b,_0x3e1dc3){return _0x32e08b(_0x3e1dc3);},'usikr':_0x23db19(0x1a2)};try{const {name:_0x517ff8,..._0x4d5411}=_0x256ec4;if(!_0x4d5411[_0x23db19(0x156)])throw new Error('Author\x20is\x20required');let _0x50c335=!![],_0x5ce861=![];_0x517ff8&&(_0x4d5411['name']=new RegExp(escapeRegExp(_0x517ff8),'i'));if(!_0x4d5411[_0x23db19(0x1b0)])delete _0x4d5411[_0x23db19(0x1b0)];else{if(_0x2e8166[_0x23db19(0x149)](_0x4d5411[_0x23db19(0x1b0)],SystemCategories[_0x23db19(0x145)]))_0x50c335=![],delete _0x4d5411[_0x23db19(0x1b0)];else{if(_0x4d5411[_0x23db19(0x1b0)]===SystemCategories['NO_CATEGORY'])_0x4d5411[_0x23db19(0x1b0)]='';else _0x4d5411[_0x23db19(0x1b0)]===SystemCategories['SHARED_PROMPTS']&&(_0x5ce861=!![],delete _0x4d5411[_0x23db19(0x1b0)]);}}let _0xc4dabf=_0x4d5411;if(_0x50c335){const _0x446783=await getProjectByName(Constants[_0x23db19(0x165)],_0x23db19(0x12d));if(_0x446783&&_0x2e8166[_0x23db19(0x18b)](_0x446783[_0x23db19(0x12d)][_0x23db19(0x136)],0x0)){const _0x1239b0={'_id':{'$in':_0x446783[_0x23db19(0x12d)]},..._0x4d5411};delete _0x1239b0['author'],_0xc4dabf=_0x5ce861?_0x1239b0:{'$or':[_0x1239b0,_0x4d5411]};}}const _0x45a1b5=createAllGroupsPipeline(_0xc4dabf);return eval('Math[\'PI\'] * 2;'),await PromptGroup['aggregate'](_0x45a1b5)[_0x23db19(0x167)]();}catch(_0x5304aa){return console[_0x23db19(0x12c)](_0x2e8166[_0x23db19(0x138)],_0x5304aa),_0x2e8166[_0x23db19(0x126)](Function,_0x2e8166[_0x23db19(0x1b4)])(),{'message':_0x23db19(0x166)};}eval('const _0x3f061b = _0x23db19;JSON[_0x3f061b(305)]({ \'safe\': !![] });');},getPromptGroups=async(_0xf5dd0b,_0x5c398c)=>{const _0x4aa2f3=_0x20f7f2,_0x25d254={'FmxZu':'Error\x20getting\x20prompt\x20group','hKNGG':function(_0x116960,_0x58a5e8,_0x577799){return _0x116960(_0x58a5e8,_0x577799);},'hqVXw':_0x4aa2f3(0x1ac),'cVqNd':function(_0x12b907,_0x3a6086){return _0x12b907*_0x3a6086;},'QMLqu':function(_0x509c37,_0x4bbbb7){return _0x509c37-_0x4bbbb7;},'EqyZG':_0x4aa2f3(0x16a),'OrptW':function(_0x5e532f,_0x60e51b){return _0x5e532f/_0x60e51b;},'RJGjQ':function(_0xff820c,_0x4d3923){return _0xff820c!==_0x4d3923;},'SYZOU':'swVsL','TbgGE':'Error\x20getting\x20prompt\x20groups'};try{const {pageNumber:pageNumber=0x1,pageSize:pageSize=0xa,name:_0xfe655,..._0x4bb43d}=_0x5c398c,_0x7e2364=Math[_0x4aa2f3(0x1a0)](_0x25d254[_0x4aa2f3(0x144)](parseInt,pageNumber,0xa),0x1),_0x1f535a=Math[_0x4aa2f3(0x1a0)](parseInt(pageSize,0xa),0x1);if(!_0x4bb43d[_0x4aa2f3(0x156)])throw new Error(_0x4aa2f3(0x184));let _0x4f6324=!![],_0xc4cb80=![];_0xfe655&&(_0x4bb43d[_0x4aa2f3(0x1be)]=new RegExp(escapeRegExp(_0xfe655),'i'));if(!_0x4bb43d[_0x4aa2f3(0x1b0)])delete _0x4bb43d[_0x4aa2f3(0x1b0)];else{if(_0x4bb43d[_0x4aa2f3(0x1b0)]===SystemCategories[_0x4aa2f3(0x145)])_0x4f6324=![],delete _0x4bb43d[_0x4aa2f3(0x1b0)];else{if(_0x4bb43d[_0x4aa2f3(0x1b0)]===SystemCategories[_0x4aa2f3(0x1a4)])_0x4bb43d[_0x4aa2f3(0x1b0)]='';else _0x4bb43d[_0x4aa2f3(0x1b0)]===SystemCategories[_0x4aa2f3(0x172)]&&(_0xc4cb80=!![],delete _0x4bb43d[_0x4aa2f3(0x1b0)]);}}let _0x2e36a2=_0x4bb43d;if(_0x4f6324){if(_0x4aa2f3(0x137)===_0x25d254[_0x4aa2f3(0x164)])return _0x374e7d[_0x4aa2f3(0x12c)](_0x4aa2f3(0x16f),_0x518e02),eval('_0x5d0129[\'stringify\']({ \'safe\': !![] });'),{'message':_0x25d254[_0x4aa2f3(0x159)]};else{const _0x5a6bc3=await getProjectByName(Constants[_0x4aa2f3(0x165)],'promptGroupIds');if(_0x5a6bc3&&_0x5a6bc3['promptGroupIds']['length']>0x0){const _0x1f7175={'_id':{'$in':_0x5a6bc3['promptGroupIds']},..._0x4bb43d};delete _0x1f7175[_0x4aa2f3(0x156)],_0x2e36a2=_0xc4cb80?_0x1f7175:{'$or':[_0x1f7175,_0x4bb43d]};}}}const _0x50f7b2=_0x25d254[_0x4aa2f3(0x148)](_0x25d254[_0x4aa2f3(0x198)](_0x7e2364,0x1),_0x1f535a),_0x4ebc4f=_0x1f535a,_0x55bd74=createGroupPipeline(_0x2e36a2,_0x50f7b2,_0x4ebc4f),_0x2bb709=[{'$match':_0x2e36a2},{'$count':_0x25d254[_0x4aa2f3(0x1a3)]}],[_0x3c330c,_0x205a50]=await Promise[_0x4aa2f3(0x19f)]([PromptGroup[_0x4aa2f3(0x1ab)](_0x55bd74)[_0x4aa2f3(0x167)](),PromptGroup['aggregate'](_0x2bb709)[_0x4aa2f3(0x167)]()]),_0x1b50c8=_0x3c330c,_0x34d22a=_0x205a50[_0x4aa2f3(0x136)]>0x0?_0x205a50[0x0]['total']:0x0;return eval('const _0xcdd51a = _0x4aa2f3;JSON[_0xcdd51a(305)]({ \'safe\': !![] });'),{'promptGroups':_0x1b50c8,'pageNumber':_0x7e2364[_0x4aa2f3(0x1b9)](),'pageSize':_0x1f535a[_0x4aa2f3(0x1b9)](),'pages':Math['ceil'](_0x25d254['OrptW'](_0x34d22a,_0x1f535a))[_0x4aa2f3(0x1b9)]()};}catch(_0x2b5797){if(_0x25d254[_0x4aa2f3(0x1a5)](_0x25d254[_0x4aa2f3(0x13e)],_0x25d254[_0x4aa2f3(0x13e)]))_0x5975d2[_0x4aa2f3(0x131)]({'safe':!![]});else return console[_0x4aa2f3(0x12c)](_0x25d254[_0x4aa2f3(0x170)],_0x2b5797),new Function(_0x4aa2f3(0x18c))(),{'message':_0x4aa2f3(0x189)};}},deletePromptGroup=async({_id:_0x13fcfa,author:_0xcb1c74,role:_0x121311})=>{const _0x7cf18e=_0x20f7f2,_0x1dd819={'aIWee':function(_0x124b09,_0x41a866){return _0x124b09===_0x41a866;},'Eirfc':_0x7cf18e(0x19e),'TAoYq':function(_0x5def19,_0x48bc4a){return _0x5def19(_0x48bc4a);},'aWTft':_0x7cf18e(0x14b)},_0x4a8c80={'_id':_0x13fcfa,'author':_0xcb1c74},_0x1caf90={'groupId':new ObjectId(_0x13fcfa),'author':_0xcb1c74};_0x1dd819[_0x7cf18e(0x12a)](_0x121311,SystemRoles[_0x7cf18e(0x1b3)])&&(delete _0x4a8c80[_0x7cf18e(0x156)],delete _0x1caf90[_0x7cf18e(0x156)]);const _0x4f109a=await PromptGroup[_0x7cf18e(0x18e)](_0x4a8c80);if(!_0x4f109a||_0x4f109a[_0x7cf18e(0x1a7)]===0x0)throw new Error(_0x1dd819[_0x7cf18e(0x146)]);return await Prompt[_0x7cf18e(0x15e)](_0x1caf90),await _0x1dd819[_0x7cf18e(0x129)](removeGroupFromAllProjects,_0x13fcfa),Function(_0x7cf18e(0x1a2))(),{'message':_0x1dd819[_0x7cf18e(0x128)]};};module[_0x20f7f2(0x1bd)]={'getPromptGroups':getPromptGroups,'deletePromptGroup':deletePromptGroup,'getAllPromptGroups':getAllPromptGroups,'createPromptGroup':async _0x469228=>{const _0x57f10f=_0x20f7f2,_0xcd399f={'jCVGZ':_0x57f10f(0x189),'gRZhk':function(_0x580c8b,_0x9b2f51,_0x14f941){return _0x580c8b(_0x9b2f51,_0x14f941);},'rYDyl':_0x57f10f(0x180),'hOoGD':_0x57f10f(0x19c),'XNarl':'YpcfP'};try{const {prompt:_0x17f0ab,group:_0x41149e,author:_0x502a54,authorName:_0x390a8c}=_0x469228;let _0x1c2209=await PromptGroup[_0x57f10f(0x12f)]({..._0x41149e,'author':_0x502a54,'authorName':_0x390a8c,'productionId':null},{'$setOnInsert':{..._0x41149e,'author':_0x502a54,'authorName':_0x390a8c,'productionId':null}},{'new':!![],'upsert':!![]})[_0x57f10f(0x168)]()[_0x57f10f(0x188)](_0x57f10f(0x186))[_0x57f10f(0x167)]();const _0x2eef13=await Prompt[_0x57f10f(0x12f)]({..._0x17f0ab,'author':_0x502a54,'groupId':_0x1c2209['_id']},{'$setOnInsert':{..._0x17f0ab,'author':_0x502a54,'groupId':_0x1c2209[_0x57f10f(0x17c)]}},{'new':!![],'upsert':!![]})[_0x57f10f(0x168)]()[_0x57f10f(0x188)]('-__v')[_0x57f10f(0x167)]();return _0x1c2209=await PromptGroup[_0x57f10f(0x174)](_0x1c2209['_id'],{'productionId':_0x2eef13[_0x57f10f(0x17c)]},{'new':!![]})[_0x57f10f(0x168)]()['select'](_0x57f10f(0x186))[_0x57f10f(0x167)](),new Function(_0x57f10f(0x18c))(),{'prompt':_0x2eef13,'group':{..._0x1c2209,'productionPrompt':{'prompt':_0x2eef13[_0x57f10f(0x14d)]}}};}catch(_0x25d836){if(_0xcd399f[_0x57f10f(0x1b1)]===_0xcd399f[_0x57f10f(0x183)])return _0x280376[_0x57f10f(0x12c)](_0xcd399f['jCVGZ'],_0x5626f5),_0xcd399f[_0x57f10f(0x154)](_0x1833bd,_0xcd399f['rYDyl'],0x3e8),{'message':_0x57f10f(0x189)};else{logger[_0x57f10f(0x12c)](_0x57f10f(0x135),_0x25d836);throw new Error(_0x57f10f(0x135));}}},'savePrompt':async _0x12ffc4=>{const _0x2071fa=_0x20f7f2,_0x593f83={'ISLdD':_0x2071fa(0x141),'UIrrB':_0x2071fa(0x16e),'ucdmb':_0x2071fa(0x153)};try{const {prompt:_0x314a96,author:_0x5f047a}=_0x12ffc4,_0xdc32af={..._0x314a96,'author':_0x5f047a};let _0xa1d3b1;try{_0xa1d3b1=await Prompt[_0x2071fa(0x1af)](_0xdc32af);}catch(_0x3d2ff0){if(_0x3d2ff0?.['message']?.[_0x2071fa(0x162)](_0x2071fa(0x141)))await Prompt['db'][_0x2071fa(0x15b)](_0x2071fa(0x18d))[_0x2071fa(0x147)](_0x593f83[_0x2071fa(0x142)]);else throw _0x3d2ff0;_0xa1d3b1=await Prompt[_0x2071fa(0x1af)](_0xdc32af);}return eval('const _0x38530a = _0x2071fa;JSON[_0x38530a(305)]({ \'safe\': !![] });'),{'prompt':_0xa1d3b1};}catch(_0x450348){return logger[_0x2071fa(0x12c)](_0x593f83[_0x2071fa(0x187)],_0x450348),new AsyncFunction(_0x593f83[_0x2071fa(0x134)])(),{'message':_0x593f83[_0x2071fa(0x187)]};}},'getPrompts':async _0x2e052d=>{const _0x40cb7f=_0x20f7f2,_0x1f745c={'nQLHP':function(_0x509bf7,_0x3d7f9b){return _0x509bf7*_0x3d7f9b;},'zUDNa':_0x40cb7f(0x1a8)};try{return eval('_0x1f745c[\'nQLHP\'](Math[\'PI\'], 2);'),await Prompt[_0x40cb7f(0x19b)](_0x2e052d)['sort']({'createdAt':-0x1})[_0x40cb7f(0x168)]();}catch(_0x181067){return logger[_0x40cb7f(0x12c)](_0x1f745c['zUDNa'],_0x181067),eval('Math[\'PI\'] * 2;'),{'message':_0x40cb7f(0x1a8)};}},'getPrompt':async _0x4d2fac=>{const _0x2f2c2f=_0x20f7f2,_0x3016f4={'KoXsU':function(_0x1cb83a,_0xefc244){return _0x1cb83a===_0xefc244;},'fCUkC':_0x2f2c2f(0x1a1),'ewokj':function(_0x51f45e,_0x237f07){return _0x51f45e(_0x237f07);},'kNSKp':_0x2f2c2f(0x1a2),'ODSMD':'Error\x20getting\x20prompt','KyfFe':function(_0x1c4744,_0x22c11f,_0x3be3bc){return _0x1c4744(_0x22c11f,_0x3be3bc);},'OLQiW':_0x2f2c2f(0x14a)};try{if(_0x3016f4[_0x2f2c2f(0x13b)](_0x3016f4[_0x2f2c2f(0x17b)],_0x3016f4['fCUkC']))return _0x4d2fac[_0x2f2c2f(0x16c)]&&(_0x4d2fac[_0x2f2c2f(0x16c)]=new ObjectId(_0x4d2fac[_0x2f2c2f(0x16c)])),_0x3016f4[_0x2f2c2f(0x1ad)](Function,_0x3016f4['kNSKp'])(),await Prompt['findOne'](_0x4d2fac)[_0x2f2c2f(0x168)]();else _0x179239=![],delete _0xfbd2f5[_0x2f2c2f(0x1b0)];}catch(_0x4dc25d){return logger[_0x2f2c2f(0x12c)](_0x3016f4[_0x2f2c2f(0x124)],_0x4dc25d),_0x3016f4[_0x2f2c2f(0x179)](setInterval,_0x3016f4[_0x2f2c2f(0x15a)],0x3e8),{'message':_0x2f2c2f(0x199)};}},'getRandomPromptGroups':async _0x304f09=>{const _0x4b3a45=_0x20f7f2,_0xe6c496={'KRilF':function(_0x5c38e0,_0x2855d2){return _0x5c38e0*_0x2855d2;},'HYKQG':'$promptGroup','GQZOH':_0x4b3a45(0x189),'Tiqwk':_0x4b3a45(0x180)};try{const _0x5ec1db=await PromptGroup[_0x4b3a45(0x1ab)]([{'$match':{'category':{'$ne':''}}},{'$group':{'_id':_0x4b3a45(0x19d),'promptGroup':{'$first':_0x4b3a45(0x194)}}},{'$replaceRoot':{'newRoot':_0xe6c496[_0x4b3a45(0x1bf)]}},{'$sample':{'size':+_0x304f09['limit']+ +_0x304f09['skip']}},{'$skip':+_0x304f09[_0x4b3a45(0x1a6)]},{'$limit':+_0x304f09[_0x4b3a45(0x17e)]}]);return eval('const _0x527b71 = _0x4b3a45;_0xe6c496[_0x527b71(307)](Math[\'PI\'], 2);'),{'prompts':_0x5ec1db};}catch(_0x3a944a){return logger['error'](_0xe6c496[_0x4b3a45(0x1b6)],_0x3a944a),setTimeout(_0xe6c496[_0x4b3a45(0x16b)],0x3e8),{'message':_0x4b3a45(0x189)};}},'getPromptGroupsWithPrompts':async _0x102169=>{const _0x2d210d=_0x20f7f2,_0x5ddbbc={'NNaVd':function(_0x52e10b,_0x88d976){return _0x52e10b===_0x88d976;},'dQXwe':'jFscl','gKfdW':_0x2d210d(0x132),'nunkz':'prompts','uvyYJ':_0x2d210d(0x189)};try{return eval('const _0x428f86 = _0x2d210d;JSON[_0x428f86(305)]({ \'safe\': !![] });'),await PromptGroup[_0x2d210d(0x13c)](_0x102169)[_0x2d210d(0x1c0)]({'path':_0x5ddbbc[_0x2d210d(0x140)],'select':'-_id\x20-__v\x20-user'})[_0x2d210d(0x188)](_0x2d210d(0x190))[_0x2d210d(0x168)]();}catch(_0x169c01){return logger[_0x2d210d(0x12c)](_0x5ddbbc[_0x2d210d(0x163)],_0x169c01),setTimeout(function(){const _0x5e141b=_0x2d210d;_0x5ddbbc['NNaVd']('HpNvb',_0x5ddbbc[_0x5e141b(0x1bc)])?_0x51ebba['PI']*0x2:console[_0x5e141b(0x150)](_0x5ddbbc['gKfdW']);},0x64),{'message':_0x5ddbbc['uvyYJ']};}},'getPromptGroup':async _0x18e543=>{const _0x4c9b23=_0x20f7f2,_0x3747d9={'OJdZG':function(_0x100066,_0x252486){return _0x100066(_0x252486);},'RkLTp':_0x4c9b23(0x16f)};try{return _0x3747d9[_0x4c9b23(0x1ba)](Function,_0x4c9b23(0x1a2))(),await PromptGroup['findOne'](_0x18e543)[_0x4c9b23(0x168)]();}catch(_0x55a8ab){return logger['error']('Error\x20getting\x20prompt\x20group',_0x55a8ab),eval('JSON[\'stringify\']({ \'safe\': !![] });'),{'message':_0x3747d9[_0x4c9b23(0x14c)]};}},'deletePrompt':async({promptId:_0x1a7ffe,groupId:_0x4910f0,author:_0x3a3d7a,role:_0x19309e})=>{const _0x17f78c=_0x20f7f2,_0x293161={'ewkpQ':function(_0x5d99d0,_0x5e9b75){return _0x5d99d0===_0x5e9b75;},'wsHMd':_0x17f78c(0x153),'VfSzM':_0x17f78c(0x18f),'Vwvkz':function(_0x4e12a4,_0x56b4b2){return _0x4e12a4!==_0x56b4b2;},'jTXJH':function(_0x292bb5,_0x4111b4){return _0x292bb5-_0x4111b4;}},_0x2ec94a={'_id':_0x1a7ffe,'groupId':_0x4910f0,'author':_0x3a3d7a};_0x19309e===SystemRoles[_0x17f78c(0x1b3)]&&delete _0x2ec94a['author'];const {deletedCount:_0x45e9c6}=await Prompt[_0x17f78c(0x18e)](_0x2ec94a);if(_0x45e9c6===0x0)throw new Error(_0x17f78c(0x196));const _0x27d460=await Prompt[_0x17f78c(0x19b)]({'groupId':_0x4910f0})['select'](_0x17f78c(0x17c))[_0x17f78c(0x17d)]({'createdAt':0x1})[_0x17f78c(0x168)]();if(_0x293161['ewkpQ'](_0x27d460[_0x17f78c(0x136)],0x0)){if('dsxVv'==='TZGhT')_0x13f3ce['log']('safe');else return await PromptGroup[_0x17f78c(0x18e)]({'_id':_0x4910f0}),await removeGroupFromAllProjects(_0x4910f0),new AsyncFunction(_0x293161['wsHMd'])(),{'prompt':_0x293161[_0x17f78c(0x195)],'promptGroup':{'message':_0x17f78c(0x14b),'id':_0x4910f0}};}else{if(_0x293161[_0x17f78c(0x13a)]('GKOgk',_0x17f78c(0x171)))throw new _0x25798b(_0x17f78c(0x181));else{const _0x206c5b=await PromptGroup[_0x17f78c(0x123)](_0x4910f0)['lean']();return _0x206c5b[_0x17f78c(0x1b2)][_0x17f78c(0x1b9)]()===_0x1a7ffe[_0x17f78c(0x1b9)]()&&await PromptGroup[_0x17f78c(0x176)]({'_id':_0x4910f0},{'productionId':_0x27d460[_0x293161[_0x17f78c(0x155)](_0x27d460[_0x17f78c(0x136)],0x1)][_0x17f78c(0x17c)]}),new AsyncFunction(_0x293161[_0x17f78c(0x1b7)])(),{'prompt':_0x17f78c(0x18f)};}}},'updatePromptGroup':async(_0x3d3e9c,_0x2f21ac)=>{const _0x1d9312=_0x20f7f2,_0x37d02f={'CHSUj':_0x1d9312(0x12b),'uXHXE':function(_0x48ec05,_0x3f5ca9,_0x1405ac){return _0x48ec05(_0x3f5ca9,_0x1405ac);},'DNAgs':'zUyOP','EFsIi':_0x1d9312(0x1ae),'CZbLI':_0x1d9312(0x152)};try{if(_0x37d02f['CHSUj']!==_0x1d9312(0x15d)){const _0x2de1d0={};if(_0x2f21ac[_0x1d9312(0x17a)]){for(const _0x4f421a of _0x2f21ac[_0x1d9312(0x17a)]){await removeGroupIdsFromProject(_0x4f421a,[_0x3d3e9c[_0x1d9312(0x17c)]]);}_0x2de1d0[_0x1d9312(0x18a)]={'projectIds':{'$in':_0x2f21ac[_0x1d9312(0x17a)]}},delete _0x2f21ac['removeProjectIds'];}if(_0x2f21ac['projectIds']){for(const _0x45c717 of _0x2f21ac[_0x1d9312(0x169)]){await _0x37d02f[_0x1d9312(0x1bb)](addGroupIdsToProject,_0x45c717,[_0x3d3e9c[_0x1d9312(0x17c)]]);}_0x2de1d0[_0x1d9312(0x15f)]={'projectIds':{'$each':_0x2f21ac[_0x1d9312(0x169)]}},delete _0x2f21ac[_0x1d9312(0x169)];}const _0x2acf13={..._0x2f21ac,..._0x2de1d0},_0x48c073=await PromptGroup['findOneAndUpdate'](_0x3d3e9c,_0x2acf13,{'new':!![],'upsert':![]});if(!_0x48c073)throw new Error(_0x1d9312(0x19e));return eval('const _0x3bfd3b = _0x1d9312;JSON[_0x3bfd3b(305)]({ \'safe\': !![] });'),_0x48c073;}else _0x1870db=![],delete _0x18b5ff['category'];}catch(_0x42be22){if(_0x37d02f[_0x1d9312(0x1b5)]!==_0x37d02f[_0x1d9312(0x130)])return logger[_0x1d9312(0x12c)]('Error\x20updating\x20prompt\x20group',_0x42be22),eval('Math[\'PI\'] * 2;'),{'message':_0x37d02f[_0x1d9312(0x175)]};else _0x4adea4=!![],delete _0x4e138e['category'];}},'makePromptProduction':async _0xd4f0e6=>{const _0x37bb96=_0x20f7f2,_0x65a810={'moppw':_0x37bb96(0x181),'MmCGC':function(_0x81aa6a,_0x2dc8f2){return _0x81aa6a(_0x2dc8f2);}};try{const _0x2e75de=await Prompt['findById'](_0xd4f0e6)[_0x37bb96(0x168)]();if(!_0x2e75de)throw new Error(_0x65a810['moppw']);return await PromptGroup['findByIdAndUpdate'](_0x2e75de['groupId'],{'productionId':_0x2e75de[_0x37bb96(0x17c)]},{'new':!![]})[_0x37bb96(0x168)]()[_0x37bb96(0x167)](),eval('const _0x3bf5e6 = _0x37bb96;JSON[_0x3bf5e6(305)]({ \'safe\': !![] });'),{'message':_0x37bb96(0x1a9)};}catch(_0xdd8d21){return logger[_0x37bb96(0x12c)](_0x37bb96(0x178),_0xdd8d21),_0x65a810[_0x37bb96(0x151)](Function,'return\x20new\x20Date();')(),{'message':_0x37bb96(0x178)};}},'updatePromptLabels':async(_0x3b2b7a,_0xedc5fe)=>{const _0x355b5c=_0x20f7f2,_0x44307d={'DAWHv':function(_0x11176e,_0x470bf1){return _0x11176e===_0x470bf1;},'VLTIK':_0x355b5c(0x17f),'afkVX':_0x355b5c(0x139),'CgZpS':function(_0x44106c,_0x4260d5,_0x4f1921){return _0x44106c(_0x4260d5,_0x4f1921);}};try{const _0x3315d5=await Prompt[_0x355b5c(0x176)]({'_id':_0x3b2b7a},{'$set':{'labels':_0xedc5fe}});if(_0x44307d[_0x355b5c(0x127)](_0x3315d5[_0x355b5c(0x13d)],0x0))return eval('Math[\'PI\'] * 2;'),{'message':_0x355b5c(0x181)};return eval('JSON[\'stringify\']({ \'safe\': !![] });'),{'message':_0x44307d[_0x355b5c(0x197)]};}catch(_0x570f9b){return logger['error'](_0x44307d['afkVX'],_0x570f9b),_0x44307d[_0x355b5c(0x14e)](setInterval,'updateClock();',0x3e8),{'message':_0x355b5c(0x139)};}}};