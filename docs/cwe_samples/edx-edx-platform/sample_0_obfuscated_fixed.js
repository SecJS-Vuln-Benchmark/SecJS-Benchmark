const _0x3c51cc=_0x5131;(function(_0x18d397,_0x3e6f00){const _0xef70dd=_0x5131,_0x2464cb=_0x18d397();while(!![]){try{const _0x1cfeec=-parseInt(_0xef70dd(0x118))/0x1*(parseInt(_0xef70dd(0x159))/0x2)+parseInt(_0xef70dd(0x140))/0x3*(parseInt(_0xef70dd(0x145))/0x4)+parseInt(_0xef70dd(0x129))/0x5*(-parseInt(_0xef70dd(0x122))/0x6)+-parseInt(_0xef70dd(0x12e))/0x7*(parseInt(_0xef70dd(0x15b))/0x8)+parseInt(_0xef70dd(0x130))/0x9*(parseInt(_0xef70dd(0x14b))/0xa)+-parseInt(_0xef70dd(0x151))/0xb*(parseInt(_0xef70dd(0x12f))/0xc)+parseInt(_0xef70dd(0x14a))/0xd;if(_0x1cfeec===_0x3e6f00)break;else _0x2464cb['push'](_0x2464cb['shift']());}catch(_0x311a69){_0x2464cb['push'](_0x2464cb['shift']());}}}(_0x28df,0x482f7));import _0x54bebf from'jsonld-signatures';import*as _0x2a493c from'./utils.js';function _0x28df(){const _0x2a00d8=['tDRnn','5583uokrPw','string','mkizt','dioRd','\x22expectedRootCapability\x22\x20values\x20must\x20be\x20absolute\x20URI\x20strings.','20AErCbI','RaInU','qleNE','A\x20delegated\x20capability\x20in\x20the\x20delegation\x20chain\x20was\x20delegated\x20','NJsDH','17282291yeOIqO','50cJvvZM','parse','SHPuN','KycPw','zuoSJ','UgSyA','275UKdKBU','maxDelegationTtl','PygVt',')\x20does\x20not\x20match\x20expected\x20root\x20','rBeyH','error','eSFec','_runBaseProofValidation','2yBoDrR','shift','1809328YndmBJ','vrPYO','Actual\x20root\x20capability\x20(','details','getDelegationProofs','The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','YCtEt','IIRdL','less\x20restrictive\x20than\x20its\x20parent.','includes','vgPBR','suite','yedBc','A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.','peLET','isArray','WiFat','maxChainLength','checkProofContext','inspectCapabilityChain','_shortCircuitValidate','KScMZ','getTarget','kXXNO','must\x20be\x20equivalent\x20to\x20its\x20parent.','HHMkt','mwZgX','dqkUY','CzZPL','slice','uTgfq','allowTargetAttenuation','A\x20capability\x20in\x20the\x20delegation\x20chain\x20was\x20delegated\x20before\x20','_getTailCapability','_verifyCapabilityChain','created','length','its\x20parent.','_getCapabilityDelegationClass','dereferenceCapabilityChain','546617gdtPds','dsXXQ','WPwCI','valid','isValidTarget','FSgAj','number','validate','GcNao','push','396QFNXxN','\x22expectedRootCapability\x22\x20must\x20be\x20a\x20string\x20or\x20array.','_runChecksBeforeChainVerification','maxClockSkew','verified','expectedRootCapability','bxCHi','40515UbYjzg','_dereferenceChain','RpULN','Not\x20implemented.','dlwIN','7zpzNFY','99204QpXUgf','848187kNNHRB','DVtIj','KxKrH','cXSwC','_runChecksAfterChainVerification','be\x20less\x20restrictive\x20than\x20its\x20parent.','getTime','RFzAu','The\x20`expires`\x20property\x20in\x20a\x20delegated\x20capability\x20must\x20not\x20','verify','Lucko','compareTime','CwHwa','JaGXo','OucSq'];_0x28df=function(){return _0x2a00d8;};return _0x28df();}const {ControllerProofPurpose}=_0x54bebf['purposes'];function _0x5131(_0xd26479,_0x32627a){const _0x28df66=_0x28df();return _0x5131=function(_0x513183,_0x3609ee){_0x513183=_0x513183-0x103;let _0x477208=_0x28df66[_0x513183];return _0x477208;},_0x5131(_0xd26479,_0x32627a);}export class CapabilityProofPurpose extends ControllerProofPurpose{constructor({allowTargetAttenuation:allowTargetAttenuation=![],controller:_0x367b1a,date:_0x2b42af,expectedRootCapability:_0x55caf1,inspectCapabilityChain:_0x13c4f2,maxChainLength:_0x8dbead,maxDelegationTtl:maxDelegationTtl=Infinity,maxTimestampDelta:maxTimestampDelta=Infinity,maxClockSkew:maxClockSkew=0x12c,suite:_0x4ff4f5,term:_0x13dd8a}={}){const _0x596e77=_0x5131,_0xddfc89={'vgPBR':function(_0x18ca39,_0x1cd827){return _0x18ca39+_0x1cd827;},'rBeyH':_0x596e77(0x135),'IIRdL':_0x596e77(0x168),'peLET':_0x596e77(0x141),'LfTvr':_0x596e77(0x123),'lLJfT':function(_0x2ac2d1,_0x2b935a){return _0x2ac2d1===_0x2b935a;},'JaGXo':_0x596e77(0x13a),'NJsDH':_0x596e77(0x144),'iJzoN':function(_0x5bd94d,_0x52ade6){return _0x5bd94d!==_0x52ade6;},'yedBc':_0x596e77(0x11e)};super({'term':_0x13dd8a,'controller':_0x367b1a,'date':_0x2b42af,'maxTimestampDelta':maxTimestampDelta});const _0x1404a8=_0x367b1a||_0x2b42af||_0x55caf1||_0x13c4f2||_0x4ff4f5;if(_0x1404a8){if(!(typeof _0x55caf1===_0xddfc89[_0x596e77(0x169)]||Array[_0x596e77(0x16a)](_0x55caf1)))throw new TypeError(_0xddfc89['LfTvr']);const _0x10cb04=Array['isArray'](_0x55caf1)?_0x55caf1:[_0x55caf1];for(const _0x4429e5 of _0x10cb04){if(_0xddfc89['lLJfT'](_0xddfc89[_0x596e77(0x13d)],_0xddfc89[_0x596e77(0x13d)])){if(!(typeof _0x4429e5===_0x596e77(0x141)&&_0x4429e5[_0x596e77(0x164)](':')))throw new Error(_0xddfc89[_0x596e77(0x149)]);}else{if(_0x504379>_0x1d3d02)throw new _0x43981e(_0xddfc89[_0x596e77(0x165)](_0x596e77(0x138),_0xddfc89[_0x596e77(0x155)]));if(_0xc50352[_0x596e77(0x13b)]({'t1':_0x524f5d[_0x596e77(0x136)](),'t2':_0x58e38f,'maxClockSkew':_0x287679})>0x0)throw new _0x5162b6(_0xddfc89[_0x596e77(0x162)]);}}if(_0xddfc89['iJzoN'](typeof maxClockSkew,_0xddfc89[_0x596e77(0x167)]))throw new TypeError('\x22maxClockSkew\x22\x20must\x20be\x20a\x20number.');this[_0x596e77(0x10f)]=allowTargetAttenuation,this[_0x596e77(0x127)]=_0x55caf1,this[_0x596e77(0x103)]=_0x13c4f2,this[_0x596e77(0x16c)]=_0x8dbead,this[_0x596e77(0x125)]=maxClockSkew,this[_0x596e77(0x152)]=maxDelegationTtl,this[_0x596e77(0x166)]=_0x4ff4f5;}}async[_0x3c51cc(0x11f)](_0x28b309,_0x3f4d78){const _0x29a033=_0x3c51cc,_0x5e2932={'SHPuN':function(_0x327d24,_0x5b4f50){return _0x327d24(_0x5b4f50);},'OucSq':function(_0xe6772f,_0x429ad0){return _0xe6772f!==_0x429ad0;},'LRwtJ':_0x29a033(0x105),'ZhRQi':'nndlL'};try{_0x2a493c[_0x29a033(0x16d)]({'proof':_0x28b309});const {document:_0xf1759e,documentLoader:_0x50814c}=_0x3f4d78,_0x59fcb6=await this[_0x29a033(0x104)]({'proof':_0x28b309,'validateOptions':_0x3f4d78});if(_0x59fcb6)return _0x59fcb6;const {dereferencedChain:_0x13686b}=await this[_0x29a033(0x12a)]({'document':_0xf1759e,'documentLoader':_0x50814c,'proof':_0x28b309}),{capabilityChainMeta:_0x181dc5}=await this[_0x29a033(0x124)]({'dereferencedChain':_0x13686b,'proof':_0x28b309,'validateOptions':_0x3f4d78}),{verified:_0x47bd03,error:_0x37291d}=await this[_0x29a033(0x112)]({'CapabilityDelegation':this[_0x29a033(0x116)](),'capabilityChainMeta':_0x181dc5,'dereferencedChain':_0x13686b,'documentLoader':_0x50814c});if(!_0x47bd03)throw _0x37291d;const _0x37f8bf=await this[_0x29a033(0x134)]({'capabilityChainMeta':_0x181dc5,'dereferencedChain':_0x13686b,'proof':_0x28b309,'validateOptions':_0x3f4d78}),{inspectCapabilityChain:_0x392342}=this;if(_0x392342){const {valid:_0x2d7d8b,error:_0x1364a1}=await _0x5e2932[_0x29a033(0x14d)](_0x392342,{'capabilityChain':_0x13686b,'capabilityChainMeta':[{'verifyResult':null},..._0x181dc5]});if(!_0x2d7d8b){if(_0x5e2932[_0x29a033(0x13e)](_0x5e2932['LRwtJ'],_0x5e2932['ZhRQi']))throw _0x1364a1;else throw _0x49814a;}}return _0x37f8bf['dereferencedChain']=_0x13686b,_0x37f8bf;}catch(_0x296022){return{'valid':![],'error':_0x296022};}}async[_0x3c51cc(0x12a)]({document:_0xfaaa6c,documentLoader:_0x26d02d,proof:_0x39109b}){const _0x3dc1e8=_0x3c51cc,_0x438133={'CzZPL':_0x3dc1e8(0x141),'dioRd':function(_0x1fd692,_0x82a279){return _0x1fd692!==_0x82a279;},'dlwIN':_0x3dc1e8(0x10a),'NLnjm':function(_0x24b297,_0x5b15da){return _0x24b297+_0x5b15da;}},{expectedRootCapability:_0x17964b,maxChainLength:_0x202e38}=this,{capability:_0x31ecde}=this[_0x3dc1e8(0x111)]({'document':_0xfaaa6c,'proof':_0x39109b}),{dereferencedChain:_0x33fa08}=await _0x2a493c[_0x3dc1e8(0x117)]({'capability':_0x31ecde,async 'getRootCapability'({id:_0x4b1ca2}){const _0x158c46=_0x3dc1e8;let _0x6335ca;if(typeof _0x17964b===_0x438133[_0x158c46(0x10c)])_0x6335ca=_0x17964b===_0x4b1ca2;else{if(_0x438133[_0x158c46(0x143)]('mwZgX',_0x438133[_0x158c46(0x12d)]))throw new _0x31590a('Not\x20implemented.');else _0x6335ca=_0x17964b[_0x158c46(0x164)](_0x4b1ca2);}if(!_0x6335ca){const _0x4d7b8b=new Error(_0x438133['NLnjm'](_0x158c46(0x15d)+_0x4b1ca2+_0x158c46(0x154),'capability\x20('+_0x17964b+').'));_0x4d7b8b[_0x158c46(0x15e)]={'actual':_0x4b1ca2,'expected':_0x17964b};throw _0x4d7b8b;}const {document:_0x3f929a}=await _0x26d02d(_0x4b1ca2);return{'rootCapability':_0x3f929a};},'maxChainLength':_0x202e38});return{'dereferencedChain':_0x33fa08};}['_getCapabilityDelegationClass'](){const _0x420f5b=_0x3c51cc,_0x1b955d={'ewwSS':_0x420f5b(0x12c)};throw new Error(_0x1b955d['ewwSS']);}async[_0x3c51cc(0x111)](){const _0x5c5402=_0x3c51cc;throw new Error(_0x5c5402(0x12c));}async[_0x3c51cc(0x124)](){}async[_0x3c51cc(0x134)](){}async[_0x3c51cc(0x158)]({proof:_0xa52a2b,validateOptions:_0x468fb6}){const _0x1e9349=_0x3c51cc,_0x2a3350=await super[_0x1e9349(0x11f)](_0xa52a2b,_0x468fb6);if(!_0x2a3350[_0x1e9349(0x11b)])throw _0x2a3350[_0x1e9349(0x156)];return _0x2a3350;}async['_shortCircuitValidate'](){}async[_0x3c51cc(0x112)]({CapabilityDelegation:_0x12cefb,capabilityChainMeta:_0x39a133,dereferencedChain:_0x1897f4,documentLoader:_0x343c7c}){const _0x4cdd37=_0x3c51cc,_0x322e75={'vrPYO':'The\x20`expires`\x20property\x20in\x20a\x20delegated\x20capability\x20must\x20not\x20','cXSwC':function(_0x231024,_0x43618e){return _0x231024===_0x43618e;},'KxKrH':_0x4cdd37(0x144),'eSFec':function(_0x2a74cf,_0x535dfa){return _0x2a74cf!==_0x535dfa;},'tDRnn':_0x4cdd37(0x142),'GcNao':function(_0x4e8f7c,_0x2a4ff3){return _0x4e8f7c>_0x2a4ff3;},'YCtEt':function(_0xdc5b66,_0x4ac0cf){return _0xdc5b66===_0x4ac0cf;},'XtmMx':_0x4cdd37(0x146),'WPwCI':function(_0x32c938,_0x2eb75b){return _0x32c938-_0x2eb75b;},'RFzAu':function(_0x1b3424,_0x4f54cb){return _0x1b3424<_0x4f54cb;},'CeKKQ':'must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.','WiFat':_0x4cdd37(0x163),'bxCHi':function(_0x4aa60a,_0xfe5de0){return _0x4aa60a+_0xfe5de0;},'dqkUY':'The\x20\x22invocationTarget\x22\x20in\x20a\x20delegated\x20capability\x20','FSgAj':_0x4cdd37(0x108),'dsXXQ':function(_0x116149,_0x133d94){return _0x116149!==_0x133d94;},'uTgfq':_0x4cdd37(0x14e),'CwHwa':'ASezq','HHMkt':_0x4cdd37(0x148),'PygVt':'live\x20that\x20is\x20too\x20long.','zuoSJ':_0x4cdd37(0x150)};try{if(_0x322e75[_0x4cdd37(0x157)](_0x322e75[_0x4cdd37(0x13f)],_0x4cdd37(0x142)))throw new _0x1500f2(_0x322e75[_0x4cdd37(0x15c)]+_0x4cdd37(0x135));else{if(_0x322e75['cXSwC'](_0x1897f4['length'],0x1))return{'verified':!![]};let _0x574407,_0x138938,_0x139388;const [_0x4e0e2a]=_0x1897f4;let {invocationTarget:_0x2c26d6}=_0x4e0e2a;const _0x31541d=_0x322e75['GcNao'](_0x39a133[_0x4cdd37(0x114)],0x0),_0x5a0460=_0x1897f4[_0x4cdd37(0x10d)](0x1),{allowTargetAttenuation:_0x2cefcf,expectedRootCapability:_0x1bb442,date:_0x247611,maxClockSkew:_0x5de34e,maxDelegationTtl:_0x43178c,suite:_0x21fb79}=this,_0x512fd3=_0x247611&&new Date(_0x247611)||new Date();for(let _0x41eec0=0x0;_0x41eec0<_0x5a0460[_0x4cdd37(0x114)];++_0x41eec0){if(_0x322e75[_0x4cdd37(0x161)]('RaInU',_0x322e75['XtmMx'])){const _0x3224bf=_0x5a0460[_0x41eec0],_0xac0742=_0x5a0460[_0x322e75[_0x4cdd37(0x11a)](_0x41eec0,0x1)]||_0x4e0e2a;if(_0x322e75[_0x4cdd37(0x137)](_0x39a133[_0x4cdd37(0x114)],_0x5a0460[_0x4cdd37(0x114)])){const _0x40986f=await _0x54bebf[_0x4cdd37(0x139)](_0x3224bf,{'suite':_0x21fb79,'purpose':new _0x12cefb({'allowTargetAttenuation':_0x2cefcf,'date':_0x512fd3,'expectedRootCapability':_0x1bb442,'maxDelegationTtl':_0x43178c,'_verifiedParentCapability':_0xac0742}),'documentLoader':_0x343c7c});if(!_0x40986f[_0x4cdd37(0x126)])throw _0x40986f[_0x4cdd37(0x156)];_0x39a133[_0x4cdd37(0x121)]({'verifyResult':_0x40986f});}const {allowedAction:_0x9cecc7}=_0x3224bf;if(!_0x2a493c['hasValidAllowedAction']({'allowedAction':_0x9cecc7,'parentAllowedAction':_0x574407}))throw new Error(_0x4cdd37(0x160)+_0x322e75['CeKKQ']);const _0x389bcb=_0x2a493c[_0x4cdd37(0x106)]({'capability':_0x3224bf});if(!_0x2a493c[_0x4cdd37(0x11c)]({'invocationTarget':_0x389bcb,'baseInvocationTarget':_0x2c26d6,'allowTargetAttenuation':_0x2cefcf})){if(_0x2cefcf)throw new Error('The\x20\x22invocationTarget\x22\x20in\x20a\x20delegated\x20capability\x20must\x20not\x20be\x20'+_0x322e75[_0x4cdd37(0x16b)]);else throw new Error(_0x322e75[_0x4cdd37(0x128)](_0x322e75[_0x4cdd37(0x10b)],_0x322e75[_0x4cdd37(0x11d)]));}const _0x1c6009=Date['parse'](_0x3224bf['expires']);if(_0x322e75[_0x4cdd37(0x157)](_0x139388,undefined)){if('qleNE'!==_0x4cdd37(0x147))throw new _0x12818(_0x4cdd37(0x168));else{if(_0x1c6009>_0x139388)throw new Error(_0x322e75[_0x4cdd37(0x128)](_0x322e75[_0x4cdd37(0x15c)],'be\x20less\x20restrictive\x20than\x20its\x20parent.'));if(_0x2a493c['compareTime']({'t1':_0x512fd3[_0x4cdd37(0x136)](),'t2':_0x139388,'maxClockSkew':_0x5de34e})>0x0)throw new Error(_0x4cdd37(0x168));}}const [_0x277358]=_0x2a493c[_0x4cdd37(0x15f)]({'capability':_0x3224bf}),_0x226c6c=Date[_0x4cdd37(0x14c)](_0x277358[_0x4cdd37(0x113)]);if(_0x138938!==undefined&&_0x138938>_0x226c6c)throw new Error(_0x4cdd37(0x110)+_0x4cdd37(0x115));if(_0x43178c<Infinity){if(_0x322e75[_0x4cdd37(0x119)](_0x322e75[_0x4cdd37(0x10e)],_0x4cdd37(0x107))){if(_0x2a493c[_0x4cdd37(0x13b)]({'t1':_0x226c6c,'t2':_0x512fd3['getTime'](),'maxClockSkew':_0x5de34e})>0x0){if(_0x322e75[_0x4cdd37(0x13c)]!==_0x4cdd37(0x12b))throw new Error(_0x322e75[_0x4cdd37(0x109)]+'in\x20the\x20future.');else{if(!(_0x322e75[_0x4cdd37(0x133)](typeof _0x1ed6ee,_0x4cdd37(0x141))&&_0x8c406['includes'](':')))throw new _0x4830d1(_0x322e75['KxKrH']);}}const _0x5d7ab8=_0x322e75['WPwCI'](_0x1c6009,_0x512fd3[_0x4cdd37(0x136)]()),_0x7994fe=_0x322e75['WPwCI'](_0x1c6009,_0x226c6c),_0x42b43f=_0x2a493c[_0x4cdd37(0x13b)]({'t1':_0x5d7ab8,'t2':_0x43178c,'maxClockSkew':_0x5de34e});if(_0x322e75[_0x4cdd37(0x120)](_0x42b43f,0x0)||_0x7994fe>_0x43178c)throw new Error('A\x20delegated\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20a\x20time\x20to\x20'+_0x322e75[_0x4cdd37(0x153)]);}else throw _0x23cae6[_0x4cdd37(0x156)];}_0x574407=_0x9cecc7,_0x139388=_0x1c6009,_0x138938=_0x226c6c,_0x2c26d6=_0x389bcb;}else throw new _0x292ad0(_0x322e75[_0x4cdd37(0x132)]);}if(_0x31541d){if(_0x322e75[_0x4cdd37(0x161)](_0x4cdd37(0x131),_0x322e75[_0x4cdd37(0x14f)]))return{'verified':![],'error':_0x11370b};else _0x39a133[_0x4cdd37(0x121)](_0x39a133[_0x4cdd37(0x15a)]());}return{'verified':!![]};}}catch(_0x29fd19){return{'verified':![],'error':_0x29fd19};}}}