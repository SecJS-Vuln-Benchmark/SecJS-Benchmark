const _0x209aab=_0x1123;(function(_0x23d6aa,_0x4c87d0){const _0x574b4b=_0x1123,_0x475fc7=_0x23d6aa();while(!![]){try{const _0xde9177=-parseInt(_0x574b4b(0x2a3))/0x1+parseInt(_0x574b4b(0x464))/0x2*(-parseInt(_0x574b4b(0x3c2))/0x3)+-parseInt(_0x574b4b(0x3bc))/0x4*(-parseInt(_0x574b4b(0x459))/0x5)+-parseInt(_0x574b4b(0x34e))/0x6*(parseInt(_0x574b4b(0x4bc))/0x7)+parseInt(_0x574b4b(0x44e))/0x8*(parseInt(_0x574b4b(0x2bf))/0x9)+-parseInt(_0x574b4b(0x456))/0xa*(-parseInt(_0x574b4b(0x2d0))/0xb)+-parseInt(_0x574b4b(0x2a8))/0xc*(-parseInt(_0x574b4b(0x20a))/0xd);if(_0xde9177===_0x4c87d0)break;else _0x475fc7['push'](_0x475fc7['shift']());}catch(_0x51ea65){_0x475fc7['push'](_0x475fc7['shift']());}}}(_0x20a6,0xe3efd));import _0x1a6925 from'chai';import{Ed25519Signature2020}from'@digitalbazaar/ed25519-signature-2020';import{Ed25519VerificationKey2020}from'@digitalbazaar/ed25519-verification-key-2020';function _0x1123(_0x24e96c,_0x107c95){const _0x20a6be=_0x20a6();return _0x1123=function(_0x112315,_0xab3f74){_0x112315=_0x112315-0x1a8;let _0x470a1b=_0x20a6be[_0x112315];return _0x470a1b;},_0x1123(_0x24e96c,_0x107c95);}function _0x20a6(){const _0x13f285=['0|5|2|1|4|3','zJQzM','zjlMO','jEjVb','capabilityDelegation','FLcwZ','qPnQg','cjRYf','ZHmBL','rUTzm','QcIRG','/a-specific-document','sUbTQ','iAMwM','should\x20verify\x20chain\x20when\x20child\x20allowedAction\x20is\x20','yRKfG','nFcDr','xKvwf','gIvbT','ZvzkD','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20a\x20','LaEIx','should\x20fail\x20to\x20verify\x20chain\x20w/invalid\x20allowedAction\x20string\x20','irIrU','lSdrR','SLhCg','iAult','kccDc','Cmogl','should\x20verify\x20chain\x20w/path\x20attenuation','ivVFb','should\x20succeed\x20when\x20passing\x20only\x20\x22parentCapability\x22','Sign\x20with\x20capabilityDelegation\x20proof\x20purpose','Error','VazkY','gGaui','The\x20capability\x20\x22','GaWKU','cvIWx','srZQK','jqBPN','required\x20\x22capabilityAction\x22\x20is\x20missing','rDeFY','urn:uuid:055f47a4-61d3-11ec-9144-10bf48838a41','qWTZX','HlBfh','JyOIU','wHprH','ymMnI','target\x20(','rODKS','zAYyR','urn:some:root:id','should\x20verify\x20chain\x20w/path\x20and\x20query\x20attenuation','deep','CoORx','Capability\x20controller\x20not\x20found','https://zcap.example/target2','osIZr','dhJFC','qiVwr','should\x20fail\x20to\x20verify\x20w/embedded\x20middle\x20zcap','&baz=fuzz','ZYTBL','/a-different-specific-document?foo=bar','2|7|3|5|1|4|0|6','proof','should\x20fail\x20to\x20verify\x20chain\x20with\x20attenuation\x20that\x20is\x20more\x20','GaEEh','cWfuF','should\x20fail\x20invoking\x20a\x20capability\x20with\x20second\x20delegated\x20','148NnUZjb','XfXOY','bWJVm','https://example.com/edvs/1d7ab048-719c-11ec-b07a-10bf48838a41','QUJvM','KXkIm','1711341cIddTk','KIIGu','qprjK','xajDR','usGxx','pAzUt','?foo=bar','mcXzH','iTaLA','StpZo','results','3000-01-01T00:01Z','VZmhJ','qfoeY','OKzdz','Mrhxg','aTQWq','iZUCU','Capability\x20controller\x20uses\x20verification\x20method','yGCzd','JnhOR','should\x20fail\x20to\x20verify\x20chain\x20exceeding\x20maxChainLength','tKjVP','should\x20fail\x20if\x20expectedRootCapability\x20does\x20not\x20match','zHDqn','permissive\x20than\x20the\x20parent\x20capability\x20w/path','akYCB','ZIHlz','zZkRH','zOPnG','should\x20fail\x20to\x20verify\x20a\x20capability\x20with\x20bad\x20`expires`\x20field','UZHXO','MYsnC','The\x20capability\x20chain\x20exceeds\x20the\x20maximum\x20allowed\x20length\x20of\x202.','kIuiB','pMlmG','KTpnK','Invocation\x20target\x20(','should\x20verify\x20invoking\x20w/inspectCapabilityChain','should\x20verify\x20a\x20root\x20zcap\x20w/\x20multiple\x20controllers','mwzCT','IQnFM','cSchD','setHours','getHours','PSSko','WbHbh','now','and\x20`date`\x20parameter\x20in\x20the\x20future','MFAQe','ZqadF','should\x20fail\x20to\x20verify\x20w/delegated\x20zcap\x20with\x20no\x20expiration\x20','invocationTarget','replace','QbJXv','\x22expectedRootCapability\x22\x20values\x20must\x20be\x20absolute\x20URI\x20strings.','jFORi','nGrUa','JBGaR','YUDjZ','object','urn:uuid:fake','XOqGg','OWjhl','ceGJe','name','xusCd','exist','should\x20fail\x20to\x20verify\x20w/delegated\x20zcap\x20created\x20before\x20','spLKC','date\x20in\x20its\x20delegation\x20proof.','does\x20not\x20match\x20the\x20parent','must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.','iklIN','SSSXu','jDZkE','Uanek','urn:zcap:e843f3c4-6b2b-11ec-b87f-10bf48838a41','urn:zcap:9ff561b8-0b3f-4bbc-af00-03ba785a7fc6','bar','vvMAT','HFxOT','jJXVN','SFaUc','Lypki','AjIdz','oTxWt','eEbVr','UHTRM','hPbxP','myIsd','kCKEo','alice','VEmOx','jMIxu','suTqb','waEWN','qOiqA','/a-different-specific-document','oraPg','lyzrC','capabilityAction','urn:zcap:ae96f88e-6b8a-4445-9b4f-03f45c3d1685','xfSfk','neOHC','ARQqc','sEiKQ','QuUTx','fdlVr','target\x20w/path','zfmEN','JGxXG','jzwQr','vdQKO','CriiG','PqCUK','pYLqx','urn:uuid:710910c8-61e4-11ec-8739-10bf48838a41','should\x20fail\x20to\x20invoke\x20a\x20root\x20zcap\x20with\x20no\x20controller','YSixn','WQnGP','bMNrF','svMuS','vJqTp','BVmPU','urn:zcap:d3e905ba-6430-11ec-beae-10bf48838a41','GcKso','delegated\x20zcap','XINtq','SLfhy','vVGXs','SQvPl','gbUqs','oASFq','oxQsD','root','must\x20be\x20equivalent\x20to\x20its\x20parent','2018-02-13T21:26:08Z','urn:zcap:59bcb98b-a7ee-4ba7-8629-8b52329bc506','RqDNy','1039000IKylHr','delegation\x20proof\x20\x22created\x22\x20date','JTgwi','split','QLUAM','zcap','urn:uuid:dada0e4d-bc52-4530-ac7f-4973eb8013e9','urn:this-should-matter','6630500FlKPFe','xjjtO','https://example.com/edvs/0d3bd43c-719c-11ec-acdd-10bf48838a41','138770LgmzAN','IDJnn','iwhND','PamlK','LZLHJ','Pbpqs','qEfte','dUkBb','should','EbifD','4|5|2|0|7|6|3|1','2tkHAEq','ZDZhM','restful','urn:zcap:142b0b4a-c664-4288-84e6-be0a59b6efa4','https://example.com/edvs/2c2fe4ab-ff54-4a82-b103-f806f50d364e','Vboax','jwUEF','UgKKs','cDXbN','URWYZ','kjgqm','hoHtf','ZKhav','aNVVQ','should\x20succeed\x20w/verification\x20method\x20as\x20controller','wlDrC','sdIYb','BseBl','should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202','pUgrL','zBdvL','oJZEW','urn:uuid:','KLwXA','w/delegated\x20zcap\x20with\x20a\x20TTL\x20that\x20is\x20too\x20long','WkhPX','GeViK','RFHTD','BXntn','vtHvs','mygaP','permissive\x20than\x20the\x20parent\x20capability\x20w/query','iARhO','verifyResult','FmaMb','xcJIb','jPPAx','KNCwG','\x22read\x22\x20expected\x20action','IMyJp','instanceof','pUOBq','eIrkq','GWlHC','BBhNd','weiQG','hoxOn','should\x20fail\x20invoking\x20a\x20capability\x20with\x20missing\x20`expires`\x20in\x20','FEmRJ','figzi','vMExE','aWZrE','when\x20the\x20expectedRootCapability\x20does\x20not\x20match','5|1|2|0|3|4|7|6','psYii','LGKKR','qzEbW','The\x20invoked\x20capability\x20has\x20expired.','lZPqH','errors','vkOXY','reCri','gOOCl','oLJiw','upPso','should\x20verify\x20an\x20invoked\x20root\x20capability','sGzjo','have','rBtrv','Ypgar','gtChj','sniNu','IBtXO','lgVho','not','gAJAV','stnoQ','WQKAa','axhtp','kdeAz','capability\x20that\x20expires\x20on\x20the\x20Unix\x20epoch','VlqbM','PFMjh','kriCQ','xtxIK','expires','RlpQT','ddeOE','7UnCApO','qsmht','not\x20a\x20valid\x20date','write','uDQNr','juWPL','should\x20fail\x20to\x20verify\x20chain\x20with\x20non-embedded\x20last\x20','YQvjX','FjWFp','jaINP','sAcWi','bYfVz','3|0|2|4|7|6|5|1','qOCKx','equal','nOHoL','purposeResult','ohBUh','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20an\x20','ALvLS','entries','urn:zcap:3c034da3-8b5e-4fdc-b75d-8c37d73cd21e','should\x20verify\x20an\x20invoked\x20root\x20capability\x20w/\x20multiple\x20controllers','XegFm','ytqyj','kxVtN','\x22write\x22\x20expected\x20action','AdqVg','\x22capability\x22\x20must\x20be\x20a\x20string\x20or\x20object.','urn:foo','DNWQz','akzrv','nYDcm','tWyaa','TIWAn','SqEiQ','get','NFxNt','w/path','should\x20fail\x20invoking\x20a\x20chain\x20depth\x203\x20capability\x20with\x20`expires`\x20','capability\x20or\x20an\x20object\x20expressing\x20the\x20full\x20parent\x20capability.','wFcWX','should\x20fail\x20invoking\x20a\x20chain\x20depth\x202\x20capability\x20with\x20`expires`\x20','should\x20fail\x20to\x20verify\x20when\x20allowTargetAttenuation\x20is\x20not\x20','NotFoundError','4|5|3|0|2|1','should\x20fail\x20when\x20missing\x20\x22capabilityAction\x22','apssa','iwaZg','tHdya','pbhkE','irLSL','ZmtUL','VXNSO','is\x20not\x20a\x20valid\x20date.','hIFQU','CaZFt','mgLnE','FpnRf','iaKVz','pZoVl','toISOString','expected\x20\x22capabilityAction\x22\x20does\x20not\x20match','parentCapability','odfAR','UYcCI','DfQvh','omqqK','null','abTyl','ayrDX','eiEVs','should\x20fail\x20to\x20verify\x20chain\x20w/delegated\x20zcap\x20in\x20the\x20','and\x20`date`\x20parameter\x20in\x20the\x20chain\x20in\x20the\x20future','alpha','DgBEL','tJjOY','a\x20matching\x20`expectedRootCapability`\x20is\x20given','gjIwB','verify','\x22\x20has\x20been\x20revoked.','FAQmt','jYhqZ','should\x20verify\x20w/array\x20expected\x20target','AjmBT','LRyOr','invocationTarget\x20attenuation','aYQzl','verified','A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.','https://example.com/edvs/cc8b09fd-76e2-4fae-9bdd-2522b83a2971','Izzua','parse','cGcPH','hsLrF','Zlske','vxkDs','YgyTb','PhwRn','dLlAP','NnjYI','RLwww','vTwJk','should\x20fail\x20when\x20missing\x20\x22parentCapability\x22','dxjVN','Root\x20capability\x20must\x20not\x20have\x20an\x20\x22expires\x22\x20field.','13600184uWtFdM','bbIGZ','error','XbwzO','Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date','igJSw','saRNC','RJYIX','yOgNa','winBl','Rtwgg','AGmTn','urn:zcap:1c919b19-baab-45ee-b0ef-24309dfb355d','exampleDoc','XgRkk','should\x20verify\x20two\x20invocation\x20proofs\x20on\x20the\x20same\x20doc','WgupM','aYDpb','tpJEV','zaxxK','zcap\x20in\x20middle\x20of\x20chain','aweKF','kgPHB','paftN','kzUJp','bob','dLVUv','IsYgR','btGGT','oDSsF','consist\x20of\x20strings\x20of\x20capability\x20IDs','mGJFf','Vdbgq','dftkD','JdMyI','length','cvUFs','should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20unexpected\x20','Lolxw','read','yoqdF','vplIU','AuZYH','w/invalid\x20allowedAction\x20strings','ofOdS','\x22capabilityAction\x22\x20is\x20not\x20in\x20\x22allowedAction\x22','w/inspectCapabilityChain','exampleDocWithInvocation','YYdRU','dvDrZ','otQlF','THpJx','gkzmz','\x22expectedRootCapability\x22\x20must\x20be\x20a\x20string\x20or\x20array.','yWGWx','SjICD','AamlV','lxVax','jgFFY','mojND','SCeDd','should\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','include','JLAtA','stringify','ELRLq','KIrSB','tJgsn','vzNVA','cLqcR','ZWmYg','FzQIj','parent','invalid\x20date','vDHdJ','jLXaz','Capability\x20controller\x20is\x20itself\x20a\x20verification\x20method','hdFqk','FQdmH','KRNXl','fGlzw','mfGNS','rdbUV','raZWo','/sub-path','PgfXd','sign','EowNi','NCWFg','NaLMy','ybtOk','ZBKuF','MHzzU','tJqQY','YNISJ','PwlvN','\x22capabilityAction\x22\x20must\x20be\x20a\x20string.','kQOGd','dCuSO','should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20as\x20delegated','date','cmxHV','SvdwV','ySIvu','mdTvi','CiMHC','https://example.com/edvs/3e209556-719c-11ec-9a7b-10bf48838a41','The\x20\x22allowedAction\x22\x20in\x20a\x20delegated\x20capability\x20','beta','CNaRi','zXfOB','mNPwW','oeBnj','EHPwD','gVbwA','AtACg','MVuZS','fYsVo','should\x20fail\x20to\x20verify\x20chain\x20','QFDgl','bpmHI','message','djBKi','urn:zcap:bcbcde5e-d64a-4f46-a76e-daf52f63f702','jssEA','XKLyg','getTime','jAdxf','yiRsK','amqIs','wFDqq','ItNgn','waodo','contain','zhQjo','lOYUf',')\x20does\x20not\x20match\x20capability\x20','STUCf','JGxxW','mMEhI','Rdirm','AbsUc','HyZFU','zcap\x20at\x20end\x20of\x20chain','cZjBZ','AqTRE','zbkfD','jeyeJ','no\x20`expectedRootCapability`\x20is\x20given','MNihh','peztG','FtOWA','mzpKu','759534ohBZuL','should\x20verify\x20invoking\x20','aMvea','explicitly\x20allowed','KODBU','12jvPiBo','kOdio','pUxmz','should\x20fail\x20to\x20verify\x20chain\x20with\x20embedded\x20root\x20','ekYUa','should\x20verify\x20invoking\x20a\x20capability\x20with\x20only\x20expires\x20on\x20','zwmPe','TegOe','RDekz','Cannot\x20delegate\x20an\x20expired\x20capability.','zcap\x20in\x20chain','nOaTt','array','zxkZn','should\x20fail\x20to\x20verify\x20an\x20increasingly\x20permissive\x20chain\x20','pGOca','Yjfwu','MWWFQ','should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20invalid\x20','ygrhL','QAjep','kmuNq','KjrOK','9WhMzNs','YHPDt','jPQKd','ccYDc','GsFJD','MvfxK','w/invalid\x20allowedAction\x20arrays','ZYftb','CapabilityDelegation\x20throws\x20TypeError\x20on\x20invalid\x20date','XOnhR','\x22parentCapability\x22\x20must\x20be\x20a\x20string\x20expressing\x20the\x20ID\x20of\x20a\x20root\x20','SAPhO','should\x20fail\x20to\x20verify\x20chain\x20with\x20misreferenced\x20parent\x20','yNqBP','rbypD','HMZtc','has\x20been\x20revoked.','11NBQbwD','does\x20not\x20match\x20expected\x20root\x20capability','nMITD','A\x20delegated\x20capability\x20must\x20not\x20be\x20invoked\x20before\x20the\x20\x22created\x22\x20','URnmO','uouoI','hrwGa','fxKZz','should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20when\x20','nTSEv','pyJpW','UdPsG','pLyPQ','should\x20verify\x20when\x20invoking\x20at\x20a\x20valid\x20sub\x20target\x20','should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202','it\x20must\x20consist\x20of\x20strings','capabilityInvocation','time\x20to\x20live\x20that\x20is\x20too\x20long','JFHRU','TnjLz','JGXNa','VerificationError','vs\x20array','yyzSO','xKbAT','JmZbX','should\x20verify\x20when\x20invoking\x20at\x20an\x20exact-match\x20target\x20','QHjLn','w/inspectCapabilityChain\x20and\x20a\x20revoked\x20capability','EJyvE','syNGM','GvwPU','Prazd','BqjDq','match','RsAKA','koPGL','dqsID','FuYGP','nVZEr','urn:zcap:ef98a880-6b36-11ec-940f-10bf48838a41','Wqdce','allowed\x20action\x20on\x20one\x20capability','QhZEt','LzeLK','NLmAU','iZqVH','jYnjs','PTjyI','a\x20valid\x20subset\x20of\x20the\x20parent\x20allowedAction\x20array','urn:zcap:6286a906-619b-4f5b-a8ae-af9fb774b070','XkwlT','urn:other','ZpQJM','VBTnS','should\x20fail\x20to\x20verify\x20chain\x20w/bad\x20middle\x20capability','DJmxN','delegated\x20before\x20its\x20parent','true','ZqyRU','MUOvr','kueBE','string','aiDne','WpGqY','HaUld','should\x20fail\x20to\x20verify\x20a\x20chain\x20','revoked','iwcOa','and\x20`date`\x20parameter\x20in\x20the\x20past','yjTgv','controller','qlbBU','wBltH','HASZp','fbSTI','snPQp','NFuPd','urn:uuid:1aaec12f-bcf2-40d8-8192-cc4dde9bca96','invalid','iOSEO','Chain\x20depth\x20of\x203','dPgVn','https://example.com/edvs/357570f6-8df2-4e78-97dc-42260d64e78e','heiAO','Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date.','CbdwN','xTcec','CDeCm','RLAHI','OXrMP','qlsaF','WEhRG','EqFVH','XNCzB','RjmSc','OTsor','hhQyu','UvvFD','GaLmn','DQfVu','urn:zcap:1d0cd622-2e0a-4686-b0d7-bd71cc27db04','Sign\x20with\x20capabilityInvocation\x20proof\x20purpose','Sqnmy','moGOp','/a-specific-document?foo=bar','TypeError','zhfHn','GKiOc','iMmCe','HpcRV','false','delegated','qupCo','should\x20fail\x20when\x20missing\x20\x22invocationTarget\x22','should\x20succeed','should\x20fail\x20to\x20verify\x20chain\x20w/bad\x20last\x20capability','bmOmY','should\x20verify\x20chain\x20w/inspectCapabilityChain','urn:zcap:0aee1dd6-646b-11ec-b975-10bf48838a41','eEfun','Zeynu','AYsNI','XWoyE','PIjjH','CXmtG','3614286CEOvVa','MbrwL','vkgap','wOOQh','FrOGX','dfOiw','qPqPm','WHhVQ','https://example.com/edvs/d9dd2093-0908-47ba-8db7-954ff1cd81ee','jxvBE','should\x20verify\x20chain','RuvIy','second\x20delegated\x20capability','tCOwv','RnJtu','Chain\x20depth\x20of\x204','urn:zcap:cbddee5a-09fb-44db-a921-70c36436c253','delegated\x20capability\x20must\x20not\x20be\x20less\x20restrictive','DXvlG','TZlGj','PolUC','EruNI','tkuzZ','lxJiZ','w/query','YFLoU','mhkbW','QdAxO','should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','QMfhr','uyPBI','zlumC','property','dpCiO','CapabilityInvocation\x20throws\x20TypeError\x20on\x20invalid\x20date','https://example.com/edvs/','vgJio','JxagT','EnLkH'];_0x20a6=function(){return _0x13f285;};return _0x20a6();}const should=_0x1a6925[_0x209aab(0x461)]();export default async function (options){const _0x21995d=_0x209aab,wdQtMN={'tJjOY':function(callee,param1){return callee(param1);},'WQnGP':function(callee,param1,param2){return callee(param1,param2);},'OKzdz':function(callee,param1,param2){return callee(param1,param2);},'WbHbh':function(callee,param1,param2){return callee(param1,param2);},'TnjLz':function(x,y){return x===y;},'JLAtA':function(callee,param1){return callee(param1);},'rZNUK':_0x21995d(0x1f3),'zhfHn':'should\x20fail\x20to\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20','iOSEO':_0x21995d(0x498),'pLyPQ':_0x21995d(0x2de),'wFDqq':_0x21995d(0x3a9),'psYii':function(callee,param1){return callee(param1);},'hoHtf':function(callee){return callee();},'JTgwi':function(callee,param1){return callee(param1);},'tpJEV':_0x21995d(0x23f),'bmciR':_0x21995d(0x3ae),'fYdHp':_0x21995d(0x407),'ZYTBL':'OxPdf','CaZFt':_0x21995d(0x304),'CKnFt':function(callee,param1){return callee(param1);},'XTqKh':'yedgH','pMlmG':_0x21995d(0x4bf),'QUJvM':_0x21995d(0x1cc),'VEpud':function(callee,param1){return callee(param1);},'Ypgar':function(callee,param1){return callee(param1);},'qOCKx':function(callee,param1){return callee(param1);},'FLcwZ':_0x21995d(0x409),'djBKi':_0x21995d(0x396),'azgid':_0x21995d(0x411),'NnjYI':function(callee,param1){return callee(param1);},'XINtq':function(callee,param1){return callee(param1);},'lkWLA':_0x21995d(0x439),'akzrv':function(x,y){return x*y;},'jMIxu':function(x,y){return x+y;},'iAMwM':'delegated\x20in\x20the\x20future','raZWo':_0x21995d(0x2b4),'uulYY':_0x21995d(0x443),'zBdvL':function(callee,param1){return callee(param1);},'CbdwN':function(callee,param1){return callee(param1);},'eEbVr':_0x21995d(0x497),'GeViK':function(callee){return callee();},'sGzjo':function(callee,param1){return callee(param1);},'NaLMy':function(callee){return callee();},'lxVax':function(callee,param1){return callee(param1);},'JnhOR':function(x,y){return x===y;},'gjIwB':function(callee){return callee();},'CNaRi':_0x21995d(0x1f9),'YaeJq':function(callee,param1){return callee(param1);},'qsmht':_0x21995d(0x1b5),'dftkD':function(x,y){return x-y;},'KTpnK':function(callee,param1){return callee(param1);},'bbIGZ':function(x,y){return x+y;},'ZmtUL':_0x21995d(0x370),'vdQKO':'should\x20fail\x20to\x20delegate\x20a\x20capability\x20with\x20bad\x20`expires`\x20field','CDeCm':'should\x20fail\x20invoking\x20a\x20chain\x20depth\x203\x20capability\x20with\x20`expires`\x20','hsLrF':_0x21995d(0x315),'hqVYW':_0x21995d(0x493),'Xnevt':'the\x20second\x20capability\x20delegation','qOiqA':function(callee,param1,param2){return callee(param1,param2);},'dPgVn':'should\x20fail\x20delegating\x20an\x20expired\x20capability','NfVnE':_0x21995d(0x4b4),'EHMIi':_0x21995d(0x2ad),'HFxOT':_0x21995d(0x3e3),'MYsnC':_0x21995d(0x3b2),'sAcWi':_0x21995d(0x1fa),'aHcOU':function(callee){return callee();},'kjgqm':function(callee){return callee();},'oASFq':function(callee,param1){return callee(param1);},'XNCzB':function(callee,param1){return callee(param1);},'PamlK':function(callee,param1,param2){return callee(param1,param2);},'XWoyE':function(callee,param1,param2){return callee(param1,param2);},'wlDrC':_0x21995d(0x438),'HyZFU':function(x,y){return x+y;},'tJqQY':'should\x20verify\x20a\x20invoking\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20','oJZEW':_0x21995d(0x1ed),'OWjhl':function(callee,param1,param2){return callee(param1,param2);},'oLJiw':function(x,y){return x+y;},'ZBKuF':_0x21995d(0x247),'aczAy':'a\x20matching\x20`expectedRootCapability`\x20array\x20is\x20given','PIjjH':'`expectedRootCapability`\x20is\x20not\x20a\x20URI','JGxXG':function(callee,param1,param2){return callee(param1,param2);},'SevBH':function(callee,param1,param2){return callee(param1,param2);},'btGGT':_0x21995d(0x1b6),'mwzCT':_0x21995d(0x476),'EqFVH':'should\x20verify\x20invoking\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20a\x20','tMsvP':_0x21995d(0x48a),'amqIs':function(x,y){return x+y;},'osIZr':'should\x20verify\x20a\x20capability\x20chain\x20of\x20depth\x202\x20and\x20an\x20','Zeynu':_0x21995d(0x2fa),'gIvbT':function(callee,param1,param2){return callee(param1,param2);},'KIIGu':function(x,y){return x+y;},'koPGL':_0x21995d(0x2d8),'fxKZz':_0x21995d(0x389),'ZHmBL':_0x21995d(0x237),'cDXbN':function(x,y){return x+y;},'Mrhxg':function(x,y){return x+y;},'SOMOl':_0x21995d(0x1de),'DJmxN':_0x21995d(0x35d),'eygGh':'zERMu','jLXaz':function(callee,param1){return callee(param1);},'BVTdw':_0x21995d(0x1bd),'qfoeY':_0x21995d(0x231),'yGCzd':'\x22invocationTarget\x22\x20must\x20be\x20a\x20string\x20that\x20expresses\x20an\x20absolute\x20URI.','tWyaa':_0x21995d(0x286),'nVZEr':function(callee,param1){return callee(param1);},'ZIHlz':_0x21995d(0x2c9),'knZva':_0x21995d(0x3ff),'ygrhL':_0x21995d(0x2e0),'CsjAF':function(callee,param1){return callee(param1);},'QnNfI':function(callee){return callee();},'SLhCg':function(callee,param1){return callee(param1);},'dLVUv':function(callee,param1){return callee(param1);},'iZUCU':_0x21995d(0x246),'cJSMd':function(x,y){return x===y;},'okHnF':'njfyJ','irfxu':_0x21995d(0x40a),'cSchD':function(callee,param1){return callee(param1);},'KXkIm':_0x21995d(0x348),'dZFJf':_0x21995d(0x244),'sniNu':function(x,y){return x+y;},'sUbTQ':function(callee,param1){return callee(param1);},'MuRDV':function(x,y){return x+y;},'mygaP':_0x21995d(0x2e6),'qlbBU':function(x,y){return x+y;},'IdelN':_0x21995d(0x1e8),'RLwww':'future','eIAyj':_0x21995d(0x458),'IDJnn':function(callee,param1){return callee(param1);},'iZqVH':_0x21995d(0x3fe),'ohBUh':_0x21995d(0x317),'FuYGP':'invocationTarget','iTaLA':'TcPLT','pUxmz':function(x,y){return x+y;},'vVGXs':_0x21995d(0x468),'AjmBT':_0x21995d(0x356),'uNjhg':'should\x20fail\x20to\x20verify\x20chain\x20with\x20attenuation\x20that\x20is\x20more\x20','kzUJp':function(callee,param1,param2){return callee(param1,param2);},'YHPDt':function(x,y){return x+y;},'PTjyI':_0x21995d(0x2ba),'ONVdt':_0x21995d(0x2a6),'gkzmz':function(callee,param1,param2){return callee(param1,param2);},'oTxWt':function(callee,param1,param2){return callee(param1,param2);},'eATqf':_0x21995d(0x336),'DNWQz':function(callee,param1,param2){return callee(param1,param2);},'axhtp':_0x21995d(0x256),'XfXOY':_0x21995d(0x3d4),'eIrkq':'verifyResult','WgupM':function(x,y){return x!==y;},'dxjVN':_0x21995d(0x41c),'nTSEv':_0x21995d(0x3dc),'kdeAz':_0x21995d(0x1a9),'iwaZg':_0x21995d(0x379),'rBtrv':function(callee){return callee();},'IcaUJ':'FXbMx'},{expect,helpers,jsigs,mock,zcap}=options,{CapabilityInvocation,CapabilityDelegation,createRootCapability,constants:{ZCAP_CONTEXT_URL}}=zcap,{controllers,privateDidDocs,capabilities,addToLoader,testLoader}=mock,{Controller,uuid}=helpers;function clone(obj){const _0x2cb895=_0x21995d;return JSON[_0x2cb895(0x1fc)](JSON[_0x2cb895(0x24a)](obj));}const alice=new Controller(controllers[_0x21995d(0x41e)]),bob=new Controller(controllers[_0x21995d(0x223)]),carol=new Controller(controllers['carol']),diana=new Controller(controllers['diana']),alpha=new Controller(privateDidDocs[_0x21995d(0x1ea)]),CONSTANT_DATE=_0x21995d(0x44b),EXPIRES_3000_DATE=_0x21995d(0x3cd);describe(_0x21995d(0x453),()=>{const _0x1033b2=_0x21995d,EMpmzw={'WpGqY':function(callee,param1){const _0x106477=_0x1123;return wdQtMN[_0x106477(0x442)](callee,param1);},'rDeFY':function(callee,param1){return callee(param1);},'UvvFD':function(x,y){return x!==y;},'gtChj':function(callee,param1){return callee(param1);},'GfIYd':wdQtMN['eygGh'],'bSLLR':_0x1033b2(0x26a),'mcXzH':function(callee,param1){const _0xbd0eb5=_0x1033b2;return wdQtMN[_0xbd0eb5(0x255)](callee,param1);},'ytqyj':wdQtMN['BVTdw'],'ekYUa':wdQtMN[_0x1033b2(0x3cf)],'nOaTt':wdQtMN[_0x1033b2(0x3d5)],'FQdmH':_0x1033b2(0x23b),'EruNI':wdQtMN[_0x1033b2(0x1c1)],'zwmPe':function(callee,param1){const _0x4f6c0e=_0x1033b2;return wdQtMN[_0x4f6c0e(0x2f7)](callee,param1);},'KLwXA':function(callee,param1){return callee(param1);},'hhQyu':wdQtMN[_0x1033b2(0x3dd)],'tTLkL':_0x1033b2(0x1c8),'FiHBX':_0x1033b2(0x437),'wFcWX':wdQtMN[_0x1033b2(0x25d)],'qzpzF':_0x1033b2(0x472),'EowNi':function(callee,param1,param2){return callee(param1,param2);},'kriCQ':function(callee,param1,param2){return wdQtMN['OKzdz'](callee,param1,param2);},'cRWtg':_0x1033b2(0x394),'oxQsD':function(callee,param1){return callee(param1);},'rbypD':wdQtMN['knZva'],'Yjfwu':_0x1033b2(0x2e5),'FzQIj':wdQtMN[_0x1033b2(0x2bb)],'ALvLS':function(callee,param1){return wdQtMN['CsjAF'](callee,param1);},'SjICD':function(callee){return callee();},'gbUqs':function(callee){return wdQtMN['QnNfI'](callee);},'TIWAn':function(callee,param1){return callee(param1);},'zHDqn':function(callee,param1){return callee(param1);},'NFuPd':function(callee,param1){return callee(param1);},'UZHXO':function(callee,param1){return wdQtMN['qOCKx'](callee,param1);},'KNCwG':function(callee,param1){const _0x19ac92=_0x1033b2;return wdQtMN[_0x19ac92(0x326)](callee,param1);},'zZkRH':function(callee,param1){return callee(param1);},'ofOdS':function(callee,param1){const _0x2ba646=_0x1033b2;return wdQtMN[_0x2ba646(0x38e)](callee,param1);},'iAult':function(callee,param1){const _0x258c03=_0x1033b2;return wdQtMN[_0x258c03(0x224)](callee,param1);},'MVuZS':function(callee,param1){const _0x20c638=_0x1033b2;return wdQtMN[_0x20c638(0x255)](callee,param1);},'AjIdz':_0x1033b2(0x3f9),'xKbAT':function(callee,param1){return wdQtMN['psYii'](callee,param1);},'vkgap':_0x1033b2(0x4bf),'syNGM':function(callee,param1){return callee(param1);},'EnLkH':function(callee){return callee();},'IBtXO':function(callee,param1){return callee(param1);},'HASZp':function(callee){return callee();},'rUTzm':function(callee,param1){return callee(param1);},'NbNHZ':function(callee,param1){const _0x174c2a=_0x1033b2;return wdQtMN[_0x174c2a(0x478)](callee,param1);},'dCuSO':function(callee,param1){return callee(param1);},'gVbwA':wdQtMN[_0x1033b2(0x3d3)],'XOqGg':function(callee,param1){return callee(param1);},'nGrUa':_0x1033b2(0x1cc),'oeBnj':function(callee,param1){const _0x51f4dd=_0x1033b2;return wdQtMN[_0x51f4dd(0x478)](callee,param1);},'ZsCry':'RQbaa','wHprH':function(x,y){return wdQtMN['cJSMd'](x,y);},'YUDjZ':wdQtMN['okHnF'],'SAPhO':wdQtMN['irfxu'],'ocIlS':function(callee,param1){const _0x512852=_0x1033b2;return wdQtMN[_0x512852(0x3ec)](callee,param1);},'olesP':wdQtMN[_0x1033b2(0x3c1)],'frEPJ':wdQtMN['dZFJf'],'vvMAT':function(x,y){const _0xce59ac=_0x1033b2;return wdQtMN[_0xce59ac(0x4ab)](x,y);},'LRyOr':function(callee,param1){return callee(param1);},'bpmHI':_0x1033b2(0x313),'MNihh':function(callee,param1){const _0x131dcd=_0x1033b2;return wdQtMN[_0x131dcd(0x381)](callee,param1);},'XYVTE':_0x1033b2(0x1d9),'zaxxK':'vRpXN','PFMjh':function(callee,param1){const _0x537713=_0x1033b2;return wdQtMN[_0x537713(0x32e)](callee,param1);},'kFwYB':function(callee,param1){const _0x383d78=_0x1033b2;return wdQtMN[_0x383d78(0x243)](callee,param1);},'BqjDq':function(x,y){return x+y;},'PhwRn':_0x1033b2(0x2ab),'KODBU':_0x1033b2(0x2b2),'lOYUf':function(x,y){return wdQtMN['MuRDV'](x,y);},'WAsOz':_0x1033b2(0x4c2),'nOHoL':_0x1033b2(0x441),'BVmPU':_0x1033b2(0x2cb),'ySIvu':_0x1033b2(0x312),'JGxxW':_0x1033b2(0x235),'tkuzZ':wdQtMN[_0x1033b2(0x482)],'yjTgv':function(callee,param1,param2){return callee(param1,param2);},'nYDcm':function(x,y){return x+y;},'SQvPl':function(x,y){const _0x5c13ba=_0x1033b2;return wdQtMN[_0x5c13ba(0x3c3)](x,y);},'iaKVz':function(x,y){const _0x4dcf2b=_0x1033b2;return wdQtMN[_0x4dcf2b(0x318)](x,y);},'ZvzkD':_0x1033b2(0x383),'neOHC':_0x1033b2(0x307),'qupCo':function(callee,param1,param2){return callee(param1,param2);},'SRfpY':'should\x20verify\x20chain\x20w/inspectCapabilityChain','EaYhn':function(x,y){return wdQtMN['HyZFU'](x,y);},'GHJNS':function(callee,param1,param2){return callee(param1,param2);},'hsbBT':wdQtMN['IdelN'],'kgPHB':wdQtMN[_0x1033b2(0x205)],'pGOca':function(x,y){return x+y;},'cWfuF':function(callee,param1,param2){return wdQtMN['OKzdz'](callee,param1,param2);},'Sqnmy':function(x,y){return x+y;},'lxJiZ':_0x1033b2(0x2a4),'UiVzd':wdQtMN['eIAyj'],'YgyTb':function(callee,param1){const _0x28f4e8=_0x1033b2;return wdQtMN[_0x28f4e8(0x45a)](callee,param1);},'vtHvs':function(callee,param1){return callee(param1);},'MHzzU':wdQtMN[_0x1033b2(0x2fe)],'ZqadF':wdQtMN[_0x1033b2(0x1b1)],'vxkDs':wdQtMN[_0x1033b2(0x2f6)],'THpJx':wdQtMN[_0x1033b2(0x3ca)],'TegOe':function(callee,param1){return callee(param1);},'uDQNr':function(callee,param1){const _0x48ce54=_0x1033b2;return wdQtMN[_0x48ce54(0x381)](callee,param1);},'XOnhR':function(x,y){const _0x16046d=_0x1033b2;return wdQtMN[_0x16046d(0x2aa)](x,y);},'XHNMo':function(callee,param1){return callee(param1);},'qPqPm':function(callee,param1){const _0x23b079=_0x1033b2;return wdQtMN[_0x23b079(0x3ec)](callee,param1);},'pZoVl':wdQtMN[_0x1033b2(0x444)],'dLlAP':_0x1033b2(0x475),'mzpKu':wdQtMN[_0x1033b2(0x1f4)],'TzDSW':function(callee,param1){const _0x11c80c=_0x1033b2;return wdQtMN[_0x11c80c(0x326)](callee,param1);},'QHjLn':'should\x20verify\x20chain\x20w/query\x20attenuation','ccYDc':_0x1033b2(0x3aa),'EbifD':wdQtMN['uNjhg'],'PolUC':_0x1033b2(0x3db),'VazkY':_0x1033b2(0x1c6),'rsrfq':function(x,y){return x+y;},'DeNuf':_0x1033b2(0x366),'vkOXY':function(callee,param1,param2){return callee(param1,param2);},'Vboax':function(callee,param1,param2){return callee(param1,param2);},'AGmTn':function(callee,param1,param2){const _0x517998=_0x1033b2;return wdQtMN[_0x517998(0x222)](callee,param1,param2);},'oDSsF':function(x,y){const _0x2da0cd=_0x1033b2;return wdQtMN[_0x2da0cd(0x2c0)](x,y);},'gHBEm':function(x,y){return wdQtMN['Mrhxg'](x,y);},'XegFm':wdQtMN[_0x1033b2(0x300)],'IRMVN':function(callee,param1,param2){return callee(param1,param2);},'HlBfh':_0x1033b2(0x1cb),'bmOmY':wdQtMN['ONVdt'],'jqWic':function(callee,param1,param2){const _0x4a2417=_0x1033b2;return wdQtMN[_0x4a2417(0x23e)](callee,param1,param2);},'aYDpb':_0x1033b2(0x2b6)};wdQtMN[_0x1033b2(0x418)](describe,wdQtMN['eATqf'],()=>{const _0x3c1f3d=_0x1033b2,vdknhD={'hrwGa':function(callee,param1){return callee(param1);},'zxkZn':_0x3c1f3d(0x231),'FAQmt':function(callee,param1){return wdQtMN['tJjOY'](callee,param1);}};it('should\x20succeed\x20w/key\x20invoker',async()=>{const _0x19bec2=_0x3c1f3d,doc=vdknhD[_0x19bec2(0x2d6)](clone,mock[_0x19bec2(0x217)]),signed=await _invoke({'doc':doc,'invoker':alice,'date':CONSTANT_DATE,'capability':capabilities[_0x19bec2(0x449)][_0x19bec2(0x1ea)],'capabilityAction':vdknhD[_0x19bec2(0x2b5)]});vdknhD[_0x19bec2(0x1f1)](expect,signed)['to']['deep']['equal'](mock[_0x19bec2(0x239)]['alpha']);}),wdQtMN[_0x3c1f3d(0x43a)](it,'should\x20succeed\x20w/controller\x20invoker',async()=>{const _0x2e9451=_0x3c1f3d,doc=clone(mock[_0x2e9451(0x217)]),signed=await _invoke({'doc':doc,'invoker':alice,'date':CONSTANT_DATE,'capability':capabilities[_0x2e9451(0x449)][_0x2e9451(0x276)],'capabilityAction':'read'});expect(signed)['to'][_0x2e9451(0x3ab)]['equal'](mock[_0x2e9451(0x239)][_0x2e9451(0x276)]);}),wdQtMN['OKzdz'](it,'should\x20fail\x20when\x20missing\x20\x22capability\x22',async()=>{const _0x12d46e=_0x3c1f3d;let err;try{const doc=EMpmzw['WpGqY'](clone,mock[_0x12d46e(0x217)]);await _invoke({'doc':doc,'invoker':alice,'purposeOptions':{}});}catch(e){err=e;}EMpmzw[_0x12d46e(0x39f)](expect,err)['to']['exist'],expect(err[_0x12d46e(0x283)])['to']['equal'](_0x12d46e(0x1bc));}),it(_0x3c1f3d(0x1ce),async()=>{const _0x30f512=_0x3c1f3d;let err;try{if(EMpmzw[_0x30f512(0x332)]('PqCUK',_0x30f512(0x435)))_0x19870a=_0x52b2f8;else{const doc=EMpmzw['WpGqY'](clone,mock['exampleDoc']);await EMpmzw[_0x30f512(0x4aa)](_invoke,{'doc':doc,'invoker':alice,'purposeOptions':{'capability':_0x30f512(0x1bd)}});}}catch(e){if(EMpmzw['GfIYd']===_0x30f512(0x206))return _0x2f6ec1[_0x30f512(0x1ef)](_0x195cef,{'documentLoader':_0x8da77e,'suite':new _0xc13070(),'purpose':new _0x7ee5e({'suite':new _0x3dc524(),'expectedRootCapability':_0xb5b803,'inspectCapabilityChain':_0x49e9f9,..._0x1c4f49})});else err=e;}expect(err)['to'][_0x30f512(0x405)],expect(err['message'])['to'][_0x30f512(0x1ae)](EMpmzw['bSLLR']);}),wdQtMN['WbHbh'](it,_0x3c1f3d(0x342),async()=>{const _0x5e98f4=_0x3c1f3d;let err;try{const doc=clone(mock[_0x5e98f4(0x217)]);await EMpmzw[_0x5e98f4(0x3c9)](_invoke,{'doc':doc,'invoker':alice,'purposeOptions':{'capability':EMpmzw[_0x5e98f4(0x1b8)],'capabilityAction':EMpmzw[_0x5e98f4(0x2ac)]}});}catch(e){err=e;}EMpmzw[_0x5e98f4(0x39f)](expect,err)['to'][_0x5e98f4(0x405)],expect(err[_0x5e98f4(0x283)])['to'][_0x5e98f4(0x1ae)](EMpmzw[_0x5e98f4(0x2b3)]);});}),wdQtMN['OWjhl'](describe,_0x1033b2(0x395),()=>{const _0x56649a=_0x1033b2,WTJKhq={'AdqVg':function(callee,param1){const _0x263687=_0x1123;return EMpmzw[_0x263687(0x2ae)](callee,param1);},'aMvea':EMpmzw[_0x56649a(0x1c9)]};it(EMpmzw['qzpzF'],async()=>{const _0x337878=_0x56649a,newCapability={'@context':ZCAP_CONTEXT_URL,'id':_0x337878(0x3a0),'controller':bob['get'](_0x337878(0x2e0),0x0)['id'],'parentCapability':capabilities[_0x337878(0x449)][_0x337878(0x1ea)]['id'],'invocationTarget':capabilities['root'][_0x337878(0x1ea)][_0x337878(0x3f6)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'parentCapability':capabilities[_0x337878(0x449)][_0x337878(0x1ea)],'delegator':alice,'date':CONSTANT_DATE});EMpmzw[_0x337878(0x310)](expect,delegatedCapability)['to'][_0x337878(0x3ab)][_0x337878(0x1ae)](capabilities[_0x337878(0x340)][_0x337878(0x1ea)]);}),EMpmzw[_0x56649a(0x261)](it,_0x56649a(0x343),async()=>{const _0x13d7e6=_0x56649a,newCapability={'@context':ZCAP_CONTEXT_URL,'id':_0x13d7e6(0x437),'controller':bob['id'](),'parentCapability':capabilities[_0x13d7e6(0x449)][_0x13d7e6(0x276)]['id'],'invocationTarget':capabilities[_0x13d7e6(0x449)]['beta'][_0x13d7e6(0x3f6)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'parentCapability':capabilities['root'][_0x13d7e6(0x276)],'delegator':alice,'date':CONSTANT_DATE});WTJKhq[_0x13d7e6(0x1bb)](expect,delegatedCapability)['to']['deep'][_0x13d7e6(0x1ae)](capabilities[_0x13d7e6(0x340)]['beta']);}),EMpmzw[_0x56649a(0x4b7)](it,_0x56649a(0x207),async()=>{const _0x5adba8=_0x56649a;let err;try{if(EMpmzw['UvvFD'](EMpmzw[_0x5adba8(0x258)],EMpmzw[_0x5adba8(0x363)])){const doc=EMpmzw[_0x5adba8(0x3c9)](clone,mock[_0x5adba8(0x217)]);await EMpmzw[_0x5adba8(0x3c9)](_delegate,{'newCapability':doc,'delegator':alice,'purposeOptions':{}});}else{const eslmVf=_0x5adba8(0x463)['split']('|');let IWRzzP=0x0;while(!![]){switch(eslmVf[IWRzzP++]){case'0':_0x501db6[_0x5adba8(0x461)]['be']['an'](WTJKhq[_0x5adba8(0x2a5)]);continue;case'1':return{'valid':!![]};case'2':_0x4b6fab[_0x5adba8(0x461)][_0x5adba8(0x4a7)][_0x5adba8(0x22d)](0x3);continue;case'3':_0x7b3158({'capabilityChainMeta':_0x1c16cf});continue;case'4':_0x2a484b++;continue;case'5':_0x4a32ea[_0x5adba8(0x461)]['be']['an']('array');continue;case'6':WTJKhq[_0x5adba8(0x1bb)](_0x8d802c,{'capabilityChain':_0x3449ca});continue;case'7':_0x8f6987[_0x5adba8(0x461)]['have'][_0x5adba8(0x22d)](0x3);continue;}break;}}}catch(e){err=e;}EMpmzw[_0x5adba8(0x2ae)](expect,err)['to'][_0x5adba8(0x405)],EMpmzw[_0x5adba8(0x47b)](expect,err['message'])['to'][_0x5adba8(0x1ae)](EMpmzw[_0x5adba8(0x331)]+EMpmzw['tTLkL']);}),EMpmzw[_0x56649a(0x4b7)](it,EMpmzw['cRWtg'],async()=>{const _0x1ff34c=_0x56649a;if(_0x1ff34c(0x46a)===_0x1ff34c(0x39b))return _0x3ae390++,_0x2d86f5[_0x1ff34c(0x461)]['be']['an'](_0x1ff34c(0x2b4)),_0x48fc61[_0x1ff34c(0x461)]['have'][_0x1ff34c(0x22d)](0x4),_0x1c6691['should']['be']['an'](WTJKhq['aMvea']),_0x14cdd0[_0x1ff34c(0x461)][_0x1ff34c(0x4a7)][_0x1ff34c(0x22d)](0x4),_0x562d74({'capabilityChain':_0x9c9d1f}),_0x2ab0c4({'capabilityChainMeta':_0x46a502}),{'valid':!![]};else{const newCapability={'@context':ZCAP_CONTEXT_URL,'id':EMpmzw['FiHBX'],'controller':bob['id'](),'parentCapability':capabilities['root'][_0x1ff34c(0x276)]['id'],'invocationTarget':capabilities[_0x1ff34c(0x449)][_0x1ff34c(0x276)][_0x1ff34c(0x3f6)],'expires':EXPIRES_3000_DATE},delegatedCapability=await _delegate({'newCapability':newCapability,'delegator':alice,'date':CONSTANT_DATE,'purposeOptions':{'parentCapability':capabilities[_0x1ff34c(0x449)][_0x1ff34c(0x276)]}});EMpmzw['zwmPe'](expect,delegatedCapability)['to'][_0x1ff34c(0x3ab)][_0x1ff34c(0x1ae)](capabilities[_0x1ff34c(0x340)][_0x1ff34c(0x276)]);}});}),wdQtMN[_0x1033b2(0x1be)](context,wdQtMN[_0x1033b2(0x4b2)],()=>{const _0x5063a9=_0x1033b2,qWLOWV={'QMfhr':function(x,y){const _0x2951ab=_0x1123;return wdQtMN[_0x2951ab(0x2e3)](x,y);},'iklIN':_0x5063a9(0x2a1),'bIvmx':function(callee,param1){const _0x472d10=_0x5063a9;return wdQtMN[_0x472d10(0x249)](callee,param1);},'iNYDH':_0x5063a9(0x2e0),'kQOGd':function(callee,param1){const _0x11ad2b=_0x5063a9;return wdQtMN[_0x11ad2b(0x1ec)](callee,param1);}};wdQtMN[_0x5063a9(0x3f0)](it,_0x5063a9(0x4a5),async()=>{const _0x4446f5=_0x5063a9,result=await _verifyInvocation({'invocation':mock[_0x4446f5(0x239)]['alpha'],'rootCapability':capabilities['root'][_0x4446f5(0x1ea)],'expectedAction':_0x4446f5(0x231)});EMpmzw[_0x4446f5(0x3c9)](expect,result)['to']['exist'],EMpmzw[_0x4446f5(0x448)](expect,result[_0x4446f5(0x1f8)])['to']['be'][_0x4446f5(0x30a)];}),wdQtMN[_0x5063a9(0x3d0)](it,wdQtMN['rZNUK'],async()=>{const _0x504a4f=_0x5063a9;if(qWLOWV[_0x504a4f(0x36b)](qWLOWV[_0x504a4f(0x40b)],qWLOWV['iklIN'])){const result=await _verifyInvocation({'invocation':mock[_0x504a4f(0x239)][_0x504a4f(0x1ea)],'purposeOptions':{'expectedAction':_0x504a4f(0x231),'expectedRootCapability':capabilities[_0x504a4f(0x449)]['alpha']['id'],'expectedTarget':[capabilities['root'][_0x504a4f(0x1ea)][_0x504a4f(0x3f6)]]}});expect(result)['to']['exist'],qWLOWV['bIvmx'](expect,result['verified'])['to']['be'][_0x504a4f(0x30a)];}else _0x1e4c52=new _0x2b380d(_0x1c73ab);}),it(_0x5063a9(0x476),async()=>{const _0x301cdb=_0x5063a9,delegatedCapability=await _delegate({'parentCapability':capabilities[_0x301cdb(0x449)]['alpha'],'controller':bob[_0x301cdb(0x1c4)](qWLOWV['iNYDH'],0x0)['id'],'delegator':alice}),result=await _verifyDelegation({'delegation':delegatedCapability,'expectedRootCapability':capabilities[_0x301cdb(0x449)][_0x301cdb(0x1ea)]['id']});expect(result)['to'][_0x301cdb(0x405)],qWLOWV[_0x301cdb(0x26b)](expect,result[_0x301cdb(0x1f8)])['to']['be'][_0x301cdb(0x30a)];}),it(wdQtMN[_0x5063a9(0x33b)]+wdQtMN[_0x5063a9(0x320)],async()=>{const _0x4f486d=_0x5063a9,delegatedCapability=await EMpmzw[_0x4f486d(0x2ae)](_delegate,{'parentCapability':capabilities[_0x4f486d(0x449)][_0x4f486d(0x1ea)],'controller':bob[_0x4f486d(0x1c4)]('capabilityInvocation',0x0)['id'],'delegator':alice}),result=await EMpmzw['mcXzH'](_verifyDelegation,{'delegation':delegatedCapability,'expectedRootCapability':EMpmzw[_0x4f486d(0x2cd)]});expect(result)['to'][_0x4f486d(0x405)],expect(result[_0x4f486d(0x1f8)])['to']['be'][_0x4f486d(0x33f)],result[_0x4f486d(0x20c)][_0x4f486d(0x403)][_0x4f486d(0x461)][_0x4f486d(0x1ae)](EMpmzw[_0x4f486d(0x2b8)]);const [error]=result['error'][_0x4f486d(0x49f)];error[_0x4f486d(0x283)][_0x4f486d(0x461)][_0x4f486d(0x28f)](_0x4f486d(0x2d1));}),it(wdQtMN[_0x5063a9(0x2dc)],async()=>{const _0x34ebef=_0x5063a9,delegatedCapability=await _delegate({'parentCapability':capabilities['root'][_0x34ebef(0x1ea)],'controller':bob[_0x34ebef(0x1c4)](EMpmzw[_0x34ebef(0x251)],0x0)['id'],'delegator':alice}),doc=clone(mock[_0x34ebef(0x217)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':'read'}),result=await EMpmzw['gtChj'](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x34ebef(0x449)][_0x34ebef(0x1ea)],'expectedAction':EMpmzw[_0x34ebef(0x2ac)]});EMpmzw['KLwXA'](expect,result)['to'][_0x34ebef(0x405)],EMpmzw['gtChj'](expect,result[_0x34ebef(0x1f8)])['to']['be'][_0x34ebef(0x30a)];});}),context(wdQtMN[_0x1033b2(0x3bd)],()=>{const _0x128de3=_0x1033b2,qRwlve={'NCWFg':wdQtMN[_0x128de3(0x28c)],'jxvBE':function(callee,param1){const _0x5d16ae=_0x128de3;return wdQtMN[_0x5d16ae(0x249)](callee,param1);},'zhQjo':function(callee){return callee();},'otQlF':function(callee,param1){const _0x2f1ebc=_0x128de3;return wdQtMN[_0x2f1ebc(0x49a)](callee,param1);},'Vdbgq':function(callee){const _0x55b1c0=_0x128de3;return wdQtMN[_0x55b1c0(0x46f)](callee);},'OTsor':_0x128de3(0x231),'WQKAa':function(callee,param1){return callee(param1);},'saRNC':'VerificationError','QLUAM':function(callee,param1){return callee(param1);},'xtxIK':function(callee,param1){return callee(param1);},'ceGJe':function(callee,param1){const _0x61ec9e=_0x128de3;return wdQtMN[_0x61ec9e(0x450)](callee,param1);},'vrLLb':wdQtMN[_0x128de3(0x21c)],'peztG':wdQtMN['bmciR'],'RlpQT':function(x,y){return x!==y;},'aYQzl':wdQtMN['fYdHp'],'tCOwv':wdQtMN[_0x128de3(0x3b4)],'heiAO':wdQtMN[_0x128de3(0x1d8)],'LaEIx':function(callee,param1){return wdQtMN['JLAtA'](callee,param1);},'AYsNI':function(callee,param1){const _0x1eb7db=_0x128de3;return wdQtMN[_0x1eb7db(0x450)](callee,param1);},'ARQqc':function(callee,param1){return wdQtMN['CKnFt'](callee,param1);},'ddeOE':'wjKyA','jPQKd':wdQtMN['XTqKh'],'zfmEN':function(callee,param1){return wdQtMN['JTgwi'](callee,param1);},'HpcRV':_0x128de3(0x2e0),'IQnFM':_0x128de3(0x28d),'MFAQe':wdQtMN[_0x128de3(0x3e5)],'qPnQg':function(callee,param1){return callee(param1);},'pUOBq':wdQtMN[_0x128de3(0x3c0)],'VlqbM':function(callee,param1){return wdQtMN['VEpud'](callee,param1);},'PgfXd':function(callee,param1){return callee(param1);},'kIuiB':function(callee,param1){return callee(param1);},'moGOp':function(callee,param1){const _0x1ed33d=_0x128de3;return wdQtMN[_0x1ed33d(0x4a9)](callee,param1);},'FrOGX':function(callee,param1){const _0xd9591a=_0x128de3;return wdQtMN[_0xd9591a(0x1ad)](callee,param1);},'pHTQs':_0x128de3(0x2df),'vgJio':wdQtMN[_0x128de3(0x37a)],'DQfVu':'foo','mfGNS':wdQtMN[_0x128de3(0x284)],'GKiOc':_0x128de3(0x40a),'JxagT':function(callee,param1){return callee(param1);},'hPbxP':wdQtMN['azgid'],'dqsID':function(callee,param1){const _0x501f67=_0x128de3;return wdQtMN[_0x501f67(0x249)](callee,param1);},'VBTnS':function(callee,param1){const _0x6c3ee9=_0x128de3;return wdQtMN[_0x6c3ee9(0x204)](callee,param1);},'vJqTp':function(callee,param1){return callee(param1);},'wOOQh':function(callee,param1){return callee(param1);},'Lypki':function(callee,param1){const _0x28864d=_0x128de3;return wdQtMN[_0x28864d(0x442)](callee,param1);},'xajDR':function(x,y){return x===y;},'ayrDX':wdQtMN['lkWLA'],'aTQWq':function(x,y){const _0x2b00a0=_0x128de3;return wdQtMN[_0x2b00a0(0x1bf)](x,y);},'vDHdJ':function(x,y){return wdQtMN['jMIxu'](x,y);},'gAJAV':function(callee,param1){return callee(param1);},'figzi':function(x,y){const _0x500225=_0x128de3;return wdQtMN[_0x500225(0x1bf)](x,y);},'tjrBE':function(x,y){return x/y;},'JFHRU':wdQtMN[_0x128de3(0x382)],'kCKEo':function(callee,param1){return callee(param1);},'oraPg':_0x128de3(0x41f),'juWPL':function(callee,param1){return callee(param1);},'fbSTI':function(callee,param1){return wdQtMN['tJjOY'](callee,param1);},'tJgsn':function(callee,param1){return wdQtMN['NnjYI'](callee,param1);},'iwhND':wdQtMN['raZWo'],'paftN':function(callee,param1){return callee(param1);},'jqBPN':wdQtMN['uulYY'],'DfQvh':function(callee,param1){const _0x49db48=_0x128de3;return wdQtMN[_0x49db48(0x49a)](callee,param1);},'xjjtO':function(callee,param1){return callee(param1);},'jYhqZ':function(callee,param1){const _0x5cee82=_0x128de3;return wdQtMN[_0x5cee82(0x478)](callee,param1);},'QIeWl':function(callee,param1){const _0x2201e7=_0x128de3;return wdQtMN[_0x2201e7(0x326)](callee,param1);},'FQUgK':'has\x20been\x20revoked','bOOut':wdQtMN[_0x128de3(0x419)],'omqqK':_0x128de3(0x1bd),'zOPnG':_0x128de3(0x253),'WEhRG':_0x128de3(0x43f),'usGxx':function(callee,param1){return callee(param1);},'rdbUV':function(callee,param1){return callee(param1);},'WHhVQ':function(callee){const _0x4ae1ec=_0x128de3;return wdQtMN[_0x4ae1ec(0x47e)](callee);},'IsYgR':function(callee){const _0x150c93=_0x128de3;return wdQtMN[_0x150c93(0x46f)](callee);},'ykHZq':function(callee,param1){const _0xb45b9a=_0x128de3;return wdQtMN[_0xb45b9a(0x4a6)](callee,param1);},'pyJpW':function(x,y){return x-y;},'SFaUc':function(callee,param1){const _0x549a4f=_0x128de3;return wdQtMN[_0x549a4f(0x49a)](callee,param1);},'DXvlG':'The\x20invoked\x20capability\x20has\x20expired.','cLqcR':function(callee){const _0x5e3d9d=_0x128de3;return wdQtMN[_0x5e3d9d(0x263)](callee);},'JBGaR':function(callee,param1){return callee(param1);},'rWTlm':function(callee,param1){const _0x45e68c=_0x128de3;return wdQtMN[_0x45e68c(0x243)](callee,param1);},'yoqdF':function(x,y){return x-y;},'XgRkk':function(callee,param1){return callee(param1);},'CoAHM':function(callee){return wdQtMN['GeViK'](callee);},'DgBEL':function(callee,param1){return callee(param1);},'jEjVb':function(callee,param1){return callee(param1);},'kUWSq':function(x,y){return wdQtMN['JnhOR'](x,y);},'bWJVm':_0x128de3(0x30f),'VXJdy':function(callee){const _0x3a8942=_0x128de3;return wdQtMN[_0x3a8942(0x1ee)](callee);},'BAMIZ':function(callee,param1){return callee(param1);},'RnJtu':wdQtMN[_0x128de3(0x277)],'CiMHC':_0x128de3(0x428),'zAYyR':function(callee){return callee();},'odfAR':function(callee,param1){return callee(param1);},'Uanek':function(callee,param1){return wdQtMN['YaeJq'](callee,param1);},'LzeLK':function(callee,param1){const _0x2be327=_0x128de3;return wdQtMN[_0x2be327(0x1ad)](callee,param1);},'QbJXv':_0x128de3(0x20e),'JGXNa':wdQtMN[_0x128de3(0x4bd)],'bYfVz':function(x,y){return x+y;},'AamlV':function(callee,param1){return callee(param1);},'jYnjs':function(callee,param1){const _0x596965=_0x128de3;return wdQtMN[_0x596965(0x450)](callee,param1);},'aNVVQ':_0x128de3(0x31e),'mMEhI':function(callee,param1){return wdQtMN['Ypgar'](callee,param1);},'Pbpqs':_0x128de3(0x347),'qzEbW':_0x128de3(0x216),'OisLP':function(x,y){return x-y;},'SqEiQ':function(callee,param1){const _0x535435=_0x128de3;return wdQtMN[_0x535435(0x4a9)](callee,param1);},'GcKso':_0x128de3(0x467),'RDekz':function(x,y){const _0x156bbb=_0x128de3;return wdQtMN[_0x156bbb(0x22b)](x,y);},'AtACg':function(x,y){const _0x33b23e=_0x128de3;return wdQtMN[_0x33b23e(0x22b)](x,y);},'pAzUt':_0x128de3(0x385),'SSSXu':'kPUle','RsAKA':function(x,y){return x+y;},'reCri':function(callee,param1){const _0x402478=_0x128de3;return wdQtMN[_0x402478(0x326)](callee,param1);},'bjuKE':function(callee){return callee();},'URnmO':function(callee,param1){return callee(param1);},'nWDqU':function(callee,param1){const _0x10bc54=_0x128de3;return wdQtMN[_0x10bc54(0x3e6)](callee,param1);},'dUkBb':function(x,y){const _0x2ed7a7=_0x128de3;return wdQtMN[_0x2ed7a7(0x20b)](x,y);},'uouoI':wdQtMN[_0x128de3(0x1d4)],'fYsVo':_0x128de3(0x2c7),'kueBE':'should\x20fail\x20to\x20verify\x20root\x20capability\x20with\x20`expires`','RqDNy':function(callee,param1,param2){const _0x491434=_0x128de3;return wdQtMN[_0x491434(0x43a)](callee,param1,param2);},'waNdf':'should\x20verify\x20invoking\x20a\x20capability\x20with\x20`expires`','mhkbW':wdQtMN[_0x128de3(0x433)],'ELRLq':_0x128de3(0x3e0),'eAqgv':_0x128de3(0x1ca),'igJSw':function(callee,param1,param2){return callee(param1,param2);},'yNqBP':_0x128de3(0x3f2),'FEmRJ':wdQtMN[_0x128de3(0x328)],'AbzDF':wdQtMN[_0x128de3(0x1fe)],'irIrU':function(x,y){return x+y;},'qprjK':wdQtMN['hqVYW'],'sEiKQ':wdQtMN['Xnevt'],'ivVFb':function(callee,param1,param2){const _0x45e27e=_0x128de3;return wdQtMN[_0x45e27e(0x423)](callee,param1,param2);},'HaUld':wdQtMN[_0x128de3(0x322)],'zJQzM':wdQtMN['NfVnE'],'eiEVs':'second\x20delegated\x20capability','QhZEt':function(x,y){return x+y;},'zbkfD':'second\x20delegated\x20capability\x20that\x20expires\x20after\x20first','XJiLg':wdQtMN['EHMIi'],'tHdya':function(callee,param1,param2){const _0x4f57dc=_0x128de3;return wdQtMN[_0x4f57dc(0x423)](callee,param1,param2);},'CmOXm':function(callee,param1){return callee(param1);},'sdIYb':function(callee,param1){return callee(param1);},'xQcBB':function(callee,param1){return wdQtMN['VEpud'](callee,param1);},'IoOmB':function(callee,param1){return callee(param1);},'yyzSO':wdQtMN[_0x128de3(0x413)],'HzkBX':_0x128de3(0x1ac),'GvwPU':_0x128de3(0x358),'CriiG':_0x128de3(0x346),'LZLHJ':wdQtMN[_0x128de3(0x3e2)],'suTqb':function(callee,param1,param2){return callee(param1,param2);},'jDZkE':wdQtMN[_0x128de3(0x1aa)],'OXrMP':function(callee){return callee();},'yWGWx':function(callee,param1){return callee(param1);},'CGMFD':_0x128de3(0x323),'KIrSB':function(callee,param1){return callee(param1);},'fmzzZ':function(callee,param1){return callee(param1);},'lyzrC':function(callee){return wdQtMN['aHcOU'](callee);},'CXmtG':function(callee){const _0x856f9=_0x128de3;return wdQtMN[_0x856f9(0x46e)](callee);},'AbsUc':function(callee,param1){return callee(param1);},'BBhNd':_0x128de3(0x35f),'Izzua':function(x,y){return x===y;},'OQTlO':function(callee){return callee();},'hoxOn':function(callee,param1){return callee(param1);},'XkwlT':function(callee,param1){return wdQtMN['lxVax'](callee,param1);},'zlumC':function(callee,param1){return callee(param1);},'kNOFe':function(callee,param1){const _0x3e578e=_0x128de3;return wdQtMN[_0x3e578e(0x447)](callee,param1);},'ATjQr':function(callee,param1){return callee(param1);},'fGlzw':function(callee,param1){const _0x5b8a3d=_0x128de3;return wdQtMN[_0x5b8a3d(0x32e)](callee,param1);}};wdQtMN[_0x128de3(0x45c)](it,_0x128de3(0x4a5),async()=>{const _0x1c4000=_0x128de3,result=await EMpmzw[_0x1c4000(0x47b)](_verifyInvocation,{'invocation':mock[_0x1c4000(0x239)][_0x1c4000(0x276)],'rootCapability':capabilities['root'][_0x1c4000(0x276)],'expectedAction':_0x1c4000(0x231)});EMpmzw[_0x1c4000(0x1b3)](expect,result)['to'][_0x1c4000(0x405)],EMpmzw[_0x1c4000(0x2ae)](expect,result[_0x1c4000(0x1f8)])['to']['be'][_0x1c4000(0x30a)];}),wdQtMN[_0x128de3(0x34b)](it,_0x128de3(0x26d),async()=>{const _0x100c4e=_0x128de3,kDkyyj={'SvdwV':function(callee,param1){return callee(param1);},'GsFJD':_0x100c4e(0x2b4)};if('vBNAR'===_0x100c4e(0x491)){const fDpzgd='4|3|5|1|2|0'[_0x100c4e(0x451)]('|');let wgHqPn=0x0;while(!![]){switch(fDpzgd[wgHqPn++]){case'0':return{'error':new _0x415718(_0x100c4e(0x399)+_0x2dbdf7[0x0]['id']+'\x22\x20'+_0x100c4e(0x2cf)),'valid':![]};case'1':kDkyyj[_0x100c4e(0x270)](_0xb73135,{'capabilityChain':_0x2d65c1});continue;case'2':kDkyyj[_0x100c4e(0x270)](_0x510e0b,{'capabilityChainMeta':_0x125e69});continue;case'3':_0x4ed0a0[_0x100c4e(0x461)]['be']['an'](kDkyyj[_0x100c4e(0x2c3)]);continue;case'4':_0x55107e++;continue;case'5':_0x106a56['should'][_0x100c4e(0x4a7)][_0x100c4e(0x22d)](0x3);continue;}break;}}else{const root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':qRwlve[_0x100c4e(0x262)],'invocationTarget':'urn:some:invocation:target'};addToLoader({'doc':root});const result=await qRwlve[_0x100c4e(0x357)](_verifyDelegation,{'delegation':root,'expectedRootCapability':root['id']});expect(result)['to'][_0x100c4e(0x405)],qRwlve[_0x100c4e(0x357)](expect,result[_0x100c4e(0x1f8)])['to']['be'][_0x100c4e(0x33f)];}}),wdQtMN[_0x128de3(0x34b)](it,wdQtMN[_0x128de3(0x473)],async()=>{const _0x366145=_0x128de3,root={'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x366145(0x290)](uuid),'invocationTarget':uuid()};qRwlve['otQlF'](addToLoader,{'doc':root});const doc={'@context':ZCAP_CONTEXT_URL,'example:foo':qRwlve['Vdbgq'](uuid)},invocation=await _invoke({'doc':doc,'invoker':alpha,'capability':root,'capabilityAction':qRwlve[_0x366145(0x330)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':_0x366145(0x231)});qRwlve[_0x366145(0x4b1)](expect,result)['to'][_0x366145(0x405)],qRwlve[_0x366145(0x23c)](expect,result[_0x366145(0x1f8)])['to']['be']['false'],result[_0x366145(0x20c)][_0x366145(0x403)][_0x366145(0x461)]['equal'](qRwlve['saRNC']);const [error]=result[_0x366145(0x20c)]['errors'];error[_0x366145(0x283)][_0x366145(0x461)][_0x366145(0x28f)](_0x366145(0x3ad));}),it(wdQtMN[_0x128de3(0x298)](wdQtMN[_0x128de3(0x267)],wdQtMN[_0x128de3(0x479)]),async()=>{const _0x505f0d=_0x128de3,root={'@context':ZCAP_CONTEXT_URL,'id':EMpmzw[_0x505f0d(0x241)](uuid),'controller':bob['id'](),'invocationTarget':EMpmzw[_0x505f0d(0x446)](uuid)};addToLoader({'doc':root});const doc=EMpmzw[_0x505f0d(0x1c2)](clone,mock[_0x505f0d(0x217)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':EMpmzw[_0x505f0d(0x2ac)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':EMpmzw[_0x505f0d(0x2ac)]});EMpmzw[_0x505f0d(0x3da)](expect,result)['to'][_0x505f0d(0x405)],EMpmzw['NFuPd'](expect,result['verified'])['to']['be'][_0x505f0d(0x30a)];}),wdQtMN[_0x128de3(0x401)](it,wdQtMN[_0x128de3(0x4a3)](wdQtMN[_0x128de3(0x265)],wdQtMN['aczAy']),async()=>{const _0x5e446f=_0x128de3,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'invocationTarget':EMpmzw[_0x5e446f(0x241)](uuid),'controller':bob['id']()};addToLoader({'doc':root});const doc=EMpmzw['UZHXO'](clone,mock[_0x5e446f(0x217)]),invocation=await EMpmzw[_0x5e446f(0x489)](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':EMpmzw[_0x5e446f(0x2ac)]}),result=await EMpmzw[_0x5e446f(0x3de)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':EMpmzw['ekYUa'],'expectedRootCapability':[root['id']],'expectedTarget':root[_0x5e446f(0x3f6)]}});expect(result)['to'][_0x5e446f(0x405)],expect(result[_0x5e446f(0x1f8)])['to']['be']['true'];}),it(wdQtMN[_0x128de3(0x420)]('should\x20fail\x20to\x20verify\x20a\x20root\x20capability\x20w/\x20separate\x20target\x20when\x20',wdQtMN[_0x128de3(0x34c)]),async()=>{const _0x3a70c4=_0x128de3,root={'@context':ZCAP_CONTEXT_URL,'id':EMpmzw[_0x3a70c4(0x241)](uuid),'controller':bob['id'](),'invocationTarget':EMpmzw['SjICD'](uuid)};EMpmzw[_0x3a70c4(0x3c9)](addToLoader,{'doc':root});const doc=EMpmzw[_0x3a70c4(0x236)](clone,mock[_0x3a70c4(0x217)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':EMpmzw['ekYUa']}),expectedRootCapability=[root['id'][_0x3a70c4(0x3f7)](_0x3a70c4(0x47a),'')];let result,error;try{result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':_0x3a70c4(0x231),'expectedRootCapability':expectedRootCapability,'expectedTarget':root[_0x3a70c4(0x3f6)]}});}catch(e){error=e;}EMpmzw['iAult'](expect,result)['to'][_0x3a70c4(0x4ae)][_0x3a70c4(0x405)],EMpmzw[_0x3a70c4(0x27e)](expect,error)['to'][_0x3a70c4(0x405)],error['message']['should']['contain'](EMpmzw[_0x3a70c4(0x417)]);}),wdQtMN[_0x128de3(0x431)](it,wdQtMN['HyZFU'](_0x128de3(0x36a),_0x128de3(0x29e)),async()=>{const _0x13da30=_0x128de3;if(_0x13da30(0x3a1)!=='qWTZX')return _0x3fe65c++,_0x5c1a84[_0x13da30(0x461)]['be']['an']('array'),_0x56921d[_0x13da30(0x461)][_0x13da30(0x4a7)][_0x13da30(0x22d)](0x4),_0x5e863c['should']['be']['an'](_0x13da30(0x2b4)),_0x5e9be9['should'][_0x13da30(0x4a7)][_0x13da30(0x22d)](0x4),qRwlve[_0x13da30(0x452)](_0x247e41,{'capabilityChain':_0x25d6f0}),_0x34a9b4({'capabilityChainMeta':_0x19fd16}),{'valid':!![]};else{const root={'@context':ZCAP_CONTEXT_URL,'id':qRwlve['Vdbgq'](uuid),'controller':bob['id'](),'invocationTarget':uuid()};qRwlve['xtxIK'](addToLoader,{'doc':root});const doc=clone(mock[_0x13da30(0x217)]),invocation=await qRwlve[_0x13da30(0x4b8)](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':qRwlve[_0x13da30(0x330)]});let error,result;try{result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':_0x13da30(0x231),'expectedTarget':root[_0x13da30(0x3f6)]}});}catch(e){error=e;}qRwlve['ceGJe'](expect,result)['to'][_0x13da30(0x4ae)][_0x13da30(0x405)],qRwlve[_0x13da30(0x357)](expect,error)['to'][_0x13da30(0x405)],error[_0x13da30(0x403)]['should']['equal'](_0x13da30(0x33a)),error[_0x13da30(0x283)]['should'][_0x13da30(0x28f)](qRwlve['vrLLb']);}}),it(_0x128de3(0x219),async()=>{const _0x148786=_0x128de3,doc={'@context':ZCAP_CONTEXT_URL,'example:foo':uuid()},target1='https://zcap.example/target1',target2=qRwlve[_0x148786(0x2a0)],invocation1=await qRwlve[_0x148786(0x402)](_invoke,{'doc':doc,'invoker':alice,'purposeOptions':{'capability':capabilities[_0x148786(0x449)][_0x148786(0x466)]['id'],'capabilityAction':_0x148786(0x231),'invocationTarget':target1}}),invocation2=await qRwlve[_0x148786(0x402)](_invoke,{'doc':invocation1,'invoker':alice,'purposeOptions':{'capability':capabilities[_0x148786(0x449)][_0x148786(0x466)]['id'],'capabilityAction':_0x148786(0x231),'invocationTarget':target2}}),result=await jsigs['verify'](invocation2,{'suite':new Ed25519Signature2020(),'purpose':[new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':_0x148786(0x231),'expectedRootCapability':capabilities['root'][_0x148786(0x466)]['id'],'expectedTarget':[capabilities[_0x148786(0x449)][_0x148786(0x466)]['invocationTarget'],target1]}),new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':'read','expectedRootCapability':capabilities[_0x148786(0x449)][_0x148786(0x466)]['id'],'expectedTarget':[capabilities[_0x148786(0x449)][_0x148786(0x466)][_0x148786(0x3f6)],target2]})],'documentLoader':testLoader});qRwlve[_0x148786(0x23c)](expect,result)['to']['exist'],expect(result[_0x148786(0x1f8)])['to']['be'][_0x148786(0x30a)];}),wdQtMN['SevBH'](it,wdQtMN[_0x128de3(0x226)],async()=>{const _0x571171=_0x128de3;if(qRwlve['RlpQT'](qRwlve[_0x571171(0x1f7)],qRwlve[_0x571171(0x35b)])){const root={'@context':ZCAP_CONTEXT_URL,'id':qRwlve['zhQjo'](uuid),'controller':[qRwlve[_0x571171(0x324)],bob['id']()],'invocationTarget':uuid()};qRwlve['QLUAM'](addToLoader,{'doc':root});const doc=qRwlve[_0x571171(0x38a)](clone,mock[_0x571171(0x217)]),invocation=await qRwlve['xtxIK'](_invoke,{'doc':doc,'invoker':bob,'capability':root,'capabilityAction':qRwlve[_0x571171(0x330)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':root,'expectedAction':_0x571171(0x231)});expect(result)['to'][_0x571171(0x405)],expect(result['verified'])['to']['be'][_0x571171(0x30a)];}else _0x1ebf0e=_0x1085f5;}),it(_0x128de3(0x3e9),async()=>{const _0x4b095f=_0x128de3,root={'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':[qRwlve[_0x4b095f(0x324)],bob['id']()],'invocationTarget':qRwlve[_0x4b095f(0x22a)](uuid)};qRwlve['WQKAa'](addToLoader,{'doc':root});const doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':root,'capabilityAction':'read'}),result=await qRwlve['AYsNI'](_verifyInvocation,{'invocation':invocation,'rootCapability':root,'expectedAction':qRwlve[_0x4b095f(0x330)]});expect(result)['to'][_0x4b095f(0x405)],expect(result['verified'])['to']['be']['true'];}),wdQtMN[_0x128de3(0x3f0)](it,_0x128de3(0x3d9),async()=>{const _0x551b58=_0x128de3,delegatedCapability=await qRwlve[_0x551b58(0x42b)](_delegate,{'parentCapability':capabilities['root'][_0x551b58(0x276)],'controller':bob,'delegator':alice}),doc=qRwlve['ceGJe'](clone,mock[_0x551b58(0x217)]),invocation=await qRwlve[_0x551b58(0x4b8)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':qRwlve[_0x551b58(0x330)]}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':_0x551b58(0x231),'expectedRootCapability':_0x551b58(0x455),'expectedTarget':capabilities[_0x551b58(0x449)][_0x551b58(0x276)][_0x551b58(0x3f6)]}});qRwlve[_0x551b58(0x4b8)](expect,result)['to'][_0x551b58(0x405)],qRwlve[_0x551b58(0x4b1)](expect,result[_0x551b58(0x1f8)])['to']['be']['false'],result[_0x551b58(0x20c)][_0x551b58(0x403)][_0x551b58(0x461)][_0x551b58(0x1ae)](_0x551b58(0x2e5));const [error]=result['error']['errors'];error[_0x551b58(0x283)][_0x551b58(0x461)][_0x551b58(0x28f)](_0x551b58(0x2d1));}),it(wdQtMN[_0x128de3(0x3ea)],async()=>{const _0x5d2c62=_0x128de3,delegatedCapability=await EMpmzw[_0x5d2c62(0x3e1)](_delegate,{'parentCapability':capabilities[_0x5d2c62(0x449)]['beta'],'controller':bob,'delegator':alice}),result=await _verifyDelegation({'delegation':delegatedCapability,'expectedRootCapability':capabilities[_0x5d2c62(0x449)][_0x5d2c62(0x276)]['id']});expect(result)['to'][_0x5d2c62(0x405)],expect(result[_0x5d2c62(0x1f8)])['to']['be'][_0x5d2c62(0x30a)];}),it(wdQtMN[_0x128de3(0x32d)]+wdQtMN['tMsvP'],async()=>{const _0x5d7a03=_0x128de3;if(qRwlve[_0x5d7a03(0x4ba)](qRwlve[_0x5d7a03(0x4bb)],qRwlve[_0x5d7a03(0x2c1)])){const delegatedCapability=await _delegate({'parentCapability':capabilities[_0x5d7a03(0x449)][_0x5d7a03(0x276)],'controller':bob,'delegator':alice}),doc=clone(mock[_0x5d7a03(0x217)]),invocation=await qRwlve[_0x5d7a03(0x34a)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':qRwlve[_0x5d7a03(0x330)]}),result=await qRwlve[_0x5d7a03(0x430)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities['root']['beta'],'expectedAction':'read'});expect(result)['to']['exist'],qRwlve[_0x5d7a03(0x402)](expect,result[_0x5d7a03(0x1f8)])['to']['be']['true'];}else _0xda2b0f=_0x5c6fc5;}),it(wdQtMN[_0x128de3(0x32d)]+_0x128de3(0x1ba),async()=>{const _0x54ac63=_0x128de3,delegatedCapability=await _delegate({'parentCapability':capabilities['root'][_0x54ac63(0x276)],'controller':bob,'delegator':alice}),doc=clone(mock[_0x54ac63(0x217)]),invocation=await EMpmzw[_0x54ac63(0x448)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x54ac63(0x4bf)}),result=await EMpmzw[_0x54ac63(0x2e8)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities['root']['beta'],'expectedAction':EMpmzw[_0x54ac63(0x350)]});expect(result)['to'][_0x54ac63(0x405)],EMpmzw[_0x54ac63(0x2ee)](expect,result['verified'])['to']['be'][_0x54ac63(0x30a)];}),it(wdQtMN[_0x128de3(0x28b)](wdQtMN[_0x128de3(0x3af)],wdQtMN[_0x128de3(0x349)]),async()=>{const _0x192d9d=_0x128de3,delegatedCapability=await EMpmzw[_0x192d9d(0x38f)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':EMpmzw[_0x192d9d(0x374)](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x192d9d(0x449)]['beta']['id'],'invocationTarget':capabilities[_0x192d9d(0x449)][_0x192d9d(0x276)]['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':EMpmzw['vkgap']},'parentCapability':capabilities[_0x192d9d(0x449)][_0x192d9d(0x276)],'delegator':alice}),doc=clone(mock[_0x192d9d(0x217)]),invocation=await EMpmzw[_0x192d9d(0x4ac)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x192d9d(0x4bf)}),result=await EMpmzw[_0x192d9d(0x31d)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x192d9d(0x449)][_0x192d9d(0x276)],'expectedAction':'write'});expect(result)['to'][_0x192d9d(0x405)],expect(result['verified'])['to']['be'][_0x192d9d(0x30a)];}),wdQtMN[_0x128de3(0x387)](it,wdQtMN[_0x128de3(0x3c3)](wdQtMN[_0x128de3(0x2f4)],'matching\x20\x22capabilityAction\x22\x20not\x20found'),async()=>{const _0x235775=_0x128de3;if(qRwlve[_0x235775(0x3eb)]!==_0x235775(0x28d)){_0x83eac7&&(_0x5baade=_0x28e384[_0x235775(0x1c4)](qRwlve[_0x235775(0x33e)],0x0));let _0xcbb1;return _0x1f4842?_0xcbb1=new _0xa1793b({'capability':_0x187904[_0x235775(0x1df)]?_0x567bc9:_0x5c53aa['id'],'capabilityAction':_0x33453b,'invocationTarget':_0x2f97bd['invocationTarget']}):_0xcbb1=new _0x5a86dc(_0x3a0b54),_0x37f592[_0x235775(0x260)](_0x2fcef5,{'documentLoader':_0x119c43,'suite':new _0x17c857({'key':new _0x1292b2(_0x5b35a4),'date':_0x5355c6}),'purpose':_0xcbb1});}else{const delegatedCapability=await qRwlve['QLUAM'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x235775(0x276)]['id'],'invocationTarget':capabilities[_0x235775(0x449)][_0x235775(0x276)]['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':qRwlve[_0x235775(0x3f3)]},'parentCapability':capabilities[_0x235775(0x449)][_0x235775(0x276)],'delegator':alice}),doc=qRwlve['qPnQg'](clone,mock[_0x235775(0x217)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':''});delete invocation['proof'][_0x235775(0x427)];const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':qRwlve['MFAQe'],'expectedRootCapability':capabilities[_0x235775(0x449)][_0x235775(0x276)]['id'],'expectedTarget':capabilities[_0x235775(0x449)][_0x235775(0x276)][_0x235775(0x3f6)]}});expect(result)['to'][_0x235775(0x405)],qRwlve[_0x235775(0x37b)](expect,result[_0x235775(0x1f8)])['to']['be']['false'],result[_0x235775(0x20c)]['name']['should'][_0x235775(0x1ae)]('VerificationError');const [error]=result[_0x235775(0x20c)][_0x235775(0x49f)];error[_0x235775(0x403)][_0x235775(0x461)][_0x235775(0x1ae)](qRwlve[_0x235775(0x48d)]);}}),it(wdQtMN[_0x128de3(0x2d7)]+wdQtMN[_0x128de3(0x37d)],async()=>{const _0x328dd9=_0x128de3,delegatedCapability=await EMpmzw['MVuZS'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':EMpmzw['HASZp'](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x328dd9(0x449)]['beta']['id'],'invocationTarget':capabilities[_0x328dd9(0x449)][_0x328dd9(0x276)][_0x328dd9(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':_0x328dd9(0x4bf)},'parentCapability':capabilities[_0x328dd9(0x449)][_0x328dd9(0x276)],'delegator':alice}),doc=clone(mock[_0x328dd9(0x217)]),invocation=await EMpmzw['rUTzm'](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':_0x328dd9(0x31f)}),result=await EMpmzw[_0x328dd9(0x2e8)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x328dd9(0x449)]['beta'],'expectedAction':EMpmzw[_0x328dd9(0x350)]});expect(result)['to'][_0x328dd9(0x405)],expect(result[_0x328dd9(0x1f8)])['to']['be'][_0x328dd9(0x33f)],result['error'][_0x328dd9(0x403)][_0x328dd9(0x461)][_0x328dd9(0x1ae)](EMpmzw['Yjfwu']);const [error]=result[_0x328dd9(0x20c)][_0x328dd9(0x49f)];error[_0x328dd9(0x403)][_0x328dd9(0x461)]['equal']('NotFoundError');}),it(wdQtMN[_0x128de3(0x46c)](_0x128de3(0x2d8),_0x128de3(0x39e)),async()=>{const _0x216a7b=_0x128de3,delegatedCapability=await _delegate({'parentCapability':capabilities[_0x216a7b(0x449)][_0x216a7b(0x276)],'controller':bob,'delegator':alice}),doc=clone(mock[_0x216a7b(0x217)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':''});delete invocation[_0x216a7b(0x3b7)]['capabilityAction'];const result=await EMpmzw['NbNHZ'](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x216a7b(0x449)][_0x216a7b(0x276)],'expectedAction':EMpmzw[_0x216a7b(0x350)]});EMpmzw[_0x216a7b(0x26c)](expect,result)['to']['exist'],expect(result[_0x216a7b(0x1f8)])['to']['be']['false'],result[_0x216a7b(0x20c)][_0x216a7b(0x403)][_0x216a7b(0x461)][_0x216a7b(0x1ae)](EMpmzw[_0x216a7b(0x2b8)]);const [error]=result[_0x216a7b(0x20c)]['errors'];error['name'][_0x216a7b(0x461)][_0x216a7b(0x1ae)]('NotFoundError');}),it(wdQtMN[_0x128de3(0x3d1)](_0x128de3(0x1b2),wdQtMN['SOMOl']),async()=>{const _0x4c7725=_0x128de3;if(_0x4c7725(0x38d)!==EMpmzw[_0x4c7725(0x27c)]){const delegatedCapability=await _delegate({'parentCapability':capabilities[_0x4c7725(0x449)][_0x4c7725(0x276)],'controller':bob,'delegator':alice}),doc=EMpmzw[_0x4c7725(0x37e)](clone,mock['exampleDoc']),invocation=await EMpmzw[_0x4c7725(0x400)](_invoke,{'doc':doc,'invoker':bob,'capability':delegatedCapability,'capabilityAction':EMpmzw['vkgap']}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x4c7725(0x449)][_0x4c7725(0x276)],'expectedAction':'read'});expect(result)['to'][_0x4c7725(0x405)],expect(result[_0x4c7725(0x1f8)])['to']['be'][_0x4c7725(0x33f)],result[_0x4c7725(0x20c)][_0x4c7725(0x403)][_0x4c7725(0x461)]['equal'](EMpmzw[_0x4c7725(0x2b8)]);const [error]=result[_0x4c7725(0x20c)]['errors'];error[_0x4c7725(0x403)][_0x4c7725(0x461)][_0x4c7725(0x1ae)](EMpmzw[_0x4c7725(0x3fb)]);}else _0x12c120=_0x46f558;}),wdQtMN[_0x128de3(0x45c)](describe,_0x128de3(0x321),()=>{const _0x490e29=_0x128de3,tuSkiS={'VXNSO':_0x490e29(0x499),'ZWmYg':EMpmzw[_0x490e29(0x1c9)],'xusCd':function(callee,param1){const _0x231eb3=_0x490e29;return EMpmzw[_0x231eb3(0x27a)](callee,param1);},'srZQK':EMpmzw[_0x490e29(0x1b8)],'Wqdce':EMpmzw['ZsCry'],'yiRsK':function(callee,param1){return EMpmzw['dCuSO'](callee,param1);},'UdPsG':function(x,y){const _0x38b186=_0x490e29;return EMpmzw[_0x38b186(0x3a4)](x,y);},'kcebl':_0x490e29(0x21f),'xNdmE':'TypeError','kOdio':function(callee,param1){return callee(param1);},'yrEgL':'urn:uuid:1aaec12f-bcf2-40d8-8192-cc4dde9bca96','BqRdC':_0x490e29(0x253),'MXGOn':EMpmzw[_0x490e29(0x3fd)],'jeyeJ':_0x490e29(0x231),'irLSL':'Error','zXfOB':function(x,y){return x+y;},'VZmhJ':EMpmzw[_0x490e29(0x2ca)],'pzLgY':function(callee,param1){return EMpmzw['ocIlS'](callee,param1);},'wBltH':EMpmzw[_0x490e29(0x2b8)],'npmMd':_0x490e29(0x35f),'hIFQU':_0x490e29(0x4bf),'yOgNa':EMpmzw['olesP'],'URWYZ':function(x,y){const _0xe2cf04=_0x490e29;return EMpmzw[_0xe2cf04(0x332)](x,y);},'xcJIb':'lZPqH','mojND':function(callee,param1){return callee(param1);},'nMITD':EMpmzw['frEPJ'],'XKLyg':function(x,y){return EMpmzw['vvMAT'](x,y);},'XbwzO':function(callee,param1){return callee(param1);},'VHOxT':function(callee,param1){const _0x3c61ac=_0x490e29;return EMpmzw[_0x3c61ac(0x1f5)](callee,param1);},'kxVtN':EMpmzw[_0x490e29(0x282)],'jJXVN':function(x,y){return x*y;},'cNlWS':function(callee,param1){const _0x324243=_0x490e29;return EMpmzw[_0x324243(0x1f5)](callee,param1);},'vMExE':function(x,y){const _0x18a78c=_0x490e29;return EMpmzw[_0x18a78c(0x412)](x,y);},'ZKhav':function(callee,param1){const _0x4e5581=_0x490e29;return EMpmzw[_0x4e5581(0x29f)](callee,param1);},'YYdRU':function(callee){const _0x2ae57f=_0x490e29;return EMpmzw[_0x2ae57f(0x31a)](callee);},'umopE':function(callee,param1){return callee(param1);},'NLmAU':EMpmzw['XYVTE'],'SwRAs':EMpmzw[_0x490e29(0x21d)],'qiVwr':_0x490e29(0x304),'AuZYH':function(callee,param1){const _0xd7de44=_0x490e29;return EMpmzw[_0xd7de44(0x4b6)](callee,param1);},'aEJqc':function(callee,param1){const _0x1ff4d7=_0x490e29;return EMpmzw[_0x1ff4d7(0x3c9)](callee,param1);},'pUgrL':function(callee,param1){return callee(param1);},'stnoQ':function(callee,param1){return EMpmzw['kFwYB'](callee,param1);}};it(_0x490e29(0x358),async()=>{const _0x239621=_0x490e29,bobZcap=await qRwlve[_0x239621(0x4b5)](_delegate,{'parentCapability':capabilities[_0x239621(0x449)][_0x239621(0x276)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),result=await qRwlve[_0x239621(0x25f)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x239621(0x449)][_0x239621(0x276)]['id']});qRwlve[_0x239621(0x3e4)](expect,result)['to'][_0x239621(0x405)],expect(result[_0x239621(0x1f8)])['to']['be'][_0x239621(0x30a)];}),EMpmzw[_0x490e29(0x4b7)](it,EMpmzw[_0x490e29(0x2f1)](EMpmzw[_0x490e29(0x202)],EMpmzw[_0x490e29(0x2a7)]),async()=>{const _0x66bcf9=_0x490e29;if(tuSkiS[_0x66bcf9(0x2f9)]===tuSkiS['Wqdce']){const bobZcap=await _delegate({'parentCapability':capabilities[_0x66bcf9(0x449)][_0x66bcf9(0x276)],'controller':bob,'delegator':alice,'_capabilityChain':[capabilities[_0x66bcf9(0x449)][_0x66bcf9(0x276)]]});let carolZcap,localError;try{carolZcap=await tuSkiS['yiRsK'](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob});}catch(e){if(tuSkiS[_0x66bcf9(0x2db)](tuSkiS['kcebl'],'UXMYP')){const nblYjb=tuSkiS[_0x66bcf9(0x1d5)][_0x66bcf9(0x451)]('|');let ByEklH=0x0;while(!![]){switch(nblYjb[ByEklH++]){case'0':_0x5f001c[_0x66bcf9(0x461)]['be']['an'](tuSkiS[_0x66bcf9(0x250)]);continue;case'1':_0x349131['should']['be']['an'](_0x66bcf9(0x2b4));continue;case'2':_0x5c248f[_0x66bcf9(0x461)]['have'][_0x66bcf9(0x22d)](0x4);continue;case'3':_0x5af0f0[_0x66bcf9(0x461)][_0x66bcf9(0x4a7)][_0x66bcf9(0x22d)](0x4);continue;case'4':tuSkiS[_0x66bcf9(0x404)](_0x5ea540,{'capabilityChain':_0x2b5e8c});continue;case'5':_0x593572++;continue;case'6':return{'valid':!![]};case'7':_0x5e54bc({'capabilityChainMeta':_0x19dabb});continue;}break;}}else localError=e;}expect(localError)['to'][_0x66bcf9(0x405)],localError[_0x66bcf9(0x403)][_0x66bcf9(0x461)][_0x66bcf9(0x1ae)](tuSkiS['xNdmE']),localError[_0x66bcf9(0x283)][_0x66bcf9(0x461)][_0x66bcf9(0x28f)](_0x66bcf9(0x228)),carolZcap=await tuSkiS[_0x66bcf9(0x28a)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![]}});const result=await tuSkiS[_0x66bcf9(0x2a9)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x66bcf9(0x449)][_0x66bcf9(0x276)]['id']});should[_0x66bcf9(0x405)](result),result[_0x66bcf9(0x1f8)][_0x66bcf9(0x461)]['be'][_0x66bcf9(0x33f)],should[_0x66bcf9(0x405)](result[_0x66bcf9(0x20c)]),result[_0x66bcf9(0x20c)][_0x66bcf9(0x403)][_0x66bcf9(0x461)][_0x66bcf9(0x1ae)](_0x66bcf9(0x2e5));const [error]=result[_0x66bcf9(0x20c)][_0x66bcf9(0x49f)];error[_0x66bcf9(0x283)]['should'][_0x66bcf9(0x28f)](_0x66bcf9(0x2df));}else _0x4d7175=new _0x48f1ff({'expectedRootCapability':tuSkiS[_0x66bcf9(0x39c)],'date':'invalid\x20date'});}),it(EMpmzw['lOYUf'](EMpmzw['WAsOz'],EMpmzw[_0x490e29(0x1af)]),async()=>{const _0x41e7c8=_0x490e29,bobZcap=await qRwlve[_0x41e7c8(0x338)](_delegate,{'parentCapability':capabilities[_0x41e7c8(0x449)][_0x41e7c8(0x276)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![],'_capabilityChain':[capabilities[_0x41e7c8(0x449)][_0x41e7c8(0x276)]['id'],bobZcap['id']]}}),result=await qRwlve[_0x41e7c8(0x352)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x41e7c8(0x449)][_0x41e7c8(0x276)]['id']});should['exist'](result),result[_0x41e7c8(0x1f8)][_0x41e7c8(0x461)]['be'][_0x41e7c8(0x33f)],should[_0x41e7c8(0x405)](result[_0x41e7c8(0x20c)]),result[_0x41e7c8(0x20c)][_0x41e7c8(0x403)][_0x41e7c8(0x461)][_0x41e7c8(0x1ae)](qRwlve['saRNC']);const [error]=result[_0x41e7c8(0x20c)][_0x41e7c8(0x49f)];error['message']['should']['contain'](qRwlve['pHTQs']);}),EMpmzw[_0x490e29(0x261)](it,EMpmzw[_0x490e29(0x43e)]+_0x490e29(0x21e),async()=>{const _0x250b7f=_0x490e29,bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x250b7f(0x276)],'controller':bob,'delegator':alice,'_capabilityChain':[capabilities[_0x250b7f(0x449)]['alpha']['id']]}),carolZcap=await qRwlve[_0x250b7f(0x338)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob,'_capabilityChain':[capabilities[_0x250b7f(0x449)]['beta']['id'],bobZcap]}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x250b7f(0x449)][_0x250b7f(0x276)]['id']});should[_0x250b7f(0x405)](result),result['verified']['should']['be'][_0x250b7f(0x33f)],should[_0x250b7f(0x405)](result['error']),result['error'][_0x250b7f(0x403)][_0x250b7f(0x461)][_0x250b7f(0x1ae)](_0x250b7f(0x2e5));const [error]=result[_0x250b7f(0x20c)]['errors'];error[_0x250b7f(0x283)][_0x250b7f(0x461)][_0x250b7f(0x28f)](qRwlve[_0x250b7f(0x372)]);}),it(EMpmzw[_0x490e29(0x412)](_0x490e29(0x2cb),_0x490e29(0x299)),async()=>{const _0x12147d=_0x490e29,bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x12147d(0x276)],'controller':bob,'delegator':alice}),dianaZcap=await _delegate({'parentCapability':capabilities['root']['beta'],'controller':diana,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'_capabilityChain':[capabilities[_0x12147d(0x449)][_0x12147d(0x1ea)]['id'],dianaZcap]}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x12147d(0x449)][_0x12147d(0x276)]['id']});should[_0x12147d(0x405)](result),result[_0x12147d(0x1f8)]['should']['be'][_0x12147d(0x33f)],should[_0x12147d(0x405)](result['error']),result[_0x12147d(0x20c)]['name']['should'][_0x12147d(0x1ae)]('VerificationError');const [error]=result[_0x12147d(0x20c)][_0x12147d(0x49f)];error['message'][_0x12147d(0x461)]['contain']('does\x20not\x20match\x20the\x20parent');}),EMpmzw[_0x490e29(0x261)](it,EMpmzw[_0x490e29(0x271)]+EMpmzw[_0x490e29(0x294)],async()=>{const _0xfcbedb=_0x490e29;if(tuSkiS['MXGOn']!==_0xfcbedb(0x49b)){const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0xfcbedb(0x449)][_0xfcbedb(0x276)]['id'],'invocationTarget':capabilities[_0xfcbedb(0x449)][_0xfcbedb(0x276)][_0xfcbedb(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':tuSkiS[_0xfcbedb(0x29d)]},'parentCapability':capabilities[_0xfcbedb(0x449)]['beta'],'delegator':alice});let carolZcap,localError;try{carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0xfcbedb(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':_0xfcbedb(0x4bf)},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to']['exist'],localError[_0xfcbedb(0x403)][_0xfcbedb(0x461)][_0xfcbedb(0x1ae)](tuSkiS[_0xfcbedb(0x1d3)]),localError['message'][_0xfcbedb(0x461)][_0xfcbedb(0x1ae)](tuSkiS['zXfOB'](_0xfcbedb(0x275),tuSkiS[_0xfcbedb(0x3ce)])),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0xfcbedb(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':_0xfcbedb(0x4bf)},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await tuSkiS['pzLgY'](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0xfcbedb(0x449)]['beta']['id']});should[_0xfcbedb(0x405)](result),result[_0xfcbedb(0x1f8)][_0xfcbedb(0x461)]['be'][_0xfcbedb(0x33f)],should[_0xfcbedb(0x405)](result['error']),result[_0xfcbedb(0x20c)][_0xfcbedb(0x403)][_0xfcbedb(0x461)]['equal'](tuSkiS[_0xfcbedb(0x319)]);const [error]=result[_0xfcbedb(0x20c)][_0xfcbedb(0x49f)];error['message'][_0xfcbedb(0x461)][_0xfcbedb(0x28f)](tuSkiS['npmMd']);}else{let _0x27e0d6,_0x20d5a4;try{_0x27e0d6=new _0x4cd88e({'expectedTarget':tuSkiS['yrEgL'],'suite':new _0x5246f6(),'date':tuSkiS['BqRdC']});}catch(_0xef2d7){_0x20d5a4=_0xef2d7;}_0x1fb7c1[_0xfcbedb(0x405)](_0x20d5a4),_0x20210b[_0xfcbedb(0x4ae)][_0xfcbedb(0x405)](_0x27e0d6),_0x20d5a4[_0xfcbedb(0x461)]['be'][_0xfcbedb(0x48c)](_0x350360),_0x20d5a4[_0xfcbedb(0x283)][_0xfcbedb(0x461)][_0xfcbedb(0x28f)](_0xfcbedb(0x1d6));}}),EMpmzw[_0x490e29(0x261)](it,_0x490e29(0x38b)+EMpmzw[_0x490e29(0x364)],async()=>{const _0x131e89=_0x490e29,bobZcap=await tuSkiS[_0x131e89(0x2a9)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities['root'][_0x131e89(0x276)]['id'],'invocationTarget':capabilities[_0x131e89(0x449)][_0x131e89(0x276)][_0x131e89(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':tuSkiS[_0x131e89(0x29d)]},'parentCapability':capabilities[_0x131e89(0x449)][_0x131e89(0x276)],'delegator':alice});let carolZcap,localError;try{carolZcap=await tuSkiS['xusCd'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':[tuSkiS[_0x131e89(0x29d)],tuSkiS[_0x131e89(0x1d7)]]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to']['exist'],localError[_0x131e89(0x403)]['should'][_0x131e89(0x1ae)](_0x131e89(0x396)),localError[_0x131e89(0x283)][_0x131e89(0x461)][_0x131e89(0x1ae)](tuSkiS['zXfOB'](_0x131e89(0x275),'must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20parent.')),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x131e89(0x231),tuSkiS[_0x131e89(0x1d7)]]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x131e89(0x449)][_0x131e89(0x276)]['id']});should[_0x131e89(0x405)](result),result[_0x131e89(0x1f8)]['should']['be'][_0x131e89(0x33f)],should['exist'](result['error']),result[_0x131e89(0x20c)]['name'][_0x131e89(0x461)]['equal'](tuSkiS[_0x131e89(0x319)]);const [error]=result[_0x131e89(0x20c)][_0x131e89(0x49f)];error[_0x131e89(0x283)][_0x131e89(0x461)]['contain'](_0x131e89(0x35f));}),EMpmzw['yjTgv'](it,EMpmzw[_0x490e29(0x1c0)]('should\x20fail\x20to\x20verify\x20chain\x20',_0x490e29(0x2c5)),async()=>{const _0x27a9d7=_0x490e29,bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x27a9d7(0x449)][_0x27a9d7(0x276)]['id'],'invocationTarget':capabilities[_0x27a9d7(0x449)][_0x27a9d7(0x276)][_0x27a9d7(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':[qRwlve['OTsor'],_0x27a9d7(0x4bf)]},'parentCapability':capabilities[_0x27a9d7(0x449)][_0x27a9d7(0x276)],'delegator':alice});let carolZcap,localError;try{carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x27a9d7(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':[qRwlve[_0x27a9d7(0x334)],_0x27a9d7(0x411)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}expect(localError)['to'][_0x27a9d7(0x405)],localError['name'][_0x27a9d7(0x461)]['equal'](qRwlve[_0x27a9d7(0x25b)]),localError[_0x27a9d7(0x283)]['should'][_0x27a9d7(0x1ae)](_0x27a9d7(0x275)+qRwlve[_0x27a9d7(0x33c)]),carolZcap=await qRwlve[_0x27a9d7(0x373)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x27a9d7(0x22a)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x27a9d7(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':[qRwlve['DQfVu'],qRwlve[_0x27a9d7(0x41b)]]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root']['beta']['id']});should[_0x27a9d7(0x405)](result),result['verified'][_0x27a9d7(0x461)]['be'][_0x27a9d7(0x33f)],should['exist'](result['error']),result[_0x27a9d7(0x20c)][_0x27a9d7(0x403)][_0x27a9d7(0x461)][_0x27a9d7(0x1ae)](_0x27a9d7(0x2e5));const [error]=result[_0x27a9d7(0x20c)]['errors'];error['message'][_0x27a9d7(0x461)][_0x27a9d7(0x28f)](_0x27a9d7(0x35f));}),it(EMpmzw[_0x490e29(0x445)](_0x490e29(0x383),_0x490e29(0x301)),async()=>{const _0x21a09e=_0x490e29,bobZcap=await qRwlve[_0x21a09e(0x2f5)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x21a09e(0x449)]['beta']['id'],'invocationTarget':capabilities[_0x21a09e(0x449)][_0x21a09e(0x276)][_0x21a09e(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x21a09e(0x231),_0x21a09e(0x4bf)]},'parentCapability':capabilities[_0x21a09e(0x449)]['beta'],'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x21a09e(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':[_0x21a09e(0x231)]},'delegator':bob,'parentCapability':bobZcap}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x21a09e(0x449)][_0x21a09e(0x276)]['id']});should[_0x21a09e(0x405)](result),result['verified']['should']['be'][_0x21a09e(0x30a)];}),it(EMpmzw[_0x490e29(0x1db)](EMpmzw[_0x490e29(0x388)],'a\x20valid\x20subset\x20of\x20the\x20undefined\x20parent\x20allowedAction'),async()=>{const _0x40136b=_0x490e29,bobZcap=await qRwlve[_0x40136b(0x338)](_delegate,{'parentCapability':capabilities[_0x40136b(0x449)][_0x40136b(0x276)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x40136b(0x3f6)],'expires':EXPIRES_3000_DATE,'allowedAction':qRwlve['OTsor']},'parentCapability':bobZcap,'delegator':bob}),result=await qRwlve[_0x40136b(0x306)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x40136b(0x276)]['id']});should['exist'](result),result[_0x40136b(0x1f8)][_0x40136b(0x461)]['be']['true'];}),it(EMpmzw[_0x490e29(0x42a)],async()=>{const _0x56da41=_0x490e29;if(tuSkiS[_0x56da41(0x212)]===_0x56da41(0x33d)){let _0x27ff69;return _0x3ae15d?_0x27ff69=new _0x23bee1({'expectedTarget':_0x5b4f4d[_0x56da41(0x3f6)],'expectedRootCapability':_0xb1b8a9['id'],'expectedAction':_0x33506d,'inspectCapabilityChain':_0x395a09,'suite':new _0x144c8e(),..._0x2bcfd6}):_0x27ff69=new _0x45bbac({'suite':new _0x41d624(),..._0x128e59}),_0x175fd8[_0x56da41(0x1ef)](_0x5ef7f5,{'documentLoader':_0x2d24de,'suite':new _0x4b1f57(),'purpose':_0x27ff69});}else{const bobZcap=await tuSkiS['yiRsK'](_delegate,{'parentCapability':capabilities[_0x56da41(0x449)][_0x56da41(0x276)],'controller':bob,'delegator':alice});bobZcap['id']=uuid();const carolZcap=await tuSkiS[_0x56da41(0x2a9)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities[_0x56da41(0x449)][_0x56da41(0x276)]['id']});expect(result)['to'][_0x56da41(0x405)],expect(result[_0x56da41(0x1f8)])['to']['be'][_0x56da41(0x33f)],result[_0x56da41(0x20c)]['name'][_0x56da41(0x461)][_0x56da41(0x1ae)](tuSkiS[_0x56da41(0x319)]);}}),EMpmzw[_0x490e29(0x341)](it,_0x490e29(0x344),async()=>{const _0x46e75f=_0x490e29,bobZcap=await qRwlve[_0x46e75f(0x452)](_delegate,{'parentCapability':capabilities[_0x46e75f(0x449)][_0x46e75f(0x276)],'controller':bob,'delegator':alice}),carolZcap=await qRwlve['AYsNI'](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob});carolZcap['id']=uuid();const result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root']['beta']['id']});expect(result)['to'][_0x46e75f(0x405)],qRwlve['vJqTp'](expect,result[_0x46e75f(0x1f8)])['to']['be'][_0x46e75f(0x33f)],result[_0x46e75f(0x20c)][_0x46e75f(0x403)][_0x46e75f(0x461)][_0x46e75f(0x1ae)](qRwlve[_0x46e75f(0x210)]);const [error]=result[_0x46e75f(0x20c)][_0x46e75f(0x49f)];error['message'][_0x46e75f(0x461)][_0x46e75f(0x1ae)]('Invalid\x20signature.');}),EMpmzw[_0x490e29(0x4b7)](it,EMpmzw['SRfpY'],async()=>{const _0x469f7a=_0x490e29,bobZcap=await _delegate({'parentCapability':capabilities[_0x469f7a(0x449)][_0x469f7a(0x276)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x4caa23=_0x469f7a;if(tuSkiS[_0x4caa23(0x46d)](_0x4caa23(0x49e),tuSkiS[_0x4caa23(0x487)]))_0x2bc1bb=_0x5b3845;else{const VMNdpL=_0x4caa23(0x3b6)[_0x4caa23(0x451)]('|');let wHOCSF=0x0;while(!![]){switch(VMNdpL[wHOCSF++]){case'0':tuSkiS[_0x4caa23(0x245)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta});continue;case'1':capabilityChainMeta['should'][_0x4caa23(0x4a7)][_0x4caa23(0x22d)](0x3);continue;case'2':checkedChain++;continue;case'3':capabilityChain[_0x4caa23(0x461)][_0x4caa23(0x4a7)][_0x4caa23(0x22d)](0x3);continue;case'4':_checkCapabilityChain({'capabilityChain':capabilityChain});continue;case'5':capabilityChainMeta['should']['be']['an'](_0x4caa23(0x2b4));continue;case'6':return{'valid':!![]};case'7':capabilityChain['should']['be']['an'](_0x4caa23(0x2b4));continue;}break;}}},result=await qRwlve[_0x469f7a(0x351)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x469f7a(0x449)][_0x469f7a(0x276)]['id'],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to'][_0x469f7a(0x405)],qRwlve['dqsID'](expect,result['verified'])['to']['be'][_0x469f7a(0x30a)],checkedChain[_0x469f7a(0x461)]['equal'](0x1);}),EMpmzw[_0x490e29(0x316)](it,EMpmzw['EaYhn']('should\x20fail\x20to\x20verify\x20w/inspectCapabilityChain\x20','w/revoked\x20capability'),async()=>{const _0x5df7f0=_0x490e29,MKsTnG={'STUCf':function(callee,param1){return tuSkiS['kOdio'](callee,param1);},'FjWFp':_0x5df7f0(0x2b4)},bobZcap=await _delegate({'parentCapability':capabilities[_0x5df7f0(0x449)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x11bb60=_0x5df7f0;if(_0x11bb60(0x4c3)!==tuSkiS[_0x11bb60(0x2d2)]){const iRspBB=_0x11bb60(0x375)[_0x11bb60(0x451)]('|');let nNVuwb=0x0;while(!![]){switch(iRspBB[nNVuwb++]){case'0':checkedChain++;continue;case'1':_checkCapabilityChain({'capabilityChain':capabilityChain});continue;case'2':capabilityChain[_0x11bb60(0x461)]['have'][_0x11bb60(0x22d)](0x3);continue;case'3':return{'error':new Error(tuSkiS[_0x11bb60(0x287)](_0x11bb60(0x399)+capabilityChain[0x0]['id']+'\x22\x20',_0x11bb60(0x2cf))),'valid':![]};case'4':tuSkiS[_0x11bb60(0x20d)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta});continue;case'5':capabilityChain[_0x11bb60(0x461)]['be']['an'](_0x11bb60(0x2b4));continue;}break;}}else{const KMDiiW=_0x11bb60(0x1cd)['split']('|');let qJHuCU=0x0;while(!![]){switch(KMDiiW[qJHuCU++]){case'0':MKsTnG[_0x11bb60(0x293)](_0x4111db,{'capabilityChain':_0x8b4b41});continue;case'1':return{'valid':!![]};case'2':_0xa12d2d({'capabilityChainMeta':_0x38064b});continue;case'3':_0x199ab5[_0x11bb60(0x461)][_0x11bb60(0x4a7)][_0x11bb60(0x22d)](0x3);continue;case'4':_0x119eda++;continue;case'5':_0x4692ea[_0x11bb60(0x461)]['be']['an'](MKsTnG[_0x11bb60(0x1a8)]);continue;}break;}}},result=await tuSkiS['VHOxT'](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x5df7f0(0x449)][_0x5df7f0(0x276)]['id'],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to'][_0x5df7f0(0x405)],expect(result[_0x5df7f0(0x1f8)])['to']['be'][_0x5df7f0(0x33f)],expect(result['error'][_0x5df7f0(0x49f)][0x0])['to'][_0x5df7f0(0x405)],result[_0x5df7f0(0x20c)][_0x5df7f0(0x49f)][0x0][_0x5df7f0(0x283)][_0x5df7f0(0x461)][_0x5df7f0(0x28f)](tuSkiS[_0x5df7f0(0x1b9)]),checkedChain[_0x5df7f0(0x461)][_0x5df7f0(0x1ae)](0x1);}),EMpmzw[_0x490e29(0x316)](it,EMpmzw[_0x490e29(0x2f1)](_0x490e29(0x406),_0x490e29(0x252)),async()=>{const _0x4188aa=_0x490e29,bobZcap=await _delegate({'parentCapability':capabilities['root'][_0x4188aa(0x276)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob,'date':new Date(0x0),'purposeOptions':{'_skipLocalValidationForTesting':!![]}}),result=await qRwlve[_0x4188aa(0x42b)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x4188aa(0x449)][_0x4188aa(0x276)]['id']});expect(result)['to']['exist'],qRwlve[_0x4188aa(0x452)](expect,result[_0x4188aa(0x1f8)])['to']['be'][_0x4188aa(0x33f)],qRwlve['Lypki'](expect,result[_0x4188aa(0x20c)][_0x4188aa(0x49f)][0x0])['to'][_0x4188aa(0x405)],result[_0x4188aa(0x20c)][_0x4188aa(0x49f)][0x0][_0x4188aa(0x283)][_0x4188aa(0x461)][_0x4188aa(0x28f)](_0x4188aa(0x309));}),it(_0x490e29(0x3f5)+_0x490e29(0x26e),async()=>{const _0xeed4ef=_0x490e29;if(qRwlve[_0xeed4ef(0x3c5)](qRwlve[_0xeed4ef(0x1e6)],qRwlve[_0xeed4ef(0x1e6)])){const ttl=qRwlve[_0xeed4ef(0x3d2)](qRwlve['aTQWq'](0x3e8*0x3c,0x3c),0x18),expires=new Date(qRwlve['vDHdJ'](Date[_0xeed4ef(0x3f1)](),ttl)),bobZcap=await qRwlve[_0xeed4ef(0x416)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0xeed4ef(0x449)]['beta']['id'],'invocationTarget':capabilities[_0xeed4ef(0x449)]['beta'][_0xeed4ef(0x3f6)],'expires':expires[_0xeed4ef(0x1dd)]()},'parentCapability':capabilities[_0xeed4ef(0x449)][_0xeed4ef(0x276)],'delegator':alice}),carolZcap=await qRwlve[_0xeed4ef(0x4b5)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0xeed4ef(0x3f6)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),result=await qRwlve[_0xeed4ef(0x4b1)](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0xeed4ef(0x449)][_0xeed4ef(0x276)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});qRwlve[_0xeed4ef(0x416)](expect,result)['to'][_0xeed4ef(0x405)],qRwlve[_0xeed4ef(0x4af)](expect,result[_0xeed4ef(0x1f8)])['to']['be'][_0xeed4ef(0x33f)],qRwlve['FrOGX'](expect,result[_0xeed4ef(0x20c)]['errors'][0x0])['to'][_0xeed4ef(0x405)],result[_0xeed4ef(0x20c)][_0xeed4ef(0x49f)][0x0][_0xeed4ef(0x283)][_0xeed4ef(0x461)][_0xeed4ef(0x28f)](_0xeed4ef(0x20e));}else _0x5d34cf=_0x44152d;}),EMpmzw['GHJNS'](it,EMpmzw['lOYUf'](EMpmzw['hsbBT'],EMpmzw[_0x490e29(0x220)]),async()=>{const _0x305950=_0x490e29,ttl=qRwlve[_0x305950(0x495)](qRwlve[_0x305950(0x3d2)](0x3e8*0x3c,0x3c),0x18),delegated=new Date(qRwlve[_0x305950(0x254)](Date[_0x305950(0x3f1)](),ttl)),bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['Vdbgq'](uuid),'controller':bob['id'](),'parentCapability':capabilities[_0x305950(0x449)]['beta']['id'],'invocationTarget':capabilities[_0x305950(0x449)]['beta'][_0x305950(0x3f6)],'expires':new Date(delegated['getTime']()+qRwlve['tjrBE'](ttl,0x2))['toISOString']()},'parentCapability':capabilities['root'][_0x305950(0x276)],'delegator':alice,'date':delegated}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':bobZcap[_0x305950(0x4b9)]},'parentCapability':bobZcap,'delegator':bob,'purposeOptions':{'_skipLocalValidationForTesting':!![]}}),result=await _verifyDelegation({'delegation':carolZcap,'expectedRootCapability':capabilities['root'][_0x305950(0x276)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to']['exist'],expect(result[_0x305950(0x1f8)])['to']['be'][_0x305950(0x33f)],qRwlve[_0x305950(0x4b1)](expect,result['error'][_0x305950(0x49f)][0x0])['to'][_0x305950(0x405)],result[_0x305950(0x20c)]['errors'][0x0]['message'][_0x305950(0x461)][_0x305950(0x28f)](qRwlve[_0x305950(0x2e2)]);}),EMpmzw[_0x490e29(0x261)](it,EMpmzw[_0x490e29(0x2b7)](_0x490e29(0x280),_0x490e29(0x47c)),async()=>{const _0x30bd26=_0x490e29,ttl=tuSkiS[_0x30bd26(0x414)](0x3e8,0x3c)*0x3c*0x18,now=new Date(),bobZcap=await tuSkiS['cNlWS'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x30bd26(0x449)][_0x30bd26(0x276)]['id'],'invocationTarget':capabilities[_0x30bd26(0x449)]['beta'][_0x30bd26(0x3f6)],'expires':new Date(tuSkiS[_0x30bd26(0x278)](tuSkiS[_0x30bd26(0x496)](now[_0x30bd26(0x288)](),ttl),0x1))[_0x30bd26(0x1dd)]()},'parentCapability':capabilities['root']['beta'],'delegator':alice,'date':now}),carolZcap=await tuSkiS[_0x30bd26(0x470)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':tuSkiS[_0x30bd26(0x23a)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x30bd26(0x3f6)],'expires':bobZcap[_0x30bd26(0x4b9)]},'parentCapability':bobZcap,'delegator':bob}),result=await tuSkiS['umopE'](_verifyDelegation,{'delegation':carolZcap,'expectedRootCapability':capabilities[_0x30bd26(0x449)][_0x30bd26(0x276)]['id'],'purposeOptions':{'maxDelegationTtl':ttl}});expect(result)['to'][_0x30bd26(0x405)],tuSkiS['ZKhav'](expect,result[_0x30bd26(0x1f8)])['to']['be'][_0x30bd26(0x33f)],expect(result[_0x30bd26(0x20c)][_0x30bd26(0x49f)][0x0])['to'][_0x30bd26(0x405)],result[_0x30bd26(0x20c)]['errors'][0x0]['message'][_0x30bd26(0x461)][_0x30bd26(0x28f)](_0x30bd26(0x2e1));}),it('should\x20verify\x20invocation',async()=>{const _0x1b8f0f=_0x490e29,bobZcap=await _delegate({'parentCapability':capabilities[_0x1b8f0f(0x449)][_0x1b8f0f(0x276)],'controller':bob,'delegator':alice}),carolZcap=await qRwlve[_0x1b8f0f(0x41d)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=qRwlve[_0x1b8f0f(0x43d)](clone,mock[_0x1b8f0f(0x217)]),invocation=await qRwlve[_0x1b8f0f(0x430)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x1b8f0f(0x231)}),result=await qRwlve[_0x1b8f0f(0x416)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x1b8f0f(0x449)]['beta'],'expectedAction':qRwlve['OTsor']});qRwlve[_0x1b8f0f(0x4af)](expect,result)['to']['exist'],expect(result[_0x1b8f0f(0x1f8)])['to']['be'][_0x1b8f0f(0x30a)];}),EMpmzw[_0x490e29(0x341)](it,'should\x20verify\x20chain\x20w/\x20multiple\x20controllers',async()=>{const _0x3866c9=_0x490e29,NtEPXY={'YFLoU':_0x3866c9(0x31e),'Rdirm':_0x3866c9(0x253)};if(tuSkiS[_0x3866c9(0x2fd)]===tuSkiS['SwRAs'])_0x5acd79=new _0x89ffe7({'expectedTarget':NtEPXY[_0x3866c9(0x367)],'suite':new _0x2724fe(),'date':NtEPXY[_0x3866c9(0x296)]});else{const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'parentCapability':capabilities[_0x3866c9(0x449)]['beta']['id'],'invocationTarget':capabilities[_0x3866c9(0x449)][_0x3866c9(0x276)][_0x3866c9(0x3f6)],'expires':EXPIRES_3000_DATE,'controller':[tuSkiS[_0x3866c9(0x3b1)],bob['id']()]},'parentCapability':capabilities[_0x3866c9(0x449)][_0x3866c9(0x276)],'delegator':alice}),carolZcap=await tuSkiS[_0x3866c9(0x234)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=clone(mock[_0x3866c9(0x217)]),invocation=await tuSkiS['aEJqc'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':tuSkiS[_0x3866c9(0x29d)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':capabilities[_0x3866c9(0x449)][_0x3866c9(0x276)],'expectedAction':tuSkiS[_0x3866c9(0x29d)]});tuSkiS[_0x3866c9(0x477)](expect,result)['to'][_0x3866c9(0x405)],expect(result[_0x3866c9(0x1f8)])['to']['be']['true'];}}),EMpmzw[_0x490e29(0x261)](it,_0x490e29(0x3e8),async()=>{const _0x115bb0=_0x490e29;if(_0x115bb0(0x41f)===qRwlve[_0x115bb0(0x425)]){const bobZcap=await qRwlve[_0x115bb0(0x4c1)](_delegate,{'parentCapability':capabilities['root']['beta'],'controller':bob,'delegator':alice}),carolZcap=await qRwlve[_0x115bb0(0x430)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=clone(mock[_0x115bb0(0x217)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qRwlve[_0x115bb0(0x330)]});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x21ad7e=_0x115bb0;return checkedChain++,capabilityChain['should']['be']['an'](_0x21ad7e(0x2b4)),capabilityChain[_0x21ad7e(0x461)][_0x21ad7e(0x4a7)][_0x21ad7e(0x22d)](0x3),tuSkiS[_0x21ad7e(0x4b0)](_checkCapabilityChain,{'capabilityChain':capabilityChain}),_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta}),{'valid':!![]};},result=await qRwlve[_0x115bb0(0x31b)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x115bb0(0x449)][_0x115bb0(0x276)],'expectedAction':'read','inspectCapabilityChain':inspectCapabilityChain});qRwlve[_0x115bb0(0x338)](expect,result)['to'][_0x115bb0(0x405)],expect(result[_0x115bb0(0x1f8)])['to']['be'][_0x115bb0(0x30a)],checkedChain[_0x115bb0(0x461)][_0x115bb0(0x1ae)](0x1);}else _0x43e355=new _0x49fe54({'expectedTarget':_0xd8fabe['invocationTarget'],'expectedRootCapability':_0x14513d['id'],'expectedAction':_0x5f4659,'inspectCapabilityChain':_0x20753e,'suite':new _0x32f9b7(),..._0x24dae1});}),EMpmzw[_0x490e29(0x3ba)](it,EMpmzw[_0x490e29(0x337)](EMpmzw[_0x490e29(0x365)],'w/TTL\x20and\x20delegation\x20date\x20monotonicity\x20checks'),async()=>{const _0x29d683=_0x490e29,iWsgCq={'Rtwgg':function(callee,param1){const _0x2ff6db=_0x1123;return qRwlve[_0x2ff6db(0x24d)](callee,param1);},'bNoVR':function(callee,param1){return qRwlve['zfmEN'](callee,param1);},'RuvIy':qRwlve[_0x29d683(0x45b)],'kmuNq':function(callee,param1){const _0x43537f=_0x29d683;return qRwlve[_0x43537f(0x221)](callee,param1);}};if(_0x29d683(0x443)!==qRwlve[_0x29d683(0x39d)])return _0x3cf872++,_0x36758d[_0x29d683(0x461)]['be']['an'](_0x29d683(0x2b4)),_0x5d9c3b['should'][_0x29d683(0x4a7)]['length'](0x4),_0x13f8ef['should']['be']['an'](_0x29d683(0x2b4)),_0xf712c0[_0x29d683(0x461)][_0x29d683(0x4a7)][_0x29d683(0x22d)](0x4),iWsgCq[_0x29d683(0x214)](_0x2c9d92,{'capabilityChain':_0x29c9db}),iWsgCq['bNoVR'](_0x32bbe4,{'capabilityChainMeta':_0x44932f}),{'valid':!![]};else{const ttl=0x3e8*0x3c*0x3c*0x18,bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':capabilities[_0x29d683(0x449)][_0x29d683(0x276)]['id'],'invocationTarget':capabilities['root'][_0x29d683(0x276)]['invocationTarget'],'expires':new Date(Date['now']()+ttl/0x2)[_0x29d683(0x1dd)]()},'parentCapability':capabilities[_0x29d683(0x449)][_0x29d683(0x276)],'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x29d683(0x22a)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x29d683(0x3f6)],'expires':bobZcap[_0x29d683(0x4b9)]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x29d683(0x231)});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x41fb97=_0x29d683;return checkedChain++,capabilityChain[_0x41fb97(0x461)]['be']['an'](iWsgCq[_0x41fb97(0x359)]),capabilityChain['should'][_0x41fb97(0x4a7)][_0x41fb97(0x22d)](0x3),iWsgCq[_0x41fb97(0x2bd)](_checkCapabilityChain,{'capabilityChain':capabilityChain}),_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta}),{'valid':!![]};},result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':_0x29d683(0x231),'expectedRootCapability':capabilities[_0x29d683(0x449)]['beta']['id'],'expectedTarget':capabilities[_0x29d683(0x449)]['beta']['invocationTarget'],'inspectCapabilityChain':inspectCapabilityChain,'maxDelegationTtl':ttl}});qRwlve[_0x29d683(0x1e2)](expect,result)['to'][_0x29d683(0x405)],qRwlve[_0x29d683(0x457)](expect,result['verified'])['to']['be'][_0x29d683(0x30a)],checkedChain[_0x29d683(0x461)]['equal'](0x1);}}),it('should\x20fail\x20invoking\x20'+_0x490e29(0x2ec),async()=>{const _0x2c0946=_0x490e29,VIDGJL={'qlsaF':function(callee,param1){return callee(param1);},'snPQp':function(callee,param1){const _0x2f28e4=_0x1123;return qRwlve[_0x2f28e4(0x373)](callee,param1);}},bobZcap=await _delegate({'parentCapability':capabilities[_0x2c0946(0x449)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await qRwlve[_0x2c0946(0x416)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qRwlve['OTsor']});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x11ec2a=_0x2c0946;return checkedChain++,should[_0x11ec2a(0x405)](capabilityChain),capabilityChain[_0x11ec2a(0x461)]['be']['an'](_0x11ec2a(0x2b4)),capabilityChain['should']['have']['length'](0x3),VIDGJL[_0x11ec2a(0x32b)](_checkCapabilityChain,{'capabilityChain':capabilityChain}),VIDGJL[_0x11ec2a(0x31c)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),{'error':new Error(_0x11ec2a(0x399)+capabilityChain[0x0]['id']+_0x11ec2a(0x1f0)),'valid':![]};},result=await qRwlve[_0x2c0946(0x306)](_verifyInvocation,{'invocation':invocation,'rootCapability':capabilities[_0x2c0946(0x449)][_0x2c0946(0x276)],'expectedAction':_0x2c0946(0x231),'inspectCapabilityChain':inspectCapabilityChain});qRwlve[_0x2c0946(0x1e2)](expect,result)['to'][_0x2c0946(0x405)],qRwlve[_0x2c0946(0x1f2)](expect,result[_0x2c0946(0x1f8)])['to']['be'][_0x2c0946(0x33f)],qRwlve['QIeWl'](expect,result[_0x2c0946(0x20c)][_0x2c0946(0x49f)][0x0])['to'][_0x2c0946(0x405)],result[_0x2c0946(0x20c)][_0x2c0946(0x49f)][0x0]['message']['should'][_0x2c0946(0x28f)](qRwlve['FQUgK']),checkedChain[_0x2c0946(0x461)]['equal'](0x1);});}),describe('Expiration\x20date',()=>{const _0x4e7f6d=_0x128de3,qOSrZI={'QdAxO':qRwlve[_0x4e7f6d(0x471)],'grWQi':qRwlve[_0x4e7f6d(0x3df)],'qEfte':_0x4e7f6d(0x410),'kccDc':function(callee,param1){const _0x4d61b9=_0x4e7f6d;return qRwlve[_0x4d61b9(0x295)](callee,param1);},'Prazd':function(callee){return callee();},'fdlVr':_0x4e7f6d(0x231),'cZjBZ':function(callee,param1){return callee(param1);},'mdTvi':qRwlve[_0x4e7f6d(0x45e)],'PwlvN':'not\x20a\x20valid\x20date','UHTRM':qRwlve[_0x4e7f6d(0x210)],'NtuJq':qRwlve[_0x4e7f6d(0x49c)],'vplIU':function(x,y){return qRwlve['OisLP'](x,y);},'FmaMb':function(x,y){return x-y;},'QFDgl':function(callee,param1){return callee(param1);},'pbhkE':function(callee,param1){return callee(param1);},'rODKS':function(callee){const _0x21e568=_0x4e7f6d;return qRwlve[_0x21e568(0x290)](callee);},'vzNVA':function(callee){const _0x359482=_0x4e7f6d;return qRwlve[_0x359482(0x355)](callee);},'cmxHV':function(callee,param1){const _0x370289=_0x4e7f6d;return qRwlve[_0x370289(0x1eb)](callee,param1);},'winBl':function(callee,param1){const _0x2d2e54=_0x4e7f6d;return qRwlve[_0x2d2e54(0x1c3)](callee,param1);},'RLAHI':function(callee,param1){return callee(param1);},'RjmSc':_0x4e7f6d(0x49d),'QAjep':qRwlve[_0x4e7f6d(0x440)],'PSSko':function(x,y){return x-y;},'dfOiw':function(callee){return callee();},'jFORi':function(x,y){const _0x697877=_0x4e7f6d;return qRwlve[_0x697877(0x2b0)](x,y);},'iwcOa':qRwlve[_0x4e7f6d(0x35c)],'TZlGj':function(callee,param1){const _0x2b068f=_0x4e7f6d;return qRwlve[_0x2b068f(0x1e2)](callee,param1);},'pYLqx':function(callee,param1){return callee(param1);},'waodo':function(callee){return callee();},'gGaui':function(x,y){const _0x476c21=_0x4e7f6d;return qRwlve[_0x476c21(0x27d)](x,y);},'KRNXl':function(callee,param1){const _0x121914=_0x4e7f6d;return qRwlve[_0x121914(0x2ff)](callee,param1);},'YcrbX':function(callee,param1){return callee(param1);},'HMZtc':function(x,y){return x+y;},'RFHTD':qRwlve[_0x4e7f6d(0x33e)],'EHPwD':qRwlve[_0x4e7f6d(0x3c7)],'jzwQr':function(x,y){return x+y;},'ZpQJM':qRwlve[_0x4e7f6d(0x40c)],'EJyvE':function(callee,param1){return callee(param1);},'ChtKY':function(callee,param1){const _0x243758=_0x4e7f6d;return qRwlve[_0x243758(0x1c3)](callee,param1);},'apssa':_0x4e7f6d(0x302),'eqxoT':function(x,y){const _0x2c360d=_0x4e7f6d;return qRwlve[_0x2c360d(0x2f3)](x,y);},'RJYIX':function(callee,param1){const _0x516d2f=_0x4e7f6d;return qRwlve[_0x516d2f(0x4a1)](callee,param1);},'xfSfk':function(callee){return qRwlve['bjuKE'](callee);},'dhwFm':function(callee,param1){return callee(param1);},'ZYftb':function(callee,param1){return callee(param1);},'ybtOk':function(callee,param1){const _0x137660=_0x4e7f6d;return qRwlve[_0x137660(0x2d4)](callee,param1);},'GaLmn':'urn:zcap:1e7dfae9-85a3-40d7-97ea-20105f0b9d99','BXntn':function(callee,param1){return qRwlve['nWDqU'](callee,param1);},'tKjVP':function(x,y){return x+y;},'TkMls':'capability\x20must\x20not\x20be\x20less\x20restrictive\x20than\x20its\x20','xTcec':function(callee,param1){return callee(param1);},'jPPAx':function(callee){return qRwlve['WHhVQ'](callee);},'zjlMO':function(x,y){const _0x357ad8=_0x4e7f6d;return qRwlve[_0x357ad8(0x460)](x,y);},'MbrwL':'urn:zcap:2c41869c-95bb-4e23-9bcd-2fbb320bb440','QcIRG':function(callee){return callee();},'ZDZhM':function(callee,param1){return qRwlve['gAJAV'](callee,param1);}};it(qRwlve[_0x4e7f6d(0x2d5)],async()=>{const _0x1d3ddc=_0x4e7f6d;let result,err;try{result=new CapabilityInvocation({'expectedTarget':qOSrZI[_0x1d3ddc(0x369)],'suite':new Ed25519Signature2020(),'date':qOSrZI['grWQi']});}catch(e){err=e;}should['exist'](err),should[_0x1d3ddc(0x4ae)][_0x1d3ddc(0x405)](result),err[_0x1d3ddc(0x461)]['be'][_0x1d3ddc(0x48c)](TypeError),err[_0x1d3ddc(0x283)]['should']['contain'](_0x1d3ddc(0x1d6));}),it(qRwlve[_0x4e7f6d(0x27f)],async()=>{const _0x3c52dc=_0x4e7f6d;let result,err;try{qRwlve['bOOut']!=='aWZrE'?_0x2832cc={'@context':_0x586a0b,'id':_0x1b2955(),'controller':typeof _0x258e07==='string'?_0x178a4d:_0x251c5d['id'](),'parentCapability':_0x41697c['id'],'invocationTarget':_0x4ead47[_0x3c52dc(0x3f6)],'expires':_0x4c4d7c}:result=new CapabilityDelegation({'expectedRootCapability':qRwlve[_0x3c52dc(0x1e3)],'date':qRwlve['zOPnG']});}catch(e){err=e;}should[_0x3c52dc(0x405)](err),should[_0x3c52dc(0x4ae)][_0x3c52dc(0x405)](result),err[_0x3c52dc(0x461)]['be'][_0x3c52dc(0x48c)](TypeError),err[_0x3c52dc(0x283)][_0x3c52dc(0x461)][_0x3c52dc(0x28f)]('is\x20not\x20a\x20valid\x20date.');}),it(qRwlve[_0x4e7f6d(0x30d)],async()=>{const _0x24cb89=_0x4e7f6d,rootCapability={...capabilities['root'][_0x24cb89(0x276)]};rootCapability['id']=qRwlve[_0x24cb89(0x32c)],rootCapability[_0x24cb89(0x4b9)]=new Date()[_0x24cb89(0x1dd)](),addToLoader({'doc':rootCapability});const doc=qRwlve[_0x24cb89(0x3c6)](clone,mock[_0x24cb89(0x217)]),invocation=await _invoke({'doc':doc,'invoker':alice,'capability':rootCapability,'capabilityAction':_0x24cb89(0x231)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x24cb89(0x231)});expect(result)['to'][_0x24cb89(0x405)],expect(result[_0x24cb89(0x1f8)])['to']['be'][_0x24cb89(0x33f)],should[_0x24cb89(0x405)](result[_0x24cb89(0x20c)]),result[_0x24cb89(0x20c)][_0x24cb89(0x403)]['should'][_0x24cb89(0x1ae)]('VerificationError');const [error]=result[_0x24cb89(0x20c)]['errors'];error[_0x24cb89(0x283)][_0x24cb89(0x461)][_0x24cb89(0x28f)](_0x24cb89(0x209));}),qRwlve[_0x4e7f6d(0x44d)](it,qRwlve['waNdf'],async()=>{const _0x3e4183=_0x4e7f6d,rootCapability={...capabilities[_0x3e4183(0x449)][_0x3e4183(0x276)]};rootCapability['id']=qOSrZI[_0x3e4183(0x45f)],qOSrZI[_0x3e4183(0x390)](addToLoader,{'doc':rootCapability});let expires=new Date();expires['setHours'](expires[_0x3e4183(0x3ee)]()+0x1),expires=expires[_0x3e4183(0x1dd)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x3e4183(0x2f0)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x3e4183(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await qOSrZI[_0x3e4183(0x390)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x3e4183(0x3f6)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=qOSrZI[_0x3e4183(0x390)](clone,mock['exampleDoc']),invocation=await qOSrZI['kccDc'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x3e4183(0x231)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':qOSrZI[_0x3e4183(0x42e)]});qOSrZI[_0x3e4183(0x29a)](expect,result)['to'][_0x3e4183(0x405)],expect(result[_0x3e4183(0x1f8)])['to']['be'][_0x3e4183(0x30a)];}),it(qRwlve[_0x4e7f6d(0x368)],async()=>{const _0x25c1e3=_0x4e7f6d,rootCapability={...capabilities[_0x25c1e3(0x449)][_0x25c1e3(0x276)]};rootCapability['id']=_0x25c1e3(0x40f),qRwlve[_0x25c1e3(0x352)](addToLoader,{'doc':rootCapability});let bobZcap,localError;try{bobZcap=await qRwlve[_0x25c1e3(0x25c)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['WHhVQ'](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x25c1e3(0x3f6)],'expires':_0x25c1e3(0x4be)},'parentCapability':rootCapability,'delegator':alice});}catch(e){localError=e;}expect(bobZcap)['to']['not'][_0x25c1e3(0x405)],expect(localError)['to'][_0x25c1e3(0x405)],localError[_0x25c1e3(0x283)][_0x25c1e3(0x461)][_0x25c1e3(0x28f)](_0x25c1e3(0x325));}),it(qRwlve[_0x4e7f6d(0x24b)],async()=>{const _0x5aba42=_0x4e7f6d,rootCapability={...capabilities[_0x5aba42(0x449)][_0x5aba42(0x276)]};rootCapability['id']=qOSrZI[_0x5aba42(0x272)],addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x5aba42(0x3f6)],'expires':qOSrZI[_0x5aba42(0x269)]},'purposeOptions':{'parentCapability':rootCapability,'_skipLocalValidationForTesting':!![]},'delegator':alice}),doc=qOSrZI[_0x5aba42(0x390)](clone,mock[_0x5aba42(0x217)]),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':qOSrZI[_0x5aba42(0x42e)]}),result=await qOSrZI[_0x5aba42(0x390)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read'});expect(result)['to'][_0x5aba42(0x405)],qOSrZI[_0x5aba42(0x29a)](expect,result[_0x5aba42(0x1f8)])['to']['be']['false'],should[_0x5aba42(0x405)](result[_0x5aba42(0x20c)]),result[_0x5aba42(0x20c)]['name'][_0x5aba42(0x461)]['equal'](qOSrZI[_0x5aba42(0x41a)]);const [error]=result['error'][_0x5aba42(0x49f)];error[_0x5aba42(0x283)][_0x5aba42(0x461)][_0x5aba42(0x1ae)](_0x5aba42(0x325));}),qRwlve[_0x4e7f6d(0x44d)](it,'should\x20verify\x20invoking\x20a\x20capability\x20with\x20`expires`\x20'+_0x4e7f6d(0x315),async()=>{const _0x18346c=_0x4e7f6d,rootCapability={...capabilities['root'][_0x18346c(0x276)]};rootCapability['id']=qOSrZI['NtuJq'],qOSrZI[_0x18346c(0x390)](addToLoader,{'doc':rootCapability});const date=new Date();date[_0x18346c(0x3ed)](qOSrZI[_0x18346c(0x233)](date[_0x18346c(0x3ee)](),0x14));let expires=new Date();expires['setHours'](qOSrZI[_0x18346c(0x486)](expires[_0x18346c(0x3ee)](),0xa)),expires=expires[_0x18346c(0x1dd)]();const bobZcap=await qOSrZI[_0x18346c(0x29a)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x18346c(0x3f6)],'expires':expires},'date':date,'parentCapability':rootCapability,'delegator':alice}),carolZcap=await qOSrZI['cZjBZ'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x18346c(0x3f6)],'expires':expires},'date':date,'parentCapability':bobZcap,'delegator':bob}),doc=qOSrZI[_0x18346c(0x281)](clone,mock['exampleDoc']),invocation=await qOSrZI[_0x18346c(0x1d2)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x18346c(0x231)}),result=await qOSrZI['pbhkE'](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x18346c(0x231),'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability['invocationTarget'],'date':date}});qOSrZI[_0x18346c(0x29a)](expect,result)['to']['exist'],expect(result[_0x18346c(0x1f8)])['to']['be']['true'];}),it(qRwlve['eAqgv']+_0x4e7f6d(0x315),async()=>{const _0xb22b54=_0x4e7f6d,rootCapability={...capabilities[_0xb22b54(0x449)][_0xb22b54(0x276)]};rootCapability['id']=_0xb22b54(0x454),addToLoader({'doc':rootCapability});let expires=new Date();expires[_0xb22b54(0x3ed)](expires[_0xb22b54(0x3ee)]()-0x32),expires=expires[_0xb22b54(0x1dd)]();const bobZcap=await qRwlve['VBTnS'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0xb22b54(0x225)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0xb22b54(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),doc=clone(mock[_0xb22b54(0x217)]),invocation=await qRwlve['ykHZq'](_invoke,{'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':_0xb22b54(0x231)}),date=new Date();date[_0xb22b54(0x3ed)](qRwlve['pyJpW'](date['getHours'](),0x14));const result=await qRwlve[_0xb22b54(0x25c)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':qRwlve[_0xb22b54(0x330)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0xb22b54(0x3f6)],'date':date}});qRwlve[_0xb22b54(0x415)](expect,result)['to'][_0xb22b54(0x405)],expect(result[_0xb22b54(0x1f8)])['to']['be'][_0xb22b54(0x33f)],should[_0xb22b54(0x405)](result['error']),result['error'][_0xb22b54(0x403)][_0xb22b54(0x461)][_0xb22b54(0x1ae)](_0xb22b54(0x2e5));const [error]=result[_0xb22b54(0x20c)][_0xb22b54(0x49f)];error[_0xb22b54(0x283)][_0xb22b54(0x461)][_0xb22b54(0x1ae)](qRwlve[_0xb22b54(0x360)]);}),qRwlve[_0x4e7f6d(0x20f)](it,qRwlve[_0x4e7f6d(0x2f3)](_0x4e7f6d(0x1ca),qRwlve['yNqBP']),async()=>{const _0x1fb733=_0x4e7f6d,rootCapability={...capabilities['root'][_0x1fb733(0x276)]};rootCapability['id']=_0x1fb733(0x335),qRwlve['fbSTI'](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x1fb733(0x3ed)](qRwlve[_0x1fb733(0x254)](expires[_0x1fb733(0x3ee)](),0x32)),expires=expires[_0x1fb733(0x1dd)]();const bobZcap=await qRwlve[_0x1fb733(0x338)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x1fb733(0x24f)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x1fb733(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),doc=qRwlve[_0x1fb733(0x3fc)](clone,mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':bob,'capability':bobZcap,'capabilityAction':'read'}),date=new Date();date[_0x1fb733(0x3ed)](qRwlve[_0x1fb733(0x254)](date['getHours'](),0x64));const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':qRwlve[_0x1fb733(0x330)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x1fb733(0x3f6)],'suite':new Ed25519Signature2020(),'date':date}});expect(result)['to'][_0x1fb733(0x405)],expect(result[_0x1fb733(0x1f8)])['to']['be'][_0x1fb733(0x33f)],should[_0x1fb733(0x405)](result['error']),result[_0x1fb733(0x20c)][_0x1fb733(0x403)][_0x1fb733(0x461)]['equal'](qRwlve[_0x1fb733(0x210)]);const [error]=result[_0x1fb733(0x20c)][_0x1fb733(0x49f)];error[_0x1fb733(0x283)][_0x1fb733(0x461)][_0x1fb733(0x1ae)](_0x1fb733(0x49d));}),qRwlve[_0x4e7f6d(0x20f)](it,qRwlve[_0x4e7f6d(0x494)]+qRwlve['AbzDF'],async()=>{const _0x31dbf8=_0x4e7f6d,rootCapability={...capabilities['root'][_0x31dbf8(0x276)]};rootCapability['id']=_0x31dbf8(0x44c),qRwlve['rWTlm'](addToLoader,{'doc':rootCapability});let expires=new Date();expires['setHours'](qRwlve['vDHdJ'](expires[_0x31dbf8(0x3ee)](),0x32)),expires=expires[_0x31dbf8(0x1dd)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x31dbf8(0x290)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability['invocationTarget'],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x31dbf8(0x3ed)](qRwlve[_0x31dbf8(0x232)](expires[_0x31dbf8(0x3ee)](),0x32)),expires=expires[_0x31dbf8(0x1dd)]();const carolZcap=await qRwlve[_0x31dbf8(0x218)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['CoAHM'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x31dbf8(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=qRwlve[_0x31dbf8(0x1eb)](clone,mock[_0x31dbf8(0x217)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x31dbf8(0x231)}),date=new Date();date[_0x31dbf8(0x3ed)](qRwlve[_0x31dbf8(0x2da)](date[_0x31dbf8(0x3ee)](),0x14));const result=await qRwlve[_0x31dbf8(0x378)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':qRwlve[_0x31dbf8(0x330)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x31dbf8(0x3f6)],'date':date}});qRwlve['FrOGX'](expect,result)['to'][_0x31dbf8(0x405)],qRwlve[_0x31dbf8(0x430)](expect,result[_0x31dbf8(0x1f8)])['to']['be'][_0x31dbf8(0x33f)],should[_0x31dbf8(0x405)](result[_0x31dbf8(0x20c)]),result['error'][_0x31dbf8(0x403)][_0x31dbf8(0x461)][_0x31dbf8(0x1ae)](qRwlve[_0x31dbf8(0x210)]);const [error]=result[_0x31dbf8(0x20c)]['errors'];error['message']['should']['equal']('The\x20invoked\x20capability\x20has\x20expired.');}),it(qRwlve[_0x4e7f6d(0x254)](qRwlve[_0x4e7f6d(0x494)],qRwlve[_0x4e7f6d(0x2cc)]),async()=>{const _0x4d087c=_0x4e7f6d,rootCapability={...capabilities[_0x4d087c(0x449)][_0x4d087c(0x276)]};rootCapability['id']='urn:zcap:80a8de39-df68-4fd8-ba78-4d65a27b2009',addToLoader({'doc':rootCapability});let expires=new Date();expires['setHours'](expires['getHours']()+0x32),expires=expires[_0x4d087c(0x1dd)]();const bobZcap=await qOSrZI['QFDgl'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x4d087c(0x3a7)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x4d087c(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires['setHours'](expires[_0x4d087c(0x3ee)]()+0x19),expires=expires[_0x4d087c(0x1dd)]();const carolZcap=await qOSrZI[_0x4d087c(0x281)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x4d087c(0x24e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x4d087c(0x3f6)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=qOSrZI[_0x4d087c(0x26f)](clone,mock[_0x4d087c(0x217)]),invocation=await qOSrZI[_0x4d087c(0x29a)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x4d087c(0x231)}),date=new Date();date[_0x4d087c(0x3ed)](date['getHours']()+0x1e);const result=await qOSrZI[_0x4d087c(0x213)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':'read','expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x4d087c(0x3f6)],'suite':new Ed25519Signature2020(),'date':date}});expect(result)['to'][_0x4d087c(0x405)],qOSrZI['RLAHI'](expect,result['verified'])['to']['be'][_0x4d087c(0x33f)],should[_0x4d087c(0x405)](result[_0x4d087c(0x20c)]),result['error'][_0x4d087c(0x403)][_0x4d087c(0x461)]['equal'](_0x4d087c(0x2e5));const [error]=result[_0x4d087c(0x20c)]['errors'];error[_0x4d087c(0x283)][_0x4d087c(0x461)][_0x4d087c(0x1ae)](qOSrZI['RjmSc']);}),it(qRwlve[_0x4e7f6d(0x38c)]('should\x20fail\x20invoking\x20a\x20chain\x20depth\x203\x20capability\x20with\x20`expires`\x20','and\x20`date`\x20parameter\x20in\x20the\x20chain\x20in\x20the\x20past'),async()=>{const _0x12aba8=_0x4e7f6d,rootCapability={...capabilities[_0x12aba8(0x449)][_0x12aba8(0x276)]};rootCapability['id']=qOSrZI[_0x12aba8(0x2bc)],addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x12aba8(0x3ed)](qOSrZI[_0x12aba8(0x3ef)](expires['getHours'](),0x32)),expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x12aba8(0x2f0)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x12aba8(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await qOSrZI[_0x12aba8(0x329)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x12aba8(0x353)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x12aba8(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=qOSrZI[_0x12aba8(0x281)](clone,mock[_0x12aba8(0x217)]),invocation=await qOSrZI[_0x12aba8(0x26f)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qOSrZI['fdlVr']}),date=new Date();date[_0x12aba8(0x3ed)](qOSrZI[_0x12aba8(0x3fa)](date['getHours'](),0x14));const result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'expectedAction':qOSrZI[_0x12aba8(0x42e)],'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability[_0x12aba8(0x3f6)],'date':date}});expect(result)['to'][_0x12aba8(0x405)],expect(result['verified'])['to']['be'][_0x12aba8(0x33f)],should[_0x12aba8(0x405)](result['error']),result['error'][_0x12aba8(0x403)][_0x12aba8(0x461)][_0x12aba8(0x1ae)](_0x12aba8(0x2e5));const [error]=result[_0x12aba8(0x20c)]['errors'];error[_0x12aba8(0x283)][_0x12aba8(0x461)]['equal'](qOSrZI[_0x12aba8(0x314)]);}),qRwlve[_0x4e7f6d(0x44d)](it,_0x4e7f6d(0x1c7)+_0x4e7f6d(0x1e9),async()=>{const _0x416fe4=_0x4e7f6d;if(qRwlve['kUWSq'](qRwlve[_0x416fe4(0x3be)],_0x416fe4(0x30f))){const rootCapability={...capabilities[_0x416fe4(0x449)]['beta']};rootCapability['id']=_0x416fe4(0x285),addToLoader({'doc':rootCapability});let expires=new Date();expires['setHours'](expires['getHours']()+0x32),expires=expires[_0x416fe4(0x1dd)]();const bobZcap=await qRwlve[_0x416fe4(0x23c)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['VXJdy'](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x416fe4(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await qRwlve[_0x416fe4(0x31b)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x416fe4(0x3f6)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=qRwlve['BAMIZ'](clone,mock[_0x416fe4(0x217)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qRwlve[_0x416fe4(0x330)]}),date=new Date();date[_0x416fe4(0x3ed)](date[_0x416fe4(0x3ee)]()+0x64);const result=await qRwlve[_0x416fe4(0x357)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'expectedAction':_0x416fe4(0x231),'expectedRootCapability':rootCapability['id'],'expectedTarget':rootCapability['invocationTarget'],'suite':new Ed25519Signature2020(),'date':date}});qRwlve[_0x416fe4(0x43d)](expect,result)['to']['exist'],expect(result[_0x416fe4(0x1f8)])['to']['be'][_0x416fe4(0x33f)],should[_0x416fe4(0x405)](result[_0x416fe4(0x20c)]),result[_0x416fe4(0x20c)][_0x416fe4(0x403)][_0x416fe4(0x461)][_0x416fe4(0x1ae)]('VerificationError');const [error]=result['error']['errors'];error['message'][_0x416fe4(0x461)][_0x416fe4(0x1ae)](qRwlve[_0x416fe4(0x35c)]);}else _0x4a9b19=new _0x1c6c49({'suite':new _0x1116f7(),..._0x1c377e});}),it(qRwlve[_0x4e7f6d(0x3c4)]+qRwlve[_0x4e7f6d(0x42c)],async()=>{const _0x37e37c=_0x4e7f6d,rootCapability={...capabilities[_0x37e37c(0x449)][_0x37e37c(0x276)]};rootCapability['id']=qRwlve[_0x37e37c(0x273)],addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x37e37c(0x3ed)](expires[_0x37e37c(0x3ee)]()+0x1),expires=expires['toISOString']();const bobZcap=await qRwlve[_0x37e37c(0x4b5)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x37e37c(0x3a8)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x37e37c(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});let carolZcap,localError;try{carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['cLqcR'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x37e37c(0x3f6)]},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}qRwlve[_0x37e37c(0x1e0)](expect,localError)['to'][_0x37e37c(0x405)],localError[_0x37e37c(0x403)][_0x37e37c(0x461)][_0x37e37c(0x1ae)]('Error'),localError[_0x37e37c(0x283)][_0x37e37c(0x461)][_0x37e37c(0x28f)]('Delegated\x20capability\x20must\x20have\x20a\x20valid\x20expires\x20date'),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['zAYyR'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x37e37c(0x3f6)]},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=qRwlve[_0x37e37c(0x40e)](clone,mock['exampleDoc']),invocation=await qRwlve[_0x37e37c(0x2fc)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x37e37c(0x231)}),result=await qRwlve[_0x37e37c(0x1e0)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':qRwlve[_0x37e37c(0x330)]});expect(result)['to'][_0x37e37c(0x405)],expect(result[_0x37e37c(0x1f8)])['to']['be'][_0x37e37c(0x33f)],should[_0x37e37c(0x405)](result[_0x37e37c(0x20c)]),result[_0x37e37c(0x20c)][_0x37e37c(0x403)]['should'][_0x37e37c(0x1ae)](qRwlve[_0x37e37c(0x210)]);const [error]=result['error']['errors'];error[_0x37e37c(0x283)][_0x37e37c(0x461)][_0x37e37c(0x248)](qRwlve[_0x37e37c(0x3f8)]);}),qRwlve[_0x4e7f6d(0x393)](it,qRwlve[_0x4e7f6d(0x38c)]('should\x20fail\x20invoking\x20a\x20delegated\x20capability\x20before\x20its\x20',_0x4e7f6d(0x44f)),async()=>{const _0x53ffdb=_0x4e7f6d,rootCapability={...capabilities[_0x53ffdb(0x449)][_0x53ffdb(0x276)]};rootCapability['id']='urn:zcap:b4840a74-6cc0-11ec-819f-10bf48838a41',qOSrZI['TZlGj'](addToLoader,{'doc':rootCapability});const date=new Date();let expires=new Date();expires[_0x53ffdb(0x3ed)](expires[_0x53ffdb(0x3ee)]()+0x1),expires=expires['toISOString']();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x53ffdb(0x3f6)],'expires':expires},'date':date,'parentCapability':rootCapability,'delegator':alice}),carolZcap=await qOSrZI[_0x53ffdb(0x436)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x53ffdb(0x28e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x53ffdb(0x3f6)],'expires':expires},'date':date,'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});{const beforeDelegation=new Date(qOSrZI[_0x53ffdb(0x398)](date[_0x53ffdb(0x288)](),0x3e8)),doc=clone(mock[_0x53ffdb(0x217)]),invocation=await _invoke({'doc':doc,'date':beforeDelegation,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x53ffdb(0x231)}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x53ffdb(0x231)});qOSrZI[_0x53ffdb(0x361)](expect,result)['to'][_0x53ffdb(0x405)],qOSrZI['KRNXl'](expect,result[_0x53ffdb(0x1f8)])['to']['be'][_0x53ffdb(0x30a)];}const beforeDelegation=new Date(qOSrZI['vplIU'](date[_0x53ffdb(0x288)](),0x12d*0x3e8)),doc=clone(mock[_0x53ffdb(0x217)]),invocation=await qOSrZI['YcrbX'](_invoke,{'doc':doc,'date':beforeDelegation,'invoker':carol,'capability':carolZcap,'capabilityAction':qOSrZI[_0x53ffdb(0x42e)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x53ffdb(0x231)});expect(result)['to'][_0x53ffdb(0x405)],qOSrZI[_0x53ffdb(0x436)](expect,result['verified'])['to']['be'][_0x53ffdb(0x33f)],should['exist'](result[_0x53ffdb(0x20c)]),result[_0x53ffdb(0x20c)][_0x53ffdb(0x403)][_0x53ffdb(0x461)][_0x53ffdb(0x1ae)](qOSrZI[_0x53ffdb(0x41a)]);const [error]=result[_0x53ffdb(0x20c)][_0x53ffdb(0x49f)];error[_0x53ffdb(0x283)][_0x53ffdb(0x461)]['equal'](qOSrZI[_0x53ffdb(0x2ce)](_0x53ffdb(0x2d3),_0x53ffdb(0x408)));}),it(qRwlve[_0x4e7f6d(0x311)],async()=>{const _0x176937=_0x4e7f6d,OgKIYm={'mGJFf':qOSrZI[_0x176937(0x47f)]};if(qOSrZI[_0x176937(0x27b)]!==_0x176937(0x4a2)){const rootCapability={...capabilities[_0x176937(0x449)][_0x176937(0x276)]};rootCapability['id']=_0x176937(0x2f8),addToLoader({'doc':rootCapability});let expires=new Date();expires[_0x176937(0x3ed)](qOSrZI['HMZtc'](expires['getHours'](),0x1)),expires=expires[_0x176937(0x1dd)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x176937(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice}),afterExpired=new Date(qOSrZI['jzwQr'](Date[_0x176937(0x1fc)](expires),0x12d*0x3e8));let carolZcap,localError;try{'kPUle'!==qOSrZI[_0x176937(0x305)]?_0x1c618c=_0x253234['get'](OgKIYm[_0x176937(0x229)],0x0):carolZcap=await qOSrZI[_0x176937(0x2ed)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x176937(0x3f6)],'expires':expires},'date':afterExpired,'parentCapability':bobZcap,'delegator':bob});}catch(e){_0x176937(0x43c)!==_0x176937(0x43c)?(_0x146035[_0x176937(0x461)]['be']['an']('object'),_0xa6d8ca[_0x176937(0x461)][_0x176937(0x4a7)][_0x176937(0x36e)]('id'),_0x473cd5[_0x176937(0x461)]['have'][_0x176937(0x36e)](_0x176937(0x317)),_0x5725da['should'][_0x176937(0x4a7)]['property']('invocationTarget')):localError=e;}qOSrZI['ChtKY'](expect,localError)['to'][_0x176937(0x405)],localError[_0x176937(0x403)][_0x176937(0x461)]['equal']('Error'),localError['message'][_0x176937(0x461)][_0x176937(0x28f)](_0x176937(0x2b1)),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x176937(0x2f0)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x176937(0x3f6)],'expires':expires},'date':afterExpired,'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=clone(mock[_0x176937(0x217)]),invocation=await _invoke({'doc':doc,'date':afterExpired,'invoker':carol,'capability':carolZcap,'capabilityAction':qOSrZI[_0x176937(0x42e)]}),result=await qOSrZI[_0x176937(0x26f)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':qOSrZI[_0x176937(0x42e)],'purposeOptions':{'date':afterExpired}});expect(result)['to'][_0x176937(0x405)],expect(result[_0x176937(0x1f8)])['to']['be']['false'],should[_0x176937(0x405)](result[_0x176937(0x20c)]),result[_0x176937(0x20c)][_0x176937(0x403)][_0x176937(0x461)][_0x176937(0x1ae)](qOSrZI['UHTRM']);const [error]=result[_0x176937(0x20c)][_0x176937(0x49f)];error[_0x176937(0x283)][_0x176937(0x461)]['equal'](_0x176937(0x1f9));}else _0x4cd1b4=_0x239030;}),it(qRwlve[_0x4e7f6d(0x38c)]('should\x20fail\x20invoking\x20a\x20capability\x20with\x20',qRwlve[_0x4e7f6d(0x376)]),async()=>{const _0x3ff0b9=_0x4e7f6d,rootCapability={...capabilities['root'][_0x3ff0b9(0x276)]};rootCapability['id']=_0x3ff0b9(0x35e),addToLoader({'doc':rootCapability});let expires=new Date(0x0);expires=expires[_0x3ff0b9(0x1dd)]();const bobZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x3ff0b9(0x290)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x3ff0b9(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':rootCapability,'delegator':alice}),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x3ff0b9(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x3ff0b9(0x217)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':'read'}),result=await qRwlve[_0x3ff0b9(0x430)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0x3ff0b9(0x231)});qRwlve[_0x3ff0b9(0x42b)](expect,result)['to'][_0x3ff0b9(0x405)],qRwlve[_0x3ff0b9(0x306)](expect,result[_0x3ff0b9(0x1f8)])['to']['be'][_0x3ff0b9(0x33f)],should['exist'](result[_0x3ff0b9(0x20c)]),result[_0x3ff0b9(0x20c)]['errors'][_0x3ff0b9(0x461)]['have']['length'](0x1);const [error]=result[_0x3ff0b9(0x20c)][_0x3ff0b9(0x49f)];error[_0x3ff0b9(0x283)][_0x3ff0b9(0x461)][_0x3ff0b9(0x1ae)]('A\x20capability\x20in\x20the\x20delegation\x20chain\x20has\x20expired.');}),qRwlve[_0x4e7f6d(0x44d)](it,'should\x20fail\x20invoking\x20a\x20capability\x20with\x20expired\x20'+qRwlve[_0x4e7f6d(0x1e7)],async()=>{const _0x42f3db=_0x4e7f6d,rootCapability={...capabilities[_0x42f3db(0x449)]['beta']};rootCapability['id']=qRwlve[_0x42f3db(0x2e4)],qRwlve['kCKEo'](addToLoader,{'doc':rootCapability});let expires=new Date();expires[_0x42f3db(0x3ed)](qRwlve[_0x42f3db(0x1ab)](expires[_0x42f3db(0x3ee)](),0xa)),expires=expires['toISOString']();const bobZcap=await qRwlve[_0x42f3db(0x452)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x42f3db(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0x42f3db(0x3ed)](expires[_0x42f3db(0x3ee)]()-0xa),expires=expires['toISOString']();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['WHhVQ'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x42f3db(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=qRwlve[_0x42f3db(0x41d)](clone,mock[_0x42f3db(0x217)]),invocation=await qRwlve[_0x42f3db(0x242)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qRwlve[_0x42f3db(0x330)]}),result=await qRwlve[_0x42f3db(0x2ff)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':qRwlve[_0x42f3db(0x330)]});expect(result)['to'][_0x42f3db(0x405)],expect(result['verified'])['to']['be']['false'],should['exist'](result[_0x42f3db(0x20c)]),result['error'][_0x42f3db(0x403)][_0x42f3db(0x461)][_0x42f3db(0x1ae)](qRwlve[_0x42f3db(0x210)]);const [error]=result[_0x42f3db(0x20c)]['errors'];error[_0x42f3db(0x283)][_0x42f3db(0x461)][_0x42f3db(0x1ae)](qRwlve[_0x42f3db(0x360)]);}),qRwlve[_0x4e7f6d(0x393)](it,_0x4e7f6d(0x3bb)+_0x4e7f6d(0x4b4),async()=>{const _0x5134b2=_0x4e7f6d,rootCapability={...capabilities[_0x5134b2(0x449)]['beta']};rootCapability['id']=qOSrZI[_0x5134b2(0x1cf)],addToLoader({'doc':rootCapability});let expires=new Date();expires['setHours'](qOSrZI['eqxoT'](expires[_0x5134b2(0x3ee)](),0xa)),expires=expires[_0x5134b2(0x1dd)]();const bobZcap=await qOSrZI['RJYIX'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x5134b2(0x429)](uuid),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0x5134b2(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(0x0),expires=expires[_0x5134b2(0x1dd)]();const carolZcap=await qOSrZI[_0x5134b2(0x436)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x5134b2(0x353)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=qOSrZI['dhwFm'](clone,mock[_0x5134b2(0x217)]),invocation=await qOSrZI[_0x5134b2(0x2c6)](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qOSrZI[_0x5134b2(0x42e)]}),result=await qOSrZI[_0x5134b2(0x264)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':qOSrZI[_0x5134b2(0x42e)]});expect(result)['to'][_0x5134b2(0x405)],expect(result[_0x5134b2(0x1f8)])['to']['be']['false'],should['exist'](result['error']),result['error'][_0x5134b2(0x49f)][_0x5134b2(0x461)][_0x5134b2(0x4a7)][_0x5134b2(0x22d)](0x1);const [error]=result['error']['errors'];error[_0x5134b2(0x283)][_0x5134b2(0x461)][_0x5134b2(0x1ae)](qOSrZI[_0x5134b2(0x32f)]);}),it(qRwlve[_0x4e7f6d(0x2fb)]('should\x20fail\x20invoking\x20a\x20capability\x20with\x20',qRwlve[_0x4e7f6d(0x29c)]),async()=>{const _0xa5ea49=_0x4e7f6d,rootCapability={...capabilities['root'][_0xa5ea49(0x276)]};rootCapability['id']=qOSrZI[_0xa5ea49(0x333)],addToLoader({'doc':rootCapability});let expires=new Date();expires[_0xa5ea49(0x3ed)](expires[_0xa5ea49(0x3ee)]()+0xa),expires=expires['toISOString']();const bobZcap=await qOSrZI[_0xa5ea49(0x436)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':bob['id'](),'parentCapability':rootCapability['id'],'invocationTarget':rootCapability[_0xa5ea49(0x3f6)],'expires':expires},'parentCapability':rootCapability,'delegator':alice});expires=new Date(),expires[_0xa5ea49(0x3ed)](qOSrZI[_0xa5ea49(0x432)](expires['getHours'](),0x64)),expires=expires[_0xa5ea49(0x1dd)]();let carolZcap,localError;try{carolZcap=await qOSrZI[_0xa5ea49(0x329)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0xa5ea49(0x3f6)],'expires':expires},'parentCapability':bobZcap,'delegator':bob});}catch(e){localError=e;}qOSrZI[_0xa5ea49(0x480)](expect,localError)['to']['exist'],localError[_0xa5ea49(0x403)][_0xa5ea49(0x461)]['equal'](_0xa5ea49(0x396)),localError[_0xa5ea49(0x283)][_0xa5ea49(0x461)][_0xa5ea49(0x1ae)](qOSrZI[_0xa5ea49(0x3d8)]('The\x20`expires`\x20property\x20in\x20a\x20delegated\x20'+qOSrZI['TkMls'],'parent.')),carolZcap=await qOSrZI[_0xa5ea49(0x327)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0xa5ea49(0x488)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob});const doc=clone(mock[_0xa5ea49(0x217)]),invocation=await qOSrZI['xTcec'](_invoke,{'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0xa5ea49(0x231)}),result=await qOSrZI[_0xa5ea49(0x390)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':_0xa5ea49(0x231)});expect(result)['to'][_0xa5ea49(0x405)],qOSrZI[_0xa5ea49(0x2c6)](expect,result[_0xa5ea49(0x1f8)])['to']['be'][_0xa5ea49(0x33f)],should[_0xa5ea49(0x405)](result['error']),result[_0xa5ea49(0x20c)][_0xa5ea49(0x403)]['should'][_0xa5ea49(0x1ae)](qOSrZI[_0xa5ea49(0x41a)]);const [error]=result['error']['errors'];error['message'][_0xa5ea49(0x461)][_0xa5ea49(0x28f)](_0xa5ea49(0x35f));}),it(qRwlve['XJiLg']+_0x4e7f6d(0x35a),async()=>{const _0x4dc350=_0x4e7f6d,rootCapability={...capabilities[_0x4dc350(0x449)][_0x4dc350(0x276)]};rootCapability['id']='urn:zcap:a0d0360b-7e93-4c9c-8804-69ca426c60c3',addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice});let expires=new Date();expires[_0x4dc350(0x3ed)](qOSrZI[_0x4dc350(0x377)](expires[_0x4dc350(0x3ee)](),0xa)),expires=expires[_0x4dc350(0x1dd)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x4dc350(0x24e)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x4dc350(0x3f6)],'expires':expires},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x4dc350(0x217)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':qOSrZI[_0x4dc350(0x42e)]}),result=await _verifyInvocation({'invocation':invocation,'rootCapability':rootCapability,'expectedAction':'read'});qOSrZI[_0x4dc350(0x480)](expect,result)['to'][_0x4dc350(0x405)],expect(result[_0x4dc350(0x1f8)])['to']['be']['true'];}),qRwlve[_0x4e7f6d(0x1d1)](it,'should\x20fail\x20invoking\x20a\x20capability\x20with\x20only\x20an\x20expired\x20'+_0x4e7f6d(0x35a),async()=>{const _0x1d1832=_0x4e7f6d,rootCapability={...capabilities[_0x1d1832(0x449)]['beta']};rootCapability['id']=qOSrZI[_0x1d1832(0x34f)],qOSrZI[_0x1d1832(0x259)](addToLoader,{'doc':rootCapability});const bobZcap=await qOSrZI[_0x1d1832(0x211)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice});let expires=new Date();expires[_0x1d1832(0x3ed)](qOSrZI[_0x1d1832(0x398)](expires[_0x1d1832(0x3ee)](),0xa)),expires=expires[_0x1d1832(0x1dd)]();const carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qOSrZI[_0x1d1832(0x37f)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':bobZcap[_0x1d1832(0x3f6)],'expires':expires},'purposeOptions':{'_skipLocalValidationForTesting':!![]},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x1d1832(0x217)]),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':_0x1d1832(0x231)}),result=await qOSrZI[_0x1d1832(0x465)](_verifyInvocation,{'invocation':invocation,'rootCapability':rootCapability,'expectedAction':qOSrZI[_0x1d1832(0x42e)]});expect(result)['to'][_0x1d1832(0x405)],qOSrZI[_0x1d1832(0x26f)](expect,result['verified'])['to']['be']['false'],should[_0x1d1832(0x405)](result[_0x1d1832(0x20c)]),result['error']['name'][_0x1d1832(0x461)][_0x1d1832(0x1ae)](qOSrZI['UHTRM']);const [error]=result['error'][_0x1d1832(0x49f)];error['message'][_0x1d1832(0x461)]['equal'](qOSrZI[_0x1d1832(0x32f)]);});}),describe(wdQtMN[_0x128de3(0x308)],()=>{const _0x405944=_0x128de3,OrnsqW={'Vexdp':qRwlve['HzkBX'],'Lolxw':qRwlve[_0x405944(0x45b)],'lgVho':function(callee,param1){const _0xd3f4b0=_0x405944;return qRwlve[_0xd3f4b0(0x3fc)](callee,param1);},'JyOIU':function(callee,param1){return callee(param1);},'xKvwf':_0x405944(0x384),'GWlHC':function(callee,param1){return callee(param1);}};qRwlve['tHdya'](it,qRwlve[_0x405944(0x2ef)],async()=>{const _0xb2e3e7=_0x405944,bobZcap=await qRwlve['CmOXm'](_delegate,{'parentCapability':capabilities[_0xb2e3e7(0x449)][_0xb2e3e7(0x276)],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await qRwlve[_0xb2e3e7(0x4b1)](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol}),result=await qRwlve[_0xb2e3e7(0x3c6)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities[_0xb2e3e7(0x449)][_0xb2e3e7(0x276)]['id']});expect(result)['to']['exist'],expect(result[_0xb2e3e7(0x1f8)])['to']['be'][_0xb2e3e7(0x30a)];}),it(qRwlve[_0x405944(0x434)],async()=>{const _0x48e7a9=_0x405944;if(OrnsqW[_0x48e7a9(0x386)]!==_0x48e7a9(0x36f)){const bobZcap=await _delegate({'parentCapability':capabilities[_0x48e7a9(0x449)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await OrnsqW[_0x48e7a9(0x48f)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await OrnsqW[_0x48e7a9(0x4ad)](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x2e0a8f=_0x48e7a9,lkmeTi=OrnsqW['Vexdp'][_0x2e0a8f(0x451)]('|');let ruYokQ=0x0;while(!![]){switch(lkmeTi[ruYokQ++]){case'0':capabilityChain[_0x2e0a8f(0x461)]['be']['an'](OrnsqW[_0x2e0a8f(0x230)]);continue;case'1':return{'valid':!![]};case'2':capabilityChain['should'][_0x2e0a8f(0x4a7)][_0x2e0a8f(0x22d)](0x4);continue;case'3':checkedChain++;continue;case'4':capabilityChainMeta['should']['be']['an'](_0x2e0a8f(0x2b4));continue;case'5':OrnsqW[_0x2e0a8f(0x4ad)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta});continue;case'6':OrnsqW[_0x2e0a8f(0x3a3)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'7':capabilityChainMeta['should'][_0x2e0a8f(0x4a7)][_0x2e0a8f(0x22d)](0x4);continue;}break;}},result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':capabilities[_0x48e7a9(0x449)][_0x48e7a9(0x276)]['id'],'inspectCapabilityChain':inspectCapabilityChain});expect(result)['to'][_0x48e7a9(0x405)],OrnsqW[_0x48e7a9(0x4ad)](expect,result[_0x48e7a9(0x1f8)])['to']['be'][_0x48e7a9(0x30a)],checkedChain[_0x48e7a9(0x461)][_0x48e7a9(0x1ae)](0x1);}else return _0xf4f44f[_0x48e7a9(0x1fc)](_0x176a7a[_0x48e7a9(0x24a)](_0x58ef65));}),it(qRwlve[_0x405944(0x45d)],async()=>{const _0xfa2857=_0x405944,bobZcap=await _delegate({'parentCapability':capabilities[_0xfa2857(0x449)]['beta'],'controller':bob,'delegator':alice}),carolZcap=await qRwlve[_0xfa2857(0x474)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await qRwlve[_0xfa2857(0x3e4)](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol,'purposeOptions':{'_skipLocalValidationForTesting':!![],'_capabilityChain':[capabilities[_0xfa2857(0x449)][_0xfa2857(0x276)]['id'],bobZcap,carolZcap]}}),result=await qRwlve[_0xfa2857(0x3e4)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities['root'][_0xfa2857(0x276)]['id']});qRwlve[_0xfa2857(0x295)](expect,result)['to'][_0xfa2857(0x405)],qRwlve[_0xfa2857(0x4b8)](expect,result[_0xfa2857(0x1f8)])['to']['be'][_0xfa2857(0x33f)],should['exist'](result[_0xfa2857(0x20c)]),result[_0xfa2857(0x20c)][_0xfa2857(0x403)][_0xfa2857(0x461)][_0xfa2857(0x1ae)](qRwlve[_0xfa2857(0x210)]),should[_0xfa2857(0x405)](result['error']['errors']);const [error]=result['error'][_0xfa2857(0x49f)];error['message'][_0xfa2857(0x461)][_0xfa2857(0x28f)](_0xfa2857(0x228));}),qRwlve[_0x405944(0x421)](it,_0x405944(0x3d7),async()=>{const _0x24c798=_0x405944,bobZcap=await _delegate({'parentCapability':capabilities['root']['beta'],'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),dianaZcap=await qRwlve['xQcBB'](_delegate,{'parentCapability':carolZcap,'controller':diana,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0xce698b=_0x1123;return checkedChain++,capabilityChain[_0xce698b(0x461)]['be']['an'](OrnsqW['Lolxw']),capabilityChain[_0xce698b(0x461)]['have'][_0xce698b(0x22d)](0x4),capabilityChainMeta[_0xce698b(0x461)]['be']['an'](_0xce698b(0x2b4)),capabilityChainMeta[_0xce698b(0x461)][_0xce698b(0x4a7)][_0xce698b(0x22d)](0x4),_checkCapabilityChain({'capabilityChain':capabilityChain}),OrnsqW[_0xce698b(0x4ad)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),{'valid':!![]};},result=await qRwlve['IoOmB'](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':capabilities['root']['beta']['id'],'purposeOptions':{'inspectCapabilityChain':inspectCapabilityChain,'maxChainLength':0x2}});expect(result)['to']['exist'],expect(result[_0x24c798(0x1f8)])['to']['be'][_0x24c798(0x33f)],should[_0x24c798(0x405)](result[_0x24c798(0x20c)]),should[_0x24c798(0x405)](result[_0x24c798(0x20c)][_0x24c798(0x49f)]),result['error'][_0x24c798(0x49f)][_0x24c798(0x461)]['have'][_0x24c798(0x22d)](0x1),result[_0x24c798(0x20c)][_0x24c798(0x49f)][0x0]['message'][_0x24c798(0x461)][_0x24c798(0x1ae)](qRwlve[_0x24c798(0x2e7)]),checkedChain['should'][_0x24c798(0x1ae)](0x0);});}),describe(_0x128de3(0x1f6),()=>{const _0x2110fb=_0x128de3,fuxzAk={'JmZbX':EMpmzw['UiVzd'],'FpnRf':function(callee,param1){return callee(param1);},'MUOvr':function(callee,param1){const _0x41039b=_0x1123;return EMpmzw[_0x41039b(0x201)](callee,param1);},'Zlske':function(callee,param1){const _0x298254=_0x1123;return EMpmzw[_0x298254(0x481)](callee,param1);},'VJHED':function(callee,param1){return callee(param1);},'GaEEh':EMpmzw[_0x2110fb(0x266)],'jTQgE':EMpmzw[_0x2110fb(0x3f4)],'GaWKU':EMpmzw[_0x2110fb(0x200)],'saaUP':EMpmzw[_0x2110fb(0x23d)],'abTyl':function(callee,param1){return callee(param1);},'cGcPH':function(callee){return callee();},'StpZo':_0x2110fb(0x231),'IMyJp':function(callee,param1){const _0x5952f2=_0x2110fb;return EMpmzw[_0x5952f2(0x2af)](callee,param1);},'ymMnI':function(callee,param1){const _0x27b735=_0x2110fb;return EMpmzw[_0x27b735(0x4c0)](callee,param1);},'ZqyRU':function(callee,param1){const _0x16269a=_0x2110fb;return EMpmzw[_0x16269a(0x27a)](callee,param1);},'YNISJ':function(x,y){const _0x41e6cb=_0x2110fb;return EMpmzw[_0x41e6cb(0x2c8)](x,y);},'waEWN':function(callee,param1){return callee(param1);},'uyPBI':function(callee){const _0x25cdb1=_0x2110fb;return EMpmzw[_0x25cdb1(0x374)](callee);},'NFxNt':function(callee,param1){return EMpmzw['XHNMo'](callee,param1);},'jAdxf':_0x2110fb(0x46b),'jXvjm':function(callee,param1){const _0x1b3b79=_0x2110fb;return EMpmzw[_0x1b3b79(0x354)](callee,param1);},'AqTRE':function(callee,param1){const _0x14213c=_0x2110fb;return EMpmzw[_0x14213c(0x39f)](callee,param1);},'VWNsR':EMpmzw[_0x2110fb(0x1dc)],'MvfxK':function(callee,param1){return callee(param1);},'lHndJ':_0x2110fb(0x1bd),'fnAuE':function(x,y){const _0x210271=_0x2110fb;return EMpmzw[_0x210271(0x3a4)](x,y);},'TbJbt':EMpmzw[_0x2110fb(0x203)],'UYcCI':'https://example.com/edvs/83d7e997-d742-4b1a-9033-968f222b9144','JdMyI':function(callee,param1){return callee(param1);},'Cmogl':function(callee,param1){return callee(param1);},'ecRhi':EMpmzw[_0x2110fb(0x1c9)],'hmLwi':EMpmzw[_0x2110fb(0x2a2)],'MWWFQ':function(callee,param1){return EMpmzw['TzDSW'](callee,param1);},'WkhPX':_0x2110fb(0x35f)};it(_0x2110fb(0x392),async()=>{const _0x5633cc=_0x2110fb,rootTarget=qRwlve[_0x5633cc(0x40d)],rootCapability=qRwlve[_0x5633cc(0x4b8)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x5633cc(0x3f6)]+'/a-specific-document',dianaZcap=await qRwlve[_0x5633cc(0x4b8)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x5633cc(0x32a)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await qRwlve[_0x5633cc(0x23c)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x5633cc(0x405)],qRwlve[_0x5633cc(0x240)](expect,result[_0x5633cc(0x1f8)])['to']['be'][_0x5633cc(0x30a)];}),it(EMpmzw[_0x2110fb(0x2eb)],async()=>{const _0x2e5a87=_0x2110fb,rootTarget=fuxzAk[_0x2e5a87(0x2e9)],rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});fuxzAk[_0x2e5a87(0x1da)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await _delegate({'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x2e5a87(0x3f6)]+_0x2e5a87(0x3c8),dianaZcap=await fuxzAk[_0x2e5a87(0x30c)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});fuxzAk[_0x2e5a87(0x30c)](expect,result)['to']['exist'],fuxzAk[_0x2e5a87(0x30c)](expect,result[_0x2e5a87(0x1f8)])['to']['be'][_0x2e5a87(0x30a)];}),it(EMpmzw[_0x2110fb(0x2c2)],async()=>{const _0x124034=_0x2110fb,rootTarget=_0x124034(0x3bf),rootCapability=fuxzAk['FpnRf'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});fuxzAk['FpnRf'](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await fuxzAk[_0x124034(0x1ff)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0x124034(0x3f6)]+_0x124034(0x339),dianaZcap=await fuxzAk[_0x124034(0x1da)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x124034(0x405)],fuxzAk['VJHED'](expect,result[_0x124034(0x1f8)])['to']['be'][_0x124034(0x30a)];}),it(EMpmzw[_0x2110fb(0x291)](EMpmzw[_0x2110fb(0x462)],EMpmzw[_0x2110fb(0x362)]),async()=>{const _0x32823c=_0x2110fb,rootTarget=qRwlve['CGMFD'],rootCapability=qRwlve[_0x32823c(0x24c)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x32823c(0x3f6)]+_0x32823c(0x380),carolZcap=await qRwlve['fmzzZ'](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x32823c(0x426)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0x32823c(0x34d)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap['invocationTarget'],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await qRwlve[_0x32823c(0x297)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x32823c(0x405)],expect(result[_0x32823c(0x1f8)])['to']['be'][_0x32823c(0x33f)],result[_0x32823c(0x20c)][_0x32823c(0x49f)][_0x32823c(0x461)]['have'][_0x32823c(0x22d)](0x1);const [error]=result[_0x32823c(0x20c)]['errors'];error[_0x32823c(0x283)][_0x32823c(0x461)][_0x32823c(0x248)](qRwlve[_0x32823c(0x490)]);}),it(_0x2110fb(0x3b8)+_0x2110fb(0x483),async()=>{const _0xb2b151=_0x2110fb;if(qRwlve[_0xb2b151(0x1fb)](_0xb2b151(0x43b),_0xb2b151(0x43b))){const rootTarget=_0xb2b151(0x274),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0xb2b151(0x3f6)]+_0xb2b151(0x3c8),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve['OQTlO'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':qRwlve[_0xb2b151(0x3a8)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap[_0xb2b151(0x3f6)],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await qRwlve[_0xb2b151(0x492)](_verifyDelegation,{'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'purposeOptions':{'allowTargetAttenuation':!![]}});qRwlve[_0xb2b151(0x303)](expect,result)['to'][_0xb2b151(0x405)],qRwlve[_0xb2b151(0x36d)](expect,result['verified'])['to']['be'][_0xb2b151(0x33f)],result[_0xb2b151(0x20c)]['errors'][_0xb2b151(0x461)][_0xb2b151(0x4a7)][_0xb2b151(0x22d)](0x1);const [error]=result[_0xb2b151(0x20c)][_0xb2b151(0x49f)];error[_0xb2b151(0x283)][_0xb2b151(0x461)][_0xb2b151(0x248)](_0xb2b151(0x35f));}else _0x5bbf1a=new _0x27a1fa({'parentCapability':_0x490c3b,'_capabilityChain':_0x3d817c});}),it(EMpmzw[_0x2110fb(0x2b7)](_0x2110fb(0x2ea),EMpmzw['VazkY']),async()=>{const _0x7273a7=_0x2110fb;if(_0x7273a7(0x257)!==fuxzAk['saaUP']){const rootTarget=_0x7273a7(0x371)+uuid(),rootCapability=fuxzAk[_0x7273a7(0x1e5)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});fuxzAk[_0x7273a7(0x30c)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x7273a7(0x3f6)]+_0x7273a7(0x380),carolZcap=await fuxzAk[_0x7273a7(0x1e5)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':fuxzAk[_0x7273a7(0x1fd)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':fuxzAk['StpZo']}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':fuxzAk[_0x7273a7(0x3cb)],'expectedTarget':[rootTarget,invocationTarget],'expectedRootCapability':rootCapability['id']}});fuxzAk['VJHED'](expect,result)['to'][_0x7273a7(0x405)],fuxzAk['IMyJp'](expect,result[_0x7273a7(0x1f8)])['to']['be'][_0x7273a7(0x30a)];}else for(const _0x576876 of _0x5a056c){_0x576876['should']['be']['an'](fuxzAk[_0x7273a7(0x3b9)]),_0x576876['should']['have'][_0x7273a7(0x36e)]('id'),_0x576876[_0x7273a7(0x461)][_0x7273a7(0x4a7)][_0x7273a7(0x36e)](fuxzAk['jTQgE']),_0x576876[_0x7273a7(0x461)][_0x7273a7(0x4a7)][_0x7273a7(0x36e)](fuxzAk[_0x7273a7(0x39a)]);}}),it(EMpmzw['rsrfq'](_0x2110fb(0x2ea),EMpmzw['DeNuf']),async()=>{const _0x55198c=_0x2110fb,rootTarget=_0x55198c(0x371)+uuid(),rootCapability=fuxzAk[_0x55198c(0x1e5)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});fuxzAk[_0x55198c(0x3a5)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x55198c(0x3f6)]+_0x55198c(0x3c8),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock['exampleDoc']),invocation=await _invoke({'doc':doc,'invoker':carol,'capability':carolZcap,'capabilityAction':fuxzAk[_0x55198c(0x3cb)]}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':_0x55198c(0x231),'expectedTarget':[rootTarget,invocationTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to']['exist'],expect(result['verified'])['to']['be']['true'];}),EMpmzw[_0x2110fb(0x4a0)](it,_0x2110fb(0x22f)+_0x2110fb(0x42f),async()=>{const _0x3f4613=_0x2110fb,rootTarget=_0x3f4613(0x371)+qRwlve[_0x3f4613(0x225)](uuid),rootCapability=qRwlve['kNOFe'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x3f4613(0x3f6)]+_0x3f4613(0x380),carolZcap=await qRwlve[_0x3f4613(0x4a1)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x3f4613(0x217)]),invalidTarget=rootTarget+_0x3f4613(0x424),invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x3f4613(0x231),'invocationTarget':invalidTarget}}),expectedTarget=[rootTarget,invocationTarget],purpose=new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':qRwlve[_0x3f4613(0x330)],'expectedTarget':expectedTarget,'expectedRootCapability':rootCapability['id'],'suite':new Ed25519Signature2020()});purpose[_0x3f4613(0x2f2)]=()=>!![];const result=await jsigs['verify'](invocation,{'suite':new Ed25519Signature2020(),'purpose':purpose,'documentLoader':testLoader});expect(result)['to'][_0x3f4613(0x405)],qRwlve[_0x3f4613(0x40e)](expect,result[_0x3f4613(0x1f8)])['to']['be'][_0x3f4613(0x33f)],result[_0x3f4613(0x20c)][_0x3f4613(0x49f)][_0x3f4613(0x461)]['have']['length'](0x1);const [error]=result['error']['errors'];error['message'][_0x3f4613(0x461)][_0x3f4613(0x248)]('Invocation\x20target\x20('+invalidTarget+')\x20does\x20not\x20match\x20capability\x20'+(_0x3f4613(0x3a6)+carolZcap[_0x3f4613(0x3f6)]+').'));}),EMpmzw[_0x2110fb(0x469)](it,'should\x20fail\x20to\x20verify\x20when\x20invoking\x20at\x20an\x20unexpected\x20'+'target\x20w/query',async()=>{const _0x486a87=_0x2110fb,rootTarget='https://example.com/edvs/'+uuid(),rootCapability=fuxzAk[_0x486a87(0x1e5)](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x486a87(0x3f6)]+'?foo=bar',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':fuxzAk[_0x486a87(0x1fd)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x486a87(0x217)]),invalidTarget=rootTarget+_0x486a87(0x3b5),invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x486a87(0x231),'invocationTarget':invalidTarget}}),expectedTarget=[rootTarget,invocationTarget],purpose=new CapabilityInvocation({'allowTargetAttenuation':!![],'expectedAction':fuxzAk[_0x486a87(0x3cb)],'expectedTarget':expectedTarget,'expectedRootCapability':rootCapability['id'],'suite':new Ed25519Signature2020()});purpose['match']=()=>!![];const result=await jsigs[_0x486a87(0x1ef)](invocation,{'suite':new Ed25519Signature2020(),'purpose':purpose,'documentLoader':testLoader});fuxzAk['ZqyRU'](expect,result)['to']['exist'],expect(result['verified'])['to']['be'][_0x486a87(0x33f)],result[_0x486a87(0x20c)]['errors'][_0x486a87(0x461)][_0x486a87(0x4a7)]['length'](0x1);const [error]=result[_0x486a87(0x20c)]['errors'];error['message'][_0x486a87(0x461)][_0x486a87(0x248)](fuxzAk[_0x486a87(0x268)]('Invocation\x20target\x20('+invalidTarget+')\x20does\x20not\x20match\x20capability\x20',_0x486a87(0x3a6)+carolZcap[_0x486a87(0x3f6)]+').'));}),it(_0x2110fb(0x2dd)+EMpmzw[_0x2110fb(0x397)],async()=>{const _0x502111=_0x2110fb,rootTarget=_0x502111(0x371)+uuid(),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await qRwlve['ATjQr'](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x502111(0x3f6)]+_0x502111(0x380),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x502111(0x217)]),validSubTarget=carolZcap[_0x502111(0x3f6)]+_0x502111(0x25e),invocation=await qRwlve[_0x502111(0x25a)](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':qRwlve[_0x502111(0x330)],'invocationTarget':validSubTarget}}),result=await qRwlve['kCKEo'](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':_0x502111(0x231),'expectedTarget':[rootTarget,validSubTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to'][_0x502111(0x405)],expect(result['verified'])['to']['be'][_0x502111(0x30a)];}),EMpmzw[_0x2110fb(0x215)](it,EMpmzw[_0x2110fb(0x445)](_0x2110fb(0x2dd),_0x2110fb(0x366)),async()=>{const _0x7878da=_0x2110fb,rootTarget=_0x7878da(0x371)+uuid(),rootCapability=fuxzAk['waEWN'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x7878da(0x3f6)]+'?foo=bar',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':fuxzAk['uyPBI'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=fuxzAk[_0x7878da(0x1c5)](clone,mock['exampleDoc']),validSubTarget=carolZcap[_0x7878da(0x3f6)]+_0x7878da(0x3b3),invocation=await _invoke({'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':fuxzAk['StpZo'],'invocationTarget':validSubTarget}}),result=await fuxzAk[_0x7878da(0x1c5)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':fuxzAk[_0x7878da(0x3cb)],'expectedTarget':[rootTarget,validSubTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to'][_0x7878da(0x405)],expect(result[_0x7878da(0x1f8)])['to']['be']['true'];}),EMpmzw['EowNi'](it,EMpmzw[_0x2110fb(0x227)](_0x2110fb(0x2ba),'target\x20w/path'),async()=>{const _0x326a3a=_0x2110fb;if(_0x326a3a(0x46b)!==fuxzAk[_0x326a3a(0x289)])_0x1bdfc1=_0x41e170;else{const rootTarget=_0x326a3a(0x371)+uuid(),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});fuxzAk[_0x326a3a(0x30b)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x326a3a(0x3f6)]+_0x326a3a(0x380),carolZcap=await fuxzAk[_0x326a3a(0x422)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':fuxzAk[_0x326a3a(0x36c)](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=fuxzAk['jXvjm'](clone,mock[_0x326a3a(0x217)]),invalidTarget=rootTarget+_0x326a3a(0x424),invocation=await fuxzAk[_0x326a3a(0x29b)](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':_0x326a3a(0x231),'invocationTarget':invalidTarget}}),result=await _verifyInvocation({'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':fuxzAk[_0x326a3a(0x3cb)],'expectedTarget':[rootTarget,invalidTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to']['exist'],expect(result[_0x326a3a(0x1f8)])['to']['be'][_0x326a3a(0x33f)],result[_0x326a3a(0x20c)]['errors'][_0x326a3a(0x461)][_0x326a3a(0x4a7)][_0x326a3a(0x22d)](0x1);const [error]=result[_0x326a3a(0x20c)][_0x326a3a(0x49f)];error[_0x326a3a(0x283)][_0x326a3a(0x461)][_0x326a3a(0x248)](_0x326a3a(0x3e7)+invalidTarget+_0x326a3a(0x292)+('target\x20('+carolZcap['invocationTarget']+')'));}}),it(EMpmzw['gHBEm'](EMpmzw[_0x2110fb(0x1b7)],'target\x20w/query'),async()=>{const _0x2d59df=_0x2110fb,rootTarget='https://example.com/edvs/'+fuxzAk['uyPBI'](uuid),rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap[_0x2d59df(0x3f6)]+'?foo=bar',carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),doc=clone(mock[_0x2d59df(0x217)]),invalidTarget=rootTarget+_0x2d59df(0x3b5),invocation=await fuxzAk['waEWN'](_invoke,{'doc':doc,'invoker':carol,'purposeOptions':{'capability':carolZcap,'capabilityAction':fuxzAk['StpZo'],'invocationTarget':invalidTarget}}),result=await fuxzAk[_0x2d59df(0x48b)](_verifyInvocation,{'invocation':invocation,'purposeOptions':{'allowTargetAttenuation':!![],'expectedAction':_0x2d59df(0x231),'expectedTarget':[rootTarget,invalidTarget],'expectedRootCapability':rootCapability['id']}});expect(result)['to'][_0x2d59df(0x405)],expect(result[_0x2d59df(0x1f8)])['to']['be'][_0x2d59df(0x33f)],result[_0x2d59df(0x20c)][_0x2d59df(0x49f)][_0x2d59df(0x461)][_0x2d59df(0x4a7)][_0x2d59df(0x22d)](0x1);const [error]=result[_0x2d59df(0x20c)]['errors'];error[_0x2d59df(0x283)][_0x2d59df(0x461)]['include'](fuxzAk[_0x2d59df(0x268)](_0x2d59df(0x3e7)+invalidTarget+_0x2d59df(0x292),_0x2d59df(0x3a6)+carolZcap['invocationTarget']+')'));}),EMpmzw['IRMVN'](it,EMpmzw[_0x2110fb(0x3a2)]+EMpmzw[_0x2110fb(0x345)],async()=>{const _0xc19dac=_0x2110fb,rootTarget=fuxzAk['VWNsR'],rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await fuxzAk[_0xc19dac(0x48b)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await fuxzAk[_0xc19dac(0x2c4)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0xc19dac(0x3f6)]+'/a-specific-document',dianaZcap=await fuxzAk[_0xc19dac(0x1e5)](_delegate,{'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol}),result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id']});expect(result)['to'][_0xc19dac(0x405)],expect(result[_0xc19dac(0x1f8)])['to']['be'][_0xc19dac(0x33f)],result[_0xc19dac(0x20c)][_0xc19dac(0x49f)][_0xc19dac(0x461)][_0xc19dac(0x4a7)][_0xc19dac(0x22d)](0x1);const [error]=result[_0xc19dac(0x20c)][_0xc19dac(0x49f)];error[_0xc19dac(0x283)][_0xc19dac(0x461)][_0xc19dac(0x28f)](_0xc19dac(0x44a));}),EMpmzw[_0x2110fb(0x4a0)](it,_0x2110fb(0x346),async()=>{const _0xc2c218=_0x2110fb,lMjaHJ={'mNPwW':fuxzAk['lHndJ'],'dhJFC':_0xc2c218(0x1d6),'mrrIf':'3|5|0|7|4|2|1|6','CoORx':function(callee,param1){return callee(param1);}};if(fuxzAk['fnAuE'](fuxzAk['TbJbt'],_0xc2c218(0x475))){const rootTarget=fuxzAk[_0xc2c218(0x1e1)],rootCapability=createRootCapability({'controller':alice['id'](),'invocationTarget':rootTarget});fuxzAk[_0xc2c218(0x22c)](addToLoader,{'doc':rootCapability});const bobZcap=await _delegate({'parentCapability':rootCapability,'controller':bob,'delegator':alice}),carolZcap=await fuxzAk[_0xc2c218(0x391)](_delegate,{'parentCapability':bobZcap,'controller':carol,'delegator':bob}),invocationTarget=carolZcap[_0xc2c218(0x3f6)]+_0xc2c218(0x380),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':fuxzAk[_0xc2c218(0x1fd)](uuid),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x152bc5=_0xc2c218;if('qdTQB'===_0x152bc5(0x484)){let _0x495307,_0x12cb1e;try{_0x495307=new _0x24aadc({'expectedRootCapability':lMjaHJ[_0x152bc5(0x279)],'date':_0x152bc5(0x253)});}catch(_0x4bba2f){_0x12cb1e=_0x4bba2f;}_0xb8222c[_0x152bc5(0x405)](_0x12cb1e),_0xdd499a[_0x152bc5(0x4ae)]['exist'](_0x495307),_0x12cb1e[_0x152bc5(0x461)]['be'][_0x152bc5(0x48c)](_0x25131e),_0x12cb1e[_0x152bc5(0x283)][_0x152bc5(0x461)]['contain'](lMjaHJ[_0x152bc5(0x3b0)]);}else{const KTGvvd=lMjaHJ['mrrIf'][_0x152bc5(0x451)]('|');let NMvVBz=0x0;while(!![]){switch(KTGvvd[NMvVBz++]){case'0':capabilityChain[_0x152bc5(0x461)][_0x152bc5(0x4a7)][_0x152bc5(0x22d)](0x4);continue;case'1':_checkCapabilityChainMeta({'capabilityChainMeta':capabilityChainMeta});continue;case'2':lMjaHJ[_0x152bc5(0x3ac)](_checkCapabilityChain,{'capabilityChain':capabilityChain});continue;case'3':checkedChain++;continue;case'4':capabilityChainMeta[_0x152bc5(0x461)][_0x152bc5(0x4a7)][_0x152bc5(0x22d)](0x4);continue;case'5':capabilityChain['should']['be']['an'](_0x152bc5(0x2b4));continue;case'6':return{'valid':!![]};case'7':capabilityChainMeta[_0x152bc5(0x461)]['be']['an'](_0x152bc5(0x2b4));continue;}break;}}},result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'inspectCapabilityChain':inspectCapabilityChain,'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0xc2c218(0x405)],fuxzAk[_0xc2c218(0x29b)](expect,result[_0xc2c218(0x1f8)])['to']['be'][_0xc2c218(0x30a)],checkedChain['should'][_0xc2c218(0x1ae)](0x1);}else _0x295f79=_0x514383;}),EMpmzw['jqWic'](it,EMpmzw[_0x2110fb(0x21b)]+_0x2110fb(0x238),async()=>{const _0x278134=_0x2110fb,FyMIaN={'cvUFs':fuxzAk['ecRhi'],'QuUTx':function(callee,param1){const _0x17e0d2=_0x1123;return fuxzAk[_0x17e0d2(0x48b)](callee,param1);}},rootTarget=fuxzAk['hmLwi'],rootCapability=fuxzAk['MvfxK'](createRootCapability,{'controller':alice['id'](),'invocationTarget':rootTarget});addToLoader({'doc':rootCapability});const bobZcap=await fuxzAk[_0x278134(0x2b9)](_delegate,{'parentCapability':rootCapability,'controller':bob,'delegator':alice}),invocationTarget=bobZcap['invocationTarget']+_0x278134(0x380),carolZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':fuxzAk['uyPBI'](uuid),'controller':carol['id'](),'parentCapability':bobZcap['id'],'invocationTarget':invocationTarget,'expires':EXPIRES_3000_DATE},'parentCapability':bobZcap,'delegator':bob}),dianaZcap=await _delegate({'newCapability':{'@context':ZCAP_CONTEXT_URL,'id':uuid(),'controller':diana['id'](),'parentCapability':carolZcap['id'],'invocationTarget':bobZcap[_0x278134(0x3f6)],'expires':EXPIRES_3000_DATE},'parentCapability':carolZcap,'delegator':carol});let checkedChain=0x0;const inspectCapabilityChain=async({capabilityChain:capabilityChain,capabilityChainMeta:capabilityChainMeta})=>{const _0x292800=_0x278134;return checkedChain++,capabilityChain['should']['be']['an'](FyMIaN[_0x292800(0x22e)]),capabilityChain[_0x292800(0x461)][_0x292800(0x4a7)][_0x292800(0x22d)](0x4),capabilityChainMeta['should']['be']['an'](_0x292800(0x2b4)),capabilityChainMeta['should'][_0x292800(0x4a7)][_0x292800(0x22d)](0x4),_checkCapabilityChain({'capabilityChain':capabilityChain}),FyMIaN[_0x292800(0x42d)](_checkCapabilityChainMeta,{'capabilityChainMeta':capabilityChainMeta}),{'valid':!![]};},result=await _verifyDelegation({'delegation':dianaZcap,'expectedRootCapability':rootCapability['id'],'inspectCapabilityChain':inspectCapabilityChain,'purposeOptions':{'allowTargetAttenuation':!![]}});expect(result)['to'][_0x278134(0x405)],expect(result['verified'])['to']['be'][_0x278134(0x33f)],result[_0x278134(0x20c)]['errors'][_0x278134(0x461)][_0x278134(0x4a7)]['length'](0x1);const [error]=result['error'][_0x278134(0x49f)];error[_0x278134(0x283)][_0x278134(0x461)][_0x278134(0x248)](fuxzAk[_0x278134(0x47d)]),checkedChain[_0x278134(0x461)][_0x278134(0x1ae)](0x0);});});});});function _checkCapabilityChain({capabilityChain:capabilityChain}){const _0x5d23ec=_0x21995d;for(const c of capabilityChain){c[_0x5d23ec(0x461)]['be']['an'](_0x5d23ec(0x3fe)),c[_0x5d23ec(0x461)]['have'][_0x5d23ec(0x36e)]('id'),c[_0x5d23ec(0x461)][_0x5d23ec(0x4a7)]['property'](wdQtMN[_0x5d23ec(0x1b1)]),c[_0x5d23ec(0x461)][_0x5d23ec(0x4a7)][_0x5d23ec(0x36e)](wdQtMN[_0x5d23ec(0x2f6)]);}}function _checkCapabilityChainMeta({capabilityChainMeta:capabilityChainMeta}){const _0x25d3c1=_0x21995d;for(const [i,m]of capabilityChainMeta[_0x25d3c1(0x1b4)]()){m[_0x25d3c1(0x461)]['be']['an'](wdQtMN[_0x25d3c1(0x2fe)]),m[_0x25d3c1(0x461)][_0x25d3c1(0x4a7)][_0x25d3c1(0x36e)](wdQtMN[_0x25d3c1(0x48e)]);if(i===0x0){expect(m[_0x25d3c1(0x485)])['to']['be'][_0x25d3c1(0x1e4)];continue;}m[_0x25d3c1(0x485)]['should']['have'][_0x25d3c1(0x36e)](_0x25d3c1(0x1f8)),m[_0x25d3c1(0x485)][_0x25d3c1(0x1f8)][_0x25d3c1(0x461)]['be'][_0x25d3c1(0x30a)],m[_0x25d3c1(0x485)]['should'][_0x25d3c1(0x4a7)][_0x25d3c1(0x36e)](_0x25d3c1(0x3cc)),m[_0x25d3c1(0x485)]['results'][_0x25d3c1(0x22d)][_0x25d3c1(0x461)][_0x25d3c1(0x1ae)](0x1),m[_0x25d3c1(0x485)][_0x25d3c1(0x3cc)][0x0][_0x25d3c1(0x461)]['be']['an'](wdQtMN[_0x25d3c1(0x2fe)]),m[_0x25d3c1(0x485)][_0x25d3c1(0x3cc)][0x0][_0x25d3c1(0x461)][_0x25d3c1(0x4a7)][_0x25d3c1(0x36e)](_0x25d3c1(0x1b0)),m['verifyResult'][_0x25d3c1(0x3cc)][0x0][_0x25d3c1(0x1b0)][_0x25d3c1(0x461)]['be']['an']('object'),m[_0x25d3c1(0x485)][_0x25d3c1(0x3cc)][0x0][_0x25d3c1(0x1b0)][_0x25d3c1(0x461)][_0x25d3c1(0x4a7)][_0x25d3c1(0x36e)]('delegator');}}async function _invoke({doc:doc,key:key,invoker:invoker,date:date,capability:capability,capabilityAction:capabilityAction,purposeOptions:purposeOptions}){const _0x183f34=_0x21995d,WehNqN={'cjRYf':wdQtMN['raZWo'],'UGvjr':function(callee,param1){const _0x5b4d5b=_0x1123;return wdQtMN[_0x5b4d5b(0x1ec)](callee,param1);}};if(wdQtMN[_0x183f34(0x21a)](wdQtMN[_0x183f34(0x208)],wdQtMN[_0x183f34(0x2d9)])){invoker&&(key=invoker[_0x183f34(0x1c4)](wdQtMN['ygrhL'],0x0));let purpose;if(capability){if(wdQtMN[_0x183f34(0x4b3)]===_0x183f34(0x1a9))purpose=new CapabilityInvocation({'capability':capability[_0x183f34(0x1df)]?capability:capability['id'],'capabilityAction':capabilityAction,'invocationTarget':capability[_0x183f34(0x3f6)]});else return _0x5f415a++,_0x1d22b0[_0x183f34(0x405)](_0x21d10b),_0x21b2cc[_0x183f34(0x461)]['be']['an'](WehNqN[_0x183f34(0x37c)]),_0x5d6493[_0x183f34(0x461)][_0x183f34(0x4a7)][_0x183f34(0x22d)](0x3),_0x2a6015({'capabilityChain':_0x1869de}),WehNqN['UGvjr'](_0x91256,{'capabilityChainMeta':_0x21f057}),{'error':new _0x20b885(_0x183f34(0x399)+_0x1e0e4a[0x0]['id']+_0x183f34(0x1f0)),'valid':![]};}else purpose=new CapabilityInvocation(purposeOptions);return jsigs[_0x183f34(0x260)](doc,{'documentLoader':testLoader,'suite':new Ed25519Signature2020({'key':new Ed25519VerificationKey2020(key),'date':date}),'purpose':purpose});}else return _0xe5d2fd++,_0x43570e[_0x183f34(0x461)]['be']['an'](wdQtMN['raZWo']),_0x5907e9[_0x183f34(0x461)][_0x183f34(0x4a7)][_0x183f34(0x22d)](0x3),_0x573d53({'capabilityChain':_0x1f4636}),wdQtMN['JTgwi'](_0x3445d3,{'capabilityChainMeta':_0x126632}),{'valid':!![]};}async function _verifyInvocation({invocation:invocation,rootCapability:rootCapability,expectedAction:expectedAction,inspectCapabilityChain:inspectCapabilityChain,purposeOptions:purposeOptions}){const _0x1fb147=_0x21995d;let purpose;return rootCapability?'jWhOZ'!==_0x1fb147(0x2be)?purpose=new CapabilityInvocation({'expectedTarget':rootCapability[_0x1fb147(0x3f6)],'expectedRootCapability':rootCapability['id'],'expectedAction':expectedAction,'inspectCapabilityChain':inspectCapabilityChain,'suite':new Ed25519Signature2020(),...purposeOptions}):_0x4b4607=_0x596dfd:purpose=new CapabilityInvocation({'suite':new Ed25519Signature2020(),...purposeOptions}),jsigs[_0x1fb147(0x1ef)](invocation,{'documentLoader':testLoader,'suite':new Ed25519Signature2020(),'purpose':purpose});}async function _delegate({newCapability:newCapability,parentCapability:parentCapability,controller:controller,key:key,delegator:delegator,date:date,_capabilityChain:_capabilityChain,purposeOptions:purposeOptions}){const _0xe43f7a=_0x21995d;delegator&&(key=delegator['get'](wdQtMN[_0xe43f7a(0x1d0)],0x0));let purpose;return purposeOptions?purpose=new CapabilityDelegation({'parentCapability':parentCapability,'_capabilityChain':_capabilityChain,...purposeOptions}):purpose=new CapabilityDelegation({'parentCapability':parentCapability,'_capabilityChain':_capabilityChain}),!newCapability&&(newCapability={'@context':ZCAP_CONTEXT_URL,'id':wdQtMN[_0xe43f7a(0x4a8)](uuid),'controller':wdQtMN[_0xe43f7a(0x3d6)](typeof controller,_0xe43f7a(0x30e))?controller:controller['id'](),'parentCapability':parentCapability['id'],'invocationTarget':parentCapability[_0xe43f7a(0x3f6)],'expires':EXPIRES_3000_DATE}),jsigs[_0xe43f7a(0x260)](newCapability,{'documentLoader':testLoader,'suite':new Ed25519Signature2020({'key':new Ed25519VerificationKey2020(key),'date':date}),'purpose':purpose});}async function _verifyDelegation({delegation:delegation,expectedRootCapability:expectedRootCapability,inspectCapabilityChain:inspectCapabilityChain,purposeOptions:purposeOptions={}}){const _0x371d43=_0x21995d;if(_0x371d43(0x4a4)===wdQtMN['IcaUJ'])_0x426c25=_0x12febb;else return jsigs['verify'](delegation,{'documentLoader':testLoader,'suite':new Ed25519Signature2020(),'purpose':new CapabilityDelegation({'suite':new Ed25519Signature2020(),'expectedRootCapability':expectedRootCapability,'inspectCapabilityChain':inspectCapabilityChain,...purposeOptions})});}}