const _0x46e3fe=_0x11c0;(function(_0x268d6c,_0x5e2a9e){const _0x26e2b2=_0x11c0,_0x3601cf=_0x268d6c();while(!![]){try{const _0x4b72d6=parseInt(_0x26e2b2(0x1f9))/0x1*(-parseInt(_0x26e2b2(0x1fb))/0x2)+-parseInt(_0x26e2b2(0x1fe))/0x3*(-parseInt(_0x26e2b2(0x1ff))/0x4)+-parseInt(_0x26e2b2(0x204))/0x5*(-parseInt(_0x26e2b2(0x1eb))/0x6)+-parseInt(_0x26e2b2(0x1e8))/0x7+-parseInt(_0x26e2b2(0x1f4))/0x8*(-parseInt(_0x26e2b2(0x209))/0x9)+-parseInt(_0x26e2b2(0x20e))/0xa*(parseInt(_0x26e2b2(0x1e9))/0xb)+parseInt(_0x26e2b2(0x213))/0xc*(parseInt(_0x26e2b2(0x1cf))/0xd);if(_0x4b72d6===_0x5e2a9e)break;else _0x3601cf['push'](_0x3601cf['shift']());}catch(_0x8c03eb){_0x3601cf['push'](_0x3601cf['shift']());}}}(_0x492b,0xe9c8d));import{Meteor}from'meteor/meteor';import _0x20ae80 from'underscore';import _0xc47e5d from'underscore.string';import _0x4ed7ff from'limax';import{hasPermission}from'../../../authorization';import{EmojiCustom}from'../../../models';function _0x492b(){const _0x5eb97c=['aliases','insertOrUpdateEmoji','217901szujxu','readStream','4vSNjjY','findByNameOrAlias','RwUWX','1722DPhmlq','6524roNqSB','jOnMV','Name','contentType','RweXR','350KOQcIW','error-input-is-not-a-valid-field','filter','FiIFm','test','6705jkezJB','not_authorized','lErae','tkWre','GsopG','7291070uLdpAV','create','previousExtension','concat','_id','8380452vxPeXN','uKghM','methods','previousName','setName','findByNameOrAliasExceptID','eAYle','Error','wILKT','13BbBdBo','pipe','updateClock();','manage-emoji','aMbdC','IYGTO','Alias_Set','bindEnvironment','error-the-field-is-required','replace','newFile','deleteFile','PLjOm','split','broadcast','fetch','ICtru','Custom_Emoji_Error_Name_Or_Alias_Already_In_Use','safe','name','userId','Jzahx','without','\x20is\x20not\x20a\x20valid\x20alias\x20set','The\x20field\x20Name\x20is\x20required','11262405HFvEGf','11QYDhPI','ouMsT','89052UmoSIH','The\x20custom\x20emoji\x20or\x20one\x20of\x20its\x20aliases\x20is\x20already\x20in\x20use','createWriteStream','zYDoo','MrCps','extension','emoji.updateCustom','vJJro','PJEeR','11360AVCTQR','setAliases','getFileWithReadStream'];_0x492b=function(){return _0x5eb97c;};return _0x492b();}function _0x11c0(_0x208b6b,_0x31da03){const _0x492b2e=_0x492b();return _0x11c0=function(_0x11c0a0,_0x4d1563){_0x11c0a0=_0x11c0a0-0x1cb;let _0x31ea70=_0x492b2e[_0x11c0a0];return _0x31ea70;},_0x11c0(_0x208b6b,_0x31da03);}import{RocketChatFileEmojiCustomInstance}from'../startup/emoji-custom';import{api}from'../../../../server/sdk/api';Meteor[_0x46e3fe(0x215)]({'insertOrUpdateEmoji'(_0x28ca9a){const _0x2e5801=_0x46e3fe,_0x37cb63={'uKghM':function(_0x4ebd5f,_0x39026a){return _0x4ebd5f(_0x39026a);},'RweXR':'error-input-is-not-a-valid-field','zYDoo':_0x2e5801(0x1f8),'tkWre':_0x2e5801(0x1e0),'lErae':_0x2e5801(0x1d5),'ICtru':_0x2e5801(0x1d7),'MrCps':_0x2e5801(0x201),'wILKT':function(_0x556fcb,_0x3d0a9d){return _0x556fcb!==_0x3d0a9d;},'vJJro':'kwEIP','IYGTO':'safe','PJEeR':'cDqxF','kWRPP':_0x2e5801(0x20a),'RwUWX':function(_0x403100,_0x50fcea,_0x5ba41e){return _0x403100(_0x50fcea,_0x5ba41e);},'epCdb':_0x2e5801(0x20d),'oqmaN':_0x2e5801(0x1ec),'aMbdC':function(_0x3c073d,_0x13b1ec,_0x3487b7){return _0x3c073d(_0x13b1ec,_0x3487b7);},'FiIFm':function(_0x9eb373,_0x518bd8){return _0x9eb373===_0x518bd8;},'wrbGa':'Wzaif','jOnMV':function(_0x605534,_0x4535c8){return _0x605534(_0x4535c8);},'Bdajh':function(_0x1f0678,_0x4a057f){return _0x1f0678(_0x4a057f);},'cYtAq':function(_0x561edb,_0x39e48f){return _0x561edb!==_0x39e48f;},'MfpOB':function(_0x28e84e,_0x2069fc){return _0x28e84e===_0x2069fc;},'PLjOm':'THcWH','RwtUW':_0x2e5801(0x1ea)};if(!hasPermission(this[_0x2e5801(0x1e3)],_0x2e5801(0x1d2))){if(_0x37cb63[_0x2e5801(0x1f3)]!==_0x37cb63[_0x2e5801(0x1f3)]){const _0x2d97fc=_0x47a0dd[_0x2e5801(0x1f6)](_0x1f8631(_0x764b1c[_0x2e5801(0x216)]+'.'+_0x366cdc['previousExtension']));if(_0x2d97fc!==null){_0x587798[_0x2e5801(0x1da)](_0x108ff7(_0x1e2f3f[_0x2e5801(0x1e2)]+'.'+_0x410e27[_0x2e5801(0x1f0)]));const _0x25f362=_0x28c895[_0x2e5801(0x1ed)](_0x37cb63[_0x2e5801(0x214)](_0x392b43,_0x930234[_0x2e5801(0x1e2)]+'.'+_0x5e320c[_0x2e5801(0x210)]),_0x2d97fc[_0x2e5801(0x202)]);_0x25f362['on']('end',_0x5d197f[_0x2e5801(0x1d6)](()=>_0x330fad['deleteFile'](_0x4fef2e(_0x10f235[_0x2e5801(0x216)]+'.'+_0x595818[_0x2e5801(0x210)])))),_0x2d97fc['readStream'][_0x2e5801(0x1d0)](_0x25f362);}}else throw new Meteor['Error'](_0x37cb63['kWRPP']);}if(!_0xc47e5d['trim'](_0x28ca9a[_0x2e5801(0x1e2)]))throw new Meteor[(_0x2e5801(0x1cd))](_0x37cb63[_0x2e5801(0x1df)],_0x2e5801(0x1e7),{'method':_0x2e5801(0x1f8),'field':_0x37cb63[_0x2e5801(0x1ef)]});_0x28ca9a[_0x2e5801(0x1e2)]=_0x37cb63[_0x2e5801(0x1fd)](_0x4ed7ff,_0x28ca9a[_0x2e5801(0x1e2)],{'replacement':'_'}),_0x28ca9a[_0x2e5801(0x1f7)]=_0x37cb63[_0x2e5801(0x1fd)](_0x4ed7ff,_0x28ca9a[_0x2e5801(0x1f7)],{'replacement':'_'});const _0xe0dae=/[\s,:><&"'\/\\\(\)]/,_0x264568=/[:><&\|"'\/\\\(\)]/;_0x28ca9a['name']=_0x28ca9a['name'][_0x2e5801(0x1d8)](/:/g,''),_0x28ca9a[_0x2e5801(0x1f7)]=_0x28ca9a[_0x2e5801(0x1f7)][_0x2e5801(0x1d8)](/:/g,'');if(_0xe0dae[_0x2e5801(0x208)](_0x28ca9a[_0x2e5801(0x1e2)]))throw new Meteor[(_0x2e5801(0x1cd))](_0x37cb63[_0x2e5801(0x203)],_0x28ca9a[_0x2e5801(0x1e2)]+'\x20is\x20not\x20a\x20valid\x20name',{'method':_0x2e5801(0x1f8),'input':_0x28ca9a[_0x2e5801(0x1e2)],'field':_0x37cb63[_0x2e5801(0x1ef)]});if(_0x28ca9a[_0x2e5801(0x1f7)]){if(_0x37cb63[_0x2e5801(0x1ce)](_0x2e5801(0x1e4),'Jzahx')){if(_0x52a409['test'](_0x35cab1[_0x2e5801(0x1f7)]))throw new _0x389842[(_0x2e5801(0x1cd))](_0x37cb63[_0x2e5801(0x203)],_0x48417a[_0x2e5801(0x1f7)]+_0x2e5801(0x1e6),{'method':_0x37cb63[_0x2e5801(0x1ee)],'input':_0x20da21[_0x2e5801(0x1f7)],'field':_0x2e5801(0x1d5)});_0x733b60[_0x2e5801(0x1f7)]=_0x2d35be['aliases'][_0x2e5801(0x1dc)](/[\s,]/),_0x3c20f5[_0x2e5801(0x1f7)]=_0x552f3d[_0x2e5801(0x1f7)][_0x2e5801(0x206)](_0x157d06),_0x2bc6b6['aliases']=_0x1b6806[_0x2e5801(0x1e5)](_0xb301b3[_0x2e5801(0x1f7)],_0x36060c[_0x2e5801(0x1e2)]);}else{if(_0x264568[_0x2e5801(0x208)](_0x28ca9a[_0x2e5801(0x1f7)])){if(_0x2e5801(0x20d)===_0x37cb63['epCdb'])throw new Meteor['Error'](_0x2e5801(0x205),_0x28ca9a[_0x2e5801(0x1f7)]+_0x2e5801(0x1e6),{'method':_0x2e5801(0x1f8),'input':_0x28ca9a['aliases'],'field':_0x37cb63[_0x2e5801(0x20b)]});else throw new _0x1e437d[(_0x2e5801(0x1cd))](_0x37cb63[_0x2e5801(0x20c)],'The\x20custom\x20emoji\x20or\x20one\x20of\x20its\x20aliases\x20is\x20already\x20in\x20use',{'method':_0x2e5801(0x1f8)});}_0x28ca9a[_0x2e5801(0x1f7)]=_0x28ca9a[_0x2e5801(0x1f7)][_0x2e5801(0x1dc)](/[\s,]/),_0x28ca9a[_0x2e5801(0x1f7)]=_0x28ca9a[_0x2e5801(0x1f7)][_0x2e5801(0x206)](Boolean),_0x28ca9a[_0x2e5801(0x1f7)]=_0x20ae80[_0x2e5801(0x1e5)](_0x28ca9a[_0x2e5801(0x1f7)],_0x28ca9a['name']);}}else _0x28ca9a[_0x2e5801(0x1f7)]=[];let _0x250338=[];if(_0x28ca9a[_0x2e5801(0x212)]){_0x250338=EmojiCustom[_0x2e5801(0x1cb)](_0x28ca9a[_0x2e5801(0x1e2)],_0x28ca9a['_id'])[_0x2e5801(0x1de)]();for(const _0x322946 of _0x28ca9a[_0x2e5801(0x1f7)]){_0x250338=_0x250338['concat'](EmojiCustom[_0x2e5801(0x1cb)](_0x322946,_0x28ca9a[_0x2e5801(0x212)])[_0x2e5801(0x1de)]());}}else{_0x250338=EmojiCustom[_0x2e5801(0x1fc)](_0x28ca9a[_0x2e5801(0x1e2)])[_0x2e5801(0x1de)]();for(const _0x30d1d0 of _0x28ca9a[_0x2e5801(0x1f7)]){_0x250338=_0x250338[_0x2e5801(0x211)](EmojiCustom['findByNameOrAlias'](_0x30d1d0)['fetch']());}}if(_0x250338['length']>0x0)throw new Meteor[(_0x2e5801(0x1cd))](_0x37cb63[_0x2e5801(0x20c)],_0x37cb63['oqmaN'],{'method':_0x37cb63[_0x2e5801(0x1ee)]});if(!_0x28ca9a[_0x2e5801(0x212)]){const _0x1c72cf={'name':_0x28ca9a[_0x2e5801(0x1e2)],'aliases':_0x28ca9a[_0x2e5801(0x1f7)],'extension':_0x28ca9a[_0x2e5801(0x1f0)]},_0x51d0f9=EmojiCustom[_0x2e5801(0x20f)](_0x1c72cf);return api[_0x2e5801(0x1dd)](_0x2e5801(0x1f1),_0x1c72cf),_0x37cb63[_0x2e5801(0x1d3)](setInterval,_0x2e5801(0x1d1),0x3e8),_0x51d0f9;}if(_0x28ca9a[_0x2e5801(0x1d9)])_0x37cb63[_0x2e5801(0x207)]('Wzaif',_0x37cb63['wrbGa'])?(RocketChatFileEmojiCustomInstance[_0x2e5801(0x1da)](encodeURIComponent(_0x28ca9a[_0x2e5801(0x1e2)]+'.'+_0x28ca9a[_0x2e5801(0x1f0)])),RocketChatFileEmojiCustomInstance[_0x2e5801(0x1da)](_0x37cb63[_0x2e5801(0x200)](encodeURIComponent,_0x28ca9a[_0x2e5801(0x1e2)]+'.'+_0x28ca9a[_0x2e5801(0x210)])),RocketChatFileEmojiCustomInstance[_0x2e5801(0x1da)](encodeURIComponent(_0x28ca9a['previousName']+'.'+_0x28ca9a[_0x2e5801(0x1f0)])),RocketChatFileEmojiCustomInstance['deleteFile'](_0x37cb63['Bdajh'](encodeURIComponent,_0x28ca9a[_0x2e5801(0x216)]+'.'+_0x28ca9a[_0x2e5801(0x210)])),EmojiCustom['setExtension'](_0x28ca9a[_0x2e5801(0x212)],_0x28ca9a['extension'])):_0x196075[_0x2e5801(0x217)](_0x567dd5[_0x2e5801(0x212)],_0x31247b['name']);else{if(_0x37cb63['cYtAq'](_0x28ca9a[_0x2e5801(0x1e2)],_0x28ca9a[_0x2e5801(0x216)])){const _0x428c59=RocketChatFileEmojiCustomInstance[_0x2e5801(0x1f6)](encodeURIComponent(_0x28ca9a[_0x2e5801(0x216)]+'.'+_0x28ca9a[_0x2e5801(0x210)]));if(_0x428c59!==null){if(_0x37cb63['MfpOB']('THcWH',_0x37cb63[_0x2e5801(0x1db)])){RocketChatFileEmojiCustomInstance[_0x2e5801(0x1da)](encodeURIComponent(_0x28ca9a[_0x2e5801(0x1e2)]+'.'+_0x28ca9a[_0x2e5801(0x1f0)]));const _0x3df14b=RocketChatFileEmojiCustomInstance['createWriteStream'](encodeURIComponent(_0x28ca9a['name']+'.'+_0x28ca9a['previousExtension']),_0x428c59[_0x2e5801(0x202)]);_0x3df14b['on']('end',Meteor['bindEnvironment'](()=>RocketChatFileEmojiCustomInstance[_0x2e5801(0x1da)](encodeURIComponent(_0x28ca9a[_0x2e5801(0x216)]+'.'+_0x28ca9a[_0x2e5801(0x210)])))),_0x428c59[_0x2e5801(0x1fa)][_0x2e5801(0x1d0)](_0x3df14b);}else throw new _0x202711['Error'](_0x2e5801(0x205),_0x152ed1['aliases']+_0x2e5801(0x1e6),{'method':_0x37cb63[_0x2e5801(0x1ee)],'input':_0x532652[_0x2e5801(0x1f7)],'field':_0x37cb63[_0x2e5801(0x20b)]});}}}_0x28ca9a[_0x2e5801(0x1e2)]!==_0x28ca9a['previousName']&&EmojiCustom[_0x2e5801(0x217)](_0x28ca9a['_id'],_0x28ca9a[_0x2e5801(0x1e2)]);if(_0x28ca9a[_0x2e5801(0x1f7)])EmojiCustom[_0x2e5801(0x1f5)](_0x28ca9a[_0x2e5801(0x212)],_0x28ca9a[_0x2e5801(0x1f7)]);else{if(_0x37cb63['MfpOB'](_0x37cb63['RwtUW'],_0x2e5801(0x1cc)))throw new _0x1f9e9e[(_0x2e5801(0x1cd))](_0x37cb63[_0x2e5801(0x1df)],_0x2e5801(0x1e7),{'method':_0x2e5801(0x1f8),'field':_0x37cb63[_0x2e5801(0x1ef)]});else EmojiCustom['setAliases'](_0x28ca9a[_0x2e5801(0x212)],[]);}return api[_0x2e5801(0x1dd)](_0x2e5801(0x1f1),_0x28ca9a),_0x37cb63['aMbdC'](setTimeout,function(){const _0x174e54=_0x2e5801;_0x37cb63[_0x174e54(0x1ce)](_0x37cb63[_0x174e54(0x1f2)],_0x37cb63['vJJro'])?_0x254465['log'](_0x174e54(0x1e1)):console['log'](_0x37cb63[_0x174e54(0x1d4)]);},0x64),!![];}});