const _0x3ed79e=_0xdb09;(function(_0x4f1ae4,_0x55d9e3){const _0x5710de=_0xdb09,_0x28e759=_0x4f1ae4();while(!![]){try{const _0x4db18c=parseInt(_0x5710de(0x121))/0x1*(parseInt(_0x5710de(0x13c))/0x2)+parseInt(_0x5710de(0x12c))/0x3+-parseInt(_0x5710de(0x135))/0x4+parseInt(_0x5710de(0x120))/0x5+parseInt(_0x5710de(0x101))/0x6+-parseInt(_0x5710de(0x122))/0x7*(-parseInt(_0x5710de(0x139))/0x8)+-parseInt(_0x5710de(0x117))/0x9;if(_0x4db18c===_0x55d9e3)break;else _0x28e759['push'](_0x28e759['shift']());}catch(_0xc6e870){_0x28e759['push'](_0x28e759['shift']());}}}(_0x1e7e,0xcbcba),process[_0x3ed79e(0xff)][_0x3ed79e(0x12a)]===_0x3ed79e(0x13f)?require(_0x3ed79e(0x125))[_0x3ed79e(0x11e)]({'path':'.env.'+process[_0x3ed79e(0xff)][_0x3ed79e(0x12a)]}):require(_0x3ed79e(0x125))[_0x3ed79e(0x11e)]());const {SystemSettings}=require(_0x3ed79e(0x116)),{Telemetry}=require('../models/telemetry'),{User}=require(_0x3ed79e(0x12f)),{reqBody,makeJWT}=require('../utils/http'),bcrypt=require(_0x3ed79e(0x127));function _0xdb09(_0x453042,_0x24667a){const _0x1e7e4c=_0x1e7e();return _0xdb09=function(_0xdb092f,_0x5c9f9d){_0xdb092f=_0xdb092f-0xf7;let _0x3f9369=_0x1e7e4c[_0xdb092f];return _0x3f9369;},_0xdb09(_0x453042,_0x24667a);}function authenticationEndpoints(_0x10a15b){const _0x313ace=_0x3ed79e,_0x4960c3={'CSqcz':function(_0x14d81d,_0xbe9740){return _0x14d81d>_0xbe9740;},'koVOT':'admin','qdGjM':'root','mmlDO':function(_0x2f60c7,_0x4afac7){return _0x2f60c7===_0x4afac7;},'DRBPH':'YNMWf','bpFpD':function(_0x5c1fbe,_0x38c7b5,_0x3efff8){return _0x5c1fbe(_0x38c7b5,_0x3efff8);},'DDpdC':_0x313ace(0x104),'qRNao':function(_0x329b53,_0x3c2564){return _0x329b53||_0x3c2564;},'ofUDa':function(_0x4a84bc,_0x3ff65f){return _0x4a84bc===_0x3ff65f;},'jSGGZ':_0x313ace(0x123),'wZnGU':_0x313ace(0x10f),'zLSLx':_0x313ace(0xfc),'VkByU':'oBKhG','HRCQc':_0x313ace(0x141),'SguKQ':function(_0x430953,_0x554748){return _0x430953===_0x554748;},'PPlUl':'bfNtV','gJGjJ':_0x313ace(0x113),'CZLpX':_0x313ace(0x10b),'CrtEa':function(_0x110121,_0x5d9fef){return _0x110121+_0x5d9fef;},'SQIOe':function(_0x4f8ef4,_0x35f9c2){return _0x4f8ef4!==_0x35f9c2;},'zEsxF':function(_0x3d47a1,_0x3c9705,_0x107e20){return _0x3d47a1(_0x3c9705,_0x107e20);},'LwiMh':function(_0x4563d3,_0x569e17){return _0x4563d3(_0x569e17);},'lgDJC':'[000]\x20System\x20setup\x20has\x20already\x20been\x20completed\x20-\x20you\x20cannot\x20do\x20this\x20again.','sivHN':_0x313ace(0x100)};if(!_0x10a15b)return;_0x10a15b['get']('/auth/auto-onboard',async(_0x278021,_0x36b054)=>{const _0x4b3646=_0x313ace;try{const _0x231d60=_0x4960c3['CSqcz'](await User[_0x4b3646(0x128)]({'role':_0x4960c3[_0x4b3646(0x13a)]}),0x0);if(_0x231d60){_0x36b054[_0x4b3646(0x11a)](0xc8)[_0x4b3646(0x119)]({'completed':!![]});return;}const _0x58b0=await User[_0x4b3646(0x107)]({'role':_0x4960c3[_0x4b3646(0xfa)]});if(!_0x58b0){if(_0x4960c3[_0x4b3646(0x133)](_0x4960c3[_0x4b3646(0xfe)],_0x4960c3['DRBPH'])){_0x36b054[_0x4b3646(0x11a)](0xc8)[_0x4b3646(0x119)]({'completed':!![]});return;}else{_0x4b4bb7[_0x4b3646(0x11a)](0xc8)['json']({'completed':!![]});return;}}await Telemetry['sendTelemetry'](_0x4b3646(0x11b)),_0x36b054[_0x4b3646(0x11a)](0xc8)[_0x4b3646(0x119)]({'valid':!![],'user':_0x58b0,'token':_0x4960c3[_0x4b3646(0x12d)](makeJWT,{'id':_0x58b0['id'],'email':_0x58b0[_0x4b3646(0x111)]},_0x4b3646(0x110)),'message':null});}catch(_0x15f784){console[_0x4b3646(0x115)](_0x15f784['message'],_0x15f784),_0x36b054['sendStatus'](0x1f4)['end']();}}),_0x10a15b['post']('/auth/login',async(_0x3eb9c6,_0x473e4d)=>{const _0x56f7d3=_0x313ace,_0xde6f9b={'euxfr':'[000]\x20System\x20setup\x20has\x20already\x20been\x20completed\x20-\x20you\x20cannot\x20do\x20this\x20again.'};try{const {email:_0x451bef,password:_0x26a341}=reqBody(_0x3eb9c6);if(_0x4960c3[_0x56f7d3(0x131)](!_0x451bef,!_0x26a341)){_0x473e4d[_0x56f7d3(0x11a)](0xc8)[_0x56f7d3(0x119)]({'user':null,'valid':![],'token':null,'message':_0x56f7d3(0x105)});return;}if(_0x451bef===process[_0x56f7d3(0xff)][_0x56f7d3(0x13b)]){if(_0x4960c3[_0x56f7d3(0xfb)](_0x4960c3[_0x56f7d3(0x11c)],_0x4960c3['wZnGU'])){_0x5456cd['status'](0xc8)[_0x56f7d3(0x119)]({'user':null,'valid':![],'token':null,'message':_0x4960c3[_0x56f7d3(0x11f)]});return;}else{const _0xab3610=await User[_0x56f7d3(0x128)]({'role':_0x56f7d3(0x134)})>0x0;if(_0xab3610){if(_0x4960c3['zLSLx']===_0x4960c3[_0x56f7d3(0xfd)]){_0x23d727['status'](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0xde6f9b[_0x56f7d3(0x132)]});return;}else{_0x473e4d['status'](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x56f7d3(0xf7)});return;}}}}const _0x120831=await User[_0x56f7d3(0x107)]({'email':_0x451bef});if(!_0x120831){_0x473e4d[_0x56f7d3(0x11a)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x4960c3['HRCQc']});return;}if(!bcrypt[_0x56f7d3(0x109)](_0x26a341,_0x120831[_0x56f7d3(0x10c)])){_0x473e4d[_0x56f7d3(0x11a)](0xc8)[_0x56f7d3(0x119)]({'user':null,'valid':![],'token':null,'message':_0x56f7d3(0x11d)});return;}await Telemetry[_0x56f7d3(0x118)](_0x56f7d3(0x138)),_0x473e4d[_0x56f7d3(0x11a)](0xc8)['json']({'valid':!![],'user':_0x120831,'token':makeJWT({'id':_0x120831['id'],'email':_0x120831['email']},_0x56f7d3(0x140)),'message':null});return;}catch(_0x3d6222){console[_0x56f7d3(0x115)](_0x3d6222[_0x56f7d3(0x12b)],_0x3d6222),_0x473e4d[_0x56f7d3(0x10a)](0x1f4)[_0x56f7d3(0xf8)]();}}),_0x10a15b['post'](_0x4960c3[_0x313ace(0x142)],async(_0x304e05,_0x3d1cac)=>{const _0x5afefa=_0x313ace;try{const {email:_0x4f764d,password:_0x2b8584}=reqBody(_0x304e05);if(!_0x4f764d||!_0x2b8584){_0x3d1cac['status'](0xc8)[_0x5afefa(0x119)]({'user':null,'valid':![],'token':null,'message':_0x5afefa(0x105)});return;}const _0x3ceee8=await User[_0x5afefa(0x128)]({'role':_0x5afefa(0x134)});if(_0x4960c3[_0x5afefa(0x13d)](_0x3ceee8,0x0)){if(_0x4960c3[_0x5afefa(0x124)]!==_0x5afefa(0x129)){_0x2749c3[_0x5afefa(0x11a)](0xc8)[_0x5afefa(0x119)]({'user':null,'valid':![],'token':null,'message':_0x5afefa(0x10b)});return;}else{_0x3d1cac[_0x5afefa(0x11a)](0xc8)[_0x5afefa(0x119)]({'user':null,'valid':![],'token':null,'message':_0x4960c3['gJGjJ']});return;}}const _0x519af3=await User['get']({'email':_0x4f764d});if(!!_0x519af3){_0x3d1cac[_0x5afefa(0x11a)](0xc8)[_0x5afefa(0x119)]({'user':null,'valid':![],'token':null,'message':_0x4960c3[_0x5afefa(0x11f)]});return;}const _0x19bcc6=await SystemSettings[_0x5afefa(0x107)]({'label':_0x5afefa(0x114)});if(!!_0x19bcc6&&_0x19bcc6[_0x5afefa(0x13e)]!==null&&_0x19bcc6[_0x5afefa(0x13e)]===_0x5afefa(0x103)){_0x3d1cac[_0x5afefa(0x11a)](0xc8)[_0x5afefa(0x119)]({'user':null,'valid':![],'token':null,'message':_0x4960c3['CZLpX']});return;}const _0x2af547=await SystemSettings['get']({'label':_0x5afefa(0x106)});if(_0x2af547&&_0x2af547[_0x5afefa(0x13e)]){const _0x58b182=_0x4f764d['substring'](_0x4960c3[_0x5afefa(0x136)](_0x4f764d['lastIndexOf']('@'),0x1));if(_0x4960c3[_0x5afefa(0x137)](_0x58b182,_0x2af547['value'])){_0x3d1cac[_0x5afefa(0x11a)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x5afefa(0x10d)});return;}}const {user:_0x15cf03,message:_0x4583cf}=await User[_0x5afefa(0x10e)]({'email':_0x4f764d,'password':_0x2b8584});if(!_0x15cf03){_0x3d1cac[_0x5afefa(0x11a)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x4583cf});return;}await User['addToAllOrgs'](_0x15cf03['id']),await Telemetry['sendTelemetry']('login_event'),_0x3d1cac[_0x5afefa(0x11a)](0xc8)[_0x5afefa(0x119)]({'user':_0x15cf03,'valid':!![],'token':_0x4960c3[_0x5afefa(0x108)](makeJWT,{'id':_0x15cf03['id'],'email':_0x15cf03[_0x5afefa(0x111)]},_0x5afefa(0x140)),'message':null});return;}catch(_0x3ca0ee){console['log'](_0x3ca0ee['message'],_0x3ca0ee),_0x3d1cac[_0x5afefa(0x10a)](0x1f4)[_0x5afefa(0xf8)]();}}),_0x10a15b[_0x313ace(0x12e)](_0x313ace(0xf9),async(_0x23971b,_0x3176f5)=>{const _0x267340=_0x313ace;try{const {email:_0x105544,password:_0x1b0f3a}=_0x4960c3['LwiMh'](reqBody,_0x23971b);if(!_0x105544||!_0x1b0f3a){_0x3176f5[_0x267340(0x11a)](0xc8)[_0x267340(0x119)]({'user':null,'valid':![],'token':null,'message':_0x267340(0x105)});return;}const _0x5d7d33=await User[_0x267340(0x128)]({'role':_0x267340(0x134)});if(_0x4960c3['CSqcz'](_0x5d7d33,0x0)){_0x3176f5[_0x267340(0x11a)](0xc8)[_0x267340(0x119)]({'user':null,'valid':![],'token':null,'message':_0x4960c3[_0x267340(0x126)]});return;}const _0x320e65=await User['get']({'email':_0x105544});if(!!_0x320e65){_0x3176f5[_0x267340(0x11a)](0xc8)[_0x267340(0x119)]({'user':null,'valid':![],'token':null,'message':_0x267340(0x104)});return;}const {user:_0x5e9725,message:_0x27afa9}=await User[_0x267340(0x10e)]({'email':_0x105544,'password':_0x1b0f3a,'role':'admin'});if(!_0x5e9725){_0x3176f5['status'](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x27afa9});return;}_0x3176f5[_0x267340(0x11a)](0xc8)[_0x267340(0x119)]({'user':_0x5e9725,'valid':!![],'token':makeJWT({'id':_0x5e9725['id'],'email':_0x5e9725[_0x267340(0x111)]},_0x267340(0x140)),'message':null});return;}catch(_0x265b8b){if(_0x267340(0x102)===_0x267340(0x130)){_0x46fa25['status'](0xc8)[_0x267340(0x119)]({'user':null,'valid':![],'token':null,'message':'[002]\x20No\x20email\x20or\x20password\x20provided.'});return;}else console['log'](_0x265b8b[_0x267340(0x12b)],_0x265b8b),_0x3176f5[_0x267340(0x10a)](0x1f4)['end']();}});}module[_0x3ed79e(0x112)]={'authenticationEndpoints':authenticationEndpoints};function _0x1e7e(){const _0x50e75f=['qdGjM','ofUDa','xdrgQ','VkByU','DRBPH','env','/auth/create-account','2744040ADjJIe','XlGNG','false','[001]\x20Account\x20already\x20exists\x20by\x20this\x20email\x20-\x20use\x20another.','[002]\x20No\x20email\x20or\x20password\x20provided.','account_creation_domain_scope','get','zEsxF','compareSync','sendStatus','[003]\x20Access\x20denied.','password','[003]\x20Invalid\x20account\x20creation\x20values.','create','FdCfk','1hr','email','exports','[000]\x20System\x20setup\x20has\x20not\x20been\x20completed\x20-\x20account\x20creation\x20disabled.','allow_account_creation','log','../models/systemSettings','8072307JNBCaU','sendTelemetry','json','status','onboarding_complete','jSGGZ','[002]\x20Invalid\x20login\x20credentials.','config','DDpdC','1896795dscZjI','1rHeGfN','4709866MgvxOj','ulnWJ','PPlUl','dotenv','lgDJC','bcrypt','count','bfNtV','NODE_ENV','message','551952cLAYjf','bpFpD','post','../models/user','XtTwm','qRNao','euxfr','mmlDO','admin','1583444cJkrxv','CrtEa','SQIOe','login_event','8lmrBgK','koVOT','SYS_EMAIL','868018TFApSz','SguKQ','value','development','30d','[001]\x20Invalid\x20login\x20credentials.','sivHN','[004]\x20Invalid\x20login\x20credentials.','end','/auth/transfer-root'];_0x1e7e=function(){return _0x50e75f;};return _0x1e7e();}