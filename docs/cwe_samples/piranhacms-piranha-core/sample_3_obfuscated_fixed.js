function _0x6d33(_0x5b905c,_0x33efa9){const _0x559324=_0x5593();return _0x6d33=function(_0x6d3355,_0xa3ce2){_0x6d3355=_0x6d3355-0xf0;let _0x566c40=_0x559324[_0x6d3355];return _0x566c40;},_0x6d33(_0x5b905c,_0x33efa9);}function _0x5593(){const _0x20e47d=['PKcCk','Error\x20processing\x20the\x20profile\x20picture\x20upload:','8PheEsI','rUSNm','../storage/assets/pfp/','/system/enable-multi-user','1266110YfiANB','dniXl','vixvQ','post','YLXcX','reduce','ZAFLV','single','nfSQP','QmopU','UWxEO','sendTelemetry','JVliJ','attachment;\x20filename=','45ZVSPuX','Jmtll','Content-Type','../models/user','download','Internal\x20server\x20error','asc','PqrrA','../utils/files/logo','Ojwrj','join','/system/update-env','CZLCV','yYmJY','luFXv','../utils/files/data','.env.','CvvmD','dcQgy','canDeleteWorkspaces','isMultiUserMode','ZCcix','rnIWs','json','PxkTm','writeHead','JVgqI','[003]\x20Invalid\x20password\x20provided','child_process','XMsAo','keys','UboPO','Bvrbr','sHSbG','kobca','username','/system/system-vectors','28NRLCdm','application/jsonl','VhYvu','../models/workspaceChats','status','locals','/system/remove-folder','bcrypt','push','config','sendStatus','7426CdwyqH','FHySe','../models/apiKeys','dotenv','YEBNj','MZExr','2720772DKCqGK','admin','OumSU','../utils/http','filename','tjOsp','caFvk','file','pfpFilename','/system/data-import','/system/export-chats','1767333KBNlUp','/system/remove-logo','NODE_ENV','development','getMessages','No\x20logo\x20file\x20provided.','path','OGcvn','jnnDD','pKsNf','/system/update-password','desc','get','fTWVC','nOlgZ','currentSettings','uSCBs','lsZPq','FizrP','oldPfpFilename','CCOBX','Logo\x20uploaded\x20successfully.','basename','IEsBB','tbKxn','BrERi','XtAeH','OoyXn','2609060rfppag','send','params','aWbVB','whereWithData','xvCfQ','UPWRJ','bKecd','existsSync','[002]\x20Invalid\x20login\x20credentials.','assistant','Error\x20processing\x20the\x20logo\x20removal:','ABFqn','../models/workspace','../models/welcomeMessages','env','../utils/files/pfp','/system/is-default-logo','/system/accepted-document-types','bmHXN','workspaceId','parse','compareSync','../models/systemSettings','logo','where','/system/set-welcome-messages','PVRND','XyAZu','manager','ubwmc','suspended','tVdBT','/env-dump','delete','update','bajmk','OtycE','ISAie','Error\x20processing\x20the\x20profile\x20picture\x20removal:','/system/logo','login_event','OJOxu','Error\x20saving\x20the\x20welcome\x20messages.','JYhhO','AUTH_TOKEN','ytyiW','rhIlv','/system/data-exports/:filename','unlinkSync','../utils/helpers','xJgDF','jguew','/system/upload-logo','OVncd','hqSIe','hashSync','image/png','/migrate','/system/check-token','Could\x20not\x20find\x20an\x20API\x20Key.','npx\x20prisma\x20migrate\x20deploy\x20--schema=./prisma/schema.prisma','ymDcf','qRUrh','/system/workspace-chats/:id','ClCNX','/system/api-key','/ping','CyIrp','LSwhk','ZdJgT','Invalid\x20user\x20ID','../utils/middleware/validatedRequest','OIyaw','30d','Failed\x20to\x20update\x20with\x20new\x20logo.','Hwgmz','isArray','Error\x20generating\x20api\x20key.','production','namespaceCount','XLQOI','TtKWl','slug','hYFds','totalVectors','../utils/middleware/multiUserProtected','message','Error\x20fetching\x20welcome\x20messages:','saveAll','values','DNqKs','Problem\x20downloading\x20the\x20file','RTuLL','cutYx','[004]\x20Account\x20suspended\x20by\x20admin.','/system/local-files','/system/multi-user-mode','HpCCl','oYKFE','File\x20','role','AJNUG','\x20does\x20not\x20exist\x20in\x20exports.','Unfsr','JPdtp','4007950NJvyol','Error\x20uploading\x20the\x20logo.','Invalid\x20message\x20format.\x20Expected\x20an\x20array\x20of\x20messages.','nmDoa','bwvVb','OpaeT','../utils/files/multer','map','JAbmK','execSync','../utils/files/documentProcessor','/../storage/exports/','Error\x20processing\x20the\x20logo\x20request:','QJoNs','mQzuu','nJxLy','fbZTD','originalname','[001]\x20Invalid\x20login\x20credentials.','XKlST','usILM','TmkYG','vzWFq','xCWri','gUtwY','openAiPrompt','Invalid\x20file\x20name.\x20Please\x20choose\x20a\x20different\x20file.','uuid','ZMFTL','system','/setup-complete','inherit','Ufbea','Failed\x20to\x20update\x20with\x20new\x20profile\x20picture.','JtCiu','count','Error\x20fetching\x20can\x20delete\x20workspaces:','tzRZW','1313568LEoePm','Multi-user\x20mode\x20is\x20already\x20enabled.','Error\x20removing\x20the\x20logo.','No\x20updates\x20provided','UOsKX','log','tzLPb','from','YMAuh','JWT_SECRET','/system/generate-api-key','password','/system/user','Error\x20processing\x20the\x20logo\x20upload:','jrSOp','Error\x20processing\x20the\x20welcome\x20messages:','error','end','XxLcp','JAlCt','messages','/request-token','YEaAj','QljYu','multiUserMode','/system/api-keys','updateSettings','currentLogoFilename','create','HOUMj','File\x20upload\x20failed.','Profile\x20picture\x20removed\x20successfully.'];_0x5593=function(){return _0x20e47d;};return _0x5593();}const _0x48b10a=_0x6d33;(function(_0x20c60d,_0xa69508){const _0x3f62a2=_0x6d33,_0x26b157=_0x20c60d();while(!![]){try{const _0x1679fb=-parseInt(_0x3f62a2(0x1ae))/0x1*(parseInt(_0x3f62a2(0x1de))/0x2)+-parseInt(_0x3f62a2(0x1ef))/0x3+-parseInt(_0x3f62a2(0x20b))/0x4+parseInt(_0x3f62a2(0x154))/0x5+parseInt(_0x3f62a2(0x17a))/0x6*(parseInt(_0x3f62a2(0x1d3))/0x7)+parseInt(_0x3f62a2(0x19c))/0x8*(parseInt(_0x3f62a2(0x1e4))/0x9)+-parseInt(_0x3f62a2(0x1a0))/0xa;if(_0x1679fb===_0xa69508)break;else _0x26b157['push'](_0x26b157['shift']());}catch(_0x131b33){_0x26b157['push'](_0x26b157['shift']());}}}(_0x5593,0x6c87a),process[_0x48b10a(0xf9)]['NODE_ENV']===_0x48b10a(0x1f2)?require(_0x48b10a(0x1e1))[_0x48b10a(0x1dc)]({'path':_0x48b10a(0x1be)+process[_0x48b10a(0xf9)]['NODE_ENV']}):require(_0x48b10a(0x1e1))[_0x48b10a(0x1dc)]());const {viewLocalFiles,normalizePath}=require('../utils/files'),{exportData,unpackAndOverwriteImport}=require(_0x48b10a(0x1bd)),{checkProcessorAlive,acceptedFileTypes}=require(_0x48b10a(0x15e)),{purgeDocument,purgeFolder}=require('../utils/files/purgeDocument'),{getVectorDbClass}=require(_0x48b10a(0x11c)),{updateENV,dumpENV}=require('../utils/helpers/updateENV'),{reqBody,makeJWT,userFromSession,multiUserMode,queryParams}=require(_0x48b10a(0x1e7)),{setupDataImports,setupLogoUploads,setupPfpUploads}=require(_0x48b10a(0x15a)),{v4}=require(_0x48b10a(0x16f)),{SystemSettings}=require(_0x48b10a(0x101)),{User}=require(_0x48b10a(0x1b1)),{validatedRequest}=require(_0x48b10a(0x132)),{handleImports}=setupDataImports(),{handleLogoUploads}=setupLogoUploads(),{handlePfpUploads}=setupPfpUploads(),fs=require('fs'),path=require(_0x48b10a(0x1f5)),{getDefaultFilename,determineLogoFilepath,fetchLogo,validFilename,renameLogoFile,removeCustomLogo,LOGO_FILENAME}=require(_0x48b10a(0x1b6)),{Telemetry}=require('../models/telemetry'),{WelcomeMessages}=require(_0x48b10a(0xf8)),{ApiKey}=require(_0x48b10a(0x1e0)),{getCustomModels}=require('../utils/helpers/customModels'),{WorkspaceChats}=require(_0x48b10a(0x1d6)),{Workspace}=require(_0x48b10a(0xf7)),{flexUserRoleValid}=require(_0x48b10a(0x140)),{fetchPfp,determinePfpFilepath}=require(_0x48b10a(0xfa));function systemEndpoints(_0x27ded2){const _0x53ae65=_0x48b10a,_0x4dd191={'UboPO':_0x53ae65(0x1ca),'FizrP':_0x53ae65(0x127),'QljYu':'production','ClCNX':function(_0x5d28ac){return _0x5d28ac();},'bajmk':function(_0x5ec24f,_0x532d41){return _0x5ec24f(_0x532d41);},'CZLCV':function(_0x172975,_0x17ed87,_0x38ea9b){return _0x172975(_0x17ed87,_0x38ea9b);},'tVdBT':function(_0x4a8af7,_0x2f91d1){return _0x4a8af7(_0x2f91d1);},'yYmJY':function(_0x354135,_0x26cb5c){return _0x354135===_0x26cb5c;},'qNNzd':_0x53ae65(0x113),'gUtwY':_0x53ae65(0x1c9),'AhmEt':'TjiGD','lsZPq':function(_0x4049d7){return _0x4049d7();},'CyIrp':_0x53ae65(0x1a1),'YLXcX':function(_0x200f46,_0x2b66eb){return _0x200f46!==_0x2b66eb;},'nJxLy':_0x53ae65(0x188),'ZMFTL':function(_0x30aa3c){return _0x30aa3c();},'JtCiu':_0x53ae65(0x159),'OGcvn':_0x53ae65(0xf6),'xvCfQ':function(_0x33d544,_0x3f0465){return _0x33d544(_0x3f0465);},'usILM':function(_0x447169,_0xafb154){return _0x447169===_0xafb154;},'JZsCL':function(_0x1a29c3,_0x4a0d1f){return _0x1a29c3===_0x4a0d1f;},'AJNUG':function(_0x952a7c,_0x3885f6){return _0x952a7c(_0x3885f6);},'ISAie':_0x53ae65(0x17b),'tzRZW':_0x53ae65(0x1e5),'ZCcix':function(_0x5fa917,_0x357842,_0x5bde83){return _0x5fa917(_0x357842,_0x5bde83);},'tKhjc':function(_0x434f81,_0x4c3472){return _0x434f81===_0x4c3472;},'DcaFx':function(_0x26ca36,_0x1da3c0){return _0x26ca36(_0x1da3c0);},'ZdJgT':function(_0xdba800,_0x2b3d2a){return _0xdba800(_0x2b3d2a);},'ymDcf':function(_0x14c3fc){return _0x14c3fc();},'JuPlD':function(_0xd09ed,_0xe37d82){return _0xd09ed(_0xe37d82);},'TtKWl':function(_0x5dd406,_0x48e6fd){return _0x5dd406(_0x48e6fd);},'UWxEO':function(_0xc2902e,_0x3c6d28){return _0xc2902e(_0x3c6d28);},'KNsWR':'base64','JVgqI':_0x53ae65(0x160),'PxkTm':function(_0x58df5c,_0x34e8ff){return _0x58df5c(_0x34e8ff);},'bwvVb':_0x53ae65(0x202),'OVncd':_0x53ae65(0x19b),'tzLPb':_0x53ae65(0x199),'BCuAT':'Failed\x20to\x20remove\x20profile\x20picture.','ubwmc':_0x53ae65(0x111),'YMAuh':_0x53ae65(0x1b3),'pKsNf':function(_0x3be89d,_0x57129c){return _0x3be89d===_0x57129c;},'lmWAa':_0x53ae65(0x1f4),'iLrTN':_0x53ae65(0x204),'ffolz':function(_0x10b07b,_0x4cbfce){return _0x10b07b||_0x4cbfce;},'OJOxu':'Failed\x20to\x20update\x20with\x20new\x20logo.','FHySe':_0x53ae65(0x187),'bmHXN':'Logo\x20removed\x20successfully.','qRUrh':function(_0x198791,_0x5e162a){return _0x198791||_0x5e162a;},'JPdtp':_0x53ae65(0x107),'FYpxt':_0x53ae65(0x178),'PqrrA':_0x53ae65(0xf1),'OIyaw':_0x53ae65(0x142),'Ojwrj':function(_0x15c6da,_0x5a810c){return _0x15c6da!==_0x5a810c;},'noTKa':_0x53ae65(0x121),'Unfsr':_0x53ae65(0x138),'jnnDD':function(_0x40ccbc,_0x5c2556){return _0x40ccbc===_0x5c2556;},'SysWM':_0x53ae65(0x174),'JVliJ':_0x53ae65(0x148),'UPWRJ':function(_0x411eec,_0x400674,_0x1526a4,_0x54b75f){return _0x411eec(_0x400674,_0x1526a4,_0x54b75f);},'XyAZu':_0x53ae65(0x1fc),'rUSNm':function(_0x84468f,_0x13fd18){return _0x84468f*_0x13fd18;},'OtycE':function(_0x7de69f,_0x2c83b5){return _0x7de69f+_0x2c83b5;},'CCOBX':'OtmCS','oqrzK':function(_0x116ae6,_0x10c2c7){return _0x116ae6(_0x10c2c7);},'nOlgZ':_0x53ae65(0x17d),'fBuKJ':_0x53ae65(0xf4),'nfSQP':_0x53ae65(0x1b4),'Jmtll':_0x53ae65(0x209),'uSCBs':_0x53ae65(0x147),'JDCri':_0x53ae65(0x198),'CvvmD':_0x53ae65(0x166),'GWGRL':'qExdY','lyTSj':_0x53ae65(0x208),'xJgDF':function(_0x1d7448,_0x457f71,_0xa160c6){return _0x1d7448(_0x457f71,_0xa160c6);},'caFvk':function(_0x24d7bc,_0x4cdb68){return _0x24d7bc(_0x4cdb68);},'VhYvu':function(_0x1164ec,_0x1b4580){return _0x1164ec!==_0x1b4580;},'mQzuu':_0x53ae65(0x1e9),'JAbmK':_0x53ae65(0x105),'DNqKs':_0x53ae65(0x1d0),'cPJJC':_0x53ae65(0x169),'LSwhk':_0x53ae65(0x14d),'MZExr':_0x53ae65(0x172),'fbZTD':_0x53ae65(0x1d2),'XLQOI':_0x53ae65(0x1d9),'RnSlQ':'/system/document-processing-status','Hwgmz':_0x53ae65(0xfc),'dcQgy':_0x53ae65(0x1b9),'xCWri':_0x53ae65(0x1f9),'rIaay':_0x53ae65(0x14b),'UOsKX':_0x53ae65(0x11a),'XKlST':_0x53ae65(0x1eb),'rnIWs':_0x53ae65(0x112),'qfYYV':'/system/pfp/:id','yITkh':'/system/upload-pfp','jguew':_0x53ae65(0x11f),'IEsBB':_0x53ae65(0x102),'HOUMj':_0x53ae65(0x1f0),'PKcCk':'/system/can-delete-workspaces','vzWFq':_0x53ae65(0x104),'hYFds':_0x53ae65(0x193),'JAlCt':_0x53ae65(0x12c),'luFXv':'/system/custom-models','XMsAo':_0x53ae65(0x1ee),'SvLIL':_0x53ae65(0x186)};if(!_0x27ded2)return;_0x27ded2[_0x53ae65(0x1fb)](_0x53ae65(0x12d),(_0x35359a,_0x3c5580)=>{_0x3c5580['status'](0xc8)['json']({'online':!![]});}),_0x27ded2[_0x53ae65(0x1fb)](_0x53ae65(0x124),async(_0x2295a7,_0x216572)=>{const _0x2acbb0=_0x53ae65,_0x1fbde1=require(_0x4dd191[_0x2acbb0(0x1cd)])[_0x2acbb0(0x15d)];_0x1fbde1(_0x4dd191[_0x2acbb0(0x201)],{'stdio':_0x2acbb0(0x173)}),_0x216572[_0x2acbb0(0x1dd)](0xc8);}),_0x27ded2[_0x53ae65(0x1fb)](_0x53ae65(0x10b),async(_0x566361,_0x1d3a91)=>{const _0x4526be=_0x53ae65;if(process[_0x4526be(0xf9)][_0x4526be(0x1f1)]!==_0x4dd191['QljYu'])return _0x1d3a91[_0x4526be(0x1dd)](0xc8)[_0x4526be(0x18b)]();await _0x4dd191['ClCNX'](dumpENV),_0x1d3a91[_0x4526be(0x1dd)](0xc8)[_0x4526be(0x18b)]();}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x1e3)],async(_0x391564,_0x521b28)=>{const _0x57afbd=_0x53ae65;try{if(_0x57afbd(0x190)===_0x57afbd(0x119))_0x47ab01['error'](_0x328aa1),_0x5ef804[_0x57afbd(0x1d7)](0x1f4)[_0x57afbd(0x18b)]();else{const _0x4674f1=await SystemSettings[_0x57afbd(0x1fe)]();_0x521b28[_0x57afbd(0x1d7)](0xc8)['json']({'results':_0x4674f1});}}catch(_0x3cf8eb){console[_0x57afbd(0x17f)](_0x3cf8eb[_0x57afbd(0x141)],_0x3cf8eb),_0x521b28['sendStatus'](0x1f4)['end']();}}),_0x27ded2['get'](_0x53ae65(0x125),[validatedRequest],async(_0x240b73,_0x22beec)=>{const _0x49b9c3=_0x53ae65;try{if(_0x4dd191[_0x49b9c3(0x10e)](multiUserMode,_0x22beec)){const _0x42949f=await _0x4dd191[_0x49b9c3(0x1ba)](userFromSession,_0x240b73,_0x22beec);if(!_0x42949f||_0x42949f[_0x49b9c3(0x109)]){_0x22beec[_0x49b9c3(0x1dd)](0x193)[_0x49b9c3(0x18b)]();return;}_0x22beec[_0x49b9c3(0x1dd)](0xc8)['end']();return;}_0x22beec[_0x49b9c3(0x1dd)](0xc8)[_0x49b9c3(0x18b)]();}catch(_0x3f9cdc){console['log'](_0x3f9cdc['message'],_0x3f9cdc),_0x22beec[_0x49b9c3(0x1dd)](0x1f4)[_0x49b9c3(0x18b)]();}}),_0x27ded2['post'](_0x53ae65(0x18f),async(_0x2ba407,_0x2e66e5)=>{const _0x8ce77c=_0x53ae65;try{const _0x42c902=require(_0x8ce77c(0x1da));if(await SystemSettings[_0x8ce77c(0x1c2)]()){const {username:_0x27d68d,password:_0x4ab971}=_0x4dd191[_0x8ce77c(0x10a)](reqBody,_0x2ba407),_0xc13901=await User[_0x8ce77c(0x1fb)]({'username':_0x27d68d});if(!_0xc13901){_0x2e66e5['status'](0xc8)[_0x8ce77c(0x1c5)]({'user':null,'valid':![],'token':null,'message':'[001]\x20Invalid\x20login\x20credentials.'});return;}if(!_0x42c902[_0x8ce77c(0x100)](_0x4ab971,_0xc13901[_0x8ce77c(0x185)])){if(_0x4dd191['yYmJY']('QmopU',_0x8ce77c(0x1a9))){_0x2e66e5[_0x8ce77c(0x1d7)](0xc8)[_0x8ce77c(0x1c5)]({'user':null,'valid':![],'token':null,'message':_0x8ce77c(0xf3)});return;}else _0x22a605[_0x8ce77c(0x17f)](_0x3fd8f2[_0x8ce77c(0x141)],_0x30e861),_0x3fec3c['sendStatus'](0x1f4)[_0x8ce77c(0x18b)]();}if(_0xc13901[_0x8ce77c(0x109)]){_0x2e66e5[_0x8ce77c(0x1d7)](0xc8)[_0x8ce77c(0x1c5)]({'user':null,'valid':![],'token':null,'message':_0x8ce77c(0x149)});return;}await Telemetry['sendTelemetry'](_0x4dd191['qNNzd'],{'multiUserMode':![]},_0xc13901?.['id']),_0x2e66e5[_0x8ce77c(0x1d7)](0xc8)[_0x8ce77c(0x1c5)]({'valid':!![],'user':_0xc13901,'token':makeJWT({'id':_0xc13901['id'],'username':_0xc13901[_0x8ce77c(0x1d1)]},_0x8ce77c(0x134)),'message':null});return;}else{const {password:_0x21bb39}=reqBody(_0x2ba407);if(!_0x42c902['compareSync'](_0x21bb39,_0x42c902[_0x8ce77c(0x122)](process[_0x8ce77c(0xf9)][_0x8ce77c(0x117)],0xa))){_0x2e66e5[_0x8ce77c(0x1d7)](0x191)[_0x8ce77c(0x1c5)]({'valid':![],'token':null,'message':_0x4dd191[_0x8ce77c(0x16c)]});return;}await Telemetry[_0x8ce77c(0x1ab)]('login_event',{'multiUserMode':![]}),_0x2e66e5[_0x8ce77c(0x1d7)](0xc8)[_0x8ce77c(0x1c5)]({'valid':!![],'token':makeJWT({'p':_0x21bb39},_0x8ce77c(0x134)),'message':null});}}catch(_0xf3a703){console[_0x8ce77c(0x17f)](_0xf3a703[_0x8ce77c(0x141)],_0xf3a703),_0x2e66e5[_0x8ce77c(0x1dd)](0x1f4)[_0x8ce77c(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x164)],[validatedRequest],async(_0x16352c,_0x5bd4df)=>{const _0x255064=_0x53ae65;try{const _0x4591cd=queryParams(_0x16352c),_0x88fc3c=getVectorDbClass(),_0x275212=!!_0x4591cd[_0x255064(0x13d)]?await _0x88fc3c[_0x255064(0x13a)](_0x4591cd[_0x255064(0x13d)]):await _0x88fc3c[_0x255064(0x13f)]();_0x5bd4df[_0x255064(0x1d7)](0xc8)['json']({'vectorCount':_0x275212});}catch(_0x41ace3){console['log'](_0x41ace3[_0x255064(0x141)],_0x41ace3),_0x5bd4df['sendStatus'](0x1f4)[_0x255064(0x18b)]();}}),_0x27ded2[_0x53ae65(0x10c)]('/system/remove-document',[validatedRequest],async(_0x51a6cf,_0x24356d)=>{const _0x4f52f0=_0x53ae65;try{const {name:_0x56162a}=reqBody(_0x51a6cf);await purgeDocument(_0x56162a),_0x24356d[_0x4f52f0(0x1dd)](0xc8)[_0x4f52f0(0x18b)]();}catch(_0x3e1215){console['log'](_0x3e1215['message'],_0x3e1215),_0x24356d[_0x4f52f0(0x1dd)](0x1f4)[_0x4f52f0(0x18b)]();}}),_0x27ded2[_0x53ae65(0x10c)](_0x4dd191[_0x53ae65(0x13b)],[validatedRequest],async(_0x5c4348,_0x5a0529)=>{const _0x4e83ee=_0x53ae65;if(_0x4e83ee(0x207)===_0x4e83ee(0x1e2)){const _0x3592b1=_0x6825b3[_0x4e83ee(0x1b8)](_0x426018,_0x4e83ee(0x19e)+_0x436f3c);if(_0x7dcbf6['existsSync'](_0x3592b1))_0x183dd7['unlinkSync'](_0x3592b1);}else try{const {name:_0x1e7e0b}=reqBody(_0x5c4348);await purgeFolder(_0x1e7e0b),_0x5a0529[_0x4e83ee(0x1dd)](0xc8)[_0x4e83ee(0x18b)]();}catch(_0x477a98){console['log'](_0x477a98[_0x4e83ee(0x141)],_0x477a98),_0x5a0529[_0x4e83ee(0x1dd)](0x1f4)['end']();}}),_0x27ded2[_0x53ae65(0x1fb)](_0x53ae65(0x14a),[validatedRequest],async(_0x5b3b1a,_0x98de6)=>{const _0x181372=_0x53ae65;if(_0x4dd191['AhmEt']!=='cgRZA')try{const _0x2c312f=await _0x4dd191[_0x181372(0x200)](viewLocalFiles);_0x98de6[_0x181372(0x1d7)](0xc8)[_0x181372(0x1c5)]({'localFiles':_0x2c312f});}catch(_0x3763bd){_0x4dd191[_0x181372(0x12e)]===_0x181372(0x1a1)?(console['log'](_0x3763bd[_0x181372(0x141)],_0x3763bd),_0x98de6['sendStatus'](0x1f4)[_0x181372(0x18b)]()):(_0x232f30[_0x181372(0x17f)](_0x3b03ae[_0x181372(0x141)],_0xa43f3d),_0x54be34['sendStatus'](0x1f4)['end']());}else _0x470d06[_0x181372(0x18a)](_0x497bf1),_0x32c437[_0x181372(0x1d7)](0x1f4)[_0x181372(0x18b)]();}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191['RnSlQ'],[validatedRequest],async(_0x54f368,_0x221800)=>{const _0x3551a8=_0x53ae65;if(_0x4dd191[_0x3551a8(0x1a4)](_0x3551a8(0x161),_0x4dd191[_0x3551a8(0x163)]))try{const _0x57130e=await checkProcessorAlive();_0x221800[_0x3551a8(0x1dd)](_0x57130e?0xc8:0x1f7);}catch(_0xbd5e66){console[_0x3551a8(0x17f)](_0xbd5e66['message'],_0xbd5e66),_0x221800['sendStatus'](0x1f4)[_0x3551a8(0x18b)]();}else{_0xdbe5e9[_0x3551a8(0x1dd)](0x191)[_0x3551a8(0x18b)]();return;}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x136)],[validatedRequest],async(_0x44d3eb,_0x69143f)=>{const _0x2d7374=_0x53ae65;try{const _0x170e5f=await _0x4dd191[_0x2d7374(0x170)](acceptedFileTypes);if(!_0x170e5f){_0x69143f[_0x2d7374(0x1dd)](0x194)[_0x2d7374(0x18b)]();return;}_0x69143f[_0x2d7374(0x1d7)](0xc8)[_0x2d7374(0x1c5)]({'types':_0x170e5f});}catch(_0x361bf7){console[_0x2d7374(0x17f)](_0x361bf7[_0x2d7374(0x141)],_0x361bf7),_0x69143f[_0x2d7374(0x1dd)](0x1f4)[_0x2d7374(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1a3)](_0x4dd191[_0x53ae65(0x1c0)],[validatedRequest,flexUserRoleValid],async(_0x21cc59,_0x4bb883)=>{const _0x56c82e=_0x53ae65,_0x5ccea9={'ytyiW':_0x56c82e(0x149)};try{const _0x2381d2=await userFromSession(_0x21cc59,_0x4bb883);if(!!_0x2381d2&&_0x4dd191[_0x56c82e(0x1a4)](_0x2381d2[_0x56c82e(0x14f)],'admin')){if(_0x4dd191[_0x56c82e(0x1a4)](_0x4dd191[_0x56c82e(0x176)],_0x4dd191[_0x56c82e(0x1f6)])){_0x4bb883[_0x56c82e(0x1dd)](0x191)[_0x56c82e(0x18b)]();return;}else{_0x579e7b[_0x56c82e(0x1d7)](0xc8)[_0x56c82e(0x1c5)]({'user':null,'valid':![],'token':null,'message':_0x5ccea9[_0x56c82e(0x118)]});return;}}const _0xd81473=reqBody(_0x21cc59),{newValues:_0x58572f,error:_0x3a2bf8}=await _0x4dd191[_0x56c82e(0x210)](updateENV,_0xd81473);if(_0x4dd191[_0x56c82e(0x168)](process[_0x56c82e(0xf9)][_0x56c82e(0x1f1)],_0x56c82e(0x139)))await dumpENV();_0x4bb883[_0x56c82e(0x1d7)](0xc8)['json']({'newValues':_0x58572f,'error':_0x3a2bf8});}catch(_0x3f996e){console[_0x56c82e(0x17f)](_0x3f996e['message'],_0x3f996e),_0x4bb883[_0x56c82e(0x1dd)](0x1f4)[_0x56c82e(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1a3)](_0x4dd191[_0x53ae65(0x16b)],[validatedRequest],async(_0x283761,_0x4bed35)=>{const _0x54edf8=_0x53ae65;try{if(multiUserMode(_0x4bed35)){_0x4bed35['sendStatus'](0x191)['end']();return;}const {usePassword:_0x34b42e,newPassword:_0x1987bd}=reqBody(_0x283761),{error:_0x44d9fb}=await updateENV({'AuthToken':_0x34b42e?_0x1987bd:'','JWTSecret':_0x34b42e?_0x4dd191[_0x54edf8(0x12b)](v4):''},!![]);if(_0x4dd191['JZsCL'](process[_0x54edf8(0xf9)][_0x54edf8(0x1f1)],'production'))await dumpENV();_0x4bed35[_0x54edf8(0x1d7)](0xc8)[_0x54edf8(0x1c5)]({'success':!_0x44d9fb,'error':_0x44d9fb});}catch(_0x331494){console[_0x54edf8(0x17f)](_0x331494[_0x54edf8(0x141)],_0x331494),_0x4bed35[_0x54edf8(0x1dd)](0x1f4)[_0x54edf8(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1a3)](_0x53ae65(0x19f),[validatedRequest],async(_0x53ace0,_0x1ea521)=>{const _0x1cb917=_0x53ae65;try{const {username:_0x499baf,password:_0x1d93f9}=_0x4dd191[_0x1cb917(0x150)](reqBody,_0x53ace0),_0x322810=await SystemSettings[_0x1cb917(0x1c2)]();if(_0x322810){_0x1ea521['status'](0xc8)[_0x1cb917(0x1c5)]({'success':![],'error':_0x4dd191[_0x1cb917(0x110)]});return;}const {user:_0x187bde,error:_0x375b22}=await User[_0x1cb917(0x196)]({'username':_0x499baf,'password':_0x1d93f9,'role':_0x4dd191[_0x1cb917(0x179)]});await SystemSettings[_0x1cb917(0x194)]({'multi_user_mode':!![],'users_can_delete_workspaces':![],'limit_user_messages':![],'message_limit':0x19}),await _0x4dd191[_0x1cb917(0x1c3)](updateENV,{'AuthToken':'','JWTSecret':process['env'][_0x1cb917(0x183)]||_0x4dd191[_0x1cb917(0x200)](v4)},!![]);if(_0x4dd191['tKhjc'](process[_0x1cb917(0xf9)][_0x1cb917(0x1f1)],_0x4dd191[_0x1cb917(0x191)]))await dumpENV();await Telemetry[_0x1cb917(0x1ab)]('enabled_multi_user_mode',{'multiUserMode':!![]}),_0x1ea521[_0x1cb917(0x1d7)](0xc8)[_0x1cb917(0x1c5)]({'success':!!_0x187bde,'error':_0x375b22});}catch(_0x3a4b98){await User[_0x1cb917(0x10c)]({}),await SystemSettings[_0x1cb917(0x194)]({'multi_user_mode':![]}),console['log'](_0x3a4b98[_0x1cb917(0x141)],_0x3a4b98),_0x1ea521[_0x1cb917(0x1dd)](0x1f4)['end']();}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191['rIaay'],async(_0x328e9a,_0x67839e)=>{const _0x5cd029=_0x53ae65;try{const _0x528196=await SystemSettings[_0x5cd029(0x1c2)]();_0x67839e[_0x5cd029(0x1d7)](0xc8)[_0x5cd029(0x1c5)]({'multiUserMode':_0x528196});}catch(_0x2bd2fa){console[_0x5cd029(0x17f)](_0x2bd2fa[_0x5cd029(0x141)],_0x2bd2fa),_0x67839e[_0x5cd029(0x1dd)](0x1f4)[_0x5cd029(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1fb)]('/system/data-export',[validatedRequest,flexUserRoleValid],async(_0x3251e5,_0x4db57c)=>{const _0x33475d=_0x53ae65;try{const {filename:_0xecc194,error:_0x2db19c}=await exportData();_0x4db57c[_0x33475d(0x1d7)](0xc8)[_0x33475d(0x1c5)]({'filename':_0xecc194,'error':_0x2db19c});}catch(_0x116e9e){console[_0x33475d(0x17f)](_0x116e9e['message'],_0x116e9e),_0x4db57c['sendStatus'](0x1f4)[_0x33475d(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x17e)],(_0x4bed7b,_0x59bb0c)=>{const _0x22e56d=_0x53ae65,_0x22d69d={'vixvQ':_0x22e56d(0x146)},_0x4c6183=__dirname+_0x22e56d(0x15f),_0x86ac06=_0x4dd191['DcaFx'](normalizePath,_0x4bed7b['params'][_0x22e56d(0x1e8)]),_0x24c7e5=path[_0x22e56d(0x1b8)](_0x4c6183,_0x86ac06);if(!fs[_0x22e56d(0xf2)](_0x24c7e5)){_0x59bb0c[_0x22e56d(0x1d7)](0x194)['json']({'error':0x194,'msg':_0x22e56d(0x14e)+_0x4bed7b[_0x22e56d(0x20d)]['filename']+_0x22e56d(0x151)});return;}_0x59bb0c[_0x22e56d(0x1b2)](_0x24c7e5,_0x4bed7b[_0x22e56d(0x20d)]['filename'],_0xe2a49=>{const _0x31b382=_0x22e56d;_0xe2a49&&_0x59bb0c[_0x31b382(0x20c)]({'error':_0xe2a49,'msg':_0x22d69d[_0x31b382(0x1a2)]}),fs['rmSync'](_0x24c7e5);});}),_0x27ded2[_0x53ae65(0x1a3)](_0x53ae65(0x1ed),handleImports[_0x53ae65(0x1a7)](_0x4dd191['XKlST']),async function(_0xb84c8a,_0x5a9e43){const _0x56b8da=_0x53ae65,{originalname:_0x244dfb}=_0xb84c8a[_0x56b8da(0x1eb)],{success:_0xf0af6a,error:_0x2ff187}=await _0x4dd191[_0x56b8da(0x130)](unpackAndOverwriteImport,_0x244dfb);_0x5a9e43['status'](0xc8)[_0x56b8da(0x1c5)]({'success':_0xf0af6a,'error':_0x2ff187});}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x1c4)],async function(_0x1b3206,_0x1d6400){const _0x5d70c4=_0x53ae65;try{const _0x174835=_0x4dd191[_0x5d70c4(0x128)](getDefaultFilename),_0x1b75ba=await _0x4dd191['JuPlD'](determineLogoFilepath,_0x174835),{found:_0x2d6739,buffer:_0x763c3e,size:_0x5521b8,mime:_0x436a54}=fetchLogo(_0x1b75ba);if(!_0x2d6739){_0x1d6400[_0x5d70c4(0x1dd)](0xcc)[_0x5d70c4(0x18b)]();return;}_0x1d6400[_0x5d70c4(0x1c7)](0xc8,{'Content-Type':_0x436a54||_0x5d70c4(0x123),'Content-Disposition':'attachment;\x20filename='+path[_0x5d70c4(0x205)](_0x1b75ba),'Content-Length':_0x5521b8}),_0x1d6400[_0x5d70c4(0x18b)](Buffer[_0x5d70c4(0x181)](_0x763c3e,'base64'));return;}catch(_0x8d59b8){console[_0x5d70c4(0x18a)](_0x5d70c4(0x160),_0x8d59b8),_0x1d6400['status'](0x1f4)[_0x5d70c4(0x1c5)]({'message':_0x5d70c4(0x1b3)});}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191['qfYYV'],async function(_0x1b44f1,_0x3716cb){const _0x25febf=_0x53ae65;try{const {id:_0x5848ee}=_0x1b44f1[_0x25febf(0x20d)],_0x4efe56=await _0x4dd191[_0x25febf(0x13c)](determinePfpFilepath,_0x5848ee);if(!_0x4efe56){_0x3716cb[_0x25febf(0x1dd)](0xcc)[_0x25febf(0x18b)]();return;}const {found:_0x3667f2,buffer:_0x41a541,size:_0xb5d140,mime:_0x149da1}=_0x4dd191[_0x25febf(0x1aa)](fetchPfp,_0x4efe56);if(!_0x3667f2){_0x3716cb[_0x25febf(0x1dd)](0xcc)['end']();return;}_0x3716cb[_0x25febf(0x1c7)](0xc8,{'Content-Type':_0x149da1||_0x25febf(0x123),'Content-Disposition':_0x25febf(0x1ad)+path[_0x25febf(0x205)](_0x4efe56),'Content-Length':_0xb5d140}),_0x3716cb[_0x25febf(0x18b)](Buffer[_0x25febf(0x181)](_0x41a541,_0x4dd191['KNsWR']));return;}catch(_0x4c5dd7){console['error'](_0x4dd191[_0x25febf(0x1c8)],_0x4c5dd7),_0x3716cb[_0x25febf(0x1d7)](0x1f4)[_0x25febf(0x1c5)]({'message':_0x25febf(0x1b3)});}}),_0x27ded2['post'](_0x4dd191['yITkh'],[validatedRequest,flexUserRoleValid],handlePfpUploads[_0x53ae65(0x1a7)](_0x4dd191[_0x53ae65(0x167)]),async function(_0xdafd19,_0x51a379){const _0xd50107=_0x53ae65;try{const _0xa68538=await userFromSession(_0xdafd19,_0x51a379),_0x5e46f2=_0xdafd19['randomFileName'];if(!_0x5e46f2)return _0x51a379[_0xd50107(0x1d7)](0x190)['json']({'message':_0xd50107(0x198)});const _0x5d245a=await User[_0xd50107(0x1fb)]({'id':_0xa68538['id']}),_0x21ea0f=_0x4dd191[_0xd50107(0x1c6)](normalizePath,_0x5d245a['pfpFilename']);console[_0xd50107(0x17f)](_0x4dd191[_0xd50107(0x158)],_0x21ea0f);if(_0x21ea0f){const _0x58096b=path[_0xd50107(0x1b8)](__dirname,'../storage/assets/pfp/'+_0x21ea0f);if(fs['existsSync'](_0x58096b))fs['unlinkSync'](_0x58096b);}const {success:_0x246731,error:_0x3deda5}=await User['update'](_0xa68538['id'],{'pfpFilename':_0x5e46f2});return _0x51a379[_0xd50107(0x1d7)](_0x246731?0xc8:0x1f4)[_0xd50107(0x1c5)]({'message':_0x246731?'Profile\x20picture\x20uploaded\x20successfully.':_0x3deda5||_0xd50107(0x175)});}catch(_0x5c5e0c){console['error'](_0x4dd191[_0xd50107(0x120)],_0x5c5e0c),_0x51a379[_0xd50107(0x1d7)](0x1f4)[_0xd50107(0x1c5)]({'message':_0xd50107(0x1b3)});}}),_0x27ded2[_0x53ae65(0x10c)]('/system/remove-pfp',[validatedRequest,flexUserRoleValid],async function(_0x331664,_0x339565){const _0x4a3e56=_0x53ae65;try{const _0x510a51=await userFromSession(_0x331664,_0x339565),_0x7ede8a=await User[_0x4a3e56(0x1fb)]({'id':_0x510a51['id']}),_0x52a61d=normalizePath(_0x7ede8a[_0x4a3e56(0x1ec)]);console['log'](_0x4dd191[_0x4a3e56(0x158)],_0x52a61d);if(_0x52a61d){const _0x4e32c1=path[_0x4a3e56(0x1b8)](__dirname,_0x4a3e56(0x19e)+_0x52a61d);if(fs[_0x4a3e56(0xf2)](_0x4e32c1))fs[_0x4a3e56(0x11b)](_0x4e32c1);}const {success:_0x1965bb,error:_0x9bd1e}=await User[_0x4a3e56(0x10d)](_0x510a51['id'],{'pfpFilename':null});return _0x339565['status'](_0x1965bb?0xc8:0x1f4)['json']({'message':_0x1965bb?_0x4dd191[_0x4a3e56(0x180)]:_0x9bd1e||_0x4dd191['BCuAT']});}catch(_0x59d1b6){console['error'](_0x4dd191[_0x4a3e56(0x108)],_0x59d1b6),_0x339565[_0x4a3e56(0x1d7)](0x1f4)[_0x4a3e56(0x1c5)]({'message':_0x4dd191['YMAuh']});}}),_0x27ded2[_0x53ae65(0x1a3)](_0x4dd191[_0x53ae65(0x11e)],[validatedRequest,flexUserRoleValid],handleLogoUploads['single'](_0x4dd191[_0x53ae65(0x206)]),async(_0x2428bb,_0x14d166)=>{const _0x1230bd=_0x53ae65;if(!_0x2428bb['file']||!_0x2428bb[_0x1230bd(0x1eb)][_0x1230bd(0x165)])return _0x4dd191[_0x1230bd(0x1f8)]('ZAFLV',_0x1230bd(0x1a6))?_0x14d166[_0x1230bd(0x1d7)](0x190)[_0x1230bd(0x1c5)]({'message':_0x4dd191['lmWAa']}):_0x84c140['status'](0xc8)[_0x1230bd(0x1c5)]({'canDelete':!![]});if(!validFilename(_0x2428bb[_0x1230bd(0x1eb)][_0x1230bd(0x165)]))return _0x14d166[_0x1230bd(0x1d7)](0x190)[_0x1230bd(0x1c5)]({'message':_0x1230bd(0x16e)});try{const _0x1a3dca=await renameLogoFile(_0x2428bb[_0x1230bd(0x1eb)][_0x1230bd(0x165)]),_0x1a21f9=await SystemSettings[_0x1230bd(0x195)]();await removeCustomLogo(_0x1a21f9);const {success:_0x3866e7,error:_0x3bf8b7}=await SystemSettings[_0x1230bd(0x194)]({'logo_filename':_0x1a3dca});return _0x14d166[_0x1230bd(0x1d7)](_0x3866e7?0xc8:0x1f4)[_0x1230bd(0x1c5)]({'message':_0x3866e7?_0x4dd191['iLrTN']:_0x4dd191['ffolz'](_0x3bf8b7,_0x4dd191[_0x1230bd(0x114)])});}catch(_0x15f3c3){console[_0x1230bd(0x18a)](_0x4dd191[_0x1230bd(0x1df)],_0x15f3c3),_0x14d166[_0x1230bd(0x1d7)](0x1f4)[_0x1230bd(0x1c5)]({'message':_0x1230bd(0x155)});}}),_0x27ded2[_0x53ae65(0x1fb)](_0x53ae65(0xfb),async(_0xe35777,_0x57c607)=>{const _0x1c4760=_0x53ae65;try{const _0x1b1b46=await SystemSettings['currentLogoFilename'](),_0x4796a9=_0x1b1b46===LOGO_FILENAME;_0x57c607[_0x1c4760(0x1d7)](0xc8)[_0x1c4760(0x1c5)]({'isDefaultLogo':_0x4796a9});}catch(_0xf6d65d){console[_0x1c4760(0x18a)](_0x1c4760(0x160),_0xf6d65d),_0x57c607[_0x1c4760(0x1d7)](0x1f4)['json']({'message':_0x1c4760(0x1b3)});}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x197)],[validatedRequest,flexUserRoleValid],async(_0x4c128d,_0x2b4f40)=>{const _0x117880=_0x53ae65;try{const _0x25f69a=await SystemSettings['currentLogoFilename']();await removeCustomLogo(_0x25f69a);const {success:_0xd7ae8d,error:_0x7d0987}=await SystemSettings[_0x117880(0x194)]({'logo_filename':LOGO_FILENAME});return _0x2b4f40[_0x117880(0x1d7)](_0xd7ae8d?0xc8:0x1f4)[_0x117880(0x1c5)]({'message':_0xd7ae8d?_0x4dd191[_0x117880(0xfd)]:_0x4dd191[_0x117880(0x129)](_0x7d0987,_0x117880(0x135))});}catch(_0x2895b4){console[_0x117880(0x18a)](_0x117880(0xf5),_0x2895b4),_0x2b4f40['status'](0x1f4)[_0x117880(0x1c5)]({'message':_0x117880(0x17c)});}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x19a)],[validatedRequest],async function(_0x13d469,_0x5e4d2d){const _0x208bdc=_0x53ae65;try{if(!_0x5e4d2d[_0x208bdc(0x1d8)][_0x208bdc(0x192)])return _0x5e4d2d[_0x208bdc(0x1d7)](0xc8)[_0x208bdc(0x1c5)]({'canDelete':!![]});const _0x341e70=await _0x4dd191[_0x208bdc(0x1ba)](userFromSession,_0x13d469,_0x5e4d2d);if([_0x4dd191['tzRZW'],_0x4dd191[_0x208bdc(0x153)]]['includes'](_0x341e70?.[_0x208bdc(0x14f)]))return _0x5e4d2d[_0x208bdc(0x1d7)](0xc8)[_0x208bdc(0x1c5)]({'canDelete':!![]});const _0x24a400=await SystemSettings[_0x208bdc(0x1c1)]();_0x5e4d2d[_0x208bdc(0x1d7)](0xc8)[_0x208bdc(0x1c5)]({'canDelete':_0x24a400});}catch(_0x3e697c){console[_0x208bdc(0x18a)](_0x4dd191['FYpxt'],_0x3e697c),_0x5e4d2d[_0x208bdc(0x1d7)](0x1f4)[_0x208bdc(0x1c5)]({'success':![],'message':_0x4dd191[_0x208bdc(0x182)],'canDelete':![]});}}),_0x27ded2[_0x53ae65(0x1fb)]('/system/welcome-messages',async function(_0x20e1f7,_0x12e33a){const _0x5e79d8=_0x53ae65;try{const _0x12f597=await WelcomeMessages[_0x5e79d8(0x1f3)]();_0x12e33a['status'](0xc8)[_0x5e79d8(0x1c5)]({'success':!![],'welcomeMessages':_0x12f597});}catch(_0x5a8a15){_0x4dd191['PqrrA']===_0x4dd191[_0x5e79d8(0x1b5)]?(console['error'](_0x4dd191[_0x5e79d8(0x133)],_0x5a8a15),_0x12e33a['status'](0x1f4)[_0x5e79d8(0x1c5)]({'success':![],'message':_0x4dd191[_0x5e79d8(0x182)]})):(_0x5d0d43['log'](_0x342e6c['message'],_0x36f547),_0x93677b[_0x5e79d8(0x1dd)](0x1f4)[_0x5e79d8(0x18b)]());}}),_0x27ded2['post'](_0x4dd191[_0x53ae65(0x16a)],[validatedRequest,flexUserRoleValid],async(_0x1e3d83,_0xdc55c)=>{const _0x5841f6=_0x53ae65;try{const {messages:messages=[]}=reqBody(_0x1e3d83);if(!Array[_0x5841f6(0x137)](messages))return _0xdc55c[_0x5841f6(0x1d7)](0x190)[_0x5841f6(0x1c5)]({'success':![],'message':_0x5841f6(0x156)});return await WelcomeMessages[_0x5841f6(0x143)](messages),_0xdc55c[_0x5841f6(0x1d7)](0xc8)[_0x5841f6(0x1c5)]({'success':!![],'message':'Welcome\x20messages\x20saved\x20successfully.'});}catch(_0x28a26d){if(_0x4dd191[_0x5841f6(0x1b7)](_0x4dd191['noTKa'],'hqSIe')){_0x319c81[_0x5841f6(0x1dd)](0xcc)[_0x5841f6(0x18b)]();return;}else console[_0x5841f6(0x18a)](_0x5841f6(0x189),_0x28a26d),_0xdc55c[_0x5841f6(0x1d7)](0x1f4)[_0x5841f6(0x1c5)]({'success':!![],'message':_0x5841f6(0x115)});}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x13e)],[validatedRequest],async(_0x279f3b,_0x50f633)=>{const _0x3b87d7=_0x53ae65;try{if(_0x50f633['locals']['multiUserMode'])return _0x50f633[_0x3b87d7(0x1dd)](0x191)[_0x3b87d7(0x18b)]();const _0x567004=await ApiKey[_0x3b87d7(0x103)]({});return _0x50f633[_0x3b87d7(0x1d7)](0xc8)[_0x3b87d7(0x1c5)]({'apiKeys':_0x567004,'error':null});}catch(_0x3e0ba5){console[_0x3b87d7(0x18a)](_0x3e0ba5),_0x50f633[_0x3b87d7(0x1d7)](0x1f4)[_0x3b87d7(0x1c5)]({'apiKey':null,'error':_0x3b87d7(0x126)});}}),_0x27ded2[_0x53ae65(0x1a3)](_0x53ae65(0x184),[validatedRequest],async(_0x5b9936,_0x50f0d1)=>{const _0x16d3f5=_0x53ae65;try{if(_0x4dd191[_0x16d3f5(0x1b7)](_0x16d3f5(0x20a),'hGjxk')){if(_0x50f0d1['locals']['multiUserMode']){if(_0x16d3f5(0x1e6)!==_0x16d3f5(0x1e6)){_0x58c02c[_0x16d3f5(0x1d7)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x16d3f5(0xf3)});return;}else return _0x50f0d1[_0x16d3f5(0x1dd)](0x191)[_0x16d3f5(0x18b)]();}const {apiKey:_0x1e7223,error:_0x590bc3}=await ApiKey[_0x16d3f5(0x196)]();return _0x50f0d1[_0x16d3f5(0x1d7)](0xc8)[_0x16d3f5(0x1c5)]({'apiKey':_0x1e7223,'error':_0x590bc3});}else{_0x189119[_0x16d3f5(0x1dd)](0xcc)[_0x16d3f5(0x18b)]();return;}}catch(_0x230363){console[_0x16d3f5(0x18a)](_0x230363),_0x50f0d1[_0x16d3f5(0x1d7)](0x1f4)['json']({'apiKey':null,'error':_0x4dd191[_0x16d3f5(0x152)]});}}),_0x27ded2['delete'](_0x4dd191[_0x53ae65(0x18d)],[validatedRequest],async(_0x194b50,_0x85dd9c)=>{const _0x307e7c=_0x53ae65;try{if(_0x4dd191[_0x307e7c(0x1f7)](_0x4dd191['SysWM'],_0x4dd191[_0x307e7c(0x1ac)]))return _0x391aae[_0x307e7c(0x1dd)](0x191)['end']();else{if(_0x85dd9c['locals']['multiUserMode'])return _0x85dd9c['sendStatus'](0x191)['end']();return await ApiKey[_0x307e7c(0x10c)](),_0x85dd9c[_0x307e7c(0x1d7)](0xc8)['end']();}}catch(_0x8c7d32){console[_0x307e7c(0x18a)](_0x8c7d32),_0x85dd9c[_0x307e7c(0x1d7)](0x1f4)[_0x307e7c(0x18b)]();}}),_0x27ded2['post'](_0x4dd191[_0x53ae65(0x1bc)],[validatedRequest],async(_0x3f46fc,_0x45b917)=>{const _0xd0cfce=_0x53ae65;try{const {provider:_0x177da1,apiKey:apiKey=null,basePath:basePath=null}=_0x4dd191['tVdBT'](reqBody,_0x3f46fc),{models:_0x501eae,error:_0x2eedbb}=await _0x4dd191[_0xd0cfce(0xf0)](getCustomModels,_0x177da1,apiKey,basePath);return _0x45b917[_0xd0cfce(0x1d7)](0xc8)[_0xd0cfce(0x1c5)]({'models':_0x501eae,'error':_0x2eedbb});}catch(_0xf35998){if(_0xd0cfce(0x18c)!==_0x4dd191[_0xd0cfce(0x106)])console[_0xd0cfce(0x18a)](_0xf35998),_0x45b917[_0xd0cfce(0x1d7)](0x1f4)['end']();else{_0x15f390['status'](0x190)[_0xd0cfce(0x1c5)]({'success':![],'error':_0xd0cfce(0x131)});return;}}}),_0x27ded2[_0x53ae65(0x1a3)]('/system/workspace-chats',[validatedRequest,flexUserRoleValid],async(_0x4f93c9,_0x3dc917)=>{const _0x2b4f39=_0x53ae65;try{const {offset:offset=0x0,limit:limit=0x14}=reqBody(_0x4f93c9),_0x1f6743=await WorkspaceChats[_0x2b4f39(0x20f)]({},limit,_0x4dd191[_0x2b4f39(0x19d)](offset,limit),{'id':_0x2b4f39(0x1fa)}),_0x4d61cb=await WorkspaceChats[_0x2b4f39(0x177)](),_0x416269=_0x4d61cb>_0x4dd191[_0x2b4f39(0x19d)](_0x4dd191[_0x2b4f39(0x10f)](offset,0x1),limit);_0x3dc917[_0x2b4f39(0x1d7)](0xc8)['json']({'chats':_0x1f6743,'hasPages':_0x416269,'totalChats':_0x4d61cb});}catch(_0x5706b7){console[_0x2b4f39(0x18a)](_0x5706b7),_0x3dc917['sendStatus'](0x1f4)[_0x2b4f39(0x18b)]();}}),_0x27ded2[_0x53ae65(0x10c)](_0x53ae65(0x12a),[validatedRequest,flexUserRoleValid],async(_0x2080f6,_0x495ddc)=>{const _0x49c907=_0x53ae65;try{if(_0x4dd191['Ojwrj'](_0x49c907(0x116),_0x4dd191[_0x49c907(0x203)])){const {id:_0xabd2c7}=_0x2080f6['params'];await WorkspaceChats[_0x49c907(0x10c)]({'id':_0x4dd191['oqrzK'](Number,_0xabd2c7)}),_0x495ddc['sendStatus'](0xc8)[_0x49c907(0x18b)]();}else _0xce0037[_0x49c907(0x17f)](_0x44e440['message'],_0x1f5ac8),_0x5254a9[_0x49c907(0x1dd)](0x1f4)[_0x49c907(0x18b)]();}catch(_0x5a2a82){console[_0x49c907(0x18a)](_0x5a2a82),_0x495ddc[_0x49c907(0x1dd)](0x1f4)[_0x49c907(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1fb)](_0x4dd191[_0x53ae65(0x1cb)],[validatedRequest,flexUserRoleValid],async(_0x1e30e9,_0x32ca91)=>{const _0x50454a=_0x53ae65,_0x104a87={'Bvrbr':_0x50454a(0x14c),'CdYNC':'user','nmDoa':_0x4dd191['fBuKJ']};try{const _0x41e146=await WorkspaceChats['whereWithData']({},null,null,{'id':_0x4dd191[_0x50454a(0x1a8)]}),_0xc701c7=[...new Set(_0x41e146['map'](_0x405890=>_0x405890[_0x50454a(0xfe)]))],_0x2c9669=await Promise['all'](_0xc701c7[_0x50454a(0x15b)](_0x292536=>Workspace[_0x50454a(0x1fb)]({'id':Number(_0x292536)}))),_0x576d39=_0x2c9669[_0x50454a(0x1a5)]((_0x30b8af,_0x2f5987)=>{const _0x476ab3=_0x50454a;return _0x104a87[_0x476ab3(0x1ce)]===_0x476ab3(0x14c)?(_0x30b8af[_0x2f5987['id']]=_0x2f5987[_0x476ab3(0x16d)],_0x30b8af):_0x4f480a[_0x476ab3(0x1d7)](0x190)[_0x476ab3(0x1c5)]({'success':![],'message':_0x476ab3(0x156)});},{}),_0x17ddcc=_0x41e146[_0x50454a(0x1a5)]((_0x4874e9,_0x42fc01)=>{const _0x1d6736=_0x50454a,{prompt:_0x197e5e,response:_0x1d0117,workspaceId:_0x50367d}=_0x42fc01,_0x2e5760=JSON[_0x1d6736(0xff)](_0x1d0117);return!_0x4874e9[_0x50367d]&&(_0x4874e9[_0x50367d]={'messages':[{'role':_0x1d6736(0x171),'content':_0x576d39[_0x50367d]||'Given\x20the\x20following\x20conversation,\x20relevant\x20context,\x20and\x20a\x20follow\x20up\x20question,\x20reply\x20with\x20an\x20answer\x20to\x20the\x20current\x20question\x20the\x20user\x20is\x20asking.\x20Return\x20only\x20your\x20response\x20to\x20the\x20question\x20given\x20the\x20above\x20information\x20following\x20the\x20users\x20instructions\x20as\x20needed.'}]}),_0x4874e9[_0x50367d][_0x1d6736(0x18e)][_0x1d6736(0x1db)]({'role':_0x104a87['CdYNC'],'content':_0x197e5e},{'role':_0x104a87[_0x1d6736(0x157)],'content':_0x2e5760['text']}),_0x4874e9;},{}),_0xa2453c=Object[_0x50454a(0x144)](_0x17ddcc)[_0x50454a(0x15b)](_0xe03284=>JSON['stringify'](_0xe03284))['join']('\x0a');_0x32ca91['setHeader'](_0x50454a(0x1b0),_0x50454a(0x1d4)),_0x32ca91[_0x50454a(0x1d7)](0xc8)[_0x50454a(0x20c)](_0xa2453c);}catch(_0x21ae74){if(_0x4dd191[_0x50454a(0x1bb)](_0x4dd191[_0x50454a(0x1af)],_0x4dd191[_0x50454a(0x1ff)])){_0x546eff[_0x50454a(0x1d7)](0x190)[_0x50454a(0x1c5)]({'success':![],'error':_0x4dd191[_0x50454a(0x1fd)]});return;}else console['error'](_0x21ae74),_0x32ca91[_0x50454a(0x1dd)](0x1f4)[_0x50454a(0x18b)]();}}),_0x27ded2[_0x53ae65(0x1a3)](_0x4dd191['SvLIL'],[validatedRequest],async(_0x2232ef,_0x254de6)=>{const _0x2302bf=_0x53ae65,_0x2e238e={'sHSbG':_0x4dd191[_0x2302bf(0x1bf)]};if(_0x4dd191['GWGRL']!==_0x4dd191['lyTSj'])try{const _0x5b4c47=await _0x4dd191[_0x2302bf(0x11d)](userFromSession,_0x2232ef,_0x254de6),{username:_0x54daff,password:_0x4128ed}=_0x4dd191[_0x2302bf(0x1ea)](reqBody,_0x2232ef),_0x353e3b=_0x4dd191[_0x2302bf(0x210)](Number,_0x5b4c47['id']);if(!_0x353e3b){_0x254de6[_0x2302bf(0x1d7)](0x190)[_0x2302bf(0x1c5)]({'success':![],'error':_0x2302bf(0x131)});return;}const _0x3f8f9e={};_0x54daff&&(_0x3f8f9e['username']=_0x54daff);if(_0x4128ed){if(_0x4dd191[_0x2302bf(0x1d5)](_0x4dd191[_0x2302bf(0x162)],_0x2302bf(0x20e)))_0x3f8f9e[_0x2302bf(0x185)]=_0x4128ed;else{_0x4a801f[_0x2302bf(0x1d7)](0xc8)[_0x2302bf(0x1c5)]({'user':null,'valid':![],'token':null,'message':_0x2e238e[_0x2302bf(0x1cf)]});return;}}if(Object[_0x2302bf(0x1cc)](_0x3f8f9e)['length']===0x0){if(_0x4dd191[_0x2302bf(0x15c)]!==_0x4dd191[_0x2302bf(0x145)]){_0x254de6[_0x2302bf(0x1d7)](0x190)['json']({'success':![],'error':_0x4dd191['nOlgZ']});return;}else return _0x1278c1['status'](0x190)[_0x2302bf(0x1c5)]({'message':_0x4dd191['JDCri']});}const {success:_0x266ab9,error:_0x82d8e6}=await User[_0x2302bf(0x10d)](_0x353e3b,_0x3f8f9e);_0x254de6['status'](0xc8)[_0x2302bf(0x1c5)]({'success':_0x266ab9,'error':_0x82d8e6});}catch(_0x309177){if(_0x4dd191['cPJJC']!==_0x4dd191[_0x2302bf(0x12f)])console[_0x2302bf(0x18a)](_0x309177),_0x254de6['sendStatus'](0x1f4)['end']();else return _0x30cce4[_0x2302bf(0x1d7)](0x190)[_0x2302bf(0x1c5)]({'message':_0x2302bf(0x1f4)});}else _0x1b8906['error'](_0xbcfa3),_0x15e18c[_0x2302bf(0x1dd)](0x1f4)['end']();});}module['exports']={'systemEndpoints':systemEndpoints};