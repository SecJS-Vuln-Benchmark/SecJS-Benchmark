const _0x2bc1b4=_0x1b25;function _0x126c(){const _0x14b30f=['npx\x20prisma\x20migrate\x20deploy\x20--schema=./prisma/schema.prisma','dEdMT','2118918sfxtBo','unlinkSync','[004]\x20Account\x20suspended\x20by\x20admin.','IPJgA','EuODX','/request-token','RzJNv','SOCwe','1283170EuWeBC','post','Invalid\x20file\x20name.\x20Please\x20choose\x20a\x20different\x20file.','../utils/files/documentProcessor','ZcVJW','originalname','kcqkJ','eDqvX','production','bcrypt','FzyOe','VVMtJ','FkoBx','admin','tkbXo','loSlB','file','nyvAJ','writeHead','Profile\x20picture\x20uploaded\x20successfully.','aOFpn','iHGtI','QDWXL','push','../models/telemetry','Error\x20fetching\x20can\x20delete\x20workspaces:','LtCuv','create','BbxcI','DNabJ','MHkap','get','KKdGq','PpPmO','join','FVJXh','password','eMDOW','HseSU','dLGwI','NODE_ENV','error','oldPfpFilename','Logo\x20removed\x20successfully.','compareSync','RHlwO','/system/is-default-logo','tSRuH','PnWPV','181870lnhhoB','mWnqR','rVzuX','from','CaPbo','ZRuHm','rlzsL','keys','vbfem','multiUserMode','saveAll','../models/systemSettings','/system/welcome-messages','XYxIl','../utils/middleware/multiUserProtected','VaeRp','hDqyO','child_process','362375CktpZX','/system/generate-api-key','OSVUM','AhVuo','/system/user','isMultiUserMode','MusyG','reduce','text','setHeader','namespaceCount','MHqJS','ugcKl','logo','user','UhTwI','json','Invalid\x20user\x20ID','IxdyJ','delete','Ujviv','system','lNeHq','../utils/files/purgeDocument','AUTH_TOKEN','suspended','development','LatwL','UNSqg','Failed\x20to\x20update\x20with\x20new\x20logo.','desc','XCvHz','../utils/files/logo','LXIGx','Esmvf','application/jsonl','/system/api-keys','values','update','MqLGm','EWdpQ','DQuGU','existsSync','Logo\x20uploaded\x20successfully.','fWLCf','Content-Type','dknQg','FtNYw','[001]\x20Invalid\x20login\x20credentials.','single','JWT_SECRET','hWNmI','/system/system-vectors','../utils/http','role','No\x20logo\x20file\x20provided.','ErcYn','Hovna','bFTVe','bNXGK','Could\x20not\x20find\x20an\x20API\x20Key.','/system/export-chats','CYMws','getMessages','shARP','vQADp','dotenv','WOzDA','asc','vkAvp','TVgFh','log','ZjeHN','HpqHP','jwBaH','zpOpf','../storage/assets/pfp/','nbQiQ','jOtUK','HxVbA','params','35QuwbhG','ANBuB','Error\x20saving\x20the\x20welcome\x20messages.','mjjPs','iDdzC','/system/remove-pfp','../utils/helpers/updateENV','rXogQ','Internal\x20server\x20error','basename','NpJhF','Welcome\x20messages\x20saved\x20successfully.','/system/accepted-document-types','eEaAn','vWIlP','[003]\x20Invalid\x20password\x20provided','exports','/system/workspace-chats/:id','dHfPF','[002]\x20Invalid\x20login\x20credentials.','No\x20updates\x20provided','includes','TtEWL','isArray','randomFileName','MjBCq','execSync','/system/upload-pfp','30d','../utils/files','../utils/helpers/customModels','/system/set-welcome-messages','../utils/helpers','/system/api-key','/system/logo','QcLJp','jUjfD','GgndE','/env-dump','../models/welcomeMessages','currentSettings','/migrate','count','xRVeG','Yxnhu','NWoNv','tnqst','username','updateSettings','whereWithData','lPkYo','ewtFc','env','nYRzl','Error\x20removing\x20the\x20logo.','Error\x20processing\x20the\x20profile\x20picture\x20upload:','UELcS','QweQJ','map','Error\x20processing\x20the\x20welcome\x20messages:','1490024BJirbQ','Given\x20the\x20following\x20conversation,\x20relevant\x20context,\x20and\x20a\x20follow\x20up\x20question,\x20reply\x20with\x20an\x20answer\x20to\x20the\x20current\x20question\x20the\x20user\x20is\x20asking.\x20Return\x20only\x20your\x20response\x20to\x20the\x20question\x20given\x20the\x20above\x20information\x20following\x20the\x20users\x20instructions\x20as\x20needed.','/system/update-env','message','LJeQR','/system/enable-multi-user','Error\x20processing\x20the\x20logo\x20request:','../models/user','Error\x20processing\x20the\x20logo\x20upload:','RGBey','where','QKSFi','currentLogoFilename','Oksjr','sendStatus','ajeHI','hlQRY','../models/apiKeys','kmlhd','LMRsp','/system/document-processing-status','rltwX','assistant','/system/remove-logo','totalVectors','XtDSu','attachment;\x20filename=','pfpFilename','owomh','Xtpzp','/ping','/system/remove-folder','onFft','parse','Failed\x20to\x20remove\x20profile\x20picture.','/system/upload-logo','Error\x20fetching\x20welcome\x20messages:','gdvsG','manager','2363829pxmDbq','Profile\x20picture\x20removed\x20successfully.','messages','tVbxh','image/png','WgmBP','end','../utils/files/multer','/system/can-delete-workspaces','axmRS','wksfy','hrlOa','Error\x20generating\x20api\x20key.','../models/workspace','base64','dRhWV','config','/system/custom-models','File\x20upload\x20failed.','402492hXZSYD','workspaceId','status','locals','eARzn','sendTelemetry','.env.','stringify'];_0x126c=function(){return _0x14b30f;};return _0x126c();}(function(_0x21a36d,_0x44c6d4){const _0x3ad44e=_0x1b25,_0x26eada=_0x21a36d();while(!![]){try{const _0x8d155c=parseInt(_0x3ad44e(0x202))/0x1+-parseInt(_0x3ad44e(0x233))/0x2+parseInt(_0x3ad44e(0x2f9))/0x3+-parseInt(_0x3ad44e(0x30c))/0x4+parseInt(_0x3ad44e(0x245))/0x5+-parseInt(_0x3ad44e(0x1fa))/0x6+parseInt(_0x3ad44e(0x296))/0x7*(-parseInt(_0x3ad44e(0x2d2))/0x8);if(_0x8d155c===_0x44c6d4)break;else _0x26eada['push'](_0x26eada['shift']());}catch(_0x8ad94f){_0x26eada['push'](_0x26eada['shift']());}}}(_0x126c,0xa2fdc),process[_0x2bc1b4(0x2ca)][_0x2bc1b4(0x22a)]===_0x2bc1b4(0x25f)?require(_0x2bc1b4(0x287))['config']({'path':_0x2bc1b4(0x1f6)+process[_0x2bc1b4(0x2ca)][_0x2bc1b4(0x22a)]}):require('dotenv')[_0x2bc1b4(0x309)]());const {viewLocalFiles,normalizePath}=require(_0x2bc1b4(0x2b3)),{checkProcessorAlive,acceptedFileTypes}=require(_0x2bc1b4(0x205)),{purgeDocument,purgeFolder}=require(_0x2bc1b4(0x25c)),{getVectorDbClass}=require(_0x2bc1b4(0x2b6)),{updateENV,dumpENV}=require(_0x2bc1b4(0x29c)),{reqBody,makeJWT,userFromSession,multiUserMode,queryParams}=require(_0x2bc1b4(0x27a)),{setupDataImports,setupLogoUploads,setupPfpUploads}=require(_0x2bc1b4(0x300)),{v4}=require('uuid'),{SystemSettings}=require(_0x2bc1b4(0x23e)),{User}=require(_0x2bc1b4(0x2d9)),{validatedRequest}=require('../utils/middleware/validatedRequest'),{handleImports}=setupDataImports(),{handleLogoUploads}=setupLogoUploads(),{handlePfpUploads}=setupPfpUploads(),fs=require('fs'),path=require('path'),{getDefaultFilename,determineLogoFilepath,fetchLogo,validFilename,renameLogoFile,removeCustomLogo,LOGO_FILENAME}=require(_0x2bc1b4(0x265)),{Telemetry}=require(_0x2bc1b4(0x21a)),{WelcomeMessages}=require(_0x2bc1b4(0x2bd)),{ApiKey}=require(_0x2bc1b4(0x2e3)),{getCustomModels}=require(_0x2bc1b4(0x2b4)),{WorkspaceChats}=require('../models/workspaceChats'),{Workspace}=require(_0x2bc1b4(0x306)),{flexUserRoleValid}=require(_0x2bc1b4(0x241)),{fetchPfp,determinePfpFilepath}=require('../utils/files/pfp');function systemEndpoints(_0x38101f){const _0x49f0a9=_0x2bc1b4,_0x50af84={'XCvHz':function(_0x4fc5e5,_0x310292){return _0x4fc5e5!==_0x310292;},'ugcKl':'bFTVe','jOtUK':function(_0x5d9b46,_0x429202,_0x2139ac){return _0x5d9b46(_0x429202,_0x2139ac);},'QKSFi':_0x49f0a9(0x1f8),'Hovna':'inherit','WOzDA':function(_0x27c4e2,_0x3cacba){return _0x27c4e2!==_0x3cacba;},'yBJiw':function(_0x4ea7ad){return _0x4ea7ad();},'eEaAn':function(_0x4e67ed,_0xeaaa75){return _0x4e67ed===_0xeaaa75;},'MHkap':_0x49f0a9(0x285),'LJeQR':function(_0x33740d,_0x202072){return _0x33740d(_0x202072);},'mWnqR':function(_0x41f574,_0x392e05,_0x1650c3){return _0x41f574(_0x392e05,_0x1650c3);},'rltwX':function(_0x53b688,_0x1789fd){return _0x53b688(_0x1789fd);},'prdvl':_0x49f0a9(0x275),'zpOpf':_0x49f0a9(0x1fc),'ZRuHm':'login_event','owomh':_0x49f0a9(0x2b2),'eDqvX':_0x49f0a9(0x2a5),'TVgFh':function(_0xb6d41a,_0x271a56){return _0xb6d41a!==_0x271a56;},'VVMtJ':function(_0x4731ed,_0x37a9fa){return _0x4731ed===_0x37a9fa;},'rXogQ':'MqLGm','GgndE':function(_0x5a744a){return _0x5a744a();},'OSVUM':function(_0x966b13,_0xa731ba){return _0x966b13(_0xa731ba);},'rVzuX':'pDWzY','loSlB':_0x49f0a9(0x26e),'jwBaH':function(_0x1916a0){return _0x1916a0();},'kmlhd':function(_0x24c4f8,_0x184be0){return _0x24c4f8!==_0x184be0;},'Yxnhu':_0x49f0a9(0x2df),'RGBey':_0x49f0a9(0x2d3),'fSRtm':_0x49f0a9(0x253),'CYMws':_0x49f0a9(0x2e8),'LMRsp':_0x49f0a9(0x20f),'xNhZw':_0x49f0a9(0x2b9),'hrlOa':function(_0x5d98b5,_0x5c2192){return _0x5d98b5(_0x5c2192);},'axmRS':_0x49f0a9(0x20a),'xRVeG':'dLGwI','eARzn':function(_0x516fea,_0x17ba1a,_0x285b87){return _0x516fea(_0x17ba1a,_0x285b87);},'aOFpn':function(_0xa9f938){return _0xa9f938();},'VaeRp':'Multi-user\x20mode\x20is\x20already\x20enabled.','HxVbA':function(_0xa249a3){return _0xa249a3();},'PpPmO':_0x49f0a9(0x307),'NWoNv':_0x49f0a9(0x2d8),'NpJhF':function(_0x14d0a0,_0x1995ca){return _0x14d0a0!==_0x1995ca;},'ZjeHN':_0x49f0a9(0x218),'Xtpzp':_0x49f0a9(0x2a4),'WgmBP':_0x49f0a9(0x200),'QweQJ':function(_0xf12fe3,_0x3a2638){return _0xf12fe3||_0x3a2638;},'dRhWV':'image/png','HseSU':_0x49f0a9(0x29e),'MusyG':_0x49f0a9(0x240),'vkMts':function(_0x1a4fce,_0x120586){return _0x1a4fce(_0x120586);},'RHlwO':_0x49f0a9(0x22c),'lPkYo':_0x49f0a9(0x215),'mjjPs':'Failed\x20to\x20update\x20with\x20new\x20profile\x20picture.','hlQRY':_0x49f0a9(0x2fa),'DNabJ':_0x49f0a9(0x2f4),'nYRzl':'Error\x20processing\x20the\x20profile\x20picture\x20removal:','FPUKn':'Error\x20processing\x20the\x20logo\x20removal:','TtEWL':_0x49f0a9(0x27c),'nbQiQ':_0x49f0a9(0x1fd),'HBmGZ':function(_0x2f8b31,_0x81f85b){return _0x2f8b31(_0x81f85b);},'FkoBx':_0x49f0a9(0x270),'tSRuH':function(_0x3854c9,_0xcb9644){return _0x3854c9||_0xcb9644;},'OLedc':'Error\x20uploading\x20the\x20logo.','gdvsG':function(_0xd3b967,_0x273106){return _0xd3b967===_0x273106;},'FzyOe':'ZqNZf','vQADp':_0x49f0a9(0x2cc),'fWLCf':function(_0x453445,_0x4ef9a8){return _0x453445!==_0x4ef9a8;},'bzjNR':_0x49f0a9(0x2af),'ErcYn':'Invalid\x20message\x20format.\x20Expected\x20an\x20array\x20of\x20messages.','lNeHq':function(_0x1692f2,_0x1e3e70){return _0x1692f2===_0x1e3e70;},'KKdGq':_0x49f0a9(0x248),'nKMcZ':_0x49f0a9(0x2a8),'bNXGK':_0x49f0a9(0x305),'EuODX':_0x49f0a9(0x297),'RMCeP':function(_0x17722e,_0x579748){return _0x17722e===_0x579748;},'tnqst':_0x49f0a9(0x21e),'dknQg':_0x49f0a9(0x243),'wksfy':function(_0x39764e,_0x10c3be,_0x5b7a36,_0x3b6616){return _0x39764e(_0x10c3be,_0x5b7a36,_0x3b6616);},'sfMwn':_0x49f0a9(0x225),'XtDSu':function(_0x227921,_0x73bd9){return _0x227921*_0x73bd9;},'ewtFc':_0x49f0a9(0x263),'gISwF':function(_0x22e207,_0x5f3261){return _0x22e207>_0x5f3261;},'LXIGx':function(_0x2ab889,_0x24a9a2){return _0x2ab889+_0x24a9a2;},'HpqHP':_0x49f0a9(0x289),'nomUI':_0x49f0a9(0x268),'RFLkq':function(_0x2b7fe3,_0x5d300c,_0x57c405){return _0x2b7fe3(_0x5d300c,_0x57c405);},'VOsbq':function(_0x255891,_0x13654a){return _0x255891(_0x13654a);},'IxdyJ':function(_0x182530,_0xf45151){return _0x182530(_0xf45151);},'LatwL':_0x49f0a9(0x2aa),'PnWPV':_0x49f0a9(0x2bf),'aQljV':_0x49f0a9(0x2bc),'UNSqg':'/system/check-token','LtCuv':_0x49f0a9(0x279),'jUjfD':_0x49f0a9(0x2d7),'Esmvf':'/system/multi-user-mode','DeaPp':_0x49f0a9(0x2b8),'UhTwI':_0x49f0a9(0x2b1),'ajeHI':_0x49f0a9(0x212),'eMDOW':_0x49f0a9(0x2f5),'FtNYw':_0x49f0a9(0x230),'hWNmI':_0x49f0a9(0x301),'MHqJS':_0x49f0a9(0x2b5),'vkAvp':_0x49f0a9(0x246),'hPjYV':_0x49f0a9(0x249)};if(!_0x38101f)return;_0x38101f[_0x49f0a9(0x221)](_0x49f0a9(0x2f0),(_0x4d2513,_0x221c60)=>{const _0x293353=_0x49f0a9;_0x221c60[_0x293353(0x1f2)](0xc8)[_0x293353(0x255)]({'online':!![]});}),_0x38101f[_0x49f0a9(0x221)](_0x50af84[_0x49f0a9(0x232)],async(_0x6936f2,_0x37ba2a)=>{const _0x3d0740=_0x49f0a9;if(_0x50af84[_0x3d0740(0x264)](_0x50af84[_0x3d0740(0x251)],_0x3d0740(0x27f))){_0x456a2f[_0x3d0740(0x1f2)](0x190)[_0x3d0740(0x255)]({'success':![],'error':_0x3d0740(0x256)});return;}else{const _0x455e6e=require(_0x3d0740(0x244))[_0x3d0740(0x2b0)];_0x50af84['jOtUK'](_0x455e6e,_0x50af84[_0x3d0740(0x2dd)],{'stdio':_0x50af84[_0x3d0740(0x27e)]}),_0x37ba2a['sendStatus'](0xc8);}}),_0x38101f[_0x49f0a9(0x221)](_0x50af84['aQljV'],async(_0xc29b05,_0x531bf8)=>{const _0x295af5=_0x49f0a9;if(_0x50af84[_0x295af5(0x288)](process[_0x295af5(0x2ca)][_0x295af5(0x22a)],_0x295af5(0x20a)))return _0x531bf8[_0x295af5(0x2e0)](0xc8)[_0x295af5(0x2ff)]();await _0x50af84['yBJiw'](dumpENV),_0x531bf8[_0x295af5(0x2e0)](0xc8)[_0x295af5(0x2ff)]();}),_0x38101f[_0x49f0a9(0x221)]('/setup-complete',async(_0x5ebbe8,_0x2098b3)=>{const _0xb5e9e7=_0x49f0a9;if(_0x50af84['eEaAn'](_0x50af84[_0xb5e9e7(0x220)],_0xb5e9e7(0x285)))try{const _0x22d377=await SystemSettings[_0xb5e9e7(0x2be)]();_0x2098b3['status'](0xc8)[_0xb5e9e7(0x255)]({'results':_0x22d377});}catch(_0x5b61de){console[_0xb5e9e7(0x28c)](_0x5b61de[_0xb5e9e7(0x2d5)],_0x5b61de),_0x2098b3[_0xb5e9e7(0x2e0)](0x1f4)[_0xb5e9e7(0x2ff)]();}else{_0x3c4d0f[_0xb5e9e7(0x2e0)](0xcc)['end']();return;}}),_0x38101f[_0x49f0a9(0x221)](_0x50af84[_0x49f0a9(0x261)],[validatedRequest],async(_0x554cba,_0x26bffe)=>{const _0x34dab6=_0x49f0a9;try{if(_0x50af84['LJeQR'](multiUserMode,_0x26bffe)){const _0x23fef2=await _0x50af84[_0x34dab6(0x234)](userFromSession,_0x554cba,_0x26bffe);if(!_0x23fef2||_0x23fef2['suspended']){_0x26bffe[_0x34dab6(0x2e0)](0x193)['end']();return;}_0x26bffe['sendStatus'](0xc8)[_0x34dab6(0x2ff)]();return;}_0x26bffe[_0x34dab6(0x2e0)](0xc8)[_0x34dab6(0x2ff)]();}catch(_0xdf6936){console[_0x34dab6(0x28c)](_0xdf6936[_0x34dab6(0x2d5)],_0xdf6936),_0x26bffe[_0x34dab6(0x2e0)](0x1f4)[_0x34dab6(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x203)](_0x49f0a9(0x1ff),async(_0x40b554,_0x1fb3ee)=>{const _0x583ab3=_0x49f0a9;try{const _0x57178e=require(_0x583ab3(0x20b));if(await SystemSettings[_0x583ab3(0x24a)]()){const {username:_0x15280c,password:_0x11915e}=_0x50af84[_0x583ab3(0x2e7)](reqBody,_0x40b554),_0x3c5add=await User[_0x583ab3(0x221)]({'username':_0x15280c});if(!_0x3c5add){_0x1fb3ee[_0x583ab3(0x1f2)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x50af84['prdvl']});return;}if(!_0x57178e[_0x583ab3(0x22e)](_0x11915e,_0x3c5add['password'])){_0x1fb3ee['status'](0xc8)[_0x583ab3(0x255)]({'user':null,'valid':![],'token':null,'message':_0x583ab3(0x2a9)});return;}if(_0x3c5add[_0x583ab3(0x25e)]){_0x1fb3ee[_0x583ab3(0x1f2)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x50af84[_0x583ab3(0x290)]});return;}await Telemetry['sendTelemetry'](_0x50af84[_0x583ab3(0x238)],{'multiUserMode':![]},_0x3c5add?.['id']),_0x1fb3ee[_0x583ab3(0x1f2)](0xc8)[_0x583ab3(0x255)]({'valid':!![],'user':_0x3c5add,'token':_0x50af84['mWnqR'](makeJWT,{'id':_0x3c5add['id'],'username':_0x3c5add[_0x583ab3(0x2c5)]},_0x50af84[_0x583ab3(0x2ee)]),'message':null});return;}else{const {password:_0x217d07}=reqBody(_0x40b554);if(!_0x57178e[_0x583ab3(0x22e)](_0x217d07,_0x57178e['hashSync'](process[_0x583ab3(0x2ca)][_0x583ab3(0x25d)],0xa))){_0x1fb3ee['status'](0x191)[_0x583ab3(0x255)]({'valid':![],'token':null,'message':_0x50af84[_0x583ab3(0x209)]});return;}await Telemetry[_0x583ab3(0x1f5)](_0x50af84[_0x583ab3(0x238)],{'multiUserMode':![]}),_0x1fb3ee[_0x583ab3(0x1f2)](0xc8)['json']({'valid':!![],'token':makeJWT({'p':_0x217d07},'30d'),'message':null});}}catch(_0x383533){console[_0x583ab3(0x28c)](_0x383533[_0x583ab3(0x2d5)],_0x383533),_0x1fb3ee[_0x583ab3(0x2e0)](0x1f4)[_0x583ab3(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x221)](_0x50af84[_0x49f0a9(0x21c)],[validatedRequest],async(_0x17b7c6,_0x20e9a7)=>{const _0xcc4e43=_0x49f0a9;if(_0x50af84[_0xcc4e43(0x28b)](_0xcc4e43(0x2f2),_0xcc4e43(0x217)))try{if(_0x50af84[_0xcc4e43(0x20d)](_0xcc4e43(0x26c),_0x50af84[_0xcc4e43(0x29d)])){const _0x2e49dd=queryParams(_0x17b7c6),_0x104668=_0x50af84[_0xcc4e43(0x2bb)](getVectorDbClass),_0x39f3ea=!!_0x2e49dd['slug']?await _0x104668[_0xcc4e43(0x24f)](_0x2e49dd['slug']):await _0x104668[_0xcc4e43(0x2ea)]();_0x20e9a7[_0xcc4e43(0x1f2)](0xc8)['json']({'vectorCount':_0x39f3ea});}else _0x12931f[_0xcc4e43(0x28c)](_0x576a4f[_0xcc4e43(0x2d5)],_0x39c790),_0x4fef43[_0xcc4e43(0x2e0)](0x1f4)[_0xcc4e43(0x2ff)]();}catch(_0x176a58){console[_0xcc4e43(0x28c)](_0x176a58[_0xcc4e43(0x2d5)],_0x176a58),_0x20e9a7['sendStatus'](0x1f4)[_0xcc4e43(0x2ff)]();}else _0x47cbfc[_0xcc4e43(0x22b)](_0xcc4e43(0x2f6),_0x12a150),_0x2216c6[_0xcc4e43(0x1f2)](0x1f4)[_0xcc4e43(0x255)]({'success':![],'message':_0xcc4e43(0x29e)});}),_0x38101f[_0x49f0a9(0x258)]('/system/remove-document',[validatedRequest],async(_0x1a3d12,_0x587ed0)=>{const _0x339071=_0x49f0a9;try{if('rEmsU'===_0x339071(0x259)){_0x413ddf[_0x339071(0x1f2)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x339071(0x275)});return;}else{const {name:_0x3c7160}=reqBody(_0x1a3d12);await purgeDocument(_0x3c7160),_0x587ed0[_0x339071(0x2e0)](0xc8)[_0x339071(0x2ff)]();}}catch(_0x2f0d4b){console[_0x339071(0x28c)](_0x2f0d4b['message'],_0x2f0d4b),_0x587ed0['sendStatus'](0x1f4)[_0x339071(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x258)](_0x49f0a9(0x2f1),[validatedRequest],async(_0x589adc,_0x7f5c6b)=>{const _0x499efa=_0x49f0a9;try{const {name:_0x58ed97}=_0x50af84[_0x499efa(0x2e7)](reqBody,_0x589adc);await _0x50af84[_0x499efa(0x247)](purgeFolder,_0x58ed97),_0x7f5c6b[_0x499efa(0x2e0)](0xc8)['end']();}catch(_0xf3f99a){if(_0x499efa(0x2fc)!==_0x50af84[_0x499efa(0x235)])console[_0x499efa(0x28c)](_0xf3f99a[_0x499efa(0x2d5)],_0xf3f99a),_0x7f5c6b['sendStatus'](0x1f4)['end']();else{_0x607771[_0x499efa(0x1f2)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x499efa(0x1fc)});return;}}}),_0x38101f['get']('/system/local-files',[validatedRequest],async(_0x22b5f4,_0x55dd1f)=>{const _0x46244c=_0x49f0a9;try{if(_0x50af84[_0x46244c(0x20d)](_0x50af84[_0x46244c(0x211)],_0x50af84[_0x46244c(0x211)])){const _0x289274=await viewLocalFiles();_0x55dd1f[_0x46244c(0x1f2)](0xc8)['json']({'localFiles':_0x289274});}else _0x29f9d5[_0x46244c(0x28c)](_0x35a59b[_0x46244c(0x2d5)],_0x1fa4ff),_0x1b8936[_0x46244c(0x2e0)](0x1f4)[_0x46244c(0x2ff)]();}catch(_0xf34a2a){if(_0x50af84[_0x46244c(0x28b)](_0x46244c(0x1f9),_0x46244c(0x1f9))){const _0x1ee5f2=_0x166e5a[_0x46244c(0x224)](_0x2122da,_0x46244c(0x291)+_0x31480f);if(_0x5313be[_0x46244c(0x26f)](_0x1ee5f2))_0x399b6f[_0x46244c(0x1fb)](_0x1ee5f2);}else console[_0x46244c(0x28c)](_0xf34a2a[_0x46244c(0x2d5)],_0xf34a2a),_0x55dd1f[_0x46244c(0x2e0)](0x1f4)[_0x46244c(0x2ff)]();}}),_0x38101f['get'](_0x49f0a9(0x2e6),[validatedRequest],async(_0x1c33cc,_0x515c61)=>{const _0x39d4fe=_0x49f0a9;try{const _0x2bb846=await _0x50af84[_0x39d4fe(0x28f)](checkProcessorAlive);_0x515c61[_0x39d4fe(0x2e0)](_0x2bb846?0xc8:0x1f7);}catch(_0x363954){console[_0x39d4fe(0x28c)](_0x363954[_0x39d4fe(0x2d5)],_0x363954),_0x515c61[_0x39d4fe(0x2e0)](0x1f4)['end']();}}),_0x38101f['get'](_0x49f0a9(0x2a2),[validatedRequest],async(_0x58acb2,_0x2d58f9)=>{const _0x1acd40=_0x49f0a9;try{if(_0x50af84[_0x1acd40(0x2e4)](_0x50af84[_0x1acd40(0x2c2)],'ofHmT')){const _0x39d82a=await _0x50af84['GgndE'](acceptedFileTypes);if(!_0x39d82a){_0x2d58f9['sendStatus'](0x194)['end']();return;}_0x2d58f9[_0x1acd40(0x1f2)](0xc8)[_0x1acd40(0x255)]({'types':_0x39d82a});}else return _0x5c0314[_0x1acd40(0x1f2)](0xc8)[_0x1acd40(0x255)]({'canDelete':!![]});}catch(_0x2901c9){console[_0x1acd40(0x28c)](_0x2901c9['message'],_0x2901c9),_0x2d58f9[_0x1acd40(0x2e0)](0x1f4)[_0x1acd40(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x203)](_0x49f0a9(0x2d4),[validatedRequest,flexUserRoleValid],async(_0x51f419,_0x265b48)=>{const _0x4fd7a8=_0x49f0a9;try{const _0x58a2d5=await _0x50af84[_0x4fd7a8(0x293)](userFromSession,_0x51f419,_0x265b48);if(!!_0x58a2d5&&_0x58a2d5[_0x4fd7a8(0x27b)]!==_0x50af84['LMRsp']){if(_0x50af84['xNhZw']!=='QcLJp'){const {prompt:_0x594286,response:_0x209bb4,workspaceId:_0x482a78}=_0x4ff3db,_0x3705d1=_0x20b7a5[_0x4fd7a8(0x2f3)](_0x209bb4);return!_0x57ab09[_0x482a78]&&(_0x12c1f5[_0x482a78]={'messages':[{'role':'system','content':_0x544501[_0x482a78]||_0x50af84[_0x4fd7a8(0x2db)]}]}),_0x3c86cb[_0x482a78][_0x4fd7a8(0x2fb)][_0x4fd7a8(0x219)]({'role':_0x50af84['fSRtm'],'content':_0x594286},{'role':_0x50af84[_0x4fd7a8(0x283)],'content':_0x3705d1[_0x4fd7a8(0x24d)]}),_0xf4989a;}else{_0x265b48[_0x4fd7a8(0x2e0)](0x191)[_0x4fd7a8(0x2ff)]();return;}}const _0x3aac0f=_0x50af84['OSVUM'](reqBody,_0x51f419),{newValues:_0x265d67,error:_0x246d87}=await _0x50af84[_0x4fd7a8(0x304)](updateENV,_0x3aac0f);if(_0x50af84[_0x4fd7a8(0x20d)](process[_0x4fd7a8(0x2ca)]['NODE_ENV'],_0x50af84[_0x4fd7a8(0x302)]))await dumpENV();_0x265b48[_0x4fd7a8(0x1f2)](0xc8)[_0x4fd7a8(0x255)]({'newValues':_0x265d67,'error':_0x246d87});}catch(_0x25d332){console[_0x4fd7a8(0x28c)](_0x25d332[_0x4fd7a8(0x2d5)],_0x25d332),_0x265b48['sendStatus'](0x1f4)[_0x4fd7a8(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x203)]('/system/update-password',[validatedRequest],async(_0x24a4bf,_0x4ca019)=>{const _0x39209b=_0x49f0a9;try{if(_0x50af84[_0x39209b(0x2c1)]!==_0x39209b(0x229)){_0x1047a3[_0x39209b(0x2e0)](0x193)[_0x39209b(0x2ff)]();return;}else{if(multiUserMode(_0x4ca019)){_0x4ca019[_0x39209b(0x2e0)](0x191)[_0x39209b(0x2ff)]();return;}const {usePassword:_0x44ef41,newPassword:_0x47388d}=_0x50af84[_0x39209b(0x2e7)](reqBody,_0x24a4bf),{error:_0x31d921}=await _0x50af84[_0x39209b(0x1f4)](updateENV,{'AuthToken':_0x44ef41?_0x47388d:'','JWTSecret':_0x44ef41?_0x50af84[_0x39209b(0x216)](v4):''},!![]);if(_0x50af84[_0x39209b(0x2a3)](process[_0x39209b(0x2ca)]['NODE_ENV'],_0x50af84['axmRS']))await dumpENV();_0x4ca019[_0x39209b(0x1f2)](0xc8)[_0x39209b(0x255)]({'success':!_0x31d921,'error':_0x31d921});}}catch(_0x510299){if(_0x39209b(0x213)!==_0x39209b(0x213)){const _0x2352f4=_0x233cb4[_0x39209b(0x224)](_0x3e8e3b,_0x39209b(0x291)+_0x21c10d);if(_0x201f43['existsSync'](_0x2352f4))_0x3ab10c[_0x39209b(0x1fb)](_0x2352f4);}else console[_0x39209b(0x28c)](_0x510299[_0x39209b(0x2d5)],_0x510299),_0x4ca019['sendStatus'](0x1f4)[_0x39209b(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x203)](_0x50af84[_0x49f0a9(0x2ba)],[validatedRequest],async(_0x527c80,_0x2c8e79)=>{const _0x33138a=_0x49f0a9;try{const {username:_0xe9774c,password:_0x2c4e1b}=reqBody(_0x527c80),_0x1c71d8=await SystemSettings[_0x33138a(0x24a)]();if(_0x1c71d8){_0x2c8e79['status'](0xc8)[_0x33138a(0x255)]({'success':![],'error':_0x50af84[_0x33138a(0x242)]});return;}const {user:_0x3b0f7e,error:_0x154247}=await User[_0x33138a(0x21d)]({'username':_0xe9774c,'password':_0x2c4e1b,'role':_0x50af84[_0x33138a(0x2e5)]});await SystemSettings[_0x33138a(0x2c6)]({'multi_user_mode':!![],'users_can_delete_workspaces':![],'limit_user_messages':![],'message_limit':0x19}),await updateENV({'AuthToken':'','JWTSecret':process['env'][_0x33138a(0x277)]||v4()},!![]);if(_0x50af84[_0x33138a(0x2a3)](process[_0x33138a(0x2ca)][_0x33138a(0x22a)],_0x50af84[_0x33138a(0x302)]))await dumpENV();await Telemetry[_0x33138a(0x1f5)]('enabled_multi_user_mode',{'multiUserMode':!![]}),_0x2c8e79[_0x33138a(0x1f2)](0xc8)[_0x33138a(0x255)]({'success':!!_0x3b0f7e,'error':_0x154247});}catch(_0xaeb0){await User[_0x33138a(0x258)]({}),await SystemSettings['updateSettings']({'multi_user_mode':![]}),console[_0x33138a(0x28c)](_0xaeb0[_0x33138a(0x2d5)],_0xaeb0),_0x2c8e79[_0x33138a(0x2e0)](0x1f4)[_0x33138a(0x2ff)]();}}),_0x38101f[_0x49f0a9(0x221)](_0x50af84[_0x49f0a9(0x267)],async(_0x3b33b6,_0x340778)=>{const _0x5f4c10=_0x49f0a9;try{const _0x48cbfb=await SystemSettings[_0x5f4c10(0x24a)]();_0x340778[_0x5f4c10(0x1f2)](0xc8)[_0x5f4c10(0x255)]({'multiUserMode':_0x48cbfb});}catch(_0x1b5d7b){console[_0x5f4c10(0x28c)](_0x1b5d7b[_0x5f4c10(0x2d5)],_0x1b5d7b),_0x340778['sendStatus'](0x1f4)[_0x5f4c10(0x2ff)]();}}),_0x38101f['get'](_0x50af84['DeaPp'],async function(_0x34d99f,_0xb1b937){const _0xf5b91e=_0x49f0a9;try{const _0x277027=_0x50af84[_0xf5b91e(0x294)](getDefaultFilename),_0x2e82ab=await _0x50af84[_0xf5b91e(0x247)](determineLogoFilepath,_0x277027),{found:_0x1fd3ca,buffer:_0x52a654,size:_0x47c5bf,mime:_0x52764f}=_0x50af84[_0xf5b91e(0x2d6)](fetchLogo,_0x2e82ab);if(!_0x1fd3ca){_0xb1b937['sendStatus'](0xcc)[_0xf5b91e(0x2ff)]();return;}_0xb1b937[_0xf5b91e(0x214)](0xc8,{'Content-Type':_0x52764f||_0xf5b91e(0x2fd),'Content-Disposition':_0xf5b91e(0x2ec)+path[_0xf5b91e(0x29f)](_0x2e82ab),'Content-Length':_0x47c5bf}),_0xb1b937[_0xf5b91e(0x2ff)](Buffer[_0xf5b91e(0x236)](_0x52a654,_0x50af84[_0xf5b91e(0x223)]));return;}catch(_0xb2d3f5){console['error'](_0x50af84[_0xf5b91e(0x2c3)],_0xb2d3f5),_0xb1b937[_0xf5b91e(0x1f2)](0x1f4)[_0xf5b91e(0x255)]({'message':_0xf5b91e(0x29e)});}}),_0x38101f[_0x49f0a9(0x221)]('/system/pfp/:id',async function(_0x4340f3,_0x1f6be1){const _0x271557=_0x49f0a9;if(_0x50af84[_0x271557(0x2a0)](_0x50af84[_0x271557(0x28d)],_0x271557(0x218)))_0x3384df[_0x271557(0x22b)]('Error\x20processing\x20the\x20logo\x20request:',_0x97f52c),_0x1d0b6b[_0x271557(0x1f2)](0x1f4)[_0x271557(0x255)]({'message':_0x271557(0x29e)});else try{if(_0x50af84[_0x271557(0x2ef)]===_0x50af84[_0x271557(0x2fe)]){_0x557e3d[_0x271557(0x2e0)](0x194)[_0x271557(0x2ff)]();return;}else{const {id:_0x9231b6}=_0x4340f3[_0x271557(0x295)],_0x4fd563=await determinePfpFilepath(_0x9231b6);if(!_0x4fd563){_0x1f6be1[_0x271557(0x2e0)](0xcc)[_0x271557(0x2ff)]();return;}const {found:_0x17188c,buffer:_0x362923,size:_0x23c628,mime:_0x3be498}=fetchPfp(_0x4fd563);if(!_0x17188c){if(_0x271557(0x29a)!==_0x271557(0x29a))_0x49c3d5[_0x271557(0x2c5)]=_0x4ba84b;else{_0x1f6be1[_0x271557(0x2e0)](0xcc)[_0x271557(0x2ff)]();return;}}_0x1f6be1['writeHead'](0xc8,{'Content-Type':_0x50af84[_0x271557(0x2cf)](_0x3be498,_0x50af84[_0x271557(0x308)]),'Content-Disposition':'attachment;\x20filename='+path[_0x271557(0x29f)](_0x4fd563),'Content-Length':_0x23c628}),_0x1f6be1[_0x271557(0x2ff)](Buffer[_0x271557(0x236)](_0x362923,_0x50af84[_0x271557(0x223)]));return;}}catch(_0x1c9e00){_0x271557(0x210)===_0x271557(0x2ce)?(_0x42c5b7[_0x271557(0x22b)](_0x5c130f),_0xd1a5c2[_0x271557(0x1f2)](0x1f4)[_0x271557(0x2ff)]()):(console[_0x271557(0x22b)](_0x50af84[_0x271557(0x2c3)],_0x1c9e00),_0x1f6be1[_0x271557(0x1f2)](0x1f4)['json']({'message':_0x50af84[_0x271557(0x228)]}));}}),_0x38101f[_0x49f0a9(0x203)](_0x50af84[_0x49f0a9(0x254)],[validatedRequest,flexUserRoleValid],handlePfpUploads['single'](_0x50af84[_0x49f0a9(0x2e1)]),async function(_0x448d7c,_0x218913){const _0x241946=_0x49f0a9;if(_0x50af84[_0x241946(0x20d)](_0x241946(0x240),_0x50af84[_0x241946(0x24b)]))try{const _0x144e01=await userFromSession(_0x448d7c,_0x218913),_0x351949=_0x448d7c[_0x241946(0x2ae)];if(!_0x351949)return _0x218913[_0x241946(0x1f2)](0x190)[_0x241946(0x255)]({'message':_0x241946(0x30b)});const _0x5f494c=await User[_0x241946(0x221)]({'id':_0x144e01['id']}),_0x450635=_0x50af84['vkMts'](normalizePath,_0x5f494c[_0x241946(0x2ed)]);console[_0x241946(0x28c)](_0x50af84['RHlwO'],_0x450635);if(_0x450635){const _0x4038a0=path[_0x241946(0x224)](__dirname,_0x241946(0x291)+_0x450635);if(fs['existsSync'](_0x4038a0))fs['unlinkSync'](_0x4038a0);}const {success:_0x2d604c,error:_0x8d7f80}=await User[_0x241946(0x26b)](_0x144e01['id'],{'pfpFilename':_0x351949});return _0x218913['status'](_0x2d604c?0xc8:0x1f4)[_0x241946(0x255)]({'message':_0x2d604c?_0x50af84[_0x241946(0x2c8)]:_0x8d7f80||_0x50af84[_0x241946(0x299)]});}catch(_0x3c6aa4){console[_0x241946(0x22b)](_0x241946(0x2cd),_0x3c6aa4),_0x218913[_0x241946(0x1f2)](0x1f4)[_0x241946(0x255)]({'message':_0x50af84[_0x241946(0x228)]});}else _0x4bd12a['log'](_0x4891e8[_0x241946(0x2d5)],_0x4ecacf),_0x40f247[_0x241946(0x2e0)](0x1f4)[_0x241946(0x2ff)]();}),_0x38101f[_0x49f0a9(0x258)](_0x49f0a9(0x29b),[validatedRequest,flexUserRoleValid],async function(_0x9bd0f2,_0x51c5c4){const _0x5c63c4=_0x49f0a9;try{const _0x40331f=await userFromSession(_0x9bd0f2,_0x51c5c4),_0x47dd3b=await User[_0x5c63c4(0x221)]({'id':_0x40331f['id']}),_0x29f7cf=_0x50af84[_0x5c63c4(0x2d6)](normalizePath,_0x47dd3b['pfpFilename']);console[_0x5c63c4(0x28c)](_0x50af84[_0x5c63c4(0x22f)],_0x29f7cf);if(_0x29f7cf){const _0x3f09e4=path[_0x5c63c4(0x224)](__dirname,'../storage/assets/pfp/'+_0x29f7cf);if(fs['existsSync'](_0x3f09e4))fs[_0x5c63c4(0x1fb)](_0x3f09e4);}const {success:_0x13a081,error:_0x550b10}=await User[_0x5c63c4(0x26b)](_0x40331f['id'],{'pfpFilename':null});return _0x51c5c4[_0x5c63c4(0x1f2)](_0x13a081?0xc8:0x1f4)['json']({'message':_0x13a081?_0x50af84[_0x5c63c4(0x2e2)]:_0x550b10||_0x50af84[_0x5c63c4(0x21f)]});}catch(_0x5424f8){console['error'](_0x50af84[_0x5c63c4(0x2cb)],_0x5424f8),_0x51c5c4[_0x5c63c4(0x1f2)](0x1f4)[_0x5c63c4(0x255)]({'message':_0x5c63c4(0x29e)});}}),_0x38101f[_0x49f0a9(0x203)](_0x50af84[_0x49f0a9(0x227)],[validatedRequest,flexUserRoleValid],handleLogoUploads[_0x49f0a9(0x276)](_0x49f0a9(0x252)),async(_0xe155e9,_0x599616)=>{const _0x270189=_0x49f0a9;if(!_0xe155e9[_0x270189(0x212)]||!_0xe155e9['file'][_0x270189(0x207)]){if(_0x270189(0x206)!==_0x270189(0x206))_0x5c0152[_0x270189(0x22b)](_0x50af84['FPUKn'],_0xc9745b),_0xa6d98a[_0x270189(0x1f2)](0x1f4)[_0x270189(0x255)]({'message':_0x270189(0x2cc)});else return _0x599616['status'](0x190)[_0x270189(0x255)]({'message':_0x50af84[_0x270189(0x2ac)]});}if(!validFilename(_0xe155e9[_0x270189(0x212)][_0x270189(0x207)]))return _0x599616[_0x270189(0x1f2)](0x190)['json']({'message':_0x270189(0x204)});try{if(_0x50af84[_0x270189(0x292)]!==_0x50af84[_0x270189(0x292)])return _0x4ed688[_0x270189(0x1f2)](0x190)[_0x270189(0x255)]({'message':_0x270189(0x27c)});else{const _0x5b8e2e=await renameLogoFile(_0xe155e9[_0x270189(0x212)][_0x270189(0x207)]),_0x3ad680=await SystemSettings[_0x270189(0x2de)]();await _0x50af84['HBmGZ'](removeCustomLogo,_0x3ad680);const {success:_0x373c74,error:_0x3f0b91}=await SystemSettings['updateSettings']({'logo_filename':_0x5b8e2e});return _0x599616[_0x270189(0x1f2)](_0x373c74?0xc8:0x1f4)[_0x270189(0x255)]({'message':_0x373c74?_0x50af84[_0x270189(0x20e)]:_0x50af84[_0x270189(0x231)](_0x3f0b91,_0x270189(0x262))});}}catch(_0x4e5976){console[_0x270189(0x22b)](_0x270189(0x2da),_0x4e5976),_0x599616[_0x270189(0x1f2)](0x1f4)[_0x270189(0x255)]({'message':_0x50af84['OLedc']});}}),_0x38101f['get'](_0x50af84[_0x49f0a9(0x274)],async(_0x1f6a46,_0x122807)=>{const _0x24f0e7=_0x49f0a9;try{const _0x335bd8=await SystemSettings[_0x24f0e7(0x2de)](),_0x1efc1a=_0x50af84[_0x24f0e7(0x2f7)](_0x335bd8,LOGO_FILENAME);_0x122807['status'](0xc8)[_0x24f0e7(0x255)]({'isDefaultLogo':_0x1efc1a});}catch(_0x5df8d1){console[_0x24f0e7(0x22b)](_0x50af84[_0x24f0e7(0x2c3)],_0x5df8d1),_0x122807['status'](0x1f4)[_0x24f0e7(0x255)]({'message':_0x50af84['HseSU']});}}),_0x38101f[_0x49f0a9(0x221)](_0x49f0a9(0x2e9),[validatedRequest,flexUserRoleValid],async(_0x5e0a7a,_0x315272)=>{const _0xd6718e=_0x49f0a9,_0x5338b6={'EWdpQ':_0x50af84[_0xd6718e(0x209)]};if(_0x50af84[_0xd6718e(0x264)](_0x50af84['FzyOe'],_0x50af84[_0xd6718e(0x20c)])){_0x24ca06[_0xd6718e(0x1f2)](0x191)['json']({'valid':![],'token':null,'message':_0x5338b6[_0xd6718e(0x26d)]});return;}else try{const _0x1345ef=await SystemSettings[_0xd6718e(0x2de)]();await removeCustomLogo(_0x1345ef);const {success:_0x302185,error:_0x5036c4}=await SystemSettings[_0xd6718e(0x2c6)]({'logo_filename':LOGO_FILENAME});return _0x315272[_0xd6718e(0x1f2)](_0x302185?0xc8:0x1f4)['json']({'message':_0x302185?_0xd6718e(0x22d):_0x5036c4||_0xd6718e(0x262)});}catch(_0x2dfeb8){console[_0xd6718e(0x22b)]('Error\x20processing\x20the\x20logo\x20removal:',_0x2dfeb8),_0x315272[_0xd6718e(0x1f2)](0x1f4)[_0xd6718e(0x255)]({'message':_0x50af84[_0xd6718e(0x286)]});}}),_0x38101f['get'](_0x50af84[_0x49f0a9(0x278)],[validatedRequest],async function(_0x10b250,_0x2877f8){const _0x4b9c38=_0x49f0a9,_0x56fb05={'DchEb':'Error\x20uploading\x20the\x20logo.'};try{if(!_0x2877f8[_0x4b9c38(0x1f3)]['multiUserMode'])return _0x2877f8[_0x4b9c38(0x1f2)](0xc8)[_0x4b9c38(0x255)]({'canDelete':!![]});const _0x284295=await _0x50af84[_0x4b9c38(0x234)](userFromSession,_0x10b250,_0x2877f8);if([_0x4b9c38(0x20f),_0x4b9c38(0x2f8)][_0x4b9c38(0x2ab)](_0x284295?.[_0x4b9c38(0x27b)])){if(_0x50af84[_0x4b9c38(0x271)](_0x4b9c38(0x2af),_0x50af84['bzjNR']))_0x506425['error'](_0x4b9c38(0x2da),_0x3eba6c),_0x5dbc4a[_0x4b9c38(0x1f2)](0x1f4)[_0x4b9c38(0x255)]({'message':_0x56fb05['DchEb']});else return _0x2877f8['status'](0xc8)[_0x4b9c38(0x255)]({'canDelete':!![]});}const _0x1b571d=await SystemSettings['canDeleteWorkspaces']();_0x2877f8[_0x4b9c38(0x1f2)](0xc8)[_0x4b9c38(0x255)]({'canDelete':_0x1b571d});}catch(_0x5aba4f){console[_0x4b9c38(0x22b)](_0x4b9c38(0x21b),_0x5aba4f),_0x2877f8[_0x4b9c38(0x1f2)](0x1f4)[_0x4b9c38(0x255)]({'success':![],'message':_0x4b9c38(0x29e),'canDelete':![]});}}),_0x38101f[_0x49f0a9(0x221)](_0x49f0a9(0x23f),async function(_0xc5bc5a,_0x5f3949){const _0xf189f=_0x49f0a9;try{const _0x1a018d=await WelcomeMessages[_0xf189f(0x284)]();_0x5f3949['status'](0xc8)[_0xf189f(0x255)]({'success':!![],'welcomeMessages':_0x1a018d});}catch(_0xaba227){console[_0xf189f(0x22b)](_0xf189f(0x2f6),_0xaba227),_0x5f3949[_0xf189f(0x1f2)](0x1f4)[_0xf189f(0x255)]({'success':![],'message':_0x50af84[_0xf189f(0x228)]});}}),_0x38101f[_0x49f0a9(0x203)](_0x50af84[_0x49f0a9(0x250)],[validatedRequest,flexUserRoleValid],async(_0x48d63b,_0x195091)=>{const _0x4e7b13=_0x49f0a9;try{const {messages:messages=[]}=_0x50af84[_0x4e7b13(0x2d6)](reqBody,_0x48d63b);if(!Array[_0x4e7b13(0x2ad)](messages))return _0x195091[_0x4e7b13(0x1f2)](0x190)['json']({'success':![],'message':_0x50af84[_0x4e7b13(0x27d)]});return await WelcomeMessages[_0x4e7b13(0x23d)](messages),_0x195091['status'](0xc8)['json']({'success':!![],'message':_0x4e7b13(0x2a1)});}catch(_0x1a3714){console[_0x4e7b13(0x22b)](_0x4e7b13(0x2d1),_0x1a3714),_0x195091['status'](0x1f4)[_0x4e7b13(0x255)]({'success':!![],'message':_0x4e7b13(0x298)});}}),_0x38101f[_0x49f0a9(0x221)](_0x49f0a9(0x269),[validatedRequest],async(_0x4db351,_0x1b6f53)=>{const _0x5032e3=_0x49f0a9;try{if(_0x1b6f53['locals'][_0x5032e3(0x23c)])return _0x1b6f53['sendStatus'](0x191)[_0x5032e3(0x2ff)]();const _0x44e1f5=await ApiKey[_0x5032e3(0x2dc)]({});return _0x1b6f53[_0x5032e3(0x1f2)](0xc8)[_0x5032e3(0x255)]({'apiKeys':_0x44e1f5,'error':null});}catch(_0x45942e){console[_0x5032e3(0x22b)](_0x45942e),_0x1b6f53[_0x5032e3(0x1f2)](0x1f4)[_0x5032e3(0x255)]({'apiKey':null,'error':_0x5032e3(0x281)});}}),_0x38101f[_0x49f0a9(0x203)](_0x50af84[_0x49f0a9(0x28a)],[validatedRequest],async(_0x31206e,_0x521fcb)=>{const _0x375796=_0x49f0a9,_0x335261={'vbfem':_0x50af84[_0x375796(0x2c3)]};if(_0x50af84[_0x375796(0x25b)](_0x50af84[_0x375796(0x222)],_0x50af84['nKMcZ']))_0x356491['error'](_0x335261[_0x375796(0x23b)],_0x445cd8),_0x50c5d2['status'](0x1f4)[_0x375796(0x255)]({'message':'Internal\x20server\x20error'});else try{if(_0x521fcb[_0x375796(0x1f3)][_0x375796(0x23c)])return _0x521fcb[_0x375796(0x2e0)](0x191)[_0x375796(0x2ff)]();const {apiKey:_0x23540e,error:_0x488c0c}=await ApiKey['create']();return _0x521fcb[_0x375796(0x1f2)](0xc8)['json']({'apiKey':_0x23540e,'error':_0x488c0c});}catch(_0x4d1995){'CaPbo'===_0x375796(0x237)?(console[_0x375796(0x22b)](_0x4d1995),_0x521fcb[_0x375796(0x1f2)](0x1f4)[_0x375796(0x255)]({'apiKey':null,'error':_0x50af84[_0x375796(0x280)]})):(_0x265dc3[_0x375796(0x22b)](_0xd35c50),_0x43370d[_0x375796(0x2e0)](0x1f4)[_0x375796(0x2ff)]());}}),_0x38101f[_0x49f0a9(0x258)](_0x49f0a9(0x2b7),[validatedRequest],async(_0x4d61c5,_0x2d50ab)=>{const _0x88e162=_0x49f0a9;try{if(_0x50af84['lNeHq'](_0x88e162(0x239),_0x50af84[_0x88e162(0x1fe)]))return _0x397549[_0xe3261e['id']]=_0x3cb843['openAiPrompt'],_0x12effe;else{if(_0x2d50ab[_0x88e162(0x1f3)][_0x88e162(0x23c)])return _0x2d50ab[_0x88e162(0x2e0)](0x191)[_0x88e162(0x2ff)]();return await ApiKey['delete'](),_0x2d50ab[_0x88e162(0x1f2)](0xc8)[_0x88e162(0x2ff)]();}}catch(_0x36e896){_0x50af84['RMCeP'](_0x50af84[_0x88e162(0x2c4)],_0x88e162(0x201))?(_0x1ec601[_0x88e162(0x22b)](_0x207c0d),_0x835464[_0x88e162(0x2e0)](0x1f4)[_0x88e162(0x2ff)]()):(console[_0x88e162(0x22b)](_0x36e896),_0x2d50ab[_0x88e162(0x1f2)](0x1f4)[_0x88e162(0x2ff)]());}}),_0x38101f['post'](_0x49f0a9(0x30a),[validatedRequest],async(_0x17a87a,_0x5531fb)=>{const _0x106022=_0x49f0a9;try{if(_0x50af84['dknQg']===_0x50af84[_0x106022(0x273)]){const {provider:_0x770b0c,apiKey:apiKey=null,basePath:basePath=null}=reqBody(_0x17a87a),{models:_0x12379d,error:_0x30e1ad}=await _0x50af84[_0x106022(0x303)](getCustomModels,_0x770b0c,apiKey,basePath);return _0x5531fb[_0x106022(0x1f2)](0xc8)[_0x106022(0x255)]({'models':_0x12379d,'error':_0x30e1ad});}else return _0x41e0fa['sendStatus'](0x191)[_0x106022(0x2ff)]();}catch(_0x5406cb){console[_0x106022(0x22b)](_0x5406cb),_0x5531fb[_0x106022(0x1f2)](0x1f4)[_0x106022(0x2ff)]();}}),_0x38101f['post']('/system/workspace-chats',[validatedRequest,flexUserRoleValid],async(_0x41042e,_0x3386d5)=>{const _0x3c8969=_0x49f0a9;if(_0x50af84['sfMwn']==='NHJoW')_0x1cc072[_0x3c8969(0x28c)](_0x22e55d[_0x3c8969(0x2d5)],_0x5526c0),_0x353baa[_0x3c8969(0x2e0)](0x1f4)[_0x3c8969(0x2ff)]();else try{const {offset:offset=0x0,limit:limit=0x14}=reqBody(_0x41042e),_0x2bff48=await WorkspaceChats[_0x3c8969(0x2c7)]({},limit,_0x50af84[_0x3c8969(0x2eb)](offset,limit),{'id':_0x50af84[_0x3c8969(0x2c9)]}),_0x16a08b=await WorkspaceChats[_0x3c8969(0x2c0)](),_0x44ecb4=_0x50af84['gISwF'](_0x16a08b,_0x50af84[_0x3c8969(0x2eb)](_0x50af84[_0x3c8969(0x266)](offset,0x1),limit));_0x3386d5[_0x3c8969(0x1f2)](0xc8)[_0x3c8969(0x255)]({'chats':_0x2bff48,'hasPages':_0x44ecb4,'totalChats':_0x16a08b});}catch(_0x277c94){console[_0x3c8969(0x22b)](_0x277c94),_0x3386d5[_0x3c8969(0x2e0)](0x1f4)['end']();}}),_0x38101f[_0x49f0a9(0x258)](_0x49f0a9(0x2a7),[validatedRequest,flexUserRoleValid],async(_0x5a0b78,_0x1fd71a)=>{const _0x2108a8=_0x49f0a9;try{const {id:_0x15a9c0}=_0x5a0b78[_0x2108a8(0x295)];await WorkspaceChats[_0x2108a8(0x258)]({'id':_0x50af84['LJeQR'](Number,_0x15a9c0)}),_0x1fd71a[_0x2108a8(0x2e0)](0xc8)[_0x2108a8(0x2ff)]();}catch(_0x44f561){console[_0x2108a8(0x22b)](_0x44f561),_0x1fd71a[_0x2108a8(0x2e0)](0x1f4)[_0x2108a8(0x2ff)]();}}),_0x38101f['get'](_0x49f0a9(0x282),[validatedRequest,flexUserRoleValid],async(_0x425aae,_0x1e9c83)=>{const _0x5214c6=_0x49f0a9;try{const _0x12ded8=await WorkspaceChats['whereWithData']({},null,null,{'id':_0x50af84[_0x5214c6(0x28e)]}),_0x4cb32d=[...new Set(_0x12ded8[_0x5214c6(0x2d0)](_0x3725ec=>_0x3725ec[_0x5214c6(0x1f1)]))],_0x4125fe=await Promise['all'](_0x4cb32d[_0x5214c6(0x2d0)](_0x146d59=>Workspace['get']({'id':Number(_0x146d59)}))),_0x2eca12=_0x4125fe[_0x5214c6(0x24c)]((_0x137db9,_0x2d1249)=>{return _0x137db9[_0x2d1249['id']]=_0x2d1249['openAiPrompt'],_0x137db9;},{}),_0x4da178=_0x12ded8[_0x5214c6(0x24c)]((_0x5d473c,_0x575031)=>{const _0x2bbf88=_0x5214c6;if('uOaNF'===_0x2bbf88(0x208)){_0x523e30['sendStatus'](0xcc)[_0x2bbf88(0x2ff)]();return;}else{const {prompt:_0x4973ef,response:_0x4e9e84,workspaceId:_0x21beef}=_0x575031,_0x20e0f7=JSON[_0x2bbf88(0x2f3)](_0x4e9e84);return!_0x5d473c[_0x21beef]&&(_0x5d473c[_0x21beef]={'messages':[{'role':_0x2bbf88(0x25a),'content':_0x2eca12[_0x21beef]||_0x2bbf88(0x2d3)}]}),_0x5d473c[_0x21beef][_0x2bbf88(0x2fb)][_0x2bbf88(0x219)]({'role':_0x2bbf88(0x253),'content':_0x4973ef},{'role':'assistant','content':_0x20e0f7[_0x2bbf88(0x24d)]}),_0x5d473c;}},{}),_0x241107=Object[_0x5214c6(0x26a)](_0x4da178)[_0x5214c6(0x2d0)](_0x40ceef=>JSON[_0x5214c6(0x1f7)](_0x40ceef))[_0x5214c6(0x224)]('\x0a');_0x1e9c83[_0x5214c6(0x24e)](_0x5214c6(0x272),_0x50af84['nomUI']),_0x1e9c83[_0x5214c6(0x1f2)](0xc8)['send'](_0x241107);}catch(_0x41a4a0){console['error'](_0x41a4a0),_0x1e9c83[_0x5214c6(0x2e0)](0x1f4)['end']();}}),_0x38101f[_0x49f0a9(0x203)](_0x50af84['hPjYV'],[validatedRequest],async(_0x29502c,_0x101055)=>{const _0xac64da=_0x49f0a9;try{const _0x12fdb9=await _0x50af84['RFLkq'](userFromSession,_0x29502c,_0x101055),{username:_0x54cf21,password:_0x550fcb}=_0x50af84['VOsbq'](reqBody,_0x29502c),_0x5bb0eb=_0x50af84[_0xac64da(0x257)](Number,_0x12fdb9['id']);if(!_0x5bb0eb){_0x101055[_0xac64da(0x1f2)](0x190)[_0xac64da(0x255)]({'success':![],'error':_0xac64da(0x256)});return;}const _0x5b1ca5={};_0x54cf21&&(_0x5b1ca5['username']=_0x54cf21);_0x550fcb&&(_0x5b1ca5[_0xac64da(0x226)]=_0x550fcb);if(Object[_0xac64da(0x23a)](_0x5b1ca5)['length']===0x0){_0x101055[_0xac64da(0x1f2)](0x190)[_0xac64da(0x255)]({'success':![],'error':_0x50af84[_0xac64da(0x260)]});return;}const {success:_0x432f4a,error:_0x2d8fbe}=await User[_0xac64da(0x26b)](_0x5bb0eb,_0x5b1ca5);_0x101055[_0xac64da(0x1f2)](0xc8)[_0xac64da(0x255)]({'success':_0x432f4a,'error':_0x2d8fbe});}catch(_0x21c11a){console[_0xac64da(0x22b)](_0x21c11a),_0x101055[_0xac64da(0x2e0)](0x1f4)[_0xac64da(0x2ff)]();}});}function _0x1b25(_0x202479,_0x1e4a62){const _0x126c7b=_0x126c();return _0x1b25=function(_0x1b257f,_0x4b169b){_0x1b257f=_0x1b257f-0x1f1;let _0x312471=_0x126c7b[_0x1b257f];return _0x312471;},_0x1b25(_0x202479,_0x1e4a62);}module[_0x2bc1b4(0x2a6)]={'systemEndpoints':systemEndpoints};