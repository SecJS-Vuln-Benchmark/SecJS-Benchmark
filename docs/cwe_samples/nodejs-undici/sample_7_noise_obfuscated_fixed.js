'use strict';function _0x4863(_0x4a4be2,_0x1f6ecd){const _0x1230d8=_0x1230();return _0x4863=function(_0x4863f0,_0xb254c){_0x4863f0=_0x4863f0-0x13e;let _0x270a6f=_0x1230d8[_0x4863f0];return _0x270a6f;},_0x4863(_0x4a4be2,_0x1f6ecd);}const _0x15617f=_0x4863;function _0x1230(){const _0xa81a83=['CloseSession','KEEPALIVE','IDRcG','subscriptionId','UUFso','args','Extdp','findNode','Xdgmi','length','IgdCZ','DDD\x20delete\x20a\x20subscription\x20with\x202\x20outstanding\x20PublishRequest','23307sQehlN','new_subscription','currentSubscriptionCount','maxKeepAliveCount','name','Good','requestHandle','BadNoSubscription','LATE','tick','XCX\x20session\x20should\x20emit\x20a\x20new_subscription\x20and\x20subscription_terminated\x20event','closeSession','subscription_terminated','deleteSubscription','sequenceNumber','ns=0;i=2258','nodeId','CLOSED','ZDZ-1\x20create\x20and\x20terminate\x202\x20subscriptions\x20,\x20with\x204\x20publish\x20requests','status','CREATING','BhYlG','notificationData','removeListener','should\x20check\x20the\x20subscription\x20live\x20cycle','spy','createSubscription','node-opcua-leak-detector','cumulatedSubscriptionCount','JrOlL','./helper_with_fake_timer','serviceResult','2007790hKTbHx','getSubscription','TwkYa','messageSent','eql','4329616LaXtCz','Both','BadSubscriptionIdInvalid','238oOMIaK','clock','createSession','HCIvi','monitoredItem','currentSessionCount','ServerEngine\x20Subscriptions\x20service','cumulatedSessionCount','8657978uYqgRJ','QRkBt','state','BaseDataVariableType','return\x20new\x20Date();','AZW1\x20should\x20receive\x20StatusChangeNotification\x20from\x20first\x20subscription\x20even\x20if\x20publishRequest\x20arrives\x20late','instanceOf','IIHdj','statusCode','ZDZ-2\x20LifetimeCount,\x20the\x20publish\x20engine\x20shall\x20send\x20a\x20StatusChangeNotification\x20to\x20inform\x20that\x20a\x20subscription\x20has\x20been\x20closed\x20because\x20of\x20lifetime\x20timeout\x20-\x20with\x202\x20subscriptions','dispose','should\x20maintain\x20the\x20correct\x20number\x20of\x20cumulatedSubscriptionCount\x20at\x20the\x20engine\x20level','512556VtCQCb','XQrOF','Reporting','initialize','jGuGq','FolderType','should','responseHeader','HlnQM','addressSpace','3570820UlBCoz','authenticationToken','jsOCC','ARizS','AZQ\x20should\x20receive\x20StatusChangeNotification\x20from\x20first\x20subscription\x20even\x20if\x20publishRequest\x20arrives\x20late','node-opcua-service-read','6031920KKLpxs','_on_PublishRequest','node-opcua-service-subscription','call','KPzqv','constructor','notificationMessage','ffSWK','mLrIR','9rDjRIQ','getCall','lifeTimeCount','should\x20return\x20an\x20error\x20when\x20trying\x20to\x20delete\x20an\x20non-existing\x20subscription','qYzyv','exist','publishingInterval','BadTimeout','IFfee','hbtCy','callCount','publishEngine','sinon','equal','GCmQs','mnuEk'];_0x1230=function(){return _0xa81a83;};return _0x1230();}(function(_0x29a00b,_0x5414e0){const _0x399d15=_0x4863,_0x2da784=_0x29a00b();while(!![]){try{const _0x477b0c=parseInt(_0x399d15(0x183))/0x1+-parseInt(_0x399d15(0x16f))/0x2*(parseInt(_0x399d15(0x147))/0x3)+parseInt(_0x399d15(0x18d))/0x4+-parseInt(_0x399d15(0x167))/0x5+-parseInt(_0x399d15(0x193))/0x6+parseInt(_0x399d15(0x177))/0x7+-parseInt(_0x399d15(0x16c))/0x8*(-parseInt(_0x399d15(0x19c))/0x9);if(_0x477b0c===_0x5414e0)break;else _0x2da784['push'](_0x2da784['shift']());}catch(_0x56864a){_0x2da784['push'](_0x2da784['shift']());}}}(_0x1230,0xcffd8));const should=require('should'),sinon=require(_0x15617f(0x1a8)),{MonitoringMode,PublishRequest}=require(_0x15617f(0x195)),{StatusCodes,StatusCode}=require('node-opcua-status-code'),{TimestampsToReturn}=require(_0x15617f(0x192)),{MonitoredItemCreateRequest}=require('node-opcua-service-subscription'),{get_mini_nodeset_filename}=require('node-opcua-address-space/testHelpers'),{ServerEngine,SubscriptionState}=require('..'),{with_fake_timer}=require(_0x15617f(0x165)),mini_nodeset_filename=get_mini_nodeset_filename(),describe=require(_0x15617f(0x162))['describeWithLeakDetector'];describe(_0x15617f(0x175),function(){const _0x45762e=_0x15617f,_0x567b1a={'HlnQM':_0x45762e(0x17a),'BhYlG':function(_0x3b1121){return _0x3b1121();},'qYzyv':'new_subscription','hbtCy':_0x45762e(0x153),'IgdCZ':function(_0x3c428,_0x4cbb25){return _0x3c428*_0x4cbb25;},'ARizS':function(_0x5d2814,_0x371b68){return _0x5d2814*_0x371b68;},'TwkYa':'CloseSession','OsPxn':_0x45762e(0x156),'iqBKf':function(_0x45899d,_0x305117){return _0x45899d(_0x305117);},'XQrOF':function(_0x1602a2,_0x1a4916){return _0x1602a2(_0x1a4916);},'IFfee':function(_0x2a0472,_0x581c9e){return _0x2a0472(_0x581c9e);},'HazjE':_0x45762e(0x17b),'AttHK':function(_0x1e3110,_0x419a32,_0x12f6de){return _0x1e3110(_0x419a32,_0x12f6de);},'jGuGq':_0x45762e(0x15f),'IIHdj':function(_0x20df4f,_0x46b6d,_0x41c89a){return _0x20df4f(_0x46b6d,_0x41c89a);},'mLrIR':_0x45762e(0x151),'GCmQs':function(_0x567d97,_0x64626,_0x567fa2){return _0x567d97(_0x64626,_0x567fa2);},'ffSWK':function(_0x254664,_0x31ee77,_0x56e67e){return _0x254664(_0x31ee77,_0x56e67e);},'jsOCC':_0x45762e(0x17c),'IDRcG':'AZW2\x20should\x20terminate\x20a\x20orphan\x20subscription\x20containing\x20monitored\x20items'},_0x2c2eb4=this;let _0x3da39a,_0x8fe7ad,_0x2915e8,_0x2a69c2;_0x567b1a['iqBKf'](beforeEach,function(_0x3c25b5){const _0xf478a1=_0x45762e;_0x3da39a=new ServerEngine(),_0x3da39a[_0xf478a1(0x186)]({'nodeset_filename':mini_nodeset_filename},function(){const _0x183d1b=_0xf478a1;_0x2915e8=_0x3da39a[_0x183d1b(0x18c)][_0x183d1b(0x142)](_0x183d1b(0x188))['nodeId'],_0x2a69c2=_0x3da39a['addressSpace'][_0x183d1b(0x142)](_0x567b1a[_0x183d1b(0x18b)])[_0x183d1b(0x157)],_0x567b1a[_0x183d1b(0x15c)](_0x3c25b5);});}),_0x567b1a[_0x45762e(0x184)](afterEach,async()=>{const _0x2c573c=_0x45762e;_0x8fe7ad=null,should[_0x2c573c(0x1a1)](_0x3da39a),await _0x3da39a['shutdown'](),_0x3da39a=null;}),_0x567b1a[_0x45762e(0x1a4)](Function,_0x567b1a['HazjE'])(),_0x567b1a['AttHK'](it,_0x45762e(0x19f),async()=>{const _0x21aabf=_0x45762e;_0x8fe7ad=_0x3da39a[_0x21aabf(0x171)]();const _0x322ad6=await _0x8fe7ad[_0x21aabf(0x154)](-0x1a85);_0x322ad6[_0x21aabf(0x189)][_0x21aabf(0x16b)](StatusCodes[_0x21aabf(0x16e)]);}),it(_0x567b1a[_0x45762e(0x187)],async()=>{const _0x4e6d58=_0x45762e;_0x8fe7ad=_0x3da39a['createSession'](),_0x8fe7ad[_0x4e6d58(0x149)]['should'][_0x4e6d58(0x1a9)](0x0),_0x8fe7ad[_0x4e6d58(0x163)][_0x4e6d58(0x189)][_0x4e6d58(0x1a9)](0x0);const _0x4b02c6=_0x8fe7ad[_0x4e6d58(0x161)]({'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe});_0x4b02c6['monitoredItemCount']['should']['eql'](0x0),_0x8fe7ad['currentSubscriptionCount']['should'][_0x4e6d58(0x1a9)](0x1),_0x8fe7ad[_0x4e6d58(0x163)][_0x4e6d58(0x189)][_0x4e6d58(0x1a9)](0x1),_0x8fe7ad[_0x4e6d58(0x168)](_0x4b02c6['id'])[_0x4e6d58(0x189)]['equal'](_0x4b02c6);const _0x1e85ff=await _0x8fe7ad[_0x4e6d58(0x154)](_0x4b02c6['id']);_0x1e85ff[_0x4e6d58(0x189)][_0x4e6d58(0x16b)](StatusCodes[_0x4e6d58(0x14c)]),_0x8fe7ad[_0x4e6d58(0x149)][_0x4e6d58(0x189)][_0x4e6d58(0x1a9)](0x0),_0x8fe7ad['cumulatedSubscriptionCount'][_0x4e6d58(0x189)][_0x4e6d58(0x1a9)](0x1),_0x3da39a[_0x4e6d58(0x149)][_0x4e6d58(0x189)][_0x4e6d58(0x1a9)](0x0),_0x3da39a[_0x4e6d58(0x163)][_0x4e6d58(0x189)][_0x4e6d58(0x1a9)](0x1),_0x4b02c6['terminate'](),_0x4b02c6[_0x4e6d58(0x181)]();}),_0x567b1a[_0x45762e(0x17e)](it,_0x567b1a[_0x45762e(0x19b)],async()=>{const _0x3cbf40=_0x45762e;_0x8fe7ad=_0x3da39a[_0x3cbf40(0x171)](),_0x8fe7ad['currentSubscriptionCount']['should'][_0x3cbf40(0x1a9)](0x0),_0x8fe7ad[_0x3cbf40(0x163)][_0x3cbf40(0x189)][_0x3cbf40(0x1a9)](0x0);const _0x325bc2=sinon[_0x3cbf40(0x160)](),_0x1301d7=sinon['spy']();_0x8fe7ad['on'](_0x567b1a[_0x3cbf40(0x1a0)],_0x325bc2),_0x8fe7ad['on'](_0x567b1a[_0x3cbf40(0x1a5)],_0x1301d7);const _0x3e5ef7=_0x8fe7ad['createSubscription']({'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe});_0x8fe7ad[_0x3cbf40(0x149)][_0x3cbf40(0x189)][_0x3cbf40(0x1a9)](0x1),_0x8fe7ad[_0x3cbf40(0x163)][_0x3cbf40(0x189)][_0x3cbf40(0x1a9)](0x1),_0x325bc2[_0x3cbf40(0x1a6)][_0x3cbf40(0x189)][_0x3cbf40(0x16b)](0x1),_0x1301d7['callCount'][_0x3cbf40(0x189)][_0x3cbf40(0x16b)](0x0);const _0x3c0f8b=await _0x8fe7ad[_0x3cbf40(0x154)](_0x3e5ef7['id']);_0x3c0f8b[_0x3cbf40(0x189)]['be'][_0x3cbf40(0x17d)](StatusCode),_0x325bc2[_0x3cbf40(0x1a6)][_0x3cbf40(0x189)]['eql'](0x1),_0x1301d7[_0x3cbf40(0x1a6)]['should']['eql'](0x1),_0x8fe7ad[_0x3cbf40(0x15e)](_0x3cbf40(0x148),_0x325bc2),_0x8fe7ad[_0x3cbf40(0x15e)](_0x3cbf40(0x153),_0x1301d7),_0x8fe7ad[_0x3cbf40(0x149)][_0x3cbf40(0x189)][_0x3cbf40(0x1a9)](0x0),_0x8fe7ad[_0x3cbf40(0x163)][_0x3cbf40(0x189)]['equal'](0x1);}),it(_0x45762e(0x182),async()=>{const _0x153a7e=_0x45762e;_0x8fe7ad=_0x3da39a[_0x153a7e(0x171)]();const _0x22eada={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe};_0x3da39a[_0x153a7e(0x149)]['should'][_0x153a7e(0x1a9)](0x0),_0x3da39a['cumulatedSubscriptionCount']['should'][_0x153a7e(0x1a9)](0x0),_0x3da39a[_0x153a7e(0x174)][_0x153a7e(0x189)]['equal'](0x1),_0x3da39a[_0x153a7e(0x176)]['should']['equal'](0x1);const _0x3b852f=_0x8fe7ad[_0x153a7e(0x161)](_0x22eada);_0x3da39a['currentSubscriptionCount'][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x1),_0x3da39a['cumulatedSubscriptionCount']['should'][_0x153a7e(0x1a9)](0x1);const _0x5ecdcd=_0x8fe7ad[_0x153a7e(0x161)](_0x22eada);_0x3da39a[_0x153a7e(0x149)]['should'][_0x153a7e(0x1a9)](0x2),_0x3da39a['cumulatedSubscriptionCount']['should'][_0x153a7e(0x1a9)](0x2),await _0x8fe7ad[_0x153a7e(0x154)](_0x5ecdcd['id']),_0x3da39a['currentSubscriptionCount'][_0x153a7e(0x189)]['equal'](0x1),_0x3da39a[_0x153a7e(0x163)][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x2);const _0x4ffacd=_0x3da39a[_0x153a7e(0x171)]();_0x3da39a[_0x153a7e(0x174)]['should']['equal'](0x2),_0x3da39a[_0x153a7e(0x176)][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x2),_0x3da39a[_0x153a7e(0x149)][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x1);const _0xd2ff33=_0x4ffacd['createSubscription'](_0x22eada),_0x2267e7=_0x4ffacd[_0x153a7e(0x161)](_0x22eada),_0x4b220e=_0x4ffacd[_0x153a7e(0x161)](_0x22eada);_0x3da39a['currentSubscriptionCount'][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x4),_0x3da39a[_0x153a7e(0x163)][_0x153a7e(0x189)]['equal'](0x5),await _0x3da39a['closeSession'](_0x4ffacd['authenticationToken'],!![]),_0x3da39a[_0x153a7e(0x174)]['should']['equal'](0x1),_0x3da39a[_0x153a7e(0x176)]['should']['equal'](0x2),_0x3da39a[_0x153a7e(0x149)][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x1),_0x3da39a[_0x153a7e(0x163)][_0x153a7e(0x189)][_0x153a7e(0x1a9)](0x5),await _0x8fe7ad[_0x153a7e(0x154)](_0x3b852f['id']),_0x3da39a['currentSubscriptionCount']['should'][_0x153a7e(0x1a9)](0x0),_0x3da39a[_0x153a7e(0x163)][_0x153a7e(0x189)]['equal'](0x5);}),it(_0x45762e(0x146),async()=>{const _0x250286=_0x45762e;_0x8fe7ad=_0x3da39a[_0x250286(0x171)]();const _0x22b5e1={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0xa,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0xce2c99=_0x8fe7ad['createSubscription'](_0x22b5e1),_0x5bf9d5=sinon['spy'](),_0x20fa92={'requestHeader':{'requestHandle':0x64}};_0x8fe7ad[_0x250286(0x1a7)][_0x250286(0x194)](new PublishRequest(_0x20fa92),_0x5bf9d5);const _0x260a98={'requestHeader':{'requestHandle':0x65}};_0x8fe7ad[_0x250286(0x1a7)][_0x250286(0x194)](new PublishRequest(_0x260a98),_0x5bf9d5),_0x5bf9d5[_0x250286(0x1a6)][_0x250286(0x189)][_0x250286(0x16b)](0x0),await _0x8fe7ad[_0x250286(0x154)](_0xce2c99['id']),_0x5bf9d5['callCount'][_0x250286(0x189)][_0x250286(0x16b)](0x2),_0x5bf9d5[_0x250286(0x19d)](0x0)[_0x250286(0x140)][0x1][_0x250286(0x18a)][_0x250286(0x14d)][_0x250286(0x189)][_0x250286(0x16b)](0x64),_0x5bf9d5[_0x250286(0x19d)](0x1)[_0x250286(0x140)][0x1][_0x250286(0x18a)][_0x250286(0x14d)][_0x250286(0x189)][_0x250286(0x16b)](0x65),_0x5bf9d5[_0x250286(0x19d)](0x0)[_0x250286(0x140)][0x1][_0x250286(0x18a)][_0x250286(0x166)]['should'][_0x250286(0x16b)](StatusCodes[_0x250286(0x14e)]),_0x5bf9d5[_0x250286(0x19d)](0x1)['args'][0x1][_0x250286(0x18a)][_0x250286(0x166)]['should'][_0x250286(0x16b)](StatusCodes[_0x250286(0x14e)]);}),it(_0x45762e(0x159),async()=>{const _0x457f12=_0x45762e,_0x5160c={'UUFso':function(_0x711619,_0x10972d){const _0x392984=_0x4863;return _0x567b1a[_0x392984(0x145)](_0x711619,_0x10972d);}};await with_fake_timer[_0x457f12(0x196)](_0x2c2eb4,async()=>{const _0x4fd95d=_0x457f12;_0x8fe7ad=_0x3da39a[_0x4fd95d(0x171)]({'sessionTimeout':0x5f5e100});const _0x12fdc0={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x23163c=_0x8fe7ad[_0x4fd95d(0x161)](_0x12fdc0);_0x23163c[_0x4fd95d(0x179)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](SubscriptionState[_0x4fd95d(0x15b)]),_0x2c2eb4[_0x4fd95d(0x170)]['tick'](_0x23163c[_0x4fd95d(0x1a2)]),_0x23163c['state'][_0x4fd95d(0x189)]['eql'](SubscriptionState[_0x4fd95d(0x15b)]),_0x23163c[_0x4fd95d(0x16a)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](![]),await _0x8fe7ad[_0x4fd95d(0x154)](_0x23163c['id']),_0x23163c['state']['should']['eql'](SubscriptionState[_0x4fd95d(0x158)]);const _0x40f36a=_0x8fe7ad[_0x4fd95d(0x161)](_0x12fdc0);_0x40f36a[_0x4fd95d(0x179)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](SubscriptionState[_0x4fd95d(0x15b)]),_0x2c2eb4['clock'][_0x4fd95d(0x150)](_0x5160c[_0x4fd95d(0x13f)](_0x40f36a['publishingInterval'],_0x40f36a[_0x4fd95d(0x14a)])),_0x40f36a[_0x4fd95d(0x179)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](SubscriptionState['LATE']);const _0x4efb70=sinon['spy']();_0x8fe7ad[_0x4fd95d(0x1a7)][_0x4fd95d(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x64}}),_0x4efb70),_0x8fe7ad['publishEngine'][_0x4fd95d(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x4efb70),_0x8fe7ad[_0x4fd95d(0x1a7)][_0x4fd95d(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x4efb70),_0x8fe7ad['publishEngine'][_0x4fd95d(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x4efb70),_0x2c2eb4['clock'][_0x4fd95d(0x150)](_0x40f36a[_0x4fd95d(0x1a2)]),_0x40f36a[_0x4fd95d(0x179)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](SubscriptionState[_0x4fd95d(0x1ad)]),await _0x8fe7ad[_0x4fd95d(0x154)](_0x40f36a['id']),_0x40f36a[_0x4fd95d(0x179)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](SubscriptionState[_0x4fd95d(0x158)]),_0x4efb70['callCount'][_0x4fd95d(0x189)]['eql'](0x4),_0x4efb70[_0x4fd95d(0x19d)](0x0)[_0x4fd95d(0x140)][0x1][_0x4fd95d(0x18a)]['serviceResult'][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](StatusCodes[_0x4fd95d(0x14c)]),_0x4efb70[_0x4fd95d(0x19d)](0x0)[_0x4fd95d(0x140)][0x1][_0x4fd95d(0x13e)]['should'][_0x4fd95d(0x16b)](_0x40f36a['id']),_0x4efb70[_0x4fd95d(0x19d)](0x0)[_0x4fd95d(0x140)][0x1][_0x4fd95d(0x199)][_0x4fd95d(0x15d)][_0x4fd95d(0x144)]['should']['eql'](0x0),_0x4efb70[_0x4fd95d(0x19d)](0x1)['args'][0x1][_0x4fd95d(0x18a)][_0x4fd95d(0x166)][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](StatusCodes[_0x4fd95d(0x14e)]),_0x4efb70[_0x4fd95d(0x19d)](0x2)['args'][0x1][_0x4fd95d(0x18a)][_0x4fd95d(0x166)][_0x4fd95d(0x189)]['eql'](StatusCodes[_0x4fd95d(0x14e)]),_0x4efb70[_0x4fd95d(0x19d)](0x3)[_0x4fd95d(0x140)][0x1][_0x4fd95d(0x18a)]['serviceResult'][_0x4fd95d(0x189)][_0x4fd95d(0x16b)](StatusCodes[_0x4fd95d(0x14e)]),await _0x3da39a['closeSession'](_0x8fe7ad[_0x4fd95d(0x18e)],!![],_0x4fd95d(0x1ac));});}),_0x567b1a[_0x45762e(0x1aa)](it,_0x45762e(0x180),async()=>{const _0x4bbbaf=_0x45762e,_0x5ab686={'Xdgmi':function(_0x205032,_0x13ab47){return _0x567b1a['IgdCZ'](_0x205032,_0x13ab47);},'HCIvi':function(_0x5ea127,_0x4442fb){return _0x5ea127*_0x4442fb;},'mnuEk':'CloseSession'};await with_fake_timer[_0x4bbbaf(0x196)](_0x2c2eb4,async()=>{const _0x21c41b=_0x4bbbaf;_0x8fe7ad=_0x3da39a['createSession']({'sessionTimeout':0x5f5e100});const _0x50889d={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x285e83=_0x8fe7ad['createSubscription'](_0x50889d);_0x285e83[_0x21c41b(0x1a2)]['should']['eql'](0x3e8),_0x285e83[_0x21c41b(0x14a)][_0x21c41b(0x189)]['eql'](0xa),_0x285e83['lifeTimeCount'][_0x21c41b(0x189)][_0x21c41b(0x16b)](0x3c),_0x285e83['state'][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x15b)]),_0x2c2eb4[_0x21c41b(0x170)]['tick'](_0x285e83['publishingInterval']),_0x285e83[_0x21c41b(0x179)][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x15b)]),_0x2c2eb4['clock'][_0x21c41b(0x150)](_0x5ab686[_0x21c41b(0x143)](_0x285e83['publishingInterval'],_0x285e83[_0x21c41b(0x14a)])),_0x285e83['state'][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x14f)]),_0x2c2eb4[_0x21c41b(0x170)]['tick'](_0x285e83[_0x21c41b(0x1a2)]*_0x285e83[_0x21c41b(0x14a)]),_0x285e83[_0x21c41b(0x179)][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x14f)]),_0x2c2eb4[_0x21c41b(0x170)][_0x21c41b(0x150)](_0x5ab686[_0x21c41b(0x172)](_0x285e83[_0x21c41b(0x1a2)],_0x285e83[_0x21c41b(0x19e)])),_0x285e83[_0x21c41b(0x179)][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x158)]);const _0x524fe7=_0x8fe7ad['createSubscription'](_0x50889d);_0x524fe7['state'][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x15b)]),_0x2c2eb4[_0x21c41b(0x170)][_0x21c41b(0x150)](_0x5ab686[_0x21c41b(0x172)](_0x524fe7[_0x21c41b(0x1a2)],_0x524fe7['maxKeepAliveCount'])),_0x524fe7[_0x21c41b(0x179)][_0x21c41b(0x189)][_0x21c41b(0x16b)](SubscriptionState[_0x21c41b(0x14f)]);const _0x3b6df5=sinon['spy']();_0x8fe7ad[_0x21c41b(0x1a7)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x3b6df5),_0x8fe7ad[_0x21c41b(0x1a7)][_0x21c41b(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x3b6df5),_0x8fe7ad['publishEngine']['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x3b6df5),_0x8fe7ad[_0x21c41b(0x1a7)][_0x21c41b(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x68}}),_0x3b6df5),_0x2c2eb4[_0x21c41b(0x170)][_0x21c41b(0x150)](_0x524fe7['publishingInterval']),await _0x8fe7ad['deleteSubscription'](_0x524fe7['id']),_0x2c2eb4['clock']['tick'](_0x524fe7['publishingInterval']),_0x3b6df5[_0x21c41b(0x1a6)][_0x21c41b(0x189)]['eql'](0x4),_0x3b6df5[_0x21c41b(0x19d)](0x0)[_0x21c41b(0x140)][0x1][_0x21c41b(0x18a)][_0x21c41b(0x166)][_0x21c41b(0x189)]['eql'](StatusCodes[_0x21c41b(0x14c)]),_0x3b6df5['getCall'](0x0)[_0x21c41b(0x140)][0x1][_0x21c41b(0x13e)][_0x21c41b(0x189)][_0x21c41b(0x16b)](_0x285e83['id']),_0x3b6df5[_0x21c41b(0x19d)](0x0)[_0x21c41b(0x140)][0x1]['notificationMessage'][_0x21c41b(0x15d)][0x0][_0x21c41b(0x15a)][_0x21c41b(0x189)][_0x21c41b(0x16b)](StatusCodes[_0x21c41b(0x1a3)]),_0x3b6df5[_0x21c41b(0x19d)](0x1)[_0x21c41b(0x140)][0x1][_0x21c41b(0x18a)][_0x21c41b(0x166)]['should'][_0x21c41b(0x16b)](StatusCodes['Good']),_0x3b6df5[_0x21c41b(0x19d)](0x1)['args'][0x1][_0x21c41b(0x13e)][_0x21c41b(0x189)]['eql'](_0x524fe7['id']),_0x3b6df5[_0x21c41b(0x19d)](0x1)[_0x21c41b(0x140)][0x1][_0x21c41b(0x199)][_0x21c41b(0x15d)][_0x21c41b(0x144)][_0x21c41b(0x189)][_0x21c41b(0x16b)](0x0),_0x3b6df5[_0x21c41b(0x19d)](0x2)[_0x21c41b(0x140)][0x1][_0x21c41b(0x18a)]['serviceResult']['should']['eql'](StatusCodes[_0x21c41b(0x14e)]),_0x3b6df5[_0x21c41b(0x19d)](0x3)[_0x21c41b(0x140)][0x1]['responseHeader']['serviceResult'][_0x21c41b(0x189)][_0x21c41b(0x16b)](StatusCodes['BadNoSubscription']),await _0x3da39a[_0x21c41b(0x152)](_0x8fe7ad['authenticationToken'],!![],_0x5ab686[_0x21c41b(0x1ab)]);});}),it(_0x45762e(0x191),async()=>{const _0x4e5065=_0x45762e,_0x796cbd={'YHpZV':'StatusChangeNotification'};await with_fake_timer[_0x4e5065(0x196)](_0x2c2eb4,async()=>{const _0x4772cf=_0x4e5065;_0x8fe7ad=_0x3da39a['createSession']({'sessionTimeout':0x5f5e100});const _0x3f4fa9={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x507428=_0x8fe7ad[_0x4772cf(0x161)](_0x3f4fa9);_0x507428['state'][_0x4772cf(0x189)][_0x4772cf(0x16b)](SubscriptionState[_0x4772cf(0x15b)]),_0x2c2eb4[_0x4772cf(0x170)][_0x4772cf(0x150)](_0x507428[_0x4772cf(0x1a2)]*_0x507428[_0x4772cf(0x14a)]),_0x2c2eb4[_0x4772cf(0x170)]['tick'](_0x507428[_0x4772cf(0x1a2)]*_0x507428[_0x4772cf(0x19e)]),_0x507428[_0x4772cf(0x179)][_0x4772cf(0x189)][_0x4772cf(0x16b)](SubscriptionState[_0x4772cf(0x158)]),_0x507428['messageSent']['should']['eql'](![]);const _0x21404a=sinon[_0x4772cf(0x160)]();_0x8fe7ad['publishEngine'][_0x4772cf(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x21404a),_0x8fe7ad[_0x4772cf(0x1a7)][_0x4772cf(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x21404a),_0x8fe7ad[_0x4772cf(0x1a7)][_0x4772cf(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x21404a),_0x8fe7ad['publishEngine'][_0x4772cf(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x68}}),_0x21404a),_0x2c2eb4[_0x4772cf(0x170)][_0x4772cf(0x150)](_0x507428['publishingInterval']*0x2),_0x21404a[_0x4772cf(0x19d)](0x0)[_0x4772cf(0x140)][0x1][_0x4772cf(0x13e)][_0x4772cf(0x189)]['eql'](_0x507428['subscriptionId']),_0x21404a['getCall'](0x0)['args'][0x1][_0x4772cf(0x18a)][_0x4772cf(0x166)][_0x4772cf(0x189)][_0x4772cf(0x16b)](StatusCodes[_0x4772cf(0x14c)]),_0x21404a[_0x4772cf(0x19d)](0x0)[_0x4772cf(0x140)][0x1][_0x4772cf(0x199)][_0x4772cf(0x155)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0x1),_0x21404a[_0x4772cf(0x19d)](0x0)[_0x4772cf(0x140)][0x1][_0x4772cf(0x199)][_0x4772cf(0x15d)][0x0][_0x4772cf(0x198)][_0x4772cf(0x14b)][_0x4772cf(0x189)][_0x4772cf(0x16b)](_0x796cbd['YHpZV']),_0x21404a[_0x4772cf(0x19d)](0x0)[_0x4772cf(0x140)][0x1][_0x4772cf(0x199)][_0x4772cf(0x15d)][0x0][_0x4772cf(0x15a)]['should']['eql'](StatusCodes[_0x4772cf(0x1a3)]),_0x21404a[_0x4772cf(0x1a6)]['should']['eql'](0x4),_0x21404a[_0x4772cf(0x19d)](0x1)[_0x4772cf(0x140)][0x1]['responseHeader'][_0x4772cf(0x166)][_0x4772cf(0x189)][_0x4772cf(0x16b)](StatusCodes[_0x4772cf(0x14e)]),_0x21404a[_0x4772cf(0x19d)](0x1)['args'][0x1][_0x4772cf(0x13e)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0xffffffff),_0x21404a[_0x4772cf(0x19d)](0x1)[_0x4772cf(0x140)][0x1]['notificationMessage'][_0x4772cf(0x155)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0x0),_0x21404a['getCall'](0x1)['args'][0x1][_0x4772cf(0x199)][_0x4772cf(0x15d)][_0x4772cf(0x144)]['should']['eql'](0x0),_0x21404a['getCall'](0x2)['args'][0x1][_0x4772cf(0x18a)][_0x4772cf(0x166)][_0x4772cf(0x189)][_0x4772cf(0x16b)](StatusCodes[_0x4772cf(0x14e)]),_0x21404a['getCall'](0x2)['args'][0x1][_0x4772cf(0x13e)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0xffffffff),_0x21404a[_0x4772cf(0x19d)](0x2)[_0x4772cf(0x140)][0x1]['notificationMessage'][_0x4772cf(0x155)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0x0),_0x21404a[_0x4772cf(0x19d)](0x2)[_0x4772cf(0x140)][0x1]['notificationMessage'][_0x4772cf(0x15d)]['length'][_0x4772cf(0x189)][_0x4772cf(0x16b)](0x0),_0x21404a['getCall'](0x3)[_0x4772cf(0x140)][0x1][_0x4772cf(0x18a)][_0x4772cf(0x166)][_0x4772cf(0x189)][_0x4772cf(0x16b)](StatusCodes['BadNoSubscription']),_0x21404a[_0x4772cf(0x19d)](0x3)[_0x4772cf(0x140)][0x1][_0x4772cf(0x13e)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0xffffffff),_0x21404a[_0x4772cf(0x19d)](0x3)[_0x4772cf(0x140)][0x1]['notificationMessage'][_0x4772cf(0x155)][_0x4772cf(0x189)]['eql'](0x0),_0x21404a['getCall'](0x3)[_0x4772cf(0x140)][0x1][_0x4772cf(0x199)][_0x4772cf(0x15d)][_0x4772cf(0x144)][_0x4772cf(0x189)][_0x4772cf(0x16b)](0x0),await _0x3da39a['closeSession'](_0x8fe7ad[_0x4772cf(0x18e)],!![],_0x4772cf(0x1ac));});}),_0x567b1a[_0x45762e(0x19a)](it,_0x567b1a[_0x45762e(0x18f)],async()=>{const _0x564bb7=_0x45762e,_0x462e7b={'Extdp':function(_0x124074,_0x4e02f7){const _0x443655=_0x4863;return _0x567b1a[_0x443655(0x190)](_0x124074,_0x4e02f7);},'QRkBt':_0x567b1a[_0x564bb7(0x169)]};await with_fake_timer[_0x564bb7(0x196)](_0x2c2eb4,async()=>{const _0x1ae68f=_0x564bb7;_0x8fe7ad=_0x3da39a[_0x1ae68f(0x171)]({'sessionTimeout':0x5f5e100});const _0x3c36da={'requestedPublishingInterval':0x3e8,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0xa,'maxNotificationsPerPublish':0xa,'publishingEnabled':!![],'priority':0xe},_0x478fa4=_0x8fe7ad['createSubscription'](_0x3c36da);_0x478fa4['state'][_0x1ae68f(0x189)][_0x1ae68f(0x16b)](SubscriptionState[_0x1ae68f(0x15b)]),_0x2c2eb4[_0x1ae68f(0x170)][_0x1ae68f(0x150)](_0x462e7b[_0x1ae68f(0x141)](_0x478fa4[_0x1ae68f(0x1a2)],_0x478fa4[_0x1ae68f(0x14a)])),_0x2c2eb4[_0x1ae68f(0x170)][_0x1ae68f(0x150)](_0x478fa4['publishingInterval']*_0x478fa4[_0x1ae68f(0x19e)]);const _0x5daae8=_0x8fe7ad['createSubscription'](_0x3c36da);_0x5daae8[_0x1ae68f(0x179)][_0x1ae68f(0x189)]['eql'](SubscriptionState[_0x1ae68f(0x15b)]);const _0x59deee=sinon[_0x1ae68f(0x160)]();_0x8fe7ad[_0x1ae68f(0x1a7)][_0x1ae68f(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x65}}),_0x59deee),_0x8fe7ad[_0x1ae68f(0x1a7)][_0x1ae68f(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x66}}),_0x59deee),_0x8fe7ad[_0x1ae68f(0x1a7)]['_on_PublishRequest'](new PublishRequest({'requestHeader':{'requestHandle':0x67}}),_0x59deee),_0x8fe7ad[_0x1ae68f(0x1a7)][_0x1ae68f(0x194)](new PublishRequest({'requestHeader':{'requestHandle':0x68}}),_0x59deee),_0x59deee[_0x1ae68f(0x1a6)]['should'][_0x1ae68f(0x16b)](0x1),_0x59deee['getCall'](0x0)['args'][0x1]['responseHeader']['serviceResult'][_0x1ae68f(0x189)][_0x1ae68f(0x16b)](StatusCodes[_0x1ae68f(0x14c)]),_0x59deee[_0x1ae68f(0x19d)](0x0)[_0x1ae68f(0x140)][0x1][_0x1ae68f(0x199)]['sequenceNumber']['should'][_0x1ae68f(0x16b)](0x1),_0x59deee[_0x1ae68f(0x19d)](0x0)['args'][0x1][_0x1ae68f(0x199)][_0x1ae68f(0x15d)][0x0][_0x1ae68f(0x198)][_0x1ae68f(0x14b)]['should'][_0x1ae68f(0x16b)]('StatusChangeNotification'),_0x59deee[_0x1ae68f(0x19d)](0x0)[_0x1ae68f(0x140)][0x1][_0x1ae68f(0x199)][_0x1ae68f(0x15d)][0x0]['status'][_0x1ae68f(0x189)][_0x1ae68f(0x16b)](StatusCodes[_0x1ae68f(0x1a3)]),await _0x3da39a[_0x1ae68f(0x152)](_0x8fe7ad[_0x1ae68f(0x18e)],!![],_0x462e7b[_0x1ae68f(0x178)]);});}),it(_0x567b1a[_0x45762e(0x1ae)],async()=>{const _0x3168fa=_0x45762e,_0x1b776d={'XmWjj':_0x567b1a['OsPxn'],'JrOlL':_0x3168fa(0x1ac),'KPzqv':function(_0xd3aa6e,_0x36e40a){return _0xd3aa6e*_0x36e40a;}};await with_fake_timer[_0x3168fa(0x196)](_0x2c2eb4,async()=>{const _0x2ed117=_0x3168fa;_0x8fe7ad=_0x3da39a[_0x2ed117(0x171)]({'sessionTimeout':0x5f5e100});const _0x599d61={'requestedPublishingInterval':0x64,'requestedLifetimeCount':0x3c,'requestedMaxKeepAliveCount':0x1e,'maxNotificationsPerPublish':0x3e8,'publishingEnabled':!![],'priority':0xe},_0x313e7e=_0x8fe7ad[_0x2ed117(0x161)](_0x599d61);_0x313e7e[_0x2ed117(0x179)][_0x2ed117(0x189)][_0x2ed117(0x16b)](SubscriptionState['CREATING']),_0x313e7e['on'](_0x2ed117(0x173),function(_0x5b8dbe){_0x5b8dbe['samplingFunc']=function(){};});const _0x420f25=new MonitoredItemCreateRequest({'itemToMonitor':{'nodeId':_0x1b776d['XmWjj']},'monitoringMode':MonitoringMode[_0x2ed117(0x185)],'requestedParameters':{'clientHandle':0x7b,'queueSize':0xa,'samplingInterval':0x64}}),_0x1b91c2=_0x313e7e['createMonitoredItem'](_0x3da39a['addressSpace'],TimestampsToReturn[_0x2ed117(0x16d)],_0x420f25);_0x1b91c2[_0x2ed117(0x17f)]['should'][_0x2ed117(0x16b)](StatusCodes['Good']);const _0x560ae8=![];_0x3da39a[_0x2ed117(0x152)](_0x8fe7ad[_0x2ed117(0x18e)],_0x560ae8,_0x1b776d[_0x2ed117(0x164)]),_0x2c2eb4[_0x2ed117(0x170)][_0x2ed117(0x150)](_0x1b776d[_0x2ed117(0x197)](_0x313e7e[_0x2ed117(0x1a2)],_0x313e7e[_0x2ed117(0x14a)])),_0x2c2eb4['clock'][_0x2ed117(0x150)](_0x313e7e[_0x2ed117(0x1a2)]*_0x313e7e[_0x2ed117(0x19e)]);});});});