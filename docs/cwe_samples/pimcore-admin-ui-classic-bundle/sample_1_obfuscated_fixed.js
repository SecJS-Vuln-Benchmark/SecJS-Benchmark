'use strict';const _0xf58c21=_0x268a;function _0x268a(_0xbc0a00,_0x364278){const _0xbc5d4d=_0xbc5d();return _0x268a=function(_0x268a76,_0x531987){_0x268a76=_0x268a76-0xc8;let _0x3b2889=_0xbc5d4d[_0x268a76];return _0x3b2889;},_0x268a(_0xbc0a00,_0x364278);}(function(_0x13177a,_0x5878e8){const _0x25bbd1=_0x268a,_0x348e23=_0x13177a();while(!![]){try{const _0x391fb6=parseInt(_0x25bbd1(0xf7))/0x1+parseInt(_0x25bbd1(0xec))/0x2+parseInt(_0x25bbd1(0x117))/0x3+parseInt(_0x25bbd1(0xee))/0x4+parseInt(_0x25bbd1(0xce))/0x5*(-parseInt(_0x25bbd1(0xe4))/0x6)+parseInt(_0x25bbd1(0xe1))/0x7*(-parseInt(_0x25bbd1(0xcb))/0x8)+parseInt(_0x25bbd1(0xf3))/0x9*(-parseInt(_0x25bbd1(0xf4))/0xa);if(_0x391fb6===_0x5878e8)break;else _0x348e23['push'](_0x348e23['shift']());}catch(_0x1b4f9b){_0x348e23['push'](_0x348e23['shift']());}}}(_0xbc5d,0xd2641));const Config=require(_0xf58c21(0xf1)),Definitions=require('../lib/Options/Definitions'),request=require(_0xf58c21(0xfc)),rest=require('../lib/rest'),auth=require(_0xf58c21(0xd9)),uuid=require(_0xf58c21(0xdf));describe(_0xf58c21(0x11f),()=>{const _0x56a2a1=_0xf58c21,_0x531d77={'qEYLd':function(_0x43c32a,_0x4f0733){return _0x43c32a(_0x4f0733);},'wbnOE':function(_0x24eb45,_0xdbb18d){return _0x24eb45!==_0xdbb18d;},'vNFsa':function(_0x54afa7,_0x4c7e81){return _0x54afa7(_0x4c7e81);},'QdllD':_0x56a2a1(0x10b),'QEeGl':'users','xZpZW':'installations','qAMxR':_0x56a2a1(0xd2),'yzWYZ':_0x56a2a1(0x12a),'NfPDC':_0x56a2a1(0xde),'PfqsH':function(_0x163dbc,_0x5de52e){return _0x163dbc(_0x5de52e);},'AzfQF':function(_0x29b446,_0x2a90bd){return _0x29b446(_0x2a90bd);},'KNtWn':function(_0x582963,_0x5ae3e8){return _0x582963(_0x5ae3e8);},'prbnO':function(_0x4c2947,_0x2f0caa){return _0x4c2947!==_0x2f0caa;},'SSnuS':_0x56a2a1(0xea),'vPLYz':_0x56a2a1(0x119),'Aceys':_0x56a2a1(0x12e),'uGizy':_0x56a2a1(0x137),'wmCZE':_0x56a2a1(0xd6),'HwALn':function(_0x2fffe1,_0x55b4d5){return _0x2fffe1(_0x55b4d5);},'JUcfm':_0x56a2a1(0xe0),'ZXlzg':_0x56a2a1(0xef),'nHflU':function(_0x620a15,_0x3fdbf0){return _0x620a15(_0x3fdbf0);},'FnNEA':function(_0x5a4b4a,_0x2ba88a){return _0x5a4b4a(_0x2ba88a);},'uZLeG':_0x56a2a1(0xe9),'RghnE':_0x56a2a1(0xfd),'ufmZo':function(_0x3ec041,_0x203d2f){return _0x3ec041(_0x203d2f);},'Rhfvh':function(_0x41f84e,_0x530d49){return _0x41f84e(_0x530d49);},'KtfQO':function(_0x45419c,_0x36492a,_0x1e0d9e){return _0x45419c(_0x36492a,_0x1e0d9e);},'hNYOP':_0x56a2a1(0xd3),'qRQNC':'some\x20other\x20error','GhtUQ':function(_0x565d5e,_0x214684){return _0x565d5e(_0x214684);},'LzPfr':function(_0x2d2b51,_0x3db78c){return _0x2d2b51(_0x3db78c);},'FDLry':function(_0x4baca0,_0x1cd0bb){return _0x4baca0(_0x1cd0bb);},'iDYLh':function(_0x1bc34d,_0x3d78a3){return _0x1bc34d(_0x3d78a3);},'FfSMD':function(_0x48eeda,_0x891512){return _0x48eeda(_0x891512);},'YraJY':function(_0x174bda,_0x273b19,_0x3ed9fb){return _0x174bda(_0x273b19,_0x3ed9fb);},'hMrny':'should\x20delete\x20request\x20entry\x20after\x20TTL','YCSSy':_0x56a2a1(0x118),'vpzTl':_0x56a2a1(0x12b)},_0x103aff=!![],_0xbdd445=0x2,_0x2c6ff3=0xfa0;async function _0x3362f6(_0x595f1b){const _0x5f0167=_0x56a2a1,_0x19e683=Config[_0x5f0167(0x11a)](Parse[_0x5f0167(0x10e)]),_0x48f1e0=await rest[_0x5f0167(0xdc)](_0x19e683,auth[_0x5f0167(0xe5)](_0x19e683),_0x5f0167(0x129),{'reqId':_0x595f1b},{'limit':0x1});await rest[_0x5f0167(0xe6)](_0x19e683,auth[_0x5f0167(0xe5)](_0x19e683),_0x5f0167(0x129),_0x48f1e0[_0x5f0167(0x122)][0x0][_0x5f0167(0x139)]);}async function _0x36d0bd(_0x54dda4){const _0x198716=_0x56a2a1;'oGqWQ'!==_0x198716(0x10f)?await _0x531d77[_0x198716(0x12f)](reconfigureServer,{'appId':Parse[_0x198716(0x10e)],'masterKey':Parse['masterKey'],'serverURL':Parse[_0x198716(0x10d)],'idempotencyOptions':_0x54dda4}):_0x554236['DEFAULT_TIMEOUT_INTERVAL']=_0xd8c239[_0x198716(0x100)][_0x198716(0x13f)]||0x2710;}_0x531d77[_0x56a2a1(0x107)](beforeEach,async()=>{const _0x2d384a=_0x56a2a1,_0x91c4cd={'EEKiF':function(_0x31202f,_0x217ffc){return _0x531d77['qEYLd'](_0x31202f,_0x217ffc);},'NMoBo':_0x2d384a(0x137)};_0x103aff&&(_0x531d77['wbnOE']('jGLHc',_0x2d384a(0x126))?jasmine[_0x2d384a(0xe3)]=0x30d40:(_0x32ff99(_0x8210bd[_0x2d384a(0x123)])[_0x2d384a(0xfa)](0x190),_0x91c4cd[_0x2d384a(0x132)](_0x7aa4b5,_0x3e04d6[_0x2d384a(0x108)]['error'])[_0x2d384a(0xfa)](_0x91c4cd[_0x2d384a(0x12c)]))),await _0x531d77[_0x2d384a(0x140)](_0x36d0bd,{'paths':[_0x2d384a(0x106),'jobs/.*',_0x531d77['QdllD'],_0x531d77['QEeGl'],_0x531d77[_0x2d384a(0x11b)]],'ttl':_0xbdd445});}),_0x531d77['FfSMD'](afterAll,()=>{const _0x3773b=_0x56a2a1;jasmine[_0x3773b(0xe3)]=process['env']['PARSE_SERVER_TEST_TIMEOUT']||0x2710;}),_0x531d77[_0x56a2a1(0x125)](it,_0x56a2a1(0xcc),async()=>{const _0x309705=_0x56a2a1,_0x42c371={'GaiiJ':function(_0x38c158,_0x2a8563){return _0x38c158(_0x2a8563);}};let _0x2000de=0x0;Parse['Cloud']['define'](_0x531d77[_0x309705(0x133)],()=>{_0x2000de++;});const _0x14c689={'method':'POST','url':_0x531d77[_0x309705(0x109)],'headers':{'X-Parse-Application-Id':Parse[_0x309705(0x10e)],'X-Parse-Master-Key':Parse['masterKey'],'X-Parse-Request-Id':_0x531d77[_0x309705(0xf0)]}};expect(Config[_0x309705(0x11a)](Parse[_0x309705(0x10e)])[_0x309705(0x113)]['ttl'])[_0x309705(0xeb)](_0xbdd445),await _0x531d77[_0x309705(0x140)](request,_0x14c689),await request(_0x14c689)[_0x309705(0x102)](fail,_0x139ba0=>{const _0x288159=_0x309705;_0x42c371[_0x288159(0x101)](expect,_0x139ba0[_0x288159(0x123)])[_0x288159(0xfa)](0x190),expect(_0x139ba0[_0x288159(0x108)][_0x288159(0x124)])['toEqual'](_0x288159(0x137));}),_0x531d77[_0x309705(0x140)](expect,_0x2000de)[_0x309705(0xeb)](0x1);}),_0x531d77['YraJY'](it,_0x531d77[_0x56a2a1(0x110)],async()=>{const _0x31a452=_0x56a2a1;let _0x1aa04c=0x0;Parse[_0x31a452(0x111)][_0x31a452(0xd8)](_0x531d77[_0x31a452(0x133)],()=>{const _0x45a141=_0x31a452;'akyth'!==_0x45a141(0x136)?_0x1aa04c++:_0x52831d[_0x45a141(0xe3)]=0x30d40;});const _0x5c7d87={'method':'POST','url':_0x531d77[_0x31a452(0x109)],'headers':{'X-Parse-Application-Id':Parse[_0x31a452(0x10e)],'X-Parse-Master-Key':Parse[_0x31a452(0x131)],'X-Parse-Request-Id':_0x31a452(0xde)}};await expectAsync(_0x531d77[_0x31a452(0xda)](request,_0x5c7d87))[_0x31a452(0x104)](),_0x103aff?await _0x3362f6(_0x31a452(0xde)):await new Promise(_0x1c7de1=>setTimeout(_0x1c7de1,_0x2c6ff3)),await _0x531d77[_0x31a452(0x140)](expectAsync,request(_0x5c7d87))[_0x31a452(0x104)](),expect(_0x1aa04c)[_0x31a452(0xeb)](0x2);}),it_only_db(_0x56a2a1(0x134))(_0x56a2a1(0x112),async()=>{const _0x51ba6c=_0x56a2a1,_0x2e3817=Config['get'](Parse[_0x51ba6c(0x10e)])[_0x51ba6c(0x10a)][_0x51ba6c(0x13b)][_0x51ba6c(0x115)];let _0x1f67c5=0x0;Parse[_0x51ba6c(0x111)][_0x51ba6c(0xd8)](_0x51ba6c(0xd2),()=>{_0x1f67c5++;});const _0x11bba8={'method':_0x51ba6c(0xd6),'url':_0x531d77[_0x51ba6c(0x109)],'headers':{'X-Parse-Application-Id':Parse[_0x51ba6c(0x10e)],'X-Parse-Master-Key':Parse[_0x51ba6c(0x131)],'X-Parse-Request-Id':_0x531d77['NfPDC']}};await _0x531d77[_0x51ba6c(0xc9)](expectAsync,_0x531d77[_0x51ba6c(0x140)](request,_0x11bba8))[_0x51ba6c(0x104)](),await _0x531d77['PfqsH'](expectAsync,request(_0x11bba8))[_0x51ba6c(0x120)](),await new Promise(_0x5f54ae=>setTimeout(_0x5f54ae,_0x2c6ff3)),await _0x2e3817['one']('SELECT\x20idempotency_delete_expired_records()'),await expectAsync(request(_0x11bba8))['toBeResolved'](),_0x531d77[_0x51ba6c(0x140)](expect,_0x1f67c5)[_0x51ba6c(0xeb)](0x2);}),it(_0x56a2a1(0xe8),async()=>{const _0x59196a=_0x56a2a1;if(_0x531d77[_0x59196a(0xf9)](_0x531d77[_0x59196a(0x13e)],_0x531d77[_0x59196a(0x13e)]))_0x3edbfd(_0x137444['status'])[_0x59196a(0xfa)](0x190),_0x531d77[_0x59196a(0xda)](_0x399f67,_0x5786c7[_0x59196a(0x108)][_0x59196a(0x124)])['toEqual'](_0x59196a(0x137));else{let _0x48a519=0x0;Parse['Cloud'][_0x59196a(0x135)](_0x531d77[_0x59196a(0x13d)],()=>{_0x48a519++;});const _0x1b6e34={'method':_0x59196a(0xd6),'url':_0x531d77[_0x59196a(0xfb)],'headers':{'X-Parse-Application-Id':Parse[_0x59196a(0x10e)],'X-Parse-Master-Key':Parse['masterKey'],'X-Parse-Request-Id':_0x59196a(0xde)}};await expectAsync(_0x531d77[_0x59196a(0x12f)](request,_0x1b6e34))[_0x59196a(0x104)](),await _0x531d77[_0x59196a(0xc8)](request,_0x1b6e34)[_0x59196a(0x102)](fail,_0x2e35f9=>{const _0x5823c0=_0x59196a;_0x531d77[_0x5823c0(0xc8)](expect,_0x2e35f9[_0x5823c0(0x123)])[_0x5823c0(0xfa)](0x190),_0x531d77[_0x5823c0(0xc9)](expect,_0x2e35f9['data'][_0x5823c0(0x124)])[_0x5823c0(0xfa)]('Duplicate\x20request');}),expect(_0x48a519)[_0x59196a(0xeb)](0x1);}}),_0x531d77[_0x56a2a1(0x10c)](it,'should\x20enforce\x20idempotency\x20for\x20class\x20object\x20creation',async()=>{const _0x4c4be9=_0x56a2a1,_0x3d0c28={'nepzo':_0x531d77[_0x4c4be9(0xcf)]};let _0x218bdb=0x0;Parse[_0x4c4be9(0x111)][_0x4c4be9(0x103)](_0x4c4be9(0xd5),()=>{_0x218bdb++;});const _0x3a46f6={'method':_0x531d77['wmCZE'],'url':_0x4c4be9(0xf6),'headers':{'X-Parse-Application-Id':Parse[_0x4c4be9(0x10e)],'X-Parse-Master-Key':Parse[_0x4c4be9(0x131)],'X-Parse-Request-Id':_0x531d77[_0x4c4be9(0xf0)]}};await expectAsync(_0x531d77[_0x4c4be9(0xda)](request,_0x3a46f6))[_0x4c4be9(0x104)](),await _0x531d77[_0x4c4be9(0xc8)](request,_0x3a46f6)[_0x4c4be9(0x102)](fail,_0x164f44=>{const _0x5d3dd3=_0x4c4be9;expect(_0x164f44[_0x5d3dd3(0x123)])[_0x5d3dd3(0xfa)](0x190),expect(_0x164f44[_0x5d3dd3(0x108)][_0x5d3dd3(0x124)])[_0x5d3dd3(0xfa)](_0x3d0c28['nepzo']);}),_0x531d77[_0x4c4be9(0x11d)](expect,_0x218bdb)[_0x4c4be9(0xeb)](0x1);}),it('should\x20enforce\x20idempotency\x20for\x20user\x20object\x20creation',async()=>{const _0x4f78bc=_0x56a2a1;let _0x160644=0x0;Parse[_0x4f78bc(0x111)][_0x4f78bc(0x103)]('_User',()=>{_0x160644++;});const _0x3629b2={'method':_0x531d77[_0x4f78bc(0xed)],'url':_0x531d77[_0x4f78bc(0x13a)],'body':{'username':_0x531d77[_0x4f78bc(0xca)],'password':_0x4f78bc(0x116)},'headers':{'X-Parse-Application-Id':Parse[_0x4f78bc(0x10e)],'X-Parse-Master-Key':Parse[_0x4f78bc(0x131)],'X-Parse-Request-Id':_0x4f78bc(0xde)}};await expectAsync(_0x531d77['nHflU'](request,_0x3629b2))['toBeResolved'](),await request(_0x3629b2)[_0x4f78bc(0x102)](fail,_0x4fa2fd=>{const _0x2f89a1=_0x4f78bc;expect(_0x4fa2fd[_0x2f89a1(0x123)])[_0x2f89a1(0xfa)](0x190),_0x531d77['KNtWn'](expect,_0x4fa2fd[_0x2f89a1(0x108)][_0x2f89a1(0x124)])[_0x2f89a1(0xfa)](_0x531d77[_0x2f89a1(0xcf)]);}),_0x531d77[_0x4f78bc(0xfe)](expect,_0x160644)[_0x4f78bc(0xeb)](0x1);}),it(_0x531d77[_0x56a2a1(0xdb)],async()=>{const _0x30c32a=_0x56a2a1;let _0x1b3806=0x0;Parse['Cloud']['afterSave'](_0x30c32a(0xf5),()=>{_0x1b3806++;});const _0x471cea={'method':'POST','url':_0x531d77[_0x30c32a(0xdd)],'body':{'installationId':'1','deviceType':_0x531d77[_0x30c32a(0x130)]},'headers':{'X-Parse-Application-Id':Parse[_0x30c32a(0x10e)],'X-Parse-Master-Key':Parse[_0x30c32a(0x131)],'X-Parse-Request-Id':_0x531d77[_0x30c32a(0xf0)]}};await _0x531d77[_0x30c32a(0x11c)](expectAsync,request(_0x471cea))[_0x30c32a(0x104)](),await request(_0x471cea)[_0x30c32a(0x102)](fail,_0x285f52=>{const _0x194e6a=_0x30c32a;expect(_0x285f52[_0x194e6a(0x123)])[_0x194e6a(0xfa)](0x190),_0x531d77[_0x194e6a(0x11d)](expect,_0x285f52[_0x194e6a(0x108)][_0x194e6a(0x124)])['toEqual']('Duplicate\x20request');}),expect(_0x1b3806)[_0x30c32a(0xeb)](0x1);}),it(_0x531d77[_0x56a2a1(0x121)],async()=>{const _0x428358=_0x56a2a1,_0x37e467={'wXtfT':'http://localhost:8378/1/classes/MyClass'};let _0xe54cbb=0x0;Parse['Cloud']['afterSave'](_0x428358(0xd5),()=>{_0xe54cbb++;});const _0x41aed3=[..._0x531d77[_0x428358(0x140)](Array,0x64)[_0x428358(0x12d)]()][_0x428358(0xf8)](()=>{const _0xcc925b=_0x428358,_0x3151b6={'method':_0xcc925b(0xd6),'url':_0x37e467[_0xcc925b(0xff)],'headers':{'X-Parse-Application-Id':Parse['applicationId'],'X-Parse-Master-Key':Parse['masterKey'],'X-Parse-Request-Id':uuid['v4']()}};return request(_0x3151b6);});await expectAsync(Promise[_0x428358(0x13c)](_0x41aed3))[_0x428358(0x104)](),_0x531d77['Rhfvh'](expect,_0xe54cbb)[_0x428358(0xeb)](0x64);}),_0x531d77[_0x56a2a1(0x125)](it,'should\x20re-throw\x20any\x20other\x20error\x20unchanged\x20when\x20writing\x20request\x20entry\x20fails\x20for\x20any\x20other\x20reason',async()=>{const _0x3c6c93=_0x56a2a1;_0x531d77[_0x3c6c93(0x125)](spyOn,rest,_0x531d77[_0x3c6c93(0xf2)])['and'][_0x3c6c93(0xd7)](new Parse['Error'](0x0,_0x531d77['qRQNC'])),Parse[_0x3c6c93(0x111)][_0x3c6c93(0xd8)](_0x3c6c93(0xd2),()=>{});const _0x39d05f={'method':_0x531d77['wmCZE'],'url':_0x3c6c93(0x12a),'headers':{'X-Parse-Application-Id':Parse[_0x3c6c93(0x10e)],'X-Parse-Master-Key':Parse[_0x3c6c93(0x131)],'X-Parse-Request-Id':_0x531d77[_0x3c6c93(0xf0)]}};await _0x531d77[_0x3c6c93(0x11d)](request,_0x39d05f)[_0x3c6c93(0x102)](fail,_0x1bc33f=>{const _0x2abd8e=_0x3c6c93;expect(_0x1bc33f[_0x2abd8e(0x123)])[_0x2abd8e(0xfa)](0x190),expect(_0x1bc33f[_0x2abd8e(0x108)][_0x2abd8e(0x124)])[_0x2abd8e(0xfa)](_0x2abd8e(0x11e));});}),it(_0x56a2a1(0x128),async()=>{const _0x5b689a=_0x56a2a1;await _0x531d77['FnNEA'](_0x36d0bd,{}),_0x531d77[_0x5b689a(0xd4)](expect,Config[_0x5b689a(0x11a)](Parse['applicationId'])[_0x5b689a(0x113)][_0x5b689a(0xe2)])[_0x5b689a(0xeb)](Definitions[_0x5b689a(0x114)][_0x5b689a(0xe2)][_0x5b689a(0x105)]),_0x531d77['FnNEA'](expect,Config['get'](Parse[_0x5b689a(0x10e)])[_0x5b689a(0x113)][_0x5b689a(0xd0)])[_0x5b689a(0xeb)](Definitions['IdempotencyOptions']['paths'][_0x5b689a(0x105)]);}),it(_0x56a2a1(0xcd),async()=>{const _0x5eabc5=_0x56a2a1,_0x43b474={'LpZOL':function(_0x48fed4,_0xc7a65d){return _0x48fed4(_0xc7a65d);},'SNKCI':_0x531d77['qRQNC']};'QBwVZ'===_0x5eabc5(0xe7)?(_0x2b60a3(_0x4f758f[_0x5eabc5(0x123)])['toEqual'](0x190),_0x43b474[_0x5eabc5(0x127)](_0x188561,_0x1ecfc5[_0x5eabc5(0x108)][_0x5eabc5(0x124)])[_0x5eabc5(0xfa)](_0x43b474[_0x5eabc5(0x138)])):(await expectAsync(_0x36d0bd({'paths':0x1}))[_0x5eabc5(0x120)](),await expectAsync(_0x531d77['qEYLd'](_0x36d0bd,{'ttl':'a'}))['toBeRejected'](),await expectAsync(_0x36d0bd({'ttl':0x0}))[_0x5eabc5(0x120)](),await _0x531d77['LzPfr'](expectAsync,_0x531d77[_0x5eabc5(0xd1)](_0x36d0bd,{'ttl':-0x1}))[_0x5eabc5(0x120)]());});});function _0xbc5d(){const _0x308bea=['DEFAULT_TIMEOUT_INTERVAL','2209122awrsER','master','del','bLGph','should\x20enforce\x20idempotency\x20for\x20cloud\x20code\x20jobs','http://localhost:8378/1/installations','PaAAf','toBe','3266666cTbqtK','wmCZE','6263160gGWWcf','user','NfPDC','../lib/Config','hNYOP','9137277MMHOnK','20GONOYe','_Installation','http://localhost:8378/1/classes/MyClass','412897GiqLuY','map','prbnO','toEqual','Aceys','../lib/request','ios','FnNEA','wXtfT','env','GaiiJ','then','afterSave','toBeResolved','default','functions/.*','iDYLh','data','yzWYZ','database','classes/.*','YraJY','serverURL','applicationId','zJQWf','hMrny','Cloud','should\x20delete\x20request\x20entry\x20when\x20postgress\x20ttl\x20function\x20is\x20called','idempotencyOptions','IdempotencyOptions','_client','pass','2771781hXCJBz','should\x20enforce\x20idempotency\x20for\x20installation\x20object\x20creation','myJob','get','xZpZW','ufmZo','HwALn','some\x20other\x20error','Idempotency','toBeRejected','vpzTl','results','status','error','KtfQO','eLNuT','LpZOL','should\x20use\x20default\x20configuration\x20when\x20none\x20is\x20set','_Idempotency','http://localhost:8378/1/functions/myFunction','should\x20not\x20interfere\x20with\x20calls\x20of\x20different\x20request\x20ID','NMoBo','keys','http://localhost:8378/1/jobs/myJob','qEYLd','RghnE','masterKey','EEKiF','qAMxR','postgres','job','urwSI','Duplicate\x20request','SNKCI','objectId','JUcfm','adapter','all','vPLYz','SSnuS','PARSE_SERVER_TEST_TIMEOUT','vNFsa','KNtWn','AzfQF','ZXlzg','16GwmKBp','should\x20enforce\x20idempotency\x20for\x20cloud\x20code\x20function','should\x20throw\x20on\x20invalid\x20configuration','10dPSgUo','uGizy','paths','FDLry','myFunction','create','GhtUQ','MyClass','POST','rejectWith','define','../lib/Auth','PfqsH','YCSSy','find','uZLeG','abc-123','uuid','http://localhost:8378/1/users','3175571LqbgSC','ttl'];_0xbc5d=function(){return _0x308bea;};return _0xbc5d();}