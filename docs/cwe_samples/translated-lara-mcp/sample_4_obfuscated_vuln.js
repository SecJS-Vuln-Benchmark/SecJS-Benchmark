'use strict';function _0x1839(_0x2e4ba3,_0x1a26d5){const _0x207483=_0x2074();return _0x1839=function(_0x1839df,_0x2f10cd){_0x1839df=_0x1839df-0x115;let _0x4cb1bf=_0x207483[_0x1839df];return _0x4cb1bf;},_0x1839(_0x2e4ba3,_0x1a26d5);}const _0x16c8fb=_0x1839;function _0x2074(){const _0x33f1d8=['nullable','Time\x20validator','../validators','hkcYe','unique','1638140400','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','wRxpS','36ZOborc','attrTimestampUnique','assertions','35565SEhXgC','validateYupSchema','clearAllMocks','688UMNnrf','36305064dpdDKU','timestamp','GkOYa','pAISL','mockReset','toBeInstanceOf','mockResolvedValueOnce','@strapi/utils','14rHCgAZ','IGlEr','toHaveBeenCalled','strapi','test-model','11337JvAeAq','wpltd','88400abrdWQ','211448INKkiv','fRcrh','zqARx','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique','BGMBo','1249687HlockG','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','jaAtm','VWYxP','QvKrK','toHaveBeenCalledWith','207sQoBOb','test-uid','not','xwJVy','319QRuiZu','2447976DUGBDV','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database'];_0x2074=function(){return _0x33f1d8;};return _0x2074();}(function(_0x2d2351,_0x5ecc6a){const _0x39e3cc=_0x1839,_0x34627d=_0x2d2351();while(!![]){try{const _0x3545ae=parseInt(_0x39e3cc(0x12b))/0x1+parseInt(_0x39e3cc(0x115))/0x2*(parseInt(_0x39e3cc(0x123))/0x3)+parseInt(_0x39e3cc(0x140))/0x4*(parseInt(_0x39e3cc(0x143))/0x5)+-parseInt(_0x39e3cc(0x136))/0x6*(-parseInt(_0x39e3cc(0x11e))/0x7)+parseInt(_0x39e3cc(0x126))/0x8*(parseInt(_0x39e3cc(0x131))/0x9)+parseInt(_0x39e3cc(0x125))/0xa*(-parseInt(_0x39e3cc(0x135))/0xb)+-parseInt(_0x39e3cc(0x116))/0xc;if(_0x3545ae===_0x5ecc6a)break;else _0x34627d['push'](_0x34627d['shift']());}catch(_0x533a2a){_0x34627d['push'](_0x34627d['shift']());}}}(_0x2074,0xb885b));const strapiUtils=require(_0x16c8fb(0x11d)),{errors:{YupValidationError}}=require(_0x16c8fb(0x11d)),validators=require(_0x16c8fb(0x13a));describe(_0x16c8fb(0x139),()=>{const _0x43897a=_0x16c8fb,_0x1550d3={'wRxpS':function(_0x534c06,_0x475065){return _0x534c06(_0x475065);},'hkcYe':'timestamp','GkOYa':'1638140400','xwJVy':function(_0xc64ad2,_0x35bca6){return _0xc64ad2(_0x35bca6);},'fRcrh':function(_0x5311b5,_0x3348cc){return _0x5311b5(_0x3348cc);},'BGMBo':'1000000000','wpltd':function(_0x2e375b,_0x971b27){return _0x2e375b(_0x971b27);},'jaAtm':_0x43897a(0x122),'lSzUo':function(_0x54b468,_0x15c53c,_0x4dff1d){return _0x54b468(_0x15c53c,_0x4dff1d);},'zqARx':function(_0x5abe70,_0x20b1b6,_0x54cd03){return _0x5abe70(_0x20b1b6,_0x54cd03);},'qBCIZ':'it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value','SYZPy':function(_0x637388,_0x55cadc,_0x180faf){return _0x637388(_0x55cadc,_0x180faf);},'hfWIl':_0x43897a(0x12c),'pAISL':_0x43897a(0x13e),'VWYxP':function(_0x55767b,_0x12a53e,_0x11089c){return _0x55767b(_0x12a53e,_0x11089c);},'ikhVu':_0x43897a(0x13c)};_0x1550d3[_0x43897a(0x12e)](describe,_0x1550d3['ikhVu'],()=>{const _0xc22e0d=_0x43897a,_0x18c88d={'nPvhE':function(_0x19c34c,_0x5528ad){return _0x19c34c(_0x5528ad);},'IGlEr':_0x1550d3[_0xc22e0d(0x118)],'QvKrK':function(_0x3d295f,_0x4c9cdc){return _0x3d295f(_0x4c9cdc);}},_0x22bde4=jest['fn']();global[_0xc22e0d(0x121)]={'db':{'query':jest['fn'](()=>({'findOne':_0x22bde4}))}},_0x1550d3[_0xc22e0d(0x124)](afterEach,()=>{const _0x30370d=_0xc22e0d;jest[_0x30370d(0x145)](),_0x22bde4[_0x30370d(0x11a)]();});const _0x1d7054={'kind':'contentType','modelName':_0x1550d3[_0xc22e0d(0x12d)],'uid':_0xc22e0d(0x132),'privateAttributes':[],'options':{},'attributes':{'attrTimestampUnique':{'type':'timestamp','unique':!![]}}};test(_0xc22e0d(0x129),async()=>{const _0x1561d9=_0xc22e0d;_0x22bde4[_0x1561d9(0x11c)](null);const _0x470d32=strapiUtils['validateYupSchema'](validators[_0x1561d9(0x117)]({'attr':{'type':_0x1561d9(0x117)},'model':_0x1d7054,'updatedAttribute':{'name':'attrTimestampUnique','value':_0x1561d9(0x13d)},'entity':null},{'isDraft':![]}));await _0x18c88d['nPvhE'](_0x470d32,_0x18c88d[_0x1561d9(0x11f)]),_0x18c88d['QvKrK'](expect,_0x22bde4)[_0x1561d9(0x133)][_0x1561d9(0x120)]();}),test('it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`',async()=>{const _0xe1c973=_0xc22e0d;_0x22bde4[_0xe1c973(0x11c)](null);const _0x42e77c=strapiUtils['validateYupSchema'](validators[_0xe1c973(0x117)]({'attr':{'type':_0xe1c973(0x117),'unique':!![]},'model':_0x1d7054,'updatedAttribute':{'name':_0xe1c973(0x141),'value':null},'entity':null},{'isDraft':![]})[_0xe1c973(0x138)]());await _0x42e77c(null),_0x1550d3[_0xe1c973(0x13f)](expect,_0x22bde4)['not'][_0xe1c973(0x120)]();}),_0x1550d3['lSzUo'](test,_0xc22e0d(0x137),async()=>{const _0x3b8c64=_0xc22e0d;_0x22bde4[_0x3b8c64(0x11c)](null);const _0x4f98ea=strapiUtils['validateYupSchema'](validators[_0x3b8c64(0x117)]({'attr':{'type':_0x1550d3[_0x3b8c64(0x13b)],'unique':!![]},'model':_0x1d7054,'updatedAttribute':{'name':_0x3b8c64(0x141),'value':_0x1550d3['GkOYa']},'entity':null},{'isDraft':![]}));_0x1550d3['wRxpS'](expect,await _0x1550d3[_0x3b8c64(0x134)](_0x4f98ea,_0x1550d3[_0x3b8c64(0x118)]))['toBe'](_0x3b8c64(0x13d));}),_0x1550d3[_0xc22e0d(0x128)](test,_0x1550d3['qBCIZ'],async()=>{const _0x3392ff=_0xc22e0d;expect[_0x3392ff(0x142)](0x1),_0x22bde4['mockResolvedValueOnce']({'attrTimestampUnique':_0x3392ff(0x13d)});const _0x46abb1=strapiUtils['validateYupSchema'](validators[_0x3392ff(0x117)]({'attr':{'type':_0x3392ff(0x117),'unique':!![]},'model':_0x1d7054,'updatedAttribute':{'name':_0x3392ff(0x141),'value':_0x3392ff(0x13d)},'entity':null},{'isDraft':![]}));try{await _0x18c88d[_0x3392ff(0x12f)](_0x46abb1,'1638140400');}catch(_0x581f5d){expect(_0x581f5d)[_0x3392ff(0x11b)](YupValidationError);}}),test('it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x458ca4=_0xc22e0d;_0x22bde4[_0x458ca4(0x11c)]({'attrTimestampUnique':_0x458ca4(0x13d)});const _0x25f714=strapiUtils[_0x458ca4(0x144)](validators[_0x458ca4(0x117)]({'attr':{'type':_0x1550d3[_0x458ca4(0x13b)],'unique':!![]},'model':_0x1d7054,'updatedAttribute':{'name':'attrTimestampUnique','value':_0x1550d3[_0x458ca4(0x118)]},'entity':{'id':0x1,'attrTimestampUnique':_0x1550d3[_0x458ca4(0x118)]}},{'isDraft':![]}));expect(await _0x1550d3[_0x458ca4(0x134)](_0x25f714,_0x1550d3[_0x458ca4(0x118)]))['toBe'](_0x458ca4(0x13d));}),_0x1550d3['SYZPy'](test,_0x1550d3['hfWIl'],async()=>{const _0x22e4df=_0xc22e0d;_0x22bde4['mockResolvedValueOnce'](null);const _0x16ad0c=strapiUtils[_0x22e4df(0x144)](validators[_0x22e4df(0x117)]({'attr':{'type':_0x22e4df(0x117),'unique':!![]},'model':_0x1d7054,'updatedAttribute':{'name':_0x22e4df(0x141),'value':_0x22e4df(0x13d)},'entity':null},{'isDraft':![]}));await _0x1550d3[_0x22e4df(0x134)](_0x16ad0c,_0x1550d3[_0x22e4df(0x118)]),_0x1550d3[_0x22e4df(0x127)](expect,_0x22bde4)[_0x22e4df(0x130)]({'select':['id'],'where':{'attrTimestampUnique':'1638140400'}});}),test(_0x1550d3[_0xc22e0d(0x119)],async()=>{const _0x46c302=_0xc22e0d;_0x22bde4['mockResolvedValueOnce'](null);const _0xba41c9=strapiUtils[_0x46c302(0x144)](validators[_0x46c302(0x117)]({'attr':{'type':_0x46c302(0x117),'unique':!![]},'model':_0x1d7054,'updatedAttribute':{'name':_0x46c302(0x141),'value':_0x1550d3[_0x46c302(0x118)]},'entity':{'id':0x1,'attrTimestampUnique':_0x1550d3[_0x46c302(0x12a)]}},{'isDraft':![]}));await _0xba41c9(_0x46c302(0x13d)),expect(_0x22bde4)[_0x46c302(0x130)]({'select':['id'],'where':{'$and':[{'attrTimestampUnique':_0x1550d3['GkOYa']},{'$not':{'id':0x1}}]}});});});});