'use strict';function _0x4c97(_0x4ef890,_0x2e03a0){const _0x150f10=_0x150f();return _0x4c97=function(_0x4c9750,_0x1057bb){_0x4c9750=_0x4c9750-0xe0;let _0x2eb817=_0x150f10[_0x4c9750];return _0x2eb817;},_0x4c97(_0x4ef890,_0x2e03a0);}const _0x540e0e=_0x4c97;(function(_0x2562e3,_0x13b66d){const _0x316200=_0x4c97,_0x3c1baf=_0x2562e3();while(!![]){try{const _0x37938d=parseInt(_0x316200(0x102))/0x1*(parseInt(_0x316200(0xfe))/0x2)+parseInt(_0x316200(0x106))/0x3*(parseInt(_0x316200(0xe0))/0x4)+parseInt(_0x316200(0x107))/0x5*(-parseInt(_0x316200(0xfd))/0x6)+parseInt(_0x316200(0x10c))/0x7*(-parseInt(_0x316200(0x108))/0x8)+-parseInt(_0x316200(0xf5))/0x9*(-parseInt(_0x316200(0x10d))/0xa)+-parseInt(_0x316200(0xf9))/0xb*(-parseInt(_0x316200(0xe7))/0xc)+parseInt(_0x316200(0xeb))/0xd*(-parseInt(_0x316200(0xff))/0xe);if(_0x37938d===_0x13b66d)break;else _0x3c1baf['push'](_0x3c1baf['shift']());}catch(_0x361635){_0x3c1baf['push'](_0x3c1baf['shift']());}}}(_0x150f,0xc4de5));const strapiUtils=require(_0x540e0e(0x105)),{errors:{YupValidationError}}=require(_0x540e0e(0x105)),validators=require(_0x540e0e(0xfa));describe(_0x540e0e(0x10e),()=>{const _0xaf4c08=_0x540e0e,_0x2e612c={'VmTZs':'attrDateUnique','XorKC':_0xaf4c08(0xe8),'iSRRW':function(_0x427d25,_0x5c3cbd){return _0x427d25(_0x5c3cbd);},'KsYLi':_0xaf4c08(0xe5),'dRmfV':_0xaf4c08(0xf0),'fweNs':_0xaf4c08(0x101),'jKNZH':function(_0x4ff20c,_0x17b362,_0x1ef8a9){return _0x4ff20c(_0x17b362,_0x1ef8a9);},'rfJKH':'it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','ywUot':function(_0x26f107,_0x42281a,_0x23ec1b){return _0x26f107(_0x42281a,_0x23ec1b);},'pAIBk':function(_0x5e9f9f,_0x448e1a,_0x1ddfac){return _0x5e9f9f(_0x448e1a,_0x1ddfac);},'SwYPu':_0xaf4c08(0x104),'CKVcz':_0xaf4c08(0x109)};describe(_0x2e612c[_0xaf4c08(0x10f)],()=>{const _0x3ee381=_0xaf4c08,_0x1b6f7e={'EQDHd':_0x2e612c[_0x3ee381(0x110)],'mcwTz':_0x2e612c[_0x3ee381(0xe2)],'nAgDi':function(_0x151401,_0x1d39b0){return _0x151401(_0x1d39b0);},'ZSswn':_0x3ee381(0x10a),'YmBka':function(_0x5787ff,_0x5b0d93){return _0x2e612c['iSRRW'](_0x5787ff,_0x5b0d93);}},_0x40228b=jest['fn']();global[_0x3ee381(0xef)]={'db':{'query':jest['fn'](()=>({'findOne':_0x40228b}))}},afterEach(()=>{const _0x442b9b=_0x3ee381;jest[_0x442b9b(0x113)](),_0x40228b[_0x442b9b(0xea)]();});const _0x5f546f={'kind':_0x2e612c[_0x3ee381(0xe3)],'modelName':_0x2e612c[_0x3ee381(0x103)],'uid':'test-uid','options':{},'attributes':{'attrDateUnique':{'type':'date','unique':!![]}}};_0x2e612c[_0x3ee381(0xf2)](test,'it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique',async()=>{const _0x3d4ba8=_0x3ee381;_0x40228b['mockResolvedValueOnce'](null);const _0x5ad561=strapiUtils[_0x3d4ba8(0xf8)](validators['date']({'attr':{'type':_0x3d4ba8(0x10a)},'model':_0x5f546f,'updatedAttribute':{'name':_0x2e612c[_0x3d4ba8(0xe2)],'value':_0x3d4ba8(0xe8)},'entity':null},{'isDraft':![]}));await _0x5ad561(_0x2e612c[_0x3d4ba8(0x110)]),_0x2e612c[_0x3d4ba8(0xed)](expect,_0x40228b)[_0x3d4ba8(0x111)][_0x3d4ba8(0xe1)]();}),_0x2e612c[_0x3ee381(0xf2)](test,_0x2e612c[_0x3ee381(0xf4)],async()=>{const _0x59bf70=_0x3ee381;_0x40228b[_0x59bf70(0xe4)](null);const _0x2a5499=strapiUtils['validateYupSchema'](validators[_0x59bf70(0x10a)]({'attr':{'type':_0x59bf70(0x10a),'unique':!![]},'model':_0x5f546f,'updatedAttribute':{'name':_0x59bf70(0xee),'value':null},'entity':null},{'isDraft':![]})['nullable']());await _0x2a5499(null),expect(_0x40228b)['not'][_0x59bf70(0xe1)]();}),_0x2e612c['ywUot'](test,_0x3ee381(0xfc),async()=>{const _0x530010=_0x3ee381;_0x40228b[_0x530010(0xe4)](null);const _0x136852=strapiUtils[_0x530010(0xf8)](validators['date']({'attr':{'type':'date','unique':!![]},'model':_0x5f546f,'updatedAttribute':{'name':'attrDateUnique','value':_0x2e612c[_0x530010(0x110)]},'entity':null},{'isDraft':![]}));expect(await _0x2e612c[_0x530010(0xed)](_0x136852,_0x2e612c[_0x530010(0x110)]))[_0x530010(0x112)](_0x2e612c['XorKC']);}),_0x2e612c[_0x3ee381(0x100)](test,'it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x18fba3=_0x3ee381;expect[_0x18fba3(0xf7)](0x1),_0x40228b['mockResolvedValueOnce']({'attrDateUnique':_0x1b6f7e[_0x18fba3(0xe6)]});const _0x1e4c08=strapiUtils[_0x18fba3(0xf8)](validators['date']({'attr':{'type':_0x18fba3(0x10a),'unique':!![]},'model':_0x5f546f,'updatedAttribute':{'name':_0x1b6f7e[_0x18fba3(0xf3)],'value':_0x18fba3(0xe8)},'entity':null},{'isDraft':![]}));try{await _0x1b6f7e[_0x18fba3(0xfb)](_0x1e4c08,'2021-11-29');}catch(_0x3d4dd2){expect(_0x3d4dd2)[_0x18fba3(0xf6)](YupValidationError);}}),test('it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x1ed549=_0x3ee381;_0x40228b['mockResolvedValueOnce']({'attrDateUnique':_0x2e612c[_0x1ed549(0x110)]});const _0x348510=strapiUtils[_0x1ed549(0xf8)](validators['date']({'attr':{'type':_0x1ed549(0x10a),'unique':!![]},'model':_0x5f546f,'updatedAttribute':{'name':_0x2e612c[_0x1ed549(0xe2)],'value':_0x1ed549(0xe8)},'entity':{'id':0x1,'attrDateUnique':_0x1ed549(0xe8)}},{'isDraft':![]}));_0x2e612c[_0x1ed549(0xed)](expect,await _0x2e612c[_0x1ed549(0xed)](_0x348510,_0x1ed549(0xe8)))['toBe'](_0x2e612c[_0x1ed549(0x110)]);}),_0x2e612c['ywUot'](test,'it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute',async()=>{const _0x2f57dc=_0x3ee381;_0x40228b[_0x2f57dc(0xe4)](null);const _0x347e8d=strapiUtils[_0x2f57dc(0xf8)](validators['date']({'attr':{'type':_0x1b6f7e['ZSswn'],'unique':!![]},'model':_0x5f546f,'updatedAttribute':{'name':'attrDateUnique','value':_0x2f57dc(0xe8)},'entity':null},{'isDraft':![]}));await _0x1b6f7e[_0x2f57dc(0x10b)](_0x347e8d,_0x2f57dc(0xe8)),expect(_0x40228b)['toHaveBeenCalledWith']({'select':['id'],'where':{'attrDateUnique':'2021-11-29'}});}),test(_0x2e612c[_0x3ee381(0xe9)],async()=>{const _0x92c347=_0x3ee381;_0x40228b[_0x92c347(0xe4)](null);const _0x2a4fe0=strapiUtils[_0x92c347(0xf8)](validators[_0x92c347(0x10a)]({'attr':{'type':_0x92c347(0x10a),'unique':!![]},'model':_0x5f546f,'updatedAttribute':{'name':_0x2e612c[_0x92c347(0xe2)],'value':_0x2e612c[_0x92c347(0x110)]},'entity':{'id':0x1,'attrDateUnique':_0x2e612c[_0x92c347(0xf1)]}},{'isDraft':![]}));await _0x2a4fe0(_0x2e612c[_0x92c347(0x110)]),_0x2e612c[_0x92c347(0xed)](expect,_0x40228b)[_0x92c347(0xec)]({'select':['id'],'where':{'$and':[{'attrDateUnique':_0x2e612c[_0x92c347(0x110)]},{'$not':{'id':0x1}}]}});});});});function _0x150f(){const _0x400ce9=['1688160kngNmt','Date\x20validator','CKVcz','XorKC','not','toBe','clearAllMocks','236tYYIka','toHaveBeenCalled','VmTZs','dRmfV','mockResolvedValueOnce','2021-12-15','EQDHd','17668932Pafxat','2021-11-29','SwYPu','mockReset','26897NQOhvv','toHaveBeenCalledWith','iSRRW','attrDateUnique','strapi','contentType','KsYLi','jKNZH','mcwTz','rfJKH','9LOPIuH','toBeInstanceOf','assertions','validateYupSchema','11KaCFxs','../validators','nAgDi','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','653028vTtrJz','2ROWyUo','5698VIWcfQ','pAIBk','test-model','1340749EoeZIe','fweNs','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','@strapi/utils','15393LkPUUN','55ulgwXB','232uTWezt','unique','date','YmBka','105973rSBeKr'];_0x150f=function(){return _0x400ce9;};return _0x150f();}