'use strict';const _0x42303d=_0x2029;(function(_0x3d46ed,_0x20f304){const _0x459acd=_0x2029,_0x2dd7df=_0x3d46ed();while(!![]){try{const _0x41d07b=parseInt(_0x459acd(0x213))/0x1+parseInt(_0x459acd(0x20b))/0x2*(-parseInt(_0x459acd(0x1f4))/0x3)+parseInt(_0x459acd(0x214))/0x4+-parseInt(_0x459acd(0x1ff))/0x5+parseInt(_0x459acd(0x201))/0x6+parseInt(_0x459acd(0x1f1))/0x7+parseInt(_0x459acd(0x1f8))/0x8;if(_0x41d07b===_0x20f304)break;else _0x2dd7df['push'](_0x2dd7df['shift']());}catch(_0x4835fc){_0x2dd7df['push'](_0x2dd7df['shift']());}}}(_0x5660,0xbd68e));function _0x5660(){const _0x5c08dd=['log','nested\x20commit\x20->\x20rollback\x20works','KHhom','yqYCn','HMunc','using\x20a\x20transaction\x20object','OHsJC','ybVcs','execute','transaction','sygzN','SjzdO','update','hIvRt','error','changed\x20key\x20-\x20nested','commits\x20successfully','invalid_uid','8053199yTxPJP','eZmfZ','WdugY','206754qwfQHC','rpBNO','rollback','new\x20key','5489304GNfFuJ','qOmYx','ztgOZ','queryBuilder','key','UmdFD','tdeTs','6316355SLQeYg','this\x20should\x20not\x20be\x20reached','2990430UNBDHs','LqqpO','changed\x20key','rqTtu','sqOji','vorjL','NLeUq','destroy','Jgywl','using\x20a\x20transaction\x20method','42vpjElG','xedaQ','toEqual','onCommit\x20hook\x20works','aleia','where','wrong\x20key','hUeAz','878482BTRCuX','1091456hColQB','strapi::core-store','bad\x20key','EiZle','KGTPQ','ATJOj','gAnXI','bLvGF','vqseq','LqeDv','api-tests/strapi','get','this\x20should\x20error','omuJU','SoPyv','transactions','gaOuC','toBe','select','XtedU','transacting','ThlKN'];_0x5660=function(){return _0x5c08dd;};return _0x5660();}const {createStrapiInstance}=require(_0x42303d(0x21e));let strapi;function _0x2029(_0x376c57,_0x5d5fcb){const _0x566063=_0x5660();return _0x2029=function(_0x202911,_0x1d04d2){_0x202911=_0x202911-0x1e2;let _0xc8e747=_0x566063[_0x202911];return _0xc8e747;},_0x2029(_0x376c57,_0x5d5fcb);}describe(_0x42303d(0x223),()=>{const _0x400117=_0x42303d,_0xed073b={'gaOuC':'strapi::core-store','UmdFD':_0x400117(0x211),'xedaQ':function(_0x115c79,_0x4d80d6){return _0x115c79(_0x4d80d6);},'SjzdO':_0x400117(0x1ee),'SoPyv':function(_0x463e29,_0x49e260){return _0x463e29(_0x49e260);},'SvHlW':function(_0x20f950,_0x33087d){return _0x20f950(_0x33087d);},'rpBNO':_0x400117(0x1f0),'ThlKN':_0x400117(0x1ed),'yqYCn':'test','rmhur':_0x400117(0x1ef),'ATJOj':function(_0x4c77a6,_0x1bfa41,_0x1ade5c){return _0x4c77a6(_0x1bfa41,_0x1ade5c);},'rqTtu':'rollback\x20successfully','WdugY':'nested\x20rollback\x20->\x20rollback\x20works','gAnXI':_0x400117(0x22b),'hUeAz':_0x400117(0x20e),'Jgywl':function(_0x5e87b6,_0x2ebc54){return _0x5e87b6(_0x2ebc54);},'kyGYp':function(_0x16586d,_0x1a8611,_0x44da17){return _0x16586d(_0x1a8611,_0x44da17);},'omuJU':function(_0x5e04b4,_0x9405ab){return _0x5e04b4(_0x9405ab);},'hIvRt':function(_0x37b097,_0x1863fa,_0x1be615){return _0x37b097(_0x1863fa,_0x1be615);},'UMUdO':_0x400117(0x20a),'NLeUq':_0x400117(0x1e4)};let _0x1e3653;beforeAll(async()=>{const _0x4d26a7=_0x400117;strapi=await createStrapiInstance(),_0x1e3653=await strapi['db'][_0x4d26a7(0x1fb)](_0x4d26a7(0x215))[_0x4d26a7(0x226)](['*'])[_0x4d26a7(0x210)]({'id':0x1})[_0x4d26a7(0x1e7)]();}),afterAll(async()=>{const _0x4ce22a=_0x400117;await strapi[_0x4ce22a(0x208)]();}),_0xed073b[_0x400117(0x221)](afterEach,async()=>{const _0x56c61b=_0x400117;await strapi['db'][_0x56c61b(0x1fb)](_0xed073b[_0x56c61b(0x224)])[_0x56c61b(0x1eb)]({'key':_0x1e3653[0x0][_0x56c61b(0x1fc)]})[_0x56c61b(0x210)]({'id':0x1})[_0x56c61b(0x1e7)]();}),_0xed073b[_0x400117(0x1ec)](describe,_0xed073b['UMUdO'],()=>{const _0x128afd=_0x400117,_0x266003={'ygCWh':_0xed073b['UmdFD'],'OHsJC':'strapi::core-store','vqseq':function(_0x599fbd,_0x408ea0){return _0xed073b['SvHlW'](_0x599fbd,_0x408ea0);},'LqeDv':_0x128afd(0x203),'sygzN':_0xed073b[_0x128afd(0x1f5)],'KGTPQ':_0x128afd(0x200),'tdeTs':function(_0x542466,_0x486744){const _0x220ee1=_0x128afd;return _0xed073b[_0x220ee1(0x20c)](_0x542466,_0x486744);},'qOmYx':_0xed073b[_0x128afd(0x229)],'ztgOZ':_0xed073b[_0x128afd(0x1e2)]};test(_0xed073b['rmhur'],async()=>{const _0x871a5b=_0x128afd;await strapi['db'][_0x871a5b(0x1e8)](async()=>{const _0x533b6c=_0x871a5b;await strapi['db']['queryBuilder']('strapi::core-store')['update']({'key':_0x266003['ygCWh']})[_0x533b6c(0x210)]({'id':0x1})['execute'](),await strapi['db']['queryBuilder'](_0x266003['OHsJC'])[_0x533b6c(0x1eb)]({'key':'new\x20key'})[_0x533b6c(0x210)]({'id':0x1})[_0x533b6c(0x1e7)]();});const _0x580511=await strapi['db'][_0x871a5b(0x1fb)](_0x871a5b(0x215))[_0x871a5b(0x226)](['*'])[_0x871a5b(0x210)]({'id':0x1})[_0x871a5b(0x1e7)]();_0x266003[_0x871a5b(0x21c)](expect,_0x580511[0x0][_0x871a5b(0x1fc)])[_0x871a5b(0x20d)](_0x871a5b(0x1f7));}),_0xed073b[_0x128afd(0x219)](test,_0xed073b['rqTtu'],async()=>{const _0x5cbce1=_0x128afd,_0x1f4fef={'LqqpO':_0xed073b[_0x5cbce1(0x1fd)],'ybVcs':_0x5cbce1(0x1f0),'YTLxk':_0x5cbce1(0x216)};try{await strapi['db']['transaction'](async()=>{const _0x27ecc8=_0x5cbce1;await strapi['db']['queryBuilder'](_0x27ecc8(0x215))[_0x27ecc8(0x1eb)]({'key':_0x1f4fef[_0x27ecc8(0x202)]})[_0x27ecc8(0x210)]({'id':0x1})[_0x27ecc8(0x1e7)](),await strapi['db'][_0x27ecc8(0x1fb)](_0x1f4fef[_0x27ecc8(0x1e6)])[_0x27ecc8(0x1eb)]({'key':_0x1f4fef['YTLxk'],'invalid_key':'error'})['where']({'id':0x1})['execute']();}),_0xed073b['xedaQ'](expect,_0x5cbce1(0x200))['toBe'](![]);}catch(_0x221373){}const _0x3917ec=await strapi['db'][_0x5cbce1(0x1fb)](_0x5cbce1(0x215))[_0x5cbce1(0x226)](['*'])[_0x5cbce1(0x210)]({'id':0x1})['execute']();_0xed073b[_0x5cbce1(0x20c)](expect,_0x3917ec[0x0][_0x5cbce1(0x1fc)])[_0x5cbce1(0x20d)](_0x1e3653[0x0]['key']);}),_0xed073b[_0x128afd(0x219)](test,_0xed073b[_0x128afd(0x1f3)],async()=>{const _0x345a35=_0x128afd,_0x5a1f76={'eZmfZ':_0x266003[_0x345a35(0x1e5)],'HMunc':_0x345a35(0x1ee),'sqOji':_0x266003[_0x345a35(0x21d)],'bLvGF':_0x266003[_0x345a35(0x1e9)],'KHhom':_0x345a35(0x1ed)};try{await strapi['db'][_0x345a35(0x1e8)](async()=>{const _0x433966=_0x345a35;await strapi['db'][_0x433966(0x1fb)](_0x433966(0x215))['update']({'key':_0x433966(0x203)})[_0x433966(0x210)]({'id':0x1})[_0x433966(0x1e7)]();try{await strapi['db']['transaction'](async()=>{const _0x412fc0=_0x433966;await strapi['db']['queryBuilder'](_0x5a1f76[_0x412fc0(0x1f2)])[_0x412fc0(0x1eb)]({'key':_0x5a1f76[_0x412fc0(0x1e3)]})[_0x412fc0(0x210)]({'id':0x1})[_0x412fc0(0x1e7)](),await strapi['db'][_0x412fc0(0x1fb)]('invalid_uid')[_0x412fc0(0x1eb)]({'invalid_key':_0x412fc0(0x1ed)})[_0x412fc0(0x210)]({'id':0x1})[_0x412fc0(0x1e7)]();});}catch(_0xd24847){}const _0x294fc4=await strapi['db'][_0x433966(0x1fb)](_0x5a1f76[_0x433966(0x1f2)])['select'](['*'])['where']({'id':0x1})[_0x433966(0x1e7)]();expect(_0x294fc4[0x0]['key'])[_0x433966(0x20d)](_0x5a1f76[_0x433966(0x205)]),await strapi['db'][_0x433966(0x1fb)](_0x5a1f76[_0x433966(0x21b)])[_0x433966(0x1eb)]({'key':_0x1e3653[0x0][_0x433966(0x1fc)],'invalid_key':_0x5a1f76[_0x433966(0x22c)]})['where']({'id':0x1})[_0x433966(0x1e7)]();}),expect(_0x266003[_0x345a35(0x218)])['toBe'](![]);}catch(_0x13f361){}const _0x32695a=await strapi['db'][_0x345a35(0x1fb)](_0x266003['OHsJC'])['select'](['*'])[_0x345a35(0x210)]({'id':0x1})['execute']();_0x266003[_0x345a35(0x1fe)](expect,_0x32695a[0x0][_0x345a35(0x1fc)])[_0x345a35(0x20d)](_0x1e3653[0x0]['key']);}),_0xed073b[_0x128afd(0x219)](test,_0xed073b[_0x128afd(0x21a)],async()=>{const _0x50ab60=_0x128afd,_0x2a02f0={'vorjL':_0x50ab60(0x215),'XtedU':_0xed073b[_0x50ab60(0x1ea)]};try{await strapi['db'][_0x50ab60(0x1e8)](async()=>{const _0x201709=_0x50ab60;await strapi['db'][_0x201709(0x1fb)](_0x201709(0x215))['update']({'key':'changed\x20key'})[_0x201709(0x210)]({'id':0x1})[_0x201709(0x1e7)]();try{await strapi['db']['transaction'](async()=>{const _0x5e7d55=_0x201709;await strapi['db'][_0x5e7d55(0x1fb)](_0x2a02f0[_0x5e7d55(0x206)])[_0x5e7d55(0x1eb)]({'key':_0x2a02f0[_0x5e7d55(0x227)]})[_0x5e7d55(0x210)]({'id':0x1})[_0x5e7d55(0x1e7)]();});}catch(_0x499363){}const _0x284788=await strapi['db'][_0x201709(0x1fb)](_0x266003[_0x201709(0x1e5)])['select'](['*'])['where']({'id':0x1})[_0x201709(0x1e7)]();expect(_0x284788[0x0][_0x201709(0x1fc)])[_0x201709(0x20d)]('changed\x20key\x20-\x20nested'),await strapi['db'][_0x201709(0x1fb)](_0x266003[_0x201709(0x1e9)])[_0x201709(0x1eb)]({'key':_0x1e3653[0x0][_0x201709(0x1fc)],'invalid_key':_0x266003[_0x201709(0x1f9)]})[_0x201709(0x210)]({'id':0x1})[_0x201709(0x1e7)]();}),_0xed073b[_0x50ab60(0x20c)](expect,_0x50ab60(0x200))[_0x50ab60(0x225)](![]);}catch(_0x53c36b){}const _0x33f1fa=await strapi['db']['queryBuilder'](_0x50ab60(0x215))[_0x50ab60(0x226)](['*'])['where']({'id':0x1})[_0x50ab60(0x1e7)]();_0xed073b[_0x50ab60(0x222)](expect,_0x33f1fa[0x0][_0x50ab60(0x1fc)])['toEqual'](_0x1e3653[0x0][_0x50ab60(0x1fc)]);}),test(_0xed073b[_0x128afd(0x212)],async()=>{let _0x44c623=0x0;await strapi['db']['transaction'](({onCommit:_0x537c84,onRollback:_0x45c9b7})=>{_0x537c84(()=>_0x44c623++);}),expect(_0x44c623)['toEqual'](0x1);}),test('onRollback\x20hook\x20works',async()=>{const _0x45eebb=_0x128afd,_0x4528d8={'OQHvV':_0x266003[_0x45eebb(0x1fa)]};let _0x266446=0x0;try{await strapi['db'][_0x45eebb(0x1e8)](({onRollback:_0x5da2bf})=>{_0x5da2bf(()=>_0x266446++);throw new Error(_0x4528d8['OQHvV']);});}catch(_0x18fa50){}_0x266003['tdeTs'](expect,_0x266446)['toEqual'](0x1);});}),describe(_0xed073b[_0x400117(0x207)],()=>{const _0x1ffd78=_0x400117,_0x1198fb={'aleia':_0x1ffd78(0x215),'LvbmG':_0x1ffd78(0x211),'EiZle':'this\x20should\x20not\x20be\x20reached','qdxsb':function(_0x19793b,_0x258fd0){return _0x19793b(_0x258fd0);},'jdipA':_0xed073b[_0x1ffd78(0x1f5)],'TJQIN':function(_0x45abdc,_0x472d39){const _0x540fa6=_0x1ffd78;return _0xed073b[_0x540fa6(0x209)](_0x45abdc,_0x472d39);}};test(_0x1ffd78(0x1ef),async()=>{const _0x2d9de6=_0x1ffd78,_0x1238af=await strapi['db']['transaction']();try{await strapi['db'][_0x2d9de6(0x1fb)](_0x1198fb[_0x2d9de6(0x20f)])[_0x2d9de6(0x1eb)]({'key':_0x1198fb['LvbmG']})[_0x2d9de6(0x210)]({'id':0x1})[_0x2d9de6(0x228)](_0x1238af[_0x2d9de6(0x21f)]())[_0x2d9de6(0x1e7)](),await strapi['db'][_0x2d9de6(0x1fb)](_0x2d9de6(0x215))[_0x2d9de6(0x1eb)]({'key':_0x1e3653[0x0][_0x2d9de6(0x1fc)]})[_0x2d9de6(0x210)]({'id':0x1})[_0x2d9de6(0x228)](_0x1238af[_0x2d9de6(0x21f)]())['execute'](),await _0x1238af['commit']();}catch(_0x4f840){await _0x1238af['rollback'](),console[_0x2d9de6(0x22a)](_0x4f840['message']),expect(_0x1198fb[_0x2d9de6(0x217)])[_0x2d9de6(0x225)](![]);}const _0x406300=await strapi['db'][_0x2d9de6(0x1fb)]('strapi::core-store')[_0x2d9de6(0x226)](['*'])[_0x2d9de6(0x210)]({'id':0x1})[_0x2d9de6(0x1e7)]();_0x1198fb['qdxsb'](expect,_0x406300[0x0][_0x2d9de6(0x1fc)])[_0x2d9de6(0x20d)](_0x1e3653[0x0][_0x2d9de6(0x1fc)]);}),_0xed073b['kyGYp'](test,_0xed073b[_0x1ffd78(0x204)],async()=>{const _0x25e35d=_0x1ffd78,_0x532896=await strapi['db'][_0x25e35d(0x1e8)]();try{await strapi['db']['queryBuilder'](_0x1198fb[_0x25e35d(0x20f)])[_0x25e35d(0x1eb)]({'key':_0x1198fb['LvbmG']})[_0x25e35d(0x210)]({'id':0x1})[_0x25e35d(0x228)](_0x532896[_0x25e35d(0x21f)]())[_0x25e35d(0x1e7)](),await strapi['db']['queryBuilder'](_0x1198fb['jdipA'])[_0x25e35d(0x1eb)]({'key':0x7b,'key_not_here':_0x25e35d(0x220)})['where']({'id':_0x25e35d(0x220)})[_0x25e35d(0x228)](_0x532896['get']())[_0x25e35d(0x1e7)](),await _0x532896['commit'](),expect(_0x25e35d(0x200))[_0x25e35d(0x225)](![]);}catch(_0x1787a3){await _0x532896[_0x25e35d(0x1f6)]();}const _0x7b164=await strapi['db']['queryBuilder'](_0x25e35d(0x215))[_0x25e35d(0x226)](['*'])[_0x25e35d(0x210)]({'id':0x1})['execute']();_0x1198fb['TJQIN'](expect,_0x7b164[0x0][_0x25e35d(0x1fc)])[_0x25e35d(0x20d)](_0x1e3653[0x0][_0x25e35d(0x1fc)]);});});});