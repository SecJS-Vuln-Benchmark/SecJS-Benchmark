'use strict';function _0x2f07(){const _0x526275=['it\x20always\x20validates\x20the\x20unique\x20constraint\x20even\x20if\x20the\x20attribute\x20is\x20not\x20set\x20as\x20unique','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20for\x20the\x20checked\x20attribute','strapi','xmBnq','mockReset','unique-uid','nullable','tPwaC','vrEhr','oeCZz','4ChsvvW','toHaveBeenCalledWith','mgfFJ','unique','231jWaVmO','pMVpA','it\x20validates\x20the\x20unique\x20constraint\x20if\x20there\x20is\x20no\x20other\x20record\x20in\x20the\x20database','5580DvRJzw','RnLnP','it\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20data\x20has\x20not\x20changed\x20even\x20if\x20there\x20is\x20a\x20record\x20in\x20the\x20database\x20with\x20the\x20same\x20attribute\x20value','hvEFZ','61280gYaKMz','vJvaw','toBeInstanceOf','fAizh','unzTF','it\x20checks\x20the\x20database\x20for\x20records\x20with\x20the\x20same\x20value\x20but\x20not\x20the\x20same\x20id\x20for\x20the\x20checked\x20attribute\x20if\x20an\x20entity\x20is\x20passed','unchanged-unique-uid','test-uid','HjxGN','it\x20does\x20not\x20validates\x20the\x20unique\x20constraint\x20if\x20the\x20attribute\x20value\x20is\x20`null`','OIUOY','attrUidUnique','384610nvXVLp','xbsTl','ebiBD','assertions','GtdJJ','mockResolvedValueOnce','UkTeE','MRdZE','toBe','it\x20fails\x20to\x20validate\x20the\x20uid\x20if\x20it\x20does\x20not\x20fit\x20the\x20requried\x20format','wrongly\x5cformated||UID','nwepm','324098OYuGJB','ibECD','VRAya','27252RSgTIM','contentType','uid','TYqtQ','AgygX','regExp','488050sYMawL','validateYupSchema','dLfUd','yZggz','it\x20validate\x20the\x20uid\x20if\x20it\x20fit\x20the\x20required\x20format','non-unique-uid','3113280OrapZl','bPzxt','1499034MTKusl','other-uid','uYivA','properly.formated-uid','wUbzw','zoAMi'];_0x2f07=function(){return _0x526275;};return _0x2f07();}(function(_0x2de124,_0x1f7259){const _0x29affa=_0x13e2,_0x1accfd=_0x2de124();while(!![]){try{const _0x586d70=-parseInt(_0x29affa(0x1c9))/0x1+parseInt(_0x29affa(0x1d2))/0x2+parseInt(_0x29affa(0x1da))/0x3*(-parseInt(_0x29affa(0x1a6))/0x4)+-parseInt(_0x29affa(0x1bd))/0x5+-parseInt(_0x29affa(0x1d8))/0x6+parseInt(_0x29affa(0x1aa))/0x7*(-parseInt(_0x29affa(0x1b1))/0x8)+parseInt(_0x29affa(0x1cc))/0x9*(parseInt(_0x29affa(0x1ad))/0xa);if(_0x586d70===_0x1f7259)break;else _0x1accfd['push'](_0x1accfd['shift']());}catch(_0x2e4996){_0x1accfd['push'](_0x1accfd['shift']());}}}(_0x2f07,0x3fcab));function _0x13e2(_0x51e0e8,_0x28851e){const _0x2f0750=_0x2f07();return _0x13e2=function(_0x13e2ab,_0x544a60){_0x13e2ab=_0x13e2ab-0x19d;let _0x2bd9ed=_0x2f0750[_0x13e2ab];return _0x2bd9ed;},_0x13e2(_0x51e0e8,_0x28851e);}const strapiUtils=require('@strapi/utils'),{errors:{YupValidationError}}=require('@strapi/utils'),validators=require('../validators');describe('UID\x20validator',()=>{const _0x4276af=_0x13e2,_0x3f7300={'pMVpA':function(_0x5cc424,_0x373d5f){return _0x5cc424(_0x373d5f);},'ibECD':function(_0x127b96,_0x686fe1){return _0x127b96(_0x686fe1);},'TYqtQ':_0x4276af(0x1ce),'UkTeE':function(_0x2fd8f5,_0x542948){return _0x2fd8f5(_0x542948);},'MRdZE':_0x4276af(0x1d7),'fAizh':_0x4276af(0x1a1),'JmRMu':'attrUidUnique','wUbzw':function(_0x33011b,_0x42815e){return _0x33011b(_0x42815e);},'yqxBa':_0x4276af(0x1b7),'xbsTl':function(_0x303955,_0x5ba63f,_0x581cde){return _0x303955(_0x5ba63f,_0x581cde);},'xmBnq':_0x4276af(0x1ac),'mgfFJ':function(_0x1d2bff,_0x2736f7,_0x47731e){return _0x1d2bff(_0x2736f7,_0x47731e);},'unzTF':_0x4276af(0x1ba),'uYivA':function(_0x350b3f,_0x41ca32,_0x4c4ab3){return _0x350b3f(_0x41ca32,_0x4c4ab3);},'dLfUd':_0x4276af(0x1e0),'vJvaw':function(_0x5f1804,_0x5a5447,_0x968b2a){return _0x5f1804(_0x5a5447,_0x968b2a);},'DZDQm':function(_0x4c62b0,_0x465af4,_0x51d383){return _0x4c62b0(_0x465af4,_0x51d383);},'GtdJJ':_0x4276af(0x1b6),'AgygX':_0x4276af(0x1c6),'bPzxt':function(_0x9b9f28,_0x128e6b){return _0x9b9f28(_0x128e6b);},'zoAMi':_0x4276af(0x1cd),'OIUOY':_0x4276af(0x1b8),'RnLnP':function(_0x40ed8e,_0x25f8d7,_0xf621aa){return _0x40ed8e(_0x25f8d7,_0xf621aa);},'nwepm':_0x4276af(0x1a9),'hvEFZ':function(_0x1f5873,_0x4aaa0a,_0xea235b){return _0x1f5873(_0x4aaa0a,_0xea235b);},'NwsoA':_0x4276af(0x1d1)},_0x38f9dd=jest['fn']();global[_0x4276af(0x19e)]={'db':{'query':jest['fn'](()=>({'findOne':_0x38f9dd}))}},_0x3f7300[_0x4276af(0x1d9)](afterEach,()=>{const _0x2485f0=_0x4276af;jest['clearAllMocks'](),_0x38f9dd[_0x2485f0(0x1a0)]();});const _0x9f9cf4={'kind':_0x3f7300[_0x4276af(0x1df)],'modelName':'test-model','uid':_0x3f7300[_0x4276af(0x1bb)],'privateAttributes':[],'options':{},'attributes':{'attrUidUnique':{'type':_0x3f7300[_0x4276af(0x1cf)]}}};_0x3f7300[_0x4276af(0x1ae)](describe,_0x3f7300[_0x4276af(0x1c8)],()=>{const _0x21363a=_0x4276af,_0x2ecad3={'HjxGN':_0x3f7300[_0x21363a(0x1cf)],'yZggz':_0x21363a(0x1bc),'oeCZz':function(_0xb62239,_0x552bdd){const _0x1bdc96=_0x21363a;return _0x3f7300[_0x1bdc96(0x1c3)](_0xb62239,_0x552bdd);},'vrEhr':_0x3f7300['yqxBa'],'VRAya':_0x21363a(0x1a1)};_0x3f7300[_0x21363a(0x1be)](test,_0x3f7300[_0x21363a(0x19f)],async()=>{const _0x31b674=_0x21363a;_0x38f9dd['mockResolvedValueOnce'](null);const _0xfb1c8d=strapiUtils[_0x31b674(0x1d3)](validators[_0x31b674(0x1ce)]({'attr':{'type':_0x2ecad3['HjxGN'],'unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x2ecad3['yZggz'],'value':_0x31b674(0x1d7)},'entity':null},{'isDraft':![]}));expect(await _0x2ecad3[_0x31b674(0x1a5)](_0xfb1c8d,_0x31b674(0x1d7)))['toBe'](_0x31b674(0x1d7));}),_0x3f7300[_0x21363a(0x1a8)](test,_0x3f7300[_0x21363a(0x1b5)],async()=>{const _0x3245c6=_0x21363a;_0x38f9dd[_0x3245c6(0x1c2)](null);const _0x51df6d=strapiUtils[_0x3245c6(0x1d3)](validators[_0x3245c6(0x1ce)]({'attr':{'type':'uid','unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x3245c6(0x1bc),'value':null},'entity':null},{'isDraft':![]})[_0x3245c6(0x1a2)]());await _0x3f7300[_0x3245c6(0x1ab)](_0x51df6d,null),_0x3f7300[_0x3245c6(0x1ca)](expect,_0x38f9dd)['not']['toHaveBeenCalled']();}),_0x3f7300[_0x21363a(0x1dc)](test,_0x3f7300[_0x21363a(0x1d4)],async()=>{const _0x7605dd=_0x21363a;_0x38f9dd[_0x7605dd(0x1c2)](null);const _0x524a76=strapiUtils['validateYupSchema'](validators[_0x7605dd(0x1ce)]({'attr':{'type':_0x3f7300[_0x7605dd(0x1cf)]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x7605dd(0x1bc),'value':_0x7605dd(0x1d7)},'entity':null},{'isDraft':![]}));_0x3f7300['UkTeE'](expect,await _0x524a76(_0x3f7300[_0x7605dd(0x1c4)]))['toBe'](_0x7605dd(0x1d7)),expect(_0x38f9dd)[_0x7605dd(0x1a7)]({'select':['id'],'where':{'attrUidUnique':_0x7605dd(0x1d7)}});}),test('it\x20fails\x20the\x20validation\x20of\x20the\x20unique\x20constraint\x20if\x20the\x20database\x20contains\x20a\x20record\x20with\x20the\x20same\x20attribute\x20value',async()=>{const _0x56c8da=_0x21363a;expect[_0x56c8da(0x1c0)](0x1),_0x38f9dd['mockResolvedValueOnce']({'attrUidUnique':_0x3f7300[_0x56c8da(0x1b4)]});const _0x4dd88b=strapiUtils[_0x56c8da(0x1d3)](validators[_0x56c8da(0x1ce)]({'attr':{'type':'uid','unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':'attrUidUnique','value':_0x3f7300[_0x56c8da(0x1b4)]},'entity':null},{'isDraft':![]}));try{await _0x4dd88b('unique-uid');}catch(_0x4752c3){expect(_0x4752c3)['toBeInstanceOf'](YupValidationError);}}),_0x3f7300[_0x21363a(0x1b2)](test,_0x21363a(0x1af),async()=>{const _0x14f27d=_0x21363a;_0x38f9dd[_0x14f27d(0x1c2)]({'attrUidUnique':_0x2ecad3['vrEhr']});const _0x33aa3d=strapiUtils['validateYupSchema'](validators['uid']({'attr':{'type':_0x2ecad3[_0x14f27d(0x1b9)],'unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x2ecad3[_0x14f27d(0x1d5)],'value':_0x2ecad3[_0x14f27d(0x1a4)]},'entity':{'id':0x1,'attrUidUnique':_0x14f27d(0x1b7)}},{'isDraft':![]}));expect(await _0x33aa3d(_0x2ecad3[_0x14f27d(0x1a4)]))[_0x14f27d(0x1c5)](_0x2ecad3[_0x14f27d(0x1a4)]);}),test(_0x21363a(0x19d),async()=>{const _0x199e17=_0x21363a;_0x38f9dd[_0x199e17(0x1c2)](null);const _0x13d0c4=strapiUtils[_0x199e17(0x1d3)](validators[_0x199e17(0x1ce)]({'attr':{'type':_0x3f7300[_0x199e17(0x1cf)],'unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x3f7300['JmRMu'],'value':_0x3f7300[_0x199e17(0x1b4)]},'entity':null},{'isDraft':![]}));await _0x3f7300[_0x199e17(0x1ab)](_0x13d0c4,'unique-uid'),_0x3f7300[_0x199e17(0x1de)](expect,_0x38f9dd)['toHaveBeenCalledWith']({'select':['id'],'where':{'attrUidUnique':_0x3f7300[_0x199e17(0x1b4)]}});}),_0x3f7300['DZDQm'](test,_0x3f7300[_0x21363a(0x1c1)],async()=>{const _0x2c6ea5=_0x21363a;_0x38f9dd[_0x2c6ea5(0x1c2)](null);const _0x285c14=strapiUtils[_0x2c6ea5(0x1d3)](validators[_0x2c6ea5(0x1ce)]({'attr':{'type':_0x2c6ea5(0x1ce),'unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x2c6ea5(0x1bc),'value':_0x2c6ea5(0x1a1)},'entity':{'id':0x1,'attrUidUnique':_0x2c6ea5(0x1db)}},{'isDraft':![]}));await _0x285c14(_0x2ecad3[_0x2c6ea5(0x1cb)]),expect(_0x38f9dd)[_0x2c6ea5(0x1a7)]({'select':['id'],'where':{'$and':[{'attrUidUnique':_0x2ecad3[_0x2c6ea5(0x1cb)]},{'$not':{'id':0x1}}]}});});}),_0x3f7300[_0x4276af(0x1b0)](describe,_0x3f7300['NwsoA'],()=>{const _0xbc7823=_0x4276af,_0x2bfeda={'ebiBD':_0x3f7300[_0xbc7823(0x1c4)],'tPwaC':_0x3f7300[_0xbc7823(0x1cf)]};test(_0x3f7300[_0xbc7823(0x1d0)],async()=>{const _0xee2ba3=_0xbc7823;expect['assertions'](0x1),_0x38f9dd[_0xee2ba3(0x1c2)](null);const _0x25a575=strapiUtils['validateYupSchema'](validators[_0xee2ba3(0x1ce)]({'attr':{'type':_0xee2ba3(0x1ce),'unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0xee2ba3(0x1bc),'value':_0x2bfeda[_0xee2ba3(0x1bf)]},'entity':null},{'isDraft':![]}));try{await _0x25a575(_0xee2ba3(0x1c7));}catch(_0x2116ab){expect(_0x2116ab)[_0xee2ba3(0x1b3)](YupValidationError);}}),test(_0xbc7823(0x1d6),async()=>{const _0x3766b5=_0xbc7823;_0x38f9dd[_0x3766b5(0x1c2)](null);const _0x59a1e6=strapiUtils[_0x3766b5(0x1d3)](validators['uid']({'attr':{'type':_0x2bfeda[_0x3766b5(0x1a3)],'unique':!![]},'model':_0x9f9cf4,'updatedAttribute':{'name':_0x3766b5(0x1bc),'value':_0x3766b5(0x1d7)},'entity':null},{'isDraft':![]}));expect(await _0x59a1e6(_0x3766b5(0x1dd)))[_0x3766b5(0x1c5)](_0x3766b5(0x1dd));});});});