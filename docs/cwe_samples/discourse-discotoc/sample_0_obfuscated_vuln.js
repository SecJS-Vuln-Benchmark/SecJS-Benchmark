const _0x5262d3=_0x5c44;(function(_0x461ab3,_0x4db2df){const _0x5485f7=_0x5c44,_0x2c7c1c=_0x461ab3();while(!![]){try{const _0x268162=-parseInt(_0x5485f7(0xaa))/0x1*(parseInt(_0x5485f7(0xdb))/0x2)+parseInt(_0x5485f7(0xce))/0x3+-parseInt(_0x5485f7(0xa6))/0x4*(parseInt(_0x5485f7(0xe2))/0x5)+parseInt(_0x5485f7(0xec))/0x6+parseInt(_0x5485f7(0xae))/0x7+parseInt(_0x5485f7(0xd4))/0x8*(parseInt(_0x5485f7(0xd0))/0x9)+parseInt(_0x5485f7(0xc8))/0xa*(-parseInt(_0x5485f7(0xd6))/0xb);if(_0x268162===_0x4db2df)break;else _0x2c7c1c['push'](_0x2c7c1c['shift']());}catch(_0x21e270){_0x2c7c1c['push'](_0x2c7c1c['shift']());}}}(_0x1d44,0x81d93));function _0x5c44(_0x34cb42,_0x529ffc){const _0x1d4433=_0x1d44();return _0x5c44=function(_0x5c44bf,_0xb18dbf){_0x5c44bf=_0x5c44bf-0x9f;let _0x3569ff=_0x1d4433[_0x5c44bf];return _0x3569ff;},_0x5c44(_0x34cb42,_0x529ffc);}const multer=require('multer'),express=require(_0x5262d3(0xcc)),{CacheKeys,EModelEndpoint}=require(_0x5262d3(0xd8)),{getConvosByPage,deleteConvos,getConvo,saveConvo}=require('~/models/Conversation'),{storage,importFileFilter}=require(_0x5262d3(0xd2)),requireJwtAuth=require(_0x5262d3(0xcb)),{forkConversation}=require(_0x5262d3(0xc4)),{importConversations}=require(_0x5262d3(0xe4)),{createImportLimiters}=require(_0x5262d3(0xde)),getLogStores=require(_0x5262d3(0xb0)),{sleep}=require('~/server/utils'),{logger}=require(_0x5262d3(0x9f)),assistantClients={[EModelEndpoint[_0x5262d3(0xc6)]]:require(_0x5262d3(0xe3)),[EModelEndpoint[_0x5262d3(0xd1)]]:require(_0x5262d3(0xab))},router=express['Router']();router[_0x5262d3(0xbb)](requireJwtAuth),router[_0x5262d3(0xea)]('/',async(_0x55232d,_0x5ed0ac)=>{const _0x3e7bca=_0x5262d3,_0x14a8ce={'hXzjs':_0x3e7bca(0xb3),'ZCKTa':function(_0x425ed8,_0x2ee083,_0x5f4112){return _0x425ed8(_0x2ee083,_0x5f4112);},'FEaDz':function(_0x4b062e,_0x58fea3,_0x2c7f5f,_0x23bdaf,_0x3641ca,_0x4cc976){return _0x4b062e(_0x58fea3,_0x2c7f5f,_0x23bdaf,_0x3641ca,_0x4cc976);}};let _0xdf25c2=_0x55232d['query'][_0x3e7bca(0xe7)]||0x1;_0xdf25c2=parseInt(_0xdf25c2,0xa);if(isNaN(_0xdf25c2)||_0xdf25c2<0x1){if(_0x14a8ce['hXzjs']!==_0x3e7bca(0xbf))return _0x5ed0ac[_0x3e7bca(0xf1)](0x190)['json']({'error':'Invalid\x20page\x20number'});else _0x44662f[_0x3e7bca(0xf1)](0x194)['end']();}let _0x5e594d=_0x55232d['query'][_0x3e7bca(0xd9)]||0x19;_0x5e594d=_0x14a8ce[_0x3e7bca(0xf2)](parseInt,_0x5e594d,0xa);if(isNaN(_0x5e594d)||_0x5e594d<0x1)return _0x5ed0ac[_0x3e7bca(0xf1)](0x190)[_0x3e7bca(0xb5)]({'error':'Invalid\x20page\x20size'});const _0x5c9feb=_0x55232d[_0x3e7bca(0xb9)]['isArchived']===_0x3e7bca(0xe1);let _0x45afe0;_0x55232d[_0x3e7bca(0xb9)]['tags']?_0x45afe0=Array[_0x3e7bca(0xba)](_0x55232d[_0x3e7bca(0xb9)][_0x3e7bca(0xdf)])?_0x55232d[_0x3e7bca(0xb9)][_0x3e7bca(0xdf)]:[_0x55232d[_0x3e7bca(0xb9)][_0x3e7bca(0xdf)]]:_0x45afe0=undefined,_0x5ed0ac[_0x3e7bca(0xf1)](0xc8)[_0x3e7bca(0xad)](await _0x14a8ce[_0x3e7bca(0xd3)](getConvosByPage,_0x55232d[_0x3e7bca(0xef)]['id'],_0xdf25c2,_0x5e594d,_0x5c9feb,_0x45afe0));}),router[_0x5262d3(0xea)](_0x5262d3(0xe9),async(_0x31f2e3,_0x297b22)=>{const _0x5a515f=_0x5262d3,{conversationId:_0x4a8998}=_0x31f2e3[_0x5a515f(0xcd)],_0xad1c8e=await getConvo(_0x31f2e3[_0x5a515f(0xef)]['id'],_0x4a8998);_0xad1c8e?_0x297b22[_0x5a515f(0xf1)](0xc8)[_0x5a515f(0xb5)](_0xad1c8e):_0x297b22[_0x5a515f(0xf1)](0x194)['end']();}),router[_0x5262d3(0xb1)]('/gen_title',async(_0x307c42,_0x3c3de1)=>{const _0x139d44=_0x5262d3,_0x42b914={'cjlux':function(_0x19c269,_0x42c20b){return _0x19c269(_0x42c20b);},'CDpxa':'PWDEJ'},{conversationId:_0x5e5e42}=_0x307c42[_0x139d44(0xd5)],_0x46e3f8=_0x42b914[_0x139d44(0xbc)](getLogStores,CacheKeys['GEN_TITLE']),_0x54c0ca=_0x307c42[_0x139d44(0xef)]['id']+'-'+_0x5e5e42;let _0x2e9404=await _0x46e3f8[_0x139d44(0xea)](_0x54c0ca);!_0x2e9404&&(await _0x42b914['cjlux'](sleep,0x9c4),_0x2e9404=await _0x46e3f8['get'](_0x54c0ca)),_0x2e9404?(await _0x46e3f8[_0x139d44(0xa2)](_0x54c0ca),_0x3c3de1[_0x139d44(0xf1)](0xc8)['json']({'title':_0x2e9404})):_0x42b914[_0x139d44(0xb4)]==='OBMEa'?(_0x1552c6[_0x139d44(0xa9)](_0x139d44(0xda),_0xb011cd),_0x1b1df7[_0x139d44(0xf1)](0x1f4)[_0x139d44(0xad)]('Error\x20processing\x20file')):_0x3c3de1[_0x139d44(0xf1)](0x194)[_0x139d44(0xb5)]({'message':_0x139d44(0xc3)});}),router[_0x5262d3(0xb1)](_0x5262d3(0xd7),async(_0x5728e7,_0x55d465)=>{const _0xf7f81a=_0x5262d3,_0x32f7f2={'hfxLP':_0xf7f81a(0xaf),'ZLZHn':_0xf7f81a(0xa7),'jPFHg':_0xf7f81a(0xb8),'Gdsbr':function(_0x3d140b,_0x3255dd){return _0x3d140b!==_0x3255dd;},'pmkEq':'KcuTB','BQXST':function(_0x3b33cf,_0x512770,_0x405528){return _0x3b33cf(_0x512770,_0x405528);},'BuQrP':_0xf7f81a(0xac)};let _0x5b080e={};const {conversationId:_0x2e9892,source:_0x3308eb,thread_id:_0x3d50f4,endpoint:_0x3598cd}=_0x5728e7[_0xf7f81a(0xd5)]['arg'];if(_0x2e9892){if(_0xf7f81a(0xcf)!==_0xf7f81a(0xb6))_0x5b080e={'conversationId':_0x2e9892};else return _0x2076c9[_0xf7f81a(0xf1)](0x190)[_0xf7f81a(0xb5)]({'error':_0x32f7f2[_0xf7f81a(0xeb)]});}if(_0x3308eb==='button'&&!_0x2e9892){if(_0x32f7f2['jPFHg']===_0x32f7f2[_0xf7f81a(0xc9)])return _0x55d465[_0xf7f81a(0xf1)](0xc8)[_0xf7f81a(0xad)](_0xf7f81a(0xc7));else _0x555bc3={'conversationId':_0x49ec6b};}if(typeof _0x3598cd!=_0xf7f81a(0xdc)&&Object[_0xf7f81a(0xed)][_0xf7f81a(0xa5)]['call'](assistantClients,_0x3598cd)){const {openai:_0x2ed914}=await assistantClients[_0x3598cd][_0xf7f81a(0xdd)]({'req':_0x5728e7,'res':_0x55d465});try{if(_0x32f7f2[_0xf7f81a(0xe8)](_0x32f7f2[_0xf7f81a(0xbe)],_0xf7f81a(0xc2)))return _0x1cf654[_0xf7f81a(0xf1)](0x190)[_0xf7f81a(0xb5)]({'error':_0x32f7f2['ZLZHn']});else{const _0x51cc5e=await _0x2ed914[_0xf7f81a(0xee)][_0xf7f81a(0xf0)][_0xf7f81a(0xe6)](_0x3d50f4);logger['debug'](_0xf7f81a(0xe0),_0x51cc5e);}}catch(_0x4932e9){logger[_0xf7f81a(0xa9)](_0xf7f81a(0xa4),_0x4932e9);}}try{const _0x59ab6e=await _0x32f7f2['BQXST'](deleteConvos,_0x5728e7[_0xf7f81a(0xef)]['id'],_0x5b080e);_0x55d465[_0xf7f81a(0xf1)](0xc9)[_0xf7f81a(0xb5)](_0x59ab6e);}catch(_0x30ac0c){logger[_0xf7f81a(0xa9)](_0x32f7f2[_0xf7f81a(0xb2)],_0x30ac0c),_0x55d465[_0xf7f81a(0xf1)](0x1f4)[_0xf7f81a(0xad)](_0x32f7f2[_0xf7f81a(0xb2)]);}}),router[_0x5262d3(0xb1)]('/update',async(_0x2268fc,_0x535d23)=>{const _0xf33310=_0x5262d3,_0x1358de={'UMQii':_0xf33310(0xaf),'ArJog':function(_0x250af4,_0x4dc0a5,_0xf2ba59,_0x52c944){return _0x250af4(_0x4dc0a5,_0xf2ba59,_0x52c944);},'mVwRk':'Error\x20updating\x20conversation'},_0x571a35=_0x2268fc[_0xf33310(0xd5)]['arg'];if(!_0x571a35['conversationId'])return _0x535d23[_0xf33310(0xf1)](0x190)[_0xf33310(0xb5)]({'error':_0x1358de[_0xf33310(0xc1)]});try{const _0xf2c7c6=await _0x1358de[_0xf33310(0xe5)](saveConvo,_0x2268fc,_0x571a35,{'context':'POST\x20/api/convos/update\x20'+_0x571a35[_0xf33310(0xb7)]});_0x535d23['status'](0xc9)['json'](_0xf2c7c6);}catch(_0x579e4a){logger[_0xf33310(0xa9)](_0x1358de['mVwRk'],_0x579e4a),_0x535d23[_0xf33310(0xf1)](0x1f4)[_0xf33310(0xad)](_0xf33310(0xa3));}});function _0x1d44(){const _0xb316d9=['single','HPpCg','delete','Error\x20updating\x20conversation','Error\x20deleting\x20OpenAI\x20thread:','propertyIsEnumerable','2381984uyRvCp','Invalid\x20page\x20size','Error\x20forking\x20conversation','error','1YIOaRh','~/server/services/Endpoints/assistants','Error\x20clearing\x20conversations','send','207263WmZlDW','conversationId\x20is\x20required','~/cache/getLogStores','post','BuQrP','QgChx','CDpxa','json','apfhU','conversationId','aeaya','query','isArray','use','cjlux','file','pmkEq','rOtly','Conversation(s)\x20imported\x20successfully','UMQii','KcuTB','Title\x20not\x20found\x20or\x20method\x20not\x20implemented\x20for\x20the\x20conversation\x27s\x20endpoint','~/server/utils/import/fork','/fork','azureAssistants','No\x20conversationId\x20provided','50qXwBxi','jPFHg','exports','~/server/middleware/requireJwtAuth','express','params','664305gNRpjC','XoRXa','1143MsftgJ','assistants','~/server/routes/files/multer','FEaDz','24520fEMLQl','body','115049sjGlrI','/clear','librechat-data-provider','pageSize','Error\x20processing\x20file','846556moyjpQ','undefined','initializeClient','~/server/middleware','tags','Deleted\x20OpenAI\x20thread:','true','5MCOUOm','~/server/services/Endpoints/azureAssistants','~/server/utils/import','ArJog','del','pageNumber','Gdsbr','/:conversationId','get','hfxLP','5775774SJXaPq','prototype','beta','user','threads','status','ZCKTa','~/config'];_0x1d44=function(){return _0xb316d9;};return _0x1d44();}const {importIpLimiter,importUserLimiter}=createImportLimiters(),upload=multer({'storage':storage,'fileFilter':importFileFilter});router[_0x5262d3(0xb1)]('/import',importIpLimiter,importUserLimiter,upload[_0x5262d3(0xa0)](_0x5262d3(0xbd)),async(_0x3dfa83,_0x47778e)=>{const _0x374046=_0x5262d3;try{await importConversations({'filepath':_0x3dfa83[_0x374046(0xbd)]['path'],'requestUserId':_0x3dfa83[_0x374046(0xef)]['id']}),_0x47778e[_0x374046(0xf1)](0xc9)[_0x374046(0xb5)]({'message':_0x374046(0xc0)});}catch(_0x2bc85f){logger['error'](_0x374046(0xda),_0x2bc85f),_0x47778e[_0x374046(0xf1)](0x1f4)[_0x374046(0xad)](_0x374046(0xda));}}),router[_0x5262d3(0xb1)](_0x5262d3(0xc5),async(_0x11d987,_0x395e4a)=>{const _0x40083a=_0x5262d3,_0x28db75={'HPpCg':function(_0x571efa,_0x5d60c1){return _0x571efa(_0x5d60c1);}};try{const {conversationId:_0x546b2d,messageId:_0x175ca2,option:_0x3f63ce,splitAtTarget:_0x10beaa,latestMessageId:_0x1f906c}=_0x11d987['body'],_0x28a115=await _0x28db75[_0x40083a(0xa1)](forkConversation,{'requestUserId':_0x11d987['user']['id'],'originalConvoId':_0x546b2d,'targetMessageId':_0x175ca2,'latestMessageId':_0x1f906c,'records':!![],'splitAtTarget':_0x10beaa,'option':_0x3f63ce});_0x395e4a[_0x40083a(0xb5)](_0x28a115);}catch(_0x40f81c){logger['error']('Error\x20forking\x20conversation',_0x40f81c),_0x395e4a[_0x40083a(0xf1)](0x1f4)['send'](_0x40083a(0xa8));}}),module[_0x5262d3(0xca)]=router;