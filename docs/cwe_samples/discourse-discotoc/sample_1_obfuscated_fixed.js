function _0x2a7a(_0x346e19,_0x3f66f3){const _0x112009=_0x1120();return _0x2a7a=function(_0x2a7a30,_0x3abcde){_0x2a7a30=_0x2a7a30-0x153;let _0x3a2324=_0x112009[_0x2a7a30];return _0x3a2324;},_0x2a7a(_0x346e19,_0x3f66f3);}function _0x1120(){const _0x343888=['data:','exports','get','CImMX','12813510nGViSy','DXXFF','8aJQkPV','8694329EJQaOp','Ollama','26886475gXIFkt','data','26142shBdAX','files','source','670TnsFrF','3vdBTPu','8676306YSGsbi','OCEww','ollama','IMAGE_URL','1868836Zibtoz','push','http','all','toString','url','1540vzeuTT','height','mYtDj','width','PLbvl','anthropic','local','agents','google','librechat-data-provider','from','~/server/services/Files/strategies','fNypg','generative','lwCbu','image_url','Error\x20fetching\x20image\x20to\x20convert\x20to\x20base64','BaJgp',';base64,','4386ovxkfK','length','Encoding\x20function\x20not\x20implemented\x20for\x20','image_urls','lHGUU','filename','auto','base64','inlineData','~/config','embedded','type','image','has','filepath'];_0x1120=function(){return _0x343888;};return _0x1120();}const _0x458c96=_0x2a7a;(function(_0x215539,_0xc62a6a){const _0x449fc6=_0x2a7a,_0x450d42=_0x215539();while(!![]){try{const _0xb2f230=-parseInt(_0x449fc6(0x15c))/0x1*(parseInt(_0x449fc6(0x17b))/0x2)+parseInt(_0x449fc6(0x15d))/0x3*(-parseInt(_0x449fc6(0x162))/0x4)+parseInt(_0x449fc6(0x168))/0x5*(parseInt(_0x449fc6(0x159))/0x6)+-parseInt(_0x449fc6(0x155))/0x7*(-parseInt(_0x449fc6(0x154))/0x8)+-parseInt(_0x449fc6(0x15e))/0x9+-parseInt(_0x449fc6(0x18e))/0xa+parseInt(_0x449fc6(0x157))/0xb;if(_0xb2f230===_0xc62a6a)break;else _0x450d42['push'](_0x450d42['shift']());}catch(_0x9774f6){_0x450d42['push'](_0x450d42['shift']());}}}(_0x1120,0xce9f4));const axios=require('axios'),{FileSources,VisionModes,ImageDetail,ContentTypes,EModelEndpoint}=require(_0x458c96(0x171)),{getStrategyFunctions}=require(_0x458c96(0x173)),{logger}=require(_0x458c96(0x184));async function fetchImageToBase64(_0x266700){const _0x2fbdb8=_0x458c96,_0x18222c={'HUcbV':'arraybuffer','fNypg':_0x2fbdb8(0x178)};try{const _0x33986b=await axios[_0x2fbdb8(0x18c)](_0x266700,{'responseType':_0x18222c['HUcbV']});return Buffer[_0x2fbdb8(0x172)](_0x33986b[_0x2fbdb8(0x158)])[_0x2fbdb8(0x166)]('base64');}catch(_0x4f2758){logger['error'](_0x18222c[_0x2fbdb8(0x174)],_0x4f2758);throw _0x4f2758;}}const base64Only=new Set([EModelEndpoint[_0x458c96(0x170)],EModelEndpoint[_0x458c96(0x16d)],_0x458c96(0x156),_0x458c96(0x160),EModelEndpoint['bedrock']]);async function encodeAndFormat(_0x238c9f,_0x76199f,_0x51823d,_0x2a5b15){const _0x38b651=_0x458c96,_0x4cd4f2={'DXXFF':function(_0x3d0fd6,_0x3deaaf){return _0x3d0fd6!==_0x3deaaf;},'lHGUU':function(_0x3fec06,_0x5a9236){return _0x3fec06(_0x5a9236);},'lwCbu':function(_0x1e2564,_0x157cfe,_0x3e322a){return _0x1e2564(_0x157cfe,_0x3e322a);},'mYtDj':function(_0x190929,_0x4bd6b6){return _0x190929(_0x4bd6b6);},'HctYW':function(_0x1f24f5,_0x490040,_0x251a99){return _0x1f24f5(_0x490040,_0x251a99);},'BaJgp':function(_0x3cae1a,_0x201ea0){return _0x3cae1a===_0x201ea0;},'CImMX':function(_0x54cb4,_0x757f36){return _0x54cb4===_0x757f36;},'PLbvl':_0x38b651(0x182)},_0x1341ad=[],_0x5b8704={},_0x5499ed={'files':[],'image_urls':[]};if(!_0x76199f||!_0x76199f[_0x38b651(0x17c)])return _0x5499ed;for(let _0x2b62c3 of _0x76199f){if(_0x4cd4f2[_0x38b651(0x153)](_0x38b651(0x15f),_0x38b651(0x15f)))delete _0x2f4109['image_url'],_0x5f6372['inlineData']={'mimeType':_0x4efb23[_0x38b651(0x186)],'data':_0x2399d1};else{const _0x2a4bdd=_0x2b62c3['source']??FileSources['local'];if(!_0x2b62c3['height']){_0x1341ad['push']([_0x2b62c3,null]);continue;}if(!_0x5b8704[_0x2a4bdd]){const {prepareImagePayload:_0x47d2a7}=_0x4cd4f2[_0x38b651(0x17f)](getStrategyFunctions,_0x2a4bdd);if(!_0x47d2a7)throw new Error(_0x38b651(0x17d)+_0x2a4bdd);_0x5b8704[_0x2a4bdd]=_0x47d2a7;}const _0x510cce=_0x5b8704[_0x2a4bdd];if(_0x2a4bdd!==FileSources[_0x38b651(0x16e)]&&base64Only[_0x38b651(0x188)](_0x51823d)){const [_0x773a8d,_0x25e804]=await _0x4cd4f2[_0x38b651(0x176)](_0x510cce,_0x238c9f,_0x2b62c3);_0x1341ad[_0x38b651(0x163)]([_0x773a8d,await _0x4cd4f2[_0x38b651(0x16a)](fetchImageToBase64,_0x25e804)]);continue;}_0x1341ad[_0x38b651(0x163)](_0x4cd4f2['HctYW'](_0x510cce,_0x238c9f,_0x2b62c3));}}const _0x1f270a=_0x238c9f['body']['imageDetail']??ImageDetail[_0x38b651(0x181)],_0x15bab7=await Promise[_0x38b651(0x165)](_0x1341ad);for(const [_0xbdde7c,_0x25b884]of _0x15bab7){const _0x26a0fe={'type':_0xbdde7c[_0x38b651(0x186)],'file_id':_0xbdde7c['file_id'],'filepath':_0xbdde7c[_0x38b651(0x189)],'filename':_0xbdde7c[_0x38b651(0x180)],'embedded':!!_0xbdde7c[_0x38b651(0x185)]};_0xbdde7c[_0x38b651(0x169)]&&_0xbdde7c[_0x38b651(0x16b)]&&(_0x26a0fe['height']=_0xbdde7c[_0x38b651(0x169)],_0x26a0fe[_0x38b651(0x16b)]=_0xbdde7c[_0x38b651(0x16b)]);if(!_0x25b884){_0x5499ed[_0x38b651(0x15a)][_0x38b651(0x163)](_0x26a0fe);continue;}const _0x3891b9={'type':ContentTypes[_0x38b651(0x161)],'image_url':{'url':_0x25b884['startsWith'](_0x38b651(0x164))?_0x25b884:_0x38b651(0x18a)+_0xbdde7c[_0x38b651(0x186)]+_0x38b651(0x17a)+_0x25b884,'detail':_0x1f270a}};if(_0x2a5b15===VisionModes[_0x38b651(0x16f)]){_0x5499ed[_0x38b651(0x17e)]['push'](_0x3891b9),_0x5499ed[_0x38b651(0x15a)][_0x38b651(0x163)](_0x26a0fe);continue;}if(_0x51823d&&_0x51823d===EModelEndpoint['google']&&_0x4cd4f2[_0x38b651(0x179)](_0x2a5b15,VisionModes[_0x38b651(0x175)]))delete _0x3891b9[_0x38b651(0x177)],_0x3891b9[_0x38b651(0x183)]={'mimeType':_0xbdde7c[_0x38b651(0x186)],'data':_0x25b884};else{if(_0x51823d&&_0x51823d===EModelEndpoint[_0x38b651(0x170)])_0x3891b9[_0x38b651(0x177)]=_0x3891b9[_0x38b651(0x177)][_0x38b651(0x167)];else _0x51823d&&_0x4cd4f2[_0x38b651(0x18d)](_0x51823d,EModelEndpoint[_0x38b651(0x16d)])&&(_0x3891b9[_0x38b651(0x186)]=_0x38b651(0x187),_0x3891b9[_0x38b651(0x15b)]={'type':_0x4cd4f2[_0x38b651(0x16c)],'media_type':_0xbdde7c[_0x38b651(0x186)],'data':_0x25b884},delete _0x3891b9['image_url']);}_0x5499ed['image_urls'][_0x38b651(0x163)](_0x3891b9),_0x5499ed['files'][_0x38b651(0x163)](_0x26a0fe);}return _0x5499ed;}module[_0x458c96(0x18b)]={'encodeAndFormat':encodeAndFormat};