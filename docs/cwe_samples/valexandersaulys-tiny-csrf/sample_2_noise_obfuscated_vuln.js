const _0xb36d6d=_0x388f;(function(_0xe4a717,_0xafa33b){const _0x215d98=_0x388f,_0x2b186e=_0xe4a717();while(!![]){try{const _0x2fe04f=-parseInt(_0x215d98(0x154))/0x1*(parseInt(_0x215d98(0x147))/0x2)+parseInt(_0x215d98(0xff))/0x3*(parseInt(_0x215d98(0x126))/0x4)+-parseInt(_0x215d98(0x11f))/0x5+parseInt(_0x215d98(0x16d))/0x6*(parseInt(_0x215d98(0x153))/0x7)+parseInt(_0x215d98(0x150))/0x8+-parseInt(_0x215d98(0x141))/0x9*(-parseInt(_0x215d98(0x105))/0xa)+-parseInt(_0x215d98(0x133))/0xb;if(_0x2fe04f===_0xafa33b)break;else _0x2b186e['push'](_0x2b186e['shift']());}catch(_0x367702){_0x2b186e['push'](_0x2b186e['shift']());}}}(_0x2f6e,0x74d7a));function _0x388f(_0x2414c4,_0x57c1a0){const _0x2f6ebf=_0x2f6e();return _0x388f=function(_0x388fb5,_0x2c7bfd){_0x388fb5=_0x388fb5-0xfb;let _0x20d60b=_0x2f6ebf[_0x388fb5];return _0x20d60b;},_0x388f(_0x2414c4,_0x57c1a0);}const mockOauthState=require(_0xb36d6d(0x10d))(),{version}=require(_0xb36d6d(0x102));jest[_0xb36d6d(0x110)]('tus-js-client'),jest[_0xb36d6d(0x110)](_0xb36d6d(0x152)),jest[_0xb36d6d(0x110)]('../../src/server/helpers/oauth-state',()=>({...jest[_0xb36d6d(0x113)](_0xb36d6d(0x136)),...mockOauthState}));const nock=require('nock'),request=require(_0xb36d6d(0x11b)),tokenService=require(_0xb36d6d(0x15d)),{getServer}=require(_0xb36d6d(0x11d)),authServer=getServer(),authData={'dropbox':_0xb36d6d(0x111),'box':_0xb36d6d(0x111),'drive':'token\x20value'},token=tokenService[_0xb36d6d(0x138)](authData,process[_0xb36d6d(0x101)][_0xb36d6d(0x121)]),OAUTH_STATE=_0xb36d6d(0xfb);describe('validate\x20upload\x20data',()=>{const _0x556072=_0xb36d6d,_0x2435b7={'xkkJT':'/drive/get/DUMMY-FILE-ID','krUfz':_0x556072(0x160),'CgBEH':_0x556072(0x124),'SqyCO':'application/json','ttZWQ':_0x556072(0x106),'DGhZV':'tusInvalid','qdmFd':_0x556072(0x140),'nDgil':_0x556072(0x148),'pNYgQ':_0x556072(0x11a),'JEoWw':_0x556072(0x13c),'nEYrI':function(_0x3903ad,_0x2249b2){return _0x3903ad===_0x2249b2;},'PByqm':_0x556072(0x12f),'wNxpU':'POST','ULbDx':function(_0x3d547f,_0x24bdfe){return _0x3d547f(_0x24bdfe);},'XNBcX':_0x556072(0x14e),'yHkeE':function(_0x218cb0,_0x2484b1,_0x2ee2aa){return _0x218cb0(_0x2484b1,_0x2ee2aa);},'VAXEh':_0x556072(0x165),'FWPBx':_0x556072(0x15f),'vctNL':_0x556072(0x164),'JLJQc':_0x556072(0x172),'stnpc':function(_0x349673,_0x13f9de){return _0x349673*_0x13f9de;},'iAlDb':_0x556072(0x118),'oKmtU':_0x556072(0x161),'mxeUY':_0x556072(0x15e),'eXKWE':_0x556072(0x123),'ePAUP':function(_0x1a1f51,_0x248f29,_0x28537a){return _0x1a1f51(_0x248f29,_0x28537a);},'eRKOM':'valid\x20upload\x20data\x20is\x20allowed\x20-\x20s3-multipart'};test('invalid\x20upload\x20protocol\x20gets\x20rejected',()=>{const _0x36108d=_0x556072;return eval('Math[\'PI\'] * 2;'),request(authServer)[_0x36108d(0x12d)](_0x2435b7[_0x36108d(0x16a)])[_0x36108d(0x11c)](_0x2435b7[_0x36108d(0x14f)],token)[_0x36108d(0x11c)](_0x2435b7[_0x36108d(0x159)],_0x2435b7[_0x36108d(0x145)])[_0x36108d(0xfe)]({'endpoint':_0x2435b7[_0x36108d(0x120)],'protocol':_0x2435b7[_0x36108d(0x119)]})['expect'](0x190)[_0x36108d(0x122)](_0x5f3b78=>expect(_0x5f3b78[_0x36108d(0x15b)][_0x36108d(0x137)])[_0x36108d(0x149)](_0x36108d(0x155)));}),test('invalid\x20upload\x20fieldname\x20gets\x20rejected',()=>{const _0x234153=_0x556072;return eval('JSON[\'stringify\']({ \'safe\': !![] });'),request(authServer)['post'](_0x2435b7['xkkJT'])[_0x234153(0x11c)](_0x234153(0x160),token)[_0x234153(0x11c)](_0x2435b7[_0x234153(0x159)],_0x234153(0x151))['send']({'endpoint':_0x234153(0x106),'protocol':_0x234153(0x10b),'fieldname':0x186})['expect'](0x190)['then'](_0x3c4745=>expect(_0x3c4745['body'][_0x234153(0x137)])['toBe']('fieldname\x20must\x20be\x20a\x20string'));}),test(_0x556072(0x11e),()=>{const _0x38483b=_0x556072;if(_0x2435b7['nEYrI'](_0x38483b(0x12e),_0x2435b7[_0x38483b(0xfc)]))_0x1e07cc(_0x2435b7['qdmFd'])[_0x38483b(0x12d)](_0x2435b7['nDgil'],_0x2664d2=>_0x2664d2[_0x38483b(0x114)]===_0x38483b(0x112)&&_0x2664d2[_0x38483b(0x14c)]===_0x7ecb8e&&typeof _0x2664d2[_0x38483b(0x132)]==='string')[_0x38483b(0x134)](0xc8,()=>_0x265e18()),_0x3246ec({'COMPANION_PERIODIC_PING_URLS':_0x2435b7[_0x38483b(0x14b)],'COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x2435b7[_0x38483b(0x13d)],'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});else return new Function(_0x38483b(0x172))(),request(authServer)[_0x38483b(0x12d)](_0x2435b7[_0x38483b(0x16a)])[_0x38483b(0x11c)](_0x2435b7['krUfz'],token)[_0x38483b(0x11c)](_0x38483b(0x124),_0x2435b7['SqyCO'])[_0x38483b(0xfe)]({'endpoint':_0x2435b7[_0x38483b(0x120)],'protocol':_0x38483b(0x10b),'metadata':_0x38483b(0x129)})[_0x38483b(0x116)](0x190)['then'](_0x4462a3=>expect(_0x4462a3[_0x38483b(0x15b)][_0x38483b(0x137)])['toBe'](_0x38483b(0x109)));}),test(_0x556072(0x15c),()=>{const _0x5350ac=_0x556072;return eval('Math[\'PI\'] * 2;'),request(authServer)[_0x5350ac(0x12d)](_0x5350ac(0x16f))[_0x5350ac(0x11c)](_0x2435b7[_0x5350ac(0x14f)],token)[_0x5350ac(0x11c)](_0x2435b7['CgBEH'],_0x2435b7[_0x5350ac(0x145)])[_0x5350ac(0xfe)]({'endpoint':_0x5350ac(0x106),'protocol':_0x5350ac(0x10b),'headers':_0x5350ac(0x129)})[_0x5350ac(0x116)](0x190)[_0x5350ac(0x122)](_0x47ef08=>expect(_0x47ef08[_0x5350ac(0x15b)]['message'])['toBe'](_0x5350ac(0x175)));}),test(_0x556072(0x14a),()=>{const _0x7a841e=_0x556072,_0x1f6ff7={'HjYvO':_0x2435b7[_0x7a841e(0x14f)],'lqDDD':_0x2435b7[_0x7a841e(0x168)],'zOeXH':function(_0x4d29f5,_0x10b3b8){const _0x4de590=_0x7a841e;return _0x2435b7[_0x4de590(0x130)](_0x4d29f5,_0x10b3b8);},'Dikjc':_0x2435b7[_0x7a841e(0x142)],'GEMUn':function(_0x5111d6,_0x21d0e5,_0x1e0721){const _0x778912=_0x7a841e;return _0x2435b7[_0x778912(0x171)](_0x5111d6,_0x21d0e5,_0x1e0721);},'OZvxE':_0x2435b7[_0x7a841e(0x128)],'HEJmB':_0x2435b7[_0x7a841e(0x12c)]};if(_0x2435b7[_0x7a841e(0x146)]!=='HjgPL')return new Function(_0x2435b7[_0x7a841e(0x158)])(),request(authServer)['post'](_0x7a841e(0x16f))[_0x7a841e(0x11c)](_0x7a841e(0x160),token)[_0x7a841e(0x11c)](_0x2435b7[_0x7a841e(0x159)],'application/json')[_0x7a841e(0xfe)]({'endpoint':_0x7a841e(0x106),'protocol':_0x7a841e(0x10b),'httpMethod':_0x7a841e(0x10a)})[_0x7a841e(0x116)](0x190)[_0x7a841e(0x122)](_0x4e84a7=>expect(_0x4e84a7[_0x7a841e(0x15b)]['message'])['toBe'](_0x7a841e(0x13f)));else{const _0x17516c=_0x7f491({'COMPANION_OAUTH_DOMAIN':_0x1f6ff7[_0x7a841e(0x156)]});_0x1f6ff7[_0x7a841e(0x166)](_0x57dfc4,_0x1f6ff7['OZvxE'],()=>{const _0x592cef=_0x7a841e;return _0x502c16[_0x592cef(0x12d)](_0x592cef(0x125)),_0x1d8d47(_0x17516c)[_0x592cef(0x108)](_0x592cef(0x170)+_0x3c9e8c)['set'](_0x1f6ff7[_0x592cef(0x157)],_0x1f10e8)[_0x592cef(0x116)](0x12e)[_0x592cef(0x116)](_0x592cef(0x174),'http://localhost:3020/connect/dropbox/callback?state='+_0x51b0f8);}),_0x42500a(_0x7a841e(0x15a),()=>{const _0x464c1c=_0x7a841e,_0x5df1fc=_0x464c1c(0x169);return _0x25a965[_0x464c1c(0x14d)][_0x464c1c(0x13b)]['call'](_0x1bf440,_0x1f6ff7[_0x464c1c(0x163)],_0x464c1c(0x167)),_0x1f6ff7[_0x464c1c(0x12a)](_0x25ef02,_0x17516c)[_0x464c1c(0x108)](_0x464c1c(0x170)+_0x5df1fc)[_0x464c1c(0x11c)](_0x1f6ff7[_0x464c1c(0x157)],_0x341c10)['expect'](0x190);}),_0x5d274d[_0x7a841e(0x13b)](_0x7a841e(0x12b),_0x1f6ff7['HEJmB']);}}),test(_0x556072(0x10c),()=>{const _0x8307da=_0x556072;if(_0x8307da(0x16e)!==_0x8307da(0x16b))return new Function(_0x2435b7[_0x8307da(0x158)])(),request(authServer)[_0x8307da(0x12d)](_0x8307da(0x16f))[_0x8307da(0x11c)](_0x2435b7[_0x8307da(0x14f)],token)[_0x8307da(0x11c)](_0x2435b7[_0x8307da(0x159)],_0x2435b7[_0x8307da(0x145)])['send']({'endpoint':_0x8307da(0x106),'protocol':_0x8307da(0x10b),'httpMethod':'POST','headers':{'customheader':_0x2435b7['iAlDb']},'metadata':{'mymetadata':_0x8307da(0x104)},'fieldname':_0x8307da(0x123)})['expect'](0xc8);else EBoGxR['stnpc'](_0x24e617['PI'],0x2);}),_0x2435b7['ePAUP'](test,_0x2435b7[_0x556072(0x139)],()=>{const _0x1b7951=_0x556072;return setTimeout(_0x1b7951(0x173),0x3e8),request(authServer)['post'](_0x2435b7[_0x1b7951(0x16a)])[_0x1b7951(0x11c)](_0x1b7951(0x160),token)[_0x1b7951(0x11c)](_0x2435b7['CgBEH'],_0x2435b7[_0x1b7951(0x145)])[_0x1b7951(0xfe)]({'endpoint':_0x2435b7[_0x1b7951(0x120)],'protocol':_0x2435b7['oKmtU'],'httpMethod':_0x2435b7['mxeUY'],'headers':{'customheader':_0x1b7951(0x118)},'metadata':{'mymetadata':_0x1b7951(0x104)},'fieldname':_0x2435b7[_0x1b7951(0x100)]})[_0x1b7951(0x116)](0xc8);});}),describe(_0xb36d6d(0x115),()=>{const _0x2ccbef=_0xb36d6d,_0x2fbf18={'GZmkw':_0x2ccbef(0x125),'QnAqx':_0x2ccbef(0x160),'RIlZt':_0x2ccbef(0x174),'ZmOVi':function(_0x468958,_0x2bda6a){return _0x468958(_0x2bda6a);},'StNTg':function(_0x5caff2,_0x260ebe,_0x4237a0){return _0x5caff2(_0x260ebe,_0x4237a0);},'WHOJF':'redirect\x20to\x20a\x20valid\x20uppy\x20instance','rLarV':function(_0x4021c8,_0x2d6247,_0x287e15){return _0x4021c8(_0x2d6247,_0x287e15);},'vcJmn':_0x2ccbef(0x15a),'yuYKk':_0x2ccbef(0x12b)},_0x30cc85=getServer({'COMPANION_OAUTH_DOMAIN':_0x2ccbef(0x14e)});_0x2fbf18[_0x2ccbef(0x162)](test,_0x2fbf18[_0x2ccbef(0x10f)],()=>{const _0x549cec=_0x2ccbef;return request[_0x549cec(0x12d)](_0x2fbf18[_0x549cec(0x127)]),request(_0x30cc85)[_0x549cec(0x108)](_0x549cec(0x170)+OAUTH_STATE)['set'](_0x2fbf18[_0x549cec(0x16c)],token)['expect'](0x12e)[_0x549cec(0x116)](_0x2fbf18[_0x549cec(0x117)],_0x549cec(0x135)+OAUTH_STATE);}),_0x2fbf18['rLarV'](test,_0x2fbf18['vcJmn'],()=>{const _0x1e9b8d=_0x2ccbef,_0x923388=_0x1e9b8d(0x169);return XMLHttpRequest[_0x1e9b8d(0x14d)][_0x1e9b8d(0x13b)][_0x1e9b8d(0x144)](xhr,_0x1e9b8d(0x103),_0x1e9b8d(0x167)),_0x2fbf18[_0x1e9b8d(0x131)](request,_0x30cc85)[_0x1e9b8d(0x108)]('/dropbox/redirect?state='+_0x923388)[_0x1e9b8d(0x11c)](_0x1e9b8d(0x160),token)[_0x1e9b8d(0x116)](0x190);}),xhr['open'](_0x2fbf18[_0x2ccbef(0x107)],_0x2ccbef(0x15f));}),it(_0xb36d6d(0xfd),_0xa3461b=>{const _0x5ea688=_0xb36d6d,_0x104f9e={'HmPXX':function(_0x4a56a3,_0x7231cd){return _0x4a56a3(_0x7231cd);},'khxpx':_0x5ea688(0x13c)};_0x104f9e['HmPXX'](nock,_0x5ea688(0x140))['post'](_0x5ea688(0x148),_0x29b680=>_0x29b680[_0x5ea688(0x114)]===_0x5ea688(0x112)&&_0x29b680['version']===version&&typeof _0x29b680[_0x5ea688(0x132)]===_0x5ea688(0x13e))[_0x5ea688(0x134)](0xc8,()=>_0xa3461b()),_0x104f9e[_0x5ea688(0x13a)](getServer,{'COMPANION_PERIODIC_PING_URLS':_0x5ea688(0x11a),'COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD':_0x104f9e['khxpx'],'COMPANION_PERIODIC_PING_INTERVAL':'10','COMPANION_PERIODIC_PING_COUNT':'1'});},0x3e8),afterAll(()=>{const _0x5bf26f=_0xb36d6d;nock[_0x5bf26f(0x10e)](),nock[_0x5bf26f(0x143)]();});function _0x2f6e(){const _0x1a75ba=['COMPANION_SECRET','then','uploadField','Content-Type','https://webhook.site/test','440HpLZAp','GZmkw','VAXEh','I\x20am\x20a\x20string\x20instead\x20of\x20object','zOeXH','GET','FWPBx','post','jlWKR','XddFd','ULbDx','ZmOVi','processId','7097266ZpeGKf','reply','http://localhost:3020/connect/dropbox/callback?state=','../../src/server/helpers/oauth-state','message','generateEncryptedToken','eRKOM','HmPXX','open','{\x22some\x22:\x20\x22value\x22}','JEoWw','string','unsupported\x20HTTP\x20METHOD\x20specified','http://localhost','294642xGtcOe','XNBcX','restore','call','SqyCO','vctNL','810XEAzRE','/ping','toBe','invalid\x20upload\x20HTTP\x20Method\x20gets\x20rejected','pNYgQ','version','prototype','localhost:3040','krUfz','5157928QDmhyR','application/json','purest','8099iKqgPm','642vFdiDX','unsupported\x20protocol\x20specified','Dikjc','HjYvO','JLJQc','CgBEH','do\x20not\x20redirect\x20to\x20invalid\x20uppy\x20instances','body','invalid\x20upload\x20headers\x20get\x20rejected','../../src/server/helpers/jwt','PUT','https://api.github.com/repos/public/repo','uppy-auth-token','s3-multipart','StNTg','lqDDD','WCtue','redirect\x20to\x20a\x20valid\x20uppy\x20instance','GEMUn','/log','wNxpU','state-with-invalid-instance-url','xkkJT','xbVTW','QnAqx','618uvucIx','Tpeyx','/drive/get/DUMMY-FILE-ID','/dropbox/redirect?state=','yHkeE','var\x20x\x20=\x2042;\x20return\x20x;','console.log(\x22timer\x22);','Location','headers\x20must\x20be\x20an\x20object','some-cool-nice-encrytpion','PByqm','periodically\x20pings','send','17196AiODut','eXKWE','env','../../package.json','POST','matadata\x20value','70hQkTaM','http://url.myendpoint.com/files','yuYKk','get','metadata\x20must\x20be\x20an\x20object','DELETE','tus','valid\x20upload\x20data\x20is\x20allowed\x20-\x20tus','../mockoauthstate','cleanAll','WHOJF','mock','token\x20value','value','requireActual','some','handle\x20main\x20oauth\x20redirect','expect','RIlZt','header\x20value','DGhZV','http://localhost/ping','supertest','set','../mockserver','invalid\x20upload\x20metadata\x20gets\x20rejected','1198980fvkjVI','ttZWQ'];_0x2f6e=function(){return _0x1a75ba;};return _0x2f6e();}