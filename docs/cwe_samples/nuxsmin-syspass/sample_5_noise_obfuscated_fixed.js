'use strict';function _0x27b3(_0x70b1cb,_0x5907bd){const _0x56f3dc=_0x56f3();return _0x27b3=function(_0x27b3ec,_0x3f3efe){_0x27b3ec=_0x27b3ec-0x108;let _0x35a60c=_0x56f3dc[_0x27b3ec];return _0x35a60c;},_0x27b3(_0x70b1cb,_0x5907bd);}const _0xbf876f=_0x27b3;(function(_0x7231dd,_0x32f444){const _0x2849c3=_0x27b3,_0x236916=_0x7231dd();while(!![]){try{const _0x1d7a82=-parseInt(_0x2849c3(0x12c))/0x1*(-parseInt(_0x2849c3(0x123))/0x2)+parseInt(_0x2849c3(0x12d))/0x3+-parseInt(_0x2849c3(0x127))/0x4+parseInt(_0x2849c3(0x11c))/0x5+parseInt(_0x2849c3(0x11f))/0x6+-parseInt(_0x2849c3(0x12b))/0x7*(-parseInt(_0x2849c3(0x10d))/0x8)+-parseInt(_0x2849c3(0x110))/0x9;if(_0x1d7a82===_0x32f444)break;else _0x236916['push'](_0x236916['shift']());}catch(_0x42dc1a){_0x236916['push'](_0x236916['shift']());}}}(_0x56f3,0x82dc0));const {test}=require(_0xbf876f(0x118)),assert=require(_0xbf876f(0x121)),{Pool}=require('..'),{createServer}=require('node:http'),{kClients}=require(_0xbf876f(0x134));function _0x56f3(){const _0x285bea=['2900275HpPBGf','text/plain','Pool\x20client\x20count\x20does\x20not\x20grow\x20on\x20repeated\x20connection\x20errors','3162948uGFxDL','All\x20clients\x20should\x20be\x20removed\x20from\x20pool\x20after\x20connectionError\x20events','node:assert','adpTZ','2258KTolig','UND_ERR_CONNECT','end','length','70208zeVRfA','ljxDJ','bBSQn','/after-error','3398906dZNzMW','1MmHeHW','1474005TnAiAc','ECONNREFUSED','CTrHY','origin','cause','/more-','emit','../lib/dispatcher/pool-base','request','abs','Client\x20count\x20should\x20not\x20grow\x20significantly\x20after\x20many\x20failed\x20requests.\x20Start:\x20','ElBJi','TEJRQ','fail','port','8xpqvRm',',\x20End:\x20','close','13785147YvRIhv','iOXaW','Client\x20count\x20should\x20not\x20increase\x20continuously.\x20Counts:\x20','push','strictEqual','HYpjL','GET','Simulated\x20connection\x20error','node:test','http://localhost:','code','max'];_0x56f3=function(){return _0x285bea;};return _0x56f3();}test(_0xbf876f(0x11e),async _0x35f6f7=>{const _0x3f4e8f=_0xbf876f,_0x6572f8={'HYpjL':function(_0xf60e8,_0x5033ad){return _0xf60e8<_0x5033ad;},'CTrHY':_0x3f4e8f(0x12e),'wZFVB':_0x3f4e8f(0x124),'bBSQn':function(_0x3f96da,_0x1117d7){return _0x3f96da-_0x1117d7;},'adpTZ':function(_0x67a119,_0x43b6fa){return _0x67a119<=_0x43b6fa;},'ElBJi':function(_0x2bf378,_0xee99eb){return _0x2bf378<_0xee99eb;}},_0x2e2bf3=new Pool('http://localhost:1',{'connections':0xa,'connectTimeout':0x64,'bodyTimeout':0x64,'headersTimeout':0x64});try{const _0x4a1e50=[];_0x4a1e50['push'](_0x2e2bf3[kClients][_0x3f4e8f(0x126)]);const _0x529a38=0x5;for(let _0x46cf1c=0x0;_0x6572f8[_0x3f4e8f(0x115)](_0x46cf1c,_0x529a38);_0x46cf1c++){try{await _0x2e2bf3[_0x3f4e8f(0x135)]({'path':'/'+_0x46cf1c,'method':'GET'}),assert[_0x3f4e8f(0x10b)]('Request\x20should\x20have\x20failed\x20with\x20a\x20connection\x20error');}catch(_0x39bbad){assert['ok'](_0x39bbad['code']==='ECONNREFUSED'||_0x39bbad[_0x3f4e8f(0x131)]?.[_0x3f4e8f(0x11a)]===_0x6572f8[_0x3f4e8f(0x12f)]||_0x39bbad[_0x3f4e8f(0x11a)]===_0x6572f8['wZFVB'],'Expected\x20connection\x20error\x20but\x20got:\x20'+_0x39bbad['message']+'\x20('+_0x39bbad[_0x3f4e8f(0x11a)]+')');}_0x4a1e50[_0x3f4e8f(0x113)](_0x2e2bf3[kClients][_0x3f4e8f(0x126)]),await new Promise(_0x552d42=>setTimeout(_0x552d42,0xa));}const _0x2c082b=Math[_0x3f4e8f(0x11b)](..._0x4a1e50);assert['ok'](_0x4a1e50[_0x6572f8[_0x3f4e8f(0x129)](_0x4a1e50[_0x3f4e8f(0x126)],0x1)]<=_0x2c082b,_0x3f4e8f(0x112)+_0x4a1e50['join'](',\x20'));const _0x55aab9=_0x4a1e50[_0x4a1e50[_0x3f4e8f(0x126)]-0x1],_0x4ff7fe=_0x4a1e50[_0x4a1e50['length']-0x2];assert['ok'](_0x6572f8[_0x3f4e8f(0x122)](Math[_0x3f4e8f(0x136)](_0x55aab9-_0x4ff7fe),0x1),'Client\x20count\x20should\x20stabilize.\x20Last\x20counts:\x20'+_0x4ff7fe+',\x20'+_0x55aab9);const _0x4b6eb7=0xa,_0x403396=_0x2e2bf3[kClients][_0x3f4e8f(0x126)];for(let _0x38486c=0x0;_0x6572f8[_0x3f4e8f(0x109)](_0x38486c,_0x4b6eb7);_0x38486c++){try{await _0x2e2bf3[_0x3f4e8f(0x135)]({'path':_0x3f4e8f(0x132)+_0x38486c,'method':_0x3f4e8f(0x116)});}catch(_0x592666){}await new Promise(_0x46f0af=>setTimeout(_0x46f0af,0xa));}const _0x2716cf=_0x2e2bf3[kClients][_0x3f4e8f(0x126)],_0x43d5fa=0x3;assert['ok'](_0x2716cf-_0x403396<=_0x43d5fa,_0x3f4e8f(0x108)+_0x403396+_0x3f4e8f(0x10e)+_0x2716cf);}finally{await _0x2e2bf3[_0x3f4e8f(0x10f)]();}}),test('Pool\x20clients\x20are\x20removed\x20on\x20connectionError\x20event',async _0x4eca01=>{const _0x1ca480=_0xbf876f,_0x28c851={'ljxDJ':_0x1ca480(0x116),'iOXaW':'connectionError','PeMUw':_0x1ca480(0x130),'TEJRQ':_0x1ca480(0x12a)},_0x34fcb2=createServer((_0x2da40e,_0x1e5173)=>{const _0x4341bc=_0x1ca480;_0x1e5173['writeHead'](0xc8,{'Content-Type':_0x4341bc(0x11d)}),_0x1e5173[_0x4341bc(0x125)]('ok');});await new Promise(_0x4413a2=>_0x34fcb2['listen'](0x0,_0x4413a2));const _0x57994f=_0x34fcb2['address']()[_0x1ca480(0x10c)],_0x2a453d=new Pool(_0x1ca480(0x119)+_0x57994f,{'connections':0x3});try{await _0x2a453d[_0x1ca480(0x135)]({'path':'/','method':_0x28c851[_0x1ca480(0x128)]});const _0x42dac9=_0x2a453d[kClients][_0x1ca480(0x126)];assert['ok'](_0x42dac9>0x0,'Should\x20have\x20at\x20least\x20one\x20client\x20after\x20a\x20successful\x20request');for(const _0x259e77 of[..._0x2a453d[kClients]]){_0x259e77[_0x1ca480(0x133)](_0x28c851[_0x1ca480(0x111)],_0x28c851['PeMUw'],[_0x259e77],new Error(_0x1ca480(0x117)));}await new Promise(_0x2c6a87=>setTimeout(_0x2c6a87,0x32)),assert[_0x1ca480(0x114)](_0x2a453d[kClients][_0x1ca480(0x126)],0x0,_0x1ca480(0x120)),await _0x2a453d[_0x1ca480(0x135)]({'path':_0x28c851[_0x1ca480(0x10a)],'method':_0x28c851[_0x1ca480(0x128)]}),assert['ok'](_0x2a453d[kClients][_0x1ca480(0x126)]>0x0,'Pool\x20should\x20create\x20new\x20clients\x20after\x20previous\x20ones\x20were\x20removed');}finally{await _0x2a453d['close'](),await new Promise(_0x4922e6=>_0x34fcb2[_0x1ca480(0x10f)](_0x4922e6));}});