'use strict';const _0x56c2d8=_0x2e7d;(function(_0x1f0f7a,_0x2311a9){const _0x2032ae=_0x2e7d,_0x351b35=_0x1f0f7a();while(!![]){try{const _0x3d1094=-parseInt(_0x2032ae(0xcf))/0x1*(-parseInt(_0x2032ae(0xaa))/0x2)+-parseInt(_0x2032ae(0xc3))/0x3*(parseInt(_0x2032ae(0xb8))/0x4)+-parseInt(_0x2032ae(0xdc))/0x5+parseInt(_0x2032ae(0xa9))/0x6*(-parseInt(_0x2032ae(0xa8))/0x7)+-parseInt(_0x2032ae(0xb4))/0x8+-parseInt(_0x2032ae(0xb7))/0x9+parseInt(_0x2032ae(0xd3))/0xa;if(_0x3d1094===_0x2311a9)break;else _0x351b35['push'](_0x351b35['shift']());}catch(_0x233679){_0x351b35['push'](_0x351b35['shift']());}}}(_0x1876,0x28db6));const {test}=require(_0x56c2d8(0xc1)),assert=require(_0x56c2d8(0xb0)),{Pool}=require('..'),{createServer}=require(_0x56c2d8(0xbc)),{kClients}=require(_0x56c2d8(0xd9));function _0x1876(){const _0x1e40fe=['OGUAT','CtLnf','Simulated\x20connection\x20error','emit','GET','../lib/dispatcher/pool-base','CqBBZ','listen','198185hMWjpM','fail','RMIhy','address','ToVWn','FsPRL','strictEqual','WPSIE','cause','1165927HNMagt','6bStHoX','12102EXeZYz',',\x20End:\x20','request','Iuybk','majiW','Expected\x20connection\x20error\x20but\x20got:\x20','node:assert','abs','Client\x20count\x20should\x20not\x20grow\x20significantly\x20after\x20many\x20failed\x20requests.\x20Start:\x20','Pool\x20should\x20create\x20new\x20clients\x20after\x20previous\x20ones\x20were\x20removed','935400bScjbz','message','Pool\x20client\x20count\x20does\x20not\x20grow\x20on\x20repeated\x20connection\x20errors','1280808QHtJGl','332944MwZUzW','Client\x20count\x20should\x20not\x20increase\x20continuously.\x20Counts:\x20','code','pOIEy','node:http','ILpUV','connectionError','qYkmu','gNBWX','node:test','end','12mjbnhA','/after-error','length','TzUeB','port','/more-','push','yUdnR','origin','UND_ERR_CONNECT','ozhwZ','text/plain','44iRhCeM','Pool\x20clients\x20are\x20removed\x20on\x20connectionError\x20event','http://localhost:','close','6994850wkYhjz'];_0x1876=function(){return _0x1e40fe;};return _0x1876();}function _0x2e7d(_0x5d95c0,_0x15552f){const _0x1876dc=_0x1876();return _0x2e7d=function(_0x2e7ddd,_0x123efa){_0x2e7ddd=_0x2e7ddd-0xa1;let _0x1e7599=_0x1876dc[_0x2e7ddd];return _0x1e7599;},_0x2e7d(_0x5d95c0,_0x15552f);}test(_0x56c2d8(0xb6),async _0x421dec=>{const _0x1bcd78=_0x56c2d8,_0x53ae8a={'yUdnR':function(_0x55522a,_0x4f688e){return _0x55522a<_0x4f688e;},'ILpUV':'Request\x20should\x20have\x20failed\x20with\x20a\x20connection\x20error','CtLnf':function(_0x191185,_0x5d4f91){return _0x191185===_0x5d4f91;},'pOIEy':'ECONNREFUSED','jLbes':function(_0x24b389,_0x2e3da3){return _0x24b389===_0x2e3da3;},'TzUeB':_0x1bcd78(0xcc),'gNBWX':function(_0x1d9e6b,_0x12b40d){return _0x1d9e6b<=_0x12b40d;},'CqBBZ':function(_0x374c0,_0x4312f8){return _0x374c0-_0x4312f8;},'majiW':function(_0x2fb618,_0x28be03){return _0x2fb618-_0x28be03;},'FsPRL':function(_0x17d201,_0x237ac4){return _0x17d201-_0x237ac4;},'Iuybk':function(_0x32d5f4,_0x19e02a){return _0x32d5f4<_0x19e02a;},'XZZze':function(_0x59e956,_0x12e07a){return _0x59e956-_0x12e07a;}},_0xcb172c=new Pool('http://localhost:1',{'connections':0xa,'connectTimeout':0x64,'bodyTimeout':0x64,'headersTimeout':0x64});try{const _0x3bdfd0=[];_0x3bdfd0[_0x1bcd78(0xc9)](_0xcb172c[kClients]['length']);const _0x3df13f=0x5;for(let _0x4b605c=0x0;_0x53ae8a[_0x1bcd78(0xca)](_0x4b605c,_0x3df13f);_0x4b605c++){try{await _0xcb172c[_0x1bcd78(0xac)]({'path':'/'+_0x4b605c,'method':_0x1bcd78(0xd8)}),assert[_0x1bcd78(0xdd)](_0x53ae8a[_0x1bcd78(0xbd)]);}catch(_0x363428){assert['ok'](_0x53ae8a[_0x1bcd78(0xd5)](_0x363428['code'],_0x53ae8a['pOIEy'])||_0x53ae8a['jLbes'](_0x363428[_0x1bcd78(0xa7)]?.['code'],_0x53ae8a[_0x1bcd78(0xbb)])||_0x363428['code']===_0x53ae8a[_0x1bcd78(0xc6)],_0x1bcd78(0xaf)+_0x363428[_0x1bcd78(0xb5)]+'\x20('+_0x363428[_0x1bcd78(0xba)]+')');}_0x3bdfd0[_0x1bcd78(0xc9)](_0xcb172c[kClients][_0x1bcd78(0xc5)]),await new Promise(_0x57becd=>setTimeout(_0x57becd,0xa));}const _0xcddb48=Math['max'](..._0x3bdfd0);assert['ok'](_0x53ae8a[_0x1bcd78(0xc0)](_0x3bdfd0[_0x53ae8a[_0x1bcd78(0xda)](_0x3bdfd0[_0x1bcd78(0xc5)],0x1)],_0xcddb48),_0x1bcd78(0xb9)+_0x3bdfd0['join'](',\x20'));const _0x5dc8d8=_0x3bdfd0[_0x53ae8a[_0x1bcd78(0xda)](_0x3bdfd0[_0x1bcd78(0xc5)],0x1)],_0x314025=_0x3bdfd0[_0x53ae8a[_0x1bcd78(0xae)](_0x3bdfd0[_0x1bcd78(0xc5)],0x2)];assert['ok'](_0x53ae8a[_0x1bcd78(0xc0)](Math[_0x1bcd78(0xb1)](_0x53ae8a[_0x1bcd78(0xa4)](_0x5dc8d8,_0x314025)),0x1),'Client\x20count\x20should\x20stabilize.\x20Last\x20counts:\x20'+_0x314025+',\x20'+_0x5dc8d8);const _0x2211f2=0xa,_0x115329=_0xcb172c[kClients][_0x1bcd78(0xc5)];for(let _0x1b5f1f=0x0;_0x53ae8a[_0x1bcd78(0xad)](_0x1b5f1f,_0x2211f2);_0x1b5f1f++){try{await _0xcb172c[_0x1bcd78(0xac)]({'path':_0x1bcd78(0xc8)+_0x1b5f1f,'method':_0x1bcd78(0xd8)});}catch(_0x5bdfad){}await new Promise(_0x3ee2ec=>setTimeout(_0x3ee2ec,0xa));}const _0x1727bb=_0xcb172c[kClients][_0x1bcd78(0xc5)],_0x3babed=0x3;assert['ok'](_0x53ae8a['XZZze'](_0x1727bb,_0x115329)<=_0x3babed,_0x1bcd78(0xb2)+_0x115329+_0x1bcd78(0xab)+_0x1727bb);}finally{await _0xcb172c[_0x1bcd78(0xd2)]();}}),test(_0x56c2d8(0xd0),async _0x10fa7a=>{const _0x443c7f=_0x56c2d8,_0xd27d06={'WPSIE':function(_0x4ffeca,_0x1138d5){return _0x4ffeca(_0x1138d5);},'jZRQN':_0x443c7f(0xd8),'qYkmu':_0x443c7f(0xbe),'RMIhy':_0x443c7f(0xcb),'OGUAT':_0x443c7f(0xd6),'ozhwZ':_0x443c7f(0xc4),'ToVWn':function(_0x2c2d5a,_0x3f7d2a){return _0x2c2d5a>_0x3f7d2a;}},_0x4d2e68=_0xd27d06[_0x443c7f(0xa6)](createServer,(_0x575f23,_0x4a6106)=>{const _0x4d0a6b=_0x443c7f;_0x4a6106['writeHead'](0xc8,{'Content-Type':_0x4d0a6b(0xce)}),_0x4a6106[_0x4d0a6b(0xc2)]('ok');});await new Promise(_0x431431=>_0x4d2e68[_0x443c7f(0xdb)](0x0,_0x431431));const _0x2e0e36=_0x4d2e68[_0x443c7f(0xa2)]()[_0x443c7f(0xc7)],_0x5a54bc=new Pool(_0x443c7f(0xd1)+_0x2e0e36,{'connections':0x3});try{await _0x5a54bc[_0x443c7f(0xac)]({'path':'/','method':_0xd27d06['jZRQN']});const _0x14d142=_0x5a54bc[kClients][_0x443c7f(0xc5)];assert['ok'](_0x14d142>0x0,'Should\x20have\x20at\x20least\x20one\x20client\x20after\x20a\x20successful\x20request');for(const _0x306c64 of[..._0x5a54bc[kClients]]){_0x306c64[_0x443c7f(0xd7)](_0xd27d06[_0x443c7f(0xbf)],_0xd27d06[_0x443c7f(0xa1)],[_0x306c64],new Error(_0xd27d06[_0x443c7f(0xd4)]));}await new Promise(_0xffb016=>setTimeout(_0xffb016,0x32)),assert[_0x443c7f(0xa5)](_0x5a54bc[kClients][_0x443c7f(0xc5)],0x0,'All\x20clients\x20should\x20be\x20removed\x20from\x20pool\x20after\x20connectionError\x20events'),await _0x5a54bc[_0x443c7f(0xac)]({'path':_0xd27d06[_0x443c7f(0xcd)],'method':_0x443c7f(0xd8)}),assert['ok'](_0xd27d06[_0x443c7f(0xa3)](_0x5a54bc[kClients][_0x443c7f(0xc5)],0x0),_0x443c7f(0xb3));}finally{await _0x5a54bc['close'](),await new Promise(_0x5ca77f=>_0x4d2e68['close'](_0x5ca77f));}});