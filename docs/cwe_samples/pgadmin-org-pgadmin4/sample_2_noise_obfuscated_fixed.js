const _0x15fd8b=_0x3377;(function(_0x4629e3,_0x19c8b1){const _0x1189db=_0x3377,_0x305488=_0x4629e3();while(!![]){try{const _0x32cb39=-parseInt(_0x1189db(0xc2))/0x1*(-parseInt(_0x1189db(0x7f))/0x2)+parseInt(_0x1189db(0x91))/0x3*(parseInt(_0x1189db(0x89))/0x4)+parseInt(_0x1189db(0x7e))/0x5+-parseInt(_0x1189db(0x76))/0x6+parseInt(_0x1189db(0xec))/0x7+parseInt(_0x1189db(0x79))/0x8+-parseInt(_0x1189db(0x77))/0x9;if(_0x32cb39===_0x19c8b1)break;else _0x305488['push'](_0x305488['shift']());}catch(_0x5e0dee){_0x305488['push'](_0x305488['shift']());}}}(_0x331f,0xcae54));function _0x331f(){const _0x123bc0=['pHgAf','efUMw','gVgTi','fetchCertificate','OpGMT','DguDr','node-forge','yTZkz','and','CZaYM','throwError','DHvpT','DDbYD','ygQKv','qNUtL','Invalid\x20signature.','oujKS','com.example.insecure.app','toThrow','1234567','readFileSync','path','EIRvg','dyUFZ','6236146SsasGJ','enableInsecureAuth','https://static.gc.apple.com/public-key/gc-prod-4.cer','validateOptions','should\x20verify\x20signature\x20successfully','ETJqH','TmNin','should\x20throw\x20error\x20for\x20invalid\x20options','pUvbu','toBeResolved','YwxML','zaxqf','yEsyI','should\x20throw\x20error\x20for\x20invalid\x20signature\x20verification','should\x20successfully\x20process\x20valid\x20payload\x20and\x20save\x20auth\x20data','should\x20not\x20use\x20bundle\x20id\x20from\x20authData\x20payload\x20in\x20insecure\x20mode','byteOffset','validateAuthData','7181034yXUnHg','24297462NqGgOt','invalidSignature','11447232gGkTNC','QXtMa','lGgKx','aJtGh','uqLBTr9Uex8zCpc1UQ1MIDMitb+HUat2Mah4Kw6AVLSGe0gGNJXlih2i5X+0ZwVY0S9zY2NHWi2gFjmhjt/4kxWGMkupqXX5H/qhE2m7hzox6lZJpH98ZEUbouWRfZX2ZhUlCkAX09oRNi7fI7mWL1/o88MaI/y6k6tLr14JTzmlxgdyhw+QRLxRPA6NuvUlRSJpyJ4aGtNH5/wHdKQWL8nUnFYiYmaY8R7IjzNxPfy8UJTUWmeZvMSgND4u8EjADPsz7ZtZyWAPi8kYcAb6M8k0jwLD3vrYCB8XXyO2RQb/FY2TM4zJuI7PzLlvvgOJXbbfVtHx7Evnm5NYoyzgzw==','330520CQndcL','95386ipJGIJ','certificateFromPem','eysTB','XIZvR','getAppleCertificate','Test\x20payload\x20fails\x20due\x20to\x20incorrect\x20appId\x20/\x20certificate','YbVpU','tuulO','uuRPM','resolve','147484VVsTcD','slice','MZvTs','invalid-key','GameCenterAuth\x20Adapter','https://cacerts.digicert.com/DigiCertTrustedG4CodeSigningRSA4096SHA3842021CA1.crt.pem','GET','should\x20validate\x20options\x20successfully\x20with\x20valid\x20parameters','105nPKXUs','DAfUL','qUDvE','oAgYe','publicKeyUrl','YCfoL','stringify','iSNdh','Test\x20config\x20failing\x20due\x20to\x20missing\x20params\x20or\x20wrong\x20types','Dhmhp','should\x20fetch\x20and\x20validate\x20Apple\x20certificate','DzqqrQ==','NwYmW','klkGK','Test\x20payload\x20failing\x20due\x20to\x20missing\x20params\x20or\x20wrong\x20types','../../../lib/Adapters/Auth/gcenter','ZBbbR','wqkPX','Invalid\x20publicKeyUrl:\x20https://malicious.url.com/key.cer','should\x20throw\x20error\x20for\x20invalid\x20publicKeyUrl','OgkYM','clKvO','validKey','cHjWS','constructor','not','OPCpN','cFZRW','toBe','cloud.xtralife.gamecenterauth','FsYti','oxeDX','can\x20\x20use\x20bundle\x20id\x20from\x20authData\x20payload\x20in\x20insecure\x20mode','content-type','returnValue','mockCertificate','G:1965586982','../../support/cert/DigiCertTrustedG4CodeSigningRSA4096SHA3842021CA1.crt.pem','should\x20throw\x20error\x20for\x20missing\x20authData\x20fields','Test\x20payload\x20passing','SBHGB','buffer','content-length','WUKJI','RCgxt','oyyBU','verifyPublicKeyIssuer','com.valid.app','Certificate\x20and\x20Signature\x20Validation','22anSBsZ','HBVPS','eaeuY','nWLoj','toBeRejectedWithError','KhfGj','length','verifySignature','withContext','KVqCv','lLYwY','toString','should\x20not\x20use\x20bundle\x20id\x20from\x20authData\x20payload\x20in\x20secure\x20mode','mcNdC','bundleId','aFTMB','CAmFy','../../support/cert/gc-prod-4.cer'];_0x331f=function(){return _0x123bc0;};return _0x331f();}const GameCenterAuth=require(_0x15fd8b(0xa0))['default'],{pki}=require(_0x15fd8b(0xda)),fs=require('fs'),path=require(_0x15fd8b(0xe9));function _0x3377(_0x564873,_0x47dd19){const _0x331f60=_0x331f();return _0x3377=function(_0x33775e,_0x1d8217){_0x33775e=_0x33775e-0x6a;let _0x5365c2=_0x331f60[_0x33775e];return _0x5365c2;},_0x3377(_0x564873,_0x47dd19);}describe(_0x15fd8b(0x8d),function(){const _0x12e237=_0x15fd8b,_0x18f1db={'FykKt':_0x12e237(0xb6),'YwxML':_0x12e237(0xee),'Dhmhp':_0x12e237(0xbb),'DAfUL':_0x12e237(0xc0),'WUKJI':function(_0x45bc08,_0x20e32d){return _0x45bc08!==_0x20e32d;},'clKvO':function(_0x5b6104,_0x5528dd){return _0x5b6104(_0x5528dd);},'oxeDX':'AuthData\x20id\x20is\x20missing.','mcNdC':'https://malicious.url.com/key.cer','eysTB':function(_0x5633c3,_0x1b4709,_0x3f52a3){return _0x5633c3(_0x1b4709,_0x3f52a3);},'klkGK':_0x12e237(0xd7),'DHvpT':'Invalid\x20publicKeyUrl','wiPWV':function(_0xb9aec7,_0x343377){return _0xb9aec7(_0x343377);},'dyUFZ':_0x12e237(0x8c),'pHgAf':_0x12e237(0x78),'OpGMT':_0x12e237(0x83),'yEsyI':function(_0x29bff2,_0x252ab9,_0x4f7141){return _0x29bff2(_0x252ab9,_0x4f7141);},'cFZRW':_0x12e237(0xc9),'tuulO':_0x12e237(0xe3),'zaxqf':function(_0x42be28,_0x18a406,_0x5a29a2){return _0x42be28(_0x18a406,_0x5a29a2);},'efUMw':_0x12e237(0x72),'ETJqH':function(_0x5815ad,_0x40ce3f,_0x4bc9d3){return _0x5815ad(_0x40ce3f,_0x4bc9d3);},'KhfGj':_0x12e237(0x80),'FsYti':function(_0x175242,_0x1f0daf){return _0x175242===_0x1f0daf;},'oAgYe':_0x12e237(0x6a),'aJtGh':_0x12e237(0xb5),'ZBbbR':_0x12e237(0x7d),'aFTMB':_0x12e237(0xae),'pUvbu':function(_0xc4ca21,_0x2765a3,_0x556bef){return _0xc4ca21(_0x2765a3,_0x556bef);},'YCfoL':function(_0x202ec2,_0x330238){return _0x202ec2(_0x330238);},'eaeuY':_0x12e237(0x93),'DguDr':_0x12e237(0x9c),'XIZvR':_0x12e237(0xbf),'EIRvg':function(_0x5b99db,_0x4920cd){return _0x5b99db(_0x4920cd);},'tPKjN':function(_0x19deaa,_0x33f6fe,_0xc463ad){return _0x19deaa(_0x33f6fe,_0xc463ad);},'oyyBU':_0x12e237(0x9b),'cHjWS':_0x12e237(0x73),'HnJIf':_0x12e237(0xb1),'QXtMa':function(_0x5d153d,_0x346cc4,_0x419ace){return _0x5d153d(_0x346cc4,_0x419ace);},'iSNdh':_0x12e237(0x84),'oujKS':function(_0x597f95,_0x64e0ad,_0xbbd37d){return _0x597f95(_0x64e0ad,_0xbbd37d);}};let _0x46c6ac;beforeEach(function(){const _0x18380d=_0x12e237;_0x46c6ac=new GameCenterAuth[(_0x18380d(0xa9))]();const _0x45541e=fs[_0x18380d(0xe8)](path[_0x18380d(0x88)](__dirname,_0x18380d(0xd3))),_0x413cd8=fs['readFileSync'](path[_0x18380d(0x88)](__dirname,_0x18f1db['FykKt']))[_0x18380d(0xcd)]();mockFetch([{'url':_0x18f1db['YwxML'],'method':_0x18380d(0x8f),'response':{'ok':!![],'headers':new Map(),'arrayBuffer':()=>Promise['resolve'](_0x45541e[_0x18380d(0xba)][_0x18380d(0x8a)](_0x45541e[_0x18380d(0x74)],_0x45541e[_0x18380d(0x74)]+_0x45541e[_0x18380d(0xc8)]))}},{'url':_0x18380d(0x8e),'method':_0x18380d(0x8f),'response':{'ok':!![],'headers':new Map([[_0x18380d(0xb2),'application/x-pem-file'],[_0x18f1db[_0x18380d(0x9a)],_0x413cd8[_0x18380d(0xc8)][_0x18380d(0xcd)]()]]),'text':()=>Promise[_0x18380d(0x88)](_0x413cd8)}}]);}),describe(_0x12e237(0x99),function(){const _0x26dafd=_0x12e237,_0x45e930={'yTZkz':_0x18f1db[_0x26dafd(0x92)],'nWLoj':function(_0x13aa17,_0x574d50){const _0x59f221=_0x26dafd;return _0x18f1db[_0x59f221(0xbc)](_0x13aa17,_0x574d50);},'ygQKv':_0x26dafd(0xbd),'CAmFy':'tRpOu','qNUtL':function(_0x38d3d2,_0x8e368d){return _0x38d3d2(_0x8e368d);}};if(_0x26dafd(0xc3)!=='qNeHm')it('should\x20throw\x20error\x20for\x20invalid\x20options',async function(){const _0x596597=_0x26dafd;if(_0x45e930[_0x596597(0xc5)](_0x45e930[_0x596597(0xe1)],_0x45e930[_0x596597(0xd2)])){const _0x172905=[null,undefined,{},{'bundleId':''},{'enableInsecureAuth':![]}];for(const _0x279a42 of _0x172905){_0x45e930[_0x596597(0xe2)](expect,()=>_0x46c6ac['validateOptions'](_0x279a42))[_0x596597(0xca)](JSON[_0x596597(0x97)](_0x279a42))[_0x596597(0xe6)]();}}else{const _0xab6b5e={'bundleId':_0x45e930[_0x596597(0xdb)],'enableInsecureAuth':![]};_0x143c57(()=>_0x28d77a['validateOptions'](_0xab6b5e))[_0x596597(0xaa)][_0x596597(0xe6)]();}}),it('should\x20validate\x20options\x20successfully\x20with\x20valid\x20parameters',function(){const _0x177c02=_0x26dafd,_0x100ba7={'bundleId':_0x177c02(0xc0),'enableInsecureAuth':![]};expect(()=>_0x46c6ac[_0x177c02(0xef)](_0x100ba7))[_0x177c02(0xaa)]['toThrow']();});else{const _0x30ebc4=[null,_0x50c5e6,{},{'bundleId':''},{'enableInsecureAuth':![]}];for(const _0x3112f8 of _0x30ebc4){_0x45e930[_0x26dafd(0xe2)](_0x2f49e1,()=>_0xc17f92[_0x26dafd(0xef)](_0x3112f8))[_0x26dafd(0xca)](_0x31d704[_0x26dafd(0x97)](_0x3112f8))[_0x26dafd(0xe6)]();}}}),_0x18f1db[_0x12e237(0x7a)](describe,_0x12e237(0x9f),function(){const _0x523591=_0x12e237;it(_0x523591(0xb7),async function(){const _0x31ea7d=_0x523591;await _0x18f1db[_0x31ea7d(0xa6)](expectAsync,_0x46c6ac[_0x31ea7d(0x75)]({}))[_0x31ea7d(0xc6)](_0x18f1db[_0x31ea7d(0xb0)]);});}),describe(_0x18f1db[_0x12e237(0x98)],function(){const _0x324acf=_0x12e237;it(_0x324acf(0xa4),async function(){const _0x56204d=_0x324acf,_0x23a201=_0x18f1db[_0x56204d(0xcf)];_0x18f1db[_0x56204d(0x81)](spyOn,_0x46c6ac,_0x18f1db[_0x56204d(0x9e)])[_0x56204d(0xdc)]['throwError'](new Error(_0x18f1db[_0x56204d(0xdf)])),await _0x18f1db['wiPWV'](expectAsync,_0x46c6ac['getAppleCertificate'](_0x23a201))['toBeRejectedWithError'](_0x56204d(0xa3));}),_0x18f1db[_0x324acf(0x70)](it,_0x324acf(0x71),async function(){const _0x5c14d3=_0x324acf,_0x53fc5e=_0x18f1db[_0x5c14d3(0xeb)],_0x4404f0={'id':_0x5c14d3(0xe7),'publicKeyUrl':_0x5c14d3(0xee),'timestamp':0x154294754f7,'salt':'saltST==','signature':_0x18f1db[_0x5c14d3(0xd4)]};spyOn(_0x46c6ac,_0x18f1db[_0x5c14d3(0xd8)])[_0x5c14d3(0xdc)][_0x5c14d3(0xb3)](Promise[_0x5c14d3(0x88)](_0x53fc5e)),_0x18f1db['yEsyI'](spyOn,_0x46c6ac,_0x18f1db[_0x5c14d3(0xac)])[_0x5c14d3(0xdc)][_0x5c14d3(0xde)](_0x18f1db[_0x5c14d3(0x86)]),await expectAsync(_0x46c6ac[_0x5c14d3(0x75)](_0x4404f0))[_0x5c14d3(0xc6)](_0x5c14d3(0xe3));});}),_0x18f1db[_0x12e237(0xe4)](describe,_0x12e237(0xb8),function(){const _0x1af811=_0x12e237,_0x105d13={'KVqCv':_0x1af811(0xe7),'lGgKx':_0x18f1db[_0x1af811(0x6e)],'lLYwY':'validSignature','wqkPX':_0x1af811(0xc0),'YbVpU':function(_0x405ed2,_0x5bc66d,_0x3c528e){return _0x405ed2(_0x5bc66d,_0x3c528e);},'MZvTs':_0x1af811(0x83),'CZaYM':function(_0xaf0b23,_0x535853,_0x1e26f1){const _0x422892=_0x1af811;return _0x18f1db[_0x422892(0x70)](_0xaf0b23,_0x535853,_0x1e26f1);},'uuRPM':_0x1af811(0xc9),'SBHGB':function(_0x1395e2,_0x35e2cb){return _0x1395e2(_0x35e2cb);}};_0x18f1db[_0x1af811(0x6f)](it,_0x18f1db[_0x1af811(0xd5)],async function(){const _0x49b946=_0x1af811,_0x22e9f5={'id':_0x105d13[_0x49b946(0xcb)],'publicKeyUrl':_0x105d13[_0x49b946(0x7b)],'timestamp':0x154294754f7,'salt':'saltST==','signature':_0x105d13[_0x49b946(0xcc)],'bundleId':_0x105d13[_0x49b946(0xa2)]};_0x105d13[_0x49b946(0x85)](spyOn,_0x46c6ac,_0x105d13[_0x49b946(0x8b)])[_0x49b946(0xdc)]['returnValue'](Promise[_0x49b946(0x88)](_0x49b946(0xa7))),_0x105d13[_0x49b946(0xdd)](spyOn,_0x46c6ac,_0x105d13[_0x49b946(0x87)])['and'][_0x49b946(0xb3)](!![]),await _0x105d13[_0x49b946(0xb9)](expectAsync,_0x46c6ac[_0x49b946(0x75)](_0x22e9f5))[_0x49b946(0x6d)]();});}),describe(_0x12e237(0xc1),function(){const _0x2fe003=_0x12e237,_0x2f307e={'gVgTi':_0x2fe003(0x6b),'OgkYM':_0x18f1db[_0x2fe003(0xd9)],'iMjmI':_0x2fe003(0xae),'OPCpN':_0x2fe003(0xbf),'NwYmW':function(_0x4e308c,_0xdc9def){const _0x52305e=_0x2fe003;return _0x18f1db[_0x52305e(0xea)](_0x4e308c,_0xdc9def);}};_0x18f1db['tPKjN'](it,_0x18f1db[_0x2fe003(0xbe)],async function(){const _0x3415c9=_0x2fe003,_0x1e813c=_0x3415c9(0xee),_0x19db41=_0x3415c9(0xb4);spyOn(_0x46c6ac,_0x3415c9(0xd7))[_0x3415c9(0xdc)][_0x3415c9(0xb3)](Promise['resolve']({'certificate':_0x19db41,'headers':new Map()})),_0x18f1db[_0x3415c9(0xf1)](spyOn,pki,_0x18f1db[_0x3415c9(0xc7)])['and'][_0x3415c9(0xb3)]({}),_0x46c6ac['cache'][_0x1e813c]=_0x19db41;const _0x1b0425=await _0x46c6ac[_0x3415c9(0x83)](_0x1e813c);expect(_0x1b0425)[_0x3415c9(0xad)](_0x19db41);}),it(_0x2fe003(0xf0),async function(){const _0x12816b=_0x2fe003,_0x33c89f={'RCsHs':_0x12816b(0xc0)};if(_0x18f1db[_0x12816b(0xaf)]('GezTv',_0x18f1db[_0x12816b(0x94)])){const _0x7d6522={'DDbYD':function(_0x39bacd,_0x4adc3f){return _0x39bacd(_0x4adc3f);}};_0x41b0b0(_0x2f307e[_0x12816b(0xd6)],async function(){const _0x31cd47=_0x12816b,_0x417ab7=[null,_0x372d92,{},{'bundleId':''},{'enableInsecureAuth':![]}];for(const _0x1a940e of _0x417ab7){_0x7d6522[_0x31cd47(0xe0)](_0x1bbb6e,()=>_0x1b2676[_0x31cd47(0xef)](_0x1a940e))['withContext'](_0x4862f5[_0x31cd47(0x97)](_0x1a940e))[_0x31cd47(0xe6)]();}}),_0x56d764(_0x12816b(0x90),function(){const _0x18eddc=_0x12816b,_0x201172={'bundleId':_0x33c89f['RCsHs'],'enableInsecureAuth':![]};_0x42483d(()=>_0x5011e2['validateOptions'](_0x201172))[_0x18eddc(0xaa)][_0x18eddc(0xe6)]();});}else{const _0x2daa3e={'id':_0x18f1db[_0x12816b(0x7c)],'publicKeyUrl':_0x12816b(0xee),'timestamp':0x16c7096de77,'signature':_0x18f1db['ZBbbR'],'salt':_0x12816b(0x9c)};_0x46c6ac[_0x12816b(0xd0)]=_0x18f1db[_0x12816b(0xd1)],_0x46c6ac[_0x12816b(0xed)]=![],_0x18f1db[_0x12816b(0x6c)](spyOn,_0x46c6ac,_0x12816b(0xbf))[_0x12816b(0xdc)][_0x12816b(0xb3)]();const _0x34942a=await _0x46c6ac[_0x12816b(0x83)](_0x2daa3e[_0x12816b(0x95)]);_0x18f1db[_0x12816b(0x96)](expect,()=>_0x46c6ac[_0x12816b(0xc9)](_0x34942a,_0x2daa3e))[_0x12816b(0xaa)][_0x12816b(0xe6)]();}}),it(_0x2fe003(0xce),async function(){const _0x2b61ed=_0x2fe003,_0xfa54f9={'KdeCi':function(_0x473c18,_0xed081c){return _0x473c18(_0xed081c);}};if(_0x18f1db[_0x2b61ed(0xc4)]===_0x18f1db['eaeuY']){const _0x16b47d={'id':_0x2b61ed(0xb5),'publicKeyUrl':_0x18f1db[_0x2b61ed(0x6e)],'timestamp':0x16c7096de77,'signature':_0x18f1db['ZBbbR'],'salt':_0x18f1db[_0x2b61ed(0xd9)],'bundleId':_0x2b61ed(0xe5)};_0x46c6ac[_0x2b61ed(0xd0)]=_0x18f1db[_0x2b61ed(0xd1)],_0x46c6ac[_0x2b61ed(0xed)]=![],spyOn(_0x46c6ac,_0x18f1db[_0x2b61ed(0x82)])[_0x2b61ed(0xdc)][_0x2b61ed(0xb3)]();const _0x542afe=await _0x46c6ac[_0x2b61ed(0x83)](_0x16b47d[_0x2b61ed(0x95)]);_0x18f1db[_0x2b61ed(0x96)](expect,()=>_0x46c6ac[_0x2b61ed(0xc9)](_0x542afe,_0x16b47d))[_0x2b61ed(0xaa)][_0x2b61ed(0xe6)]();}else _0xfa54f9['KdeCi'](_0x29a428,()=>_0x1dbcce['validateOptions'](_0xe59579))['withContext'](_0x5835d8['stringify'](_0x4fe79b))[_0x2b61ed(0xe6)]();}),it(_0x18f1db[_0x2fe003(0xa8)],async function(){const _0x4a9994=_0x2fe003,_0x2f6645={'id':_0x4a9994(0xb5),'publicKeyUrl':_0x4a9994(0xee),'timestamp':0x16c7096de77,'signature':_0x4a9994(0x7d),'salt':_0x2f307e[_0x4a9994(0xa5)],'bundleId':'com.example.insecure.app'};_0x46c6ac[_0x4a9994(0xd0)]=_0x2f307e['iMjmI'],_0x46c6ac[_0x4a9994(0xed)]=!![],spyOn(_0x46c6ac,_0x2f307e[_0x4a9994(0xab)])[_0x4a9994(0xdc)]['returnValue']();const _0x47b523=await _0x46c6ac['getAppleCertificate'](_0x2f6645[_0x4a9994(0x95)]);_0x2f307e[_0x4a9994(0x9d)](expect,()=>_0x46c6ac[_0x4a9994(0xc9)](_0x47b523,_0x2f6645))['not']['toThrow']();}),_0x18f1db[_0x2fe003(0x6c)](it,_0x18f1db['HnJIf'],async function(){const _0x2f1c69=_0x2fe003,_0x2f23a1={'id':_0x2f1c69(0xb5),'publicKeyUrl':_0x18f1db['YwxML'],'timestamp':0x16c7096de77,'signature':_0x18f1db[_0x2f1c69(0xa1)],'salt':_0x18f1db[_0x2f1c69(0xd9)],'bundleId':_0x2f1c69(0xae)};_0x46c6ac[_0x2f1c69(0xed)]=!![],spyOn(_0x46c6ac,_0x18f1db[_0x2f1c69(0x82)])['and'][_0x2f1c69(0xb3)]();const _0x3ab7d4=await _0x46c6ac['getAppleCertificate'](_0x2f23a1[_0x2f1c69(0x95)]);expect(()=>_0x46c6ac[_0x2f1c69(0xc9)](_0x3ab7d4,_0x2f23a1))[_0x2f1c69(0xaa)][_0x2f1c69(0xe6)]();});});});