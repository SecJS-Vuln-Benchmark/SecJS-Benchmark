function _0x35a4(){const _0x58bcc3=['format','discount','LKiIl','RjzIs','xLpMl','eapVY','3735645xxzXcY','products','Successfully\x20saved','csrf-token','znODM','27861940fgkBjq','some_bogus_code','/admin/settings/discount/create','moment','sessions','deepEqual','set','/admin/settings/discount/update','nnDEk','[Fail]\x20Add\x20a\x20future\x20discount\x20code','post','avoBY','iqfeQ','_id','deleteMany','expect','1392bvqAGY','TEST_CODE_1','CTgoQ','request','value','mIhSF','TEST_CODE_99','tByfS','[Success]\x20Add\x20valid\x20amount\x20discount','MSZjU','26684QvvQYl','ZEphs','/checkout/adddiscountcode','uzRnN','gJfSp','2008395pEgmUR','body','25911NkkYwZ','ZUHdQ','totalCartAmount','/product/addtocart','toArray','iHmUc','apiKey','[Fail]\x20Create\x20a\x20new\x20discount\x20code\x20with\x20existing\x20code','24IVBPHC','nuQnL','Discount\x20code\x20already\x20exists','KZABF','[Success]\x20Add\x20valid\x20percent\x20discount','Discount\x20is\x20expired','TEST_CODE_5','[Fail]\x20Create\x20a\x20new\x20discount\x20code\x20with\x20invalid\x20type','totalCartDiscount','productOptions','tWKVK','gSAnT','code','LyLLT','Discount\x20code\x20created\x20successfully','PwgXf','DutoO','YuIpH','WCird','IZbfx','468054HoSGli','csrf','message','add','find','OBFiD','Discount\x20code\x20applied','TJYEv','fail','stringify','valid_10_amount_code','[Success]\x20Create\x20a\x20new\x20discount\x20code','[Success]\x20Update\x20a\x20discount\x20code','length','zlLOk','757977CUPlzF','discountCode','YRXrP','292fQmipz','discounts','ZMJPj','days','send','qqrxz','DD/MM/YYYY\x20HH:mm','productPrice','users','bogus_type','amount','../helper','DKSCG'];_0x35a4=function(){return _0x58bcc3;};return _0x35a4();}function _0x17b2(_0x1c2bde,_0x339712){const _0x35a486=_0x35a4();return _0x17b2=function(_0x17b2f0,_0x144e14){_0x17b2f0=_0x17b2f0-0x1e7;let _0xf1182d=_0x35a486[_0x17b2f0];return _0xf1182d;},_0x17b2(_0x1c2bde,_0x339712);}const _0x5dc5d9=_0x17b2;(function(_0x29e261,_0x177301){const _0x51a67e=_0x17b2,_0x3047bc=_0x29e261();while(!![]){try{const _0x3d8e13=-parseInt(_0x51a67e(0x227))/0x1+-parseInt(_0x51a67e(0x218))/0x2+parseInt(_0x51a67e(0x1fc))/0x3*(-parseInt(_0x51a67e(0x22a))/0x4)+-parseInt(_0x51a67e(0x23d))/0x5+parseInt(_0x51a67e(0x1eb))/0x6*(parseInt(_0x51a67e(0x1f5))/0x7)+parseInt(_0x51a67e(0x204))/0x8*(-parseInt(_0x51a67e(0x1fa))/0x9)+parseInt(_0x51a67e(0x242))/0xa;if(_0x3d8e13===_0x177301)break;else _0x3047bc['push'](_0x3047bc['shift']());}catch(_0x4728de){_0x3047bc['push'](_0x3047bc['shift']());}}}(_0x35a4,0x9a2b7));import{serial as _0x58c748}from'ava';const {runBefore,g}=require(_0x5dc5d9(0x235)),moment=require(_0x5dc5d9(0x245));_0x58c748['before'](async()=>{await runBefore();}),_0x58c748(_0x5dc5d9(0x1f3),async _0x4a1f84=>{const _0x9e2339=_0x5dc5d9,_0x81d580={'nnDEk':_0x9e2339(0x1f7),'tByfS':_0x9e2339(0x21e),'tWKVK':function(_0x503221,_0x3403a2){return _0x503221-_0x3403a2;}};await g['db']['sessions'][_0x9e2339(0x1e9)]({},{}),await g[_0x9e2339(0x1ee)]['post'](_0x9e2339(0x1ff))['send']({'productId':g[_0x9e2339(0x23e)][0x0][_0x9e2339(0x1e8)],'productQuantity':0x1,'productOptions':JSON[_0x9e2339(0x221)](g[_0x9e2339(0x23e)][0x0][_0x9e2339(0x20d)])})[_0x9e2339(0x1ea)](0xc8);const _0x3be498=await g['request']['post'](_0x81d580[_0x9e2339(0x24a)])[_0x9e2339(0x22e)]({'discountCode':g[_0x9e2339(0x22b)][0x0][_0x9e2339(0x210)]})[_0x9e2339(0x1ea)](0xc8);_0x4a1f84[_0x9e2339(0x247)](_0x3be498['body']['message'],_0x81d580[_0x9e2339(0x1f2)]);const _0x1d9aa3=await g['db'][_0x9e2339(0x246)]['find']({})[_0x9e2339(0x200)]();(!_0x1d9aa3||_0x1d9aa3[_0x9e2339(0x225)]===0x0)&&_0x4a1f84['fail']();const _0x239469=g[_0x9e2339(0x23e)][0x0][_0x9e2339(0x231)]*0x1,_0x42d08d=_0x1d9aa3[0x0]['session'];_0x4a1f84['deepEqual'](_0x42d08d['discountCode'],g[_0x9e2339(0x22b)][0x0][_0x9e2339(0x210)]),_0x4a1f84[_0x9e2339(0x247)](_0x42d08d['totalCartDiscount'],g[_0x9e2339(0x22b)][0x0][_0x9e2339(0x1ef)]),_0x4a1f84[_0x9e2339(0x247)](_0x42d08d[_0x9e2339(0x1fe)],_0x81d580[_0x9e2339(0x20e)](_0x239469,g[_0x9e2339(0x22b)][0x0]['value']));}),_0x58c748(_0x5dc5d9(0x208),async _0x24f83b=>{const _0x5afeca=_0x5dc5d9,_0x143e36={'WCird':_0x5afeca(0x1ff),'CTgoQ':'/checkout/adddiscountcode','ZMJPj':_0x5afeca(0x21e),'znODM':function(_0x50f754,_0x5a798d){return _0x50f754*_0x5a798d;},'KZABF':function(_0x5ab544,_0x44766b){return _0x5ab544*_0x44766b;}};await g['db']['sessions']['deleteMany']({},{}),await g[_0x5afeca(0x1ee)]['post'](_0x143e36[_0x5afeca(0x216)])[_0x5afeca(0x22e)]({'productId':g['products'][0x0][_0x5afeca(0x1e8)],'productQuantity':0x1,'productOptions':JSON[_0x5afeca(0x221)](g['products'][0x0]['productOptions'])})['expect'](0xc8);const _0x2b65fb=await g['request']['post'](_0x143e36[_0x5afeca(0x1ed)])[_0x5afeca(0x22e)]({'discountCode':g[_0x5afeca(0x22b)][0x1]['code']})[_0x5afeca(0x1ea)](0xc8);_0x24f83b[_0x5afeca(0x247)](_0x2b65fb[_0x5afeca(0x1fb)][_0x5afeca(0x21a)],_0x143e36[_0x5afeca(0x22c)]);const _0xa5b14b=await g['db'][_0x5afeca(0x246)][_0x5afeca(0x21c)]({})[_0x5afeca(0x200)]();(!_0xa5b14b||_0xa5b14b['length']===0x0)&&_0x24f83b[_0x5afeca(0x220)]();const _0x21a9c8=_0x143e36[_0x5afeca(0x241)](g['products'][0x0]['productPrice'],0x1),_0x510a91=_0x143e36[_0x5afeca(0x207)](g[_0x5afeca(0x22b)][0x1][_0x5afeca(0x1ef)]/0x64,_0x21a9c8),_0x150947=_0xa5b14b[0x0]['session'];_0x24f83b[_0x5afeca(0x247)](_0x150947[_0x5afeca(0x228)],g[_0x5afeca(0x22b)][0x1][_0x5afeca(0x210)]),_0x24f83b['deepEqual'](_0x150947[_0x5afeca(0x1fe)],_0x21a9c8-_0x510a91),_0x24f83b[_0x5afeca(0x247)](_0x150947[_0x5afeca(0x20c)],_0x510a91);}),_0x58c748('[Fail]\x20Add\x20an\x20expired\x20discount\x20code',async _0x477e6f=>{const _0xb6244=_0x5dc5d9,_0x45253d={'bILkH':_0xb6244(0x1ff),'qqrxz':_0xb6244(0x1f7),'MSZjU':'Discount\x20is\x20expired'};await g[_0xb6244(0x1ee)][_0xb6244(0x24c)](_0x45253d['bILkH'])[_0xb6244(0x22e)]({'productId':g[_0xb6244(0x23e)][0x0][_0xb6244(0x1e8)],'productQuantity':0x1,'productOptions':JSON[_0xb6244(0x221)](g[_0xb6244(0x23e)][0x0][_0xb6244(0x20d)])})[_0xb6244(0x1ea)](0xc8);const _0x1d0703=await g[_0xb6244(0x1ee)][_0xb6244(0x24c)](_0x45253d[_0xb6244(0x22f)])['send']({'discountCode':g[_0xb6244(0x22b)][0x2]['code']})[_0xb6244(0x1ea)](0x190);_0x477e6f[_0xb6244(0x247)](_0x1d0703[_0xb6244(0x1fb)][_0xb6244(0x21a)],_0x45253d[_0xb6244(0x1f4)]);}),_0x58c748(_0x5dc5d9(0x24b),async _0x5cbfc1=>{const _0x4e403b=_0x5dc5d9,_0x1fb404={'jBwNW':_0x4e403b(0x209)};await g[_0x4e403b(0x1ee)]['post'](_0x4e403b(0x1ff))[_0x4e403b(0x22e)]({'productId':g[_0x4e403b(0x23e)][0x0][_0x4e403b(0x1e8)],'productQuantity':0x1,'productOptions':JSON['stringify'](g['products'][0x0][_0x4e403b(0x20d)])})[_0x4e403b(0x1ea)](0xc8);const _0xb0a6ff=await g['request'][_0x4e403b(0x24c)](_0x4e403b(0x1f7))[_0x4e403b(0x22e)]({'discountCode':g[_0x4e403b(0x22b)][0x3][_0x4e403b(0x210)]})[_0x4e403b(0x1ea)](0x190);_0x5cbfc1[_0x4e403b(0x247)](_0xb0a6ff[_0x4e403b(0x1fb)][_0x4e403b(0x21a)],_0x1fb404['jBwNW']);}),_0x58c748('[Fail]\x20Add\x20a\x20bogus\x20code',async _0x345424=>{const _0x138921=_0x5dc5d9,_0x54ac6d={'nuQnL':_0x138921(0x1ff),'uzRnN':_0x138921(0x243),'ZUHdQ':'csrf-token'};await g[_0x138921(0x1ee)][_0x138921(0x24c)](_0x54ac6d[_0x138921(0x205)])['send']({'productId':g[_0x138921(0x23e)][0x0][_0x138921(0x1e8)],'productQuantity':0x1,'productOptions':JSON[_0x138921(0x221)](g[_0x138921(0x23e)][0x0][_0x138921(0x20d)])})[_0x138921(0x1ea)](0xc8);const _0xb1ff2=await g[_0x138921(0x1ee)][_0x138921(0x24c)](_0x138921(0x1f7))[_0x138921(0x22e)]({'discountCode':_0x54ac6d[_0x138921(0x1f8)]})['set'](_0x54ac6d[_0x138921(0x1fd)],g[_0x138921(0x219)])['expect'](0x190);_0x345424[_0x138921(0x247)](_0xb1ff2['body']['message'],'Discount\x20code\x20is\x20invalid\x20or\x20expired');}),_0x58c748(_0x5dc5d9(0x223),async _0x38a72a=>{const _0x3a20f1=_0x5dc5d9,_0x57e760={'RjzIs':_0x3a20f1(0x20a),'LKiIl':function(_0x13e893){return _0x13e893();},'iqfeQ':'days','OBFiD':_0x3a20f1(0x230),'mXPgb':_0x3a20f1(0x202)},_0x331bf3=await g['request'][_0x3a20f1(0x24c)](_0x3a20f1(0x244))[_0x3a20f1(0x22e)]({'code':_0x57e760[_0x3a20f1(0x23a)],'type':'amount','value':0xa,'start':_0x57e760[_0x3a20f1(0x239)](moment)[_0x3a20f1(0x21b)](0x1,_0x57e760[_0x3a20f1(0x1e7)])[_0x3a20f1(0x237)](_0x57e760[_0x3a20f1(0x21d)]),'end':_0x57e760[_0x3a20f1(0x239)](moment)[_0x3a20f1(0x21b)](0x7,_0x3a20f1(0x22d))[_0x3a20f1(0x237)]('DD/MM/YYYY\x20HH:mm')})['set'](_0x57e760['mXPgb'],g[_0x3a20f1(0x232)][0x0][_0x3a20f1(0x202)])[_0x3a20f1(0x248)](_0x3a20f1(0x240),g[_0x3a20f1(0x219)])['expect'](0xc8);_0x38a72a[_0x3a20f1(0x247)](_0x331bf3[_0x3a20f1(0x1fb)][_0x3a20f1(0x21a)],_0x3a20f1(0x212));}),_0x58c748(_0x5dc5d9(0x20b),async _0x3523df=>{const _0x3098cc=_0x5dc5d9,_0x45bba0={'ZEphs':_0x3098cc(0x244),'DKSCG':_0x3098cc(0x1ec),'NsjIq':_0x3098cc(0x233),'TJYEv':'days','tBAct':function(_0x38558f){return _0x38558f();},'LyLLT':'apiKey'},_0x2ab0eb=await g[_0x3098cc(0x1ee)][_0x3098cc(0x24c)](_0x45bba0[_0x3098cc(0x1f6)])['send']({'code':_0x45bba0[_0x3098cc(0x236)],'type':_0x45bba0['NsjIq'],'value':0xa,'start':moment()[_0x3098cc(0x21b)](0x1,_0x45bba0[_0x3098cc(0x21f)])['format'](_0x3098cc(0x230)),'end':_0x45bba0['tBAct'](moment)[_0x3098cc(0x21b)](0x7,_0x45bba0[_0x3098cc(0x21f)])[_0x3098cc(0x237)](_0x3098cc(0x230))})[_0x3098cc(0x248)](_0x45bba0[_0x3098cc(0x211)],g[_0x3098cc(0x232)][0x0][_0x3098cc(0x202)])['set'](_0x3098cc(0x240),g[_0x3098cc(0x219)])[_0x3098cc(0x1ea)](0x190);_0x3523df[_0x3098cc(0x247)](_0x2ab0eb[_0x3098cc(0x1fb)][0x0][_0x3098cc(0x21a)],'should\x20be\x20equal\x20to\x20one\x20of\x20the\x20allowed\x20values');}),_0x58c748(_0x5dc5d9(0x203),async _0x21db8a=>{const _0x12ab7d=_0x5dc5d9,_0xeeb5fb={'hMaMv':_0x12ab7d(0x244),'YRXrP':'days','PwgXf':_0x12ab7d(0x230),'iHmUc':_0x12ab7d(0x206)},_0x4d0fbf=await g[_0x12ab7d(0x1ee)][_0x12ab7d(0x24c)](_0xeeb5fb['hMaMv'])[_0x12ab7d(0x22e)]({'code':_0x12ab7d(0x222),'type':'amount','value':0xa,'start':moment()[_0x12ab7d(0x21b)](0x1,_0xeeb5fb[_0x12ab7d(0x229)])[_0x12ab7d(0x237)](_0xeeb5fb[_0x12ab7d(0x213)]),'end':moment()[_0x12ab7d(0x21b)](0x7,_0x12ab7d(0x22d))[_0x12ab7d(0x237)]('DD/MM/YYYY\x20HH:mm')})[_0x12ab7d(0x248)](_0x12ab7d(0x202),g[_0x12ab7d(0x232)][0x0][_0x12ab7d(0x202)])[_0x12ab7d(0x248)](_0x12ab7d(0x240),g[_0x12ab7d(0x219)])['expect'](0x190);_0x21db8a['deepEqual'](_0x4d0fbf[_0x12ab7d(0x1fb)][_0x12ab7d(0x21a)],_0xeeb5fb[_0x12ab7d(0x201)]);}),_0x58c748(_0x5dc5d9(0x224),async _0xf7c7d3=>{const _0x298b94=_0x5dc5d9,_0x36ef8e={'eapVY':function(_0x3d9a28){return _0x3d9a28();},'avoBY':_0x298b94(0x22d),'gSAnT':function(_0x154bca){return _0x154bca();},'mIhSF':_0x298b94(0x230),'gJfSp':_0x298b94(0x202)},_0x5038d6=await g[_0x298b94(0x1ee)][_0x298b94(0x24c)](_0x298b94(0x249))[_0x298b94(0x22e)]({'discountId':g[_0x298b94(0x22b)][0x0][_0x298b94(0x1e8)],'code':'TEST_CODE_99','type':_0x298b94(0x234),'value':0x14,'start':_0x36ef8e[_0x298b94(0x23c)](moment)[_0x298b94(0x21b)](0x1,_0x36ef8e['avoBY'])[_0x298b94(0x237)](_0x298b94(0x230)),'end':_0x36ef8e[_0x298b94(0x20f)](moment)[_0x298b94(0x21b)](0x7,_0x36ef8e[_0x298b94(0x24d)])[_0x298b94(0x237)](_0x36ef8e[_0x298b94(0x1f0)])})['set'](_0x36ef8e[_0x298b94(0x1f9)],g[_0x298b94(0x232)][0x0]['apiKey'])[_0x298b94(0x1ea)](0xc8);_0xf7c7d3[_0x298b94(0x247)](_0x5038d6['body'][_0x298b94(0x238)][_0x298b94(0x1ef)],0x14),_0xf7c7d3[_0x298b94(0x247)](_0x5038d6[_0x298b94(0x1fb)][_0x298b94(0x21a)],_0x298b94(0x23f));}),_0x58c748('[Fail]\x20Update\x20a\x20discount\x20with\x20same\x20code\x20as\x20existing',async _0x2cc3d6=>{const _0x43bb7c=_0x5dc5d9,_0xdae0dc={'xLpMl':_0x43bb7c(0x1f1),'IZbfx':_0x43bb7c(0x234),'YuIpH':'days','DutoO':'DD/MM/YYYY\x20HH:mm','zlLOk':_0x43bb7c(0x202)},_0x5841e7=await g[_0x43bb7c(0x1ee)][_0x43bb7c(0x24c)]('/admin/settings/discount/update')[_0x43bb7c(0x22e)]({'discountId':g[_0x43bb7c(0x22b)][0x1]['_id'],'code':_0xdae0dc[_0x43bb7c(0x23b)],'type':_0xdae0dc[_0x43bb7c(0x217)],'value':0x14,'start':moment()[_0x43bb7c(0x21b)](0x1,_0xdae0dc[_0x43bb7c(0x215)])['format'](_0xdae0dc[_0x43bb7c(0x214)]),'end':moment()[_0x43bb7c(0x21b)](0x7,_0xdae0dc[_0x43bb7c(0x215)])[_0x43bb7c(0x237)](_0xdae0dc[_0x43bb7c(0x214)])})[_0x43bb7c(0x248)](_0xdae0dc[_0x43bb7c(0x226)],g[_0x43bb7c(0x232)][0x0][_0x43bb7c(0x202)])['expect'](0x190);_0x2cc3d6['deepEqual'](_0x5841e7[_0x43bb7c(0x1fb)][_0x43bb7c(0x21a)],_0x43bb7c(0x206));});