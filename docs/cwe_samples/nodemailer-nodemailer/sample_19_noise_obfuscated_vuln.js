'use strict';const _0x301ab4=_0x4a45;function _0x4c18(){const _0x88d5bb=['JbEiM','12010zLJKXS','PFqEQ','should','2838DIykHp','yellow','should\x20process\x20a\x20signed\x20and\x20encrypted\x20message','WdsJA','518060mjpdLK','write','Oihvm','Basic128Rsa15','thImZ','toString','feed','127546YCFxym','CDMFy','gPBMl','370418dslUuT','xybup','ZJQOZ','WrjmG','105fwEnHu','this\x20chunk\x20has\x20a\x20altered\x20body\x20(\x20signature\x20verification\x20failed)','eql','\x20we\x20are\x20not\x20expecting\x20a\x20error\x20event\x20in\x20this\x20case','yeiXP','privateKey','TMOgm','XCmhv','length','ERROR','sejeX','GMlWW','SSYHs','QQSJx','err\x20','gsALt','TEST','kdtYA','1105320cbynSk','zqIUA','232264JFqfGb','slice','SFUEg','mkFwS','VZBxQ','chalk','full_message_body','log','AFemn','MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(MSG)\x20','_decodeMessageBody','nPCvy','securityMode','securityPolicy','setSecurity','node-opcua-debug','Zdidj','BtleJ','error','MessageBuilder\x20with\x20SIGN\x20support','SignAndEncrypt','it\x20should\x20not\x20emit\x20a\x20message\x20event\x20if\x20a\x20signature\x20is\x20invalid\x20or\x20missing','GjiVR','LtpNU','chunk','IWVnh','yUurr','10wdntIF','node-opcua-crypto','not','RTHGh','from','message','WFdas','make_debugLog','return\x20new\x20Date();','node-opcua-test-helpers','exist','qwShA','Sign','node-opcua-service-secure-channel','1458eUIBdh','joMCB','GdfLd','18hLJEot','eLjyC'];_0x4c18=function(){return _0x88d5bb;};return _0x4c18();}(function(_0x4159c2,_0x46c19d){const _0xa62c53=_0x4a45,_0x3f321d=_0x4159c2();while(!![]){try{const _0xf4c2f1=parseInt(_0xa62c53(0xf3))/0x1+-parseInt(_0xa62c53(0xf6))/0x2+parseInt(_0xa62c53(0xb4))/0x3+-parseInt(_0xa62c53(0xec))/0x4*(-parseInt(_0xa62c53(0xd1))/0x5)+parseInt(_0xa62c53(0xdf))/0x6*(parseInt(_0xa62c53(0xfa))/0x7)+-parseInt(_0xa62c53(0xb6))/0x8*(parseInt(_0xa62c53(0xe2))/0x9)+parseInt(_0xa62c53(0xe5))/0xa*(-parseInt(_0xa62c53(0xe8))/0xb);if(_0xf4c2f1===_0x46c19d)break;else _0x3f321d['push'](_0x3f321d['shift']());}catch(_0x30b86a){_0x3f321d['push'](_0x3f321d['shift']());}}}(_0x4c18,0x322d8));const should=require(_0x301ab4(0xe7)),chalk=require(_0x301ab4(0xbb)),debugLog=require(_0x301ab4(0xc5))[_0x301ab4(0xd8)](_0x301ab4(0x10a)),{hexDump}=require(_0x301ab4(0xc5)),{MessageSecurityMode}=require(_0x301ab4(0xde)),{readPrivateRsaKey}=require(_0x301ab4(0xd2)),{make_lorem_ipsum_buffer}=require(_0x301ab4(0xda)),{getFixture}=require('node-opcua-test-fixtures'),{iterateOnSymmetricEncryptedChunk,iterateOnSignedAndEncryptedMessageChunks,iterateOnSignedMessageChunks,derivedKeys}=require('../dist/test_helpers/fake_message_chunk_factory'),{MessageBuilder,SecurityPolicy}=require('..'),private_key_filename=getFixture('certs/server_key_1024.pem');function fake_decodeMessageBody(_0x58075a){const _0x175205=_0x301ab4,_0x38445b={'yeiXP':_0x175205(0xd9)};return this['emit'](_0x175205(0xd6),_0x58075a),Function(_0x38445b[_0x175205(0xfe)])(),!![];}function _0x4a45(_0x9790f2,_0x1a5591){const _0x4c188e=_0x4c18();return _0x4a45=function(_0x4a4535,_0xb4d0d9){_0x4a4535=_0x4a4535-0xb4;let _0x12593b=_0x4c188e[_0x4a4535];return _0x12593b;},_0x4a45(_0x9790f2,_0x1a5591);}describe(_0x301ab4(0xc9),function(){const _0x37728f=_0x301ab4,_0x1d55ee={'tQxtt':'GdfLd','IWVnh':function(_0xd94f22,_0x336e36){return _0xd94f22(_0x336e36);},'SFUEg':function(_0x27204f,_0x5256cd){return _0x27204f(_0x5256cd);},'WrjmG':_0x37728f(0xfb),'vbbZF':function(_0x43495f,_0x4d23f5){return _0x43495f===_0x4d23f5;},'thImZ':'BvDqA','zqIUA':function(_0x2ea339,_0x1edb65){return _0x2ea339(_0x1edb65);},'LtpNU':_0x37728f(0xbc),'GjiVR':_0x37728f(0xc8),'gPBMl':function(_0x1ac1d8,_0x3db92e){return _0x1ac1d8(_0x3db92e);},'PFqEQ':function(_0x95613e){return _0x95613e();},'CDMFy':function(_0x4d38b3,_0x3106e3){return _0x4d38b3(_0x3106e3);},'sejeX':function(_0x29900e,_0x496c21,_0x5821c2){return _0x29900e(_0x496c21,_0x5821c2);},'Zdidj':'####***\x20TEMPERED\x20***#####','Cblaq':function(_0x80f29d,_0x58a7a4){return _0x80f29d!==_0x58a7a4;},'CkAOn':'message','WdsJA':function(_0x1fcc27){return _0x1fcc27();},'qHGDq':'should\x20reconstruct\x20a\x20full\x20message\x20made\x20of\x20many\x20signed\x20chunks','WFdas':'should\x20emit\x20an\x20bad_signature\x20event\x20if\x20chunk\x20has\x20been\x20tempered'},_0x27e4b5=_0x1d55ee[_0x37728f(0xeb)](make_lorem_ipsum_buffer),_0x5020df=Buffer[_0x37728f(0xd5)](_0x27e4b5,_0x27e4b5[_0x37728f(0x102)]);_0x1d55ee['sejeX'](it,'should\x20not\x20emit\x20an\x20error\x20event\x20if\x20chunks\x20have\x20valid\x20signature',function(_0x19cd0a){const _0x1986ff=_0x37728f,_0x42a02a={'XCmhv':function(_0x1c63d3,_0x5cac6d){const _0x235e22=_0x4a45;return _0x1d55ee[_0x235e22(0xcf)](_0x1c63d3,_0x5cac6d);},'TMOgm':function(_0x521b72,_0x218594){const _0x2a2740=_0x4a45;return _0x1d55ee[_0x2a2740(0xb8)](_0x521b72,_0x218594);},'gsALt':_0x1d55ee[_0x1986ff(0xf9)]};if(_0x1d55ee['vbbZF'](_0x1d55ee[_0x1986ff(0xf0)],_0x1986ff(0x105)))_0x42a02a[_0x1986ff(0x101)](_0x4d595d,_0x595e2a),_0x42a02a[_0x1986ff(0x100)](_0x450907,_0x2193dc[_0x1986ff(0xe9)](_0x42a02a[_0x1986ff(0x109)])),_0x29745a();else{const _0x542646=new MessageBuilder({'maxChunkCount':0xa,'maxMessageSize':_0x5020df['length']*0xa,'maxChunkSize':_0x5020df['length']+0x3e8});_0x542646[_0x1986ff(0xff)]=_0x1d55ee[_0x1986ff(0xb5)](readPrivateRsaKey,private_key_filename),_0x542646[_0x1986ff(0xc0)]=fake_decodeMessageBody,_0x542646['on'](_0x1d55ee['LtpNU'],_0x3c06e4=>{_0x19cd0a();})['on'](_0x1986ff(0xd6),_0x1f3d5d=>{})['on'](_0x1d55ee[_0x1986ff(0xcc)],_0x4d6a26=>{const _0x14fb1f=_0x1986ff;console[_0x14fb1f(0xbd)](_0x14fb1f(0x103),_0x4d6a26),_0x19cd0a(_0x4d6a26);}),iterateOnSignedMessageChunks(_0x5020df,(_0x578ce0,_0x199982)=>{const _0x25fe36=_0x1986ff,_0x10a8a6={'qwShA':function(_0x4a71b2,_0x54cba8){return _0x4a71b2(_0x54cba8);}};_0x1d55ee['tQxtt']!==_0x25fe36(0xe1)?(_0x10a8a6[_0x25fe36(0xdc)](_0x2cf91c,_0x472f98[_0x25fe36(0xf1)]()),_0x3f4171[_0x25fe36(0xf1)]()[_0x25fe36(0xe7)][_0x25fe36(0xfc)](_0x55c1e8[_0x25fe36(0xf1)]())):(should[_0x25fe36(0xd3)][_0x25fe36(0xdb)](_0x578ce0),_0x542646[_0x25fe36(0xf2)](_0x199982[_0x25fe36(0xb7)](0x0,0x14)),_0x542646[_0x25fe36(0xf2)](_0x199982[_0x25fe36(0xb7)](0x14)));});}}),_0x1d55ee[_0x37728f(0x104)](it,_0x1d55ee['qHGDq'],function(_0x2b1929){const _0x77b2a9=_0x37728f,_0x5e9cdd={'RTHGh':function(_0x27db72,_0x1b7f5f){const _0x37c36f=_0x4a45;return _0x1d55ee[_0x37c36f(0xf4)](_0x27db72,_0x1b7f5f);},'VZBxQ':_0x77b2a9(0xfd)},_0x17f682={},_0x3c4f7c=new MessageBuilder(_0x17f682);_0x3c4f7c[_0x77b2a9(0xc4)](MessageSecurityMode[_0x77b2a9(0xdd)],SecurityPolicy[_0x77b2a9(0xef)]),_0x3c4f7c[_0x77b2a9(0xc0)]=fake_decodeMessageBody,_0x3c4f7c['on'](_0x1d55ee[_0x77b2a9(0xcd)],_0x5a243d=>{const _0xaed39d=_0x77b2a9;_0x5e9cdd[_0xaed39d(0xd4)](debugLog,_0x5a243d[_0xaed39d(0xf1)]()),_0x5a243d[_0xaed39d(0xf1)]()['should'][_0xaed39d(0xfc)](_0x5020df['toString']());})['on'](_0x77b2a9(0xce),_0x30d3e1=>{debugLog(_0x5e9cdd['RTHGh'](hexDump,_0x30d3e1));})['on'](_0x77b2a9(0xd6),_0x2c141c=>{const _0x6ed6ef=_0x77b2a9;_0x1d55ee[_0x6ed6ef(0xf5)](debugLog,_0x1d55ee[_0x6ed6ef(0xcf)](hexDump,_0x2c141c)),_0x1d55ee[_0x6ed6ef(0xe6)](_0x2b1929);})['on'](_0x77b2a9(0xc8),_0x2dfe95=>{const _0x257c98=_0x77b2a9;_0x5e9cdd[_0x257c98(0xd4)](_0x2b1929,new Error(_0x5e9cdd[_0x257c98(0xba)]+_0x2dfe95));}),_0x1d55ee[_0x77b2a9(0x104)](iterateOnSignedMessageChunks,_0x5020df,function(_0x5353f7,_0x3866ef){const _0x2e1a8f=_0x77b2a9;should[_0x2e1a8f(0xd3)][_0x2e1a8f(0xdb)](_0x5353f7),_0x3c4f7c['feed'](_0x3866ef[_0x2e1a8f(0xb7)](0x0,0x14)),_0x3c4f7c[_0x2e1a8f(0xf2)](_0x3866ef[_0x2e1a8f(0xb7)](0x14));});}),_0x1d55ee[_0x37728f(0x104)](it,_0x1d55ee[_0x37728f(0xd7)],function(_0x4598d6){const _0x1d8888=_0x37728f,_0x33dae6={'YLORn':function(_0x3b5dca,_0x1fc7a3){return _0x3b5dca(_0x1fc7a3);},'ZJQOZ':'it\x20should\x20not\x20emit\x20a\x20message\x20event\x20if\x20a\x20signature\x20is\x20invalid\x20or\x20missing','QQSJx':function(_0x4851c6,_0x2d8ae7){const _0x2594bc=_0x4a45;return _0x1d55ee[_0x2594bc(0xf5)](_0x4851c6,_0x2d8ae7);}};if(_0x1d55ee['Cblaq'](_0x1d8888(0xb9),_0x1d8888(0xc7))){const _0x15312b={},_0x1b26c7=new MessageBuilder(_0x15312b);_0x1b26c7[_0x1d8888(0xc0)]=fake_decodeMessageBody,_0x1b26c7['on'](_0x1d55ee[_0x1d8888(0xcd)],_0x5a2d82=>{const _0x375228=_0x1d8888;_0x4598d6(new Error(_0x375228(0xcb)));})['on'](_0x1d55ee['CkAOn'],_0x25def6=>{const _0x109d8e=_0x1d8888;_0x33dae6['YLORn'](_0x4598d6,new Error(_0x33dae6[_0x109d8e(0xf8)]));})['on'](_0x1d8888(0xc8),_0x3b7455=>{const _0x4a7296=_0x1d8888;debugLog(_0x3b7455),debugLog(chalk[_0x4a7296(0xe9)]('this\x20chunk\x20has\x20a\x20altered\x20body\x20(\x20signature\x20verification\x20failed)')),_0x1d55ee[_0x4a7296(0xe6)](_0x4598d6);}),iterateOnSignedMessageChunks(_0x5020df,function(_0x49b9ee,_0x23ea8c){const _0x46175d=_0x1d8888;should[_0x46175d(0xd3)][_0x46175d(0xdb)](_0x49b9ee),_0x23ea8c[_0x46175d(0xed)](_0x1d55ee[_0x46175d(0xc6)],0x3a0),_0x1b26c7['feed'](_0x23ea8c[_0x46175d(0xb7)](0x0,0x14)),_0x1b26c7[_0x46175d(0xf2)](_0x23ea8c[_0x46175d(0xb7)](0x14));});}else _0x33dae6[_0x1d8888(0x107)](_0xe2b0e7,new _0x9dc0dd(_0x33dae6[_0x1d8888(0xf8)]));});}),describe('MessageBuilder\x20with\x20SIGN\x20&\x20ENCRYPT\x20support\x20(OPN)\x20',function(){const _0x2ebc83=_0x301ab4,_0x3a5ccf={'YMGXB':function(_0x10eb06){return _0x10eb06();},'xybup':function(_0x4451a3,_0xd47301){return _0x4451a3(_0xd47301);},'yUurr':_0x2ebc83(0xd6),'OUPcw':function(_0x57f9a4,_0x4d72a4,_0x57781f){return _0x57f9a4(_0x4d72a4,_0x57781f);}},_0x25909a=make_lorem_ipsum_buffer();it('should\x20not\x20emit\x20an\x20error\x20event\x20with\x20valid\x20SIGN\x20&\x20ENCRYPT\x20chunks',function(_0x40f311){const _0x13711e=_0x2ebc83,_0x491cf5={'SSYHs':function(_0x5d65b9,_0x545fc5){return _0x5d65b9(_0x545fc5);}},_0x2b7be5={},_0x162c96=new MessageBuilder(_0x2b7be5);_0x162c96[_0x13711e(0xff)]=_0x3a5ccf[_0x13711e(0xf7)](readPrivateRsaKey,private_key_filename),_0x162c96[_0x13711e(0xc0)]=fake_decodeMessageBody,_0x162c96['on']('full_message_body',_0x4b2059=>{const _0x8192ac=_0x13711e;_0x4b2059['toString']()[_0x8192ac(0xe7)][_0x8192ac(0xfc)](_0x25909a['toString']()),_0x3a5ccf['YMGXB'](_0x40f311);})['on'](_0x3a5ccf[_0x13711e(0xd0)],_0x29a1d7=>{})['on'](_0x13711e(0xc8),_0x185bc5=>{const _0x1c0cdd=_0x13711e;_0x491cf5[_0x1c0cdd(0x106)](_0x40f311,_0x185bc5);}),_0x3a5ccf['OUPcw'](iterateOnSignedAndEncryptedMessageChunks,_0x25909a,function(_0x57cbe9,_0x16b0f9){const _0x3dee50=_0x13711e;should[_0x3dee50(0xd3)]['exist'](_0x57cbe9),_0x162c96[_0x3dee50(0xf2)](_0x16b0f9[_0x3dee50(0xb7)](0x0,0x14)),_0x162c96[_0x3dee50(0xf2)](_0x16b0f9['slice'](0x14));});});}),describe(_0x301ab4(0xbf),function(){const _0x499ab1=_0x301ab4,_0xd8c595={'QrXaC':function(_0x1512c0,_0x46e46a){return _0x1512c0(_0x46e46a);},'AFemn':function(_0x1d3b81,_0xb1c037){return _0x1d3b81!==_0xb1c037;},'kdtYA':_0x499ab1(0xee),'joMCB':'full_message_body','AHdEJ':_0x499ab1(0xc8),'HkoCo':function(_0x879e8c,_0x3a84d8,_0x3b85f0){return _0x879e8c(_0x3a84d8,_0x3b85f0);},'USEMR':function(_0x4cc6ed){return _0x4cc6ed();},'sOYFh':function(_0x4a1950,_0x48a239,_0x3c8a45){return _0x4a1950(_0x48a239,_0x3c8a45);}},_0x2d27f2=_0xd8c595['USEMR'](make_lorem_ipsum_buffer);_0xd8c595['sOYFh'](it,_0x499ab1(0xea),function(_0x313ffb){const _0x133bd0=_0x499ab1,_0x3786af={'nPCvy':function(_0x3160cd){return _0x3160cd();},'eLjyC':function(_0x21a811){return _0x21a811();}};if(_0xd8c595[_0x133bd0(0xbe)](_0x133bd0(0xee),_0xd8c595[_0x133bd0(0x10b)]))_0x5dfc95['not']['exist'](_0x121f0e),_0x44322b[_0x133bd0(0xf2)](_0x12cc89);else{const _0x5c9563=new MessageBuilder({'maxMessageSize':0xf4240,'maxChunkSize':0x800,'maxChunkCount':0x5});_0x5c9563[_0x133bd0(0xc0)]=fake_decodeMessageBody,_0x5c9563[_0x133bd0(0xc3)]=SecurityPolicy[_0x133bd0(0xef)],_0x5c9563[_0x133bd0(0xff)]=readPrivateRsaKey(private_key_filename),_0x5c9563[_0x133bd0(0xc2)]=MessageSecurityMode[_0x133bd0(0xca)],_0x5c9563['pushNewToken']({'tokenId':0xa},derivedKeys);let _0x2f2f48;_0x5c9563['on'](_0xd8c595[_0x133bd0(0xe0)],_0x140c45=>{const _0x323741=_0x133bd0;_0x140c45['toString']()[_0x323741(0xe7)]['eql'](_0x2d27f2[_0x323741(0xf1)]()),_0x3786af[_0x323741(0xc1)](_0x313ffb);})['on'](_0x133bd0(0xd6),_0x307c35=>{})['on'](_0xd8c595['AHdEJ'],_0x1c2de5=>{const _0x4f328d=_0x133bd0;_0x4f328d(0xe4)===_0x4f328d(0xe4)?(console[_0x4f328d(0xbd)](_0x4f328d(0x108),_0x1c2de5['message']),_0xd8c595['QrXaC'](_0x313ffb,_0x1c2de5)):(_0x12c0d0[_0x4f328d(0xf1)]()['should'][_0x4f328d(0xfc)](_0x5edb66['toString']()),_0x3786af[_0x4f328d(0xe3)](_0x490bd5));}),_0xd8c595['HkoCo'](iterateOnSymmetricEncryptedChunk,_0x2d27f2,function(_0x103a69,_0x265294){const _0x1e9740=_0x133bd0;should['not']['exist'](_0x103a69),_0x5c9563[_0x1e9740(0xf2)](_0x265294);});}});});