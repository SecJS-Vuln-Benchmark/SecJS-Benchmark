const _0x1b90cf=_0x15f6;function _0x15f6(_0x228eb1,_0x2fdc35){const _0x1c4e23=_0x1c4e();return _0x15f6=function(_0x15f613,_0x3dceb1){_0x15f613=_0x15f613-0x14d;let _0x9ac6bb=_0x1c4e23[_0x15f613];return _0x9ac6bb;},_0x15f6(_0x228eb1,_0x2fdc35);}(function(_0x5613ce,_0xce2b2b){const _0x498947=_0x15f6,_0x25a066=_0x5613ce();while(!![]){try{const _0xa0bcb0=parseInt(_0x498947(0x21b))/0x1+-parseInt(_0x498947(0x2a5))/0x2+-parseInt(_0x498947(0x1e2))/0x3*(-parseInt(_0x498947(0x18f))/0x4)+parseInt(_0x498947(0x2b7))/0x5+-parseInt(_0x498947(0x294))/0x6+parseInt(_0x498947(0x2b3))/0x7*(-parseInt(_0x498947(0x246))/0x8)+-parseInt(_0x498947(0x283))/0x9;if(_0xa0bcb0===_0xce2b2b)break;else _0x25a066['push'](_0x25a066['shift']());}catch(_0x5378c0){_0x25a066['push'](_0x25a066['shift']());}}}(_0x1c4e,0x901a6),process[_0x1b90cf(0x24c)][_0x1b90cf(0x240)]===_0x1b90cf(0x239)?require(_0x1b90cf(0x27b))[_0x1b90cf(0x278)]({'path':'.env.'+process['env'][_0x1b90cf(0x240)]}):require(_0x1b90cf(0x27b))[_0x1b90cf(0x278)]());const {viewLocalFiles,normalizePath,isWithin}=require('../utils/files'),{purgeDocument,purgeFolder}=require(_0x1b90cf(0x194)),{getVectorDbClass}=require(_0x1b90cf(0x28e)),{updateENV,dumpENV}=require(_0x1b90cf(0x156)),{reqBody,makeJWT,userFromSession,multiUserMode,queryParams}=require(_0x1b90cf(0x182)),{handleAssetUpload,handlePfpUpload}=require(_0x1b90cf(0x209)),{v4}=require(_0x1b90cf(0x1be)),{SystemSettings}=require(_0x1b90cf(0x18b)),{User}=require(_0x1b90cf(0x215)),{validatedRequest}=require('../utils/middleware/validatedRequest'),fs=require('fs'),path=require('path'),{getDefaultFilename,determineLogoFilepath,fetchLogo,validFilename,renameLogoFile,removeCustomLogo,LOGO_FILENAME,isDefaultFilename}=require(_0x1b90cf(0x1f0)),{Telemetry}=require(_0x1b90cf(0x2a1)),{WelcomeMessages}=require(_0x1b90cf(0x2aa)),{ApiKey}=require('../models/apiKeys'),{getCustomModels}=require(_0x1b90cf(0x186)),{WorkspaceChats}=require(_0x1b90cf(0x280)),{flexUserRoleValid,ROLES,isMultiUserSetup}=require(_0x1b90cf(0x269)),{fetchPfp,determinePfpFilepath}=require('../utils/files/pfp'),{exportChatsAsType}=require(_0x1b90cf(0x23f)),{EventLogs}=require(_0x1b90cf(0x16c)),{CollectorApi}=require(_0x1b90cf(0x27a)),{recoverAccount,resetPassword,generateRecoveryCodes}=require('../utils/PasswordRecovery'),{SlashCommandPresets}=require(_0x1b90cf(0x1da)),{EncryptionManager}=require(_0x1b90cf(0x228)),{BrowserExtensionApiKey}=require('../models/browserExtensionApiKey'),{chatHistoryViewable}=require(_0x1b90cf(0x15e)),{simpleSSOEnabled}=require(_0x1b90cf(0x1c0)),{TemporaryAuthToken}=require(_0x1b90cf(0x26a));function systemEndpoints(_0x4661d4){const _0x44325b=_0x1b90cf,_0x47b996={'nNtbN':_0x44325b(0x189),'eGrVS':_0x44325b(0x2a7),'uBUID':_0x44325b(0x24d),'uiPGG':_0x44325b(0x1bc),'NPAaJ':'xIxIN','cfoBU':function(_0x2dbca3,_0xc20995,_0xcf0e48){return _0x2dbca3(_0xc20995,_0xcf0e48);},'somzB':_0x44325b(0x1d7),'XfPGq':'nqIvB','RKJWi':function(_0x3abd63,_0x447dd8){return _0x3abd63(_0x447dd8);},'IMDOb':_0x44325b(0x28f),'vTQFi':function(_0x2d512b,_0x16ee62){return _0x2d512b||_0x16ee62;},'lMreB':_0x44325b(0x1a0),'mZjtn':'Utrkg','krlmg':'failed_login_invalid_password','WnYot':_0x44325b(0x1ed),'qrPZB':_0x44325b(0x18c),'mIlEw':'vrYcg','SMdGY':_0x44325b(0x224),'lbtkT':_0x44325b(0x164),'vIHnI':function(_0x5a94d7,_0x4d0203){return _0x5a94d7||_0x4d0203;},'cYsxR':_0x44325b(0x2b8),'JzPOa':'login_event','dPcBE':function(_0xb04013,_0x35cb96){return _0xb04013===_0x35cb96;},'hTxBp':_0x44325b(0x277),'OrUHb':'30d','xWIKq':function(_0x53885d,_0x12b09c,_0x2506f1){return _0x53885d(_0x12b09c,_0x2506f1);},'zhTpX':function(_0x4a0ff8,_0x404fbc){return _0x4a0ff8(_0x404fbc);},'KUqmw':'[003]\x20Invalid\x20password\x20provided','BNxOo':_0x44325b(0x25b),'XLExc':_0x44325b(0x282),'RrHcn':_0x44325b(0x281),'sDvis':function(_0x40fe44,_0xa80bab,_0x15d38a,_0xbecde6){return _0x40fe44(_0xa80bab,_0x15d38a,_0xbecde6);},'WsIVF':function(_0x30f3a1,_0x5449dc){return _0x30f3a1(_0x5449dc);},'qFzGS':function(_0x54b52c,_0x1eaeac){return _0x54b52c(_0x1eaeac);},'zvDoE':function(_0x5c4b4c,_0x48c53e){return _0x5c4b4c!==_0x48c53e;},'MkxQx':'duifI','tFiCn':_0x44325b(0x26b),'EsHob':_0x44325b(0x16e),'rTcBt':_0x44325b(0x23c),'YKhaT':function(_0x30625c,_0x2fb196){return _0x30625c===_0x2fb196;},'LFucf':function(_0x40f202,_0x5904f2){return _0x40f202!==_0x5904f2;},'irsCP':function(_0x56b8f1){return _0x56b8f1();},'TkmjI':_0x44325b(0x158),'IwItC':function(_0x2d568b,_0x4936e9){return _0x2d568b||_0x4936e9;},'nKECM':function(_0x14bde5,_0x559e12,_0x52c8f9){return _0x14bde5(_0x559e12,_0x52c8f9);},'YbbdG':function(_0x1b0ab8){return _0x1b0ab8();},'ZIdIw':_0x44325b(0x1ba),'MMRri':function(_0x21e9ec,_0xab010f){return _0x21e9ec!==_0xab010f;},'lhriY':_0x44325b(0x15d),'wjrJs':'Akqip','XiaAQ':_0x44325b(0x188),'iIlwB':'base64','RcHoD':_0x44325b(0x263),'ctedF':_0x44325b(0x202),'crbXS':_0x44325b(0x172),'BKGHS':_0x44325b(0x22a),'iPKpx':_0x44325b(0x22c),'tihpX':_0x44325b(0x16f),'frSrR':_0x44325b(0x273),'fcSrD':_0x44325b(0x1ee),'BfliH':_0x44325b(0x276),'FzhsC':function(_0x3c34c0,_0x37ecee){return _0x3c34c0===_0x37ecee;},'dIzEj':_0x44325b(0x255),'rDRol':function(_0xbccf3,_0x2f4e07){return _0xbccf3||_0x2f4e07;},'jowxh':_0x44325b(0x216),'OFvcq':_0x44325b(0x1ad),'hPyPx':function(_0x103eaa,_0x1053dc){return _0x103eaa!==_0x1053dc;},'JTjoV':function(_0x42e597,_0x3b4503){return _0x42e597||_0x3b4503;},'yxfXF':_0x44325b(0x26e),'uEIat':function(_0x3ed4af,_0x3b2b14){return _0x3ed4af||_0x3b2b14;},'ZRxtu':function(_0x447082,_0xde6bd4){return _0x447082!==_0xde6bd4;},'JqFpY':_0x44325b(0x265),'seZjp':function(_0x27e1f3,_0x5987fa,_0x1f9bda){return _0x27e1f3(_0x5987fa,_0x1f9bda);},'bKnaV':_0x44325b(0x27f),'FYzWV':function(_0x16b81a,_0x577e3e){return _0x16b81a||_0x577e3e;},'xpKjR':_0x44325b(0x187),'AfEAb':_0x44325b(0x199),'xHxFX':_0x44325b(0x223),'vixQF':_0x44325b(0x171),'PFrml':'Error\x20uploading\x20the\x20logo.','bsxHo':_0x44325b(0x295),'LUebY':_0x44325b(0x20c),'FoKqe':'lSvLB','rEdWL':_0x44325b(0x24f),'SsSlP':function(_0x2b700e,_0x1743a6){return _0x2b700e(_0x1743a6);},'FoONz':_0x44325b(0x19b),'dBznE':'Error\x20processing\x20the\x20welcome\x20messages:','qYxIm':_0x44325b(0x208),'LhYHQ':_0x44325b(0x22b),'MricK':_0x44325b(0x28d),'HiaHD':'Error\x20generating\x20api\x20key.','BGJlO':_0x44325b(0x23e),'VFmgo':'pjzhf','svmqQ':function(_0x2a3987,_0x54d970){return _0x2a3987(_0x54d970);},'vArEv':function(_0x381314,_0xa80a53){return _0x381314*_0xa80a53;},'olMaR':_0x44325b(0x1a2),'AikbK':function(_0x31ae58,_0xa80d9e){return _0x31ae58>_0xa80d9e;},'bEIZL':function(_0x56d201,_0x1e0bc6){return _0x56d201+_0x1e0bc6;},'VSurb':function(_0x2fce0e,_0x170a7f){return _0x2fce0e!==_0x170a7f;},'ILFtS':_0x44325b(0x264),'BmCma':_0x44325b(0x200),'TbfLo':_0x44325b(0x250),'nUarB':'Invalid\x20user\x20ID','AmUTE':function(_0x2aa9d0,_0x287d24){return _0x2aa9d0(_0x287d24);},'tSCnI':function(_0x4ad8bd,_0x56601a){return _0x4ad8bd===_0x56601a;},'eIbbA':_0x44325b(0x229),'OMpSX':function(_0x322268,_0xb92d0){return _0x322268===_0xb92d0;},'vyZAP':'tOeKG','Afexf':function(_0x26fe4e,_0x2a20e3,_0x9adb67){return _0x26fe4e(_0x2a20e3,_0x9adb67);},'jiaWt':function(_0x57dbd5,_0x1d6f70){return _0x57dbd5(_0x1d6f70);},'olsUK':'Failed\x20to\x20create\x20preset','xdkiG':function(_0x1d3a79,_0x44c339){return _0x1d3a79===_0x44c339;},'VaTwr':'nMayP','COkyO':function(_0x359d12,_0x5d1041,_0x207c62){return _0x359d12(_0x5d1041,_0x207c62);},'ksyly':function(_0x1a3480,_0x5bd662){return _0x1a3480(_0x5bd662);},'CrfiY':function(_0x46513d,_0x4bfe2c){return _0x46513d(_0x4bfe2c);},'amstR':function(_0x25f361,_0x594d22){return _0x25f361(_0x594d22);},'Wuoqg':'Error\x20updating\x20slash\x20command\x20preset:','rGyeV':function(_0x12042b,_0x583c2c){return _0x12042b(_0x583c2c);},'aJnNh':_0x44325b(0x293),'vONdf':'/migrate','KfyKu':'/setup-complete','Hhdoy':_0x44325b(0x258),'RHXdl':'/request-token','qeiBr':_0x44325b(0x279),'BzjGT':_0x44325b(0x1e9),'NRyhg':function(_0x51024e,_0x4ebd01){return _0x51024e(_0x4ebd01);},'lHrlr':'/system/remove-documents','FskqW':_0x44325b(0x23a),'XPJRt':function(_0x5588f9,_0x300866){return _0x5588f9(_0x300866);},'aXGZX':_0x44325b(0x157),'PTTSe':_0x44325b(0x21e),'yKhbm':_0x44325b(0x20d),'SXtvP':'/system/update-password','qebFw':'/system/enable-multi-user','HuCLp':_0x44325b(0x225),'UWvZs':'/system/logo','wISUS':_0x44325b(0x163),'SMpAa':_0x44325b(0x234),'vzzKC':_0x44325b(0x17e),'GgVJa':_0x44325b(0x28a),'TWUVb':_0x44325b(0x25f),'zPDXG':function(_0x4611b0,_0x532009){return _0x4611b0(_0x532009);},'cYTxt':_0x44325b(0x21f),'SOMiz':'/system/is-default-logo','ssqLR':function(_0x4c9328,_0x3857a9){return _0x4c9328(_0x3857a9);},'UItsY':function(_0x265fb6,_0x53dc29){return _0x265fb6(_0x53dc29);},'rlmFN':_0x44325b(0x2b2),'BQalq':_0x44325b(0x1e7),'DBzuX':_0x44325b(0x214),'wOyou':'/system/event-logs','DdKqi':function(_0x5f0e31,_0x490c5e){return _0x5f0e31(_0x490c5e);},'ZwfSp':_0x44325b(0x1d3),'GOXZS':_0x44325b(0x2b5),'mIRGU':_0x44325b(0x1f3),'ZJCYy':_0x44325b(0x268),'MtWuX':function(_0x5cbabb,_0x24d02f){return _0x5cbabb(_0x24d02f);},'dRKzl':_0x44325b(0x29e)};if(!_0x4661d4)return;_0x4661d4[_0x44325b(0x1cf)](_0x44325b(0x14d),(_0xe7855d,_0x2add14)=>{const _0x4c1ebc=_0x44325b;_0x2add14[_0x4c1ebc(0x206)](0xc8)[_0x4c1ebc(0x166)]({'online':!![]});}),_0x4661d4['get'](_0x47b996[_0x44325b(0x230)],async(_0x4d4af4,_0x10261f)=>{const _0x422f6e=_0x44325b,_0x1765c7={'gGsRb':_0x422f6e(0x1bc)};_0x422f6e(0x211)===_0x47b996[_0x422f6e(0x22e)]?(_0x18c527[_0x422f6e(0x245)](_0x422f6e(0x1c5),_0x21eb5f),_0x5d4ad2[_0x422f6e(0x206)](0x1f4)[_0x422f6e(0x166)]({'message':_0x1765c7['gGsRb']})):_0x10261f['sendStatus'](0xc8);}),_0x4661d4[_0x44325b(0x1cf)](_0x44325b(0x20e),async(_0x46aea8,_0x389174)=>{const _0xe6561e=_0x44325b;if(process[_0xe6561e(0x24c)][_0xe6561e(0x240)]!==_0x47b996['eGrVS'])return _0x389174[_0xe6561e(0x2a6)](0xc8)['end']();dumpENV(),_0x389174[_0xe6561e(0x2a6)](0xc8)[_0xe6561e(0x196)]();}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x1fd)],async(_0x465104,_0x103b6a)=>{const _0x109518=_0x44325b;try{const _0x14026b=await SystemSettings[_0x109518(0x1ce)]();_0x103b6a[_0x109518(0x206)](0xc8)['json']({'results':_0x14026b});}catch(_0x32651e){console[_0x109518(0x245)](_0x32651e[_0x109518(0x227)],_0x32651e),_0x103b6a[_0x109518(0x2a6)](0x1f4)[_0x109518(0x196)]();}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996['Hhdoy'],[validatedRequest],async(_0x4cf31d,_0x5d461f)=>{const _0x2a7cb1=_0x44325b;try{if(_0x47b996[_0x2a7cb1(0x1c8)]===_0x2a7cb1(0x2af)){if(multiUserMode(_0x5d461f)){const _0x5059a5=await _0x47b996[_0x2a7cb1(0x17a)](userFromSession,_0x4cf31d,_0x5d461f);if(!_0x5059a5||_0x5059a5[_0x2a7cb1(0x226)]){_0x5d461f[_0x2a7cb1(0x2a6)](0x193)[_0x2a7cb1(0x196)]();return;}_0x5d461f[_0x2a7cb1(0x2a6)](0xc8)[_0x2a7cb1(0x196)]();return;}_0x5d461f[_0x2a7cb1(0x2a6)](0xc8)[_0x2a7cb1(0x196)]();}else _0x4a327c[_0x2a7cb1(0x245)](_0x47b996['uBUID'],_0x1f24bc),_0x4434bf[_0x2a7cb1(0x206)](0x1f4)['json']({'message':_0x47b996[_0x2a7cb1(0x184)]});}catch(_0x28d0a2){console[_0x2a7cb1(0x245)](_0x28d0a2[_0x2a7cb1(0x227)],_0x28d0a2),_0x5d461f[_0x2a7cb1(0x2a6)](0x1f4)['end']();}}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996['RHXdl'],async(_0x255c7d,_0x550029)=>{const _0x1af839=_0x44325b;try{const _0x36c2a2=require(_0x1af839(0x1af));if(await SystemSettings[_0x1af839(0x160)]()){if(_0x47b996[_0x1af839(0x178)]===_0x1af839(0x19d))_0x5ca037[_0x1af839(0x206)](0x190)[_0x1af839(0x166)]({'success':_0x5ca6a2,'error':_0x51def3});else{const {username:_0x103f0e,password:_0x21c4af}=_0x47b996[_0x1af839(0x20b)](reqBody,_0x255c7d),_0x3aec58=await User['_get']({'username':_0x47b996[_0x1af839(0x20b)](String,_0x103f0e)});if(!_0x3aec58){await EventLogs[_0x1af839(0x218)](_0x47b996[_0x1af839(0x210)],{'ip':_0x255c7d['ip']||_0x1af839(0x164),'username':_0x47b996[_0x1af839(0x205)](_0x103f0e,_0x47b996[_0x1af839(0x233)])},_0x3aec58?.['id']),_0x550029[_0x1af839(0x206)](0xc8)[_0x1af839(0x166)]({'user':null,'valid':![],'token':null,'message':_0x1af839(0x165)});return;}if(!_0x36c2a2[_0x1af839(0x296)](String(_0x21c4af),_0x3aec58['password'])){if(_0x1af839(0x26d)!==_0x47b996[_0x1af839(0x266)])_0x1d08c2['error'](_0x47b996['somzB'],_0x99fb24),_0x1ddf0c[_0x1af839(0x206)](0x1f4)[_0x1af839(0x166)]({'message':_0x1af839(0x1bc)});else{await EventLogs[_0x1af839(0x218)](_0x47b996[_0x1af839(0x190)],{'ip':_0x255c7d['ip']||_0x1af839(0x164),'username':_0x47b996[_0x1af839(0x205)](_0x103f0e,_0x1af839(0x1a0))},_0x3aec58?.['id']),_0x550029[_0x1af839(0x206)](0xc8)['json']({'user':null,'valid':![],'token':null,'message':_0x47b996[_0x1af839(0x1b6)]});return;}}if(_0x3aec58[_0x1af839(0x226)]){if(_0x47b996[_0x1af839(0x1d5)]!==_0x47b996[_0x1af839(0x23d)]){await EventLogs[_0x1af839(0x218)](_0x47b996[_0x1af839(0x15f)],{'ip':_0x255c7d['ip']||_0x47b996[_0x1af839(0x17c)],'username':_0x47b996['vIHnI'](_0x103f0e,_0x1af839(0x1a0))},_0x3aec58?.['id']),_0x550029['status'](0xc8)[_0x1af839(0x166)]({'user':null,'valid':![],'token':null,'message':_0x47b996[_0x1af839(0x247)]});return;}else _0x4d7a9d[_0x1af839(0x245)](_0x40d57d[_0x1af839(0x227)],_0x4a67a3),_0x7b9250[_0x1af839(0x2a6)](0x1f4)[_0x1af839(0x196)]();}await Telemetry[_0x1af839(0x1fa)](_0x47b996[_0x1af839(0x27c)],{'multiUserMode':![]},_0x3aec58?.['id']),await EventLogs[_0x1af839(0x218)](_0x47b996[_0x1af839(0x27c)],{'ip':_0x255c7d['ip']||_0x1af839(0x164),'username':_0x3aec58[_0x1af839(0x1b8)]||_0x1af839(0x1a0)},_0x3aec58?.['id']);if(!_0x3aec58[_0x1af839(0x175)]){if(_0x47b996[_0x1af839(0x21d)](_0x47b996[_0x1af839(0x1c2)],_0x1af839(0x277))){const _0x364aba=await _0x47b996['RKJWi'](generateRecoveryCodes,_0x3aec58['id']);_0x550029[_0x1af839(0x206)](0xc8)[_0x1af839(0x166)]({'valid':!![],'user':User['filterFields'](_0x3aec58),'token':_0x47b996[_0x1af839(0x17a)](makeJWT,{'id':_0x3aec58['id'],'username':_0x3aec58[_0x1af839(0x1b8)]},_0x47b996[_0x1af839(0x1e4)]),'message':null,'recoveryCodes':_0x364aba});return;}else _0x4b2449[_0x1af839(0x245)](_0xa38505),_0x59578d[_0x1af839(0x2a6)](0x1f4)['end']();}_0x550029[_0x1af839(0x206)](0xc8)[_0x1af839(0x166)]({'valid':!![],'user':User[_0x1af839(0x298)](_0x3aec58),'token':_0x47b996[_0x1af839(0x213)](makeJWT,{'id':_0x3aec58['id'],'username':_0x3aec58['username']},_0x1af839(0x1a6)),'message':null});return;}}else{const {password:_0x220cfa}=_0x47b996['zhTpX'](reqBody,_0x255c7d);if(!_0x36c2a2[_0x1af839(0x296)](_0x220cfa,_0x36c2a2[_0x1af839(0x2ae)](process[_0x1af839(0x24c)][_0x1af839(0x29d)],0xa))){await EventLogs[_0x1af839(0x218)](_0x47b996[_0x1af839(0x190)],{'ip':_0x255c7d['ip']||_0x47b996['lbtkT'],'multiUserMode':![]}),_0x550029['status'](0x191)[_0x1af839(0x166)]({'valid':![],'token':null,'message':_0x47b996[_0x1af839(0x174)]});return;}await Telemetry['sendTelemetry'](_0x1af839(0x21a),{'multiUserMode':![]}),await EventLogs[_0x1af839(0x218)]('login_event',{'ip':_0x255c7d['ip']||_0x1af839(0x164),'multiUserMode':![]}),_0x550029[_0x1af839(0x206)](0xc8)[_0x1af839(0x166)]({'valid':!![],'token':_0x47b996['xWIKq'](makeJWT,{'p':new EncryptionManager()[_0x1af839(0x242)](_0x220cfa)},_0x1af839(0x1a6)),'message':null});}}catch(_0x143aff){console[_0x1af839(0x245)](_0x143aff['message'],_0x143aff),_0x550029[_0x1af839(0x2a6)](0x1f4)[_0x1af839(0x196)]();}}),_0x4661d4['get']('/request-token/sso/simple',[simpleSSOEnabled],async(_0x2400a9,_0x360df8)=>{const _0x3cbd40=_0x44325b;if(_0x3cbd40(0x243)===_0x47b996['BNxOo'])_0x107e36['error'](_0x3cbd40(0x1e8),_0x3901bf),_0x25305f[_0x3cbd40(0x206)](0x1f4)[_0x3cbd40(0x166)]({'success':![],'message':'Internal\x20server\x20error'});else{const {token:_0x2ae045}=_0x2400a9['query'],{sessionToken:_0x39574b,token:_0xc5bd68,error:_0x4e5f}=await TemporaryAuthToken[_0x3cbd40(0x292)](_0x2ae045);if(_0x4e5f)return await EventLogs['logEvent'](_0x47b996[_0x3cbd40(0x19a)],{'ip':_0x2400a9['ip']||_0x3cbd40(0x164),'multiUserMode':!![]}),_0x360df8[_0x3cbd40(0x206)](0x191)[_0x3cbd40(0x166)]({'valid':![],'token':null,'message':_0x3cbd40(0x153)+_0x4e5f});await Telemetry[_0x3cbd40(0x1fa)](_0x3cbd40(0x21a),{'multiUserMode':!![]},_0xc5bd68[_0x3cbd40(0x1b7)]['id']),await EventLogs['logEvent'](_0x3cbd40(0x21a),{'ip':_0x2400a9['ip']||_0x47b996[_0x3cbd40(0x17c)],'username':_0xc5bd68[_0x3cbd40(0x1b7)][_0x3cbd40(0x1b8)]||_0x3cbd40(0x1a0)},_0xc5bd68['user']['id']),_0x360df8[_0x3cbd40(0x206)](0xc8)['json']({'valid':!![],'user':User[_0x3cbd40(0x298)](_0xc5bd68[_0x3cbd40(0x1b7)]),'token':_0x39574b,'message':null});}}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996['qeiBr'],[isMultiUserSetup],async(_0x10d901,_0x22cb05)=>{const _0x1ce566=_0x44325b;try{const {username:_0x2c6b1e,recoveryCodes:_0x3f0c1d}=_0x47b996[_0x1ce566(0x180)](reqBody,_0x10d901),{success:_0x1164d2,resetToken:_0xd52863,error:_0x8dbdeb}=await recoverAccount(_0x2c6b1e,_0x3f0c1d);_0x1164d2?_0x22cb05[_0x1ce566(0x206)](0xc8)[_0x1ce566(0x166)]({'success':_0x1164d2,'resetToken':_0xd52863}):_0x22cb05[_0x1ce566(0x206)](0x190)[_0x1ce566(0x166)]({'success':_0x1164d2,'message':_0x8dbdeb});}catch(_0x2d5e6b){console[_0x1ce566(0x245)]('Error\x20recovering\x20account:',_0x2d5e6b),_0x22cb05['status'](0x1f4)['json']({'success':![],'message':'Internal\x20server\x20error'});}}),_0x4661d4['post']('/system/reset-password',[isMultiUserSetup],async(_0x15a43f,_0x4ff5c9)=>{const _0x1c2e66=_0x44325b;if(_0x47b996[_0x1c2e66(0x21d)](_0x1c2e66(0x281),_0x47b996[_0x1c2e66(0x2ac)]))try{const {token:_0x1af8ee,newPassword:_0x281c37,confirmPassword:_0x296df6}=_0x47b996['zhTpX'](reqBody,_0x15a43f),{success:_0x2479a0,message:_0x129889,error:_0x4a3e51}=await _0x47b996[_0x1c2e66(0x1c4)](resetPassword,_0x1af8ee,_0x281c37,_0x296df6);_0x2479a0?_0x4ff5c9[_0x1c2e66(0x206)](0xc8)['json']({'success':_0x2479a0,'message':_0x129889}):_0x4ff5c9[_0x1c2e66(0x206)](0x190)[_0x1c2e66(0x166)]({'success':_0x2479a0,'error':_0x4a3e51});}catch(_0x4d3444){console[_0x1c2e66(0x245)](_0x1c2e66(0x25c),_0x4d3444),_0x4ff5c9[_0x1c2e66(0x206)](0x1f4)['json']({'success':![],'message':_0x4d3444[_0x1c2e66(0x227)]});}else _0x10c7c1[_0x1c2e66(0x206)](0xc8)[_0x1c2e66(0x166)]({'success':_0x4422ae,'message':_0x35d9ba});}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x291)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x1b3)],ROLES['manager']])],async(_0x3fbd7a,_0x40b5bc)=>{const _0x48782b=_0x44325b;try{const _0x388b75=queryParams(_0x3fbd7a),_0x4f83ea=getVectorDbClass(),_0x195d61=!!_0x388b75[_0x48782b(0x24a)]?await _0x4f83ea[_0x48782b(0x1de)](_0x388b75[_0x48782b(0x24a)]):await _0x4f83ea[_0x48782b(0x29a)]();_0x40b5bc[_0x48782b(0x206)](0xc8)[_0x48782b(0x166)]({'vectorCount':_0x195d61});}catch(_0x3ff45b){console[_0x48782b(0x245)](_0x3ff45b['message'],_0x3ff45b),_0x40b5bc[_0x48782b(0x2a6)](0x1f4)['end']();}}),_0x4661d4[_0x44325b(0x1eb)](_0x44325b(0x2a9),[validatedRequest,_0x47b996[_0x44325b(0x155)](flexUserRoleValid,[ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]])],async(_0x4ee97f,_0x5b91ed)=>{const _0x237070=_0x44325b;try{const {name:_0x841694}=reqBody(_0x4ee97f);await _0x47b996[_0x237070(0x2a2)](purgeDocument,_0x841694),_0x5b91ed[_0x237070(0x2a6)](0xc8)[_0x237070(0x196)]();}catch(_0x28c363){console[_0x237070(0x245)](_0x28c363[_0x237070(0x227)],_0x28c363),_0x5b91ed[_0x237070(0x2a6)](0x1f4)[_0x237070(0x196)]();}}),_0x4661d4['delete'](_0x47b996['lHrlr'],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]])],async(_0x4d52b0,_0x117697)=>{const _0x1bac48=_0x44325b;try{const {names:_0x1ffbd3}=_0x47b996[_0x1bac48(0x180)](reqBody,_0x4d52b0);for await(const _0x195225 of _0x1ffbd3)await purgeDocument(_0x195225);_0x117697[_0x1bac48(0x2a6)](0xc8)[_0x1bac48(0x196)]();}catch(_0x3f2e31){console[_0x1bac48(0x245)](_0x3f2e31[_0x1bac48(0x227)],_0x3f2e31),_0x117697[_0x1bac48(0x2a6)](0x1f4)[_0x1bac48(0x196)]();}}),_0x4661d4[_0x44325b(0x1eb)](_0x47b996[_0x44325b(0x1b5)],[validatedRequest,_0x47b996[_0x44325b(0x219)](flexUserRoleValid,[ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]])],async(_0x1beb98,_0x4b02bd)=>{const _0x5c0d3d=_0x44325b;try{const {name:_0x3ff035}=_0x47b996[_0x5c0d3d(0x197)](reqBody,_0x1beb98);await _0x47b996['WsIVF'](purgeFolder,_0x3ff035),_0x4b02bd[_0x5c0d3d(0x2a6)](0xc8)['end']();}catch(_0xdad409){console[_0x5c0d3d(0x245)](_0xdad409[_0x5c0d3d(0x227)],_0xdad409),_0x4b02bd[_0x5c0d3d(0x2a6)](0x1f4)['end']();}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x288)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]])],async(_0x1b8244,_0x38483a)=>{const _0x387475=_0x44325b;try{const _0x2a689f=await viewLocalFiles();_0x38483a['status'](0xc8)[_0x387475(0x166)]({'localFiles':_0x2a689f});}catch(_0x159e0c){console[_0x387475(0x245)](_0x159e0c[_0x387475(0x227)],_0x159e0c),_0x38483a[_0x387475(0x2a6)](0x1f4)['end']();}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x193)],[validatedRequest],async(_0x4f7503,_0x41f9bc)=>{const _0x26c875=_0x44325b,_0x3dc83a={'gqiBH':_0x26c875(0x15b)};if(_0x26c875(0x1cd)!==_0x26c875(0x19e))try{if(_0x47b996[_0x26c875(0x252)](_0x47b996['MkxQx'],_0x47b996[_0x26c875(0x212)])){const _0x554e48=await new CollectorApi()[_0x26c875(0x259)]();_0x41f9bc['sendStatus'](_0x554e48?0xc8:0x1f7);}else return _0x422194[_0x26c875(0x206)](0x190)[_0x26c875(0x166)]({'message':_0x3dc83a[_0x26c875(0x254)]});}catch(_0x2d3b5e){console[_0x26c875(0x245)](_0x2d3b5e['message'],_0x2d3b5e),_0x41f9bc['sendStatus'](0x1f4)[_0x26c875(0x196)]();}else _0x52a7dd[_0x26c875(0x245)](_0x14476a),_0x308b30['status'](0x1f4)['end']();}),_0x4661d4[_0x44325b(0x1cf)]('/system/accepted-document-types',[validatedRequest],async(_0x4fa8a9,_0x1c145c)=>{const _0x464694=_0x44325b;try{const _0x2d1398=await new CollectorApi()[_0x464694(0x1f6)]();if(!_0x2d1398){_0x1c145c[_0x464694(0x2a6)](0x194)[_0x464694(0x196)]();return;}_0x1c145c[_0x464694(0x206)](0xc8)[_0x464694(0x166)]({'types':_0x2d1398});}catch(_0x149bfe){if(_0x464694(0x249)==='ZpVrt')return _0x1d46e6['status'](0x190)[_0x464694(0x166)]({'message':_0x47b996[_0x464694(0x2a8)]});else console['error'](_0x149bfe[_0x464694(0x227)],_0x149bfe),_0x1c145c['sendStatus'](0x1f4)[_0x464694(0x196)]();}}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996[_0x44325b(0x154)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x1b3)]])],async(_0x1f01f3,_0x7a56a3)=>{const _0x271d0b=_0x44325b;try{const _0x4fe1c7=reqBody(_0x1f01f3),{newValues:_0x1d5e26,error:_0x51691d}=await updateENV(_0x4fe1c7,![],_0x7a56a3?.[_0x271d0b(0x207)]?.['user']?.['id']);_0x7a56a3[_0x271d0b(0x206)](0xc8)[_0x271d0b(0x166)]({'newValues':_0x1d5e26,'error':_0x51691d});}catch(_0x528f1e){console[_0x271d0b(0x245)](_0x528f1e[_0x271d0b(0x227)],_0x528f1e),_0x7a56a3['sendStatus'](0x1f4)['end']();}}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996[_0x44325b(0x2a4)],[validatedRequest],async(_0x4ed027,_0x443c58)=>{const _0x156735=_0x44325b;if(_0x47b996['YKhaT'](_0x156735(0x2b6),'dTHyX'))try{if(_0x47b996[_0x156735(0x176)](_0x156735(0x150),_0x156735(0x150)))_0x4f0836[_0x156735(0x245)](_0x2f6265[_0x156735(0x227)],_0x8ea795),_0x50ebe7[_0x156735(0x2a6)](0x1f4)[_0x156735(0x196)]();else{if(multiUserMode(_0x443c58)){_0x443c58[_0x156735(0x2a6)](0x191)[_0x156735(0x196)]();return;}let _0x3ee47e=null;const {usePassword:_0x1d18df,newPassword:_0x25415a}=reqBody(_0x4ed027);!_0x1d18df?(process['env']['AUTH_TOKEN']='',process[_0x156735(0x24c)][_0x156735(0x241)]=''):_0x3ee47e=await _0x47b996[_0x156735(0x213)](updateENV,{'AuthToken':_0x25415a,'JWTSecret':_0x47b996['irsCP'](v4)},!![])?.[_0x156735(0x245)],_0x443c58[_0x156735(0x206)](0xc8)[_0x156735(0x166)]({'success':!_0x3ee47e,'error':_0x3ee47e});}}catch(_0x20d2c4){console['error'](_0x20d2c4[_0x156735(0x227)],_0x20d2c4),_0x443c58[_0x156735(0x2a6)](0x1f4)[_0x156735(0x196)]();}else return _0x39708d[_0x156735(0x206)](0x190)[_0x156735(0x166)]({'message':_0x47b996[_0x156735(0x1c9)]});}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996['qebFw'],[validatedRequest],async(_0x5a3a21,_0x4cff25)=>{const _0x167ac4=_0x44325b;try{if(_0x4cff25[_0x167ac4(0x207)][_0x167ac4(0x167)]){_0x4cff25[_0x167ac4(0x206)](0xc8)[_0x167ac4(0x166)]({'success':![],'error':_0x47b996[_0x167ac4(0x1e0)]});return;}const {username:_0x4a4094,password:_0x4c53ef}=reqBody(_0x5a3a21),{user:_0x356581,error:_0x6a928b}=await User[_0x167ac4(0x1dd)]({'username':_0x4a4094,'password':_0x4c53ef,'role':ROLES[_0x167ac4(0x1b3)]});if(_0x6a928b||!_0x356581){_0x4cff25[_0x167ac4(0x206)](0x190)[_0x167ac4(0x166)]({'success':![],'error':_0x47b996[_0x167ac4(0x270)](_0x6a928b,_0x167ac4(0x216))});return;}await SystemSettings[_0x167ac4(0x14e)]({'multi_user_mode':!![]}),await BrowserExtensionApiKey[_0x167ac4(0x1d1)](_0x356581['id']),await _0x47b996[_0x167ac4(0x1b0)](updateENV,{'JWTSecret':process[_0x167ac4(0x24c)][_0x167ac4(0x241)]||_0x47b996[_0x167ac4(0x181)](v4)},!![]),await Telemetry[_0x167ac4(0x1fa)](_0x47b996['ZIdIw'],{'multiUserMode':!![]}),await EventLogs[_0x167ac4(0x218)]('multi_user_mode_enabled',{},_0x356581?.['id']),_0x4cff25['status'](0xc8)[_0x167ac4(0x166)]({'success':!!_0x356581,'error':_0x6a928b});}catch(_0x153e79){await User[_0x167ac4(0x1eb)]({}),await SystemSettings[_0x167ac4(0x14e)]({'multi_user_mode':![]}),console[_0x167ac4(0x245)](_0x153e79[_0x167ac4(0x227)],_0x153e79),_0x4cff25['sendStatus'](0x1f4)[_0x167ac4(0x196)]();}}),_0x4661d4['get'](_0x47b996['HuCLp'],async(_0x2349b8,_0x50cde8)=>{const _0x4f3a59=_0x44325b;try{if(_0x47b996[_0x4f3a59(0x260)](_0x4f3a59(0x1cc),_0x4f3a59(0x1bd))){const _0x4f9e48=await SystemSettings[_0x4f3a59(0x160)]();_0x50cde8['status'](0xc8)[_0x4f3a59(0x166)]({'multiUserMode':_0x4f9e48});}else _0x500059['env'][_0x4f3a59(0x29d)]='',_0x4dd35e[_0x4f3a59(0x24c)]['JWT_SECRET']='';}catch(_0x403dd9){_0x4f3a59(0x2ba)!==_0x4f3a59(0x297)?(console[_0x4f3a59(0x245)](_0x403dd9[_0x4f3a59(0x227)],_0x403dd9),_0x50cde8['sendStatus'](0x1f4)[_0x4f3a59(0x196)]()):(_0x1d19c7[_0x4f3a59(0x245)]('Error\x20processing\x20the\x20logo\x20request:',_0x233e7b),_0x3d3851['status'](0x1f4)[_0x4f3a59(0x166)]({'message':_0x47b996[_0x4f3a59(0x184)]}));}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996['UWvZs'],async function(_0x525465,_0x74570d){const _0x10d215=_0x44325b,_0x5d1f12={'ORTzR':_0x47b996[_0x10d215(0x1dc)],'tehXC':_0x10d215(0x1bc)};try{const _0x135681=!_0x525465?.['query']?.[_0x10d215(0x192)]||_0x525465?.[_0x10d215(0x26f)]?.[_0x10d215(0x192)]==='default',_0xf16d90=getDefaultFilename(_0x135681),_0x10a858=await determineLogoFilepath(_0xf16d90),{found:_0x5dedf7,buffer:_0x4a1f06,size:_0x531c51,mime:_0x4ae6c1}=_0x47b996[_0x10d215(0x180)](fetchLogo,_0x10a858);if(!_0x5dedf7){if(_0x47b996['wjrJs']==='ufNJD')_0x8710b['error'](_0x5d1f12['ORTzR'],_0x262ece),_0x292a64['status'](0x1f4)[_0x10d215(0x166)]({'message':_0x5d1f12[_0x10d215(0x1f2)]});else{_0x74570d[_0x10d215(0x2a6)](0xcc)[_0x10d215(0x196)]();return;}}const _0x1fe9d1=await SystemSettings[_0x10d215(0x1b2)]();_0x74570d[_0x10d215(0x24b)](0xc8,{'Access-Control-Expose-Headers':_0x10d215(0x19c),'Content-Type':_0x4ae6c1||_0x47b996[_0x10d215(0x1fb)],'Content-Disposition':_0x10d215(0x1c7)+path[_0x10d215(0x257)](_0x10a858),'Content-Length':_0x531c51,'X-Is-Custom-Logo':_0x47b996[_0x10d215(0x252)](_0x1fe9d1,null)&&_0x1fe9d1!==_0xf16d90&&!isDefaultFilename(_0x1fe9d1)}),_0x74570d[_0x10d215(0x196)](Buffer['from'](_0x4a1f06,_0x47b996[_0x10d215(0x1ab)]));return;}catch(_0x53b0c9){console[_0x10d215(0x245)](_0x47b996[_0x10d215(0x261)],_0x53b0c9),_0x74570d[_0x10d215(0x206)](0x1f4)['json']({'message':_0x47b996[_0x10d215(0x184)]});}}),_0x4661d4['get'](_0x47b996[_0x44325b(0x1a5)],[validatedRequest],async(_0x4fb145,_0x3a79e2)=>{const _0x43a3fc=_0x44325b;try{const _0x4cff42=(await SystemSettings[_0x43a3fc(0x1cf)]({'label':_0x43a3fc(0x183)}))?.[_0x43a3fc(0x161)]??JSON[_0x43a3fc(0x1b1)]([]);_0x3a79e2['status'](0xc8)[_0x43a3fc(0x166)]({'footerData':_0x4cff42});}catch(_0x3e2c0b){console['error'](_0x47b996['ctedF'],_0x3e2c0b),_0x3a79e2[_0x43a3fc(0x206)](0x1f4)['json']({'message':_0x47b996[_0x43a3fc(0x184)]});}}),_0x4661d4[_0x44325b(0x1cf)](_0x44325b(0x25a),[validatedRequest],async(_0x3374d0,_0x5ae4a7)=>{const _0x1977d2=_0x44325b;if(_0x47b996[_0x1977d2(0x176)](_0x47b996[_0x1977d2(0x284)],_0x47b996[_0x1977d2(0x284)])){_0x316155[_0x1977d2(0x206)](0x190)['json']({'success':![],'error':_0x47b996[_0x1977d2(0x179)]});return;}else try{if(_0x47b996[_0x1977d2(0x1c1)]!==_0x1977d2(0x1f5)){const _0xa1fc3e=(await SystemSettings[_0x1977d2(0x1cf)]({'label':_0x47b996['tihpX']}))?.['value']??null;_0x5ae4a7['status'](0xc8)[_0x1977d2(0x166)]({'supportEmail':_0xa1fc3e});}else _0x3094ae[_0x1977d2(0x245)](_0xce6db),_0x5c39b5[_0x1977d2(0x206)](0x1f4)['json']({'apiKey':null,'error':'Error\x20generating\x20api\x20key.'});}catch(_0x4251b0){console[_0x1977d2(0x245)](_0x47b996[_0x1977d2(0x1e6)],_0x4251b0),_0x5ae4a7[_0x1977d2(0x206)](0x1f4)['json']({'message':_0x47b996[_0x1977d2(0x184)]});}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x1db)],async(_0x5a2bd5,_0x33262c)=>{const _0x58444a=_0x44325b,_0x2d93c3={'TDWci':'Error\x20processing\x20the\x20logo\x20upload:','aLcMc':_0x58444a(0x1ef)};if(_0x47b996['LFucf'](_0x58444a(0x285),_0x47b996[_0x58444a(0x244)]))try{const _0x34e369=(await SystemSettings[_0x58444a(0x1cf)]({'label':_0x47b996[_0x58444a(0x221)]}))?.[_0x58444a(0x161)]??null;_0x33262c[_0x58444a(0x206)](0xc8)[_0x58444a(0x166)]({'customAppName':_0x34e369});}catch(_0x35e0e8){_0x47b996[_0x58444a(0x20a)](_0x47b996[_0x58444a(0x1fe)],_0x58444a(0x173))?(_0x132a70[_0x58444a(0x245)](_0x2d93c3[_0x58444a(0x22f)],_0x1277b8),_0x39bee0['status'](0x1f4)[_0x58444a(0x166)]({'message':_0x2d93c3[_0x58444a(0x18e)]})):(console[_0x58444a(0x245)](_0x58444a(0x1c5),_0x35e0e8),_0x33262c[_0x58444a(0x206)](0x1f4)[_0x58444a(0x166)]({'message':_0x47b996[_0x58444a(0x184)]}));}else _0xd1cb28[_0x58444a(0x245)](_0x544b66[_0x58444a(0x227)],_0x4b51f6),_0xbff25a[_0x58444a(0x2a6)](0x1f4)['end']();}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x2b0)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x14f)]])],async function(_0x901295,_0x3deb71){const _0x53c211=_0x44325b;if(_0x53c211(0x1ad)===_0x47b996[_0x53c211(0x159)])try{const {id:_0x2984ec}=_0x901295['params'],_0x32a992=await _0x47b996[_0x53c211(0x180)](determinePfpFilepath,_0x2984ec);if(!_0x32a992){_0x3deb71[_0x53c211(0x2a6)](0xcc)[_0x53c211(0x196)]();return;}const {found:_0x1c06e9,buffer:_0x18fdcb,size:_0x4398e3,mime:_0x26ad35}=fetchPfp(_0x32a992);if(!_0x1c06e9){if(_0x47b996[_0x53c211(0x162)](_0x53c211(0x1d4),_0x53c211(0x1d4))){_0x46dbc4['status'](0x190)[_0x53c211(0x166)]({'success':![],'error':_0x47b996['rDRol'](_0x421d0a,_0x47b996['jowxh'])});return;}else{_0x3deb71[_0x53c211(0x2a6)](0xcc)[_0x53c211(0x196)]();return;}}_0x3deb71[_0x53c211(0x24b)](0xc8,{'Content-Type':_0x47b996[_0x53c211(0x253)](_0x26ad35,_0x47b996[_0x53c211(0x1fb)]),'Content-Disposition':'attachment;\x20filename='+path['basename'](_0x32a992),'Content-Length':_0x4398e3}),_0x3deb71['end'](Buffer[_0x53c211(0x1ae)](_0x18fdcb,_0x47b996[_0x53c211(0x1ab)]));return;}catch(_0x28337d){console[_0x53c211(0x245)](_0x53c211(0x263),_0x28337d),_0x3deb71[_0x53c211(0x206)](0x1f4)[_0x53c211(0x166)]({'message':_0x47b996[_0x53c211(0x184)]});}else _0x17ace9['error'](_0x3d101e[_0x53c211(0x227)],_0x17d2bc),_0x24238e[_0x53c211(0x2a6)](0x1f4)[_0x53c211(0x196)]();}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996[_0x44325b(0x1f4)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x14f)]]),handlePfpUpload],async function(_0x494de5,_0x201660){const _0x17e88f=_0x44325b;try{const _0x687116=await userFromSession(_0x494de5,_0x201660),_0x38a151=_0x494de5['randomFileName'];if(!_0x38a151)return _0x201660[_0x17e88f(0x206)](0x190)['json']({'message':_0x17e88f(0x15b)});const _0x35ccdb=await User[_0x17e88f(0x1cf)]({'id':_0x687116['id']}),_0x4733c5=_0x35ccdb[_0x17e88f(0x1ff)];if(_0x4733c5){const _0xf49dee=path[_0x17e88f(0x201)](__dirname,_0x47b996[_0x17e88f(0x2ad)]),_0x3060ba=path[_0x17e88f(0x201)](_0xf49dee,normalizePath(_0x35ccdb['pfpFilename']));if(!isWithin(path['resolve'](_0xf49dee),path[_0x17e88f(0x272)](_0x3060ba)))throw new Error(_0x17e88f(0x267));if(fs[_0x17e88f(0x28b)](_0x3060ba))fs[_0x17e88f(0x27d)](_0x3060ba);}const {success:_0x1d3b16,error:_0x43a40d}=await User[_0x17e88f(0x222)](_0x687116['id'],{'pfpFilename':_0x38a151});return _0x201660[_0x17e88f(0x206)](_0x1d3b16?0xc8:0x1f4)[_0x17e88f(0x166)]({'message':_0x1d3b16?_0x17e88f(0x1c3):_0x47b996[_0x17e88f(0x29b)](_0x43a40d,_0x17e88f(0x1d6))});}catch(_0x634ab8){console['error']('Error\x20processing\x20the\x20profile\x20picture\x20upload:',_0x634ab8),_0x201660[_0x17e88f(0x206)](0x1f4)[_0x17e88f(0x166)]({'message':_0x47b996[_0x17e88f(0x184)]});}}),_0x4661d4[_0x44325b(0x1eb)](_0x47b996[_0x44325b(0x15c)],[validatedRequest,_0x47b996['zPDXG'](flexUserRoleValid,[ROLES[_0x44325b(0x14f)]])],async function(_0x12f6c9,_0x43c3b6){const _0x36ecd0=_0x44325b;if(_0x47b996[_0x36ecd0(0x1b9)](_0x47b996[_0x36ecd0(0x26c)],_0x36ecd0(0x1df)))try{const _0x5c55da=await userFromSession(_0x12f6c9,_0x43c3b6),_0xee0dfb=await User['get']({'id':_0x5c55da['id']}),_0x3d798e=_0xee0dfb['pfpFilename'];if(_0x3d798e){if(_0x47b996['FzhsC'](_0x36ecd0(0x1e3),'ToBaa')){const _0x11196e=path['join'](__dirname,_0x47b996['yxfXF']),_0x4deecb=path['join'](_0x11196e,normalizePath(_0x3d798e));if(!_0x47b996['seZjp'](isWithin,path[_0x36ecd0(0x272)](_0x11196e),path[_0x36ecd0(0x272)](_0x4deecb)))throw new Error(_0x36ecd0(0x267));if(fs['existsSync'](_0x4deecb))fs[_0x36ecd0(0x27d)](_0x4deecb);}else _0x3615e5[_0x36ecd0(0x206)](0xc8)['json']({'online':!![]});}const {success:_0x5c581d,error:_0xdc6f32}=await User[_0x36ecd0(0x222)](_0x5c55da['id'],{'pfpFilename':null});return _0x43c3b6['status'](_0x5c581d?0xc8:0x1f4)[_0x36ecd0(0x166)]({'message':_0x5c581d?_0x47b996[_0x36ecd0(0x1fc)]:_0x47b996[_0x36ecd0(0x16d)](_0xdc6f32,_0x36ecd0(0x19f))});}catch(_0x13e239){if(_0x47b996['xpKjR']!==_0x47b996[_0x36ecd0(0x238)])console[_0x36ecd0(0x245)](_0x36ecd0(0x1d7),_0x13e239),_0x43c3b6[_0x36ecd0(0x206)](0x1f4)[_0x36ecd0(0x166)]({'message':_0x36ecd0(0x1bc)});else{_0x2ccac1[_0x36ecd0(0x206)](0xc8)['json']({'success':![],'error':_0x36ecd0(0x158)});return;}}else _0xbb9e7a[_0x36ecd0(0x245)](_0x864569[_0x36ecd0(0x227)],_0x34ae49),_0x37cba5[_0x36ecd0(0x2a6)](0x1f4)['end']();}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996[_0x44325b(0x1ac)],[validatedRequest,_0x47b996[_0x44325b(0x23b)](flexUserRoleValid,[ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]]),handleAssetUpload],async(_0x33121c,_0x2f86d8)=>{const _0x70f13d=_0x44325b;if(!_0x33121c?.[_0x70f13d(0x169)]||!_0x33121c?.[_0x70f13d(0x169)]['originalname'])return _0x2f86d8[_0x70f13d(0x206)](0x190)['json']({'message':_0x47b996[_0x70f13d(0x2a8)]});if(!_0x47b996[_0x70f13d(0x180)](validFilename,_0x33121c['file']['originalname']))return _0x2f86d8[_0x70f13d(0x206)](0x190)[_0x70f13d(0x166)]({'message':_0x47b996[_0x70f13d(0x1c9)]});try{const _0x2b98b2=await _0x47b996[_0x70f13d(0x180)](renameLogoFile,_0x33121c[_0x70f13d(0x169)][_0x70f13d(0x15a)]),_0x4a5ff1=await SystemSettings['currentLogoFilename']();await removeCustomLogo(_0x4a5ff1);const {success:_0x3b72b4,error:_0x466ca2}=await SystemSettings[_0x70f13d(0x14e)]({'logo_filename':_0x2b98b2});return _0x2f86d8[_0x70f13d(0x206)](_0x3b72b4?0xc8:0x1f4)[_0x70f13d(0x166)]({'message':_0x3b72b4?_0x70f13d(0x152):_0x466ca2||_0x47b996[_0x70f13d(0x16a)]});}catch(_0x33ad66){console[_0x70f13d(0x245)](_0x47b996['vixQF'],_0x33ad66),_0x2f86d8[_0x70f13d(0x206)](0x1f4)['json']({'message':_0x47b996[_0x70f13d(0x236)]});}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x1ea)],async(_0x4f6aaf,_0xd9c2d4)=>{const _0x9b76f=_0x44325b;try{const _0x28a56f=await SystemSettings[_0x9b76f(0x1b2)](),_0x3442db=_0x28a56f===LOGO_FILENAME;_0xd9c2d4[_0x9b76f(0x206)](0xc8)[_0x9b76f(0x166)]({'isDefaultLogo':_0x3442db});}catch(_0x347c14){console[_0x9b76f(0x245)](_0x47b996[_0x9b76f(0x261)],_0x347c14),_0xd9c2d4[_0x9b76f(0x206)](0x1f4)[_0x9b76f(0x166)]({'message':_0x47b996[_0x9b76f(0x184)]});}}),_0x4661d4[_0x44325b(0x1cf)]('/system/remove-logo',[validatedRequest,_0x47b996[_0x44325b(0x1aa)](flexUserRoleValid,[ROLES['admin'],ROLES[_0x44325b(0x198)]])],async(_0x4b157d,_0x318ea9)=>{const _0x4af355=_0x44325b;try{const _0x92a178=await SystemSettings[_0x4af355(0x1b2)]();await removeCustomLogo(_0x92a178);const {success:_0x56a8bc,error:_0x175c35}=await SystemSettings[_0x4af355(0x14e)]({'logo_filename':LOGO_FILENAME});return _0x318ea9[_0x4af355(0x206)](_0x56a8bc?0xc8:0x1f4)[_0x4af355(0x166)]({'message':_0x56a8bc?_0x4af355(0x1cb):_0x175c35||'Failed\x20to\x20update\x20with\x20new\x20logo.'});}catch(_0x1599a6){console[_0x4af355(0x245)]('Error\x20processing\x20the\x20logo\x20removal:',_0x1599a6),_0x318ea9[_0x4af355(0x206)](0x1f4)[_0x4af355(0x166)]({'message':_0x4af355(0x274)});}}),_0x4661d4['get'](_0x44325b(0x290),[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x14f)]])],async function(_0x5f27b0,_0x5b653b){const _0x5a9978=_0x44325b;try{if(_0x47b996[_0x5a9978(0x1bb)]===_0x47b996[_0x5a9978(0x289)]){_0x45714a[_0x5a9978(0x2a6)](0xcc)[_0x5a9978(0x196)]();return;}else{const _0x6493fe=await WelcomeMessages[_0x5a9978(0x22d)]();_0x5b653b[_0x5a9978(0x206)](0xc8)[_0x5a9978(0x166)]({'success':!![],'welcomeMessages':_0x6493fe});}}catch(_0x5f1ae4){console[_0x5a9978(0x245)](_0x5a9978(0x1e8),_0x5f1ae4),_0x5b653b[_0x5a9978(0x206)](0x1f4)[_0x5a9978(0x166)]({'success':![],'message':_0x47b996[_0x5a9978(0x184)]});}}),_0x4661d4[_0x44325b(0x1b4)](_0x44325b(0x1d8),[validatedRequest,_0x47b996[_0x44325b(0x299)](flexUserRoleValid,[ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]])],async(_0x54e1ee,_0x4c52c8)=>{const _0x2477e3=_0x44325b;try{if(_0x47b996['YKhaT'](_0x47b996[_0x2477e3(0x1ec)],_0x47b996[_0x2477e3(0x1a3)]))_0x2e9f86['error'](_0x2477e3(0x271),_0x3368e6),_0x2a554f[_0x2477e3(0x206)](0x1f4)['json']({'message':_0x2477e3(0x1bc)});else{const {messages:messages=[]}=_0x47b996[_0x2477e3(0x275)](reqBody,_0x54e1ee);if(!Array['isArray'](messages))return _0x4c52c8[_0x2477e3(0x206)](0x190)['json']({'success':![],'message':_0x47b996[_0x2477e3(0x1a4)]});return await WelcomeMessages['saveAll'](messages),_0x4c52c8['status'](0xc8)[_0x2477e3(0x166)]({'success':!![],'message':_0x2477e3(0x203)});}}catch(_0x1b01a4){console[_0x2477e3(0x245)](_0x47b996[_0x2477e3(0x2bb)],_0x1b01a4),_0x4c52c8[_0x2477e3(0x206)](0x1f4)[_0x2477e3(0x166)]({'success':!![],'message':_0x47b996[_0x2477e3(0x287)]});}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996['rlmFN'],[validatedRequest],async(_0x21e258,_0xc0ca1)=>{const _0x457996=_0x44325b;try{if(_0xc0ca1['locals'][_0x457996(0x167)])return _0xc0ca1[_0x457996(0x2a6)](0x191)[_0x457996(0x196)]();const _0x5d1c05=await ApiKey[_0x457996(0x1f8)]({});return _0xc0ca1[_0x457996(0x206)](0xc8)['json']({'apiKeys':_0x5d1c05,'error':null});}catch(_0x8ff8e7){console['error'](_0x8ff8e7),_0xc0ca1[_0x457996(0x206)](0x1f4)[_0x457996(0x166)]({'apiKey':null,'error':_0x47b996[_0x457996(0x151)]});}}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996[_0x44325b(0x237)],[validatedRequest],async(_0x5a4206,_0x3143b2)=>{const _0x496d1b=_0x44325b;try{if(_0x3143b2['locals']['multiUserMode'])return _0x3143b2['sendStatus'](0x191)[_0x496d1b(0x196)]();const {apiKey:_0xce1ef6,error:_0x42b85a}=await ApiKey[_0x496d1b(0x1dd)]();return await Telemetry['sendTelemetry']('api_key_created'),await EventLogs[_0x496d1b(0x218)](_0x47b996[_0x496d1b(0x1e5)],{},_0x3143b2?.[_0x496d1b(0x207)]?.[_0x496d1b(0x1b7)]?.['id']),_0x3143b2['status'](0xc8)[_0x496d1b(0x166)]({'apiKey':_0xce1ef6,'error':_0x42b85a});}catch(_0x5c5dd5){console[_0x496d1b(0x245)](_0x5c5dd5),_0x3143b2['status'](0x1f4)['json']({'apiKey':null,'error':_0x47b996[_0x496d1b(0x1a9)]});}}),_0x4661d4[_0x44325b(0x1eb)](_0x47b996[_0x44325b(0x16b)],[validatedRequest],async(_0x482863,_0x48b6c4)=>{const _0x20d5b7=_0x44325b;try{if(_0x48b6c4[_0x20d5b7(0x207)][_0x20d5b7(0x167)])return _0x48b6c4[_0x20d5b7(0x2a6)](0x191)[_0x20d5b7(0x196)]();return await ApiKey[_0x20d5b7(0x1eb)](),await EventLogs[_0x20d5b7(0x218)](_0x47b996[_0x20d5b7(0x1a8)],{'deletedBy':_0x48b6c4[_0x20d5b7(0x207)]?.[_0x20d5b7(0x1b7)]?.[_0x20d5b7(0x1b8)]},_0x48b6c4?.['locals']?.[_0x20d5b7(0x1b7)]?.['id']),_0x48b6c4[_0x20d5b7(0x206)](0xc8)[_0x20d5b7(0x196)]();}catch(_0x3f4d2d){console[_0x20d5b7(0x245)](_0x3f4d2d),_0x48b6c4['status'](0x1f4)[_0x20d5b7(0x196)]();}}),_0x4661d4[_0x44325b(0x1b4)](_0x44325b(0x177),[validatedRequest],async(_0x13c6b6,_0x1dfc76)=>{const _0x37e024=_0x44325b;try{const {provider:_0x4c975b,apiKey:apiKey=null,basePath:basePath=null}=_0x47b996[_0x37e024(0x275)](reqBody,_0x13c6b6),{models:_0x2d23eb,error:_0x2dad13}=await getCustomModels(_0x4c975b,apiKey,basePath);return _0x1dfc76[_0x37e024(0x206)](0xc8)[_0x37e024(0x166)]({'models':_0x2d23eb,'error':_0x2dad13});}catch(_0x529fc1){console['error'](_0x529fc1),_0x1dfc76[_0x37e024(0x206)](0x1f4)[_0x37e024(0x196)]();}}),_0x4661d4['post'](_0x47b996[_0x44325b(0x286)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x1b3)]])],async(_0x820c52,_0xe56003)=>{const _0x5348f1=_0x44325b;if(_0x47b996[_0x5348f1(0x1a1)]!==_0x5348f1(0x29f))_0x441f29[_0x5348f1(0x245)](_0xeb153b),_0x75431[_0x5348f1(0x2a6)](0x1f4)[_0x5348f1(0x196)]();else try{const {offset:offset=0x0,limit:limit=0xa}=_0x47b996[_0x5348f1(0x204)](reqBody,_0x820c52),_0x5025de=await EventLogs[_0x5348f1(0x256)]({},limit,offset*limit,{'id':_0x5348f1(0x1a2)}),_0x5b7ec0=await EventLogs['count'](),_0x310542=_0x5b7ec0>_0x47b996[_0x5348f1(0x1ca)](offset+0x1,limit);_0xe56003[_0x5348f1(0x206)](0xc8)[_0x5348f1(0x166)]({'logs':_0x5025de,'hasPages':_0x310542,'totalLogs':_0x5b7ec0});}catch(_0x14f3f3){console['error'](_0x14f3f3),_0xe56003['sendStatus'](0x1f4)[_0x5348f1(0x196)]();}}),_0x4661d4[_0x44325b(0x1eb)](_0x44325b(0x2b4),[validatedRequest,_0x47b996['DdKqi'](flexUserRoleValid,[ROLES[_0x44325b(0x1b3)]])],async(_0x29055b,_0x4454ae)=>{const _0x117595=_0x44325b;try{await EventLogs[_0x117595(0x1eb)](),await EventLogs[_0x117595(0x218)]('event_logs_cleared',{},_0x4454ae?.[_0x117595(0x207)]?.[_0x117595(0x1b7)]?.['id']),_0x4454ae[_0x117595(0x166)]({'success':!![]});}catch(_0x264d10){console[_0x117595(0x245)](_0x264d10),_0x4454ae['sendStatus'](0x1f4)[_0x117595(0x196)]();}}),_0x4661d4[_0x44325b(0x1b4)](_0x44325b(0x2b9),[chatHistoryViewable,validatedRequest,_0x47b996['XPJRt'](flexUserRoleValid,[ROLES[_0x44325b(0x1b3)],ROLES['manager']])],async(_0x51e022,_0x476abf)=>{const _0x38a98a=_0x44325b;try{const {offset:offset=0x0,limit:limit=0x14}=_0x47b996[_0x38a98a(0x275)](reqBody,_0x51e022),_0x226468=await WorkspaceChats[_0x38a98a(0x256)]({},limit,offset*limit,{'id':_0x47b996[_0x38a98a(0x29c)]}),_0x103d39=await WorkspaceChats['count'](),_0x4f52ae=_0x47b996[_0x38a98a(0x251)](_0x103d39,_0x47b996[_0x38a98a(0x2a3)](offset,0x1)*limit);_0x476abf[_0x38a98a(0x206)](0xc8)[_0x38a98a(0x166)]({'chats':_0x226468,'hasPages':_0x4f52ae,'totalChats':_0x103d39});}catch(_0x413cb6){console[_0x38a98a(0x245)](_0x413cb6),_0x476abf['sendStatus'](0x1f4)[_0x38a98a(0x196)]();}}),_0x4661d4['delete'](_0x47b996[_0x44325b(0x1d0)],[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x1b3)],ROLES[_0x44325b(0x198)]])],async(_0x254ba2,_0x4f6888)=>{const _0xb3b382=_0x44325b;if(_0x47b996['VSurb']('yDAZb',_0xb3b382(0x1d9)))try{const {id:_0x328377}=_0x254ba2[_0xb3b382(0x1c6)];_0x47b996['svmqQ'](Number,_0x328377)===-0x1?await WorkspaceChats[_0xb3b382(0x1eb)]({},!![]):await WorkspaceChats[_0xb3b382(0x1eb)]({'id':Number(_0x328377)}),_0x4f6888[_0xb3b382(0x166)]({'success':!![],'error':null});}catch(_0x36187a){console[_0xb3b382(0x245)](_0x36187a),_0x4f6888['sendStatus'](0x1f4)[_0xb3b382(0x196)]();}else _0x46187d[_0xb3b382(0x245)](_0x47b996[_0xb3b382(0x2bb)],_0xe3d39),_0x515886[_0xb3b382(0x206)](0x1f4)[_0xb3b382(0x166)]({'success':!![],'message':_0x47b996[_0xb3b382(0x287)]});}),_0x4661d4['get'](_0x47b996[_0x44325b(0x27e)],[chatHistoryViewable,validatedRequest,flexUserRoleValid([ROLES['manager'],ROLES[_0x44325b(0x1b3)]])],async(_0x574bf6,_0x3e6130)=>{const _0x339477=_0x44325b;try{const {type:type=_0x47b996['ILFtS'],chatType:chatType=_0x47b996[_0x339477(0x18d)]}=_0x574bf6[_0x339477(0x26f)],{contentType:_0x421065,data:_0x2adf3f}=await exportChatsAsType(type,chatType);await EventLogs['logEvent']('exported_chats',{'type':type,'chatType':chatType},_0x3e6130[_0x339477(0x207)]['user']?.['id']),_0x3e6130[_0x339477(0x248)](_0x47b996[_0x339477(0x231)],_0x421065),_0x3e6130['status'](0xc8)[_0x339477(0x220)](_0x2adf3f);}catch(_0x4e76db){console['error'](_0x4e76db),_0x3e6130[_0x339477(0x2a6)](0x1f4)[_0x339477(0x196)]();}}),_0x4661d4['post'](_0x47b996[_0x44325b(0x1f1)],[validatedRequest],async(_0x235e64,_0x39781a)=>{const _0x51d323=_0x44325b,_0x44fce4={'osMAl':_0x51d323(0x232)};try{const _0x4dbe2a=await userFromSession(_0x235e64,_0x39781a),{username:_0xd48f4f,password:_0x50d186}=_0x47b996[_0x51d323(0x180)](reqBody,_0x235e64),_0x257986=_0x47b996[_0x51d323(0x2a2)](Number,_0x4dbe2a['id']);if(!_0x257986){_0x39781a[_0x51d323(0x206)](0x190)[_0x51d323(0x166)]({'success':![],'error':_0x47b996[_0x51d323(0x18a)]});return;}const _0x2ef488={};_0xd48f4f&&(_0x2ef488['username']=User[_0x51d323(0x25e)][_0x51d323(0x1b8)](_0x47b996[_0x51d323(0x20f)](String,_0xd48f4f)));_0x50d186&&(_0x2ef488[_0x51d323(0x262)]=String(_0x50d186));if(_0x47b996[_0x51d323(0x1d2)](Object[_0x51d323(0x195)](_0x2ef488)['length'],0x0)){_0x39781a[_0x51d323(0x206)](0x190)['json']({'success':![],'error':_0x47b996[_0x51d323(0x179)]});return;}const {success:_0x4b802f,error:_0xfd3c5e}=await User[_0x51d323(0x222)](_0x257986,_0x2ef488);_0x39781a[_0x51d323(0x206)](0xc8)[_0x51d323(0x166)]({'success':_0x4b802f,'error':_0xfd3c5e});}catch(_0x1e5b0a){_0x47b996[_0x51d323(0x25d)]==='rCfuo'?(console[_0x51d323(0x245)](_0x1e5b0a),_0x39781a[_0x51d323(0x2a6)](0x1f4)[_0x51d323(0x196)]()):(_0x1bd0d2[_0x51d323(0x245)](_0x44fce4['osMAl'],_0x43096d),_0x2cb37e['status'](0x1f4)[_0x51d323(0x166)]({'message':_0x51d323(0x1bc)}));}}),_0x4661d4[_0x44325b(0x1cf)](_0x47b996[_0x44325b(0x2ab)],[validatedRequest,_0x47b996[_0x44325b(0x217)](flexUserRoleValid,[ROLES[_0x44325b(0x14f)]])],async(_0x39b94f,_0x38c2f9)=>{const _0x35f950=_0x44325b,_0x956a9c={'FWKpG':_0x47b996[_0x35f950(0x18a)]};if(_0x47b996['OMpSX'](_0x47b996[_0x35f950(0x28c)],_0x35f950(0x235)))try{const _0x3f6889=await userFromSession(_0x39b94f,_0x38c2f9),_0x18b9af=await SlashCommandPresets[_0x35f950(0x2b1)](_0x3f6889?.['id']);_0x38c2f9[_0x35f950(0x206)](0xc8)[_0x35f950(0x166)]({'presets':_0x18b9af});}catch(_0x34d328){console['error'](_0x47b996[_0x35f950(0x1dc)],_0x34d328),_0x38c2f9['status'](0x1f4)['json']({'message':_0x47b996['uiPGG']});}else{_0x1e853f[_0x35f950(0x206)](0x190)['json']({'success':![],'error':_0x956a9c[_0x35f950(0x21c)]});return;}}),_0x4661d4[_0x44325b(0x1b4)]('/system/slash-command-presets',[validatedRequest,flexUserRoleValid([ROLES[_0x44325b(0x14f)]])],async(_0xd0d7db,_0xd19f72)=>{const _0x4d009d=_0x44325b;if(_0x4d009d(0x24e)!=='TnZzV')_0x21590a[_0x4d009d(0x245)](_0x47b996[_0x4d009d(0x261)],_0x491a80),_0x51d165[_0x4d009d(0x206)](0x1f4)[_0x4d009d(0x166)]({'message':_0x47b996[_0x4d009d(0x184)]});else try{const _0xa9d2b3=await _0x47b996[_0x4d009d(0x1f7)](userFromSession,_0xd0d7db,_0xd19f72),{command:_0x3524ea,prompt:_0x221cd9,description:_0x306f13}=reqBody(_0xd0d7db),_0x113190={'command':SlashCommandPresets[_0x4d009d(0x2a0)](_0x47b996[_0x4d009d(0x20f)](String,_0x3524ea)),'prompt':String(_0x221cd9),'description':_0x47b996[_0x4d009d(0x17d)](String,_0x306f13)},_0x2d3feb=await SlashCommandPresets['create'](_0xa9d2b3?.['id'],_0x113190);if(!_0x2d3feb)return _0xd19f72[_0x4d009d(0x206)](0x1f4)[_0x4d009d(0x166)]({'message':_0x47b996[_0x4d009d(0x168)]});_0xd19f72[_0x4d009d(0x206)](0xc9)[_0x4d009d(0x166)]({'preset':_0x2d3feb});}catch(_0x348d5a){_0x47b996['xdkiG'](_0x47b996[_0x4d009d(0x1bf)],'nMayP')?(console['error'](_0x4d009d(0x24d),_0x348d5a),_0xd19f72['status'](0x1f4)[_0x4d009d(0x166)]({'message':_0x4d009d(0x1bc)})):_0x3adcd9[_0x4d009d(0x262)]=_0x130aa4(_0x109a42);}}),_0x4661d4[_0x44325b(0x1b4)](_0x47b996[_0x44325b(0x185)],[validatedRequest,flexUserRoleValid([ROLES['all']])],async(_0x3b059c,_0x329a0b)=>{const _0x106a3d=_0x44325b;try{const _0x4ea672=await _0x47b996[_0x106a3d(0x17b)](userFromSession,_0x3b059c,_0x329a0b),{slashCommandId:_0x102e18}=_0x3b059c[_0x106a3d(0x1c6)],{command:_0x4b0b93,prompt:_0x431e49,description:_0x38eb10}=_0x47b996[_0x106a3d(0x1e1)](reqBody,_0x3b059c),_0x207049=await SlashCommandPresets['get']({'userId':_0x4ea672?.['id']??null,'id':Number(_0x102e18)});if(!_0x207049)return _0x329a0b['status'](0x194)[_0x106a3d(0x166)]({'message':_0x106a3d(0x170)});const _0x2375d3={'command':SlashCommandPresets[_0x106a3d(0x2a0)](_0x47b996['CrfiY'](String,_0x4b0b93)),'prompt':_0x47b996[_0x106a3d(0x1f9)](String,_0x431e49),'description':String(_0x38eb10)},_0x302fb7=await SlashCommandPresets['update'](Number(_0x102e18),_0x2375d3);if(!_0x302fb7)return _0x329a0b[_0x106a3d(0x2a6)](0x1a6);_0x329a0b[_0x106a3d(0x206)](0xc8)[_0x106a3d(0x166)]({'preset':{..._0x207049,..._0x2375d3}});}catch(_0x5dd495){console['error'](_0x47b996['Wuoqg'],_0x5dd495),_0x329a0b[_0x106a3d(0x206)](0x1f4)['json']({'message':_0x47b996[_0x106a3d(0x184)]});}}),_0x4661d4[_0x44325b(0x1eb)](_0x47b996['dRKzl'],[validatedRequest,_0x47b996[_0x44325b(0x17d)](flexUserRoleValid,[ROLES['all']])],async(_0x4a1f34,_0x26b4c6)=>{const _0x5be34f=_0x44325b;try{if('VYSng'!==_0x5be34f(0x17f)){_0x393952[_0x5be34f(0x2a6)](0x191)[_0x5be34f(0x196)]();return;}else{const {slashCommandId:_0x49998b}=_0x4a1f34['params'],_0x27ca6c=await userFromSession(_0x4a1f34,_0x26b4c6),_0x3d52aa=await SlashCommandPresets[_0x5be34f(0x1cf)]({'userId':_0x27ca6c?.['id']??null,'id':_0x47b996['rGyeV'](Number,_0x49998b)});if(!_0x3d52aa)return _0x26b4c6[_0x5be34f(0x206)](0x193)[_0x5be34f(0x166)]({'message':'Failed\x20to\x20delete\x20preset'});await SlashCommandPresets[_0x5be34f(0x1eb)](Number(_0x49998b)),_0x26b4c6['sendStatus'](0xcc);}}catch(_0x1732f7){console[_0x5be34f(0x245)](_0x47b996[_0x5be34f(0x191)],_0x1732f7),_0x26b4c6[_0x5be34f(0x206)](0x1f4)['json']({'message':_0x47b996['uiPGG']});}});}module[_0x1b90cf(0x1a7)]={'systemEndpoints':systemEndpoints};function _0x1c4e(){const _0xe12185=['olsUK','file','xHxFX','DBzuX','../models/eventLogs','FYzWV','No\x20logo\x20file\x20provided.','support_email','Preset\x20not\x20found','Error\x20processing\x20the\x20logo\x20upload:','No\x20updates\x20provided','VFwWa','KUqmw','seen_recovery_codes','LFucf','/system/custom-models','XfPGq','crbXS','cfoBU','COkyO','lbtkT','jiaWt','/system/pfp/:id','VYSng','zhTpX','YbbdG','../utils/http','footer_data','uiPGG','dRKzl','../utils/helpers/customModels','CCcWo','image/png','ZRyZX','nUarB','../models/systemSettings','sIOYG','BmCma','aLcMc','172McwpwZ','krlmg','aJnNh','theme','PTTSe','../utils/files/purgeDocument','keys','end','qFzGS','manager','oRUKa','XLExc','Invalid\x20message\x20format.\x20Expected\x20an\x20array\x20of\x20messages.','Content-Disposition,X-Is-Custom-Logo,Content-Type,Content-Length','vFMkO','QWBjx','Failed\x20to\x20remove\x20profile\x20picture.','Unknown\x20user','VFmgo','desc','rEdWL','FoONz','wISUS','30d','exports','BGJlO','HiaHD','ssqLR','iIlwB','cYTxt','eyrue','from','bcrypt','nKECM','stringify','currentLogoFilename','admin','post','FskqW','WnYot','user','username','ZRxtu','enabled_multi_user_mode','bsxHo','Internal\x20server\x20error','wlzmA','uuid','VaTwr','../utils/middleware/simpleSSOEnabled','iPKpx','hTxBp','Profile\x20picture\x20uploaded\x20successfully.','sDvis','Error\x20fetching\x20custom\x20app\x20name:','params','attachment;\x20filename=','NPAaJ','rTcBt','vArEv','Logo\x20removed\x20successfully.','YChZB','xJlJQ','currentSettings','get','ZwfSp','migrateApiKeysToMultiUser','tSCnI','/system/workspace-chats/:id','IUKfg','qrPZB','Failed\x20to\x20update\x20with\x20new\x20profile\x20picture.','Error\x20processing\x20the\x20profile\x20picture\x20removal:','/system/set-welcome-messages','TMRQJ','../models/slashCommandsPresets','SMpAa','lhriY','create','namespaceCount','AeryN','TkmjI','ksyly','50565BVebyF','ToBaa','OrUHb','MricK','frSrR','/system/generate-api-key','Error\x20fetching\x20welcome\x20messages:','/system/system-vectors','SOMiz','delete','FoKqe','[002]\x20Invalid\x20login\x20credentials.','uKumj','Error\x20uploading\x20the\x20logo.','../utils/files/logo','mIRGU','tehXC','/system/user','GgVJa','zbnbV','acceptedFileTypes','Afexf','where','amstR','sendTelemetry','XiaAQ','bKnaV','KfyKu','dIzEj','pfpFilename','workspace','join','Error\x20fetching\x20footer\x20data:','Welcome\x20messages\x20saved\x20successfully.','svmqQ','vTQFi','status','locals','Error\x20saving\x20the\x20welcome\x20messages.','../utils/files/multer','FzhsC','RKJWi','wxDZf','/system/update-env','/env-dump','AmUTE','IMDOb','ktUPF','tFiCn','xWIKq','/system/api-key','../models/user','Failed\x20to\x20enable\x20multi-user\x20mode.','MtWuX','logEvent','XPJRt','login_event','845874hpvJrU','FWKpG','dPcBE','/system/document-processing-status','/system/upload-logo','send','BfliH','update','Failed\x20to\x20update\x20with\x20new\x20logo.','failed_login_account_suspended','/system/multi-user-mode','suspended','message','../utils/EncryptionManager','rCfuo','Lgxtc','Could\x20not\x20find\x20an\x20API\x20Key.','fnkpA','getMessages','nNtbN','TDWci','vONdf','TbfLo','Error\x20updating\x20slash\x20command\x20preset:','lMreB','/system/custom-app-name','tOeKG','PFrml','BQalq','AfEAb','development','/system/remove-folder','zPDXG','Invalid\x20file\x20name.\x20Please\x20choose\x20a\x20different\x20file.','mIlEw','api_key_deleted','../utils/helpers/chat/convertTo','NODE_ENV','JWT_SECRET','encrypt','YPJwO','fcSrD','error','8qLiFfM','cYsxR','setHeader','OBivn','slug','writeHead','env','Error\x20creating\x20slash\x20command\x20preset:','TnZzV','eemoo','Content-Type','AikbK','zvDoE','JTjoV','gqiBH','rERwX','whereWithData','basename','/system/check-token','online','/system/support-email','HgxMB','Error\x20resetting\x20password:','eIbbA','validations','/system/remove-pfp','MMRri','RcHoD','password','Error\x20processing\x20the\x20logo\x20request:','jsonl','zRIHR','mZjtn','Invalid\x20path\x20name','/system/slash-command-presets','../utils/middleware/multiUserProtected','../models/temporaryAuthToken','CLObw','JqFpY','Utrkg','../storage/assets/pfp','query','IwItC','Error\x20processing\x20the\x20profile\x20picture\x20upload:','resolve','Error\x20fetching\x20support\x20email:','Error\x20removing\x20the\x20logo.','SsSlP','custom_app_name','Gpocn','config','/system/recover-account','../utils/collectorApi','dotenv','JzPOa','unlinkSync','GOXZS','Profile\x20picture\x20removed\x20successfully.','../models/workspaceChats','aRSHz','failed_login_invalid_temporary_auth_token','461718lxBvQC','BKGHS','lwoen','wOyou','qYxIm','aXGZX','LUebY','/system/upload-pfp','existsSync','vyZAP','api_key_created','../utils/helpers','failed_login_invalid_username','/system/welcome-messages','BzjGT','validate','Error\x20deleting\x20slash\x20command\x20preset:','3195534NJqJDB','uAhzN','compareSync','gBgHr','filterFields','UItsY','totalVectors','uEIat','olMaR','AUTH_TOKEN','/system/slash-command-presets/:slashCommandId','pjzhf','formatCommand','../models/telemetry','WsIVF','bEIZL','SXtvP','929728bEkntN','sendStatus','production','EsHob','/system/remove-document','../models/welcomeMessages','ZJCYy','RrHcn','yxfXF','hashSync','xIxIN','vzzKC','getUserPresets','/system/api-keys','3901583DCpXnO','/system/event-logs','/system/export-chats','dTHyX','3128655ptAirY','[004]\x20Account\x20suspended\x20by\x20admin.','/system/workspace-chats','EdrLs','dBznE','/ping','_updateSettings','all','mQONs','LhYHQ','Logo\x20uploaded\x20successfully.','[001]\x20An\x20error\x20occurred\x20while\x20validating\x20the\x20token:\x20','yKhbm','NRyhg','../utils/helpers/updateENV','/system/local-files','Multi-user\x20mode\x20is\x20already\x20enabled.','OFvcq','originalname','File\x20upload\x20failed.','TWUVb','Error\x20fetching\x20slash\x20command\x20presets:','../utils/middleware/chatHistoryViewable','SMdGY','isMultiUserMode','value','hPyPx','/system/footer-data','Unknown\x20IP','[001]\x20Invalid\x20login\x20credentials.','json','multiUserMode'];_0x1c4e=function(){return _0xe12185;};return _0x1c4e();}