function _0x22e9(_0x5aeaef,_0x27dec7){const _0x2aae2f=_0x2aae();return _0x22e9=function(_0x22e992,_0x19af35){_0x22e992=_0x22e992-0xf2;let _0x34afbd=_0x2aae2f[_0x22e992];return _0x34afbd;},_0x22e9(_0x5aeaef,_0x27dec7);}const _0x21ce2e=_0x22e9;(function(_0x329259,_0xa8b6e9){const _0x42b204=_0x22e9,_0x3264f9=_0x329259();while(!![]){try{const _0x25fac9=-parseInt(_0x42b204(0x159))/0x1+-parseInt(_0x42b204(0x16c))/0x2*(parseInt(_0x42b204(0x173))/0x3)+-parseInt(_0x42b204(0x14d))/0x4+parseInt(_0x42b204(0x12d))/0x5+-parseInt(_0x42b204(0x139))/0x6+parseInt(_0x42b204(0x11c))/0x7*(-parseInt(_0x42b204(0x13c))/0x8)+-parseInt(_0x42b204(0x169))/0x9*(-parseInt(_0x42b204(0x16b))/0xa);if(_0x25fac9===_0xa8b6e9)break;else _0x3264f9['push'](_0x3264f9['shift']());}catch(_0x38281d){_0x3264f9['push'](_0x3264f9['shift']());}}}(_0x2aae,0x61a29));const Model=require(_0x21ce2e(0x106))[_0x21ce2e(0x143)],moment=require(_0x21ce2e(0x119)),path=require(_0x21ce2e(0x176)),fs=require(_0x21ce2e(0xfb)),_=require(_0x21ce2e(0x11a)),assetHelper=require(_0x21ce2e(0x110)),Promise=require(_0x21ce2e(0x141));function _0x2aae(){const _0x1acb73=['assets.authorId','EdpBC','first','startsWith','config','BodrH','10511379lpuESa','patch','10Rzrpax','120hQIqxK','getAssetFromDb','toISOString','where','getLocalLocations','update','type','11787IwzXjP','copy','image/svg+xml','path','uploads','remove','deny','generateHash','AUYZe','XaRiL','object','query','logger','upload','fs-extra','utc','slug','authorId','filter','EPIPE','storage','assetData','string','bqblw','brWaa','objection','.dat','$beforeUpdate','ROOTPATH','Dibvx','knex','ADJqh','qJzwx','./assetFolders','sendStatus','../helpers/asset','code','resolve','ext','KddgM','RSXag','wgrpn','mimetype','hash','moment','lodash','relationMappings','7cLEpNB','getAssetFromCache','cache/','frgbG','sendFile','flushTempUploads','assets','createdAt','filename','vWsFp','uploaded','getHierarchy','originalname','SbvBa','finished','folderId','promisify','2646585fgPBKP','getAssetPath','scheduler','BelongsToOneRelation','sanitize-svg','readFile','updatedAt','OSqsQ','binary','ECONNABORTED','integer','assetPath','2038476FfoBeM','XQayZ','assetFolders.id','542680mSAOVW','vfrnw','map','user','error','bluebird','registerJob','Model','skipStorage','EOJTj','getAssetFromStorage','image','parse','QurAn','scanSVG','outputFile','rCKBk','2294520SGsPFO','constants','models','deleteAssetCache','join','jlzXM','dataPath','jsonSchema','users.id','size','move','bxfpg','80384kqKmQw','tableName','$beforeInsert','eBKWp','wUdWP','email','extname','RNZXL','WAtkF','igcSj'];_0x2aae=function(){return _0x1acb73;};return _0x2aae();}module['exports']=class Asset extends Model{static get[_0x21ce2e(0x15a)](){return'assets';}static get[_0x21ce2e(0x154)](){const _0x183611=_0x21ce2e,_0x5d2ddd={'OSqsQ':_0x183611(0xf7),'vfrnw':_0x183611(0x137),'RSXag':_0x183611(0x103)};return{'type':_0x5d2ddd[_0x183611(0x134)],'properties':{'id':{'type':_0x5d2ddd[_0x183611(0x13d)]},'filename':{'type':_0x183611(0x103)},'hash':{'type':_0x183611(0x103)},'ext':{'type':'string'},'kind':{'type':_0x183611(0x103)},'mime':{'type':_0x5d2ddd['RSXag']},'fileSize':{'type':_0x5d2ddd[_0x183611(0x13d)]},'metadata':{'type':'object'},'createdAt':{'type':_0x5d2ddd[_0x183611(0x115)]},'updatedAt':{'type':_0x5d2ddd[_0x183611(0x115)]}}};}static get[_0x21ce2e(0x11b)](){const _0x3a0cae=_0x21ce2e,_0x2c8263={'AUYZe':_0x3a0cae(0x155),'wUdWP':function(_0x227a80,_0x35f09d){return _0x227a80(_0x35f09d);},'WAtkF':'assets.folderId'};return{'author':{'relation':Model[_0x3a0cae(0x130)],'modelClass':require('./users'),'join':{'from':_0x3a0cae(0x163),'to':_0x2c8263[_0x3a0cae(0xf5)]}},'folder':{'relation':Model[_0x3a0cae(0x130)],'modelClass':_0x2c8263[_0x3a0cae(0x15d)](require,_0x3a0cae(0x10e)),'join':{'from':_0x2c8263[_0x3a0cae(0x161)],'to':_0x3a0cae(0x13b)}}};}async[_0x21ce2e(0x108)](_0x59af89,_0x574877){const _0x42af41=_0x21ce2e;await super[_0x42af41(0x108)](_0x59af89,_0x574877),this[_0x42af41(0x133)]=moment[_0x42af41(0xfc)]()[_0x42af41(0x16e)]();}async[_0x21ce2e(0x15b)](_0x4ca969){const _0x5c9405=_0x21ce2e;await super[_0x5c9405(0x15b)](_0x4ca969),this[_0x5c9405(0x123)]=moment[_0x5c9405(0xfc)]()[_0x5c9405(0x16e)](),this[_0x5c9405(0x133)]=moment[_0x5c9405(0xfc)]()[_0x5c9405(0x16e)]();}async['getAssetPath'](){const _0x3a2a9f=_0x21ce2e,_0x4fb45e={'BodrH':function(_0x108ea0,_0x592709){return _0x108ea0+_0x592709;}};let _0x5da72c=[];return this[_0x3a2a9f(0x12b)]&&(_0x5da72c=await WIKI[_0x3a2a9f(0x14f)]['assetFolders'][_0x3a2a9f(0x127)](this[_0x3a2a9f(0x12b)])),this[_0x3a2a9f(0x12b)]?_0x4fb45e[_0x3a2a9f(0x168)](_0x5da72c[_0x3a2a9f(0x13e)](_0x3a73b9=>_0x3a73b9[_0x3a2a9f(0xfd)])[_0x3a2a9f(0x151)]('/'),'/'+this[_0x3a2a9f(0x124)]):this[_0x3a2a9f(0x124)];}async[_0x21ce2e(0x150)](){const _0x1c8d20=_0x21ce2e;await fs[_0x1c8d20(0xf2)](path['resolve'](WIKI[_0x1c8d20(0x109)],WIKI[_0x1c8d20(0x167)][_0x1c8d20(0x153)],_0x1c8d20(0x11e)+this[_0x1c8d20(0x118)]+_0x1c8d20(0x107)));}static async[_0x21ce2e(0xfa)](_0x6ccd90){const _0x2a9285=_0x21ce2e,_0x31b9ce={'eBKWp':'image/','jMUDl':_0x2a9285(0x135),'rCKBk':function(_0x4c6fa1,_0x92011c){return _0x4c6fa1===_0x92011c;},'sFGbZ':_0x2a9285(0x175),'jlzXM':_0x2a9285(0xfa),'SbvBa':_0x2a9285(0x104)},_0xc6cd21=path[_0x2a9285(0x148)](_0x6ccd90[_0x2a9285(0x128)]),_0x5103d3=assetHelper[_0x2a9285(0xf4)](_0x6ccd90[_0x2a9285(0x138)]);let _0x29ae8f=await WIKI[_0x2a9285(0x14f)][_0x2a9285(0x122)]['query']()[_0x2a9285(0x16f)]({'hash':_0x5103d3,'folderId':_0x6ccd90[_0x2a9285(0x12b)]})[_0x2a9285(0x165)](),_0x2f87d5={'filename':_0x6ccd90[_0x2a9285(0x128)],'hash':_0x5103d3,'ext':_0xc6cd21[_0x2a9285(0x113)],'kind':_[_0x2a9285(0x166)](_0x6ccd90['mimetype'],_0x31b9ce[_0x2a9285(0x15c)])?_0x2a9285(0x147):_0x31b9ce['jMUDl'],'mime':_0x6ccd90[_0x2a9285(0x117)],'fileSize':_0x6ccd90[_0x2a9285(0x156)],'folderId':_0x6ccd90[_0x2a9285(0x12b)]};if(WIKI[_0x2a9285(0x167)][_0x2a9285(0x177)][_0x2a9285(0x14a)]&&_0x31b9ce[_0x2a9285(0x14c)](_0x6ccd90[_0x2a9285(0x117)],_0x31b9ce['sFGbZ'])){const _0xa924d9=await WIKI[_0x2a9285(0x12f)][_0x2a9285(0x142)]({'name':_0x2a9285(0x131),'immediate':!![],'worker':!![]},_0x6ccd90['path']);await _0xa924d9[_0x2a9285(0x12a)];}try{const _0x478cd4=await fs[_0x2a9285(0x132)](_0x6ccd90[_0x2a9285(0x176)]);_0x29ae8f?(_0x6ccd90['mode']==='upload'&&(_0x2f87d5[_0x2a9285(0xfe)]=_0x6ccd90['user']['id']),await WIKI[_0x2a9285(0x14f)][_0x2a9285(0x122)][_0x2a9285(0xf8)]()[_0x2a9285(0x16a)](_0x2f87d5)['findById'](_0x29ae8f['id']),await WIKI['models']['knex'](_0x2a9285(0x102))[_0x2a9285(0x16f)]({'id':_0x29ae8f['id']})[_0x2a9285(0x171)]({'data':_0x478cd4})):(_0x2f87d5[_0x2a9285(0xfe)]=_0x6ccd90['user']['id'],_0x29ae8f=await WIKI[_0x2a9285(0x14f)][_0x2a9285(0x122)][_0x2a9285(0xf8)]()['insert'](_0x2f87d5),await WIKI[_0x2a9285(0x14f)][_0x2a9285(0x10b)]('assetData')['insert']({'id':_0x29ae8f['id'],'data':_0x478cd4}));_0x31b9ce['rCKBk'](_0x6ccd90['mode'],_0x31b9ce[_0x2a9285(0x152)])?await fs[_0x2a9285(0x157)](_0x6ccd90['path'],path[_0x2a9285(0x112)](WIKI[_0x2a9285(0x109)],WIKI[_0x2a9285(0x167)][_0x2a9285(0x153)],'cache/'+_0x5103d3+_0x2a9285(0x107)),{'overwrite':!![]}):await fs[_0x2a9285(0x174)](_0x6ccd90[_0x2a9285(0x176)],path[_0x2a9285(0x112)](WIKI[_0x2a9285(0x109)],WIKI[_0x2a9285(0x167)][_0x2a9285(0x153)],'cache/'+_0x5103d3+_0x2a9285(0x107)),{'overwrite':!![]});if(!_0x6ccd90[_0x2a9285(0x144)]){if(_0x31b9ce[_0x2a9285(0x14c)](_0x31b9ce['SbvBa'],_0x31b9ce[_0x2a9285(0x129)]))await WIKI[_0x2a9285(0x14f)]['storage']['assetEvent']({'event':_0x2a9285(0x126),'asset':{..._0x29ae8f,'path':await _0x29ae8f[_0x2a9285(0x12e)](),'data':_0x478cd4,'authorId':_0x6ccd90[_0x2a9285(0x13f)]['id'],'authorName':_0x6ccd90[_0x2a9285(0x13f)]['name'],'authorEmail':_0x6ccd90[_0x2a9285(0x13f)][_0x2a9285(0x15e)]}});else return!![];}}catch(_0x4fd1bc){WIKI['logger']['warn'](_0x4fd1bc);}}static async['getAsset'](_0x515a67,_0x2c27b3){const _0x389fa5=_0x21ce2e,_0x521dfc={'hQszE':_0x389fa5(0x122),'KddgM':function(_0x2f0080,_0x3d0d34){return _0x2f0080===_0x3d0d34;},'hAlLk':function(_0x36289c,_0x52069b){return _0x36289c!==_0x52069b;},'zAzlb':_0x389fa5(0xf6),'qJzwx':function(_0x107f05,_0x5f5823){return _0x107f05===_0x5f5823;},'gYCTF':_0x389fa5(0x10a)};try{const _0x37804a=assetHelper['generateHash'](_0x515a67),_0x79bba8=path[_0x389fa5(0x112)](WIKI[_0x389fa5(0x109)],WIKI[_0x389fa5(0x167)][_0x389fa5(0x153)],_0x389fa5(0x11e)+_0x37804a+'.dat');if(await WIKI[_0x389fa5(0x14f)]['assets'][_0x389fa5(0x11d)](_0x515a67,_0x79bba8,_0x2c27b3)){if(_0x521dfc[_0x389fa5(0x114)]('jQHVq',_0x389fa5(0x13a)))return _0x521dfc['hQszE'];else return;}if(await WIKI['models']['assets'][_0x389fa5(0x146)](_0x515a67,_0x2c27b3)){if(_0x521dfc['hAlLk'](_0x521dfc['zAzlb'],'EjLUE'))return;else return;}await WIKI[_0x389fa5(0x14f)][_0x389fa5(0x122)][_0x389fa5(0x16d)](_0x515a67,_0x37804a,_0x79bba8,_0x2c27b3);}catch(_0x1fe023){if(_0x1fe023['code']==='ECONNABORTED'||_0x521dfc['KddgM'](_0x1fe023[_0x389fa5(0x111)],_0x389fa5(0x100))){if(_0x521dfc[_0x389fa5(0x10d)](_0x521dfc['gYCTF'],_0x389fa5(0x160))){if(_0x521dfc[_0x389fa5(0x114)](_0xd4e8b0[_0x389fa5(0x111)],_0x389fa5(0x136))||_0x1b6586['code']===_0x389fa5(0x100))return;_0x5166dd[_0x389fa5(0xf9)][_0x389fa5(0x140)](_0x292be0),_0x2ab9ed[_0x389fa5(0x10f)](0x1f4);}else return;}WIKI['logger']['error'](_0x1fe023),_0x2c27b3[_0x389fa5(0x10f)](0x1f4);}}static async[_0x21ce2e(0x11d)](_0x4a41d9,_0x2363c0,_0x51c73e){const _0x1f01f6=_0x21ce2e,_0x2975a8={'frgbG':_0x1f01f6(0x149),'wgrpn':function(_0x121552,_0x293963,_0x1192de){return _0x121552(_0x293963,_0x1192de);},'VPSpl':_0x1f01f6(0xf3)};try{await fs['access'](_0x2363c0,fs[_0x1f01f6(0x14e)]['R_OK']);}catch(_0x279fab){return _0x2975a8[_0x1f01f6(0x11f)]!==_0x2975a8[_0x1f01f6(0x11f)]?![]:![];}const _0x4ad2b7=Promise[_0x1f01f6(0x12c)](_0x51c73e[_0x1f01f6(0x120)],{'context':_0x51c73e});return _0x51c73e[_0x1f01f6(0x172)](path[_0x1f01f6(0x15f)](_0x4a41d9)),await _0x2975a8[_0x1f01f6(0x116)](_0x4ad2b7,_0x2363c0,{'dotfiles':_0x2975a8['VPSpl']}),!![];}static async[_0x21ce2e(0x146)](_0x85588f,_0x35183a){const _0x3a3e14=_0x21ce2e,_0x6d5d22=await WIKI[_0x3a3e14(0x14f)][_0x3a3e14(0x101)][_0x3a3e14(0x170)]({'asset':{'path':_0x85588f}});for(let _0x22e678 of _[_0x3a3e14(0xff)](_0x6d5d22,_0x3268ae=>Boolean(_0x3268ae[_0x3a3e14(0x176)]))){const _0x3e15b7=await WIKI[_0x3a3e14(0x14f)][_0x3a3e14(0x122)][_0x3a3e14(0x11d)](_0x85588f,_0x22e678[_0x3a3e14(0x176)],_0x35183a);if(_0x3e15b7)return!![];}return![];}static async[_0x21ce2e(0x16d)](_0x2c9db2,_0x384c9c,_0x3bbcb1,_0x2c635c){const _0x17b697=_0x21ce2e,_0x34c364={'ADJqh':_0x17b697(0x118),'brWaa':_0x17b697(0x102),'vWsFp':function(_0x53988d,_0x3ff2c4){return _0x53988d===_0x3ff2c4;},'bxfpg':_0x17b697(0x145)},_0x522150=await WIKI[_0x17b697(0x14f)]['assets'][_0x17b697(0xf8)]()[_0x17b697(0x16f)](_0x34c364[_0x17b697(0x10c)],_0x384c9c)[_0x17b697(0x165)]();if(_0x522150){if(_0x17b697(0x164)!==_0x17b697(0x162)){const _0x4a3f28=await WIKI[_0x17b697(0x14f)]['knex'](_0x34c364[_0x17b697(0x105)])[_0x17b697(0x16f)]('id',_0x522150['id'])[_0x17b697(0x165)]();_0x2c635c['type'](_0x522150[_0x17b697(0x113)]),_0x2c635c['send'](_0x4a3f28['data']),await fs[_0x17b697(0x14b)](_0x3bbcb1,_0x4a3f28['data']);}else return;}else{if(_0x34c364[_0x17b697(0x125)](_0x34c364[_0x17b697(0x158)],_0x17b697(0x145)))_0x2c635c[_0x17b697(0x10f)](0x194);else return;}}static async[_0x21ce2e(0x121)](){const _0x443803=_0x21ce2e;return fs['emptyDir'](path[_0x443803(0x112)](WIKI[_0x443803(0x109)],WIKI['config'][_0x443803(0x153)],'uploads'));}};