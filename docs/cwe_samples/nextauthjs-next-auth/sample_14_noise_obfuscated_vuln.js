const _0x4f5aab=_0x1331;function _0x1331(_0x52ac6b,_0x92b6a){const _0x7adab7=_0x7ada();return _0x1331=function(_0x1331ae,_0x13a94d){_0x1331ae=_0x1331ae-0xb3;let _0x850dfc=_0x7adab7[_0x1331ae];return _0x850dfc;},_0x1331(_0x52ac6b,_0x92b6a);}function _0x7ada(){const _0x29a269=['bogus_type','request','NKdjl','[Success]\x20Update\x20a\x20discount\x20code','[Fail]\x20Add\x20an\x20expired\x20discount\x20code','productOptions','nOogb','value','AIyPq','504ZTFYwP','FTgtY','[Fail]\x20Update\x20a\x20discount\x20with\x20same\x20code\x20as\x20existing','before','../helper','SJThe','[Fail]\x20Add\x20a\x20bogus\x20code','send','productPrice','MMhqA','expect','gIHIk','rZdOY','discount','code','amount','message','/admin/settings/discount/create','[Success]\x20Add\x20valid\x20percent\x20discount','session','48FTYAsV','csrf','eYbnT','8754330LpVbBB','Discount\x20code\x20applied','TEST_CODE_99','/product/addtocart','XcBzj','Successfully\x20saved','discounts','post','format','[Success]\x20Create\x20a\x20new\x20discount\x20code','should\x20be\x20equal\x20to\x20one\x20of\x20the\x20allowed\x20values','BRWRu','184AHFxsk','YKIXJ','body','DD/MM/YYYY\x20HH:mm','Discount\x20code\x20already\x20exists','Discount\x20code\x20created\x20successfully','xKBEV','gTWgE','CcSVx','44947bAAFlo','/checkout/adddiscountcode','iGhas','users','1484838tDHzAr','1347624uTHKob','TJmBA','bkeHt','CPceu','set','95440YZXEGL','nbGaT','[Fail]\x20Create\x20a\x20new\x20discount\x20code\x20with\x20invalid\x20type','discountCode','deleteMany','csrf-token','111092Kedepm','days','sessions','totalCartDiscount','riTrc','LaGdM','fzTKP','RgaIR','moment','apiKey','Discount\x20is\x20expired','37855VqXDMa','[Success]\x20Add\x20valid\x20amount\x20discount','fail','/admin/settings/discount/update','yjLpt','stringify','AgETj','add','_id','Discount\x20code\x20is\x20invalid\x20or\x20expired','deepEqual','valid_10_amount_code','XcDTd','qwjBh','products','length','VOFmr','totalCartAmount','some_bogus_code','toArray','sgmdT','RDyeg'];_0x7ada=function(){return _0x29a269;};return _0x7ada();}(function(_0x3265be,_0x5e3a59){const _0x3f2bce=_0x1331,_0x156a5c=_0x3265be();while(!![]){try{const _0x14e32f=parseInt(_0x3f2bce(0xc5))/0x1+parseInt(_0x3f2bce(0xbf))/0x2+parseInt(_0x3f2bce(0x109))/0x3*(parseInt(_0x3f2bce(0xcb))/0x4)+parseInt(_0x3f2bce(0xd6))/0x5*(parseInt(_0x3f2bce(0xf5))/0x6)+-parseInt(_0x3f2bce(0xbb))/0x7*(parseInt(_0x3f2bce(0x118))/0x8)+-parseInt(_0x3f2bce(0xc0))/0x9+-parseInt(_0x3f2bce(0x10c))/0xa;if(_0x14e32f===_0x5e3a59)break;else _0x156a5c['push'](_0x156a5c['shift']());}catch(_0x9dd02c){_0x156a5c['push'](_0x156a5c['shift']());}}}(_0x7ada,0xb5f7b));import{serial as _0x1932ef}from'ava';const {runBefore,g}=require(_0x4f5aab(0xf9)),moment=require(_0x4f5aab(0xd3));_0x1932ef[_0x4f5aab(0xf8)](async()=>{await runBefore();}),_0x1932ef(_0x4f5aab(0xd7),async _0x493822=>{const _0x43d3b8=_0x4f5aab,_0x23a31f={'MMhqA':_0x43d3b8(0x10d)};await g['db'][_0x43d3b8(0xcd)][_0x43d3b8(0xc9)]({},{}),await g['request']['post'](_0x43d3b8(0x10f))[_0x43d3b8(0xfc)]({'productId':g[_0x43d3b8(0xe4)][0x0]['_id'],'productQuantity':0x1,'productOptions':JSON['stringify'](g[_0x43d3b8(0xe4)][0x0][_0x43d3b8(0xf1)])})[_0x43d3b8(0xff)](0xc8);const _0x3f8edc=await g['request']['post']('/checkout/adddiscountcode')[_0x43d3b8(0xfc)]({'discountCode':g[_0x43d3b8(0x112)][0x0][_0x43d3b8(0x103)]})[_0x43d3b8(0xff)](0xc8);_0x493822[_0x43d3b8(0xe0)](_0x3f8edc[_0x43d3b8(0xb4)][_0x43d3b8(0x105)],_0x23a31f[_0x43d3b8(0xfe)]);const _0x2fec93=await g['db'][_0x43d3b8(0xcd)]['find']({})[_0x43d3b8(0xe9)]();(!_0x2fec93||_0x2fec93[_0x43d3b8(0xe5)]===0x0)&&_0x493822['fail']();const _0x19a57e=g['products'][0x0]['productPrice']*0x1,_0x31cce9=_0x2fec93[0x0][_0x43d3b8(0x108)];_0x493822[_0x43d3b8(0xe0)](_0x31cce9['discountCode'],g[_0x43d3b8(0x112)][0x0][_0x43d3b8(0x103)]),_0x493822[_0x43d3b8(0xe0)](_0x31cce9[_0x43d3b8(0xce)],g['discounts'][0x0][_0x43d3b8(0xf3)]),_0x493822[_0x43d3b8(0xe0)](_0x31cce9['totalCartAmount'],_0x19a57e-g[_0x43d3b8(0x112)][0x0][_0x43d3b8(0xf3)]);}),_0x1932ef(_0x4f5aab(0x107),async _0x480505=>{const _0x4cb279=_0x4f5aab,_0x3c80a9={'XcDTd':_0x4cb279(0xbc),'yjLpt':function(_0x1b3305,_0xb25cd9){return _0x1b3305*_0xb25cd9;},'SJThe':function(_0x467e65,_0x5854d3){return _0x467e65-_0x5854d3;}};await g['db']['sessions'][_0x4cb279(0xc9)]({},{}),await g[_0x4cb279(0xed)][_0x4cb279(0x113)]('/product/addtocart')[_0x4cb279(0xfc)]({'productId':g[_0x4cb279(0xe4)][0x0][_0x4cb279(0xde)],'productQuantity':0x1,'productOptions':JSON[_0x4cb279(0xdb)](g['products'][0x0]['productOptions'])})[_0x4cb279(0xff)](0xc8);const _0x59eac1=await g[_0x4cb279(0xed)][_0x4cb279(0x113)](_0x3c80a9[_0x4cb279(0xe2)])[_0x4cb279(0xfc)]({'discountCode':g[_0x4cb279(0x112)][0x1][_0x4cb279(0x103)]})[_0x4cb279(0xff)](0xc8);_0x480505[_0x4cb279(0xe0)](_0x59eac1[_0x4cb279(0xb4)]['message'],'Discount\x20code\x20applied');const _0xce0ac5=await g['db'][_0x4cb279(0xcd)]['find']({})[_0x4cb279(0xe9)]();(!_0xce0ac5||_0xce0ac5['length']===0x0)&&_0x480505[_0x4cb279(0xd8)]();const _0xd15afb=_0x3c80a9[_0x4cb279(0xda)](g[_0x4cb279(0xe4)][0x0][_0x4cb279(0xfd)],0x1),_0x1a17f4=g['discounts'][0x1][_0x4cb279(0xf3)]/0x64*_0xd15afb,_0xd261e8=_0xce0ac5[0x0][_0x4cb279(0x108)];_0x480505[_0x4cb279(0xe0)](_0xd261e8[_0x4cb279(0xc8)],g[_0x4cb279(0x112)][0x1][_0x4cb279(0x103)]),_0x480505[_0x4cb279(0xe0)](_0xd261e8[_0x4cb279(0xe7)],_0x3c80a9[_0x4cb279(0xfa)](_0xd15afb,_0x1a17f4)),_0x480505['deepEqual'](_0xd261e8[_0x4cb279(0xce)],_0x1a17f4);}),_0x1932ef(_0x4f5aab(0xf0),async _0x2fd60d=>{const _0x223a03=_0x4f5aab,_0x235d03={'CcSVx':_0x223a03(0xbc)};await g[_0x223a03(0xed)][_0x223a03(0x113)]('/product/addtocart')[_0x223a03(0xfc)]({'productId':g['products'][0x0]['_id'],'productQuantity':0x1,'productOptions':JSON['stringify'](g['products'][0x0][_0x223a03(0xf1)])})['expect'](0xc8);const _0x250a54=await g['request']['post'](_0x235d03[_0x223a03(0xba)])[_0x223a03(0xfc)]({'discountCode':g['discounts'][0x2][_0x223a03(0x103)]})[_0x223a03(0xff)](0x190);_0x2fd60d[_0x223a03(0xe0)](_0x250a54[_0x223a03(0xb4)][_0x223a03(0x105)],_0x223a03(0xd5));}),_0x1932ef('[Fail]\x20Add\x20a\x20future\x20discount\x20code',async _0x3e6f70=>{const _0x457cb4=_0x4f5aab,_0x2b7740={'BRWRu':'Discount\x20is\x20expired'};await g[_0x457cb4(0xed)][_0x457cb4(0x113)](_0x457cb4(0x10f))[_0x457cb4(0xfc)]({'productId':g[_0x457cb4(0xe4)][0x0][_0x457cb4(0xde)],'productQuantity':0x1,'productOptions':JSON[_0x457cb4(0xdb)](g[_0x457cb4(0xe4)][0x0][_0x457cb4(0xf1)])})['expect'](0xc8);const _0x4df7ee=await g[_0x457cb4(0xed)]['post'](_0x457cb4(0xbc))[_0x457cb4(0xfc)]({'discountCode':g['discounts'][0x3][_0x457cb4(0x103)]})[_0x457cb4(0xff)](0x190);_0x3e6f70[_0x457cb4(0xe0)](_0x4df7ee['body'][_0x457cb4(0x105)],_0x2b7740[_0x457cb4(0x117)]);}),_0x1932ef(_0x4f5aab(0xfb),async _0x2ac6d9=>{const _0x164c30=_0x4f5aab,_0x1937ab={'fzTKP':_0x164c30(0x10f),'sgmdT':_0x164c30(0xdf)};await g[_0x164c30(0xed)][_0x164c30(0x113)](_0x1937ab[_0x164c30(0xd1)])[_0x164c30(0xfc)]({'productId':g[_0x164c30(0xe4)][0x0]['_id'],'productQuantity':0x1,'productOptions':JSON['stringify'](g[_0x164c30(0xe4)][0x0][_0x164c30(0xf1)])})['expect'](0xc8);const _0x232408=await g[_0x164c30(0xed)][_0x164c30(0x113)]('/checkout/adddiscountcode')[_0x164c30(0xfc)]({'discountCode':_0x164c30(0xe8)})['set'](_0x164c30(0xca),g[_0x164c30(0x10a)])[_0x164c30(0xff)](0x190);_0x2ac6d9[_0x164c30(0xe0)](_0x232408['body']['message'],_0x1937ab[_0x164c30(0xea)]);}),_0x1932ef(_0x4f5aab(0x115),async _0x1c2bf=>{const _0x47f345=_0x4f5aab,_0xa54299={'RDyeg':_0x47f345(0x106),'xKBEV':'TEST_CODE_5','NKdjl':'amount','LaGdM':function(_0x1aca4f){return _0x1aca4f();},'rJEOW':_0x47f345(0xd4),'jjAnD':_0x47f345(0xca)},_0x4e80a1=await g['request'][_0x47f345(0x113)](_0xa54299[_0x47f345(0xeb)])['send']({'code':_0xa54299[_0x47f345(0xb8)],'type':_0xa54299[_0x47f345(0xee)],'value':0xa,'start':_0xa54299[_0x47f345(0xd0)](moment)['add'](0x1,'days')[_0x47f345(0x114)]('DD/MM/YYYY\x20HH:mm'),'end':moment()['add'](0x7,_0x47f345(0xcc))['format']('DD/MM/YYYY\x20HH:mm')})[_0x47f345(0xc4)](_0xa54299['rJEOW'],g[_0x47f345(0xbe)][0x0]['apiKey'])[_0x47f345(0xc4)](_0xa54299['jjAnD'],g[_0x47f345(0x10a)])[_0x47f345(0xff)](0xc8);_0x1c2bf[_0x47f345(0xe0)](_0x4e80a1[_0x47f345(0xb4)][_0x47f345(0x105)],_0x47f345(0xb7));}),_0x1932ef(_0x4f5aab(0xc7),async _0x12fbd3=>{const _0x247656=_0x4f5aab,_0x519457={'bkeHt':'/admin/settings/discount/create','nOogb':'TEST_CODE_1','FTgtY':function(_0x3c4141){return _0x3c4141();},'iGhas':_0x247656(0xcc),'xAbRt':_0x247656(0xb5),'nbGaT':function(_0x11ec50){return _0x11ec50();},'UoUOf':_0x247656(0xca)},_0x20a30a=await g['request'][_0x247656(0x113)](_0x519457[_0x247656(0xc2)])['send']({'code':_0x519457[_0x247656(0xf2)],'type':_0x247656(0xec),'value':0xa,'start':_0x519457[_0x247656(0xf6)](moment)['add'](0x1,_0x519457[_0x247656(0xbd)])[_0x247656(0x114)](_0x519457['xAbRt']),'end':_0x519457[_0x247656(0xc6)](moment)[_0x247656(0xdd)](0x7,_0x247656(0xcc))['format'](_0x247656(0xb5))})['set']('apiKey',g[_0x247656(0xbe)][0x0][_0x247656(0xd4)])['set'](_0x519457['UoUOf'],g[_0x247656(0x10a)])['expect'](0x190);_0x12fbd3[_0x247656(0xe0)](_0x20a30a[_0x247656(0xb4)][0x0][_0x247656(0x105)],_0x247656(0x116));}),_0x1932ef('[Fail]\x20Create\x20a\x20new\x20discount\x20code\x20with\x20existing\x20code',async _0x155b2f=>{const _0x12de7c=_0x4f5aab,_0xfc330c={'Xpjov':_0x12de7c(0x106),'riTrc':'amount','VOFmr':function(_0x42e673){return _0x42e673();},'qwjBh':'days','RgaIR':_0x12de7c(0xb5),'AIyPq':function(_0x434728){return _0x434728();},'eYbnT':_0x12de7c(0xd4)},_0x1937e5=await g[_0x12de7c(0xed)][_0x12de7c(0x113)](_0xfc330c['Xpjov'])[_0x12de7c(0xfc)]({'code':_0x12de7c(0xe1),'type':_0xfc330c[_0x12de7c(0xcf)],'value':0xa,'start':_0xfc330c[_0x12de7c(0xe6)](moment)[_0x12de7c(0xdd)](0x1,_0xfc330c[_0x12de7c(0xe3)])[_0x12de7c(0x114)](_0xfc330c[_0x12de7c(0xd2)]),'end':_0xfc330c[_0x12de7c(0xf4)](moment)[_0x12de7c(0xdd)](0x7,'days')[_0x12de7c(0x114)](_0xfc330c['RgaIR'])})[_0x12de7c(0xc4)](_0xfc330c[_0x12de7c(0x10b)],g[_0x12de7c(0xbe)][0x0][_0x12de7c(0xd4)])[_0x12de7c(0xc4)]('csrf-token',g['csrf'])[_0x12de7c(0xff)](0x190);_0x155b2f[_0x12de7c(0xe0)](_0x1937e5[_0x12de7c(0xb4)][_0x12de7c(0x105)],_0x12de7c(0xb6));}),_0x1932ef(_0x4f5aab(0xef),async _0x46e7f3=>{const _0x480920=_0x4f5aab,_0x3a4d51={'gTWgE':function(_0x2c20db){return _0x2c20db();},'XcBzj':_0x480920(0xb5),'CPceu':function(_0x4916cd){return _0x4916cd();},'zfOYf':'apiKey'},_0x4b800d=await g[_0x480920(0xed)][_0x480920(0x113)](_0x480920(0xd9))[_0x480920(0xfc)]({'discountId':g[_0x480920(0x112)][0x0][_0x480920(0xde)],'code':_0x480920(0x10e),'type':_0x480920(0x104),'value':0x14,'start':_0x3a4d51[_0x480920(0xb9)](moment)[_0x480920(0xdd)](0x1,'days')['format'](_0x3a4d51[_0x480920(0x110)]),'end':_0x3a4d51[_0x480920(0xc3)](moment)[_0x480920(0xdd)](0x7,'days')[_0x480920(0x114)](_0x480920(0xb5))})['set'](_0x3a4d51['zfOYf'],g[_0x480920(0xbe)][0x0][_0x480920(0xd4)])[_0x480920(0xff)](0xc8);_0x46e7f3['deepEqual'](_0x4b800d[_0x480920(0xb4)][_0x480920(0x102)][_0x480920(0xf3)],0x14),_0x46e7f3['deepEqual'](_0x4b800d[_0x480920(0xb4)]['message'],_0x480920(0x111));}),_0x1932ef(_0x4f5aab(0xf7),async _0x20e3c5=>{const _0x2dc644=_0x4f5aab,_0x30bf15={'rZdOY':_0x2dc644(0xd9),'TJmBA':_0x2dc644(0x10e),'gIHIk':'amount','AgETj':_0x2dc644(0xb5),'WlnmK':'apiKey','YKIXJ':'Discount\x20code\x20already\x20exists'},_0x5aacea=await g['request'][_0x2dc644(0x113)](_0x30bf15[_0x2dc644(0x101)])[_0x2dc644(0xfc)]({'discountId':g[_0x2dc644(0x112)][0x1][_0x2dc644(0xde)],'code':_0x30bf15[_0x2dc644(0xc1)],'type':_0x30bf15[_0x2dc644(0x100)],'value':0x14,'start':moment()[_0x2dc644(0xdd)](0x1,_0x2dc644(0xcc))[_0x2dc644(0x114)](_0x30bf15[_0x2dc644(0xdc)]),'end':moment()[_0x2dc644(0xdd)](0x7,'days')['format'](_0x30bf15['AgETj'])})[_0x2dc644(0xc4)](_0x30bf15['WlnmK'],g[_0x2dc644(0xbe)][0x0]['apiKey'])[_0x2dc644(0xff)](0x190);_0x20e3c5[_0x2dc644(0xe0)](_0x5aacea[_0x2dc644(0xb4)][_0x2dc644(0x105)],_0x30bf15[_0x2dc644(0xb3)]);});