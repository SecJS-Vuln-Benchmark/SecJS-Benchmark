const _0x465260=_0x57e8;(function(_0x427cc1,_0x4abfe4){const _0x1c52dc=_0x57e8,_0x292bc0=_0x427cc1();while(!![]){try{const _0x20bbfd=-parseInt(_0x1c52dc(0xa1))/0x1+parseInt(_0x1c52dc(0xc4))/0x2+-parseInt(_0x1c52dc(0xf9))/0x3+-parseInt(_0x1c52dc(0x9d))/0x4+-parseInt(_0x1c52dc(0x10b))/0x5*(-parseInt(_0x1c52dc(0xce))/0x6)+-parseInt(_0x1c52dc(0xc7))/0x7+-parseInt(_0x1c52dc(0x106))/0x8*(-parseInt(_0x1c52dc(0x88))/0x9);if(_0x20bbfd===_0x4abfe4)break;else _0x292bc0['push'](_0x292bc0['shift']());}catch(_0x5a98d4){_0x292bc0['push'](_0x292bc0['shift']());}}}(_0x5de6,0xa9bc2));const {agentProvider,fixtureManager,matchers,mockManager}=require('../../utils/e2e-framework'),{anyEtag,anyErrorId,anyContentVersion,anyString}=matchers,assert=require('assert/strict'),sinon=require(_0x465260(0xe4)),escapeRegExp=require(_0x465260(0x115)),should=require(_0x465260(0xac)),ObjectId=require(_0x465260(0xa6))['default'],testUtils=require(_0x465260(0x92)),models=require(_0x465260(0x95)),logging=require(_0x465260(0x8f));function testCleanedSnapshot(_0x21664d,_0x1e5556){const _0x55b954=_0x465260,_0xa55d19={'XHmhz':function(_0x47fe8e,_0x5c58a0){return _0x47fe8e(_0x5c58a0);}};for(const [_0x556523,_0x3a4443]of Object[_0x55b954(0xad)](_0x1e5556)){_0x21664d=_0x21664d[_0x55b954(0xb0)](new RegExp(_0xa55d19[_0x55b954(0xeb)](escapeRegExp,_0x556523),'g'),_0x3a4443);}should({'html':_0x21664d})['matchSnapshot']();}function _0x57e8(_0x5dc046,_0x4b48e5){const _0x5de68f=_0x5de6();return _0x57e8=function(_0x57e86f,_0x43897d){_0x57e86f=_0x57e86f-0x85;let _0x28543c=_0x5de68f[_0x57e86f];return _0x28543c;},_0x57e8(_0x5dc046,_0x4b48e5);}function _0x5de6(){const _0x550c64=['eql','createPost','10humWMD','{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[[\x22email\x22,{\x22html\x22:\x22<p>Hey\x20{first_name\x20\x5c\x22there\x5c\x22}\x20{unknown}</p><p><strong>Welcome\x20to\x20your\x20first\x20Ghost\x20email!</strong></p>\x22}],[\x22email\x22,{\x22html\x22:\x22<p>Another\x20email\x20card\x20with\x20a\x20similar\x20replacement,\x20{first_name,\x20\x5c\x22see?\x5c\x22}</p>\x22}]],\x22markups\x22:[],\x22sections\x22:[[10,0],[1,\x22p\x22,[[0,[],0,\x22This\x20is\x20the\x20actual\x20post\x20content...\x22]]],[10,1],[1,\x22p\x22,[]]]}','Dujyz','oOUhD','hXrIn','xTGeo','plaintext','can\x20read\x20post\x20email\x20preview\x20with\x20email\x20card\x20and\x20replacements','assert','email_previews/posts/','lodash/escapeRegExp','Post\x20with\x20email-only\x20card','As\x20Owner','VHdAH','7194708LtqokD','gAcWf','ICDEa','nAOYP','uses\x20the\x20newsletter\x20provided\x20through\x20?newsletter=slug','mDcTq','jITIr','@tryghost/logging','coTzn','stub','../../utils','toHexString','MIvdF','../../../core/server/models/index','matchSnapshot','ayIDh','matchHeaderSnapshot','TGUsg','loginAsEditor','cannot\x20send\x20test\x20email','MJGkx','2562528HUfsVb','ISvvs','Post','Should\x20use\x20a\x20non-default\x20newsletter\x20for\x20this\x20test','339215TUriTW','whfBX','KaoJu','expectStatus','tPZTe','bson-objectid','init','{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[],\x22markups\x22:[[\x22a\x22,[\x22href\x22,\x22https://ghost.org\x22]]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Testing\x20\x22],[0,[0],1,\x22links\x22],[0,[],0,\x22\x20in\x20email\x20excerpt\x20and\x20apostrophes\x20\x27\x22]]]]}','oZqRY','dGJkZ','Mrlpi','should','entries','slug','pRnFo','replace','Read','error','loginAsAuthor','OpyRq','bAyDr','get','email-only-card','has\x20custom\x20content\x20transformations\x20for\x20email\x20compatibility','test@ghost.org','<p>This\x20is\x20the\x20actual\x20post\x20content...</p>','expect','CHWUa','loginAsOwner','can\x20read\x20post\x20email\x20preview\x20with\x20fields','requested-newsletter-uuid','Newsletter','name','YdNil','sRVMz','1320754PqqzfD','calledOnce','dONfx','8728482ceNwZV','doesNotMatch','uuid','wlNwG','fEocO','LKlsJ','jxSaq','2720004RvrWPP','zmqsr','Email\x20Preview\x20API','rrpwm','cRkoR','DataGenerator','loginAsContributor','expectEmptyBody','yDUUi','html','can\x20send\x20test\x20email','GaCFn','getDefaultNewsletter','HuMPn','/?newsletter=','newsletters','posts','match','EfgnU','body','As\x20Contributor','As\x20Admin','sinon','DBOun','draft','ZyPyh','matchBodySnapshot','dLwPo','post','XHmhz','mMZnZ','restore','GCFoD','OxkCN','LlZtF','SZENt','tXoxd','email_previews','EeRHA','EXoaR','fXADY','forKnex','aMmfA','3129822sMBDQv','AaaKH','fLFjx','ldIwA','This\x20is\x20the\x20actual\x20post\x20content...','rKeHT','eWwLl','dtTdV','As\x20Author','ebBzw','xoBPN','add','uses\x20the\x20posts\x20newsletter\x20by\x20default','24BgBuVZ','d52c42ae-2755-455c-80ec-70b2ec55c904','nvpzV'];_0x5de6=function(){return _0x550c64;};return _0x5de6();}const matchEmailPreviewBody={'email_previews':[{'html':anyString,'plaintext':anyString}]};describe(_0x465260(0xd0),function(){const _0x36c3e1=_0x465260,_0x21e1f4={'mDcTq':'users','jITIr':_0x36c3e1(0xdd),'pRnFo':_0x36c3e1(0xde),'fXADY':'email_previews/posts/abcd1234abcd1234abcd1234/','EfgnU':'Post\x20with\x20email-only\x20card','eWwLl':_0x36c3e1(0xa8),'yDUUi':_0x36c3e1(0xfd),'nvpzV':function(_0x131fea){return _0x131fea();},'EXoaR':_0x36c3e1(0xb7),'bAyDr':_0x36c3e1(0xba),'GaCFn':function(_0x564202,_0x1f1319){return _0x564202===_0x1f1319;},'LlZtF':_0x36c3e1(0x10c),'tXoxd':_0x36c3e1(0xe6),'hXrIn':_0x36c3e1(0xc1),'ZyPyh':function(_0x2af847,_0x135777,_0x2925a4){return _0x2af847(_0x135777,_0x2925a4);},'ronZI':'can\x27t\x20retrieve\x20for\x20non\x20existent\x20post','ANEkx':_0x36c3e1(0xbe),'ayIDh':function(_0x2aca5a,_0x44ac1f,_0x14f516){return _0x2aca5a(_0x44ac1f,_0x14f516);},'nAOYP':_0x36c3e1(0x112),'ebBzw':function(_0x564695,_0x437395,_0xd1dc7f){return _0x564695(_0x437395,_0xd1dc7f);},'zlOeb':_0x36c3e1(0x8c),'jxSaq':_0x36c3e1(0xc9),'AaaKH':function(_0x246bcf,_0xeaa6c,_0x4e09fc){return _0x246bcf(_0xeaa6c,_0x4e09fc);},'ldIwA':_0x36c3e1(0x100),'dLwPo':_0x36c3e1(0xb9),'SZENt':function(_0x2d2342,_0x6095e2){return _0x2d2342(_0x6095e2);},'fEocO':function(_0x191fb7,_0x5eab6d){return _0x191fb7!==_0x5eab6d;},'wWOZQ':_0x36c3e1(0x110),'YdNil':function(_0x15dc0b,_0x521c34){return _0x15dc0b(_0x521c34);},'rKeHT':_0x36c3e1(0xd8),'ISvvs':function(_0x592df0,_0x1b774c,_0x2a7df1){return _0x592df0(_0x1b774c,_0x2a7df1);},'MIvdF':_0x36c3e1(0x10e),'tdrHL':function(_0x39475a,_0x174dc4){return _0x39475a(_0x174dc4);},'aMmfA':_0x36c3e1(0xe3),'OxkCN':function(_0x4136ee,_0x2923e8,_0x5cf260){return _0x4136ee(_0x2923e8,_0x5cf260);},'coTzn':'As\x20Editor','dGJkZ':function(_0xffaca4,_0x3e1235,_0x2b6304){return _0xffaca4(_0x3e1235,_0x2b6304);},'KaoJu':_0x36c3e1(0xe2)};let _0x3dad35;afterEach(function(){const _0xa02069=_0x36c3e1;mockManager[_0xa02069(0xed)](),sinon['restore']();}),beforeEach(function(){mockManager['mockMailgun']();}),_0x21e1f4['tdrHL'](before,async function(){const _0x50d946=_0x36c3e1;_0x3dad35=await agentProvider['getAdminAPIAgent'](),await fixtureManager[_0x50d946(0xa7)](_0x21e1f4[_0x50d946(0x8d)],_0x21e1f4[_0x50d946(0x8e)],_0x21e1f4[_0x50d946(0xaf)]),await _0x3dad35[_0x50d946(0xbd)]();}),describe(_0x36c3e1(0xb1),function(){const _0x59eb4e=_0x36c3e1,_0x16155b={'usQvS':function(_0x5e9a8e,_0x9a6fa4,_0x1f4eb2){return _0x5e9a8e(_0x9a6fa4,_0x1f4eb2);},'Dujyz':'uuid','whfBX':_0x59eb4e(0xbf),'LOKBN':function(_0x2514d8,_0x4d396c){const _0x225f6a=_0x59eb4e;return _0x21e1f4[_0x225f6a(0xd9)](_0x2514d8,_0x4d396c);},'XhzbU':_0x59eb4e(0xb4),'cRkoR':function(_0x5b88a0,_0x5d2d6e,_0x295a6a){return _0x5b88a0(_0x5d2d6e,_0x295a6a);},'CHWUa':function(_0x2cece2){const _0x4c31ac=_0x59eb4e;return _0x21e1f4[_0x4c31ac(0x108)](_0x2cece2);},'tPZTe':_0x21e1f4[_0x59eb4e(0xf0)],'mMZnZ':_0x21e1f4[_0x59eb4e(0xf2)],'xoBPN':_0x59eb4e(0xb7),'oZqRY':_0x21e1f4['bAyDr'],'dONfx':'d52c42ae-2755-455c-80ec-70b2ec55c904','VhVIO':_0x21e1f4[_0x59eb4e(0x10f)],'EeRHA':function(_0x2c44e8,_0x19e694,_0x39a3b9){return _0x2c44e8(_0x19e694,_0x39a3b9);},'wlNwG':function(_0x1dfc58,_0x59229b,_0x1ad0ae){return _0x21e1f4['ZyPyh'](_0x1dfc58,_0x59229b,_0x1ad0ae);}};_0x21e1f4[_0x59eb4e(0xe7)](it,_0x21e1f4['ronZI'],async function(){const _0x36eece=_0x59eb4e;await _0x3dad35[_0x36eece(0xb6)](_0x21e1f4[_0x36eece(0xf6)])['expectStatus'](0x194)[_0x36eece(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x36eece(0xe8)]({'errors':[{'id':anyErrorId}]});}),it(_0x21e1f4['ANEkx'],async function(){const _0x5e5b87=_0x59eb4e,_0x568d96=await models[_0x5e5b87(0xc0)][_0x5e5b87(0xda)]();await _0x3dad35[_0x5e5b87(0xb6)](_0x5e5b87(0x114)+fixtureManager[_0x5e5b87(0xb6)](_0x21e1f4[_0x5e5b87(0xaf)],0x0)['id']+'/')[_0x5e5b87(0xa4)](0xc8)[_0x5e5b87(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x5e5b87(0xe8)](matchEmailPreviewBody)[_0x5e5b87(0xbb)](({body:_0x52a1c0})=>{const _0x11672d=_0x5e5b87;_0x16155b['usQvS'](testCleanedSnapshot,_0x52a1c0[_0x11672d(0xf3)][0x0]['html'],{[_0x568d96[_0x11672d(0xb6)](_0x16155b[_0x11672d(0x10d)])]:_0x11672d(0xbf)}),testCleanedSnapshot(_0x52a1c0[_0x11672d(0xf3)][0x0][_0x11672d(0x111)],{[_0x568d96[_0x11672d(0xb6)](_0x16155b[_0x11672d(0x10d)])]:_0x16155b[_0x11672d(0xa2)]});});}),_0x21e1f4[_0x59eb4e(0x97)](it,_0x21e1f4[_0x59eb4e(0x8b)],async function(){const _0x5941b5=_0x59eb4e,_0x6d41ca={'nFfEn':function(_0xfc16cd,_0x527259){return _0x16155b['LOKBN'](_0xfc16cd,_0x527259);},'gAcWf':_0x16155b['XhzbU'],'DBOun':_0x5941b5(0xc9),'ICDEa':_0x16155b[_0x5941b5(0xa2)],'Mrlpi':function(_0x4396fd,_0x34482c,_0x3b8a93){const _0x29de08=_0x5941b5;return _0x16155b[_0x29de08(0xd2)](_0x4396fd,_0x34482c,_0x3b8a93);}},_0x259ff0=await models[_0x5941b5(0xc0)]['getDefaultNewsletter'](),_0x289b69=testUtils[_0x5941b5(0xd3)][_0x5941b5(0xf7)][_0x5941b5(0x10a)]({'id':_0x16155b[_0x5941b5(0xbc)](ObjectId)[_0x5941b5(0x93)](),'title':_0x5941b5(0x85),'slug':_0x5941b5(0xb7),'mobiledoc':_0x16155b[_0x5941b5(0xa5)],'html':_0x5941b5(0xba),'plaintext':_0x5941b5(0xfd),'status':_0x16155b[_0x5941b5(0xec)],'uuid':_0x5941b5(0x107),'published_at':new Date(0x0)});await models[_0x5941b5(0x9f)][_0x5941b5(0x104)](_0x289b69,{'context':{'internal':!![]}}),await _0x3dad35[_0x5941b5(0xb6)](_0x5941b5(0x114)+_0x289b69['id']+'/')[_0x5941b5(0xa4)](0xc8)[_0x5941b5(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x5941b5(0xe8)](matchEmailPreviewBody)[_0x5941b5(0xbb)](({body:_0x585fc2})=>{const _0x530b01=_0x5941b5;_0x6d41ca['nFfEn'](_0x6d41ca[_0x530b01(0x89)],_0x530b01(0xb4))?(testCleanedSnapshot(_0x585fc2[_0x530b01(0xf3)][0x0][_0x530b01(0xd7)],{[_0x259ff0[_0x530b01(0xb6)](_0x6d41ca[_0x530b01(0xe5)])]:_0x6d41ca[_0x530b01(0x8a)]}),_0x6d41ca[_0x530b01(0xab)](testCleanedSnapshot,_0x585fc2[_0x530b01(0xf3)][0x0][_0x530b01(0x111)],{[_0x259ff0[_0x530b01(0xb6)]('uuid')]:_0x6d41ca['ICDEa']})):_0x2fd409['mockMailgun']();});}),_0x21e1f4[_0x59eb4e(0x102)](it,_0x59eb4e(0xb8),async function(){const _0x21a419=_0x59eb4e,_0x58308d={'zmqsr':function(_0x18e975,_0x41c1da,_0x19d84c){return _0x18e975(_0x41c1da,_0x19d84c);},'TGUsg':_0x21a419(0xbf),'YiQqw':function(_0x277e47,_0x229551,_0x264704){return _0x277e47(_0x229551,_0x264704);}};if(_0x21a419(0x87)!==_0x21a419(0xdb)){const _0x79886d=await models[_0x21a419(0xc0)][_0x21a419(0xda)](),_0x184930=testUtils[_0x21a419(0xd3)]['forKnex'][_0x21a419(0x10a)]({'id':ObjectId()[_0x21a419(0x93)](),'title':_0x21a419(0x85),'slug':_0x16155b[_0x21a419(0x103)],'mobiledoc':'{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[],\x22markups\x22:[[\x22a\x22,[\x22href\x22,\x22https://ghost.org\x22]]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Testing\x20\x22],[0,[0],1,\x22links\x22],[0,[],0,\x22\x20in\x20email\x20excerpt\x20and\x20apostrophes\x20\x27\x22]]]]}','html':_0x16155b[_0x21a419(0xa9)],'plaintext':'This\x20is\x20the\x20actual\x20post\x20content...','status':_0x16155b['mMZnZ'],'uuid':_0x16155b[_0x21a419(0xc6)],'published_at':new Date(0x0)});await models[_0x21a419(0x9f)][_0x21a419(0x104)](_0x184930,{'context':{'internal':!![]}}),await _0x3dad35[_0x21a419(0xb6)]('email_previews/posts/'+_0x184930['id']+'/')['expectStatus'](0xc8)[_0x21a419(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x21a419(0xe8)](matchEmailPreviewBody)[_0x21a419(0xbb)](({body:_0x4e74c6})=>{const _0x42b6eb=_0x21a419;assert[_0x42b6eb(0xc8)](_0x4e74c6[_0x42b6eb(0xf3)][0x0]['html'],/Testing links in email excerpt and apostrophes &apos;/),assert['match'](_0x4e74c6[_0x42b6eb(0xf3)][0x0][_0x42b6eb(0xd7)],/Testing links in email excerpt and apostrophes &#39;/),testCleanedSnapshot(_0x4e74c6[_0x42b6eb(0xf3)][0x0][_0x42b6eb(0xd7)],{[_0x79886d[_0x42b6eb(0xb6)](_0x16155b['Dujyz'])]:_0x42b6eb(0xbf)}),_0x16155b[_0x42b6eb(0xd2)](testCleanedSnapshot,_0x4e74c6['email_previews'][0x0]['plaintext'],{[_0x79886d[_0x42b6eb(0xb6)](_0x16155b[_0x42b6eb(0x10d)])]:_0x16155b['whfBX']});});}else _0x408999[_0x21a419(0xc8)](_0x243aa4[_0x21a419(0xf3)][0x0]['html'],/Testing links in email excerpt and apostrophes &apos;/),_0x129001[_0x21a419(0xdf)](_0x372d9e[_0x21a419(0xf3)][0x0][_0x21a419(0xd7)],/Testing links in email excerpt and apostrophes &#39;/),_0x58308d[_0x21a419(0xcf)](_0x5cf2b8,_0x3e27d4[_0x21a419(0xf3)][0x0][_0x21a419(0xd7)],{[_0x467f0e['get'](_0x21a419(0xc9))]:_0x58308d[_0x21a419(0x99)]}),_0x58308d['YiQqw'](_0x5393aa,_0x482f0b[_0x21a419(0xf3)][0x0]['plaintext'],{[_0x3b2f73[_0x21a419(0xb6)](_0x21a419(0xc9))]:_0x58308d[_0x21a419(0x99)]});}),_0x21e1f4[_0x59eb4e(0x97)](it,_0x59eb4e(0x105),async function(){const _0x398b15=_0x59eb4e,_0x270dbb={'LKlsJ':_0x398b15(0xc1),'MJGkx':function(_0x13ce81,_0xd7c4ff,_0x14701f){return _0x13ce81(_0xd7c4ff,_0x14701f);}},_0x563e2a=await models[_0x398b15(0xc0)][_0x398b15(0xda)](),_0x19a1c0=fixtureManager[_0x398b15(0xb6)](_0x398b15(0xdd),0x0);_0x563e2a['id']['should']['not'][_0x398b15(0x109)](_0x19a1c0['id'],_0x398b15(0xa0));const _0x172204=testUtils[_0x398b15(0xd3)][_0x398b15(0xf7)][_0x398b15(0x10a)]({'id':ObjectId()['toHexString'](),'title':_0x21e1f4[_0x398b15(0xe0)],'slug':'email-only-card','mobiledoc':_0x21e1f4[_0x398b15(0xff)],'html':_0x398b15(0xba),'plaintext':_0x21e1f4[_0x398b15(0xd6)],'status':'scheduled','uuid':'d52c42ae-2755-455c-80ec-70b2ec55c904','newsletter_id':_0x19a1c0['id'],'published_at':new Date(0x0)});await models[_0x398b15(0x9f)]['add'](_0x172204,{'context':{'internal':!![]}}),await _0x3dad35[_0x398b15(0xb6)]('email_previews/posts/'+_0x172204['id']+'/')[_0x398b15(0xa4)](0xc8)[_0x398b15(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x398b15(0xe8)](matchEmailPreviewBody)['expect'](({body:_0x1896b9})=>{const _0x23f579=_0x398b15;assert[_0x23f579(0xc8)](_0x1896b9[_0x23f579(0xf3)][0x0][_0x23f579(0xd7)],new RegExp(_0x563e2a[_0x23f579(0xb6)](_0x270dbb[_0x23f579(0xcc)]))),assert[_0x23f579(0xdf)](_0x1896b9['email_previews'][0x0]['html'],new RegExp(_0x19a1c0['name'])),_0x270dbb[_0x23f579(0x9c)](testCleanedSnapshot,_0x1896b9[_0x23f579(0xf3)][0x0][_0x23f579(0xd7)],{[_0x19a1c0['uuid']]:'requested-newsletter-uuid'}),testCleanedSnapshot(_0x1896b9['email_previews'][0x0]['plaintext'],{[_0x19a1c0[_0x23f579(0xc9)]]:_0x23f579(0xbf)});});}),it(_0x21e1f4['zlOeb'],async function(){const _0x71482b=_0x59eb4e,_0x272dd7=await models[_0x71482b(0xc0)]['getDefaultNewsletter'](),_0x26fa3f=fixtureManager[_0x71482b(0xb6)](_0x21e1f4['jITIr'],0x0);_0x26fa3f['id']['should']['not'][_0x71482b(0x109)](_0x272dd7['id'],'Should\x20use\x20a\x20non-default\x20newsletter\x20for\x20this\x20test');const _0x3c6817=testUtils[_0x71482b(0xd3)]['forKnex'][_0x71482b(0x10a)]({'id':_0x21e1f4[_0x71482b(0x108)](ObjectId)[_0x71482b(0x93)](),'title':_0x71482b(0x85),'slug':_0x21e1f4[_0x71482b(0xf5)],'mobiledoc':'{\x22version\x22:\x220.3.1\x22,\x22atoms\x22:[],\x22cards\x22:[],\x22markups\x22:[[\x22a\x22,[\x22href\x22,\x22https://ghost.org\x22]]],\x22sections\x22:[[1,\x22p\x22,[[0,[],0,\x22Testing\x20\x22],[0,[0],1,\x22links\x22],[0,[],0,\x22\x20in\x20email\x20excerpt\x20and\x20apostrophes\x20\x27\x22]]]]}','html':_0x21e1f4[_0x71482b(0xb5)],'plaintext':_0x21e1f4[_0x71482b(0xd6)],'status':_0x71482b(0xe6),'uuid':_0x71482b(0x107),'published_at':new Date(0x0)});await models['Post'][_0x71482b(0x104)](_0x3c6817,{'context':{'internal':!![]}}),await _0x3dad35[_0x71482b(0xb6)](_0x71482b(0x114)+_0x3c6817['id']+_0x71482b(0xdc)+_0x26fa3f[_0x71482b(0xae)])[_0x71482b(0xa4)](0xc8)[_0x71482b(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x71482b(0xe8)](matchEmailPreviewBody)[_0x71482b(0xbb)](({body:_0x749862})=>{const _0x583492=_0x71482b;assert[_0x583492(0xc8)](_0x749862['email_previews'][0x0][_0x583492(0xd7)],new RegExp(_0x272dd7['get'](_0x16155b['VhVIO']))),assert[_0x583492(0xdf)](_0x749862[_0x583492(0xf3)][0x0][_0x583492(0xd7)],new RegExp(_0x26fa3f[_0x583492(0xc1)])),_0x16155b[_0x583492(0xf4)](testCleanedSnapshot,_0x749862[_0x583492(0xf3)][0x0][_0x583492(0xd7)],{[_0x26fa3f[_0x583492(0xc9)]]:_0x16155b[_0x583492(0xa2)]}),_0x16155b[_0x583492(0xca)](testCleanedSnapshot,_0x749862['email_previews'][0x0][_0x583492(0x111)],{[_0x26fa3f[_0x583492(0xc9)]]:'requested-newsletter-uuid'});});});}),describe(_0x36c3e1(0x86),function(){it('can\x20send\x20test\x20email',async function(){const _0x329307=_0x57e8,_0x48d2f3={'fLFjx':function(_0x38bf02,_0x24172e,_0x479e7e){return _0x38bf02(_0x24172e,_0x479e7e);},'rrpwm':_0x21e1f4[_0x329307(0xcd)],'GCFoD':function(_0x20b86c,_0x4ec987,_0x2f53db){const _0x43d4a9=_0x329307;return _0x21e1f4[_0x43d4a9(0xfa)](_0x20b86c,_0x4ec987,_0x2f53db);}};_0x21e1f4[_0x329307(0xfc)]===_0x329307(0x100)?await _0x3dad35[_0x329307(0xea)](_0x329307(0x114)+fixtureManager['get'](_0x21e1f4[_0x329307(0xaf)],0x0)['id']+'/')[_0x329307(0xe1)]({'emails':[_0x21e1f4['dLwPo']]})[_0x329307(0xa4)](0xcc)[_0x329307(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x329307(0xd5)]():(_0x48d2f3[_0x329307(0xfb)](_0x2bd6ab,_0x4071de[_0x329307(0xf3)][0x0][_0x329307(0xd7)],{[_0x202c1e[_0x329307(0xb6)](_0x48d2f3[_0x329307(0xd1)])]:'requested-newsletter-uuid'}),_0x48d2f3[_0x329307(0xee)](_0x274dd1,_0xca576a[_0x329307(0xf3)][0x0][_0x329307(0x111)],{[_0x19cf06['get'](_0x329307(0xc9))]:_0x329307(0xbf)}));});}),describe(_0x21e1f4[_0x36c3e1(0xf8)],function(){const _0x58f025=_0x36c3e1;if(_0x21e1f4[_0x58f025(0xcb)](_0x58f025(0xc3),_0x21e1f4['wWOZQ']))_0x21e1f4[_0x58f025(0xc2)](before,async function(){await _0x3dad35['loginAsAdmin']();}),_0x21e1f4['ebBzw'](it,_0x21e1f4[_0x58f025(0xfe)],async function(){const _0x3c40d2=_0x58f025;await _0x3dad35['post']('email_previews/posts/'+fixtureManager[_0x3c40d2(0xb6)]('posts',0x0)['id']+'/')['body']({'emails':[_0x3c40d2(0xb9)]})['expectStatus'](0xcc)[_0x3c40d2(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})['expectEmptyBody']();});else{for(const [_0x357431,_0x5ab501]of _0x4bb7a3[_0x58f025(0xad)](_0x293c52)){_0x3b62da=_0x351dbc[_0x58f025(0xb0)](new _0x2bba53(_0x21e1f4[_0x58f025(0xf1)](_0x55ded6,_0x357431),'g'),_0x5ab501);}_0x59e8ce({'html':_0x11b4ca})[_0x58f025(0x96)]();}}),_0x21e1f4[_0x36c3e1(0xef)](describe,_0x21e1f4[_0x36c3e1(0x90)],function(){const _0x1dc489=_0x36c3e1;_0x21e1f4['SZENt'](before,async function(){const _0x474d20=_0x57e8;await _0x3dad35[_0x474d20(0x9a)]();}),_0x21e1f4[_0x1dc489(0x9e)](it,_0x21e1f4[_0x1dc489(0xfe)],async function(){const _0x31a438=_0x1dc489;await _0x3dad35[_0x31a438(0xea)]('email_previews/posts/'+fixtureManager[_0x31a438(0xb6)](_0x31a438(0xde),0x0)['id']+'/')[_0x31a438(0xe1)]({'emails':['test@ghost.org']})[_0x31a438(0xa4)](0xcc)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})['expectEmptyBody']();});}),_0x21e1f4[_0x36c3e1(0xaa)](describe,_0x36c3e1(0x101),function(){const _0x5d66d8=_0x36c3e1;_0x21e1f4[_0x5d66d8(0xf1)](before,async function(){const _0x5c5907=_0x5d66d8;await _0x3dad35[_0x5c5907(0xb3)]();}),_0x21e1f4[_0x5d66d8(0x9e)](it,_0x5d66d8(0x9b),async function(){const _0x4321bf=_0x5d66d8,_0x2198f0=sinon[_0x4321bf(0x91)](logging,'error');await _0x3dad35[_0x4321bf(0xea)](_0x4321bf(0x114)+fixtureManager['get'](_0x21e1f4[_0x4321bf(0xaf)],0x0)['id']+'/')[_0x4321bf(0xe1)]({'emails':[_0x4321bf(0xb9)]})[_0x4321bf(0xa4)](0x193)[_0x4321bf(0x98)]({'content-version':anyContentVersion,'etag':anyEtag})[_0x4321bf(0xe8)]({'errors':[{'id':anyErrorId}]}),sinon[_0x4321bf(0x113)][_0x4321bf(0xc5)](_0x2198f0);});}),describe(_0x21e1f4[_0x36c3e1(0xa3)],function(){const _0x2906cd=_0x36c3e1;before(async function(){const _0x42d47b=_0x57e8;await _0x3dad35[_0x42d47b(0xd4)]();}),it(_0x2906cd(0x9b),async function(){const _0x29485d=_0x2906cd;if(_0x21e1f4[_0x29485d(0x94)]!==_0x21e1f4['MIvdF'])_0x286d27['restore'](),_0x4c015e['restore']();else{const _0xa74bd9=sinon['stub'](logging,_0x29485d(0xb2));await _0x3dad35[_0x29485d(0xea)](_0x29485d(0x114)+fixtureManager[_0x29485d(0xb6)](_0x29485d(0xde),0x0)['id']+'/')[_0x29485d(0xe1)]({'emails':[_0x21e1f4[_0x29485d(0xe9)]]})[_0x29485d(0xa4)](0x193)['matchHeaderSnapshot']({'content-version':anyContentVersion,'etag':anyEtag})[_0x29485d(0xe8)]({'errors':[{'id':anyErrorId}]}),sinon[_0x29485d(0x113)][_0x29485d(0xc5)](_0xa74bd9);}});});});