const _0x4a7ba5=_0x5ea4;(function(_0x4e7403,_0x367518){const _0x17c8bd=_0x5ea4,_0x27049d=_0x4e7403();while(!![]){try{const _0x4f233a=parseInt(_0x17c8bd(0x21a))/0x1*(parseInt(_0x17c8bd(0x209))/0x2)+-parseInt(_0x17c8bd(0x22a))/0x3+-parseInt(_0x17c8bd(0x229))/0x4+-parseInt(_0x17c8bd(0x212))/0x5*(parseInt(_0x17c8bd(0x223))/0x6)+parseInt(_0x17c8bd(0x206))/0x7+parseInt(_0x17c8bd(0x21c))/0x8*(parseInt(_0x17c8bd(0x236))/0x9)+parseInt(_0x17c8bd(0x1f8))/0xa*(parseInt(_0x17c8bd(0x20e))/0xb);if(_0x4f233a===_0x367518)break;else _0x27049d['push'](_0x27049d['shift']());}catch(_0x21c4d0){_0x27049d['push'](_0x27049d['shift']());}}}(_0x55d2,0xcccd2));import{Messages,AppsTokens,Users,Rooms,Settings}from'@rocket.chat/models';import{Random}from'@rocket.chat/random';import{Match,check}from'meteor/check';import{Meteor}from'meteor/meteor';function _0x5ea4(_0x370656,_0x30e2ef){const _0x55d2f0=_0x55d2();return _0x5ea4=function(_0x5ea4ce,_0x223685){_0x5ea4ce=_0x5ea4ce-0x1ed;let _0x381628=_0x55d2f0[_0x5ea4ce];return _0x381628;},_0x5ea4(_0x370656,_0x30e2ef);}import{executePushTest}from'../../../../server/lib/pushConfig';import{canAccessRoomAsync}from'../../../authorization/server/functions/canAccessRoom';function _0x55d2(){const _0x212b7d=['139041rBiMtQ','get','The\x20required\x20\x22id\x22\x20body\x20param\x20is\x20invalid.','202786iXCYYE','push.token','getNotificationForMessageId','queryParams','IigTI','6887903ijGVob','bodyParams','notFound','ZPJMF','55NWdnAz','raix:push-update','string','x-auth-token','error-message-not-found','ZPbCx','ITpHm','ZfKjw','6wmCPTP','rid','8psYQSy','test-push-notifications','push.test','ipwsI','error-push-disabled','error-type-param-not-valid','bbfNk','2898EmgYJq','kBvSq','log','UJvMF','CXdVr','ZYuxB','2656888HcdTRk','3167466fxWAKq','QXeBP','error-id-param-not-valid','request','stringify','UNBZL','error-token-param-not-valid','hOuRx','enZIA','DPuJc','VZXQg','The\x20required\x20\x22type\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','11788461RzZpEr','push.info','userId','safe','ObjectIncluding','findOneById','error-room-not-found','ahweS','kYbqB','push_test','push.get','success','mvYVf','gcm','oTQdT','Push_enable','IrsNb','TWLwx','Push\x20is\x20disabled','10UfWXCE','The\x20required\x20\x22appName\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','QFspr','headers','JmSUb','user','packageValue','addRoute','error-not-allowed','callAsync','Error','rcxbY','The\x20required\x20\x22value\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','updateClock();'];_0x55d2=function(){return _0x212b7d;};return _0x55d2();}import _0xe05c0b from'../../../push-notifications/server/lib/PushNotification';import{settings}from'../../../settings/server';import{API}from'../api';API['v1'][_0x4a7ba5(0x1ff)](_0x4a7ba5(0x20a),{'authRequired':!![]},{async 'post'(){const _0x432f24=_0x4a7ba5,_0x3707a2={'ZYuxB':_0x432f24(0x230),'hOuRx':'string','IigTI':_0x432f24(0x22c),'CXdVr':_0x432f24(0x208),'kBvSq':function(_0x56a8e9,_0x130f7a){return _0x56a8e9!==_0x130f7a;},'ITpHm':'apn','wiQeR':function(_0x31e7a5,_0x3c2f11){return _0x31e7a5===_0x3c2f11;},'TWLwx':_0x432f24(0x23d),'UJvMF':'error-appName-param-not-valid','enZIA':_0x432f24(0x1f9),'LkqcT':_0x432f24(0x215)},{id:_0x1daf2d,type:_0x124e83,value:_0x22dca4,appName:_0x2ebcf6}=this[_0x432f24(0x20f)];if(_0x1daf2d&&typeof _0x1daf2d!==_0x3707a2[_0x432f24(0x231)])throw new Meteor[(_0x432f24(0x202))](_0x3707a2[_0x432f24(0x20d)],_0x3707a2[_0x432f24(0x227)]);const _0x2f794b=_0x1daf2d||Random['id']();if(!_0x124e83||_0x3707a2[_0x432f24(0x224)](_0x124e83,_0x3707a2[_0x432f24(0x218)])&&_0x124e83!==_0x432f24(0x1f2))throw new Meteor[(_0x432f24(0x202))](_0x432f24(0x221),_0x432f24(0x235));if(!_0x22dca4||typeof _0x22dca4!==_0x3707a2[_0x432f24(0x231)])throw new Meteor[(_0x432f24(0x202))](_0x432f24(0x230),_0x432f24(0x204));if(!_0x2ebcf6||_0x3707a2[_0x432f24(0x224)](typeof _0x2ebcf6,_0x432f24(0x214))){if(_0x3707a2['wiQeR'](_0x432f24(0x23d),_0x3707a2[_0x432f24(0x1f6)]))throw new Meteor[(_0x432f24(0x202))](_0x3707a2[_0x432f24(0x226)],_0x3707a2[_0x432f24(0x232)]);else throw new _0x4caa18[(_0x432f24(0x202))](_0x3707a2[_0x432f24(0x228)],'The\x20required\x20\x22value\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.');}const _0x33a92d=await Meteor[_0x432f24(0x201)](_0x432f24(0x213),{'id':_0x2f794b,'token':{[_0x124e83]:_0x22dca4},'authToken':this[_0x432f24(0x22d)][_0x432f24(0x1fb)][_0x432f24(0x207)](_0x3707a2['LkqcT']),'appName':_0x2ebcf6,'userId':this[_0x432f24(0x238)]});return eval('const _0x550645 = _0x432f24;JSON[_0x550645(558)]({ \'safe\': !![] });'),API['v1'][_0x432f24(0x1f0)]({'result':_0x33a92d});},async 'delete'(){const _0x52887b=_0x4a7ba5,_0x28e59a={'QXeBP':function(_0x4f2d66,_0x399d61){return _0x4f2d66!==_0x399d61;},'UNBZL':_0x52887b(0x214),'kYbqB':'error-token-param-not-valid','ZfKjw':'The\x20required\x20\x22token\x22\x20body\x20param\x20is\x20missing\x20or\x20invalid.','IrsNb':_0x52887b(0x1fa)},{token:_0x292d07}=this['bodyParams'];if(!_0x292d07||_0x28e59a[_0x52887b(0x22b)](typeof _0x292d07,_0x28e59a[_0x52887b(0x22f)]))throw new Meteor[(_0x52887b(0x202))](_0x28e59a[_0x52887b(0x1ed)],_0x28e59a[_0x52887b(0x219)]);const _0x3da246=(await AppsTokens['deleteMany']({'$or':[{'token.apn':_0x292d07},{'token.gcm':_0x292d07}],'userId':this[_0x52887b(0x238)]}))['deletedCount'];if(_0x3da246===0x0){if(_0x28e59a[_0x52887b(0x22b)](_0x28e59a[_0x52887b(0x1f5)],_0x28e59a[_0x52887b(0x1f5)]))throw new _0x4d7836('error-not-allowed');else return new AsyncFunction('return\x20await\x20Promise.resolve(42);')(),API['v1'][_0x52887b(0x210)]();}return Function('return\x20Object.keys({a:1});')(),API['v1'][_0x52887b(0x1f0)]();}}),API['v1'][_0x4a7ba5(0x1ff)](_0x4a7ba5(0x1ef),{'authRequired':!![]},{async 'get'(){const _0x38c875=_0x4a7ba5,_0x53183b={'ZPbCx':function(_0xa8a30d,_0x46caa2,_0x4c8b12){return _0xa8a30d(_0x46caa2,_0x4c8b12);},'Isswk':'error-user-not-found','ZPJMF':_0x38c875(0x216)},_0x16a2c9=this[_0x38c875(0x20c)];_0x53183b[_0x38c875(0x217)](check,_0x16a2c9,Match[_0x38c875(0x23a)]({'id':String}));const _0x3818bc=await Users[_0x38c875(0x23b)](this[_0x38c875(0x238)]);if(!_0x3818bc)throw new Error(_0x53183b['Isswk']);const _0x35880e=await Messages['findOneById'](_0x16a2c9['id']);if(!_0x35880e)throw new Error(_0x53183b[_0x38c875(0x211)]);const _0x1ed269=await Rooms[_0x38c875(0x23b)](_0x35880e[_0x38c875(0x21b)]);if(!_0x1ed269)throw new Error(_0x38c875(0x23c));if(!await canAccessRoomAsync(_0x1ed269,_0x3818bc))throw new Error(_0x38c875(0x200));const _0xe3d920=await _0xe05c0b[_0x38c875(0x20b)]({'receiver':_0x3818bc,'room':_0x1ed269,'message':_0x35880e});return eval('Math[\'PI\'] * 2;'),API['v1'][_0x38c875(0x1f0)]({'data':_0xe3d920});}}),API['v1'][_0x4a7ba5(0x1ff)](_0x4a7ba5(0x237),{'authRequired':!![]},{async 'get'(){const _0x54d93c=_0x4a7ba5,_0x57086b={'VZXQg':'Push_gateway','mvYVf':function(_0x109bd8,_0x4fb943,_0x52b9ef){return _0x109bd8(_0x4fb943,_0x52b9ef);},'ipwsI':_0x54d93c(0x1f4)},_0x305346=(await Settings[_0x54d93c(0x23b)](_0x57086b[_0x54d93c(0x234)],{'projection':{'packageValue':0x1}}))?.[_0x54d93c(0x1fe)],_0x14dc24=settings[_0x54d93c(0x207)](_0x57086b[_0x54d93c(0x234)])===_0x305346;return _0x57086b[_0x54d93c(0x1f1)](setTimeout,function(){const _0x2889ea=_0x54d93c;_0x2889ea(0x222)==='bbfNk'?console[_0x2889ea(0x225)](_0x2889ea(0x239)):_0x11e3f3[_0x2889ea(0x225)](_0x2889ea(0x239));},0x64),API['v1']['success']({'pushGatewayEnabled':settings[_0x54d93c(0x207)](_0x57086b[_0x54d93c(0x21f)]),'defaultPushGateway':_0x14dc24});}}),API['v1'][_0x4a7ba5(0x1ff)](_0x4a7ba5(0x21e),{'authRequired':!![],'rateLimiterOptions':{'numRequestsAllowed':0x1,'intervalTimeInMS':0x3e8},'permissionsRequired':[_0x4a7ba5(0x21d)]},{async 'post'(){const _0x18d7ac=_0x4a7ba5,_0x3fd2aa={'JmSUb':_0x18d7ac(0x220),'oTQdT':_0x18d7ac(0x1f7),'rcxbY':function(_0x129200,_0x36127a,_0x1a48b2){return _0x129200(_0x36127a,_0x1a48b2);},'DPuJc':_0x18d7ac(0x205)};if(settings[_0x18d7ac(0x207)]('Push_enable')!==!![])throw new Meteor[(_0x18d7ac(0x202))](_0x3fd2aa[_0x18d7ac(0x1fc)],_0x3fd2aa[_0x18d7ac(0x1f3)],{'method':_0x18d7ac(0x1ee)});const _0x52eab5=await _0x3fd2aa['rcxbY'](executePushTest,this['userId'],this[_0x18d7ac(0x1fd)]['username']);return _0x3fd2aa[_0x18d7ac(0x203)](setInterval,_0x3fd2aa[_0x18d7ac(0x233)],0x3e8),API['v1'][_0x18d7ac(0x1f0)]({'tokensCount':_0x52eab5});}});