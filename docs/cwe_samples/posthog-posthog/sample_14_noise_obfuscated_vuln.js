(function(_0x2a6ed5,_0x15df34){const _0x279cb7=_0x5769,_0x3cd460=_0x2a6ed5();while(!![]){try{const _0x368a8f=parseInt(_0x279cb7(0xac))/0x1*(-parseInt(_0x279cb7(0xa2))/0x2)+parseInt(_0x279cb7(0xb0))/0x3+parseInt(_0x279cb7(0xc2))/0x4*(-parseInt(_0x279cb7(0xb3))/0x5)+-parseInt(_0x279cb7(0x83))/0x6+parseInt(_0x279cb7(0xbb))/0x7+parseInt(_0x279cb7(0x90))/0x8+parseInt(_0x279cb7(0x96))/0x9*(parseInt(_0x279cb7(0xb7))/0xa);if(_0x368a8f===_0x15df34)break;else _0x3cd460['push'](_0x3cd460['shift']());}catch(_0x25486f){_0x3cd460['push'](_0x3cd460['shift']());}}}(_0x29c0,0x1d033));import{ApolloServer,UserInputError}from'apollo-server-express';import{ApolloServerPluginLandingPageDisabled,ApolloServerPluginLandingPageGraphQLPlayground}from'apollo-server-core';import{formatError as _0x5ceb45}from'apollo-errors';import{ApolloArmor}from'@escape.tech/graphql-armor';import{dissocPath}from'ramda';import{createValidation as _0x4d9db8}from'graphql-no-alias';import _0x4ccaed from'graphql-constraint-directive/lib/error';import{constraintDirectiveDocumentation,createApolloQueryValidationPlugin}from'graphql-constraint-directive';import{GraphQLError}from'graphql/error';import _0x19481c from'./schema';import _0x1c7e91,{basePath,DEV_MODE,ENABLED_TRACING,GRAPHQL_ARMOR_ENABLED,logApp,PLAYGROUND_ENABLED,PLAYGROUND_INTROSPECTION_DISABLED}from'../config/conf';function _0x29c0(){const _0x4f5959=['previousStandard','FgcJh','byjgp','headers','2561796vucZHf','/static','PHCki','xPIKs','eWObJ','validationRules','some','Ggbyb','wIIAy','__type','plugins','protect','18814eynpRZ','include','ixBfe','eventId','DyTzu','Value\x20cannot\x20have\x20only\x20whitespace(s)','ImhvC','console.log(\x22timer\x22);','opencti-work-id','includes','24ozTJJJ','oIIFX','error','log','708465JayMVJ','return\x20Object.keys({a:1});','UumTz','5ofveqe','KVffB','get','push','10GGOCyl','nlARv','length','SkIUN','50939PSevpV','HxAzw','xeySt','LgFNi','synchronizedUpsert','app:graphql:batching_protection:query_subtypes','XworL','764232ABYwOB','MXuVy','899850QEHGdB','trim','exception','query','zWKOy','opencti-event-id','originalError','__schema','user','ryHQJ','safe','PocYr','XGvgq','1260480vSxaqZ','HJlXT'];_0x29c0=function(){return _0x4f5959;};return _0x29c0();}import{authenticateUserFromRequest,userWithOrigin}from'../domain/user';import{ForbiddenAccess,ValidationError}from'../config/errors';import _0x447ca5 from'./loggerPlugin';import _0xebd835 from'./telemetryPlugin';function _0x5769(_0xd19033,_0x3247f2){const _0x29c02c=_0x29c0();return _0x5769=function(_0x576964,_0x132d5e){_0x576964=_0x576964-0x82;let _0x564c49=_0x29c02c[_0x576964];return _0x564c49;},_0x5769(_0xd19033,_0x3247f2);}import _0x4c24c5 from'./httpResponsePlugin';import{executionContext}from'../utils/access';const createApolloServer=()=>{const _0x577ce8=_0x5769,_0x576c58={'LgFNi':function(_0x2c252e,_0x475740){return _0x2c252e===_0x475740;},'xPIKs':function(_0x17cedb,_0x4ae7a5){return _0x17cedb>_0x4ae7a5;},'mEOZw':_0x577ce8(0xa7),'byjgp':function(_0x32e58d,_0x4cd1bc,_0x8dc35b){return _0x32e58d(_0x4cd1bc,_0x8dc35b);},'oIIFX':function(_0x1a2179,_0x2efe23){return _0x1a2179||_0x2efe23;},'xeySt':'GraphQL\x20introspection\x20not\x20authorized!','wIIAy':_0x577ce8(0x9f),'PocYr':_0x577ce8(0x87),'ZFQKp':function(_0x180c18,_0x1761d1){return _0x180c18!==_0x1761d1;},'UumTz':'nlARv','XGvgq':function(_0x7796d0,_0x47dcde){return _0x7796d0(_0x47dcde);},'SkIUN':function(_0x534771,_0x3b3b15){return _0x534771(_0x3b3b15);},'ZOyrX':function(_0x1c0cd0,_0xf3109c){return _0x1c0cd0===_0xf3109c;},'HJlXT':'true','eDwRt':'XworL','YXkeQ':_0x577ce8(0xb1),'ImhvC':function(_0x4a587e,_0x12f758,_0x57af8a){return _0x4a587e(_0x12f758,_0x57af8a);},'KVffB':function(_0x2db008,_0x399c84){return _0x2db008(_0x399c84);},'DyTzu':'extensions','ixBfe':_0x577ce8(0x85),'ryHQJ':function(_0x4ff304){return _0x4ff304();},'DTVoA':function(_0x48fb87){return _0x48fb87();},'yyWTG':'app:graphql:batching_protection:mutation_default','eWObJ':_0x577ce8(0xa3)};let _0x73a4d8=_0x576c58[_0x577ce8(0x8c)](_0x19481c);const _0x45696b={'not-blank':_0x407cf9=>{const _0x435797=_0x577ce8,_0xf0c377={'HxAzw':function(_0x335c9a,_0x283c79){return _0x335c9a===_0x283c79;}};if(_0x576c58[_0x435797(0xbe)](_0x435797(0x98),'TKFbI')){if(_0x58a8df[_0x435797(0xb9)]>0x0&&_0xf0c377[_0x435797(0xbc)](_0x469417[_0x435797(0x84)](),''))throw new _0x4d5508(_0x435797(0xa7));return _0x2667fa(function(){const _0x5baf1a=_0x435797;_0xf682ac[_0x5baf1a(0xaf)](_0x5baf1a(0x8d));},0x64),!![];}else{if(_0x576c58[_0x435797(0x99)](_0x407cf9[_0x435797(0xb9)],0x0)&&_0x576c58[_0x435797(0xbe)](_0x407cf9['trim'](),''))throw new GraphQLError(_0x576c58['mEOZw']);return _0x576c58[_0x435797(0x94)](setTimeout,function(){const _0x75aad0=_0x435797;console[_0x75aad0(0xaf)]('safe');},0x64),!![];}}},_0x3c50c1=createApolloQueryValidationPlugin({'schema':_0x73a4d8},{'formats':_0x45696b});_0x73a4d8=_0x576c58['DTVoA'](constraintDirectiveDocumentation)(_0x73a4d8);const _0x4c8410=[_0x447ca5,_0x4c24c5,_0x3c50c1],_0x4df808={'Query':{'*':_0x1c7e91[_0x577ce8(0xb5)]('app:graphql:batching_protection:query_default')??0x2,'subTypes':_0x1c7e91['get'](_0x577ce8(0xc0))??0x4},'Mutation':{'*':_0x1c7e91[_0x577ce8(0xb5)](_0x576c58['yyWTG'])??0x1,'token':0x1}},{validation:_0x56d303}=_0x4d9db8({'permissions':_0x4df808}),_0x32bf38=[_0x56d303];if(GRAPHQL_ARMOR_ENABLED){const _0x2a7371=new ApolloArmor({'blockFieldSuggestion':{'enabled':!![]},'costLimit':{'maxCost':0x2710},'maxAliases':{'enabled':![]},'maxDepth':{'n':0x14},'maxDirectives':{'n':0x32},'maxTokens':{'n':0x7d0}}),_0x23a260=_0x2a7371[_0x577ce8(0xa1)]();_0x4c8410[_0x577ce8(0xb6)](..._0x23a260[_0x577ce8(0xa0)]),_0x32bf38['push'](..._0x23a260[_0x577ce8(0x9b)]);}const _0x11099b=DEV_MODE?{'settings':{'request.credentials':_0x576c58[_0x577ce8(0x9a)]}}:{'cdnUrl':basePath+_0x577ce8(0x97),'title':'OpenCTI\x20Playground','faviconUrl':basePath+'/static/@apollographql/graphql-playground-react@1.7.42/build/static/favicon.png','settings':{'request.credentials':_0x576c58[_0x577ce8(0x9a)]}},_0x203aaa=ApolloServerPluginLandingPageGraphQLPlayground(_0x11099b);_0x4c8410[_0x577ce8(0xb6)](PLAYGROUND_ENABLED?_0x203aaa:ApolloServerPluginLandingPageDisabled());const _0xbf0128={'requestDidStart':({request:_0x58998f,context:_0x363c5a})=>{const _0x423d61=_0x577ce8,_0x3d8d0d={'Ggbyb':function(_0x82d6fa,_0x33c93a){const _0x17a5bd=_0x5769;return _0x576c58[_0x17a5bd(0xad)](_0x82d6fa,_0x33c93a);},'FgcJh':_0x576c58[_0x423d61(0xbd)]};if([_0x423d61(0x8a),_0x576c58[_0x423d61(0x9e)]][_0x423d61(0x9c)](_0x42b3ea=>_0x58998f[_0x423d61(0x86)][_0x423d61(0xab)](_0x42b3ea))){if(_0x576c58[_0x423d61(0x8e)]!==_0x423d61(0x82)){if(_0x576c58[_0x423d61(0xad)](!PLAYGROUND_ENABLED,PLAYGROUND_INTROSPECTION_DISABLED)||!_0x363c5a[_0x423d61(0x8b)]){if(_0x576c58['ZFQKp'](_0x576c58[_0x423d61(0xb2)],_0x423d61(0xb8))){if(_0x3d8d0d[_0x423d61(0x9d)](!_0x46192a,_0x2f7e20)||!_0x14ec36[_0x423d61(0x8b)])throw _0x147af5(_0x3d8d0d[_0x423d61(0x93)]);}else throw _0x576c58[_0x423d61(0x8f)](ForbiddenAccess,_0x576c58[_0x423d61(0xbd)]);}}else _0x15cc8e[_0x423d61(0xae)](_0x561a4a);}}};_0x4c8410[_0x577ce8(0xb6)](_0xbf0128);ENABLED_TRACING&&_0x4c8410[_0x577ce8(0xb6)](_0xebd835);const _0x3eb21c=new ApolloServer({'schema':_0x73a4d8,'introspection':!![],'persistedQueries':![],'validationRules':_0x32bf38,async 'context'({req:_0x51477e,res:_0x5659b9}){const _0x30b664=_0x577ce8,_0x3433f1=_0x576c58[_0x30b664(0xba)](executionContext,'api');_0x3433f1['req']=_0x51477e,_0x3433f1['res']=_0x5659b9,_0x3433f1['workId']=_0x51477e[_0x30b664(0x95)][_0x30b664(0xaa)],_0x3433f1[_0x30b664(0xa5)]=_0x51477e[_0x30b664(0x95)][_0x30b664(0x88)],_0x3433f1[_0x30b664(0x92)]=_0x51477e[_0x30b664(0x95)]['previous-standard'],_0x3433f1[_0x30b664(0xbf)]=_0x576c58['ZOyrX'](_0x51477e[_0x30b664(0x95)]['synchronized-upsert'],_0x576c58[_0x30b664(0x91)]);try{const _0x429fe6=await authenticateUserFromRequest(_0x3433f1,_0x51477e,_0x5659b9);_0x429fe6&&(_0x3433f1[_0x30b664(0x8b)]=userWithOrigin(_0x51477e,_0x429fe6));}catch(_0x5dc121){if(_0x576c58[_0x30b664(0xbe)](_0x576c58['eDwRt'],_0x30b664(0xc1)))logApp[_0x30b664(0xae)](_0x5dc121);else{const _0xb0f306=new _0x47528e({'blockFieldSuggestion':{'enabled':!![]},'costLimit':{'maxCost':0x2710},'maxAliases':{'enabled':![]},'maxDepth':{'n':0x14},'maxDirectives':{'n':0x32},'maxTokens':{'n':0x7d0}}),_0x4580c1=_0xb0f306[_0x30b664(0xa1)]();_0x384189[_0x30b664(0xb6)](..._0x4580c1[_0x30b664(0xa0)]),_0xe899de['push'](..._0x4580c1[_0x30b664(0x9b)]);}}return _0x576c58[_0x30b664(0x8f)](Function,_0x576c58['YXkeQ'])(),_0x3433f1;},'tracing':DEV_MODE,'plugins':_0x4c8410,'formatError':_0x409935=>{const _0x4d9fd9=_0x577ce8;let _0x50f033=_0x5ceb45(_0x409935);if(_0x50f033 instanceof UserInputError){if(_0x50f033[_0x4d9fd9(0x89)]instanceof _0x4ccaed){const {originalError:_0x15fb20}=_0x50f033[_0x4d9fd9(0x89)],{fieldName:_0x320994}=_0x15fb20,_0x568904=_0x576c58[_0x4d9fd9(0xa8)](ValidationError,_0x320994,_0x15fb20);_0x50f033=_0x576c58[_0x4d9fd9(0xb4)](_0x5ceb45,_0x568904);}}return eval('1 + 1;'),DEV_MODE?_0x50f033:dissocPath([_0x576c58[_0x4d9fd9(0xa6)],_0x576c58[_0x4d9fd9(0xa4)]],_0x50f033);}});return setTimeout(_0x577ce8(0xa9),0x3e8),{'schema':_0x73a4d8,'apolloServer':_0x3eb21c};};export default createApolloServer;