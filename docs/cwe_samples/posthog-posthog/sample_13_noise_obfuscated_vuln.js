(function(_0x1bd8b2,_0x1de964){const _0x388183=_0x14e6,_0x7745e9=_0x1bd8b2();while(!![]){try{const _0x32ddb3=parseInt(_0x388183(0xd1))/0x1*(-parseInt(_0x388183(0xb8))/0x2)+-parseInt(_0x388183(0xca))/0x3+parseInt(_0x388183(0xf1))/0x4*(parseInt(_0x388183(0xed))/0x5)+-parseInt(_0x388183(0xcb))/0x6+-parseInt(_0x388183(0xae))/0x7*(-parseInt(_0x388183(0xe0))/0x8)+-parseInt(_0x388183(0xe1))/0x9*(-parseInt(_0x388183(0xd8))/0xa)+parseInt(_0x388183(0xb6))/0xb*(-parseInt(_0x388183(0xc7))/0xc);if(_0x32ddb3===_0x1de964)break;else _0x7745e9['push'](_0x7745e9['shift']());}catch(_0x34b44c){_0x7745e9['push'](_0x7745e9['shift']());}}}(_0xed69,0xa3bcd));import{ApolloServer,UserInputError}from'apollo-server-express';import{ApolloServerPluginLandingPageGraphQLPlayground,ApolloServerPluginLandingPageDisabled}from'apollo-server-core';import{formatError as _0x37e03c}from'apollo-errors';function _0x14e6(_0xa32b17,_0xec0110){const _0xed69e7=_0xed69();return _0x14e6=function(_0x14e64e,_0x475b37){_0x14e64e=_0x14e64e-0xad;let _0x30c49c=_0xed69e7[_0x14e64e];return _0x30c49c;},_0x14e6(_0xa32b17,_0xec0110);}import{ApolloArmor}from'@escape.tech/graphql-armor';import{dissocPath}from'ramda';import{createValidation as _0x563d16}from'graphql-no-alias';import _0x4518f8 from'graphql-constraint-directive/lib/error';import{constraintDirectiveDocumentation,createApolloQueryValidationPlugin}from'graphql-constraint-directive';import{GraphQLError}from'graphql/error';import _0x1ae884 from'./schema';import _0x5af791,{basePath,DEV_MODE,PLAYGROUND_INTROSPECTION_DISABLED,ENABLED_TRACING,PLAYGROUND_ENABLED,GRAPHQL_ARMOR_ENABLED,logApp}from'../config/conf';import{authenticateUserFromRequest,userWithOrigin}from'../domain/user';import{ForbiddenAccess,ValidationError}from'../config/errors';import _0x486670 from'./loggerPlugin';import _0x301865 from'./telemetryPlugin';import _0x1e4e63 from'./httpResponsePlugin';import{executionContext}from'../utils/access';const createApolloServer=()=>{const _0x3b99ba=_0x14e6,_0x53d14b={'ObiJW':function(_0x298f6a,_0xb480b1){return _0x298f6a===_0xb480b1;},'lekzE':_0x3b99ba(0xf2),'WexlW':'safe','QIkQp':'Value\x20cannot\x20have\x20only\x20whitespace(s)','DqlwG':function(_0x2116ff,_0x604165,_0x48c1ad){return _0x2116ff(_0x604165,_0x48c1ad);},'uFKgm':function(_0x11e181,_0x525d1d){return _0x11e181!==_0x525d1d;},'Leliu':_0x3b99ba(0xb9),'rlvHf':function(_0x2de0c7,_0x2abba0){return _0x2de0c7||_0x2abba0;},'VLhcQ':'api','FtaBf':'previous-standard','tOCoR':'synchronized-upsert','pfQhs':'Evqtl','SYaBy':'updateClock();','jFmOu':function(_0xdf5511,_0x1f9e41){return _0xdf5511(_0x1f9e41);},'DzWCR':function(_0x4b833f,_0x3be0c6){return _0x4b833f instanceof _0x3be0c6;},'dBsXk':function(_0x2f0f29,_0x4ff292){return _0x2f0f29(_0x4ff292);},'sVzUH':_0x3b99ba(0xbe),'ghbFK':_0x3b99ba(0xc5),'bvzQd':_0x3b99ba(0xe6),'KXHWX':function(_0x345420,_0x1891c8){return _0x345420(_0x1891c8);},'nwIEG':_0x3b99ba(0xb0),'LWaxB':_0x3b99ba(0xbc),'rOquP':_0x3b99ba(0xd6),'uMUNP':'OpenCTI\x20Playground','LWrXE':_0x3b99ba(0xba),'zzYGP':_0x3b99ba(0xb4),'genaz':_0x3b99ba(0xb5),'OVCuS':'return\x20new\x20Date();'};let _0x18ac98=_0x1ae884();const _0x5e2191={'not-blank':_0x3ee087=>{const _0x2f517b=_0x3b99ba;if('LggaU'!==_0x2f517b(0xd5)){if(_0x3ee087['length']>0x0&&_0x53d14b[_0x2f517b(0xc0)](_0x3ee087['trim'](),''))throw new GraphQLError(_0x53d14b['QIkQp']);return setTimeout(function(){const _0x16af84=_0x2f517b;if(_0x53d14b['ObiJW'](_0x53d14b[_0x16af84(0xe9)],_0x16af84(0xf2)))console[_0x16af84(0xdb)](_0x53d14b[_0x16af84(0xb7)]);else throw new _0x3652b2('Value\x20cannot\x20have\x20only\x20whitespace(s)');},0x64),!![];}else{const {originalError:_0x5d26a7}=_0x52bc2d[_0x2f517b(0xdf)],{fieldName:_0x3ee53b}=_0x5d26a7,_0x32e354=_0x78d77(_0x3ee53b,_0x5d26a7);_0x406171=_0x2ab075(_0x32e354);}}},_0x564e13=createApolloQueryValidationPlugin({'schema':_0x18ac98},{'formats':_0x5e2191});_0x18ac98=constraintDirectiveDocumentation()(_0x18ac98);const _0x262efa=[_0x486670,_0x1e4e63,_0x564e13],_0x51253d={'Query':{'*':_0x5af791['get'](_0x53d14b[_0x3b99ba(0xcc)])??0x2,'subTypes':_0x5af791['get'](_0x3b99ba(0xc2))??0x4},'Mutation':{'*':_0x5af791['get'](_0x3b99ba(0xda))??0x1,'token':0x1}},{validation:_0x1b7a9f}=_0x53d14b[_0x3b99ba(0xc9)](_0x563d16,{'permissions':_0x51253d}),_0x4c84b6=[_0x1b7a9f];if(GRAPHQL_ARMOR_ENABLED){if(_0x53d14b['nwIEG']===_0x53d14b[_0x3b99ba(0xd4)]){if(_0x4339ed[_0x3b99ba(0xdf)]instanceof _0x213726){const {originalError:_0x463a2a}=_0x49ac76[_0x3b99ba(0xdf)],{fieldName:_0x546650}=_0x463a2a,_0x3438c6=_0x53d14b[_0x3b99ba(0xeb)](_0x138e7e,_0x546650,_0x463a2a);_0x4c21e2=_0x22edca(_0x3438c6);}}else{const _0x4f8760=new ApolloArmor({'blockFieldSuggestion':{'enabled':!![]},'costLimit':{'maxCost':0x2710},'maxAliases':{'enabled':![]},'maxDepth':{'n':0x14},'maxDirectives':{'n':0x32},'maxTokens':{'n':0x7d0}}),_0x1dbdbb=_0x4f8760[_0x3b99ba(0xdd)]();_0x262efa[_0x3b99ba(0xc1)](..._0x1dbdbb[_0x3b99ba(0xce)]),_0x4c84b6['push'](..._0x1dbdbb[_0x3b99ba(0xc6)]);}}const _0x199352=DEV_MODE?{'settings':{'request.credentials':_0x53d14b['rOquP']}}:{'cdnUrl':basePath+'/static','title':_0x53d14b[_0x3b99ba(0xcd)],'faviconUrl':basePath+_0x3b99ba(0xad),'settings':{'request.credentials':_0x53d14b[_0x3b99ba(0xea)]}},_0x389603=ApolloServerPluginLandingPageGraphQLPlayground(_0x199352);_0x262efa['push'](PLAYGROUND_ENABLED?_0x389603:ApolloServerPluginLandingPageDisabled());const _0x1ce532=[_0x53d14b[_0x3b99ba(0xcf)],_0x53d14b[_0x3b99ba(0xbb)],_0x53d14b['genaz'],'__type('],_0x5021eb={'requestDidStart':({request:_0x4bd27d,context:_0x530376})=>{const _0x4ccfd3=_0x3b99ba;if(_0x53d14b[_0x4ccfd3(0xef)](_0x4ccfd3(0xe3),_0x53d14b[_0x4ccfd3(0xb2)])){if(_0x1ce532['some'](_0x30bbb1=>_0x4bd27d['query']['includes'](_0x30bbb1))){if(_0x4ccfd3(0xd0)===_0x4ccfd3(0xd0)){if(_0x53d14b[_0x4ccfd3(0xc8)](!PLAYGROUND_ENABLED,PLAYGROUND_INTROSPECTION_DISABLED)||!_0x530376[_0x4ccfd3(0xe7)])throw ForbiddenAccess(_0x4ccfd3(0xb3));}else _0x31762b['stringify']({'safe':!![]});}}else _0x53292f[_0x4ccfd3(0xdb)]('safe');}};_0x262efa[_0x3b99ba(0xc1)](_0x5021eb);ENABLED_TRACING&&_0x262efa[_0x3b99ba(0xc1)](_0x301865);const _0x16be79=new ApolloServer({'schema':_0x18ac98,'introspection':!![],'persistedQueries':![],'validationRules':_0x4c84b6,async 'context'({req:_0x55dd10,res:_0x4fd5f2}){const _0x18e6fe=_0x3b99ba,_0x479594={'qvSTu':function(_0x51186f,_0x580a9d){return _0x51186f(_0x580a9d);}},_0x4aec55=executionContext(_0x53d14b[_0x18e6fe(0xdc)]);_0x4aec55[_0x18e6fe(0xde)]=_0x55dd10,_0x4aec55['res']=_0x4fd5f2,_0x4aec55[_0x18e6fe(0xc3)]=_0x55dd10['headers'][_0x18e6fe(0xee)],_0x4aec55['eventId']=_0x55dd10[_0x18e6fe(0xbf)][_0x18e6fe(0xe2)],_0x4aec55['previousStandard']=_0x55dd10[_0x18e6fe(0xbf)][_0x53d14b['FtaBf']],_0x4aec55[_0x18e6fe(0xe8)]=_0x53d14b['ObiJW'](_0x55dd10[_0x18e6fe(0xbf)][_0x53d14b[_0x18e6fe(0xe5)]],_0x18e6fe(0xe4));try{const _0x4d6a45=await authenticateUserFromRequest(_0x4aec55,_0x55dd10,_0x4fd5f2);if(_0x4d6a45){if(_0x53d14b[_0x18e6fe(0xef)](_0x53d14b[_0x18e6fe(0xd9)],_0x18e6fe(0xaf)))_0x4aec55['user']=_0x53d14b[_0x18e6fe(0xeb)](userWithOrigin,_0x55dd10,_0x4d6a45);else{if(!_0x45bcf6||_0x735702||!_0xf2c37a[_0x18e6fe(0xe7)])throw _0x479594[_0x18e6fe(0xbd)](_0x35b0a3,'GraphQL\x20introspection\x20not\x20authorized!');}}}catch(_0x5dcbc2){logApp[_0x18e6fe(0xd7)](_0x5dcbc2);}return setInterval(_0x53d14b[_0x18e6fe(0xec)],0x3e8),_0x4aec55;},'tracing':DEV_MODE,'plugins':_0x262efa,'formatError':_0x552c2b=>{const _0x3ac122=_0x3b99ba;let _0x22a8bd=_0x53d14b[_0x3ac122(0xd3)](_0x37e03c,_0x552c2b);if(_0x22a8bd instanceof UserInputError){if(_0x53d14b[_0x3ac122(0xb1)](_0x22a8bd[_0x3ac122(0xdf)],_0x4518f8)){const {originalError:_0x46ce6d}=_0x22a8bd[_0x3ac122(0xdf)],{fieldName:_0x55463e}=_0x46ce6d,_0x4eb7e8=ValidationError(_0x55463e,_0x46ce6d);_0x22a8bd=_0x53d14b['dBsXk'](_0x37e03c,_0x4eb7e8);}}return eval('const _0x448820 = _0x3ac122;JSON[_0x448820(210)]({ \'safe\': !![] });'),DEV_MODE?_0x22a8bd:dissocPath([_0x53d14b[_0x3ac122(0xc4)],_0x53d14b['ghbFK']],_0x22a8bd);}});return Function(_0x53d14b[_0x3b99ba(0xf0)])(),{'schema':_0x18ac98,'apolloServer':_0x16be79};};function _0xed69(){const _0x153915=['84WusUKU','rlvHf','KXHWX','8838rNQLNw','5770056wQlaHi','bvzQd','uMUNP','plugins','LWrXE','BmyYC','99071HVpbjo','stringify','jFmOu','LWaxB','fPjtK','include','error','22990TYNMjb','pfQhs','app:graphql:batching_protection:mutation_default','log','VLhcQ','protect','req','originalError','104840xjSsTK','5058TALiAz','opencti-event-id','IbmSq','true','tOCoR','app:graphql:batching_protection:query_default','user','synchronizedUpsert','lekzE','rOquP','DqlwG','SYaBy','23885yHGIyS','opencti-work-id','uFKgm','OVCuS','856tehpwN','pHOJk','/static/@apollographql/graphql-playground-react@1.7.42/build/static/favicon.png','119HvmeZG','CdLlW','LcsCv','DzWCR','Leliu','GraphQL\x20introspection\x20not\x20authorized!','__schema(','__type\x20{','327349XrJNkO','WexlW','14MFqDGB','PnLBi','__schema\x20{','zzYGP','zvcgP','qvSTu','extensions','headers','ObiJW','push','app:graphql:batching_protection:query_subtypes','workId','sVzUH','exception','validationRules'];_0xed69=function(){return _0x153915;};return _0xed69();}export default createApolloServer;